<!DOCTYPE html>
<html>
  <head lang="en">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        border: 0;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <script src="node_modules/@jrc03c/js-convex-hull/dist/js-convex-hull.js"></script>
    <script src="node_modules/@jrc03c/js-data-science-helpers/dist/js-data-science-helpers.js"></script>
    <script src="node_modules/@jrc03c/js-math-tools/dist/js-math-tools.js"></script>
    <script src="dist/tf-kmeans.js"></script>
    <script>
      const { add, max, min, normal, random, range, remap, scale, set, shape } =
        JSMathTools

      let width = window.innerWidth
      let height = window.innerHeight
      const padding = 64
      const mouse = { position: [0, 0], buttonIsDown: false }
      const canvas = document.createElement("canvas")
      const context = canvas.getContext("2d")
      canvas.width = width
      canvas.height = height
      document.body.appendChild(canvas)

      canvas.addEventListener("mousedown", () => {
        mouse.buttonIsDown = true
      })

      window.addEventListener("mouseup", () => {
        mouse.buttonIsDown = false
      })

      canvas.addEventListener("mousemove", event => {
        mouse.position[0] = event.offsetX
        mouse.position[1] = event.offsetY
      })

      window.addEventListener("resize", () => {
        width = window.innerWidth
        height = window.innerHeight
        canvas.width = width
        canvas.height = height
      })

      const spread = 100
      const centroids = scale(normal([parseInt(random() * 10) + 1, 2]), spread)
      const labels = []

      const points = range(0, 250).map(() => {
        const index = parseInt(random() * centroids.length)
        const c = centroids[index]
        labels.push(index)
        return add(c, scale(spread / 4, normal(shape(c))))
      })

      const xvalues = points.map(p => p[0])
      const yvalues = points.map(p => p[1])
      const xmin = min(xvalues)
      const xmax = max(xvalues)
      const ymin = min(yvalues)
      const ymax = max(yvalues)

      const numberOfColors = set(labels).length

      const colors = range(0, numberOfColors).map(i => [
        i * (360 / numberOfColors),
        100,
        50,
      ])

      function loop() {
        try {
          context.fillStyle = "rgb(235, 235, 235)"
          context.fillRect(0, 0, width, height)

          context.strokeStyle = "black"
          context.lineWidth = 1

          points.forEach((p, i) => {
            const label = labels[i]
            const color = colors[label]
            const x = remap(p[0], xmin, xmax, padding, width - padding)
            const y = remap(p[1], ymin, ymax, padding, height - padding)
            context.fillStyle = `hsl(${color[0]}deg, ${color[1]}%, ${color[2]}%)`
            context.beginPath()
            context.arc(x, y, 4, 0, Math.PI * 2)
            context.fill()
            context.stroke()
          })

          window.requestAnimationFrame(loop)
        } catch (e) {
          throw e
        }
      }

      loop()
    </script>
  </body>
</html>
