(()=>{var ef=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')});var ue=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var $i=ue((tnt,uS)=>{var jg=class extends Error{constructor(e){typeof window<"u"?super(e):super(`

\x1B[31m`+e+`
\x1B[0m`)}};uS.exports=jg});var ze=ue((rnt,lS)=>{var nH=$i();lS.exports=function(r,e){if(!r)throw new nH(e)}});var He=ue((nnt,cS)=>{function aH(r){try{return r instanceof Array||typeof r.constructor<"u"&&r.constructor.name==="Array"}catch{return!1}}cS.exports=aH});var yt=ue((ant,fS)=>{function iH(r){try{return!!r._symbol&&r._symbol===Symbol.for("@jrc03c/js-math-tools/dataframe")}catch{return!1}}fS.exports=iH});var Fn=ue((int,hS)=>{function oH(r){return typeof r=="function"}hS.exports=oH});var ut=ue((ont,pS)=>{function sH(r){return typeof r=="number"&&!isNaN(r)}pS.exports=sH});var Tt=ue((snt,dS)=>{function uH(r){return r===null||typeof r>"u"}dS.exports=uH});var Bo=ue((unt,vS)=>{var lH=He(),cH=Tt();function fH(r){return typeof r=="object"&&!cH(r)&&!lH(r)}vS.exports=fH});var vt=ue((lnt,mS)=>{function hH(r){try{return!!r._symbol&&r._symbol===Symbol.for("@jrc03c/js-math-tools/series")}catch{return!1}}mS.exports=hH});var tf=ue((cnt,bS)=>{var pH=ze(),gS=He(),dH=yt(),vH=Fn(),Xg=ut(),yS=Bo(),mH=vt();function Yg(r,e){if(dH(r)){let i=Yg(r.values,e);return i.length>0&&Xg(i[0])&&i[0]>=0&&i[0]<r.index.length&&(i[0]=r.index[i[0]]),i.length>1&&Xg(i[1])&&i[1]>=0&&i[1]<r.columns.length&&(i[1]=r.columns[i[1]]),i}if(mH(r)){let i=Yg(r.values,e);return i.length>0&&Xg(i[0])&&i[0]>=0&&i[0]<r.index.length&&(i[0]=r.index[i[0]]),i}if(pH(yS(r)||gS(r),"You must pass (1) an object, array, Series, or DataFrame and (2) a function or value into the `indexOf` function!"),!vH(e)){let i=e;e=o=>o===i}function t(i,o,s){if(s=s||[],s.indexOf(i)>-1)return null;if(yS(i)){s.push(i);let u=Object.keys(i);for(let l=0;l<u.length;l++){let c=u[l],f=i[c];if(o(f))return[c];let h=t(f,o,s);if(h&&h.length>0)return[c].concat(h)}}else if(gS(i)){s.push(i);for(let u=0;u<i.length;u++){let l=i[u];if(o(l))return[u];let c=t(l,o,s);if(c&&c.length>0)return[u].concat(c)}}else if(o(i))return[];return null}function n(i){try{return e(i)}catch{return!1}}let a=t(r,n);return a&&a.length>0?a:null}bS.exports=Yg});var Wi=ue((fnt,wS)=>{var gH=tf(),yH=He(),bH=yt(),wH=vt();function xH(r){function e(n,a,i){if(bH(n)||wH(n))return n.copy();if(a=a||[],i=i||"",a.indexOf(n)>-1){let o=i.split("/").slice(i.startsWith("/")?1:0);if(o.some((u,l)=>{let c=o.slice(0,o.length-l-1),f=t;return c.forEach(h=>{f=f[h]}),f===n}))return`<reference to "${t===n?"/":"/"+gH(t,n).join("/")}">`}if(typeof n=="object"){if(n===null)return null;if(a.push(n),yH(n))return n.map((o,s)=>e(o,a,i+"/"+s));{let o={};return Object.keys(n).forEach(s=>{o[s]=e(n[s],a,i+"/"+s)}),o}}else return n}let t=r;return e(r)}wS.exports=xH});var Fr=ue((hnt,SS)=>{var kH=ze(),SH=Wi(),xS=He(),NH=yt(),EH=vt();function kS(r){if(NH(r)||EH(r))return kS(r.values);kH(xS(r),"The `flatten` function only works on arrays, Series, and DataFrames!");function e(t){let n=[];return SH(t).forEach(a=>{xS(a)?n=n.concat(e(a)):n.push(a)}),n}return e(r)}SS.exports=kS});var qi=ue((pnt,ES)=>{var NS=Wi();function TH(r,e){function t(n,a){let i=typeof n;if(i!==typeof a)return!1;if(i==="undefined")return!0;if(i==="boolean"||i==="symbol")return n===a;if(i==="number"||i==="bigint")return n.toString()==="NaN"&&a.toString()==="NaN"?!0:n===a;if(i==="string"||i==="function")return n===a;if(i==="object"){if(n===null||a===null)return n===null&&a===null;{let s=Object.keys(n),u=Object.keys(a);if(s.length!==u.length)return!1;for(let l=0;l<s.length;l++){let c=s[l];if(!t(n[c],a[c]))return!1}return!0}}}return t(NS(r),NS(e))}ES.exports=TH});var di=ue((dnt,AS)=>{var IH=ze(),CH=Fr(),AH=He(),TS=yt(),_H=Fn(),IS=vt(),DH=Tt();function rf(r){let e="abcdefg1234567890",t="";for(;t.length<r;)t+=e[parseInt(Math.random()*e.length)];return t}var FH=rf(256),RH=rf(256),OH=rf(256),PH=rf(256),MH=rf(256);function CS(r){if(TS(r)||IS(r))return CS(r.values);IH(AH(r),"The `set` function only works on arrays, Series, and DataFrames!");let e=[],t={};return CH(r).forEach(n=>{let a=typeof n=="object"&&n===null?FH:DH(n)?RH:_H(n)?n.toString():typeof n=="symbol"?n.toString()+" - "+MH:n===1/0?OH:n===-1/0?PH:TS(n)?n.toJSONString():IS(n)?JSON.stringify(n.toObject()):JSON.stringify(n);t[a]||e.push(n),t[a]=!0}),e}AS.exports=CS});var Vp=ue((vnt,FS)=>{var BH=ze(),Zg=Fr(),_S=He(),LH=yt(),DS=qi(),zH=Fn(),$H=vt(),WH=di();function qp(r,e){if(LH(r)||$H(r))return arguments.length>1?qp(r.values,e):qp(r.values,r.values);if(BH(_S(r),"The first argument to the `count` function must be an array, Series, or DataFrame!"),zH(e))return Zg(r).filter(t=>e(t)).length;if(_S(e)){let t=Zg(r);return WH(e).map(n=>({item:n,count:t.filter(a=>DS(a,n)).length}))}else return arguments.length>1?Zg(r).filter(t=>DS(t,e)).length:qp(r,r)}FS.exports=qp});var nf=ue((mnt,OS)=>{var qH=ze(),RS=He(),VH=yt(),GH=vt();function Jg(r){if(VH(r)||GH(r))return Jg(r.values);qH(RS(r),"The `isJagged` function only works on arrays, Series, and DataFrames!");let e=0,t=null;for(let n=0;n<r.length;n++)if(RS(r[n])){if(e++,Jg(r[n]))return!0;if(t===null)t=r[n].length;else if(r[n].length!==t)return!0}return e>0&&e<r.length}OS.exports=Jg});var Gp=ue((gnt,BS)=>{var UH=ze(),PS=He(),HH=yt(),KH=vt();function MS(r){if(HH(r)||KH(r))return MS(r.values);UH(PS(r),"The `isNested` function only works on arrays, Series, and DataFrames!");for(let e=0;e<r.length;e++)if(PS(r[e]))return!0;return!1}BS.exports=MS});var Lo=ue((ynt,zS)=>{var Os=ze(),jH=He(),XH=Gp(),YH=ut(),ZH=Tt(),ll="You must pass a natural number or a one-dimensional array of natural numbers into the `ndarray` function!";function LS(r){Os(!ZH(r),ll),jH(r)||(r=[r]),Os(!XH(r),ll),Os(r.length>0,ll);let e=r[0];if(Os(YH(e),ll),Os(parseInt(e)===e,ll),Os(e>=0,ll),Os(e!==1/0,"We can't create an array containing an infinite number of values!"),r.length===1){let t=[];for(let n=0;n<e;n++)t.push(void 0);return t}else{let t=[];for(let n=0;n<e;n++)t.push(LS(r.slice(1)));return t}}zS.exports=LS});var af=ue((bnt,$S)=>{var JH=ze(),QH=He(),eK=yt(),tK=vt();function Qg(r){if(eK(r)||tK(r)){let t=r.copy();return t.values=Qg(t.values),t.index=Qg(t.index),t}JH(QH(r),"The `reverse` function only works on arrays, Series, and DataFrames!");let e=[];for(let t=r.length-1;t>=0;t--)e.push(r[t]);return e}$S.exports=Qg});var Zn=ue((wnt,WS)=>{var ey=ze(),ty=ut(),ry=Tt(),rK=af();function nK(r,e,t=1){ey(!ry(r)&&!ry(e)&&!ry(t),"You must pass two numbers and optionally a step value to the `range` function!"),ey(ty(r)&&ty(e)&&ty(t),"You must pass two numbers and optionally a step value to the `range` function!"),ey(t>0,"The step value must be greater than 0! (NOTE: The step value is a magnitude; it does not indicate direction.)");let n=!1;if(r>e){n=!0;let i=r;r=e+t,e=i+t}let a=[];for(let i=r;i<e;i+=t)a.push(i);return n&&(a=rK(a)),a}WS.exports=nK});var wr=ue((xnt,US)=>{var aK=ze(),qS=He(),iK=yt(),oK=qi(),sK=vt(),uK=Tt();function VS(r){if(!qS(r))return;let e=[r.length],t=0,n=r.map(a=>{let i=VS(a);return uK(i)?i:(t++,i.length===1?i[0]:i)});return t>0?t===r.length&&n.slice(0,-1).every((i,o)=>oK(i,n[o+1]))?e.concat(n[0]):(e.push(n),e):e}function GS(r){return iK(r)||sK(r)?GS(r.values):(aK(qS(r),"The `shape` function only works on arrays, Series, and DataFrames!"),VS(r))}US.exports=GS});var ZS=ue((knt,YS)=>{var HS=ze(),lK=He(),cK=yt(),fK=nf(),hK=vt(),pK=Tt(),KS=$i(),Up=Lo(),jS=Zn(),dK=di(),vK=wr();function XS(r,e,t){if(pK(t)&&(t=0),HS(t===0||t===1||t==="vertical"||t==="horizontal",'The only valid axis values for use when appending data to a DataFrame are 0, 1, "vertical", and "horizontal". Note that 0 == "horizontal" and 1 == "vertical".'),lK(e)){HS(!fK(e),"The array of data you're trying to append to this DataFrame is jagged!");let n=vK(e);if(n.length===1)if(t===0){let a=r.copy();a._values.push(e);let i=Math.max(r.shape[1],n[0]);for(a._values.forEach(o=>{for(;o.length<i;)o.push(void 0)});a._index.length<a._values.length;)a._index.push("row"+a._index.length);for(;a._columns.length<i;)a._columns.push("col"+a._columns.length);return a}else{let a=Math.max(r.shape[0],n[0]),i=r.copy();for(jS(0,a).forEach(o=>{o>=i._values.length&&i._values.push(Up(r.shape[1])),i._values[o].push(e[o])});i._index.length<i._values.length;)i._index.push("row"+i._index.length);for(;i._columns.length<i._values[0].length;)i._columns.push("col"+i._columns.length);return i}else if(n.length===2)if(t===0){let a=Math.max(...e.map(o=>o.length).concat([r.shape[1]])),i=r.copy();for(i._values=i._values.concat(e).map(o=>{for(;o.length<a;)o.push(void 0);return o});i._index.length<i._values.length;)i._index.push("row"+i._index.length);for(;i._columns.length<a;)i._columns.push("col"+i._columns.length);return i}else{let a=Math.max(...e.map(s=>s.length))+r.shape[1],i=Math.max(r.shape[0],n[0]),o=r.copy();for(jS(0,i).forEach(s=>{for(s>=o._values.length&&o._values.push(Up(r.shape[1])),o._values[s]=o._values[s].concat(e[s]);o._values[s].length<a;)o._values[s].push(void 0)});o._index.length<o._values.length;)o._index.push("row"+o._index.length);for(;o._columns.length<a;)o._columns.push("col"+o._columns.length);return o}else throw new KS("Only 1- and 2-dimensional arrays can be appended to a DataFrame!")}else if(hK(e)){let n=XS(r,e.values,t);return t===0?n.index[n.index.length-1]=n.index.indexOf(e.name)>-1?e.name+" (2)":e.name:n.columns[n.columns.length-1]=n.columns.indexOf(e.name)>-1?e.name+" (2)":e.name,n}else if(cK(e))if(t===0){let n=r.copy(),a=dK(n._columns.concat(e._columns)).length;for(n._values.forEach(i=>{for(;i.length<a;)i.push(void 0)}),e.apply(i=>{let o=i.copy(),s=[];n._columns.forEach(u=>{let l=o._index.indexOf(u);l>-1?(s.push(o._values[l]),o._values.splice(l,1),o._index.splice(l,1)):s.push(void 0)}),n._values.push(s.concat(o._values))},1),n._columns=n._columns.concat(e._columns.filter(i=>n._columns.indexOf(i)<0));n._index.length<n._values.length;){let i="row"+n._index.length;n._index.push(i+(r._index.indexOf(i)>-1?" (2)":""))}return n}else{let n=r.copy();return n._index.forEach((a,i)=>{let o=e._index.indexOf(a);o>-1?n._values[i]=n._values[i].concat(e._values[o]):n._values[i]=n._values[i].concat(Up(e.shape[1]))}),e._index.forEach((a,i)=>{n._index.indexOf(a)<0&&(n._index.push(a),n._values.push(Up(n._columns.length).concat(e._values[i])))}),n._columns=n._columns.concat(e._columns.map(a=>a+(n._columns.indexOf(a)>-1?" (2)":""))),n}else throw new KS("Only 1- or 2-dimensional arrays, Series, and DataFrames can be appended to a DataFrame!")}YS.exports=XS});var rN=ue((Snt,tN)=>{var JS=ze(),QS=He(),mK=Fn(),eN=Tt();function gK(r,e,t,n,a){if(a=a||0,JS(mK(n),"The first parameter to the `apply` method must be a function."),JS(a===0||a===1,"The second parameter to the `apply` method (the `axis`) must be 0 or 1."),a===0){let i={},o;if(t.columns.forEach((s,u)=>{let l=new e(t.values.map(f=>f[u]));l.name=s,l.index=t.index;let c=n(l,u,t);c instanceof e?i[s]=c.values:i[s]=c,eN(o)&&(o=c instanceof e||QS(c))}),o){let s=new r(i);return s.index=t.index,s}else{let s=new e(t.columns.map(u=>i[u]));return s.index=t.columns,s}}else if(a===1){let i,o=t.values.map((s,u)=>{let l=new e(s);l.name=t.index[u],l.index=t.columns;let c=n(l,u,t);return eN(i)&&(i=c instanceof e||QS(c)),c instanceof e?c.values:c});if(i){let s=new r(o);return s.index=t.index,s.columns=t.columns,s}else{let s=new e(o);return s.index=t.index,s}}}tN.exports=gK});var kn=ue((Nnt,nN)=>{function yK(r){return typeof r=="string"}nN.exports=yK});var oN=ue((Ent,iN)=>{var aN=ze(),bK=He(),wK=nf(),xK=Bo(),kK=kn(),SK=Tt(),NK=$i(),EK=wr();function TK(r,e,t,n,a){let i=s=>s instanceof r,o=s=>s instanceof e;if(SK(a)){if(i(n))return t.append(n,1);if(o(n))return t.append(n,1);if(xK(n)){let s=Math.max(...Object.keys(n).map(u=>n[u].length));return Object.keys(n).forEach(u=>{for(;n[u].length<s;)n[u].push(void 0)}),t.append(new r(n),1)}else throw new NK("You must pass a DataFrame, Series, or object into the `assign` method!")}else{aN(kK(n),"If passing two arguments into the `assign` method, then the first argument must be a string name!"),aN(bK(a)&&!wK(a)&&EK(a).length===1,"If passing two arguments into the `assign` method, then the second argument must be a 1-dimensional array!");let s=t.append(a,1);return s.columns[s.columns.length-1]=n,s}}iN.exports=TK});var uN=ue((Tnt,sN)=>{var IK=Wi();function CK(r,e){if(e.isEmpty)return new r;let t=new r(IK(e.values));return t.columns=e.columns.slice(),t.index=e.index.slice(),t}sN.exports=CK});var vN=ue((Int,dN)=>{var Hp=ze(),lN=He(),cN=ut(),fN=kn(),hN=Tt(),pN=wr();function AK(r,e,t,n,a){hN(n)&&(n=[]),hN(a)&&(a=[]),(fN(n)||cN(n))&&(n=[n]),(fN(a)||cN(a))&&(a=[a]),Hp(lN(n),"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings."),Hp(lN(a),"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings."),Hp(pN(n).length===1,"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings."),Hp(pN(a).length===1,"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings.");let i,o;t.index.forEach((u,l)=>{n.indexOf(u)<0&&n.indexOf(l)<0&&(i||(i=[]),i.push(u))}),t.columns.forEach((u,l)=>{a.indexOf(u)<0&&a.indexOf(l)<0&&(o||(o=[]),o.push(u))});let s=t.get(i,o);if(s instanceof e){let u=new r;u=u.assign(s),t.index.indexOf(s.name)>-1&&(u=u.transpose()),s=u}return s}dN.exports=AK});var of=ue((Cnt,mN)=>{var _K=ut();function DK(r){return _K(r)&&parseInt(r)===r}function FK(r){return DK(r)&&r>=0}mN.exports=FK});var yN=ue((Ant,gN)=>{var ny=ze(),RK=kn(),Kp=Tt(),OK=of(),PK=wr();function MK(r,e,t,n,a,i){n=n||0,ny(n===0||n===1,"The first parameter of the `dropMissing` method (the `axis`) must be 0 or 1."),i=i||0,ny(OK(i),"The third parameter of the `dropMissing` method (the `threshold`) should be a whole number (meaning that data should be dropped if it contains more than `threshold` null values)."),a=i>0?"none":a||"any",ny(a==="any"||a==="all"||a==="none","The second parameter of the `dropMissing` method (the `condition` parameter, which indicates the condition under which data should be dropped) should be 'any' or 'all' (meaning that if 'any' of the data contains null values, then it should be dropped; or that if 'all' of the data contains null values, then it should be dropped).");function o(l){if(i>0){let c=0;for(let f=0;f<l.length;f++){let h=l[f];if(Kp(h)&&c++,c>=i)return[]}}else if(a==="any")for(let c=0;c<l.length;c++){let f=l[c];if(Kp(f))return[]}else if(a==="all"){for(let c=0;c<l.length;c++){let f=l[c];if(!Kp(f))return l}return[]}return l}let s=t.copy(),u=Math.random().toString();if(n===0){s=s.assign(u,s.index);let l=s.values.map(o).filter(f=>f.length>0);if(PK(l).length<2)return new r;s.values=l;let c=s.get(null,u);if(Kp(c))return new r;RK(c)&&(c=[c]),c instanceof e&&(c=c.values),s.index=c,s=s.drop(null,u)}else if(n===1){let l={};if(s.columns.forEach((f,h)=>{let p=s.values.map(m=>m[h]),d=o(p);d.length>0&&(l[f]=d)}),Object.keys(l).length===0)return new r;let c=new r(l);return c.index=s.index,c}return s}gN.exports=MK});var ay=ue((_nt,wN)=>{var BK=ze(),LK=He(),zK=yt(),$K=ut(),WK=vt();function bN(r){if(zK(r)||WK(r))return r.dropNaN(...Object.values(arguments).slice(1));BK(LK(r),"The `dropNaN` function only works on arrays, Series, and DataFrames!");let e=[];return r.forEach(t=>{try{return e.push(bN(t))}catch{if($K(t))return e.push(t)}}),e}wN.exports=bN});var kN=ue((Dnt,xN)=>{var iy=ze(),qK=ay(),VK=of();function GK(r,e,t,n,a){t=t||0,iy(t===0||t===1,"The first parameter of the `dropNaN` method (the `axis`) must be 0 or 1."),a=a||0,iy(VK(a),"The third parameter of the `dropNaN` method (the `threshold`) should be a whole number (meaning that data should be dropped if it contains more than `threshold` NaN values)."),n=a>0?"none":n||"any",iy(n==="any"||n==="all"||n==="none","The second parameter of the `dropNaN` method (the `condition` parameter, which indicates the condition under which data should be dropped) should be 'any' or 'all' (meaning that if 'any' of the data contains NaN values, then it should be dropped; or that if 'all' of the data contains NaN values, then it should be dropped).");function i(s){let u=qK(s);return a>0?s.length-u.length<a:n==="any"?u.length===s.length:n==="all"?u.length>0:!0}let o=e.copy();if(t===0){let s=o.index.filter(u=>{let l=o.get(u,null).values;return i(l)});return s.length>0?o.get(s,null):new r}else if(t===1){let s=o.columns.filter(u=>{let l=o.get(null,u).values;return i(l)});return s.length>0?o.get(null,s):new r}return o}xN.exports=GK});var TN=ue((Fnt,EN)=>{var SN=ze(),sf=Fr(),UK=Fn(),HK=Tt();function NN(r){let e={};return sf(r).forEach((t,n)=>{e[t]=n}),e}function cl(r){return Object.keys(r).sort((e,t)=>r[e]-r[t])}function KK(r,e,t,n,a){SN(UK(n),"The `filter` method takes a single parameter: a function that is used to filter the values."),HK(a)&&(a=0),SN(a===0||a===1,"The `axis` parameter to the `filter` method must be 0 or 1.");let i=t.copy();if(i.isEmpty)return i;let o=NN(i.index),s=NN(i.columns);if(a===0){let u=i.values.filter((l,c)=>{let f=new e(l);f.name=t.index[c],f.index=t.columns;let h=n(f,c,t);return h||delete o[i.index[c]],h});if(sf(u).length===0)return new r;if(u.length===1){let l=new e(sf(u));return l.name=cl(o)[0],l.index=cl(s),l}i.values=u,i.index=cl(o)}else if(a===1){i=i.transpose();let u=i.values.filter((l,c)=>{let f=new e(l);f.name=t.columns[c],f.index=t.index;let h=n(f,c,t);return h||delete s[i.index[c]],h});if(sf(u).length===0)return new r;if(u.length===1){let l=new e(sf(u));return l.name=cl(s)[0],l.index=cl(o),l}i.values=u,i.index=cl(s),i=i.transpose()}return i}EN.exports=KK});var uf=ue((Rnt,IN)=>{function jK(r){return typeof r=="boolean"}IN.exports=jK});var Ps=ue((Ont,AN)=>{var XK=ze(),YK=Fr(),ZK=He(),JK=yt(),QK=vt();function CN(r){if(JK(r)||QK(r))return CN(r.values);XK(ZK(r),"The `max` function only works on arrays, Series, and DataFrames!");try{return Math.max(...YK(r))}catch{return NaN}}AN.exports=CN});var oy=ue((Pnt,FN)=>{var jp=$i(),zo=ze(),$o=He(),_N=uf(),Xp=kn(),Yp=Tt(),e5=Ps(),DN=Zn();function t5(r,e,t,n,a,i){return t=(()=>{if(Yp(t))return!1;if(_N(t))return t;throw new jp("The `hasHeaderRow` parameter of the `fromCSV` method must be a boolean!")})(),n=(()=>{if(Yp(n))return!1;if(_N(n))return n;throw new jp("The `hasIndexColumn` parameter of the `fromCSV` method must be a boolean!")})(),a=(()=>{let s="The `fieldDelimiter` parameter of the `fromCSV` method must be one of:\n\n1) a single-character string (e.g., ',')\n2) an array containing two single-character strings, one each for a left delimiter and a right delimiter (e.g., ['<', '>'])";if(Yp(a))return",";if(Xp(a))return zo(a.length===1,s),a;if($o(a))return zo(a.length===2,s),zo(a[0].length===1,s),zo(a[1].length===1,s),a;throw new jp(s)})(),i=(()=>{let s="The `stringDelimiter` parameter of the `fromCSV` method must be one of:\n\n1) a single-character string (e.g., '\"')\n2) an array containing two single-character strings, one each for a left delimiter and a right delimiter (e.g., ['\u201C', '\u201D'])";if(Yp(i))return'"';if(Xp(i))return zo(i.length===1,s),i;if($o(i))return zo(i.length===2,s),zo(i[0].length===1,s),zo(i[1].length===1,s),i;throw new jp(s)})(),(()=>{let u=e.split(`
`).filter(p=>p.length>0).map(p=>{let d=[],m="",v=!1;for(let g=0;g<p.length;g++){let y=p[g];if(y.match(/\\/g))g++;else if($o(i)&&y===i[0])v=!0;else if($o(i)&&y===i[1])v=!1;else if(Xp(i)&&y===i)v=!v;else if($o(a)&&y===a[0]||$o(a)&&y===a[1]||Xp(a)&&y===a)if(v)m+=y;else{let b=m;try{let w=JSON.parse(b);$o(w)?d.push(b.trim()):d.push(w)}catch{d.push(b.trim())}m=""}else m+=y}if(m.length>0){let g=m;try{let y=JSON.parse(g);$o(y)?d.push(g.trim()):d.push(y)}catch{d.push(g.trim())}}return d}),l=(()=>{let p=t?u.shift():DN(0,u[0].length).map(d=>"col"+d);return n&&p.shift(),p})(),c=(()=>n?u.map(d=>d.shift()):DN(0,u.length).map(d=>"row"+d))(),f=e5(u.map(p=>p.length)),h=new r(u.map(p=>(p.length=f,p)));return t&&(h.columns=l),n&&(h.index=c),h})()}FN.exports=t5});var ON=ue((Mnt,RN)=>{var r5=$i(),n5=ze(),a5=oy(),i5=kn(),o5=Tt();async function s5(r,e,t,n,a,i,o){t=(()=>o5(t)?"utf8":(n5(i5(t),"The `encoding` parameter of the `fromCSV` method must be a string (e.g., 'utf8')!"),t))();let s=await(async()=>{try{return ef("fs").readFileSync(e,t)}catch{}try{return await(await fetch(e)).text()}catch{}throw new r5(`The path "${e}" could not be loaded!`)})();return a5(r,s,n,a,i,o)}RN.exports=s5});var BN=ue((Bnt,MN)=>{var $a=ze(),Zp=ut(),Jp=kn(),PN=Tt(),u5=di();function l5(r,e,t){(Jp(e)||Zp(e))&&(e=[e]),(Jp(t)||Zp(t))&&(t=[t]);let n=u5((e||[]).concat(t||[]).map(a=>typeof a));return $a(n.length<=2,"Only whole numbers and/or strings are allowed in `get` arrays!"),n.length===1&&$a(n[0]==="string"||n[0]==="number","Only whole numbers and/or strings are allowed in `get` arrays!"),n.length===2&&($a(n.indexOf("string")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!"),$a(n.indexOf("number")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!")),PN(e)||(e=e.map(a=>{if(Jp(a))return $a(r.index.indexOf(a)>-1,`Row "${a}" does not exist!`),a;if(Zp(a))return $a(a>=0,`Index ${a} is out of bounds!`),$a(parseInt(a)===a,"Row numbers must be integers!"),$a(a<r.index.length,`Index ${a} is out of bounds!`),r.index[a]})),PN(t)||(t=t.map(a=>{if(Jp(a))return $a(r.columns.indexOf(a)>-1,`Column "${a}" does not exist!`),a;if(Zp(a))return $a(a>=0,`Column ${a} is out of bounds!`),$a(parseInt(a)===a,"Column numbers must be integers!"),$a(a<r.columns.length,`Column ${a} is out of bounds!`),r.columns[a]})),r.getSubsetByNames(e,t)}MN.exports=l5});var Wo=ue((Lnt,zN)=>{var LN=ze(),c5=He(),f5=yt(),h5=Fn(),p5=vt(),d5=Tt();function v5(r,e){try{return r<e?-1:r>e?1:0}catch{return r=typeof r=="object"&&r!==null?JSON.stringify(r):r.toString(),e=typeof e=="object"&&e!==null?JSON.stringify(e):e.toString(),r<e?-1:r>e?1:0}}function m5(r,e){if(d5(e)&&(e=v5),f5(r)||p5(r))return r.sort(...Object.values(arguments).slice(1));LN(c5(r),"The `sort` function only works on arrays, Series, and DataFrames!"),LN(h5(e),"The second parameter of the `sort` function must be a comparison function!");let t=r.slice();return t.sort(e),t}zN.exports=m5});var VN=ue((znt,qN)=>{var $N=ze(),WN=kn(),g5=Tt(),y5=di(),b5=Wo();function w5(r){let e=r.toLowerCase(),t="";for(let a=0;a<e.length;a++){let i=e[a];i.match(/[a-z0-9]/g)?t+=i:t+=" "}let n=t.split(" ").filter(a=>a.length>0);return n[0]+n.slice(1).map(a=>a[0].toUpperCase()+a.substring(1)).join("")}function x5(r,e,t){g5(t)?t=e.columns:WN(t)&&(t=[t]);let n={};t.forEach(i=>{$N(WN(i),"You must pass either a string or a one-dimensional array of strings into the `getDummies` (AKA `oneHotEncode`) method!");let o=e.columns.indexOf(i);$N(o>-1,`The given DataFrame does not have a column called "${i}"!`);let s=e.values.map(l=>l[o]),u=b5(y5(s));s.forEach(l=>{u.forEach(c=>{let f=i+"_"+w5(c.toString());n[f]||(n[f]=[]),l===c?n[f].push(1):n[f].push(0)})})});let a=new r(n);return a.index=e.index,a}qN.exports=x5});var ZN=ue(($nt,YN)=>{var qo=ze(),GN=He(),UN=ut(),HN=Tt(),KN=of(),jN=Zn(),XN=wr();function k5(r,e,t){let n=r.shape;HN(e)&&(e=jN(0,n[0])),HN(t)&&(t=jN(0,n[1])),UN(e)&&(e=[e]),UN(t)&&(t=[t]),qo(GN(e)&&GN(t),"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),qo(XN(e).length===1&&XN(t).length===1,"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),qo(e.length>0,"The `rowIndices` array must contain at least one index."),qo(t.length>0,"The `colIndices` array must contain at least one index."),e.forEach(o=>{qo(KN(o),"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),qo(o<r.index.length,`The row index ${o} is out of bounds.`)}),t.forEach(o=>{qo(KN(o),"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),qo(o<r.columns.length,`The column index ${o} is out of bounds.`)});let a=e.map(o=>r.index[o]),i=t.map(o=>r.columns[o]);return r.getSubsetByNames(a,i)}YN.exports=k5});var rE=ue((Wnt,tE)=>{var Vo=ze(),sy=Fr(),JN=He(),Qp=kn(),QN=Tt(),eE=wr();function S5(r,e,t,n,a){QN(n)&&(n=t.index),QN(a)&&(a=t.columns),Qp(n)&&(n=[n]),Qp(a)&&(a=[a]),Vo(JN(n)&&JN(a),"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),Vo(eE(n).length===1&&eE(a).length===1,"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),Vo(n.length>0,"The `rows` array must contain at least one row name."),Vo(a.length>0,"The `cols` array must contain at least one column name."),n.forEach(s=>{Vo(Qp(s),"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),Vo(t.index.indexOf(s)>-1,`The row name "${s}" does not exist in the list of rows.`)}),a.forEach(s=>{Vo(Qp(s),"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),Vo(t.columns.indexOf(s)>-1,`The column name "${s}" does not exist in the list of columns.`)});let i=n.map(s=>a.map(u=>t.values[t.index.indexOf(s)][t.columns.indexOf(u)]));if(n.length===1&&a.length===1)return sy(i)[0];if(n.length===1){let s=new e(sy(i));return s.name=n[0],s.index=a,s}if(a.length===1){let s=new e(sy(i));return s.name=a[0],s.index=n,s}let o=new r(i);return o.columns=a,o.index=n,o}tE.exports=S5});var aE=ue((qnt,nE)=>{var N5=kn(),lf=Zn();function E5(r,e,t){function n(h,p){return N5(h)&&h.length>p?h.substring(0,p-3)+"...":h}if(t.isEmpty)return console.table({}),console.log("Shape:",[0,0],`
`),t;let a=typeof window>"u"?20:10,i=parseInt(a/2),o=typeof window>"u"?Math.floor(process.stdout.columns/24)-1:10,s=parseInt(o/2),u=a>t.index.length?null:lf(0,i).concat(lf(t.index.length-i,t.index.length)),l=o>t.columns.length?null:lf(0,s).concat(lf(t.columns.length-s,t.columns.length)),c=t.get(u,l);c instanceof e&&(t.shape[0]===1?(c=new r([c.values]),c.index=t.index,c.columns=new e(t.columns).get(l).values):t.shape[1]===1&&(c=new r([c.values]).transpose(),c.index=new e(t.index).get(u).values,c.columns=t.columns)),a<=t.index.length&&(c._index.splice(i,0,"..."),c._values.splice(i,0,lf(0,c.columns.length).map(()=>"..."))),o<=t.columns.length&&(c._columns.splice(s,0,"..."),c._values=c._values.map(h=>(h.splice(s,0,"..."),h)));let f=28;return c instanceof e?(c.values=c.values.map(h=>n(h,f)),c.name=n(c.name,f),c.index=c.index.map(h=>n(h,f))):(c.values=c.values.map(h=>h.map(p=>n(p,f))),c.columns=c.columns.map(h=>n(h,f)),c.index=c.index.map(h=>n(h,f))),console.table(c.toObject()),console.log("Shape:",t.shape,`
`),t}nE.exports=E5});var ed=ue((Vnt,iE)=>{var T5=ze(),I5=ut();function C5(r,e){T5(I5(r),"The `leftPad` function only works on numbers!");let t=r.toString();for(;t.length<e;)t="0"+t;return t}iE.exports=C5});var sE=ue((Gnt,oE)=>{var A5=ed(),_5=Zn();function D5(r,e){let t=e?r:r.copy();return t.index=_5(0,r.shape[0]).map(n=>"row"+A5(n,(t.index.length-1).toString().length)),t}oE.exports=D5});var cf=ue((Unt,lE)=>{var F5=ze(),R5=Fr(),O5=He(),P5=yt(),M5=vt();function uE(r){if(P5(r)||M5(r))return uE(r.values);F5(O5(r),"The `product` function only works on arrays, Series, and DataFrames!");try{return r.length===0?NaN:R5(r).reduce((e,t)=>e*t,1)}catch{return NaN}}lE.exports=uE});var td=ue((Hnt,pE)=>{var ff=ze(),cE=Fr(),fE=He(),B5=yt(),hE=ut(),L5=vt(),z5=cf(),$5=wr();function uy(r,e){if(B5(r)||L5(r))return uy(r.values,e);if(ff(fE(r),"The first argument passed into the `reshape` function must be an array!"),hE(e)&&(e=[e]),ff(fE(e),"The second argument passed into the `reshape` function must be a whole number or a one-dimensional array of whole numbers!"),ff($5(e).length===1,"The first argument passed into the `reshape` function must be a whole number or a one-dimensional array of whole numbers!"),e.forEach(i=>{ff(hE(i)&&parseInt(i)===i&&i>0,"The first argument passed into the `reshape` function must be a whole number or a one-dimensional array of whole numbers!")}),e.length===0)return cE(r);let t=cE(r);if(e.length===1&&e[0]===t.length)return t;ff(z5(e)===t.length,"The new shape doesn't match the number of values available in `x` (the first argument passed into the `reshape` function)!");let n=[],a=parseInt(t.length/e[0]);for(let i=0;i<e[0];i++){let o=t.slice(i*a,(i+1)*a);n.push(uy(o,e.slice(1)))}return n}pE.exports=uy});var fl=ue((Knt,wE)=>{var W5=ze(),mE=Wi(),q5=He(),V5=ut(),gE=Tt(),G5=Lo(),U5=cf(),H5=td(),yE=Math.pow(2,64),xr=[];bE(parseInt(Math.random()*yE));function K5(r,e){r=Sn(r);function t(){r+=Sn("0x9e3779b97f4a7c15");let a=mE(r);return a=(a^a>>30n)*Sn("0xbf58476d1ce4e5b9"),a=(a^a>>27n)*Sn("0x94d049bb133111eb"),a^a>>31n}let n=[];for(let a=0;a<e;a++)n.push(t());return n}function Sn(r){return BigInt.asUintN(64,BigInt(r))}function dE(r,e){return r=Sn(r),e=BigInt(e),Sn(Sn(r<<e)|Sn(r>>Sn(64n-e)))}function bE(r){if(gE(r))return mE(xr);{W5(V5(r),"If passing a value into the `seed` function, then that value must be an integer!");let e=K5(parseInt(r),4);xr[0]=e[0],xr[1]=e[1],xr[2]=e[2],xr[3]=e[3]}}function vE(){let r=Sn(dE(xr[0]+xr[3],23)+xr[0]),e=Sn(xr[1]<<17n);return xr[2]=Sn(xr[2]^xr[0]),xr[3]=Sn(xr[3]^xr[1]),xr[1]=Sn(xr[1]^xr[2]),xr[0]=Sn(xr[0]^xr[3]),xr[2]=Sn(xr[2]^e),xr[3]=dE(xr[3],45),parseInt(r)/yE}function j5(r){return gE(r)?vE():(q5(r)||(r=[r]),H5(G5(U5(r)).map(vE),r))}wE.exports={random:j5,seed:bE}});var rd=ue((jnt,xE)=>{var{random:X5}=fl(),Y5=ze(),Z5=He(),J5=yt(),Q5=vt();function ej(r){if(J5(r)||Q5(r))return r.shuffle(...Object.values(arguments).slice(1));Y5(Z5(r),"The `shuffle` function only works on arrays, Series, and DataFrames!");let e=[],t=r.slice();for(let n=0;n<r.length;n++){let a=parseInt(X5()*t.length);e.push(t.splice(a,1)[0])}return e}xE.exports=ej});var NE=ue((Xnt,SE)=>{var tj=ze(),rj=Tt(),kE=rd();function nj(r,e){return rj(e)&&(e=0),tj(e===0||e===1,"The `axis` parameter to the `shuffle` must be 0, 1, or undefined."),r.get(e===0?kE(r.index):null,e===1?kE(r.columns):null)}SE.exports=nj});var AE=ue((Ynt,CE)=>{var{random:aj}=fl(),Jn=ze(),ij=Fr(),EE=He(),ly=uf(),IE=Fn(),nd=ut(),hl=kn(),cy=Tt(),oj=Zn(),TE=wr(),fy=Wo();function sj(r,e,t){return IE(e)?uj(r,e,t):lj(r,e,t)}function uj(r,e,t){if(t=cy(t)?0:t,Jn(IE(e),"When sorting a DataFrame using a function, the first argument to the `sort` method must be a function!"),Jn(nd(t),"When sorting a DataFrame using a function, the second argument to the `sort` method must be null, undefined, 0, or 1 to indicate the axis along which the data should be sorted! An axis of 0 means that the rows will be sorted relative to each other, whereas an axis of 1 means that the columns will be sorted relative to each other."),t===0){let n=fy(r.index,(a,i)=>e(r.get(a,null),r.get(i,null)));return r.get(n,null)}else{let n=fy(r.columns,(a,i)=>e(r.get(null,a),r.get(null,i)));return r.get(null,n)}}function lj(r,e,t){let n=r.copy(),a=aj().toString();return n=n.assign(a,n.index),cy(e)&&(e=[a],t=[!0]),(nd(e)||hl(e))&&(e=[e],(ly(t)||hl(t))&&(t=[t])),Jn(EE(e),"The first parameter of the `sort` method must be (1) a string or index representing a column name or index, respectively; (2) a 1-dimensional array of strings and/or indices; or (3) null."),Jn(TE(e).length===1,"The first parameter of the `sort` method must be (1) a string or index representing a column name or index, respectively; (2) a 1-dimensional array of strings and/or indices; or (3) null."),cy(t)&&(t=oj(0,e.length).map(()=>!0)),Jn(EE(t),"The second parameter of the `sort` method must be (1) a string or boolean representing the sort direction ('ascending' / 'descending', or true / false); (2) a 1-dimensional array of strings and/or booleans; or (3) null."),Jn(TE(t).length===1,"The second parameter of the `sort` method must be (1) a string or boolean representing the sort direction ('ascending' / 'descending', or true / false); (2) a 1-dimensional array of strings and/or booleans; or (3) null."),Jn(e.length===t.length,"The arrays passed into the `sort` method must be equal in length."),e=e.map(i=>{if(Jn(hl(i)||nd(i),"Column references can either be column names (as strings) or column indices (as whole numbers)."),hl(i)){let o=n.columns.indexOf(i);return Jn(o>-1,`The column "${i}" does not exist!`),o}if(nd(i))return Jn(parseInt(i)===i,"Column indices must be whole numbers!"),Jn(i>=0,`The column index ${i} is out of bounds!`),Jn(i<n.columns.length,`The index ${i} is out of bounds!`),i}),t=t.map(i=>{if(Jn(hl(i)||ly(i),"Direction references can either be strings ('ascending' or 'descending') or booleans (true or false)."),hl(i)){let o=i.trim().toLowerCase();return Jn(o==="ascending"||o==="descending","Direction references can either be strings ('ascending' or 'descending') or booleans (true or false)."),o==="ascending"}if(ly(i))return i}),n.values=fy(n.values,(i,o)=>{let s=0;for(;i[e[s]]===o[e[s]]&&s<e.length;)s++;let u=t[s];if(i[e[s]]===o[e[s]])return 0;if(i[e[s]]<o[e[s]])return u?-1:1;if(i[e[s]]>o[e[s]])return u?1:-1}),n.index=ij(n.get(null,a).values),n=n.dropColumns(a),n}CE.exports=sj});var hy=ue((Znt,DE)=>{var cj=$i(),fj=uf(),hj=Bo(),pj=kn(),_E=Tt();function dj(r,e){e=(()=>{if(_E(e))return!0;if(fj(e))return e;throw new cj("The `shouldIncludeIndex` parameter of the `toCSVString` method must be a boolean!")})();let t=[""].concat(r.index);return[r.columns].concat(r.values).map((a,i)=>(e?[t[i]]:[]).concat(a).map(s=>pj(s)?JSON.stringify(s):hj(s)?JSON.stringify(JSON.stringify(s)):_E(s)?"":s.toString()).join(",")).join(`
`)}DE.exports=dj});var FE=ue((Jnt,dy)=>{var py=$i(),vj=hy();function mj(r,e,t){let n=vj(r,t),a=!1,i=!1,o,s;try{let u=e;if(e.includes("/")){let c=e.split("/");u=c[c.length-1]}let l=document.createElement("a");l.href=`data:text/csv;charset=utf-8,${encodeURIComponent(n)}`,l.download=u,l.dispatchEvent(new MouseEvent("click")),a=!0}catch(u){o=u}try{let u=ef("fs"),l=ef("path");u.writeFileSync(l.resolve(e),n,"utf8"),i=!0}catch(u){s=u}if(!a&&!i)throw typeof window<"u"?new py(o):typeof dy<"u"?new py(s):new py("I don't know what's going wrong, but it doesn't seem like you're in Node or the browser, and we couldn't download and/or write the file to disk!");return r}dy.exports=mj});var vy=ue((Qnt,RE)=>{function gj(r,e){return JSON.stringify(r.toObject(e))}RE.exports=gj});var OE=ue((eat,gy)=>{var my=$i(),yj=vy();function bj(r,e,t){let n=yj(r,t),a=!1,i=!1,o,s;try{let u=e;if(e.includes("/")){let c=e.split("/");u=c[c.length-1]}let l=document.createElement("a");l.href=`data:application/json;charset=utf-8,${encodeURIComponent(n)}`,l.download=u,l.dispatchEvent(new MouseEvent("click")),a=!0}catch(u){o=u}try{let u=ef("fs"),l=ef("path");u.writeFileSync(l.resolve(e),n,"utf8"),i=!0}catch(u){s=u}if(!a&&!i)throw typeof window<"u"?new my(o):typeof gy<"u"?new my(s):new my("I don't know what's going wrong, but it doesn't seem like you're in Node or the browser, and we couldn't download and/or write the file to disk!");return r}gy.exports=bj});var ME=ue((tat,PE)=>{var wj=ze(),xj=Tt();function kj(r,e){xj(e)?e=0:wj(e===0||e===1,"The axis parameter of the `toObject` method must be undefined, 0, or 1. An axis of 0 indicates that the returned object should be organized first by rows and then by columns. An axis of 1 indicates that the returned object should be organized first by columns and then by rows.");let t={};return e===0?r.index.forEach((n,a)=>{let i={};r.columns.forEach((o,s)=>{i[o]=r.values[a][s]}),t[n]=i}):r.columns.forEach((n,a)=>{let i={};r.index.forEach((o,s)=>{i[o]=r.values[s][a]}),t[n]=i}),t}PE.exports=kj});var Ms=ue((rat,zE)=>{var BE=ze(),Sj=He(),Nj=yt(),Ej=vt(),Tj=Lo(),LE=af(),Ij=wr();function Cj(r){if(Nj(r)||Ej(r))return r.transpose();BE(Sj(r),"The `transpose` function only works on arrays, Series, and DataFrames!");let e=Ij(r);if(BE(e.length<=2,"I'm not smart enough to know how to transpose arrays that have more than 2 dimensions. Sorry for the inconvenience! Please only pass 1- or 2-dimensional arrays into the `transpose` function!"),e.length===1)return LE(r);if(e.length===2){let t=Tj(LE(e));for(let n=0;n<e[0];n++)for(let a=0;a<e[1];a++)t[a][n]=r[n][a];return t}}zE.exports=Cj});var VE=ue((nat,qE)=>{var $E=ze(),Aj=He(),_j=yt(),Dj=Gp(),Fj=vt(),Rj=wr();function WE(r,e,t){if(Fj(t))return new r(e.values.concat(t.values));if(Aj(t)){let n=Rj(t);$E(n.length===1&&!Dj(n),"Only vectors can be appended to Series!");let a=e.copy();return t.forEach((i,o)=>{a._values.push(i),a._index.push("item"+(e.values.length+o))}),a}return $E(!_j(t),"DataFrames cannot be appended to Series!"),WE(e,[t])}qE.exports=WE});var UE=ue((aat,GE)=>{var Oj=ze(),Pj=Fn();function Mj(r,e){Oj(Pj(e),"The parameter to the `apply` method must be a function.");let t=r.copy();return t._values=t._values.map((n,a)=>e(n,a)),t}GE.exports=Mj});var KE=ue((iat,HE)=>{var Bj=Tt();function Lj(r){let e=r.copy(),t=[];return e._values=e.values.filter((n,a)=>Bj(n)?!1:(t.push(e.index[a]),!0)),e._index=t,e}HE.exports=Lj});var XE=ue((oat,jE)=>{var zj=ut();function $j(r,e){let t=[],n=[];e.values.forEach((i,o)=>{zj(i)&&(n.push(i),t.push(e.index[o]))});let a=new r(n);return a.name=e.name,a.index=t,a}jE.exports=$j});var ZE=ue((sat,YE)=>{var Wj=Wi();function qj(r,e,t){let n=e.copy(),a=Wj(n.index),i=[],o=n.values.filter((s,u)=>{let l=t(s,u,n.values);return l||i.push(n.index[u]),l});return i.forEach(s=>{a.splice(a.indexOf(s),1)}),o.length===0?(n=new r,n.name=e.name,n):(n.values=o,n.index=a,n)}YE.exports=qj});var QE=ue((uat,JE)=>{var Go=ze(),Vj=ut(),Gj=kn(),Uj=Tt(),Hj=di();function Kj(r,e){(Gj(e)||Vj(e))&&(e=[e]);let t=Hj((e||[]).map(n=>typeof n));return Go(t.length<=2,"Only whole numbers and/or strings are allowed in `get` arrays!"),t.length===1&&Go(t[0]==="string"||t[0]==="number","Only whole numbers and/or strings are allowed in `get` arrays!"),t.length===2&&(Go(t.indexOf("string")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!"),Go(t.indexOf("number")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!")),Uj(e)||(e=e.map(n=>{if(typeof n=="string")return Go(r.index.indexOf(n)>-1,`Index "${n}" does not exist!`),n;if(typeof n=="number")return Go(n>=0,`Index ${n} is out of bounds!`),Go(parseInt(n)===n,"Indices must be integers!"),Go(n<r.index.length,`Index ${n} is out of bounds!`),r.index[n]})),r.getSubsetByNames(e)}JE.exports=Kj});var tT=ue((lat,eT)=>{var hf=ze(),jj=He(),Xj=Tt(),Yj=of(),Zj=Zn(),Jj=wr();function Qj(r,e){let t=r.shape;Xj(e)&&(e=Zj(0,t[0])),hf(jj(e),"The `indices` array must be 1-dimensional array of whole numbers."),hf(Jj(e).length===1,"The `indices` array must be a 1-dimensional array of whole numbers."),hf(e.length>0,"The `indices` array must contain at least one index."),e.forEach(a=>{hf(Yj(a),"The `indices` array must be a 1-dimensional array of whole numbers."),hf(a<r.index.length,`The row index ${a} is out of bounds.`)});let n=e.map(a=>r.index[a]);return r.getSubsetByNames(n)}eT.exports=Qj});var nT=ue((cat,rT)=>{var pf=ze(),e8=He(),t8=kn(),r8=Tt(),n8=wr();function a8(r,e,t){r8(t)&&(t=e.index),pf(e8(t),"The `indices` array must be a 1-dimensional array of strings."),pf(n8(t).length===1,"The `indices` array must be a 1-dimensional array of strings."),pf(t.length>0,"The `indices` array must contain at least one index name."),t.forEach(i=>{pf(t8(i),"The `indices` array must contain only strings."),pf(e.index.indexOf(i)>-1,`The name "${i}" does not exist in the index.`)});let n=t.map(i=>e.values[e.index.indexOf(i)]);if(n.length===1)return n[0];let a=new r(n);return a.index=t,a.name=e.name,a}rT.exports=a8});var oT=ue((fat,iT)=>{var i8=Wi(),aT=Zn();function o8(r){let e=r.copy(),t=typeof window>"u"?20:10;if(e.index.length>t){e=e.get(aT(0,t/2).concat(aT(e.index.length-t/2,e.index.length)));let a=i8(e.index);a.splice(parseInt(a.length/2),0,"..."),e.values.push("..."),e.index.push("..."),e=e.get(a)}let n={};return e.values.forEach((a,i)=>{let o={};o[e.name]=a,n[e.index[i]]=o}),console.table(n),console.log("Shape:",r.shape,`
`),r}iT.exports=o8});var uT=ue((hat,sT)=>{var s8=rd();function u8(r){let e=r.copy();return e.get(s8(e.index))}sT.exports=u8});var cT=ue((pat,lT)=>{var l8=ze(),c8=Fn(),f8=Tt(),h8=Wo(),p8=Ms();function d8(r,e,t){t=t||((u,l)=>u<l?-1:1),l8(f8(t)||c8(t),"You must pass undefined, null, or a comparison function as the second argument to the `sort` method!");let n=p8([e.values,e.index]),a=h8(n,(u,l)=>t(u[0],l[0])),i=[],o=[];a.forEach(u=>{i.push(u[0]),o.push(u[1])});let s=new r;return s._values=i,s._index=o,s.name=e.name,s}lT.exports=d8});var pT=ue((dat,hT)=>{var v8=Wo(),fT=Ms();function m8(r,e){let t=fT([e.values,e.index]);t=fT(v8(t,(a,i)=>{if(a[1]===i[1])return 0;if(a[1]<i[1])return-1;if(a[1]>i[1])return 1}));let n=new r(t[0]);return n.index=t[1],n.name=e.name,n}hT.exports=m8});var vT=ue((vat,dT)=>{function g8(r){let e={};return e[r.name]={},r.index.forEach((t,n)=>{e[r.name][t]=r.values[n]}),e}dT.exports=g8});var wT=ue((mat,bT)=>{var lo=ze(),ad=Wi(),yy=He(),y8=kn(),b8=Tt(),mT=ed(),gT=Zn(),id=af(),w8=VE(),x8=UE(),k8=KE(),S8=XE(),N8=ZE(),E8=QE(),T8=tT(),I8=nT(),C8=oT(),A8=uT(),_8=cT(),D8=pT(),F8=vT(),df=wr(),R8=Ms(),yT=Symbol.for("@jrc03c/js-math-tools/series");bT.exports=function(r){class e{static[Symbol.hasInstance](n){try{return!!n._symbol&&n._symbol===yT}catch{return!1}}constructor(n){let a=this;if(a.name="data",Object.defineProperty(a,"_symbol",{configurable:!1,enumerable:!1,writable:!1,value:yT}),Object.defineProperty(a,"_values",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(a,"values",{configurable:!0,enumerable:!0,get(){return a._values},set(i){lo(yy(i),"The new values must be a 1-dimensional array!");let o=df(i);lo(o.length===1,"The new array of values must be 1-dimensional!"),o[0]<a._index.length?a._index=a._index.slice(0,o[0]):o[0]>a._index.length&&(a._index=a._index.concat(gT(a._index.length,o[0]).map(s=>"item"+mT(s,(i.length-1).toString().length)))),a._values=i}}),Object.defineProperty(a,"_index",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(a,"index",{configurable:!0,enumerable:!0,get(){return a._index},set(i){lo(yy(i),"The new index must be a 1-dimensional array of strings!"),lo(i.length===a.shape[0],"The new index must be the same length as the old index!"),lo(df(i).length===1,"The new index must be a 1-dimensional array of strings!"),i.forEach(o=>{lo(y8(o),"All of the row names must be strings!")}),a._index=i}}),n){if(n instanceof e)a.name=n.name,a.values=ad(n.values),a.index=ad(n.index);else if(yy(n)){let i=df(n);lo(i.length===1,"When passing an array into the constructor of a Series, the array must be 1-dimensional!"),a.values=n}else if(n instanceof Object){let i=Object.keys(n);lo(i.length===1,"When passing an object into the constructor of a Series, the object must have only 1 key-value pair, where the key is the name of the data and the value is the 1-dimensional array of values!");let o=i[0],s=n[o];lo(df(s).length===1,"When passing an object into the constructor of a Series, the object must have only 1 key-value pair, where the key is the name of the data and the value is the 1-dimensional array of values!"),a.name=o,a.values=s.slice()}}}get shape(){return df(this.values)}get length(){return this.shape[0]}get isEmpty(){return this.values.filter(a=>!b8(a)).length===0}clear(){let a=this.copy();return a.values.forEach((i,o)=>{a.values[o]=void 0}),a}get(n){return E8(this,n)}getSubsetByNames(n){return I8(e,this,n)}getSubsetByIndices(n){return T8(this,n)}loc(n){return this.getSubsetByNames(n)}iloc(n){return this.getSubsetByIndices(n)}reverse(){let n=this,a=new e(id(n.values));return a.index=id(n.index),a.name=n.name,a}resetIndex(){let n=this,a=n.copy();return a.index=gT(0,n.shape[0]).map(i=>"item"+mT(i,(a.index.length-1).toString().length)),a}copy(){let n=this,a=new e;return a._values=ad(n.values),a._index=ad(n.index),a.name=n.name,a}append(n){return w8(e,this,n)}apply(n){return x8(this,n)}concat(n){return this.append(n)}dropMissing(n,a){return k8(this,n,a)}dropNaN(){return S8(e,this)}toObject(){return F8(this)}print(){return C8(this)}shuffle(){return A8(this)}sort(n){return _8(e,this,n)}sortByIndex(){return D8(e,this)}filter(n){return N8(e,this,n)}toDataFrame(){let n=this,a=new r(R8([n.values]));return a.columns=[n.name],a.index=n.index,a}transpose(){let a=this.copy();return a.values=id(a.values),a.index=id(a.index),a}getDummies(){return this.toDataFrame().getDummies()}oneHotEncode(){return this.getDummies()}}return e}});var mf=ue((gat,TT)=>{var Vi=ze(),by=Wi(),xT=Vp(),O8=ZS(),P8=rN(),M8=oN(),B8=uN(),L8=vN(),z8=yN(),$8=kN(),W8=TN(),q8=ON(),V8=oy(),G8=BN(),kT=VN(),U8=ZN(),H8=rE(),K8=aE(),j8=sE(),X8=NE(),Y8=AE(),Z8=FE(),J8=hy(),Q8=OE(),e7=vy(),t7=ME(),r7=Fr(),vf=He(),n7=Bo(),ST=Tt(),wy=ed(),a7=Lo(),xy=Zn(),pl=wr(),NT=Ms(),ET=Symbol.for("@jrc03c/js-math-tools/dataframe");function od(r){let e="abcdefghijklmnopqrstuvwxyz1234567890",t="";for(let n=0;n<r;n++)t+=e[parseInt(Math.random()*e.length)];return t}var Rr=class{static[Symbol.hasInstance](e){try{return!!e._symbol&&e._symbol===ET}catch{return!1}}constructor(e){let t=this;if(Object.defineProperty(t,"_symbol",{configurable:!1,enumerable:!1,writable:!1,value:ET}),Object.defineProperty(t,"_values",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(t,"values",{configurable:!0,enumerable:!0,get(){return t._values.length===0||!ST(t._values[0])&&t._values[0].length===0?[[]]:t._values},set(n){Vi(vf(n),"The new values must be a 2-dimensional array!");let a=pl(n);Vi(a.length===2,"The new array of values must be 2-dimensional!"),a[0]<t._index.length?t._index=t._index.slice(0,a[0]):a[0]>t._index.length&&(t._index=t._index.concat(xy(t._index.length,a[0]).map(i=>"row"+wy(i,(a[0]-1).toString().length)))),a[1]<t._columns.length?t._columns=t._columns.slice(0,a[1]):a[1]>t._columns.length&&(t._columns=t._columns.concat(xy(t._columns.length,a[1]).map(i=>"col"+wy(i,(a[1]-1).toString().length)))),t._values=n}}),Object.defineProperty(t,"_columns",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(t,"columns",{configurable:!0,enumerable:!0,get(){return t._columns},set(n){Vi(vf(n),"The new columns list must be a 1-dimensional array of strings!"),Vi(t.isEmpty||n.length===t.shape[1],"The new columns list must be the same length as the old columns list!"),Vi(pl(n).length===1,"The new columns list must be a 1-dimensional array of strings!"),n=n.map(i=>(typeof i!="string"&&(i=JSON.stringify(i)||i.toString()),i.trim().length===0?"untitled_"+od(8):i.trim()));let a=(()=>{let i=xT(n),o={};return i.forEach(s=>{o[s.item]=s.count}),o})();n=n.map(i=>a[i]>1?i+"_"+od(8):i),t._columns=n}}),Object.defineProperty(t,"_index",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(t,"index",{configurable:!0,enumerable:!0,get(){return t._index},set(n){Vi(vf(n),"The new index must be a 1-dimensional array of strings!"),Vi(t.isEmpty||n.length===t.shape[0],"The new index must be the same length as the old index!"),Vi(pl(n).length===1,"The new index must be a 1-dimensional array of strings!"),n=n.map(i=>(typeof i!="string"&&(i=JSON.stringify(i)||i.toString()),i.trim().length===0?"untitled_"+od(8):i.trim()));let a=(()=>{let i=xT(n),o={};return i.forEach(s=>{o[s.item]=s.count}),o})();n=n.map(i=>a[i]>1?i+"_"+od(8):i),t._index=n}}),Vi(ST(e)||n7(e)||vf(e),"The `data` passed into the constructor of a DataFrame must be either (1) an object where the key-value pairs are (respectively) column names and 1-dimensional arrays of values, or (2) a 2-dimensional array of values."),e)if(e instanceof Rr)t.values=by(e.values),t.columns=by(e.columns),t.index=by(e.index);else if(vf(e)){let n=pl(e);Vi(n.length===2,"The `data` array passed into the constructor of a DataFrame must be 2-dimensional!"),t.values=e}else{t._columns=Object.keys(e);let n=[];t._columns.forEach(i=>{let o=e[i];n.push(o)}),t._values=NT(n);let a=pl(t.values);t._index=xy(0,a[0]).map(i=>"row"+wy(i,(a[0]-1).toString().length))}}get shape(){return pl(this.values)}get length(){return this.shape[0]}get width(){return this.shape[1]}get rows(){return this.index}set rows(e){let t=this;t.index=e}get isEmpty(){return r7(this.values).length===0}clear(){let e=this,t=new Rr(a7(e.shape));return t.columns=e.columns.slice(),t.index=e.index.slice(),t}get(e,t){let n=this;if(arguments.length===0)return n;if(arguments.length===1)try{return n.get(null,e)}catch{return n.get(e,null)}return G8(n,e,t)}getSubsetByNames(e,t){return H8(Rr,Uo,this,e,t)}getSubsetByIndices(e,t){return U8(this,e,t)}getDummies(e){return kT(Rr,this,e)}oneHotEncode(e){return kT(Rr,this,e)}transpose(){let e=this,t=new Rr(NT(e.values));return t.columns=e.index.slice(),t.index=e.columns.slice(),t}get T(){return this.transpose()}resetIndex(e){return j8(this,e)}copy(){return B8(Rr,this)}assign(e,t){return M8(Rr,Uo,this,e,t)}apply(e,t){return P8(Rr,Uo,this,e,t)}dropMissing(e,t,n){return z8(Rr,Uo,this,e,t,n)}dropNaN(e,t,n){return $8(Rr,this,e,t,n)}drop(e,t){return L8(Rr,Uo,this,e,t)}dropColumns(e){return this.drop(null,e)}dropRows(e){return this.drop(e,null)}toObject(e){return t7(this,e)}toCSVString(e){return J8(this,e)}saveAsCSV(e,t){return Z8(this,e,t)}toJSONString(e){return e7(this,e)}saveAsJSON(e,t){return Q8(this,e,t)}print(){return K8(Rr,Uo,this)}sort(e,t){return Y8(this,e,t)}sortByIndex(){return this.sort()}filter(e,t){return W8(Rr,Uo,this,e,t)}shuffle(e){return X8(this,e)}append(e,t){return O8(this,e,t)}concat(e,t){return this.append(e,t)}join(e,t){return this.append(e,t)}toString(){let e=this;return JSON.stringify(e)}};Rr.fromCSV=function(){return q8(Rr,...arguments)};Rr.fromCSVString=function(){return V8(Rr,...arguments)};var Uo=wT()(Rr);TT.exports={DataFrame:Rr,Series:Uo}});var jt=ue((yat,DT)=>{var{DataFrame:IT,Series:CT}=mf(),AT=ze(),gf=He(),ky=yt(),_T=qi(),i7=Fn(),Sy=vt(),o7=Ps(),s7=Zn(),sd=wr();function u7(r){return gf(r)||Sy(r)||ky(r)}function l7(r){return AT(i7(r),"You must pass a function into the `vectorize` function!"),function e(){let t,n,a=[],i=[],o=Object.keys(arguments).filter(s=>{let u=arguments[s];return gf(u)?!0:Sy(u)?(t=!0,a.push(u),!0):ky(u)?(n=!0,i.push(u),!0):!1}).map(s=>arguments[s]);if(o.slice(0,-1).forEach((s,u)=>{AT(_T(gf(s)?sd(s):s.shape,gf(o[u+1])?sd(o[u+1]):o[u+1].shape),`When passing multiple arrays into the \`${r.name}\` function, all of the arrays must have the same shape!`)}),o.length>0){let s=o7(o.map(l=>l.length?l.length:l.values.length)),u=s7(0,s).map(l=>{let c=Object.keys(arguments).map(f=>{if(u7(arguments[f])){if(gf(arguments[f]))return arguments[f][l];if(Sy(arguments[f]))return arguments[f].values[l];if(ky(arguments[f]))return arguments[f].values[l]}else return arguments[f]});return e(...c)});if(n)try{if(i.length===1&&_T(sd(i[0]),sd(u))){let l=new IT(u);return l.index=i[0].index.slice(),l.columns=i[0].columns.slice(),l}else return new IT(u)}catch{return u}if(t)try{if(a.length===1&&a[0].length===u.length){let l=new CT(u);return l.name=a[0].name,l.index=a[0].index.slice(),l}else return new CT(u)}catch{return u}return u}else return r(...arguments)}}DT.exports=l7});var ud=ue((bat,FT)=>{var c7=ut(),f7=jt();function h7(r){try{return c7(r)?Math.abs(r):NaN}catch{return NaN}}FT.exports=f7(h7)});var ld=ue((wat,RT)=>{var p7=ut(),d7=jt();function v7(){try{let r=0,e=Object.values(arguments);for(let t=0;t<e.length;t++){if(!p7(e[t]))return NaN;r+=e[t]}return r}catch{return NaN}}RT.exports=d7(v7)});var cd=ue((xat,OT)=>{var m7=jt();function g7(r,e){try{return e(r)}catch{return NaN}}OT.exports=m7(g7)});var MT=ue((kat,PT)=>{var y7=ut(),b7=jt();function w7(r){try{return y7(r)?Math.acos(r):NaN}catch{return NaN}}PT.exports=b7(w7)});var LT=ue((Sat,BT)=>{var x7=ut(),k7=jt();function S7(r){try{return x7(r)?Math.asin(r):NaN}catch{return NaN}}BT.exports=k7(S7)});var $T=ue((Nat,zT)=>{var N7=ut(),E7=jt();function T7(r){try{return N7(r)?Math.atan(r):NaN}catch{return NaN}}zT.exports=E7(T7)});var qT=ue((Eat,WT)=>{var I7=ze(),C7=tf(),A7=He(),_7=yt(),D7=vt(),F7=Ps();function Ny(r){if(_7(r)){let e=Ny(r.values);return[r.index[e[0]],r.columns[e[1]]]}if(D7(r)){let e=Ny(r.values);return[r.index[e]]}I7(A7(r),"The `argmax` function only works on arrays, Series, and DataFrames!");try{let e=C7(r,F7(r));return e?e.length===0?void 0:e.length===1?e[0]:e:void 0}catch{return}}WT.exports=Ny});var fd=ue((Tat,GT)=>{var R7=ze(),O7=Fr(),P7=He(),M7=yt(),B7=vt();function VT(r){if(M7(r)||B7(r))return VT(r.values);R7(P7(r),"The `min` function only works on arrays, Series, and DataFrames!");try{return Math.min(...O7(r))}catch{return NaN}}GT.exports=VT});var HT=ue((Iat,UT)=>{var L7=ze(),z7=tf(),$7=He(),W7=yt(),q7=vt(),V7=fd();function Ey(r){if(W7(r)){let e=Ey(r.values);return[r.index[e[0]],r.columns[e[1]]]}if(q7(r)){let e=Ey(r.values);return[r.index[e]]}L7($7(r),"The `argmin` function only works on arrays, Series, and DataFrames!");try{let e=z7(r,V7(r));return e?e.length===0?void 0:e.length===1?e[0]:e:void 0}catch{return}}UT.exports=Ey});var jT=ue((Cat,KT)=>{var G7=ut(),U7=jt();function H7(r){try{return G7(r)?Math.ceil(r):NaN}catch{return NaN}}KT.exports=U7(H7)});var ZT=ue((Aat,YT)=>{var K7=ud(),XT=ut(),j7=Tt(),X7=jt();function Y7(r,e){try{if(!XT(r))return NaN;if(j7(e))e=1e-10;else if(!XT(e))return NaN;return K7(r)<e?0:r}catch{return NaN}}YT.exports=X7(Y7)});var QT=ue((_at,JT)=>{var Ty=ut(),Z7=jt();function J7(r,e,t){try{return Ty(r)?Ty(e)?Ty(t)?r<e?e:r>t?t:r:NaN:NaN:NaN}catch{return NaN}}JT.exports=Z7(J7)});var tI=ue((Dat,eI)=>{var Iy=ze(),Q7=Fr(),eX=He(),tX=yt(),rX=ut(),nX=vt();function Cy(r,e){if(tX(r)||nX(r))return Cy(r.values,e);if(Iy(eX(r),"The `combinations` function only works on arrays, Series, and DataFrames!"),Iy(rX(e),"`r` must be a whole number!"),r=Q7(r),e>r.length)return[r];if(e<=0)return[[]];if(Iy(e===parseInt(e),"`r` must be a whole number!"),r.length<2)return r;let t=[];return r.forEach((n,a)=>{let i=r.slice(a+1);if(i.length<e-1)return;Cy(i,e-1).forEach(s=>{t.push([n].concat(s))})}),t}eI.exports=Cy});var hd=ue((Fat,nI)=>{var aX=ze(),iX=Fr(),oX=He(),sX=yt(),uX=vt();function rI(r){if(sX(r)||uX(r))return rI(r.values);aX(oX(r),"The `mean` function only works on arrays, Series, and DataFrames!");try{let e=iX(r),t=0;return e.forEach(n=>{t+=n}),t/e.length}catch{return NaN}}nI.exports=rI});var _y=ue((Rat,lI)=>{var aI=ze(),iI=He(),pd=ut(),oI=vt(),sI=hd(),uI=wr();function Ay(r,e){if(oI(r))return Ay(r.values,e);if(oI(e))return Ay(r,e.values);aI(iI(r)&&iI(e)&&uI(r).length===1&&uI(e).length===1,"The `covariance` function only works on 1-dimensional arrays and Series!"),aI(r.length===e.length,"The two arrays or Series passed into the `covariance` function must have the same length!");try{let t=sI(r),n=sI(e);if(!pd(t)||!pd(n))return NaN;let a=Math.max(r.length,e.length),i=0;for(let o=0;o<a;o++){if(!pd(r[o]))return NaN;if(!pd(e[o]))return NaN;i+=(r[o]-t)*(e[o]-n)}return i/r.length}catch{return NaN}}lI.exports=Ay});var dd=ue((Oat,cI)=>{var lX=ut(),cX=jt();function fX(r){try{return lX(r)?Math.sqrt(r):NaN}catch{return NaN}}cI.exports=cX(fX)});var Dy=ue((Pat,hI)=>{var hX=ze(),pX=Fr(),dX=He(),vX=yt(),mX=ut(),gX=vt(),yX=hd();function fI(r){if(vX(r)||gX(r))return fI(r.values);hX(dX(r),"The `variance` function only works on arrays, Series, and DataFrames!");try{let e=pX(r),t=yX(e),n=0;for(let a=0;a<e.length;a++){if(!mX(e[a]))return NaN;n+=(e[a]-t)*(e[a]-t)}return n/e.length}catch{return NaN}}hI.exports=fI});var vd=ue((Mat,dI)=>{var bX=ze(),wX=He(),xX=yt(),kX=vt(),SX=dd(),NX=Dy();function pI(r){if(xX(r)||kX(r))return pI(r.values);bX(wX(r),"The `std` function only works on arrays, Series, and DataFrames!");try{return SX(NX(r))}catch{return NaN}}dI.exports=pI});var xI=ue((Bat,wI)=>{var vI=ze(),EX=_y(),mI=He(),gI=vt(),yI=wr(),bI=vd();function Fy(r,e){if(gI(r))return Fy(r.values,e);if(gI(e))return Fy(r,e.values);vI(mI(r)&&mI(e)&&yI(r).length===1&&yI(e).length===1,"The `correl` function only works on 1-dimensional arrays and Series!"),vI(r.length===e.length,"The two arrays or Series passed into the `correl` function must have the same length!");try{return EX(r,e)/(bI(r)*bI(e))}catch{return NaN}}wI.exports=Fy});var SI=ue((Lat,kI)=>{var TX=ut(),IX=jt();function CX(r){try{return TX(r)?Math.cos(r):NaN}catch{return NaN}}kI.exports=IX(CX)});var AI=ue((zat,CI)=>{var AX=ze(),NI=He(),EI=yt(),_X=qi(),TI=vt(),II=di();function Ry(r,e){if(EI(r)||TI(r))return Ry(r.values,e);if(EI(e)||TI(e))return Ry(r,e.values);AX(NI(r)&&NI(e),"The `diff` function only works on arrays, Series, and DataFrames!");let t=II(r),n=II(e),a=[];return t.forEach(i=>{n.findIndex(o=>_X(o,i))<0&&a.push(i)}),a}CI.exports=Ry});var md=ue(($at,DI)=>{var _I=ut(),DX=jt();function FX(r,e){try{return _I(r)?_I(e)?Math.pow(r,e):NaN:NaN}catch{return NaN}}DI.exports=DX(FX)});var Oy=ue((Wat,FI)=>{var RX=ut(),OX=jt();function PX(){try{let r=Object.values(arguments);if(r.length===0)return NaN;let e=1;for(let t=0;t<r.length;t++){if(!RX(r[t]))return NaN;e*=r[t]}return e}catch{return NaN}}FI.exports=OX(PX)});var dl=ue((qat,RI)=>{var MX=Oy();function BX(){return MX(...arguments)}RI.exports=BX});var Py=ue((Vat,OI)=>{var LX=ld(),zX=dl();function $X(r,e){return LX(r,zX(e,-1))}OI.exports=$X});var gd=ue((Gat,MI)=>{var WX=ze(),qX=Fr(),VX=He(),GX=yt(),UX=vt();function PI(r){if(GX(r)||UX(r))return PI(r.values);WX(VX(r),"The `sum` function only works on arrays, Series, and DataFrames!");try{return r.length===0?NaN:qX(r).reduce((e,t)=>e+t,0)}catch{return NaN}}MI.exports=PI});var VI=ue((Uat,qI)=>{var HX=ud(),KX=ze(),BI=He(),LI=yt(),jX=qi(),zI=ut(),$I=vt(),XX=md(),WI=wr(),YX=dd(),ZX=Py(),JX=gd();function My(r,e){if(zI(r)&&zI(e))return HX(r-e);if(LI(r)||$I(r))return My(r.values,e);if(LI(e)||$I(e))return My(r,e.values);BI(r)&&BI(e)&&KX(jX(WI(r),WI(e)),"If passing two arrays, Series, or DataFrames into the `distance` function, then those objects must have the same shape!");try{return YX(JX(XX(ZX(r,e),2)))}catch{return NaN}}qI.exports=My});var UI=ue((Hat,GI)=>{var QX=md(),e9=dl();function t9(r,e){return e9(r,QX(e,-1))}GI.exports=t9});var Ly=ue((Kat,ZI)=>{var{DataFrame:HI,Series:KI}=mf(),yd=ze(),jI=Fr(),XI=He(),By=yt(),r9=ut(),bd=vt(),n9=dl(),wd=wr(),a9=gd(),YI=Ms();function Ho(r,e){if(By(r)){let a=Ho(r.values,e);if(wd(a).length===1){let i=new KI(a);return i.name=bd(e)?e.name:i.name,i.index=r.index.slice(),i}else{let i=new HI(a);return i.index=r.index.slice(),By(e)&&(i.columns=e.columns.slice()),i}}if(By(e)){let a=Ho(r,e.values);if(wd(a).length===1){let i=new KI(a);return i.name=bd(r)?r.name:i.name,i.index=e.columns.slice(),i}else{let i=new HI(a);return i.columns=e.columns.slice(),i}}if(bd(r))return Ho(r.values,e);if(bd(e))return Ho(r,e.values);yd(XI(r)&&XI(e),"The `dot` function only works on arrays, Series, and DataFrames!"),jI(r).concat(jI(e)).forEach(a=>{yd(r9(a),"One of the arrays you passed into the `dot` function contains non-numerical values!")});let t=wd(r),n=wd(e);if(yd(t.length<=2&&n.length<=2,"I'm not smart enough to know how to get the dot-product of arrays that have more than 2 dimensions. Sorry for the inconvenience! Please only pass 1- or 2-dimensional arrays into the `dot` function!"),yd(t[t.length-1]===n[0],`There's a dimension misalignment in the two arrays you passed into the \`dot\` function. (${t[t.length-1]} !== ${n[0]})`),t.length===1&&n.length===1)return a9(n9(r,e));if(t.length===1&&n.length===2)return YI(e).map(a=>Ho(r,a));if(t.length===2&&n.length===1)return r.map(a=>Ho(a,e));if(t.length===2&&n.length===2){let a=YI(e),i=[];for(let o=0;o<r.length;o++){let s=[];for(let u=0;u<a.length;u++)s.push(Ho(r[o],a[u]));i.push(s)}return i}}ZI.exports=Ho});var zy=ue((jat,QI)=>{var i9=ze(),o9=He(),s9=yt(),u9=vt(),l9=Tt();function JI(r){if(s9(r)||u9(r))return r.dropMissing(...Object.values(arguments).slice(1));i9(o9(r),"The `dropMissing` function only works on arrays, Series, and DataFrames!");let e=[];return r.forEach(t=>{try{return e.push(JI(t))}catch{l9(t)||e.push(t)}}),e}QI.exports=JI});var sC=ue((Xat,oC)=>{var eC=ze(),tC=He(),rC=yt(),c9=qi(),nC=vt(),aC=Tt(),iC=wr();function xd(r,e){if(rC(r)||nC(r))return xd(r.values,e);if(rC(e)||nC(e))return xd(r,e.values);eC(tC(r)&&tC(e),"The `dropMissingPairwise` function only works on arrays, Series, and DataFrames!"),eC(c9(iC(r),iC(e)),"The two arrays, Series, and/or DataFrames passed into the `dropMissingPairwise` function must have the same shape!");let t=[],n=[];for(let a=0;a<r.length;a++)try{let[i,o]=xd(r[a],e[a]);t.push(i),n.push(o)}catch{!aC(r[a])&&!aC(e[a])&&(t.push(r[a]),n.push(e[a]))}return[t,n]}oC.exports=xd});var vC=ue((Yat,dC)=>{var uC=ze(),lC=He(),cC=yt(),f9=qi(),fC=ut(),hC=vt(),pC=wr();function kd(r,e){if(cC(r)||hC(r))return kd(r.values,e);if(cC(e)||hC(e))return kd(r,e.values);uC(lC(r)&&lC(e),"The `dropNaNPairwise` only works on arrays, Series, and DataFrames!"),uC(f9(pC(r),pC(e)),"The two arrays, Series, and/or DataFrames passed into the `dropNaNPairwise` must have the same shape!");let t=[],n=[];for(let a=0;a<r.length;a++)try{let[i,o]=kd(r[a],e[a]);t.push(i),n.push(o)}catch{fC(r[a])&&fC(e[a])&&(t.push(r[a]),n.push(e[a]))}return[t,n]}dC.exports=kd});var gC=ue((Zat,mC)=>{var h9=zy();function p9(r){return h9(r)}mC.exports=p9});var bC=ue((Jat,yC)=>{var d9=ut(),v9=jt();function m9(r){try{return d9(r)?Math.exp(r):NaN}catch{return NaN}}yC.exports=v9(m9)});var kC=ue((Qat,xC)=>{var g9=jt();function wC(r){try{return r!==parseInt(r)?NaN:r<=1?1:r*wC(r-1)}catch{return NaN}}xC.exports=g9(wC)});var TC=ue((eit,EC)=>{var y9=ze(),b9=Fr(),SC=He(),w9=yt(),x9=Fn(),NC=Bo(),k9=vt();function $y(r,e){if(w9(r))return $y(b9(r.values),e);if(k9(r))return $y(r.values,e);if(y9(NC(r)||SC(r),"You must pass (1) an object, array, Series, or DataFrame and (2) a function or value into the `find` function!"),!x9(e)){let a=e;e=i=>i===a}function t(a,i,o){if(o=o||[],o.indexOf(a)>-1)return null;if(NC(a)){o.push(a);let s=Object.keys(a);for(let u=0;u<s.length;u++){let l=s[u],c=a[l];if(i(c))return c;let f=t(c,i,o);if(f)return f}}else if(SC(a)){o.push(a);for(let s=0;s<a.length;s++){let u=a[s];if(i(u))return u;let l=t(u,i,o);if(l)return l}}else if(i(a))return a;return null}function n(a){try{return e(a)}catch{return!1}}return t(r,n)}EC.exports=$y});var _C=ue((tit,AC)=>{var S9=ze(),N9=Fr(),IC=He(),E9=yt(),T9=Fn(),CC=Bo(),I9=vt();function Wy(r,e){if(E9(r))return Wy(N9(r.values),e);if(I9(r))return Wy(r.values,e);if(S9(CC(r)||IC(r),"You must pass (1) an object, array, Series, or DataFrame and (2) a function or value into the `findAll` function!"),!T9(e)){let i=e;e=o=>o===i}function t(i,o,s){if(s=s||[],s.indexOf(i)>-1)return null;if(CC(i)){s.push(i);let u=Object.keys(i),l=[];for(let c=0;c<u.length;c++){let f=u[c],h=i[f],p=!1;o(h)&&(l.push(h),p=!0);let d=t(h,o,s);d&&d.length>0&&d.slice(p?1:0).forEach(m=>l.push(m))}return l}else if(IC(i)){s.push(i);let u=[];for(let l=0;l<i.length;l++){let c=i[l],f=!1;o(c)&&(u.push(c),f=!0);let h=t(c,o,s);h&&h.length>0&&h.slice(f?1:0).forEach(p=>u.push(p))}return u}else if(o(i))return[i];return null}function n(i){try{return e(i)}catch{return!1}}let a=t(r,n);return a&&a.length>0?a:null}AC.exports=Wy});var FC=ue((rit,DC)=>{var C9=ut(),A9=jt();function _9(r){try{if(r==="Infinity")return 1/0;if(r==="-Infinity")return-1/0;let e=JSON.parse(r);return C9(e)?e:NaN}catch{return NaN}}DC.exports=A9(_9)});var OC=ue((nit,RC)=>{var D9=ut(),F9=jt();function R9(r){try{return D9(r)?Math.floor(r):NaN}catch{return NaN}}RC.exports=F9(R9)});var qy=ue((ait,PC)=>{var O9=ut(),P9=cf(),M9=td();function B9(r){O9(r)&&(r=[r]);let e=[],t=P9(r);for(let n=0;n<t;n++)e.push(0);return M9(e,r)}PC.exports=B9});var BC=ue((iit,MC)=>{var Sd=ze(),L9=ut(),z9=Tt(),$9=qy();function W9(r){Sd(!z9(r),"You must pass an integer greater than 0 (representing the size) into the `identity` function!"),Sd(L9(r),"You must pass an integer greater than 0 (representing the size) into the `identity` function!"),Sd(parseInt(r)===r,"You must pass an integer greater than 0 (representing the size) into the `identity` function!"),Sd(r>0,"You must pass an integer greater than 0 (representing the size) into the `identity` function!");let e=$9([r,r]);for(let t=0;t<r;t++)e[t][t]=1;return e}MC.exports=W9});var zC=ue((oit,LC)=>{var q9=ut(),V9=jt();function G9(r){try{let e=JSON.parse(r);return q9(e)?parseInt(e):NaN}catch{return NaN}}LC.exports=V9(G9)});var WC=ue((sit,$C)=>{var U9=ze(),H9=He(),K9=yt(),j9=qi(),X9=vt(),Vy=di();function Y9(){let r=Object.values(arguments).map(t=>K9(t)||X9(t)?Vy(t.values):(U9(H9(t),"The `intersect` function only works on arrays, Series, and DataFrames!"),Vy(t)));return Vy(r).filter(t=>r.every(n=>n.findIndex(a=>j9(a,t))>-1))}$C.exports=Y9});var UC=ue((uit,GC)=>{var qC=ld(),Ko=ze(),Z9=Ly(),J9=Fr(),Q9=He(),eY=yt(),Gy=ut(),VC=dl(),tY=wr();function Nd(r){if(eY(r)){let t=r.copy();return t.values=Nd(t.values),t}Ko(Q9(r),"The `inverse` function only works on square 2-dimensional arrays or DataFrames!"),J9(r).forEach(t=>Ko(Gy(t),"The array passed into the `inverse` function must contain only numbers!"));let e=tY(r);if(Ko(e.length===2,"The array passed into the `inverse` function must be exactly two-dimensional and square!"),Ko(e[0]===e[1],"The array passed into the `inverse` function must be exactly two-dimensional and square!"),Ko(e[0]>=0,"The array passed into the `inverse` function must be exactly two-dimensional and square!"),e[0]===0)return r;if(e[0]===1)return Ko(r[0][0]!==0,"This matrix cannot be inverted!"),1/r[0][0];if(e[0]===2){let t=r[0][0],n=r[0][1],a=r[1][0],i=r[1][1],o=t*i-n*a;Ko(o!==0,"This matrix cannot be inverted!");let s=[[i,-n],[-a,t]];return VC(s,1/o)}else if(e[0]>1){let t=(n,a)=>Gy(n)||Gy(a)?VC(n,a):Z9(n,a);for(let n=1;n<e[0]-1;n++)try{let a=r.slice(0,n).map(m=>m.slice(0,n)),i=r.slice(0,n).map(m=>m.slice(n,e[0])),o=r.slice(n,e[0]).map(m=>m.slice(0,n)),s=r.slice(n,e[0]).map(m=>m.slice(n,e[0])),u=Nd(a),l=Nd(qC(s,t(-1,t(t(o,u),i)))),c=qC(u,t(t(t(t(u,i),l),o),u)),f=t(-1,t(t(u,i),l)),h=t(-1,t(t(l,o),u)),p=l;return c.map((m,v)=>m.concat(f[v])).concat(h.map((m,v)=>m.concat(p[v])))}catch{}Ko(!1,"This matrix cannot be inverted!")}}GC.exports=Nd});var KC=ue((lit,HC)=>{var Uy=ut(),rY=jt();function nY(r,e,t){try{return Uy(r)?Uy(e)?Uy(t)?t*(e-r)+r:NaN:NaN:NaN}catch{return NaN}}HC.exports=rY(nY)});var YC=ue((cit,XC)=>{var jC=ut(),aY=Tt(),iY=jt();function oY(r,e){try{return e=aY(e)?Math.E:e,jC(r)?jC(e)?Math.log(r)/Math.log(e):NaN:NaN}catch{return NaN}}XC.exports=iY(oY)});var QC=ue((fit,JC)=>{var sY=ze(),uY=Fr(),lY=He(),cY=yt(),fY=vt(),hY=Wo();function ZC(r){if(cY(r)||fY(r))return ZC(r.values);sY(lY(r),"The `median` function only works on arrays, Series, and DataFrames!");try{let e=hY(uY(r));return e.length===0?NaN:e.length%2===0?(e[e.length/2-1]+e[e.length/2])/2:e[parseInt(e.length/2)]}catch{return NaN}}JC.exports=ZC});var rA=ue((hit,tA)=>{var eA=ut(),pY=jt();function dY(r,e){try{return eA(r)?eA(e)?r%e:NaN:NaN}catch{return NaN}}tA.exports=pY(dY)});var oA=ue((pit,iA)=>{var vY=ze(),mY=Vp(),gY=Fr(),yY=He(),bY=yt(),wY=vt(),xY=di(),nA=Wo();function aA(r){if(bY(r)||wY(r))return aA(r.values);vY(yY(r),"The `mode` function only works on arrays, Series, and DataFrames!");try{if(r.length===0)return NaN;let e=gY(r);if(e.length===0)return NaN;let t={},n=xY(e);n.forEach(s=>{t[s]=mY(e,s)});let a=nA(n,(s,u)=>t[u]-t[s]),i=a[0];return nA(a.filter(s=>t[s]===t[i]))}catch{return NaN}}iA.exports=aA});var cA=ue((dit,lA)=>{var{random:sA}=fl(),kY=cd(),SY=Tt(),NY=Lo();function uA(){let r=sA(),e=sA();return Math.sqrt(-2*Math.log(r))*Math.cos(2*Math.PI*e)}function EY(r){return SY(r)?uA():kY(NY(r),uA)}lA.exports=EY});var hA=ue((vit,fA)=>{var TY=cd(),IY=Lo();function CY(r){return TY(IY(r),()=>1)}fA.exports=CY});var dA=ue((mit,pA)=>{var Hy=ze(),AY=Fr(),_Y=He(),DY=yt(),FY=ut(),RY=vt(),OY=Tt();function Ed(r,e){if(DY(r)||RY(r))return Ed(r.values,e);if(Hy(_Y(r),"The `permutations` function only works on arrays, Series, and DataFrames!"),OY(e)&&(e=r.length),Hy(FY(e),"`r` must be a whole number!"),r=AY(r),e>r.length)return Ed(r);if(e<=0)return[[]];if(Hy(e===parseInt(e),"`r` must be a whole number!"),r.length<2)return r;let t=[];return r.forEach((n,a)=>{let i=r.slice(0,a),o=r.slice(a+1),s=i.concat(o);Ed(s,e-1).forEach(l=>{t.push([n].concat(l))})}),t}pA.exports=Ed});var mA=ue((git,vA)=>{var{DataFrame:PY,Series:MY}=mf(),BY=He(),LY=yt(),zY=nf(),$Y=vt(),WY=wr();function qY(){Object.keys(arguments).forEach(r=>{let e=arguments[r];if(BY(e))if(zY(e))console.log(e);else{let t=WY(e);t.length===1?new MY(e).print():t.length==2?new PY(e).print():console.log(e)}else LY(e)||$Y(e)?e.print():console.log(e)})}vA.exports=qY});var bA=ue((yit,yA)=>{var VY=He(),GY=ut(),gA=Tt(),UY=Ps(),HY=fd(),KY=jt(),jY=KY(function(r,e,t,n,a){try{return[r,e,t,n,a].every(i=>GY(i))?t-e===0?NaN:(a-n)*(r-e)/(t-e)+n:NaN}catch{return NaN}});function XY(r,e,t,n,a){return VY(r)&&gA(n)&&gA(a)&&(n=e,a=t,e=HY(r),t=UY(r)),jY(r,e,t,n,a)}yA.exports=XY});var xA=ue((bit,wA)=>{var YY=ut(),ZY=jt();function JY(r){try{return YY(r)?Math.round(r):NaN}catch{return NaN}}wA.exports=ZY(JY)});var SA=ue((wit,kA)=>{var QY=ut(),eZ=jt();function tZ(r){try{return QY(r)?r<0?-1:r>0?1:0:NaN}catch{return NaN}}kA.exports=eZ(tZ)});var EA=ue((xit,NA)=>{var rZ=ut(),nZ=jt();function aZ(r){try{return rZ(r)?Math.sin(r):NaN}catch{return NaN}}NA.exports=nZ(aZ)});var IA=ue((kit,TA)=>{var iZ=vd();function oZ(r){return iZ(r)}TA.exports=oZ});var AA=ue((Sit,CA)=>{var sZ=ut(),uZ=jt();function lZ(r){try{return sZ(r)?Math.tan(r):NaN}catch{return NaN}}CA.exports=uZ(lZ)});var Td=ue((Nit,FA)=>{var _A=ze(),DA=Fn();function cZ(r,e){_A(DA(r),"`fn` must be a function!");let t=new Date;return e?r(...e):r(),new Date-t}async function fZ(r,e){_A(DA(r),"`fn` must be a function!");let t=new Date;return e?await r(...e):await r(),new Date-t}FA.exports={timeSync:cZ,timeAsync:fZ}});var OA=ue((Eit,RA)=>{var hZ=He(),pZ=yt(),dZ=vt(),vZ=di();function mZ(){return vZ([...arguments].map(r=>hZ(r)?r:pZ(r)||dZ(r)?r.values:[r]))}RA.exports=mZ});var MA=ue((Tit,PA)=>{var gZ=ze(),yZ=He(),bZ=yt(),wZ=vt(),xZ=Tt(),kZ=Ps(),SZ=Zn();function NZ(){let r=[],e=Object.values(arguments).map(t=>((bZ(t)||wZ(t))&&(t=t.values),gZ(yZ(t),"The `zip` function only works on arrays, Series, and DataFrames!"),t));return SZ(0,kZ(e.map(t=>t.length))).forEach(t=>{let n=[];e.forEach(a=>{let i=a[t];n.push(xZ(i)?void 0:i)}),r.push(n)}),r}PA.exports=NZ});var yf=ue((Iit,Ky)=>{var{DataFrame:EZ,Series:TZ}=mf(),vl={abs:ud(),add:ld(),apply:cd(),arccos:MT(),arcsin:LT(),arctan:$T(),argmax:qT(),argmin:HT(),assert:ze(),ceil:jT(),chop:ZT(),clamp:QT(),combinations:tI(),copy:Wi(),correl:xI(),cos:SI(),count:Vp(),covariance:_y(),DataFrame:EZ,diff:AI(),distance:VI(),divide:UI(),dot:Ly(),dropMissing:zy(),dropMissingPairwise:sC(),dropNaN:ay(),dropNaNPairwise:vC(),dropUndefined:gC(),exp:bC(),factorial:kC(),find:TC(),findAll:_C(),flatten:Fr(),float:FC(),floor:OC(),identity:BC(),indexOf:tf(),int:zC(),intersect:WC(),inverse:UC(),isArray:He(),isBoolean:uf(),isDataFrame:yt(),isEqual:qi(),isFunction:Fn(),isJagged:nf(),isNested:Gp(),isNumber:ut(),isObject:Bo(),isSeries:vt(),isString:kn(),isUndefined:Tt(),lerp:KC(),log:YC(),MathError:$i(),max:Ps(),mean:hd(),median:QC(),min:fd(),mod:rA(),mode:oA(),multiply:Oy(),ndarray:Lo(),normal:cA(),ones:hA(),permutations:dA(),pow:md(),print:mA(),product:cf(),random:fl().random,range:Zn(),remap:bA(),reshape:td(),reverse:af(),round:xA(),scale:dl(),seed:fl().seed,Series:TZ,set:di(),shape:wr(),shuffle:rd(),sign:SA(),sin:EA(),sort:Wo(),sqrt:dd(),std:vd(),stdev:IA(),subtract:Py(),sum:gd(),tan:AA(),time:Td().timeSync,timeSync:Td().timeSync,timeAsync:Td().timeAsync,transpose:Ms(),union:OA(),variance:Dy(),vectorize:jt(),zeros:qy(),zip:MA(),dump:function(){let r=typeof global<"u"?global:window;if(!r)throw new vl.MathError("Cannot dump functions into global scope because neither `global` nor `window` exist in the current context!");Object.keys(vl).forEach(e=>{try{Object.defineProperty(r,e,{configurable:!1,enumerable:!0,writable:!1,value:vl[e]})}catch{r[e]=vl[e]}})}};typeof Ky<"u"&&(Ky.exports=vl);typeof window<"u"&&(window.JSMathTools=vl)});var BA=ue(()=>{});var LA=ue(()=>{});var Id=ue(()=>{});var ru=ue(A=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0});var e0=function(r,e){return e0=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},e0(r,e)};function vo(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");e0(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Ke(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(f){o(f)}}function u(c){try{l(n.throw(c))}catch(f){o(f)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(r,e||[])).next())})}function je(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(l){return function(c){return u([l,c])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=l[0]&2?a.return:l[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,l[1])).done)return i;switch(a=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,a=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){t.label=l[1];break}if(l[0]===6&&t.label<i[1]){t.label=i[1],i=l;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(l);break}i[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(c){l=[6,c],a=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function On(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ge(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function Lt(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(Ge(arguments[e]));return r}var IZ=1e-7,CZ=1e-4,AZ=function(){function r(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return r.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},r.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},r.prototype.has=function(e){return this.data.has(e)},r.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},r.prototype.numDataIds=function(){return this.dataIdsCount},r}(),a_=function(){function r(){}return r.prototype.refCount=function(e){return Na("refCount")},r.prototype.incRef=function(e){return Na("incRef")},r.prototype.timerAvailable=function(){return!0},r.prototype.time=function(e){return Na("time")},r.prototype.read=function(e){return Na("read")},r.prototype.readSync=function(e){return Na("readSync")},r.prototype.readToGPU=function(e,t){return Na("readToGPU")},r.prototype.numDataIds=function(){return Na("numDataIds")},r.prototype.disposeData=function(e,t){return Na("disposeData")},r.prototype.write=function(e,t,n){return Na("write")},r.prototype.move=function(e,t,n,a,i){return Na("move")},r.prototype.memory=function(){return Na("memory")},r.prototype.floatPrecision=function(){return Na("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?IZ:CZ},r.prototype.dispose=function(){return Na("dispose")},r}();function Na(r){throw new Error("'"+r+"' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen")}function i_(r){for(var e=r.length,t=0;e>0;)t=Math.random()*e|0,e--,Od(r,e,t)}function _Z(r,e){if(r.length!==e.length)throw new Error("Array sizes must match to be shuffled together "+("First array length was "+r.length)+("Second array length was "+e.length));for(var t=r.length,n=0;t>0;)n=Math.random()*t|0,t--,Od(r,t,n),Od(e,t,n)}function Ef(r,e,t){return Math.max(r,Math.min(e,t))}function DZ(r){return r%2===0?r:r+1}function Od(r,e,t){var n=r[e];r[e]=r[t],r[t]=n}function FZ(r){for(var e=0,t=0;t<r.length;t++)e+=r[t];return e}function RZ(r,e){var t=Math.random();return e*t+(1-t)*r}function OZ(r,e){for(var t=0,n=0;n<r.length;n++){var a=Number(r[n])-Number(e[n]);t+=a*a}return t}function G(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function En(r,e,t){t===void 0&&(t=""),G(rs(r,e),function(){return t+(" Shapes "+r+" and "+e+" must match")})}function Zs(r){G(r!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Hs(r,e,t){if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),Array.isArray(r)||gn(r)&&!t)for(var n=0;n<r.length;++n)Hs(r[n],e,t);else e.push(r);return e}function ir(r){if(r.length===0)return 1;for(var e=r[0],t=1;t<r.length;t++)e*=r[t];return e}function PZ(r){return r.length===0}function rs(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function El(r){return r%1===0}function MZ(r){if(Math.tanh!=null)return Math.tanh(r);if(r===1/0)return 1;if(r===-1/0)return-1;var e=Math.exp(2*r);return(e-1)/(e+1)}function BZ(r){var e=Math.ceil(Math.sqrt(r));return[e,Math.ceil(r/e)]}function LZ(r){for(var e=new Uint32Array(r),t=0;t<r;++t)e[t]=t;return i_(e),e}function kf(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function zZ(r,e,t,n){return e===void 0&&(e=function(a){return 0}),n===void 0&&(n=setTimeout),new Promise(function(a,i){var o=0,s=function(){if(r()){a();return}o++;var u=e(o);if(t!=null&&o>=t){i();return}n(s,u)};s()})}function $Z(r,e){for(var t=1,n=-1,a=0;a<r.length;++a)if(r[a]>=0)t*=r[a];else if(r[a]===-1){if(n!==-1)throw Error("Shapes can only have 1 implicit size. "+("Found -1 at dim "+n+" and dim "+a));n=a}else if(r[a]<0)throw Error("Shapes can not be < 0. Found "+r[a]+" at dim "+a);if(n===-1){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+r);return r}if(t===0)throw Error("Cannot infer the missing size in ["+r+"] when there are 0 elements");if(e%t!==0)throw Error("The implicit shape can't be a fractional number. "+("Got "+e+" / "+t));var i=r.slice();return i[n]=e/t,i}function Bf(r,e){var t=e.length;return r=r==null?e.map(function(n,a){return a}):[].concat(r),G(r.every(function(n){return n>=-t&&n<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but "+("got axis "+r)}),G(r.every(function(n){return El(n)}),function(){return"All values in axis param must be integers but "+("got axis "+r)}),r.map(function(n){return n<0?t+n:n})}function o_(r,e){for(var t=[],n=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:Bf(e,r).sort(),o=0,s=0;s<r.length;++s){if(i!=null){if(i[o]===s&&r[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+r[s]+"' is not 1");(i[o]==null||i[o]>s)&&r[s]===1&&(t.push(r[s]),n.push(s)),i[o]<=s&&o++}r[s]!==1&&(t.push(r[s]),n.push(s))}return{newShape:t,keptDims:n}}function s_(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else throw new Error("Unknown data type "+r);return t}function u_(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else if(r==="string")t=new Array(e);else throw new Error("Unknown data type "+r);return t}function l_(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type "+e+" being uploaded contains "+n+".")}}function c_(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function WZ(r,e){return!(e==="complex64"||e==="float32"&&r!=="complex64"||e==="int32"&&r!=="float32"&&r!=="complex64"||e==="bool"&&r==="bool")}function gn(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}function t0(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype "+r)}function f_(r){if(r==null)return 0;var e=0;return r.forEach(function(t){return e+=t.length}),e}function Yo(r){return typeof r=="string"||r instanceof String}function h_(r){return typeof r=="boolean"}function p_(r){return typeof r=="number"}function jd(r){return Array.isArray(r)?jd(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":p_(r)?"float32":Yo(r)?"string":h_(r)?"bool":"float32"}function Qo(r){return!!(r&&r.constructor&&r.call&&r.apply)}function Pd(r,e){for(var t=e;t<r;++t)if(r%t===0)return t;return r}function _l(r){var e=r.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=r[e-1];for(var n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function d_(r,e,t,n){n===void 0&&(n=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(n?2:1),o=0;o<i;o++)a[o]=t[r+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(c,f){return c*f})*(n?2:1),o=0;o<i;o++)a[o]=d_(r+o*u,s,t,n);return a}function bl(r,e,t){if(t===void 0&&(t=!1),r.length===0)return e[0];var n=r.reduce(function(a,i){return a*i})*(t?2:1);if(n===0)return[];if(n!==e.length)throw new Error("["+r+"] does not match the input size "+e.length+(t?" for a complex tensor":"")+".");return d_(0,r,e,t)}function T0(r,e){for(var t=Xd(r,e),n=0;n<t.length;n++)t[n]=1;return t}function Xd(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error("Unknown data type "+e)}function qZ(r,e){var t=r.reduce(function(n,a){return n*a},1);if(e==null||e==="float32")return bl(r,new Float32Array(t));if(e==="int32")return bl(r,new Int32Array(t));if(e==="bool")return bl(r,new Uint8Array(t));throw new Error("Unknown data type "+e)}function I0(r){r.forEach(function(e){G(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+("shape ["+r+"].")})})}function VZ(r,e,t){if(e===0)return 0;if(e===1)return r[0];for(var n=r[r.length-1],a=0;a<r.length-1;++a)n+=t[a]*r[a];return n}function GZ(r,e,t){if(e===0)return[];if(e===1)return[r];for(var n=new Array(e),a=0;a<n.length-1;++a)n[a]=Math.floor(r/t[a]),r-=n[a]*t[a];return n[n.length-1]=r,n}function C0(r){return r&&r.then&&typeof r.then=="function"}var zA="tfjsflags",v_=function(){function r(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=UZ,this.populateURLFlags()}return r.prototype.setPlatform=function(e,t){this.platform!=null&&(It().getBool("IS_TEST")||It().getBool("PROD")||console.warn("Platform "+this.platformName+" has already been set. "+("Overwriting the platform with "+e+"."))),this.platformName=e,this.platform=t},r.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){var a=this.urlFlags[e];It().getBool("IS_TEST")||It().getBool("PROD")||console.warn("Setting feature override from URL "+e+": "+a+"."),this.set(e,a)}},r.prototype.getAsync=function(e){return Ke(this,void 0,void 0,function(){var t,n;return je(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,n=e,[4,this.evaluateFlag(e)]);case 1:return t[n]=a.sent(),[2,this.flags[e]]}})})},r.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(C0(t))throw new Error("Flag "+e+" cannot be synchronously evaluated. Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},r.prototype.getNumber=function(e){return this.get(e)},r.prototype.getBool=function(e){return this.get(e)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),r.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},r.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},r.prototype.setFlags=function(e){this.flags=Object.assign({},e)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if(zA in t){var n=t[zA].split(",");n.forEach(function(a){var i=Ge(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=KZ(o,s)})}}},r}();function UZ(r){var e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];return HZ(e,n[0],n[1]),n.join("=")}),e}function HZ(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function KZ(r,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if(""+ +e===e)return+e;throw new Error("Could not parse value flag value "+e+" for flag "+r+".")}function It(){return A.ENV}A.ENV=null;function jZ(r){A.ENV=r}var jy;function m_(){if(jy==null){var r=void 0;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");jy=r}return jy}function XZ(){var r=m_();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function A0(r,e){var t=XZ();if(t.has(r))return t.get(r);var n=e();return t.set(r,n),t.get(r)}var g_="Abs",y_="Acos",b_="Acosh",_0="Add",w_="AddN",x_="All",k_="Any",S_="ArgMax",N_="ArgMin",E_="Asin",T_="Asinh",I_="Atan",C_="Atanh",A_="Atan2",__="AvgPool",YZ="AvgPoolGrad",D_="AvgPool3D",ZZ="AvgPool3DGrad",F_="BatchMatMul",R_="BatchToSpaceND",O_="Bincount",JZ="BroadcastTo",P_="BroadcastArgs",D0="Cast",M_="Ceil",B_="ClipByValue",L_="Complex",z_="ComplexAbs",$_="Concat",W_="Conv2D",q_="Conv2DBackpropFilter",V_="Conv2DBackpropInput",G_="Conv3D",QZ="Conv3DBackpropFilterV2",U_="Conv3DBackpropInputV2",H_="Cos",K_="Cosh",j_="Cumprod",X_="Cumsum",Y_="CropAndResize",Z_="DenseBincount",J_="DepthToSpace",Q_="DepthwiseConv2dNative",eD="DepthwiseConv2dNativeBackpropFilter",tD="DepthwiseConv2dNativeBackpropInput",rD="Diag",nD="Dilation2D",eJ="Dilation2DBackpropInput",tJ="Dilation2DBackpropFilter",aD="RealDiv",iD="Einsum",oD="Elu",rJ="EluGrad",sD="Erf",uD="Equal",lD="Exp",cD="ExpandDims",fD="Expm1",hD="FFT",pD="Fill",dD="FlipLeftRight",vD="Floor",mD="FloorDiv",gD="FusedBatchNorm",yD="GatherV2",bD="GatherNd",wD="Greater",xD="GreaterEqual",F0="Identity",kD="IFFT",SD="Imag",ND="IsFinite",ED="IsInf",TD="IsNan",ID="LeakyRelu",CD="Less",AD="LessEqual",_D="LinSpace",DD="Log",FD="Log1p",RD="LogicalAnd",OD="LogicalNot",PD="LogicalOr",nJ="LogicalXor",aJ="LogSoftmax",iJ="LowerBound",MD="LRN",oJ="LRNGrad",BD="Max",LD="Maximum",zD="MaxPool",sJ="MaxPoolGrad",$D="MaxPool3D",uJ="MaxPool3DGrad",WD="MaxPoolWithArgmax",qD="Mean",VD="Min",GD="Minimum",UD="MirrorPad",HD="Mod",KD="Multinomial",jD="Multiply",XD="Neg",YD="NotEqual",ZD="NonMaxSuppressionV3",JD="NonMaxSuppressionV4",QD="NonMaxSuppressionV5",e3="OnesLike",t3="OneHot",r3="Pack",n3="PadV2",lJ="Pool",a3="Pow",i3="Prelu",o3="Prod",s3="RaggedGather",u3="RaggedTensorToTensor",l3="Range",c3="Real",f3="Reciprocal",h3="Relu",p3="Reshape",d3="ResizeNearestNeighbor",cJ="ResizeNearestNeighborGrad",v3="ResizeBilinear",fJ="ResizeBilinearGrad",m3="Relu6",g3="Reverse",y3="Round",b3="Rsqrt",w3="ScatterNd",x3="SearchSorted",k3="Select",S3="Selu",N3="Slice",E3="Sin",T3="Sinh",I3="Sign",C3="Sigmoid",A3="Softplus",_3="Sqrt",D3="Sum",F3="SpaceToBatchND",R3="SplitV",O3="Softmax",P3="SparseFillEmptyRows",M3="SparseReshape",B3="SparseSegmentMean",L3="SparseSegmentSum",z3="SparseToDense",$3="SquaredDifference",hJ="Square",W3="StridedSlice",q3="StringNGrams",V3="StringSplit",G3="StringToHashBucketFast",U3="Sub",H3="Tan",K3="Tanh",R0="Tile",j3="TopK",X3="Transform",_d="Transpose",Y3="Unique",Z3="Unpack",J3="UnsortedSegmentSum",pJ="UpperBound",Q3="ZerosLike",eF="Step",r0="FromPixels",tF="RotateWithOffset",n0="_FusedMatMul",a0="FusedConv2D",i0="FusedDepthwiseConv2D";function Xo(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];It().getBool("IS_TEST")||It().getBool("PROD")||console.warn.apply(console,Lt(r))}function dJ(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];It().getBool("IS_TEST")||It().getBool("PROD")||console.log.apply(console,Lt(r))}var Tl=A0("kernelRegistry",function(){return new Map}),Tf=A0("gradRegistry",function(){return new Map});function Md(r,e){var t=O0(r,e);return Tl.get(t)}function o0(r){return Tf.get(r)}function Bd(r){for(var e=Tl.entries(),t=[];;){var n=e.next(),a=n.done,i=n.value;if(a)break;var o=Ge(i,2),s=o[0],u=o[1],l=Ge(s.split("_"),1),c=l[0];c===r&&t.push(u)}return t}function rF(r){var e=r.kernelName,t=r.backendName,n=O0(e,t);Tl.has(n)&&Xo("The kernel '"+e+"' for backend "+("'"+t+"' is already registered")),Tl.set(n,r)}function vJ(r){var e=r.kernelName;Tf.has(e)&&It().getBool("DEBUG")&&Xo("Overriding the gradient for '"+e+"'"),Tf.set(e,r)}function mJ(r,e){var t=O0(r,e);if(!Tl.has(t))throw new Error("The kernel '"+r+"' for backend "+("'"+e+"' is not registered"));Tl.delete(t)}function gJ(r){if(!Tf.has(r))throw new Error("The gradient '"+r+"' for backend is not registered");Tf.delete(r)}function yJ(r,e){var t=Bd(r);t.forEach(function(n){var a=Object.assign({},n,{backendName:e});rF(a)})}function O0(r,e){return e+"_"+r}var s0=or,Wa=null;try{Wa=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function or(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}or.prototype.__isLong__;Object.defineProperty(or.prototype,"__isLong__",{value:!0});function ra(r){return(r&&r.__isLong__)===!0}or.isLong=ra;var $A={},WA={};function Js(r,e){var t,n,a;return e?(r>>>=0,(a=0<=r&&r<256)&&(n=WA[r],n)?n:(t=sr(r,(r|0)<0?-1:0,!0),a&&(WA[r]=t),t)):(r|=0,(a=-128<=r&&r<128)&&(n=$A[r],n)?n:(t=sr(r,r<0?-1:0,!1),a&&($A[r]=t),t))}or.fromInt=Js;function qa(r,e){if(isNaN(r))return e?Ws:Va;if(e){if(r<0)return Ws;if(r>=nF)return oF}else{if(r<=-VA)return Qn;if(r+1>=VA)return iF}return r<0?qa(-r,e).neg():sr(r%Il|0,r/Il|0,e)}or.fromNumber=qa;function sr(r,e,t){return new or(r,e,t)}or.fromBits=sr;var Ld=Math.pow;function P0(r,e,t){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return Va;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return P0(r.substring(1),e,t).neg();for(var a=qa(Ld(t,8)),i=Va,o=0;o<r.length;o+=8){var s=Math.min(8,r.length-o),u=parseInt(r.substring(o,o+s),t);if(s<8){var l=qa(Ld(t,s));i=i.mul(l).add(qa(u))}else i=i.mul(a),i=i.add(qa(u))}return i.unsigned=e,i}or.fromString=P0;function yi(r,e){return typeof r=="number"?qa(r,e):typeof r=="string"?P0(r,e):sr(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}or.fromValue=yi;var qA=1<<16,bJ=1<<24,Il=qA*qA,nF=Il*Il,VA=nF/2,GA=Js(bJ),Va=Js(0);or.ZERO=Va;var Ws=Js(0,!0);or.UZERO=Ws;var yl=Js(1);or.ONE=yl;var aF=Js(1,!0);or.UONE=aF;var u0=Js(-1);or.NEG_ONE=u0;var iF=sr(-1,2147483647,!1);or.MAX_VALUE=iF;var oF=sr(-1,-1,!0);or.MAX_UNSIGNED_VALUE=oF;var Qn=sr(0,-2147483648,!1);or.MIN_VALUE=Qn;var _e=or.prototype;_e.toInt=function(){return this.unsigned?this.low>>>0:this.low};_e.toNumber=function(){return this.unsigned?(this.high>>>0)*Il+(this.low>>>0):this.high*Il+(this.low>>>0)};_e.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Qn)){var t=qa(e),n=this.div(t),a=n.mul(t).sub(this);return n.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=qa(Ld(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),l=o.sub(u.mul(i)).toInt()>>>0,c=l.toString(e);if(o=u,o.isZero())return c+s;for(;c.length<6;)c="0"+c;s=""+c+s}};_e.getHighBits=function(){return this.high};_e.getHighBitsUnsigned=function(){return this.high>>>0};_e.getLowBits=function(){return this.low};_e.getLowBitsUnsigned=function(){return this.low>>>0};_e.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Qn)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};_e.isZero=function(){return this.high===0&&this.low===0};_e.eqz=_e.isZero;_e.isNegative=function(){return!this.unsigned&&this.high<0};_e.isPositive=function(){return this.unsigned||this.high>=0};_e.isOdd=function(){return(this.low&1)===1};_e.isEven=function(){return(this.low&1)===0};_e.equals=function(e){return ra(e)||(e=yi(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};_e.eq=_e.equals;_e.notEquals=function(e){return!this.eq(e)};_e.neq=_e.notEquals;_e.ne=_e.notEquals;_e.lessThan=function(e){return this.comp(e)<0};_e.lt=_e.lessThan;_e.lessThanOrEqual=function(e){return this.comp(e)<=0};_e.lte=_e.lessThanOrEqual;_e.le=_e.lessThanOrEqual;_e.greaterThan=function(e){return this.comp(e)>0};_e.gt=_e.greaterThan;_e.greaterThanOrEqual=function(e){return this.comp(e)>=0};_e.gte=_e.greaterThanOrEqual;_e.ge=_e.greaterThanOrEqual;_e.compare=function(e){if(ra(e)||(e=yi(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};_e.comp=_e.compare;_e.negate=function(){return!this.unsigned&&this.eq(Qn)?Qn:this.not().add(yl)};_e.neg=_e.negate;_e.add=function(e){ra(e)||(e=yi(e));var t=this.high>>>16,n=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,l=e.low&65535,c=0,f=0,h=0,p=0;return p+=i+l,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=n+s,c+=f>>>16,f&=65535,c+=t+o,c&=65535,sr(h<<16|p,c<<16|f,this.unsigned)};_e.subtract=function(e){return ra(e)||(e=yi(e)),this.add(e.neg())};_e.sub=_e.subtract;_e.multiply=function(e){if(this.isZero())return Va;if(ra(e)||(e=yi(e)),Wa){var t=Wa.mul(this.low,this.high,e.low,e.high);return sr(t,Wa.get_high(),this.unsigned)}if(e.isZero())return Va;if(this.eq(Qn))return e.isOdd()?Qn:Va;if(e.eq(Qn))return this.isOdd()?Qn:Va;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(GA)&&e.lt(GA))return qa(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,l=e.low>>>16,c=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*c,p+=d>>>16,d&=65535,p+=i*c,h+=p>>>16,p&=65535,p+=o*l,h+=p>>>16,p&=65535,h+=a*c,f+=h>>>16,h&=65535,h+=i*l,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=n*c+a*l+i*u+o*s,f&=65535,sr(p<<16|d,f<<16|h,this.unsigned)};_e.mul=_e.multiply;_e.divide=function(e){if(ra(e)||(e=yi(e)),e.isZero())throw Error("division by zero");if(Wa){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Wa.div_u:Wa.div_s)(this.low,this.high,e.low,e.high);return sr(t,Wa.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Ws:Va;var n,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Ws;if(e.gt(this.shru(1)))return aF;i=Ws}else{if(this.eq(Qn)){if(e.eq(yl)||e.eq(u0))return Qn;if(e.eq(Qn))return yl;var o=this.shr(1);return n=o.div(e).shl(1),n.eq(Va)?e.isNegative()?yl:u0:(a=this.sub(e.mul(n)),i=n.add(a.div(e)),i)}else if(e.eq(Qn))return this.unsigned?Ws:Va;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Va}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:Ld(2,s-48),l=qa(n),c=l.mul(e);c.isNegative()||c.gt(a);)n-=u,l=qa(n,this.unsigned),c=l.mul(e);l.isZero()&&(l=yl),i=i.add(l),a=a.sub(c)}return i};_e.div=_e.divide;_e.modulo=function(e){if(ra(e)||(e=yi(e)),Wa){var t=(this.unsigned?Wa.rem_u:Wa.rem_s)(this.low,this.high,e.low,e.high);return sr(t,Wa.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};_e.mod=_e.modulo;_e.rem=_e.modulo;_e.not=function(){return sr(~this.low,~this.high,this.unsigned)};_e.and=function(e){return ra(e)||(e=yi(e)),sr(this.low&e.low,this.high&e.high,this.unsigned)};_e.or=function(e){return ra(e)||(e=yi(e)),sr(this.low|e.low,this.high|e.high,this.unsigned)};_e.xor=function(e){return ra(e)||(e=yi(e)),sr(this.low^e.low,this.high^e.high,this.unsigned)};_e.shiftLeft=function(e){return ra(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?sr(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):sr(0,this.low<<e-32,this.unsigned)};_e.shl=_e.shiftLeft;_e.shiftRight=function(e){return ra(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?sr(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):sr(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};_e.shr=_e.shiftRight;_e.shiftRightUnsigned=function(e){if(ra(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var n=this.low;return sr(n>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?sr(t,0,this.unsigned):sr(t>>>e-32,0,this.unsigned)};_e.shru=_e.shiftRightUnsigned;_e.shr_u=_e.shiftRightUnsigned;_e.toSigned=function(){return this.unsigned?sr(this.low,this.high,!1):this};_e.toUnsigned=function(){return this.unsigned?this:sr(this.low,this.high,!0)};_e.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};_e.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};_e.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};or.fromBytes=function(e,t,n){return n?or.fromBytesLE(e,t):or.fromBytesBE(e,t)};or.fromBytesLE=function(e,t){return new or(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};or.fromBytesBE=function(e,t){return new or(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var wJ=Object.assign(Object.create(null),s0,{default:s0}),$s=s0||wJ;function Lf(r){return $s.fromString(r,!0,16)}var sF=Lf("c3a5c85c97cb3127"),Ls=Lf("b492b66fbe98f273"),Nn=Lf("9ae16a3b2f90404f");function l0(r){return r.xor(r.shru(47))}function uF(r,e,t){var n=r.slice(e,e+t);return $s.fromBytes(Array.from(n),!0,!0)}function Zt(r,e){return uF(r,e,8)}function UA(r,e){return uF(r,e,4)}function nn(r,e){return e===0?r:r.shru(e).or(r.shl(64-e))}function Jo(r,e,t){t===void 0&&(t=Lf("9ddfea08eb382d69"));var n=r.xor(e).mul(t);n=n.xor(n.shru(47));var a=e.xor(n).mul(t);return a=a.xor(a.shru(47)),a=a.mul(t),a}function xJ(r,e,t,n,a,i){a=a.add(r),i=nn(i.add(a).add(n),21);var o=a;return a=a.add(e),a=a.add(t),i=i.add(nn(a,44)),[a.add(n),i.add(o)]}function Cd(r,e,t,n){return xJ(Zt(r,e),Zt(r,e+8),Zt(r,e+16),Zt(r,e+24),t,n)}function kJ(r,e){if(e===void 0&&(e=r.length),e>=8){var t=Nn.add(e*2),n=Zt(r,0).add(Nn),a=Zt(r,e-8),i=nn(a,37).mul(t).add(n),o=nn(n,25).add(a).mul(t);return Jo(i,o,t)}if(e>=4){var t=Nn.add(e*2),n=UA(r,0);return Jo(n.shl(3).add(e),UA(r,e-4),t)}if(e>0){var n=r[0],a=r[e>>1],i=r[e-1],s=n+(a<<8),u=e+(i<<2);return l0(Nn.mul(s).xor(sF.mul(u))).mul(Nn)}return Nn}function SJ(r,e){e===void 0&&(e=r.length);var t=Nn.add(e*2),n=Zt(r,0).mul(Ls),a=Zt(r,8),i=Zt(r,e-8).mul(t),o=Zt(r,e-16).mul(Nn);return Jo(nn(n.add(a),43).add(nn(i,30)).add(o),n.add(nn(a.add(Nn),18)).add(i),t)}function NJ(r,e){e===void 0&&(e=r.length);var t=Nn.add(e*2),n=Zt(r,0).mul(Nn),a=Zt(r,8),i=Zt(r,e-8).mul(t),o=Zt(r,e-16).mul(Nn),s=nn(n.add(a),43).add(nn(i,30)).add(o),u=Jo(s,n.add(nn(a.add(Nn),18)).add(i),t),l=Zt(r,16).mul(t),c=Zt(r,24),f=s.add(Zt(r,e-32)).mul(t),h=u.add(Zt(r,e-24)).mul(t);return Jo(nn(l.add(c),43).add(nn(f,30)).add(h),l.add(nn(c.add(n),18)).add(f),t)}function EJ(r,e){var t,n;e===void 0&&(e=r.length);var a=$s.fromNumber(81,!0);if(e<=32)return e<=16?kJ(r,e):SJ(r,e);if(e<=64)return NJ(r,e);var i=a,o=a.mul(Ls).add(113),s=l0(o.mul(Nn).add(113)).mul(Nn),u=[$s.UZERO,$s.UZERO],l=[$s.UZERO,$s.UZERO];i=i.mul(Nn).add(Zt(r,0));var c=0,f=(e-1>>6)*64,h=f+(e-1&63)-63;do i=nn(i.add(o).add(u[0]).add(Zt(r,c+8)),37).mul(Ls),o=nn(o.add(u[1]).add(Zt(r,c+48)),42).mul(Ls),i=i.xor(l[1]),o=o.add(u[0]).add(Zt(r,c+40)),s=nn(s.add(l[0]),33).mul(Ls),u=Cd(r,c,u[1].mul(Ls),i.add(l[0])),l=Cd(r,c+32,s.add(l[1]),o.add(Zt(r,c+16))),t=Ge([i,s],2),s=t[0],i=t[1],c+=64;while(c!==f);var p=Ls.add(s.and(255).shl(1));return c=h,l[0]=l[0].add(e-1&63),u[0]=u[0].add(l[0]),l[0]=l[0].add(u[0]),i=nn(i.add(o).add(u[0]).add(Zt(r,c+8)),37).mul(p),o=nn(o.add(u[1]).add(Zt(r,c+48)),42).mul(p),i=i.xor(l[1].mul(9)),o=o.add(u[0].mul(9).add(Zt(r,c+40))),s=nn(s.add(l[0]),33).mul(p),u=Cd(r,c,u[1].mul(p),i.add(l[0])),l=Cd(r,c+32,s.add(l[1]),o.add(Zt(r,c+16))),n=Ge([i,s],2),s=n[0],i=n[1],Jo(Jo(u[0],l[0],p).add(l0(o).mul(sF)).add(s),Jo(u[1],l[1],p).add(i),p)}function TJ(r,e){return e==="string"?zf(r):Yd([r],e)}function IJ(r,e){return r instanceof Float32Array&&e==="float32"||r instanceof Int32Array&&e==="int32"||r instanceof Uint8Array&&e==="bool"}function Yd(r,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=Hs(r)),It().getBool("DEBUG")&&l_(r,e),IJ(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){for(var t=new Uint8Array(r.length),n=0;n<t.length;++n)Math.round(r[n])!==0&&(t[n]=1);return t}else throw new Error("Unknown data type "+e)}function If(){return It().platform.now()}function CJ(r,e){return It().platform.fetch(r,e)}function zf(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",It().platform.encode(r,e)}function zd(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",It().platform.decode(r,e)}var AJ={__proto__:null,createScalarValue:TJ,toTypedArray:Yd,now:If,fetch:CJ,encodeString:zf,decodeString:zd,shuffle:i_,shuffleCombo:_Z,clamp:Ef,nearestLargerEven:DZ,swap:Od,sum:FZ,randUniform:RZ,distSquared:OZ,assert:G,assertShapesMatch:En,assertNonNull:Zs,flatten:Hs,sizeFromShape:ir,isScalarShape:PZ,arraysEqual:rs,isInt:El,tanh:MZ,sizeToSquarishShape:BZ,createShuffledIndices:LZ,rightPad:kf,repeatedTry:zZ,inferFromImplicitShape:$Z,parseAxisParam:Bf,squeezeShape:o_,getTypedArrayFromDType:s_,getArrayFromDType:u_,checkConversionForErrors:l_,isValidDtype:c_,hasEncodingLoss:WZ,isTypedArray:gn,bytesPerElement:t0,bytesFromStringArray:f_,isString:Yo,isBoolean:h_,isNumber:p_,inferDtype:jd,isFunction:Qo,nearestDivisor:Pd,computeStrides:_l,toNestedArray:bl,makeOnesTypedArray:T0,makeZerosTypedArray:Xd,makeZerosNestedTypedArray:qZ,assertNonNegativeIntegerDimensions:I0,locToIndex:VZ,indexToLoc:GZ,isPromise:C0,hexToLong:Lf,fingerPrint64:EJ},_J=function(){function r(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new FJ)}return r.prototype.profileKernel=function(e,t,n){var a,i,o,s=function(){o=n()},u,l=If();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var c=On(o),f=c.next();!f.done;f=c.next()){var h=f.value;h.dataSync()}}catch(v){a={error:v}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:If()-l})}if(It().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var p=function(v){var g=o[v];g.data().then(function(y){DJ(y,g.dtype,e)})},d=0;d<o.length;d++)p(d);var m={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(v){return v.kernelMs}),extraInfo:u.then(function(v){return v.getExtraProfileInfo!=null?v.getExtraProfileInfo():""})};return m},r.prototype.logKernelProfile=function(e){var t=this,n=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(l){t.logger.logKernelProfile(n,u,l[0],l[1],o,l[2])})})},r}();function DJ(r,e,t){if(e!=="float32")return!1;for(var n=0;n<r.length;n++){var a=r[n];if(isNaN(a)||!isFinite(a))return console.warn("Found "+a+" in the result of '"+t+"'"),!0}return!1}var FJ=function(){function r(){}return r.prototype.logKernelProfile=function(e,t,n,a,i,o){var s=typeof a=="number"?kf(a+"ms",9):a.error,u=kf(e,25),l=t.rank,c=t.size,f=kf(t.shape.toString(),14),h="";for(var p in i){var d=i[p];if(d!=null){var m=d.shape||t.shape,v=m.length;h+=p+": "+v+"D "+(v>0?m:"")+" "}}console.log("%c"+u+"	%c"+s+"	%c"+l+"D "+f+"	%c"+c+"	%c"+h+"	%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r}();function RJ(r,e,t){for(var n={},a={},i=0;i<e.length;i++)n[e[i].id]=!0;for(var i=0;i<r.length;i++){var o=r[i],s=o.inputs;for(var u in s){for(var l=s[u],c=!1,f=0;f<e.length;f++)if(n[l.id]){o.outputs.forEach(function(b){return n[b.id]=!0}),c=!0,a[o.id]=!0;break}if(c)break}}var h={};h[t.id]=!0;for(var p={},i=r.length-1;i>=0;i--)for(var o=r[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,p[o.id]=!0;break}for(var d=[],i=0;i<r.length;i++){var o=r[i];if(a[o.id]&&p[o.id]){var m={};for(var u in o.inputs){var v=o.inputs[u];n[v.id]&&(m[u]=v)}var g=Object.assign({},o);g.inputs=m,g.outputs=o.outputs,d.push(g)}}return d}function OJ(r,e,t,n){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var p=r[h.id];p!=null?u.push(p):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+("for "+s.kernelName+"."));var l=s.gradient(u),c=function(h){if(!(h in l))throw new Error("Cannot backprop through input "+h+". "+("Available gradients found: "+Object.keys(l)+"."));var p=t(function(){return l[h]()});if(p.dtype!=="float32")throw new Error("Error in gradient for op "+s.kernelName+". The gradient of input "+(h+" must have 'float32' dtype, but has '"+p.dtype+"'"));var d=s.inputs[h];if(!rs(p.shape,d.shape))throw new Error("Error in gradient for op "+s.kernelName+". The gradient of input "+("'"+h+"' has shape '"+p.shape+"', which does not match ")+("the shape of the input '"+d.shape+"'"));if(r[d.id]==null)r[d.id]=p;else{var m=r[d.id];r[d.id]=n(m,p),m.dispose()}};for(var f in s.inputs)c(f)},i=e.length-1;i>=0;i--)a(i)}var HA=20,bf=3,Xy=7;function PJ(r,e,t,n){var a=_l(e),i=MJ(r,e,t,a),o=e.length,s=Dd(r,e,t,a,i),u=["Tensor"];return n&&(u.push("  dtype: "+t),u.push("  rank: "+o),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map(function(l){return"    "+l}).join(`
`)),u.join(`
`)}function MJ(r,e,t,n){var a=ir(e),i=n[n.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?xf(r):r;if(s>1)for(var l=0;l<a/i;l++)for(var c=l*i,f=0;f<i;f++)o[f]=Math.max(o[f],wf(u[c+f],0,t).length);return o}function wf(r,e,t){var n;return Array.isArray(r)?n=parseFloat(r[0].toFixed(Xy))+" + "+(parseFloat(r[1].toFixed(Xy))+"j"):Yo(r)?n="'"+r+"'":t==="bool"?n=lF(r):n=parseFloat(r.toFixed(Xy)).toString(),kf(n,e)}function lF(r){return r===0?"false":"true"}function Dd(r,e,t,n,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var l=xf(r);return[wf(l[0],0,t)]}return t==="bool"?[lF(r[0])]:[r[0].toString()]}if(u===1){if(s>HA){var c=bf*o,f=Array.from(r.slice(0,c)),h=Array.from(r.slice((s-bf)*o,s*o));return t==="complex64"&&(f=xf(f),h=xf(h)),["["+f.map(function(N,T){return wf(N,a[T],t)}).join(", ")+", ..., "+h.map(function(N,T){return wf(N,a[s-bf+T],t)}).join(", ")+"]"]}var p=t==="complex64"?xf(r):Array.from(r);return["["+p.map(function(N,T){return wf(N,a[T],t)}).join(", ")+"]"]}var d=e.slice(1),m=n.slice(1),v=n[0]*o,g=[];if(s>HA){for(var y=0;y<bf;y++){var b=y*v,w=b+v;g.push.apply(g,Lt(Dd(r.slice(b,w),d,t,m,a,!1)))}g.push("...");for(var y=s-bf;y<s;y++){var b=y*v,w=b+v;g.push.apply(g,Lt(Dd(r.slice(b,w),d,t,m,a,y===s-1)))}}else for(var y=0;y<s;y++){var b=y*v,w=b+v;g.push.apply(g,Lt(Dd(r.slice(b,w),d,t,m,a,y===s-1)))}var x=u===2?",":"";g[0]="["+g[0]+x;for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+x;for(var k=`,
`,y=2;y<u;y++)k+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":k),g}function xf(r){for(var e=[],t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var $d=function(){function r(e,t,n){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=ir(e),n!=null){var i=n.length;G(i===this.size,function(){return"Length of values '"+i+"' does not match the size "+("inferred by the shape '"+a.size+"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||u_(t,this.size),this.strides=_l(e)}return r.prototype.set=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];n.length===0&&(n=[0]),G(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must "+("match the rank ("+t.rank+")")});var i=this.locToIndex(n);this.values[i]=e},r.prototype.get=function(){for(var e,t,n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];n.length===0&&(n=[0]);var i=0;try{for(var o=On(n),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var l="Requested out of range element at "+n+". "+("  Buffer shape="+this.shape);throw new Error(l)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var c=n[n.length-1],f=0;f<n.length-1;++f)c+=this.strides[f]*n[f];return this.values[c]},r.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},r.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.toTensor=function(){return vi().makeTensor(this.values,this.shape,this.dtype)},r}(),vi=null,ml=null;function BJ(r){vi=r}function LJ(r){ml=r}var Gr=function(){function r(e,t,n,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=ir(e),this.strides=_l(e),this.dataId=n,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.buffer=function(){return Ke(this,void 0,void 0,function(){var e;return je(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,ml.buffer(this.shape,this.dtype,e)]}})})},r.prototype.bufferSync=function(){return ml.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return Ke(this,void 0,void 0,function(){var e;return je(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,bl(this.shape,e,this.dtype==="complex64")]}})})},r.prototype.arraySync=function(){return bl(this.shape,this.dataSync(),this.dtype==="complex64")},r.prototype.data=function(){return Ke(this,void 0,void 0,function(){var e,t;return je(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=vi().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(a){return zd(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}})})},r.prototype.dataToGPU=function(e){return this.throwIfDisposed(),vi().readToGPU(this.dataId,e)},r.prototype.dataSync=function(){this.throwIfDisposed();var e=vi().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return zd(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},r.prototype.bytes=function(){return Ke(this,void 0,void 0,function(){var e;return je(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,vi().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(vi().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.print=function(e){return e===void 0&&(e=!1),ml.print(this,e)},r.prototype.clone=function(){return this.throwIfDisposed(),ml.clone(this)},r.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return PJ(t,this.shape,this.dtype,e)},r.prototype.cast=function(e){return this.throwIfDisposed(),ml.cast(this,e)},r.prototype.variable=function(e,t,n){return e===void 0&&(e=!0),this.throwIfDisposed(),vi().makeVariable(this,e,t,n)},r}();Object.defineProperty(Gr,Symbol.hasInstance,{value:function(r){return!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null}});function zJ(){return A0("Tensor",function(){return Gr})}zJ();var Cf=function(r){vo(e,r);function e(t,n,a,i){var o=r.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=n,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and "+("previous value ("+this.dtype+") must match"));if(!rs(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and "+("previous value ("+this.shape+") must match"));vi().disposeTensor(this),this.dataId=t.dataId,vi().incRef(this,null)},e.prototype.dispose=function(){vi().disposeVariable(this),this.isDisposedInternal=!0},e}(Gr);Object.defineProperty(Cf,Symbol.hasInstance,{value:function(r){return r instanceof Gr&&r.assign!=null&&r.assign instanceof Function}});A.Rank=void 0;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(A.Rank||(A.Rank={}));var c0;(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(c0||(c0={}));var f0;(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(f0||(f0={}));var h0;(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(h0||(h0={}));var p0;(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(p0||(p0={}));var $J={float32:h0,int32:c0,bool:f0,complex64:p0};function Zd(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error("Can not upcast "+r+" with "+e)}return $J[r][e]}function WJ(r){return Zd(r,"int32")}function Ir(r,e){if(r.dtype===e.dtype)return[r,e];var t=Zd(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function cF(r,e){G(r.dtype===e.dtype,function(){return"The dtypes of the first("+r.dtype+") and"+(" second("+e.dtype+") input must match")})}function qJ(r,e){return e.some(function(t){return t.id===r.id})}function M0(r){var e=[],t=new Set;return fF(r,e,t),e}function fF(r,e,t){if(r!=null){if(r instanceof Gr){e.push(r);return}if(!!VJ(r)){var n=r;for(var a in n){var i=n[a];t.has(i)||(t.add(i),fF(i,e,t))}}}}function VJ(r){return Array.isArray(r)||typeof r=="object"}var GJ={__proto__:null,makeTypesMatch:Ir,assertTypesMatch:cF,isTensorInList:qJ,getTensorsInContainer:M0};function Yy(r){return r.kernelName!=null}var KA=function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return r.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},r}(),B0=function(){function r(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new KA}return r.prototype.ready=function(){return Ke(this,void 0,void 0,function(){var e,t,n,a;return je(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(n)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,n=e.asyncInit;if(n)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},r.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},r.prototype.registerBackend=function(e,t,n){return n===void 0&&(n=1),e in this.registryFactory?(Xo(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},r.prototype.setBackend=function(e){return Ke(this,void 0,void 0,function(){var t,n,a,i,o;return je(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,a=t.asyncInit,a?[4,n]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=n,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new _J(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var e=this,t=Bd(this.backendName);t.forEach(function(n){n.setupFunc!=null&&n.setupFunc(e.backendInstance)})},r.prototype.disposeRegisteredKernels=function(e){var t=this,n=Bd(e);n.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},r.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(n==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var a=n.factory();if(a&&!(a instanceof a_)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,Xo("Initialization of backend "+e+" failed"),Xo(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return Xo("Initialization of backend "+e+" failed"),Xo(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],a=this.initializeBackend(n),i=a.success,o=a.asyncInit;if(o||i)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),a=n.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(e,t){var n=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return n.startScope(a)},function(){return n.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},r.prototype.scopedRun=function(e,t,n){e();try{var a=n();return t(),a}catch(i){throw t(),i}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(e){var t=Q.runKernel(F0,{x:e}),n={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},l={dtype:s};return Q.runKernel(D0,u,l)}}},i=[];return this.addTapeNode(this.state.activeScope.name,n,[t],a,i,{}),t},r.prototype.runKernel=function(e,t,n){this.backendName==null&&this.backend;var a=Md(e,this.backendName)!=null;if(!a)throw new Error("Kernel '"+e+"' not registered for backend '"+this.backendName+"'");return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(e,t,n){var a=this.backend.numDataIds(),i=0;n.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak "+("("+s+" data ids) after running '"+e+"'"))},r.prototype.runKernelFunc=function(e){var t=this,n,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var l,c=Yy(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Yy(e)){var f=e.kernelName,h=e.inputs,p=e.attrs;this.backendName==null&&this.backend;var d=Md(f,this.backendName);G(d!=null,function(){return"Cannot find registered kernel '"+f+"' for backend '"+t.backendName+"'"}),u=function(){var x=t.backend.numDataIds();l=d.kernelFunc({inputs:h,attrs:p,backend:t.backend});var k=Array.isArray(l)?l:[l];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,x,k);var N=k.map(function(I){return I.rank!=null?I:t.makeTensorFromTensorInfo(I)});if(i){var T=t.getTensorsForGradient(f,h,N);a=t.saveTensorsForBackwardMode(T)}return N}}else{var m=e.forwardFunc,v=function(x){!i||(a=x.map(function(k){return t.keep(t.clone(k))}))};u=function(){var x=t.backend.numDataIds();l=t.tidy(function(){return m(t.backend,v)});var k=Array.isArray(l)?l:[l];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(c,x,k),k}}var g=e.inputs,y=e.attrs,b=Yy(e)?null:e.backwardsFunc,w;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?n=u():(w=t.profiler.profileKernel(c,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(w),n=w.outputs)}),i&&this.addTapeNode(c,g,n,b,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(x){return g[x]!=null?g[x].shape:null}),outputShapes:n.map(function(x){return x.shape}),kernelTimeMs:w.timeMs,extraInfo:w.extraInfo}),Array.isArray(l)?n:n[0]},r.prototype.saveTensorsForBackwardMode=function(e){var t=this,n=e.map(function(a){return t.keep(t.clone(a))});return n},r.prototype.getTensorsForGradient=function(e,t,n){var a=o0(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(G(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(l){return t[l]})):s=i.map(function(l){return t[l]});var u=n.filter(function(l,c){return o[c]});return s.concat(u)}return[]},r.prototype.makeTensor=function(e,t,n,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",a=a||this.backend;var i=e;n==="string"&&Yo(e[0])&&(i=e.map(function(c){return zf(c)}));var o=a.write(i,t,n),s=new Gr(t,n,o,this.nextTensorId());if(this.trackTensor(s,a),n==="string"){var u=this.state.tensorInfo.get(o),l=f_(i);this.state.numBytes+=l-u.bytes,u.bytes=l}return s},r.prototype.makeTensorFromDataId=function(e,t,n,a){n=n||"float32";var i={dataId:e,shape:t,dtype:n};return this.makeTensorFromTensorInfo(i,a)},r.prototype.makeTensorFromTensorInfo=function(e,t){var n=e.dataId,a=e.shape,i=e.dtype,o=new Gr(a,i,n,this.nextTensorId());return this.trackTensor(o,t),o},r.prototype.makeVariable=function(e,t,n,a){t===void 0&&(t=!0),n=n||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new Cf(e,t,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},r.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*t0(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof Cf||this.track(e)},r.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},r.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},r.prototype.disposeTensor=function(e){if(!!this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var n=e.size*t0(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},r.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},r.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},r.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},r.prototype.profile=function(e){return Ke(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c,f,h;return je(this,function(p){switch(p.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=p.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,Lt(this.state.activeProfile.kernels.map(function(d){return d.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,p.label=2;case 2:p.trys.push([2,8,9,10]),i=On(this.state.activeProfile.kernels),o=i.next(),p.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=p.sent(),l=s,[4,s.extraInfo];case 5:l.extraInfo=p.sent(),p.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return c=p.sent(),f={error:c},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(e,t,n,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},l=o0(e);l!=null&&(a=l.gradFunc),a!=null&&(u.gradient=function(c){return c=c.map(function(f,h){if(f==null){var p=n[h],d=Xd(p.size,p.dtype);return s.makeTensor(d,p.shape,p.dtype)}return f}),a(c.length>1?c:c[0],i,o)}),this.state.activeTape.push(u)},r.prototype.keep=function(e){return e.kept=!0,e},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(e){for(var t=this,n=M0(e),a=new Set(n.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},r.prototype.gradients=function(e,t,n,a){var i=this;if(a===void 0&&(a=!1),G(t.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});G(o instanceof Gr,function(){return"The result y returned by f() must be a tensor."});var s=RJ(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=n??UJ(o.shape),OJ(u,s,function(c){return i.tidy(c)},HJ);var l=t.map(function(c){return u[c.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(c){var f,h;try{for(var p=On(c.saved),d=p.next();!d.done;d=p.next()){var m=d.value;m.dispose()}}catch(v){f={error:v}}finally{try{d&&!d.done&&(h=p.return)&&h.call(p)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:l}})},r.prototype.customGrad=function(e){var t=this;return G(Qo(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];G(n.every(function(l){return l instanceof Gr}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};n.forEach(function(l,c){o[c]=l});var s=function(l,c){return i=e.apply(void 0,Lt(n,[c])),G(i.value instanceof Gr,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),G(Qo(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(l,c){var f=i.gradFunc(l,c),h=Array.isArray(f)?f:[f];G(h.length===n.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),G(h.every(function(d){return d instanceof Gr}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return h.forEach(function(d,m){p[m]=function(){return d}}),p};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},r.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},r.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},r.prototype.readToGPU=function(e,t){var n=this.state.tensorInfo.get(e);return n.backend.readToGPU(e,t)},r.prototype.time=function(e){return Ke(this,void 0,void 0,function(){var t,n;return je(this,function(a){switch(a.label){case 0:return t=If(),[4,this.backend.time(e)];case 1:return n=a.sent(),n.wallMs=If()-t,[2,n]}})})},r.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),r.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new KA;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r}();B0.nextTensorId=0;B0.nextVariableId=0;function UJ(r){var e=T0(ir(r),"float32");return Q.makeTensor(e,r,"float32")}function hF(){var r=m_();if(r._tfengine==null){var e=new v_(r);r._tfengine=new B0(e)}return jZ(r._tfengine.ENV),BJ(function(){return r._tfengine}),r._tfengine}var Q=hF();function HJ(r,e){var t={a:r,b:e};return Q.runKernel(_0,t)}function KJ(){return typeof navigator<"u"&&navigator!=null}var d0;function jJ(r){d0=r}function XJ(r){if(d0!==void 0)return d0;if(r||KJ()){if(r||(r=navigator),r.product==="ReactNative")return!0;var e=r.userAgent||r.vendor||(typeof window<"u"?window.opera:"");if(!e){var t=r;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function pF(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var YJ={__proto__:null,mockIsMobile:jJ,isMobile:XJ,isBrowser:pF};var ta=It();ta.registerFlag("DEBUG",function(){return!1},function(r){r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});ta.registerFlag("IS_BROWSER",function(){return pF()});ta.registerFlag("IS_NODE",function(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"});ta.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)});ta.registerFlag("PROD",function(){return!1});ta.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return ta.getBool("DEBUG")});ta.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0});ta.registerFlag("IS_TEST",function(){return!1});ta.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",function(){return!0});ta.registerFlag("WRAP_TO_IMAGEBITMAP",function(){return!1});ta.registerFlag("ENGINE_COMPILE_ONLY",function(){return!1});ta.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",function(){return!1});ta.registerFlag("USE_SETTIMEOUTCUSTOM",function(){return!1});function Ui(r,e){var t=r;if(gn(r))return e==="string"?[]:[r.length];if(!Array.isArray(r))return[];for(var n=[];Array.isArray(t)||gn(t)&&e!=="string";)n.push(t.length),t=t[0];return Array.isArray(r)&&It().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&dF(r,n,[]),n}function dF(r,e,t){if(t=t||[],!Array.isArray(r)&&!gn(r)){G(e.length===0,function(){return"Element arr["+t.join("][")+"] is a primitive, "+("but should be an array/TypedArray of "+e[0]+" elements")});return}G(e.length>0,function(){return"Element arr["+t.join("][")+"] should be a primitive, "+("but is an array of "+r.length+" elements")}),G(r.length===e[0],function(){return"Element arr["+t.join("][")+"] should have "+e[0]+" "+("elements, but has "+r.length+" elements")});for(var n=e.slice(1),a=0;a<r.length;++a)dF(r[a],n,t.concat(a))}function jA(r,e,t,n){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==e||r==="numeric"&&e==="string")throw new Error("Argument '"+t+"' passed to '"+n+"' must "+("be "+r+" tensor, but got "+e+" tensor"))}}function L(r,e,t,n){if(n===void 0&&(n="numeric"),r instanceof Gr)return jA(n,r.dtype,e,t),r;var a=jd(r);if(a!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(a=n),jA(n,a,e,t),r==null||!gn(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var i=r==null?"null":r.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a "+("Tensor or TensorLike, but got '"+i+"'"))}var o=Ui(r,a);!gn(r)&&!Array.isArray(r)&&(r=[r]);var s=!0,u=a!=="string"?Yd(r,a):Hs(r,[],s);return Q.makeTensor(u,o,a)}function Af(r,e,t,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");var a=r;return a.map(function(i,o){return L(i,e+"["+o+"]",t,n)})}var vF="__op";function J(r){var e=Object.keys(r);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+(e.length+" keys."));var t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+vF;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];Q.startScope(t);try{var s=n.apply(void 0,Lt(i));return C0(s)&&console.error("Cannot return a Promise inside of tidy."),Q.endScope(s),s}catch(u){throw Q.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function ZJ(r,e){var t=L(r,"real","complex"),n=L(e,"imag","complex");En(t.shape,n.shape,"real and imag shapes, "+t.shape+" and "+n.shape+", must match in call to tf.complex().");var a={real:t,imag:n};return Q.runKernel(L_,a)}var es=J({complex_:ZJ});function ns(r,e,t,n){if(n==null&&(n=jd(r)),n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!gn(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){I0(e);var a=ir(e),i=ir(t);G(a===i,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+(a+" values but has "+i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==ir(e.slice(o)):!0;G(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+("("+t+") does not match the provided ")+("shape ("+e+"). ")})}}return!gn(r)&&!Array.isArray(r)&&(r=[r]),e=e||t,r=n!=="string"?Yd(r,n):Hs(r,[],!0),Q.makeTensor(r,e,n)}function wl(r,e,t){var n=Ui(r,t);return ns(r,e,n,t)}var v0={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},Wd=4;function JJ(r,e){return Ke(this,void 0,void 0,function(){var t,n,a,i,o,s,u=this;return je(this,function(l){switch(l.label){case 0:for(t=[],n=[],a=Array.isArray(r)?r.map(function(c){return c.name}):Object.keys(r),i=function(c){var f=a[c],h=Array.isArray(r)?r[c].tensor:r[f];if(h.dtype!=="float32"&&h.dtype!=="int32"&&h.dtype!=="bool"&&h.dtype!=="string"&&h.dtype!=="complex64")throw new Error("Unsupported dtype in weight '"+f+"': "+h.dtype);var p={name:f,shape:h.shape,dtype:h.dtype};if(h.dtype==="string"){var d=new Promise(function(m){return Ke(u,void 0,void 0,function(){var v,g,y,b,w,x,k;return je(this,function(N){switch(N.label){case 0:return[4,h.bytes()];case 1:for(v=N.sent(),g=v.reduce(function(T,I){return T+I.length},0)+Wd*v.length,y=new Uint8Array(g),b=0,w=0;w<v.length;w++)x=v[w],k=new Uint8Array(new Uint32Array([x.length]).buffer),y.set(k,b),b+=Wd,y.set(x,b),b+=x.length;return m(y),[2]}})})});n.push(d)}else n.push(h.data());e!=null&&(p.group=e),t.push(p)},o=0;o<a.length;++o)i(o);return[4,Promise.all(n)];case 1:return s=l.sent(),[2,{data:QJ(s),specs:t}]}})})}function mF(r,e){var t,n,a={},i,o=0;try{for(var s=On(e),u=s.next();!u.done;u=s.next()){var l=u.value,c=l.name,f=l.dtype,h=l.shape,p=ir(h),d=void 0;if("quantization"in l){var m=l.quantization;if(m.dtype==="uint8"||m.dtype==="uint16"){if(!("min"in m&&"scale"in m))throw new Error("Weight "+l.name+" with quantization "+m.dtype+" doesn't have corresponding metadata min and scale.")}else if(m.dtype==="float16"){if(f!=="float32")throw new Error("Weight "+l.name+" is quantized with "+m.dtype+" "+("which only supports weights of type float32 not "+f+"."))}else throw new Error("Weight "+l.name+" has unknown "+("quantization dtype "+m.dtype+". ")+"Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.");var v=v0[m.dtype],g=r.slice(o,o+p*v),y=m.dtype==="uint8"?new Uint8Array(g):new Uint16Array(g);if(f==="float32")if(m.dtype==="uint8"||m.dtype==="uint16"){d=new Float32Array(y.length);for(var b=0;b<y.length;b++){var w=y[b];d[b]=w*m.scale+m.min}}else if(m.dtype==="float16")i===void 0&&(i=iQ()),d=i(y);else throw new Error("Unsupported quantization type "+m.dtype+" for weight type float32.");else if(f==="int32"){if(m.dtype!=="uint8"&&m.dtype!=="uint16")throw new Error("Unsupported quantization type "+m.dtype+" for weight type int32.");d=new Int32Array(y.length);for(var b=0;b<y.length;b++){var w=y[b];d[b]=Math.round(w*m.scale+m.min)}}else throw new Error("Unsupported dtype in weight '"+c+"': "+f);o+=p*v}else if(f==="string"){var x=ir(l.shape);d=[];for(var b=0;b<x;b++){var k=new Uint32Array(r.slice(o,o+Wd))[0];o+=Wd;var N=new Uint8Array(r.slice(o,o+k));d.push(N),o+=k}}else{var T=v0[f],g=r.slice(o,o+p*T);if(f==="float32")d=new Float32Array(g);else if(f==="int32")d=new Int32Array(g);else if(f==="bool")d=new Uint8Array(g);else if(f==="complex64"){d=new Float32Array(g);for(var I=new Float32Array(d.length/2),F=new Float32Array(d.length/2),b=0;b<I.length;b++)I[b]=d[b*2],F[b]=d[b*2+1];var D=wl(I,h,"float32"),R=wl(F,h,"float32");a[c]=es(D,R),D.dispose(),R.dispose()}else throw new Error("Unsupported dtype in weight '"+c+"': "+f);o+=p*T}f!=="complex64"&&(a[c]=wl(d,h,f))}}catch(P){t={error:P}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return a}function QJ(r){if(r===null)throw new Error("Invalid input value: "+JSON.stringify(r));var e=0,t=[];r.forEach(function(i){if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+i.constructor.name)});var n=new Uint8Array(e),a=0;return t.forEach(function(i){n.set(new Uint8Array(i.buffer),a),a+=i.byteLength}),n.buffer}var L0=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function XA(r){return L0?Buffer.byteLength(r):new Blob([r]).size}function eQ(r){if(L0)return Buffer.from(r).toString("base64");for(var e=new Uint8Array(r),t="",n=0,a=e.length;n<a;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function tQ(r){if(L0){var e=Buffer.from(r,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var t=atob(r),n=new Uint8Array(t.length),a=0;a<t.length;++a)n.set([t.charCodeAt(a)],a);return n.buffer}function z0(r){if(r.length===1)return r[0];var e=0;r.forEach(function(a){e+=a.byteLength});var t=new Uint8Array(e),n=0;return r.forEach(function(a){t.set(new Uint8Array(a),n),n+=a.byteLength}),t.buffer}function YA(r){var e="/";for(r=r.trim();r.endsWith(e);)r=r.slice(0,r.length-1);var t=r.split(e);return t[t.length-1]}function gF(r,e){var t={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy,weightsManifest:e};return r.signature!=null&&(t.signature=r.signature),r.userDefinedMetadata!=null&&(t.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(t.modelInitializer=r.modelInitializer),r.trainingConfig!=null&&(t.trainingConfig=r.trainingConfig),t}function yF(r,e,t){var n={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy};if(r.trainingConfig!=null&&(n.trainingConfig=r.trainingConfig),r.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");n.weightSpecs=e,n.weightData=t}return r.signature!=null&&(n.signature=r.signature),r.userDefinedMetadata!=null&&(n.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(n.modelInitializer=r.modelInitializer),n}function $0(r,e){return Ke(this,void 0,void 0,function(){var t,n,a;return je(this,function(i){switch(i.label){case 0:return r.weightsManifest==null?[3,2]:[4,e(r.weightsManifest)];case 1:a=Ge.apply(void 0,[i.sent(),2]),t=a[0],n=a[1],i.label=2;case 2:return[2,yF(r,t,n)]}})})}function $f(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:XA(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:XA(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:r.weightData.byteLength}}function bF(r){var e,t,n=[];try{for(var a=On(r),i=a.next();!i.done;i=a.next()){var o=i.value;n.push.apply(n,Lt(o.weights))}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}function rQ(){var r=function(n){for(var a=n<<13,i=0;(a&8388608)===0;)i-=8388608,a<<=1;return a&=-8388609,i+=947912704,a|i},e=new Uint32Array(2048);e[0]=0;for(var t=1;t<1024;t++)e[t]=r(t);for(var t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function nQ(){var r=new Uint32Array(64);r[0]=0,r[31]=1199570944,r[32]=2147483648,r[63]=3347054592;for(var e=1;e<31;e++)r[e]=e<<23;for(var e=33;e<63;e++)r[e]=2147483648+(e-32<<23);return r}function aQ(){for(var r=new Uint32Array(64),e=0;e<64;e++)r[e]=1024;return r[0]=r[32]=0,r}function iQ(){var r=rQ(),e=nQ(),t=aQ();return function(n){for(var a=new ArrayBuffer(4*n.length),i=new Uint32Array(a),o=0;o<n.length;o++){var s=n[o],u=r[t[s>>10]+(s&1023)]+e[s>>10];i[o]=u}return new Float32Array(a)}}var Ia=function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerSaveRouter=function(e){r.getInstance().saveRouters.push(e)},r.registerLoadRouter=function(e){r.getInstance().loadRouters.push(e)},r.getSaveHandlers=function(e){return r.getHandlers(e,"save")},r.getLoadHandlers=function(e,t){return r.getHandlers(e,"load",t)},r.getHandlers=function(e,t,n){var a=[],i=t==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters;return i.forEach(function(o){var s=o(e,n);s!==null&&a.push(s)}),a},r}(),oQ=function(r){return Ia.registerSaveRouter(r)},sQ=function(r){return Ia.registerLoadRouter(r)},uQ=function(r){return Ia.getSaveHandlers(r)},lQ=function(r,e){return Ia.getLoadHandlers(r,e)},m0="tensorflowjs",g0=1,qs="models_store",Zo="model_info_store";function wF(){if(!It().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=typeof window>"u"?self:window,e=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function y0(r){var e=r.result;e.createObjectStore(qs,{keyPath:"modelPath"}),e.createObjectStore(Zo,{keyPath:"modelPath"})}var Ks=function(){function r(e){if(this.indexedDB=wF(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return r.prototype.save=function(e){return Ke(this,void 0,void 0,function(){return je(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},r.prototype.load=function(){return Ke(this,void 0,void 0,function(){return je(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},r.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(a,i){var o=n.indexedDB.open(m0,g0);o.onupgradeneeded=function(){return y0(o)},o.onsuccess=function(){var s=o.result;if(t==null){var u=s.transaction(qs,"readonly"),l=u.objectStore(qs),c=l.get(n.modelPath);c.onsuccess=function(){if(c.result==null)return s.close(),i(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));a(c.result.modelArtifacts)},c.onerror=function(v){return s.close(),i(c.error)},u.oncomplete=function(){return s.close()}}else{var f=$f(t),h=s.transaction(Zo,"readwrite"),p=h.objectStore(Zo),d=p.put({modelPath:n.modelPath,modelArtifactsInfo:f}),m;d.onsuccess=function(){m=s.transaction(qs,"readwrite");var v=m.objectStore(qs),g=v.put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:f});g.onsuccess=function(){return a({modelArtifactsInfo:f})},g.onerror=function(y){p=h.objectStore(Zo);var b=p.delete(n.modelPath);b.onsuccess=function(){return s.close(),i(g.error)},b.onerror=function(w){return s.close(),i(g.error)}}},d.onerror=function(v){return s.close(),i(d.error)},h.oncomplete=function(){m==null?s.close():m.oncomplete=function(){return s.close()}}}},o.onerror=function(s){return i(o.error)}})},r}();Ks.URL_SCHEME="indexeddb://";var xF=function(r){return It().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Ks.URL_SCHEME)?cQ(r.slice(Ks.URL_SCHEME.length)):null};Ia.registerSaveRouter(xF);Ia.registerLoadRouter(xF);function cQ(r){return new Ks(r)}function fQ(r){return r.startsWith(Ks.URL_SCHEME)?r.slice(Ks.URL_SCHEME.length):r}var hQ=function(){function r(){this.indexedDB=wF()}return r.prototype.listModels=function(){return Ke(this,void 0,void 0,function(){var e=this;return je(this,function(t){return[2,new Promise(function(n,a){var i=e.indexedDB.open(m0,g0);i.onupgradeneeded=function(){return y0(i)},i.onsuccess=function(){var o=i.result,s=o.transaction(Zo,"readonly"),u=s.objectStore(Zo),l=u.getAll();l.onsuccess=function(){var c,f,h={};try{for(var p=On(l.result),d=p.next();!d.done;d=p.next()){var m=d.value;h[m.modelPath]=m.modelArtifactsInfo}}catch(v){c={error:v}}finally{try{d&&!d.done&&(f=p.return)&&f.call(p)}finally{if(c)throw c.error}}n(h)},l.onerror=function(c){return o.close(),a(l.error)},s.oncomplete=function(){return o.close()}},i.onerror=function(o){return a(i.error)}})]})})},r.prototype.removeModel=function(e){return Ke(this,void 0,void 0,function(){var t=this;return je(this,function(n){return e=fQ(e),[2,new Promise(function(a,i){var o=t.indexedDB.open(m0,g0);o.onupgradeneeded=function(){return y0(o)},o.onsuccess=function(){var s=o.result,u=s.transaction(Zo,"readwrite"),l=u.objectStore(Zo),c=l.get(e),f;c.onsuccess=function(){if(c.result==null)return s.close(),i(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var h=l.delete(e),p=function(){f=s.transaction(qs,"readwrite");var d=f.objectStore(qs),m=d.delete(e);m.onsuccess=function(){return a(c.result.modelArtifactsInfo)},m.onerror=function(v){return i(c.error)}};h.onsuccess=p,h.onerror=function(d){return p(),s.close(),i(c.error)}},c.onerror=function(h){return s.close(),i(c.error)},u.oncomplete=function(){f==null?s.close():f.oncomplete=function(){return s.close()}}},o.onerror=function(s){return i(o.error)}})]})})},r}(),co="/",gl="tensorflowjs_models",kF="info",pQ="model_topology",dQ="weight_specs",vQ="weight_data",mQ="model_metadata";function SF(r){return{info:[gl,r,kF].join(co),topology:[gl,r,pQ].join(co),weightSpecs:[gl,r,dQ].join(co),weightData:[gl,r,vQ].join(co),modelMetadata:[gl,r,mQ].join(co)}}function NF(r){var e,t;try{for(var n=On(Object.values(r)),a=n.next();!a.done;a=n.next()){var i=a.value;window.localStorage.removeItem(i)}}catch(o){e={error:o}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}}function gQ(r){var e=r.split(co);if(e.length<3)throw new Error("Invalid key format: "+r);return e.slice(1,e.length-1).join(co)}function yQ(r){return r.startsWith(js.URL_SCHEME)?r.slice(js.URL_SCHEME.length):r}var js=function(){function r(e){if(!It().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=SF(this.modelPath)}return r.prototype.save=function(e){return Ke(this,void 0,void 0,function(){var t,n,a,i;return je(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),a=$f(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,eQ(e.weightData)),i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),[2,{modelArtifactsInfo:a}]}catch{throw NF(this.keys),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: "+("modelTopologyBytes="+a.modelTopologyBytes+", ")+("weightSpecsBytes="+a.weightSpecsBytes+", ")+("weightDataBytes="+a.weightDataBytes+"."))}return[2]})})},r.prototype.load=function(){return Ke(this,void 0,void 0,function(){var e,t,n,a,i,o,s;return je(this,function(u){if(e=JSON.parse(this.LS.getItem(this.keys.info)),e==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},n=JSON.parse(this.LS.getItem(this.keys.topology)),n==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)),a==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=a,i=this.LS.getItem(this.keys.modelMetadata),i!=null&&(o=JSON.parse(i),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,o.signature!=null&&(t.signature=o.signature),o.userDefinedMetadata!=null&&(t.userDefinedMetadata=o.userDefinedMetadata),o.modelInitializer!=null&&(t.modelInitializer=o.modelInitializer),o.trainingConfig!=null&&(t.trainingConfig=o.trainingConfig)),s=this.LS.getItem(this.keys.weightData),s==null)throw new Error("In local storage, the binary weight values of model "+("'"+this.modelPath+"' are missing."));return t.weightData=tQ(s),[2,t]})})},r}();js.URL_SCHEME="localstorage://";var EF=function(r){return It().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(js.URL_SCHEME)?bQ(r.slice(js.URL_SCHEME.length)):null};Ia.registerSaveRouter(EF);Ia.registerLoadRouter(EF);function bQ(r){return new js(r)}var wQ=function(){function r(){G(It().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),G(typeof window>"u"||typeof window.localStorage<"u",function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return r.prototype.listModels=function(){return Ke(this,void 0,void 0,function(){var e,t,n,a,i,o;return je(this,function(s){for(e={},t=gl+co,n=co+kF,a=0;a<this.LS.length;++a)i=this.LS.key(a),i.startsWith(t)&&i.endsWith(n)&&(o=gQ(i),e[o]=JSON.parse(this.LS.getItem(i)));return[2,e]})})},r.prototype.removeModel=function(e){return Ke(this,void 0,void 0,function(){var t,n;return je(this,function(a){if(e=yQ(e),t=SF(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),NF(t),[2,n]})})},r}(),xl="://",ts=function(){function r(){this.managers={}}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerManager=function(e,t){G(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(xl)&&(e=e.slice(0,e.indexOf(xl))),G(e.length>0,function(){return"scheme must not be an empty string."});var n=r.getInstance();G(n.managers[e]==null,function(){return"A model store manager is already registered for scheme '"+e+"'."}),n.managers[e]=t},r.getManager=function(e){var t=r.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},r.getSchemes=function(){return Object.keys(r.getInstance().managers)},r}();function Fd(r){if(r.indexOf(xl)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+(""+ts.getSchemes().join(",")));return{scheme:r.split(xl)[0],path:r.split(xl)[1]}}function TF(r,e,t){return t===void 0&&(t=!1),Ke(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,f;return je(this,function(h){switch(h.label){case 0:return G(r!==e,function(){return"Old path and new path are the same: '"+r+"'"}),n=Ia.getLoadHandlers(r),G(n.length>0,function(){return"Copying failed because no load handler is found for source URL "+r+"."}),G(n.length<2,function(){return"Copying failed because more than one ("+n.length+") "+("load handlers for source URL "+r+".")}),a=n[0],i=Ia.getSaveHandlers(e),G(i.length>0,function(){return"Copying failed because no save handler is found for destination "+("URL "+e+".")}),G(i.length<2,function(){return"Copying failed because more than one ("+n.length+") "+("save handlers for destination URL "+e+".")}),o=i[0],s=Fd(r).scheme,u=Fd(r).path,l=s===Fd(r).scheme,[4,a.load()];case 1:return c=h.sent(),t&&l?[4,ts.getManager(s).removeModel(u)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[4,o.save(c)];case 4:return f=h.sent(),t&&!l?[4,ts.getManager(s).removeModel(u)]:[3,6];case 5:h.sent(),h.label=6;case 6:return[2,f.modelArtifactsInfo]}})})}function xQ(){return Ke(this,void 0,void 0,function(){var r,e,t,n,a,i,o,s,u,l,c;return je(this,function(f){switch(f.label){case 0:r=ts.getSchemes(),e={},f.label=1;case 1:f.trys.push([1,6,7,8]),t=On(r),n=t.next(),f.label=2;case 2:return n.done?[3,5]:(a=n.value,[4,ts.getManager(a).listModels()]);case 3:i=f.sent();for(o in i)s=a+xl+o,e[s]=i[o];f.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return u=f.sent(),l={error:u},[3,8];case 7:try{n&&!n.done&&(c=t.return)&&c.call(t)}finally{if(l)throw l.error}return[7];case 8:return[2,e]}})})}function kQ(r){return Ke(this,void 0,void 0,function(){var e,t;return je(this,function(n){return e=Fd(r),t=ts.getManager(e.scheme),[2,t.removeModel(e.path)]})})}function SQ(r,e){return Ke(this,void 0,void 0,function(){var t;return je(this,function(n){return t=!1,[2,TF(r,e,t)]})})}function NQ(r,e){return Ke(this,void 0,void 0,function(){var t;return je(this,function(n){return t=!0,[2,TF(r,e,t)]})})}var EQ=function(){function r(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}return r.prototype.fetch=function(e,t){return fetch(e,t)},r.prototype.now=function(){return performance.now()},r.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+t);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},r.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},r.prototype.setTimeoutCustom=function(e,t){var n=this;if(!window||!It().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(function(){window.postMessage({name:n.messageName,index:n.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",function(a){if(a.source===window&&a.data.name===n.messageName){a.stopPropagation();var i=n.functionRefs[a.data.index];i(),n.handledMessageCount++,n.handledMessageCount===n.functionRefs.length&&(n.functionRefs=[],n.handledMessageCount=0)}},!0))},r}();if(It().get("IS_BROWSER")){It().setPlatform("browser",new EQ);try{ts.registerManager(js.URL_SCHEME,new wQ)}catch{}try{ts.registerManager(Ks.URL_SCHEME,new hQ)}catch{}}var TQ={importFetch:function(){return BA()}},Zy,IQ=function(){function r(){this.util=LA(),this.textEncoder=new this.util.TextEncoder}return r.prototype.fetch=function(e,t){return It().global.fetch!=null?It().global.fetch(e,t):(Zy==null&&(Zy=TQ.importFetch()),Zy(e,t))},r.prototype.now=function(){var e=process.hrtime();return e[0]*1e3+e[1]/1e6},r.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},r.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},r}();It().get("IS_NODE")&&!It().get("IS_BROWSER")&&It().setPlatform("node",new IQ);function ho(r,e,t){return e===void 0&&(e="float32"),e=e||"float32",I0(r),new $d(r,e,t)}function CQ(r,e){var t=L(r,"x","cast");if(!c_(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var n={x:t},a={dtype:e};return Q.runKernel(D0,n,a)}var Or=J({cast_:CQ});function AQ(r){var e=L(r,"x","clone","string_or_numeric"),t={x:e};return Q.runKernel(F0,t)}var Gs=J({clone_:AQ});function IF(r,e){e===void 0&&(e=!1),console.log(r.toString(e))}hF();var _Q={buffer:ho,cast:Or,clone:Gs,print:IF};LJ(_Q);var DQ="model",FQ=".json",RQ=".weights.bin";function ZA(r){return new Promise(function(e){return setTimeout(e)}).then(r)}var qd=function(){function r(e){if(!It().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(r.URL_SCHEME)&&(e=e.slice(r.URL_SCHEME.length)),(e==null||e.length===0)&&(e=DQ),this.modelJsonFileName=e+FQ,this.weightDataFileName=e+RQ}return r.prototype.save=function(e){return Ke(this,void 0,void 0,function(){var t,n,a,i,o,s;return je(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],a=gF(e,n),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),o=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor,o.download=this.modelJsonFileName,o.href=i,[4,ZA(function(){return o.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),e.weightData==null?[3,4]:(s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor,s.download=this.weightDataFileName,s.href=t,[4,ZA(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:$f(e)}]}})})},r}();qd.URL_SCHEME="downloads://";var OQ=function(){function r(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, "+("but received "+e));this.jsonFile=e[0],this.weightsFiles=e.slice(1)}return r.prototype.load=function(){return Ke(this,void 0,void 0,function(){var e=this;return je(this,function(t){return[2,new Promise(function(n,a){var i=new FileReader;i.onload=function(o){var s=JSON.parse(o.target.result),u=s.modelTopology;if(u==null){a(new Error("modelTopology field is missing from file "+e.jsonFile.name));return}var l=s.weightsManifest;if(l==null){a(new Error("weightManifest field is missing from file "+e.jsonFile.name));return}if(e.weightsFiles.length===0){n({modelTopology:u});return}var c=$0(s,function(f){return e.loadWeights(f)});n(c)},i.onerror=function(o){return a("Failed to read model topology and weights manifest JSON "+("from file '"+e.jsonFile.name+"'. BrowserFiles supports loading ")+"Keras-style tf.Model artifacts only.")},i.readAsText(e.jsonFile)})]})})},r.prototype.loadWeights=function(e){var t,n,a=this,i=[],o=[];try{for(var s=On(e),u=s.next();!u.done;u=s.next()){var l=u.value;i.push.apply(i,Lt(l.weights)),o.push.apply(o,Lt(l.paths))}}catch(h){t={error:h}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}var c=this.checkManifestAndWeightFiles(e),f=o.map(function(h){return a.loadWeightsFile(h,c[h])});return Promise.all(f).then(function(h){return[i,z0(h)]})},r.prototype.loadWeightsFile=function(e,t){return new Promise(function(n,a){var i=new FileReader;i.onload=function(o){var s=o.target.result;n(s)},i.onerror=function(o){return a("Failed to weights data from file of path '"+e+"'.")},i.readAsArrayBuffer(t)})},r.prototype.checkManifestAndWeightFiles=function(e){var t,n,a=this,i=[],o=this.weightsFiles.map(function(f){return YA(f.name)}),s={};try{for(var u=On(e),l=u.next();!l.done;l=u.next()){var c=l.value;c.paths.forEach(function(f){var h=YA(f);if(i.indexOf(h)!==-1)throw new Error("Duplicate file basename found in weights manifest: "+("'"+h+"'"));if(i.push(h),o.indexOf(h)===-1)throw new Error("Weight file with basename '"+h+"' is not provided.");s[f]=a.weightsFiles[o.indexOf(h)]})}}catch(f){t={error:f}}finally{try{l&&!l.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}if(i.length!==this.weightsFiles.length)throw new Error("Mismatch in the number of files in weights manifest "+("("+i.length+") and the number of weight files provided ")+("("+this.weightsFiles.length+")."));return s},r}(),PQ=function(r){return It().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(qd.URL_SCHEME)?MQ(r.slice(qd.URL_SCHEME.length)):null};Ia.registerSaveRouter(PQ);function MQ(r){return r===void 0&&(r="model"),new qd(r)}function BQ(r){return new OQ(r)}function JA(r,e,t,n){o(r),t=t??0,n=n??1,s(t,n);var a=0,i=function(u){return u.then(function(l){var c=t+ ++a/r.length*(n-t);return e(c),l}),u};function o(u){G(u!=null&&Array.isArray(u)&&u.length>0,function(){return"promises must be a none empty array"})}function s(u,l){G(u>=0&&u<=1,function(){return"Progress fraction must be in range [0, 1], but "+("got startFraction "+u)}),G(l>=0&&l<=1,function(){return"Progress fraction must be in range [0, 1], but "+("got endFraction "+l)}),G(l>=u,function(){return"startFraction must be no more than endFraction, but "+("got startFraction "+u+" and endFraction ")+(""+l)})}return Promise.all(r.map(i))}function CF(r,e){return Ke(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c,f,h;return je(this,function(p){switch(p.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?It().platform.fetch:e.fetchFunc,n=r.map(function(d){return t(d,e.requestInit,{isBinary:!0})}),a=0,i=.5,e.onProgress!=null?[3,2]:[4,Promise.all(n)];case 1:return s=p.sent(),[3,4];case 2:return[4,JA(n,e.onProgress,a,i)];case 3:s=p.sent(),p.label=4;case 4:return o=s,u=o.map(function(d){return d.arrayBuffer()}),l=.5,c=1,e.onProgress!=null?[3,6]:[4,Promise.all(u)];case 5:return h=p.sent(),[3,8];case 6:return[4,JA(u,e.onProgress,l,c)];case 7:h=p.sent(),p.label=8;case 8:return f=h,[2,f]}})})}function LQ(r,e,t,n){return e===void 0&&(e=""),Ke(this,void 0,void 0,function(){var a,i;return je(this,function(o){return a=function(s){return CF(s,{requestInit:n})},i=AF(a),[2,i(r,e,t)]})})}function AF(r){var e=this;return function(t,n,a){return n===void 0&&(n=""),Ke(e,void 0,void 0,function(){var i,o,s,u,l,c,f,h,p,d;return je(this,function(m){switch(m.label){case 0:if(i=t.map(function(){return!1}),o={},s=a!=null?a.map(function(){return!1}):[],u=[],t.forEach(function(v,g){var y=0;v.weights.forEach(function(b){var w="quantization"in b?b.quantization.dtype:b.dtype,x=v0[w]*ir(b.shape),k=function(){i[g]=!0,o[g]==null&&(o[g]=[]),o[g].push({manifestEntry:b,groupOffset:y,sizeBytes:x})};a!=null?a.forEach(function(N,T){N===b.name&&(k(),s[T]=!0)}):k(),u.push(b.name),y+=x})}),!s.every(function(v){return v}))throw l=a.filter(function(v,g){return!s[g]}),new Error("Could not find weights in manifest with names: "+(l.join(", ")+`. 
`)+"Manifest JSON has weights with names: "+(u.join(", ")+"."));return c=i.reduce(function(v,g,y){return g&&v.push(y),v},[]),f=[],c.forEach(function(v){t[v].paths.forEach(function(g){var y=n+(n.endsWith("/")?"":"/")+g;f.push(y)})}),[4,r(f)];case 1:return h=m.sent(),p={},d=0,c.forEach(function(v){for(var g=t[v].paths.length,y=0,b=0;b<g;b++)y+=h[d+b].byteLength;for(var w=new ArrayBuffer(y),x=new Uint8Array(w),k=0,N=0;N<g;N++){var T=new Uint8Array(h[d+N]);x.set(T,k),k+=T.byteLength}var I=o[v];I.forEach(function(F){var D=w.slice(F.groupOffset,F.groupOffset+F.sizeBytes),R=mF(D,[F.manifestEntry]);for(var P in R)p[P]=R[P]}),d+=g}),[2,p]}})})}}var zQ="application/octet-stream",$Q="application/json",W0=function(){function r(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(G(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=It().platform.fetch,G(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&G(e.length===2,function(){return"URL paths for http must have a length of 2, "+("(actual length is "+e.length+").")}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return r.prototype.save=function(e){return Ke(this,void 0,void 0,function(){var t,n,a,i;return je(this,function(o){switch(o.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit),t.body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=gF(e,n),t.body.append("model.json",new Blob([JSON.stringify(a)],{type:$Q}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:zQ}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if(i=o.sent(),i.ok)return[2,{modelArtifactsInfo:$f(e),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+(i.status+"."))}})})},r.prototype.load=function(){return Ke(this,void 0,void 0,function(){var e,t,n,a,i,o=this;return je(this,function(s){switch(s.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(e=s.sent(),!e.ok)throw new Error("Request to "+this.path+" failed with status code "+(e.status+". Please verify this URL points to ")+"the model JSON of the model to load.");s.label=2;case 2:return s.trys.push([2,4,,5]),[4,e.json()];case 3:return t=s.sent(),[3,5];case 4:throw s.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(a=t.modelTopology,i=t.weightsManifest,a==null&&i==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return[2,$0(t,function(u){return o.loadWeights(u)})]}})})},r.prototype.loadWeights=function(e){return Ke(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c,f,h,p,d,m,v,g,y,b,w,x,k,N;return je(this,function(T){switch(T.label){case 0:t=Array.isArray(this.path)?this.path[1]:this.path,n=Ge(WQ(t),2),a=n[0],i=n[1],o=this.weightPathPrefix||a,s=bF(e),u=[],l=[];try{for(c=On(e),f=c.next();!f.done;f=c.next()){h=f.value;try{for(p=(k=void 0,On(h.paths)),d=p.next();!d.done;d=p.next())m=d.value,this.weightUrlConverter!=null?l.push(this.weightUrlConverter(m)):u.push(o+m+i)}catch(I){k={error:I}}finally{try{d&&!d.done&&(N=p.return)&&N.call(p)}finally{if(k)throw k.error}}}}catch(I){w={error:I}}finally{try{f&&!f.done&&(x=c.return)&&x.call(c)}finally{if(w)throw w.error}}return this.weightUrlConverter?(g=(v=u.push).apply,y=[u],[4,Promise.all(l)]):[3,2];case 1:g.apply(v,y.concat([Lt.apply(void 0,[T.sent()])])),T.label=2;case 2:return[4,CF(u,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 3:return b=T.sent(),[2,[s,z0(b)]]}})})},r}();W0.URL_SCHEME_REGEX=/^https?:\/\//;function WQ(r){var e=r.lastIndexOf("/"),t=r.lastIndexOf("?"),n=r.substring(0,e),a=t>e?r.substring(t):"";return[n+"/",a]}function b0(r){return r.match(W0.URL_SCHEME_REGEX)!=null}var _F=function(r,e){if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;var t=!0;return Array.isArray(r)?t=r.every(function(n){return b0(n)}):t=b0(r),t?q0(r,e):null};Ia.registerSaveRouter(_F);Ia.registerLoadRouter(_F);function q0(r,e){return new W0(r,e)}function qQ(r,e){return q0(r,e)}var Jy=function(){function r(e){this.modelArtifacts=e}return r.prototype.load=function(){return this.modelArtifacts},r}(),DF=function(){function r(e){this.saveHandler=e}return r.prototype.save=function(e){return this.saveHandler(e)},r}(),VQ=function(){function r(e){e.load&&(this.load=function(){return Promise.resolve(e.load())}),e.save&&(this.save=function(t){return Promise.resolve(e.save(t))})}return r}();function GQ(r,e,t,n){var a=arguments;return new VQ(FF.apply(void 0,Lt(a)))}function FF(r,e,t,n){if(arguments.length===1){var a=r.modelTopology!=null||r.weightSpecs!=null;return a?new Jy(r):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Jy({modelTopology:r}))}else return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Jy({modelTopology:r,weightSpecs:e,weightData:t,trainingConfig:n})}function UQ(r){return new DF(r)}function HQ(r){return new DF(r)}var KQ={__proto__:null,browserFiles:BQ,browserHTTPRequest:qQ,concatenateArrayBuffers:z0,decodeWeights:mF,encodeWeights:JJ,fromMemory:GQ,fromMemorySync:FF,getLoadHandlers:lQ,getModelArtifactsForJSON:$0,getModelArtifactsForJSONSync:yF,getModelArtifactsInfoForJSON:$f,getSaveHandlers:uQ,getWeightSpecs:bF,http:q0,isHTTPScheme:b0,loadWeights:LQ,registerLoadRouter:sQ,registerSaveRouter:oQ,weightsLoaderFactory:AF,withSaveHandler:UQ,withSaveHandlerSync:HQ,copyModel:SQ,listModels:xQ,moveModel:NQ,removeModel:kQ};function jQ(r,e,t,n){var a;t===void 0&&(t=!1),n===void 0&&(n=!1);var i=L(r,"a","matMul"),o=L(e,"b","matMul");a=Ge(Ir(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:n};return Q.runKernel(F_,s,u)}var Wt=J({matMul_:jQ});function XQ(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n=0),a===void 0&&(a="int32"),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=L(r,"indices","oneHot","int32"),o={indices:i},s={dtype:a,depth:e,onValue:t,offValue:n};return Q.runKernel(t3,o,s)}var w0=J({oneHot_:XQ});function YQ(){It().set("PROD",!0)}function ZQ(){It().set("DEBUG",!0)}function JQ(){It().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function QQ(r){It().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function eee(){Q.disposeVariables()}function tee(){return Q}function ree(){return Q.memory()}function nee(r){return Q.profile(r)}function Ur(r,e){return Q.tidy(r,e)}function Rn(r){var e=M0(r);e.forEach(function(t){return t.dispose()})}function RF(r){return Q.keep(r)}function aee(r){return Q.time(r)}function iee(r){return Q.setBackend(r)}function oee(){return Q.ready()}function see(){return Q.backendName}function uee(r){Q.removeBackend(r)}function lee(r){return Q.findBackend(r)}function cee(r){return Q.findBackendFactory(r)}function fee(r,e,t){return t===void 0&&(t=1),Q.registerBackend(r,e,t)}function hee(){return Q.backend}function pee(r,e){It().setPlatform(r,e)}function dee(r){var e=L(r,"input","imag"),t={input:e};return Q.runKernel(SD,t)}var Jd=J({imag_:dee});function vee(r){var e=L(r,"x","neg"),t={x:e};return Q.runKernel(XD,t)}var fo=J({neg_:vee});function mee(r){var e=L(r,"input","real"),t={input:e};return Q.runKernel(c3,t)}var _f=J({real_:mee});function gee(r,e,t){var n=L(r,"x","transpose");if(e==null&&(e=n.shape.map(function(o,s){return s}).reverse()),G(n.rank===e.length,function(){return"Error in transpose: rank of input "+n.rank+" "+("must match length of perm "+e+".")}),e.forEach(function(o){G(o>=0&&o<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+(" but got "+e)})}),n.rank<=1)return n.clone();var a={x:n},i={perm:e};return n.dtype==="complex64"?Ur(function(){var o=_f(n),s=Jd(n);return o=Q.runKernel(_d,{x:o},i),s=Q.runKernel(_d,{x:s},i),t&&(s=fo(s)),es(o,s)}):Q.runKernel(_d,a,i)}var Vd=J({transpose_:gee});function yee(r,e,t){var n=L(r,"labels","confusionMatrix"),a=L(e,"predictions","confusionMatrix");G(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, "+("but got "+t)}),G(n.rank===1,function(){return"Expected the rank of labels to be 1, but got "+n.rank}),G(a.rank===1,function(){return"Expected the rank of predictions to be 1, "+("but got "+a.rank)}),G(n.shape[0]===a.shape[0],function(){return"Mismatch in the number of examples: "+(n.shape[0]+" vs. "+a.shape[0]+". ")+"Labels and predictions should have the same number of elements."}),G(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+(""+t)});var i=w0(Or(n,"int32"),t),o=w0(Or(a,"int32"),t),s=Vd(i),u=Wt(s,o);return Or(u,"int32")}var bee=J({confusionMatrix_:yee});var wee={__proto__:null,confusionMatrix:bee};function OF(r,e){for(var t=r.length,n=[],a=0;a<t;a++){var i=t-1-a,o=r[i]||1,s=e[e.length-1-a]||1;s>1&&o===1&&n.unshift(i)}return n}function V0(r,e){for(var t=[],n=0;n<e.length;n++){var a=r[r.length-n-1],i=e.length-n-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function Hr(r,e){for(var t=[],n=Math.max(r.length,e.length),a=0;a<n;a++){var i=r[r.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)t.unshift(o);else if(o===1)t.unshift(i);else if(i!==o){var s="Operands could not be broadcast together with shapes "+(r+" and "+e+".");throw Error(s)}else t.unshift(i)}return t}var xee={__proto__:null,getBroadcastDims:OF,getReductionAxes:V0,assertAndGetBroadcastShape:Hr};function PF(r,e,t){if(Zs(r),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var n=Ui(r,t);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return ns(r,e,n,t)}var Bs;function MF(r,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(r==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,n=!1,a=!1,i=!1,o=!1,s=!1;if(r.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&r instanceof ImageData)n=!0;else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)a=!0;else if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)i=!0;else if(r.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&r instanceof ImageBitmap)s=!0;else throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, "+("but was "+r.constructor.name));var u=Md(r0,Q.backendName);if(u!=null){var l={pixels:r},c={numChannels:e};return Q.runKernel(r0,l,c)}var f=Ge(a?[r.videoWidth,r.videoHeight]:[r.width,r.height],2),h=f[0],p=f[1],d;if(o)d=r.getContext("2d").getImageData(0,0,h,p).data;else if(n||t)d=r.data;else if(i||a||s){if(Bs==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")Bs=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else Bs=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Bs.canvas.width=h,Bs.canvas.height=p,Bs.drawImage(r,0,0,h,p),d=Bs.getImageData(0,0,h,p).data}var m;if(e===4)m=new Int32Array(d);else{var v=h*p;m=new Int32Array(v*e);for(var g=0;g<v;g++)for(var y=0;y<e;++y)m[g*e+y]=d[g*4+y]}var b=[p,h,e];return PF(m,b,"int32")}function kee(r){return r!=null&&r.data instanceof Uint8Array}function See(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function Nee(r){return r!=null&&r.width!==0&&r.height!==0}function Eee(r){return See()&&!(r instanceof ImageBitmap)&&Nee(r)&&!kee(r)}function Tee(r,e){return e===void 0&&(e=3),Ke(this,void 0,void 0,function(){var t,n;return je(this,function(a){switch(a.label){case 0:if(t=null,!(It().getBool("WRAP_TO_IMAGEBITMAP")&&Eee(r)))return[3,5];n=void 0,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,createImageBitmap(r,{premultiplyAlpha:"none"})];case 2:return n=a.sent(),[3,4];case 3:return a.sent(),n=null,[3,4];case 4:return n!=null&&n.width===r.width&&n.height===r.height?t=n:t=r,[3,6];case 5:t=r,a.label=6;case 6:return[2,MF(t,e)]}})})}function Iee(r,e){return Ke(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c,f,h,p,d,m,v,g;return je(this,function(y){switch(y.label){case 0:if(t=L(r,"img","toPixels"),r instanceof Gr||(n=t,t=Or(n,"int32"),n.dispose()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(a=Ge(t.shape.slice(0,2),2),i=a[0],o=a[1],s=t.rank===2?1:t.shape[2],s>4||s===2)throw new Error("toPixels only supports depth of size "+("1, 3 or 4 but got "+s));if(t.dtype!=="float32"&&t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");return[4,t.data()];case 1:for(u=y.sent(),l=t.dtype==="float32"?255:1,c=new Uint8ClampedArray(o*i*4),f=0;f<i*o;++f){for(h=[0,0,0,255],p=0;p<s;p++){if(d=u[f*s+p],t.dtype==="float32"){if(d<0||d>1)throw new Error("Tensor values for a float32 Tensor must be in the "+("range [0 - 1] but encountered "+d+"."))}else if(t.dtype==="int32"&&(d<0||d>255))throw new Error("Tensor values for a int32 Tensor must be in the "+("range [0 - 255] but encountered "+d+"."));s===1?(h[0]=d*l,h[1]=d*l,h[2]=d*l):h[p]=d*l}m=f*4,c[m+0]=Math.round(h[0]),c[m+1]=Math.round(h[1]),c[m+2]=Math.round(h[2]),c[m+3]=Math.round(h[3])}return e!=null&&(e.width=o,e.height=i,v=e.getContext("2d"),g=new ImageData(c,o,i),v.putImageData(g,0,0)),t!==r&&t.dispose(),[2,c]}})})}var Cee=J({fromPixels_:MF}),Aee={__proto__:null,fromPixelsAsync:Tee,toPixels:Iee,fromPixels:Cee};function BF(r,e){var t=r.shape.length,n=e.shape.length;if(t<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+(" but the rank was "+t+"."));if(n<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+(" but the rank was "+n+"."));if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type,"+(" but the dtype was "+e.dtype+"."));if(e.shape[n-1]>t)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+(e.shape[n-1]+" vs. "+t));if(ir(r.shape)===0)throw new Error("Requested more than 0 entries, but input is empty."+(" Input shape: "+r.shape+"."));for(var a=e.shape,i=a[a.length-1],o=1,s=0;s<a.length-1;++s)o*=a[s];var u=r.shape,l=a.slice();l.pop();for(var c=1,s=i;s<t;++s)c*=u[s],l.push(u[s]);var f=Lt(_l(r.shape).map(function(h){return h/c}),[1]).slice(0,i);return[l,o,c,f]}var _ee={__proto__:null,prepareAndValidate:BF};function G0(r,e,t){var n=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+("shape[sliceDim:], got updates.shape: "+t.shape)+(", indices.shape: "+e.shape+", shape: "+r)+(", sliceDim: "+n+", and batchDim: "+a+".");if(t.rank<a)throw new Error(i+(" update.rank < "+a+". "));if(r.length<n+(t.rank-a))throw new Error(i+(" Output shape length < "+(n+(t.rank-a))));if(t.rank!==a+r.length-n)throw new Error(i+(" update.rank != "+(a+r.length-n)));for(var o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+(" updates.shape["+o+"] ("+t.shape[o]+") != indices.shape["+o+"] ("+e.shape[o]+")."));for(var o=0;o<t.rank-a;++o)if(t.shape[o+a]!==r[o+n])throw new Error(i+(" updates.shape["+(o+a)+"] ("+t.shape[o+a]+") != shape["+(o+a)+"] ("+r[o+a]+")"))}function U0(r,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+(" but the rank was "+e.rank+"."));if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+(" but the rank was "+r.rank+"."));if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(r.size===0)throw new Error("Updates specified for empty output. updates shape: "+r.shape)}G0(t,e,r)}function LF(r,e,t){for(var n=e.shape.length,a=n>1?e.shape[n-1]:1,i=t.length,o=1,s=a;s<i;++s)o*=t[s];var u=a<1?1:a,l=ir(e.shape)/u,c=Lt(_l(t.slice(0,a)),[1]),f=ir(t);return{sliceRank:a,numUpdates:l,sliceSize:o,strides:c,outputSize:f}}var Dee={__proto__:null,validateUpdateShape:G0,validateInput:U0,calculateShapes:LF},x0=-2,Fee=-1;function Ree(r,e,t){var n=r.shape.length;G(n===e.length,function(){return"Error in slice"+n+"D: Length of begin "+e+" must "+("match the rank of the array ("+n+").")}),G(n===t.length,function(){return"Error in slice"+n+"D: Length of size "+t+" must "+("match the rank of the array ("+n+").")});for(var a=function(o){G(e[o]+t[o]<=r.shape[o],function(){return"Error in slice"+n+"D: begin["+o+"] + size["+o+"] "+("("+(e[o]+t[o])+") would overflow input.shape["+o+"] ("+r.shape[o]+")")})},i=0;i<n;++i)a(i)}function Oee(r){for(var e=[],t=0;r>0;)r&1&&e.push(t),r/=2,t++;return e}function Pee(r,e,t){for(var n=[],a=0;a<r.length;a++)n[a]=Math.ceil((e[a]-r[a])/t[a]);return n}function zF(r,e,t,n){for(var a=Lt(r),i=a.length;i<n.length;i++)a.push(1);for(var i=0;i<t;i++)i===0?a[e]=1:(a.splice(e,0,1),a.pop());return a}function $F(r,e,t){return t<=r?t:t-(e-1)}function WF(r,e){for(var t=[],n=0;n<r;n++)t.push(e+n);return t}function Mee(r,e,t,n,a,i,o,s,u){var l=r.length,c=new Array(l),f=new Array(l),h=new Array(l);if(e.length&&t>0){var p=e[0],d=t+1;c=qF(o,p,d,n,r),f=VF(s,p,d,a,r),h=zF(i,p,d,r)}else for(var m=0;m<l;m++)c[m]=UF(o,n,i,r,m,u),f[m]=HF(s,a,i,r,m,u),h[m]=GF(i,m,u);return{begin:c,end:f,strides:h}}function qF(r,e,t,n,a){for(var i=Lt(a),o=WF(t,e),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=0;else{var u=$F(e,t,s),l=n[u];r&1<<u&&(l=0),i[s]=l}return i}function VF(r,e,t,n,a){for(var i=Lt(a),o=WF(t,e),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=Number.MAX_SAFE_INTEGER;else{var u=$F(e,t,s),l=n[u];r&1<<u&&(l=Number.MAX_SAFE_INTEGER),i[s]=l}for(var c=0;c<i.length;c++){var f=a[c];i[c]<0&&(i[c]+=f),i[c]=Ef(0,i[c],a[c])}return i}function GF(r,e,t){var n=r[e];return(t&1<<e||n==null)&&(n=1),n}function UF(r,e,t,n,a,i){var o=e[a],s=t[a]||1;(r&1<<a||i&1<<a||o==null)&&(s>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);var u=n[a];return o<0&&(o+=u),o=Ef(0,o,u-1),o}function HF(r,e,t,n,a,i){var o=e[a],s=t[a]||1;(r&1<<a||i&1<<a||o==null)&&(s>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);var u=n[a];return o<0&&(o+=u),s>0?o=Ef(0,o,u):o=Ef(-1,o,u-1),o}function Bee(r,e,t){for(var n=t.length,a=0;a<t.length;a++)if(t[a]>1){n=a;break}for(var a=n+1;a<t.length;a++)if(e[a]>0||t[a]!==r[a])return!1;return!0}function Lee(r,e){for(var t=r.length>0?r[r.length-1]:1,n=0;n<r.length-1;n++)t+=r[n]*e[n];return t}function zee(r,e,t){var n,a=r.shape.length;typeof e=="number"?n=Lt([e],new Array(a-1).fill(0)):e.length<a?n=e.concat(new Array(a-e.length).fill(0)):n=e.slice(),n.forEach(function(o){G(o!==-1,function(){return"slice() does not support negative begin indexing."})});var i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=Lt([t],new Array(a-1).fill(-1)):t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map(function(o,s){return o>=0?o:(G(o===-1,function(){return"Negative size values should be exactly -1 but got "+(o+" for the slice() size at index "+s+".")}),r.shape[s]-n[s])}),[n,i]}function $ee(r,e,t,n,a,i,o,s,u){var l;if(n==null?(l=new Array(e.length),l.fill(1)):l=n,o!=null&&(o&o-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");for(var c=!1,f={dims:l.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:l.slice(),beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u},h=0;h<f.dims;h++)c&&(1<<h&s)!==0&&f.numAddAxisAfterEllipsis++,1<<h&o&&(c=!0);c||(f.ellipsisMask|=1<<f.dims,f.dims++);var p={dims:r.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};Wee(f,p);for(var d=!0,m=!0,v=!0,g=[],y=[],h=0;h<r.length;++h){if(p.strides[h]===0)throw Error("strides["+h+"] must be non-zero");var b=!!(p.shrinkAxisMask&1<<h),w=r[h];if(w===-1){g.push(b?1:-1);continue}var x=[p.beginMask&1<<h,p.endMask&1<<h],k=[p.strides[h]>0?0:-1,p.strides[h]>0?w:w-1];if(b&&p.strides[h]<=0)throw Error("only stride 1 allowed on non-range indexing.");v=v&&p.strides[h]===1;var N=!!(p.beginMask&1<<h&&p.endMask&1<<h);if(p.beginValid&&p.endValid){if(b){var T=p.begin[h]<0?w+p.begin[h]:p.begin[h];if(p.begin[h]=T,p.end[h]=p.begin[h]+1,T<0||T>=w)throw Error("slice index "+p.begin[h]+" of dimension "+h+" out of bounds.")}else p.begin[h]=QA(p.begin[h],0,p.strides[h],w,x,k),p.end[h]=QA(p.end[h],1,p.strides[h],w,x,k);var I=p.strides[h]===1&&p.begin[h]===0&&p.end[h]===w;d=d&&I,m=m&&(h===0&&p.strides[h]===1||I)}else d=d&&p.strides[h]===1&&N,m=m&&(h===0&&p.strides[h]===1||N);var F=void 0,D=!1;if(p.beginValid&&p.endValid?(F=p.end[h]-p.begin[h],D=!0):b?(F=1,D=!0):N&&w>=0&&(p.strides[h]<0?F=-w:F=w,D=!0),D){var R=void 0;F===0||F<0!=p.strides[h]<0?R=0:R=Math.trunc(F/p.strides[h])+(F%p.strides[h]!==0?1:0),g.push(R)}else g.push(-1)}for(var P=0;P<p.finalShapeGatherIndices.length;++P){var B=p.finalShapeGatherIndices[P];B>=0?y.push(g[B]):B===x0&&y.push(1)}var q=y.filter(function(O,V){return p.finalShapeGatherIndices[V]!==x0});return{finalShapeSparse:q,finalShape:y,isIdentity:d,sliceDim0:m,isSimpleSlice:v,begin:p.begin,end:p.end,strides:p.strides}}function Wee(r,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;var t=0;e.beginValid=r.begin!=null,e.endValid=r.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(var n=0;n<r.dims;n++)if(1<<n&r.ellipsisMask)for(var a=Math.min(e.dims-(r.dims-n)+1+r.numAddAxisAfterEllipsis,e.dims);t<a;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=n;else if(1<<n&r.newAxisMask)e.finalShapeGatherIndices.push(x0),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error("Index out of range using input dim "+t+"; input "+("has only "+e.dims+" dims, "+e.begin.length+"."));r.begin!=null&&(e.begin[t]=r.begin[n]),r.end!=null&&(e.end[t]=r.end[n]),e.strides[t]=r.strides[n],r.beginMask&1<<n&&(e.beginMask|=1<<t),r.endMask&1<<n&&(e.endMask|=1<<t),r.shrinkAxisMask&1<<n?(e.finalShapeGatherIndices.push(Fee),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(n)),e.inputShapeGatherIndicesSparse[t]=n,t++}}function QA(r,e,t,n,a,i){if(a[e])return t>0?i[e]:i[e+1&1];var o=r<0?n+r:r;return o<i[0]?i[0]:o>i[1]?i[1]:o}var KF={__proto__:null,assertParamsValid:Ree,maskToAxes:Oee,computeOutShape:Pee,stridesWithElidedDims:zF,getNormalizedAxes:Mee,startIndicesWithElidedDims:qF,stopIndicesWithElidedDims:VF,stridesForAxis:GF,startForAxis:UF,stopForAxis:HF,isSliceContinous:Bee,computeFlatOffset:Lee,parseSliceParams:zee,sliceInfo:$ee};var jF=function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(e,t){return new e(t)},r}(),XF=function(){function r(){this.classNameMap={}}return r.getMap=function(){return r.instance==null&&(r.instance=new r),r.instance},r.register=function(e){r.getMap().classNameMap[e.className]=[e,e.fromConfig]},r}();function as(r){G(r.className!=null,function(){return"Class being registered does not have the static className property defined."}),G(typeof r.className=="string",function(){return"className is required to be a string, but got type "+typeof r.className}),G(r.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),XF.register(r)}var qee={__proto__:null,Serializable:jF,SerializationMap:XF,registerClass:as},Vee=.001,YF=.1;function Gee(r,e,t){return t==null&&(t=H0()),k0(r,e,function(n,a){return K0(n,a,t)})}function H0(){return Q.backend.floatPrecision()===32?Vee:YF}function k0(r,e,t){var n=!0;if((gn(r)||gn(e))&&(n=!1),gn(r)&&gn(e)&&(n=!0),n){var a=r.constructor.name,i=e.constructor.name;if(a!==i)throw new Error("Arrays are of different type. Actual: "+a+". "+("Expected: "+i))}if(Array.isArray(r)&&Array.isArray(e)){var o=Ui(r),s=Ui(e);if(!rs(o,s))throw new Error("Arrays have different shapes. "+("Actual: ["+o+"]. Expected: ["+s+"]"))}var u=gn(r)?r:Hs(r),l=gn(e)?e:Hs(e);if(u.length!==l.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs "+("expected: "+l.length+`.
`)+("Actual:   "+u+`.
`)+("Expected: "+l+"."));for(var c=0;c<l.length;++c){var f=u[c],h=l[c];if(!t(f,h))throw new Error("Arrays differ: actual["+c+"] = "+f+", expected["+c+"] = "+h+`.
`+("Actual:   "+u+`.
`)+("Expected: "+l+"."))}typeof expect<"u"&&expect().nothing()}function Uee(r,e){r().then(function(){return e.fail()},function(){return e()}),typeof expect<"u"&&expect().nothing()}function Hee(r,e){var t=typeof e=="string"||typeof e=="number"||typeof e=="boolean"?[e]:e;return Yo(r)||Yo(r[0])||Yo(e)||Yo(e[0])?k0(r,t,function(n,a){return n==a}):k0(r,e,function(n,a){return K0(n,a,0)})}function Kee(r,e,t){if(t==null&&(t=H0()),!K0(r,e,t))throw new Error("Numbers differ: actual === "+r+", expected === "+e);typeof expect<"u"&&expect().nothing()}function K0(r,e,t){return!isFinite(r)&&!isFinite(e)?!0:!(isNaN(r)||isNaN(e)||Math.abs(r-e)>t)}function jee(r,e,t){for(var n=0;n<r.length;n++)if(r[n]<e||r[n]>t)throw new Error("Value out of range:"+r[n]+" low: "+e+", high: "+t)}function Xee(r,e){var t=new Float32Array(r),n=new Float32Array(e);if(t.length!==n.length)throw new Error("Expected ArrayBuffer to be of length "+(n.length+", but it was "+t.length));for(var a=0;a<n.length;a++)if(t[a]!==n[a])throw new Error("Expected ArrayBuffer value at "+a+" to be "+(n[a]+" but got "+t[a]+" instead"))}function ZF(r){for(var e=0;e<r.length;e++){var t=r[e];Array.isArray(t)?ZF(t):r[e]=zf(t)}return r}function Yee(r){var e=document.createElement("video");return"playsInline"in e&&(e.playsInline=!0),e.muted=!0,e.loop=!0,e.style.position="fixed",e.style.left="0px",e.style.top="0px",e.preload="auto",e.appendChild(r),new Promise(function(t){e.addEventListener("loadeddata",function(n){return t(e)}),e.load()})}function Zee(r){return Ke(this,void 0,void 0,function(){return je(this,function(e){switch(e.label){case 0:return[4,r.play()];case 1:return e.sent(),"requestVideoFrameCallback"in r?[4,new Promise(function(t){r.requestVideoFrameCallback(t)})]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})}var Jee={__proto__:null,TEST_EPSILON_FLOAT16:YF,expectArraysClose:Gee,testEpsilon:H0,expectPromiseToFail:Uee,expectArraysEqual:Hee,expectNumbersClose:Kee,expectValuesInRange:jee,expectArrayBuffersEqual:Xee,encodeStrings:ZF,createVideoElement:Yee,play:Zee};var Qee="3.21.0";function ete(r,e){var t,n=L(r,"a","add"),a=L(e,"b","add");t=Ge(Ir(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(_0,i)}var pt=J({add_:ete});function tte(r,e){var t,n=L(r,"a","floorDiv"),a=L(e,"b","floorDiv");t=Ge(Ir(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(mD,i)}var JF=J({floorDiv_:tte});function rte(r,e){var t,n=L(r,"a","div"),a=L(e,"b","div");if(t=Ge(Ir(n,a),2),n=t[0],a=t[1],n.dtype==="int32"&&a.dtype==="int32")return JF(n,a);var i={a:n,b:a},o={};return Q.runKernel(aD,i,o)}var ar=J({div_:rte});function nte(r,e){var t,n=L(r,"a","mul"),a=L(e,"b","mul");t=Ge(Ir(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(jD,i)}var Pe=J({mul_:nte});function ate(r){var e=L(r,"x","abs");if(e.dtype==="complex64"){var t={x:e};return Q.runKernel(z_,t)}else{var t={x:e};return Q.runKernel(g_,t)}}var Ea=J({abs_:ate});function ite(r){var e=L(r,"x","acos"),t={x:e};return Q.runKernel(y_,t)}var ote=J({acos_:ite});function ste(r){var e=L(r,"x","acosh"),t={x:e};return Q.runKernel(b_,t)}var ute=J({acosh_:ste});function lte(r){G(Array.isArray(r),function(){return"The argument passed to tf.addN() must be a list of tensors"}),G(r.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+(""+r.length)});var e=r.map(function(a,i){return L(a,"tensors"+i,"addN")}),t=e[0];e.forEach(function(a){if(a.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(a){if(!rs(a.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var n=e;return Q.runKernel(w_,n)}var cte=J({addN_:lte});function fte(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=L(r,"x","all","bool"),a={x:n},i={axis:e,keepDims:t};return Q.runKernel(x_,a,i)}var hte=J({all_:fte});function pte(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=L(r,"x","any","bool"),a={x:n},i={axis:e,keepDims:t};return Q.runKernel(k_,a,i)}var dte=J({any_:pte});function vte(r,e){e===void 0&&(e=0);var t=L(r,"x","argMax"),n={x:t},a={axis:e};return Q.runKernel(S_,n,a)}var mte=J({argMax_:vte});function gte(r,e){e===void 0&&(e=0);var t=L(r,"x","argMin"),n={x:t},a={axis:e};return Q.runKernel(N_,n,a)}var yte=J({argMin_:gte});function bte(r){var e=L(r,"x","asin"),t={x:e};return Q.runKernel(E_,t)}var wte=J({asin_:bte});function xte(r){var e=L(r,"x","asinh"),t={x:e};return Q.runKernel(T_,t)}var kte=J({asinh_:xte});function Ste(r){var e=L(r,"x","atan"),t={x:e};return Q.runKernel(I_,t)}var Nte=J({atan_:Ste});function Ete(r,e){var t,n=L(r,"a","atan2"),a=L(e,"b","atan2");t=Ge(Ir(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(A_,i)}var Tte=J({atan2_:Ete});function Ite(r){var e=L(r,"x","atanh"),t={x:e};return Q.runKernel(C_,t)}var Cte=J({atanh_:Ite});function Ate(r,e,t,n,a,i){a===void 0&&(a="NHWC");var o=r[3],s=Lt(e,[o]),u=tR(a);return Wf(r,s,t,i,n,null,null,u)}function QF(r,e,t,n,a,i,o){o===void 0&&(o="channelsLast");var s=Ge(Gd(e),2),u=s[0],l=s[1],c;if(o==="channelsLast")c=[u,l,r[3],r[3]];else if(o==="channelsFirst")c=[u,l,r[1],r[1]];else throw new Error("Unknown dataFormat "+o);return Wf(r,c,t,n,a,i,!1,o)}function _te(r,e,t,n,a,i,o){o===void 0&&(o="NDHWC");var s=Ge(S0(e),3),u=s[0],l=s[1],c=s[2],f,h;if(o==="NDHWC")h="channelsLast",f=[u,l,c,r[4],r[4]];else if(o==="NCDHW")h="channelsFirst",f=[u,l,c,r[1],r[1]];else throw new Error("Unknown dataFormat "+o);return eR(r,f,t,n,a,!1,h,i)}function Wf(r,e,t,n,a,i,o,s){var u,l;o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var c=Ge([-1,-1,-1,-1],4),f=c[0],h=c[1],p=c[2],d=c[3];if(s==="channelsLast")u=Ge(r,4),f=u[0],h=u[1],p=u[2],d=u[3];else if(s==="channelsFirst")l=Ge(r,4),f=l[0],d=l[1],h=l[2],p=l[3];else throw new Error("Unknown dataFormat "+s);var m=Ge(e,4),v=m[0],g=m[1],y=m[3],b=Ge(Gd(t),2),w=b[0],x=b[1],k=Ge(Gd(n),2),N=k[0],T=k[1],I=kl(v,N),F=kl(g,T),D=Rte(a,h,p,w,x,I,F,i,s),R=D.padInfo,P=D.outHeight,B=D.outWidth,q=o?y*d:y,O;return s==="channelsFirst"?O=[f,q,P,B]:s==="channelsLast"&&(O=[f,P,B,q]),{batchSize:f,dataFormat:s,inHeight:h,inWidth:p,inChannels:d,outHeight:P,outWidth:B,outChannels:q,padInfo:R,strideHeight:w,strideWidth:x,filterHeight:v,filterWidth:g,effectiveFilterHeight:I,effectiveFilterWidth:F,dilationHeight:N,dilationWidth:T,inShape:r,outShape:O,filterShape:e}}function eR(r,e,t,n,a,i,o,s){var u,l;i===void 0&&(i=!1),o===void 0&&(o="channelsLast");var c=Ge([-1,-1,-1,-1,-1],5),f=c[0],h=c[1],p=c[2],d=c[3],m=c[4];if(o==="channelsLast")u=Ge(r,5),f=u[0],h=u[1],p=u[2],d=u[3],m=u[4];else if(o==="channelsFirst")l=Ge(r,5),f=l[0],m=l[1],h=l[2],p=l[3],d=l[4];else throw new Error("Unknown dataFormat "+o);var v=Ge(e,5),g=v[0],y=v[1],b=v[2],w=v[4],x=Ge(S0(t),3),k=x[0],N=x[1],T=x[2],I=Ge(S0(n),3),F=I[0],D=I[1],R=I[2],P=kl(g,F),B=kl(y,D),q=kl(b,R),O=Ote(a,h,p,d,k,N,T,P,B,q,s),V=O.padInfo,K=O.outDepth,Z=O.outHeight,j=O.outWidth,ee=i?w*m:w,le;return o==="channelsFirst"?le=[f,ee,K,Z,j]:o==="channelsLast"&&(le=[f,K,Z,j,ee]),{batchSize:f,dataFormat:o,inDepth:h,inHeight:p,inWidth:d,inChannels:m,outDepth:K,outHeight:Z,outWidth:j,outChannels:ee,padInfo:V,strideDepth:k,strideHeight:N,strideWidth:T,filterDepth:g,filterHeight:y,filterWidth:b,effectiveFilterDepth:P,effectiveFilterHeight:B,effectiveFilterWidth:q,dilationDepth:F,dilationHeight:D,dilationWidth:R,inShape:r,outShape:le,filterShape:e}}function Dte(r,e,t,n,a){n==null&&(n=j0(r,e,t));var i=r[0],o=r[1],s=Us((i-e+2*n)/t+1,a),u=Us((o-e+2*n)/t+1,a);return[s,u]}function Fte(r,e,t,n,a,i){a==null&&(a=j0(r,e,n));var o=r[0],s=r[1],u=r[2],l=Us((o-e+2*a)/n+1,i),c=Us((s-e+2*a)/n+1,i),f=Us((u-e+2*a)/n+1,i);return[l,c,f,t]}function j0(r,e,t,n){n===void 0&&(n=1);var a=kl(e,n);return Math.floor((r[0]*(t-1)-t+a)/2)}function Gd(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function S0(r){return typeof r=="number"?[r,r,r]:r}function kl(r,e){return e<=1?r:r+(r-1)*(e-1)}function Rte(r,e,t,n,a,i,o,s,u){var l,c,f;if(typeof r=="number"){var h=r===0?"VALID":"NUMBER";l={top:r,bottom:r,left:r,right:r,type:h};var p=Dte([e,t],i,n,r,s);c=p[0],f=p[1]}else if(r==="same"){c=Math.ceil(e/n),f=Math.ceil(t/a);var d=Math.max(0,(c-1)*n+i-e),m=Math.max(0,(f-1)*a+o-t),v=Math.floor(d/2),g=d-v,y=Math.floor(m/2),b=m-y;l={top:v,bottom:g,left:y,right:b,type:"SAME"}}else if(r==="valid")l={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-i+1)/n),f=Math.ceil((t-o+1)/a);else if(typeof r=="object"){var v=u==="channelsLast"?r[1][0]:r[2][0],g=u==="channelsLast"?r[1][1]:r[2][1],y=u==="channelsLast"?r[2][0]:r[3][0],b=u==="channelsLast"?r[2][1]:r[3][1],h=v===0&&g===0&&y===0&&b===0?"VALID":"EXPLICIT";l={top:v,bottom:g,left:y,right:b,type:h},c=Us((e-i+v+g)/n+1,s),f=Us((t-o+y+b)/a+1,s)}else throw Error("Unknown padding parameter: "+r);return{padInfo:l,outHeight:c,outWidth:f}}function Ote(r,e,t,n,a,i,o,s,u,l,c){var f,h,p,d;if(typeof r=="number"){var m=r===0?"VALID":"NUMBER";f={top:r,bottom:r,left:r,right:r,front:r,back:r,type:m};var v=Fte([e,t,n,1],s,1,a,r,c);h=v[0],p=v[1],d=v[2]}else if(r==="same"){h=Math.ceil(e/a),p=Math.ceil(t/i),d=Math.ceil(n/o);var g=(h-1)*a+s-e,y=(p-1)*i+u-t,b=(d-1)*o+l-n,w=Math.floor(g/2),x=g-w,k=Math.floor(y/2),N=y-k,T=Math.floor(b/2),I=b-T;f={top:k,bottom:N,left:T,right:I,front:w,back:x,type:"SAME"}}else if(r==="valid")f={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},h=Math.ceil((e-s+1)/a),p=Math.ceil((t-u+1)/i),d=Math.ceil((n-l+1)/o);else throw Error("Unknown padding parameter: "+r);return{padInfo:f,outDepth:h,outHeight:p,outWidth:d}}function Us(r,e){if(!e)return Math.trunc(r);switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode "+e)}}function Df(r){var e=Ge(Gd(r),3),t=e[0],n=e[1],a=e[2];return t===1&&n===1&&a===1}function mo(r,e){return Df(r)||Df(e)}function tR(r){if(r==="NHWC")return"channelsLast";if(r==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+r)}function Ga(r,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in "+r+": pad must be an integer when using "+("dimRoundingMode "+t+" but got pad "+e+"."));if(typeof e=="number")G(El(e),function(){return"Error in "+r+": pad must be an integer when using "+("dimRoundingMode "+t+" but got pad "+e+".")});else if(typeof e=="object")e.forEach(function(n){n.forEach(function(a){G(El(a),function(){return"Error in "+r+": pad must be an integer when using "+("dimRoundingMode "+t+" but got pad "+a+".")})})});else throw Error("Error in "+r+": Unknown padding parameter: "+e)}}function Pte(r,e){var t=L(r,"x","reshape","string_or_numeric"),n={x:t},a={shape:e};return Q.runKernel(p3,n,a)}var Ee=J({reshape_:Pte});function Mte(r,e,t,n,a){var i=L(r,"x","avgPool","float32"),o=1;G(mo(t,o),function(){return"Error in avgPool: Either strides or dilations must be 1. "+("Got strides "+t+" and dilations '"+o+"'")});var s=i,u=!1;i.rank===3&&(u=!0,s=Ee(i,[1,i.shape[0],i.shape[1],i.shape[2]])),G(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),Ga("avgPool",n,a);var l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=Q.runKernel(__,l,c);return f=Or(f,i.dtype),u?Ee(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var rR=J({avgPool_:Mte});function Bte(r,e,t,n,a,i){i===void 0&&(i="NDHWC");var o=L(r,"x","avgPool3d","float32"),s=o,u=!1;o.rank===4&&(u=!0,s=Ee(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),G(s.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+s.rank+"."}),G(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+("but got dataFormat of "+i)}),Ga("avgPool3d",n,a);var l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=Q.runKernel(D_,l,c);return f=Or(f,s.dtype),u?Ee(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var Lte=J({avgPool3d_:Bte});function zte(r,e){e===void 0&&(e=0),G(r.length>=1,function(){return"Pass at least one tensor to concat"});var t=Af(r,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+i.dtype+". ")}),t.length===1)return Gs(t[0]);var n=t,a={axis:e};return Q.runKernel($_,n,a)}var ea=J({concat_:zte});function $te(r){var e=L(r,"x","sigmoid","float32"),t={x:e};return Q.runKernel(C3,t)}var Sl=J({sigmoid_:$te});function Wte(r,e,t){var n=L(r,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");var a={x:n},i={begin:e,size:t};return Q.runKernel(N3,a,i)}var kr=J({slice_:Wte});function qte(r){var e=L(r,"x","tanh","float32"),t={x:e};return Q.runKernel(K3,t)}var N0=J({tanh_:qte});function Vte(r,e,t,n,a,i){var o=L(r,"forgetBias","basicLSTMCell"),s=L(e,"lstmKernel","basicLSTMCell"),u=L(t,"lstmBias","basicLSTMCell"),l=L(n,"data","basicLSTMCell"),c=L(a,"c","basicLSTMCell"),f=L(i,"h","basicLSTMCell"),h=ea([l,f],1),p=Wt(h,s),d=pt(p,u),m=d.shape[0],v=d.shape[1]/4,g=[m,v],y=kr(d,[0,0],g),b=kr(d,[0,v],g),w=kr(d,[0,v*2],g),x=kr(d,[0,v*3],g),k=pt(Pe(Sl(y),N0(b)),Pe(c,Sl(pt(o,w)))),N=Pe(N0(k),Sl(x));return[k,N]}var Gte=J({basicLSTMCell_:Vte});function Ute(r,e,t){var n=L(r,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});G(n.rank>=1+e.length,function(){return"input rank is "+n.rank+" but should be > than blockShape.length "+e.length}),G(t.length===e.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length}),G(n.shape[0]%a===0,function(){return"input tensor batch is "+n.shape[0]+" but is not divisible by the product of "+("the elements of blockShape "+e.join(" * ")+" === "+a)});var i={x:n},o={blockShape:e,crops:t};return Q.runKernel(R_,i,o)}var nR=J({batchToSpaceND_:Ute});function Hte(r){var e;return r.rank===0||r.rank===1?e=Ee(r,[1,1,1,r.size]):r.rank===2?e=Ee(r,[1,1,r.shape[0],r.shape[1]]):r.rank===3?e=Ee(r,[1,r.shape[0],r.shape[1],r.shape[2]]):e=r,e}function Kte(r,e,t,n,a,i){i==null&&(i=.001);var o=L(r,"x","batchNorm"),s=L(e,"mean","batchNorm"),u=L(t,"variance","batchNorm"),l;a!=null&&(l=L(a,"scale","batchNorm"));var c;n!=null&&(c=L(n,"offset","batchNorm")),G(s.rank===u.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),G(c==null||s.rank===c.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),G(l==null||s.rank===l.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var f=Hte(o),h={x:f,scale:l,offset:c,mean:s,variance:u},p={varianceEpsilon:i},d=Q.runKernel(gD,h,p);return Ee(d,o.shape)}var Qd=J({batchNorm_:Kte});function jte(r,e,t,n,a,i){var o=L(r,"x","batchNorm"),s=L(e,"mean","batchNorm"),u=L(t,"variance","batchNorm"),l;a!=null&&(l=L(a,"scale","batchNorm"));var c;return n!=null&&(c=L(n,"offset","batchNorm")),G(o.rank===2,function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+(o.rank+".")}),G(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+("got rank "+s.rank+".")}),G(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+("but got rank "+u.rank+".")}),l!=null&&G(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+("but got rank "+l.rank+".")}),c!=null&&G(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+("but got rank "+c.rank+".")}),Qd(o,s,u,c,l,i)}var Xte=J({batchNorm2d_:jte});function Yte(r,e,t,n,a,i){var o=L(r,"x","batchNorm"),s=L(e,"mean","batchNorm"),u=L(t,"variance","batchNorm"),l;a!=null&&(l=L(a,"scale","batchNorm"));var c;return n!=null&&(c=L(n,"offset","batchNorm")),G(o.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+(o.rank+".")}),G(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+("got rank "+s.rank+".")}),G(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+("but got rank "+u.rank+".")}),l!=null&&G(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+("but got rank "+l.rank+".")}),c!=null&&G(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+("but got rank "+c.rank+".")}),Qd(o,s,u,c,l,i)}var Zte=J({batchNorm3d_:Yte});function Jte(r,e,t,n,a,i){var o=L(r,"x","batchNorm"),s=L(e,"mean","batchNorm"),u=L(t,"variance","batchNorm"),l;a!=null&&(l=L(a,"scale","batchNorm"));var c;return n!=null&&(c=L(n,"offset","batchNorm")),G(o.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+(o.rank+".")}),G(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+("got rank "+s.rank+".")}),G(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+("but got rank "+u.rank+".")}),l!=null&&G(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+("but got rank "+l.rank+".")}),c!=null&&G(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+("but got rank "+c.rank+".")}),Qd(o,s,u,c,l,i)}var Qte=J({batchNorm4d_:Jte});function ere(r,e,t){var n=L(r,"x","bincount"),a=L(e,"weights","bincount");G(n.dtype==="int32",function(){return"Error in bincount: input "+("dtype must be int32, but got "+n.dtype)}),G(t>=0,function(){return"size must be non-negative, but got "+t+"."}),G(a.size===n.size||a.size===0,function(){return"Error in bincount: weights must have the same size as input or"+("0-length, but got input shape: "+n.shape+", weights shape: ")+(a.shape+".")});var i={x:n,weights:a},o={size:t};return Q.runKernel(O_,i,o)}var aR=J({bincount_:ere});function tre(r,e){var t=L(r,"s0","broadcastArgs","int32"),n=L(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error("broadcastArgs(): first input must be a vector (rank=1). "+("Has rank "+t.rank));if(n.rank!==1)throw new Error("broadcastArgs(): second input must be a vector (rank=1). "+("Has rank "+n.rank));var a={s0:t,s1:n};return Q.runKernel(P_,a)}var rre=J({broadcastArgs_:tre});function nre(r,e){var t=L(r,"broadcastTo","x"),n=t.shape;if(e.some(function(f){return!(f>0)||f%1!==0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<t.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+t.rank+".");if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=Ee(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): ["+n+"] cannot be broadcast to ["+e+"].");var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return Gs(t);var l={x:t},c={reps:o};return Q.runKernel(R0,l,c)}var Rd=J({broadcastTo_:nre});function are(r){var e=L(r,"x","ceil","float32"),t={x:e};return Q.runKernel(M_,t)}var ire=J({ceil_:are});function qf(r,e,t){var n={shape:r,value:e,dtype:t};return Q.runKernel(pD,{},n)}function ore(r,e,t){var n=L(r,"x","clipByValue");if(G(e<=t,function(){return"Error in clip: min ("+e+") must be "+("less than or equal to max ("+t+").")}),e===t)return qf(n.shape,e,n.dtype);var a={x:n},i={clipValueMin:e,clipValueMax:t};return Q.runKernel(B_,a,i)}var sre=J({clipByValue_:ore});function ure(r){return ea(r,0)}var lre=J({concat1d_:ure});function cre(r,e){return ea(r,e)}var fre=J({concat2d_:cre});function hre(r,e){return ea(r,e)}var pre=J({concat3d_:hre});function dre(r,e){return ea(r,e)}var vre=J({concat4d_:dre});function mre(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=L(r,"x","conv2d","float32"),u=L(e,"filter","conv2d","float32"),l=s,c=!1;s.rank===3&&(c=!0,l=Ee(s,[1,s.shape[0],s.shape[1],s.shape[2]])),G(l.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),G(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+(u.rank+".")}),Ga("conv2d",n,o);var f=a==="NHWC"?l.shape[3]:l.shape[1];G(f===u.shape[2],function(){return"Error in conv2d: depth of input ("+f+") must match "+("input depth for filter "+u.shape[2]+".")}),G(mo(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+("Got strides "+t+" and dilations '"+i+"'")});var h={x:l,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=Q.runKernel(W_,h,p);return c?Ee(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var ev=J({conv2d_:mre});function gre(r,e,t,n,a,i,o){a===void 0&&(a="NWC"),i===void 0&&(i=1);var s=L(r,"x","conv1d"),u=L(e,"filter","conv1d"),l=s,c=!1;s.rank===2&&(c=!0,l=Ee(s,[1,s.shape[0],s.shape[1]])),G(l.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),G(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+(u.rank+".")}),Ga("conv1d",n,o),G(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match "+("input depth for filter "+u.shape[1]+".")}),G(mo(t,i),function(){return"Error in conv1D: Either stride or dilation must be 1. "+("Got stride "+t+" and dilation '"+i+"'")}),G(a==="NWC",function(){return"Error in conv1d: got dataFormat of "+a+" but only NWC is currently supported."});var f=Ee(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=Ee(l,[l.shape[0],1,l.shape[1],l.shape[2]]),p=[1,t],d=[1,i],m="NHWC",v=ev(h,f,p,n,m,d,o);return c?Ee(v,[v.shape[2],v.shape[3]]):Ee(v,[v.shape[0],v.shape[2],v.shape[3]])}var yre=J({conv1d_:gre});function bre(r,e,t,n,a,i,o){i===void 0&&(i="NHWC"),G(r.length===e.rank,function(){return"Length of inShape "+("("+r.length+") and rank of dy ("+e.rank+") must match")});var s=r,u=e,l=!1;e.rank===3&&(l=!0,u=Ee(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,r[0],r[1],r[2]]),G(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+(s.length+".")}),G(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+("rank "+u.rank)}),G(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+("rank "+t.rank)});var c=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];G(c===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must "+("match input depth for filter "+t.shape[2]+".")}),G(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+f+") must "+("match output depth for filter "+t.shape[3]+".")}),Ga("conv2dDerInput",a,o);var h={dy:u,filter:t},p={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=Q.runKernel(V_,h,p);return l?Ee(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var iR=J({conv2DBackpropInput_:bre});function wre(r,e,t,n,a,i){var o=L(r,"x","conv2dTranspose"),s=L(e,"filter","conv2dTranspose");return iR(t,o,s,n,a,"NHWC",i)}var xre=J({conv2dTranspose_:wre});function kre(r,e,t,n,a,i){a===void 0&&(a="NDHWC"),i===void 0&&(i=[1,1,1]);var o=L(r,"x","conv3d"),s=L(e,"filter","conv3d"),u=o,l=!1;o.rank===4&&(l=!0,u=Ee(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),G(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),G(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+(s.rank+".")}),G(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match "+("input depth for filter "+s.shape[3]+".")}),G(mo(t,i),function(){return"Error in conv3D: Either strides or dilations must be 1. "+("Got strides "+t+" and dilations '"+i+"'")}),G(a==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+a+" but only NDHWC is currently supported."});var c={x:u,filter:s},f={strides:t,pad:n,dataFormat:a,dilations:i},h=Q.runKernel(G_,c,f);return l?Ee(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var Sre=J({conv3d_:kre});function Nre(r,e,t,n,a){G(r.length===e.rank,function(){return"Length of inShape "+("("+r.length+") and rank of dy ("+e.rank+") must match")});var i=r,o=e,s=!1;e.rank===4&&(s=!0,o=Ee(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,r[0],r[1],r[2],r[3]]);var u=i[4],l=o.shape[4];G(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+(i.length+".")}),G(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+("rank "+o.rank)}),G(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+("rank "+t.rank)}),G(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must "+("match input depth for filter "+t.shape[3]+".")}),G(l===t.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must "+("match output depth for filter "+t.shape[4]+".")});var c={dy:o,filter:t},f={pad:a,strides:n,inputShape:i},h=Q.runKernel(U_,c,f);return s?Ee(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var Ere=J({conv3DBackpropInput_:Nre});function Tre(r,e,t,n,a){var i=L(r,"x","conv3dTranspose"),o=L(e,"filter","conv3dTranspose");return Ere(t,i,o,n,a)}var Ire=J({conv3dTranspose_:Tre});function Cre(r){var e=L(r,"x","cos","float32"),t={x:e};return Q.runKernel(H_,t)}var Are=J({cos_:Cre});function _re(r){var e=L(r,"x","cosh","float32"),t={x:e};return Q.runKernel(K_,t)}var Dre=J({cosh_:_re});function Fre(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=L(r,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:n};return Q.runKernel(j_,i,o)}var Rre=J({cumprod_:Fre});function Ore(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=L(r,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:n};return Q.runKernel(X_,i,o)}var Pre=J({cumsum_:Ore});function Mre(r,e,t,n){n===void 0&&(n=!1);var a=L(r,"x","denseBincount"),i=L(e,"weights","denseBincount");G(a.dtype==="int32",function(){return"Error in denseBincount: input "+("dtype must be int32, but got "+a.dtype)}),G(a.rank<=2,function(){return"Error in denseBincount: input must be at most rank 2, but got "+("rank "+a.rank+".")}),G(t>=0,function(){return"size must be non-negative, but got "+t+"."}),G(i.size===a.size||i.size===0,function(){return"Error in denseBincount: weights must have the same shape as x or "+("0-length, but got x shape: "+a.shape+", weights shape: ")+(i.shape+".")});var o={x:a,weights:i},s={size:t,binaryOutput:n};return Q.runKernel(Z_,o,s)}var Bre=J({denseBincount_:Mre});function Lre(r,e,t){t===void 0&&(t="NHWC");var n=L(r,"x","depthToSpace","float32"),a=t==="NHWC"?n.shape[1]:n.shape[2],i=t==="NHWC"?n.shape[2]:n.shape[3],o=t==="NHWC"?n.shape[3]:n.shape[1];G(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e}),G(a*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `+a+" and "+e+`  for depthToSpace with input shape
    `+n.shape}),G(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `+i+" and "+e+` for depthToSpace with input shape
        `+n.shape}),G(o%(e*e)===0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+o+" for depthToSpace with input shape "+n.shape});var s={x:n},u={blockSize:e,dataFormat:t};return Q.runKernel(J_,s,u)}var zre=J({depthToSpace_:Lre});function $re(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=L(r,"x","depthwiseConv2d","float32"),u=L(e,"filter","depthwiseConv2d","float32"),l=s,c=!1;s.rank===3&&(c=!0,l=Ee(s,[1,s.shape[0],s.shape[1],s.shape[2]])),G(l.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+("rank "+l.rank+".")}),G(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+(u.rank+".")});var f=a==="NHWC"?l.shape[3]:l.shape[1];G(f===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels "+("("+f+") must match the inChannels dimension in ")+("filter "+u.shape[2]+".")}),Ga("depthwiseConv2d",n,o);var h={x:l,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=Q.runKernel(Q_,h,p);return c?Ee(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var X0=J({depthwiseConv2d_:$re});function Wre(r){var e=L(r,"x","diag"),t={x:e};return Q.runKernel(rD,t)}var qre=J({diag_:Wre});function Vre(r,e,t,n,a,i){a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC");var o=L(r,"x","dilation2d"),s=L(e,"filter","dilation2d");G(o.rank===3||o.rank===4,function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+(o.rank+".")}),G(s.rank===3,function(){return"Error in dilation2d: filter must be rank 3, but got rank "+(s.rank+".")}),G(i==="NHWC",function(){return"Error in dilation2d: Only NHWC is currently supported, "+("but got dataFormat of "+i)});var u=o,l=!1;o.rank===3&&(u=Ee(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=!0);var c={x:u,filter:s},f={strides:t,pad:n,dilations:a},h=Q.runKernel(nD,c,f);return l?Ee(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var Gre=J({dilation2d_:Vre});function Ure(r,e){var t,n=L(r,"a","equal","string_or_numeric"),a=L(e,"b","equal","string_or_numeric");t=Ge(Ir(n,a),2),n=t[0],a=t[1],Hr(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(uD,i)}var oR=J({equal_:Ure});function Hre(r,e,t){var n=L(e,"a","where"),a=L(t,"b","where"),i=L(r,"condition","where","bool"),o=Hr(Hr(i.shape,n.shape),a.shape),s=Rd(i,o),u=Rd(n,o),l=Rd(a,o),c={condition:s,t:u,e:l};return Q.runKernel(k3,c)}var Cl=J({where_:Hre});function Kre(r){var e=L(r,"x","zerosLike"),t={x:e};return Q.runKernel(Q3,t)}var Ta=J({zerosLike_:Kre});function jre(r,e){var t,n=L(r,"a","div"),a=L(e,"b","div");t=Ge(Ir(n,a),2),n=t[0],a=t[1];var i=ar(n,a),o=Ta(i),s=oR(a,o);return Cl(s,o,i)}var Xre=J({divNoNan_:jre});function Yre(r,e){var t=L(r,"t1","dot"),n=L(e,"t2","dot");G((t.rank===1||t.rank===2)&&(n.rank===1||n.rank===2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+(t.rank+" and "+n.rank+".")});var a=t.rank===1?t.size:t.shape[1],i=n.rank===1?n.size:n.shape[0];if(G(a===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+(a+" and "+i+".")}),t.rank===1&&n.rank===1){var o=Ee(t,[1,-1]),s=Ee(n,[-1,1]),u=Wt(o,s);return Ee(u,[])}else if(t.rank===1&&n.rank===2){var o=Ee(t,[1,-1]),s=Ee(n,[n.shape[0],n.shape[1]]),u=Wt(o,s);return Ee(u,[u.size])}else if(t.rank===2&&n.rank===1){var s=Ee(n,[-1,1]),u=Wt(t,s);return Ee(u,[u.size])}else{var s=Ee(n,[n.shape[0],n.shape[1]]),u=Wt(t,s);return u}}var Zre=J({dot_:Yre});function Jre(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var n=e.map(function(i,o){return L(i,"tensors"+o,"einsum")}),a={equation:r};return Q.runKernel(iD,n,a)}var Qre=J({einsum_:Jre});function ene(r){var e=L(r,"x","elu","float32"),t={x:e};return Q.runKernel(oD,t)}var sR=J({elu_:ene});function tne(r){var e=L(r,"x","erf");G(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=Or(e,"float32"));var t={x:e};return Q.runKernel(sD,t)}var rne=J({erf_:tne});function Y0(r,e){for(var t=0;t<r.length;++t)if(r[r.length-t-1]!==e-1-t)return!1;return!0}function uR(r,e,t){for(var n=r.length+e.length,a=[],i=0,o=0,s=0;s<n;s++)t.indexOf(s)===-1?a.push(r[i++]):a.push(e[o++]);return a}function nne(r,e){for(var t=[],n=r.length,a=0;a<n;a++)e.indexOf(a)===-1&&t.push(r[a]);var i=e.map(function(o){return r[o]});return[t,i]}function Vf(r,e){var t=e.map(function(n){return 1});return uR(r,t,e)}function ane(r,e,t){G(Y0(e,t),function(){return r+" supports only inner-most axes for now. "+("Got axes "+e+" and rank-"+t+" input.")})}function ine(r,e){if(Y0(r,e))return null;for(var t=[],n=0;n<e;++n)r.indexOf(n)===-1&&t.push(n);return r.forEach(function(a){return t.push(a)}),t}function one(r){return r.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function sne(r,e){for(var t=[],n=e-r;n<e;++n)t.push(n);return t}function une(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=L(r,"x","max"),a={x:n},i={reductionIndices:e,keepDims:t};return Q.runKernel(BD,a,i)}var Nl=J({max_:une});function lne(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=L(r,"x","min"),a={x:n},i={axis:e,keepDims:t};return Q.runKernel(VD,a,i)}var E0=J({min_:lne});function cne(r,e){var t,n=L(r,"base","pow"),a=L(e,"exp","pow");t=Ge(Ir(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(a3,i)}var Ff=J({pow_:cne});function qt(r,e){if((gn(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&gn(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],n=[];return ns(r,t,n,e)}function fne(r){var e=L(r,"x","sqrt","float32"),t={x:e};return Q.runKernel(_3,t)}var po=J({sqrt_:fne});function hne(r){var e=L(r,"x","square"),t={};return Q.runKernel("Square",{x:e},t)}var gi=J({square_:hne});function pne(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=L(r,"x","sum");n.dtype==="bool"&&(n=Or(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return Q.runKernel(D3,a,i)}var nr=J({sum_:pne});function dne(r,e,t,n){e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1),r=L(r,"x","norm");var a=lR(r,e,t),i=a.shape;if(n){var o=Bf(t,r.shape);i=Vf(a.shape,o)}return Ee(a,i)}function lR(r,e,t){if(t===void 0&&(t=null),r.rank===0)return Ea(r);if(r.rank!==1&&t===null)return lR(Ee(r,[-1]),e,t);if(r.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return nr(Ea(r),t);if(e===1/0)return Nl(Ea(r),t);if(e===-1/0)return E0(Ea(r),t);if(e==="euclidean"||e===2)return po(nr(Ff(Ea(r),qt(2,"int32")),t));throw new Error("Error in norm: invalid ord value: "+e)}if(Array.isArray(t)&&t.length===2){if(e===1)return Nl(nr(Ea(r),t[0]),t[1]-1);if(e===1/0)return Nl(nr(Ea(r),t[1]),t[0]);if(e===-1/0)return E0(nr(Ea(r),t[1]),t[0]);if(e==="fro"||e==="euclidean")return po(nr(gi(r),t));throw new Error("Error in norm: invalid ord value: "+e)}throw new Error("Error in norm: invalid axis: "+t)}var tv=J({norm_:dne});function vne(r,e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),tv(r,"euclidean",e,t)}var mne=J({euclideanNorm_:vne});function gne(r){var e=L(r,"x","exp"),t={x:e};return Q.runKernel(lD,t)}var Xs=J({exp_:gne});function yne(r,e){e===void 0&&(e=0);var t=L(r,"x","expandDims","string_or_numeric");G(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var n={input:t},a={dim:e};return Q.runKernel(cD,n,a)}var zs=J({expandDims_:yne});function bne(r){var e=L(r,"x","expm1"),t={x:e};return Q.runKernel(fD,t)}var wne=J({expm1_:bne});function xne(r,e){var t=L(r,"x","tile","string_or_numeric");G(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" "+("must match length of reps "+e+".")});var n={x:t},a={reps:e};return Q.runKernel(R0,n,a)}var Sf=J({tile_:xne});function kne(r,e,t,n){n===void 0&&(n="float32"),e==null&&(e=r);for(var a=ho([r,e],n),i=r<=e?r:e,o=0;o<i;++o)a.set(1,o,o);var s=Ee(a.toTensor(),[r,e]);if(t==null)return s;if(t.length===1)return Sf(zs(s,0),[t[0],1,1]);if(t.length===2)return Sf(zs(zs(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return Sf(zs(zs(zs(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+("batchShapes, but received "+t.length+"D."))}var cR=J({eye_:kne});function Sne(r){var e=L(r,"x","floor","float32"),t={x:e};return Q.runKernel(vD,t)}var fR=J({floor_:Sne});function Nne(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=0);var a=L(r,"x","gather"),i=L(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:n};return Q.runKernel(yD,o,s)}var hR=J({gather_:Nne});function Ene(r,e){var t,n=L(r,"a","greater","string_or_numeric"),a=L(e,"b","greater","string_or_numeric");t=Ge(Ir(n,a),2),n=t[0],a=t[1],Hr(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(wD,i)}var rv=J({greater_:Ene});function Tne(r,e){var t,n=L(r,"a","greaterEqual","string_or_numeric"),a=L(e,"b","greaterEqual","string_or_numeric");t=Ge(Ir(n,a),2),n=t[0],a=t[1],Hr(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(xD,i)}var pR=J({greaterEqual_:Tne});function Ine(r){var e=L(r,"x","isFinite"),t={x:e};return Q.runKernel(ND,t)}var Cne=J({isFinite_:Ine});function Ane(r){var e=L(r,"x","isInf"),t={x:e};return Q.runKernel(ED,t)}var _ne=J({isInf_:Ane});function Dne(r){var e=L(r,"x","isNaN"),t={x:e};return Q.runKernel(TD,t)}var Fne=J({isNaN_:Dne});function Rne(r,e){e===void 0&&(e=.2);var t=L(r,"x","leakyRelu"),n={x:t},a={alpha:e};return Q.runKernel(ID,n,a)}var dR=J({leakyRelu_:Rne});function One(r,e){var t,n=L(r,"a","less","string_or_numeric"),a=L(e,"b","less","string_or_numeric");t=Ge(Ir(n,a),2),n=t[0],a=t[1],Hr(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(CD,i)}var Pne=J({less_:One});function Mne(r,e){var t,n=L(r,"a","lessEqual","string_or_numeric"),a=L(e,"b","lessEqual","string_or_numeric");t=Ge(Ir(n,a),2),n=t[0],a=t[1],Hr(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(AD,i)}var Z0=J({lessEqual_:Mne});function Bne(r,e,t){if(t<=0)throw new Error("The number of values should be positive.");var n={start:r,stop:e,num:t};return Q.runKernel(_D,{},n)}function Lne(r,e,t,n,a){e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),a===void 0&&(a=.5);var i=L(r,"x","localResponseNormalization");G(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+i.rank+"."}),G(El(e),function(){return"Error in localResponseNormalization: depthRadius must be an "+("integer but got depthRadius "+e+".")});var o=i,s=!1;i.rank===3&&(s=!0,o=Ee(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},l={depthRadius:e,bias:t,alpha:n,beta:a},c=Q.runKernel(MD,u,l);return s?Ee(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var zne=J({localResponseNormalization_:Lne});function $ne(r){var e=L(r,"x","log","float32"),t={x:e};return Q.runKernel(DD,t)}var Rf=J({log_:$ne});function Wne(r){var e=L(r,"x","log1p"),t={x:e};return Q.runKernel(FD,t)}var vR=J({log1p_:Wne});function qne(r){return G(Qo(r),function(){return"The f passed in grad(f) must be a function"}),function(e,t){var n=L(e,"x","tf.grad","string_or_numeric"),a=t!=null?L(t,"dy","tf.grad"):null;return Q.tidy(function(){var i=Q.gradients(function(){return r(n)},[n],a),o=i.value,s=i.grads;return a!=null&&En(o.shape,a.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),nv(s),s[0]})}}function Vne(r){return G(Qo(r),function(){return"The f passed in grads(f) must be a function"}),function(e,t){G(Array.isArray(e),function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"});var n=Af(e,"args","tf.grads","string_or_numeric"),a=t!=null?L(t,"dy","tf.grads"):null;return Q.tidy(function(){var i=Q.gradients(function(){return r.apply(void 0,Lt(n))},n,a),o=i.value,s=i.grads;return a!=null&&En(o.shape,a.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),nv(s),s})}}function Gne(r){return G(Qo(r),function(){return"The f passed in valueAndGrad(f) must be a function"}),function(e,t){G(e instanceof Gr,function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"}),G(t==null||t instanceof Gr,function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"});var n=Q.gradients(function(){return r(e)},[e],t),a=n.grads,i=n.value;return nv(a),{grad:a[0],value:i}}}function Une(r){return G(Qo(r),function(){return"The f passed in valueAndGrads(f) must be a function"}),function(e,t){G(Array.isArray(e)&&e.every(function(a){return a instanceof Gr}),function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"}),G(t==null||t instanceof Gr,function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"});var n=Q.gradients(function(){return r.apply(void 0,Lt(e))},e,t);return t!=null&&En(n.value.shape,t.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),nv(n.grads),n}}function mR(r,e){G(Qo(r),function(){return"The f passed in variableGrads(f) must be a function"}),G(e==null||Array.isArray(e)&&e.every(function(f){return f instanceof Cf}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t){e=[];for(var n in Q.registeredVariables)e.push(Q.registeredVariables[n])}var a=t?e.filter(function(f){return!f.trainable}):null,i=e.length;e=e.filter(function(f){return f.trainable}),G(e.length>0,function(){return"variableGrads() expects at least one of the input variables to "+("be trainable, but none of the "+i+" variables is ")+"trainable."});var o=!0,s=Q.gradients(r,e,null,o),u=s.value,l=s.grads;G(l.some(function(f){return f!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),G(u.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it "+("returned a rank-"+u.rank+" tensor")});var c={};return e.forEach(function(f,h){l[h]!=null&&(c[f.name]=l[h])}),a?.forEach(function(f){return c[f.name]=null}),{value:u,grads:c}}function Hi(r){return Q.customGrad(r)}function nv(r){var e=r.filter(function(t){return t==null}).length;if(e>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}function Hne(r){var e=L(r,"x","softplus"),t={x:e};return Q.runKernel(A3,t)}var gR=J({softplus_:Hne});function Kne(r){var e=L(r,"x","logSigmoid"),t=Hi(function(n){var a=fo(gR(fo(n))),i=function(o){var s=Pe(o,Sl(fo(n)));return s};return{value:a,gradFunc:i}});return t(e)}var jne=J({logSigmoid_:Kne});function Xne(r,e){var t,n=L(r,"a","sub"),a=L(e,"b","sub");t=Ge(Ir(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(U3,i)}var At=J({sub_:Xne});function Yne(r,e){e===void 0&&(e=-1);var t=L(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+("Logits was rank "+t.rank+" and axis was "+e));var n=Hi(function(a,i){var o=!0,s=Nl(a,e,!0),u=At(a,s),l=At(Or(u,"float32"),Rf(nr(Xs(u),e,o)));i([l]);var c=function(f,h){var p=Ge(h,1),d=p[0],m=!0,v=Xs(d);return At(f,Pe(nr(f,e,m),v))};return{value:l,gradFunc:c}});return n(t)}var Zne=J({logSoftmax_:Yne});function Jne(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=L(r,"x","logSumExp"),a=Bf(e,n.shape),i=Nl(n,a,!0),o=At(n,i),s=Xs(o),u=nr(s,a),l=Rf(u),c=pt(Ee(i,l.shape),l);if(t){var f=Vf(c.shape,a);return Ee(c,f)}return c}var yR=J({logSumExp_:Jne});function Qne(r,e){var t=L(r,"a","logicalAnd","bool"),n=L(e,"b","logicalAnd","bool");Hr(t.shape,n.shape);var a={a:t,b:n};return Q.runKernel(RD,a)}var Ud=J({logicalAnd_:Qne});function eae(r){var e=L(r,"x","logicalNot","bool"),t={x:e};return Q.runKernel(OD,t)}var bR=J({logicalNot_:eae});function tae(r,e){var t=L(r,"a","logicalOr","bool"),n=L(e,"b","logicalOr","bool");Hr(t.shape,n.shape);var a={a:t,b:n};return Q.runKernel(PD,a)}var wR=J({logicalOr_:tae});function rae(r,e){var t=L(r,"a","logicalXor","bool"),n=L(e,"b","logicalXor","bool");return Hr(t.shape,n.shape),Ud(wR(r,e),bR(Ud(r,e)))}var nae=J({logicalXor_:rae});var Ad=2147483648;function aae(r,e,t){t===void 0&&(t="left");var n=L(r,"sortedSequence","searchSorted"),a=L(e,"values","searchSorted"),i=n.shape[n.shape.length-1],o=a.shape[a.shape.length-1],s=Ee(n,[-1,i]),u=Ee(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(ir(u.shape)>=Ad)throw new Error("values tensor size must less than "+Ad);if(s.shape[1]>=Ad)throw new Error("trailing dim_size must less than "+Ad+" for int32 output type, was "+s.shape[1]);var l={sortedSequence:s,values:u},c={side:t};return Q.runKernel(x3,l,c)}var J0=J({searchSorted_:aae});function iae(r,e){return J0(r,e,"left")}function oae(r,e,t,n,a){var i=L(r,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=Ee(i,[1,i.shape[0],i.shape[1],i.shape[2]])),G(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),G(mo(t,o),function(){return"Error in maxPool: Either strides or dilations must be 1. "+("Got strides "+t+" and dilations '"+o+"'")}),Ga("maxPool",n,a);var l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=Q.runKernel(zD,l,c);return u?Ee(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var xR=J({maxPool_:oae});function sae(r,e,t,n,a,i){e===void 0&&(e=[1,1,1]),i===void 0&&(i="NDHWC");var o=L(r,"x","maxPool3d"),s=o,u=!1;o.rank===4&&(u=!0,s=Ee(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),G(s.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+s.rank+"."}),G(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+("but got dataFormat of "+i)}),Ga("maxPool3d",n,a);var l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=Q.runKernel($D,l,c);return u?Ee(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var uae=J({maxPool3d_:sae});function lae(r,e,t,n,a){a===void 0&&(a=!1);var i=L(r,"x","maxPoolWithArgmax"),o={x:i},s={filterSize:e,strides:t,pad:n,includeBatchInIndex:a},u=Q.runKernel(WD,o,s);return{result:u[0],indexes:u[1]}}var cae=J({maxPoolWithArgmax_:lae});function fae(r,e){var t,n=L(r,"a","maximum"),a=L(e,"b","maximum");t=Ge(Ir(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=Or(n,"int32"),a=Or(a,"int32")),Hr(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(LD,i)}var kR=J({maximum_:fae});function hae(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=L(r,"x","mean"),a={x:n},i={axis:e,keepDims:t};return Q.runKernel(qD,a,i)}var Hd=J({mean_:hae});function Al(r,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Al(r,"float32"),n=Al(r,"float32");return es(t,n)}var a=Xd(ir(r),e);return Q.makeTensor(a,r,e)}function Vs(r,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Vs(r,"float32"),n=Al(r,"float32");return es(t,n)}var a=T0(ir(r),e);return Q.makeTensor(a,r,e)}function pae(r,e,t){var n=(t===void 0?{}:t).indexing,a=n===void 0?"xy":n;if(a!=="xy"&&a!=="ij")throw new TypeError(a+" is not a valid third argument to meshgrid");if(r===void 0)return[];var i=L(r,"x","meshgrid",r instanceof Gr?r.dtype:"float32");if(e===void 0)return[i];var o=L(e,"y","meshgrid",e instanceof Gr?e.dtype:"float32"),s=ir(i.shape),u=ir(o.shape);return a==="xy"?(i=Ee(i,[1,-1]),o=Ee(o,[-1,1]),[Wt(Vs([u,1],i.dtype),i),Wt(o,Vs([1,s],o.dtype))]):(i=Ee(i,[-1,1]),o=Ee(o,[1,-1]),[Wt(i,Vs([1,u],i.dtype)),Wt(Vs([s,1],o.dtype),o)])}function dae(r,e){var t,n=L(r,"a","minimum"),a=L(e,"b","minimum");t=Ge(Ir(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=Or(n,"int32"),a=Or(a,"int32")),Hr(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(GD,i)}var SR=J({minimum_:dae});function vae(r,e,t){G(t==="reflect"||t==="symmetric",function(){return"Invalid mode. Mode must be either reflect or symmetric. "+("Got "+t+".")});var n=L(r,"x","mirrorPad");if(n.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");G(e.length===n.rank,function(){return"Padding doesn't match input. Must be "+n.rank+". "+("Got "+e.length+".")});for(var a=t==="reflect"?1:0,i=function(l){G(e[l].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),G(e[l][0]>=0&&e[l][0]<=n.shape[l]-a&&e[l][1]>=0&&e[l][1]<=n.shape[l]-a,function(){return"Padding in dimension "+l+" cannot be greater than or equal "+("to "+(n.shape[l]-a)+" or less than 0 for input of ")+("shape "+n.shape)})},o=0;o<n.rank;o++)i(o);var s={paddings:e,mode:t},u={x:n};return Q.runKernel(UD,u,s)}var mae=J({mirrorPad_:vae});function gae(r,e){var t,n=L(r,"a","mod"),a=L(e,"b","mod");t=Ge(Ir(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(HD,i)}var yae=J({mod_:gae});function bae(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1),r=L(r,"x","moments");var n=Bf(e,r.shape),a=Hd(r,n,t),i=a.shape;t||(i=Vf(a.shape,n));var o=gi(At(Or(r,"float32"),Ee(a,i))),s=Hd(o,n,t);return{mean:a,variance:s}}var wae=J({moments_:bae});function xae(r,e,t,n){for(var a=L(e,"data","multiRNNCell"),i=Af(t,"c","multiRNNCell"),o=Af(n,"h","multiRNNCell"),s=a,u=[],l=0;l<r.length;l++){var c=r[l](s,i[l],o[l]);u.push(c[0]),u.push(c[1]),s=c[1]}for(var f=[],h=[],l=0;l<u.length;l+=2)f.push(u[l]),h.push(u[l+1]);return[f,h]}var kae=J({multiRNNCell_:xae});function Sae(r,e,t,n){n===void 0&&(n=!1);var a=L(r,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+(i+"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);t=t||Math.random();var s=o===1?Ee(a,[1,-1]):a,u={logits:s},l={numSamples:e,seed:t,normalized:n},c=Q.runKernel(KD,u,l);return o===1?Ee(c,[c.size]):c}var Nae=J({multinomial_:Sae});function Eae(r,e){var t,n=L(r,"a","notEqual","string_or_numeric"),a=L(e,"b","notEqual","string_or_numeric");t=Ge(Ir(n,a),2),n=t[0],a=t[1],Hr(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(YD,i)}var NR=J({notEqual_:Eae});function Tae(r){var e=L(r,"x","onesLike"),t={x:e};return Q.runKernel(e3,t)}var Iae=J({onesLike_:Tae});function Cae(r,e){var t=L(r,"v1","outerProduct"),n=L(e,"v2","outerProduct");G(t.rank===1&&n.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+(t.rank+" and "+n.rank+".")});var a=Ee(t,[-1,1]),i=Ee(n,[1,-1]);return Wt(a,i)}var Aae=J({outerProduct_:Cae});function _ae(r,e,t){t===void 0&&(t=0);var n=L(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:n};return Q.runKernel(n3,i,a)}var Gf=J({pad_:_ae});function Dae(r,e,t){return t===void 0&&(t=0),G(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Gf(r,[e],t)}var Fae=J({pad1d_:Dae});function Rae(r,e,t){return t===void 0&&(t=0),G(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Gf(r,e,t)}var Oae=J({pad2d_:Rae});function Pae(r,e,t){return t===void 0&&(t=0),G(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Gf(r,e,t)}var Mae=J({pad3d_:Pae});function Bae(r,e,t){return t===void 0&&(t=0),G(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Gf(r,e,t)}var Lae=J({pad4d_:Bae});function zae(r,e,t){var n=L(r,"x","spaceToBatchND");G(n.rank>=1+e.length,function(){return"input rank "+n.rank+" should be > than [blockShape] "+e.length}),G(t.length===e.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length}),G(n.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions "+n.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()});var a={x:n},i={blockShape:e,paddings:t};return Q.runKernel(F3,a,i)}var ER=J({spaceToBatchND_:zae});function $ae(r,e,t,n,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),n===0&&(n="valid");var s=L(r,"x","maxPool"),u=s,l=!1;s.rank===3&&(l=!0,u=Ee(s,[1,s.shape[0],s.shape[1],s.shape[2]])),G(mo(i,a),function(){return"Error in pool: Either strides or dilations must be 1. "+("Got strides "+i+" and dilations '"+a+"'")});var c=QF(u.shape,e,i,a,n),f=[c.dilationHeight,c.dilationWidth],h;n==="same"?h=qae([c.filterHeight,c.filterWidth],f):h=[[0,0],[0,0]];var p=f[0]===1&&f[1]===1,d=Ge(Wae([c.inHeight,c.inWidth],f,h),2),m=d[0],v=d[1],g=p?n:"valid",y=p?u:ER(u,f,m),b=t==="avg"?function(){return rR(y,e,i,g,o)}:function(){return xR(y,e,i,g,o)},w=b(),x=p?w:nR(w,f,v);return l?Ee(x,[x.shape[1],x.shape[2],x.shape[3]]):x}function Wae(r,e,t){var n=t.map(function(c){return c[0]}),a=t.map(function(c){return c[1]}),i=r.concat(n,a),o=e.map(function(c,f){return(c-i[f]%c)%c}),s=a.map(function(c,f){return c+o[f]}),u=e.map(function(c,f){return[n[f],s[f]]}),l=e.map(function(c,f){return[0,o[f]]});return[u,l]}function qae(r,e){var t=r.map(function(o,s){return o+(o-1)*(e[s]-1)}),n=t.map(function(o){return o-1}),a=n.map(function(o){return Math.floor(o/2)}),i=n.map(function(o,s){return o-a[s]});return n.map(function(o,s){return[a[s],i[s]]})}var Vae=J({pool_:$ae});function Gae(r,e){var t=L(r,"x","prelu"),n=L(e,"alpha","prelu"),a={x:t,alpha:n};return Q.runKernel(i3,a)}var TR=J({prelu_:Gae});function Uae(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=L(r,"x","prod");n.dtype==="bool"&&(n=Or(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return Q.runKernel(o3,a,i)}var Hae=J({prod_:Uae});function Kae(r,e,t,n){var a=r.map(function(c,f){return L(c,"tensors"+f,"raggedGather","int32")}),i=L(e,"paramsDenseValues","raggedGather"),o=L(t,"indices","raggedGather","int32"),s={paramsNestedSplits:a,paramsDenseValues:i,indices:o},u={outputRaggedRank:n},l=Q.runKernel(s3,s,u);return{outputNestedSplits:l.slice(0,l.length-1),outputDenseValues:l[l.length-1]}}var jae=J({raggedGather_:Kae});function Xae(r,e,t,n,a){var i=L(r,"shape","raggedTensorToTensor","int32"),o=L(e,"values","raggedTensorToTensor"),s=L(t,"defaultValue","raggedTensorToTensor",o.dtype),u=n.map(function(f,h){return L(f,"tensors"+h,"raggedTensorToTensor","int32")}),l={shape:i,values:o,defaultValue:s,rowPartitionTensors:u},c={rowPartitionTypes:a};return Q.runKernel(u3,l,c)}var Yae=J({raggedTensorToTensor_:Xae});function Zae(r,e,t){var n=ir(r),a=null;if(t==null||t==="float32")a=new Float32Array(n);else if(t==="int32")a=new Int32Array(n);else if(t==="bool")a=new Uint8Array(n);else throw new Error("Unknown data type "+t);for(var i=0;i<n;i++)a[i]=e();return Q.makeTensor(a,r,t)}var Jae=J({rand_:Zae}),Qs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function eu(r){var e={exports:{}};return r(e,e.exports),e.exports}var Qae=eu(function(r){(function(e,t,n){function a(u){var l=this,c=s();l.next=function(){var f=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=f-(l.c=f|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(u),l.s0<0&&(l.s0+=1),l.s1-=c(u),l.s1<0&&(l.s1+=1),l.s2-=c(u),l.s2<0&&(l.s2+=1),c=null}function i(u,l){return l.c=u.c,l.s0=u.s0,l.s1=u.s1,l.s2=u.s2,l}function o(u,l){var c=new a(u),f=l&&l.state,h=c.next;return h.int32=function(){return c.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,c),h.state=function(){return i(c,{})}),h}function s(){var u=4022871197,l=function(c){c=String(c);for(var f=0;f<c.length;f++){u+=c.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return l}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(Qs,r,!1)}),eie=eu(function(r){(function(e,t,n){function a(s){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(Qs,r,!1)}),tie=eu(function(r){(function(e,t,n){function a(s){var u=this,l="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(Qs,r,!1)}),rie=eu(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var c=u.x,f=u.i,h,p;return h=c[f],h^=h>>>7,p=h^h<<24,h=c[f+1&7],p^=h^h>>>10,h=c[f+3&7],p^=h^h>>>3,h=c[f+4&7],p^=h^h<<7,h=c[f+7&7],h=h^h<<13,p^=h^h<<9,c[f]=p,u.i=f+1&7,p};function l(c,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8&&(p[7]=-1),c.x=p,c.i=0,h=256;h>0;--h)c.next()}l(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(c.x&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(Qs,r,!1)}),nie=eu(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var c=u.w,f=u.X,h=u.i,p,d;return u.w=c=c+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(c^c>>>16)|0};function l(c,f){var h,p,d,m,v,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,m=-32;m<y;++m)f&&(p^=f.charCodeAt((m+32)%f.length)),m===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(v=v+1640531527|0,h=g[m&127]^=p+v,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,m=4*128;m>0;--m)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;c.w=v,c.X=g,c.i=d}l(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(c.X&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(Qs,r,!1)}),aie=eu(function(r){(function(e,t,n){function a(s){var u=this,l="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)u.b^=l.charCodeAt(c)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(Qs,r,!1)}),tu=eu(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),l=n.pow(2,o),c=l*2,f=a-1,h;function p(w,x,k){var N=[];x=x==!0?{entropy:!0}:x||{};var T=g(v(x.entropy?[w,b(t)]:w??y(),3),N),I=new d(N),F=function(){for(var D=I.g(i),R=u,P=0;D<l;)D=(D+P)*a,R*=a,P=I.g(1);for(;D>=c;)D/=2,R/=2,P>>>=1;return(D+P)/R};return F.int32=function(){return I.g(4)|0},F.quick=function(){return I.g(4)/4294967296},F.double=F,g(b(I.S),t),(x.pass||k||function(D,R,P,B){return B&&(B.S&&m(B,I),D.state=function(){return m(I,{})}),P?(n[s]=D,R):D})(F,T,"global"in x?x.global:this==n,x.state)}function d(w){var x,k=w.length,N=this,T=0,I=N.i=N.j=0,F=N.S=[];for(k||(w=[k++]);T<a;)F[T]=T++;for(T=0;T<a;T++)F[T]=F[I=f&I+w[T%k]+(x=F[T])],F[I]=x;(N.g=function(D){for(var R,P=0,B=N.i,q=N.j,O=N.S;D--;)R=O[B=f&B+1],P=P*a+O[f&(O[B]=O[q=f&q+R])+(O[q]=R)];return N.i=B,N.j=q,P})(a)}function m(w,x){return x.i=w.i,x.j=w.j,x.S=w.S.slice(),x}function v(w,x){var k=[],N=typeof w,T;if(x&&N=="object")for(T in w)try{k.push(v(w[T],x-1))}catch{}return k.length?k:N=="string"?w:w+"\0"}function g(w,x){for(var k=w+"",N,T=0;T<k.length;)x[f&T]=f&(N^=x[f&T]*19)+k.charCodeAt(T++);return b(x)}function y(){try{var w;return h&&(w=h.randomBytes)?w=w(a):(w=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var x=e.navigator,k=x&&x.plugins;return[+new Date,e,k,e.screen,b(t)]}}function b(w){return String.fromCharCode.apply(0,w)}if(g(n.random(),t),r.exports){r.exports=p;try{h=Id()}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:Qs,[],Math)});tu.alea=Qae;tu.xor128=eie;tu.xorwow=tie;tu.xorshift7=rie;tu.xor4096=nie;tu.tychei=aie;var Q0=tu;var eb=function(){function r(e,t,n,a,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);var o=i||Math.random();this.random=Q0.alea(o.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,a=!1;!a;){var i=void 0,o=void 0,s=void 0;do i=2*this.random()-1,o=2*this.random()-1,s=i*i+o*o;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*i*u,n=this.mean+this.stdDev*o*u,(!this.truncated||this.isValidTruncated(t))&&(a=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)},r.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},r.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},r}(),iie=function(){function r(e,t,n,a){this.alpha=e,this.beta=1/t,this.dtype=n;var i=a||Math.random();this.randu=Q0.alea(i.toString()),this.randn=new eb(0,1,n,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var e,t,n,a,i,o;;){do a=this.randn.nextValue(),o=1+this.c*a;while(o<=0);if(o*=o*o,e=a*a,t=1-.331*e*e,n=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<t||Math.log(i)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},r.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},r}(),oie=function(){function r(e,t,n,a){var i=this;if(e===void 0&&(e=0),t===void 0&&(t=1),this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=n,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=Q0.alea(a)}return r.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r}();function sie(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t==null&&(t=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error("Unsupported data type "+n);for(var i=new iie(e,t,n,a),o=ho(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var uie=J({randomGamma_:sie});function lie(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),n!=null&&n==="bool")throw new Error("Unsupported data type "+n);for(var i=new eb(e,t,n,!1,a),o=ho(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var IR=J({randomNormal_:lie});function cie(r,e,t){if(e!=null&&e==="bool")throw new Error("Unsupported data type "+e);return IR(r,0,1,e,t)}var fie=J({randomStandardNormal_:cie});function hie(r,e,t,n,a){e===void 0&&(e=0),t===void 0&&(t=1),n===void 0&&(n="float32");for(var i=ho(r,n),o=new oie(e,t,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}var CR=J({randomUniform_:hie});function Of(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t===0)throw new Error("Cannot have a step of zero");var a={start:r,stop:e,step:t,dtype:n};return Q.runKernel(l3,{},a)}function pie(r){var e=L(r,"x","reciprocal"),t={x:e};return Q.runKernel(f3,t)}var die=J({reciprocal_:pie});function vie(r){var e=L(r,"x","relu"),t={x:e};return Q.runKernel(h3,t)}var av=J({relu_:vie});function mie(r){var e=L(r,"x","relu6"),t={x:e};return Q.runKernel(m3,t)}var AR=J({relu6_:mie});function gie(r,e){var t=L(r,"x","reverse"),n={x:t},a={dims:e};return Q.runKernel(g3,n,a)}var Ys=J({reverse_:gie});function yie(r){var e=L(r,"x","reverse");return G(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),Ys(e,0)}var bie=J({reverse1d_:yie});function wie(r,e){var t=L(r,"x","reverse");return G(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),Ys(t,e)}var xie=J({reverse2d_:wie});function kie(r,e){var t=L(r,"x","reverse");return G(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),Ys(t,e)}var Sie=J({reverse3d_:kie});function Nie(r,e){var t=L(r,"x","reverse");return G(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),Ys(t,e)}var Eie=J({reverse4d_:Nie});function Tie(r){var e=L(r,"x","round"),t={x:e};return Q.runKernel(y3,t)}var _R=J({round_:Tie});function Iie(r){var e=L(r,"x","rsqrt","float32"),t={x:e};return Q.runKernel(b3,t)}var Cie=J({rsqrt_:Iie});function Aie(r){var e=L(r,"x","selu"),t={x:e};return Q.runKernel(S3,t)}var _ie=J({selu_:Aie});function Die(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC");var s=L(r,"x","separableConv2d"),u=L(e,"depthwiseFilter","separableConv2d"),l=L(t,"pointwiseFilter","separableConv2d"),c=s,f=!1;if(s.rank===3&&(f=!0,c=Ee(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");G(c.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got "+("rank "+c.rank+".")}),G(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+("got rank "+u.rank+".")}),G(l.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+("got rank "+u.rank+".")}),G(l.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter "+(" must be 1, but got "+l.shape[0]+".")}),G(l.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise "+("filter must be 1, but got "+l.shape[1]+".")});var h=u.shape[2],p=u.shape[3];G(l.shape[2]===h*p,function(){return"Error in separableConv2d: the third dimension of pointwise filter "+("must be "+h*p+", ")+("but got "+l.shape[2]+".")});var d=X0(c,u,n,a,o,i),m=1,v=ev(d,l,m,"valid",o);return f?Ee(v,[v.shape[1],v.shape[2],v.shape[3]]):v}var Fie=J({separableConv2d_:Die});function Rie(r,e){return Ke(this,void 0,void 0,function(){var t,n,a,i,o,s,c,u,l,c,f;return je(this,function(h){switch(h.label){case 0:return t=L(r,"x","setdiff1d"),n=L(e,"y","setdiff1d"),G(t.dtype===n.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+n.dtype+")."}),G(t.rank===1,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),G(n.rank===1,function(){return"y should be 1D tensor, but got y ("+n.shape+")."}),[4,t.data()];case 1:return a=h.sent(),[4,n.data()];case 2:for(i=h.sent(),o=new Set(i),s=0,c=0;c<a.length;c++)o.has(a[c])||s++;for(u=new $d([s],t.dtype),l=new $d([s],"int32"),c=0,f=0;c<a.length;c++)o.has(a[c])||(u.values[f]=a[c],l.values[f]=c,f++);return[2,[u.toTensor(),l.toTensor()]]}})})}var Oie=Rie;function Pie(r){var e=L(r,"x","sign"),t={x:e};return Q.runKernel(I3,t)}var Mie=J({sign_:Pie});function Bie(r){var e=L(r,"x","sin","float32"),t={x:e};return Q.runKernel(E3,t)}var Lie=J({sin_:Bie});function zie(r){var e=L(r,"x","sinh"),t={x:e};return Q.runKernel(T3,t)}var $ie=J({sinh_:zie});function Wie(r,e,t){var n=L(r,"x","slice1d");return G(n.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+n.rank+" tensor"}),kr(n,[e],[t])}var qie=J({slice1d_:Wie});function Vie(r,e,t){var n=L(r,"x","slice2d");return G(n.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+n.rank+" tensor"}),kr(n,e,t)}var Gie=J({slice2d_:Vie});function Uie(r,e,t){var n=L(r,"x","slice3d");return G(n.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+n.rank+" tensor"}),kr(n,e,t)}var Hie=J({slice3d_:Uie});function Kie(r,e,t){var n=L(r,"x","slice4d");return G(n.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+n.rank+" tensor"}),kr(n,e,t)}var jie=J({slice4d_:Kie});function Xie(r,e){e===void 0&&(e=-1);var t=L(r,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+("Logits was rank "+t.rank+" and dim was "+e));var n={logits:t},a={dim:e};return Q.runKernel(O3,n,a)}var Yie=J({softmax_:Xie});function Zie(r){G(r.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 "+("but got "+r.dtype+".")});var e={input:r};return Q.runKernel(hD,e)}var tb=J({fft_:Zie});function Jie(r){G(r.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 "+("but got "+r.dtype+".")});var e={input:r};return Q.runKernel(kD,e)}var Kd=J({ifft_:Jie});function Qie(r){var e=r.shape[r.shape.length-1],t=r.size/e,n;if(e<=2){var a=Ee(r,[t,e]);n=Kd(a)}else{var i=[t,2*(e-1)],o=Ee(_f(r),[t,e]),s=Ee(Jd(r),[t,e]),u=Ys(kr(o,[0,1],[t,e-2]),1),l=Pe(Ys(kr(s,[0,1],[t,e-2]),1),qt(-1)),c=ea([o,u],1),f=ea([s,l],1),a=Ee(es(c,f),[i[0],i[1]]);n=Kd(a)}if(n=_f(n),r.rank===3&&r.shape[0]!==0){var h=n,p=r.shape[0];n=Ee(n,[p,n.shape[0]/p,n.shape[1]]),h.dispose()}return n}var DR=J({irfft_:Qie});function eoe(r,e,t){t===void 0&&(t=0);var n=L(r,"x","split"),a={x:n},i={numOrSizeSplits:e,axis:t};return Q.runKernel(R3,a,i)}var Pf=J({split_:eoe});function toe(r,e){G(r.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+r.dtype});var t=r.shape[r.shape.length-1],n=r.size/t,a;if(e!=null&&e<t){var i=r.shape.map(function(g){return 0}),o=r.shape.map(function(g){return g});o[r.shape.length-1]=e,a=kr(r,i,o),t=e}else if(e!=null&&e>t){var s=r.shape.map(function(g){return g});s[r.shape.length-1]=e-t,a=ea([r,Al(s)],r.shape.length-1),t=e}else a=r;var u=Ta(a),l=Ee(es(a,u),[n,t]),c=tb(l),f=Math.floor(t/2)+1,h=_f(c),p=Jd(c),d=Pf(h,[f,t-f],h.shape.length-1),m=Pf(p,[f,t-f],p.shape.length-1),v=a.shape.slice();return v[a.shape.length-1]=f,Ee(es(d[0],m[0]),v)}var rb=J({rfft_:toe});function roe(r,e){var t,n=L(r,"a","squaredDifference"),a=L(e,"b","squaredDifference");t=Ge(Ir(n,a),2),n=t[0],a=t[1],Hr(n.shape,a.shape);var i={a:n,b:a},o={};return Q.runKernel($3,i,o)}var FR=J({squaredDifference_:roe});function noe(r,e){var t=L(r,"x","squeeze","string_or_numeric");return Ee(t,o_(t.shape,e).newShape)}var nb=J({squeeze_:noe});function aoe(r,e){e===void 0&&(e=0);var t=Af(r,"tensors","stack","string_or_numeric");G(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&G(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var n=t,a={axis:e};return Q.runKernel(r3,n,a)}var Mf=J({stack_:aoe});function ioe(r,e){e===void 0&&(e=0);var t=L(r,"x","step"),n={x:t},a={alpha:e};return Q.runKernel(eF,n,a)}var RR=J({step_:ioe});function ooe(r,e,t,n,a,i,o,s,u){a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),u===void 0&&(u=0);var l=L(r,"x","stridedSlice","string_or_numeric"),c={x:l},f={begin:e,end:t,strides:n,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return Q.runKernel(W3,c,f)}var soe=J({stridedSlice_:ooe});function uoe(r){var e=L(r,"x","tan","float32"),t={x:e};return Q.runKernel(H3,t)}var loe=J({tan_:uoe});function mi(r,e){Zs(r);var t=Ui(r,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");var n=null;return ns(r,n,t,e)}function Nf(r,e,t){if(Zs(r),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var n=Ui(r,t);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return ns(r,e,n,t)}function coe(r,e,t){if(Zs(r),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var n=Ui(r,t);if(n.length!==4&&n.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return ns(r,e,n,t)}function foe(r,e,t){if(Zs(r),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var n=Ui(r,t);if(n.length!==5&&n.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return ns(r,e,n,t)}function hoe(r,e,t){if(Zs(r),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var n=Ui(r,t);if(n.length!==6&&n.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||n,ns(r,e,n,t)}function poe(r,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var n=L(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=n.shape[n.shape.length-1];if(e<0)throw new Error("'k' passed to topk() must be >= 0 but got "+e);if(e>a)throw new Error("'k' passed to topk() must be <= the last dimension ("+a+") "+("but got "+e));var i={x:n},o={k:e,sorted:t},s=Ge(Q.runKernel(j3,i,o),2),u=s[0],l=s[1];return{values:u,indices:l}}var doe=J({topk_:poe});function voe(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),n!=null&&n==="bool")throw new Error("Unsupported data type $ { dtype }");for(var i=new eb(e,t,n,!0,a),o=ho(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var moe=J({truncatedNormal_:voe});function goe(r,e){e===void 0&&(e=0);var t=L(r,"x","unique","string_or_numeric");G(t.rank>0,function(){return"The input tensor must be at least 1D"});var n={x:t},a={axis:e},i=Ge(Q.runKernel(Y3,n,a),2),o=i[0],s=i[1];return{values:o,indices:s}}var yoe=J({unique_:goe});function boe(r,e,t){var n=L(r,"x","unsortedSegmentSum"),a=L(e,"segmentIds","unsortedSegmentSum","int32");G(El(t),function(){return"numSegments must be of dtype int"});var i={x:n,segmentIds:a},o={numSegments:t};return Q.runKernel(J3,i,o)}var woe=J({unsortedSegmentSum_:boe});function xoe(r,e){e===void 0&&(e=0);var t=L(r,"x","unstack","string_or_numeric");G(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"});var n={value:t},a={axis:e};return Q.runKernel(Z3,n,a)}var ab=J({unstack_:xoe});function koe(r,e){return J0(r,e,"right")}function Soe(r,e,t,n){return e===void 0&&(e=!0),Q.makeVariable(r,e,t,n)}function OR(r,e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(n);for(var a=ho(r,"int32"),i=ho([t.length,r.length],"int32"),n=0;n<t.length;n++){var o=a.indexToLoc(t[n]),s=n*r.length;i.values.set(o,s)}return i.toTensor()}function Noe(r){return Ke(this,void 0,void 0,function(){var e,t,n;return je(this,function(a){switch(a.label){case 0:return e=L(r,"condition","whereAsync","bool"),[4,e.data()];case 1:return t=a.sent(),n=OR(e.shape,t),r!==e&&e.dispose(),[2,n]}})})}var PR=Noe;function Eoe(r,e,t){return Ke(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,f,h,p,d,m;return je(this,function(v){switch(v.label){case 0:for(n=L(r,"tensor","boolMask"),a=L(e,"mask","boolMask","bool"),i=t??0,o=a.rank,s=n.shape,G(o>0,function(){return"mask cannot be scalar"}),En(s.slice(i,i+o),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=i;l<i+o;l++)u*=s[l];return c=s.slice(0,i).concat([u],s.slice(i+o)),f=Ee(n,c),h=Ee(a,[-1]),[4,PR(h)];case 1:return p=v.sent(),d=nb(p,[1]),m=hR(f,d,i),r!==n&&n.dispose(),e!==a&&a.dispose(),d.dispose(),f.dispose(),h.dispose(),p.dispose(),[2,m]}})})}var Toe=Eoe;function Ioe(r,e,t,n,a){a===void 0&&(a=!0);var i=L(r,"v","movingAverage"),o=L(e,"x","movingAverage"),s=L(t,"decay","movingAverage");cF(i,o),G(rs(i.shape,o.shape),function(){return"Shape mismatch in v and x"});var u=qt(1),l=At(u,s),c=Pe(At(o,i),l);if(a){G(n!=null,function(){return"When using zeroDebias: true, step is required."});var f=L(n,"step","movingAverage");c=ar(c,At(u,Ff(s,f)))}return pt(i,c)}var Coe=J({movingAverage_:Ioe});function Aoe(r,e,t){var n=L(r,"indices","scatterND","int32"),a=L(e,"updates","scatterND");U0(a,n,t);var i={indices:n,updates:a},o={shape:t};return Q.runKernel(w3,i,o)}var _oe=J({scatterND_:Aoe});function Doe(r,e,t,n){if(r.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+(" but the dtype was "+r.dtype+"."));if(r.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+(" but got shape "+r.shape+"."));var a=r.rank>0?r.shape[0]:1,i=r.rank>1?r.shape[1]:1;if(t.length!==i)throw new Error("outputShape has incorrect number of elements:,"+(" "+t.length+", should be: "+i+"."));var o=e.size;if(!(e.rank===0||e.rank===1&&o===a))throw new Error("sparseValues has incorrect shape "+(e.shape+", should be [] or ["+a+"]"));if(e.dtype!==n.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function Foe(r,e,t,n){n===void 0&&(n=0);var a=L(r,"sparseIndices","sparseToDense","int32"),i=L(e,"sparseValues","sparseToDense","string_or_numeric"),o=L(n,"defaultValue","sparseToDense",i.dtype);Doe(a,i,t,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:t};return Q.runKernel(z3,s,u)}var Roe=J({sparseToDense_:Foe});function Ooe(r,e){var t=L(e,"indices","gatherND","int32"),n=L(r,"x","gatherND","string_or_numeric"),a={params:n,indices:t};return Q.runKernel(bD,a)}var Poe=J({gatherND_:Ooe});function Moe(r,e){if(e==null)return r.shape.slice();if(rs(r.shape,e))return e;if(r.shape.length===e.length){for(var t=[],n=0;n<r.shape.length;n++)e[n]==null&&r.shape[n]!=null?t.push(r.shape[n]):t.push(e[n]);return t}return e}function Boe(r,e,t,n){var a=L(r,"x","dropout");if(G(a.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be "+("scaled, but got a "+a.dtype+" tensor instead.")}),G(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),e===0)return r instanceof Gr?a.clone():a;var i=Moe(a,t),o=1-e,s=ar(fR(pt(CR(i,0,1,"float32",n),o)),o);return Pe(a,s)}var Loe=J({dropout_:Boe});function MR(r){return Math.floor(Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))))}function ib(r,e,t){for(var n=1-r%2,a=new Float32Array(r),i=0;i<r;++i){var o=2*Math.PI*i/(r+n-1);a[i]=e-t*Math.cos(o)}return mi(a,"float32")}function zoe(r,e,t){return t===void 0&&(t=1),Ke(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,f,h,p,d,m,v,v;return je(this,function(g){switch(g.label){case 0:return n=L(r,"predictions","inTopK"),a=L(e,"targets","inTopK"),G(n.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, "+("but got "+n.rank)}),G(n.rank-1===a.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+(n.rank+" and targets rank "+a.rank)}),En(n.shape.slice(0,n.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=n.shape[n.shape.length-1],G(t>0&&t<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last "+("dimension ("+i+"), but got "+t)}),[4,n.data()];case 1:return o=g.sent(),[4,a.data()];case 2:for(s=g.sent(),u=Ge([o.length/i,i],2),l=u[0],c=u[1],f=s_("bool",l),h=0;h<l;h++){for(p=h*c,d=o.subarray(p,p+c),m=[],v=0;v<d.length;v++)m.push({value:d[v],index:v});for(m.sort(function(y,b){return b.value-y.value}),f[h]=0,v=0;v<t;v++)if(m[v].index===s[h]){f[h]=1;break}}return r!==n&&n.dispose(),e!==a&&a.dispose(),[2,wl(f,a.shape,"bool")]}})})}var $oe=zoe;function Woe(r,e,t,n,a,i,o){i===void 0&&(i="NHWC");var s=r;r.rank===3&&(s=Ee(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=Ee(e,[1,e.shape[0],e.shape[1],e.shape[2]])),G(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+(s.shape+".")}),G(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+(u.shape+".")}),G(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+(t+".")});var l=i==="NHWC"?s.shape[3]:s.shape[1],c=i==="NHWC"?u.shape[3]:u.shape[1];G(l===t[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must "+("match input depth in filter ("+t[2]+".")}),G(c===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must "+("match output depth for filter ("+t[3]+").")}),Ga("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return Q.runKernel(q_,f,h)}var qoe=J({conv2DBackpropFilter_:Woe});function iv(r,e,t){if(t==null||t==="linear")return r;if(t==="relu")return Pe(r,RR(e));throw new Error("Cannot compute gradient for fused activation "+t+".")}function ov(r,e){var t=e,n=V0(r.shape,e.shape);return n.length>0&&(t=nr(t,n)),Ee(t,r.shape)}function sv(r,e,t,n){if(e==="linear")return r;if(e==="relu")return av(r);if(e==="elu")return sR(r);if(e==="relu6")return AR(r);if(e==="prelu")return TR(r,t);if(e==="leakyrelu")return dR(r,n);if(e==="sigmoid")return Sl(r);throw new Error("Unknown fused activation "+e+".")}var uv=function(r,e){var t=r>0;return!t||e==="linear"};function Voe(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,l=u===void 0?[1,1]:u,c=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,m=r.leakyreluAlpha;if(p=p||"linear",uv(Q.state.gradientDepth,p)===!1){G(s==="NHWC",function(){return"Error in fused conv2d: got dataFormat of "+s+" but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."});var v=ev(t,n,a,i,s,l,c);return f!=null&&(v=pt(v,f)),sv(v,p,d,m)}var g=L(t,"x","conv2d","float32"),y=L(n,"filter","conv2d","float32"),b=g,w=!1;g.rank===3&&(w=!0,b=Ee(g,[1,g.shape[0],g.shape[1],g.shape[2]])),G(b.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+(b.rank+".")}),G(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+(y.rank+".")}),Ga("fused conv2d",i,c);var x=s==="NHWC"?b.shape[3]:b.shape[1];G(y.shape[2]===x,function(){return"Error in conv2d: depth of input ("+x+") must match "+("input depth for filter "+y.shape[2]+".")}),G(mo(a,l),function(){return"Error in conv2D: Either strides or dilations must be 1. "+("Got strides "+a+" and dilations '"+l+"'")});var k=Wf(b.shape,y.shape,a,l,i,c),N;f!=null&&(N=L(f,"bias","fused conv2d"),e=Ge(Ir(N,g),1),N=e[0],s==="NHWC"?Hr(k.outShape,N.shape):(G(N.shape.length<=1,function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+("rank-"+N.shape.length+".")}),G(N.shape.length===0||N.shape[0]===k.outChannels||N.shape[0]===1,function(){return"Error in fused conv2d: bias shape ("+N.shape+") is not compatible with the number of output channels "+("("+k.outChannels+")")})));var T;if(d!=null){var I=d.shape;if(G(I.length<=1||I.length===3,function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+("rank-"+I.length+".")}),I.length===1)G(I[0]===1||I[0]===k.outChannels,function(){return"Error in fused conv2d: PReLU activation weights "+("("+I+") is not compatible with the number of output ")+("channels ("+k.outChannels+").")});else if(I.length===3)try{Hr(I,k.outShape)}catch{var F="Error in fused conv2d: PReLU activation weights ("+I+") is not compatible with the output shape of the conv2d "+("("+k.outShape+").");throw Error(F)}T=L(d,"prelu weights","fused conv2d")}var D=function(O,V){G(s==="NHWC",function(){return"Error in gradient of fused conv2D: got dataFormat of "+s+" but only NHWC is currently supported."});var K=Ge(V,4),Z=K[0],j=K[1],ee=K[2],le=K[3],se=iv(O,ee,p);G(Df(l),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+("are not yet supported in gradients. Got dilations '"+l+"'")});var ce=iR(j.shape,se,Z,a,i),he=qoe(j,se,Z.shape,a,i),xe=[ce,he];if(le!=null){var Se=ov(le,se);xe.push(Se)}return xe},R={x:b,filter:y,bias:N,preluActivationWeights:T},P={strides:a,pad:i,dataFormat:s,dilations:l,dimRoundingMode:c,activation:p,leakyreluAlpha:m};if(f==null){var B=Hi(function(O,V,K){var Z=Q.runKernel(a0,R,P);return K([V,O,Z]),w&&(Z=Ee(Z,[Z.shape[1],Z.shape[2],Z.shape[3]])),{value:Z,gradFunc:D}});return B(b,y)}else{var q=Hi(function(O,V,K,Z){var j=Q.runKernel(a0,R,P);return Z([V,O,j,K]),w&&(j=Ee(j,[j.shape[1],j.shape[2],j.shape[3]])),{value:j,gradFunc:D}});return q(b,y,N)}}var Goe=J({fusedConv2d_:Voe});function Uoe(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=r;r.rank===3&&(s=Ee(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=Ee(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var l={x:s,dy:u},c={strides:n,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return Q.runKernel(eD,l,c)}var Hoe=J({depthwiseConv2dNativeBackpropFilter_:Uoe});function Koe(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=Ee(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var l={dy:s,filter:t},c={strides:n,pad:a,dimRoundingMode:o,dilations:i,inputShape:r},f=Q.runKernel(tD,l,c);return u?Ee(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var joe=J({depthwiseConv2dNativeBackpropInput_:Koe});function Xoe(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,l=u===void 0?[1,1]:u,c=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,m=r.leakyreluAlpha;if(uv(Q.state.gradientDepth,p)===!1){var v=X0(t,n,a,i,s,l,c);return f!=null&&(v=pt(v,f)),sv(v,p,d,m)}var g=L(t,"x","depthwiseConv2d","float32"),y=L(n,"filter","depthwiseConv2d","float32"),b=g,w=!1;g.rank===3&&(w=!0,b=Ee(g,[1,g.shape[0],g.shape[1],g.shape[2]])),G(b.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+("rank "+b.rank+".")}),G(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+("but got rank "+y.rank+".")}),G(b.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels "+("("+b.shape[3]+") must match the inChannels dimension in ")+("filter "+y.shape[2]+".")}),l==null&&(l=[1,1]),G(mo(a,l),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+("be 1. Got strides "+a+" and dilations '"+l+"'")}),Ga("fused depthwiseConv2d",i,c);var x=Wf(b.shape,y.shape,a,l,i,c,!0),k;f!=null&&(k=L(f,"bias","fused conv2d"),e=Ge(Ir(k,g),1),k=e[0],Hr(x.outShape,k.shape));var N;d!=null&&(N=L(d,"prelu weights","fused depthwiseConv2d"));var T=function(P,B){G(Df(l),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+("'"+l+"'")});var q=Ge(B,4),O=q[0],V=q[1],K=q[2],Z=q[3],j=iv(P,K,p),ee=joe(V.shape,j,O,a,i,l,c),le=Hoe(V,j,O.shape,a,i,l,c);if(Z!=null){var se=ov(k,j);return[ee,le,se]}return[ee,le]},I={x:b,filter:y,bias:k,preluActivationWeights:N},F={strides:a,pad:i,dataFormat:s,dilations:l,dimRoundingMode:c,activation:p,leakyreluAlpha:m};if(f==null){var D=Hi(function(P,B,q){var O=Q.runKernel(i0,I,F);return q([B,P,O]),w&&(O=Ee(O,[O.shape[1],O.shape[2],O.shape[3]])),{value:O,gradFunc:T}});return D(b,y)}else{var R=Hi(function(P,B,q,O){var V=Q.runKernel(i0,I,F);return O([B,P,V,q]),w&&(V=Ee(V,[V.shape[1],V.shape[2],V.shape[3]])),{value:V,gradFunc:T}});return R(b,y,k)}}var Yoe=J({fusedDepthwiseConv2d_:Xoe});function Zoe(r){var e,t,n=r.a,a=r.b,i=r.transposeA,o=i===void 0?!1:i,s=r.transposeB,u=s===void 0?!1:s,l=r.bias,c=r.activation,f=c===void 0?"linear":c,h=r.preluActivationWeights,p=r.leakyreluAlpha,d=p===void 0?.2:p;if(uv(Q.state.gradientDepth,f)===!1){var m=Wt(n,a,o,u);return l!=null&&(m=pt(m,l)),sv(m,f,h,d)}var v=L(n,"a","fused matMul"),g=L(a,"b","fused matMul");e=Ge(Ir(v,g),2),v=e[0],g=e[1];var y=o?v.shape[v.rank-2]:v.shape[v.rank-1],b=u?g.shape[g.rank-1]:g.shape[g.rank-2],w=o?v.shape[v.rank-1]:v.shape[v.rank-2],x=u?g.shape[g.rank-2]:g.shape[g.rank-1],k=v.shape.slice(0,-2),N=g.shape.slice(0,-2),T=ir(k),I=ir(N);G(y===b,function(){return"Error in fused matMul: inner shapes ("+y+") and ("+(b+") of Tensors with shapes "+v.shape+" and ")+(g.shape+" and transposeA="+o)+(" and transposeB="+u+" must match.")});var F=Hr(v.shape.slice(0,-2),g.shape.slice(0,-2)),D=F.concat([w,x]),R=o?Ee(v,[T,y,w]):Ee(v,[T,w,y]),P=u?Ee(g,[I,x,b]):Ee(g,[I,b,x]),B;l!=null&&(B=L(l,"bias","fused matMul"),t=Ge(Ir(B,v),1),B=t[0],Hr(D,B.shape));var q;h!=null&&(q=L(h,"prelu weights","fused matMul"));var O=function(ee,le){var se=Ge(le,4),ce=se[0],he=se[1],xe=se[2],Se=se[3],we=iv(Ee(ee,xe.shape),xe,f),ke,Ne;if(!o&&!u?(ke=Wt(we,he,!1,!0),Ne=Wt(ce,we,!0,!1)):!o&&u?(ke=Wt(we,he,!1,!1),Ne=Wt(we,ce,!0,!1)):o&&!u?(ke=Wt(he,we,!1,!0),Ne=Wt(ce,we,!1,!1)):(ke=Wt(he,we,!0,!0),Ne=Wt(we,ce,!0,!0)),l!=null){var Ae=ov(Se,we);return[ke,Ne,Ae]}else return[ke,Ne]},V={a:R,b:P,bias:B,preluActivationWeights:q},K={transposeA:o,transposeB:u,activation:f,leakyreluAlpha:d};if(l==null){var Z=Hi(function(ee,le,se){var ce=Q.runKernel(n0,V,K);return se([ee,le,ce]),{value:Ee(ce,D),gradFunc:O}});return Z(R,P)}else{var j=Hi(function(ee,le,se,ce){var he=Q.runKernel(n0,V,K);return ce([ee,le,he,se]),{value:Ee(he,D),gradFunc:O}});return j(R,P,B)}}var Joe=J({fusedMatMul_:Zoe});var Qoe={__proto__:null,conv2d:Goe,depthwiseConv2d:Yoe,matMul:Joe};function ese(r){return ib(r,.54,.46)}var tse=J({hammingWindow_:ese});function rse(r){return ib(r,.5,.5)}var BR=J({hannWindow_:rse});function nse(r,e,t,n,a){n===void 0&&(n=!1),a===void 0&&(a=0);for(var i=0,o=[];i+e<=r.size;)o.push(kr(r,i,e)),i+=t;if(n)for(;i<r.size;){var s=i+e-r.size,u=ea([kr(r,i,e-s),qf([s],a)]);o.push(u),i+=t}return o.length===0?Nf([],[0,e]):Ee(ea(o),[o.length,e])}var LR=J({frame_:nse});function ase(r,e,t,n,a){a===void 0&&(a=BR),n==null&&(n=MR(e));var i=LR(r,e,t),o=Pe(i,a(e));return rb(o,n)}var ise=J({stft_:ase});function ose(r,e,t,n,a,i){a===void 0&&(a="bilinear"),i===void 0&&(i=0);var o=L(r,"image","cropAndResize"),s=L(e,"boxes","cropAndResize","float32"),u=L(t,"boxInd","cropAndResize","int32"),l=s.shape[0];G(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,"+("but got rank "+o.rank+".")}),G(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] "+("but had shape "+s.shape+".")}),G(u.rank===1&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] "+("but had shape "+s.shape+".")}),G(n.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+("length "+n.length+".")}),G(n[0]>=1&&n[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+n}),G(a==="bilinear"||a==="nearest",function(){return"method must be bilinear or nearest, but was "+a});var c={image:o,boxes:s,boxInd:u},f={method:a,extrapolationValue:i,cropSize:n},h=Q.runKernel(Y_,c,f);return h}var sse=J({cropAndResize_:ose});function use(r){var e=L(r,"image","flipLeftRight","float32");G(e.rank===4,function(){return"Error in flipLeftRight: image must be rank 4,"+("but got rank "+e.rank+".")});var t={image:e},n=Q.runKernel(dD,t,{});return n}var lse=J({flipLeftRight_:use});function cse(r){var e=L(r,"image","grayscaleToRGB"),t=e.rank-1,n=e.shape[t];G(e.rank>=2,function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+("but got rank "+e.rank+".")}),G(n===1,function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+("should be size 1, but got size "+n+".")});var a=new Array(e.rank);return a.fill(1,0,t),a[t]=3,Sf(e,a)}var fse=J({grayscaleToRGB_:cse});function hse(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=.5);var a=L(r,"image","rotateWithOffset","float32");G(a.rank===4,function(){return"Error in rotateWithOffset: image must be rank 4,"+("but got rank "+a.rank+".")});var i={image:a},o={radians:e,fillValue:t,center:n},s=Q.runKernel(tF,i,o);return s}var pse=J({rotateWithOffset_:hse});function Dl(r,e,t,n,a,i){n==null&&(n=.5),a==null&&(a=Number.NEGATIVE_INFINITY),i==null&&(i=0);var o=r.shape[0];return t=Math.min(t,o),G(0<=n&&n<=1,function(){return"iouThreshold must be in [0, 1], but was '"+n+"'"}),G(r.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+r.rank+"'"}),G(r.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+r.shape[1]}),G(e.rank===1,function(){return"scores must be a 1D tensor"}),G(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected "+o+", "+("but was "+e.shape[0])}),G(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"}),{maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i}}function dse(r,e,t,n,a){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var i=L(r,"boxes","nonMaxSuppression","float32"),o=L(e,"scores","nonMaxSuppression","float32"),s=Dl(i,o,t,n,a);t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:n,scoreThreshold:a};return Q.runKernel(ZD,{boxes:i,scores:o},u)}var vse=J({nonMaxSuppression_:dse});function mse(r,e,t){var n=gse(r,e,t),a=n<0?-(n+1):n;r.splice(a,0,e)}function gse(r,e,t){return bse(r,e,t||yse)}function yse(r,e){return r>e?1:r<e?-1:0}function bse(r,e,t){for(var n=0,a=r.length,i=0,o=!1;n<a;){i=n+(a-n>>>1);var s=t(e,r[i]);s>0?n=i+1:(a=i,o=!s)}return o?n:-n-1}function zR(r,e,t,n,a){return ob(r,e,t,n,a,0)}function $R(r,e,t,n,a,i){return ob(r,e,t,n,a,0,!1,i,!0)}function WR(r,e,t,n,a,i){return ob(r,e,t,n,a,i,!0)}function ob(r,e,t,n,a,i,o,s,u){o===void 0&&(o=!1),s===void 0&&(s=!1),u===void 0&&(u=!1);for(var l=[],c=0;c<e.length;c++)e[c]>a&&l.push({score:e[c],boxIndex:c,suppressBeginIndex:0});l.sort(e_);for(var f=i>0?-.5/i:0,h=[],p=[];h.length<t&&l.length>0;){var d=l.pop(),m=d.score,v=d.boxIndex,g=d.suppressBeginIndex;if(m<a)break;for(var y=!1,b=h.length-1;b>=g;--b){var w=wse(r,v,h[b]);if(w>=n){y=!0;break}if(d.score=d.score*xse(n,f,w),d.score<=a)break}d.suppressBeginIndex=h.length,y||(d.score===m?(h.push(v),p.push(d.score)):d.score>a&&mse(l,d,e_))}var x=h.length,k=t-x;s&&k>0&&(h.push.apply(h,Lt(new Array(k).fill(0))),p.push.apply(p,Lt(new Array(k).fill(0))));var N={selectedIndices:h};return o&&(N.selectedScores=p),u&&(N.validOutputs=x),N}function wse(r,e,t){var n=r.subarray(e*4,e*4+4),a=r.subarray(t*4,t*4+4),i=Math.min(n[0],n[2]),o=Math.min(n[1],n[3]),s=Math.max(n[0],n[2]),u=Math.max(n[1],n[3]),l=Math.min(a[0],a[2]),c=Math.min(a[1],a[3]),f=Math.max(a[0],a[2]),h=Math.max(a[1],a[3]),p=(s-i)*(u-o),d=(f-l)*(h-c);if(p<=0||d<=0)return 0;var m=Math.max(i,l),v=Math.max(o,c),g=Math.min(s,f),y=Math.min(u,h),b=Math.max(g-m,0)*Math.max(y-v,0);return b/(p+d-b)}function xse(r,e,t){var n=Math.exp(e*t*t);return t<=r?n:0}function e_(r,e){return r.score-e.score||r.score===e.score&&e.boxIndex-r.boxIndex}function kse(r,e,t,n,a){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),Ke(this,void 0,void 0,function(){var i,o,s,u,l,c,f;return je(this,function(h){switch(h.label){case 0:return i=L(r,"boxes","nonMaxSuppressionAsync"),o=L(e,"scores","nonMaxSuppressionAsync"),s=Dl(i,o,t,n,a),t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold,[4,Promise.all([i.data(),o.data()])];case 1:return u=h.sent(),l=u[0],c=u[1],f=zR(l,c,t,n,a).selectedIndices,i!==r&&i.dispose(),o!==e&&o.dispose(),[2,mi(f,"int32")]}})})}var Sse=kse;function Nse(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var o=L(r,"boxes","nonMaxSuppression"),s=L(e,"scores","nonMaxSuppression"),u=Dl(o,s,t,n,a,i);t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma;var l={boxes:o,scores:s},c={maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i},f=Q.runKernel(QD,l,c);return{selectedIndices:f[0],selectedScores:f[1]}}var Ese=J({nonMaxSuppressionWithScore_:Nse});function Tse(r,e,t,n,a,i){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),Ke(this,void 0,void 0,function(){var o,s,u,l,c,f,h,p,d;return je(this,function(m){switch(m.label){case 0:return o=L(r,"boxes","nonMaxSuppressionAsync"),s=L(e,"scores","nonMaxSuppressionAsync"),u=Dl(o,s,t,n,a,i),t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return l=m.sent(),c=l[0],f=l[1],h=WR(c,f,t,n,a,i),p=h.selectedIndices,d=h.selectedScores,o!==r&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:mi(p,"int32"),selectedScores:mi(d)}]}})})}var Ise=Tse;function Cse(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1);var o=L(r,"boxes","nonMaxSuppression"),s=L(e,"scores","nonMaxSuppression"),u=Dl(o,s,t,n,a,null),l=u.maxOutputSize,c=u.iouThreshold,f=u.scoreThreshold,h={boxes:o,scores:s},p={maxOutputSize:l,iouThreshold:c,scoreThreshold:f,padToMaxOutputSize:i},d=Q.runKernel(JD,h,p);return{selectedIndices:d[0],validOutputs:d[1]}}var Ase=J({nonMaxSuppressionPadded_:Cse});function _se(r,e,t,n,a,i){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1),Ke(this,void 0,void 0,function(){var o,s,u,l,c,f,h,p,d,m,v,g;return je(this,function(y){switch(y.label){case 0:return o=L(r,"boxes","nonMaxSuppressionAsync"),s=L(e,"scores","nonMaxSuppressionAsync"),u=Dl(o,s,t,n,a,null),l=u.maxOutputSize,c=u.iouThreshold,f=u.scoreThreshold,[4,Promise.all([o.data(),s.data()])];case 1:return h=Ge.apply(void 0,[y.sent(),2]),p=h[0],d=h[1],m=$R(p,d,l,c,f,i),v=m.selectedIndices,g=m.validOutputs,o!==r&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:mi(v,"int32"),validOutputs:qt(g,"int32")}]}})})}var Dse=_se;function Fse(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=L(r,"images","resizeBilinear");G(a.rank===3||a.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+("rank "+a.rank+".")}),G(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+(e+".")}),G(n===!1||t===!1,function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=Ee(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Ge(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},l=Q.runKernel(v3,s,u);return o?Ee(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var Rse=J({resizeBilinear_:Fse});function Ose(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=L(r,"images","resizeNearestNeighbor");G(a.rank===3||a.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+("rank "+a.rank+".")}),G(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+(e+".")}),G(a.dtype==="float32"||a.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"}),G(n===!1||t===!1,function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=Ee(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Ge(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},l=Q.runKernel(d3,s,u);return o?Ee(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var Pse=J({resizeNearestNeighbor_:Ose});function Mse(r,e,t,n){var a;e===void 0&&(e="binary"),t===void 0&&(t=!1),n===void 0&&(n=.5);var i=L(r,"image","threshold"),o=.2989,s=.587,u=.114,l=i.shape[0]*i.shape[1],c=Pe(mi([n]),255),f,h,p,d;if(G(i.rank===3,function(){return"Error in threshold: image must be rank 3,"+("but got rank "+i.rank+".")}),G(i.shape[2]===3||i.shape[2]===1,function(){return"Error in threshold: image color channel must be equal to 3 or 1"+("but got "+i.shape[2]+".")}),G(i.dtype==="int32"||i.dtype==="float32",function(){return"Error in dtype: image dtype must be int32 or float32,"+("but got dtype "+i.dtype+".")}),G(e==="otsu"||e==="binary",function(){return"Method must be binary or otsu, but was "+e}),i.shape[2]===3){a=Ge(Pf(i,[1,1,1],-1),3),f=a[0],h=a[1],p=a[2];var m=Pe(f,o),v=Pe(h,s),g=Pe(p,u);d=pt(pt(m,v),g)}else d=r;if(e==="otsu"){var y=aR(Or(_R(d),"int32"),wl([]),256);c=Bse(y,l)}var b=t?Z0(d,c):rv(d,c),w=Or(Pe(b,255),"int32");return w}function Bse(r,e){for(var t=mi([-1]),n=mi([0]),a=mi([0]),i,o,s,u,l,c,f=0;f<r.size-1;f++){i=kr(r,0,f+1),o=kr(r,f+1),l=ar(nr(i),e),c=ar(nr(o),e);var h=nr(Pe(i,Of(0,i.size)));s=ar(h,nr(i));var p=qf(o.shape,i.size),d=pt(Of(0,o.size),p),m=Pe(o,d);u=ar(nr(m),nr(o));var v=At(s,u),g=At(s,u),y=Pe(l,c);a=Pe(Pe(y,v),g);var b=rv(a,n);n=Cl(b,a,n),t=Cl(b,mi([f]),t)}return t}var Lse=J({threshold_:Mse});function zse(r,e,t,n,a,i){t===void 0&&(t="nearest"),n===void 0&&(n="constant"),a===void 0&&(a=0);var o=L(r,"image","transform","float32"),s=L(e,"transforms","transform","float32");G(o.rank===4,function(){return"Error in transform: image must be rank 4,"+("but got rank "+o.rank+".")}),G(s.rank===2&&(s.shape[0]===o.shape[0]||s.shape[0]===1)&&s.shape[1]===8,function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"}),G(i==null||i.length===2,function(){return"Error in transform: outputShape must be [height, width] or null, "+("but got "+i+".")});var u={image:o,transforms:s},l={interpolation:t,fillMode:n,fillValue:a,outputShape:i};return Q.runKernel(X3,u,l)}var $se=J({transform_:zse});function Wse(r,e,t){G(e%1===0,function(){return"bandPart(): numLower must be an integer, got "+e+"."}),G(t%1===0,function(){return"bandPart(): numUpper must be an integer, got "+t+"."});var n=L(r,"a","bandPart");G(n.rank>=2,function(){return"bandPart(): Rank must be at least 2, got "+n.rank+"."});var a=n.shape,i=Ge(n.shape.slice(-2),2),o=i[0],s=i[1];if(!(e<=o))throw new Error("bandPart(): numLower ("+e+")"+(" must not be greater than the number of rows ("+o+")."));if(!(t<=s))throw new Error("bandPart(): numUpper ("+t+")"+(" must not be greater than the number of columns ("+s+")."));e<0&&(e=o),t<0&&(t=s);var u=Ee(Of(0,o,1,"int32"),[-1,1]),l=Of(0,s,1,"int32"),c=At(u,l),f=Ud(Z0(c,qt(+e,"int32")),pR(c,qt(-t,"int32"))),h=Al([o,s],n.dtype);return Ee(Mf(ab(Ee(n,[-1,o,s])).map(function(p){return Cl(f,p,h)})),a)}var qse=J({bandPart_:Wse});function Vse(r){var e;if(Array.isArray(r)){e=!1,G(r!=null&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=r[0].shape[0],n=function(u){G(r[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+("("+r[u].shape[0]+" vs. "+t+")")})},a=1;a<r.length;++a)n(a)}else e=!0,r=Pf(r,r.shape[0],0).map(function(u){return nb(u,[0])});G(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+r.length+") exceeds "+("number of dimensions ("+r[0].shape[0]+").")});for(var i=[],o=r,s=function(u){i.push(Q.tidy(function(){var l=o[u];if(u>0)for(var c=0;c<u;++c){var f=Pe(nr(Pe(i[c],l)),i[c]);l=At(l,f)}return ar(l,tv(l,"euclidean"))}))},a=0;a<r.length;++a)s(a);return e?Mf(i,0):i}var Gse=J({gramSchmidt_:Vse});function Use(r,e){if(e===void 0&&(e=!1),G(r.rank>=2,function(){return"qr() requires input tensor to have a rank >= 2, but got rank "+r.rank}),r.rank===2)return t_(r,e);var t=r.shape.slice(0,r.shape.length-2).reduce(function(u,l){return u*l}),n=ab(Ee(r,[t,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),a=[],i=[];n.forEach(function(u){var l=Ge(t_(u,e),2),c=l[0],f=l[1];a.push(c),i.push(f)});var o=Ee(Mf(a,0),r.shape),s=Ee(Mf(i,0),r.shape);return[o,s]}function t_(r,e){return e===void 0&&(e=!1),Q.tidy(function(){G(r.shape.length===2,function(){return"qr2d() requires a 2D Tensor, but got a "+r.shape.length+"D Tensor."});for(var t=r.shape[0],n=r.shape[1],a=cR(t),i=Gs(r),o=Nf([[1]],[1,1]),s=Gs(o),u=t>=n?n:t,l=function(f){var h,p=i,d=s,m=a;h=Ge(Q.tidy(function(){var v=kr(i,[f,f],[t-f,1]),g=tv(v),y=kr(i,[f,f],[1,1]),b=Cl(rv(y,0),Nf([[-1]]),Nf([[1]])),w=At(y,Pe(b,g)),x=ar(v,w);x.shape[0]===1?s=Gs(o):s=ea([o,kr(x,[1,0],[x.shape[0]-1,x.shape[1]])],0);var k=fo(ar(Wt(b,w),g)),N=kr(i,[f,0],[t-f,n]),T=Pe(k,s),I=Vd(s);if(f===0)i=At(N,Wt(T,Wt(I,N)));else{var F=At(N,Wt(T,Wt(I,N)));i=ea([kr(i,[0,0],[f,n]),F],0)}var D=Vd(T),R=kr(a,[0,f],[t,a.shape[1]-f]);if(f===0)a=At(R,Wt(Wt(R,s),D));else{var P=At(R,Wt(Wt(R,s),D));a=ea([kr(a,[0,0],[t,f]),P],1)}return[s,i,a]}),3),s=h[0],i=h[1],a=h[2],Rn([p,d,m])},c=0;c<u;++c)l(c);return!e&&t>n&&(a=kr(a,[0,0],[t,n]),i=kr(i,[0,0],[n,n])),[a,i]})}var Hse=J({qr_:Use});A.Reduction=void 0;(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(A.Reduction||(A.Reduction={}));function Kse(r,e,t){t===void 0&&(t=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var n=L(r,"losses","computeWeightedLoss"),a=null;e!=null&&(a=L(e,"weights","computeWeightedLoss"));var i=a==null?n:Pe(n,a);if(t===A.Reduction.NONE)return i;if(t===A.Reduction.SUM)return nr(i);if(t===A.Reduction.MEAN){if(a==null)return Hd(i);var o=n.size/a.size,s=ar(nr(i),nr(a));return o>1?ar(s,qt(o)):s}if(t===A.Reduction.SUM_BY_NONZERO_WEIGHTS){if(a==null)return ar(nr(i),qt(n.size));var u=Pe(a,Vs(n.shape)),l=Or(nr(NR(u,qt(0))),"float32");return ar(nr(i),l)}throw Error("Unknown reduction: "+t)}var go=J({computeWeightedLoss_:Kse});function jse(r,e,t,n){n===void 0&&(n=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=L(r,"labels","absoluteDifference"),i=L(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=L(t,"weights","absoluteDifference")),En(a.shape,i.shape,"Error in absoluteDifference: ");var s=Ea(At(a,i));return go(s,o,n)}var Xse=J({absoluteDifference_:jse});function Yse(r,e,t,n,a){a===void 0&&(a=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=L(r,"labels","cosineDistance"),o=L(e,"predictions","cosineDistance"),s=null;n!=null&&(s=L(n,"weights","cosineDistance")),En(i.shape,o.shape,"Error in cosineDistance: ");var u=qt(1),l=At(u,nr(Pe(i,o),t,!0));return go(l,s,a)}var Zse=J({cosineDistance_:Yse});function Jse(r,e,t,n){n===void 0&&(n=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=L(r,"labels","hingeLoss"),i=L(e,"predictions","hingeLoss"),o=null;t!=null&&(o=L(t,"weights","hingeLoss")),En(a.shape,i.shape,"Error in hingeLoss: ");var s=qt(1);a=At(Pe(qt(2),a),s);var u=av(At(s,Pe(a,i)));return go(u,o,n)}var Qse=J({hingeLoss_:Jse});function eue(r,e,t,n,a){n===void 0&&(n=1),a===void 0&&(a=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=L(r,"labels","huberLoss"),o=L(e,"predictions","huberLoss"),s=null;t!=null&&(s=L(t,"weights","huberLoss")),En(i.shape,o.shape,"Error in huberLoss: ");var u=qt(n),l=Ea(At(o,i)),c=SR(l,u),f=At(l,c),h=pt(Pe(qt(.5),gi(c)),Pe(u,f));return go(h,s,a)}var tue=J({huberLoss_:eue});function rue(r,e,t,n,a){n===void 0&&(n=1e-7),a===void 0&&(a=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=L(r,"labels","logLoss"),o=L(e,"predictions","logLoss"),s=null;t!=null&&(s=L(t,"weights","logLoss")),En(i.shape,o.shape,"Error in logLoss: ");var u=qt(1),l=qt(n),c=fo(Pe(i,Rf(pt(o,l)))),f=Pe(At(u,i),Rf(pt(At(u,o),l))),h=At(c,f);return go(h,s,a)}var nue=J({logLoss_:rue});function aue(r,e,t,n){n===void 0&&(n=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=L(r,"labels","meanSquaredError"),i=L(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=L(t,"weights","meanSquaredError")),En(a.shape,i.shape,"Error in meanSquaredError: ");var s=FR(a,i);return go(s,o,n)}var iue=J({meanSquaredError_:aue});function oue(r,e){var t=L(r,"labels","sigmoidCrossEntropyWithLogits"),n=L(e,"logits","sigmoidCrossEntropyWithLogits");En(t.shape,n.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=av(n),i=Pe(n,t),o=vR(Xs(fo(Ea(n))));return pt(At(a,i),o)}function sue(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=L(r,"multiClassLabels","sigmoidCrossEntropy"),o=L(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=L(t,"weights","sigmoidCrossEntropy")),En(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),n>0){var u=qt(n),l=qt(1),c=qt(.5);i=pt(Pe(i,At(l,u)),Pe(c,u))}var f=oue(i,o);return go(f,s,a)}var uue=J({sigmoidCrossEntropy_:sue});function lue(r,e,t){if(t===void 0&&(t=-1),t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+("supported. Labels / logits was rank "+e.rank+" ")+("and dim was "+t));var n=Hi(function(a,i,o){var s=!0,u=yR(i,[t],s),l=At(Or(i,"float32"),u);o([a,l]);var c=fo(Pe(l,a)),f=nr(c,[t]),h=function(p,d){var m=Ge(d,2),v=m[0],g=m[1],y=Vf(p.shape,[t]);return[Pe(Ee(p,y),At(Or(v,"float32"),Xs(g))),Pe(Ee(p,y),At(Xs(g),Or(v,"float32")))]};return{value:f,gradFunc:h}});return n(r,e)}function cue(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=L(r,"onehotLabels","softmaxCrossEntropy"),o=L(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=L(t,"weights","softmaxCrossEntropy")),En(i.shape,o.shape,"Error in softmaxCrossEntropy: "),n>0){var u=qt(n),l=qt(1),c=qt(i.shape[1]);i=pt(Pe(i,At(l,u)),ar(u,c))}var f=lue(i,o);return go(f,s,a)}var fue=J({softmaxCrossEntropy_:cue});function hue(r,e,t,n){var a=L(r,"indices","sparseFillEmptyRows","int32"),i=L(e,"values","sparseFillEmptyRows"),o=L(t,"denseShape","sparseFillEmptyRows","int32"),s=L(n,"defaultValue","sparseFillEmptyRows",i.dtype);if(a.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        `+a.shape);if(i.rank!==1)throw new Error("Values should be Tensor1D but received shape "+i.shape);if(o.rank!==1)throw new Error("Dense shape should be Tensor1D but received shape "+o.shape);if(s.rank!==0)throw new Error("Default value should be a scalar but received shape "+s.shape);var u={indices:a,values:i,denseShape:o,defaultValue:s},l=Q.runKernel(P3,u);return{outputIndices:l[0],outputValues:l[1],emptyRowIndicator:l[2],reverseIndexMap:l[3]}}var pue=J({sparseFillEmptyRows_:hue});function due(r,e,t){var n=L(r,"inputIndices","sparseReshape","int32"),a=L(e,"inputShape","sparseReshape","int32"),i=L(t,"newShape","sparseReshape","int32");if(n.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        `+n.shape);if(a.rank!==1)throw new Error("Input shape should be Tensor1D but received shape "+a.shape);if(i.rank!==1)throw new Error("New shape should be Tensor1D but received shape "+i.shape);var o={inputIndices:n,inputShape:a,newShape:i},s=Q.runKernel(M3,o);return{outputIndices:s[0],outputShape:s[1]}}var vue=J({sparseReshape_:due});function mue(r,e,t){var n=L(r,"data","sparseSegmentMean"),a=L(e,"indices","sparseSegmentMean","int32"),i=L(t,"segmentIds","sparseSegmentMean","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          `+a.shape);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          `+i.shape);var o={data:n,indices:a,segmentIds:i};return Q.runKernel(B3,o)}var gue=J({sparseSegmentMean_:mue});function yue(r,e,t){var n=L(r,"data","sparseSegmentSum"),a=L(e,"indices","sparseSegmentSum","int32"),i=L(t,"segmentIds","sparseSegmentSum","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         `+a.shape);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         `+i.shape);var o={data:n,indices:a,segmentIds:i};return Q.runKernel(L3,o)}var bue=J({sparseSegmentSum_:yue});function wue(r,e,t,n,a,i,o,s){var u=L(r,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error("Data must be a vector, saw: "+u.shape);var l=L(e,"dataSplits","stringNGrams");if(l.dtype!=="int32")throw new Error("Data splits must be of datatype int32");var c={separator:t,nGramWidths:n,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},f={data:u,dataSplits:l},h=Q.runKernel(q3,f,c);return{nGrams:h[0],nGramsSplits:h[1]}}var xue=J({stringNGrams_:wue});function kue(r,e,t){t===void 0&&(t=!0);var n=L(r,"input","stringSplit","string"),a=L(e,"delimiter","stringSplit","string");if(n.rank!==1)throw new Error("Input should be Tensor1D but received shape "+n.shape);if(a.rank!==0)throw new Error("Delimiter should be a scalar but received shape "+a.shape);var i={skipEmpty:t},o={input:n,delimiter:a},s=Q.runKernel(V3,o,i);return{indices:s[0],values:s[1],shape:s[2]}}var Sue=J({stringSplit_:kue});function Nue(r,e){var t=L(r,"input","stringToHashBucketFast","string"),n={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");var a={input:t};return Q.runKernel(G3,a,n)}var Eue=J({stringToHashBucketFast_:Nue});var Tue={fft:tb,ifft:Kd,rfft:rb,irfft:DR},Iue={hammingWindow:tse,hannWindow:BR,frame:LR,stft:ise},Cue={flipLeftRight:lse,grayscaleToRGB:fse,resizeNearestNeighbor:Pse,resizeBilinear:Rse,rotateWithOffset:pse,cropAndResize:sse,nonMaxSuppression:vse,nonMaxSuppressionAsync:Sse,nonMaxSuppressionWithScore:Ese,nonMaxSuppressionWithScoreAsync:Ise,nonMaxSuppressionPadded:Ase,nonMaxSuppressionPaddedAsync:Dse,threshold:Lse,transform:$se},Aue={bandPart:qse,gramSchmidt:Gse,qr:Hse},_ue={absoluteDifference:Xse,computeWeightedLoss:go,cosineDistance:Zse,hingeLoss:Qse,huberLoss:tue,logLoss:nue,meanSquaredError:iue,sigmoidCrossEntropy:uue,softmaxCrossEntropy:fue},Due={sparseFillEmptyRows:pue,sparseReshape:vue,sparseSegmentMean:gue,sparseSegmentSum:bue},Fue={stringNGrams:xue,stringSplit:Sue,stringToHashBucketFast:Eue},is=function(r){vo(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.minimize=function(t,n,a){n===void 0&&(n=!1);var i=this.computeGradients(t,a),o=i.value,s=i.grads;if(a!=null){var u=a.map(function(l){return{name:l.name,tensor:s[l.name]}});this.applyGradients(u)}else this.applyGradients(s);return Rn(s),n?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,n){return mR(t,n)},e.prototype.dispose=function(){this.iterations_!=null&&Rn(this.iterations_)},e.prototype.saveIterations=function(){return Ke(this,void 0,void 0,function(){return je(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:qt(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return Ke(this,void 0,void 0,function(){return je(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return Ke(this,void 0,void 0,function(){return je(this,function(n){throw new Error("setWeights() is not implemented for this optimizer class "+(""+this.getClassName()))})})},e.prototype.extractIterations=function(t){return Ke(this,void 0,void 0,function(){var n;return je(this,function(a){switch(a.label){case 0:return n=this,[4,t[0].tensor.data()];case 1:return n.iterations_=a.sent()[0],[2,t.slice(1)]}})})},e}(jF);Object.defineProperty(is,Symbol.hasInstance,{value:function(r){return r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null}});var lv=function(r){vo(e,r);function e(t,n,a){a===void 0&&(a=null);var i=r.call(this)||this;return i.learningRate=t,i.rho=n,i.epsilon=a,i.accumulatedGrads=[],i.accumulatedUpdates=[],a==null&&(i.epsilon=Q.backend.epsilon()),i}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=Q.registeredVariables[i],u=!1;n.accumulatedGrads[o]==null&&(n.accumulatedGrads[o]={originalName:i+"/accum_grad",variable:Ur(function(){return Ta(s).variable(u)})}),n.accumulatedUpdates[o]==null&&(n.accumulatedUpdates[o]={originalName:i+"/accum_var",variable:Ur(function(){return Ta(s).variable(u)})});var l=Array.isArray(t)?t[o].tensor:t[i];if(l!=null){var c=n.accumulatedGrads[o].variable,f=n.accumulatedUpdates[o].variable;Ur(function(){var h=pt(Pe(c,n.rho),Pe(gi(l),1-n.rho)),p=Pe(ar(po(pt(f,n.epsilon)),po(pt(c,n.epsilon))),l),d=pt(Pe(f,n.rho),Pe(gi(p),1-n.rho));c.assign(h),f.assign(d);var m=pt(Pe(p,-n.learningRate),s);s.assign(m)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Rn(this.accumulatedGrads.map(function(t){return t.variable})),Rn(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return Ke(this,void 0,void 0,function(){var t;return je(this,function(n){switch(n.label){case 0:return t=Lt(this.accumulatedGrads,this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ke(this,void 0,void 0,function(){var n,a;return je(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=t.length/2,a=!1,this.accumulatedGrads=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedUpdates=t.slice(n,n*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.rho,n.epsilon)},e}(is);lv.className="Adadelta";as(lv);var cv=function(r){vo(e,r);function e(t,n){n===void 0&&(n=.1);var a=r.call(this)||this;return a.learningRate=t,a.initialAccumulatorValue=n,a.accumulatedGrads=[],a}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=Q.registeredVariables[i];if(n.accumulatedGrads[o]==null){var u=!1;n.accumulatedGrads[o]={originalName:i+"/accumulator",variable:Ur(function(){return qf(s.shape,n.initialAccumulatorValue).variable(u)})}}var l=Array.isArray(t)?t[o].tensor:t[i];if(l!=null){var c=n.accumulatedGrads[o].variable;Ur(function(){var f=pt(c,gi(l));c.assign(f);var h=pt(Pe(ar(l,po(pt(f,Q.backend.epsilon()))),-n.learningRate),s);s.assign(h)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&Rn(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ke(this,void 0,void 0,function(){return je(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return Ke(this,void 0,void 0,function(){var n;return je(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),n=!1,this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(n)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,n){return new t(n.learningRate,n.initialAccumulatorValue)},e}(is);cv.className="Adagrad";as(cv);var fv=function(r){vo(e,r);function e(t,n,a,i){i===void 0&&(i=null);var o=r.call(this)||this;return o.learningRate=t,o.beta1=n,o.beta2=a,o.epsilon=i,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],Ur(function(){o.accBeta1=qt(n).variable(),o.accBeta2=qt(a).variable()}),i==null&&(o.epsilon=Q.backend.epsilon()),o}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Ur(function(){var i=At(1,n.accBeta1),o=At(1,n.accBeta2);a.forEach(function(s,u){var l=Q.registeredVariables[s],c=!1;n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:s+"/m",variable:Ur(function(){return Ta(l).variable(c)})}),n.accumulatedSecondMoment[u]==null&&(n.accumulatedSecondMoment[u]={originalName:s+"/v",variable:Ur(function(){return Ta(l).variable(c)})});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=n.accumulatedFirstMoment[u].variable,p=n.accumulatedSecondMoment[u].variable,d=pt(Pe(h,n.beta1),Pe(f,1-n.beta1)),m=pt(Pe(p,n.beta2),Pe(gi(f),1-n.beta2)),v=ar(d,i),g=ar(m,o);h.assign(d),p.assign(m);var y=pt(Pe(ar(v,pt(po(g),n.epsilon)),-n.learningRate),l);l.assign(y)}}),n.accBeta1.assign(Pe(n.accBeta1,n.beta1)),n.accBeta2.assign(Pe(n.accBeta2,n.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Rn(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&Rn(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ke(this,void 0,void 0,function(){var t;return je(this,function(n){switch(n.label){case 0:return t=Lt(this.accumulatedFirstMoment,this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ke(this,void 0,void 0,function(){var n,a,i=this;return je(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),Ur(function(){i.accBeta1.assign(Ff(i.beta1,i.iterations_+1)),i.accBeta2.assign(Ff(i.beta2,i.iterations_+1))}),n=t.length/2,a=!1,this.accumulatedFirstMoment=t.slice(0,n).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),this.accumulatedSecondMoment=t.slice(n,n*2).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon)},e}(is);fv.className="Adam";as(fv);var hv=function(r){vo(e,r);function e(t,n,a,i,o){i===void 0&&(i=null),o===void 0&&(o=0);var s=r.call(this)||this;return s.learningRate=t,s.beta1=n,s.beta2=a,s.epsilon=i,s.decay=o,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],Ur(function(){s.iteration=qt(0).variable(),s.accBeta1=qt(n).variable()}),i==null&&(s.epsilon=Q.backend.epsilon()),s}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Ur(function(){var i=At(1,n.accBeta1),o=ar(-n.learningRate,pt(Pe(n.iteration,n.decay),1));a.forEach(function(s,u){var l=Q.registeredVariables[s],c=!1;n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:s+"/m",variable:Ta(l).variable(c)}),n.accumulatedWeightedInfNorm[u]==null&&(n.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:Ta(l).variable(c)});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=n.accumulatedFirstMoment[u].variable,p=n.accumulatedWeightedInfNorm[u].variable,d=pt(Pe(h,n.beta1),Pe(f,1-n.beta1)),m=Pe(p,n.beta2),v=Ea(f),g=kR(m,v);h.assign(d),p.assign(g);var y=pt(Pe(ar(o,i),ar(d,pt(g,n.epsilon))),l);l.assign(y)}}),n.iteration.assign(pt(n.iteration,1)),n.accBeta1.assign(Pe(n.accBeta1,n.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Rn(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&Rn(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ke(this,void 0,void 0,function(){return je(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return Ke(this,void 0,void 0,function(){return je(this,function(n){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)},e}(is);hv.className="Adamax";as(hv);var Uf=function(r){vo(e,r);function e(t){var n=r.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=Q.registeredVariables[i];Ur(function(){var l=pt(Pe(n.c,s),u);u.assign(l)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=RF(qt(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return Ke(this,void 0,void 0,function(){return je(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return Ke(this,void 0,void 0,function(){return je(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:if(t=n.sent(),t.length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,n){return new t(n.learningRate)},e}(is);Uf.className="SGD";as(Uf);var pv=function(r){vo(e,r);function e(t,n,a){a===void 0&&(a=!1);var i=r.call(this,t)||this;return i.learningRate=t,i.momentum=n,i.useNesterov=a,i.accumulations=[],i.m=qt(i.momentum),i}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=Q.registeredVariables[i];if(n.accumulations[o]==null){var u=!1;n.accumulations[o]={originalName:i+"/momentum",variable:Ur(function(){return Ta(s).variable(u)})}}var l=n.accumulations[o].variable,c=Array.isArray(t)?t[o].tensor:t[i];c!=null&&Ur(function(){var f,h=pt(Pe(n.m,l),c);n.useNesterov?f=pt(Pe(n.c,pt(c,Pe(h,n.m))),s):f=pt(Pe(n.c,h),s),l.assign(h),s.assign(f)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Rn(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return Ke(this,void 0,void 0,function(){return je(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return Ke(this,void 0,void 0,function(){var n;return je(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),n=!1,this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(n)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,n){return new t(n.learningRate,n.momentum,n.useNesterov)},e}(Uf);pv.className="Momentum";as(pv);var dv=function(r){vo(e,r);function e(t,n,a,i,o){n===void 0&&(n=.9),a===void 0&&(a=0),i===void 0&&(i=null),o===void 0&&(o=!1);var s=r.call(this)||this;if(s.learningRate=t,s.decay=n,s.momentum=a,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=o,i==null&&(s.epsilon=Q.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=Q.registeredVariables[i],u=!1;n.accumulatedMeanSquares[o]==null&&(n.accumulatedMeanSquares[o]={originalName:i+"/rms",variable:Ur(function(){return Ta(s).variable(u)})}),n.accumulatedMoments[o]==null&&(n.accumulatedMoments[o]={originalName:i+"/momentum",variable:Ur(function(){return Ta(s).variable(u)})}),n.accumulatedMeanGrads[o]==null&&n.centered&&(n.accumulatedMeanGrads[o]={originalName:i+"/mg",variable:Ur(function(){return Ta(s).variable(u)})});var l=Array.isArray(t)?t[o].tensor:t[i];if(l!=null){var c=n.accumulatedMeanSquares[o].variable,f=n.accumulatedMoments[o].variable;Ur(function(){var h=pt(Pe(c,n.decay),Pe(gi(l),1-n.decay));if(n.centered){var p=n.accumulatedMeanGrads[o].variable,d=pt(Pe(p,n.decay),Pe(l,1-n.decay)),m=ar(Pe(l,n.learningRate),po(At(h,pt(gi(d),n.epsilon)))),v=pt(Pe(f,n.momentum),m);c.assign(h),p.assign(d),f.assign(v);var g=At(s,v);s.assign(g)}else{var y=pt(Pe(c,n.decay),Pe(gi(l),1-n.decay)),v=pt(Pe(f,n.momentum),ar(Pe(l,n.learningRate),po(pt(y,n.epsilon))));c.assign(y),f.assign(v);var g=At(s,v);s.assign(g)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Rn(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&Rn(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&Rn(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ke(this,void 0,void 0,function(){var t;return je(this,function(n){switch(n.label){case 0:return t=Lt(this.accumulatedMeanSquares,this.accumulatedMoments),this.centered&&t.push.apply(t,Lt(this.accumulatedMeanGrads)),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ke(this,void 0,void 0,function(){var n,a;return je(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=this.centered?t.length/3:t.length/2,a=!1,this.accumulatedMeanSquares=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedMoments=t.slice(n,n*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(n*2,n*3).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,n){return new t(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)},e}(is);dv.className="RMSProp";as(dv);var jo=function(){function r(){}return r.sgd=function(e){return new Uf(e)},r.momentum=function(e,t,n){return n===void 0&&(n=!1),new pv(e,t,n)},r.rmsprop=function(e,t,n,a,i){return t===void 0&&(t=.9),n===void 0&&(n=0),a===void 0&&(a=null),i===void 0&&(i=!1),new dv(e,t,n,a,i)},r.adam=function(e,t,n,a){return e===void 0&&(e=.001),t===void 0&&(t=.9),n===void 0&&(n=.999),a===void 0&&(a=null),new fv(e,t,n,a)},r.adadelta=function(e,t,n){return e===void 0&&(e=.001),t===void 0&&(t=.95),n===void 0&&(n=null),new lv(e,t,n)},r.adamax=function(e,t,n,a,i){return e===void 0&&(e=.002),t===void 0&&(t=.9),n===void 0&&(n=.999),a===void 0&&(a=null),i===void 0&&(i=0),new hv(e,t,n,a,i)},r.adagrad=function(e,t){return t===void 0&&(t=.1),new cv(e,t)},r}();var Rue={sgd:jo.sgd,momentum:jo.momentum,adadelta:jo.adadelta,adagrad:jo.adagrad,rmsprop:jo.rmsprop,adamax:jo.adamax,adam:jo.adam};var Oue=function(){return typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:function(r){return r()}}();function Pue(){return new Promise(function(r){return Oue(function(){return r()})})}function Mue(r,e){var t=r[0].length;r.forEach(function(a,i){G(a.length===t,function(){return"Error in concat"+t+"D: rank of tensors["+i+"] must be the same "+("as the rank of the rest ("+t+")")})}),G(e>=0&&e<t,function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."});var n=r[0];r.forEach(function(a,i){for(var o=0;o<t;o++)G(o===e||a[o]===n[o],function(){return"Error in concat"+t+"D: Shape of tensors["+i+"] ("+a+") "+("does not match the shape of the rest ("+n+") ")+("along the non-concatenated axis "+i+".")})})}function Bue(r,e){for(var t=r[0].slice(),n=1;n<r.length;n++)t[e]+=r[n][e];return t}var Gi;(function(r){r[r.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",r[r.VALUE_ROWIDS=1]="VALUE_ROWIDS",r[r.ROW_LENGTHS=2]="ROW_LENGTHS",r[r.ROW_SPLITS=3]="ROW_SPLITS",r[r.ROW_LIMITS=4]="ROW_LIMITS",r[r.ROW_STARTS=5]="ROW_STARTS"})(Gi||(Gi={}));function Lue(r,e,t){var n=new Array;if(t==null&&e==null)return n;if(e==null)for(;n.length<r+t.length;)n.push(-1);else n=e.slice();if(t==null)return n;if(r+t.length!==n.length)throw new Error("rt input.shape and shape="+e+" are incompatible: rt input.rank = "+(r+t.length)+", but shape.rank = "+n.length);for(var a=1;a<t.length;++a){var i=t[a],o=n[n.length-t.length+a],s=n[o];if(i>=0)if(s>=0){if(s!==i)throw new Error("rt input.shape and shape="+e+" are incompatible: rt input.shape["+(a+r)+"] = "+i+" but shape["+(a+r)+"] = "+s)}else n[o]=i}return n}function zue(r){var e,t,n={FIRST_DIM_SIZE:Gi.FIRST_DIM_SIZE,VALUE_ROWIDS:Gi.VALUE_ROWIDS,ROW_LENGTHS:Gi.ROW_LENGTHS,ROW_SPLITS:Gi.ROW_SPLITS,ROW_LIMITS:Gi.ROW_LIMITS,ROW_STARTS:Gi.ROW_STARTS},a=[];try{for(var i=On(r),o=i.next();!o.done;o=i.next()){var s=o.value;if(s in n)a.push(n[s]);else break}}catch(u){e={error:u}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return a}function $ue(r){return r.length===0?0:r[0]===Gi.FIRST_DIM_SIZE?r.length-1:r.length}function Wue(r,e){if(!(r==null||e==null)){var t=r.length,n=e.length;if(t>=n)throw new Error("defaultValue.shape="+r+" and ragged tensor flatValues.shape="+e+", are incompatible: defaultValue.rank = "+t+" must be less than ragged tensor input flatValues.rank = "+n+")");for(var a=0;a<Math.min(t,n-1);++a){var i=r[a],o=e[a+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error("defaultValue.shape="+r+", and ragged tensor input flatValues.shape="+e+" are incompatible: defaultValue.shape["+(a-r.length)+"] = "+i+" but ragged tensor input.flatValues.shape["+(a-r.length)+"] = "+o)}}}var sb=30;function que(r){return r<=sb?r:Pd(r,Math.floor(Math.sqrt(r)))}function Vue(r,e,t){var n=t*(typeof r=="number"?r:r[0]),a=e*(typeof r=="number"?r:r[1]);return[n,a]}function Gue(r,e,t,n){n===void 0&&(n=!0);var a=[];if(n)a=a.concat(e.slice(0)),a.push(r[0]/t),a=a.concat(r.slice(1));else{a=a.concat(r[0]);for(var i=e.length,o=0;o<i;++o)a=a.concat([r[o+1]/e[o],e[o]]);a=a.concat(r.slice(i+1))}return a}function Uue(r,e,t){t===void 0&&(t=!0);var n=[];if(t){n.push(e);for(var a=e+1;a<r;++a)a<=2*e?(n.push(a),n.push(a-(e+1))):n.push(a)}else{for(var i=[],o=[],a=1;a<r;++a)a>=e*2+1||a%2===1?o.push(a):i.push(a);n.push.apply(n,Lt(i)),n.push(0),n.push.apply(n,Lt(o))}return n}function Hue(r,e,t,n){n===void 0&&(n=!0);var a=[];n?a.push(r[0]/t):a.push(r[0]*t);for(var i=1;i<r.length;++i)i<=e.length?n?a.push(e[i-1]*r[i]):a.push(r[i]/e[i-1]):a.push(r[i]);return a}function Kue(r,e){for(var t=[0],n=0;n<e;++n)t.push(r[n][0]);return t}function jue(r,e,t){for(var n=r.slice(0,1),a=0;a<t;++a)n.push(r[a+1]-e[a][0]-e[a][1]);return n}var Xue=1.7580993408473768,Yue=1.0507009873554805;var Zue=.3275911,Jue=.254829592,Que=-.284496736,ele=1.421413741,tle=-1.453152027,rle=1.061405429;function nle(r,e){if(r.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+(r.length+", imag: "+e.length+"."));for(var t=new Float32Array(r.length*2),n=0;n<t.length;n+=2)t[n]=r[n/2],t[n+1]=e[n/2];return t}function ale(r){for(var e=new Float32Array(r.length/2),t=new Float32Array(r.length/2),n=0;n<r.length;n+=2)e[n/2]=r[n],t[n/2]=r[n+1];return{real:e,imag:t}}function ile(r){for(var e=Math.ceil(r.length/4),t=new Float32Array(e),n=new Float32Array(e),a=0;a<r.length;a+=4)t[Math.floor(a/4)]=r[a],n[Math.floor(a/4)]=r[a+1];return{real:t,imag:n}}function ole(r){for(var e=Math.floor(r.length/4),t=new Float32Array(e),n=new Float32Array(e),a=2;a<r.length;a+=4)t[Math.floor(a/4)]=r[a],n[Math.floor(a/4)]=r[a+1];return{real:t,imag:n}}function sle(r,e){var t=r[e*2],n=r[e*2+1];return{real:t,imag:n}}function ule(r,e,t,n){r[n*2]=e,r[n*2+1]=t}function lle(r,e){for(var t=new Float32Array(r/2),n=new Float32Array(r/2),a=0;a<Math.ceil(r/2);a++){var i=(e?2:-2)*Math.PI*(a/r);t[a]=Math.cos(i),n[a]=Math.sin(i)}return{real:t,imag:n}}function cle(r,e,t){var n=(t?2:-2)*Math.PI*(r/e),a=Math.cos(n),i=Math.sin(n);return{real:a,imag:i}}var Qy="->",fle=/->/g,r_=",",n_="...";function hle(r,e){r=r.replace(/\s/g,"");var t=(r.length-r.replace(fle,"").length)/Qy.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error('Equation must contain exactly one arrow ("'+Qy+'").');var n=Ge(r.split(Qy),2),a=n[0],i=n[1];G(a.indexOf(n_)===-1,function(){return'The ellipsis notation ("'+n_+'") is not supported yet.'});var o=a.split(r_),s=o.length;if(e!==s)throw new Error("Expected "+s+" input tensors, received "+e);if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");for(var u=[],l=function(g){var y=i[g];if(!o.some(function(b){return b.indexOf(y)!==-1}))throw new Error("Output subscripts contain the label "+y+" not present in the input subscripts.");u.indexOf(y)===-1&&u.push(y)},c=0;c<i.length;++c)l(c);for(var c=0;c<a.length;++c){var f=a[c];u.indexOf(f)===-1&&f!==r_&&u.push(f)}for(var h=new Array(o.length),c=0;c<s;++c){if(new Set(o[c].split("")).size!==o[c].length)throw new Error("Found duplicate axes in input component "+o[c]+". Support for duplicate axes in input is not implemented yet.");h[c]=[];for(var p=0;p<o[c].length;++p)h[c].push(u.indexOf(o[c][p]))}for(var d=u.length,m=i.length,v=[],c=m;c<d;++c)v.push(c);return{allDims:u,summedDims:v,idDims:h}}function ple(r,e){var t=new Array(r);t.fill(-1);for(var n=0;n<e.length;++n)t[e[n]]=n;for(var a=[],n=0;n<r;++n)t[n]===-1&&a.push(n);return t=t.filter(function(i){return i!==-1}),{permutationIndices:t,expandDims:a}}function dle(r,e,t){for(var n=new Array(r),a=function(o){for(var s=t[o].shape,u=function(c){n[e[o][c]]===void 0?n[e[o][c]]=s[c]:G(n[e[o][c]]===s[c],function(){return"Expected dimension "+n[e[o][c]]+" at axis "+c+" "+("of input shaped "+JSON.stringify(s)+", ")+("but got dimension "+s[c])})},l=0;l<e[o].length;++l)u(l)},i=0;i<t.length;++i)a(i)}function vle(r,e){var t,n,a=r,i=[],o=0;r.length===0&&a.push(-1),o=r.length+1;for(var s=0;s<o;++s)i.push([]);for(var u=[],s=0;s<a.length;++s){var l=a[s],c=gle(e,l);try{for(var f=(t=void 0,On(c)),h=f.next();!h.done;h=f.next()){var p=h.value;u.indexOf(p)===-1&&(i[s].push(p),u.push(p))}}catch(m){t={error:m}}finally{try{h&&!h.done&&(n=f.return)&&n.call(f)}finally{if(t)throw t.error}}}return{path:a,steps:i}}function mle(r){return r.every(function(e,t){return e===t})}function gle(r,e){for(var t=[],n=0;n<r.length;++n)(r[n].length===0||r[n].indexOf(e)!==-1||e===-1)&&t.push(n);return t}function yle(r,e,t){t===void 0&&(t=0);var n=[];if(typeof e=="number")G(r.shape[t]%e===0,function(){return"Number of splits must evenly divide the axis."}),n=new Array(e).fill(r.shape[t]/e);else{var a=e.reduce(function(s,u){return u===-1&&(s+=1),s},0);G(a<=1,function(){return"There should be only one negative value in split array."});var i=e.indexOf(-1);if(i!==-1){var o=e.reduce(function(s,u){return u>0?s+u:s});e[i]=r.shape[t]-o}G(r.shape[t]===e.reduce(function(s,u){return s+u}),function(){return"The sum of sizes must match the size of the axis dimension."}),n=e}return n}function ble(r){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = `+r}function wle(r,e){return"indices("+r+", 0) is invalid: "+e+" < 0"}function xle(r,e,t){return"indices("+r+", 0) is invalid: "+e+" >= "+t}function kle(r,e){return"only one output dimension may be -1, not both "+r+" and "+e}function Sle(r,e){return"size "+r+" must be non-negative, not "+e}function Nle(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function Ele(r,e){var t=ir(r),n=ir(e);return"Input to reshape is a SparseTensor with "+t+`
  dense values, but the requested shape requires a multiple of `+n+". inputShape="+r+" outputShape= "+e}function Tle(r,e){var t=ir(r),n=ir(e);return"Input to reshape is a tensor with "+t+" dense values, but the requested shape has "+n+". inputShape="+r+" outputShape="+e}function Ile(){return"segment ids must be >= 0"}function Cle(){return"segment ids are not increasing"}function Ale(r,e){return"Segment id "+r+" out of range [0, "+e+"), possibly because segmentIds input is not sorted."}function _le(r,e,t){return"Bad: indices["+r+"] == "+e+" out of range [0, "+t+")"}function Dle(r,e){var t=!1,n;for(r<=sb?(n=r,t=!0):n=Pd(r,Math.floor(Math.sqrt(r)));!t;)n>e||n===r?t=!0:n=Pd(r,n+1);return n}function Fle(r,e,t){for(var n=[],a=r.length,i=0;i<a;i++)i!==e?n.push(r[i]):n.push(t);return n}function Rle(r,e,t,n){var a=e.shape.length,i=r.shape.length;if(n!==0&&(n<-a||n>a))throw new Error("Expect batchDims in the range of [-"+a+", "+a+"], but got "+n);if(n<0&&(n+=a),n>i)throw new Error("batchDims ("+n+`) must be less than rank(x) (
    `+i+").");if(t<n)throw new Error("batchDims ("+n+") must be less than or equal to axis ("+t+").");for(var o=0;o<n;++o)if(r.shape[o]!==e.shape[o])throw new Error("x.shape["+o+"]: "+r.shape[o]+" should be equal to indices.shape["+o+"]: "+e.shape[o]+".");for(var s=r.shape[t],u=[],l=1,c=1,f=1,o=0;o<n;++o)u.push(r.shape[o]),l*=r.shape[o];for(var o=n;o<t;o++)u.push(r.shape[o]),c*=r.shape[o];for(var o=n;o<a;o++)u.push(e.shape[o]);for(var o=t+1;o<i;o++)u.push(r.shape[o]),f*=r.shape[o];return{batchSize:l,sliceSize:f,outerSize:c,dimSize:s,outputShape:u}}var Ole={__proto__:null,segOpComputeOptimalWindowSize:Dle,computeOutShape:Fle,collectGatherOpShapeInfo:Rle};function Ple(r){try{return r.map(function(e){return zd(e)})}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8, error: "+e)}}function Mle(r){return r.map(function(e){return zf(e)})}var Ble={__proto__:null,slice_util:KF,segment_util:Ole,fromUint8ToStringArray:Ple,fromStringArrayToUint8:Mle,upcastType:Zd,axesAreInnerMostDims:Y0,combineLocations:uR,computeOutAndReduceShapes:nne,expandShapeToKeepDim:Vf,assertAxesAreInnerMostDims:ane,getAxesPermutation:ine,getUndoAxesPermutation:one,getInnerMostAxes:sne,getBroadcastDims:OF,getReductionAxes:V0,assertAndGetBroadcastShape:Hr,assertParamsConsistent:Mue,computeOutShape:Bue,computeDilation2DInfo:Ate,computePool2DInfo:QF,computePool3DInfo:_te,computeConv2DInfo:Wf,computeConv3DInfo:eR,computeDefaultPad:j0,tupleValuesAreOne:Df,eitherStridesOrDilationsAreOne:mo,convertConv2DDataFormat:tR,checkPadOnDimRoundingMode:Ga,getFusedDyActivation:iv,getFusedBiasGradient:ov,applyActivation:sv,shouldFuse:uv,get RowPartitionType(){return Gi},combineRaggedTensorToTensorShapes:Lue,getRowPartitionTypesHelper:zue,getRaggedRank:$ue,validateDefaultValueShape:Wue,PARALLELIZE_THRESHOLD:sb,computeOptimalWindowSize:que,getImageCenter:Vue,getReshaped:Gue,getPermuted:Uue,getReshapedPermuted:Hue,getSliceBeginCoords:Kue,getSliceSize:jue,prepareAndValidate:BF,validateUpdateShape:G0,validateInput:U0,calculateShapes:LF,SELU_SCALEALPHA:Xue,SELU_SCALE:Yue,ERF_P:Zue,ERF_A1:Jue,ERF_A2:Que,ERF_A3:ele,ERF_A4:tle,ERF_A5:rle,warn:Xo,log:dJ,mergeRealAndImagArrays:nle,splitRealAndImagArrays:ale,complexWithEvenIndex:ile,complexWithOddIndex:ole,getComplexWithIndex:sle,assignToTypedArray:ule,exponents:lle,exponent:cle,decodeEinsumEquation:hle,getEinsumPermutation:ple,checkEinsumDimSizes:dle,getEinsumComputePath:vle,isIdentityPermutation:mle,prepareSplitSize:yle,getSparseFillEmptyRowsIndicesDenseShapeMismatch:ble,getSparseFillEmptyRowsNegativeIndexErrorMessage:wle,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:xle,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:kle,getSparseReshapeNegativeOutputDimErrorMessage:Sle,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:Nle,getSparseReshapeInputOutputMultipleErrorMessage:Ele,getSparseReshapeInputOutputMismatchErrorMessage:Tle,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Ile,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:Cle,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:Ale,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:_le};var Lle={__proto__:null,nonMaxSuppressionV3Impl:zR,nonMaxSuppressionV4Impl:$R,nonMaxSuppressionV5Impl:WR,whereImpl:OR};A.Abs=g_;A.Acos=y_;A.Acosh=b_;A.AdadeltaOptimizer=lv;A.AdagradOptimizer=cv;A.AdamOptimizer=fv;A.AdamaxOptimizer=hv;A.Add=_0;A.AddN=w_;A.All=x_;A.Any=k_;A.ArgMax=S_;A.ArgMin=N_;A.Asin=E_;A.Asinh=T_;A.Atan=I_;A.Atan2=A_;A.Atanh=C_;A.AvgPool=__;A.AvgPool3D=D_;A.AvgPool3DGrad=ZZ;A.AvgPoolGrad=YZ;A.BatchMatMul=F_;A.BatchToSpaceND=R_;A.Bincount=O_;A.BroadcastArgs=P_;A.BroadcastTo=JZ;A.Cast=D0;A.Ceil=M_;A.ClipByValue=B_;A.Complex=L_;A.ComplexAbs=z_;A.Concat=$_;A.Conv2D=W_;A.Conv2DBackpropFilter=q_;A.Conv2DBackpropInput=V_;A.Conv3D=G_;A.Conv3DBackpropFilterV2=QZ;A.Conv3DBackpropInputV2=U_;A.Cos=H_;A.Cosh=K_;A.CropAndResize=Y_;A.Cumprod=j_;A.Cumsum=X_;A.DataStorage=AZ;A.DenseBincount=Z_;A.DepthToSpace=J_;A.DepthwiseConv2dNative=Q_;A.DepthwiseConv2dNativeBackpropFilter=eD;A.DepthwiseConv2dNativeBackpropInput=tD;A.Diag=rD;A.Dilation2D=nD;A.Dilation2DBackpropFilter=tJ;A.Dilation2DBackpropInput=eJ;A.Einsum=iD;A.Elu=oD;A.EluGrad=rJ;A.Environment=v_;A.Equal=uD;A.Erf=sD;A.Exp=lD;A.ExpandDims=cD;A.Expm1=fD;A.FFT=hD;A.Fill=pD;A.FlipLeftRight=dD;A.Floor=vD;A.FloorDiv=mD;A.FromPixels=r0;A.FusedBatchNorm=gD;A.FusedConv2D=a0;A.FusedDepthwiseConv2D=i0;A.GatherNd=bD;A.GatherV2=yD;A.Greater=wD;A.GreaterEqual=xD;A.IFFT=kD;A.Identity=F0;A.Imag=SD;A.IsFinite=ND;A.IsInf=ED;A.IsNan=TD;A.KernelBackend=a_;A.LRN=MD;A.LRNGrad=oJ;A.LeakyRelu=ID;A.Less=CD;A.LessEqual=AD;A.LinSpace=_D;A.Log=DD;A.Log1p=FD;A.LogSoftmax=aJ;A.LogicalAnd=RD;A.LogicalNot=OD;A.LogicalOr=PD;A.LogicalXor=nJ;A.LowerBound=iJ;A.Max=BD;A.MaxPool=zD;A.MaxPool3D=$D;A.MaxPool3DGrad=uJ;A.MaxPoolGrad=sJ;A.MaxPoolWithArgmax=WD;A.Maximum=LD;A.Mean=qD;A.Min=VD;A.Minimum=GD;A.MirrorPad=UD;A.Mod=HD;A.MomentumOptimizer=pv;A.Multinomial=KD;A.Multiply=jD;A.Neg=XD;A.NonMaxSuppressionV3=ZD;A.NonMaxSuppressionV4=JD;A.NonMaxSuppressionV5=QD;A.NotEqual=YD;A.OP_SCOPE_SUFFIX=vF;A.OneHot=t3;A.OnesLike=e3;A.Optimizer=is;A.OptimizerConstructors=jo;A.Pack=r3;A.PadV2=n3;A.Pool=lJ;A.Pow=a3;A.Prelu=i3;A.Prod=o3;A.RMSPropOptimizer=dv;A.RaggedGather=s3;A.RaggedTensorToTensor=u3;A.Range=l3;A.Real=c3;A.RealDiv=aD;A.Reciprocal=f3;A.Relu=h3;A.Relu6=m3;A.Reshape=p3;A.ResizeBilinear=v3;A.ResizeBilinearGrad=fJ;A.ResizeNearestNeighbor=d3;A.ResizeNearestNeighborGrad=cJ;A.Reverse=g3;A.RotateWithOffset=tF;A.Round=y3;A.Rsqrt=b3;A.SGDOptimizer=Uf;A.ScatterNd=w3;A.SearchSorted=x3;A.Select=k3;A.Selu=S3;A.Sigmoid=C3;A.Sign=I3;A.Sin=E3;A.Sinh=T3;A.Slice=N3;A.Softmax=O3;A.Softplus=A3;A.SpaceToBatchND=F3;A.SparseFillEmptyRows=P3;A.SparseReshape=M3;A.SparseSegmentMean=B3;A.SparseSegmentSum=L3;A.SparseToDense=z3;A.SplitV=R3;A.Sqrt=_3;A.Square=hJ;A.SquaredDifference=$3;A.Step=eF;A.StridedSlice=W3;A.StringNGrams=q3;A.StringSplit=V3;A.StringToHashBucketFast=G3;A.Sub=U3;A.Sum=D3;A.Tan=H3;A.Tanh=K3;A.Tensor=Gr;A.TensorBuffer=$d;A.Tile=R0;A.TopK=j3;A.Transform=X3;A.Transpose=_d;A.Unique=Y3;A.Unpack=Z3;A.UnsortedSegmentSum=J3;A.UpperBound=pJ;A.Variable=Cf;A.ZerosLike=Q3;A._FusedMatMul=n0;A.abs=Ea;A.acos=ote;A.acosh=ute;A.add=pt;A.addN=cte;A.all=hte;A.any=dte;A.argMax=mte;A.argMin=yte;A.asin=wte;A.asinh=kte;A.atan=Nte;A.atan2=Tte;A.atanh=Cte;A.avgPool=rR;A.avgPool3d=Lte;A.backend=hee;A.backend_util=Ble;A.basicLSTMCell=Gte;A.batchNorm=Qd;A.batchNorm2d=Xte;A.batchNorm3d=Zte;A.batchNorm4d=Qte;A.batchToSpaceND=nR;A.bincount=aR;A.booleanMaskAsync=Toe;A.broadcastArgs=rre;A.broadcastTo=Rd;A.broadcast_util=xee;A.browser=Aee;A.buffer=ho;A.cast=Or;A.ceil=ire;A.clipByValue=sre;A.clone=Gs;A.complex=es;A.concat=ea;A.concat1d=lre;A.concat2d=fre;A.concat3d=pre;A.concat4d=vre;A.conv1d=yre;A.conv2d=ev;A.conv2dTranspose=xre;A.conv3d=Sre;A.conv3dTranspose=Ire;A.copyRegisteredKernels=yJ;A.cos=Are;A.cosh=Dre;A.cosineWindow=ib;A.cumprod=Rre;A.cumsum=Pre;A.customGrad=Hi;A.denseBincount=Bre;A.deprecationWarn=QQ;A.depthToSpace=zre;A.depthwiseConv2d=X0;A.device_util=YJ;A.diag=qre;A.dilation2d=Gre;A.disableDeprecationWarnings=JQ;A.dispose=Rn;A.disposeVariables=eee;A.div=ar;A.divNoNan=Xre;A.dot=Zre;A.dropout=Loe;A.einsum=Qre;A.elu=sR;A.enableDebugMode=ZQ;A.enableProdMode=YQ;A.enclosingPowerOfTwo=MR;A.engine=tee;A.env=It;A.equal=oR;A.erf=rne;A.euclideanNorm=mne;A.exp=Xs;A.expandDims=zs;A.expm1=wne;A.eye=cR;A.fft=tb;A.fill=qf;A.findBackend=lee;A.findBackendFactory=cee;A.floor=fR;A.floorDiv=JF;A.fused=Qoe;A.gather=hR;A.gatherND=Poe;A.gather_util=_ee;A.getBackend=see;A.getGradient=o0;A.getKernel=Md;A.getKernelsForBackend=Bd;A.grad=qne;A.grads=Vne;A.greater=rv;A.greaterEqual=pR;A.ifft=Kd;A.imag=Jd;A.image=Cue;A.inTopKAsync=$oe;A.io=KQ;A.irfft=DR;A.isFinite=Cne;A.isInf=_ne;A.isNaN=Fne;A.keep=RF;A.kernel_impls=Lle;A.leakyRelu=dR;A.less=Pne;A.lessEqual=Z0;A.linalg=Aue;A.linspace=Bne;A.localResponseNormalization=zne;A.log=Rf;A.log1p=vR;A.logSigmoid=jne;A.logSoftmax=Zne;A.logSumExp=yR;A.logicalAnd=Ud;A.logicalNot=bR;A.logicalOr=wR;A.logicalXor=nae;A.losses=_ue;A.lowerBound=iae;A.matMul=Wt;A.math=wee;A.max=Nl;A.maxPool=xR;A.maxPool3d=uae;A.maxPoolWithArgmax=cae;A.maximum=kR;A.mean=Hd;A.memory=ree;A.meshgrid=pae;A.min=E0;A.minimum=SR;A.mirrorPad=mae;A.mod=yae;A.moments=wae;A.movingAverage=Coe;A.mul=Pe;A.multiRNNCell=kae;A.multinomial=Nae;A.neg=fo;A.nextFrame=Pue;A.norm=tv;A.notEqual=NR;A.oneHot=w0;A.ones=Vs;A.onesLike=Iae;A.op=J;A.outerProduct=Aae;A.pad=Gf;A.pad1d=Fae;A.pad2d=Oae;A.pad3d=Mae;A.pad4d=Lae;A.pool=Vae;A.pow=Ff;A.prelu=TR;A.print=IF;A.prod=Hae;A.profile=nee;A.raggedGather=jae;A.raggedTensorToTensor=Yae;A.rand=Jae;A.randomGamma=uie;A.randomNormal=IR;A.randomStandardNormal=fie;A.randomUniform=CR;A.range=Of;A.ready=oee;A.real=_f;A.reciprocal=die;A.registerBackend=fee;A.registerGradient=vJ;A.registerKernel=rF;A.relu=av;A.relu6=AR;A.removeBackend=uee;A.reshape=Ee;A.reverse=Ys;A.reverse1d=bie;A.reverse2d=xie;A.reverse3d=Sie;A.reverse4d=Eie;A.rfft=rb;A.round=_R;A.rsqrt=Cie;A.scalar=qt;A.scatterND=_oe;A.scatter_util=Dee;A.searchSorted=J0;A.selu=_ie;A.separableConv2d=Fie;A.serialization=qee;A.setBackend=iee;A.setPlatform=pee;A.setdiff1dAsync=Oie;A.sigmoid=Sl;A.sign=Mie;A.signal=Iue;A.sin=Lie;A.sinh=$ie;A.slice=kr;A.slice1d=qie;A.slice2d=Gie;A.slice3d=Hie;A.slice4d=jie;A.slice_util=KF;A.softmax=Yie;A.softplus=gR;A.spaceToBatchND=ER;A.sparse=Due;A.sparseToDense=Roe;A.spectral=Tue;A.split=Pf;A.sqrt=po;A.square=gi;A.squaredDifference=FR;A.squeeze=nb;A.stack=Mf;A.step=RR;A.stridedSlice=soe;A.string=Fue;A.sub=At;A.sum=nr;A.sumOutType=WJ;A.tan=loe;A.tanh=N0;A.tensor=wl;A.tensor1d=mi;A.tensor2d=Nf;A.tensor3d=PF;A.tensor4d=coe;A.tensor5d=foe;A.tensor6d=hoe;A.tensor_util=GJ;A.test_util=Jee;A.tidy=Ur;A.tile=Sf;A.time=aee;A.topk=doe;A.train=Rue;A.transpose=Vd;A.truncatedNormal=moe;A.unique=yoe;A.unregisterGradient=gJ;A.unregisterKernel=mJ;A.unsortedSegmentSum=woe;A.unstack=ab;A.upcastType=Zd;A.upperBound=koe;A.util=AJ;A.valueAndGrad=Gne;A.valueAndGrads=Une;A.variable=Soe;A.variableGrads=mR;A.version_core=Qee;A.where=Cl;A.whereAsync=PR;A.zeros=Al;A.zerosLike=Ta});var JR=ue((Pit,ZR)=>{ZR.exports=ur;var Ua=null;try{Ua=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function ur(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}ur.prototype.__isLong__;Object.defineProperty(ur.prototype,"__isLong__",{value:!0});function aa(r){return(r&&r.__isLong__)===!0}ur.isLong=aa;var qR={},VR={};function au(r,e){var t,n,a;return e?(r>>>=0,(a=0<=r&&r<256)&&(n=VR[r],n)?n:(t=lr(r,(r|0)<0?-1:0,!0),a&&(VR[r]=t),t)):(r|=0,(a=-128<=r&&r<128)&&(n=qR[r],n)?n:(t=lr(r,r<0?-1:0,!1),a&&(qR[r]=t),t))}ur.fromInt=au;function Ha(r,e){if(isNaN(r))return e?nu:Ka;if(e){if(r<0)return nu;if(r>=KR)return YR}else{if(r<=-UR)return na;if(r+1>=UR)return XR}return r<0?Ha(-r,e).neg():lr(r%Rl|0,r/Rl|0,e)}ur.fromNumber=Ha;function lr(r,e,t){return new ur(r,e,t)}ur.fromBits=lr;var vv=Math.pow;function lb(r,e,t){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return Ka;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return lb(r.substring(1),e,t).neg();for(var a=Ha(vv(t,8)),i=Ka,o=0;o<r.length;o+=8){var s=Math.min(8,r.length-o),u=parseInt(r.substring(o,o+s),t);if(s<8){var l=Ha(vv(t,s));i=i.mul(l).add(Ha(u))}else i=i.mul(a),i=i.add(Ha(u))}return i.unsigned=e,i}ur.fromString=lb;function bi(r,e){return typeof r=="number"?Ha(r,e):typeof r=="string"?lb(r,e):lr(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}ur.fromValue=bi;var GR=1<<16,zle=1<<24,Rl=GR*GR,KR=Rl*Rl,UR=KR/2,HR=au(zle),Ka=au(0);ur.ZERO=Ka;var nu=au(0,!0);ur.UZERO=nu;var Fl=au(1);ur.ONE=Fl;var jR=au(1,!0);ur.UONE=jR;var ub=au(-1);ur.NEG_ONE=ub;var XR=lr(-1,2147483647,!1);ur.MAX_VALUE=XR;var YR=lr(-1,-1,!0);ur.MAX_UNSIGNED_VALUE=YR;var na=lr(0,-2147483648,!1);ur.MIN_VALUE=na;var De=ur.prototype;De.toInt=function(){return this.unsigned?this.low>>>0:this.low};De.toNumber=function(){return this.unsigned?(this.high>>>0)*Rl+(this.low>>>0):this.high*Rl+(this.low>>>0)};De.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(na)){var t=Ha(e),n=this.div(t),a=n.mul(t).sub(this);return n.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Ha(vv(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),l=o.sub(u.mul(i)).toInt()>>>0,c=l.toString(e);if(o=u,o.isZero())return c+s;for(;c.length<6;)c="0"+c;s=""+c+s}};De.getHighBits=function(){return this.high};De.getHighBitsUnsigned=function(){return this.high>>>0};De.getLowBits=function(){return this.low};De.getLowBitsUnsigned=function(){return this.low>>>0};De.getNumBitsAbs=function(){if(this.isNegative())return this.eq(na)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};De.isZero=function(){return this.high===0&&this.low===0};De.eqz=De.isZero;De.isNegative=function(){return!this.unsigned&&this.high<0};De.isPositive=function(){return this.unsigned||this.high>=0};De.isOdd=function(){return(this.low&1)===1};De.isEven=function(){return(this.low&1)===0};De.equals=function(e){return aa(e)||(e=bi(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};De.eq=De.equals;De.notEquals=function(e){return!this.eq(e)};De.neq=De.notEquals;De.ne=De.notEquals;De.lessThan=function(e){return this.comp(e)<0};De.lt=De.lessThan;De.lessThanOrEqual=function(e){return this.comp(e)<=0};De.lte=De.lessThanOrEqual;De.le=De.lessThanOrEqual;De.greaterThan=function(e){return this.comp(e)>0};De.gt=De.greaterThan;De.greaterThanOrEqual=function(e){return this.comp(e)>=0};De.gte=De.greaterThanOrEqual;De.ge=De.greaterThanOrEqual;De.compare=function(e){if(aa(e)||(e=bi(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};De.comp=De.compare;De.negate=function(){return!this.unsigned&&this.eq(na)?na:this.not().add(Fl)};De.neg=De.negate;De.add=function(e){aa(e)||(e=bi(e));var t=this.high>>>16,n=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,l=e.low&65535,c=0,f=0,h=0,p=0;return p+=i+l,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=n+s,c+=f>>>16,f&=65535,c+=t+o,c&=65535,lr(h<<16|p,c<<16|f,this.unsigned)};De.subtract=function(e){return aa(e)||(e=bi(e)),this.add(e.neg())};De.sub=De.subtract;De.multiply=function(e){if(this.isZero())return Ka;if(aa(e)||(e=bi(e)),Ua){var t=Ua.mul(this.low,this.high,e.low,e.high);return lr(t,Ua.get_high(),this.unsigned)}if(e.isZero())return Ka;if(this.eq(na))return e.isOdd()?na:Ka;if(e.eq(na))return this.isOdd()?na:Ka;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(HR)&&e.lt(HR))return Ha(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,l=e.low>>>16,c=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*c,p+=d>>>16,d&=65535,p+=i*c,h+=p>>>16,p&=65535,p+=o*l,h+=p>>>16,p&=65535,h+=a*c,f+=h>>>16,h&=65535,h+=i*l,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=n*c+a*l+i*u+o*s,f&=65535,lr(p<<16|d,f<<16|h,this.unsigned)};De.mul=De.multiply;De.divide=function(e){if(aa(e)||(e=bi(e)),e.isZero())throw Error("division by zero");if(Ua){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Ua.div_u:Ua.div_s)(this.low,this.high,e.low,e.high);return lr(t,Ua.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?nu:Ka;var n,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return nu;if(e.gt(this.shru(1)))return jR;i=nu}else{if(this.eq(na)){if(e.eq(Fl)||e.eq(ub))return na;if(e.eq(na))return Fl;var o=this.shr(1);return n=o.div(e).shl(1),n.eq(Ka)?e.isNegative()?Fl:ub:(a=this.sub(e.mul(n)),i=n.add(a.div(e)),i)}else if(e.eq(na))return this.unsigned?nu:Ka;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Ka}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:vv(2,s-48),l=Ha(n),c=l.mul(e);c.isNegative()||c.gt(a);)n-=u,l=Ha(n,this.unsigned),c=l.mul(e);l.isZero()&&(l=Fl),i=i.add(l),a=a.sub(c)}return i};De.div=De.divide;De.modulo=function(e){if(aa(e)||(e=bi(e)),Ua){var t=(this.unsigned?Ua.rem_u:Ua.rem_s)(this.low,this.high,e.low,e.high);return lr(t,Ua.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};De.mod=De.modulo;De.rem=De.modulo;De.not=function(){return lr(~this.low,~this.high,this.unsigned)};De.and=function(e){return aa(e)||(e=bi(e)),lr(this.low&e.low,this.high&e.high,this.unsigned)};De.or=function(e){return aa(e)||(e=bi(e)),lr(this.low|e.low,this.high|e.high,this.unsigned)};De.xor=function(e){return aa(e)||(e=bi(e)),lr(this.low^e.low,this.high^e.high,this.unsigned)};De.shiftLeft=function(e){return aa(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?lr(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):lr(0,this.low<<e-32,this.unsigned)};De.shl=De.shiftLeft;De.shiftRight=function(e){return aa(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?lr(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):lr(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};De.shr=De.shiftRight;De.shiftRightUnsigned=function(e){if(aa(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var n=this.low;return lr(n>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?lr(t,0,this.unsigned):lr(t>>>e-32,0,this.unsigned)};De.shru=De.shiftRightUnsigned;De.shr_u=De.shiftRightUnsigned;De.toSigned=function(){return this.unsigned?lr(this.low,this.high,!1):this};De.toUnsigned=function(){return this.unsigned?this:lr(this.low,this.high,!0)};De.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};De.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};De.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};ur.fromBytes=function(e,t,n){return n?ur.fromBytesLE(e,t):ur.fromBytesBE(e,t)};ur.fromBytesLE=function(e,t){return new ur(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};ur.fromBytesBE=function(e,t){return new ur(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}});var WB=ue(dr=>{"use strict";Object.defineProperty(dr,"__esModule",{value:!0});var M=ru();function $le(r){if(r&&r.__esModule)return r;var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var _=$le(M),bb=function(r,e){return bb=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},bb(r,e)};function ge(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");bb(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Ce(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(f){o(f)}}function u(c){try{l(n.throw(c))}catch(f){o(f)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(r,e||[])).next())})}function Ie(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(l){return function(c){return u([l,c])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=l[0]&2?a.return:l[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,l[1])).done)return i;switch(a=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,a=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){t.label=l[1];break}if(l[0]===6&&t.label<i[1]){t.label=i[1],i=l;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(l);break}i[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(c){l=[6,c],a=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function be(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function me(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function mt(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(me(arguments[e]));return r}var ss=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e}(Error),Xi=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e}(Error),ie=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e}(Error),Nt=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e}(Error),Wle=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e}(Error);(function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e})(Error);var aP=function(){function r(e){this.maxEntries=e||100,this.cache=new Map}return r.prototype.get=function(e){var t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t},r.prototype.put=function(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){var n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,t)},r.prototype.getMaxEntries=function(){return this.maxEntries},r.prototype.setMaxEntries=function(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got "+e+".");if(this.maxEntries>e)for(var t=0;t<this.maxEntries-e;t++){var n=this.cache.keys().next().value;this.cache.delete(n)}this.maxEntries=e},r}();function fu(r,e){if(Array.isArray(r)){for(var t=[],n=0;n<e;n++)t=t.concat(r);return t}else{var t=new Array(e);return t.fill(r),t}}function Ki(r,e){if(!r)throw new Wle(e)}function QR(r,e){var t,n,a=0;try{for(var i=be(r),o=i.next();!o.done;o=i.next()){var s=o.value;s===e&&a++}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a}function Pn(r){return r.length===1?r[0]:r}function cr(r){return Array.isArray(r)?r:[r]}function yo(r){var e=r.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2"),t=e.replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function su(r){return r.length<=1||r.indexOf("_")===-1?r:r.replace(/[_]+(\w|$)/g,function(e,t){return t.toUpperCase()})}var ja={};function Wb(r){if(r==null)return null;var e={};return e.className=r.getClassName(),e.config=r.getConfig(),e}function wb(r){var e,t;if(!(r==null||typeof r!="object"))if(Array.isArray(r))r.forEach(function(u){return wb(u)});else{var n=Object.keys(r);try{for(var a=be(n),i=a.next();!i.done;i=a.next()){var o=i.value,s=r[o];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?r[o]=s.value:wb(s))}}catch(u){e={error:u}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}}}function vh(r,e,t,n,a){var i,o,s,u,l,c,f,h,p,d,m;if(e===void 0&&(e={}),t===void 0&&(t={}),n===void 0&&(n="object"),a===void 0&&(a=!1),typeof r=="string"){var v=r,g=void 0;if(v in t)g=t[v];else if(v in ja)g=ja[v];else if(g=e[v],g==null)throw new ie("Unknown "+n+": "+r+`. This may be due to one of the following reasons:
`+("1. The "+n+" is defined in Python, in which ")+`case it needs to be ported to TensorFlow.js or your JavaScript code.
`+("2. The custom "+n+" is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");return g}else{var y=r;if(y.className==null||y.config==null)throw new ie(n+": Improper config format: "+(JSON.stringify(y)+`.
`)+"'className' and 'config' must set.");var b=y.className,w=void 0,x=void 0;if(b in t?(i=me(t[b],2),w=i[0],x=i[1]):b in ja?(o=me(ja.className,2),w=o[0],x=o[1]):b in e&&(s=me(e[b],2),w=s[0],x=s[1]),w==null)throw new ie("Unknown "+n+": "+b+`. This may be due to one of the following reasons:
`+("1. The "+n+" is defined in Python, in which ")+`case it needs to be ported to TensorFlow.js or your JavaScript code.
`+("2. The custom "+n+" is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");if(x!=null){var k={};try{for(var N=be(Object.keys(ja)),T=N.next();!T.done;T=N.next()){var I=T.value;k[I]=ja[I]}}catch(Z){u={error:Z}}finally{try{T&&!T.done&&(l=N.return)&&l.call(N)}finally{if(u)throw u.error}}try{for(var F=be(Object.keys(t)),D=F.next();!D.done;D=F.next()){var I=D.value;k[I]=t[I]}}catch(Z){c={error:Z}}finally{try{D&&!D.done&&(f=F.return)&&f.call(F)}finally{if(c)throw c.error}}var R=y.config;R.customObjects=k;var P=Object.assign({},ja);try{for(var B=be(Object.keys(t)),q=B.next();!q.done;q=B.next()){var I=q.value;ja[I]=t[I]}}catch(Z){h={error:Z}}finally{try{q&&!q.done&&(p=B.return)&&p.call(B)}finally{if(h)throw h.error}}wb(y.config);var O=x(w,y.config,t,a);return ja=Object.assign({},P),O}else{var P=Object.assign({},ja);try{for(var V=be(Object.keys(t)),K=V.next();!K.done;K=V.next()){var I=K.value;ja[I]=t[I]}}catch(ee){d={error:ee}}finally{try{K&&!K.done&&(m=V.return)&&m.call(V)}finally{if(d)throw d.error}}var O=new w(y.config);return ja=Object.assign({},P),O}}}function qle(r,e){return r<e?-1:r>e?1:0}function mv(r,e){return-1*qle(r,e)}function us(r){var e,t;if(r==null)return r;var n=[];try{for(var a=be(r),i=a.next();!i.done;i=a.next()){var o=i.value;n.indexOf(o)===-1&&n.push(o)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}function Vle(r){if(r==null)throw new ie("Invalid value in obj: "+JSON.stringify(r));for(var e in r)if(r.hasOwnProperty(e))return!1;return!0}function du(r,e,t){if(t!=null&&r.indexOf(t)<0)throw new ie(t+" is not a valid "+e+".  Valid values are "+r+" or null/undefined.")}function qb(r,e,t,n){return t===void 0&&(t=0),n===void 0&&(n=1/0),Ki(t>=0),Ki(n>=t),Array.isArray(r)&&r.length>=t&&r.length<=n&&r.every(function(a){return typeof a===e})}function an(r,e){Array.isArray(r)?(M.util.assert(r.length>0,function(){return e+" is unexpectedly an empty array."}),r.forEach(function(t,n){return an(t,"element "+(n+1)+" of "+e)})):M.util.assert(Number.isInteger(r)&&r>0,function(){return"Expected "+e+" to be a positive integer, but got "+(iP(r)+".")})}function iP(r){return r===null?"null":Array.isArray(r)?"["+r.map(function(e){return iP(e)}).join(",")+"]":typeof r=="string"?'"'+r+'"':""+r}function Gle(r,e,t){var n=t!=null?t():M.util.now(),a,i=function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var u=t!=null?t():M.util.now();return u-n<e||(n=u,a=r.apply(void 0,mt(o))),a};return i}function oP(r){return r==="relu"?"relu":r==="linear"?"linear":r==="elu"?"elu":null}var Ule=0;function sP(){return Ule++}var gv={};function Kv(r){return r===void 0&&(r=""),r in gv||(gv[r]=0),gv[r]+=1,r+gv[r].toString()}var Hle=["channelsFirst","channelsLast"],Kle=["nearest","bilinear"],jle=["valid","same","causal"],Xle=["max","avg"],Yle=["sum","mul","concat","ave"];var Ol=new Map;function qr(r){du(Hle,"DataFormat",r)}function Zle(r){du(Kle,"InterpolationFormat",r)}function Da(r){du(jle,"PaddingMode",r)}function uP(r){du(Xle,"PoolMode",r)}var nh=[],eO="/";function lu(r,e){nh.push(r);try{var t=e();return nh.pop(),t}catch(n){throw nh.pop(),n}}function Jle(){return nh.length===0?"":nh.join(eO)+eO}function lP(r){if(!fP(r))throw new Error("Not a valid tensor name: '"+r+"'");return Jle()+r}function cP(r){if(!fP(r))throw new Error("Not a valid tensor name: '"+r+"'");Ol.has(r)||Ol.set(r,0);var e=Ol.get(r);if(Ol.set(r,Ol.get(r)+1),e>0){var t=r+"_"+e;return Ol.set(t,1),t}else return r}var Qle=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function fP(r){return!!r.match(Qle)}function ece(r){return r===parseInt(r.toString(),10)}function ls(r,e,t){e==null&&(e=0),t==null&&(t=r.length);for(var n=1,a=e;a<t;++a)n*=r[a];return n}function ql(r){if(r.length===0)return Number.NaN;for(var e=Number.POSITIVE_INFINITY,t=0;t<r.length;t++){var n=r[t];n<e&&(e=n)}return e}function cs(r){if(r.length===0)return Number.NaN;for(var e=Number.NEGATIVE_INFINITY,t=0;t<r.length;t++){var n=r[t];n>e&&(e=n)}return e}function Ei(r,e){if(e<r)throw new ie("end ("+e+") < begin ("+r+") is forbidden.");for(var t=[],n=r;n<e;++n)t.push(n);return t}var cb;function Zr(){return cb==null&&(cb=M.backend().epsilon()),cb}function Ti(){return"channelsLast"}function mh(r,e){return _.cast(r,e)}function gh(r,e){e===void 0&&(e=-1);var t=r.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),_.reshape(r,t)}function tce(r,e){return M.tidy(function(){if(r.shape.length!==2)throw new ie("repeat() expects a rank-2 tensor, but received a "+("rank-"+r.shape.length+" tensor."));var t=gh(r,1);return xb(t,[1,e,1])})}function rce(r){var e=[ls(r.shape)];return _.reshape(r,e)}function nce(r){if(r.rank<=1)throw new ie("batchFlatten requires a minimum rank of 2. Got rank: "+r.rank+".");var e=[r.shape[0],ls(r.shape,1)];return _.reshape(r,e)}function cu(r,e,t){return M.tidy(function(){switch(r.rank){case 1:return _.slice1d(r,e,t);case 2:return _.slice2d(r,[e,0],[t,r.shape[1]]);case 3:return _.slice3d(r,[e,0,0],[t,r.shape[1],r.shape[2]]);case 4:return _.slice4d(r,[e,0,0,0],[t,r.shape[1],r.shape[2],r.shape[3]]);case 5:return _.slice(r,[e,0,0,0,0],[t,r.shape[1],r.shape[2],r.shape[3],r.shape[4]]);case 6:return _.slice(r,[e,0,0,0,0,0],[t,r.shape[1],r.shape[2],r.shape[3],r.shape[4],r.shape[5]]);default:throw new ie("sliceAlongFirstAxis() received an unsupported tensor rank: "+(""+r.rank))}})}function fb(r,e,t){return M.tidy(function(){switch(r.rank){case 1:return _.slice1d(r,e,t);case 2:return _.slice2d(r,[0,e],[r.shape[0],t]);case 3:return _.slice3d(r,[0,0,e],[r.shape[0],r.shape[1],t]);case 4:return _.slice4d(r,[0,0,0,e],[r.shape[0],r.shape[1],r.shape[2],t]);default:throw new ie("sliceAlongLastAxis() received an unsupported tensor rank: "+(""+r.rank))}})}function yv(r,e,t,n){return M.tidy(function(){switch(r.rank){case 1:return _.slice1d(r,e,t);case 2:switch(n){case 1:return cu(r,e,t);case 2:return fb(r,e,t);default:throw new ie("The axis is not within the rank of the tensor "+(""+n))}case 3:switch(n){case 1:return cu(r,e,t);case 2:return _.slice3d(r,[0,e,0],[r.shape[0],t,r.shape[2]]);case 3:return fb(r,e,t);default:throw new ie("The axis is not within the rank of the tensor "+(""+n))}case 4:switch(n){case 1:return cu(r,e,t);case 2:return _.slice4d(r,[0,e,0,0],[r.shape[0],t,r.shape[2],r.shape[3]]);case 3:return _.slice4d(r,[0,0,e,0],[r.shape[0],r.shape[1],t,r.shape[3]]);case 4:return fb(r,e,t);default:throw new ie("The axis is not within the rank of the tensor "+(""+n))}default:throw new ie("sliceAlongLastAxis() received an unsupported tensor rank: "+(""+r.rank))}})}function Vb(r,e){e===void 0&&(e=-1);var t;return e<0&&(t=r[0].rank,t!==0?e=t:e=0),e===r[0].rank&&(e=-1),_.concat(r,e)}function tO(r,e){switch(r.rank){case 1:return _.concat1d([r,e]);case 2:return _.concat2d([r,e],0);case 3:return _.concat3d([r,e],0);case 4:return _.concat4d([r,e],0);default:throw new ie("concatAlongFirstAxis() received an unsupported "+("tensor rank: "+r.rank))}}function xb(r,e){if(Array.isArray(e)||(e=[e]),r.rank!==e.length)throw new ie("The length of input n ("+e.length+") does not match "+("the number of dimensions in input x ("+r.rank+")"));return _.tile(r,e)}function jv(r,e,t,n,a){return e===void 0&&(e=0),t===void 0&&(t=1),_.randomNormal(r,e,t,n,a)}function Yi(r,e,t,n){if(r.rank<2||e.rank<2)throw new Nt("dot requires both inputs to be rank >= 2"+(" but got x shape = "+r.shape+" and y shape = "+e.shape));if(e.rank>=3){var a=r.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(a!==i)throw new Nt("If rank y >= 3, then the second last dim"+(" of y must equal the last dim of x but got x shape = "+r.shape+" and ")+(" y shape = "+e.shape))}if(r.rank===2&&e.rank===2){var o=!1,s=!1;return _.fused.matMul({a:r,b:e,transposeA:o,transposeB:s,bias:n?kb(r.rank,n,Ti()):null,activation:t})}else{var u=r.shape.slice(),l=u.pop();r=_.reshape(r,[-1,l]);var c=e.shape.slice(),f=c.pop(),i=c.pop(),h=mt(c,[f]),p=Array.from({length:e.rank},function(y,b){return b===0?e.rank-2:b<=e.rank-2?b-1:b});e=_.reshape(_.transpose(e,p),[i,-1]);var d=mt(u,h),o=!1,s=!1;return _.reshape(_.fused.matMul({a:r,b:e,transposeA:o,transposeB:s,bias:n?kb(r.rank,n,Ti()):null,activation:t}),d)}}function hP(r,e,t){return M.tidy(function(){return Array.isArray(e)?e=M.tensor1d(e,"int32"):e=_.cast(e,"int32"),_.gather(r,e,t)})}function yh(r){return _.mul(r,r)}function kb(r,e,t){var n=e.shape;if(e.rank!==1&&e.rank!==r)throw new ie("Unexpected bias dimensions: "+e.rank+("; expected it to be 1 or "+r));if(r===5){if(t==="channelsFirst")return n.length===1?_.reshape(e,[1,n[0],1,1,1]):_.reshape(e,[1,n[3],n[0],n[1],n[2]]);if(t==="channelsLast")return n.length===1?_.reshape(e,[1,1,1,1,n[0]]):_.reshape(e,[1].concat(n))}else if(r===4){if(t==="channelsFirst")return n.length===1?_.reshape(e,[1,n[0],1,1]):_.reshape(e,[1,n[2],n[0],n[1]]);if(t==="channelsLast")return n.length===1?_.reshape(e,[1,1,1,n[0]]):_.reshape(e,[1].concat(n))}else if(r===3){if(t==="channelsFirst")return n.length===1?_.reshape(e,[1,n[0],1]):_.reshape(e,[1,n[1],n[0]]);if(t==="channelsLast")return n.length===1?_.reshape(e,[1,1,n[0]]):_.reshape(e,[1].concat(n))}else if(r<3)return e;throw new ie("Unsupported input rank by biasAdd: "+e.rank)}function Ii(r,e,t){return M.tidy(function(){return t==null&&(t=Ti()),qr(t),_.add(r,kb(r.rank,e,t))})}function ace(r,e){if(e===void 0&&(e=1),e!==1)throw new Nt("Support for alpha values other than 1 ("+e+") is not implemented yet.");return _.elu(r)}function ice(r){return M.tidy(function(){return _.div(r,_.add(_.abs(r),1))})}function pP(r,e,t,n){return M.tidy(function(){return _.dropout(r,e,t,n)})}function oce(r){return M.tidy(function(){var e=_.add(.5,_.mul(.2,r));return _.clipByValue(e,0,1)})}function bh(r,e,t){return t===void 0&&(t=!1),t?r():e()}var sce=["fanIn","fanOut","fanAvg"],uce=["normal","uniform","truncatedNormal"];function lce(r){du(sce,"FanMode",r)}function cce(r){du(uce,"Distribution",r)}var ei=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.fromConfigUsesCustomObjects=function(){return!1},e.prototype.getConfig=function(){return{}},e}(M.serialization.Serializable),Gb=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return M.zeros(t,n)},e}(ei);Gb.className="Zeros";M.serialization.registerClass(Gb);var Xv=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return M.ones(t,n)},e}(ei);Xv.className="Ones";M.serialization.registerClass(Xv);var Ub=function(r){ge(e,r);function e(t){var n=r.call(this)||this;if(typeof t!="object")throw new ie("Expected argument of type ConstantConfig but got "+t);if(t.value===void 0)throw new ie("config must have value set but got "+t);return n.value=t.value,n}return e.prototype.apply=function(t,n){var a=this;return M.tidy(function(){return M.mul(M.scalar(a.value),M.ones(t,n))})},e.prototype.getConfig=function(){return{value:this.value}},e}(ei);Ub.className="Constant";M.serialization.registerClass(Ub);var Hb=function(r){ge(e,r);function e(t){var n=r.call(this)||this;return n.DEFAULT_MINVAL=-.05,n.DEFAULT_MAXVAL=.05,n.minval=t.minval||n.DEFAULT_MINVAL,n.maxval=t.maxval||n.DEFAULT_MAXVAL,n.seed=t.seed,n}return e.prototype.apply=function(t,n){return M.randomUniform(t,this.minval,this.maxval,n)},e.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},e}(ei);Hb.className="RandomUniform";M.serialization.registerClass(Hb);var Kb=function(r){ge(e,r);function e(t){var n=r.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=t.mean||n.DEFAULT_MEAN,n.stddev=t.stddev||n.DEFAULT_STDDEV,n.seed=t.seed,n}return e.prototype.apply=function(t,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Nt("randomNormal does not support dType "+n+".");return jv(t,this.mean,this.stddev,n,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e}(ei);Kb.className="RandomNormal";M.serialization.registerClass(Kb);var jb=function(r){ge(e,r);function e(t){var n=r.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=t.mean||n.DEFAULT_MEAN,n.stddev=t.stddev||n.DEFAULT_STDDEV,n.seed=t.seed,n}return e.prototype.apply=function(t,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Nt("truncatedNormal does not support dType "+n+".");return M.truncatedNormal(t,this.mean,this.stddev,n,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e}(ei);jb.className="TruncatedNormal";M.serialization.registerClass(jb);var Xb=function(r){ge(e,r);function e(t){var n=r.call(this)||this;return n.gain=t.gain!=null?t.gain:1,n}return e.prototype.apply=function(t,n){var a=this;return M.tidy(function(){if(t.length!==2||t[0]!==t[1])throw new ie("Identity matrix initializer can only be used for 2D square matrices.");return M.mul(a.gain,M.eye(t[0]))})},e.prototype.getConfig=function(){return{gain:this.gain}},e}(ei);Xb.className="Identity";M.serialization.registerClass(Xb);function fce(r,e){e===void 0&&(e="channelsLast");var t,n;if(qr(e),r.length===2)t=r[0],n=r[1];else if([3,4,5].indexOf(r.length)!==-1){if(e==="channelsFirst"){var a=ls(r,2);t=r[1]*a,n=r[0]*a}else if(e==="channelsLast"){var a=ls(r,0,r.length-2);t=r[r.length-2]*a,n=r[r.length-1]*a}}else{var i=ls(r);t=Math.sqrt(i),n=Math.sqrt(i)}return[t,n]}var Bn=function(r){ge(e,r);function e(t){var n=r.call(this)||this;if(t.scale<0)throw new ie("scale must be a positive float. Got: "+t.scale);return n.scale=t.scale==null?1:t.scale,n.mode=t.mode==null?"fanIn":t.mode,lce(n.mode),n.distribution=t.distribution==null?"normal":t.distribution,cce(n.distribution),n.seed=t.seed,n}return e.prototype.apply=function(t,n){var a=fce(t),i=a[0],o=a[1],s=this.scale;if(this.mode==="fanIn"?s/=Math.max(1,i):this.mode==="fanOut"?s/=Math.max(1,o):s/=Math.max(1,(i+o)/2),this.distribution==="normal"){var u=Math.sqrt(s);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new Nt(this.getClassName()+" does not support dType "+n+".");return M.truncatedNormal(t,0,u,n,this.seed)}else{var l=Math.sqrt(3*s);return M.randomUniform(t,-l,l,n)}},e.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},e}(ei);Bn.className="VarianceScaling";M.serialization.registerClass(Bn);var Yv=function(r){ge(e,r);function e(t){return r.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Bn.className},e}(Bn);Yv.className="GlorotUniform";M.serialization.registerClass(Yv);var Zv=function(r){ge(e,r);function e(t){return r.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Bn.className},e}(Bn);Zv.className="GlorotNormal";M.serialization.registerClass(Zv);var Jv=function(r){ge(e,r);function e(t){return r.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Bn.className},e}(Bn);Jv.className="HeNormal";M.serialization.registerClass(Jv);var Qv=function(r){ge(e,r);function e(t){return r.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Bn.className},e}(Bn);Qv.className="HeUniform";M.serialization.registerClass(Qv);var em=function(r){ge(e,r);function e(t){return r.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Bn.className},e}(Bn);em.className="LeCunNormal";M.serialization.registerClass(em);var tm=function(r){ge(e,r);function e(t){return r.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Bn.className},e}(Bn);tm.className="LeCunNormal";M.serialization.registerClass(tm);var Yb=function(r){ge(e,r);function e(t){var n=r.call(this)||this;if(n.DEFAULT_GAIN=1,n.gain=t.gain==null?n.DEFAULT_GAIN:t.gain,n.seed=t.seed,n.seed!=null)throw new Nt("Random seed is not implemented for Orthogonal Initializer yet.");return n}return e.prototype.apply=function(t,n){var a=this;return M.tidy(function(){if(t.length<2)throw new Nt("Shape must be at least 2D.");t[0]*t[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more "+("than 2000 ("+t[0]*t[1]+") elements: ")+"Slowness may result.");var i=t[0]>t[1]?[t[1],t[0]]:t,o=jv(i,0,1,"float32"),s=M.linalg.gramSchmidt(o);return t[0]>t[1]&&(s=M.transpose(s)),M.mul(a.gain,s)})},e.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},e}(ei);Yb.className="Orthogonal";M.serialization.registerClass(Yb);var rO={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function nO(r,e){return e===void 0&&(e={}),vh(r,M.serialization.SerializationMap.getMap().classNameMap,e,"initializer")}function Cr(r){return Wb(r)}function Sr(r){if(typeof r=="string"){var e=r in rO?rO[r]:r;if(e==="GlorotNormal")return new Zv;if(e==="GlorotUniform")return new Yv;if(e==="HeNormal")return new Jv;if(e==="HeUniform")return new Qv;if(e==="LeCunNormal")return new em;if(e==="LeCunUniform")return new tm;var t={};return t.className=e,t.config={},nO(t)}else return r instanceof ei?r:nO(r)}function Sb(r){return Array.isArray(r)&&Array.isArray(r[0])}function Iv(r){return r.length===0?[]:Array.isArray(r[0])?r:[r]}function xt(r){var e;if(Array.isArray(r)){if(r.length!==1)throw new ie("Expected Tensor length to be 1; got "+r.length);e=r[0]}else e=r;return e}function Gt(r){if(Array.isArray(r)&&Array.isArray(r[0])){if(r.length===1)return r=r,r[0];throw new ie("Expected exactly 1 Shape; got "+r.length)}else return r}function Cv(r){var e,t,n=0;try{for(var a=be(r),i=a.next();!i.done;i=a.next()){var o=i.value;o.shape.length===0?n+=1:n+=o.shape.reduce(function(s,u){return s*u})}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}var aO="Variable",dP=function(){function r(e,t,n,a,i){t===void 0&&(t="float32"),n===void 0&&(n=aO),a===void 0&&(a=!0),i===void 0&&(i=null),this.dtype=t??"float32",this.shape=e.shape,this.id=sP(),n=n??aO,this.originalName=lP(n),this.name=cP(this.originalName),this.trainable_=a,this.constraint=i,this.val=_.variable(e,this.trainable_,this.name,this.dtype)}return r.prototype.read=function(){return this.assertNotDisposed(),this.val},r.prototype.write=function(e){return this.assertNotDisposed(),hce(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this},r.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},r.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable "+this.name+" is already disposed.")},Object.defineProperty(r.prototype,"trainable",{get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e},enumerable:!0,configurable:!0}),r}();function hce(r,e){if(r.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(r.shape)+" vs. "+JSON.stringify(e.shape))}function Nb(r){return r.map(function(e){return e.read()})}function Zb(r){r.forEach(function(e){var t=e[0];t.write(e[1])})}var Kr=function(){function r(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}return r}(),ki=function(){function r(e,t,n,a,i,o,s){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=sP(),o!=null&&(this.originalName=lP(o),this.name=cP(this.originalName)),this.rank=t.length}return r}(),pce=0,rm=function(){function r(e,t){var n,a;this.callArgs=t,this.id=pce++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;try{for(var i=be(e.inboundLayers),o=i.next();!o.done;o=i.next()){var s=o.value;s?.outboundNodes.push(this)}}catch(u){n={error:u}}finally{try{o&&!o.done&&(a=i.return)&&a.call(i)}finally{if(n)throw n.error}}e.outboundLayer.inboundNodes.push(this)}return r.prototype.getConfig=function(){var e,t,n=[];try{for(var a=be(this.inboundLayers),i=a.next();!i.done;i=a.next()){var o=i.value;o!=null?n.push(o.name):n.push(null)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:n,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},r}(),dce=0,Dt=function(r){ge(e,r);function e(t){t===void 0&&(t={});var n=r.call(this)||this;n._callHook=null,n._addedWeightNames=[],n._stateful=!1,n.id=dce++,n.activityRegularizer=null,n.inputSpec=null,n.supportsMasking=!1,n._trainableWeights=[],n._nonTrainableWeights=[],n._losses=[],n._updates=[],n._built=!1,n.inboundNodes=[],n.outboundNodes=[];var a=t.name;if(!a){var i=n.getClassName();a=yo(i)+"_"+Kv(i)}if(n.name=a,n.trainable_=t.trainable==null?!0:t.trainable,t.inputShape!=null||t.batchInputShape!=null){var o=void 0;if(t.batchInputShape!=null)o=t.batchInputShape;else if(t.inputShape!=null){var s=null;t.batchSize!=null&&(s=t.batchSize),o=[s].concat(t.inputShape)}n.batchInputShape=o;var u=t.dtype;u==null&&(u=t.inputDType),u==null&&(u="float32"),n.dtype=u}return t.weights!=null?n.initialWeights=t.weights:n.initialWeights=null,n._refCount=null,n.fastWeightInitDuringBuild=!1,n}return e.nodeKey=function(t,n){return t.name+"_ib-"+n.toString()},e.prototype.getNodeAtIndex=function(t,n){if(this.inboundNodes.length===0)throw new Xi("The layer has never been called "+("and thus has no defined "+n+"."));if(this.inboundNodes.length<=t)throw new ie("Asked to get "+n+" at node "+t+", "+("but the layer has only "+this.inboundNodes.length+" inbound nodes."));return this.inboundNodes[t]},e.prototype.getInputAt=function(t){return Pn(this.getNodeAtIndex(t,"input").inputTensors)},e.prototype.getOutputAt=function(t){return Pn(this.getNodeAtIndex(t,"output").outputTensors)},Object.defineProperty(e.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new ss("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(this.inboundNodes.length===0)throw new ss("Layer "+this.name+" is not connected, no input to return.");return Pn(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){if(this.inboundNodes.length===0)throw new ss("Layer "+this.name+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new ss("Layer "+this.name+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return Pn(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this._losses},enumerable:!0,configurable:!0}),e.prototype.calculateLosses=function(){return this.losses.map(function(t){return t()})},Object.defineProperty(e.prototype,"updates",{get:function(){return this._updates},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"built",{get:function(){return this._built},set:function(t){this._built=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this._trainableWeights.forEach(function(n){return n.trainable=t}),this.trainable_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable_?this._trainableWeights.filter(function(t){return t.trainable}):[]},set:function(t){this._trainableWeights=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._trainableWeights.filter(function(t){return!t.trainable}).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(t){this._nonTrainableWeights=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stateful",{get:function(){return this._stateful},enumerable:!0,configurable:!0}),e.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},e.prototype.assertInputCompatibility=function(t){if(t=cr(t),!(this.inputSpec==null||this.inputSpec.length===0)){var n=cr(this.inputSpec);if(t.length!==n.length)throw new ie("Layer "+this.name+" expects "+n.length+" inputs, "+("but it received "+t.length+" input tensors. ")+("Input received: "+t));for(var a=0;a<t.length;a++){var i=t[a],o=n[a];if(o!=null){var s=i.rank;if(o.ndim!=null&&s!==o.ndim)throw new ie("Input "+a+" is incompatible with layer "+this.name+": "+("expected ndim="+o.ndim+", found ndim="+s));if(o.maxNDim!=null&&s>o.maxNDim)throw new ie("Input "+a+" is incompatible with layer "+this.name+(": expected max_ndim="+o.maxNDim+", found ndim="+s));if(o.minNDim!=null&&s<o.minNDim)throw new ie("Input "+a+" is incompatible with layer "+this.name+(": expected min_ndim="+o.minNDim+", found ndim="+s+"."));if(o.dtype!=null&&i.dtype!==o.dtype)throw new ie("Input "+a+" is incompatible with layer "+this.name+" "+(": expected dtype="+o.dtype+", found dtype="+i.dtype+"."));if(o.axes){var u=i.shape;for(var l in o.axes){var c=Number(l),f=o.axes[l],h=c>=0?u[c]:u[u.length+c];if(f!=null&&[f,null].indexOf(h)===-1)throw new ie("Input "+a+" is incompatible with layer "+(this.name+": expected axis "+c+" of input shape to ")+("have value "+f+" but got shape "+u+"."))}}if(o.shape!=null)for(var p=0;p<o.shape.length;++p){var d=o.shape[p],m=i.shape[p];if(d!=null&&m!=null&&d!==m)throw new ie("Input "+a+" is incompatible with layer "+(this.name+": expected shape="+o.shape+", ")+("found shape="+i.shape+"."))}}}}},e.prototype.call=function(t,n){return t},e.prototype.invokeCallHook=function(t,n){this._callHook!=null&&this._callHook(t,n)},e.prototype.setCallHook=function(t){this._callHook=t},e.prototype.clearCallHook=function(){this._callHook=null},e.prototype.apply=function(t,n){var a,i,o,s,u=this;n=n||{},this.assertNotDisposed();var l=cr(t),c=!0;try{for(var f=be(l),h=f.next();!h.done;h=f.next()){var p=h.value;if(!(p instanceof ki)){c=!1;break}}}catch(g){a={error:g}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}var d=!0;try{for(var m=be(l),v=m.next();!v.done;v=m.next()){var p=v.value;if(p instanceof ki){d=!1;break}}}catch(g){o={error:g}}finally{try{v&&!v.done&&(s=m.return)&&s.call(m)}finally{if(o)throw o.error}}if(c===d)throw new ie("Arguments to apply() must be all SymbolicTensors or all Tensors");return lu(this.name,function(){var g,y,b,w;if(!u.built){u.assertInputCompatibility(t);var x=[];try{for(var k=be(cr(t)),N=k.next();!N.done;N=k.next()){var T=N.value;x.push(T.shape)}}catch(K){g={error:K}}finally{try{N&&!N.done&&(y=k.return)&&y.call(k)}finally{if(g)throw g.error}}u.build(Pn(x)),u.built=!0,u.initialWeights&&u.setWeights(u.initialWeights),u._refCount===null&&d&&(u._refCount=1)}if(u.assertInputCompatibility(t),d){var I=u.call(t,n),F=cr(I),D=[];try{for(var R=be(F),P=R.next();!P.done;P=R.next()){var B=P.value;l.indexOf(B)!==-1&&(B=B.clone()),D.push(B)}}catch(K){b={error:K}}finally{try{P&&!P.done&&(w=R.return)&&w.call(R)}finally{if(b)throw b.error}}if(I=Pn(D),u.activityRegularizer!=null)throw new Nt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return I}else{var q=vce(t),O=u.computeOutputShape(q),I=void 0,V=mce(t);if(u.warnOnIncompatibleInputShape(Array.isArray(t)?q[0]:q),O!=null&&O.length>0&&Array.isArray(O[0])?I=O.map(function(Z,j){return new ki(V,Z,u,cr(t),n,u.name,j)}):I=new ki(V,O,u,cr(t),n,u.name),u.addInboundNode(t,I,null,null,q,O,n),u._refCount++,u.activityRegularizer!=null)throw new Nt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return I}})},e.prototype.warnOnIncompatibleInputShape=function(t){if(this.batchInputShape!=null)if(t.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+(JSON.stringify(t)+") does not match that of the ")+("batchInputShape ("+JSON.stringify(this.batchInputShape)+") ")+("of the layer "+this.name));else{var n=!1;this.batchInputShape.forEach(function(a,i){a!=null&&t[i]!=null&&t[i]!==a&&(n=!0)}),n&&console.warn("The shape of the input tensor "+("("+JSON.stringify(t)+") does not ")+("match the expectation of layer "+this.name+": ")+(""+JSON.stringify(this.batchInputShape)))}},Object.defineProperty(e.prototype,"outputShape",{get:function(){var t,n;if(this.inboundNodes==null||this.inboundNodes.length===0)throw new ss("The layer "+this.name+" has never been called and thus has no defined output shape.");var a=[];try{for(var i=be(this.inboundNodes),o=i.next();!o.done;o=i.next()){var s=o.value,u=JSON.stringify(s.outputShapes);a.indexOf(u)===-1&&a.push(u)}}catch(c){t={error:c}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}if(a.length===1){var l=this.inboundNodes[0].outputShapes;return Array.isArray(l)&&Array.isArray(l[0])&&l.length===1?l[0]:l}else throw new ss("The layer "+this.name+' has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.')},enumerable:!0,configurable:!0}),e.prototype.countParams=function(){if(!this.built)throw new Xi("You tried to call countParams() on "+this.name+", but the layer is not built yet. Build it first by calling build(batchInputShape).");return Cv(this.weights)},e.prototype.build=function(t){this.built=!0},e.prototype.getWeights=function(t){return t===void 0&&(t=!1),Nb(t?this.trainableWeights:this.weights)},e.prototype.setWeights=function(t){var n=this;M.tidy(function(){var a=n.weights;if(a.length!==t.length)throw new ie('You called setWeights(weights) on layer "'+n.name+'" '+("with a weight list of length "+t.length+", ")+("but the layer was expecting "+a.length+" weights. ")+("Provided weights: "+t+"..."));if(a.length!==0){for(var i=[],o=Nb(a),s=0;s<o.length;++s){var u=o[s],l=a[s],c=t[s];if(!M.util.arraysEqual(u.shape,c.shape))throw new ie("Layer weight shape "+u.shape+" "+("not compatible with provided weight shape "+c.shape));i.push([l,c])}Zb(i)}})},e.prototype.addWeight=function(t,n,a,i,o,s,u,l){if(this._addedWeightNames.indexOf(t)!==-1)throw new ie("Duplicate weight name "+t+" for layer "+this.name);this._addedWeightNames.push(t),a==null&&(a="float32"),this.fastWeightInitDuringBuild&&(i=l!=null?l():Sr("zeros"));var c=i.apply(n,a),f=new dP(c,a,t,s,u);return c.dispose(),o!=null&&this.addLoss(function(){return o.apply(f.read())}),s==null&&(s=!0),s?this._trainableWeights.push(f):this._nonTrainableWeights.push(f),f},e.prototype.setFastWeightInitDuringBuild=function(t){this.fastWeightInitDuringBuild=t},e.prototype.addLoss=function(t){var n;t==null||Array.isArray(t)&&t.length===0||(t=cr(t),this._losses!==void 0&&this._losses!==null&&(n=this.losses).push.apply(n,mt(t)))},e.prototype.computeOutputShape=function(t){return t},e.prototype.computeMask=function(t,n){var a=this;if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(function(i){if(i!=null)throw new TypeError("Layer "+a.name+" does not support masking, but was passed an inputMask.")});else throw new TypeError("Layer "+this.name+" does not support masking, but was passed an inputMask.");return null}return n},e.prototype.addInboundNode=function(t,n,a,i,o,s,u){var l,c;u===void 0&&(u=null);var f=cr(t);n=cr(n),a=cr(a),i=cr(i),o=Iv(o),s=Iv(s);var h=[],p=[],d=[];try{for(var m=be(f),v=m.next();!v.done;v=m.next()){var g=v.value;h.push(g.sourceLayer),p.push(g.nodeIndex),d.push(g.tensorIndex)}}catch(b){l={error:b}}finally{try{v&&!v.done&&(c=m.return)&&c.call(m)}finally{if(l)throw l.error}}new rm({outboundLayer:this,inboundLayers:h,nodeIndices:p,tensorIndices:d,inputTensors:f,outputTensors:n,inputMasks:a,outputMasks:i,inputShapes:o,outputShapes:s},u);for(var y=0;y<n.length;y++)n[y].sourceLayer=this,n[y].nodeIndex=this.inboundNodes.length-1,n[y].tensorIndex=y},e.prototype.getConfig=function(){var t={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(t.batchInputShape=this.batchInputShape),this.dtype!=null&&(t.dtype=this.dtype),t},e.prototype.disposeWeights=function(){return this.weights.forEach(function(t){return t.dispose()}),this.weights.length},e.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Layer '"+this.name+"' is already disposed.")},e.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer "+this.name+" because it has not been built yet.");if(this._refCount===null)throw new Error("Cannot dispose Layer "+this.name+" because it has not been used yet.");this.assertNotDisposed();var t=0;return--this._refCount===0&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}},e}(M.serialization.Serializable);function vce(r){var e,t;r=cr(r);var n=[];try{for(var a=be(r),i=a.next();!i.done;i=a.next()){var o=i.value;n.push(o.shape)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return Pn(n)}function mce(r){return"float32"}function vP(r,e,t){var n,a;if((e==null||t!=null&&t>0)&&(e=r.sourceLayer,t=r.nodeIndex),e.inboundNodes.length===0)return[r];var i=e.inboundNodes[t];if(i.inboundLayers.length===0)return i.inputTensors;for(var o=[],s=0;s<i.inboundLayers.length;s++){var u=i.inputTensors[s],l=i.inboundLayers[s],c=i.nodeIndices[s],f=vP(u,l,c);try{for(var h=(n=void 0,be(f)),p=h.next();!p.done;p=h.next()){var d=p.value;o.indexOf(d)===-1&&o.push(d)}}catch(m){n={error:m}}finally{try{p&&!p.done&&(a=h.return)&&a.call(h)}finally{if(n)throw n.error}}}return o}var Xl=function(r){ge(e,r);function e(t){var n=r.call(this,{dtype:t.dtype,name:t.name!=null?t.name:Kv("input").toString()})||this;if(t.batchSize==null&&(t.batchSize=null),t.sparse==null&&(t.sparse=!1),n.trainable=!1,n.built=!0,n.sparse=t.sparse,t.inputShape!=null&&t.batchInputShape!=null)throw new ie("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=t.batchInputShape;if(a==null){if(t.inputShape==null)throw new ie("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[t.batchSize].concat(t.inputShape)}else if(t.batchSize!=null)throw new ie("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=t.dtype||"float32";n.batchInputShape=a,n.dtype=i,n.inputSpec=[{shape:a}];var o=new ki(n.dtype,n.batchInputShape,n,[],{},n.name);return o.nodeIndex=0,o.tensorIndex=0,new rm({outboundLayer:n,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),n}return e.prototype.apply=function(t,n){throw new ie("Cannot pass any input to an "+("InputLayer's apply() method. InputLayer name: "+this.name))},e.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},e.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},e}(Dt);Xl.className="InputLayer";M.serialization.registerClass(Xl);function mP(r){if(r.batchShape==null&&r.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(r.batchShape!=null&&r.shape!=null)throw new ie("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var e=r.batchShape;r.shape!=null&&e==null&&(e=[null].concat(r.shape));var t=r.dtype;t==null&&(t="float32");var n=new Xl({batchInputShape:e,name:r.name,dtype:t,sparse:r.sparse}),a=n.inboundNodes[0].outputTensors;return a[0]}function gce(r,e){if(r.dtype==null||r.dtype===e.dtype)return e;try{return M.cast(e,r.dtype)}catch{throw new ie("The dtype of the feed ("+e.dtype+") can not be cast to the dtype "+("of the key '"+r.name+"' ("+r.dtype+")."))}}var Bl=function(){function r(e){var t,n;if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof r)for(var a in e.id2Value)this.id2Value[a]=e.id2Value[a],a in e.id2Mask&&(this.id2Mask[a]=e.id2Mask[a]);else{if(e==null)return;try{for(var i=be(e),o=i.next();!o.done;o=i.next()){var s=o.value;this.add(s.key,s.value)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}}return r.prototype.add=function(e,t,n){if(this.id2Value[e.id]==null)this.id2Value[e.id]=gce(e,t),this.name2Id[e.name]=e.id,n!=null&&(this.id2Mask[e.id]=n);else throw new ie("Duplicate key: name="+e.name+", id="+e.id);return this},r.prototype.addFeed=function(e){this.add(e.key,e.value)},r.prototype.hasKey=function(e){return this.id2Value[e.id]!=null},r.prototype.names=function(){return Object.keys(this.name2Id)},r.prototype.getValue=function(e){if(e instanceof ki){if(this.id2Value[e.id]==null)throw new ie("Nonexistent key: "+e.name);return this.id2Value[e.id]}else{var t=this.name2Id[e];if(t==null)throw new ie("Feed dict has no SymbolicTensor name: "+e);return this.id2Value[t]}},r.prototype.getMask=function(e){if(e instanceof ki){if(this.id2Value[e.id]==null)throw new ie("Nonexistent key: "+e.name);return this.id2Mask[e.id]}else{var t=this.name2Id[e];if(t==null)throw new ie("Feed dict has no SymbolicTensor name: "+e);return this.id2Mask[t]}},r.prototype.disposeMasks=function(){this.id2Mask!=null&&M.dispose(this.id2Mask)},r}(),Av=new aP,_v=new aP;function yce(r){Av?.setMaxEntries(r),_v?.setMaxEntries(r)}function Jf(r,e,t,n){var a,i,o,s,u=t==null?!1:t.training,l=Array.isArray(r),c=l?r:[r],f=c.map(function(he){return he.name}),h=[],p=e.names();try{for(var d=be(f),m=d.next();!m.done;m=d.next()){var v=m.value;p.indexOf(v)!==-1?h.push(e.getValue(v)):h.push(null)}}catch(he){a={error:he}}finally{try{m&&!m.done&&(i=d.return)&&i.call(d)}finally{if(a)throw a.error}}n!=null&&(n.maxNumTensors=-1/0,n.minNumTensors=1/0);var g=f.join(",")+"|"+e.names().sort().join(","),y=Av.get(g),b;if(y==null){var w=bce(c,e);y=w.sorted,b=w.recipientCounts,Av.put(g,y),_v.put(g,b)}b={},u||Object.assign(b,_v.get(g));for(var x=new Bl(e),k=0;k<y.length;++k){if(n!=null){var N=M.memory().numTensors;N>n.maxNumTensors&&(n.maxNumTensors=N),N<n.minNumTensors&&(n.minNumTensors=N)}var T=y[k],I=T.sourceLayer;if(!(I instanceof Xl)){var F=[],D=[],R=[],P=!1;try{for(var B=(o=void 0,be(T.inputs)),q=B.next();!q.done;q=B.next()){var O=q.value,V=x.getValue(O),K=x.getMask(O);F.push(V),D.push(K),K!=null&&(P=!0),u||(b[O.name]--,b[O.name]===0&&!e.hasKey(O)&&f.indexOf(O.name)===-1&&!V.isDisposed&&O.sourceLayer.stateful!==!0&&R.push(V))}}catch(he){o={error:he}}finally{try{q&&!q.done&&(s=B.return)&&s.call(B)}finally{if(o)throw o.error}}P&&(t=t||{},t.mask=D[0]);var Z=cr(I.apply(F,t)),j=null;I.supportsMasking&&(j=I.computeMask(F,D));for(var ee=xce(T),le=Array.isArray(ee)?ee:[ee],se=0;se<le.length;++se){x.hasKey(le[se])||x.add(le[se],Z[se],Array.isArray(j)?j[0]:j);var ce=f.indexOf(le[se].name);ce!==-1&&(h[ce]=Z[se])}u||M.dispose(R)}}return x.disposeMasks(),l?h:h[0]}function bce(r,e){var t,n,a,i;M.util.assert(r!=null&&r.length>0,function(){return"Expected at least one fetch, got none"});var o=[],s={};if(r.length===1){var u=iO(r[0],e);o=u.sorted,s=u.recipientMap}else{var l=new Set;try{for(var c=be(r),f=c.next();!f.done;f=c.next()){var h=f.value,p=iO(h,e),d=p.sorted,m=p.recipientMap;try{for(var v=(a=void 0,be(d)),g=v.next();!g.done;g=v.next()){var y=g.value;l.has(y.name)||(o.push(y),l.add(y.name))}}catch(x){a={error:x}}finally{try{g&&!g.done&&(i=v.return)&&i.call(v)}finally{if(a)throw a.error}}var b=function(x){s[x]==null&&(s[x]=new Set),m[x].forEach(function(k){return s[x].add(k)})};for(var w in m)b(w)}}catch(x){t={error:x}}finally{try{f&&!f.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}}return{sorted:o,recipientCounts:wce(s)}}function wce(r){var e={};for(var t in r)e[t]=r[t].size;return e}function iO(r,e){var t,n,a,i,o=new Set,s=[],u={};try{for(var l=be(e.names()),c=l.next();!c.done;c=l.next()){var f=c.value;o.add(f)}}catch(b){t={error:b}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}var h=[],p=[];for(h.push(r);h.length>0;){var d=h[h.length-1];if(o.has(d.name)){h.pop();continue}var m=p[p.length-1]===h.length-1;if(d.inputs.length===0||m)h.pop(),s.push(d),o.add(d.name),m&&p.pop();else{p.push(h.length-1);try{for(var v=(a=void 0,be(d.inputs)),g=v.next();!g.done;g=v.next()){var y=g.value;u[y.name]==null&&(u[y.name]=new Set),u[y.name].add(d.name),!o.has(y.name)&&h.push(y)}}catch(b){a={error:b}}finally{try{g&&!g.done&&(i=v.return)&&i.call(v)}finally{if(a)throw a.error}}}}return{sorted:s,recipientMap:u}}function xce(r){var e,t,n;if(r.sourceLayer.inboundNodes.length===1)n=r.sourceLayer.output;else{for(var a=null,i=0;i<r.sourceLayer.inboundNodes.length;++i)try{for(var o=(e=void 0,be(r.sourceLayer.inboundNodes[i].outputTensors)),s=o.next();!s.done;s=o.next()){var u=s.value;if(u.id===r.id){a=i;break}}}catch(l){e={error:l}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}n=r.sourceLayer.getOutputAt(a)}return n}var kce=M.env();kce.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",function(){return 100},yce);var gP="Abs",yP="Acos",bP="Acosh",Jb="Add",wP="AddN",Sce="All",Nce="Any",xP="ArgMax",kP="ArgMin",SP="Asin",NP="Asinh",EP="Atan",TP="Atanh",IP="Atan2",CP="AvgPool",Ece="AvgPoolGrad",AP="AvgPool3D",Tce="AvgPool3DGrad",_P="BatchMatMul",DP="BatchToSpaceND",Ice="Bincount",Cce="BroadcastTo",Ace="BroadcastArgs",Qb="Cast",FP="Ceil",RP="ClipByValue",_ce="Complex",OP="ComplexAbs",PP="Concat",MP="Conv2D",Dce="Conv2DBackpropFilter",BP="Conv2DBackpropInput",LP="Conv3D",Fce="Conv3DBackpropFilterV2",Rce="Conv3DBackpropInputV2",zP="Cos",$P="Cosh",Oce="Cumprod",WP="Cumsum",Pce="CropAndResize",Mce="DenseBincount",Bce="DepthToSpace",qP="DepthwiseConv2dNative",Lce="DepthwiseConv2dNativeBackpropFilter",zce="DepthwiseConv2dNativeBackpropInput",$ce="Diag",VP="Dilation2D",Wce="Dilation2DBackpropInput",qce="Dilation2DBackpropFilter",GP="RealDiv",Vce="Einsum",UP="Elu",Gce="EluGrad",HP="Erf",Uce="Equal",KP="Exp",jP="ExpandDims",XP="Expm1",Hce="FFT",Kce="Fill",jce="FlipLeftRight",YP="Floor",ZP="FloorDiv",JP="FusedBatchNorm",QP="GatherV2",Xce="GatherNd",Yce="Greater",eM="GreaterEqual",e1="Identity",Zce="IFFT",Jce="Imag",tM="IsFinite",rM="IsInf",nM="IsNan",aM="LeakyRelu",Qce="Less",efe="LessEqual",iM="Log",oM="Log1p",tfe="LogicalAnd",rfe="LogicalNot",nfe="LogicalOr",afe="LogSoftmax",sM="LRN",ife="LRNGrad",uM="Max",lM="Maximum",cM="MaxPool",ofe="MaxPoolGrad",fM="MaxPool3D",sfe="MaxPool3DGrad",ufe="MaxPoolWithArgmax",hM="Mean",pM="Min",dM="Minimum",vM="MirrorPad",mM="Mod",lfe="Multinomial",gM="Multiply",yM="Neg",cfe="NotEqual",ffe="NonMaxSuppressionV3",hfe="NonMaxSuppressionV4",pfe="NonMaxSuppressionV5",bM="OnesLike",wM="OneHot",xM="Pack",kM="PadV2",SM="Pow",NM="Prelu",EM="Prod",dfe="RaggedGather",vfe="RaggedTensorToTensor",mfe="Range",gfe="Real",TM="Reciprocal",IM="Relu",CM="Reshape",AM="ResizeNearestNeighbor",yfe="ResizeNearestNeighborGrad",_M="ResizeBilinear",bfe="ResizeBilinearGrad",DM="Relu6",FM="Reverse",RM="Round",OM="Rsqrt",wfe="ScatterNd",xfe="SearchSorted",PM="Select",MM="Selu",BM="Slice",LM="Sin",zM="Sinh",$M="Sign",WM="Sigmoid",qM="Softplus",VM="Sqrt",GM="Sum",UM="SpaceToBatchND",HM="SplitV",KM="Softmax",kfe="SparseFillEmptyRows",Sfe="SparseReshape",Nfe="SparseSegmentMean",Efe="SparseSegmentSum",Tfe="SparseToDense",jM="SquaredDifference",Ife="Square",Cfe="StridedSlice",Afe="StringNGrams",_fe="StringSplit",Dfe="StringToHashBucketFast",XM="Sub",YM="Tan",ZM="Tanh",t1="Tile",Ffe="TopK",Rfe="Transform",kv="Transpose",Ofe="Unique",JM="Unpack",QM="UnsortedSegmentSum",e4="ZerosLike",t4="Step",oO="FromPixels",Pfe="RotateWithOffset",sO="_FusedMatMul",uO="FusedConv2D",lO="FusedDepthwiseConv2D";var Mfe=1e-7,Bfe=1e-4,Lfe=function(){function r(){}return r.prototype.refCount=function(e){return Ca("refCount")},r.prototype.incRef=function(e){return Ca("incRef")},r.prototype.timerAvailable=function(){return!0},r.prototype.time=function(e){return Ca("time")},r.prototype.read=function(e){return Ca("read")},r.prototype.readSync=function(e){return Ca("readSync")},r.prototype.readToGPU=function(e,t){return Ca("readToGPU")},r.prototype.numDataIds=function(){return Ca("numDataIds")},r.prototype.disposeData=function(e,t){return Ca("disposeData")},r.prototype.write=function(e,t,n){return Ca("write")},r.prototype.move=function(e,t,n,a,i){return Ca("move")},r.prototype.memory=function(){return Ca("memory")},r.prototype.floatPrecision=function(){return Ca("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?Mfe:Bfe},r.prototype.dispose=function(){return Ca("dispose")},r}();function Ca(r){throw new Error("'"+r+"' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen")}function H(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function Qi(r,e,t){t===void 0&&(t=""),H(Yl(r,e),function(){return t+(" Shapes "+r+" and "+e+" must match")})}function r1(r){H(r!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function nm(r,e,t){if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),Array.isArray(r)||Zi(r)&&!t)for(var n=0;n<r.length;++n)nm(r[n],e,t);else e.push(r);return e}function oa(r){if(r.length===0)return 1;for(var e=r[0],t=1;t<r.length;t++)e*=r[t];return e}function Yl(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function sh(r){return r%1===0}function Sv(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function Ci(r,e){var t=e.length;return r=r==null?e.map(function(n,a){return a}):[].concat(r),H(r.every(function(n){return n>=-t&&n<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but "+("got axis "+r)}),H(r.every(function(n){return sh(n)}),function(){return"All values in axis param must be integers but "+("got axis "+r)}),r.map(function(n){return n<0?t+n:n})}function zfe(r,e){for(var t=[],n=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:Ci(e,r).sort(),o=0,s=0;s<r.length;++s){if(i!=null){if(i[o]===s&&r[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+r[s]+"' is not 1");(i[o]==null||i[o]>s)&&r[s]===1&&(t.push(r[s]),n.push(s)),i[o]<=s&&o++}r[s]!==1&&(t.push(r[s]),n.push(s))}return{newShape:t,keptDims:n}}function $fe(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else if(r==="string")t=new Array(e);else throw new Error("Unknown data type "+r);return t}function Wfe(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type "+e+" being uploaded contains "+n+".")}}function qfe(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function Zi(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}function cO(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype "+r)}function Vfe(r){if(r==null)return 0;var e=0;return r.forEach(function(t){return e+=t.length}),e}function n1(r){return typeof r=="string"||r instanceof String}function Gfe(r){return typeof r=="boolean"}function Ufe(r){return typeof r=="number"}function a1(r){return Array.isArray(r)?a1(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":Ufe(r)?"float32":n1(r)?"string":Gfe(r)?"bool":"float32"}function Eb(r){return!!(r&&r.constructor&&r.call&&r.apply)}function i1(r){var e=r.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=r[e-1];for(var n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function r4(r,e,t,n){n===void 0&&(n=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(n?2:1),o=0;o<i;o++)a[o]=t[r+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(c,f){return c*f})*(n?2:1),o=0;o<i;o++)a[o]=r4(r+o*u,s,t,n);return a}function fO(r,e,t){if(t===void 0&&(t=!1),r.length===0)return e[0];var n=r.reduce(function(a,i){return a*i})*(t?2:1);if(n===0)return[];if(n!==e.length)throw new Error("["+r+"] does not match the input size "+e.length+(t?" for a complex tensor":"")+".");return r4(0,r,e,t)}function n4(r,e){for(var t=o1(r,e),n=0;n<t.length;n++)t[n]=1;return t}function o1(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error("Unknown data type "+e)}function a4(r){r.forEach(function(e){H(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+("shape ["+r+"].")})})}function i4(r){return r&&r.then&&typeof r.then=="function"}var hO="tfjsflags",Hfe=function(){function r(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Kfe,this.populateURLFlags()}return r.prototype.setPlatform=function(e,t){this.platform!=null&&(Wr().getBool("IS_TEST")||Wr().getBool("PROD")||console.warn("Platform "+this.platformName+" has already been set. "+("Overwriting the platform with "+e+"."))),this.platformName=e,this.platform=t},r.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){var a=this.urlFlags[e];Wr().getBool("IS_TEST")||Wr().getBool("PROD")||console.warn("Setting feature override from URL "+e+": "+a+"."),this.set(e,a)}},r.prototype.getAsync=function(e){return Ce(this,void 0,void 0,function(){var t,n;return Ie(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,n=e,[4,this.evaluateFlag(e)]);case 1:return t[n]=a.sent(),[2,this.flags[e]]}})})},r.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(i4(t))throw new Error("Flag "+e+" cannot be synchronously evaluated. Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},r.prototype.getNumber=function(e){return this.get(e)},r.prototype.getBool=function(e){return this.get(e)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),r.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},r.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},r.prototype.setFlags=function(e){this.flags=Object.assign({},e)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if(hO in t){var n=t[hO].split(",");n.forEach(function(a){var i=me(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=Xfe(o,s)})}}},r}();function Kfe(r){var e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];return jfe(e,n[0],n[1]),n.join("=")}),e}function jfe(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Xfe(r,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if(""+ +e===e)return+e;throw new Error("Could not parse value flag value "+e+" for flag "+r+".")}function Wr(){return o4}var o4=null;function Yfe(r){o4=r}var hb;function s4(){if(hb==null){var r=void 0;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");hb=r}return hb}function Zfe(){var r=s4();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function s1(r,e){var t=Zfe();if(t.has(r))return t.get(r);var n=e();return t.set(r,n),t.get(r)}function Ml(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];Wr().getBool("IS_TEST")||Wr().getBool("PROD")||console.warn.apply(console,mt(r))}var u4=s1("kernelRegistry",function(){return new Map}),Tb=s1("gradRegistry",function(){return new Map});function Ib(r,e){var t=Qfe(r,e);return u4.get(t)}function pO(r){return Tb.get(r)}function dO(r){for(var e=u4.entries(),t=[];;){var n=e.next(),a=n.done,i=n.value;if(a)break;var o=me(i,2),s=o[0],u=o[1],l=me(s.split("_"),1),c=l[0];c===r&&t.push(u)}return t}function Jfe(r){var e=r.kernelName;Tb.has(e)&&Wr().getBool("DEBUG")&&Ml("Overriding the gradient for '"+e+"'"),Tb.set(e,r)}function Qfe(r,e){return e+"_"+r}var Cb=hr,Ya=null;try{Ya=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function hr(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}hr.prototype.__isLong__;Object.defineProperty(hr.prototype,"__isLong__",{value:!0});function ca(r){return(r&&r.__isLong__)===!0}hr.isLong=ca;var vO={},mO={};function vu(r,e){var t,n,a;return e?(r>>>=0,(a=0<=r&&r<256)&&(n=mO[r],n)?n:(t=pr(r,(r|0)<0?-1:0,!0),a&&(mO[r]=t),t)):(r|=0,(a=-128<=r&&r<128)&&(n=vO[r],n)?n:(t=pr(r,r<0?-1:0,!1),a&&(vO[r]=t),t))}hr.fromInt=vu;function Za(r,e){if(isNaN(r))return e?uu:Ja;if(e){if(r<0)return uu;if(r>=l4)return h4}else{if(r<=-yO)return ia;if(r+1>=yO)return f4}return r<0?Za(-r,e).neg():pr(r%Vl|0,r/Vl|0,e)}hr.fromNumber=Za;function pr(r,e,t){return new hr(r,e,t)}hr.fromBits=pr;var Dv=Math.pow;function u1(r,e,t){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return Ja;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return u1(r.substring(1),e,t).neg();for(var a=Za(Dv(t,8)),i=Ja,o=0;o<r.length;o+=8){var s=Math.min(8,r.length-o),u=parseInt(r.substring(o,o+s),t);if(s<8){var l=Za(Dv(t,s));i=i.mul(l).add(Za(u))}else i=i.mul(a),i=i.add(Za(u))}return i.unsigned=e,i}hr.fromString=u1;function Ai(r,e){return typeof r=="number"?Za(r,e):typeof r=="string"?u1(r,e):pr(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}hr.fromValue=Ai;var gO=1<<16,ehe=1<<24,Vl=gO*gO,l4=Vl*Vl,yO=l4/2,bO=vu(ehe),Ja=vu(0);hr.ZERO=Ja;var uu=vu(0,!0);hr.UZERO=uu;var Ll=vu(1);hr.ONE=Ll;var c4=vu(1,!0);hr.UONE=c4;var Ab=vu(-1);hr.NEG_ONE=Ab;var f4=pr(-1,2147483647,!1);hr.MAX_VALUE=f4;var h4=pr(-1,-1,!0);hr.MAX_UNSIGNED_VALUE=h4;var ia=pr(0,-2147483648,!1);hr.MIN_VALUE=ia;var Fe=hr.prototype;Fe.toInt=function(){return this.unsigned?this.low>>>0:this.low};Fe.toNumber=function(){return this.unsigned?(this.high>>>0)*Vl+(this.low>>>0):this.high*Vl+(this.low>>>0)};Fe.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ia)){var t=Za(e),n=this.div(t),a=n.mul(t).sub(this);return n.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Za(Dv(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),l=o.sub(u.mul(i)).toInt()>>>0,c=l.toString(e);if(o=u,o.isZero())return c+s;for(;c.length<6;)c="0"+c;s=""+c+s}};Fe.getHighBits=function(){return this.high};Fe.getHighBitsUnsigned=function(){return this.high>>>0};Fe.getLowBits=function(){return this.low};Fe.getLowBitsUnsigned=function(){return this.low>>>0};Fe.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ia)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};Fe.isZero=function(){return this.high===0&&this.low===0};Fe.eqz=Fe.isZero;Fe.isNegative=function(){return!this.unsigned&&this.high<0};Fe.isPositive=function(){return this.unsigned||this.high>=0};Fe.isOdd=function(){return(this.low&1)===1};Fe.isEven=function(){return(this.low&1)===0};Fe.equals=function(e){return ca(e)||(e=Ai(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Fe.eq=Fe.equals;Fe.notEquals=function(e){return!this.eq(e)};Fe.neq=Fe.notEquals;Fe.ne=Fe.notEquals;Fe.lessThan=function(e){return this.comp(e)<0};Fe.lt=Fe.lessThan;Fe.lessThanOrEqual=function(e){return this.comp(e)<=0};Fe.lte=Fe.lessThanOrEqual;Fe.le=Fe.lessThanOrEqual;Fe.greaterThan=function(e){return this.comp(e)>0};Fe.gt=Fe.greaterThan;Fe.greaterThanOrEqual=function(e){return this.comp(e)>=0};Fe.gte=Fe.greaterThanOrEqual;Fe.ge=Fe.greaterThanOrEqual;Fe.compare=function(e){if(ca(e)||(e=Ai(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Fe.comp=Fe.compare;Fe.negate=function(){return!this.unsigned&&this.eq(ia)?ia:this.not().add(Ll)};Fe.neg=Fe.negate;Fe.add=function(e){ca(e)||(e=Ai(e));var t=this.high>>>16,n=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,l=e.low&65535,c=0,f=0,h=0,p=0;return p+=i+l,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=n+s,c+=f>>>16,f&=65535,c+=t+o,c&=65535,pr(h<<16|p,c<<16|f,this.unsigned)};Fe.subtract=function(e){return ca(e)||(e=Ai(e)),this.add(e.neg())};Fe.sub=Fe.subtract;Fe.multiply=function(e){if(this.isZero())return Ja;if(ca(e)||(e=Ai(e)),Ya){var t=Ya.mul(this.low,this.high,e.low,e.high);return pr(t,Ya.get_high(),this.unsigned)}if(e.isZero())return Ja;if(this.eq(ia))return e.isOdd()?ia:Ja;if(e.eq(ia))return this.isOdd()?ia:Ja;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(bO)&&e.lt(bO))return Za(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,l=e.low>>>16,c=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*c,p+=d>>>16,d&=65535,p+=i*c,h+=p>>>16,p&=65535,p+=o*l,h+=p>>>16,p&=65535,h+=a*c,f+=h>>>16,h&=65535,h+=i*l,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=n*c+a*l+i*u+o*s,f&=65535,pr(p<<16|d,f<<16|h,this.unsigned)};Fe.mul=Fe.multiply;Fe.divide=function(e){if(ca(e)||(e=Ai(e)),e.isZero())throw Error("division by zero");if(Ya){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Ya.div_u:Ya.div_s)(this.low,this.high,e.low,e.high);return pr(t,Ya.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?uu:Ja;var n,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return uu;if(e.gt(this.shru(1)))return c4;i=uu}else{if(this.eq(ia)){if(e.eq(Ll)||e.eq(Ab))return ia;if(e.eq(ia))return Ll;var o=this.shr(1);return n=o.div(e).shl(1),n.eq(Ja)?e.isNegative()?Ll:Ab:(a=this.sub(e.mul(n)),i=n.add(a.div(e)),i)}else if(e.eq(ia))return this.unsigned?uu:Ja;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Ja}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:Dv(2,s-48),l=Za(n),c=l.mul(e);c.isNegative()||c.gt(a);)n-=u,l=Za(n,this.unsigned),c=l.mul(e);l.isZero()&&(l=Ll),i=i.add(l),a=a.sub(c)}return i};Fe.div=Fe.divide;Fe.modulo=function(e){if(ca(e)||(e=Ai(e)),Ya){var t=(this.unsigned?Ya.rem_u:Ya.rem_s)(this.low,this.high,e.low,e.high);return pr(t,Ya.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Fe.mod=Fe.modulo;Fe.rem=Fe.modulo;Fe.not=function(){return pr(~this.low,~this.high,this.unsigned)};Fe.and=function(e){return ca(e)||(e=Ai(e)),pr(this.low&e.low,this.high&e.high,this.unsigned)};Fe.or=function(e){return ca(e)||(e=Ai(e)),pr(this.low|e.low,this.high|e.high,this.unsigned)};Fe.xor=function(e){return ca(e)||(e=Ai(e)),pr(this.low^e.low,this.high^e.high,this.unsigned)};Fe.shiftLeft=function(e){return ca(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?pr(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):pr(0,this.low<<e-32,this.unsigned)};Fe.shl=Fe.shiftLeft;Fe.shiftRight=function(e){return ca(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?pr(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):pr(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Fe.shr=Fe.shiftRight;Fe.shiftRightUnsigned=function(e){if(ca(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var n=this.low;return pr(n>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?pr(t,0,this.unsigned):pr(t>>>e-32,0,this.unsigned)};Fe.shru=Fe.shiftRightUnsigned;Fe.shr_u=Fe.shiftRightUnsigned;Fe.toSigned=function(){return this.unsigned?pr(this.low,this.high,!1):this};Fe.toUnsigned=function(){return this.unsigned?this:pr(this.low,this.high,!0)};Fe.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Fe.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Fe.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};hr.fromBytes=function(e,t,n){return n?hr.fromBytesLE(e,t):hr.fromBytesBE(e,t)};hr.fromBytesLE=function(e,t){return new hr(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};hr.fromBytesBE=function(e,t){return new hr(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var the=Object.assign(Object.create(null),Cb,{default:Cb}),rhe=Cb||the;function l1(r){return rhe.fromString(r,!0,16)}l1("c3a5c85c97cb3127");l1("b492b66fbe98f273");l1("9ae16a3b2f90404f");function nhe(r,e){return r instanceof Float32Array&&e==="float32"||r instanceof Int32Array&&e==="int32"||r instanceof Uint8Array&&e==="bool"}function p4(r,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=nm(r)),Wr().getBool("DEBUG")&&Wfe(r,e),nhe(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){for(var t=new Uint8Array(r.length),n=0;n<t.length;++n)Math.round(r[n])!==0&&(t[n]=1);return t}else throw new Error("Unknown data type "+e)}function Fv(){return Wr().platform.now()}function ahe(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",Wr().platform.encode(r,e)}function wO(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",Wr().platform.decode(r,e)}var ihe=function(){function r(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new she)}return r.prototype.profileKernel=function(e,t,n){var a,i,o,s=function(){o=n()},u,l=Fv();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var c=be(o),f=c.next();!f.done;f=c.next()){var h=f.value;h.dataSync()}}catch(v){a={error:v}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:Fv()-l})}if(Wr().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var p=function(v){var g=o[v];g.data().then(function(y){ohe(y,g.dtype,e)})},d=0;d<o.length;d++)p(d);var m={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(v){return v.kernelMs}),extraInfo:u.then(function(v){return v.getExtraProfileInfo!=null?v.getExtraProfileInfo():""})};return m},r.prototype.logKernelProfile=function(e){var t=this,n=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(l){t.logger.logKernelProfile(n,u,l[0],l[1],o,l[2])})})},r}();function ohe(r,e,t){if(e!=="float32")return!1;for(var n=0;n<r.length;n++){var a=r[n];if(isNaN(a)||!isFinite(a))return console.warn("Found "+a+" in the result of '"+t+"'"),!0}return!1}var she=function(){function r(){}return r.prototype.logKernelProfile=function(e,t,n,a,i,o){var s=typeof a=="number"?Sv(a+"ms",9):a.error,u=Sv(e,25),l=t.rank,c=t.size,f=Sv(t.shape.toString(),14),h="";for(var p in i){var d=i[p];if(d!=null){var m=d.shape||t.shape,v=m.length;h+=p+": "+v+"D "+(v>0?m:"")+" "}}console.log("%c"+u+"	%c"+s+"	%c"+l+"D "+f+"	%c"+c+"	%c"+h+"	%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r}();function uhe(r,e,t){for(var n={},a={},i=0;i<e.length;i++)n[e[i].id]=!0;for(var i=0;i<r.length;i++){var o=r[i],s=o.inputs;for(var u in s){for(var l=s[u],c=!1,f=0;f<e.length;f++)if(n[l.id]){o.outputs.forEach(function(b){return n[b.id]=!0}),c=!0,a[o.id]=!0;break}if(c)break}}var h={};h[t.id]=!0;for(var p={},i=r.length-1;i>=0;i--)for(var o=r[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,p[o.id]=!0;break}for(var d=[],i=0;i<r.length;i++){var o=r[i];if(a[o.id]&&p[o.id]){var m={};for(var u in o.inputs){var v=o.inputs[u];n[v.id]&&(m[u]=v)}var g=Object.assign({},o);g.inputs=m,g.outputs=o.outputs,d.push(g)}}return d}function lhe(r,e,t,n){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var p=r[h.id];p!=null?u.push(p):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+("for "+s.kernelName+"."));var l=s.gradient(u),c=function(h){if(!(h in l))throw new Error("Cannot backprop through input "+h+". "+("Available gradients found: "+Object.keys(l)+"."));var p=t(function(){return l[h]()});if(p.dtype!=="float32")throw new Error("Error in gradient for op "+s.kernelName+". The gradient of input "+(h+" must have 'float32' dtype, but has '"+p.dtype+"'"));var d=s.inputs[h];if(!Yl(p.shape,d.shape))throw new Error("Error in gradient for op "+s.kernelName+". The gradient of input "+("'"+h+"' has shape '"+p.shape+"', which does not match ")+("the shape of the input '"+d.shape+"'"));if(r[d.id]==null)r[d.id]=p;else{var m=r[d.id];r[d.id]=n(m,p),m.dispose()}};for(var f in s.inputs)c(f)},i=e.length-1;i>=0;i--)a(i)}var xO=20,Hf=3,pb=7;function che(r,e,t,n){var a=i1(e),i=fhe(r,e,t,a),o=e.length,s=Nv(r,e,t,a,i),u=["Tensor"];return n&&(u.push("  dtype: "+t),u.push("  rank: "+o),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map(function(l){return"    "+l}).join(`
`)),u.join(`
`)}function fhe(r,e,t,n){var a=oa(e),i=n[n.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?eh(r):r;if(s>1)for(var l=0;l<a/i;l++)for(var c=l*i,f=0;f<i;f++)o[f]=Math.max(o[f],Qf(u[c+f],0,t).length);return o}function Qf(r,e,t){var n;return Array.isArray(r)?n=parseFloat(r[0].toFixed(pb))+" + "+(parseFloat(r[1].toFixed(pb))+"j"):n1(r)?n="'"+r+"'":t==="bool"?n=d4(r):n=parseFloat(r.toFixed(pb)).toString(),Sv(n,e)}function d4(r){return r===0?"false":"true"}function Nv(r,e,t,n,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var l=eh(r);return[Qf(l[0],0,t)]}return t==="bool"?[d4(r[0])]:[r[0].toString()]}if(u===1){if(s>xO){var c=Hf*o,f=Array.from(r.slice(0,c)),h=Array.from(r.slice((s-Hf)*o,s*o));return t==="complex64"&&(f=eh(f),h=eh(h)),["["+f.map(function(N,T){return Qf(N,a[T],t)}).join(", ")+", ..., "+h.map(function(N,T){return Qf(N,a[s-Hf+T],t)}).join(", ")+"]"]}var p=t==="complex64"?eh(r):Array.from(r);return["["+p.map(function(N,T){return Qf(N,a[T],t)}).join(", ")+"]"]}var d=e.slice(1),m=n.slice(1),v=n[0]*o,g=[];if(s>xO){for(var y=0;y<Hf;y++){var b=y*v,w=b+v;g.push.apply(g,mt(Nv(r.slice(b,w),d,t,m,a,!1)))}g.push("...");for(var y=s-Hf;y<s;y++){var b=y*v,w=b+v;g.push.apply(g,mt(Nv(r.slice(b,w),d,t,m,a,y===s-1)))}}else for(var y=0;y<s;y++){var b=y*v,w=b+v;g.push.apply(g,mt(Nv(r.slice(b,w),d,t,m,a,y===s-1)))}var x=u===2?",":"";g[0]="["+g[0]+x;for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+x;for(var k=`,
`,y=2;y<u;y++)k+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":k),g}function eh(r){for(var e=[],t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var hhe=function(){function r(e,t,n){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=oa(e),n!=null){var i=n.length;H(i===this.size,function(){return"Length of values '"+i+"' does not match the size "+("inferred by the shape '"+a.size+"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||$fe(t,this.size),this.strides=i1(e)}return r.prototype.set=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];n.length===0&&(n=[0]),H(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must "+("match the rank ("+t.rank+")")});var i=this.locToIndex(n);this.values[i]=e},r.prototype.get=function(){for(var e,t,n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];n.length===0&&(n=[0]);var i=0;try{for(var o=be(n),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var l="Requested out of range element at "+n+". "+("  Buffer shape="+this.shape);throw new Error(l)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var c=n[n.length-1],f=0;f<n.length-1;++f)c+=this.strides[f]*n[f];return this.values[c]},r.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},r.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.toTensor=function(){return wi().makeTensor(this.values,this.shape,this.dtype)},r}(),wi=null,Kf=null;function phe(r){wi=r}var Aa=function(){function r(e,t,n,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=oa(e),this.strides=i1(e),this.dataId=n,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.buffer=function(){return Ce(this,void 0,void 0,function(){var e;return Ie(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Kf.buffer(this.shape,this.dtype,e)]}})})},r.prototype.bufferSync=function(){return Kf.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return Ce(this,void 0,void 0,function(){var e;return Ie(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,fO(this.shape,e,this.dtype==="complex64")]}})})},r.prototype.arraySync=function(){return fO(this.shape,this.dataSync(),this.dtype==="complex64")},r.prototype.data=function(){return Ce(this,void 0,void 0,function(){var e,t;return Ie(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=wi().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(a){return wO(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}})})},r.prototype.dataToGPU=function(e){return this.throwIfDisposed(),wi().readToGPU(this.dataId,e)},r.prototype.dataSync=function(){this.throwIfDisposed();var e=wi().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return wO(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},r.prototype.bytes=function(){return Ce(this,void 0,void 0,function(){var e;return Ie(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,wi().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(wi().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.print=function(e){return e===void 0&&(e=!1),Kf.print(this,e)},r.prototype.clone=function(){return this.throwIfDisposed(),Kf.clone(this)},r.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return che(t,this.shape,this.dtype,e)},r.prototype.cast=function(e){return this.throwIfDisposed(),Kf.cast(this,e)},r.prototype.variable=function(e,t,n){return e===void 0&&(e=!0),this.throwIfDisposed(),wi().makeVariable(this,e,t,n)},r}();Object.defineProperty(Aa,Symbol.hasInstance,{value:function(r){return!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null}});function dhe(){return s1("Tensor",function(){return Aa})}dhe();var Rv=function(r){ge(e,r);function e(t,n,a,i){var o=r.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=n,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and "+("previous value ("+this.dtype+") must match"));if(!Yl(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and "+("previous value ("+this.shape+") must match"));wi().disposeTensor(this),this.dataId=t.dataId,wi().incRef(this,null)},e.prototype.dispose=function(){wi().disposeVariable(this),this.isDisposedInternal=!0},e}(Aa);Object.defineProperty(Rv,Symbol.hasInstance,{value:function(r){return r instanceof Aa&&r.assign!=null&&r.assign instanceof Function}});var kO;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(kO||(kO={}));var _b;(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(_b||(_b={}));var Db;(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(Db||(Db={}));var Fb;(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(Fb||(Fb={}));var Rb;(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(Rb||(Rb={}));var vhe={float32:Fb,int32:_b,bool:Db,complex64:Rb};function mhe(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error("Can not upcast "+r+" with "+e)}return vhe[r][e]}function Pr(r,e){if(r.dtype===e.dtype)return[r,e];var t=mhe(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function ghe(r,e){H(r.dtype===e.dtype,function(){return"The dtypes of the first("+r.dtype+") and"+(" second("+e.dtype+") input must match")})}function v4(r){var e=[],t=new Set;return m4(r,e,t),e}function m4(r,e,t){if(r!=null){if(r instanceof Aa){e.push(r);return}if(!!yhe(r)){var n=r;for(var a in n){var i=n[a];t.has(i)||(t.add(i),m4(i,e,t))}}}}function yhe(r){return Array.isArray(r)||typeof r=="object"}function db(r){return r.kernelName!=null}var SO=function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return r.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},r}(),c1=function(){function r(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new SO}return r.prototype.ready=function(){return Ce(this,void 0,void 0,function(){var e,t,n,a;return Ie(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(n)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,n=e.asyncInit;if(n)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},r.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},r.prototype.registerBackend=function(e,t,n){return n===void 0&&(n=1),e in this.registryFactory?(Ml(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},r.prototype.setBackend=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o;return Ie(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,a=t.asyncInit,a?[4,n]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=n,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new ihe(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var e=this,t=dO(this.backendName);t.forEach(function(n){n.setupFunc!=null&&n.setupFunc(e.backendInstance)})},r.prototype.disposeRegisteredKernels=function(e){var t=this,n=dO(e);n.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},r.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(n==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var a=n.factory();if(a&&!(a instanceof Lfe)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,Ml("Initialization of backend "+e+" failed"),Ml(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return Ml("Initialization of backend "+e+" failed"),Ml(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],a=this.initializeBackend(n),i=a.success,o=a.asyncInit;if(o||i)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),a=n.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(e,t){var n=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return n.startScope(a)},function(){return n.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},r.prototype.scopedRun=function(e,t,n){e();try{var a=n();return t(),a}catch(i){throw t(),i}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(e){var t=ne.runKernel(e1,{x:e}),n={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},l={dtype:s};return ne.runKernel(Qb,u,l)}}},i=[];return this.addTapeNode(this.state.activeScope.name,n,[t],a,i,{}),t},r.prototype.runKernel=function(e,t,n){this.backendName==null&&this.backend;var a=Ib(e,this.backendName)!=null;if(!a)throw new Error("Kernel '"+e+"' not registered for backend '"+this.backendName+"'");return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(e,t,n){var a=this.backend.numDataIds(),i=0;n.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak "+("("+s+" data ids) after running '"+e+"'"))},r.prototype.runKernelFunc=function(e){var t=this,n,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var l,c=db(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(db(e)){var f=e.kernelName,h=e.inputs,p=e.attrs;this.backendName==null&&this.backend;var d=Ib(f,this.backendName);H(d!=null,function(){return"Cannot find registered kernel '"+f+"' for backend '"+t.backendName+"'"}),u=function(){var x=t.backend.numDataIds();l=d.kernelFunc({inputs:h,attrs:p,backend:t.backend});var k=Array.isArray(l)?l:[l];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,x,k);var N=k.map(function(I){return I.rank!=null?I:t.makeTensorFromTensorInfo(I)});if(i){var T=t.getTensorsForGradient(f,h,N);a=t.saveTensorsForBackwardMode(T)}return N}}else{var m=e.forwardFunc,v=function(x){!i||(a=x.map(function(k){return t.keep(t.clone(k))}))};u=function(){var x=t.backend.numDataIds();l=t.tidy(function(){return m(t.backend,v)});var k=Array.isArray(l)?l:[l];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(c,x,k),k}}var g=e.inputs,y=e.attrs,b=db(e)?null:e.backwardsFunc,w;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?n=u():(w=t.profiler.profileKernel(c,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(w),n=w.outputs)}),i&&this.addTapeNode(c,g,n,b,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(x){return g[x]!=null?g[x].shape:null}),outputShapes:n.map(function(x){return x.shape}),kernelTimeMs:w.timeMs,extraInfo:w.extraInfo}),Array.isArray(l)?n:n[0]},r.prototype.saveTensorsForBackwardMode=function(e){var t=this,n=e.map(function(a){return t.keep(t.clone(a))});return n},r.prototype.getTensorsForGradient=function(e,t,n){var a=pO(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(H(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(l){return t[l]})):s=i.map(function(l){return t[l]});var u=n.filter(function(l,c){return o[c]});return s.concat(u)}return[]},r.prototype.makeTensor=function(e,t,n,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",a=a||this.backend;var i=e;n==="string"&&n1(e[0])&&(i=e.map(function(c){return ahe(c)}));var o=a.write(i,t,n),s=new Aa(t,n,o,this.nextTensorId());if(this.trackTensor(s,a),n==="string"){var u=this.state.tensorInfo.get(o),l=Vfe(i);this.state.numBytes+=l-u.bytes,u.bytes=l}return s},r.prototype.makeTensorFromDataId=function(e,t,n,a){n=n||"float32";var i={dataId:e,shape:t,dtype:n};return this.makeTensorFromTensorInfo(i,a)},r.prototype.makeTensorFromTensorInfo=function(e,t){var n=e.dataId,a=e.shape,i=e.dtype,o=new Aa(a,i,n,this.nextTensorId());return this.trackTensor(o,t),o},r.prototype.makeVariable=function(e,t,n,a){t===void 0&&(t=!0),n=n||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new Rv(e,t,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},r.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*cO(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof Rv||this.track(e)},r.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},r.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},r.prototype.disposeTensor=function(e){if(!!this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var n=e.size*cO(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},r.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},r.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},r.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},r.prototype.profile=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c,f,h;return Ie(this,function(p){switch(p.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=p.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,mt(this.state.activeProfile.kernels.map(function(d){return d.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,p.label=2;case 2:p.trys.push([2,8,9,10]),i=be(this.state.activeProfile.kernels),o=i.next(),p.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=p.sent(),l=s,[4,s.extraInfo];case 5:l.extraInfo=p.sent(),p.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return c=p.sent(),f={error:c},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(e,t,n,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},l=pO(e);l!=null&&(a=l.gradFunc),a!=null&&(u.gradient=function(c){return c=c.map(function(f,h){if(f==null){var p=n[h],d=o1(p.size,p.dtype);return s.makeTensor(d,p.shape,p.dtype)}return f}),a(c.length>1?c:c[0],i,o)}),this.state.activeTape.push(u)},r.prototype.keep=function(e){return e.kept=!0,e},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(e){for(var t=this,n=v4(e),a=new Set(n.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},r.prototype.gradients=function(e,t,n,a){var i=this;if(a===void 0&&(a=!1),H(t.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});H(o instanceof Aa,function(){return"The result y returned by f() must be a tensor."});var s=uhe(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=n??bhe(o.shape),lhe(u,s,function(c){return i.tidy(c)},xhe);var l=t.map(function(c){return u[c.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(c){var f,h;try{for(var p=be(c.saved),d=p.next();!d.done;d=p.next()){var m=d.value;m.dispose()}}catch(v){f={error:v}}finally{try{d&&!d.done&&(h=p.return)&&h.call(p)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:l}})},r.prototype.customGrad=function(e){var t=this;return H(Eb(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];H(n.every(function(l){return l instanceof Aa}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};n.forEach(function(l,c){o[c]=l});var s=function(l,c){return i=e.apply(void 0,mt(n,[c])),H(i.value instanceof Aa,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),H(Eb(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(l,c){var f=i.gradFunc(l,c),h=Array.isArray(f)?f:[f];H(h.length===n.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),H(h.every(function(d){return d instanceof Aa}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return h.forEach(function(d,m){p[m]=function(){return d}}),p};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},r.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},r.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},r.prototype.readToGPU=function(e,t){var n=this.state.tensorInfo.get(e);return n.backend.readToGPU(e,t)},r.prototype.time=function(e){return Ce(this,void 0,void 0,function(){var t,n;return Ie(this,function(a){switch(a.label){case 0:return t=Fv(),[4,this.backend.time(e)];case 1:return n=a.sent(),n.wallMs=Fv()-t,[2,n]}})})},r.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),r.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new SO;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r}();c1.nextTensorId=0;c1.nextVariableId=0;function bhe(r){var e=n4(oa(r),"float32");return ne.makeTensor(e,r,"float32")}function whe(){var r=s4();if(r._tfengine==null){var e=new Hfe(r);r._tfengine=new c1(e)}return Yfe(r._tfengine.ENV),phe(function(){return r._tfengine}),r._tfengine}var ne=whe();function xhe(r,e){var t={a:r,b:e};return ne.runKernel(Jb,t)}function wh(r,e){var t=r;if(Zi(r))return e==="string"?[]:[r.length];if(!Array.isArray(r))return[];for(var n=[];Array.isArray(t)||Zi(t)&&e!=="string";)n.push(t.length),t=t[0];return Array.isArray(r)&&Wr().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&g4(r,n,[]),n}function g4(r,e,t){if(t=t||[],!Array.isArray(r)&&!Zi(r)){H(e.length===0,function(){return"Element arr["+t.join("][")+"] is a primitive, "+("but should be an array/TypedArray of "+e[0]+" elements")});return}H(e.length>0,function(){return"Element arr["+t.join("][")+"] should be a primitive, "+("but is an array of "+r.length+" elements")}),H(r.length===e[0],function(){return"Element arr["+t.join("][")+"] should have "+e[0]+" "+("elements, but has "+r.length+" elements")});for(var n=e.slice(1),a=0;a<r.length;++a)g4(r[a],n,t.concat(a))}function NO(r,e,t,n){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==e||r==="numeric"&&e==="string")throw new Error("Argument '"+t+"' passed to '"+n+"' must "+("be "+r+" tensor, but got "+e+" tensor"))}}function $(r,e,t,n){if(n===void 0&&(n="numeric"),r instanceof Aa)return NO(n,r.dtype,e,t),r;var a=a1(r);if(a!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(a=n),NO(n,a,e,t),r==null||!Zi(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var i=r==null?"null":r.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a "+("Tensor or TensorLike, but got '"+i+"'"))}var o=wh(r,a);!Zi(r)&&!Array.isArray(r)&&(r=[r]);var s=!0,u=a!=="string"?p4(r,a):nm(r,[],s);return ne.makeTensor(u,o,a)}function Ov(r,e,t,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");var a=r;return a.map(function(i,o){return $(i,e+"["+o+"]",t,n)})}var khe="__op";function X(r){var e=Object.keys(r);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+(e.length+" keys."));var t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+khe;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];ne.startScope(t);try{var s=n.apply(void 0,mt(i));return i4(s)&&console.error("Cannot return a Promise inside of tidy."),ne.endScope(s),s}catch(u){throw ne.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function She(r,e){var t=$(r,"x","cast");if(!qfe(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var n={x:t},a={dtype:e};return ne.runKernel(Qb,n,a)}var rt=X({cast_:She});function Nhe(r,e){var t,n=$(r,"a","mul"),a=$(e,"b","mul");t=me(Pr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ne.runKernel(gM,i)}var de=X({mul_:Nhe});function Ehe(r,e){e===void 0&&(e=0);var t=$(r,"x","step"),n={x:t},a={alpha:e};return ne.runKernel(t4,n,a)}var am=X({step_:Ehe}),y4={kernelName:gP,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){return de(r,am(rt(n,"float32"),-1))}}}};function The(r,e){var t,n=$(r,"a","floorDiv"),a=$(e,"b","floorDiv");t=me(Pr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ne.runKernel(ZP,i)}var Ihe=X({floorDiv_:The});function Che(r,e){var t,n=$(r,"a","div"),a=$(e,"b","div");if(t=me(Pr(n,a),2),n=t[0],a=t[1],n.dtype==="int32"&&a.dtype==="int32")return Ihe(n,a);var i={a:n,b:a},o={};return ne.runKernel(GP,i,o)}var bt=X({div_:Che});function Ahe(r){var e=$(r,"x","neg"),t={x:e};return ne.runKernel(yM,t)}var on=X({neg_:Ahe});function xh(r,e,t,n){if(n==null&&(n=a1(r)),n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Zi(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){a4(e);var a=oa(e),i=oa(t);H(a===i,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+(a+" values but has "+i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==oa(e.slice(o)):!0;H(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+("("+t+") does not match the provided ")+("shape ("+e+"). ")})}}return!Zi(r)&&!Array.isArray(r)&&(r=[r]),e=e||t,r=n!=="string"?p4(r,n):nm(r,[],!0),ne.makeTensor(r,e,n)}function wt(r,e){if((Zi(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Zi(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],n=[];return xh(r,t,n,e)}function _he(r){var e=$(r,"x","sqrt","float32"),t={x:e};return ne.runKernel(VM,t)}var _a=X({sqrt_:_he});function Dhe(r){var e=$(r,"x","square"),t={};return ne.runKernel("Square",{x:e},t)}var fr=X({square_:Dhe});function Fhe(r,e){var t,n=$(r,"a","sub"),a=$(e,"b","sub");t=me(Pr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ne.runKernel(XM,i)}var lt=X({sub_:Fhe}),Rhe={kernelName:yP,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){var a=fr(rt(n,"float32")),i=_a(lt(wt(1),a));return on(bt(r,i))}}}},Ohe={kernelName:bP,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){var a=_a(lt(fr(rt(n,"float32")),1));return bt(r,a)}}}};function sn(r,e){for(var t=[],n=0;n<e.length;n++){var a=r[r.length-n-1],i=e.length-n-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function Jt(r,e){for(var t=[],n=Math.max(r.length,e.length),a=0;a<n;a++){var i=r[r.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)t.unshift(o);else if(o===1)t.unshift(i);else if(i!==o){var s="Operands could not be broadcast together with shapes "+(r+" and "+e+".");throw Error(s)}else t.unshift(i)}return t}function Phe(r,e){var t=$(r,"x","reshape","string_or_numeric"),n={x:t},a={shape:e};return ne.runKernel(CM,n,a)}var ve=X({reshape_:Phe});function Mhe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=$(r,"x","sum");n.dtype==="bool"&&(n=rt(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return ne.runKernel(GM,a,i)}var ht=X({sum_:Mhe}),Bhe={kernelName:Jb,inputsToSave:["a","b"],gradFunc:function(r,e){var t=me(e,2),n=t[0],a=t[1],i=Jt(n.shape,a.shape),o=function(){var u=r,l=sn(n.shape,i);return l.length>0&&(u=ht(u,l)),ve(u,n.shape)},s=function(){var u=r,l=sn(a.shape,i);return l.length>0&&(u=ht(u,l)),ve(u,a.shape)};return{a:o,b:s}}};var Lhe={kernelName:wP,saveAllInputs:!0,gradFunc:function(r,e){var t={};return e.forEach(function(n,a){t[a]=function(){return r.clone()}}),t}};function zhe(r){var e=$(r,"x","zerosLike"),t={x:e};return ne.runKernel(e4,t)}var Mt=X({zerosLike_:zhe}),$he={kernelName:xP,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){return Mt(n)}}}},Whe={kernelName:kP,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){return Mt(n)}}}},qhe={kernelName:SP,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){return bt(r,_a(lt(wt(1),fr(rt(n,"float32")))))}}}};function Vhe(r,e){var t,n=$(r,"a","add"),a=$(e,"b","add");t=me(Pr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ne.runKernel(Jb,i)}var et=X({add_:Vhe}),Ghe={kernelName:NP,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){var a=_a(et(wt(1),fr(rt(n,"float32"))));return bt(r,a)}}}},Uhe={kernelName:IP,inputsToSave:["a","b"],gradFunc:function(r,e){var t=me(e,2),n=t[0],a=t[1],i=Jt(n.shape,a.shape),o=function(){var u=et(fr(n),fr(a)),l=de(r,bt(a,u)),c=sn(n.shape,i);return c.length>0&&(l=ht(l,c)),ve(l,n.shape)},s=function(){var u=et(fr(n),fr(a)),l=on(de(r,bt(n,u))),c=sn(a.shape,i);return c.length>0&&(l=ht(l,c)),ve(l,a.shape)};return{a:o,b:s}}},Hhe={kernelName:EP,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){return bt(r,et(fr(rt(n,"float32")),1))}}}},Khe={kernelName:TP,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){return bt(r,lt(wt(1),fr(rt(n,"float32"))))}}}};function jhe(r,e,t,n,a,i,o){o===void 0&&(o="channelsLast");var s=me(Pv(e),2),u=s[0],l=s[1],c;if(o==="channelsLast")c=[u,l,r[3],r[3]];else if(o==="channelsFirst")c=[u,l,r[1],r[1]];else throw new Error("Unknown dataFormat "+o);return f1(r,c,t,n,a,i,!1,o)}function f1(r,e,t,n,a,i,o,s){var u,l;o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var c=me([-1,-1,-1,-1],4),f=c[0],h=c[1],p=c[2],d=c[3];if(s==="channelsLast")u=me(r,4),f=u[0],h=u[1],p=u[2],d=u[3];else if(s==="channelsFirst")l=me(r,4),f=l[0],d=l[1],h=l[2],p=l[3];else throw new Error("Unknown dataFormat "+s);var m=me(e,4),v=m[0],g=m[1],y=m[3],b=me(Pv(t),2),w=b[0],x=b[1],k=me(Pv(n),2),N=k[0],T=k[1],I=Ob(v,N),F=Ob(g,T),D=Zhe(a,h,p,w,x,I,F,i,s),R=D.padInfo,P=D.outHeight,B=D.outWidth,q=o?y*d:y,O;return s==="channelsFirst"?O=[f,q,P,B]:s==="channelsLast"&&(O=[f,P,B,q]),{batchSize:f,dataFormat:s,inHeight:h,inWidth:p,inChannels:d,outHeight:P,outWidth:B,outChannels:q,padInfo:R,strideHeight:w,strideWidth:x,filterHeight:v,filterWidth:g,effectiveFilterHeight:I,effectiveFilterWidth:F,dilationHeight:N,dilationWidth:T,inShape:r,outShape:O,filterShape:e}}function Xhe(r,e,t,n,a){n==null&&(n=Yhe(r,e,t));var i=r[0],o=r[1],s=Mv((i-e+2*n)/t+1,a),u=Mv((o-e+2*n)/t+1,a);return[s,u]}function Yhe(r,e,t,n){n===void 0&&(n=1);var a=Ob(e,n);return Math.floor((r[0]*(t-1)-t+a)/2)}function Pv(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function Ob(r,e){return e<=1?r:r+(r-1)*(e-1)}function Zhe(r,e,t,n,a,i,o,s,u){var l,c,f;if(typeof r=="number"){var h=r===0?"VALID":"NUMBER";l={top:r,bottom:r,left:r,right:r,type:h};var p=Xhe([e,t],i,n,r,s);c=p[0],f=p[1]}else if(r==="same"){c=Math.ceil(e/n),f=Math.ceil(t/a);var d=Math.max(0,(c-1)*n+i-e),m=Math.max(0,(f-1)*a+o-t),v=Math.floor(d/2),g=d-v,y=Math.floor(m/2),b=m-y;l={top:v,bottom:g,left:y,right:b,type:"SAME"}}else if(r==="valid")l={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-i+1)/n),f=Math.ceil((t-o+1)/a);else if(typeof r=="object"){var v=u==="channelsLast"?r[1][0]:r[2][0],g=u==="channelsLast"?r[1][1]:r[2][1],y=u==="channelsLast"?r[2][0]:r[3][0],b=u==="channelsLast"?r[2][1]:r[3][1],h=v===0&&g===0&&y===0&&b===0?"VALID":"EXPLICIT";l={top:v,bottom:g,left:y,right:b,type:h},c=Mv((e-i+v+g)/n+1,s),f=Mv((t-o+y+b)/a+1,s)}else throw Error("Unknown padding parameter: "+r);return{padInfo:l,outHeight:c,outWidth:f}}function Mv(r,e){if(!e)return Math.trunc(r);switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode "+e)}}function hu(r){var e=me(Pv(r),3),t=e[0],n=e[1],a=e[2];return t===1&&n===1&&a===1}function ko(r,e){return hu(r)||hu(e)}function Ln(r,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in "+r+": pad must be an integer when using "+("dimRoundingMode "+t+" but got pad "+e+"."));if(typeof e=="number")H(sh(e),function(){return"Error in "+r+": pad must be an integer when using "+("dimRoundingMode "+t+" but got pad "+e+".")});else if(typeof e=="object")e.forEach(function(n){n.forEach(function(a){H(sh(a),function(){return"Error in "+r+": pad must be an integer when using "+("dimRoundingMode "+t+" but got pad "+a+".")})})});else throw Error("Error in "+r+": Unknown padding parameter: "+e)}}function Jhe(r,e,t,n,a,i){var o=$(r,"dy","avgPool3dGrad"),s=$(e,"input","avgPool3dGrad"),u=o,l=s,c=!1;s.rank===4&&(c=!0,u=ve(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),l=ve(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),H(u.rank===5,function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank "+(u.rank+".")}),H(l.rank===5,function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank "+(l.rank+".")}),Ln("avgPool3dGrad",a,i);var f={dy:u,input:l},h={filterSize:t,strides:n,pad:a,dimRoundingMode:i},p=ne.runKernel(Tce,f,h);return c?ve(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var Qhe=X({avgPool3dGrad_:Jhe}),epe={kernelName:AP,inputsToSave:["x"],gradFunc:function(r,e,t){var n=me(e,1),a=n[0],i=t.filterSize,o=t.strides,s=t.pad,u=t.dimRoundingMode;return{x:function(){return Qhe(r,a,i,o,s,u)}}}};function tpe(r,e,t,n,a){var i=$(r,"dy","avgPoolGrad"),o=$(e,"input","avgPoolGrad");H(o.rank===i.rank,function(){return"Rank of input ("+o.rank+") does not match rank of dy ("+i.rank+")"});var s=o,u=i,l=!1;o.rank===3&&(l=!0,s=ve(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=ve(i,[1,i.shape[0],i.shape[1],i.shape[2]])),H(u.rank===4,function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank "+(u.rank+".")}),H(s.rank===4,function(){return"Error in avgPoolGrad: input must be rank 4 but got rank "+(s.rank+".")});var c={dy:u,input:s},f={filterSize:t,strides:n,pad:a},h=ne.runKernel(Ece,c,f);return l?ve(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var rpe=X({avgPoolGrad_:tpe}),npe={kernelName:CP,inputsToSave:["x"],gradFunc:function(r,e,t){var n=me(e,1),a=n[0],i=t.filterSize,o=t.strides,s=t.pad;return{x:function(){return rpe(r,a,i,o,s)}}}};function ape(r,e,t,n){var a;t===void 0&&(t=!1),n===void 0&&(n=!1);var i=$(r,"a","matMul"),o=$(e,"b","matMul");a=me(Pr(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:n};return ne.runKernel(_P,s,u)}var Pt=X({matMul_:ape}),ipe={kernelName:_P,inputsToSave:["a","b"],gradFunc:function(r,e,t){var n=me(e,2),a=n[0],i=n[1],o=t.transposeA,s=t.transposeB;return!o&&!s?{a:function(){return Pt(r,i,!1,!0)},b:function(){return Pt(a,r,!0,!1)}}:!o&&s?{a:function(){return Pt(r,i,!1,!1)},b:function(){return Pt(r,a,!0,!1)}}:o&&!s?{a:function(){return Pt(i,r,!1,!0)},b:function(){return Pt(a,r,!1,!1)}}:{a:function(){return Pt(i,r,!0,!0)},b:function(){return Pt(r,a,!0,!0)}}}};function ope(r,e,t){var n=$(r,"x","spaceToBatchND");H(n.rank>=1+e.length,function(){return"input rank "+n.rank+" should be > than [blockShape] "+e.length}),H(t.length===e.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length}),H(n.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions "+n.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()});var a={x:n},i={blockShape:e,paddings:t};return ne.runKernel(UM,a,i)}var b4=X({spaceToBatchND_:ope});var spe={kernelName:DP,gradFunc:function(r,e,t){var n=t.blockShape,a=t.crops;return{x:function(){return b4(r,n,a)}}}};var upe={kernelName:Cce,gradFunc:function(r,e,t){for(var n=t,a=n.inputShape,i=n.shape,o=Array.from(i),s=a.length-1;s>=0;s--)if(a[s]===i[s])o[s]=1;else if(a[s]!==1)throw new Error("broadcastTo(): ["+a+"] cannot be broadcast to ["+i+"].");for(var u=[],s=0;s<o.length;s++)o[s]>1&&u.push(s);return{x:function(){return ht(r,u,!0)}}}};var lpe={kernelName:Qb,gradFunc:function(r){return{x:function(){return r.clone()}}}};var cpe={kernelName:FP,gradFunc:function(r){return{x:function(){return Mt(r)}}}};function fpe(r,e){var t,n=$(r,"a","greaterEqual","string_or_numeric"),a=$(e,"b","greaterEqual","string_or_numeric");t=me(Pr(n,a),2),n=t[0],a=t[1],Jt(n.shape,a.shape);var i={a:n,b:a};return ne.runKernel(eM,i)}var im=X({greaterEqual_:fpe});function hpe(r,e){var t,n=$(r,"a","lessEqual","string_or_numeric"),a=$(e,"b","lessEqual","string_or_numeric");t=me(Pr(n,a),2),n=t[0],a=t[1],Jt(n.shape,a.shape);var i={a:n,b:a};return ne.runKernel(efe,i)}var kh=X({lessEqual_:hpe});function ppe(r,e){var t=$(r,"a","logicalAnd","bool"),n=$(e,"b","logicalAnd","bool");Jt(t.shape,n.shape);var a={a:t,b:n};return ne.runKernel(tfe,a)}var uh=X({logicalAnd_:ppe});function dpe(r){var e=$(r,"x","clone","string_or_numeric"),t={x:e};return ne.runKernel(e1,t)}var ah=X({clone_:dpe});function vpe(r,e){var t=$(r,"broadcastTo","x"),n=t.shape;if(e.some(function(f){return!(f>0)||f%1!==0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<t.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+t.rank+".");if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=ve(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): ["+n+"] cannot be broadcast to ["+e+"].");var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return ah(t);var l={x:t},c={reps:o};return ne.runKernel(t1,l,c)}var vb=X({broadcastTo_:vpe});function mpe(r,e,t){var n=$(e,"a","where"),a=$(t,"b","where"),i=$(r,"condition","where","bool"),o=Jt(Jt(i.shape,n.shape),a.shape),s=vb(i,o),u=vb(n,o),l=vb(a,o),c={condition:s,t:u,e:l};return ne.runKernel(PM,c)}var Qa=X({where_:mpe}),gpe={kernelName:RP,inputsToSave:["x"],gradFunc:function(r,e,t){var n=me(e,1),a=n[0],i=t.clipValueMin,o=t.clipValueMax;return{x:function(){return Qa(uh(im(a,i),kh(a,o)),r,Mt(r))}}}};var ype={kernelName:OP,inputsToSave:["x"],gradFunc:y4.gradFunc};function bpe(r,e,t){t===void 0&&(t=0);var n=$(r,"x","split"),a={x:n},i={numOrSizeSplits:e,axis:t};return ne.runKernel(HM,a,i)}var lh=X({split_:bpe});var wpe={kernelName:PP,saveAllInputs:!0,gradFunc:function(r,e,t){var n=e.map(function(u){return u.shape}),a=t.axis,i=Ci(a,e[0].shape)[0],o=n.map(function(u){return u[i]}),s=lh(r,o,i);return s.map(function(u){return function(){return u}})}};function xpe(r,e,t,n,a,i,o){i===void 0&&(i="NHWC");var s=r;r.rank===3&&(s=ve(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=ve(e,[1,e.shape[0],e.shape[1],e.shape[2]])),H(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+(s.shape+".")}),H(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+(u.shape+".")}),H(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+(t+".")});var l=i==="NHWC"?s.shape[3]:s.shape[1],c=i==="NHWC"?u.shape[3]:u.shape[1];H(l===t[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must "+("match input depth in filter ("+t[2]+".")}),H(c===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must "+("match output depth for filter ("+t[3]+").")}),Ln("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return ne.runKernel(Dce,f,h)}var h1=X({conv2DBackpropFilter_:xpe});function kpe(r,e,t,n,a,i,o){i===void 0&&(i="NHWC"),H(r.length===e.rank,function(){return"Length of inShape "+("("+r.length+") and rank of dy ("+e.rank+") must match")});var s=r,u=e,l=!1;e.rank===3&&(l=!0,u=ve(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,r[0],r[1],r[2]]),H(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+(s.length+".")}),H(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+("rank "+u.rank)}),H(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+("rank "+t.rank)});var c=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];H(c===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must "+("match input depth for filter "+t.shape[2]+".")}),H(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+f+") must "+("match output depth for filter "+t.shape[3]+".")}),Ln("conv2dDerInput",a,o);var h={dy:u,filter:t},p={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=ne.runKernel(BP,h,p);return l?ve(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var p1=X({conv2DBackpropInput_:kpe}),Spe={kernelName:MP,inputsToSave:["x","filter"],gradFunc:function(r,e,t){var n=me(e,2),a=n[0],i=n[1],o=t.dilations,s=t.strides,u=t.pad,l=t.dataFormat;return H(hu(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 "+("are not yet supported in gradients. Got dilations '"+o+"'")}),{x:function(){return p1(a.shape,r,i,s,u,l)},filter:function(){return h1(a,r,i.shape,s,u,l)}}}};function Npe(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=$(r,"x","conv2d","float32"),u=$(e,"filter","conv2d","float32"),l=s,c=!1;s.rank===3&&(c=!0,l=ve(s,[1,s.shape[0],s.shape[1],s.shape[2]])),H(l.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),H(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+(u.rank+".")}),Ln("conv2d",n,o);var f=a==="NHWC"?l.shape[3]:l.shape[1];H(f===u.shape[2],function(){return"Error in conv2d: depth of input ("+f+") must match "+("input depth for filter "+u.shape[2]+".")}),H(ko(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+("Got strides "+t+" and dilations '"+i+"'")});var h={x:l,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=ne.runKernel(MP,h,p);return c?ve(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var om=X({conv2d_:Npe}),Epe={kernelName:BP,inputsToSave:["dy","filter"],gradFunc:function(r,e,t){var n=me(e,2),a=n[0],i=n[1],o=t.strides,s=t.pad,u=t.dataFormat,l=t.dimRoundingMode;return{dy:function(){return om(r,i,o,s,u,1,l)},filter:function(){return h1(r,a,i.shape,o,s,u,l)}}}};function Tpe(r,e,t,n,a){var i=r;r.rank===4&&(i=ve(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));var o=e;o.rank===4&&(o=ve(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),H(i.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+(i.shape+".")}),H(o.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+(o.shape+".")}),H(t.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+(t+".")}),H(i.shape[4]===t[3],function(){return"Error in conv3dDerFilter: depth of input "+i.shape[4]+") must "+("match input depth in filter ("+t[3]+".")}),H(o.shape[4]===t[4],function(){return"Error in conv3dDerFilter: depth of dy ("+o.shape[4]+") must "+("match output depth for filter ("+t[4]+").")});var s={x:i,dy:o},u={strides:n,pad:a,filterShape:t};return ne.runKernel(Fce,s,u)}var Ipe=X({conv3DBackpropFilter_:Tpe});function Cpe(r,e,t,n,a){H(r.length===e.rank,function(){return"Length of inShape "+("("+r.length+") and rank of dy ("+e.rank+") must match")});var i=r,o=e,s=!1;e.rank===4&&(s=!0,o=ve(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,r[0],r[1],r[2],r[3]]);var u=i[4],l=o.shape[4];H(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+(i.length+".")}),H(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+("rank "+o.rank)}),H(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+("rank "+t.rank)}),H(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must "+("match input depth for filter "+t.shape[3]+".")}),H(l===t.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must "+("match output depth for filter "+t.shape[4]+".")});var c={dy:o,filter:t},f={pad:a,strides:n,inputShape:i},h=ne.runKernel(Rce,c,f);return s?ve(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var w4=X({conv3DBackpropInput_:Cpe}),Ape={kernelName:LP,inputsToSave:["x","filter"],gradFunc:function(r,e,t){var n=t.dilations,a=t.strides,i=t.pad;H(hu(n),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are "+("not yet supported in gradients. Got dilations '"+n+"'")});var o=me(e,2),s=o[0],u=o[1];return{x:function(){return w4(s.shape,r,u,a,i)},filter:function(){return Ipe(s,r,u.shape,a,i)}}}};function _pe(r){var e=$(r,"x","sin","float32"),t={x:e};return ne.runKernel(LM,t)}var Dpe=X({sin_:_pe}),Fpe={kernelName:zP,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){return de(on(Dpe(rt(n,"float32"))),r)}}}};function Rpe(r){var e=$(r,"x","sinh"),t={x:e};return ne.runKernel(zM,t)}var Ope=X({sinh_:Rpe}),Ppe={kernelName:$P,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){return de(Ope(rt(n,"float32")),r)}}}};function Mpe(r,e){for(var t=0;t<r.length;++t)if(r[r.length-t-1]!==e-1-t)return!1;return!0}function Bpe(r,e,t){for(var n=r.length+e.length,a=[],i=0,o=0,s=0;s<n;s++)t.indexOf(s)===-1?a.push(r[i++]):a.push(e[o++]);return a}function Lpe(r,e){for(var t=[],n=r.length,a=0;a<n;a++)e.indexOf(a)===-1&&t.push(r[a]);var i=e.map(function(o){return r[o]});return[t,i]}function Gl(r,e){var t=e.map(function(n){return 1});return Bpe(r,t,e)}function x4(r,e){if(Mpe(r,e))return null;for(var t=[],n=0;n<e;++n)r.indexOf(n)===-1&&t.push(n);return r.forEach(function(a){return t.push(a)}),t}function d1(r){return r.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function zpe(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=$(r,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:n};return ne.runKernel(WP,i,o)}var $pe=X({cumsum_:zpe});function Yr(r,e){return ne.tidy(r,e)}function sa(r){var e=v4(r);e.forEach(function(t){return t.dispose()})}function Wpe(r){return ne.keep(r)}function qpe(r,e){var t=$(r,"real","complex"),n=$(e,"imag","complex");Qi(t.shape,n.shape,"real and imag shapes, "+t.shape+" and "+n.shape+", must match in call to tf.complex().");var a={real:t,imag:n};return ne.runKernel(_ce,a)}var Ul=X({complex_:qpe});function Vpe(r){var e=$(r,"input","imag"),t={input:e};return ne.runKernel(Jce,t)}var v1=X({imag_:Vpe});function Gpe(r){var e=$(r,"input","real"),t={input:e};return ne.runKernel(gfe,t)}var Bv=X({real_:Gpe});function Upe(r,e,t){var n=$(r,"x","transpose");if(e==null&&(e=n.shape.map(function(o,s){return s}).reverse()),H(n.rank===e.length,function(){return"Error in transpose: rank of input "+n.rank+" "+("must match length of perm "+e+".")}),e.forEach(function(o){H(o>=0&&o<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+(" but got "+e)})}),n.rank<=1)return n.clone();var a={x:n},i={perm:e};return n.dtype==="complex64"?Yr(function(){var o=Bv(n),s=v1(n);return o=ne.runKernel(kv,{x:o},i),s=ne.runKernel(kv,{x:s},i),t&&(s=on(s)),Ul(o,s)}):ne.runKernel(kv,a,i)}var wo=X({transpose_:Upe}),Hpe={kernelName:WP,inputsToSave:["x"],gradFunc:function(r,e,t){var n=me(e,1),a=n[0],i=t.axis,o=t.exclusive,s=t.reverse;return{x:function(){var u=x4([i],a.rank),l=$pe(r,i,o,!s);return u!=null&&(l=wo(l,u)),l}}}};function Kpe(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=r;r.rank===3&&(s=ve(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=ve(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var l={x:s,dy:u},c={strides:n,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return ne.runKernel(Lce,l,c)}var k4=X({depthwiseConv2dNativeBackpropFilter_:Kpe});function jpe(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=ve(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var l={dy:s,filter:t},c={strides:n,pad:a,dimRoundingMode:o,dilations:i,inputShape:r},f=ne.runKernel(zce,l,c);return u?ve(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var S4=X({depthwiseConv2dNativeBackpropInput_:jpe}),Xpe={kernelName:qP,inputsToSave:["x","filter"],gradFunc:function(r,e,t){var n=t.dilations,a=t.strides,i=t.pad,o=t.dimRoundingMode,s=n??[1,1];H(hu(s),function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations "+("'"+s+"'")});var u=me(e,2),l=u[0],c=u[1];return H(l.rank===4,function(){return"Error in gradient of depthwiseConv2dNative: input must be "+("rank 4, but got rank "+l.rank+".")}),H(c.rank===4,function(){return"Error in gradient of depthwiseConv2dNative: filter must be "+("rank 4, but got rank "+c.rank+".")}),H(l.shape[3]===c.shape[2],function(){return"Error in gradient of depthwiseConv2d: number of input "+("channels ("+l.shape[3]+") must match the inChannels dimension ")+("in filter "+c.shape[2]+".")}),H(ko(a,s),function(){return"Error in gradient of depthwiseConv2d: Either strides or "+("dilations must be  1. Got strides "+a+" and dilations ")+("'"+s+"'.")}),Ln("depthwiseConv2d",i,o),{x:function(){return S4(l.shape,r,c,a,i,s,o)},filter:function(){return k4(l,r,c.shape,a,i,s,o)}}}},Ype={kernelName:VP,inputsToSave:["x","filter"],gradFunc:function(r,e,t){var n=me(e,2),a=n[0],i=n[1],o={x:a,filter:i,dy:r},s={x:a,filter:i,dy:r};return{x:function(){return ne.runKernel(Wce,o,t)},filter:function(){return ne.runKernel(qce,s,t)}}}},Zpe={kernelName:UP,outputsToSave:[!0],gradFunc:function(r,e){var t=me(e,1),n=t[0],a={dy:r,y:n};return{x:function(){return ne.runKernel(Gce,a)}}}};function Jpe(r){var e=$(r,"x","exp"),t={x:e};return ne.runKernel(KP,t)}var Ji=X({exp_:Jpe}),Qpe={kernelName:HP,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0],a=de(Ji(on(fr(n))),2/Math.sqrt(Math.PI));return{x:function(){return de(r,a)}}}},ede={kernelName:KP,outputsToSave:[!0],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){return de(r,n)}}}},tde={kernelName:jP,inputsToSave:["input"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{input:function(){return ve(r,n.shape)}}}},rde={kernelName:XP,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){return de(r,Ji(n))}}}};var nde={kernelName:YP,gradFunc:function(r){return{x:function(){return Mt(r)}}}},ade={kernelName:ZP,inputsToSave:["a","b"],gradFunc:function(r,e){var t=me(e,2),n=t[0],a=t[1],i=Jt(n.shape,a.shape),o=function(){var u=bt(r,rt(a,"float32")),l=sn(n.shape,i);return l.length>0?ve(ht(u,l),n.shape):u},s=function(){var u=de(r,rt(n,"float32")),l=sn(a.shape,i);l.length>0&&(u=ve(ht(u,l),a.shape));var c=fr(a);return on(bt(u,rt(c,"float32")))};return{a:o,b:s}}};function ide(r){var e=$(r,"x","rsqrt","float32"),t={x:e};return ne.runKernel(OM,t)}var ode=X({rsqrt_:ide});function sde(r,e){var t=$(r,"x","tile","string_or_numeric");H(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" "+("must match length of reps "+e+".")});var n={x:t},a={reps:e};return ne.runKernel(t1,n,a)}var ih=X({tile_:sde}),ude={kernelName:JP,inputsToSave:["x","mean","variance","scale"],gradFunc:function(r,e,t){var n=t.varianceEpsilon,a=me(e,4),i=a[0],o=a[1],s=a[2],u=a[3],l=u??wt(1),c=sn(o.shape,i.shape),f=[];if(o.rank===1){for(var h=0;h<i.shape.length-1;++h)f.push(i.shape[h]);f.push(1)}var p=lt(i,o),d=de(r,l),m=ode(et(s,wt(n))),v=de(de(de(m,m),m),wt(-.5)),g=function(){return o.rank===1?ve(de(de(r,ih(ve(m,[1,1,1,o.shape[0]]),f)),l),i.shape):ve(de(de(r,m),l),i.shape)},y=function(){var k=de(de(m,wt(-1)),d);return o.rank===1&&(k=ht(k,c)),ve(k,o.shape)},b=function(){var k=de(de(v,p),d);return o.rank===1&&(k=ht(k,c)),ve(k,o.shape)},w=function(){var k=de(p,m),N=de(r,k);return o.rank===1&&(N=ht(N,c)),ve(N,o.shape)},x=function(){var k=r;return o.rank===1&&(k=ht(k,c)),ve(k,o.shape)};return{x:g,mean:y,variance:b,scale:w,offset:x}}};function lde(r,e,t){var n=$(r,"x","unsortedSegmentSum"),a=$(e,"segmentIds","unsortedSegmentSum","int32");H(sh(t),function(){return"numSegments must be of dtype int"});var i={x:n,segmentIds:a},o={numSegments:t};return ne.runKernel(QM,i,o)}var cde=X({unsortedSegmentSum_:lde}),fde={kernelName:QP,inputsToSave:["x","indices"],gradFunc:function(r,e,t){var n=me(e,2),a=n[0],i=n[1],o=t.axis,s=Ci(o,a.shape)[0],u=function(){var l=a.shape,c=i.size,f=l.slice(0,s),h=f.length,p=l.slice(o,l.length).slice(1),d=p.length,m=EO(0,h),v=EO(h+1,h+1+d),g=TO([f,[c],p]),y=ve(r,g),b=ve(i,[c]),w=TO([[h],m,v]),x=wo(y,w),k=cde(x,b,a.shape[s]),N=d1(w);return k=wo(k,N),k};return{x:u,indices:function(){return i}}}};function EO(r,e){for(var t=[],n=r;n<e;++n)t.push(n);return t}function TO(r){for(var e=[],t=0;t<r.length;++t)for(var n=0;n<r[t].length;++n)e.push(r[t][n]);return e}var hde={kernelName:eM,inputsToSave:["a","b"],gradFunc:function(r,e){var t=me(e,2),n=t[0],a=t[1];return{a:function(){return Mt(n)},b:function(){return Mt(a)}}}};var pde={kernelName:e1,gradFunc:function(r){return{x:function(){return rt(r,"float32")}}}};var dde={kernelName:tM,gradFunc:function(r){return{x:function(){return Mt(r)}}}};var vde={kernelName:rM,gradFunc:function(r){return{x:function(){return Mt(r)}}}};var mde={kernelName:nM,gradFunc:function(r){return{x:function(){return Mt(r)}}}};function gde(r,e){var t,n=$(r,"a","greater","string_or_numeric"),a=$(e,"b","greater","string_or_numeric");t=me(Pr(n,a),2),n=t[0],a=t[1],Jt(n.shape,a.shape);var i={a:n,b:a};return ne.runKernel(Yce,i)}var ds=X({greater_:gde}),yde={kernelName:aM,inputsToSave:["x"],gradFunc:function(r,e,t){var n=me(e,1),a=n[0],i=t.alpha,o=ds(a,0);return{x:function(){return Qa(o,r,de(r,i))}}}},bde={kernelName:oM,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){return bt(r,et(n,1))}}}},wde={kernelName:iM,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){return bt(r,rt(n,"float32"))}}}},xde={kernelName:afe,inputsToSave:[],outputsToSave:[!0],gradFunc:function(r,e,t){var n=me(e,1),a=n[0],i=t.axis;return{logits:function(){var o=!0,s=Ji(a);return lt(r,de(ht(r,i,o),s))}}}};function kde(r,e,t,n,a,i,o){n===void 0&&(n=5),a===void 0&&(a=1),i===void 0&&(i=1),o===void 0&&(o=.5);var s={x:r,y:e,dy:t},u={depthRadius:n,bias:a,alpha:i,beta:o};return ne.runKernel(ife,s,u)}var Sde=X({localResponseNormalizationBackprop_:kde}),Nde={kernelName:sM,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=me(e,2),a=n[0],i=n[1],o=t.depthRadius,s=t.bias,u=t.alpha,l=t.beta;return{x:function(){return Sde(a,i,r,o,s,u,l)}}}};function Ede(r,e){var t,n=$(r,"a","equal","string_or_numeric"),a=$(e,"b","equal","string_or_numeric");t=me(Pr(n,a),2),n=t[0],a=t[1],Jt(n.shape,a.shape);var i={a:n,b:a};return ne.runKernel(Uce,i)}var N4=X({equal_:Ede});function E4(r,e,t,n){return e.rank<t.rank&&(e=ve(e,Gl(e.shape,n))),r.rank<t.rank&&(r=ve(r,Gl(r.shape,n))),{x:function(){var a=de(r,rt(N4(t,e),r.dtype));return a}}}var IO={kernelName:uM,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=t,a=n.reductionIndices,i=e[0],o=e[1],s=Ci(a,i.shape),u=E4(r,o,i,s);return{x:function(){return u.x()}}}};function Tde(r,e){var t,n=$(r,"a","less","string_or_numeric"),a=$(e,"b","less","string_or_numeric");t=me(Pr(n,a),2),n=t[0],a=t[1],Jt(n.shape,a.shape);var i={a:n,b:a};return ne.runKernel(Qce,i)}var Ide=X({less_:Tde}),Cde={kernelName:lM,inputsToSave:["a","b"],gradFunc:function(r,e){var t=me(e,2),n=t[0],a=t[1],i=function(){return de(r,rt(im(n,a),"float32"))},o=function(){return de(r,rt(Ide(n,a),"float32"))};return{a:i,b:o}}};function Ade(r,e,t,n,a,i,o){var s=$(r,"dy","maxPool3dGrad"),u=$(e,"input","maxPool3dGrad"),l=$(t,"output","maxPool3dGrad"),c=s,f=u,h=l,p=!1;u.rank===4&&(p=!0,c=ve(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),f=ve(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=ve(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),H(c.rank===5,function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank "+(c.rank+".")}),H(f.rank===5,function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank "+(f.rank+".")}),H(h.rank===5,function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank "+(h.rank+".")}),Ln("maxPool3dGrad",i,o);var d={dy:c,input:f,output:h},m={filterSize:n,strides:a,pad:i,dimRoundingMode:o},v=ne.runKernel(sfe,d,m);return p?ve(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}var _de=X({maxPool3dGrad_:Ade}),Dde={kernelName:fM,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=me(e,2),a=n[0],i=n[1],o=t.filterSize,s=t.strides,u=t.pad,l=t.dimRoundingMode;return{x:function(){return _de(r,a,i,o,s,u,l)}}}};function Fde(r,e,t,n,a,i,o){var s=$(r,"dy","maxPoolGrad"),u=$(e,"input","maxPoolGrad"),l=$(t,"output","maxPoolGrad");H(u.rank===s.rank,function(){return"Rank of input ("+u.rank+") does not match rank of dy "+("("+s.rank+")")}),H(s.rank===4,function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank "+(s.rank+".")}),H(u.rank===4,function(){return"Error in maxPoolGrad: input must be rank 4 but got rank "+(u.rank+".")}),Ln("maxPoolGrad",i,o);var c={dy:s,input:u,output:l},f={filterSize:n,strides:a,pad:i,dimRoundingMode:o};return ne.runKernel(ofe,c,f)}var Rde=X({maxPoolGrad_:Fde}),Ode={kernelName:cM,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=me(e,2),a=n[0],i=n[1],o=t.filterSize,s=t.strides,u=t.pad;return{x:function(){return Rde(r,a,i,o,s,u)}}}};function Hl(r,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Hl(r,"float32"),n=Hl(r,"float32");return Ul(t,n)}var a=o1(oa(r),e);return ne.makeTensor(a,r,e)}function Sh(r,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Sh(r,"float32"),n=Hl(r,"float32");return Ul(t,n)}var a=n4(oa(r),e);return ne.makeTensor(a,r,e)}var Pde={kernelName:hM,inputsToSave:["x"],gradFunc:function(r,e,t){var n=me(e,1),a=n[0],i=t.axis,o=Ci(i,a.shape),s=Lpe(a.shape,o),u=s[1],l=oa(u),c=function(){var f=a.shape.slice();o.forEach(function(d){f[d]=1});var h=ve(r,f),p=bt(de(h,Sh(a.shape,"float32")),l);return p};return{x:c}}},Mde={kernelName:pM,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=t,a=n.axis,i=me(e,2),o=i[0],s=i[1],u=Ci(a,o.shape),l=E4(r,s,o,u);return{x:function(){return l.x()}}}},Bde={kernelName:dM,inputsToSave:["a","b"],gradFunc:function(r,e){var t=me(e,2),n=t[0],a=t[1],i=function(){return de(r,rt(kh(n,a),"float32"))},o=function(){return de(r,rt(ds(n,a),"float32"))};return{a:i,b:o}}};function Lde(r,e,t){var n=$(r,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");var a={x:n},i={begin:e,size:t};return ne.runKernel(BM,a,i)}var Vt=X({slice_:Lde});var zde={kernelName:vM,inputsToSave:["x"],gradFunc:function(r,e,t){var n=e[0],a=t.paddings,i=a.map(function(o){return o[0]});return{x:function(){return Vt(r,i,n.shape)}}}};function $de(r){var e=$(r,"x","floor","float32"),t={x:e};return ne.runKernel(YP,t)}var T4=X({floor_:$de}),Wde={kernelName:mM,inputsToSave:["a","b"],gradFunc:function(r,e){var t=me(e,2),n=t[0],a=t[1],i=Jt(n.shape,a.shape),o=function(){var u=sn(n.shape,i);return u.length>0?ve(ht(r,u),n.shape):r},s=function(){var u=de(r,on(T4(bt(n,a)))),l=sn(a.shape,i);return l.length>0?ve(ht(u,l),a.shape):u};return{a:o,b:s}}},qde={kernelName:gM,inputsToSave:["a","b"],gradFunc:function(r,e){var t=me(e,2),n=t[0],a=t[1],i=Jt(n.shape,a.shape),o=function(){var u=de(r,rt(a,"float32")),l=sn(n.shape,i);return l.length>0?ve(ht(u,l),n.shape):u},s=function(){var u=de(r,rt(n,"float32")),l=sn(a.shape,i);return l.length>0?ve(ht(u,l),a.shape):u};return{a:o,b:s}}};var Vde={kernelName:yM,gradFunc:function(r){return{x:function(){return on(r)}}}};var Gde={kernelName:wM,inputsToSave:["indices"],gradFunc:function(r,e){var t=e[0];return{indices:function(){return Hl(t.shape,"float32")}}}};var Ude={kernelName:bM,gradFunc:function(r){return{x:function(){return Mt(r)}}}};function Hde(r,e){e===void 0&&(e=0);var t=$(r,"x","unstack","string_or_numeric");H(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"});var n={value:t},a={axis:e};return ne.runKernel(JM,n,a)}var m1=X({unstack_:Hde});var Kde={kernelName:xM,saveAllInputs:!0,gradFunc:function(r,e,t){var n=t.axis,a=m1(r,n);return a.map(function(i){return function(){return i}})}};var CO={kernelName:kM,inputsToSave:["x"],gradFunc:function(r,e,t){var n=e[0],a=t.paddings,i=a.map(function(o){return o[0]});return{x:function(){return Vt(r,i,n.shape)}}}};function jde(r){var e=$(r,"x","log","float32"),t={x:e};return ne.runKernel(iM,t)}var ch=X({log_:jde});function Xde(r,e){var t,n=$(r,"base","pow"),a=$(e,"exp","pow");t=me(Pr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ne.runKernel(SM,i)}var Kl=X({pow_:Xde}),Yde={kernelName:SM,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(r,e){var t=me(e,3),n=t[0],a=t[1],i=t[2],o=n,s=a,u=Jt(o.shape,s.shape),l=function(){var f=rt(s,"float32"),h=de(r,de(f,Kl(o,lt(f,wt(1))))),p=sn(o.shape,u);return p.length>0&&(h=ht(h,p)),ve(h,o.shape)},c=function(){var f=ds(o,0),h=Qa(f,ch(o),Mt(o)),p=de(r,de(i,h)),d=sn(s.shape,u);return d.length>0&&(p=ht(p,d)),ve(p,s.shape)};return{a:l,b:c}}},Zde={kernelName:NM,inputsToSave:["x","alpha"],gradFunc:function(r,e){var t=me(e,2),n=t[0],a=t[1],i=ds(n,0);return{x:function(){return Qa(i,r,de(r,a))},alpha:function(){var o=Qa(i,Mt(r),de(r,n)),s=sn(a.shape,r.shape);return s.length>0&&(o=ht(o,s)),ve(o,a.shape)}}}};function Jde(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var la=Wr();la.registerFlag("DEBUG",function(){return!1},function(r){r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});la.registerFlag("IS_BROWSER",function(){return Jde()});la.registerFlag("IS_NODE",function(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"});la.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)});la.registerFlag("PROD",function(){return!1});la.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return la.getBool("DEBUG")});la.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0});la.registerFlag("IS_TEST",function(){return!1});la.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",function(){return!0});la.registerFlag("WRAP_TO_IMAGEBITMAP",function(){return!1});la.registerFlag("ENGINE_COMPILE_ONLY",function(){return!1});la.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",function(){return!1});la.registerFlag("USE_SETTIMEOUTCUSTOM",function(){return!1});function Qde(r,e,t){var n=wh(r,t);return xh(r,e,n,t)}var g1=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function AO(r){return g1?Buffer.byteLength(r):new Blob([r]).size}function eve(r){if(g1)return Buffer.from(r).toString("base64");for(var e=new Uint8Array(r),t="",n=0,a=e.length;n<a;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function tve(r){if(g1){var e=Buffer.from(r,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var t=atob(r),n=new Uint8Array(t.length),a=0;a<t.length;++a)n.set([t.charCodeAt(a)],a);return n.buffer}function rve(r){if(r.length===1)return r[0];var e=0;r.forEach(function(a){e+=a.byteLength});var t=new Uint8Array(e),n=0;return r.forEach(function(a){t.set(new Uint8Array(a),n),n+=a.byteLength}),t.buffer}function I4(r,e){var t={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy,weightsManifest:e};return r.signature!=null&&(t.signature=r.signature),r.userDefinedMetadata!=null&&(t.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(t.modelInitializer=r.modelInitializer),r.trainingConfig!=null&&(t.trainingConfig=r.trainingConfig),t}function nve(r,e,t){var n={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy};if(r.trainingConfig!=null&&(n.trainingConfig=r.trainingConfig),r.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");n.weightSpecs=e,n.weightData=t}return r.signature!=null&&(n.signature=r.signature),r.userDefinedMetadata!=null&&(n.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(n.modelInitializer=r.modelInitializer),n}function ave(r,e){return Ce(this,void 0,void 0,function(){var t,n,a;return Ie(this,function(i){switch(i.label){case 0:return r.weightsManifest==null?[3,2]:[4,e(r.weightsManifest)];case 1:a=me.apply(void 0,[i.sent(),2]),t=a[0],n=a[1],i.label=2;case 2:return[2,nve(r,t,n)]}})})}function sm(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:AO(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:AO(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:r.weightData.byteLength}}function ive(r){var e,t,n=[];try{for(var a=be(r),i=a.next();!i.done;i=a.next()){var o=i.value;n.push.apply(n,mt(o.weights))}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}var mu=function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerSaveRouter=function(e){r.getInstance().saveRouters.push(e)},r.registerLoadRouter=function(e){r.getInstance().loadRouters.push(e)},r.getSaveHandlers=function(e){return r.getHandlers(e,"save")},r.getLoadHandlers=function(e,t){return r.getHandlers(e,"load",t)},r.getHandlers=function(e,t,n){var a=[],i=t==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters;return i.forEach(function(o){var s=o(e,n);s!==null&&a.push(s)}),a},r}(),ove="tensorflowjs",sve=1,th="models_store",Ev="model_info_store";function uve(){if(!Wr().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=typeof window>"u"?self:window,e=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function lve(r){var e=r.result;e.createObjectStore(th,{keyPath:"modelPath"}),e.createObjectStore(Ev,{keyPath:"modelPath"})}var Lv=function(){function r(e){if(this.indexedDB=uve(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return r.prototype.save=function(e){return Ce(this,void 0,void 0,function(){return Ie(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},r.prototype.load=function(){return Ce(this,void 0,void 0,function(){return Ie(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},r.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(a,i){var o=n.indexedDB.open(ove,sve);o.onupgradeneeded=function(){return lve(o)},o.onsuccess=function(){var s=o.result;if(t==null){var u=s.transaction(th,"readonly"),l=u.objectStore(th),c=l.get(n.modelPath);c.onsuccess=function(){if(c.result==null)return s.close(),i(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));a(c.result.modelArtifacts)},c.onerror=function(v){return s.close(),i(c.error)},u.oncomplete=function(){return s.close()}}else{var f=sm(t),h=s.transaction(Ev,"readwrite"),p=h.objectStore(Ev),d=p.put({modelPath:n.modelPath,modelArtifactsInfo:f}),m;d.onsuccess=function(){m=s.transaction(th,"readwrite");var v=m.objectStore(th),g=v.put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:f});g.onsuccess=function(){return a({modelArtifactsInfo:f})},g.onerror=function(y){p=h.objectStore(Ev);var b=p.delete(n.modelPath);b.onsuccess=function(){return s.close(),i(g.error)},b.onerror=function(w){return s.close(),i(g.error)}}},d.onerror=function(v){return s.close(),i(d.error)},h.oncomplete=function(){m==null?s.close():m.oncomplete=function(){return s.close()}}}},o.onerror=function(s){return i(o.error)}})},r}();Lv.URL_SCHEME="indexeddb://";var C4=function(r){return Wr().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Lv.URL_SCHEME)?cve(r.slice(Lv.URL_SCHEME.length)):null};mu.registerSaveRouter(C4);mu.registerLoadRouter(C4);function cve(r){return new Lv(r)}var jf="/",Xf="tensorflowjs_models",fve="info",hve="model_topology",pve="weight_specs",dve="weight_data",vve="model_metadata";function mve(r){return{info:[Xf,r,fve].join(jf),topology:[Xf,r,hve].join(jf),weightSpecs:[Xf,r,pve].join(jf),weightData:[Xf,r,dve].join(jf),modelMetadata:[Xf,r,vve].join(jf)}}function gve(r){var e,t;try{for(var n=be(Object.values(r)),a=n.next();!a.done;a=n.next()){var i=a.value;window.localStorage.removeItem(i)}}catch(o){e={error:o}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}}var zv=function(){function r(e){if(!Wr().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=mve(this.modelPath)}return r.prototype.save=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i;return Ie(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),a=sm(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,eve(e.weightData)),i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),[2,{modelArtifactsInfo:a}]}catch{throw gve(this.keys),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: "+("modelTopologyBytes="+a.modelTopologyBytes+", ")+("weightSpecsBytes="+a.weightSpecsBytes+", ")+("weightDataBytes="+a.weightDataBytes+"."))}return[2]})})},r.prototype.load=function(){return Ce(this,void 0,void 0,function(){var e,t,n,a,i,o,s;return Ie(this,function(u){if(e=JSON.parse(this.LS.getItem(this.keys.info)),e==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},n=JSON.parse(this.LS.getItem(this.keys.topology)),n==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)),a==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=a,i=this.LS.getItem(this.keys.modelMetadata),i!=null&&(o=JSON.parse(i),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,o.signature!=null&&(t.signature=o.signature),o.userDefinedMetadata!=null&&(t.userDefinedMetadata=o.userDefinedMetadata),o.modelInitializer!=null&&(t.modelInitializer=o.modelInitializer),o.trainingConfig!=null&&(t.trainingConfig=o.trainingConfig)),s=this.LS.getItem(this.keys.weightData),s==null)throw new Error("In local storage, the binary weight values of model "+("'"+this.modelPath+"' are missing."));return t.weightData=tve(s),[2,t]})})},r}();zv.URL_SCHEME="localstorage://";var A4=function(r){return Wr().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(zv.URL_SCHEME)?yve(r.slice(zv.URL_SCHEME.length)):null};mu.registerSaveRouter(A4);mu.registerLoadRouter(A4);function yve(r){return new zv(r)}var bve="model",wve=".json",xve=".weights.bin";function _O(r){return new Promise(function(e){return setTimeout(e)}).then(r)}var $v=function(){function r(e){if(!Wr().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(r.URL_SCHEME)&&(e=e.slice(r.URL_SCHEME.length)),(e==null||e.length===0)&&(e=bve),this.modelJsonFileName=e+wve,this.weightDataFileName=e+xve}return r.prototype.save=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s;return Ie(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],a=I4(e,n),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),o=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor,o.download=this.modelJsonFileName,o.href=i,[4,_O(function(){return o.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),e.weightData==null?[3,4]:(s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor,s.download=this.weightDataFileName,s.href=t,[4,_O(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:sm(e)}]}})})},r}();$v.URL_SCHEME="downloads://";var kve=function(r){return Wr().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith($v.URL_SCHEME)?Sve(r.slice($v.URL_SCHEME.length)):null};mu.registerSaveRouter(kve);function Sve(r){return r===void 0&&(r="model"),new $v(r)}function DO(r,e,t,n){o(r),t=t??0,n=n??1,s(t,n);var a=0,i=function(u){return u.then(function(l){var c=t+ ++a/r.length*(n-t);return e(c),l}),u};function o(u){H(u!=null&&Array.isArray(u)&&u.length>0,function(){return"promises must be a none empty array"})}function s(u,l){H(u>=0&&u<=1,function(){return"Progress fraction must be in range [0, 1], but "+("got startFraction "+u)}),H(l>=0&&l<=1,function(){return"Progress fraction must be in range [0, 1], but "+("got endFraction "+l)}),H(l>=u,function(){return"startFraction must be no more than endFraction, but "+("got startFraction "+u+" and endFraction ")+(""+l)})}return Promise.all(r.map(i))}function Nve(r,e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c,f,h;return Ie(this,function(p){switch(p.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?Wr().platform.fetch:e.fetchFunc,n=r.map(function(d){return t(d,e.requestInit,{isBinary:!0})}),a=0,i=.5,e.onProgress!=null?[3,2]:[4,Promise.all(n)];case 1:return s=p.sent(),[3,4];case 2:return[4,DO(n,e.onProgress,a,i)];case 3:s=p.sent(),p.label=4;case 4:return o=s,u=o.map(function(d){return d.arrayBuffer()}),l=.5,c=1,e.onProgress!=null?[3,6]:[4,Promise.all(u)];case 5:return h=p.sent(),[3,8];case 6:return[4,DO(u,e.onProgress,l,c)];case 7:h=p.sent(),p.label=8;case 8:return f=h,[2,f]}})})}var Eve="application/octet-stream",Tve="application/json",y1=function(){function r(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(H(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=Wr().platform.fetch,H(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&H(e.length===2,function(){return"URL paths for http must have a length of 2, "+("(actual length is "+e.length+").")}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return r.prototype.save=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i;return Ie(this,function(o){switch(o.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit),t.body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=I4(e,n),t.body.append("model.json",new Blob([JSON.stringify(a)],{type:Tve}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:Eve}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if(i=o.sent(),i.ok)return[2,{modelArtifactsInfo:sm(e),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+(i.status+"."))}})})},r.prototype.load=function(){return Ce(this,void 0,void 0,function(){var e,t,n,a,i,o=this;return Ie(this,function(s){switch(s.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(e=s.sent(),!e.ok)throw new Error("Request to "+this.path+" failed with status code "+(e.status+". Please verify this URL points to ")+"the model JSON of the model to load.");s.label=2;case 2:return s.trys.push([2,4,,5]),[4,e.json()];case 3:return t=s.sent(),[3,5];case 4:throw s.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(a=t.modelTopology,i=t.weightsManifest,a==null&&i==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return[2,ave(t,function(u){return o.loadWeights(u)})]}})})},r.prototype.loadWeights=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c,f,h,p,d,m,v,g,y,b,w,x,k,N;return Ie(this,function(T){switch(T.label){case 0:t=Array.isArray(this.path)?this.path[1]:this.path,n=me(Ive(t),2),a=n[0],i=n[1],o=this.weightPathPrefix||a,s=ive(e),u=[],l=[];try{for(c=be(e),f=c.next();!f.done;f=c.next()){h=f.value;try{for(p=(k=void 0,be(h.paths)),d=p.next();!d.done;d=p.next())m=d.value,this.weightUrlConverter!=null?l.push(this.weightUrlConverter(m)):u.push(o+m+i)}catch(I){k={error:I}}finally{try{d&&!d.done&&(N=p.return)&&N.call(p)}finally{if(k)throw k.error}}}}catch(I){w={error:I}}finally{try{f&&!f.done&&(x=c.return)&&x.call(c)}finally{if(w)throw w.error}}return this.weightUrlConverter?(g=(v=u.push).apply,y=[u],[4,Promise.all(l)]):[3,2];case 1:g.apply(v,y.concat([mt.apply(void 0,[T.sent()])])),T.label=2;case 2:return[4,Nve(u,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 3:return b=T.sent(),[2,[s,rve(b)]]}})})},r}();y1.URL_SCHEME_REGEX=/^https?:\/\//;function Ive(r){var e=r.lastIndexOf("/"),t=r.lastIndexOf("?"),n=r.substring(0,e),a=t>e?r.substring(t):"";return[n+"/",a]}function FO(r){return r.match(y1.URL_SCHEME_REGEX)!=null}var _4=function(r,e){if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;var t=!0;return Array.isArray(r)?t=r.every(function(n){return FO(n)}):t=FO(r),t?Cve(r,e):null};mu.registerSaveRouter(_4);mu.registerLoadRouter(_4);function Cve(r,e){return new y1(r,e)}function Ave(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n=0),a===void 0&&(a="int32"),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=$(r,"indices","oneHot","int32"),o={indices:i},s={dtype:a,depth:e,onValue:t,offValue:n};return ne.runKernel(wM,o,s)}var RO=X({oneHot_:Ave});function _ve(r,e,t){var n=$(r,"labels","confusionMatrix"),a=$(e,"predictions","confusionMatrix");H(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, "+("but got "+t)}),H(n.rank===1,function(){return"Expected the rank of labels to be 1, but got "+n.rank}),H(a.rank===1,function(){return"Expected the rank of predictions to be 1, "+("but got "+a.rank)}),H(n.shape[0]===a.shape[0],function(){return"Mismatch in the number of examples: "+(n.shape[0]+" vs. "+a.shape[0]+". ")+"Labels and predictions should have the same number of elements."}),H(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+(""+t)});var i=RO(rt(n,"int32"),t),o=RO(rt(a,"int32"),t),s=wo(i),u=Pt(s,o);return rt(u,"int32")}X({confusionMatrix_:_ve});function Dve(r,e,t){if(r1(r),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var n=wh(r,t);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return xh(r,e,n,t)}var iu;function Fve(r,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(r==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,n=!1,a=!1,i=!1,o=!1,s=!1;if(r.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&r instanceof ImageData)n=!0;else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)a=!0;else if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)i=!0;else if(r.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&r instanceof ImageBitmap)s=!0;else throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, "+("but was "+r.constructor.name));var u=Ib(oO,ne.backendName);if(u!=null){var l={pixels:r},c={numChannels:e};return ne.runKernel(oO,l,c)}var f=me(a?[r.videoWidth,r.videoHeight]:[r.width,r.height],2),h=f[0],p=f[1],d;if(o)d=r.getContext("2d").getImageData(0,0,h,p).data;else if(n||t)d=r.data;else if(i||a||s){if(iu==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")iu=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else iu=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});iu.canvas.width=h,iu.canvas.height=p,iu.drawImage(r,0,0,h,p),d=iu.getImageData(0,0,h,p).data}var m;if(e===4)m=new Int32Array(d);else{var v=h*p;m=new Int32Array(v*e);for(var g=0;g<v;g++)for(var y=0;y<e;++y)m[g*e+y]=d[g*4+y]}var b=[p,h,e];return Dve(m,b,"int32")}X({fromPixels_:Fve});function Rve(r,e,t){var n=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+("shape[sliceDim:], got updates.shape: "+t.shape)+(", indices.shape: "+e.shape+", shape: "+r)+(", sliceDim: "+n+", and batchDim: "+a+".");if(t.rank<a)throw new Error(i+(" update.rank < "+a+". "));if(r.length<n+(t.rank-a))throw new Error(i+(" Output shape length < "+(n+(t.rank-a))));if(t.rank!==a+r.length-n)throw new Error(i+(" update.rank != "+(a+r.length-n)));for(var o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+(" updates.shape["+o+"] ("+t.shape[o]+") != indices.shape["+o+"] ("+e.shape[o]+")."));for(var o=0;o<t.rank-a;++o)if(t.shape[o+a]!==r[o+n])throw new Error(i+(" updates.shape["+(o+a)+"] ("+t.shape[o+a]+") != shape["+(o+a)+"] ("+r[o+a]+")"))}function Ove(r,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+(" but the rank was "+e.rank+"."));if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+(" but the rank was "+r.rank+"."));if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(r.size===0)throw new Error("Updates specified for empty output. updates shape: "+r.shape)}Rve(t,e,r)}function Pve(r,e,t){var n,a=r.shape.length;typeof e=="number"?n=mt([e],new Array(a-1).fill(0)):e.length<a?n=e.concat(new Array(a-e.length).fill(0)):n=e.slice(),n.forEach(function(o){H(o!==-1,function(){return"slice() does not support negative begin indexing."})});var i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=mt([t],new Array(a-1).fill(-1)):t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map(function(o,s){return o>=0?o:(H(o===-1,function(){return"Negative size values should be exactly -1 but got "+(o+" for the slice() size at index "+s+".")}),r.shape[s]-n[s])}),[n,i]}var Mve=function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(e,t){return new e(t)},r}(),Bve=function(){function r(){this.classNameMap={}}return r.getMap=function(){return r.instance==null&&(r.instance=new r),r.instance},r.register=function(e){r.getMap().classNameMap[e.className]=[e,e.fromConfig]},r}();function gu(r){H(r.className!=null,function(){return"Class being registered does not have the static className property defined."}),H(typeof r.className=="string",function(){return"className is required to be a string, but got type "+typeof r.className}),H(r.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),Bve.register(r)}function Lve(r){var e=$(r,"x","abs");if(e.dtype==="complex64"){var t={x:e};return ne.runKernel(OP,t)}else{var t={x:e};return ne.runKernel(gP,t)}}var Xa=X({abs_:Lve});function zve(r){var e=$(r,"x","acos"),t={x:e};return ne.runKernel(yP,t)}X({acos_:zve});function $ve(r){var e=$(r,"x","acosh"),t={x:e};return ne.runKernel(bP,t)}X({acosh_:$ve});function Wve(r){H(Array.isArray(r),function(){return"The argument passed to tf.addN() must be a list of tensors"}),H(r.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+(""+r.length)});var e=r.map(function(a,i){return $(a,"tensors"+i,"addN")}),t=e[0];e.forEach(function(a){if(a.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(a){if(!Yl(a.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var n=e;return ne.runKernel(wP,n)}X({addN_:Wve});function qve(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=$(r,"x","all","bool"),a={x:n},i={axis:e,keepDims:t};return ne.runKernel(Sce,a,i)}X({all_:qve});function Vve(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=$(r,"x","any","bool"),a={x:n},i={axis:e,keepDims:t};return ne.runKernel(Nce,a,i)}X({any_:Vve});function Gve(r,e){e===void 0&&(e=0);var t=$(r,"x","argMax"),n={x:t},a={axis:e};return ne.runKernel(xP,n,a)}X({argMax_:Gve});function Uve(r,e){e===void 0&&(e=0);var t=$(r,"x","argMin"),n={x:t},a={axis:e};return ne.runKernel(kP,n,a)}X({argMin_:Uve});function Hve(r){var e=$(r,"x","asin"),t={x:e};return ne.runKernel(SP,t)}X({asin_:Hve});function Kve(r){var e=$(r,"x","asinh"),t={x:e};return ne.runKernel(NP,t)}X({asinh_:Kve});function jve(r){var e=$(r,"x","atan"),t={x:e};return ne.runKernel(EP,t)}X({atan_:jve});function Xve(r,e){var t,n=$(r,"a","atan2"),a=$(e,"b","atan2");t=me(Pr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ne.runKernel(IP,i)}X({atan2_:Xve});function Yve(r){var e=$(r,"x","atanh"),t={x:e};return ne.runKernel(TP,t)}X({atanh_:Yve});function Zve(r,e,t,n,a){var i=$(r,"x","avgPool","float32"),o=1;H(ko(t,o),function(){return"Error in avgPool: Either strides or dilations must be 1. "+("Got strides "+t+" and dilations '"+o+"'")});var s=i,u=!1;i.rank===3&&(u=!0,s=ve(i,[1,i.shape[0],i.shape[1],i.shape[2]])),H(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),Ln("avgPool",n,a);var l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=ne.runKernel(CP,l,c);return f=rt(f,i.dtype),u?ve(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var Jve=X({avgPool_:Zve});function Qve(r,e,t,n,a,i){i===void 0&&(i="NDHWC");var o=$(r,"x","avgPool3d","float32"),s=o,u=!1;o.rank===4&&(u=!0,s=ve(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),H(s.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+s.rank+"."}),H(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+("but got dataFormat of "+i)}),Ln("avgPool3d",n,a);var l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=ne.runKernel(AP,l,c);return f=rt(f,s.dtype),u?ve(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}X({avgPool3d_:Qve});function eme(r,e){e===void 0&&(e=0),H(r.length>=1,function(){return"Pass at least one tensor to concat"});var t=Ov(r,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+i.dtype+". ")}),t.length===1)return ah(t[0]);var n=t,a={axis:e};return ne.runKernel(PP,n,a)}var ua=X({concat_:eme});function tme(r){var e=$(r,"x","sigmoid","float32"),t={x:e};return ne.runKernel(WM,t)}var $l=X({sigmoid_:tme});function rme(r){var e=$(r,"x","tanh","float32"),t={x:e};return ne.runKernel(ZM,t)}var OO=X({tanh_:rme});function nme(r,e,t,n,a,i){var o=$(r,"forgetBias","basicLSTMCell"),s=$(e,"lstmKernel","basicLSTMCell"),u=$(t,"lstmBias","basicLSTMCell"),l=$(n,"data","basicLSTMCell"),c=$(a,"c","basicLSTMCell"),f=$(i,"h","basicLSTMCell"),h=ua([l,f],1),p=Pt(h,s),d=et(p,u),m=d.shape[0],v=d.shape[1]/4,g=[m,v],y=Vt(d,[0,0],g),b=Vt(d,[0,v],g),w=Vt(d,[0,v*2],g),x=Vt(d,[0,v*3],g),k=et(de($l(y),OO(b)),de(c,$l(et(o,w)))),N=de(OO(k),$l(x));return[k,N]}X({basicLSTMCell_:nme});function ame(r,e,t){var n=$(r,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});H(n.rank>=1+e.length,function(){return"input rank is "+n.rank+" but should be > than blockShape.length "+e.length}),H(t.length===e.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length}),H(n.shape[0]%a===0,function(){return"input tensor batch is "+n.shape[0]+" but is not divisible by the product of "+("the elements of blockShape "+e.join(" * ")+" === "+a)});var i={x:n},o={blockShape:e,crops:t};return ne.runKernel(DP,i,o)}var D4=X({batchToSpaceND_:ame});function ime(r){var e;return r.rank===0||r.rank===1?e=ve(r,[1,1,1,r.size]):r.rank===2?e=ve(r,[1,1,r.shape[0],r.shape[1]]):r.rank===3?e=ve(r,[1,r.shape[0],r.shape[1],r.shape[2]]):e=r,e}function ome(r,e,t,n,a,i){i==null&&(i=.001);var o=$(r,"x","batchNorm"),s=$(e,"mean","batchNorm"),u=$(t,"variance","batchNorm"),l;a!=null&&(l=$(a,"scale","batchNorm"));var c;n!=null&&(c=$(n,"offset","batchNorm")),H(s.rank===u.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),H(c==null||s.rank===c.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),H(l==null||s.rank===l.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var f=ime(o),h={x:f,scale:l,offset:c,mean:s,variance:u},p={varianceEpsilon:i},d=ne.runKernel(JP,h,p);return ve(d,o.shape)}var b1=X({batchNorm_:ome});function sme(r,e,t,n,a,i){var o=$(r,"x","batchNorm"),s=$(e,"mean","batchNorm"),u=$(t,"variance","batchNorm"),l;a!=null&&(l=$(a,"scale","batchNorm"));var c;return n!=null&&(c=$(n,"offset","batchNorm")),H(o.rank===2,function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+(o.rank+".")}),H(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+("got rank "+s.rank+".")}),H(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+("but got rank "+u.rank+".")}),l!=null&&H(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+("but got rank "+l.rank+".")}),c!=null&&H(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+("but got rank "+c.rank+".")}),b1(o,s,u,c,l,i)}X({batchNorm2d_:sme});function ume(r,e,t,n,a,i){var o=$(r,"x","batchNorm"),s=$(e,"mean","batchNorm"),u=$(t,"variance","batchNorm"),l;a!=null&&(l=$(a,"scale","batchNorm"));var c;return n!=null&&(c=$(n,"offset","batchNorm")),H(o.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+(o.rank+".")}),H(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+("got rank "+s.rank+".")}),H(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+("but got rank "+u.rank+".")}),l!=null&&H(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+("but got rank "+l.rank+".")}),c!=null&&H(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+("but got rank "+c.rank+".")}),b1(o,s,u,c,l,i)}X({batchNorm3d_:ume});function lme(r,e,t,n,a,i){var o=$(r,"x","batchNorm"),s=$(e,"mean","batchNorm"),u=$(t,"variance","batchNorm"),l;a!=null&&(l=$(a,"scale","batchNorm"));var c;return n!=null&&(c=$(n,"offset","batchNorm")),H(o.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+(o.rank+".")}),H(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+("got rank "+s.rank+".")}),H(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+("but got rank "+u.rank+".")}),l!=null&&H(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+("but got rank "+l.rank+".")}),c!=null&&H(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+("but got rank "+c.rank+".")}),b1(o,s,u,c,l,i)}X({batchNorm4d_:lme});function cme(r,e,t){var n=$(r,"x","bincount"),a=$(e,"weights","bincount");H(n.dtype==="int32",function(){return"Error in bincount: input "+("dtype must be int32, but got "+n.dtype)}),H(t>=0,function(){return"size must be non-negative, but got "+t+"."}),H(a.size===n.size||a.size===0,function(){return"Error in bincount: weights must have the same size as input or"+("0-length, but got input shape: "+n.shape+", weights shape: ")+(a.shape+".")});var i={x:n,weights:a},o={size:t};return ne.runKernel(Ice,i,o)}var fme=X({bincount_:cme});function hme(r,e){var t=$(r,"s0","broadcastArgs","int32"),n=$(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error("broadcastArgs(): first input must be a vector (rank=1). "+("Has rank "+t.rank));if(n.rank!==1)throw new Error("broadcastArgs(): second input must be a vector (rank=1). "+("Has rank "+n.rank));var a={s0:t,s1:n};return ne.runKernel(Ace,a)}X({broadcastArgs_:hme});function Nh(r,e,t){return e===void 0&&(e="float32"),e=e||"float32",a4(r),new hhe(r,e,t)}function pme(r){var e=$(r,"x","ceil","float32"),t={x:e};return ne.runKernel(FP,t)}X({ceil_:pme});function um(r,e,t){var n={shape:r,value:e,dtype:t};return ne.runKernel(Kce,{},n)}function dme(r,e,t){var n=$(r,"x","clipByValue");if(H(e<=t,function(){return"Error in clip: min ("+e+") must be "+("less than or equal to max ("+t+").")}),e===t)return um(n.shape,e,n.dtype);var a={x:n},i={clipValueMin:e,clipValueMax:t};return ne.runKernel(RP,a,i)}X({clipByValue_:dme});function vme(r){return ua(r,0)}X({concat1d_:vme});function mme(r,e){return ua(r,e)}X({concat2d_:mme});function gme(r,e){return ua(r,e)}X({concat3d_:gme});function yme(r,e){return ua(r,e)}X({concat4d_:yme});function bme(r,e,t,n,a,i,o){a===void 0&&(a="NWC"),i===void 0&&(i=1);var s=$(r,"x","conv1d"),u=$(e,"filter","conv1d"),l=s,c=!1;s.rank===2&&(c=!0,l=ve(s,[1,s.shape[0],s.shape[1]])),H(l.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),H(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+(u.rank+".")}),Ln("conv1d",n,o),H(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match "+("input depth for filter "+u.shape[1]+".")}),H(ko(t,i),function(){return"Error in conv1D: Either stride or dilation must be 1. "+("Got stride "+t+" and dilation '"+i+"'")}),H(a==="NWC",function(){return"Error in conv1d: got dataFormat of "+a+" but only NWC is currently supported."});var f=ve(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=ve(l,[l.shape[0],1,l.shape[1],l.shape[2]]),p=[1,t],d=[1,i],m="NHWC",v=om(h,f,p,n,m,d,o);return c?ve(v,[v.shape[2],v.shape[3]]):ve(v,[v.shape[0],v.shape[2],v.shape[3]])}X({conv1d_:bme});function wme(r,e,t,n,a,i){var o=$(r,"x","conv2dTranspose"),s=$(e,"filter","conv2dTranspose");return p1(t,o,s,n,a,"NHWC",i)}X({conv2dTranspose_:wme});function xme(r,e,t,n,a,i){a===void 0&&(a="NDHWC"),i===void 0&&(i=[1,1,1]);var o=$(r,"x","conv3d"),s=$(e,"filter","conv3d"),u=o,l=!1;o.rank===4&&(l=!0,u=ve(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),H(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),H(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+(s.rank+".")}),H(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match "+("input depth for filter "+s.shape[3]+".")}),H(ko(t,i),function(){return"Error in conv3D: Either strides or dilations must be 1. "+("Got strides "+t+" and dilations '"+i+"'")}),H(a==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+a+" but only NDHWC is currently supported."});var c={x:u,filter:s},f={strides:t,pad:n,dataFormat:a,dilations:i},h=ne.runKernel(LP,c,f);return l?ve(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}X({conv3d_:xme});function kme(r,e,t,n,a){var i=$(r,"x","conv3dTranspose"),o=$(e,"filter","conv3dTranspose");return w4(t,i,o,n,a)}X({conv3dTranspose_:kme});function Sme(r){var e=$(r,"x","cos","float32"),t={x:e};return ne.runKernel(zP,t)}var F4=X({cos_:Sme});function Nme(r){var e=$(r,"x","cosh","float32"),t={x:e};return ne.runKernel($P,t)}var Eme=X({cosh_:Nme});function Tme(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=$(r,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:n};return ne.runKernel(Oce,i,o)}var PO=X({cumprod_:Tme});function Ime(r,e,t,n){n===void 0&&(n=!1);var a=$(r,"x","denseBincount"),i=$(e,"weights","denseBincount");H(a.dtype==="int32",function(){return"Error in denseBincount: input "+("dtype must be int32, but got "+a.dtype)}),H(a.rank<=2,function(){return"Error in denseBincount: input must be at most rank 2, but got "+("rank "+a.rank+".")}),H(t>=0,function(){return"size must be non-negative, but got "+t+"."}),H(i.size===a.size||i.size===0,function(){return"Error in denseBincount: weights must have the same shape as x or "+("0-length, but got x shape: "+a.shape+", weights shape: ")+(i.shape+".")});var o={x:a,weights:i},s={size:t,binaryOutput:n};return ne.runKernel(Mce,o,s)}X({denseBincount_:Ime});function Cme(r,e,t){t===void 0&&(t="NHWC");var n=$(r,"x","depthToSpace","float32"),a=t==="NHWC"?n.shape[1]:n.shape[2],i=t==="NHWC"?n.shape[2]:n.shape[3],o=t==="NHWC"?n.shape[3]:n.shape[1];H(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e}),H(a*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `+a+" and "+e+`  for depthToSpace with input shape
    `+n.shape}),H(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `+i+" and "+e+` for depthToSpace with input shape
        `+n.shape}),H(o%(e*e)===0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+o+" for depthToSpace with input shape "+n.shape});var s={x:n},u={blockSize:e,dataFormat:t};return ne.runKernel(Bce,s,u)}X({depthToSpace_:Cme});function Ame(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=$(r,"x","depthwiseConv2d","float32"),u=$(e,"filter","depthwiseConv2d","float32"),l=s,c=!1;s.rank===3&&(c=!0,l=ve(s,[1,s.shape[0],s.shape[1],s.shape[2]])),H(l.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+("rank "+l.rank+".")}),H(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+(u.rank+".")});var f=a==="NHWC"?l.shape[3]:l.shape[1];H(f===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels "+("("+f+") must match the inChannels dimension in ")+("filter "+u.shape[2]+".")}),Ln("depthwiseConv2d",n,o);var h={x:l,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=ne.runKernel(qP,h,p);return c?ve(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var R4=X({depthwiseConv2d_:Ame});function _me(r){var e=$(r,"x","diag"),t={x:e};return ne.runKernel($ce,t)}X({diag_:_me});function Dme(r,e,t,n,a,i){a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC");var o=$(r,"x","dilation2d"),s=$(e,"filter","dilation2d");H(o.rank===3||o.rank===4,function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+(o.rank+".")}),H(s.rank===3,function(){return"Error in dilation2d: filter must be rank 3, but got rank "+(s.rank+".")}),H(i==="NHWC",function(){return"Error in dilation2d: Only NHWC is currently supported, "+("but got dataFormat of "+i)});var u=o,l=!1;o.rank===3&&(u=ve(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=!0);var c={x:u,filter:s},f={strides:t,pad:n,dilations:a},h=ne.runKernel(VP,c,f);return l?ve(h,[h.shape[1],h.shape[2],h.shape[3]]):h}X({dilation2d_:Dme});function Fme(r,e){var t,n=$(r,"a","div"),a=$(e,"b","div");t=me(Pr(n,a),2),n=t[0],a=t[1];var i=bt(n,a),o=Mt(i),s=N4(a,o);return Qa(s,o,i)}X({divNoNan_:Fme});function Rme(r,e){var t=$(r,"t1","dot"),n=$(e,"t2","dot");H((t.rank===1||t.rank===2)&&(n.rank===1||n.rank===2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+(t.rank+" and "+n.rank+".")});var a=t.rank===1?t.size:t.shape[1],i=n.rank===1?n.size:n.shape[0];if(H(a===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+(a+" and "+i+".")}),t.rank===1&&n.rank===1){var o=ve(t,[1,-1]),s=ve(n,[-1,1]),u=Pt(o,s);return ve(u,[])}else if(t.rank===1&&n.rank===2){var o=ve(t,[1,-1]),s=ve(n,[n.shape[0],n.shape[1]]),u=Pt(o,s);return ve(u,[u.size])}else if(t.rank===2&&n.rank===1){var s=ve(n,[-1,1]),u=Pt(t,s);return ve(u,[u.size])}else{var s=ve(n,[n.shape[0],n.shape[1]]),u=Pt(t,s);return u}}X({dot_:Rme});function Ome(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var n=e.map(function(i,o){return $(i,"tensors"+o,"einsum")}),a={equation:r};return ne.runKernel(Vce,n,a)}X({einsum_:Ome});function Pme(r){var e=$(r,"x","elu","float32"),t={x:e};return ne.runKernel(UP,t)}var Mme=X({elu_:Pme});function Bme(r){var e=$(r,"x","erf");H(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=rt(e,"float32"));var t={x:e};return ne.runKernel(HP,t)}X({erf_:Bme});function Lme(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=$(r,"x","max"),a={x:n},i={reductionIndices:e,keepDims:t};return ne.runKernel(uM,a,i)}var oh=X({max_:Lme});function zme(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=$(r,"x","min"),a={x:n},i={axis:e,keepDims:t};return ne.runKernel(pM,a,i)}var MO=X({min_:zme});function $me(r,e,t,n){e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1),r=$(r,"x","norm");var a=O4(r,e,t),i=a.shape;if(n){var o=Ci(t,r.shape);i=Gl(a.shape,o)}return ve(a,i)}function O4(r,e,t){if(t===void 0&&(t=null),r.rank===0)return Xa(r);if(r.rank!==1&&t===null)return O4(ve(r,[-1]),e,t);if(r.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return ht(Xa(r),t);if(e===1/0)return oh(Xa(r),t);if(e===-1/0)return MO(Xa(r),t);if(e==="euclidean"||e===2)return _a(ht(Kl(Xa(r),wt(2,"int32")),t));throw new Error("Error in norm: invalid ord value: "+e)}if(Array.isArray(t)&&t.length===2){if(e===1)return oh(ht(Xa(r),t[0]),t[1]-1);if(e===1/0)return oh(ht(Xa(r),t[1]),t[0]);if(e===-1/0)return MO(ht(Xa(r),t[1]),t[0]);if(e==="fro"||e==="euclidean")return _a(ht(fr(r),t));throw new Error("Error in norm: invalid ord value: "+e)}throw new Error("Error in norm: invalid axis: "+t)}var w1=X({norm_:$me});function Wme(r,e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),w1(r,"euclidean",e,t)}X({euclideanNorm_:Wme});function qme(r,e){e===void 0&&(e=0);var t=$(r,"x","expandDims","string_or_numeric");H(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var n={input:t},a={dim:e};return ne.runKernel(jP,n,a)}var ou=X({expandDims_:qme});function Vme(r){var e=$(r,"x","expm1"),t={x:e};return ne.runKernel(XP,t)}X({expm1_:Vme});function Gme(r,e,t,n){n===void 0&&(n="float32"),e==null&&(e=r);for(var a=Nh([r,e],n),i=r<=e?r:e,o=0;o<i;++o)a.set(1,o,o);var s=ve(a.toTensor(),[r,e]);if(t==null)return s;if(t.length===1)return ih(ou(s,0),[t[0],1,1]);if(t.length===2)return ih(ou(ou(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return ih(ou(ou(ou(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+("batchShapes, but received "+t.length+"D."))}var Ume=X({eye_:Gme});function Hme(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=0);var a=$(r,"x","gather"),i=$(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:n};return ne.runKernel(QP,o,s)}var Kme=X({gather_:Hme});function jme(r){var e=$(r,"x","isFinite"),t={x:e};return ne.runKernel(tM,t)}X({isFinite_:jme});function Xme(r){var e=$(r,"x","isInf"),t={x:e};return ne.runKernel(rM,t)}X({isInf_:Xme});function Yme(r){var e=$(r,"x","isNaN"),t={x:e};return ne.runKernel(nM,t)}X({isNaN_:Yme});function Zme(r,e){e===void 0&&(e=.2);var t=$(r,"x","leakyRelu"),n={x:t},a={alpha:e};return ne.runKernel(aM,n,a)}var Jme=X({leakyRelu_:Zme});function Qme(r,e,t,n,a){e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),a===void 0&&(a=.5);var i=$(r,"x","localResponseNormalization");H(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+i.rank+"."}),H(sh(e),function(){return"Error in localResponseNormalization: depthRadius must be an "+("integer but got depthRadius "+e+".")});var o=i,s=!1;i.rank===3&&(s=!0,o=ve(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},l={depthRadius:e,bias:t,alpha:n,beta:a},c=ne.runKernel(sM,u,l);return s?ve(c,[c.shape[1],c.shape[2],c.shape[3]]):c}X({localResponseNormalization_:Qme});function ege(r){var e=$(r,"x","log1p"),t={x:e};return ne.runKernel(oM,t)}var tge=X({log1p_:ege});function rge(r,e){H(Eb(r),function(){return"The f passed in variableGrads(f) must be a function"}),H(e==null||Array.isArray(e)&&e.every(function(f){return f instanceof Rv}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t){e=[];for(var n in ne.registeredVariables)e.push(ne.registeredVariables[n])}var a=t?e.filter(function(f){return!f.trainable}):null,i=e.length;e=e.filter(function(f){return f.trainable}),H(e.length>0,function(){return"variableGrads() expects at least one of the input variables to "+("be trainable, but none of the "+i+" variables is ")+"trainable."});var o=!0,s=ne.gradients(r,e,null,o),u=s.value,l=s.grads;H(l.some(function(f){return f!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),H(u.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it "+("returned a rank-"+u.rank+" tensor")});var c={};return e.forEach(function(f,h){l[h]!=null&&(c[f.name]=l[h])}),a?.forEach(function(f){return c[f.name]=null}),{value:u,grads:c}}function xo(r){return ne.customGrad(r)}function nge(r){var e=$(r,"x","softplus"),t={x:e};return ne.runKernel(qM,t)}var age=X({softplus_:nge});function ige(r){var e=$(r,"x","logSigmoid"),t=xo(function(n){var a=on(age(on(n))),i=function(o){var s=de(o,$l(on(n)));return s};return{value:a,gradFunc:i}});return t(e)}X({logSigmoid_:ige});function oge(r,e){e===void 0&&(e=-1);var t=$(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+("Logits was rank "+t.rank+" and axis was "+e));var n=xo(function(a,i){var o=!0,s=oh(a,e,!0),u=lt(a,s),l=lt(rt(u,"float32"),ch(ht(Ji(u),e,o)));i([l]);var c=function(f,h){var p=me(h,1),d=p[0],m=!0,v=Ji(d);return lt(f,de(ht(f,e,m),v))};return{value:l,gradFunc:c}});return n(t)}X({logSoftmax_:oge});function sge(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=$(r,"x","logSumExp"),a=Ci(e,n.shape),i=oh(n,a,!0),o=lt(n,i),s=Ji(o),u=ht(s,a),l=ch(u),c=et(ve(i,l.shape),l);if(t){var f=Gl(c.shape,a);return ve(c,f)}return c}var uge=X({logSumExp_:sge});function lge(r){var e=$(r,"x","logicalNot","bool"),t={x:e};return ne.runKernel(rfe,t)}var P4=X({logicalNot_:lge});function cge(r,e){var t=$(r,"a","logicalOr","bool"),n=$(e,"b","logicalOr","bool");Jt(t.shape,n.shape);var a={a:t,b:n};return ne.runKernel(nfe,a)}var fge=X({logicalOr_:cge});function hge(r,e){var t=$(r,"a","logicalXor","bool"),n=$(e,"b","logicalXor","bool");return Jt(t.shape,n.shape),uh(fge(r,e),P4(uh(r,e)))}X({logicalXor_:hge});var bv=2147483648;function pge(r,e,t){t===void 0&&(t="left");var n=$(r,"sortedSequence","searchSorted"),a=$(e,"values","searchSorted"),i=n.shape[n.shape.length-1],o=a.shape[a.shape.length-1],s=ve(n,[-1,i]),u=ve(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(oa(u.shape)>=bv)throw new Error("values tensor size must less than "+bv);if(s.shape[1]>=bv)throw new Error("trailing dim_size must less than "+bv+" for int32 output type, was "+s.shape[1]);var l={sortedSequence:s,values:u},c={side:t};return ne.runKernel(xfe,l,c)}X({searchSorted_:pge});function dge(r,e,t,n,a){var i=$(r,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=ve(i,[1,i.shape[0],i.shape[1],i.shape[2]])),H(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),H(ko(t,o),function(){return"Error in maxPool: Either strides or dilations must be 1. "+("Got strides "+t+" and dilations '"+o+"'")}),Ln("maxPool",n,a);var l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=ne.runKernel(cM,l,c);return u?ve(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var vge=X({maxPool_:dge});function mge(r,e,t,n,a,i){e===void 0&&(e=[1,1,1]),i===void 0&&(i="NDHWC");var o=$(r,"x","maxPool3d"),s=o,u=!1;o.rank===4&&(u=!0,s=ve(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),H(s.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+s.rank+"."}),H(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+("but got dataFormat of "+i)}),Ln("maxPool3d",n,a);var l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=ne.runKernel(fM,l,c);return u?ve(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}X({maxPool3d_:mge});function gge(r,e,t,n,a){a===void 0&&(a=!1);var i=$(r,"x","maxPoolWithArgmax"),o={x:i},s={filterSize:e,strides:t,pad:n,includeBatchInIndex:a},u=ne.runKernel(ufe,o,s);return{result:u[0],indexes:u[1]}}X({maxPoolWithArgmax_:gge});function yge(r,e){var t,n=$(r,"a","maximum"),a=$(e,"b","maximum");t=me(Pr(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=rt(n,"int32"),a=rt(a,"int32")),Jt(n.shape,a.shape);var i={a:n,b:a};return ne.runKernel(lM,i)}var M4=X({maximum_:yge});function bge(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=$(r,"x","mean"),a={x:n},i={axis:e,keepDims:t};return ne.runKernel(hM,a,i)}var Pb=X({mean_:bge});function wge(r,e){var t,n=$(r,"a","minimum"),a=$(e,"b","minimum");t=me(Pr(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=rt(n,"int32"),a=rt(a,"int32")),Jt(n.shape,a.shape);var i={a:n,b:a};return ne.runKernel(dM,i)}var xge=X({minimum_:wge});function kge(r,e,t){H(t==="reflect"||t==="symmetric",function(){return"Invalid mode. Mode must be either reflect or symmetric. "+("Got "+t+".")});var n=$(r,"x","mirrorPad");if(n.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");H(e.length===n.rank,function(){return"Padding doesn't match input. Must be "+n.rank+". "+("Got "+e.length+".")});for(var a=t==="reflect"?1:0,i=function(l){H(e[l].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),H(e[l][0]>=0&&e[l][0]<=n.shape[l]-a&&e[l][1]>=0&&e[l][1]<=n.shape[l]-a,function(){return"Padding in dimension "+l+" cannot be greater than or equal "+("to "+(n.shape[l]-a)+" or less than 0 for input of ")+("shape "+n.shape)})},o=0;o<n.rank;o++)i(o);var s={paddings:e,mode:t},u={x:n};return ne.runKernel(vM,u,s)}X({mirrorPad_:kge});function Sge(r,e){var t,n=$(r,"a","mod"),a=$(e,"b","mod");t=me(Pr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ne.runKernel(mM,i)}X({mod_:Sge});function Nge(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1),r=$(r,"x","moments");var n=Ci(e,r.shape),a=Pb(r,n,t),i=a.shape;t||(i=Gl(a.shape,n));var o=fr(lt(rt(r,"float32"),ve(a,i))),s=Pb(o,n,t);return{mean:a,variance:s}}X({moments_:Nge});function Ege(r,e,t,n){for(var a=$(e,"data","multiRNNCell"),i=Ov(t,"c","multiRNNCell"),o=Ov(n,"h","multiRNNCell"),s=a,u=[],l=0;l<r.length;l++){var c=r[l](s,i[l],o[l]);u.push(c[0]),u.push(c[1]),s=c[1]}for(var f=[],h=[],l=0;l<u.length;l+=2)f.push(u[l]),h.push(u[l+1]);return[f,h]}X({multiRNNCell_:Ege});function Tge(r,e,t,n){n===void 0&&(n=!1);var a=$(r,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+(i+"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);t=t||Math.random();var s=o===1?ve(a,[1,-1]):a,u={logits:s},l={numSamples:e,seed:t,normalized:n},c=ne.runKernel(lfe,u,l);return o===1?ve(c,[c.size]):c}X({multinomial_:Tge});function Ige(r,e){var t,n=$(r,"a","notEqual","string_or_numeric"),a=$(e,"b","notEqual","string_or_numeric");t=me(Pr(n,a),2),n=t[0],a=t[1],Jt(n.shape,a.shape);var i={a:n,b:a};return ne.runKernel(cfe,i)}var Cge=X({notEqual_:Ige});function Age(r){var e=$(r,"x","onesLike"),t={x:e};return ne.runKernel(bM,t)}X({onesLike_:Age});function _ge(r,e){var t=$(r,"v1","outerProduct"),n=$(e,"v2","outerProduct");H(t.rank===1&&n.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+(t.rank+" and "+n.rank+".")});var a=ve(t,[-1,1]),i=ve(n,[1,-1]);return Pt(a,i)}X({outerProduct_:_ge});function Dge(r,e,t){t===void 0&&(t=0);var n=$(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:n};return ne.runKernel(kM,i,a)}var Eh=X({pad_:Dge});function Fge(r,e,t){return t===void 0&&(t=0),H(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Eh(r,[e],t)}X({pad1d_:Fge});function Rge(r,e,t){return t===void 0&&(t=0),H(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Eh(r,e,t)}X({pad2d_:Rge});function Oge(r,e,t){return t===void 0&&(t=0),H(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Eh(r,e,t)}X({pad3d_:Oge});function Pge(r,e,t){return t===void 0&&(t=0),H(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Eh(r,e,t)}X({pad4d_:Pge});function Mge(r,e,t,n,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),n===0&&(n="valid");var s=$(r,"x","maxPool"),u=s,l=!1;s.rank===3&&(l=!0,u=ve(s,[1,s.shape[0],s.shape[1],s.shape[2]])),H(ko(i,a),function(){return"Error in pool: Either strides or dilations must be 1. "+("Got strides "+i+" and dilations '"+a+"'")});var c=jhe(u.shape,e,i,a,n),f=[c.dilationHeight,c.dilationWidth],h;n==="same"?h=Lge([c.filterHeight,c.filterWidth],f):h=[[0,0],[0,0]];var p=f[0]===1&&f[1]===1,d=me(Bge([c.inHeight,c.inWidth],f,h),2),m=d[0],v=d[1],g=p?n:"valid",y=p?u:b4(u,f,m),b=t==="avg"?function(){return Jve(y,e,i,g,o)}:function(){return vge(y,e,i,g,o)},w=b(),x=p?w:D4(w,f,v);return l?ve(x,[x.shape[1],x.shape[2],x.shape[3]]):x}function Bge(r,e,t){var n=t.map(function(c){return c[0]}),a=t.map(function(c){return c[1]}),i=r.concat(n,a),o=e.map(function(c,f){return(c-i[f]%c)%c}),s=a.map(function(c,f){return c+o[f]}),u=e.map(function(c,f){return[n[f],s[f]]}),l=e.map(function(c,f){return[0,o[f]]});return[u,l]}function Lge(r,e){var t=r.map(function(o,s){return o+(o-1)*(e[s]-1)}),n=t.map(function(o){return o-1}),a=n.map(function(o){return Math.floor(o/2)}),i=n.map(function(o,s){return o-a[s]});return n.map(function(o,s){return[a[s],i[s]]})}X({pool_:Mge});function zge(r,e){var t=$(r,"x","prelu"),n=$(e,"alpha","prelu"),a={x:t,alpha:n};return ne.runKernel(NM,a)}var $ge=X({prelu_:zge});function Wge(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=$(r,"x","prod");n.dtype==="bool"&&(n=rt(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return ne.runKernel(EM,a,i)}X({prod_:Wge});function qge(r,e,t,n){var a=r.map(function(c,f){return $(c,"tensors"+f,"raggedGather","int32")}),i=$(e,"paramsDenseValues","raggedGather"),o=$(t,"indices","raggedGather","int32"),s={paramsNestedSplits:a,paramsDenseValues:i,indices:o},u={outputRaggedRank:n},l=ne.runKernel(dfe,s,u);return{outputNestedSplits:l.slice(0,l.length-1),outputDenseValues:l[l.length-1]}}X({raggedGather_:qge});function Vge(r,e,t,n,a){var i=$(r,"shape","raggedTensorToTensor","int32"),o=$(e,"values","raggedTensorToTensor"),s=$(t,"defaultValue","raggedTensorToTensor",o.dtype),u=n.map(function(f,h){return $(f,"tensors"+h,"raggedTensorToTensor","int32")}),l={shape:i,values:o,defaultValue:s,rowPartitionTensors:u},c={rowPartitionTypes:a};return ne.runKernel(vfe,l,c)}X({raggedTensorToTensor_:Vge});function Gge(r,e,t){var n=oa(r),a=null;if(t==null||t==="float32")a=new Float32Array(n);else if(t==="int32")a=new Int32Array(n);else if(t==="bool")a=new Uint8Array(n);else throw new Error("Unknown data type "+t);for(var i=0;i<n;i++)a[i]=e();return ne.makeTensor(a,r,t)}X({rand_:Gge});var yu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Uge(r){if(r.__esModule)return r;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(r).forEach(function(t){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}),e}function bu(r){var e={exports:{}};return r(e,e.exports),e.exports}var Hge=bu(function(r){(function(e,t,n){function a(u){var l=this,c=s();l.next=function(){var f=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=f-(l.c=f|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(u),l.s0<0&&(l.s0+=1),l.s1-=c(u),l.s1<0&&(l.s1+=1),l.s2-=c(u),l.s2<0&&(l.s2+=1),c=null}function i(u,l){return l.c=u.c,l.s0=u.s0,l.s1=u.s1,l.s2=u.s2,l}function o(u,l){var c=new a(u),f=l&&l.state,h=c.next;return h.int32=function(){return c.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,c),h.state=function(){return i(c,{})}),h}function s(){var u=4022871197,l=function(c){c=String(c);for(var f=0;f<c.length;f++){u+=c.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return l}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(yu,r,!1)}),Kge=bu(function(r){(function(e,t,n){function a(s){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(yu,r,!1)}),jge=bu(function(r){(function(e,t,n){function a(s){var u=this,l="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(yu,r,!1)}),Xge=bu(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var c=u.x,f=u.i,h,p;return h=c[f],h^=h>>>7,p=h^h<<24,h=c[f+1&7],p^=h^h>>>10,h=c[f+3&7],p^=h^h>>>3,h=c[f+4&7],p^=h^h<<7,h=c[f+7&7],h=h^h<<13,p^=h^h<<9,c[f]=p,u.i=f+1&7,p};function l(c,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8&&(p[7]=-1),c.x=p,c.i=0,h=256;h>0;--h)c.next()}l(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(c.x&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(yu,r,!1)}),Yge=bu(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var c=u.w,f=u.X,h=u.i,p,d;return u.w=c=c+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(c^c>>>16)|0};function l(c,f){var h,p,d,m,v,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,m=-32;m<y;++m)f&&(p^=f.charCodeAt((m+32)%f.length)),m===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(v=v+1640531527|0,h=g[m&127]^=p+v,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,m=4*128;m>0;--m)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;c.w=v,c.X=g,c.i=d}l(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(c.X&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(yu,r,!1)}),Zge=bu(function(r){(function(e,t,n){function a(s){var u=this,l="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)u.b^=l.charCodeAt(c)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(yu,r,!1)}),Jge={},Qge={__proto__:null,default:Jge},eye=Uge(Qge),wu=bu(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),l=n.pow(2,o),c=l*2,f=a-1,h;function p(w,x,k){var N=[];x=x==!0?{entropy:!0}:x||{};var T=g(v(x.entropy?[w,b(t)]:w??y(),3),N),I=new d(N),F=function(){for(var D=I.g(i),R=u,P=0;D<l;)D=(D+P)*a,R*=a,P=I.g(1);for(;D>=c;)D/=2,R/=2,P>>>=1;return(D+P)/R};return F.int32=function(){return I.g(4)|0},F.quick=function(){return I.g(4)/4294967296},F.double=F,g(b(I.S),t),(x.pass||k||function(D,R,P,B){return B&&(B.S&&m(B,I),D.state=function(){return m(I,{})}),P?(n[s]=D,R):D})(F,T,"global"in x?x.global:this==n,x.state)}function d(w){var x,k=w.length,N=this,T=0,I=N.i=N.j=0,F=N.S=[];for(k||(w=[k++]);T<a;)F[T]=T++;for(T=0;T<a;T++)F[T]=F[I=f&I+w[T%k]+(x=F[T])],F[I]=x;(N.g=function(D){for(var R,P=0,B=N.i,q=N.j,O=N.S;D--;)R=O[B=f&B+1],P=P*a+O[f&(O[B]=O[q=f&q+R])+(O[q]=R)];return N.i=B,N.j=q,P})(a)}function m(w,x){return x.i=w.i,x.j=w.j,x.S=w.S.slice(),x}function v(w,x){var k=[],N=typeof w,T;if(x&&N=="object")for(T in w)try{k.push(v(w[T],x-1))}catch{}return k.length?k:N=="string"?w:w+"\0"}function g(w,x){for(var k=w+"",N,T=0;T<k.length;)x[f&T]=f&(N^=x[f&T]*19)+k.charCodeAt(T++);return b(x)}function y(){try{var w;return h&&(w=h.randomBytes)?w=w(a):(w=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var x=e.navigator,k=x&&x.plugins;return[+new Date,e,k,e.screen,b(t)]}}function b(w){return String.fromCharCode.apply(0,w)}if(g(n.random(),t),r.exports){r.exports=p;try{h=eye}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:yu,[],Math)});wu.alea=Hge;wu.xor128=Kge;wu.xorwow=jge;wu.xorshift7=Xge;wu.xor4096=Yge;wu.tychei=Zge;var x1=wu;var k1=function(){function r(e,t,n,a,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);var o=i||Math.random();this.random=x1.alea(o.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,a=!1;!a;){var i=void 0,o=void 0,s=void 0;do i=2*this.random()-1,o=2*this.random()-1,s=i*i+o*o;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*i*u,n=this.mean+this.stdDev*o*u,(!this.truncated||this.isValidTruncated(t))&&(a=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)},r.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},r.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},r}(),tye=function(){function r(e,t,n,a){this.alpha=e,this.beta=1/t,this.dtype=n;var i=a||Math.random();this.randu=x1.alea(i.toString()),this.randn=new k1(0,1,n,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var e,t,n,a,i,o;;){do a=this.randn.nextValue(),o=1+this.c*a;while(o<=0);if(o*=o*o,e=a*a,t=1-.331*e*e,n=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<t||Math.log(i)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},r.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},r}(),rye=function(){function r(e,t,n,a){var i=this;if(e===void 0&&(e=0),t===void 0&&(t=1),this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=n,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=x1.alea(a)}return r.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r}();function nye(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t==null&&(t=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error("Unsupported data type "+n);for(var i=new tye(e,t,n,a),o=Nh(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}X({randomGamma_:nye});function aye(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),n!=null&&n==="bool")throw new Error("Unsupported data type "+n);for(var i=new k1(e,t,n,!1,a),o=Nh(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var iye=X({randomNormal_:aye});function oye(r,e,t){if(e!=null&&e==="bool")throw new Error("Unsupported data type "+e);return iye(r,0,1,e,t)}X({randomStandardNormal_:oye});function sye(r,e,t,n,a){e===void 0&&(e=0),t===void 0&&(t=1),n===void 0&&(n="float32");for(var i=Nh(r,n),o=new rye(e,t,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}var uye=X({randomUniform_:sye});function Wv(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t===0)throw new Error("Cannot have a step of zero");var a={start:r,stop:e,step:t,dtype:n};return ne.runKernel(mfe,{},a)}function lye(r){var e=$(r,"x","reciprocal"),t={x:e};return ne.runKernel(TM,t)}X({reciprocal_:lye});function cye(r){var e=$(r,"x","relu"),t={x:e};return ne.runKernel(IM,t)}var S1=X({relu_:cye});function fye(r){var e=$(r,"x","relu6"),t={x:e};return ne.runKernel(DM,t)}var hye=X({relu6_:fye});function pye(r,e){var t=$(r,"x","reverse"),n={x:t},a={dims:e};return ne.runKernel(FM,n,a)}var pu=X({reverse_:pye});function dye(r){var e=$(r,"x","reverse");return H(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),pu(e,0)}X({reverse1d_:dye});function vye(r,e){var t=$(r,"x","reverse");return H(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),pu(t,e)}X({reverse2d_:vye});function mye(r,e){var t=$(r,"x","reverse");return H(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),pu(t,e)}X({reverse3d_:mye});function gye(r,e){var t=$(r,"x","reverse");return H(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),pu(t,e)}X({reverse4d_:gye});function yye(r){var e=$(r,"x","round"),t={x:e};return ne.runKernel(RM,t)}var bye=X({round_:yye});function wye(r){var e=$(r,"x","selu"),t={x:e};return ne.runKernel(MM,t)}X({selu_:wye});function xye(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC");var s=$(r,"x","separableConv2d"),u=$(e,"depthwiseFilter","separableConv2d"),l=$(t,"pointwiseFilter","separableConv2d"),c=s,f=!1;if(s.rank===3&&(f=!0,c=ve(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");H(c.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got "+("rank "+c.rank+".")}),H(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+("got rank "+u.rank+".")}),H(l.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+("got rank "+u.rank+".")}),H(l.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter "+(" must be 1, but got "+l.shape[0]+".")}),H(l.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise "+("filter must be 1, but got "+l.shape[1]+".")});var h=u.shape[2],p=u.shape[3];H(l.shape[2]===h*p,function(){return"Error in separableConv2d: the third dimension of pointwise filter "+("must be "+h*p+", ")+("but got "+l.shape[2]+".")});var d=R4(c,u,n,a,o,i),m=1,v=om(d,l,m,"valid",o);return f?ve(v,[v.shape[1],v.shape[2],v.shape[3]]):v}X({separableConv2d_:xye});function kye(r){var e=$(r,"x","sign"),t={x:e};return ne.runKernel($M,t)}X({sign_:kye});function Sye(r,e,t){var n=$(r,"x","slice1d");return H(n.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+n.rank+" tensor"}),Vt(n,[e],[t])}X({slice1d_:Sye});function Nye(r,e,t){var n=$(r,"x","slice2d");return H(n.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+n.rank+" tensor"}),Vt(n,e,t)}X({slice2d_:Nye});function Eye(r,e,t){var n=$(r,"x","slice3d");return H(n.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+n.rank+" tensor"}),Vt(n,e,t)}X({slice3d_:Eye});function Tye(r,e,t){var n=$(r,"x","slice4d");return H(n.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+n.rank+" tensor"}),Vt(n,e,t)}X({slice4d_:Tye});function Iye(r,e){e===void 0&&(e=-1);var t=$(r,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+("Logits was rank "+t.rank+" and dim was "+e));var n={logits:t},a={dim:e};return ne.runKernel(KM,n,a)}X({softmax_:Iye});function Cye(r){H(r.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 "+("but got "+r.dtype+".")});var e={input:r};return ne.runKernel(Hce,e)}var Aye=X({fft_:Cye});function _ye(r){H(r.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 "+("but got "+r.dtype+".")});var e={input:r};return ne.runKernel(Zce,e)}var BO=X({ifft_:_ye});function Dye(r){var e=r.shape[r.shape.length-1],t=r.size/e,n;if(e<=2){var a=ve(r,[t,e]);n=BO(a)}else{var i=[t,2*(e-1)],o=ve(Bv(r),[t,e]),s=ve(v1(r),[t,e]),u=pu(Vt(o,[0,1],[t,e-2]),1),l=de(pu(Vt(s,[0,1],[t,e-2]),1),wt(-1)),c=ua([o,u],1),f=ua([s,l],1),a=ve(Ul(c,f),[i[0],i[1]]);n=BO(a)}if(n=Bv(n),r.rank===3&&r.shape[0]!==0){var h=n,p=r.shape[0];n=ve(n,[p,n.shape[0]/p,n.shape[1]]),h.dispose()}return n}X({irfft_:Dye});function Fye(r,e){H(r.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+r.dtype});var t=r.shape[r.shape.length-1],n=r.size/t,a;if(e!=null&&e<t){var i=r.shape.map(function(g){return 0}),o=r.shape.map(function(g){return g});o[r.shape.length-1]=e,a=Vt(r,i,o),t=e}else if(e!=null&&e>t){var s=r.shape.map(function(g){return g});s[r.shape.length-1]=e-t,a=ua([r,Hl(s)],r.shape.length-1),t=e}else a=r;var u=Mt(a),l=ve(Ul(a,u),[n,t]),c=Aye(l),f=Math.floor(t/2)+1,h=Bv(c),p=v1(c),d=lh(h,[f,t-f],h.shape.length-1),m=lh(p,[f,t-f],p.shape.length-1),v=a.shape.slice();return v[a.shape.length-1]=f,ve(Ul(d[0],m[0]),v)}var Rye=X({rfft_:Fye});function Oye(r,e){var t,n=$(r,"a","squaredDifference"),a=$(e,"b","squaredDifference");t=me(Pr(n,a),2),n=t[0],a=t[1],Jt(n.shape,a.shape);var i={a:n,b:a},o={};return ne.runKernel(jM,i,o)}var Pye=X({squaredDifference_:Oye});function Mye(r,e){var t=$(r,"x","squeeze","string_or_numeric");return ve(t,zfe(t.shape,e).newShape)}var Bye=X({squeeze_:Mye});function Lye(r,e){e===void 0&&(e=0);var t=Ov(r,"tensors","stack","string_or_numeric");H(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&H(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var n=t,a={axis:e};return ne.runKernel(xM,n,a)}var fh=X({stack_:Lye});function zye(r,e,t,n,a,i,o,s,u){a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),u===void 0&&(u=0);var l=$(r,"x","stridedSlice","string_or_numeric"),c={x:l},f={begin:e,end:t,strides:n,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return ne.runKernel(Cfe,c,f)}X({stridedSlice_:zye});function $ye(r){var e=$(r,"x","tan","float32"),t={x:e};return ne.runKernel(YM,t)}X({tan_:$ye});function zl(r,e){r1(r);var t=wh(r,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");var n=null;return xh(r,n,t,e)}function Tv(r,e,t){if(r1(r),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var n=wh(r,t);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return xh(r,e,n,t)}function Wye(r,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var n=$(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=n.shape[n.shape.length-1];if(e<0)throw new Error("'k' passed to topk() must be >= 0 but got "+e);if(e>a)throw new Error("'k' passed to topk() must be <= the last dimension ("+a+") "+("but got "+e));var i={x:n},o={k:e,sorted:t},s=me(ne.runKernel(Ffe,i,o),2),u=s[0],l=s[1];return{values:u,indices:l}}X({topk_:Wye});function qye(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),n!=null&&n==="bool")throw new Error("Unsupported data type $ { dtype }");for(var i=new k1(e,t,n,!0,a),o=Nh(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}X({truncatedNormal_:qye});function Vye(r,e){e===void 0&&(e=0);var t=$(r,"x","unique","string_or_numeric");H(t.rank>0,function(){return"The input tensor must be at least 1D"});var n={x:t},a={axis:e},i=me(ne.runKernel(Ofe,n,a),2),o=i[0],s=i[1];return{values:o,indices:s}}X({unique_:Vye});function Gye(r,e,t,n,a){a===void 0&&(a=!0);var i=$(r,"v","movingAverage"),o=$(e,"x","movingAverage"),s=$(t,"decay","movingAverage");ghe(i,o),H(Yl(i.shape,o.shape),function(){return"Shape mismatch in v and x"});var u=wt(1),l=lt(u,s),c=de(lt(o,i),l);if(a){H(n!=null,function(){return"When using zeroDebias: true, step is required."});var f=$(n,"step","movingAverage");c=bt(c,lt(u,Kl(s,f)))}return et(i,c)}X({movingAverage_:Gye});function Uye(r,e,t){var n=$(r,"indices","scatterND","int32"),a=$(e,"updates","scatterND");Ove(a,n,t);var i={indices:n,updates:a},o={shape:t};return ne.runKernel(wfe,i,o)}X({scatterND_:Uye});function Hye(r,e,t,n){if(r.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+(" but the dtype was "+r.dtype+"."));if(r.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+(" but got shape "+r.shape+"."));var a=r.rank>0?r.shape[0]:1,i=r.rank>1?r.shape[1]:1;if(t.length!==i)throw new Error("outputShape has incorrect number of elements:,"+(" "+t.length+", should be: "+i+"."));var o=e.size;if(!(e.rank===0||e.rank===1&&o===a))throw new Error("sparseValues has incorrect shape "+(e.shape+", should be [] or ["+a+"]"));if(e.dtype!==n.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function Kye(r,e,t,n){n===void 0&&(n=0);var a=$(r,"sparseIndices","sparseToDense","int32"),i=$(e,"sparseValues","sparseToDense","string_or_numeric"),o=$(n,"defaultValue","sparseToDense",i.dtype);Hye(a,i,t,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:t};return ne.runKernel(Tfe,s,u)}X({sparseToDense_:Kye});function jye(r,e){var t=$(e,"indices","gatherND","int32"),n=$(r,"x","gatherND","string_or_numeric"),a={params:n,indices:t};return ne.runKernel(Xce,a)}X({gatherND_:jye});function Xye(r,e){if(e==null)return r.shape.slice();if(Yl(r.shape,e))return e;if(r.shape.length===e.length){for(var t=[],n=0;n<r.shape.length;n++)e[n]==null&&r.shape[n]!=null?t.push(r.shape[n]):t.push(e[n]);return t}return e}function Yye(r,e,t,n){var a=$(r,"x","dropout");if(H(a.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be "+("scaled, but got a "+a.dtype+" tensor instead.")}),H(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),e===0)return r instanceof Aa?a.clone():a;var i=Xye(a,t),o=1-e,s=bt(T4(et(uye(i,0,1,"float32",n),o)),o);return de(a,s)}X({dropout_:Yye});function Zye(r){return Math.floor(Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))))}function B4(r,e,t){for(var n=1-r%2,a=new Float32Array(r),i=0;i<r;++i){var o=2*Math.PI*i/(r+n-1);a[i]=e-t*Math.cos(o)}return zl(a,"float32")}function N1(r,e,t){if(t==null||t==="linear")return r;if(t==="relu")return de(r,am(e));throw new Error("Cannot compute gradient for fused activation "+t+".")}function E1(r,e){var t=e,n=sn(r.shape,e.shape);return n.length>0&&(t=ht(t,n)),ve(t,r.shape)}function T1(r,e,t,n){if(e==="linear")return r;if(e==="relu")return S1(r);if(e==="elu")return Mme(r);if(e==="relu6")return hye(r);if(e==="prelu")return $ge(r,t);if(e==="leakyrelu")return Jme(r,n);if(e==="sigmoid")return $l(r);throw new Error("Unknown fused activation "+e+".")}var I1=function(r,e){var t=r>0;return!t||e==="linear"};function Jye(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,l=u===void 0?[1,1]:u,c=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,m=r.leakyreluAlpha;if(p=p||"linear",I1(ne.state.gradientDepth,p)===!1){H(s==="NHWC",function(){return"Error in fused conv2d: got dataFormat of "+s+" but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."});var v=om(t,n,a,i,s,l,c);return f!=null&&(v=et(v,f)),T1(v,p,d,m)}var g=$(t,"x","conv2d","float32"),y=$(n,"filter","conv2d","float32"),b=g,w=!1;g.rank===3&&(w=!0,b=ve(g,[1,g.shape[0],g.shape[1],g.shape[2]])),H(b.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+(b.rank+".")}),H(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+(y.rank+".")}),Ln("fused conv2d",i,c);var x=s==="NHWC"?b.shape[3]:b.shape[1];H(y.shape[2]===x,function(){return"Error in conv2d: depth of input ("+x+") must match "+("input depth for filter "+y.shape[2]+".")}),H(ko(a,l),function(){return"Error in conv2D: Either strides or dilations must be 1. "+("Got strides "+a+" and dilations '"+l+"'")});var k=f1(b.shape,y.shape,a,l,i,c),N;f!=null&&(N=$(f,"bias","fused conv2d"),e=me(Pr(N,g),1),N=e[0],s==="NHWC"?Jt(k.outShape,N.shape):(H(N.shape.length<=1,function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+("rank-"+N.shape.length+".")}),H(N.shape.length===0||N.shape[0]===k.outChannels||N.shape[0]===1,function(){return"Error in fused conv2d: bias shape ("+N.shape+") is not compatible with the number of output channels "+("("+k.outChannels+")")})));var T;if(d!=null){var I=d.shape;if(H(I.length<=1||I.length===3,function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+("rank-"+I.length+".")}),I.length===1)H(I[0]===1||I[0]===k.outChannels,function(){return"Error in fused conv2d: PReLU activation weights "+("("+I+") is not compatible with the number of output ")+("channels ("+k.outChannels+").")});else if(I.length===3)try{Jt(I,k.outShape)}catch{var F="Error in fused conv2d: PReLU activation weights ("+I+") is not compatible with the output shape of the conv2d "+("("+k.outShape+").");throw Error(F)}T=$(d,"prelu weights","fused conv2d")}var D=function(O,V){H(s==="NHWC",function(){return"Error in gradient of fused conv2D: got dataFormat of "+s+" but only NHWC is currently supported."});var K=me(V,4),Z=K[0],j=K[1],ee=K[2],le=K[3],se=N1(O,ee,p);H(hu(l),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+("are not yet supported in gradients. Got dilations '"+l+"'")});var ce=p1(j.shape,se,Z,a,i),he=h1(j,se,Z.shape,a,i),xe=[ce,he];if(le!=null){var Se=E1(le,se);xe.push(Se)}return xe},R={x:b,filter:y,bias:N,preluActivationWeights:T},P={strides:a,pad:i,dataFormat:s,dilations:l,dimRoundingMode:c,activation:p,leakyreluAlpha:m};if(f==null){var B=xo(function(O,V,K){var Z=ne.runKernel(uO,R,P);return K([V,O,Z]),w&&(Z=ve(Z,[Z.shape[1],Z.shape[2],Z.shape[3]])),{value:Z,gradFunc:D}});return B(b,y)}else{var q=xo(function(O,V,K,Z){var j=ne.runKernel(uO,R,P);return Z([V,O,j,K]),w&&(j=ve(j,[j.shape[1],j.shape[2],j.shape[3]])),{value:j,gradFunc:D}});return q(b,y,N)}}X({fusedConv2d_:Jye});function Qye(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,l=u===void 0?[1,1]:u,c=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,m=r.leakyreluAlpha;if(I1(ne.state.gradientDepth,p)===!1){var v=R4(t,n,a,i,s,l,c);return f!=null&&(v=et(v,f)),T1(v,p,d,m)}var g=$(t,"x","depthwiseConv2d","float32"),y=$(n,"filter","depthwiseConv2d","float32"),b=g,w=!1;g.rank===3&&(w=!0,b=ve(g,[1,g.shape[0],g.shape[1],g.shape[2]])),H(b.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+("rank "+b.rank+".")}),H(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+("but got rank "+y.rank+".")}),H(b.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels "+("("+b.shape[3]+") must match the inChannels dimension in ")+("filter "+y.shape[2]+".")}),l==null&&(l=[1,1]),H(ko(a,l),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+("be 1. Got strides "+a+" and dilations '"+l+"'")}),Ln("fused depthwiseConv2d",i,c);var x=f1(b.shape,y.shape,a,l,i,c,!0),k;f!=null&&(k=$(f,"bias","fused conv2d"),e=me(Pr(k,g),1),k=e[0],Jt(x.outShape,k.shape));var N;d!=null&&(N=$(d,"prelu weights","fused depthwiseConv2d"));var T=function(P,B){H(hu(l),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+("'"+l+"'")});var q=me(B,4),O=q[0],V=q[1],K=q[2],Z=q[3],j=N1(P,K,p),ee=S4(V.shape,j,O,a,i,l,c),le=k4(V,j,O.shape,a,i,l,c);if(Z!=null){var se=E1(k,j);return[ee,le,se]}return[ee,le]},I={x:b,filter:y,bias:k,preluActivationWeights:N},F={strides:a,pad:i,dataFormat:s,dilations:l,dimRoundingMode:c,activation:p,leakyreluAlpha:m};if(f==null){var D=xo(function(P,B,q){var O=ne.runKernel(lO,I,F);return q([B,P,O]),w&&(O=ve(O,[O.shape[1],O.shape[2],O.shape[3]])),{value:O,gradFunc:T}});return D(b,y)}else{var R=xo(function(P,B,q,O){var V=ne.runKernel(lO,I,F);return O([B,P,V,q]),w&&(V=ve(V,[V.shape[1],V.shape[2],V.shape[3]])),{value:V,gradFunc:T}});return R(b,y,k)}}X({fusedDepthwiseConv2d_:Qye});function e0e(r){var e,t,n=r.a,a=r.b,i=r.transposeA,o=i===void 0?!1:i,s=r.transposeB,u=s===void 0?!1:s,l=r.bias,c=r.activation,f=c===void 0?"linear":c,h=r.preluActivationWeights,p=r.leakyreluAlpha,d=p===void 0?.2:p;if(I1(ne.state.gradientDepth,f)===!1){var m=Pt(n,a,o,u);return l!=null&&(m=et(m,l)),T1(m,f,h,d)}var v=$(n,"a","fused matMul"),g=$(a,"b","fused matMul");e=me(Pr(v,g),2),v=e[0],g=e[1];var y=o?v.shape[v.rank-2]:v.shape[v.rank-1],b=u?g.shape[g.rank-1]:g.shape[g.rank-2],w=o?v.shape[v.rank-1]:v.shape[v.rank-2],x=u?g.shape[g.rank-2]:g.shape[g.rank-1],k=v.shape.slice(0,-2),N=g.shape.slice(0,-2),T=oa(k),I=oa(N);H(y===b,function(){return"Error in fused matMul: inner shapes ("+y+") and ("+(b+") of Tensors with shapes "+v.shape+" and ")+(g.shape+" and transposeA="+o)+(" and transposeB="+u+" must match.")});var F=Jt(v.shape.slice(0,-2),g.shape.slice(0,-2)),D=F.concat([w,x]),R=o?ve(v,[T,y,w]):ve(v,[T,w,y]),P=u?ve(g,[I,x,b]):ve(g,[I,b,x]),B;l!=null&&(B=$(l,"bias","fused matMul"),t=me(Pr(B,v),1),B=t[0],Jt(D,B.shape));var q;h!=null&&(q=$(h,"prelu weights","fused matMul"));var O=function(ee,le){var se=me(le,4),ce=se[0],he=se[1],xe=se[2],Se=se[3],we=N1(ve(ee,xe.shape),xe,f),ke,Ne;if(!o&&!u?(ke=Pt(we,he,!1,!0),Ne=Pt(ce,we,!0,!1)):!o&&u?(ke=Pt(we,he,!1,!1),Ne=Pt(we,ce,!0,!1)):o&&!u?(ke=Pt(he,we,!1,!0),Ne=Pt(ce,we,!1,!1)):(ke=Pt(he,we,!0,!0),Ne=Pt(we,ce,!0,!0)),l!=null){var Ae=E1(Se,we);return[ke,Ne,Ae]}else return[ke,Ne]},V={a:R,b:P,bias:B,preluActivationWeights:q},K={transposeA:o,transposeB:u,activation:f,leakyreluAlpha:d};if(l==null){var Z=xo(function(ee,le,se){var ce=ne.runKernel(sO,V,K);return se([ee,le,ce]),{value:ve(ce,D),gradFunc:O}});return Z(R,P)}else{var j=xo(function(ee,le,se,ce){var he=ne.runKernel(sO,V,K);return ce([ee,le,he,se]),{value:ve(he,D),gradFunc:O}});return j(R,P,B)}}X({fusedMatMul_:e0e});function t0e(r){return B4(r,.54,.46)}X({hammingWindow_:t0e});function r0e(r){return B4(r,.5,.5)}var n0e=X({hannWindow_:r0e});function a0e(r,e,t,n,a){n===void 0&&(n=!1),a===void 0&&(a=0);for(var i=0,o=[];i+e<=r.size;)o.push(Vt(r,i,e)),i+=t;if(n)for(;i<r.size;){var s=i+e-r.size,u=ua([Vt(r,i,e-s),um([s],a)]);o.push(u),i+=t}return o.length===0?Tv([],[0,e]):ve(ua(o),[o.length,e])}var i0e=X({frame_:a0e});function o0e(r,e,t,n,a){a===void 0&&(a=n0e),n==null&&(n=Zye(e));var i=i0e(r,e,t),o=de(i,a(e));return Rye(o,n)}X({stft_:o0e});function s0e(r,e,t,n,a,i){a===void 0&&(a="bilinear"),i===void 0&&(i=0);var o=$(r,"image","cropAndResize"),s=$(e,"boxes","cropAndResize","float32"),u=$(t,"boxInd","cropAndResize","int32"),l=s.shape[0];H(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,"+("but got rank "+o.rank+".")}),H(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] "+("but had shape "+s.shape+".")}),H(u.rank===1&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] "+("but had shape "+s.shape+".")}),H(n.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+("length "+n.length+".")}),H(n[0]>=1&&n[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+n}),H(a==="bilinear"||a==="nearest",function(){return"method must be bilinear or nearest, but was "+a});var c={image:o,boxes:s,boxInd:u},f={method:a,extrapolationValue:i,cropSize:n},h=ne.runKernel(Pce,c,f);return h}X({cropAndResize_:s0e});function u0e(r){var e=$(r,"image","flipLeftRight","float32");H(e.rank===4,function(){return"Error in flipLeftRight: image must be rank 4,"+("but got rank "+e.rank+".")});var t={image:e},n=ne.runKernel(jce,t,{});return n}X({flipLeftRight_:u0e});function l0e(r){var e=$(r,"image","grayscaleToRGB"),t=e.rank-1,n=e.shape[t];H(e.rank>=2,function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+("but got rank "+e.rank+".")}),H(n===1,function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+("should be size 1, but got size "+n+".")});var a=new Array(e.rank);return a.fill(1,0,t),a[t]=3,ih(e,a)}X({grayscaleToRGB_:l0e});function c0e(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=.5);var a=$(r,"image","rotateWithOffset","float32");H(a.rank===4,function(){return"Error in rotateWithOffset: image must be rank 4,"+("but got rank "+a.rank+".")});var i={image:a},o={radians:e,fillValue:t,center:n},s=ne.runKernel(Pfe,i,o);return s}X({rotateWithOffset_:c0e});function C1(r,e,t,n,a,i){n==null&&(n=.5),a==null&&(a=Number.NEGATIVE_INFINITY),i==null&&(i=0);var o=r.shape[0];return t=Math.min(t,o),H(0<=n&&n<=1,function(){return"iouThreshold must be in [0, 1], but was '"+n+"'"}),H(r.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+r.rank+"'"}),H(r.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+r.shape[1]}),H(e.rank===1,function(){return"scores must be a 1D tensor"}),H(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected "+o+", "+("but was "+e.shape[0])}),H(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"}),{maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i}}function f0e(r,e,t,n,a){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var i=$(r,"boxes","nonMaxSuppression","float32"),o=$(e,"scores","nonMaxSuppression","float32"),s=C1(i,o,t,n,a);t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:n,scoreThreshold:a};return ne.runKernel(ffe,{boxes:i,scores:o},u)}X({nonMaxSuppression_:f0e});function h0e(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var o=$(r,"boxes","nonMaxSuppression"),s=$(e,"scores","nonMaxSuppression"),u=C1(o,s,t,n,a,i);t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma;var l={boxes:o,scores:s},c={maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i},f=ne.runKernel(pfe,l,c);return{selectedIndices:f[0],selectedScores:f[1]}}X({nonMaxSuppressionWithScore_:h0e});function p0e(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1);var o=$(r,"boxes","nonMaxSuppression"),s=$(e,"scores","nonMaxSuppression"),u=C1(o,s,t,n,a,null),l=u.maxOutputSize,c=u.iouThreshold,f=u.scoreThreshold,h={boxes:o,scores:s},p={maxOutputSize:l,iouThreshold:c,scoreThreshold:f,padToMaxOutputSize:i},d=ne.runKernel(hfe,h,p);return{selectedIndices:d[0],validOutputs:d[1]}}X({nonMaxSuppressionPadded_:p0e});function d0e(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=$(r,"images","resizeBilinear");H(a.rank===3||a.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+("rank "+a.rank+".")}),H(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+(e+".")}),H(n===!1||t===!1,function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=ve(a,[1,a.shape[0],a.shape[1],a.shape[2]])),me(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},l=ne.runKernel(_M,s,u);return o?ve(l,[l.shape[1],l.shape[2],l.shape[3]]):l}X({resizeBilinear_:d0e});function v0e(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=$(r,"images","resizeNearestNeighbor");H(a.rank===3||a.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+("rank "+a.rank+".")}),H(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+(e+".")}),H(a.dtype==="float32"||a.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"}),H(n===!1||t===!1,function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=ve(a,[1,a.shape[0],a.shape[1],a.shape[2]])),me(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},l=ne.runKernel(AM,s,u);return o?ve(l,[l.shape[1],l.shape[2],l.shape[3]]):l}X({resizeNearestNeighbor_:v0e});function m0e(r,e,t,n){var a;e===void 0&&(e="binary"),t===void 0&&(t=!1),n===void 0&&(n=.5);var i=$(r,"image","threshold"),o=.2989,s=.587,u=.114,l=i.shape[0]*i.shape[1],c=de(zl([n]),255),f,h,p,d;if(H(i.rank===3,function(){return"Error in threshold: image must be rank 3,"+("but got rank "+i.rank+".")}),H(i.shape[2]===3||i.shape[2]===1,function(){return"Error in threshold: image color channel must be equal to 3 or 1"+("but got "+i.shape[2]+".")}),H(i.dtype==="int32"||i.dtype==="float32",function(){return"Error in dtype: image dtype must be int32 or float32,"+("but got dtype "+i.dtype+".")}),H(e==="otsu"||e==="binary",function(){return"Method must be binary or otsu, but was "+e}),i.shape[2]===3){a=me(lh(i,[1,1,1],-1),3),f=a[0],h=a[1],p=a[2];var m=de(f,o),v=de(h,s),g=de(p,u);d=et(et(m,v),g)}else d=r;if(e==="otsu"){var y=fme(rt(bye(d),"int32"),Qde([]),256);c=g0e(y,l)}var b=t?kh(d,c):ds(d,c),w=rt(de(b,255),"int32");return w}function g0e(r,e){for(var t=zl([-1]),n=zl([0]),a=zl([0]),i,o,s,u,l,c,f=0;f<r.size-1;f++){i=Vt(r,0,f+1),o=Vt(r,f+1),l=bt(ht(i),e),c=bt(ht(o),e);var h=ht(de(i,Wv(0,i.size)));s=bt(h,ht(i));var p=um(o.shape,i.size),d=et(Wv(0,o.size),p),m=de(o,d);u=bt(ht(m),ht(o));var v=lt(s,u),g=lt(s,u),y=de(l,c);a=de(de(y,v),g);var b=ds(a,n);n=Qa(b,a,n),t=Qa(b,zl([f]),t)}return t}X({threshold_:m0e});function y0e(r,e,t,n,a,i){t===void 0&&(t="nearest"),n===void 0&&(n="constant"),a===void 0&&(a=0);var o=$(r,"image","transform","float32"),s=$(e,"transforms","transform","float32");H(o.rank===4,function(){return"Error in transform: image must be rank 4,"+("but got rank "+o.rank+".")}),H(s.rank===2&&(s.shape[0]===o.shape[0]||s.shape[0]===1)&&s.shape[1]===8,function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"}),H(i==null||i.length===2,function(){return"Error in transform: outputShape must be [height, width] or null, "+("but got "+i+".")});var u={image:o,transforms:s},l={interpolation:t,fillMode:n,fillValue:a,outputShape:i};return ne.runKernel(Rfe,u,l)}X({transform_:y0e});function b0e(r,e,t){H(e%1===0,function(){return"bandPart(): numLower must be an integer, got "+e+"."}),H(t%1===0,function(){return"bandPart(): numUpper must be an integer, got "+t+"."});var n=$(r,"a","bandPart");H(n.rank>=2,function(){return"bandPart(): Rank must be at least 2, got "+n.rank+"."});var a=n.shape,i=me(n.shape.slice(-2),2),o=i[0],s=i[1];if(!(e<=o))throw new Error("bandPart(): numLower ("+e+")"+(" must not be greater than the number of rows ("+o+")."));if(!(t<=s))throw new Error("bandPart(): numUpper ("+t+")"+(" must not be greater than the number of columns ("+s+")."));e<0&&(e=o),t<0&&(t=s);var u=ve(Wv(0,o,1,"int32"),[-1,1]),l=Wv(0,s,1,"int32"),c=lt(u,l),f=uh(kh(c,wt(+e,"int32")),im(c,wt(-t,"int32"))),h=Hl([o,s],n.dtype);return ve(fh(m1(ve(n,[-1,o,s])).map(function(p){return Qa(f,p,h)})),a)}X({bandPart_:b0e});function w0e(r){var e;if(Array.isArray(r)){e=!1,H(r!=null&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=r[0].shape[0],n=function(u){H(r[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+("("+r[u].shape[0]+" vs. "+t+")")})},a=1;a<r.length;++a)n(a)}else e=!0,r=lh(r,r.shape[0],0).map(function(u){return Bye(u,[0])});H(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+r.length+") exceeds "+("number of dimensions ("+r[0].shape[0]+").")});for(var i=[],o=r,s=function(u){i.push(ne.tidy(function(){var l=o[u];if(u>0)for(var c=0;c<u;++c){var f=de(ht(de(i[c],l)),i[c]);l=lt(l,f)}return bt(l,w1(l,"euclidean"))}))},a=0;a<r.length;++a)s(a);return e?fh(i,0):i}X({gramSchmidt_:w0e});function x0e(r,e){if(e===void 0&&(e=!1),H(r.rank>=2,function(){return"qr() requires input tensor to have a rank >= 2, but got rank "+r.rank}),r.rank===2)return LO(r,e);var t=r.shape.slice(0,r.shape.length-2).reduce(function(u,l){return u*l}),n=m1(ve(r,[t,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),a=[],i=[];n.forEach(function(u){var l=me(LO(u,e),2),c=l[0],f=l[1];a.push(c),i.push(f)});var o=ve(fh(a,0),r.shape),s=ve(fh(i,0),r.shape);return[o,s]}function LO(r,e){return e===void 0&&(e=!1),ne.tidy(function(){H(r.shape.length===2,function(){return"qr2d() requires a 2D Tensor, but got a "+r.shape.length+"D Tensor."});for(var t=r.shape[0],n=r.shape[1],a=Ume(t),i=ah(r),o=Tv([[1]],[1,1]),s=ah(o),u=t>=n?n:t,l=function(f){var h,p=i,d=s,m=a;h=me(ne.tidy(function(){var v=Vt(i,[f,f],[t-f,1]),g=w1(v),y=Vt(i,[f,f],[1,1]),b=Qa(ds(y,0),Tv([[-1]]),Tv([[1]])),w=lt(y,de(b,g)),x=bt(v,w);x.shape[0]===1?s=ah(o):s=ua([o,Vt(x,[1,0],[x.shape[0]-1,x.shape[1]])],0);var k=on(bt(Pt(b,w),g)),N=Vt(i,[f,0],[t-f,n]),T=de(k,s),I=wo(s);if(f===0)i=lt(N,Pt(T,Pt(I,N)));else{var F=lt(N,Pt(T,Pt(I,N)));i=ua([Vt(i,[0,0],[f,n]),F],0)}var D=wo(T),R=Vt(a,[0,f],[t,a.shape[1]-f]);if(f===0)a=lt(R,Pt(Pt(R,s),D));else{var P=lt(R,Pt(Pt(R,s),D));a=ua([Vt(a,[0,0],[t,f]),P],1)}return[s,i,a]}),3),s=h[0],i=h[1],a=h[2],sa([p,d,m])},c=0;c<u;++c)l(c);return!e&&t>n&&(a=Vt(a,[0,0],[t,n]),i=Vt(i,[0,0],[n,n])),[a,i]})}X({qr_:x0e});var Mn;(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Mn||(Mn={}));function k0e(r,e,t){t===void 0&&(t=Mn.SUM_BY_NONZERO_WEIGHTS);var n=$(r,"losses","computeWeightedLoss"),a=null;e!=null&&(a=$(e,"weights","computeWeightedLoss"));var i=a==null?n:de(n,a);if(t===Mn.NONE)return i;if(t===Mn.SUM)return ht(i);if(t===Mn.MEAN){if(a==null)return Pb(i);var o=n.size/a.size,s=bt(ht(i),ht(a));return o>1?bt(s,wt(o)):s}if(t===Mn.SUM_BY_NONZERO_WEIGHTS){if(a==null)return bt(ht(i),wt(n.size));var u=de(a,Sh(n.shape)),l=rt(ht(Cge(u,wt(0))),"float32");return bt(ht(i),l)}throw Error("Unknown reduction: "+t)}var vs=X({computeWeightedLoss_:k0e});function S0e(r,e,t,n){n===void 0&&(n=Mn.SUM_BY_NONZERO_WEIGHTS);var a=$(r,"labels","absoluteDifference"),i=$(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=$(t,"weights","absoluteDifference")),Qi(a.shape,i.shape,"Error in absoluteDifference: ");var s=Xa(lt(a,i));return vs(s,o,n)}X({absoluteDifference_:S0e});function N0e(r,e,t,n,a){a===void 0&&(a=Mn.SUM_BY_NONZERO_WEIGHTS);var i=$(r,"labels","cosineDistance"),o=$(e,"predictions","cosineDistance"),s=null;n!=null&&(s=$(n,"weights","cosineDistance")),Qi(i.shape,o.shape,"Error in cosineDistance: ");var u=wt(1),l=lt(u,ht(de(i,o),t,!0));return vs(l,s,a)}X({cosineDistance_:N0e});function E0e(r,e,t,n){n===void 0&&(n=Mn.SUM_BY_NONZERO_WEIGHTS);var a=$(r,"labels","hingeLoss"),i=$(e,"predictions","hingeLoss"),o=null;t!=null&&(o=$(t,"weights","hingeLoss")),Qi(a.shape,i.shape,"Error in hingeLoss: ");var s=wt(1);a=lt(de(wt(2),a),s);var u=S1(lt(s,de(a,i)));return vs(u,o,n)}X({hingeLoss_:E0e});function T0e(r,e,t,n,a){n===void 0&&(n=1),a===void 0&&(a=Mn.SUM_BY_NONZERO_WEIGHTS);var i=$(r,"labels","huberLoss"),o=$(e,"predictions","huberLoss"),s=null;t!=null&&(s=$(t,"weights","huberLoss")),Qi(i.shape,o.shape,"Error in huberLoss: ");var u=wt(n),l=Xa(lt(o,i)),c=xge(l,u),f=lt(l,c),h=et(de(wt(.5),fr(c)),de(u,f));return vs(h,s,a)}X({huberLoss_:T0e});function I0e(r,e,t,n,a){n===void 0&&(n=1e-7),a===void 0&&(a=Mn.SUM_BY_NONZERO_WEIGHTS);var i=$(r,"labels","logLoss"),o=$(e,"predictions","logLoss"),s=null;t!=null&&(s=$(t,"weights","logLoss")),Qi(i.shape,o.shape,"Error in logLoss: ");var u=wt(1),l=wt(n),c=on(de(i,ch(et(o,l)))),f=de(lt(u,i),ch(et(lt(u,o),l))),h=lt(c,f);return vs(h,s,a)}X({logLoss_:I0e});function C0e(r,e,t,n){n===void 0&&(n=Mn.SUM_BY_NONZERO_WEIGHTS);var a=$(r,"labels","meanSquaredError"),i=$(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=$(t,"weights","meanSquaredError")),Qi(a.shape,i.shape,"Error in meanSquaredError: ");var s=Pye(a,i);return vs(s,o,n)}X({meanSquaredError_:C0e});function A0e(r,e){var t=$(r,"labels","sigmoidCrossEntropyWithLogits"),n=$(e,"logits","sigmoidCrossEntropyWithLogits");Qi(t.shape,n.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=S1(n),i=de(n,t),o=tge(Ji(on(Xa(n))));return et(lt(a,i),o)}function _0e(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=Mn.SUM_BY_NONZERO_WEIGHTS);var i=$(r,"multiClassLabels","sigmoidCrossEntropy"),o=$(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=$(t,"weights","sigmoidCrossEntropy")),Qi(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),n>0){var u=wt(n),l=wt(1),c=wt(.5);i=et(de(i,lt(l,u)),de(c,u))}var f=A0e(i,o);return vs(f,s,a)}X({sigmoidCrossEntropy_:_0e});function D0e(r,e,t){if(t===void 0&&(t=-1),t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+("supported. Labels / logits was rank "+e.rank+" ")+("and dim was "+t));var n=xo(function(a,i,o){var s=!0,u=uge(i,[t],s),l=lt(rt(i,"float32"),u);o([a,l]);var c=on(de(l,a)),f=ht(c,[t]),h=function(p,d){var m=me(d,2),v=m[0],g=m[1],y=Gl(p.shape,[t]);return[de(ve(p,y),lt(rt(v,"float32"),Ji(g))),de(ve(p,y),lt(Ji(g),rt(v,"float32")))]};return{value:f,gradFunc:h}});return n(r,e)}function F0e(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=Mn.SUM_BY_NONZERO_WEIGHTS);var i=$(r,"onehotLabels","softmaxCrossEntropy"),o=$(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=$(t,"weights","softmaxCrossEntropy")),Qi(i.shape,o.shape,"Error in softmaxCrossEntropy: "),n>0){var u=wt(n),l=wt(1),c=wt(i.shape[1]);i=et(de(i,lt(l,u)),bt(u,c))}var f=D0e(i,o);return vs(f,s,a)}X({softmaxCrossEntropy_:F0e});function R0e(r,e,t,n){var a=$(r,"indices","sparseFillEmptyRows","int32"),i=$(e,"values","sparseFillEmptyRows"),o=$(t,"denseShape","sparseFillEmptyRows","int32"),s=$(n,"defaultValue","sparseFillEmptyRows",i.dtype);if(a.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        `+a.shape);if(i.rank!==1)throw new Error("Values should be Tensor1D but received shape "+i.shape);if(o.rank!==1)throw new Error("Dense shape should be Tensor1D but received shape "+o.shape);if(s.rank!==0)throw new Error("Default value should be a scalar but received shape "+s.shape);var u={indices:a,values:i,denseShape:o,defaultValue:s},l=ne.runKernel(kfe,u);return{outputIndices:l[0],outputValues:l[1],emptyRowIndicator:l[2],reverseIndexMap:l[3]}}X({sparseFillEmptyRows_:R0e});function O0e(r,e,t){var n=$(r,"inputIndices","sparseReshape","int32"),a=$(e,"inputShape","sparseReshape","int32"),i=$(t,"newShape","sparseReshape","int32");if(n.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        `+n.shape);if(a.rank!==1)throw new Error("Input shape should be Tensor1D but received shape "+a.shape);if(i.rank!==1)throw new Error("New shape should be Tensor1D but received shape "+i.shape);var o={inputIndices:n,inputShape:a,newShape:i},s=ne.runKernel(Sfe,o);return{outputIndices:s[0],outputShape:s[1]}}X({sparseReshape_:O0e});function P0e(r,e,t){var n=$(r,"data","sparseSegmentMean"),a=$(e,"indices","sparseSegmentMean","int32"),i=$(t,"segmentIds","sparseSegmentMean","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          `+a.shape);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          `+i.shape);var o={data:n,indices:a,segmentIds:i};return ne.runKernel(Nfe,o)}X({sparseSegmentMean_:P0e});function M0e(r,e,t){var n=$(r,"data","sparseSegmentSum"),a=$(e,"indices","sparseSegmentSum","int32"),i=$(t,"segmentIds","sparseSegmentSum","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         `+a.shape);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         `+i.shape);var o={data:n,indices:a,segmentIds:i};return ne.runKernel(Efe,o)}X({sparseSegmentSum_:M0e});function B0e(r,e,t,n,a,i,o,s){var u=$(r,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error("Data must be a vector, saw: "+u.shape);var l=$(e,"dataSplits","stringNGrams");if(l.dtype!=="int32")throw new Error("Data splits must be of datatype int32");var c={separator:t,nGramWidths:n,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},f={data:u,dataSplits:l},h=ne.runKernel(Afe,f,c);return{nGrams:h[0],nGramsSplits:h[1]}}X({stringNGrams_:B0e});function L0e(r,e,t){t===void 0&&(t=!0);var n=$(r,"input","stringSplit","string"),a=$(e,"delimiter","stringSplit","string");if(n.rank!==1)throw new Error("Input should be Tensor1D but received shape "+n.shape);if(a.rank!==0)throw new Error("Delimiter should be a scalar but received shape "+a.shape);var i={skipEmpty:t},o={input:n,delimiter:a},s=ne.runKernel(_fe,o,i);return{indices:s[0],values:s[1],shape:s[2]}}X({stringSplit_:L0e});function z0e(r,e){var t=$(r,"input","stringToHashBucketFast","string"),n={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");var a={input:t};return ne.runKernel(Dfe,a,n)}X({stringToHashBucketFast_:z0e});var xu=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.minimize=function(t,n,a){n===void 0&&(n=!1);var i=this.computeGradients(t,a),o=i.value,s=i.grads;if(a!=null){var u=a.map(function(l){return{name:l.name,tensor:s[l.name]}});this.applyGradients(u)}else this.applyGradients(s);return sa(s),n?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,n){return rge(t,n)},e.prototype.dispose=function(){this.iterations_!=null&&sa(this.iterations_)},e.prototype.saveIterations=function(){return Ce(this,void 0,void 0,function(){return Ie(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:wt(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ie(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){return Ie(this,function(n){throw new Error("setWeights() is not implemented for this optimizer class "+(""+this.getClassName()))})})},e.prototype.extractIterations=function(t){return Ce(this,void 0,void 0,function(){var n;return Ie(this,function(a){switch(a.label){case 0:return n=this,[4,t[0].tensor.data()];case 1:return n.iterations_=a.sent()[0],[2,t.slice(1)]}})})},e}(Mve);Object.defineProperty(xu,Symbol.hasInstance,{value:function(r){return r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null}});var L4=function(r){ge(e,r);function e(t,n,a){a===void 0&&(a=null);var i=r.call(this)||this;return i.learningRate=t,i.rho=n,i.epsilon=a,i.accumulatedGrads=[],i.accumulatedUpdates=[],a==null&&(i.epsilon=ne.backend.epsilon()),i}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=ne.registeredVariables[i],u=!1;n.accumulatedGrads[o]==null&&(n.accumulatedGrads[o]={originalName:i+"/accum_grad",variable:Yr(function(){return Mt(s).variable(u)})}),n.accumulatedUpdates[o]==null&&(n.accumulatedUpdates[o]={originalName:i+"/accum_var",variable:Yr(function(){return Mt(s).variable(u)})});var l=Array.isArray(t)?t[o].tensor:t[i];if(l!=null){var c=n.accumulatedGrads[o].variable,f=n.accumulatedUpdates[o].variable;Yr(function(){var h=et(de(c,n.rho),de(fr(l),1-n.rho)),p=de(bt(_a(et(f,n.epsilon)),_a(et(c,n.epsilon))),l),d=et(de(f,n.rho),de(fr(p),1-n.rho));c.assign(h),f.assign(d);var m=et(de(p,-n.learningRate),s);s.assign(m)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(sa(this.accumulatedGrads.map(function(t){return t.variable})),sa(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){var t;return Ie(this,function(n){switch(n.label){case 0:return t=mt(this.accumulatedGrads,this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var n,a;return Ie(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=t.length/2,a=!1,this.accumulatedGrads=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedUpdates=t.slice(n,n*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.rho,n.epsilon)},e}(xu);L4.className="Adadelta";gu(L4);var z4=function(r){ge(e,r);function e(t,n){n===void 0&&(n=.1);var a=r.call(this)||this;return a.learningRate=t,a.initialAccumulatorValue=n,a.accumulatedGrads=[],a}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=ne.registeredVariables[i];if(n.accumulatedGrads[o]==null){var u=!1;n.accumulatedGrads[o]={originalName:i+"/accumulator",variable:Yr(function(){return um(s.shape,n.initialAccumulatorValue).variable(u)})}}var l=Array.isArray(t)?t[o].tensor:t[i];if(l!=null){var c=n.accumulatedGrads[o].variable;Yr(function(){var f=et(c,fr(l));c.assign(f);var h=et(de(bt(l,_a(et(f,ne.backend.epsilon()))),-n.learningRate),s);s.assign(h)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&sa(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ie(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var n;return Ie(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),n=!1,this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(n)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,n){return new t(n.learningRate,n.initialAccumulatorValue)},e}(xu);z4.className="Adagrad";gu(z4);var $4=function(r){ge(e,r);function e(t,n,a,i){i===void 0&&(i=null);var o=r.call(this)||this;return o.learningRate=t,o.beta1=n,o.beta2=a,o.epsilon=i,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],Yr(function(){o.accBeta1=wt(n).variable(),o.accBeta2=wt(a).variable()}),i==null&&(o.epsilon=ne.backend.epsilon()),o}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Yr(function(){var i=lt(1,n.accBeta1),o=lt(1,n.accBeta2);a.forEach(function(s,u){var l=ne.registeredVariables[s],c=!1;n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:s+"/m",variable:Yr(function(){return Mt(l).variable(c)})}),n.accumulatedSecondMoment[u]==null&&(n.accumulatedSecondMoment[u]={originalName:s+"/v",variable:Yr(function(){return Mt(l).variable(c)})});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=n.accumulatedFirstMoment[u].variable,p=n.accumulatedSecondMoment[u].variable,d=et(de(h,n.beta1),de(f,1-n.beta1)),m=et(de(p,n.beta2),de(fr(f),1-n.beta2)),v=bt(d,i),g=bt(m,o);h.assign(d),p.assign(m);var y=et(de(bt(v,et(_a(g),n.epsilon)),-n.learningRate),l);l.assign(y)}}),n.accBeta1.assign(de(n.accBeta1,n.beta1)),n.accBeta2.assign(de(n.accBeta2,n.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&sa(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&sa(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){var t;return Ie(this,function(n){switch(n.label){case 0:return t=mt(this.accumulatedFirstMoment,this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var n,a,i=this;return Ie(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),Yr(function(){i.accBeta1.assign(Kl(i.beta1,i.iterations_+1)),i.accBeta2.assign(Kl(i.beta2,i.iterations_+1))}),n=t.length/2,a=!1,this.accumulatedFirstMoment=t.slice(0,n).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),this.accumulatedSecondMoment=t.slice(n,n*2).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon)},e}(xu);$4.className="Adam";gu($4);var W4=function(r){ge(e,r);function e(t,n,a,i,o){i===void 0&&(i=null),o===void 0&&(o=0);var s=r.call(this)||this;return s.learningRate=t,s.beta1=n,s.beta2=a,s.epsilon=i,s.decay=o,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],Yr(function(){s.iteration=wt(0).variable(),s.accBeta1=wt(n).variable()}),i==null&&(s.epsilon=ne.backend.epsilon()),s}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Yr(function(){var i=lt(1,n.accBeta1),o=bt(-n.learningRate,et(de(n.iteration,n.decay),1));a.forEach(function(s,u){var l=ne.registeredVariables[s],c=!1;n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:s+"/m",variable:Mt(l).variable(c)}),n.accumulatedWeightedInfNorm[u]==null&&(n.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:Mt(l).variable(c)});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=n.accumulatedFirstMoment[u].variable,p=n.accumulatedWeightedInfNorm[u].variable,d=et(de(h,n.beta1),de(f,1-n.beta1)),m=de(p,n.beta2),v=Xa(f),g=M4(m,v);h.assign(d),p.assign(g);var y=et(de(bt(o,i),bt(d,et(g,n.epsilon))),l);l.assign(y)}}),n.iteration.assign(et(n.iteration,1)),n.accBeta1.assign(de(n.accBeta1,n.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&sa(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&sa(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ie(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){return Ie(this,function(n){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)},e}(xu);W4.className="Adamax";gu(W4);var A1=function(r){ge(e,r);function e(t){var n=r.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=ne.registeredVariables[i];Yr(function(){var l=et(de(n.c,s),u);u.assign(l)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=Wpe(wt(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ie(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){return Ie(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:if(t=n.sent(),t.length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,n){return new t(n.learningRate)},e}(xu);A1.className="SGD";gu(A1);var q4=function(r){ge(e,r);function e(t,n,a){a===void 0&&(a=!1);var i=r.call(this,t)||this;return i.learningRate=t,i.momentum=n,i.useNesterov=a,i.accumulations=[],i.m=wt(i.momentum),i}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=ne.registeredVariables[i];if(n.accumulations[o]==null){var u=!1;n.accumulations[o]={originalName:i+"/momentum",variable:Yr(function(){return Mt(s).variable(u)})}}var l=n.accumulations[o].variable,c=Array.isArray(t)?t[o].tensor:t[i];c!=null&&Yr(function(){var f,h=et(de(n.m,l),c);n.useNesterov?f=et(de(n.c,et(c,de(h,n.m))),s):f=et(de(n.c,h),s),l.assign(h),s.assign(f)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&sa(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ie(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var n;return Ie(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),n=!1,this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(n)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,n){return new t(n.learningRate,n.momentum,n.useNesterov)},e}(A1);q4.className="Momentum";gu(q4);var V4=function(r){ge(e,r);function e(t,n,a,i,o){n===void 0&&(n=.9),a===void 0&&(a=0),i===void 0&&(i=null),o===void 0&&(o=!1);var s=r.call(this)||this;if(s.learningRate=t,s.decay=n,s.momentum=a,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=o,i==null&&(s.epsilon=ne.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=ne.registeredVariables[i],u=!1;n.accumulatedMeanSquares[o]==null&&(n.accumulatedMeanSquares[o]={originalName:i+"/rms",variable:Yr(function(){return Mt(s).variable(u)})}),n.accumulatedMoments[o]==null&&(n.accumulatedMoments[o]={originalName:i+"/momentum",variable:Yr(function(){return Mt(s).variable(u)})}),n.accumulatedMeanGrads[o]==null&&n.centered&&(n.accumulatedMeanGrads[o]={originalName:i+"/mg",variable:Yr(function(){return Mt(s).variable(u)})});var l=Array.isArray(t)?t[o].tensor:t[i];if(l!=null){var c=n.accumulatedMeanSquares[o].variable,f=n.accumulatedMoments[o].variable;Yr(function(){var h=et(de(c,n.decay),de(fr(l),1-n.decay));if(n.centered){var p=n.accumulatedMeanGrads[o].variable,d=et(de(p,n.decay),de(l,1-n.decay)),m=bt(de(l,n.learningRate),_a(lt(h,et(fr(d),n.epsilon)))),v=et(de(f,n.momentum),m);c.assign(h),p.assign(d),f.assign(v);var g=lt(s,v);s.assign(g)}else{var y=et(de(c,n.decay),de(fr(l),1-n.decay)),v=et(de(f,n.momentum),bt(de(l,n.learningRate),_a(et(y,n.epsilon))));c.assign(y),f.assign(v);var g=lt(s,v);s.assign(g)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&sa(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&sa(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&sa(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){var t;return Ie(this,function(n){switch(n.label){case 0:return t=mt(this.accumulatedMeanSquares,this.accumulatedMoments),this.centered&&t.push.apply(t,mt(this.accumulatedMeanGrads)),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var n,a;return Ie(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=this.centered?t.length/3:t.length/2,a=!1,this.accumulatedMeanSquares=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedMoments=t.slice(n,n*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(n*2,n*3).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,n){return new t(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)},e}(xu);V4.className="RMSProp";gu(V4);(function(){return typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:function(r){return r()}})();var zO;(function(r){r[r.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",r[r.VALUE_ROWIDS=1]="VALUE_ROWIDS",r[r.ROW_LENGTHS=2]="ROW_LENGTHS",r[r.ROW_SPLITS=3]="ROW_SPLITS",r[r.ROW_LIMITS=4]="ROW_LIMITS",r[r.ROW_STARTS=5]="ROW_STARTS"})(zO||(zO={}));var $0e=1.7580993408473768,W0e=1.0507009873554805;function q0e(r,e,t){var n=r.shape.slice();n[t]=1;var a=ve(e,n),i=PO(r,t,!0,!1),o=PO(r,t,!0,!0),s=de(i,o);return de(a,s)}function V0e(r,e,t){var n=r.shape.length,a=n-t.length,i=x4(t,n),o=r;i!=null&&(o=wo(r,i));var s=o.shape.slice(),u=s.splice(n-t.length,t.length),l=u.reduce(function(p,d){return p*d},1);s.push(l);var c=o.reshape(s),f=q0e(c,e,a);if(f=f.reshape(o.shape),i!=null){var h=d1(i);f=wo(f,h)}return f}var G0e={kernelName:EM,inputsToSave:["x"],gradFunc:function(r,e,t){var n=me(e,1),a=n[0],i=t.axis,o=[];return i==null?o=a.shape.map(function(s,u){return u}):typeof i=="number"?o=[i]:o=i,{x:function(){return V0e(a,r,o)}}}},U0e={kernelName:GP,inputsToSave:["a","b"],gradFunc:function(r,e){var t=me(e,2),n=t[0],a=t[1],i=Jt(n.shape,a.shape),o=function(){var u=bt(r,rt(a,"float32")),l=sn(n.shape,i);return l.length>0?ve(ht(u,l),n.shape):u},s=function(){var u=de(r,rt(n,"float32")),l=sn(a.shape,i);l.length>0&&(u=ve(ht(u,l),a.shape));var c=fr(a);return on(bt(u,rt(c,"float32")))};return{a:o,b:s}}},H0e={kernelName:TM,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){return bt(r,on(fr(n)))}}}},K0e={kernelName:DM,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0],a=de(kh(n,6),am(n));return{x:function(){return de(r,rt(a,"float32"))}}}},j0e={kernelName:IM,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){return de(r,rt(am(n),"float32"))}}}},X0e={kernelName:CM,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){return ve(r,n.shape)}}}},Y0e={kernelName:_M,inputsToSave:["images"],gradFunc:function(r,e,t){var n=me(e,1),a=n[0],i={dy:r,images:a},o=function(){return ne.runKernel(bfe,i,t)};return{images:o}}},Z0e={kernelName:AM,inputsToSave:["images"],gradFunc:function(r,e,t){var n=me(e,1),a=n[0],i={dy:r,images:a},o=function(){return ne.runKernel(yfe,i,t)};return{images:o}}};var J0e={kernelName:FM,gradFunc:function(r,e,t){var n=t.dims,a=Ci(n,r.shape);return{x:function(){return pu(r,a)}}}};var Q0e={kernelName:RM,gradFunc:function(r){return{x:function(){return Mt(r)}}}},ebe={kernelName:OM,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){return on(bt(r,de(Kl(n,1.5),2)))}}}},tbe={kernelName:PM,inputsToSave:["condition"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{condition:function(){return rt(Mt(n),"float32")},t:function(){return de(r,rt(n,r.dtype))},e:function(){return de(r,rt(P4(n),r.dtype))}}}},rbe={kernelName:MM,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){var a=ds(n,wt(0)),i=wt($0e),o=wt(W0e),s=de(r,o),u=de(de(r,i),Ji(rt(n,"float32")));return Qa(a,s,u)}}}},nbe={kernelName:WM,outputsToSave:[!0],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){return de(r,de(n,lt(wt(1),n)))}}}};var abe={kernelName:$M,gradFunc:function(r){return{x:function(){return Mt(r)}}}},ibe={kernelName:LM,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){return de(F4(rt(n,"float32")),r)}}}},obe={kernelName:zM,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){return de(Eme(rt(n,"float32")),r)}}}},sbe={kernelName:BM,inputsToSave:["x"],gradFunc:function(r,e,t){for(var n=me(e,1),a=n[0],i=t.begin,o=t.size,s=a.shape,u=me(Pve(a,i,o),2),l=u[0],c=u[1],f=[],h=0;h<r.rank;h++)f.push([l[h],s[h]-l[h]-c[h]]);return{x:function(){return Eh(r,f)}}}},ube={kernelName:KM,outputsToSave:[!0],gradFunc:function(r,e,t){var n=me(e,1),a=n[0],i=t.dim,o=!0,s=de(r,a);return{logits:function(){return lt(s,de(ht(s,[i],o),a))}}}},lbe={kernelName:qM,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){return de(r,$l(n))}}}};var $O={kernelName:UM,gradFunc:function(r,e,t){var n=t.blockShape,a=t.paddings;return{x:function(){return D4(r,n,a)}}}};var WO={kernelName:HM,gradFunc:function(r,e,t){var n=t.axis;return{x:function(){return ua(r,n)}}}},cbe={kernelName:VM,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){return bt(r,de(_a(rt(n,"float32")),2))}}}},fbe={kernelName:Ife,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){return de(r,de(rt(n,"float32"),2))}}}},hbe={kernelName:jM,inputsToSave:["a","b"],gradFunc:function(r,e){var t=me(e,2),n=t[0],a=t[1],i=wt(2),o=function(){return de(r,de(i,lt(n,a)))},s=function(){return de(r,de(i,lt(a,n)))};return{a:o,b:s}}};var pbe={kernelName:t4,gradFunc:function(r){return{x:function(){return Mt(r)}}}},dbe={kernelName:XM,inputsToSave:["a","b"],gradFunc:function(r,e){var t=me(e,2),n=t[0],a=t[1],i=Jt(n.shape,a.shape),o=function(){var u=r,l=sn(n.shape,i);return l.length>0&&(u=ht(u,l)),ve(u,n.shape)},s=function(){var u=r,l=sn(a.shape,i);return l.length>0&&(u=ht(u,l)),ve(on(u),a.shape)};return{a:o,b:s}}},vbe={kernelName:GM,inputsToSave:["x"],gradFunc:function(r,e,t){var n=me(e,1),a=n[0],i=a.shape.slice(),o=t.axis,s=Ci(o,a.shape);s.forEach(function(c){i[c]=1});var u=ve(r,i),l=de(u,Sh(a.shape,"float32"));return{x:function(){return l}}}},mbe={kernelName:YM,inputsToSave:["x"],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){return bt(r,fr(F4(n)))}}}},gbe={kernelName:ZM,outputsToSave:[!0],gradFunc:function(r,e){var t=me(e,1),n=t[0];return{x:function(){return de(lt(wt(1),fr(n)),r)}}}},ybe={kernelName:t1,inputsToSave:["x"],gradFunc:function(r,e,t){var n=me(e,1),a=n[0],i=t.reps,o=function(){var s=Mt(a);if(a.rank===1)for(var u=0;u<i[0];++u)s=et(s,Vt(r,[u*a.shape[0]],[a.shape[0]]));else if(a.rank===2)for(var u=0;u<i[0];++u)for(var l=0;l<i[1];++l)s=et(s,Vt(r,[u*a.shape[0],l*a.shape[1]],[a.shape[0],a.shape[1]]));else if(a.rank===3)for(var u=0;u<i[0];++u)for(var l=0;l<i[1];++l)for(var c=0;c<i[2];++c)s=et(s,Vt(r,[u*a.shape[0],l*a.shape[1],c*a.shape[2]],[a.shape[0],a.shape[1],a.shape[2]]));else if(a.rank===4)for(var u=0;u<i[0];++u)for(var l=0;l<i[1];++l)for(var c=0;c<i[2];++c)for(var f=0;f<i[3];++f)s=et(s,Vt(r,[u*a.shape[0],l*a.shape[1],c*a.shape[2],f*a.shape[3]],[a.shape[0],a.shape[1],a.shape[2],a.shape[3]]));else throw new Error("Gradient for tile operation is not implemented for rank-"+(a.rank+" tensors yet."));return s};return{x:o}}};var bbe={kernelName:kv,gradFunc:function(r,e,t){var n=t,a=n.perm,i=d1(a);return{x:function(){return wo(r,i)}}}};var wbe={kernelName:JM,gradFunc:function(r,e,t){var n=t,a=n.axis;return{value:function(){return fh(r,a)}}}},xbe={kernelName:QM,inputsToSave:["segmentIds"],gradFunc:function(r,e){var t=me(e,1),n=t[0],a=function(){return kbe(r,n)};return{x:a}}};function kbe(r,e){for(var t=M4(e,Mt(e)),n=Kme(r,t),a=im(e,wt(0,"int32")),i=n.rank-a.rank,o=0;o<i;++o)a=ou(a,o+1);a=uh(a,Sh(n.shape,"bool"));var s=Mt(n);return Qa(a,n,s)}var Sbe={kernelName:e4,gradFunc:function(r){return{x:function(){return Mt(r)}}}},mb,qO,Nbe=[y4,Rhe,Ohe,Bhe,Lhe,$he,Whe,qhe,Ghe,Uhe,Hhe,Khe,epe,npe,ipe,spe,upe,lpe,cpe,gpe,ype,wpe,Epe,Spe,Ape,Fpe,Ppe,Hpe,Xpe,Ype,U0e,Zpe,Qpe,ede,tde,rde,ade,nde,ude,fde,hde,pde,dde,vde,mde,yde,bde,wde,xde,Nde,IO,IO,Cde,Dde,Ode,Pde,Mde,Bde,zde,Wde,qde,Vde,Gde,Ude,Kde,CO,CO,Yde,Zde,G0e,H0e,K0e,j0e,X0e,Y0e,Z0e,J0e,Q0e,ebe,tbe,rbe,nbe,abe,ibe,obe,sbe,ube,lbe,$O,$O,WO,WO,cbe,hbe,fbe,pbe,dbe,vbe,mbe,gbe,ybe,bbe,wbe,xbe,Sbe];try{for(Yf=be(Nbe),Pl=Yf.next();!Pl.done;Pl=Yf.next())VO=Pl.value,Jfe(VO)}catch(r){mb={error:r}}finally{try{Pl&&!Pl.done&&(qO=Yf.return)&&qO.call(Yf)}finally{if(mb)throw mb.error}}var VO,Yf,Pl;function _1(r,e){return M.tidy(function(){return _.sqrt(_.sum(_.mul(r,r),e,!0))})}var Th=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getConfig=function(){return{}},e}(M.serialization.Serializable),D1=function(r){ge(e,r);function e(t){var n=r.call(this)||this;return n.defaultMaxValue=2,n.defaultAxis=0,n.maxValue=t.maxValue!=null?t.maxValue:n.defaultMaxValue,n.axis=t.axis!=null?t.axis:n.defaultAxis,n}return e.prototype.apply=function(t){var n=this;return M.tidy(function(){var a=_1(t,n.axis),i=_.clipByValue(a,0,n.maxValue);return _.mul(t,_.div(i,_.add(Zr(),a)))})},e.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},e}(Th);D1.className="MaxNorm";M.serialization.registerClass(D1);var F1=function(r){ge(e,r);function e(t){var n=r.call(this)||this;return n.defaultAxis=0,n.axis=t.axis!=null?t.axis:n.defaultAxis,n}return e.prototype.apply=function(t){var n=this;return M.tidy(function(){return _.div(t,_.add(Zr(),_1(t,n.axis)))})},e.prototype.getConfig=function(){return{axis:this.axis}},e}(Th);F1.className="UnitNorm";M.serialization.registerClass(F1);var R1=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return _.relu(t)},e}(Th);R1.className="NonNeg";M.serialization.registerClass(R1);var O1=function(r){ge(e,r);function e(t){var n=r.call(this)||this;return n.defaultMinValue=0,n.defaultMaxValue=1,n.defaultRate=1,n.defaultAxis=0,n.minValue=t.minValue!=null?t.minValue:n.defaultMinValue,n.maxValue=t.maxValue!=null?t.maxValue:n.defaultMaxValue,n.rate=t.rate!=null?t.rate:n.defaultRate,n.axis=t.axis!=null?t.axis:n.defaultAxis,n}return e.prototype.apply=function(t){var n=this;return M.tidy(function(){var a=_1(t,n.axis),i=_.add(_.mul(n.rate,_.clipByValue(a,n.minValue,n.maxValue)),_.mul(1-n.rate,a));return _.mul(t,_.div(i,_.add(Zr(),a)))})},e.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},e}(Th);O1.className="MinMaxNorm";M.serialization.registerClass(O1);var GO={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Jr(r){return Wb(r)}function UO(r,e){return e===void 0&&(e={}),vh(r,M.serialization.SerializationMap.getMap().classNameMap,e,"constraint")}function Qr(r){if(r==null)return null;if(typeof r=="string"){var e=r in GO?GO[r]:r,t={className:e,config:{}};return UO(t)}else return r instanceof Th?r:UO(r)}function Ebe(r){return new D1(r)}function Tbe(r){return new F1(r)}function Ibe(){return new R1}function Cbe(r){return new O1(r)}var Abe={__proto__:null,maxNorm:Ebe,unitNorm:Tbe,nonNeg:Ibe,minMaxNorm:Cbe};function _be(){return new Gb}function Dbe(){return new Xv}function Fbe(r){return new Ub(r)}function Rbe(r){return new Hb(r)}function Obe(r){return new Kb(r)}function Pbe(r){return new jb(r)}function Mbe(r){return new Xb(r)}function Bbe(r){return new Bn(r)}function Lbe(r){return new Yv(r)}function zbe(r){return new Zv(r)}function $be(r){return new Jv(r)}function Wbe(r){return new Qv(r)}function qbe(r){return new em(r)}function Vbe(r){return new tm(r)}function Gbe(r){return new Yb(r)}var Ube={__proto__:null,zeros:_be,ones:Dbe,constant:Fbe,randomUniform:Rbe,randomNormal:Obe,truncatedNormal:Pbe,identity:Mbe,varianceScaling:Bbe,glorotUniform:Lbe,glorotNormal:zbe,heNormal:$be,heUniform:Wbe,leCunNormal:qbe,leCunUniform:Vbe,orthogonal:Gbe};function os(r){return Ce(this,void 0,void 0,function(){var e,t,n,a,i,o,s,u;return Ie(this,function(l){switch(l.label){case 0:if(r==null)return[2];e=[],t=[],n=[];for(a in r)i=r[a],typeof i!="number"&&(o=i,e.push(o.data()),t.push(a),n.push(o));return e.length>0?[4,Promise.all(e)]:[3,2];case 1:for(s=l.sent(),u=0;u<s.length;++u)r[t[u]]=s[u][0];M.dispose(n),l.label=2;case 2:return[2]}})})}function G4(r){if(r!=null)for(var e in r){var t=r[e];typeof t!="number"&&t.dispose()}}var HO;(function(r){r[r.SILENT=0]="SILENT",r[r.VERBOSE=1]="VERBOSE"})(HO||(HO={}));var Hbe=125,jl=function(){function r(){this.validationData=null}return r.prototype.setParams=function(e){this.params=e},r.prototype.onEpochBegin=function(e,t){return Ce(this,void 0,void 0,function(){return Ie(this,function(n){return[2]})})},r.prototype.onEpochEnd=function(e,t){return Ce(this,void 0,void 0,function(){return Ie(this,function(n){return[2]})})},r.prototype.onBatchBegin=function(e,t){return Ce(this,void 0,void 0,function(){return Ie(this,function(n){return[2]})})},r.prototype.onBatchEnd=function(e,t){return Ce(this,void 0,void 0,function(){return Ie(this,function(n){return[2]})})},r.prototype.onTrainBegin=function(e){return Ce(this,void 0,void 0,function(){return Ie(this,function(t){return[2]})})},r.prototype.onTrainEnd=function(e){return Ce(this,void 0,void 0,function(){return Ie(this,function(t){return[2]})})},r.prototype.setModel=function(e){},r}(),U4=function(){function r(e,t){t===void 0&&(t=10),e==null&&(e=[]),this.callbacks=e,this.queueLength=t}return r.prototype.append=function(e){this.callbacks.push(e)},r.prototype.setParams=function(e){var t,n;try{for(var a=be(this.callbacks),i=a.next();!i.done;i=a.next()){var o=i.value;o.setParams(e)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},r.prototype.setModel=function(e){var t,n;try{for(var a=be(this.callbacks),i=a.next();!i.done;i=a.next()){var o=i.value;o.setModel(e)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},r.prototype.onEpochBegin=function(e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u;return Ie(this,function(l){switch(l.label){case 0:t==null&&(t={}),l.label=1;case 1:l.trys.push([1,6,7,8]),n=be(this.callbacks),a=n.next(),l.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onEpochBegin(e,t)]);case 3:l.sent(),l.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},r.prototype.onEpochEnd=function(e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u;return Ie(this,function(l){switch(l.label){case 0:t==null&&(t={}),l.label=1;case 1:l.trys.push([1,6,7,8]),n=be(this.callbacks),a=n.next(),l.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onEpochEnd(e,t)]);case 3:l.sent(),l.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},r.prototype.onBatchBegin=function(e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u;return Ie(this,function(l){switch(l.label){case 0:t==null&&(t={}),l.label=1;case 1:l.trys.push([1,6,7,8]),n=be(this.callbacks),a=n.next(),l.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onBatchBegin(e,t)]);case 3:l.sent(),l.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},r.prototype.onBatchEnd=function(e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u;return Ie(this,function(l){switch(l.label){case 0:t==null&&(t={}),l.label=1;case 1:l.trys.push([1,6,7,8]),n=be(this.callbacks),a=n.next(),l.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onBatchEnd(e,t)]);case 3:l.sent(),l.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o=l.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},r.prototype.onTrainBegin=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s;return Ie(this,function(u){switch(u.label){case 0:e==null&&(e={}),u.label=1;case 1:u.trys.push([1,6,7,8]),t=be(this.callbacks),n=t.next(),u.label=2;case 2:return n.done?[3,5]:(a=n.value,[4,a.onTrainBegin(e)]);case 3:u.sent(),u.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return i=u.sent(),o={error:i},[3,8];case 7:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},r.prototype.onTrainEnd=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s;return Ie(this,function(u){switch(u.label){case 0:e==null&&(e={}),u.label=1;case 1:u.trys.push([1,6,7,8]),t=be(this.callbacks),n=t.next(),u.label=2;case 2:return n.done?[3,5]:(a=n.value,[4,a.onTrainEnd(e)]);case 3:u.sent(),u.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return i=u.sent(),o={error:i},[3,8];case 7:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},r}(),Kbe=function(r){ge(e,r);function e(){return r.call(this)||this}return e.prototype.onEpochBegin=function(t){return Ce(this,void 0,void 0,function(){return Ie(this,function(n){return this.seen=0,this.totals={},[2]})})},e.prototype.onBatchEnd=function(t,n){return Ce(this,void 0,void 0,function(){var a,i,o,s,u=this;return Ie(this,function(l){n==null&&(n={}),a=n.size==null?0:n.size,this.seen+=a,i=function(c){var f=n[c];if(typeof f=="number")o.totals.hasOwnProperty(c)||(o.totals[c]=0),o.totals[c]=o.totals[c]+f*a;else{var h=void 0;c in o.totals?h=o.totals[c]:o.totals[c]=0;var p=M.tidy(function(){return M.add(u.totals[c],M.mul(f,a))});o.totals[c]=p,h?.dispose()}},o=this;for(s in n)i(s);return[2]})})},e.prototype.onEpochEnd=function(t,n){return Ce(this,void 0,void 0,function(){var a,i,o,s,u,l,c,f=this;return Ie(this,function(h){if(n!=null){a=function(p){if(i.totals[p]==null)return"continue";typeof i.totals[p]=="number"?n[p]=i.totals[p]/i.seen:M.tidy(function(){var d=M.mul(M.div(1,f.seen),f.totals[p]);n[p]=d,f.totals[p].dispose(),M.keep(n[p])})},i=this;try{for(o=be(this.params.metrics),s=o.next();!s.done;s=o.next())u=s.value,a(u)}catch(p){l={error:p}}finally{try{s&&!s.done&&(c=o.return)&&c.call(o)}finally{if(l)throw l.error}}}return[2]})})},e}(jl),H4=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.onTrainBegin=function(t){return Ce(this,void 0,void 0,function(){return Ie(this,function(n){return this.epoch=[],this.history={},[2]})})},e.prototype.onEpochEnd=function(t,n){return Ce(this,void 0,void 0,function(){var a;return Ie(this,function(i){n==null&&(n={}),this.epoch.push(t);for(a in n)this.history[a]==null&&(this.history[a]=[]),this.history[a].push(n[a]);return[2]})})},e.prototype.syncData=function(){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c,f;return Ie(this,function(h){switch(h.label){case 0:t=[],n=[],a=[];for(i in this.history)for(o=this.history[i],s=0;s<o.length;++s)typeof o[s]!="number"&&(u=o[s],t.push(u.data()),n.push(i),a.push(s));return[4,Promise.all(t)];case 1:for(l=h.sent(),c=0;c<l.length;++c)f=this.history[n[c]][a[c]],f.dispose(),this.history[n[c]][a[c]]=l[c][0];return[2]}})})},e}(jl),K4=function(r){ge(e,r);function e(t,n){var a=r.call(this)||this;if(a.currentEpoch=0,a.nowFunc=t.nowFunc,a.nextFrameFunc=t.nextFrameFunc||M.nextFrame,a.yieldEvery=n||"auto",a.yieldEvery==="auto"&&(a.yieldEvery=Hbe),a.yieldEvery==="never"&&t.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return M.util.isNumber(a.yieldEvery)&&(a.maybeWait=Gle(a.maybeWait.bind(a),a.yieldEvery,a.nowFunc)),a.trainBegin=t.onTrainBegin,a.trainEnd=t.onTrainEnd,a.epochBegin=t.onEpochBegin,a.epochEnd=t.onEpochEnd,a.batchBegin=t.onBatchBegin,a.batchEnd=t.onBatchEnd,a.yield=t.onYield,a}return e.prototype.maybeWait=function(t,n,a){return Ce(this,void 0,void 0,function(){var i;return Ie(this,function(o){switch(o.label){case 0:return i=[],this.yield==null?[3,2]:[4,os(a)];case 1:o.sent(),i.push(this.yield(t,n,a)),o.label=2;case 2:return i.push(this.nextFrameFunc()),[4,Promise.all(i)];case 3:return o.sent(),[2]}})})},e.prototype.onEpochBegin=function(t,n){return Ce(this,void 0,void 0,function(){return Ie(this,function(a){switch(a.label){case 0:return this.currentEpoch=t,this.epochBegin==null?[3,3]:[4,os(n)];case 1:return a.sent(),[4,this.epochBegin(t,n)];case 2:a.sent(),a.label=3;case 3:return[2]}})})},e.prototype.onEpochEnd=function(t,n){return Ce(this,void 0,void 0,function(){var a;return Ie(this,function(i){switch(i.label){case 0:return a=[],this.epochEnd==null?[3,2]:[4,os(n)];case 1:i.sent(),a.push(this.epochEnd(t,n)),i.label=2;case 2:return this.yieldEvery==="epoch"&&a.push(this.nextFrameFunc()),[4,Promise.all(a)];case 3:return i.sent(),[2]}})})},e.prototype.onBatchBegin=function(t,n){return Ce(this,void 0,void 0,function(){return Ie(this,function(a){switch(a.label){case 0:return this.batchBegin==null?[3,3]:[4,os(n)];case 1:return a.sent(),[4,this.batchBegin(t,n)];case 2:a.sent(),a.label=3;case 3:return[2]}})})},e.prototype.onBatchEnd=function(t,n){return Ce(this,void 0,void 0,function(){var a;return Ie(this,function(i){switch(i.label){case 0:return a=[],this.batchEnd==null?[3,2]:[4,os(n)];case 1:i.sent(),a.push(this.batchEnd(t,n)),i.label=2;case 2:return this.yieldEvery==="batch"?a.push(this.nextFrameFunc()):M.util.isNumber(this.yieldEvery)&&a.push(this.maybeWait(this.currentEpoch,t,n)),[4,Promise.all(a)];case 3:return i.sent(),[2]}})})},e.prototype.onTrainBegin=function(t){return Ce(this,void 0,void 0,function(){return Ie(this,function(n){switch(n.label){case 0:return this.trainBegin==null?[3,3]:[4,os(t)];case 1:return n.sent(),[4,this.trainBegin(t)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.onTrainEnd=function(t){return Ce(this,void 0,void 0,function(){return Ie(this,function(n){switch(n.label){case 0:return this.trainEnd==null?[3,3]:[4,os(t)];case 1:return n.sent(),[4,this.trainEnd(t)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e}(jl);function j4(r,e){if(r==null&&(r={}),r instanceof jl)return[r];if(Array.isArray(r)&&r[0]instanceof jl)return r;var t=cr(r);return t.map(function(n){return new K4(n,e)})}var P1=function(){function r(){}return r.registerCallbackConstructor=function(e,t){M.util.assert(e>=0&&Number.isInteger(e),function(){return"Verbosity level is expected to be an integer >= 0, "+("but got "+e)}),r.checkForDuplicate(t),r.constructors[e]==null&&(r.constructors[e]=[]),r.constructors[e].push(t)},r.checkForDuplicate=function(e){for(var t in r.constructors){var n=r.constructors[+t];n.forEach(function(a){if(a===e)throw new ie("Duplicate callback constructor.")})}},r.clear=function(){r.constructors={}},r.createCallbacks=function(e){var t=[];for(var n in r.constructors){var a=+n;e>=a&&t.push.apply(t,mt(r.constructors[a]))}return t.map(function(i){return new i})},r}();P1.constructors={};function X4(r,e,t,n,a,i,o,s,u){var l=new H4,c=mt([new Kbe],P1.createCallbacks(e));r!=null&&c.push.apply(c,mt(r)),c.push(l);var f=new U4(c);return f.setParams({epochs:t,initialEpoch:n,samples:a,steps:i,batchSize:o,verbose:e,doValidation:s,metrics:u}),{callbackList:f,history:l}}function Si(r,e,t){return e===void 0&&(e={}),t===void 0&&(t=!1),vh(r,M.serialization.SerializationMap.getMap().classNameMap,e,"layer",t)}function qv(r,e){return M.tidy(function(){r.dtype!=="float32"&&(r=_.cast(r,"float32"));var t=_.sum(yh(r),e,!0),n=_.fill(t.shape,Zr()),a=_.sqrt(_.maximum(t,n));return _.div(r,a)})}function ku(r,e){return M.tidy(function(){return _.mean(yh(_.sub(e,r)),-1)})}function lm(r,e){return M.tidy(function(){return _.mean(_.abs(_.sub(e,r)),-1)})}function Zl(r,e){return M.tidy(function(){var t=_.sub(r,e),n=_.clipByValue(_.abs(r),Zr(),Number.MAX_VALUE),a=_.abs(_.div(t,n));return _.mul(100,_.mean(a,-1))})}function jbe(r,e){return M.tidy(function(){var t=_.clipByValue(e,Zr(),Number.MAX_VALUE),n=_.log(_.add(1,t)),a=_.clipByValue(r,Zr(),Number.MAX_VALUE),i=_.log(_.add(1,a));return _.mean(yh(_.sub(n,i)),-1)})}function Xbe(r,e){return M.tidy(function(){var t=_.maximum(0,_.sub(1,_.mul(r,e)));return _.mean(yh(t),-1)})}function Ybe(r,e){return M.tidy(function(){var t=_.maximum(0,_.sub(1,_.mul(r,e)));return _.mean(t,-1)})}function Zbe(r,e){return M.tidy(function(){var t=_.sum(_.mul(r,e),-1),n=_.max(_.mul(_.sub(1,r),e),-1);return _.maximum(0,_.add(1,_.sub(n,t)))})}function Jbe(r,e){return M.tidy(function(){var t=Math.log(2),n=_.sub(e,r),a=_.sub(_.add(n,_.softplus(_.mul(-2,n))),t);return _.mean(a,-1)})}function hh(r,e,t){return t===void 0&&(t=!1),M.tidy(function(){if(t)e=_.softmax(e);else{var n=_.sum(e,e.shape.length-1,!0);e=_.div(e,n)}return e=_.clipByValue(e,Zr(),1-Zr()),_.neg(_.sum(_.mul(_.cast(r,"float32"),_.log(e)),e.shape.length-1))})}function Vv(r,e,t){return t===void 0&&(t=!1),M.tidy(function(){var n=_.cast(_.floor(rce(r)),"int32");e=_.clipByValue(e,Zr(),1-Zr());var a=e.shape,i=_.reshape(_.oneHot(n,a[a.length-1]),a);return hh(i,e,t)})}function Qbe(r,e){if(!M.util.arraysEqual(r.shape,e.shape))throw new ie("logits and labels must have the same shape, but got shapes "+(JSON.stringify(r.shape)+" and "+JSON.stringify(e.shape)));return M.tidy(function(){var t=_.relu(e),n=_.neg(_.abs(e));return _.add(_.sub(t,_.mul(e,r)),_.log1p(_.exp(n)))})}function cm(r,e){return M.tidy(function(){var t;return t=_.clipByValue(e,Zr(),1-Zr()),t=_.log(_.div(t,_.sub(1,t))),_.mean(Qbe(r,t),-1)})}function e1e(r,e){return M.tidy(function(){var t=_.clipByValue(r,Zr(),1),n=_.clipByValue(e,Zr(),1);return _.sum(_.mul(r,_.log(_.div(t,n))),-1)})}function t1e(r,e){return M.tidy(function(){var t=_.log(_.add(Zr(),e));return _.mean(_.sub(e,_.mul(r,t)),-1)})}function M1(r,e){return M.tidy(function(){var t=qv(r,-1),n=qv(e,-1),a=_.mul(t,n);return _.neg(_.sum(a,-1))})}var Gv={meanSquaredError:ku,meanAbsoluteError:lm,meanAbsolutePercentageError:Zl,meanSquaredLogarithmicError:jbe,squaredHinge:Xbe,hinge:Ybe,categoricalHinge:Zbe,logcosh:Jbe,categoricalCrossentropy:hh,sparseCategoricalCrossentropy:Vv,binaryCrossentropy:cm,kullbackLeiblerDivergence:e1e,poisson:t1e,cosineProximity:M1};function gb(r){if(typeof r=="string"){if(r in Gv)return Gv[r];var e="Unknown loss "+r;throw r.toLowerCase().includes("softmaxcrossentropy")&&(e="Unknown loss "+r+'. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new ie(e)}else return r}function B1(r,e){return M.tidy(function(){var t=_.mul(.5,_.onesLike(e)),n=mh(_.greater(e,t),r.dtype);return _.mean(_.equal(r,n),-1)})}function L1(r,e){return M.tidy(function(){return mh(_.equal(_.argMax(r,-1),_.argMax(e,-1)),"float32")})}function Y4(r,e){return M.tidy(function(){return _.cast(_.sum(_.logicalAnd(_.equal(r,1),_.equal(e,1))),"float32")})}function r1e(r,e){return M.tidy(function(){return _.cast(_.sum(_.logicalAnd(_.equal(r,1),_.equal(e,0))),"float32")})}function n1e(r,e){return M.tidy(function(){return _.cast(_.sum(_.logicalAnd(_.equal(r,0),_.equal(e,1))),"float32")})}function Z4(r,e){return M.tidy(function(){var t=Y4(r,e),n=n1e(r,e),a=_.add(t,n);return _.cast(_.where(_.greater(a,0),_.div(t,a),0),"float32")})}function a1e(r,e){return M.tidy(function(){var t=Y4(r,e),n=r1e(r,e),a=_.add(t,n);return _.cast(_.where(_.greater(a,0),_.div(t,a),0),"float32")})}function J4(r,e){return cm(r,e)}function Q4(r,e){return r.rank===e.rank&&(r=_.squeeze(r,[r.rank-1])),e=_.argMax(e,-1),e.dtype!==r.dtype&&(e=_.cast(e,r.dtype)),_.cast(_.equal(r,e),"float32")}var i1e=ku,o1e=ku,s1e=lm,u1e=lm,l1e=Zl,c1e=Zl,z1=hh,f1e=M1,eB=Vv,Uv={binaryAccuracy:B1,categoricalAccuracy:L1,precision:Z4,categoricalCrossentropy:z1,sparseCategoricalCrossentropy:eB,mse:i1e,MSE:o1e,mae:s1e,MAE:u1e,mape:l1e,MAPE:c1e,cosine:f1e};function h1e(r){if(typeof r=="string"&&r in Uv)return Uv[r];if(typeof r!="string"&&r!=null)return r;throw new ie("Unknown metric "+r)}function wv(r){var e,t,n,a;if(Ki(r!==null,"Unknown LossOrMetricFn "+r),typeof r=="string")return r;var i=void 0;try{for(var o=be(Object.keys(Gv)),s=o.next();!s.done;s=o.next()){var u=s.value;if(Gv[u]===r){i=u;break}}}catch(f){e={error:f}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}if(i!==void 0)return i;try{for(var l=be(Object.keys(Uv)),c=l.next();!c.done;c=l.next()){var u=c.value;if(Uv[u]===r){i=u;break}}}catch(f){n={error:f}}finally{try{c&&!c.done&&(a=l.return)&&a.call(l)}finally{if(n)throw n.error}}return i!==void 0?i:r.name}function p1e(r){var e={Adagrad:function(){return M.train.adagrad(.01)},Adadelta:function(){return M.train.adadelta(1,.95,Zr())},Adam:function(){return M.train.adam(.001,.9,.999,Zr())},Adamax:function(){return M.train.adamax(.002,.9,.999,Zr(),0)},RMSProp:function(){return M.train.rmsprop(.001,.9,0,Zr())},SGD:function(){return M.train.sgd(.01)}};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,r in e)return e[r]();throw new ie("Unknown Optimizer "+r)}var KO=1*1024*1024;function jO(r,e,t){if(t===void 0&&(t=!1),r==null||typeof r!="object"||Object.getPrototypeOf(r)!==Object.prototype||!Mb(r))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){var n=JSON.stringify(r);n.length>KO&&console.warn('User-defined metadata of model "'+e+'" is too large in '+("size (length="+n.length+" when serialized). It is not ")+"recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+(KO+"."))}}function Mb(r){var e,t,n,a;if(r===null)return!0;if(typeof r=="object")if(Object.getPrototypeOf(r)===Object.prototype){var i=Object.keys(r);try{for(var o=be(i),s=o.next();!s.done;s=o.next()){var u=s.value;if(typeof u!="string"||!Mb(r[u]))return!1}}catch(p){e={error:p}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return!0}else if(Array.isArray(r)){try{for(var l=be(r),c=l.next();!c.done;c=l.next()){var f=c.value;if(!Mb(f))return!1}}catch(p){n={error:p}}finally{try{c&&!c.done&&(a=l.return)&&a.call(l)}finally{if(n)throw n.error}}return!0}else return!1;else{var h=typeof r;return h==="string"||h==="number"||h==="boolean"}}function d1e(r,e,t,n){n===void 0&&(n=console.log);var a=m1e(r),i=["Layer (type)","Input Shape","Output shape","Param #"];a?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(function(h){return Math.floor(e*h)}));var o;if(!a){i.push("Receives inputs"),o=[];for(var s in r.nodesByDepth)o.push.apply(o,mt(r.nodesByDepth[s]))}n("_".repeat(e)),Hv(i,t,n),n("=".repeat(e));for(var u=r.layers,l=0;l<u.length;++l)a?g1e(u[l],t,n):y1e(u[l],t,o,n),n((l===u.length-1?"=":"_").repeat(e));r.checkTrainableWeightsConsistency();var c=v1e(r),f=Cv(r.nonTrainableWeights);n("Total params: "+(c+f)),n("Trainable params: "+c),n("Non-trainable params: "+f),n("_".repeat(e))}function v1e(r){var e;return r.collectedTrainableWeights!=null?e=Cv(r.collectedTrainableWeights):e=Cv(r.trainableWeights),e}function m1e(r){var e,t,n,a,i,o,s=!0,u=[],l=[];for(var c in r.nodesByDepth)u.push(r.nodesByDepth[c]);try{for(var f=be(u),h=f.next();!h.done;h=f.next()){var p=h.value;if(p.length>1||p.length===1&&p[0].inboundLayers.length>1){s=!1;break}l.push.apply(l,mt(p))}}catch(x){e={error:x}}finally{try{h&&!h.done&&(t=f.return)&&t.call(f)}finally{if(e)throw e.error}}if(s)try{for(var d=be(r.layers),m=d.next();!m.done;m=d.next()){var v=m.value,g=!1;try{for(var y=(i=void 0,be(v.inboundNodes)),b=y.next();!b.done;b=y.next()){var w=b.value;if(l.indexOf(w)!==-1)if(g){s=!1;break}else g=!0}}catch(x){i={error:x}}finally{try{b&&!b.done&&(o=y.return)&&o.call(y)}finally{if(i)throw i.error}}if(!s)break}}catch(x){n={error:x}}finally{try{m&&!m.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}return s}function Hv(r,e,t){t===void 0&&(t=console.log);for(var n="",a=0;a<r.length;++a)a>0&&(n=n.slice(0,n.length-1)+" "),n+=r[a],n=n.slice(0,e[a]),n+=" ".repeat(e[a]-n.length);t(n)}function g1e(r,e,t){var n,a;try{a=r.inboundNodes.map(function(u){return JSON.stringify(u.inputShapes)}).join(",")}catch{a="multiple"}try{n=JSON.stringify(r.outputShape)}catch{n="multiple"}var i=r.name,o=r.getClassName(),s=[i+" ("+o+")",a,n,r.countParams().toString()];Hv(s,e,t)}function y1e(r,e,t,n){var a,i,o,s;try{s=r.inboundNodes.map(function(w){return JSON.stringify(w.inputShapes)}).join(",")}catch{s="multiple"}try{o=JSON.stringify(r.outputShape)}catch{o="multiple"}var u=[];try{for(var l=be(r.inboundNodes),c=l.next();!c.done;c=l.next()){var f=c.value;if(!(t!=null&&t.length>0&&t.indexOf(f)===-1))for(var h=0;h<f.inboundLayers.length;++h){var p=f.inboundLayers[h].name,d=f.nodeIndices[h],m=f.tensorIndices[h];u.push(p+"["+d+"]["+m+"]")}}}catch(w){a={error:w}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}var v=r.name,g=r.getClassName(),y=u.length===0?"":u[0],b=[v+" ("+g+")",s,o,r.countParams().toString(),y];Hv(b,e,n);for(var h=1;h<u.length;++h)Hv(["","","","",u[h]],e,n)}function tB(r,e,t){return(r==="inboundNodes"||r==="outputLayers"||r==="inputLayers")&&e===0&&typeof t=="string"}function ph(r,e){var t,n;if(r===null)return null;if(typeof r=="string")return su(r);if(typeof r=="number"||typeof r=="boolean")return r;if(r instanceof Array){for(var a=[],i=r.length,o=0;o<i;++o){var s=r[o];tB(e,o,s)?a.push(s):a.push(ph(s,e))}return a}else{var u={};try{for(var l=be(Object.keys(r)),c=l.next();!c.done;c=l.next()){var f=c.value,h=r[f];if(f==="name"&&typeof h=="string")u[f]=h;else{var p=su(f);u[p]=ph(h,p)}}}catch(d){t={error:d}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}return u}}function Bb(r,e){var t,n;if(r==null)return null;if(typeof r=="string")return yo(r);if(typeof r=="number"||typeof r=="boolean")return r;if(r instanceof Array){for(var a=[],i=r.length,o=0;o<i;++o){var s=r[o];tB(e,o,s)?a.push(s):a.push(Bb(s,e))}return a}else{var u={};try{for(var l=be(Object.keys(r)),c=l.next();!c.done;c=l.next()){var f=c.value,h=r[f],p=yo(f);(f==="name"||f==="className")&&typeof h=="string"?u[p]=h:u[p]=Bb(h,f)}}catch(d){t={error:d}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}return u}}var $1="3.21.0",b1e=function(r){ge(e,r);function e(t){var n,a,i,o,s,u,l,c,f,h,p,d,m,v,g,y,b,w,x,k,N,T,I,F,D=r.call(this,{})||this;if(D.containerNodes=new Set,D.name=t.name,D.name==null){var R=D.getClassName().toLowerCase();D.name=Kv(R)}if(D.supportsMasking=!1,D.trainable_=!0,Array.isArray(t.inputs)?D.inputs=t.inputs.slice():D.inputs=[t.inputs],Array.isArray(t.outputs)?D.outputs=t.outputs.slice():D.outputs=[t.outputs],us(D.inputs).length!==D.inputs.length)throw new ie("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+(""+D.inputs.map(function(St){return St.name})));us(D.outputs).length!==D.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+(""+D.outputs.map(function(St){return St.name}))),D.inputLayers=[],D.inputLayersNodeIndices=[],D.inputLayersTensorIndices=[],D.outputLayers=[],D.outputLayersNodeIndices=[],D.outputLayersTensorIndices=[],D.layers=[],D.internalContainerRefs=[];try{for(var P=be(D.outputs),B=P.next();!B.done;B=P.next()){var q=B.value,O=q.sourceLayer,V=q.nodeIndex,K=q.tensorIndex;D.outputLayers.push(O),D.outputLayersNodeIndices.push(V),D.outputLayersTensorIndices.push(K)}}catch(St){n={error:St}}finally{try{B&&!B.done&&(a=P.return)&&a.call(P)}finally{if(n)throw n.error}}try{for(var Z=be(D.inputs),j=Z.next();!j.done;j=Z.next()){var q=j.value,O=q.sourceLayer,V=q.nodeIndex,K=q.tensorIndex;Ki(V===0,"input layer has >1 nodes"),Ki(K===0,"input layer has >1 tensors"),D.inputLayers.push(O),D.inputLayersNodeIndices.push(V),D.inputLayersTensorIndices.push(K)}}catch(St){i={error:St}}finally{try{j&&!j.done&&(o=Z.return)&&o.call(Z)}finally{if(i)throw i.error}}D.inputNames=[],D.outputNames=[],D.feedInputShapes=[],D.feedInputNames=[],D.feedOutputNames=[];for(var ee=0;ee<D.inputLayers.length;ee++){var O=D.inputLayers[ee];if(!(O instanceof Xl))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. "+("Received inputs: "+t.inputs+". ")+("Input "+ee+" (0-based) originates ")+("from layer type "+O.getClassName()+"."));D.inputNames.push(O.name),D.feedInputShapes.push(O.batchInputShape),D.feedInputNames.push(O.name)}try{for(var le=be(D.outputLayers),se=le.next();!se.done;se=le.next()){var O=se.value;D.outputNames.push(O.name)}}catch(St){s={error:St}}finally{try{se&&!se.done&&(u=le.return)&&u.call(le)}finally{if(s)throw s.error}}D.internalInputShapes=D.inputs.map(function(St){return St.shape}),D.internalOutputShapes=D.outputs.map(function(St){return St.shape});var ce={},he={},xe={},Se={},we={},ke=[],Ne=function(St,za,pi,Yn,Rs,sS){(Yn==null||Rs==null||sS==null)&&(Yn=St.sourceLayer,Rs=St.nodeIndex,sS=St.tensorIndex);var Sa=Yn.inboundNodes[Rs];if(pi.indexOf(Sa)!==-1)throw new Xi("The tensor "+St.name+' at layer "'+Yn.name+'" is part of a cycle.');if(za.indexOf(Sa)===-1){D.containerNodes.add(e.nodeKey(Yn,Rs)),Yn.id in we||(we[Yn.id]=Object.keys(we).length),pi.indexOf(Sa)===-1&&pi.push(Sa);for(var J6=Sa.inboundLayers.length,ul=0;ul<J6;ul++){var Q6=Sa.inputTensors[ul],eH=Sa.inboundLayers[ul],tH=Sa.nodeIndices[ul],rH=Sa.tensorIndices[ul];Ne(Q6,za,pi,eH,tH,rH)}for(za.push(Sa);pi.indexOf(Sa)>=0;)pi.splice(pi.indexOf(Sa),1);ke.push(Sa)}},Ae=[],Ze=[];try{for(var Et=be(D.outputs),st=Et.next();!st.done;st=Et.next()){var q=st.value;Ne(q,Ae,Ze)}}catch(St){l={error:St}}finally{try{st&&!st.done&&(c=Et.return)&&c.call(Et)}finally{if(l)throw l.error}}var it=ke.slice().reverse();try{for(var ft=be(it),dt=ft.next();!dt.done;dt=ft.next()){var Je=dt.value;he[Je.id]=Je,Je.id in ce||(ce[Je.id]=0);var at=ce[Je.id],nt=xe[Je.outboundLayer.id]==null?0:xe[Je.outboundLayer.id];at=Math.max(at,nt),xe[Je.outboundLayer.id]=at,Se[Je.outboundLayer.id]=Je.outboundLayer,ce[Je.id]=at;for(var ee=0;ee<Je.inboundLayers.length;ee++){var yr=Je.inboundLayers[ee],V=Je.nodeIndices[ee],Ue=yr.inboundNodes[V],_t=ce[Ue.id]==null?0:ce[Ue.id];ce[Ue.id]=Math.max(at+1,_t),he[Ue.id]=Ue}}}catch(St){f={error:St}}finally{try{dt&&!dt.done&&(h=ft.return)&&h.call(ft)}finally{if(f)throw f.error}}var zr={};for(var wn in ce){var at=ce[wn];at in zr||(zr[at]=[]),zr[at].push(he[wn])}var Vr={};for(var $r in xe){var at=xe[$r];at in Vr||(Vr[at]=[]),Vr[at].push(Se[$r])}var br=Object.keys(Vr).map(function(St){return parseInt(St,10)}).sort(mv);D.layers=[];try{for(var jn=be(br),xn=jn.next();!xn.done;xn=jn.next()){var at=xn.value,Xn=Vr[at];Xn.sort(function(za,pi){var Yn=we[za.id],Rs=we[pi.id];return Yn<Rs?-1:Yn>Rs?1:0});try{for(var Dr=(m=void 0,be(Xn)),so=Dr.next();!so.done;so=Dr.next()){var O=so.value;O instanceof e&&D.internalContainerRefs.push(O),D.layers.push(O)}}catch(za){m={error:za}}finally{try{so&&!so.done&&(v=Dr.return)&&v.call(Dr)}finally{if(m)throw m.error}}}}catch(St){p={error:St}}finally{try{xn&&!xn.done&&(d=jn.return)&&d.call(jn)}finally{if(p)throw p.error}}D.layersByDepth=Vr,br=Object.keys(zr).map(function(St){return parseInt(St,10)}).sort(mv);var ol=D.inputs.slice(),Lp=[];try{for(var uo=be(br),Fs=uo.next();!Fs.done;Fs=uo.next()){var at=Fs.value;try{for(var sl=(b=void 0,be(zr[at])),Yc=sl.next();!Yc.done;Yc=sl.next()){var Je=Yc.value,O=Je.outboundLayer;if(O!=null){try{for(var zp=(x=void 0,be(Je.inputTensors)),Zc=zp.next();!Zc.done;Zc=zp.next()){var q=Zc.value;if(ol.indexOf(q)===-1)throw new Xi("Graph disconnected: cannot obtain value for tensor "+q+(' at layer "'+O.name+'". ')+"The following previous layers were accessed without "+("issue: "+Lp))}}catch(Yn){x={error:Yn}}finally{try{Zc&&!Zc.done&&(k=zp.return)&&k.call(zp)}finally{if(x)throw x.error}}try{for(var $p=(N=void 0,be(Je.outputTensors)),Jc=$p.next();!Jc.done;Jc=$p.next()){var q=Jc.value;ol.push(q)}}catch(Yn){N={error:Yn}}finally{try{Jc&&!Jc.done&&(T=$p.return)&&T.call($p)}finally{if(N)throw N.error}}Lp.push(O.name)}}}catch(za){b={error:za}}finally{try{Yc&&!Yc.done&&(w=sl.return)&&w.call(sl)}finally{if(b)throw b.error}}}}catch(St){g={error:St}}finally{try{Fs&&!Fs.done&&(y=uo.return)&&y.call(uo)}finally{if(g)throw g.error}}D.nodesByDepth=zr;var Kg=D.layers.map(function(St){return St.name}),Y6=function(St){var za=Kg.filter(function(pi){return pi===St}).length;if(za!==1)throw new Xi('The name "'+St+'" is used '+za+" times in the model. All layer names should be unique. Layer names: "+JSON.stringify(Kg))};try{for(var Wp=be(Kg),Qc=Wp.next();!Qc.done;Qc=Wp.next()){var Z6=Qc.value;Y6(Z6)}}catch(St){I={error:St}}finally{try{Qc&&!Qc.done&&(F=Wp.return)&&F.call(Wp)}finally{if(I)throw I.error}}return D.outboundNodes=[],D.inboundNodes=[],new rm({outboundLayer:D,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:D.inputs,outputTensors:D.outputs,inputMasks:D.inputs.map(function(St){return null}),outputMasks:D.outputs.map(function(St){return null}),inputShapes:D.inputs.map(function(St){return St.shape}),outputShapes:D.outputs.map(function(St){return St.shape})}),D.built=!0,D._refCount=1,D}return e.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Container '"+this.name+"' is already disposed.")},e.prototype.dispose=function(){var t,n,a,i;this.assertNotDisposed();var o={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){try{for(var s=be(this.layers),u=s.next();!u.done;u=s.next()){var l=u.value;o.numDisposedVariables+=l.dispose().numDisposedVariables}}catch(p){t={error:p}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}try{for(var c=be(this.internalContainerRefs),f=c.next();!f.done;f=c.next()){var h=f.value;o.numDisposedVariables+=h.dispose().numDisposedVariables}}catch(p){a={error:p}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(a)throw a.error}}}return o.refCountAfterDispose=this._refCount,o},Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this.layers.forEach(function(n){n._trainableWeights.forEach(function(a){return a.trainable=t})}),this.trainable_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){var t,n;if(this._trainableWeights.length>0)throw new ie("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var a=[];try{for(var i=be(this.layers),o=i.next();!o.done;o=i.next()){var s=o.value;a=a.concat(s.trainableWeights)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){var t,n,a,i,o=[];try{for(var s=be(this.layers),u=s.next();!u.done;u=s.next()){var l=u.value;o.push.apply(o,mt(l.nonTrainableWeights))}}catch(p){t={error:p}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}if(!this.trainable){var c=[];try{for(var f=be(this.layers),h=f.next();!h.done;h=f.next()){var l=h.value;c.push.apply(c,mt(l.trainableWeights))}}catch(p){a={error:p}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}return c.concat(o)}return o},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!0,configurable:!0}),e.prototype.loadWeights=function(t,n){var a,i,o,s;n===void 0&&(n=!0);var u={},l=0;try{for(var c=be(this.layers),f=c.next();!f.done;f=c.next()){var h=f.value;try{for(var p=(o=void 0,be(h.weights)),d=p.next();!d.done;d=p.next()){var m=d.value;if(u[m.originalName]!=null)throw new ie("Duplicate weight name: "+m.originalName);u[m.originalName]=m,l++}}catch(k){o={error:k}}finally{try{d&&!d.done&&(s=p.return)&&s.call(p)}finally{if(o)throw o.error}}}}catch(k){a={error:k}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(a)throw a.error}}var v=[];for(var g in t){var y=g;if(u[g]==null){var b=g.split("/"),w=b.slice(0,-2).concat([b[b.length-1]]);y=w.join("/")}if(u[y]!=null)v.push([u[y],t[g]]);else if(n)throw new ie("Provided weight data has no target variable: "+g);delete u[y]}if(n){var x=[];for(var g in u)x.push(g);if(x.length>0)throw new ie(x.length+" of "+l+" weights are not set: "+(""+x))}Zb(v)},e.prototype.updatedConfig=function(){var t=this.getConfig(),n={};return n.className=this.getClassName(),n.config=t,n.kerasVersion="tfjs-layers "+$1,n.backend="TensorFlow.js",n},e.prototype.toJSON=function(t,n){n===void 0&&(n=!0);var a=Bb(this.updatedConfig());return n?JSON.stringify(a):a},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){t=cr(t);for(var i=new Bl,o=0;o<a.inputs.length;++o)i.add(a.inputs[o],t[o]);return Jf(a.outputs,i,n)})},e.prototype.computeMask=function(t,n){var a=this;return M.tidy(function(){t=cr(t);var i;return n==null?i=fu(null,t.length):i=cr(n),a.runInternalGraph(t,i)[1]})},e.prototype.computeOutputShape=function(t){var n,a,i,o,s=Iv(t);if(s.length!==this.inputLayers.length)throw new ie("Invalid inputShape argument "+t+": "+("model has "+this.inputLayers.length+" tensor inputs."));for(var u={},l=0;l<s.length;l++){var c=this.inputLayers[l],f=s[l],h=c.name+"_0_0";u[h]=f}var p=Object.keys(this.nodesByDepth).map(function(V){return parseInt(V,10)}).sort(mv);if(p.length>1)try{for(var d=be(p),m=d.next();!m.done;m=d.next()){var v=m.value,g=this.nodesByDepth[v];try{for(var y=(i=void 0,be(g)),b=y.next();!b.done;b=y.next()){var w=b.value,c=w.outboundLayer;if(this.inputLayers.map(function(K){return K.id}).indexOf(c.id)===-1){for(var x=[],k=0;k<w.inboundLayers.length;k++){var N=w.inboundLayers[k],T=w.nodeIndices[k],I=w.tensorIndices[k],h=N.name+"_"+T+"_"+I,F=u[h];x.push(F)}for(var D=c.computeOutputShape(Pn(x)),R=Iv(D),P=c.inboundNodes.indexOf(w),k=0;k<R.length;k++){var h=c.name+"_"+P+"_"+k;u[h]=R[k]}}}}catch(V){i={error:V}}finally{try{b&&!b.done&&(o=y.return)&&o.call(y)}finally{if(i)throw i.error}}}}catch(V){n={error:V}}finally{try{m&&!m.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}for(var B=[],q=[],l=0;l<this.outputLayers.length;l++){var c=this.outputLayers[l],P=this.outputLayersNodeIndices[l],I=this.outputLayersTensorIndices[l],h=c.name+"_"+P+"_"+I;q.push(h)}for(var l=0;l<q.length;l++){var O=q[l];Ki(O in u),B.push(u[O])}return Pn(B)},e.prototype.runInternalGraph=function(t,n){var a,i,o,s,u,l,c,f;n==null&&(n=fu(null,t.length));for(var h={},p=0;p<this.inputs.length;++p){var d=this.inputs[p],m=t[p],v=n[p];h[d.id]=[m,v]}var g=Object.keys(this.nodesByDepth).map(function(Ne){return parseInt(Ne,10)}).sort(mv);try{for(var y=be(g),b=y.next();!b.done;b=y.next()){var w=b.value,x=this.nodesByDepth[w];try{for(var k=(o=void 0,be(x)),N=k.next();!N.done;N=k.next()){var T=N.value,I=T.outboundLayer,F=T.inputTensors,D=T.outputTensors,R=new Array;try{for(var P=(u=void 0,be(F)),B=P.next();!B.done;B=P.next()){var d=B.value;d.id in h&&R.push(h[d.id])}}catch(Ne){u={error:Ne}}finally{try{B&&!B.done&&(l=P.return)&&l.call(P)}finally{if(u)throw u.error}}if(R.length===F.length){var q={},O=void 0,V=void 0,K=void 0,Z=void 0;if(T.callArgs!=null&&(q=T.callArgs),R.length===1){var j=me(R[0],2),ee=j[0],le=j[1];q.mask==null&&(q.mask=le),K=cr(I.call(ee,q)),Z=cr(I.computeMask(ee,le)),O=[ee],V=[le]}else O=R.map(function(Ne){return Ne[0]}),V=R.map(function(Ne){return Ne[1]}),q.mask==null&&(q.mask=V),K=cr(I.call(O,q)),Z=cr(I.computeMask(O,V));if(I.activityRegularizer)throw new Nt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var p=0;p<D.length;++p){var d=D[p],m=K[p],v=Z[p];h[d.id]=[m,v]}}}}catch(Ne){o={error:Ne}}finally{try{N&&!N.done&&(s=k.return)&&s.call(k)}finally{if(o)throw o.error}}}}catch(Ne){a={error:Ne}}finally{try{b&&!b.done&&(i=y.return)&&i.call(y)}finally{if(a)throw a.error}}var se=[],ce=[],he=[];try{for(var xe=be(this.outputs),Se=xe.next();!Se.done;Se=xe.next()){var d=Se.value;Ki(d.id in h,"Could not compute output "+d.name+" : "+d.id);var we=me(h[d.id],2),ke=we[0],v=we[1];he.push(ke.shape),se.push(ke),ce.push(v)}}catch(Ne){c={error:Ne}}finally{try{Se&&!Se.done&&(f=xe.return)&&f.call(xe)}finally{if(c)throw c.error}}return[se,ce,he]},e.prototype.buildNodeConversionMap=function(t){var n,a,i={},o;try{for(var s=be(this.layers),u=s.next();!u.done;u=s.next()){var l=u.value;o=l instanceof e?1:0;for(var c=0;c<l.inboundNodes.length;c++){var f=e.nodeKey(l,c);this.containerNodes.has(f)&&(i[f]=o,o+=1)}}}catch(h){n={error:h}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}return i},e.prototype.getLayer=function(t,n){var a,i;if(n!=null){if(this.layers.length<=n)throw new ie("Was asked to retrieve layer at index "+n+", but model only "+("has "+this.layers.length+" layer(s)."));return this.layers[n]}else if(t==null)throw new ie("Provide either a layer name or layer index");try{for(var o=be(this.layers),s=o.next();!s.done;s=o.next()){var u=s.value;if(u.name===t)return u}}catch(l){a={error:l}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(a)throw a.error}}throw new ie("No such layer: "+t)},e.prototype.calculateLosses=function(){var t=this;return M.tidy(function(){var n,a,i=[];try{for(var o=be(t.layers),s=o.next();!s.done;s=o.next())for(var u=s.value,l=0;l<u.inboundNodes.length;++l){var c=e.nodeKey(u,l);t.containerNodes.has(c)&&i.push.apply(i,mt(u.calculateLosses()))}}catch(f){n={error:f}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}return i})},e.prototype.getConfig=function(){var t,n,a={name:this.name},i=this.buildNodeConversionMap(this.layers),o=[];try{for(var s=be(this.layers),u=s.next();!u.done;u=s.next()){for(var l=u.value,c=l.getClassName(),f=l.getConfig(),h=[],p=0;p<l.inboundNodes.length;p++){var d=l.inboundNodes[p],m=e.nodeKey(l,p),v={};if(this.containerNodes.has(m)){if(d.callArgs)try{JSON.stringify(d.callArgs),v=d.callArgs}catch{console.warn("Layer "+l.name+" was passed non-serializable keyword arguments: "+(d.callArgs+". They will not be included ")+"in the serialized model (and thus will be missing at deserialization time)."),v={}}if(d.inboundLayers.length>0){for(var g=[],y=0;y<d.inboundLayers.length;y++){var b=d.inboundLayers[y],w=d.nodeIndices[y],x=d.tensorIndices[y],k=e.nodeKey(b,w),N=i[k];N==null&&(N=0),g.push([b.name,N,x,v])}h.push(g)}}}var T={};T.name=l.name,T.className=c,T.config=f,T.inboundNodes=h,o.push(T)}}catch(D){t={error:D}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}a.layers=o;for(var I=[],y=0;y<this.inputLayers.length;y++){var l=this.inputLayers[y],w=this.inputLayersNodeIndices[y],m=e.nodeKey(l,w);if(!!this.containerNodes.has(m)){var N=i[m];N==null&&(N=0);var x=this.inputLayersTensorIndices[y];I.push([l.name,N,x])}}a.inputLayers=I;for(var F=[],y=0;y<this.outputLayers.length;y++){var l=this.outputLayers[y],w=this.outputLayersNodeIndices[y],m=e.nodeKey(l,w);if(!!this.containerNodes.has(m)){var N=i[m];N==null&&(N=0);var x=this.outputLayersTensorIndices[y];F.push([l.name,N,x])}}return a.outputLayers=F,a},e.fromConfig=function(t,n,a,i){var o,s,u,l,c,f,h,p,d,m;i===void 0&&(i=!1);var v={},g={};function y(ke,Ne){ke.name in g?g[ke.name].push(Ne):g[ke.name]=[Ne]}function b(ke,Ne){var Ae,Ze,Et=[],st;try{for(var it=be(Ne),ft=it.next();!ft.done;ft=it.next()){var dt=ft.value,Je=dt[0],at=dt[1],nt=dt[2];if(st=dt[3]==null?{}:dt[3],!(Je in v)){y(ke,Ne);return}var yr=v[Je];if(yr.inboundNodes.length<=at){y(ke,Ne);return}var Ue=yr.inboundNodes[at];Et.push(Ue.outputTensors[nt])}}catch(_t){Ae={error:_t}}finally{try{ft&&!ft.done&&(Ze=it.return)&&Ze.call(it)}finally{if(Ae)throw Ae.error}}Et.length>0&&ke.apply(Pn(Et),st)}function w(ke){var Ne=ke.name,Ae=Si(ke,n.customObjects!=null?n.customObjects:{});Ae.setFastWeightInitDuringBuild(i),v[Ne]=Ae;var Ze=ke.inboundNodes;Ze.forEach(function(Et){if(!(Et instanceof Array))throw new ie("Corrupted configuration, expected array for nodeData: "+Et);y(Ae,Et)})}var x=n.name,k=n.layers;try{for(var N=be(k),T=N.next();!T.done;T=N.next()){var I=T.value;w(I)}}catch(ke){o={error:ke}}finally{try{T&&!T.done&&(s=N.return)&&s.call(N)}finally{if(o)throw o.error}}for(;!Vle(g);)try{for(var F=(u=void 0,be(k)),D=F.next();!D.done;D=F.next()){var I=D.value,R=v[I.name];if(R.name in g){var P=g[R.name];delete g[R.name];try{for(var B=(c=void 0,be(P)),q=B.next();!q.done;q=B.next()){var O=q.value;b(R,O)}}catch(Ne){c={error:Ne}}finally{try{q&&!q.done&&(f=B.return)&&f.call(B)}finally{if(c)throw c.error}}}}}catch(ke){u={error:ke}}finally{try{D&&!D.done&&(l=F.return)&&l.call(F)}finally{if(u)throw u.error}}var V=[],K=[],Z=n.inputLayers;try{for(var j=be(Z),ee=j.next();!ee.done;ee=j.next()){var I=ee.value,le=I[0],se=I[1],ce=I[2];Ki(le in v);var R=v[le],he=R.inboundNodes[se].outputTensors;V.push(he[ce])}}catch(ke){h={error:ke}}finally{try{ee&&!ee.done&&(p=j.return)&&p.call(j)}finally{if(h)throw h.error}}var xe=n.outputLayers;try{for(var Se=be(xe),we=Se.next();!we.done;we=Se.next()){var I=we.value,le=I[0],se=I[1],ce=I[2];Ki(le in v);var R=v[le],he=R.inboundNodes[se].outputTensors;K.push(he[ce])}}catch(ke){d={error:ke}}finally{try{we&&!we.done&&(m=Se.return)&&m.call(Se)}finally{if(d)throw d.error}}return new t({inputs:V,outputs:K,name:x})},Object.defineProperty(e.prototype,"stateful",{get:function(){var t,n;if(this._stateful)throw new ie("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");try{for(var a=be(this.layers),i=a.next();!i.done;i=a.next()){var o=i.value;if(o.stateful)return!0}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return!1},enumerable:!0,configurable:!0}),e.prototype.resetStates=function(){var t=this;M.tidy(function(){t.layers.forEach(function(n){n.stateful&&n.resetStates()})})},e}(Dt);function w1e(r,e,t){var n=e.length;if(r==null||Array.isArray(r)&&r.length===0)return e.map(function(i){return null});if(n===1)return Array.isArray(r)&&r.length===1?r:typeof r=="object"&&e[0]in r?[r[e[0]]]:[r];if(Array.isArray(r)){if(r.length!==n)throw new Error("Provided "+t+" is an array of "+r.length+" "+("element(s), but the model has "+n+" outputs. ")+"Make sure a set of weights is provided for each model output.");return r}else if(typeof r=="object"&&Object.keys(r).length>0&&typeof r[Object.keys(r)[0]]=="object"){var a=[];return e.forEach(function(i){i in r?a.push(r[i]):a.push(null)}),a}else throw new Error("The model has multiple ("+n+") outputs, "+("so "+t+" must be either an array with ")+(n+" elements or an object with "+e+" keys. ")+("Provided "+t+" not understood: "+JSON.stringify(r)))}function rB(r,e){return w1e(r,e,"classWeight")}function nB(r,e,t,n){return Ce(this,void 0,void 0,function(){var a,i,o,s,u;return Ie(this,function(l){switch(l.label){case 0:if(e!=null||n!=null)throw new Error("Support sampleWeight is not implemented yet");return t==null?[3,2]:(a=M.tidy(function(){if(r.shape.length===1)return M.clone(r);if(r.shape.length===2)if(r.shape[1]>1){var c=1;return M.argMax(r,c)}else{if(r.shape[1]===1)return M.reshape(r,[r.shape[0]]);throw new Error("Encountered unexpected last-dimension size ("+r.shape[1]+") during handling of class weights. The size is expected to be >= 1.")}else throw new Error("Unexpected rank of target (y) tensor ("+r.rank+") during handling of class weights. The rank is expected to be 1 or 2.")}),s=(o=Array).from,[4,a.data()]);case 1:return i=s.apply(o,[l.sent()]),M.dispose(a),u=[],i.forEach(function(c){if(t[c]==null)throw new Error("classWeight must contain all classes in the training data. "+("The class "+c+" exists in the data but not in ")+"classWeight");u.push(t[c])}),[2,M.tensor1d(u,"float32")];case 2:return[2,null]}})})}function x1e(r,e){return M.mul(r,e)}var k1e=32;function aB(r,e){var t,n,a=e;t=a.xs,n=a.ys,_.util.assert(t!=null&&n!=null,function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+(""+e)});var i=XO("input",r.inputNames,t),o=XO("output",r.outputNames,n),s=i[0].shape[0];_.util.assert(i.length===r.inputs.length,function(){return"LayersModel has "+r.inputs.length+" inputs, but the dataset "+("provides "+i.length+" inputs.  (Expected input keys: ")+(JSON.stringify(r.inputNames)+")")}),_.util.assert(o.length===r.outputs.length,function(){return"LayersModel has "+r.outputs.length+" outputs, but the dataset "+("provides "+o.length+" outputs.  (Expected output keys: ")+(JSON.stringify(r.outputNames)+")")});for(var u=function(h){_.util.assert(i[h].shape[0]===s,function(){return"Batch size mismatch: input "+(r.inputNames[h]+" has "+i[h].shape[0]+"; ")+("expected  "+s+" based on input "+r.inputNames[0]+".")})},l=0;l<i.length;l++)u(l);for(var c=function(h){_.util.assert(o[h].shape[0]===s,function(){return"Batch size mismatch: output "+(r.outputNames[h]+" has "+o[h].shape[0]+"; ")+("expected  "+s+" based on input "+r.inputNames[0]+".")})},f=0;f<o.length;f++)c(f);return{xs:i,ys:o}}function XO(r,e,t){var n,a;if(t instanceof _.Tensor)return[t];if(Array.isArray(t))return _.util.assert(t.length===e.length,function(){return"Received an array of "+t.length+" Tensors, but expected "+e.length+" to match the "+r+" keys "+e+"."}),t;var i=[];try{for(var o=be(e),s=o.next();!s.done;s=o.next()){var u=s.value;if(t[u]==null)throw new ie("The feature data generated by the dataset lacks the required "+(r+" key '"+u+"'."));i.push(t[u])}}catch(l){n={error:l}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}return i}function S1e(r){if(r.length===3)throw new Nt("Validation with sample weights is not implemented yet.");return{xs:r[0],ys:r[1]}}function N1e(r,e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,f,h,p,d,m,v,g,y,b,w,x,k,N,T,I,F,D,j,R,P,B,q,j,O,V,K,Z,j;return Ie(this,function(ee){switch(ee.label){case 0:if(n=t.batchesPerEpoch!=null,_.util.assert(r.optimizer!=null,function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."}),_.util.assert(t!=null,function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."}),_.util.assert(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),function(){return"For fitDataset(), config.epochs is expected to be a positive "+("integer, but got "+t.epochs)}),_.util.assert(!n||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a "+("positive integer if specified, but got "+t.batchesPerEpoch)}),_.util.assert(t.validationSplit==null,function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."}),r.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");r.isTraining=!0,ee.label=1;case 1:return ee.trys.push([1,,26,27]),a=t.validationData!=null,i=void 0,o=void 0,a&&(YO(t.validationData)?_.util.assert(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, "+("but got "+t.validationBatches)}):(s=S1e(t.validationData),i=s.xs,o=s.ys)),u=r.makeTrainFunction(),l=r.getDedupedMetricsNames(),c=void 0,a?c=l.slice().concat(l.map(function(le){return"val_"+le})):c=l.slice(),f=j4(t.callbacks,t.yieldEvery),h=t.verbose==null?1:t.verbose,p=X4(f,h,t.epochs,null,null,E1e(e,t),null,a,c),d=p.callbackList,m=p.history,d.setModel(r),r.history=m,[4,d.onTrainBegin()];case 2:return ee.sent(),r.stopTraining_=!1,v=t.initialEpoch==null?0:t.initialEpoch,[4,e.iterator()];case 3:g=ee.sent(),ee.label=4;case 4:return v<t.epochs?(y={},[4,d.onEpochBegin(v)]):[3,23];case 5:return ee.sent(),b=0,w=0,n?[3,7]:[4,e.iterator()];case 6:g=ee.sent(),ee.label=7;case 7:return!n||b<t.batchesPerEpoch?[4,g.next()]:[3,21];case 8:return x=ee.sent(),n&&x.done?(console.warn("You provided `batchesPerEpoch` as "+(t.batchesPerEpoch+", ")+"but your dataset iterator ran out of data after "+(b+" batches; ")+"interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+(t.batchesPerEpoch*t.epochs+" batches). ")+"You may need to use the repeat() function when building your dataset."),[3,21]):x.value==null?[3,15]:(k=aB(r,x.value),N=k.xs,T=k.ys,I={},I.batch=w,I.size=N[0].shape[0],[4,d.onBatchBegin(w,I)]);case 9:if(ee.sent(),F=[],t.classWeight==null)return[3,13];D=rB(t.classWeight,r.outputNames),j=0,ee.label=10;case 10:return j<D.length?(P=(R=F).push,[4,nB(T[j],null,D[j])]):[3,13];case 11:P.apply(R,[ee.sent()]),ee.label=12;case 12:return++j,[3,10];case 13:for(B=N.concat(T).concat(F),q=u(B),_.dispose(B),j=0;j<l.length;++j)O=l[j],V=q[j],I[O]=V,_.keep(V);return[4,d.onBatchEnd(w,I)];case 14:ee.sent(),G4(I),w++,b++,ee.label=15;case 15:return(n?b>=t.batchesPerEpoch:x.done)?a?(K=void 0,YO(t.validationData)?(Z=cr,[4,r.evaluateDataset(t.validationData,{batches:t.validationBatches})]):[3,17]):[3,19]:[3,20];case 16:return K=Z.apply(void 0,[ee.sent()]),[3,18];case 17:K=cr(r.evaluate(i,o,{batchSize:t.validationBatchSize==null?k1e:t.validationBatchSize,verbose:0})),ee.label=18;case 18:for(j=0;j<r.metricsNames.length;++j)y["val_"+r.metricsNames[j]]=K[j];ee.label=19;case 19:return[3,21];case 20:return r.stopTraining_?[3,21]:[3,7];case 21:return[4,d.onEpochEnd(v,y)];case 22:return ee.sent(),v++,r.stopTraining_?[3,23]:[3,4];case 23:return[4,d.onTrainEnd()];case 24:return ee.sent(),[4,r.history.syncData()];case 25:return ee.sent(),[2,r.history];case 26:return r.isTraining=!1,[7];case 27:return[2]}})})}function E1e(r,e){var t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(r.size)&&(t=r.size),t}function YO(r){return typeof r.iterator=="function"}function T1e(r){return typeof r.next=="function"}function I1e(r,e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,f,h,p;return Ie(this,function(d){switch(d.label){case 0:if(t=t||{},n=t.batches!=null,a=r.testFunction,i=[],t.verbose>0)throw new Nt("Verbose mode is not implemented yet.");return _.util.assert(!n||t.batches>0&&Number.isInteger(t.batches),function(){return"Test loop expects `batches` to be a positive integer, but "+("received "+JSON.stringify(t.batches))}),T1e(e)?(s=e,[3,3]):[3,1];case 1:return[4,e.iterator()];case 2:s=d.sent(),d.label=3;case 3:o=s,u=0,l=0,c=function(){var m;return Ie(this,function(v){switch(v.label){case 0:return[4,o.next()];case 1:return m=v.sent(),i=_.tidy(function(){if(m.value){var g=aB(r,m.value),y=g.xs,b=g.ys,w=y.concat(b),x=_.tidy(function(){return a(w)});if(_.dispose(w),l===0)for(var k=0;k<x.length;++k)i.push(M.scalar(0));for(var N=w[0].shape[0],T=function(I){var F=x[I],D=i[I];i[I]=_.tidy(function(){return _.add(i[I],_.mul(N,F))}),l>0&&_.dispose(D)},k=0;k<x.length;++k)T(k);_.dispose(x),u+=N,++l}return i}),m.done?(n&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` "+("batches (in this case, "+t.batches+" batches). ")+"You may need to use the repeat() function when building your dataset."),[2,"break"]):[2]}})},d.label=4;case 4:return!n||l<t.batches?[5,c()]:[3,6];case 5:return f=d.sent(),f==="break"?[3,6]:[3,4];case 6:for(h=0;h<i.length;++h)p=i[h],i[h]=_.div(i[h],u),_.dispose(p);return[2,Pn(i)]}})})}function Lb(r){_.util.assert(r>0&&Number.isInteger(r),function(){return"batchSize is required to be a positive integer, but got "+r})}function rh(r,e,t){return r==null?[null]:Array.isArray(r)?r.map(function(n){return cu(n,e,t-e)}):cu(r,e,t-e)}function W1(r,e){return _.tidy(function(){return r==null?null:Array.isArray(r)?r.map(function(t){return W1(t,e)}):hP(r,e.dtype==="int32"?e:_.cast(e,"int32"))})}function zb(r,e){for(var t=[],n=0,a=null;n<r;)a=n+e,a>=r&&(a=r),t.push([n,a]),n=a;return t}function C1e(r,e,t,n,a,i,o,s,u,l,c,f,h,p,d){return Ce(this,void 0,void 0,function(){var m,v,g,y,b,w,x,k,N;return Ie(this,function(T){switch(T.label){case 0:if(a==null&&(a=32),i==null&&(i=1),c==null&&(c=!0),h==null&&(h=0),m=!1,u!=null&&l!=null&&(m=!0),d!=null&&(m=!0,p==null))throw new ie("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");return v=r.checkNumSamples(t,a,p,"steps_per_epoch"),v!=null&&(g=Ei(0,v)),o==null&&(o=1),y=X4(s,o,i,h,v,p,a,m,f),b=y.callbackList,w=y.history,b.setModel(r),r.history=w,[4,b.onTrainBegin()];case 1:T.sent(),r.stopTraining_=!1,x=function(I){var F,D,R,P,B,q;return Ie(this,function(O){switch(O.label){case 0:return[4,b.onEpochBegin(I)];case 1:if(O.sent(),F={},p==null)return[3,2];throw new Nt("stepsPerEpoch mode is not implemented yet.");case 2:if(c==="batch")throw new Nt("batch shuffling is not implemneted yet");c&&M.util.shuffle(g),D=M.tensor1d(g),R=zb(v,a),P=function(V){var K;return Ie(this,function(Z){switch(Z.label){case 0:return K={},[4,b.onBatchBegin(V,K)];case 1:return Z.sent(),_.tidy(function(){var j=R[V][0],ee=R[V][1],le=cu(D,j,ee-j);K.batch=V,K.size=ee-j;for(var se=W1(t,le),ce=e(se),he=0;he<n.length;++he){var xe=n[he],Se=ce[he];K[xe]=Se,_.keep(Se)}if(V===R.length-1&&m)for(var we=r.testLoop(u,l,a),he=0;he<n.length;++he){var xe=n[he],Se=we[he];_.keep(Se),F["val_"+xe]=Se}}),[4,b.onBatchEnd(V,K)];case 2:return Z.sent(),G4(K),r.stopTraining_?[2,"break"]:[2]}})},B=0,O.label=3;case 3:return B<R.length?[5,P(B)]:[3,6];case 4:if(q=O.sent(),q==="break")return[3,6];O.label=5;case 5:return++B,[3,3];case 6:D.dispose(),O.label=7;case 7:return[4,b.onEpochEnd(I,F)];case 8:return O.sent(),r.stopTraining_?[2,"break"]:[2]}})},k=h,T.label=2;case 2:return k<i?[5,x(k)]:[3,5];case 3:if(N=T.sent(),N==="break")return[3,5];T.label=4;case 4:return++k,[3,2];case 5:return[4,b.onTrainEnd()];case 6:return T.sent(),[4,r.history.syncData()];case 7:return T.sent(),[2,r.history]}})})}function A1e(r,e,t,n){return n===void 0&&(n={}),Ce(this,void 0,void 0,function(){var a,i,o,s,u,l,c,f,h,p,d,m,v,g,y,b,w,x,k,N,T,I,F,D,R;return Ie(this,function(P){switch(P.label){case 0:if(r.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");r.isTraining=!0,P.label=1;case 1:return P.trys.push([1,,7,8]),p=n.batchSize==null?32:n.batchSize,Lb(p),d=!1,[4,r.standardizeUserData(e,t,n.sampleWeight,n.classWeight,d,p)];case 2:if(m=P.sent(),a=m[0],i=m[1],h=m[2],v=!1,g=void 0,!(n.validationData!=null&&n.validationData.length>0))return[3,4];if(v=!0,n.validationData.length===2)u=n.validationData[0],l=n.validationData[1];else throw n.validationData.length===3?new Nt("validationData including sample weights is not supported yet."):new ie("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+(n.validationData+" is invalid."));return y=!0,[4,r.standardizeUserData(u,l,null,null,y,p)];case 3:return b=P.sent(),c=b[0],f=b[1],g=c.concat(f),[3,5];case 4:n.validationSplit!=null&&n.validationSplit>0&&n.validationSplit<1?(v=!0,w=Math.floor(a[0].shape[0]*(1-n.validationSplit)),x=a[0].shape[0],c=rh(a,w,x),o=a,a=rh(a,0,w),f=rh(i,w,x),s=i,i=rh(i,0,w),g=c.concat(f)):n.validationSteps!=null&&(v=!0),P.label=5;case 5:return k=a.concat(i).concat(h),r.checkTrainableWeightsConsistency(),N=r.makeTrainFunction(),T=r.getDedupedMetricsNames(),I=void 0,F=void 0,v?(r.makeTestFunction(),I=r.testFunction,F=T.slice().concat(T.map(function(B){return"val_"+B}))):(I=null,g=[],F=T.slice()),D=j4(n.callbacks,n.yieldEvery),[4,C1e(r,N,k,T,p,n.epochs,n.verbose,D,I,g,n.shuffle,F,n.initialEpoch,null,null)];case 6:return R=P.sent(),[2,R];case 7:return r.isTraining=!1,xi(a,e),xi(i,t),xi(o,e),xi(s,t),xi(c,u),xi(f,l),h!=null&&_.dispose(h),[7];case 8:return[2]}})})}function iB(r){var e=[];r instanceof M.Tensor&&(r=[r]);for(var t=0;t<r.length;++t){var n=r[t];if(n.rank===1)e.push(gh(n,1));else{if(n.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(n)}}return e}function xi(r,e){if(r!=null){var t=[];if(e instanceof M.Tensor)t.push(e.id);else if(Array.isArray(e))e.forEach(function(s){return t.push(s.id)});else if(e!=null)for(var n in e){var a=e[n];t.push(a.id)}var i=[];if(r instanceof M.Tensor)t.indexOf(r.id)===-1&&i.push(r);else if(Array.isArray(r))r.forEach(function(s){t.indexOf(s.id)===-1&&i.push(s)});else if(r!=null)for(var n in r){var o=r[n];t.indexOf(o.id)===-1&&i.push(o)}i.forEach(function(s){s.isDisposed||s.dispose()})}}function _1e(r){return r instanceof M.Tensor}function $b(r){return Array.isArray(r)}function ZO(r){return!_1e(r)&&!$b(r)}function JO(r,e,t,n,a){var i,o;if(n===void 0&&(n=!0),a===void 0&&(a=""),e==null||e.length===0){if(r!=null){var s=!1;if($b(r)&&r.length>0)s=!0;else if(ZO(r)){for(var u in r)if(r.hasOwnProperty(u)){s=!0;break}}else s=!0;if(s)throw new ie("Error when checking model "+a+" expected no data, "+("but got "+r))}return[]}if(r==null)return e.map(function(y){return null});var l;if(ZO(r)){r=r,l=[];try{for(var c=be(e),f=c.next();!f.done;f=c.next()){var h=f.value;if(r[h]==null)throw new ie('No data provided for "'+h+'". Need data for each key in: '+(""+e));l.push(r[h])}}catch(y){i={error:y}}finally{try{f&&!f.done&&(o=c.return)&&o.call(c)}finally{if(i)throw i.error}}}else if($b(r)){if(r=r,r.length!==e.length)throw new ie("Error when checking model "+a+": the Array of Tensors that you are passing to your model is not the size the "+("model expected. Expected to see "+e.length+" Tensor(s), but ")+("instead got the following list of Tensor(s): "+r));l=r}else{if(r=r,e.length>1)throw new ie("The model "+a+" expects "+e.length+" Tensor(s), "+("but only received one Tensor. Found: Tensor with shape "+r.shape));l=[r]}if(l=iB(l),t!=null){for(var p=0;p<e.length;++p)if(t[p]!=null){var d=l[p];if(d.shape.length!==t[p].length)throw new ie("Error when checking "+a+": expected "+e[p]+" "+("to have "+t[p].length+" dimension(s). but got array with ")+("shape "+d.shape));for(var m=0;m<t[p].length;++m)if(!(m===0&&!n)){var v=d.shape[m],g=t[p][m];if(g!=null&&g>=0&&v!==g)throw new ie(a+" expected a batch of elements where each "+("example has shape ["+t[p].slice(1,t[p].length)+"] ")+("(i.e.,tensor shape [*,"+t[p].slice(1,t[p].length)+"])")+(" but the "+a+" received an input with "+d.shape[0])+(" examples, each with shape ["+d.shape.slice(1,d.shape.length)+"]")+(" (tensor shape ["+d.shape+"])"))}}}return l}function D1e(r,e,t){var n=us(r.map(function(i){return i.shape[0]}));n.sort();var a=us(e.map(function(i){return i.shape[0]}));if(a.sort(),n.length>1)throw new ie("All input Tensors (x) should have the same number of samples. Got array shapes: "+(""+JSON.stringify(r.map(function(i){return i.shape}))));if(a.length>1)throw new ie("All target Tensors (y) should have the same number of samples. Got array shapes: "+(""+JSON.stringify(e.map(function(i){return i.shape}))));if(n.length>0&&a.length>0&&!M.util.arraysEqual(n,a))throw new ie("Input Tensors should have the same number of samples as target "+("Tensors. Found "+n[0]+" input sample(s) and "+a[0]+" target ")+"sample(s).")}function F1e(r,e,t){for(var n=[ku,cm,hh],a=0;a<r.length;++a){var i=r[a],o=e[a],s=t[a];if(o!=null){if(o===hh&&i.shape[i.shape.length-1]===1)throw new ie("You are passing a target array of shape "+i.shape+" while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(n.indexOf(o)!==-1)for(var u=i.shape.slice(1),l=s.slice(1),c=0;c<u.length;++c){var f=u[c],h=l[c];if(h!=null&&f!==h)throw new ie("A target Tensor with shape "+i.shape+" was passed for an "+("output of shape "+s+", while using a loss function that ")+"expects targets to have the same shape as the output.")}}}}function QO(r,e,t,n,a){n===void 0&&(n=!0),a===void 0&&(a="");var i;if(Array.isArray(r)){if(r.length!==e.length)throw new ie("Error when checking model "+a+": the Array of Tensors that you are passing to your model is not the size the "+("the model expected. Expected to see "+e.length+" Tensor(s),")+(" but instead got "+r.length+" Tensors(s)."));i=r}else{if(e.length>1)throw new ie("The model expects "+e.length+" "+a+" Tensors, but only received one Tensor. Found: array with shape "+(JSON.stringify(r.shape)+"."));i=[r]}if(t!=null){for(var o=0;o<e.length;++o)if(t[o]!=null){var s=i[o];if(s.shape.length!==t[o].length)throw new ie("Error when checking "+a+": expected "+e[o]+" "+("to have "+t[o].length+" dimension(s), but got array with ")+("shape "+JSON.stringify(s.shape)));for(var u=0;u<t[o].length;++u)if(!(u===0&&!n)){var l=s.shape[u],c=t[o][u];if(c!=null&&c!==l)throw new ie("Error when checking "+a+": expected "+(e[o]+" to have shape "+JSON.stringify(t[o])+" but ")+("got array with shape "+JSON.stringify(s.shape)+"."))}}}}function R1e(r,e){var t,n;if(r==null||Array.isArray(r)&&r.length===0)return e.map(function(c){return[]});var a;if(typeof r=="string"||typeof r=="function")a=[r];else if(Array.isArray(r)||typeof r=="object")a=r;else throw new TypeError("Type of metrics argument not understood. Expected an string,"+("function, Array, or Object, found: "+r));if(Array.isArray(a))return e.map(function(c){return a});var i=[];try{for(var o=be(e),s=o.next();!s.done;s=o.next()){var u=s.value,l=a.hasOwnProperty(u)?a[u]:[];Array.isArray(l)||(l=[l]),i.push(l)}}catch(c){t={error:c}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i}var O1e="layers-model",bo=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;return n.isTraining=!1,n}return e.prototype.summary=function(t,n,a){if(a===void 0&&(a=console.log),!this.built)throw new ie("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");d1e(this,t,n,a)},e.prototype.compile=function(t){var n,a,i=this;if(t.loss==null&&(t.loss=[]),this.loss=t.loss,typeof t.optimizer=="string")this.optimizer_=p1e(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof M.Optimizer))throw new ie("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}var o=[];if(!Array.isArray(t.loss)&&typeof t.loss!="string"&&typeof t.loss!="function"){t.loss=t.loss;for(var s in t.loss)if(this.outputNames.indexOf(s)===-1)throw new ie('Unknown entry in loss dictionary: "'+s+'". '+("Only expected the following keys: "+this.outputNames));try{for(var u=be(this.outputNames),l=u.next();!l.done;l=u.next()){var s=l.value;t.loss[s]==null&&console.warn('Output "'+s+'" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data '+("to be passed to "+s+" during training")),o.push(gb(t.loss[s]))}}catch(g){n={error:g}}finally{try{l&&!l.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}}else if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new ie("When passing an Array as loss, it should have one entry per "+("model output. The model has "+this.outputs.length+" output(s), ")+("but you passed loss="+t.loss+"."));var c=t.loss;o=c.map(function(g){return gb(g)})}else{var f=gb(t.loss);this.outputs.forEach(function(g){o.push(f)})}this.lossFunctions=o,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var h=0;h<this.outputs.length;++h){var p=this.internalOutputShapes[h],s=this.outputNames[h];this.feedOutputNames.push(s),this.feedOutputShapes.push(p),this.feedLossFns.push(this.lossFunctions[h])}var d=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],lu("loss",function(){for(var g=0;g<i.outputs.length;++g)if(d.indexOf(g)===-1){var y=i.lossFunctions[g];i.outputs.length>1&&(i.metricsTensors.push([y,g]),i.metricsNames.push(i.outputNames[g]+"_loss"))}});var m=R1e(t.metrics,this.outputNames),v=function(g,y,b){i.outputNames.length>1&&(y=i.outputNames[g]+"_"+y),i.metricsNames.push(y),i.metricsTensors.push([b,g])};lu("metric",function(){for(var g=function(b){if(d.indexOf(b)!==-1)return"continue";var w=m[b],x=function(k){var N,T,I="",F,D,R,P=function(V){if(typeof V=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(V)!==-1){var K=i.internalOutputShapes[b];K[K.length-1]===1||i.lossFunctions[b]===cm?["accuracy","acc"].indexOf(V)!==-1?D=B1:["crossentropy","ce"].indexOf(V)!==-1&&(D=J4):i.lossFunctions[b]===Vv?["accuracy","acc"].indexOf(V)!==-1?D=Q4:["crossentropy","ce"].indexOf(V)!==-1&&(D=eB):["accuracy","acc"].indexOf(V)!==-1?D=L1:["crossentropy","ce"].indexOf(V)!==-1&&(D=z1);var Z=void 0;["accuracy","acc"].indexOf(V)!==-1?Z="acc":["crossentropy","ce"].indexOf(V)!==-1&&(Z="ce"),R=D,F=I+Z}else{var j=h1e(V);R=j,F=I+wv(V)}var ee;lu(F,function(){ee=R}),v(b,F,ee)};try{for(var B=(N=void 0,be(k)),q=B.next();!q.done;q=B.next()){var O=q.value;P(O)}}catch(V){N={error:V}}finally{try{q&&!q.done&&(T=B.return)&&T.call(B)}finally{if(N)throw N.error}}};x(w)},y=0;y<i.outputs.length;++y)g(y)}),this.collectedTrainableWeights=this.trainableWeights},e.prototype.checkTrainableWeightsConsistency=function(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},e.prototype.evaluate=function(t,n,a){a===void 0&&(a={});var i=a.batchSize==null?32:a.batchSize;Lb(i);var o=!0,s=this.standardizeUserDataXY(t,n,o,i);try{var u=s[0].concat(s[1]);this.makeTestFunction();var l=this.testFunction,c=this.testLoop(l,u,i,a.verbose,a.steps);return Pn(c)}finally{xi(s[0],t),xi(s[1],n)}},e.prototype.evaluateDataset=function(t,n){return Ce(this,void 0,void 0,function(){return Ie(this,function(a){return this.makeTestFunction(),[2,I1e(this,t,n)]})})},e.prototype.checkNumSamples=function(t,n,a,i){i===void 0&&(i="steps");var o;if(a!=null){if(o=null,n!=null)throw new ie("If "+i+" is set, batchSize must be null or undefined."+("Got batchSize = "+n))}else if(t!=null)Array.isArray(t)?o=t[0].shape[0]:o=t.shape[0];else throw new ie("Either the input data should have a defined shape, or "+(i+" shoud be specified."));return o},e.prototype.execute=function(t,n){var a,i;if(Array.isArray(n)&&n.length===0)throw new ie("`outputs` is an empty Array, which is not allowed.");var o=Array.isArray(n),s=o?n:[n],u=this.retrieveSymbolicTensors(s),l=new Bl;if(t instanceof M.Tensor&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new ie("The number of inputs provided ("+t.length+") does not match the number of inputs of this model "+("("+this.inputs.length+")."));for(var c=0;c<this.inputs.length;++c)l.add(this.inputs[c],t[c])}else try{for(var f=be(this.inputs),h=f.next();!h.done;h=f.next()){var p=h.value,d=t[p.name];if(d==null)throw new ie("No value is provided for the model's input "+p.name);l.add(p,d)}}catch(v){a={error:v}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}var m=Jf(u,l);return o?m:m[0]},e.prototype.retrieveSymbolicTensors=function(t){var n,a,i=fu(null,t.length),o=t.length;try{for(var s=be(this.layers),u=s.next();!u.done;u=s.next()){for(var l=u.value,c=Array.isArray(l.output)?l.output:[l.output],f=c.map(function(m){return m.name}),h=0;h<t.length;++h){var p=f.indexOf(t[h]);if(p!==-1&&(i[h]=c[p],o--),o===0)break}if(o===0)break}}catch(m){n={error:m}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}if(o>0){var d=[];throw i.forEach(function(m,v){m==null&&d.push(t[v])}),new ie("Cannot find SymbolicTensors for output name(s): "+(""+JSON.stringify(d)))}return i},e.prototype.predictLoop=function(t,n,a){var i=this;return n===void 0&&(n=32),a===void 0&&(a=!1),_.tidy(function(){var o=i.checkNumSamples(t);if(a)throw new Nt("Verbose predictLoop() is not implemented yet.");for(var s=zb(o,n),u=i.outputs.map(function(f){return[]}),l=function(f){var h=_.tidy(function(){var p=s[f][0],d=s[f][1],m=rh(t,p,d),v=[];if(Array.isArray(m))for(var g=0;g<m.length;++g)v.push({key:i.inputs[g],value:m[g]});else v.push({key:i.inputs[0],value:m});var y=new Bl(v);return Jf(i.outputs,y)});h.forEach(function(p,d){return u[d].push(p)})},c=0;c<s.length;++c)l(c);return Pn(u.map(function(f){return _.concat(f,0)}))})},e.prototype.predict=function(t,n){n===void 0&&(n={});var a=iB(t);QO(a,this.inputNames,this.feedInputShapes,!1);try{var i=n.batchSize==null?32:n.batchSize;return Lb(i),this.predictLoop(a,i)}finally{xi(a,t)}},e.prototype.predictOnBatch=function(t){QO(t,this.inputNames,this.feedInputShapes,!0);var n=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,n)},e.prototype.standardizeUserDataXY=function(t,n,a,i){if(this.optimizer_==null)throw new Xi("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var o=[],s=0;s<this.feedOutputShapes.length;++s){var u=this.feedOutputShapes[s],l=this.feedLossFns[s];l===Vv?o.push(u.slice(0,u.length-1).concat([1])):o.push(u)}if(t=JO(t,this.feedInputNames,this.feedInputShapes,!1,"input"),n=JO(n,this.feedOutputNames,o,!1,"target"),D1e(t,n),F1e(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&i!=null&&i>0&&t[0].shape[0]%i!==0)throw new ie("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+(i+". Found: "+t[0].shape[0]+" sample(s)."));return[t,n]},e.prototype.standardizeUserData=function(t,n,a,i,o,s){return o===void 0&&(o=!0),Ce(this,void 0,void 0,function(){var u,l,c,f,h,p,d,m;return Ie(this,function(v){switch(v.label){case 0:if(u=me(this.standardizeUserDataXY(t,n,o,s),2),l=u[0],c=u[1],a!=null)throw new Error("sample weight is not supported yet.");if(f=null,i==null)return[3,4];h=rB(i,this.outputNames),f=[],p=0,v.label=1;case 1:return p<h.length?(m=(d=f).push,[4,nB(c[p],null,h[p])]):[3,4];case 2:m.apply(d,[v.sent()]),v.label=3;case 3:return++p,[3,1];case 4:return[2,[l,c,f]]}})})},e.prototype.testLoop=function(t,n,a,i,o){var s=this;return i===void 0&&(i=0),_.tidy(function(){var u=s.checkNumSamples(n,a,o,"steps"),l=[];if(i>0)throw new Nt("Verbose mode is not implemented yet.");if(o!=null)throw new Nt("steps mode in testLoop() is not implemented yet");for(var c=zb(u,a),f=M.tensor1d(Ei(0,u)),h=0;h<c.length;++h){var p=c[h][0],d=c[h][1],m=cu(f,p,d-p),v=W1(n,m),g=t(v);if(h===0)for(var y=0;y<g.length;++y)l.push(M.scalar(0));for(var y=0;y<g.length;++y){var b=g[y];l[y]=_.add(l[y],_.mul(d-p,b))}}for(var y=0;y<l.length;++y)l[y]=_.div(l[y],u);return l})},e.prototype.getDedupedMetricsNames=function(){for(var t=this.metricsNames,n=[],a=0;a<t.length;++a){var i=t[a],o=i;if(QR(t,i)>1){var s=QR(t.slice(0,a),i);o+="_"+s}n.push(o)}return n},e.prototype.makeTrainFunction=function(){var t=this;return function(n){var a=[],i=n.slice(0,t.inputs.length),o=n.slice(t.inputs.length,t.inputs.length+t.outputs.length),s=n.slice(t.inputs.length+t.outputs.length,t.inputs.length+t.outputs.length*2),u=[],l=function(){for(var p=[],d=0;d<t.inputs.length;++d)p.push({key:t.inputs[d],value:i[d]});for(var m=new Bl(p),v=Jf(t.outputs,m,{training:!0}),g,d=0;d<t.lossFunctions.length;++d){var y=t.lossFunctions[d],b=y(o[d],v[d]);s[d]!=null&&(b=x1e(b,s[d]));var w=_.mean(b);a.push(w),d===0?g=b:g=_.add(g,b)}for(var d=0;d<t.metricsTensors.length;++d){var x=void 0;if(t.outputs.length>1&&d<t.outputs.length)x=a[d];else{var k=t.metricsTensors[d][0],N=t.metricsTensors[d][1];x=_.mean(k(o[N],v[N]))}_.keep(x),u.push(x)}return g=_.mean(g),t.calculateLosses().forEach(function(T){g=_.add(g,T)}),g},c=t.collectedTrainableWeights.map(function(p){return p.read()}),f=!0,h=t.optimizer_.minimize(l,f,c);return[h].concat(u)}},e.prototype.makeTestFunction=function(){var t=this;this.testFunction=function(n){return _.tidy(function(){for(var a=[],i,o=n.slice(0,t.inputs.length),s=n.slice(t.inputs.length,t.inputs.length+t.outputs.length),u=[],l=0;l<t.inputs.length;++l)u.push({key:t.inputs[l],value:o[l]});for(var c=new Bl(u),f=Jf(t.outputs,c),l=0;l<t.lossFunctions.length;++l){var h=t.lossFunctions[l],p=_.mean(h(s[l],f[l]));l===0?i=p:i=_.add(i,p),a.push(i)}for(var l=0;l<t.metricsTensors.length;++l){var d=t.metricsTensors[l][0],m=t.metricsTensors[l][1],v=_.mean(d(s[m],f[m]));a.push(v)}return a})}},e.prototype.fit=function(t,n,a){return a===void 0&&(a={}),Ce(this,void 0,void 0,function(){return Ie(this,function(i){return[2,A1e(this,t,n,a)]})})},e.prototype.fitDataset=function(t,n){return Ce(this,void 0,void 0,function(){return Ie(this,function(a){return[2,N1e(this,t,n)]})})},e.prototype.trainOnBatch=function(t,n){return Ce(this,void 0,void 0,function(){var a,i,o,s,u,l,c,f,h,p,d,m,v;return Ie(this,function(g){switch(g.label){case 0:return[4,this.standardizeUserData(t,n)];case 1:a=g.sent(),i=a[0],o=a[1],s=this.makeTrainFunction(),u=s(i.concat(o)),l=[],g.label=2;case 2:g.trys.push([2,7,8,9]),c=be(u),f=c.next(),g.label=3;case 3:return f.done?[3,6]:(h=f.value,[4,h.data()]);case 4:p=g.sent(),l.push(p[0]),g.label=5;case 5:return f=c.next(),[3,3];case 6:return[3,9];case 7:return d=g.sent(),m={error:d},[3,9];case 8:try{f&&!f.done&&(v=c.return)&&v.call(c)}finally{if(m)throw m.error}return[7];case 9:return _.dispose(u),xi(a[0],t),xi(a[1],n),[2,Pn(l)]}})})},e.prototype.getNamedWeights=function(t){for(var n=[],a=t!=null&&t.trainableOnly,i=a?this.trainableWeights:this.weights,o=this.getWeights(a),s=0;s<i.length;++s)a&&!i[s].trainable||n.push({name:i[s].originalName,tensor:o[s]});return n},Object.defineProperty(e.prototype,"stopTraining",{get:function(){return this.stopTraining_},set:function(t){this.stopTraining_=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"optimizer",{get:function(){return this.optimizer_},set:function(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var t=r.prototype.dispose.call(this);if(t.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){var n=_.memory().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=n-_.memory().numTensors}return t},e.prototype.getLossIdentifiers=function(){var t,n,a,i,o;if(typeof this.loss=="string")o=yo(this.loss);else if(Array.isArray(this.loss)){try{for(var s=be(this.loss),u=s.next();!u.done;u=s.next()){var l=u.value;if(typeof l!="string")throw new Error("Serialization of non-string loss is not supported.")}}catch(m){t={error:m}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}o=this.loss.map(function(m){return yo(m)})}else{var c=Object.keys(this.loss);o={};var f=this.loss;try{for(var h=be(c),p=h.next();!p.done;p=h.next()){var d=p.value;if(typeof f[d]=="string")o[d]=yo(f[d]);else throw new Error("Serialization of non-string loss is not supported.")}}catch(m){a={error:m}}finally{try{p&&!p.done&&(i=h.return)&&i.call(h)}finally{if(a)throw a.error}}}return o},e.prototype.getMetricIdentifiers=function(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[yo(wv(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(function(a){return yo(wv(a))});var t={};for(var n in this.metrics)t[n]=yo(wv(this.metrics[n]));return t},e.prototype.getTrainingConfig=function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}},e.prototype.loadTrainingConfig=function(t){if(t.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(t.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(t.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");var n=ph(t.optimizer_config),a=Si(n),i;if(typeof t.loss=="string")i=su(t.loss);else if(Array.isArray(t.loss))i=t.loss.map(function(u){return su(u)});else if(t.loss!=null){i={};for(var o in t.loss)i[o]=su(t.loss[o])}var s;if(Array.isArray(t.metrics))s=t.metrics.map(function(u){return su(u)});else if(t.metrics!=null){s={};for(var o in t.metrics)s[o]=su(t.metrics[o])}this.compile({loss:i,metrics:s,optimizer:a})},e.prototype.save=function(t,n){return Ce(this,void 0,void 0,function(){var a,i,o,s,u,l,c,f,h,p,d,m,v,g,y;return Ie(this,function(b){switch(b.label){case 0:if(typeof t=="string"){if(a=M.io.getSaveHandlers(t),a.length===0)throw new ie("Cannot find any save handlers for URL '"+t+"'");if(a.length>1)throw new ie("Found more than one ("+a.length+") save handlers for "+("URL '"+t+"'"));t=a[0]}if(t.save==null)throw new ie("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,M.io.encodeWeights(this.getNamedWeights(n))];case 1:return i=b.sent(),o=!1,s=null,u=this.toJSON(s,o),l={modelTopology:u,format:O1e,generatedBy:"TensorFlow.js tfjs-layers v"+$1,convertedBy:null},c=n==null?!1:n.includeOptimizer,c&&this.optimizer!=null?(l.trainingConfig=this.getTrainingConfig(),f="optimizer",v=(m=M.io).encodeWeights,[4,this.optimizer.getWeights()]):[3,4];case 2:return[4,v.apply(m,[b.sent(),f])];case 3:h=b.sent(),p=h.data,d=h.specs,(y=i.specs).push.apply(y,mt(d)),i.data=M.io.concatenateArrayBuffers([i.data,p]),b.label=4;case 4:return this.userDefinedMetadata!=null&&(g=!0,jO(this.userDefinedMetadata,this.name,g),l.userDefinedMetadata=this.userDefinedMetadata),l.weightData=i.data,l.weightSpecs=i.specs,[2,t.save(l)]}})})},e.prototype.setUserDefinedMetadata=function(t){jO(t,this.name),this.userDefinedMetadata=t},e.prototype.getUserDefinedMetadata=function(){return this.userDefinedMetadata},e}(b1e);bo.className="Model";M.serialization.registerClass(bo);var oB=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(bo);oB.className="Functional";M.serialization.registerClass(oB);function P1e(r,e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c,f;return Ie(this,function(h){switch(h.label){case 0:return"modelTopology"in r||(r={modelTopology:r}),r=r,t=r.modelTopology,t.model_config!=null&&(t=t.model_config),n=ph(t),a=Si(n,e),r.weightsManifest==null?[3,2]:[4,M.io.loadWeights(r.weightsManifest,r.pathPrefix,a.weights.map(function(p){return p.originalName}))];case 1:i=h.sent(),o={};try{for(s=be(a.weights),u=s.next();!u.done;u=s.next())l=u.value,o[l.originalName]=i[l.originalName]}catch(p){c={error:p}}finally{try{u&&!u.done&&(f=s.return)&&f.call(s)}finally{if(c)throw c.error}}a.loadWeights(o),M.dispose(i),h.label=2;case 2:return[2,a]}})})}function M1e(r,e){return Ce(this,void 0,void 0,function(){var t;return Ie(this,function(n){if(e==null&&(e={}),typeof r=="string"){if(t=M.io.getLoadHandlers(r,e),t.length===0)t.push(M.io.browserHTTPRequest(r,e));else if(t.length>1)throw new ie("Found more than one ("+t.length+") load handlers for "+("URL '"+r+"'"));r=t[0]}return[2,B1e(r,void 0,e)]})})}function B1e(r,e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,f;return Ie(this,function(h){switch(h.label){case 0:if(t==null&&(t={}),r.load==null)throw new ie("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,r.load()];case 1:if(n=h.sent(),a=n.modelTopology,a.model_config!=null&&(a=a.model_config),i=t.strict==null?!0:t.strict,o=n.weightData!=null&&n.weightSpecs!=null&&i,s=Si(ph(a),e,o),u=n.trainingConfig,u!=null&&s.loadTrainingConfig(u),n.userDefinedMetadata!=null&&s.setUserDefinedMetadata(n.userDefinedMetadata),n.weightData==null)return[3,4];if(n.weightSpecs==null)throw new ie("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");return l=L1e(n.weightData,n.weightSpecs),c=l.modelWeights,f=l.optimizerWeights,s.loadWeights(c,i),s.optimizer!=null&&f.length>0?[4,s.optimizer.setWeights(f)]:[3,3];case 2:h.sent(),h.label=3;case 3:M.dispose(c),M.dispose(f.map(function(p){return p.tensor})),h.label=4;case 4:return[2,s]}})})}function L1e(r,e){var t=M.io.decodeWeights(r,e),n={},a=[];return e.forEach(function(i){i.group==="optimizer"?a.push({name:i.name,tensor:t[i.name]}):n[i.name]=t[i.name]}),{modelWeights:n,optimizerWeights:a}}var fm=function(r){ge(e,r);function e(t){var n,a,i=r.call(this,{inputs:[],outputs:[]})||this;if(t=t||{},i.trainable=!0,i.built=!1,i.name=t.name!=null?t.name:Kv("sequential_"),t.layers!=null)try{for(var o=be(t.layers),s=o.next();!s.done;s=o.next()){var u=s.value;i.add(u)}}catch(l){n={error:l}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}return i}return e.prototype.checkShape=function(t){var n=t.inboundNodes[0].outputTensors[0].shape;if(n.some(function(a){return a<0}))throw new ie("Negative dimension size caused by adding layer "+(t.name+" with input shape [")+(t.inboundNodes[0].inputTensors[0].shape+"]"))},e.prototype.add=function(t){var n=t instanceof e||t instanceof bo,a;if(n){if(a=t,a.outputs.length!==1)throw new ie("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(a.inputs.length!==1)throw new ie("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new ie("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var i=mP({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(i)}if(n)this.outputs=a.outputs,this.inputs=a.inputs;else{if(t.inboundNodes.length!==1)throw new ie("A layer added to a Sequential model must not already be "+("connected somewhere else. LayersModel received layer "+t.name+" ")+("which has "+t.inboundNodes.length+" pre-existing inbound ")+"connections.");if(t.inboundNodes[0].outputTensors.length!==1)throw new ie("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=vP(this.outputs[0])}this.inboundNodes=[],new rm({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:fu(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(function(s){return s.shape}),outputShapes:this.outputs[0].shape})}else{var o=t.apply(this.outputs[0]);if(Array.isArray(o))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[o],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1},e.prototype.pop=function(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},e.prototype.call=function(t,n){return this.model==null&&this.build(),this.model.call(t,n)},e.prototype.build=function(t){if(Gt(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new bo({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},e.prototype.countParams=function(){return this.built||this.build(),r.prototype.countParams.call(this)},e.prototype.summary=function(t,n,a){a===void 0&&(a=console.log),this.built||this.build(),r.prototype.summary.call(this,t,n,a)},e.prototype.setWeights=function(t){this.model==null&&this.build(),this.model.setWeights(t)},e.prototype.evaluate=function(t,n,a){if(a===void 0&&(a={}),!this.built)throw new Xi("The model needs to be compiled before being used.");return this.model.evaluate(t,n,a)},e.prototype.evaluateDataset=function(t,n){return Ce(this,void 0,void 0,function(){return Ie(this,function(a){if(!this.built)throw new Xi("The model needs to be compiled before being used.");return[2,this.model.evaluateDataset(t,n)]})})},e.prototype.predict=function(t,n){return n===void 0&&(n={}),this.model==null&&this.build(),this.model.predict(t,n)},e.prototype.predictOnBatch=function(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)},e.prototype.compile=function(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},Object.defineProperty(e.prototype,"optimizer",{get:function(){return this.model==null?void 0:this.model.optimizer},set:function(t){this.model.optimizer=t},enumerable:!0,configurable:!0}),e.prototype.fit=function(t,n,a){return a===void 0&&(a={}),Ce(this,void 0,void 0,function(){return Ie(this,function(i){if(!this.built)throw new Xi("The model needs to be compiled before being used.");return[2,this.model.fit(t,n,a)]})})},e.prototype.fitDataset=function(t,n){return Ce(this,void 0,void 0,function(){return Ie(this,function(a){if(!this.built)throw new Xi("The model needs to be compiled before being used.");return[2,this.model.fitDataset(t,n)]})})},e.prototype.trainOnBatch=function(t,n){return Ce(this,void 0,void 0,function(){return Ie(this,function(a){return[2,this.model.trainOnBatch(t,n)]})})},e.fromConfig=function(t,n,a,i){var o,s;i===void 0&&(i=!1);var u,l={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new ie("Legacy serialization format not supported yet.");u=n}else M.util.assert(n.layers!=null,function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."}),u=n.layers,delete n.layers,l=n;var c=new t(l);if(!(c instanceof e))throw new Nt("Sequential.fromConfig called on non-Sequential input: "+c);try{for(var f=be(u),h=f.next();!h.done;h=f.next()){var p=h.value,d=void 0,m=Si(p,d,i);i&&m.setFastWeightInitDuringBuild(!0),c.add(m)}}catch(v){o={error:v}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}return c},Object.defineProperty(e.prototype,"stopTraining",{get:function(){if(this.model==null)throw new ie("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(t){if(this.model==null)throw new ie("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t},enumerable:!0,configurable:!0}),e.prototype.getConfig=function(){var t,n,a=[];try{for(var i=be(this.layers),o=i.next();!o.done;o=i.next()){var s=o.value,u={};u.className=s.getClassName(),u.config=s.getConfig(),a.push(u)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return{name:this.name,layers:a}},e}(bo);fm.className="Sequential";M.serialization.registerClass(fm);function z1e(r){return new bo(r)}function $1e(r){return new fm(r)}function W1e(r,e){return e==null&&(e={}),M1e(r,e)}function sB(r){return mP(r)}function q1e(r,e){P1.registerCallbackConstructor(r,e)}var zn=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getConfig=function(){return{}},e}(M.serialization.Serializable),uB=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return n===void 0&&(n=1),ace(t,n)},e}(zn);uB.className="elu";M.serialization.registerClass(uB);var lB=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return _.selu(t)},e}(zn);lB.className="selu";M.serialization.registerClass(lB);var cB=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return _.relu(t)},e}(zn);cB.className="relu";M.serialization.registerClass(cB);var fB=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return M.tidy(function(){return _.minimum(6,_.relu(t))})},e}(zn);fB.className="relu6";M.serialization.registerClass(fB);var hB=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return t},e}(zn);hB.className="linear";M.serialization.registerClass(hB);var pB=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return _.sigmoid(t)},e}(zn);pB.className="sigmoid";M.serialization.registerClass(pB);var dB=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return oce(t)},e}(zn);dB.className="hardSigmoid";M.serialization.registerClass(dB);var vB=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return _.softplus(t)},e}(zn);vB.className="softplus";M.serialization.registerClass(vB);var mB=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return ice(t)},e}(zn);mB.className="softsign";M.serialization.registerClass(mB);var gB=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return _.tanh(t)},e}(zn);gB.className="tanh";M.serialization.registerClass(gB);var q1=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return n===void 0&&(n=-1),_.softmax(t,n)},e}(zn);q1.className="softmax";M.serialization.registerClass(q1);var yB=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return n===void 0&&(n=-1),_.logSoftmax(t,n)},e}(zn);yB.className="logSoftmax";M.serialization.registerClass(yB);var bB=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return n===void 0&&(n=1),M.tidy(function(){return _.mul(_.sigmoid(_.mul(t,n)),t)})},e}(zn);bB.className="swish";M.serialization.registerClass(bB);var wB=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return M.tidy(function(){return _.mul(t,_.tanh(_.softplus(t)))})},e}(zn);wB.className="mish";M.serialization.registerClass(wB);function fs(r){return r.getClassName()}function yb(r,e){return e===void 0&&(e={}),vh(r,M.serialization.SerializationMap.getMap().classNameMap,e,"activation")}function hs(r){if(r==null){var e={};return e.className="linear",e.config={},yb(e)}if(typeof r=="string"){var e={};return e.className=r,e.config={},yb(e)}else return r instanceof zn?r:yb(r)}function V1(r){if(r!=null&&typeof r!="object")throw new Error("Argument to L1L2 regularizer's constructor is expected to be an "+("object, but received: "+r))}var xB=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(M.serialization.Serializable),Ih=function(r){ge(e,r);function e(t){var n=r.call(this)||this;return V1(t),n.l1=t==null||t.l1==null?.01:t.l1,n.l2=t==null||t.l2==null?.01:t.l2,n.hasL1=n.l1!==0,n.hasL2=n.l2!==0,n}return e.prototype.apply=function(t){var n=this;return M.tidy(function(){var a=M.zeros([1]);return n.hasL1&&(a=M.add(a,M.sum(_.mul(n.l1,M.abs(t))))),n.hasL2&&(a=M.add(a,M.sum(_.mul(n.l2,yh(t))))),_.reshape(a,[])})},e.prototype.getConfig=function(){return{l1:this.l1,l2:this.l2}},e.fromConfig=function(t,n){return new t({l1:n.l1,l2:n.l2})},e}(xB);Ih.className="L1L2";M.serialization.registerClass(Ih);function V1e(r){return V1(r),new Ih({l1:r!=null?r.l1:null,l2:0})}function G1e(r){return V1(r),new Ih({l2:r!=null?r.l2:null,l1:0})}var eP={l1l2:"L1L2"};function Xt(r){return Wb(r)}function tP(r,e){return e===void 0&&(e={}),vh(r,M.serialization.SerializationMap.getMap().classNameMap,e,"regularizer")}function Nr(r){if(r==null)return null;if(typeof r=="string"){var e=r in eP?eP[r]:r,t={className:e,config:{}};return tP(t)}else return r instanceof xB?r:tP(r)}var G1=function(r){ge(e,r);function e(t){var n=r.call(this,t??{})||this;return n.supportsMasking=!0,t!=null&&(n.maxValue=t.maxValue),n}return e.prototype.call=function(t,n){t=xt(t);var a=M.relu(t);return this.maxValue!=null&&(a=M.clipByValue(a,0,this.maxValue)),a},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={maxValue:this.maxValue},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Dt);G1.className="ReLU";M.serialization.registerClass(G1);var U1=function(r){ge(e,r);function e(t){var n=r.call(this,t??{})||this;return n.DEFAULT_ALPHA=.3,t==null&&(t={}),n.alpha=t.alpha==null?n.DEFAULT_ALPHA:t.alpha,n}return e.prototype.call=function(t,n){var a=xt(t);return M.leakyRelu(a,this.alpha)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={alpha:this.alpha},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Dt);U1.className="LeakyReLU";M.serialization.registerClass(U1);var H1=function(r){ge(e,r);function e(t){var n=r.call(this,t??{})||this;if(n.DEFAULT_ALPHA_INITIALIZER="zeros",t==null&&(t={}),n.supportsMasking=!0,n.alphaInitializer=Sr(t.alphaInitializer||n.DEFAULT_ALPHA_INITIALIZER),n.alphaRegularizer=Nr(t.alphaRegularizer),n.alphaConstraint=Qr(t.alphaConstraint),t.sharedAxes==null)n.sharedAxes=null;else if(Array.isArray(t.sharedAxes))n.sharedAxes=t.sharedAxes;else if(typeof t.sharedAxes=="number")n.sharedAxes=[t.sharedAxes];else throw new ie("Expected sharedAxes to be a number or an array of numbers, "+("but got "+t.sharedAxes));return n}return e.prototype.build=function(t){var n,a;t=Gt(t);var i=t.slice(1);if(this.sharedAxes!=null)try{for(var o=be(this.sharedAxes),s=o.next();!s.done;s=o.next()){var u=s.value;i[u-1]=1}}catch(c){n={error:c}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}this.alpha=this.addWeight("alpha",i,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var l={};if(this.sharedAxes!=null)for(var u=1;u<t.length;++u)l[u]=t[u];this.inputSpec=[new Kr({ndim:t.length,axes:l})],this.built=!0},e.prototype.call=function(t,n){return t=xt(t),M.prelu(t,this.alpha.read())},e.prototype.getConfig=function(){var t={alphaInitializer:Cr(this.alphaInitializer),alphaRegularizer:Xt(this.alphaRegularizer),alphaConstraint:Jr(this.alphaConstraint),sharedAxes:this.sharedAxes},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Dt);H1.className="PReLU";M.serialization.registerClass(H1);var K1=function(r){ge(e,r);function e(t){var n=r.call(this,t??{})||this;if(n.DEFAULT_ALPHA=1,t==null&&(t={}),t.alpha!=null&&t.alpha!==n.DEFAULT_ALPHA)throw new Nt("Non-default alpha value ("+t.alpha+") is not supported by the ELU layer yet.");return n.alpha=t.alpha==null?n.DEFAULT_ALPHA:t.alpha,n}return e.prototype.call=function(t,n){var a=xt(t);return M.elu(a)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={alpha:this.alpha},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Dt);K1.className="ELU";M.serialization.registerClass(K1);var j1=function(r){ge(e,r);function e(t){var n=r.call(this,t??{})||this;return n.DEFAULT_THETA=1,t==null&&(t={}),n.theta=t.theta==null?n.DEFAULT_THETA:t.theta,n}return e.prototype.call=function(t,n){var a=xt(t);return M.mul(a,M.cast(M.greater(a,this.theta),"float32"))},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={theta:this.theta},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Dt);j1.className="ThresholdedReLU";M.serialization.registerClass(j1);var X1=function(r){ge(e,r);function e(t){var n=r.call(this,t??{})||this;return n.DEFAULT_AXIS=1,t==null&&(t={}),n.softmax=new q1().apply,n.axis=t.axis==null?n.DEFAULT_AXIS:t.axis,n}return e.prototype.call=function(t,n){var a=xt(t);return this.softmax(a,this.axis)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={axis:this.axis},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Dt);X1.className="Softmax";M.serialization.registerClass(X1);function Wl(r,e,t){if(typeof r=="number")return fu(r,e);if(r.length!==e)throw new ie("The "+t+" argument must be an integer or tuple of "+e+" integers."+(" Received: "+r.length+" elements."));for(var n=0;n<e;++n){var a=r[n];if(!ece(a))throw new ie("The "+t+" argument must be an integer or tuple of "+e+(" integers. Received: "+JSON.stringify(r)+" including a")+(" non-integer number "+a))}return r}function Ni(r,e,t,n,a){if(a===void 0&&(a=1),r==null)return r;var i=e+(e-1)*(a-1),o;return t==="same"?o=r:o=r-i+1,Math.floor((o+n-1)/n)}function ji(r,e,t,n){if(r==null)return null;if(n==="valid")r=r*e+cs([t-e,0]);else if(n==="same")r=r*e;else throw new ie("Unsupport padding mode: "+n+".");return r}function Y1(r,e){return M.tidy(function(){return qr(e),e==="channelsFirst"?_.transpose(r,[0,2,3,1]):r})}function kB(r,e){return M.tidy(function(){return qr(e),e==="channelsFirst"?_.transpose(r,[0,2,3,4,1]):r})}function U1e(r,e,t,n,a,i,o){return n===void 0&&(n=1),a===void 0&&(a="valid"),o===void 0&&(o=1),M.tidy(function(){if(i==null&&(i=Ti()),qr(i),r.shape.length!==3)throw new ie("The input of a conv1dWithBias operation should be 3, but is "+(r.shape.length+" instead."));if(e.shape.length!==3)throw new ie("The kernel for a conv1dWithBias operation should be 3, but is "+(e.shape.length+" instead"));if(t!=null&&t.shape.length!==1)throw new ie("The bias for a conv1dWithBias operation should be 1, but is "+(e.shape.length+" instead"));if(i==="channelsFirst"&&(r=_.transpose(r,[0,2,1])),a==="causal")throw new Nt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=_.conv1d(r,e,n,a==="same"?"same":"valid","NWC",o);return t!=null&&(s=Ii(s,t)),s})}function rP(r,e,t,n,a,i,o,s){return n===void 0&&(n=[1,1]),a===void 0&&(a="valid"),s===void 0&&(s=null),M.tidy(function(){if(i==null&&(i=Ti()),qr(i),r.rank!==3&&r.rank!==4)throw new ie("conv2dWithBiasActivation expects input to be of rank 3 or 4, "+("but received "+r.rank+"."));if(e.rank!==3&&e.rank!==4)throw new ie("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, "+("but received "+r.rank+"."));var u=Y1(r,i);if(a==="causal")throw new Nt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=_.fused.conv2d({x:u,filter:e,strides:n,pad:a==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:t,activation:s}),i==="channelsFirst"&&(u=_.transpose(u,[0,3,1,2])),u})}function H1e(r,e,t,n,a,i,o){return n===void 0&&(n=[1,1,1]),a===void 0&&(a="valid"),M.tidy(function(){if(i==null&&(i=Ti()),qr(i),r.rank!==4&&r.rank!==5)throw new ie("conv3dWithBias expects input to be of rank 4 or 5, but received "+(r.rank+"."));if(e.rank!==4&&e.rank!==5)throw new ie("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+(r.rank+"."));var s=kB(r,i);if(a==="causal")throw new Nt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=_.conv3d(s,e,n,a==="same"?"same":"valid","NDHWC",o),t!=null&&(s=Ii(s,t)),i==="channelsFirst"&&(s=_.transpose(s,[0,4,1,2,3])),s})}var SB=function(r){ge(e,r);function e(t,n){var a=r.call(this,n)||this;if(a.bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",e.verifyArgs(n),a.rank=t,an(a.rank,"rank"),a.rank!==1&&a.rank!==2&&a.rank!==3)throw new Nt("Convolution layer for rank other than 1, 2, or 3 ("+a.rank+") is not implemented yet.");if(a.kernelSize=Wl(n.kernelSize,t,"kernelSize"),a.strides=Wl(n.strides==null?1:n.strides,t,"strides"),a.padding=n.padding==null?"valid":n.padding,Da(a.padding),a.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,qr(a.dataFormat),a.activation=hs(n.activation),a.useBias=n.useBias==null?!0:n.useBias,a.biasInitializer=Sr(n.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=Qr(n.biasConstraint),a.biasRegularizer=Nr(n.biasRegularizer),a.activityRegularizer=Nr(n.activityRegularizer),a.dilationRate=Wl(n.dilationRate==null?1:n.dilationRate,t,"dilationRate"),a.rank===1&&Array.isArray(a.dilationRate)&&a.dilationRate.length!==1)throw new ie("dilationRate must be a number or an array of a single number for 1D convolution, but received "+(""+JSON.stringify(a.dilationRate)));if(a.rank===2){if(typeof a.dilationRate=="number")a.dilationRate=[a.dilationRate,a.dilationRate];else if(a.dilationRate.length!==2)throw new ie("dilationRate must be a number or array of two numbers for 2D "+("convolution, but received "+JSON.stringify(a.dilationRate)))}else if(a.rank===3){if(typeof a.dilationRate=="number")a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(a.dilationRate.length!==3)throw new ie("dilationRate must be a number or array of three numbers for 3D "+("convolution, but received "+JSON.stringify(a.dilationRate)))}return a}return e.verifyArgs=function(t){if(Ki("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!qb(t.kernelSize,"number",1,3))throw new ie("BaseConv expects config.kernelSize to be number or number[] with "+("length 1, 2, or 3, but received "+JSON.stringify(t.kernelSize)+"."))},e.prototype.getConfig=function(){var t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:fs(this.activation),useBias:this.useBias,biasInitializer:Cr(this.biasInitializer),biasRegularizer:Xt(this.biasRegularizer),activityRegularizer:Xt(this.activityRegularizer),biasConstraint:Jr(this.biasConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Dt),hm=function(r){ge(e,r);function e(t,n){var a=r.call(this,t,n)||this;return a.kernel=null,e.verifyArgs(n),a.filters=n.filters,an(a.filters,"filters"),a.kernelInitializer=Sr(n.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=Qr(n.kernelConstraint),a.kernelRegularizer=Nr(n.kernelRegularizer),a}return e.prototype.build=function(t){var n;t=Gt(t);var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new ie("The channel dimension of the input should be defined. "+("Found "+t[a]));var i=t[a],o=this.kernelSize.concat([i,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(n={},n[a]=i,n)}],this.built=!0},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){t=xt(t);var i,o=a.bias==null?null:a.bias.read(),s=oP(a.activation.getClassName());if(s!=null&&a.rank===2)i=rP(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate,s);else{if(a.rank===1)i=U1e(t,a.kernel.read(),o,a.strides[0],a.padding,a.dataFormat,a.dilationRate[0]);else if(a.rank===2)i=rP(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate);else if(a.rank===3)i=H1e(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate);else throw new Nt("convolutions greater than 3D are not implemented yet.");a.activation!=null&&(i=a.activation.apply(i))}return i})},e.prototype.computeOutputShape=function(t){t=Gt(t);for(var n=[],a=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2),i=0;i<a.length;++i){var o=Ni(a[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);n.push(o)}var s=[t[0]];return this.dataFormat==="channelsLast"?(s=s.concat(n),s.push(this.filters)):(s.push(this.filters),s=s.concat(n)),s},e.prototype.getConfig=function(){var t={filters:this.filters,kernelInitializer:Cr(this.kernelInitializer),kernelRegularizer:Xt(this.kernelRegularizer),kernelConstraint:Jr(this.kernelConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.verifyArgs=function(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new ie("Convolution layer expected config.filters to be a 'number' > 0 "+("but got "+JSON.stringify(t.filters)))},e}(SB),pm=function(r){ge(e,r);function e(t){var n=r.call(this,2,t)||this;return e.verifyArgs(t),n}return e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!qb(t.kernelSize,"number",1,2))throw new ie("Conv2D expects config.kernelSize to be number or number[] with "+("length 1 or 2, but received "+JSON.stringify(t.kernelSize)+"."))},e}(hm);pm.className="Conv2D";M.serialization.registerClass(pm);var dm=function(r){ge(e,r);function e(t){var n=r.call(this,3,t)||this;return e.verifyArgs(t),n}return e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!(Array.isArray(t.kernelSize)&&(t.kernelSize.length===1||t.kernelSize.length===3)))throw new ie("Conv3D expects config.kernelSize to be number or"+(" [number, number, number], but received "+JSON.stringify(t.kernelSize)+"."))},e}(hm);dm.className="Conv3D";M.serialization.registerClass(dm);var Z1=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;if(n.inputSpec=[new Kr({ndim:4})],n.padding!=="same"&&n.padding!=="valid")throw new ie("Conv2DTranspose currently supports only padding modes 'same' "+("and 'valid', but received padding mode "+n.padding));return n}return e.prototype.build=function(t){var n;if(t=Gt(t),t.length!==4)throw new ie("Input should have rank 4; Received input shape: "+JSON.stringify(t));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new ie("The channel dimension of the inputs should be defined. Found `None`.");var i=t[a],o=this.kernelSize.concat([this.filters,i]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Kr({ndim:4,axes:(n={},n[a]=i,n)})],this.built=!0},e.prototype.call=function(t,n){var a=this;return _.tidy(function(){var i=xt(t);if(i.shape.length!==4)throw new ie("Conv2DTranspose.call() expects input tensor to be rank-4, but "+("received a tensor of rank-"+i.shape.length));var o=i.shape,s=o[0],u,l;a.dataFormat==="channelsFirst"?(u=2,l=3):(u=1,l=2);var c=o[u],f=o[l],h=a.kernelSize[0],p=a.kernelSize[1],d=a.strides[0],m=a.strides[1],v=ji(c,d,h,a.padding),g=ji(f,m,p,a.padding),y=[s,v,g,a.filters];a.dataFormat!=="channelsLast"&&(i=_.transpose(i,[0,2,3,1]));var b=_.conv2dTranspose(i,a.kernel.read(),y,a.strides,a.padding);return a.dataFormat!=="channelsLast"&&(b=_.transpose(b,[0,3,1,2])),a.bias!=null&&(b=Ii(b,a.bias.read(),a.dataFormat)),a.activation!=null&&(b=a.activation.apply(b)),b})},e.prototype.computeOutputShape=function(t){t=Gt(t);var n=t.slice(),a,i,o;this.dataFormat==="channelsFirst"?(a=1,i=2,o=3):(a=3,i=1,o=2);var s=this.kernelSize[0],u=this.kernelSize[1],l=this.strides[0],c=this.strides[1];return n[a]=this.filters,n[i]=ji(n[i],l,s,this.padding),n[o]=ji(n[o],c,u,this.padding),n},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.dilationRate,t},e}(pm);Z1.className="Conv2DTranspose";M.serialization.registerClass(Z1);var J1=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;if(n.inputSpec=[new Kr({ndim:5})],n.padding!=="same"&&n.padding!=="valid")throw new ie("Conv3DTranspose currently supports only padding modes 'same' "+("and 'valid', but received padding mode "+n.padding));return n}return e.prototype.build=function(t){var n;if(t=Gt(t),t.length!==5)throw new ie("Input should have rank 5; Received input shape: "+JSON.stringify(t));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new ie("The channel dimension of the inputs should be defined. Found `None`.");var i=t[a],o=this.kernelSize.concat([this.filters,i]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Kr({ndim:5,axes:(n={},n[a]=i,n)})],this.built=!0},e.prototype.call=function(t,n){var a=this;return _.tidy(function(){var i=xt(t);if(i.shape.length!==5)throw new ie("Conv3DTranspose.call() expects input tensor to be rank-4, but "+("received a tensor of rank-"+i.shape.length));var o=i.shape,s=o[0],u,l,c;a.dataFormat==="channelsFirst"?(c=2,u=3,l=4):(c=1,u=2,l=3);var f=o[c],h=o[u],p=o[l],d=a.kernelSize[0],m=a.kernelSize[1],v=a.kernelSize[2],g=a.strides[0],y=a.strides[1],b=a.strides[2],w=ji(f,g,d,a.padding),x=ji(h,y,m,a.padding),k=ji(p,b,v,a.padding),N=[s,w,x,k,a.filters];a.dataFormat!=="channelsLast"&&(i=_.transpose(i,[0,2,3,4,1]));var T=_.conv3dTranspose(i,a.kernel.read(),N,a.strides,a.padding);return a.dataFormat!=="channelsLast"&&(T=_.transpose(T,[0,4,1,2,3])),a.bias!==null&&(T=Ii(T,a.bias.read(),a.dataFormat)),a.activation!==null&&(T=a.activation.apply(T)),T})},e.prototype.computeOutputShape=function(t){t=Gt(t);var n=t.slice(),a,i,o,s;this.dataFormat==="channelsFirst"?(a=1,i=2,o=3,s=4):(a=4,i=1,o=2,s=3);var u=this.kernelSize[0],l=this.kernelSize[1],c=this.kernelSize[2],f=this.strides[0],h=this.strides[1],p=this.strides[2];return n[a]=this.filters,n[i]=ji(n[i],f,u,this.padding),n[o]=ji(n[o],h,l,this.padding),n[s]=ji(n[s],p,c,this.padding),n},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.dilationRate,t},e}(dm);J1.className="Conv3DTranspose";M.serialization.registerClass(J1);var NB=function(r){ge(e,r);function e(t,n){var a=r.call(this,t,n)||this;if(a.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,n.filters==null)throw new ie("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new ie("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new ie("SeparableConv"+a.rank+"D supports only padding modes: "+("'same' and 'valid', but received "+JSON.stringify(n.padding)));return a.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,a.depthwiseInitializer=Sr(n.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=Nr(n.depthwiseRegularizer),a.depthwiseConstraint=Qr(n.depthwiseConstraint),a.pointwiseInitializer=Sr(n.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=Nr(n.pointwiseRegularizer),a.pointwiseConstraint=Qr(n.pointwiseConstraint),a}return e.prototype.build=function(t){var n;if(t=Gt(t),t.length<this.rank+2)throw new ie("Inputs to SeparableConv"+this.rank+"D should have rank "+(this.rank+2+", but received input shape: ")+(""+JSON.stringify(t)));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null||t[a]<0)throw new ie("The channel dimension of the inputs should be defined, "+("but found "+JSON.stringify(t[a])));for(var i=t[a],o=this.kernelSize.concat([i,this.depthMultiplier]),s=[],u=0;u<this.rank;++u)s.push(1);s.push(i*this.depthMultiplier,this.filters);var l=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",o,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,l,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",s,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,l,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,l,this.biasConstraint):this.bias=null,this.inputSpec=[new Kr({ndim:this.rank+2,axes:(n={},n[a]=i,n)})],this.built=!0},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){t=xt(t);var i;if(a.rank===1)throw new Nt("1D separable convolution is not implemented yet.");return a.rank===2&&(a.dataFormat==="channelsFirst"&&(t=_.transpose(t,[0,2,3,1])),i=_.separableConv2d(t,a.depthwiseKernel.read(),a.pointwiseKernel.read(),a.strides,a.padding,a.dilationRate,"NHWC")),a.useBias&&(i=Ii(i,a.bias.read(),a.dataFormat)),a.activation!=null&&(i=a.activation.apply(i)),a.dataFormat==="channelsFirst"&&(i=_.transpose(i,[0,3,1,2])),i})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=Cr(this.depthwiseInitializer),t.pointwiseInitializer=Cr(this.pointwiseInitializer),t.depthwiseRegularizer=Xt(this.depthwiseRegularizer),t.pointwiseRegularizer=Xt(this.pointwiseRegularizer),t.depthwiseConstraint=Jr(this.depthwiseConstraint),t.pointwiseConstraint=Jr(this.pointwiseConstraint),t},e}(hm);NB.className="SeparableConv";var Q1=function(r){ge(e,r);function e(t){return r.call(this,2,t)||this}return e}(NB);Q1.className="SeparableConv2D";M.serialization.registerClass(Q1);var ew=function(r){ge(e,r);function e(t){var n=r.call(this,1,t)||this;return e.verifyArgs(t),n.inputSpec=[{ndim:3}],n}return e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,delete t.dataFormat,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!qb(t.kernelSize,"number",1,1))throw new ie("Conv1D expects config.kernelSize to be number or number[] with "+("length 1, but received "+JSON.stringify(t.kernelSize)+"."))},e}(hm);ew.className="Conv1D";M.serialization.registerClass(ew);var tw=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;return typeof t.cropping=="number"?n.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:typeof t.cropping[0]=="number"?n.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:n.cropping=t.cropping,n.dataFormat=t.dataFormat===void 0?"channelsLast":t.dataFormat,n.inputSpec=[{ndim:4}],n}return e.prototype.computeOutputShape=function(t){return this.dataFormat==="channelsFirst"?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){if(t=xt(t),a.dataFormat==="channelsLast"){var i=yv(t,a.cropping[0][0],t.shape[1]-a.cropping[0][0]-a.cropping[0][1],2);return yv(i,a.cropping[1][0],t.shape[2]-a.cropping[1][1]-a.cropping[1][0],3)}else{var i=yv(t,a.cropping[0][0],t.shape[2]-a.cropping[0][0]-a.cropping[0][1],3);return yv(i,a.cropping[1][0],t.shape[3]-a.cropping[1][1]-a.cropping[1][0],4)}})},e.prototype.getConfig=function(){var t={cropping:this.cropping,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Dt);tw.className="Cropping2D";M.serialization.registerClass(tw);var rw=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;return n.DEFAULT_SIZE=[2,2],n.inputSpec=[{ndim:4}],n.size=t.size==null?n.DEFAULT_SIZE:t.size,n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,qr(n.dataFormat),n.interpolation=t.interpolation==null?"nearest":t.interpolation,Zle(n.interpolation),n}return e.prototype.computeOutputShape=function(t){if(this.dataFormat==="channelsFirst"){var n=t[2]==null?null:this.size[0]*t[2],a=t[3]==null?null:this.size[1]*t[3];return[t[0],t[1],n,a]}else{var n=t[1]==null?null:this.size[0]*t[1],a=t[2]==null?null:this.size[1]*t[2];return[t[0],n,a,t[3]]}},e.prototype.call=function(t,n){var a=this;return _.tidy(function(){var i=xt(t),o=i.shape;if(a.dataFormat==="channelsFirst"){i=_.transpose(i,[0,2,3,1]);var s=a.size[0]*o[2],u=a.size[1]*o[3],l=a.interpolation==="nearest"?_.image.resizeNearestNeighbor(i,[s,u]):_.image.resizeBilinear(i,[s,u]);return _.transpose(l,[0,3,1,2])}else{var s=a.size[0]*o[1],u=a.size[1]*o[2];return a.interpolation==="nearest"?_.image.resizeNearestNeighbor(i,[s,u]):_.image.resizeBilinear(i,[s,u])}})},e.prototype.getConfig=function(){var t={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Dt);rw.className="UpSampling2D";M.serialization.registerClass(rw);function K1e(r,e,t,n,a,i){return t===void 0&&(t=[1,1]),n===void 0&&(n="valid"),M.tidy(function(){a==null&&(a=Ti()),qr(a);var o=Y1(r,a);if(r.rank!==4)throw new ie("Input for depthwiseConv2d is required to be 4-D, but is instead "+(r.rank+"-D"));if(e.rank!==4)throw new ie("depthwiseKernel is required to be 4-D, but is instead "+(e.rank+"-D"));return o=_.depthwiseConv2d(o,e,t,n==="same"?"same":"valid","NHWC",i),a==="channelsFirst"&&(o=_.transpose(o,[0,3,1,2])),o})}var nw=function(r){ge(e,r);function e(t){var n=r.call(this,2,t)||this;return n.depthwiseKernel=null,n.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,n.depthwiseInitializer=Sr(t.depthwiseInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.depthwiseConstraint=Qr(t.depthwiseConstraint),n.depthwiseRegularizer=Nr(t.depthwiseRegularizer),n}return e.prototype.build=function(t){if(t=Gt(t),t.length<4)throw new ie("Inputs to DepthwiseConv2D should have rank 4. "+("Received input shape: "+JSON.stringify(t)+"."));var n=this.dataFormat==="channelsFirst"?1:3;if(t[n]==null||t[n]<0)throw new ie("The channel dimension of the inputs to DepthwiseConv2D should "+("be defined, but is not ("+t[n]+")."));var a=t[n],i=[this.kernelSize[0],this.kernelSize[1],a,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[a*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){t=xt(t);var i=K1e(t,a.depthwiseKernel.read(),a.strides,a.padding,a.dataFormat,null);return a.useBias&&(i=Ii(i,a.bias.read(),a.dataFormat)),a.activation!=null&&(i=a.activation.apply(i)),i})},e.prototype.computeOutputShape=function(t){t=Gt(t);var n=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,o=Ni(n,this.kernelSize[0],this.padding,this.strides[0]),s=Ni(a,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[t[0],i,o,s]:[t[0],o,s,i]},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=Cr(this.depthwiseInitializer),t.depthwiseRegularizer=Xt(this.depthwiseRegularizer),t.depthwiseConstraint=Jr(this.depthwiseRegularizer),t},e}(SB);nw.className="DepthwiseConv2D";M.serialization.registerClass(nw);function EB(r,e,t,n){if(Array.isArray(r)){if(e!=null||t!=null)throw new ie("When inputs is an array, neither initialState or constants should be provided");n!=null&&(t=r.slice(r.length-n,r.length),r=r.slice(0,r.length-n)),r.length>1&&(e=r.slice(1,r.length)),r=r[0]}function a(i){return i==null||Array.isArray(i)?i:[i]}return e=a(e),t=a(t),{inputs:r,initialState:e,constants:t}}function TB(r,e,t,n,a,i,o,s){return n===void 0&&(n=!1),o===void 0&&(o=!1),s===void 0&&(s=!1),_.tidy(function(){var u=e.shape.length;if(u<3)throw new ie("Input should be at least 3D, but is "+u+"D.");var l=[1,0].concat(Ei(2,u));if(e=_.transpose(e,l),i!=null)throw new Nt("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),a!=null&&(a=_.cast(_.cast(a,"bool"),"float32"),a.rank===u-1&&(a=_.expandDims(a,-1)),a=_.transpose(a,l)),n&&(e=_.reverse(e,0),a!=null&&(a=_.reverse(a,0)));var c=[],f,h=t,p=e.shape[0],d=_.unstack(e),m;a!=null&&(m=_.unstack(a));for(var v=function(w){var x=d[w],k=_.tidy(function(){return r(x,h)});if(a==null)f=k[0],h=k[1];else{var N=_.tidy(function(){var T=m[w],I=_.sub(_.onesLike(T),T),F=_.add(_.mul(k[0],T),_.mul(h[0],I)),D=h.map(function(R,P){return _.add(_.mul(k[1][P],T),_.mul(R,I))});return{output:F,newStates:D}});f=N.output,h=N.newStates}s&&c.push(f)},g=0;g<p;++g)v(g);var y;if(s){var b=1;y=_.stack(c,b)}return[f,y,h]})}var So=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this,a;if(t.cell==null)throw new ie("cell property is missing for the constructor of RNN.");if(Array.isArray(t.cell)?a=new gm({cells:t.cell}):a=t.cell,a.stateSize==null)throw new ie("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return n.cell=a,n.returnSequences=t.returnSequences==null?!1:t.returnSequences,n.returnState=t.returnState==null?!1:t.returnState,n.goBackwards=t.goBackwards==null?!1:t.goBackwards,n._stateful=t.stateful==null?!1:t.stateful,n.unroll=t.unroll==null?!1:t.unroll,n.supportsMasking=!0,n.inputSpec=[new Kr({ndim:3})],n.stateSpec=null,n.states_=null,n.numConstants=null,n.keptStates=[],n}return e.prototype.getStates=function(){if(this.states_==null){var t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Ei(0,t).map(function(n){return null})}else return this.states_},e.prototype.setStates=function(t){this.states_=t},e.prototype.computeOutputShape=function(t){var n,a;Sb(t)&&(t=t[0]),t=t;var i=this.cell.stateSize;Array.isArray(i)||(i=[i]);var o=i[0],s;if(this.returnSequences?s=[t[0],t[1],o]:s=[t[0],o],this.returnState){var u=[];try{for(var l=be(i),c=l.next();!c.done;c=l.next()){var f=c.value;u.push([t[0],f])}}catch(h){n={error:h}}finally{try{c&&!c.done&&(a=l.return)&&a.call(l)}finally{if(n)throw n.error}}return[s].concat(u)}else return s},e.prototype.computeMask=function(t,n){var a=this;return _.tidy(function(){Array.isArray(n)&&(n=n[0]);var i=a.returnSequences?n:null;if(a.returnState){var o=a.states.map(function(s){return null});return[i].concat(o)}else return i})},Object.defineProperty(e.prototype,"states",{get:function(){if(this.states_==null){for(var t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[],a=0;a<t;++a)n.push(null);return n}else return this.states_},set:function(t){this.states_=t},enumerable:!0,configurable:!0}),e.prototype.build=function(t){if(this.numConstants!=null)throw new Nt("Constants support is not implemented in RNN yet.");Sb(t)&&(t=t[0]),t=t;var n=this.stateful?t[0]:null,a=t.slice(2);this.inputSpec[0]=new Kr({shape:mt([n,null],a)});var i=[t[0]].concat(t.slice(2));this.cell.build(i);var o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!M.util.arraysEqual(this.stateSpec.map(function(s){return s.shape[s.shape.length-1]}),o))throw new ie("An initialState was passed that is not compatible with "+("cell.stateSize. Received stateSpec="+this.stateSpec+"; ")+("However cell.stateSize is "+this.cell.stateSize))}else this.stateSpec=o.map(function(s){return new Kr({shape:[null,s]})});this.stateful&&this.resetStates()},e.prototype.resetStates=function(t,n){var a=this;n===void 0&&(n=!1),M.tidy(function(){if(!a.stateful)throw new ss("Cannot call resetStates() on an RNN Layer that is not stateful.");var i=a.inputSpec[0].shape[0];if(i==null)throw new ie("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(a.states_==null)Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(c){return _.zeros([i,c])}):a.states_=[_.zeros([i,a.cell.stateSize])];else if(t==null)_.dispose(a.states_),a.keptStates!=null&&(_.dispose(a.keptStates),a.keptStates=[]),Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(c){return _.zeros([i,c])}):a.states_[0]=_.zeros([i,a.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==a.states_.length)throw new ie("Layer "+a.name+" expects "+a.states_.length+" state(s), "+("but it received "+t.length+" state value(s). Input ")+("received: "+t));n===!0?a.keptStates.push(a.states_.slice()):_.dispose(a.states_);for(var o=0;o<a.states_.length;++o){var s=t[o],u=Array.isArray(a.cell.stateSize)?a.cell.stateSize[o]:a.cell.stateSize,l=[i,u];if(!M.util.arraysEqual(s.shape,l))throw new ie("State "+o+" is incompatible with layer "+a.name+": "+("expected shape="+l+", received shape="+s.shape));a.states_[o]=s}}a.states_=a.states_.map(function(c){return _.keep(c.clone())})})},e.prototype.apply=function(t,n){var a,i,o=n==null?null:n.initialState,s=n==null?null:n.constants;n==null&&(n={});var u=EB(t,o,s,this.numConstants);t=u.inputs,o=u.initialState,s=u.constants;var l=[],c=[];if(o!=null){n.initialState=o,l=l.concat(o),this.stateSpec=[];try{for(var f=be(o),h=f.next();!h.done;h=f.next()){var p=h.value;this.stateSpec.push(new Kr({shape:p.shape}))}}catch(b){a={error:b}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}c=c.concat(this.stateSpec)}s!=null&&(n.constants=s,l=l.concat(s),this.numConstants=s.length);var d=l[0]instanceof ki;if(d){var m=[t].concat(l),v=this.inputSpec.concat(c),g=this.inputSpec;this.inputSpec=v;var y=r.prototype.apply.call(this,m,n);return this.inputSpec=g,y}else return r.prototype.apply.call(this,t,n)},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;t=xt(t),s==null&&(a.stateful?s=a.states_:s=a.getInitialState(t));var u=Array.isArray(a.cell.stateSize)?a.cell.stateSize.length:1;if(s.length!==u)throw new ie("RNN Layer has "+u+" state(s) but was passed "+(s.length+" initial state(s)."));a.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var l={training:o},c=function(v,g){var y=a.cell.call([v].concat(g),l);return[y[0],y.slice(1)]},f=TB(c,t,s,a.goBackwards,i,null,a.unroll,a.returnSequences),h=f[0],p=f[1],d=f[2];a.stateful&&a.resetStates(d,o);var m=a.returnSequences?p:h;return a.returnState?[m].concat(d):m})},e.prototype.getInitialState=function(t){var n=this;return M.tidy(function(){var a=_.zeros(t.shape);return a=_.sum(a,[1,2]),a=gh(a),Array.isArray(n.cell.stateSize)?n.cell.stateSize.map(function(i){return i>1?xb(a,[1,i]):a}):n.cell.stateSize>1?[xb(a,[1,n.cell.stateSize])]:[a]})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!0,configurable:!0}),e.prototype.setFastWeightInitDuringBuild=function(t){r.prototype.setFastWeightInitDuringBuild.call(this,t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);var a=this.cell.getConfig();return this.getClassName()===e.className&&(n.cell={className:this.cell.getClassName(),config:a}),Object.assign({},a,t,n)},e.fromConfig=function(t,n,a){a===void 0&&(a={});var i=n.cell,o=Si(i,a);return new t(Object.assign(n,{cell:o}))},e}(Dt);So.className="RNN";M.serialization.registerClass(So);var Jl=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(Dt),vm=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,an(n.units,"units"),n.activation=hs(t.activation==null?n.DEFAULT_ACTIVATION:t.activation),n.useBias=t.useBias==null?!0:t.useBias,n.kernelInitializer=Sr(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=Sr(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=Sr(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=Nr(t.kernelRegularizer),n.recurrentRegularizer=Nr(t.recurrentRegularizer),n.biasRegularizer=Nr(t.biasRegularizer),n.kernelConstraint=Qr(t.kernelConstraint),n.recurrentConstraint=Qr(t.recurrentConstraint),n.biasConstraint=Qr(t.biasConstraint),n.dropout=ql([1,cs([0,t.dropout==null?0:t.dropout])]),n.recurrentDropout=ql([1,cs([0,t.recurrentDropout==null?0:t.recurrentDropout])]),n.dropoutFunc=t.dropoutFunc,n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return e.prototype.build=function(t){t=Gt(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){if(t=t,t.length!==2)throw new ie("SimpleRNNCell expects 2 input Tensors, got "+t.length+".");var i=t[1];t=t[0];var o=n.training==null?!1:n.training;0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=ps({ones:function(){return _.onesLike(t)},rate:a.dropout,training:o,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=ps({ones:function(){return _.onesLike(i)},rate:a.recurrentDropout,training:o,dropoutFunc:a.dropoutFunc}));var s,u=a.dropoutMask,l=a.recurrentDropoutMask;u!=null?s=Yi(_.mul(t,u),a.kernel.read()):s=Yi(t,a.kernel.read()),a.bias!=null&&(s=Ii(s,a.bias.read())),l!=null&&(i=_.mul(i,l));var c=_.add(s,Yi(i,a.recurrentKernel.read()));return a.activation!=null&&(c=a.activation.apply(c)),[c,c]})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={units:this.units,activation:fs(this.activation),useBias:this.useBias,kernelInitializer:Cr(this.kernelInitializer),recurrentInitializer:Cr(this.recurrentInitializer),biasInitializer:Cr(this.biasInitializer),kernelRegularizer:Xt(this.kernelRegularizer),recurrentRegularizer:Xt(this.recurrentRegularizer),biasRegularizer:Xt(this.biasRegularizer),activityRegularizer:Xt(this.activityRegularizer),kernelConstraint:Jr(this.kernelConstraint),recurrentConstraint:Jr(this.recurrentConstraint),biasConstraint:Jr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},t,n)},e}(Jl);vm.className="SimpleRNNCell";M.serialization.registerClass(vm);var aw=function(r){ge(e,r);function e(t){var n=this;return t.cell=new vm(t),n=r.call(this,t)||this,n}return e.prototype.call=function(t,n){var a=this;return M.tidy(function(){a.cell.dropoutMask!=null&&(_.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(_.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,n){return new t(n)},e}(So);aw.className="SimpleRNN";M.serialization.registerClass(aw);var mm=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;if(n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new ie("GRUCell does not support reset_after parameter set to true.");return n.units=t.units,an(n.units,"units"),n.activation=hs(t.activation===void 0?n.DEFAULT_ACTIVATION:t.activation),n.recurrentActivation=hs(t.recurrentActivation===void 0?n.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),n.useBias=t.useBias==null?!0:t.useBias,n.kernelInitializer=Sr(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=Sr(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=Sr(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=Nr(t.kernelRegularizer),n.recurrentRegularizer=Nr(t.recurrentRegularizer),n.biasRegularizer=Nr(t.biasRegularizer),n.kernelConstraint=Qr(t.kernelConstraint),n.recurrentConstraint=Qr(t.recurrentConstraint),n.biasConstraint=Qr(t.biasConstraint),n.dropout=ql([1,cs([0,t.dropout==null?0:t.dropout])]),n.recurrentDropout=ql([1,cs([0,t.recurrentDropout==null?0:t.recurrentDropout])]),n.dropoutFunc=t.dropoutFunc,n.implementation=t.implementation,n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return e.prototype.build=function(t){t=Gt(t);var n=t[t.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){if(t=t,t.length!==2)throw new ie("GRUCell expects 2 input Tensors (inputs, h, c), got "+(t.length+"."));var i=n.training==null?!1:n.training,o=t[1];t=t[0],0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=ps({ones:function(){return _.onesLike(t)},rate:a.dropout,training:i,count:3,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=ps({ones:function(){return _.onesLike(o)},rate:a.recurrentDropout,training:i,count:3,dropoutFunc:a.dropoutFunc}));var s=a.dropoutMask,u=a.recurrentDropoutMask,l,c,f;0<a.dropout&&a.dropout<1&&(t=_.mul(t,s[0]));var h=Yi(t,a.kernel.read());a.useBias&&(h=Ii(h,a.bias.read())),0<a.recurrentDropout&&a.recurrentDropout<1&&(o=_.mul(o,u[0]));var p=a.recurrentKernel.read(),d=me(_.split(p,[2*a.units,a.units],p.rank-1),2),m=d[0],v=d[1],g=Yi(o,m),y=me(_.split(h,3,h.rank-1),3),b=y[0],w=y[1],x=y[2],k=me(_.split(g,2,g.rank-1),2),N=k[0],T=k[1];l=a.recurrentActivation.apply(_.add(b,N)),c=a.recurrentActivation.apply(_.add(w,T));var I=Yi(_.mul(c,o),v);f=a.activation.apply(_.add(x,I));var F=_.add(_.mul(l,o),_.mul(_.add(1,_.neg(l)),f));return[F,F]})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={units:this.units,activation:fs(this.activation),recurrentActivation:fs(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Cr(this.kernelInitializer),recurrentInitializer:Cr(this.recurrentInitializer),biasInitializer:Cr(this.biasInitializer),kernelRegularizer:Xt(this.kernelRegularizer),recurrentRegularizer:Xt(this.recurrentRegularizer),biasRegularizer:Xt(this.biasRegularizer),activityRegularizer:Xt(this.activityRegularizer),kernelConstraint:Jr(this.kernelConstraint),recurrentConstraint:Jr(this.recurrentConstraint),biasConstraint:Jr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},t,n)},e}(Jl);mm.className="GRUCell";M.serialization.registerClass(mm);var iw=function(r){ge(e,r);function e(t){var n=this;return t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new mm(t),n=r.call(this,t)||this,n}return e.prototype.call=function(t,n){var a=this;return M.tidy(function(){a.cell.dropoutMask!=null&&(_.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(_.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)},e}(So);iw.className="GRU";M.serialization.registerClass(iw);var Ch=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,an(n.units,"units"),n.activation=hs(t.activation===void 0?n.DEFAULT_ACTIVATION:t.activation),n.recurrentActivation=hs(t.recurrentActivation===void 0?n.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),n.useBias=t.useBias==null?!0:t.useBias,n.kernelInitializer=Sr(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=Sr(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=Sr(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.unitForgetBias=t.unitForgetBias,n.kernelRegularizer=Nr(t.kernelRegularizer),n.recurrentRegularizer=Nr(t.recurrentRegularizer),n.biasRegularizer=Nr(t.biasRegularizer),n.kernelConstraint=Qr(t.kernelConstraint),n.recurrentConstraint=Qr(t.recurrentConstraint),n.biasConstraint=Qr(t.biasConstraint),n.dropout=ql([1,cs([0,t.dropout==null?0:t.dropout])]),n.recurrentDropout=ql([1,cs([0,t.recurrentDropout==null?0:t.recurrentDropout])]),n.dropoutFunc=t.dropoutFunc,n.implementation=t.implementation,n.stateSize=[n.units,n.units],n.dropoutMask=null,n.recurrentDropoutMask=null,n}return e.prototype.build=function(t){var n;t=Gt(t);var a=t[t.length-1];this.kernel=this.addWeight("kernel",[a,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);var i;if(this.useBias){if(this.unitForgetBias){var o=this.biasInitializer,s=this.units;i=new(n=function(u){ge(l,u);function l(){return u!==null&&u.apply(this,arguments)||this}return l.prototype.apply=function(c,f){var h=o.apply([s]),p=new Xv().apply([s]),d=o.apply([s*2]);return tO(tO(h,p),d)},l}(ei),n.className="CustomInit",n)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){var i=n.training==null?!1:n.training;if(t=t,t.length!==3)throw new ie("LSTMCell expects 3 input Tensors (inputs, h, c), got "+(t.length+"."));var o=t[1],s=t[2];t=t[0],0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=ps({ones:function(){return _.onesLike(t)},rate:a.dropout,training:i,count:4,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=ps({ones:function(){return _.onesLike(o)},rate:a.recurrentDropout,training:i,count:4,dropoutFunc:a.dropoutFunc}));var u=a.dropoutMask,l=a.recurrentDropoutMask,c,f,h,p;0<a.dropout&&a.dropout<1&&(t=_.mul(t,u[0]));var d=Yi(t,a.kernel.read());0<a.recurrentDropout&&a.recurrentDropout<1&&(o=_.mul(o,l[0])),d=_.add(d,Yi(o,a.recurrentKernel.read())),a.useBias&&(d=Ii(d,a.bias.read()));var m=me(_.split(d,4,d.rank-1),4),v=m[0],g=m[1],y=m[2],b=m[3];c=a.recurrentActivation.apply(v),f=a.recurrentActivation.apply(g),h=_.add(_.mul(f,s),_.mul(c,a.activation.apply(y))),p=a.recurrentActivation.apply(b);var w=_.mul(p,a.activation.apply(h));return[w,w,h]})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={units:this.units,activation:fs(this.activation),recurrentActivation:fs(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Cr(this.kernelInitializer),recurrentInitializer:Cr(this.recurrentInitializer),biasInitializer:Cr(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Xt(this.kernelRegularizer),recurrentRegularizer:Xt(this.recurrentRegularizer),biasRegularizer:Xt(this.biasRegularizer),activityRegularizer:Xt(this.activityRegularizer),kernelConstraint:Jr(this.kernelConstraint),recurrentConstraint:Jr(this.recurrentConstraint),biasConstraint:Jr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},t,n)},e}(Jl);Ch.className="LSTMCell";M.serialization.registerClass(Ch);var ow=function(r){ge(e,r);function e(t){var n=this;return t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Ch(t),n=r.call(this,t)||this,n}return e.prototype.call=function(t,n){var a=this;return M.tidy(function(){a.cell.dropoutMask!=null&&(_.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(_.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)},e}(So);ow.className="LSTM";M.serialization.registerClass(ow);var gm=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;return n.cells=t.cells,n}return Object.defineProperty(e.prototype,"stateSize",{get:function(){var t,n,a=[];try{for(var i=be(this.cells.slice().reverse()),o=i.next();!o.done;o=i.next()){var s=o.value;Array.isArray(s.stateSize)?a.push.apply(a,mt(s.stateSize)):a.push(s.stateSize)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a},enumerable:!0,configurable:!0}),e.prototype.call=function(t,n){var a=this;return M.tidy(function(){var i,o,s,u;t=t;var l=t.slice(1),c=[];try{for(var f=be(a.cells.slice().reverse()),h=f.next();!h.done;h=f.next()){var p=h.value;Array.isArray(p.stateSize)?c.push(l.splice(0,p.stateSize.length)):c.push(l.splice(0,1))}}catch(w){i={error:w}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}c.reverse();for(var d=[],m,v=0;v<a.cells.length;++v){var p=a.cells[v];l=c[v],v===0?m=[t[0]].concat(l):m=[m[0]].concat(l),m=p.call(m,n),d.push(m.slice(1))}l=[];try{for(var g=be(d.slice().reverse()),y=g.next();!y.done;y=g.next()){var b=y.value;l.push.apply(l,mt(b))}}catch(w){s={error:w}}finally{try{y&&!y.done&&(u=g.return)&&u.call(g)}finally{if(s)throw s.error}}return[m[0]].concat(l)})},e.prototype.build=function(t){Sb(t)&&(t=t[0]),t=t;var n;this.cells.forEach(function(a,i){lu("RNNCell_"+i,function(){a.build(t),Array.isArray(a.stateSize)?n=a.stateSize[0]:n=a.stateSize,t=[t[0],n]})}),this.built=!0},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n=function(o){return{className:o.getClassName(),config:o.getConfig()}},a=this.cells.map(n),i={cells:a};return Object.assign({},t,i)},e.fromConfig=function(t,n,a){var i,o;a===void 0&&(a={});var s=[];try{for(var u=be(n.cells),l=u.next();!l.done;l=u.next()){var c=l.value;s.push(Si(c,a))}}catch(f){i={error:f}}finally{try{l&&!l.done&&(o=u.return)&&o.call(u)}finally{if(i)throw i.error}}return new t({cells:s})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){var t,n;if(!this.trainable)return[];var a=[];try{for(var i=be(this.cells),o=i.next();!o.done;o=i.next()){var s=o.value;a.push.apply(a,mt(s.trainableWeights))}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){var t,n,a,i,o=[];try{for(var s=be(this.cells),u=s.next();!u.done;u=s.next()){var l=u.value;o.push.apply(o,mt(l.nonTrainableWeights))}}catch(p){t={error:p}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}if(!this.trainable){var c=[];try{for(var f=be(this.cells),h=f.next();!h.done;h=f.next()){var l=h.value;c.push.apply(c,mt(l.trainableWeights))}}catch(p){a={error:p}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}return c.concat(o)}return o},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){var t,n,a=[];try{for(var i=be(this.cells),o=i.next();!o.done;o=i.next()){var s=o.value;a.push.apply(a,mt(s.weights))}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return Nb(a)},e.prototype.setWeights=function(t){var n,a,i=[];try{for(var o=be(this.cells),s=o.next();!s.done;s=o.next())for(var u=s.value,l=u.weights.length,c=t.splice(l),f=0;f<u.weights.length;++f)i.push([u.weights[f],c[f]])}catch(h){n={error:h}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}Zb(i)},e}(Jl);gm.className="StackedRNNCells";M.serialization.registerClass(gm);function ps(r){var e=r.ones,t=r.rate,n=r.training,a=n===void 0?!1:n,i=r.count,o=i===void 0?1:i,s=r.dropoutFunc,u=function(){return s!=null?s(e(),t):pP(e(),t)},l=function(){return bh(u,e,a)};if(!o||o<=1)return _.keep(l().clone());var c=Array(o).fill(void 0).map(l);return c.map(function(f){return _.keep(f.clone())})}var j1e=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(r);a<n.length;a++)e.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(r,n[a])&&(t[n[a]]=r[n[a]]);return t};(function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(Jl);var IB=function(r){ge(e,r);function e(t){var n=this;if(t.unroll)throw new Nt("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new Nt("It is not possible at the moment to stack convolutional cells.");return n=r.call(this,t)||this,n.inputSpec=[new Kr({ndim:5})],n}return e.prototype.call=function(t,n){var a=this;return _.tidy(function(){if(a.cell.dropoutMask!=null&&(_.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(_.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null),n&&n.constants)throw new ie("ConvRNN2D cell does not support constants");var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.prototype.computeOutputShape=function(t){var n=this.computeSingleOutputShape(t);return this.returnSequences||(n=mt([n[0]],n.slice(2))),this.returnState&&(n=mt([n],Array(2).fill(mt([t[0]],n.slice(-3))))),n},e.prototype.getInitialState=function(t){var n=this;return _.tidy(function(){var a=n.cell.stateSize,i=t.shape,o=n.computeSingleOutputShape(i),s=mt([o[0]],o.slice(2)),u=_.zeros(s);return Array.isArray(a)?Array(a.length).fill(u):[u]})},e.prototype.resetStates=function(t,n){var a=this;n===void 0&&(n=!1),_.tidy(function(){if(!a.stateful)throw new ss("Cannot call resetStates() on an RNN Layer that is not stateful.");var i=a.inputSpec[0].shape,o=a.computeSingleOutputShape(i),s=mt([o[0]],o.slice(2)),u=i[0];if(u==null)throw new ie("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(a.getStates()==null)Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(){return _.zeros(s)}):a.states_=[_.zeros(s)];else if(t==null)_.dispose(a.states_),a.keptStates!=null&&(_.dispose(a.keptStates),a.keptStates=[]),Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(){return _.zeros(s)}):a.states_[0]=_.zeros(s);else{if(Array.isArray(t)||(t=[t]),t.length!==a.states_.length)throw new ie("Layer "+a.name+" expects "+a.states_.length+" state(s), "+("but it received "+t.length+" state value(s). Input ")+("received: "+t));n?a.keptStates.push(a.states_.slice()):_.dispose(a.states_);for(var l=0;l<a.states_.length;++l){var c=t[l],f=s;if(!M.util.arraysEqual(c.shape,f))throw new ie("State "+l+" is incompatible with layer "+a.name+": "+("expected shape="+f+", received shape="+c.shape));a.states_[l]=c}}a.states_=a.states_.map(function(h){return _.keep(h.clone())})})},e.prototype.computeSingleOutputShape=function(t){var n=this.cell,a=n.dataFormat,i=n.filters,o=n.kernelSize,s=n.padding,u=n.strides,l=n.dilationRate,c=a==="channelsFirst",f=t[c?3:2],h=t[c?4:3],p=Ni(f,o[0],s,u[0],l[0]),d=Ni(h,o[1],s,u[1],l[1]),m=mt(t.slice(0,2),c?[i,p,d]:[p,d,i]);return m},e}(So);IB.className="ConvRNN2D";var ym=function(r){ge(e,r);function e(t){var n=this,a=t.filters,i=t.kernelSize,o=t.strides,s=t.padding,u=t.dataFormat,l=t.dilationRate;return n=r.call(this,Object.assign({},t,{units:a}))||this,n.filters=a,an(n.filters,"filters"),n.kernelSize=Wl(i,2,"kernelSize"),n.kernelSize.forEach(function(c){return an(c,"kernelSize")}),n.strides=Wl(o||1,2,"strides"),n.strides.forEach(function(c){return an(c,"strides")}),n.padding=s||"valid",Da(n.padding),n.dataFormat=u||"channelsLast",qr(n.dataFormat),n.dilationRate=Wl(l||1,2,"dilationRate"),n.dilationRate.forEach(function(c){return an(c,"dilationRate")}),n}return e.prototype.build=function(t){var n;t=Gt(t);var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new ie("The channel dimension of the input should be defined. "+("Found "+t[a]));var i=t[a],o=4,s=this.kernelSize.concat([i,this.filters*o]);this.kernel=this.addWeight("kernel",s,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var u=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",u,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var l=void 0;if(this.unitForgetBias){var c=this.biasInitializer,f=this.filters;l=new(n=function(h){ge(p,h);function p(){return h!==null&&h.apply(this,arguments)||this}return p.prototype.apply=function(d,m){var v=c.apply([f]),g=_.ones([f]),y=c.apply([f*2]);return Vb([v,g,y])},p}(ei),n.className="CustomInit",n)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0},e.prototype.call=function(t,n){var a=this;return _.tidy(function(){if(t.length!==3)throw new ie("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+(t.length+"."));var i=n.training||!1,o=t[0],s=t[1],u=t[2],l=4;0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=ps({ones:function(){return _.onesLike(o)},rate:a.dropout,training:i,count:l,dropoutFunc:a.dropoutFunc}));var c=a.dropoutMask,f=function(he,xe,Se){return!xe||!xe[Se]?he:_.mul(xe[Se],he)},h=f(o,c,0),p=f(o,c,1),d=f(o,c,2),m=f(o,c,3);0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=ps({ones:function(){return _.onesLike(s)},rate:a.recurrentDropout,training:i,count:l,dropoutFunc:a.dropoutFunc}));var v=a.recurrentDropoutMask,g=f(s,v,0),y=f(s,v,1),b=f(s,v,2),w=f(s,v,3),x=3,k=me(_.split(a.kernel.read(),l,x),4),N=k[0],T=k[1],I=k[2],F=k[3],D=me(a.useBias?_.split(a.bias.read(),l):[null,null,null,null],4),R=D[0],P=D[1],B=D[2],q=D[3];h=a.inputConv(h,N,R,a.padding),p=a.inputConv(p,T,P,a.padding),d=a.inputConv(d,I,B,a.padding),m=a.inputConv(m,F,q,a.padding);var O=me(_.split(a.recurrentKernel.read(),l,x),4),V=O[0],K=O[1],Z=O[2],j=O[3];g=a.recurrentConv(g,V),y=a.recurrentConv(y,K),b=a.recurrentConv(b,Z),w=a.recurrentConv(w,j);var ee=a.recurrentActivation.apply(_.add(h,g)),le=a.recurrentActivation.apply(_.add(p,y)),se=_.add(_.mul(le,u),_.mul(ee,a.activation.apply(_.add(d,b)))),ce=_.mul(a.recurrentActivation.apply(_.add(m,w)),a.activation.apply(se));return[ce,ce,se]})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);t.units;var n=j1e(t,["units"]),a={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},n,a)},e.prototype.inputConv=function(t,n,a,i){var o=_.conv2d(t,n,this.strides,i||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return a?Ii(o,a,this.dataFormat):o},e.prototype.recurrentConv=function(t,n){var a=1;return _.conv2d(t,n,a,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")},e}(Ch);ym.className="ConvLSTM2DCell";_.serialization.registerClass(ym);var sw=function(r){ge(e,r);function e(t){var n=this,a=new ym(t);return n=r.call(this,Object.assign({},t,{cell:a}))||this,n}return e.fromConfig=function(t,n){return new t(n)},e}(IB);sw.className="ConvLSTM2D";_.serialization.registerClass(sw);var bm=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;return n.rate=Math.max(Math.min(t.rate,1),0),n.noiseShape=t.noiseShape,n.seed=t.seed,n.supportsMasking=!0,n}return e.prototype.getNoiseShape=function(t){if(this.noiseShape==null)return this.noiseShape;for(var n=t.shape,a=[],i=0;i<this.noiseShape.length;++i)a.push(this.noiseShape[i]==null?n[i]:this.noiseShape[i]);return a},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){a.invokeCallHook(t,n);var i=xt(t);if(0<a.rate&&a.rate<1){var o=n.training==null?!1:n.training,s=a.getNoiseShape(i),u=bh(function(){return pP(i,a.rate,s,a.seed)},function(){return i},o);return u}return t})},e.prototype.getConfig=function(){var t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.dispose=function(){return r.prototype.dispose.call(this)},e}(Dt);bm.className="Dropout";M.serialization.registerClass(bm);var uw=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;return n.inputSpec=[{ndim:3}],n}return e.prototype.getNoiseShape=function(t){var n=t.shape;return[n[0],1,n[2]]},e}(bm);uw.className="SpatialDropout1D";M.serialization.registerClass(uw);var lw=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;if(n.activation=null,n.useBias=!0,n.kernel=null,n.bias=null,n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_BIAS_INITIALIZER="zeros",t.batchInputShape==null&&t.inputShape==null&&t.inputDim!=null){var a=null;t.batchSize!=null&&(a=t.batchSize),n.batchInputShape=[a,t.inputDim]}return n.units=t.units,an(n.units,"units"),n.activation=hs(t.activation),t.useBias!=null&&(n.useBias=t.useBias),n.kernelInitializer=Sr(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.biasInitializer=Sr(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelConstraint=Qr(t.kernelConstraint),n.biasConstraint=Qr(t.biasConstraint),n.kernelRegularizer=Nr(t.kernelRegularizer),n.biasRegularizer=Nr(t.biasRegularizer),n.activityRegularizer=Nr(t.activityRegularizer),n.supportsMasking=!0,n.inputSpec=[{minNDim:2}],n}return e.prototype.build=function(t){var n;t=Gt(t);var a=t[t.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[a,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(n={},n[-1]=a,n)}],this.built=!0},e.prototype.computeOutputShape=function(t){t=Gt(t);var n=t.slice();return n[n.length-1]=this.units,n},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){a.invokeCallHook(t,n);var i=xt(t),o=oP(a.activation.getClassName()),s;return o!=null?s=Yi(i,a.kernel.read(),o,a.bias?a.bias.read():null):(s=Yi(i,a.kernel.read()),a.bias!=null&&(s=Ii(s,a.bias.read())),a.activation!=null&&(s=a.activation.apply(s))),s})},e.prototype.getConfig=function(){var t={units:this.units,activation:fs(this.activation),useBias:this.useBias,kernelInitializer:Cr(this.kernelInitializer),biasInitializer:Cr(this.biasInitializer),kernelRegularizer:Xt(this.kernelRegularizer),biasRegularizer:Xt(this.biasRegularizer),activityRegularizer:Xt(this.activityRegularizer),kernelConstraint:Jr(this.kernelConstraint),biasConstraint:Jr(this.biasConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Dt);lw.className="Dense";M.serialization.registerClass(lw);var cw=function(r){ge(e,r);function e(t){var n=this;return t=t||{},n=r.call(this,t)||this,n.inputSpec=[{minNDim:3}],n.dataFormat=t.dataFormat,n}return e.prototype.computeOutputShape=function(t){var n,a;t=Gt(t);try{for(var i=be(t.slice(1)),o=i.next();!o.done;o=i.next()){var s=o.value;if(s==null)throw new ie('The shape of the input to "Flatten" is not fully defined '+("(got "+t.slice(1)+"). Make sure to pass a complete ")+'"input_shape" or "batch_input_shape" argument to the first layer in your model.')}}catch(u){n={error:u}}finally{try{o&&!o.done&&(a=i.return)&&a.call(i)}finally{if(n)throw n.error}}return[t[0],ls(t,1)]},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){a.invokeCallHook(t,n);var i=xt(t);if(a.dataFormat==="channelsFirst"&&i.rank>1){for(var o=[0],s=2;s<i.rank;++s)o.push(s);o.push(1),i=M.transpose(i,o)}return nce(i)})},e.prototype.getConfig=function(){var t={};this.dataFormat!=null&&(t.dataFormat=this.dataFormat);var n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Dt);cw.className="Flatten";M.serialization.registerClass(cw);var fw=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.activation=hs(t.activation),n}return e.prototype.call=function(t,n){var a=this;return M.tidy(function(){a.invokeCallHook(t,n);var i=xt(t);return a.activation.apply(i)})},e.prototype.getConfig=function(){var t={activation:fs(this.activation)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Dt);fw.className="Activation";M.serialization.registerClass(fw);var hw=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;return n.n=t.n,n.inputSpec=[{ndim:2}],n}return e.prototype.computeOutputShape=function(t){return[t[0],this.n,t[1]]},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){return t=xt(t),tce(t,a.n)})},e.prototype.getConfig=function(){var t={n:this.n},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Dt);hw.className="RepeatVector";M.serialization.registerClass(hw);var pw=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;n.targetShape=t.targetShape;for(var a=0;a<n.targetShape.length;++a)n.isUnknown(n.targetShape[a])&&(n.targetShape[a]=null);return n}return e.prototype.isUnknown=function(t){return t<0||t==null},e.prototype.fixUnknownDimension=function(t,n){for(var a="Total size of new array must be unchanged.",i=n.slice(),o=1,s=null,u=0;u<i.length;++u){var l=i[u];if(this.isUnknown(l))if(s===null)s=u;else throw new ie("Can only specifiy one unknown dimension.");else o*=l}var c=ls(t);if(s!==null){if(o===0||c%o!==0)throw new ie(a);i[s]=c/o}else if(c!==o)throw new ie(a);return i},e.prototype.computeOutputShape=function(t){for(var n=!1,a=0;a<t.length;++a)if(this.isUnknown(t[a])){n=!0;break}return n?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){a.invokeCallHook(t,n);var i=xt(t),o=i.shape,s=o.slice(0,1).concat(a.fixUnknownDimension(o.slice(1),a.targetShape));return M.reshape(i,s)})},e.prototype.getConfig=function(){var t={targetShape:this.targetShape},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Dt);pw.className="Reshape";M.serialization.registerClass(pw);var dw=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;if(t.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+(t.dims+" instead."));var a=Ei(1,t.dims.length+1);if(!M.util.arraysEqual(t.dims.slice().sort(),a))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");return n.dims=t.dims,n.dimsIncludingBatch=[0].concat(n.dims),n.inputSpec=[new Kr({ndim:n.dims.length+1})],n}return e.prototype.computeOutputShape=function(t){t=Gt(t);var n=t.slice();return this.dims.forEach(function(a,i){n[i+1]=t[a]}),n},e.prototype.call=function(t,n){return M.transpose(xt(t),this.dimsIncludingBatch)},e.prototype.getConfig=function(){var t={dims:this.dims},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Dt);dw.className="Permute";M.serialization.registerClass(dw);var vw=function(r){ge(e,r);function e(t){var n=r.call(this,t??{})||this;return n.supportsMasking=!0,t!=null?n.maskValue=t.maskValue==null?0:t.maskValue:n.maskValue=0,n}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={maskValue:this.maskValue};return Object.assign(n,t),n},e.prototype.computeMask=function(t,n){var a=xt(t),i=-1;return M.any(M.notEqual(a,this.maskValue),i)},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){a.invokeCallHook(t,n);var i=xt(t),o=-1,s=!0,u=M.any(M.notEqual(i,a.maskValue),o,s),l=M.mul(i,M.cast(u,i.dtype));return l})},e}(Dt);vw.className="Masking";M.serialization.registerClass(vw);var mw=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;if(n.embeddings=null,n.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",t.batchInputShape==null&&t.inputShape==null){var a=null;t.batchSize!=null&&(a=t.batchSize),t.inputLength==null?n.batchInputShape=[a,null]:n.batchInputShape=[a].concat(cr(t.inputLength))}return n.inputDim=t.inputDim,an(n.inputDim,"inputDim"),n.outputDim=t.outputDim,an(n.outputDim,"outputDim"),n.embeddingsInitializer=Sr(t.embeddingsInitializer||n.DEFAULT_EMBEDDINGS_INITIALIZER),n.embeddingsRegularizer=Nr(t.embeddingsRegularizer),n.activityRegularizer=Nr(t.activityRegularizer),n.embeddingsConstraint=Qr(t.embeddingsConstraint),n.maskZero=t.maskZero,n.supportsMasking=t.maskZero,n.inputLength=t.inputLength,n}return e.prototype.build=function(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},e.prototype.warnOnIncompatibleInputShape=function(t){},e.prototype.computeMask=function(t,n){var a=this;return M.tidy(function(){return a.maskZero?(t=xt(t),M.notEqual(t,M.zerosLike(t))):null})},e.prototype.computeOutputShape=function(t){if(t=Gt(t),this.inputLength==null)return mt(t,[this.outputDim]);var n=cr(this.inputLength);if(n.length!==t.length-1)throw new ie('"inputLength" is '+this.inputLength+", but received "+("input shape has shape "+t));for(var a=0,i=0;i<n.length;++i){var o=n[i],s=t[i+1];if(o!=null&&s!=null&&o!==s)throw new ie('"inputLength" is '+this.inputLength+", but received "+("input shape has shape "+t));o==null&&(n[a]=s),a++}return mt([t[0]],n,[this.outputDim])},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){a.invokeCallHook(t,n);var i=xt(t);i.dtype!=="int32"&&(i=mh(i,"int32"));var o=hP(a.embeddings.read(),M.reshape(i,[i.size]));return M.reshape(o,Gt(a.computeOutputShape(i.shape)))})},e.prototype.getConfig=function(){var t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Cr(this.embeddingsInitializer),embeddingsRegularizer:Xt(this.embeddingsRegularizer),activityRegularizer:Xt(this.activityRegularizer),embeddingsConstraint:Jr(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Dt);mw.className="Embedding";M.serialization.registerClass(mw);var Su=function(r){ge(e,r);function e(t){var n=r.call(this,t||{})||this;return n.supportsMasking=!0,n}return e.prototype.mergeFunction=function(t){throw new Nt},e.prototype.computeElementwiseOpOutputShape=function(t,n){if(t==null||n==null)return null;if(t.length<n.length)return this.computeElementwiseOpOutputShape(n,t);if(n.length===0)return t;for(var a=t.slice(0,t.length-n.length),i=0;i<n.length;++i){var o=t[t.length-n.length+i],s=n[i];if(o==null||s==null||o<0||s<0)a.push(null);else if(o===1)a.push(s);else if(s===1)a.push(o);else{if(o!==s)throw new ie("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(n));a.push(o)}}return a},e.prototype.build=function(t){var n,a;if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[Gt(t)]),t=t,t.length<2)throw new ie("A merge layer should be called on an Array of at least 2 inputs."+(" Got "+t.length+" input(s)."));var i=[];try{for(var o=be(t),s=o.next();!s.done;s=o.next()){var u=s.value;u!=null&&u[0]!==null&&i.push(u[0])}}catch(h){n={error:h}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}if(i=us(i),i.length>1)throw new ie("Can not merge tensors with different batch sizes. "+("Got tensors with shapes: "+JSON.stringify(t)+"."));for(var l=t[0]==null?null:t[0].slice(1),c=1;c<t.length;++c){var u=t[c]==null?null:t[c].slice(1);l=this.computeElementwiseOpOutputShape(l,u)}var f=t.map(function(h){return h.length});t.indexOf(null)===-1&&us(f).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){var i,o,s,u;if(t=t,a.reshapeRequired){var l=[],c=t.map(function(P){return P.rank});if(c.indexOf(null)===-1){var f=cs(c);try{for(var h=be(t),p=h.next();!p.done;p=h.next()){for(var d=p.value,m=d.rank,v=0;v<f-m;++v)d=gh(d,1);l.push(d)}}catch(P){i={error:P}}finally{try{p&&!p.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}return a.mergeFunction(l)}else{var g=!1;try{for(var y=be(t),b=y.next();!b.done;b=y.next()){var d=b.value,m=d.rank;if(m==null){var w=d.shape,x=w[0],k=w.slice(1).concat([x]),N=_.reshape(d,[x].concat(ls(w.slice(1))));N=_.transpose(N,[1,0]),N=_.reshape(N,k),l.push(N),g=!0}else if(m>1){var T=Ei(1,m).concat([0]);l.push(_.transpose(d,T)),g=!0}else l.push(d)}}catch(P){s={error:P}}finally{try{b&&!b.done&&(u=y.return)&&u.call(y)}finally{if(s)throw s.error}}var I=a.mergeFunction(l),F=I.rank;if(g){if(F==null){var D=I.shape,R=D.length,x=D[R-1],k=[x].concat(D.slice(0,D.length-1));I=_.reshape(_.transpose(_.reshape(I,[-1,x]),[1,0]),k)}else if(F>1){var T=[F-1].concat(Ei(0,F-1));I=_.transpose(I,T)}}return I}}else return a.mergeFunction(t)})},e.prototype.computeOutputShape=function(t){var n,a;t=t;var i;t[0]==null?i=null:i=t[0].slice(1);for(var o=1;o<t.length;++o){var s=t[o]==null?null:t[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}var u=[];try{for(var l=be(t),c=l.next();!c.done;c=l.next()){var s=c.value;s!=null&&s[0]!==null&&u.push(s[0])}}catch(f){n={error:f}}finally{try{c&&!c.done&&(a=l.return)&&a.call(l)}finally{if(n)throw n.error}}return u=us(u),u.length===1?i=u.concat(i):i=[null].concat(i),i},e.prototype.computeMask=function(t,n){return _.tidy(function(){if(n==null)return null;if(!Array.isArray(n))throw new ie("`mask` should be an Array");if(!Array.isArray(t))throw new ie("`inputs` should be an Array");if(n.length!==t.length)throw new ie("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths "+("("+t.length+" vs "+n.length+")"));if(n.every(function(o){return o==null}))return null;n=n.map(function(o){return o==null?o:_.expandDims(o,0)});for(var a=n[0],i=1;i<n.length-1;++i)a=_.logicalAnd(a,n[i]);return a})},e}(Dt),gw=function(r){ge(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return M.tidy(function(){for(var n=t[0].clone(),a=1;a<t.length;++a)n=_.add(n,t[a]);return n})},e}(Su);gw.className="Add";M.serialization.registerClass(gw);var yw=function(r){ge(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return M.tidy(function(){for(var n=t[0].clone(),a=1;a<t.length;++a)n=_.mul(n,t[a]);return n})},e}(Su);yw.className="Multiply";M.serialization.registerClass(yw);var bw=function(r){ge(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return M.tidy(function(){for(var n=t[0].clone(),a=1;a<t.length;++a)n=_.add(n,t[a]);return _.mul(1/t.length,n)})},e}(Su);bw.className="Average";M.serialization.registerClass(bw);var ww=function(r){ge(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return M.tidy(function(){for(var n=t[0],a=1;a<t.length;++a)n=_.maximum(n,t[a]);return n})},e}(Su);ww.className="Maximum";M.serialization.registerClass(ww);var xw=function(r){ge(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return M.tidy(function(){for(var n=t[0],a=1;a<t.length;++a)n=_.minimum(n,t[a]);return n})},e}(Su);xw.className="Minimum";M.serialization.registerClass(xw);var kw=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;return n.DEFAULT_AXIS=-1,t==null&&(t={}),n.axis=t.axis==null?n.DEFAULT_AXIS:t.axis,n.supportsMasking=!0,n.reshapeRequired=!1,n}return e.prototype.build=function(t){var n,a,i,o;if(!(Array.isArray(t)&&Array.isArray(t[0]))||t.length===1)throw new ie("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;var s=!0;try{for(var u=be(t),l=u.next();!l.done;l=u.next()){var c=l.value;if(c!=null){s=!1;break}}}catch(g){n={error:g}}finally{try{l&&!l.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}if(!s){for(var f=[],h=0;h<t.length;++h){var p=t[h].slice();p.splice(this.axis,1);var d=!1;try{for(var m=(i=void 0,be(f)),v=m.next();!v.done;v=m.next()){var c=v.value;if(M.util.arraysEqual(c,p)){d=!0;break}}}catch(g){i={error:g}}finally{try{v&&!v.done&&(o=m.return)&&o.call(m)}finally{if(i)throw i.error}}d||f.push(p)}if(f.length>1)throw new ie("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}},e.prototype.mergeFunction=function(t){var n=this;return M.tidy(function(){return Vb(t,n.axis)})},e.prototype.computeOutputShape=function(t){var n,a;if(!(Array.isArray(t)&&Array.isArray(t[0])))throw new ie("A `Concatenate` layer should be called on a list of inputs.");var i=t,o=i[0].slice(),s=this.axis<0?o.length+this.axis:this.axis;try{for(var u=be(i.slice(1)),l=u.next();!l.done;l=u.next()){var c=l.value;if(o[s]==null||c[s]==null){o[s]=null;break}o[s]+=c[s]}}catch(f){n={error:f}}finally{try{l&&!l.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}return o},e.prototype.computeMask=function(t,n){var a=this;if(n==null)return null;if(!Array.isArray(n))throw new ie("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new ie("`inputs` should be an array for Concatenate");if(n.length!==t.length)throw new ie("Mismatch in the length of mask ("+n.length+") "+("and the legnth of inputs ("+t.length+")"));return _.tidy(function(){var i=!0;if(n.forEach(function(l){if(l!=null){i=!1;return}}),i)return null;for(var o=[],s=0;s<t.length;++s)n[s]==null?o.push(_.cast(_.onesLike(t[s]),"bool")):n[s].rank<t[s].rank?o.push(_.expandDims(n[s],-1)):o.push(n[s]);var u=_.concat(o,a.axis);return _.all(u,-1,!1)})},e.prototype.getConfig=function(){var t={axis:this.axis},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Su);kw.className="Concatenate";M.serialization.registerClass(kw);function Zf(r,e){for(;r<0;)r+=e;return r}function X1e(r,e,t){if(r.shape.length>3||e.shape.length>3)throw new Nt("batchDot is not implemented for tensors of 4D or higher rank yet");if(_.util.assert(r.shape.length>=2,function(){return"batchDot requires the rank of x to be >= 2, "+("but got "+r.shape.length)}),_.util.assert(r.shape.length>=2,function(){return"batchDot requires the rank of y to be >= 2, "+("but got "+e.shape.length)}),typeof t=="number"&&(t=[t,t]),r.dtype==="complex64"||e.dtype==="complex64")throw new Nt("batchDot is not implemented for complex64-type Tensors yet.");var n=r.shape.length,a=e.shape.length;t==null&&(t=[n-1,a-2]);var i=t;return _.tidy(function(){var o;if(n>a){o=n-a;for(var s=[],u=0;u<o;++u)s.push(1);e=_.reshape(e,e.shape.concat(s))}else if(a>n){o=a-n;for(var s=[],u=0;u<o;++u)s.push(1);r=_.reshape(r,r.shape.concat(s))}else o=0;var l;if(r.shape.length===2&&e.shape.length===2)i[0]===i[1]?l=_.sum(_.mul(r,e),i[0]):l=_.sum(_.mul(_.transpose(r,[1,0]),e),i[1]);else{var c=i[0]!==r.shape.length-1,f=i[1]===e.shape.length-1;l=_.matMul(r,e,c,f)}if(o>0){var h=void 0;n>a?h=n+a-3:h=n-1;for(var p=[],u=h;u<h+o;++u)p.push(u);l=_.squeeze(l,p)}return l.shape.length===1&&(l=_.expandDims(l,1)),l})}var Sw=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;return n.axes=t.axes,n.normalize=t.normalize==null?!1:t.normalize,n.supportsMasking=!0,n.reshapeRequired=!1,n}return e.prototype.build=function(t){_.util.assert(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var n=t[0],a=t[1];if(n.length>3||a.length>3)throw new Nt("Dot layer does not support tensors of 4D or higher rank yet.");var i=this.interpretAxes(n,a);if(n[i[0]]!==a[i[1]])throw new ie("Dimension incompatibility: "+(n[i[0]]+" !== "+a[i[1]]))},e.prototype.mergeFunction=function(t){if(t.length!==2)throw new ie("A `Dot` layer must be called on exactly 2 inputs, "+("but received "+t.length+" input(s)."));var n=t[0],a=t[1],i;return Array.isArray(this.axes)?i=this.axes.map(function(o,s){return Zf(o,t[s].shape.length)}):i=[Zf(this.axes,n.shape.length),Zf(this.axes,a.shape.length)],this.normalize&&(n=qv(n,i[0]),a=qv(a,i[1])),X1e(n,a,i)},e.prototype.interpretAxes=function(t,n){var a;return Array.isArray(this.axes)?a=this.axes:a=[Zf(this.axes,t.length),Zf(this.axes,n.length)],a},e.prototype.computeOutputShape=function(t){_.util.assert(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var n=t[0].slice(),a=t[1].slice();if(n.length>3||a.length>3)throw new Nt("Dot layer does not support tensors of 4D or higher rank yet.");var i=this.interpretAxes(n,a);n.splice(i[0],1),a.splice(i[1],1),a.splice(0,1);var o=n.concat(a);return o.length===1&&o.push(1),o},e.prototype.computeMask=function(t,n){return null},e.prototype.getConfig=function(){var t={axes:this.axes,normalize:this.normalize},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Su);Sw.className="Dot";M.serialization.registerClass(Sw);var Nw=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.stddev=t.stddev,n}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={stddev:this.stddev};return Object.assign(n,t),n},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){a.invokeCallHook(t,n);var i=xt(t),o=function(){return M.add(jv(i.shape,0,a.stddev),i)},s=bh(o,function(){return i},n.training||!1);return s})},e}(Dt);Nw.className="GaussianNoise";M.serialization.registerClass(Nw);var Ew=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.rate=t.rate,n}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={rate:this.rate};return Object.assign(n,t),n},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){a.invokeCallHook(t,n);var i=xt(t);if(a.rate>0&&a.rate<1){var o=function(){var s=Math.sqrt(a.rate/(1-a.rate));return M.mul(i,jv(i.shape,1,s))};return bh(o,function(){return i},n.training||!1)}return i})},e}(Dt);Ew.className="GaussianDropout";M.serialization.registerClass(Ew);var Tw=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.rate=t.rate,n.noiseShape=t.noiseShape,n}return e.prototype._getNoiseShape=function(t){return this.noiseShape||xt(t).shape},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={rate:this.rate};return Object.assign(n,t),n},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){if(a.rate<1&&a.rate>0){var i=a._getNoiseShape(t),o=function(){var s=xt(t),u=1.6732632423543772,l=1.0507009873554805,c=-u*l,f=M.greaterEqual(M.randomUniform(i),a.rate);f=mh(f,"float32");var h=Math.pow((1-a.rate)*(1+a.rate*Math.pow(c,2)),-.5),p=-h*c*a.rate,d=M.add(M.mul(s,f),M.mul(M.add(f,-1),c));return M.add(M.mul(d,h),p)};return bh(o,function(){return xt(t)},n.training||!1)}return t})},e}(Dt);Tw.className="AlphaDropout";M.serialization.registerClass(Tw);function dh(r,e,t,n,a,i){i===void 0&&(i=.001);var o;if(r.rank===2)o=_.batchNorm2d(r,e,t,n,a,i);else if(r.rank===3)o=_.batchNorm3d(r,e,t,n,a,i);else if(r.rank===4)o=_.batchNorm4d(r,e,t,n,a,i);else throw new Nt("batchNormalization is not implemented for array of rank "+r.rank+" yet");return o}function Y1e(r,e,t,n,a){return a===void 0&&(a=.001),M.tidy(function(){var i=_.moments(r,n),o=i.mean,s=i.variance,u=dh(r,o,s,t,e,a);return[u,o,s]})}function Z1e(r,e,t,n,a){return a===void 0&&(a=.001),M.tidy(function(){var i,o,s=_.moments(r,n),u=s.mean,l=s.variance,c=[];try{for(var f=be(Ei(0,r.rank)),h=f.next();!h.done;h=f.next()){var p=h.value;n.indexOf(p)!==-1?c.push(1):c.push(r.shape[p])}}catch(b){i={error:b}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}var d=M.reshape(u,c),m=M.reshape(l,c),v=e==null?null:M.reshape(e,c),g=t==null?null:M.reshape(t,c),y=dh(r,d,m,g,v,a);return[y,u,l]})}function J1e(r,e,t,n,a){return a===void 0&&(a=.001),M.util.arraysEqual(n.slice().sort(),Ei(0,r.rank-1))?Y1e(r,e,t,n,a):Z1e(r,e,t,n,a)}var Iw=function(r){ge(e,r);function e(t){var n=this;return t==null&&(t={}),n=r.call(this,t)||this,n.supportsMasking=!0,n.axis=t.axis==null?-1:t.axis,n.momentum=t.momentum==null?.99:t.momentum,n.epsilon=t.epsilon==null?.001:t.epsilon,n.center=t.center==null?!0:t.center,n.scale=t.scale==null?!0:t.scale,n.betaInitializer=Sr(t.betaInitializer||"zeros"),n.gammaInitializer=Sr(t.gammaInitializer||"ones"),n.movingMeanInitializer=Sr(t.movingMeanInitializer||"zeros"),n.movingVarianceInitializer=Sr(t.movingVarianceInitializer||"ones"),n.betaConstraint=Qr(t.betaConstraint),n.gammaConstraint=Qr(t.gammaConstraint),n.betaRegularizer=Nr(t.betaRegularizer),n.gammaRegularizer=Nr(t.gammaRegularizer),n}return e.prototype.build=function(t){var n;t=Gt(t);var a=this.axis>=0?this.axis:this.axis+t.length,i=t[a];if(i==null)throw new ie("Axis "+a+" of input tensor should have a defined dimension but the layer received an input with shape "+(JSON.stringify(t)+"."));this.inputSpec=[new Kr({ndim:t.length,axes:(n={},n[a]=i,n)})];var o=[i];this.scale&&(this.gamma=this.addWeight("gamma",o,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",o,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",o,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",o,null,this.movingVarianceInitializer,null,!1),this.built=!0},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){var i=n.training==null?!1:n.training,o=xt(t),s=o.shape,u=s.length,l=Ei(0,u),c=a.axis>=0?a.axis:a.axis+u;l.splice(c,1);var f=fu(1,u);f[c]=s[c];var h=l.slice();h.sort();var p=!M.util.arraysEqual(h,Ei(0,u).slice(0,u-1)),d=function(){if(p){var x=M.reshape(a.movingMean.read(),f),k=M.reshape(a.movingVariance.read(),f),N=a.center?M.reshape(a.beta.read(),f):null,T=a.scale?M.reshape(a.gamma.read(),f):null;return dh(o,x,k,N,T,a.epsilon)}else return dh(o,a.movingMean.read(),a.movingVariance.read(),a.beta==null?null:a.beta.read(),a.gamma==null?null:a.gamma.read(),a.epsilon)};if(!i)return d();var m=me(J1e(o,a.gamma.read(),a.beta.read(),l,a.epsilon),3),v=m[0],g=m[1],y=m[2],b=function(x,k,N){_.tidy(function(){var T=1-N,I=x.read(),F=_.mul(_.sub(I,k),T);x.write(_.sub(I,F))})},w=function(){b(a.movingMean,g,a.momentum),b(a.movingVariance,y,a.momentum)};return w(),v})},e.prototype.getConfig=function(){var t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Cr(this.betaInitializer),gammaInitializer:Cr(this.gammaInitializer),movingMeanInitializer:Cr(this.movingMeanInitializer),movingVarianceInitializer:Cr(this.movingVarianceInitializer),betaRegularizer:Xt(this.betaRegularizer),gammaRegularizer:Xt(this.gammaRegularizer),betaConstraint:Jr(this.betaConstraint),gammaConstraint:Jr(this.gammaConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Dt);Iw.className="BatchNormalization";M.serialization.registerClass(Iw);var Cw=function(r){ge(e,r);function e(t){var n,a,i=this;if(t==null&&(t={}),i=r.call(this,t)||this,i.axis=t.axis==null?-1:t.axis,typeof i.axis=="number"){if(!Number.isInteger(i.axis))throw new Error("Expected axis to be an integer, but received "+i.axis)}else if(Array.isArray(i.axis))try{for(var o=be(i.axis),s=o.next();!s.done;s=o.next()){var u=s.value;if(!Number.isInteger(u))throw new Error("Expected axis to be an array of integers, "+("but received "+JSON.stringify(i.axis)))}}catch(l){n={error:l}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}else throw new Error("Expected axis to be an integer or an array of integers, "+("but received "+JSON.stringify(i.axis)));return i.epsilon=t.epsilon==null?.001:t.epsilon,i.center=t.center==null?!0:t.center,i.scale=t.scale==null?!0:t.scale,i.betaInitializer=Sr(t.betaInitializer||"zeros"),i.gammaInitializer=Sr(t.gammaInitializer||"ones"),i.betaRegularizer=Nr(t.betaRegularizer),i.gammaRegularizer=Nr(t.gammaRegularizer),i.supportsMasking=!0,i}return e.prototype.build=function(t){var n,a;t=Gt(t);var i=t.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(var o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=i);try{for(var s=be(this.axis),u=s.next();!u.done;u=s.next()){var l=u.value;if(l<0||l>=i)throw new Error("Invalid axis: "+l)}}catch(h){n={error:h}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}if(this.axis.length!==us(this.axis).length)throw new Error("Found duplicate axes in: "+this.axis);var c=this.axis.map(function(h){return t[h]}),f=!0;this.scale?this.gamma=this.addWeight("gamma",c,"float32",this.gammaInitializer,this.gammaRegularizer,f):this.gamma=null,this.center?this.beta=this.addWeight("beta",c,"float32",this.betaInitializer,this.betaRegularizer,f):this.beta=null,this.built=!0},e.prototype.call=function(t,n){var a=this,i=xt(t),o=i.shape,s=o.length;return M.tidy(function(){var u,l,c=!0,f=M.moments(i,a.axis,c),h=f.mean,p=f.variance,d=fu(1,s);try{for(var m=be(a.axis),v=m.next();!v.done;v=m.next()){var g=v.value;d[g]=o[g]}}catch(T){u={error:T}}finally{try{v&&!v.done&&(l=m.return)&&l.call(m)}finally{if(u)throw u.error}}for(var y=function(T){return T!=null&&T.shape.length!==s?_.reshape(T,d):T},b=a.scale?y(a.gamma.read()):null,w=a.center?y(a.beta.read()):null,x=[],k=[],N=0;N<s;++N)a.axis.indexOf(N)!==-1?(x.push(o[N]),k.push(1)):(x.push(1),k.push(o[N]));return h=_.tile(h,x),p=_.tile(p,x),b!=null&&(b=_.tile(b,k)),w!=null&&(w=_.tile(w,k)),dh(i,h,p,w,b,a.epsilon)})},e.prototype.getConfig=function(){var t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Cr(this.betaInitializer),gammaInitializer:Cr(this.gammaInitializer),betaRegularizer:Xt(this.betaRegularizer),gammaRegularizer:Xt(this.gammaRegularizer)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Dt);Cw.className="LayerNormalization";M.serialization.registerClass(Cw);function Q1e(r,e,t){return M.tidy(function(){if(r.rank!==4)throw new ie("temporalPadding expects input tensor to be 4-D, but received a "+(r.rank+"-D tensor."));if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new ie("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=Ti()),t!=="channelsLast"&&t!=="channelsFirst")throw new ie("Unknown data format: "+t+". Supported data formats are 'channelsLast' and 'channelsFirst.");var n;return t==="channelsFirst"?n=[[0,0],[0,0],e[0],e[1]]:n=[[0,0],e[0],e[1],[0,0]],_.pad(r,n)})}var Aw=function(r){ge(e,r);function e(t){var n=this;if(t==null&&(t={}),n=r.call(this,t)||this,n.dataFormat=t.dataFormat==null?Ti():t.dataFormat,t.padding==null)n.padding=[[1,1],[1,1]];else if(typeof t.padding=="number")n.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,t.padding.length!==2)throw new ie("ZeroPadding2D expects padding to be a length-2 array, but "+("received a length-"+t.padding.length+" array."));var a=void 0,i=void 0;if(typeof t.padding[0]=="number")a=[t.padding[0],t.padding[0]],i=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,t.padding[0].length!==2)throw new ie("ZeroPadding2D expects height padding to be a length-2 array, "+("but received a length-"+t.padding[0].length+" array."));if(a=t.padding[0],t.padding[1].length!==2)throw new ie("ZeroPadding2D expects width padding to be a length-2 array, "+("but received a length-"+t.padding[1].length+" array."));i=t.padding[1]}n.padding=[a,i]}return n.inputSpec=[new Kr({ndim:4})],n}return e.prototype.computeOutputShape=function(t){t=Gt(t);var n,a;return this.dataFormat==="channelsFirst"?(t[2]!=null&&t[2]>=0?n=t[2]+this.padding[0][0]+this.padding[0][1]:n=null,t[3]!=null&&t[3]>=0?a=t[3]+this.padding[1][0]+this.padding[1][1]:a=null,[t[0],t[1],n,a]):(t[1]!=null&&t[1]>=0?n=t[1]+this.padding[0][0]+this.padding[0][1]:n=null,t[2]!=null&&t[2]>=0?a=t[2]+this.padding[1][0]+this.padding[1][1]:a=null,[t[0],n,a,t[3]])},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){return Q1e(xt(t),a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={padding:this.padding,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Dt);Aw.className="ZeroPadding2D";M.serialization.registerClass(Aw);function wm(r,e,t,n,a,i){return M.tidy(function(){qr(a),uP(i),Da(n),t==null&&(t=[1,1]),n==null&&(n="valid"),a==null&&(a=Ti()),i==null&&(i="max"),r=Y1(r,a);var o,s=n==="same"?"same":"valid";return i==="max"?o=_.maxPool(r,e,t,s):o=_.avgPool(r,e,t,s),a==="channelsFirst"&&(o=_.transpose(o,[0,3,1,2])),o})}function CB(r,e,t,n,a,i){return M.tidy(function(){qr(a),uP(i),Da(n),t==null&&(t=[1,1,1]),n==null&&(n="valid"),a==null&&(a=Ti()),i==null&&(i="max"),r=kB(r,a);var o,s=n==="same"?"same":"valid";return i==="max"?o=_.maxPool3d(r,e,t,s):o=_.avgPool3d(r,e,t,s),a==="channelsFirst"&&(o=_.transpose(o,[0,4,1,2,3])),o})}var AB=function(r){ge(e,r);function e(t){var n=this;if(t.poolSize==null&&(t.poolSize=2),n=r.call(this,t)||this,typeof t.poolSize=="number")n.poolSize=[t.poolSize];else if(Array.isArray(t.poolSize)&&t.poolSize.length===1&&typeof t.poolSize[0]=="number")n.poolSize=t.poolSize;else throw new ie("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+(""+JSON.stringify(t.poolSize)));if(an(n.poolSize,"poolSize"),t.strides==null)n.strides=n.poolSize;else if(typeof t.strides=="number")n.strides=[t.strides];else if(Array.isArray(t.strides)&&t.strides.length===1&&typeof t.strides[0]=="number")n.strides=t.strides;else throw new ie("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+(""+JSON.stringify(t.strides)));return an(n.strides,"strides"),n.padding=t.padding==null?"valid":t.padding,Da(n.padding),n.inputSpec=[new Kr({ndim:3})],n}return e.prototype.computeOutputShape=function(t){t=Gt(t);var n=Ni(t[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],n,t[2]]},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){a.invokeCallHook(t,n),t=gh(xt(t),2);var i=a.poolingFunction(xt(t),[a.poolSize[0],1],[a.strides[0],1],a.padding,"channelsLast");return _.squeeze(i,[2])})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Dt),_w=function(r){ge(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return qr(o),Da(i),wm(t,n,a,i,o,"max")},e}(AB);_w.className="MaxPooling1D";M.serialization.registerClass(_w);var Dw=function(r){ge(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return qr(o),Da(i),wm(t,n,a,i,o,"avg")},e}(AB);Dw.className="AveragePooling1D";M.serialization.registerClass(Dw);var _B=function(r){ge(e,r);function e(t){var n=this;if(t.poolSize==null&&(t.poolSize=[2,2]),n=r.call(this,t)||this,n.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],t.strides==null)n.strides=n.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==2)throw new ie("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+(t.strides.length+"."));n.strides=t.strides}else n.strides=[t.strides,t.strides];return an(n.poolSize,"poolSize"),an(n.strides,"strides"),n.padding=t.padding==null?"valid":t.padding,n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,qr(n.dataFormat),Da(n.padding),n.inputSpec=[new Kr({ndim:4})],n}return e.prototype.computeOutputShape=function(t){t=Gt(t);var n=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2];return n=Ni(n,this.poolSize[0],this.padding,this.strides[0]),a=Ni(a,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,a]:[t[0],n,a,t[3]]},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){return a.invokeCallHook(t,n),a.poolingFunction(xt(t),a.poolSize,a.strides,a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Dt),Fw=function(r){ge(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return qr(o),Da(i),wm(t,n,a,i,o,"max")},e}(_B);Fw.className="MaxPooling2D";M.serialization.registerClass(Fw);var Rw=function(r){ge(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return qr(o),Da(i),wm(t,n,a,i,o,"avg")},e}(_B);Rw.className="AveragePooling2D";M.serialization.registerClass(Rw);var DB=function(r){ge(e,r);function e(t){var n=this;if(t.poolSize==null&&(t.poolSize=[2,2,2]),n=r.call(this,t)||this,n.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],t.strides==null)n.strides=n.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==3)throw new ie("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+(t.strides.length+"."));n.strides=t.strides}else n.strides=[t.strides,t.strides,t.strides];return an(n.poolSize,"poolSize"),an(n.strides,"strides"),n.padding=t.padding==null?"valid":t.padding,n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,qr(n.dataFormat),Da(n.padding),n.inputSpec=[new Kr({ndim:5})],n}return e.prototype.computeOutputShape=function(t){t=Gt(t);var n=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[4]:t[3];return n=Ni(n,this.poolSize[0],this.padding,this.strides[0]),a=Ni(a,this.poolSize[1],this.padding,this.strides[1]),i=Ni(i,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,a,i]:[t[0],n,a,i,t[4]]},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){return a.invokeCallHook(t,n),a.poolingFunction(xt(t),a.poolSize,a.strides,a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Dt),Ow=function(r){ge(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return qr(o),Da(i),CB(t,n,a,i,o,"max")},e}(DB);Ow.className="MaxPooling3D";M.serialization.registerClass(Ow);var Pw=function(r){ge(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return qr(o),Da(i),CB(t,n,a,i,o,"avg")},e}(DB);Pw.className="AveragePooling3D";M.serialization.registerClass(Pw);var FB=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;return n.inputSpec=[new Kr({ndim:3})],n}return e.prototype.computeOutputShape=function(t){return[t[0],t[2]]},e.prototype.call=function(t,n){throw new Nt},e}(Dt),Mw=function(r){ge(e,r);function e(t){return r.call(this,t||{})||this}return e.prototype.call=function(t,n){return M.tidy(function(){var a=xt(t);return _.mean(a,1)})},e}(FB);Mw.className="GlobalAveragePooling1D";M.serialization.registerClass(Mw);var Bw=function(r){ge(e,r);function e(t){return r.call(this,t||{})||this}return e.prototype.call=function(t,n){return M.tidy(function(){var a=xt(t);return _.max(a,1)})},e}(FB);Bw.className="GlobalMaxPooling1D";M.serialization.registerClass(Bw);var RB=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;return n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,qr(n.dataFormat),n.inputSpec=[new Kr({ndim:4})],n}return e.prototype.computeOutputShape=function(t){return t=t,this.dataFormat==="channelsLast"?[t[0],t[3]]:[t[0],t[1]]},e.prototype.call=function(t,n){throw new Nt},e.prototype.getConfig=function(){var t={dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Dt),Lw=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.call=function(t,n){var a=this;return M.tidy(function(){var i=xt(t);return a.dataFormat==="channelsLast"?_.mean(i,[1,2]):_.mean(i,[2,3])})},e}(RB);Lw.className="GlobalAveragePooling2D";M.serialization.registerClass(Lw);var zw=function(r){ge(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.call=function(t,n){var a=this;return M.tidy(function(){var i=xt(t);return a.dataFormat==="channelsLast"?_.max(i,[1,2]):_.max(i,[2,3])})},e}(RB);zw.className="GlobalMaxPooling2D";M.serialization.registerClass(zw);var OB=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;return n.layer=t.layer,n}return e.prototype.build=function(t){this.built=!0},Object.defineProperty(e.prototype,"trainable",{get:function(){return this.layer!=null?this.layer.trainable:!1},set:function(t){this.layer!=null&&(this.layer.trainable=t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){return this.layer.getWeights()},e.prototype.setWeights=function(t){this.layer.setWeights(t)},e.prototype.getConfig=function(){var t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.setFastWeightInitDuringBuild=function(t){r.prototype.setFastWeightInitDuringBuild.call(this,t),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(t)},e.fromConfig=function(t,n,a){a===void 0&&(a={});var i=n.layer,o=Si(i,a);delete n.layer;var s={layer:o};return Object.assign(s,n),new t(s)},e}(Dt),$w=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n}return e.prototype.build=function(t){if(t=Gt(t),t.length<3)throw new ie("TimeDistributed layer expects an input shape >= 3D, but received "+("input shape "+JSON.stringify(t)));this.inputSpec=[{shape:t}];var n=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),r.prototype.build.call(this,t)},e.prototype.computeOutputShape=function(t){t=Gt(t);var n=[t[0]].concat(t.slice(2)),a=this.layer.computeOutputShape(n),i=t[1];return[a[0],i].concat(a.slice(1))},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){t=xt(t);var i=function(u,l){var c=xt(a.layer.call(u,n));return[c,[]]},o=TB(i,t,[],!1,null,null,!1,!0),s=o[1];return s})},e}(OB);$w.className="TimeDistributed";M.serialization.registerClass($w);function ewe(r){du(Yle,"BidirectionalMergeMode",r)}var twe="concat",Ww=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this,a=t.layer.getConfig(),i={};i.className=t.layer.getClassName(),i.config=a,n.forwardLayer=Si(i),a.goBackwards=a.goBackwards!==!0;var o={};if(o.className=t.layer.getClassName(),o.config=a,n.backwardLayer=Si(o),n.forwardLayer.name="forward_"+n.forwardLayer.name,n.backwardLayer.name="backward_"+n.backwardLayer.name,n.mergeMode=t.mergeMode===void 0?twe:t.mergeMode,ewe(n.mergeMode),t.weights)throw new Nt("weights support is not implemented for Bidirectional layer yet.");return n._stateful=t.layer.stateful,n.returnSequences=t.layer.returnSequences,n.returnState=t.layer.returnState,n.supportsMasking=!0,n._trainable=!0,n.inputSpec=t.layer.inputSpec,n.numConstants=null,n}return Object.defineProperty(e.prototype,"trainable",{get:function(){return this._trainable},set:function(t){this._trainable=t,this.forwardLayer!=null&&(this.forwardLayer.trainable=t),this.backwardLayer!=null&&(this.backwardLayer.trainable=t)},enumerable:!0,configurable:!0}),e.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},e.prototype.setWeights=function(t){var n=t.length,a=Math.floor(n/2);this.forwardLayer.setWeights(t.slice(0,a)),this.backwardLayer.setWeights(t.slice(a))},e.prototype.computeOutputShape=function(t){var n=this.forwardLayer.computeOutputShape(t);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;var a,i,o;return this.returnState&&(o=n.slice(1)),a=n[0],a=a,this.mergeMode==="concat"?(a[a.length-1]*=2,i=[a]):this.mergeMode==null?i=[a,a.slice()]:i=[a],this.returnState?this.mergeMode==null?i.concat(o).concat(o.slice()):[a].concat(o).concat(o.slice()):Pn(i)},e.prototype.apply=function(t,n){var a,i,o=n==null?null:n.initialState,s=n==null?null:n.constants;n==null&&(n={});var u=EB(t,o,s,this.numConstants);if(t=u.inputs,o=u.initialState,s=u.constants,Array.isArray(t)&&(o=t.slice(1),t=t[0]),(o==null||o.length===0)&&s==null)return r.prototype.apply.call(this,t,n);var l=[],c=[];if(o!=null){var f=o.length;if(f%2>0)throw new ie("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=o,l.push.apply(l,mt(o));var h=o.map(function(x){return new Kr({shape:x.shape})});this.forwardLayer.stateSpec=h.slice(0,f/2),this.backwardLayer.stateSpec=h.slice(f/2),c.push.apply(c,mt(h))}if(s!=null)throw new Nt("Support for constants in Bidirectional layers is not implemented yet.");var p=l[0]instanceof ki;try{for(var d=be(l),m=d.next();!m.done;m=d.next()){var v=m.value;if(v instanceof ki!==p)throw new ie("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}}catch(x){a={error:x}}finally{try{m&&!m.done&&(i=d.return)&&i.call(d)}finally{if(a)throw a.error}}if(p){var g=[t].concat(l),y=this.inputSpec.concat(c),b=this.inputSpec;this.inputSpec=y;var w=r.prototype.apply.call(this,g,n);return this.inputSpec=b,w}else return r.prototype.apply.call(this,t,n)},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){var i=n.initialState,o,s;if(i==null)o=a.forwardLayer.call(t,n),s=a.backwardLayer.call(t,n);else{var u=i.slice(0,i.length/2),l=i.slice(i.length/2);o=a.forwardLayer.call(t,Object.assign(n,{initialState:u})),s=a.backwardLayer.call(t,Object.assign(n,{initialState:l}))}var c;a.returnState&&(Array.isArray(o)&&(c=o.slice(1).concat(s.slice(1))),o=o[0],s=s[0]),a.returnSequences&&(s=_.reverse(s,1));var f;return a.mergeMode==="concat"?f=Vb([o,s]):a.mergeMode==="sum"?f=_.add(o,s):a.mergeMode==="ave"?f=_.mul(.5,_.add(o,s)):a.mergeMode==="mul"?f=_.mul(o,s):a.mergeMode==null&&(f=[o,s]),a.returnState?a.mergeMode==null?f.concat(c):[f].concat(c):f})},e.prototype.resetStates=function(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},e.prototype.build=function(t){var n=this;lu(this.forwardLayer.name,function(){n.forwardLayer.build(t)}),lu(this.backwardLayer.name,function(){n.backwardLayer.build(t)}),this.built=!0},e.prototype.computeMask=function(t,n){Array.isArray(n)&&(n=n[0]);var a;if(this.returnSequences?this.mergeMode==null?a=[n,n]:a=n:this.mergeMode==null?a=[null,null]:a=null,this.returnState){var i=this.forwardLayer.states,o=i.map(function(s){return null});return Array.isArray(a)?a.concat(o).concat(o):[a].concat(o).concat(o)}else return a},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!0,configurable:!0}),e.prototype.setFastWeightInitDuringBuild=function(t){r.prototype.setFastWeightInitDuringBuild.call(this,t),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(t),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(t)},e.prototype.getConfig=function(){var t={mergeMode:this.mergeMode},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.fromConfig=function(t,n){var a=Si(n.layer);if(delete n.layer,n.numConstants!=null)throw new Nt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var i=n;return i.layer=a,new t(i)},e}(OB);Ww.className="Bidirectional";M.serialization.registerClass(Ww);var qw=function(r){ge(e,r);function e(t){var n=r.call(this,t)||this;return n.scale=t.scale,t.offset?n.offset=t.offset:n.offset=0,n}return e.prototype.getConfig=function(){var t={scale:this.scale,offset:this.offset},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.call=function(t,n){var a=this;return M.tidy(function(){return t=xt(t),t.dtype!=="float32"&&(t=mh(t,"float32")),M.add(M.mul(t,a.scale),a.offset)})},e}(Dt);qw.className="Rescaling";M.serialization.registerClass(qw);function rwe(r){return new Xl(r)}function nwe(r){return new K1(r)}function awe(r){return new G1(r)}function iwe(r){return new U1(r)}function owe(r){return new H1(r)}function swe(r){return new X1(r)}function uwe(r){return new j1(r)}function lwe(r){return new ew(r)}function cwe(r){return new pm(r)}function fwe(r){return new Z1(r)}function hwe(r){return new dm(r)}function pwe(r){return new J1(r)}function dwe(r){return new Q1(r)}function vwe(r){return new tw(r)}function mwe(r){return new rw(r)}function gwe(r){return new nw(r)}function ywe(r){return new fw(r)}function bwe(r){return new lw(r)}function wwe(r){return new bm(r)}function xwe(r){return new uw(r)}function kwe(r){return new cw(r)}function Swe(r){return new hw(r)}function Nwe(r){return new pw(r)}function Ewe(r){return new dw(r)}function Twe(r){return new mw(r)}function Iwe(r){return new gw(r)}function Cwe(r){return new bw(r)}function Awe(r){return new kw(r)}function _we(r){return new ww(r)}function Dwe(r){return new xw(r)}function Fwe(r){return new yw(r)}function Rwe(r){return new Sw(r)}function Owe(r){return new Iw(r)}function Pwe(r){return new Cw(r)}function Mwe(r){return new Aw(r)}function Vw(r){return new Dw(r)}function Bwe(r){return Vw(r)}function Lwe(r){return Vw(r)}function Gw(r){return new Rw(r)}function zwe(r){return Gw(r)}function $we(r){return Gw(r)}function Uw(r){return new Pw(r)}function Wwe(r){return Uw(r)}function qwe(r){return Uw(r)}function Vwe(r){return new Mw(r)}function Gwe(r){return new Lw(r)}function PB(r){return new Bw(r)}function MB(r){return new zw(r)}function BB(r){return new _w(r)}function LB(r){return new Fw(r)}function Uwe(r){return new Ow(r)}function Hwe(r){return new iw(r)}function Kwe(r){return new mm(r)}function jwe(r){return new ow(r)}function Xwe(r){return new Ch(r)}function Ywe(r){return new aw(r)}function Zwe(r){return new vm(r)}function Jwe(r){return new sw(r)}function Qwe(r){return new ym(r)}function exe(r){return new So(r)}function txe(r){return new gm(r)}function rxe(r){return new Ww(r)}function nxe(r){return new $w(r)}var axe=PB,ixe=MB,oxe=BB,sxe=LB;function uxe(r){return new Nw(r)}function lxe(r){return new Ew(r)}function cxe(r){return new Tw(r)}function fxe(r){return new vw(r)}function hxe(r){return new qw(r)}var pxe={__proto__:null,inputLayer:rwe,elu:nwe,reLU:awe,leakyReLU:iwe,prelu:owe,softmax:swe,thresholdedReLU:uwe,conv1d:lwe,conv2d:cwe,conv2dTranspose:fwe,conv3d:hwe,conv3dTranspose:pwe,separableConv2d:dwe,cropping2D:vwe,upSampling2d:mwe,depthwiseConv2d:gwe,activation:ywe,dense:bwe,dropout:wwe,spatialDropout1d:xwe,flatten:kwe,repeatVector:Swe,reshape:Nwe,permute:Ewe,embedding:Twe,add:Iwe,average:Cwe,concatenate:Awe,maximum:_we,minimum:Dwe,multiply:Fwe,dot:Rwe,batchNormalization:Owe,layerNormalization:Pwe,zeroPadding2d:Mwe,averagePooling1d:Vw,avgPool1d:Bwe,avgPooling1d:Lwe,averagePooling2d:Gw,avgPool2d:zwe,avgPooling2d:$we,averagePooling3d:Uw,avgPool3d:Wwe,avgPooling3d:qwe,globalAveragePooling1d:Vwe,globalAveragePooling2d:Gwe,globalMaxPooling1d:PB,globalMaxPooling2d:MB,maxPooling1d:BB,maxPooling2d:LB,maxPooling3d:Uwe,gru:Hwe,gruCell:Kwe,lstm:jwe,lstmCell:Xwe,simpleRNN:Ywe,simpleRNNCell:Zwe,convLstm2d:Jwe,convLstm2dCell:Qwe,rnn:exe,stackedRNNCells:txe,bidirectional:rxe,timeDistributed:nxe,globalMaxPool1d:axe,globalMaxPool2d:ixe,maxPool1d:oxe,maxPool2d:sxe,Layer:Dt,RNN:So,RNNCell:Jl,input:sB,gaussianNoise:uxe,gaussianDropout:lxe,alphaDropout:cxe,masking:fxe,rescaling:hxe};function dxe(r,e){return B1(r,e)}function vxe(r,e){return J4(r,e)}function mxe(r,e){return Q4(r,e)}function gxe(r,e){return L1(r,e)}function yxe(r,e){return z1(r,e)}function bxe(r,e){return Z4(r,e)}function wxe(r,e){return a1e(r,e)}function xxe(r,e){return M1(r,e)}function kxe(r,e){return lm(r,e)}function Sxe(r,e){return Zl(r,e)}function Nxe(r,e){return Zl(r,e)}function Exe(r,e){return Zl(r,e)}function Txe(r,e){return ku(r,e)}function Ixe(r,e){return ku(r,e)}function Cxe(r,e){return ku(r,e)}var Axe={__proto__:null,binaryAccuracy:dxe,binaryCrossentropy:vxe,sparseCategoricalAccuracy:mxe,categoricalAccuracy:gxe,categoricalCrossentropy:yxe,precision:bxe,recall:wxe,cosineProximity:xxe,meanAbsoluteError:kxe,meanAbsolutePercentageError:Sxe,MAPE:Nxe,mape:Exe,meanSquaredError:Txe,MSE:Ixe,mse:Cxe};var _xe={__proto__:null,modelFromJSON:P1e};function Dxe(r){return new Ih(r)}function Fxe(r){return V1e(r)}function Rxe(r){return G1e(r)}var Oxe={__proto__:null,l1l2:Dxe,l1:Fxe,l2:Rxe},zB=function(r){ge(e,r);function e(){var t=r.apply(this,mt(arguments))||this;return t.model=null,t}return e.prototype.setModel=function(t){if(!(t instanceof bo))throw new Error("model must be a LayersModel, not some other Container");this.model=t},e}(jl);function xv(r,e){return r<e}function nP(r,e){return r>e}var $B=function(r){ge(e,r);function e(t){var n=r.call(this)||this;if(t==null&&(t={}),t.restoreBestWeights)throw new Nt("restoreBestWeights = True is not implemented in EarlyStopping yet.");return n.monitor=t.monitor||"val_loss",n.minDelta=Math.abs(t.minDelta||0),n.patience=t.patience||0,n.verbose=t.verbose||0,n.mode=t.mode||"auto",n.baseline=t.baseline,["auto","min","max"].indexOf(n.mode)===-1&&(console.warn("EarlyStopping mode '"+n.mode+"' is invalid. Falling back to mode 'auto'."),n.mode="auto"),n.mode==="min"?n.monitorFunc=xv:n.mode==="max"||n.monitor.indexOf("acc")!==-1?n.monitorFunc=nP:n.monitorFunc=xv,n.monitorFunc===xv&&(n.minDelta*=-1),n}return e.prototype.onTrainBegin=function(t){return Ce(this,void 0,void 0,function(){return Ie(this,function(n){return this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===xv?1/0:-1/0,[2]})})},e.prototype.onEpochEnd=function(t,n){return Ce(this,void 0,void 0,function(){var a;return Ie(this,function(i){switch(i.label){case 0:return[4,os(n)];case 1:return i.sent(),a=this.getMonitorValue(n),a==null?[2]:(this.monitorFunc(a-this.minDelta,this.best)?(this.best=a,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=t,this.model.stopTraining=!0)),[2])}})})},e.prototype.onTrainEnd=function(t){return Ce(this,void 0,void 0,function(){return Ie(this,function(n){return this.stoppedEpoch>0&&this.verbose&&console.log("Epoch "+this.stoppedEpoch+": early stopping."),[2]})})},e.prototype.getMonitorValue=function(t){t==null&&(t={});var n=t[this.monitor];return n==null&&console.warn("Metric for EarlyStopping "+this.monitor+" is not available. "+("Available metrics are: "+Object.keys(t))),n},e}(zB);function Pxe(r){return new $B(r)}var Mxe={earlyStopping:Pxe};dr.Callback=zB;dr.CallbackList=U4;dr.CustomCallback=K4;dr.EarlyStopping=$B;dr.History=H4;dr.InputSpec=Kr;dr.LayerVariable=dP;dr.LayersModel=bo;dr.RNN=So;dr.Sequential=fm;dr.SymbolicTensor=ki;dr.callbacks=Mxe;dr.constraints=Abe;dr.initializers=Ube;dr.input=sB;dr.layers=pxe;dr.loadLayersModel=W1e;dr.metrics=Axe;dr.model=z1e;dr.models=_xe;dr.registerCallbackConstructor=q1e;dr.regularizers=Oxe;dr.sequential=$1e;dr.version_layers=$1});var Ez=ue(ws=>{"use strict";Object.defineProperty(ws,"__esModule",{value:!0});var $e=ru();function Bxe(r){if(r&&r.__esModule)return r;var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var qB=Bxe($e);var Lxe=$e.env();Lxe.registerFlag("KEEP_INTERMEDIATE_TENSORS",function(){return!1},function(r){r&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});var Zw=function(r,e){return Zw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},Zw(r,e)};function zxe(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Zw(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Yt(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(f){o(f)}}function u(c){try{l(n.throw(c))}catch(f){o(f)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(r,e||[])).next())})}function Kt(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(l){return function(c){return u([l,c])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=l[0]&2?a.return:l[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,l[1])).done)return i;switch(a=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,a=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){t.label=l[1];break}if(l[0]===6&&t.label<i[1]){t.label=i[1],i=l;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(l);break}i[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(c){l=[6,c],a=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Tm(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Le(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function pn(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(Le(arguments[e]));return r}var ti;(function(r){r[r.DT_INVALID=0]="DT_INVALID",r[r.DT_FLOAT=1]="DT_FLOAT",r[r.DT_DOUBLE=2]="DT_DOUBLE",r[r.DT_INT32=3]="DT_INT32",r[r.DT_UINT8=4]="DT_UINT8",r[r.DT_INT16=5]="DT_INT16",r[r.DT_INT8=6]="DT_INT8",r[r.DT_STRING=7]="DT_STRING",r[r.DT_COMPLEX64=8]="DT_COMPLEX64",r[r.DT_INT64=9]="DT_INT64",r[r.DT_BOOL=10]="DT_BOOL",r[r.DT_QINT8=11]="DT_QINT8",r[r.DT_QUINT8=12]="DT_QUINT8",r[r.DT_QINT32=13]="DT_QINT32",r[r.DT_BFLOAT16=14]="DT_BFLOAT16",r[r.DT_QINT16=15]="DT_QINT16",r[r.DT_QUINT16=16]="DT_QUINT16",r[r.DT_UINT16=17]="DT_UINT16",r[r.DT_COMPLEX128=18]="DT_COMPLEX128",r[r.DT_HALF=19]="DT_HALF",r[r.DT_RESOURCE=20]="DT_RESOURCE",r[r.DT_VARIANT=21]="DT_VARIANT",r[r.DT_UINT32=22]="DT_UINT32",r[r.DT_UINT64=23]="DT_UINT64",r[r.DT_FLOAT_REF=101]="DT_FLOAT_REF",r[r.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",r[r.DT_INT32_REF=103]="DT_INT32_REF",r[r.DT_UINT8_REF=104]="DT_UINT8_REF",r[r.DT_INT16_REF=105]="DT_INT16_REF",r[r.DT_INT8_REF=106]="DT_INT8_REF",r[r.DT_STRING_REF=107]="DT_STRING_REF",r[r.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",r[r.DT_INT64_REF=109]="DT_INT64_REF",r[r.DT_BOOL_REF=110]="DT_BOOL_REF",r[r.DT_QINT8_REF=111]="DT_QINT8_REF",r[r.DT_QUINT8_REF=112]="DT_QUINT8_REF",r[r.DT_QINT32_REF=113]="DT_QINT32_REF",r[r.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",r[r.DT_QINT16_REF=115]="DT_QINT16_REF",r[r.DT_QUINT16_REF=116]="DT_QUINT16_REF",r[r.DT_UINT16_REF=117]="DT_UINT16_REF",r[r.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",r[r.DT_HALF_REF=119]="DT_HALF_REF",r[r.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",r[r.DT_VARIANT_REF=121]="DT_VARIANT_REF",r[r.DT_UINT32_REF=122]="DT_UINT32_REF",r[r.DT_UINT64_REF=123]="DT_UINT64_REF"})(ti||(ti={}));var VB;(function(r){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(r.CheckpointFormatVersion||(r.CheckpointFormatVersion={}))})(VB||(VB={}));var kx={};function $xe(r,e){var t={tfOpName:r,category:"custom",inputs:[],attrs:[],customExecutor:e};kx[r]=t}function wL(r){return kx[r]}function Wxe(r){delete kx[r]}function C(r,e,t,n,a){var i=e.inputParams[r];if(i&&i.inputIndexStart!==void 0){var o=i.inputIndexStart,s=i.inputIndexEnd===0?void 0:i.inputIndexEnd===void 0?o+1:i.inputIndexEnd;if(i.type==="tensor")return Tn(e.inputNames[i.inputIndexStart],t,n,a);if(i.type==="tensors"){var u=e.inputNames.slice(o,s);return u.map(function(h){return Tn(h,t,n,a)})}var l=Tn(e.inputNames.slice(o)[0],t,n,a),c=l.dataSync();return i.type==="number"?c[0]:$e.util.toNestedArray(l.shape,c)}var f=e.attrParams[r];return f&&f.value}function Tn(r,e,t,n){var a=Le(fa(r),2),i=a[0],o=a[1];if(n!=null){var s=n.getHashTableHandleByName(i);if(s!=null)return s}var u=t.currentContextIds.find(function(l){return!!e[Im(i,l)]});return u!==void 0?e[Im(i,u)][o]:void 0}function qxe(r,e,t){return e[Im(r,t.currentContextId)]}function eo(r,e){var t=Le(fa(r),3),n=t[0],a=t[1],i=t[2];return[Im(n,e&&e.currentContextId),a,i]}function Im(r,e){return e?r+"-"+e:r}function fa(r){var e=r.split(":");if(e.length===1)return[r,0,void 0];var t=e[0],n=e.length===3?e[1]:void 0,a=Number(e[e.length-1]);return[t,a,n]}function km(r,e,t){var n=C("pad",r,e,t);if(n==="explicit"){n=C("explicitPaddings",r,e,t);for(var a=[[0,0],[0,0],[0,0],[0,0]],i=0;i<4;i++)a[i][0]=n[i*2],a[i][1]=n[i*2+1];return a}return n}function No(r){return r.kept?r:$e.clone(r)}var Vxe=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Gxe={__proto__:null,json:Vxe};var Uxe=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Hxe={__proto__:null,json:Uxe};var Kxe=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],jxe={__proto__:null,json:Kxe};var Xxe=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],Yxe={__proto__:null,json:Xxe};var Zxe=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],Jxe={__proto__:null,json:Zxe};var Qxe=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],eke={__proto__:null,json:Qxe};var tke=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],rke={__proto__:null,json:tke};var nke=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],ake={__proto__:null,json:nke};var ike=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}],oke={__proto__:null,json:ike};var ske=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],uke={__proto__:null,json:ske};var lke=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],cke={__proto__:null,json:lke};var fke=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}],hke={__proto__:null,json:fke};var pke=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}],dke={__proto__:null,json:pke};var vke=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],mke={__proto__:null,json:vke};var gke=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}],yke={__proto__:null,json:gke};var bke=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],wke={__proto__:null,json:bke};var xke=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],kke={__proto__:null,json:xke};var Ske=[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],Nke={__proto__:null,json:Ske};var Eke=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],Tke={__proto__:null,json:Eke},GB=function(){function r(){var e=[Gxe,Hxe,jxe,Yxe,Jxe,eke,rke,ake,oke,uke,cke,hke,dke,mke,yke,wke,kke,Nke,Tke],t=[].concat.apply([],pn(e.map(function(n){return n.json})));this.opMappers=t.reduce(function(n,a){return n[a.tfOpName]=a,n},{})}return Object.defineProperty(r,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!0,configurable:!0}),r.prototype.transformGraph=function(e,t){var n=this;t===void 0&&(t={});var a=e.node,i=[],o=[],s=[],u=a.reduce(function(v,g){return v[g.name]=n.mapNode(g),g.op.startsWith("Placeholder")?i.push(v[g.name]):g.op==="Const"?o.push(v[g.name]):(g.input==null||g.input.length===0)&&s.push(v[g.name]),v},{}),l=[],c=[],f={},h={};t!=null&&(f=this.mapSignatureEntries(t.inputs),h=this.mapSignatureEntries(t.outputs));var p=Object.keys(u);p.forEach(function(v){var g=u[v];g.inputNames.forEach(function(y,b){var w=Le(eo(y),3),x=w[0],k=w[2],N=u[x];if(N.outputs!=null){var T=N.outputs.indexOf(k);if(T!==-1){var I=x+":"+T;g.inputNames[b]=I}}g.inputs.push(N),N.children.push(g)})}),Object.keys(h).length===0?p.forEach(function(v){var g=u[v];g.children.length===0&&c.push(g)}):Object.keys(h).forEach(function(v){var g=Le(eo(v),1),y=g[0],b=u[y];b!=null&&(b.signatureKey=h[v],c.push(b))}),Object.keys(f).length>0?Object.keys(f).forEach(function(v){var g=Le(eo(v),1),y=g[0],b=u[y];b&&(b.signatureKey=f[v],l.push(b))}):l=i;var d={};e.library!=null&&e.library.function!=null&&(d=e.library.function.reduce(function(v,g){return v[g.signature.name]=n.mapFunction(g),v},{}));var m={nodes:u,inputs:l,outputs:c,weights:o,placeholders:i,signature:t,functions:d};return s.length>0&&(m.initNodes=s),m},r.prototype.mapSignatureEntries=function(e){return Object.keys(e||{}).reduce(function(t,n){return t[e[n].name]=n,t},{})},r.prototype.mapNode=function(e){var t=wL(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});var n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(function(a){return a.startsWith("^")?a.slice(1):a}),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return t.inputs!=null&&(n.inputParams=t.inputs.reduce(function(a,i){return a[i.name]={type:i.type,inputIndexStart:i.start,inputIndexEnd:i.end},a},{})),t.attrs!=null&&(n.attrParams=t.attrs.reduce(function(a,i){var o=i.type,s=void 0;switch(i.type){case"string":s=Jw(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=Jw(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"string[]":s=ix(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=ix(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number":s=ex(e.attr,i.tfName,i.defaultValue||0),s===void 0&&!!i.tfDeprecatedName&&(s=ex(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number[]":s=ax(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=ax(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool":s=Qw(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=Qw(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool[]":s=sx(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=sx(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape":s=nx(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=nx(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape[]":s=ox(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=ox(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype":s=tx(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=tx(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype[]":s=rx(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=rx(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"func":s=UB(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=UB(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: "+i.type+" for op: "+e.op)}return a[i.name]={value:s,type:o},a},{})),n},r.prototype.mapFunction=function(e){var t=this,n=e.nodeDef,a=[],i=[],o={};n!=null&&(o=n.reduce(function(h,p){return h[p.name]=t.mapNode(p),p.op==="Const"&&i.push(h[p.name]),h},{}));var s=[],u=[];e.signature.inputArg.forEach(function(h){var p=Le(eo(h.name),1),d=p[0],m={name:d,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:Sx(h.type),type:"dtype"}},children:[]};m.signatureKey=h.name,s.push(m),o[d]=m});var l=Object.keys(o);l.forEach(function(h){var p=o[h];p.inputNames.forEach(function(d,m){var v=Le(eo(d),3),g=v[0],y=v[2],b=o[g];if(b.outputs!=null){var w=b.outputs.indexOf(y);if(w!==-1){var x=g+":"+w;p.inputNames[m]=x}}p.inputs.push(b),b.children.push(p)})});var c=e.ret;e.signature.outputArg.forEach(function(h){var p=Le(eo(c[h.name]),2),d=p[0],m=p[1],v=o[d];v!=null&&(v.defaultOutput=m,u.push(v))});var f=this.mapArgsToSignature(e);return{nodes:o,inputs:s,outputs:u,weights:i,placeholders:a,signature:f}},r.prototype.mapArgsToSignature=function(e){var t=this;return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce(function(n,a){return n[a.name]=t.mapArgToTensorInfo(a),n},{}),outputs:e.signature.outputArg.reduce(function(n,a){return n[a.name]=t.mapArgToTensorInfo(a,e.ret),n},{})}},r.prototype.mapArgToTensorInfo=function(e,t){var n=e.name;return t!=null&&(n=t[n]),{name:n,dtype:e.type}},r}();function Ike(r){var e=$e.env().global;if(typeof e.atob<"u")return e.atob(r);if(typeof Buffer<"u")return new Buffer(r,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function xL(r,e){var t=Array.isArray(r)?String.fromCharCode.apply(null,r):Ike(r);return e?t:t.toLowerCase()}function Jw(r,e,t,n){n===void 0&&(n=!1);var a=r[e];return a!=null?xL(a.s,n):t}function Qw(r,e,t){var n=r[e];return n?n.b:t}function ex(r,e,t){var n=r[e]||{},a=n.i!=null?n.i:n.f!=null?n.f:t;return typeof a=="number"?a:parseInt(a,10)}function Sx(r){switch(typeof r=="string"&&(r=ti[r]),r){case ti.DT_FLOAT:case ti.DT_HALF:return"float32";case ti.DT_INT32:case ti.DT_INT64:case ti.DT_INT8:case ti.DT_UINT8:return"int32";case ti.DT_BOOL:return"bool";case ti.DT_DOUBLE:return"float32";case ti.DT_STRING:return"string";default:return null}}function UB(r,e,t){var n=r[e];return n&&n.func?n.func.name:t}function tx(r,e,t){var n=r[e];return n&&n.type?Sx(n.type):t}function rx(r,e,t){var n=r[e];return n&&n.list&&n.list.type?n.list.type.map(function(a){return Sx(a)}):t}function kL(r){if(!r.unknownRank)return r.dim!=null?r.dim.map(function(e){return typeof e.size=="number"?e.size:parseInt(e.size,10)}):[]}function nx(r,e,t){var n=r[e];return n&&n.shape?kL(n.shape):t}function ax(r,e,t){var n=r[e];return n?((n.list.f&&n.list.f.length?n.list.f:n.list.i)||[]).map(function(a){return typeof a=="number"?a:parseInt(a,10)}):t}function ix(r,e,t,n){n===void 0&&(n=!1);var a=r[e];return a&&a.list&&a.list.s?a.list.s.map(function(i){return xL(i,n)}):t}function ox(r,e,t){var n=r[e];return n&&n.list&&n.list.shape?n.list.shape.map(function(a){return kL(a)}):t}function sx(r,e,t){var n=r[e];return n&&n.list&&n.list.b?n.list.b:t}var Cke=function(){function r(e,t,n){var a=this;this.node=e,this.tensorMap=t,this.context=n,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(function(i){return a.getInput(i)}),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce(function(i,o){return i[o]=a.getAttr(o),i},{}))}return r.prototype.getInput=function(e){return Tn(e,this.tensorMap,this.context)},r.prototype.getAttr=function(e,t){var n=this.node.rawAttrs[e];if(n.tensor!=null)return Tn(e,this.tensorMap,this.context);if(n.i!=null||n.f!=null)return ex(this.node.rawAttrs,e,t);if(n.s!=null)return Jw(this.node.rawAttrs,e,t);if(n.b!=null)return Qw(this.node.rawAttrs,e,t);if(n.shape!=null)return nx(this.node.rawAttrs,e,t);if(n.type!=null)return tx(this.node.rawAttrs,e,t);if(n.list!=null){if(n.list.i!=null||n.list.f!=null)return ax(this.node.rawAttrs,e,t);if(n.list.s!=null)return ix(this.node.rawAttrs,e,t);if(n.list.shape!=null)return ox(this.node.rawAttrs,e,t);if(n.list.b!=null)return sx(this.node.rawAttrs,e,t);if(n.list.type!=null)return rx(this.node.rawAttrs,e,t)}return t},r}();var Ake=1e-7,_ke=1e-4,Dke=function(){function r(){}return r.prototype.refCount=function(e){return Fa("refCount")},r.prototype.incRef=function(e){return Fa("incRef")},r.prototype.timerAvailable=function(){return!0},r.prototype.time=function(e){return Fa("time")},r.prototype.read=function(e){return Fa("read")},r.prototype.readSync=function(e){return Fa("readSync")},r.prototype.readToGPU=function(e,t){return Fa("readToGPU")},r.prototype.numDataIds=function(){return Fa("numDataIds")},r.prototype.disposeData=function(e,t){return Fa("disposeData")},r.prototype.write=function(e,t,n){return Fa("write")},r.prototype.move=function(e,t,n,a,i){return Fa("move")},r.prototype.memory=function(){return Fa("memory")},r.prototype.floatPrecision=function(){return Fa("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?Ake:_ke},r.prototype.dispose=function(){return Fa("dispose")},r}();function Fa(r){throw new Error("'"+r+"' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen")}function re(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function ui(r,e,t){t===void 0&&(t=""),re(sc(r,e),function(){return t+(" Shapes "+r+" and "+e+" must match")})}function oc(r){re(r!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Bm(r,e,t){if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),Array.isArray(r)||to(r)&&!t)for(var n=0;n<r.length;++n)Bm(r[n],e,t);else e.push(r);return e}function qn(r){if(r.length===0)return 1;for(var e=r[0],t=1;t<r.length;t++)e*=r[t];return e}function sc(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function Bh(r){return r%1===0}function Sm(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function Lm(r,e){var t=e.length;return r=r==null?e.map(function(n,a){return a}):[].concat(r),re(r.every(function(n){return n>=-t&&n<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but "+("got axis "+r)}),re(r.every(function(n){return Bh(n)}),function(){return"All values in axis param must be integers but "+("got axis "+r)}),r.map(function(n){return n<0?t+n:n})}function Fke(r,e){for(var t=[],n=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:Lm(e,r).sort(),o=0,s=0;s<r.length;++s){if(i!=null){if(i[o]===s&&r[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+r[s]+"' is not 1");(i[o]==null||i[o]>s)&&r[s]===1&&(t.push(r[s]),n.push(s)),i[o]<=s&&o++}r[s]!==1&&(t.push(r[s]),n.push(s))}return{newShape:t,keptDims:n}}function Rke(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else throw new Error("Unknown data type "+r);return t}function Oke(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else if(r==="string")t=new Array(e);else throw new Error("Unknown data type "+r);return t}function Pke(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type "+e+" being uploaded contains "+n+".")}}function Mke(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function to(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}function HB(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype "+r)}function Bke(r){if(r==null)return 0;var e=0;return r.forEach(function(t){return e+=t.length}),e}function Nx(r){return typeof r=="string"||r instanceof String}function Lke(r){return typeof r=="boolean"}function zke(r){return typeof r=="number"}function Ex(r){return Array.isArray(r)?Ex(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":zke(r)?"float32":Nx(r)?"string":Lke(r)?"bool":"float32"}function KB(r){return!!(r&&r.constructor&&r.call&&r.apply)}function Tx(r){var e=r.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=r[e-1];for(var n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function SL(r,e,t,n){n===void 0&&(n=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(n?2:1),o=0;o<i;o++)a[o]=t[r+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(c,f){return c*f})*(n?2:1),o=0;o<i;o++)a[o]=SL(r+o*u,s,t,n);return a}function jB(r,e,t){if(t===void 0&&(t=!1),r.length===0)return e[0];var n=r.reduce(function(a,i){return a*i})*(t?2:1);if(n===0)return[];if(n!==e.length)throw new Error("["+r+"] does not match the input size "+e.length+(t?" for a complex tensor":"")+".");return SL(0,r,e,t)}function NL(r,e){for(var t=Ix(r,e),n=0;n<t.length;n++)t[n]=1;return t}function Ix(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error("Unknown data type "+e)}function EL(r){r.forEach(function(e){re(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+("shape ["+r+"].")})})}function TL(r){return r&&r.then&&typeof r.then=="function"}var XB="tfjsflags",$ke=function(){function r(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Wke,this.populateURLFlags()}return r.prototype.setPlatform=function(e,t){this.platform!=null&&(ai().getBool("IS_TEST")||ai().getBool("PROD")||console.warn("Platform "+this.platformName+" has already been set. "+("Overwriting the platform with "+e+"."))),this.platformName=e,this.platform=t},r.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){var a=this.urlFlags[e];ai().getBool("IS_TEST")||ai().getBool("PROD")||console.warn("Setting feature override from URL "+e+": "+a+"."),this.set(e,a)}},r.prototype.getAsync=function(e){return Yt(this,void 0,void 0,function(){var t,n;return Kt(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,n=e,[4,this.evaluateFlag(e)]);case 1:return t[n]=a.sent(),[2,this.flags[e]]}})})},r.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(TL(t))throw new Error("Flag "+e+" cannot be synchronously evaluated. Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},r.prototype.getNumber=function(e){return this.get(e)},r.prototype.getBool=function(e){return this.get(e)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),r.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},r.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},r.prototype.setFlags=function(e){this.flags=Object.assign({},e)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if(XB in t){var n=t[XB].split(",");n.forEach(function(a){var i=Le(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=Vke(o,s)})}}},r}();function Wke(r){var e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];return qke(e,n[0],n[1]),n.join("=")}),e}function qke(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Vke(r,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if(""+ +e===e)return+e;throw new Error("Could not parse value flag value "+e+" for flag "+r+".")}function ai(){return IL}var IL=null;function Gke(r){IL=r}var Hw;function CL(){if(Hw==null){var r=void 0;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");Hw=r}return Hw}function Uke(){var r=CL();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function Cx(r,e){var t=Uke();if(t.has(r))return t.get(r);var n=e();return t.set(r,n),t.get(r)}var Hke="Abs",Kke="Acos",jke="Acosh",AL="Add",Xke="AddN",Yke="All",Zke="Any",Jke="ArgMax",Qke="ArgMin",e2e="Asin",t2e="Asinh",r2e="Atan",n2e="Atanh",a2e="Atan2",i2e="AvgPool",o2e="AvgPool3D",s2e="BatchMatMul",u2e="BatchToSpaceND",l2e="Bincount",c2e="BroadcastArgs",_L="Cast",f2e="Ceil",h2e="ClipByValue",p2e="Complex",d2e="ComplexAbs",v2e="Concat",m2e="Conv2D",g2e="Conv2DBackpropFilter",y2e="Conv2DBackpropInput",b2e="Conv3D",w2e="Conv3DBackpropInputV2",x2e="Cos",k2e="Cosh",S2e="Cumprod",N2e="Cumsum",E2e="CropAndResize",T2e="DenseBincount",I2e="DepthToSpace",C2e="DepthwiseConv2dNative",A2e="DepthwiseConv2dNativeBackpropFilter",_2e="DepthwiseConv2dNativeBackpropInput",D2e="Diag",F2e="Dilation2D",R2e="RealDiv",O2e="Einsum",P2e="Elu",M2e="Erf",B2e="Equal",L2e="Exp",z2e="ExpandDims",$2e="Expm1",W2e="FFT",q2e="Fill",V2e="FlipLeftRight",G2e="Floor",U2e="FloorDiv",H2e="FusedBatchNorm",K2e="GatherV2",j2e="GatherNd",X2e="Greater",Y2e="GreaterEqual",DL="Identity",Z2e="IFFT",J2e="Imag",Q2e="IsFinite",eSe="IsInf",tSe="IsNan",rSe="LeakyRelu",nSe="Less",aSe="LessEqual",iSe="LinSpace",oSe="Log",sSe="Log1p",uSe="LogicalAnd",lSe="LogicalNot",cSe="LogicalOr",fSe="LRN",hSe="Max",pSe="Maximum",dSe="MaxPool",vSe="MaxPool3D",mSe="MaxPoolWithArgmax",gSe="Mean",ySe="Min",bSe="Minimum",wSe="MirrorPad",xSe="Mod",kSe="Multinomial",SSe="Multiply",NSe="Neg",ESe="NotEqual",TSe="NonMaxSuppressionV3",ISe="NonMaxSuppressionV4",CSe="NonMaxSuppressionV5",ASe="OnesLike",_Se="OneHot",DSe="Pack",FSe="PadV2",RSe="Pow",OSe="Prelu",PSe="Prod",MSe="RaggedGather",BSe="RaggedTensorToTensor",LSe="Range",zSe="Real",$Se="Reciprocal",WSe="Relu",qSe="Reshape",VSe="ResizeNearestNeighbor",GSe="ResizeBilinear",USe="Relu6",HSe="Reverse",KSe="Round",jSe="Rsqrt",XSe="ScatterNd",YSe="SearchSorted",ZSe="Select",JSe="Selu",QSe="Slice",eNe="Sin",tNe="Sinh",rNe="Sign",nNe="Sigmoid",aNe="Softplus",iNe="Sqrt",oNe="Sum",sNe="SpaceToBatchND",uNe="SplitV",lNe="Softmax",cNe="SparseFillEmptyRows",fNe="SparseReshape",hNe="SparseSegmentMean",pNe="SparseSegmentSum",dNe="SparseToDense",vNe="SquaredDifference",mNe="StridedSlice",gNe="StringNGrams",yNe="StringSplit",bNe="StringToHashBucketFast",wNe="Sub",xNe="Tan",kNe="Tanh",FL="Tile",SNe="TopK",NNe="Transform",Kw="Transpose",ENe="Unique",TNe="Unpack",INe="UnsortedSegmentSum",CNe="ZerosLike",ANe="Step",_Ne="RotateWithOffset",YB="_FusedMatMul",ZB="FusedConv2D",JB="FusedDepthwiseConv2D";function Ah(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];ai().getBool("IS_TEST")||ai().getBool("PROD")||console.warn.apply(console,pn(r))}var RL=Cx("kernelRegistry",function(){return new Map}),DNe=Cx("gradRegistry",function(){return new Map});function QB(r,e){var t=FNe(r,e);return RL.get(t)}function eL(r){return DNe.get(r)}function tL(r){for(var e=RL.entries(),t=[];;){var n=e.next(),a=n.done,i=n.value;if(a)break;var o=Le(i,2),s=o[0],u=o[1],l=Le(s.split("_"),1),c=l[0];c===r&&t.push(u)}return t}function FNe(r,e){return e+"_"+r}var ux=mr,ii=null;try{ii=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function mr(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}mr.prototype.__isLong__;Object.defineProperty(mr.prototype,"__isLong__",{value:!0});function da(r){return(r&&r.__isLong__)===!0}mr.isLong=da;var rL={},nL={};function _u(r,e){var t,n,a;return e?(r>>>=0,(a=0<=r&&r<256)&&(n=nL[r],n)?n:(t=gr(r,(r|0)<0?-1:0,!0),a&&(nL[r]=t),t)):(r|=0,(a=-128<=r&&r<128)&&(n=rL[r],n)?n:(t=gr(r,r<0?-1:0,!1),a&&(rL[r]=t),t))}mr.fromInt=_u;function oi(r,e){if(isNaN(r))return e?Eu:si;if(e){if(r<0)return Eu;if(r>=OL)return BL}else{if(r<=-iL)return ha;if(r+1>=iL)return ML}return r<0?oi(-r,e).neg():gr(r%nc|0,r/nc|0,e)}mr.fromNumber=oi;function gr(r,e,t){return new mr(r,e,t)}mr.fromBits=gr;var Cm=Math.pow;function Ax(r,e,t){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return si;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return Ax(r.substring(1),e,t).neg();for(var a=oi(Cm(t,8)),i=si,o=0;o<r.length;o+=8){var s=Math.min(8,r.length-o),u=parseInt(r.substring(o,o+s),t);if(s<8){var l=oi(Cm(t,s));i=i.mul(l).add(oi(u))}else i=i.mul(a),i=i.add(oi(u))}return i.unsigned=e,i}mr.fromString=Ax;function Fi(r,e){return typeof r=="number"?oi(r,e):typeof r=="string"?Ax(r,e):gr(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}mr.fromValue=Fi;var aL=1<<16,RNe=1<<24,nc=aL*aL,OL=nc*nc,iL=OL/2,oL=_u(RNe),si=_u(0);mr.ZERO=si;var Eu=_u(0,!0);mr.UZERO=Eu;var Ql=_u(1);mr.ONE=Ql;var PL=_u(1,!0);mr.UONE=PL;var lx=_u(-1);mr.NEG_ONE=lx;var ML=gr(-1,2147483647,!1);mr.MAX_VALUE=ML;var BL=gr(-1,-1,!0);mr.MAX_UNSIGNED_VALUE=BL;var ha=gr(0,-2147483648,!1);mr.MIN_VALUE=ha;var Re=mr.prototype;Re.toInt=function(){return this.unsigned?this.low>>>0:this.low};Re.toNumber=function(){return this.unsigned?(this.high>>>0)*nc+(this.low>>>0):this.high*nc+(this.low>>>0)};Re.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ha)){var t=oi(e),n=this.div(t),a=n.mul(t).sub(this);return n.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=oi(Cm(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),l=o.sub(u.mul(i)).toInt()>>>0,c=l.toString(e);if(o=u,o.isZero())return c+s;for(;c.length<6;)c="0"+c;s=""+c+s}};Re.getHighBits=function(){return this.high};Re.getHighBitsUnsigned=function(){return this.high>>>0};Re.getLowBits=function(){return this.low};Re.getLowBitsUnsigned=function(){return this.low>>>0};Re.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ha)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};Re.isZero=function(){return this.high===0&&this.low===0};Re.eqz=Re.isZero;Re.isNegative=function(){return!this.unsigned&&this.high<0};Re.isPositive=function(){return this.unsigned||this.high>=0};Re.isOdd=function(){return(this.low&1)===1};Re.isEven=function(){return(this.low&1)===0};Re.equals=function(e){return da(e)||(e=Fi(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Re.eq=Re.equals;Re.notEquals=function(e){return!this.eq(e)};Re.neq=Re.notEquals;Re.ne=Re.notEquals;Re.lessThan=function(e){return this.comp(e)<0};Re.lt=Re.lessThan;Re.lessThanOrEqual=function(e){return this.comp(e)<=0};Re.lte=Re.lessThanOrEqual;Re.le=Re.lessThanOrEqual;Re.greaterThan=function(e){return this.comp(e)>0};Re.gt=Re.greaterThan;Re.greaterThanOrEqual=function(e){return this.comp(e)>=0};Re.gte=Re.greaterThanOrEqual;Re.ge=Re.greaterThanOrEqual;Re.compare=function(e){if(da(e)||(e=Fi(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Re.comp=Re.compare;Re.negate=function(){return!this.unsigned&&this.eq(ha)?ha:this.not().add(Ql)};Re.neg=Re.negate;Re.add=function(e){da(e)||(e=Fi(e));var t=this.high>>>16,n=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,l=e.low&65535,c=0,f=0,h=0,p=0;return p+=i+l,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=n+s,c+=f>>>16,f&=65535,c+=t+o,c&=65535,gr(h<<16|p,c<<16|f,this.unsigned)};Re.subtract=function(e){return da(e)||(e=Fi(e)),this.add(e.neg())};Re.sub=Re.subtract;Re.multiply=function(e){if(this.isZero())return si;if(da(e)||(e=Fi(e)),ii){var t=ii.mul(this.low,this.high,e.low,e.high);return gr(t,ii.get_high(),this.unsigned)}if(e.isZero())return si;if(this.eq(ha))return e.isOdd()?ha:si;if(e.eq(ha))return this.isOdd()?ha:si;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(oL)&&e.lt(oL))return oi(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,l=e.low>>>16,c=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*c,p+=d>>>16,d&=65535,p+=i*c,h+=p>>>16,p&=65535,p+=o*l,h+=p>>>16,p&=65535,h+=a*c,f+=h>>>16,h&=65535,h+=i*l,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=n*c+a*l+i*u+o*s,f&=65535,gr(p<<16|d,f<<16|h,this.unsigned)};Re.mul=Re.multiply;Re.divide=function(e){if(da(e)||(e=Fi(e)),e.isZero())throw Error("division by zero");if(ii){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?ii.div_u:ii.div_s)(this.low,this.high,e.low,e.high);return gr(t,ii.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Eu:si;var n,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Eu;if(e.gt(this.shru(1)))return PL;i=Eu}else{if(this.eq(ha)){if(e.eq(Ql)||e.eq(lx))return ha;if(e.eq(ha))return Ql;var o=this.shr(1);return n=o.div(e).shl(1),n.eq(si)?e.isNegative()?Ql:lx:(a=this.sub(e.mul(n)),i=n.add(a.div(e)),i)}else if(e.eq(ha))return this.unsigned?Eu:si;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=si}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:Cm(2,s-48),l=oi(n),c=l.mul(e);c.isNegative()||c.gt(a);)n-=u,l=oi(n,this.unsigned),c=l.mul(e);l.isZero()&&(l=Ql),i=i.add(l),a=a.sub(c)}return i};Re.div=Re.divide;Re.modulo=function(e){if(da(e)||(e=Fi(e)),ii){var t=(this.unsigned?ii.rem_u:ii.rem_s)(this.low,this.high,e.low,e.high);return gr(t,ii.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Re.mod=Re.modulo;Re.rem=Re.modulo;Re.not=function(){return gr(~this.low,~this.high,this.unsigned)};Re.and=function(e){return da(e)||(e=Fi(e)),gr(this.low&e.low,this.high&e.high,this.unsigned)};Re.or=function(e){return da(e)||(e=Fi(e)),gr(this.low|e.low,this.high|e.high,this.unsigned)};Re.xor=function(e){return da(e)||(e=Fi(e)),gr(this.low^e.low,this.high^e.high,this.unsigned)};Re.shiftLeft=function(e){return da(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?gr(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):gr(0,this.low<<e-32,this.unsigned)};Re.shl=Re.shiftLeft;Re.shiftRight=function(e){return da(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?gr(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):gr(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Re.shr=Re.shiftRight;Re.shiftRightUnsigned=function(e){if(da(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var n=this.low;return gr(n>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?gr(t,0,this.unsigned):gr(t>>>e-32,0,this.unsigned)};Re.shru=Re.shiftRightUnsigned;Re.shr_u=Re.shiftRightUnsigned;Re.toSigned=function(){return this.unsigned?gr(this.low,this.high,!1):this};Re.toUnsigned=function(){return this.unsigned?this:gr(this.low,this.high,!0)};Re.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Re.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Re.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};mr.fromBytes=function(e,t,n){return n?mr.fromBytesLE(e,t):mr.fromBytesBE(e,t)};mr.fromBytesLE=function(e,t){return new mr(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};mr.fromBytesBE=function(e,t){return new mr(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var ONe=Object.assign(Object.create(null),ux,{default:ux}),PNe=ux||ONe;function _x(r){return PNe.fromString(r,!0,16)}_x("c3a5c85c97cb3127");_x("b492b66fbe98f273");_x("9ae16a3b2f90404f");function MNe(r,e){return r instanceof Float32Array&&e==="float32"||r instanceof Int32Array&&e==="int32"||r instanceof Uint8Array&&e==="bool"}function LL(r,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=Bm(r)),ai().getBool("DEBUG")&&Pke(r,e),MNe(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){for(var t=new Uint8Array(r.length),n=0;n<t.length;++n)Math.round(r[n])!==0&&(t[n]=1);return t}else throw new Error("Unknown data type "+e)}function Am(){return ai().platform.now()}function BNe(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",ai().platform.encode(r,e)}function sL(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",ai().platform.decode(r,e)}var LNe=function(){function r(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new $Ne)}return r.prototype.profileKernel=function(e,t,n){var a,i,o,s=function(){o=n()},u,l=Am();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var c=Tm(o),f=c.next();!f.done;f=c.next()){var h=f.value;h.dataSync()}}catch(v){a={error:v}}finally{try{f&&!f.done&&(i=c.return)&&i.call(c)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:Am()-l})}if(ai().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var p=function(v){var g=o[v];g.data().then(function(y){zNe(y,g.dtype,e)})},d=0;d<o.length;d++)p(d);var m={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(v){return v.kernelMs}),extraInfo:u.then(function(v){return v.getExtraProfileInfo!=null?v.getExtraProfileInfo():""})};return m},r.prototype.logKernelProfile=function(e){var t=this,n=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(l){t.logger.logKernelProfile(n,u,l[0],l[1],o,l[2])})})},r}();function zNe(r,e,t){if(e!=="float32")return!1;for(var n=0;n<r.length;n++){var a=r[n];if(isNaN(a)||!isFinite(a))return console.warn("Found "+a+" in the result of '"+t+"'"),!0}return!1}var $Ne=function(){function r(){}return r.prototype.logKernelProfile=function(e,t,n,a,i,o){var s=typeof a=="number"?Sm(a+"ms",9):a.error,u=Sm(e,25),l=t.rank,c=t.size,f=Sm(t.shape.toString(),14),h="";for(var p in i){var d=i[p];if(d!=null){var m=d.shape||t.shape,v=m.length;h+=p+": "+v+"D "+(v>0?m:"")+" "}}console.log("%c"+u+"	%c"+s+"	%c"+l+"D "+f+"	%c"+c+"	%c"+h+"	%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r}();function WNe(r,e,t){for(var n={},a={},i=0;i<e.length;i++)n[e[i].id]=!0;for(var i=0;i<r.length;i++){var o=r[i],s=o.inputs;for(var u in s){for(var l=s[u],c=!1,f=0;f<e.length;f++)if(n[l.id]){o.outputs.forEach(function(b){return n[b.id]=!0}),c=!0,a[o.id]=!0;break}if(c)break}}var h={};h[t.id]=!0;for(var p={},i=r.length-1;i>=0;i--)for(var o=r[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,p[o.id]=!0;break}for(var d=[],i=0;i<r.length;i++){var o=r[i];if(a[o.id]&&p[o.id]){var m={};for(var u in o.inputs){var v=o.inputs[u];n[v.id]&&(m[u]=v)}var g=Object.assign({},o);g.inputs=m,g.outputs=o.outputs,d.push(g)}}return d}function qNe(r,e,t,n){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var p=r[h.id];p!=null?u.push(p):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+("for "+s.kernelName+"."));var l=s.gradient(u),c=function(h){if(!(h in l))throw new Error("Cannot backprop through input "+h+". "+("Available gradients found: "+Object.keys(l)+"."));var p=t(function(){return l[h]()});if(p.dtype!=="float32")throw new Error("Error in gradient for op "+s.kernelName+". The gradient of input "+(h+" must have 'float32' dtype, but has '"+p.dtype+"'"));var d=s.inputs[h];if(!sc(p.shape,d.shape))throw new Error("Error in gradient for op "+s.kernelName+". The gradient of input "+("'"+h+"' has shape '"+p.shape+"', which does not match ")+("the shape of the input '"+d.shape+"'"));if(r[d.id]==null)r[d.id]=p;else{var m=r[d.id];r[d.id]=n(m,p),m.dispose()}};for(var f in s.inputs)c(f)},i=e.length-1;i>=0;i--)a(i)}var uL=20,_h=3,jw=7;function VNe(r,e,t,n){var a=Tx(e),i=GNe(r,e,t,a),o=e.length,s=Nm(r,e,t,a,i),u=["Tensor"];return n&&(u.push("  dtype: "+t),u.push("  rank: "+o),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map(function(l){return"    "+l}).join(`
`)),u.join(`
`)}function GNe(r,e,t,n){var a=qn(e),i=n[n.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?Oh(r):r;if(s>1)for(var l=0;l<a/i;l++)for(var c=l*i,f=0;f<i;f++)o[f]=Math.max(o[f],Rh(u[c+f],0,t).length);return o}function Rh(r,e,t){var n;return Array.isArray(r)?n=parseFloat(r[0].toFixed(jw))+" + "+(parseFloat(r[1].toFixed(jw))+"j"):Nx(r)?n="'"+r+"'":t==="bool"?n=zL(r):n=parseFloat(r.toFixed(jw)).toString(),Sm(n,e)}function zL(r){return r===0?"false":"true"}function Nm(r,e,t,n,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var l=Oh(r);return[Rh(l[0],0,t)]}return t==="bool"?[zL(r[0])]:[r[0].toString()]}if(u===1){if(s>uL){var c=_h*o,f=Array.from(r.slice(0,c)),h=Array.from(r.slice((s-_h)*o,s*o));return t==="complex64"&&(f=Oh(f),h=Oh(h)),["["+f.map(function(N,T){return Rh(N,a[T],t)}).join(", ")+", ..., "+h.map(function(N,T){return Rh(N,a[s-_h+T],t)}).join(", ")+"]"]}var p=t==="complex64"?Oh(r):Array.from(r);return["["+p.map(function(N,T){return Rh(N,a[T],t)}).join(", ")+"]"]}var d=e.slice(1),m=n.slice(1),v=n[0]*o,g=[];if(s>uL){for(var y=0;y<_h;y++){var b=y*v,w=b+v;g.push.apply(g,pn(Nm(r.slice(b,w),d,t,m,a,!1)))}g.push("...");for(var y=s-_h;y<s;y++){var b=y*v,w=b+v;g.push.apply(g,pn(Nm(r.slice(b,w),d,t,m,a,y===s-1)))}}else for(var y=0;y<s;y++){var b=y*v,w=b+v;g.push.apply(g,pn(Nm(r.slice(b,w),d,t,m,a,y===s-1)))}var x=u===2?",":"";g[0]="["+g[0]+x;for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+x;for(var k=`,
`,y=2;y<u;y++)k+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":k),g}function Oh(r){for(var e=[],t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var cx=function(){function r(e,t,n){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=qn(e),n!=null){var i=n.length;re(i===this.size,function(){return"Length of values '"+i+"' does not match the size "+("inferred by the shape '"+a.size+"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Oke(t,this.size),this.strides=Tx(e)}return r.prototype.set=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];n.length===0&&(n=[0]),re(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must "+("match the rank ("+t.rank+")")});var i=this.locToIndex(n);this.values[i]=e},r.prototype.get=function(){for(var e,t,n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];n.length===0&&(n=[0]);var i=0;try{for(var o=Tm(n),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var l="Requested out of range element at "+n+". "+("  Buffer shape="+this.shape);throw new Error(l)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var c=n[n.length-1],f=0;f<n.length-1;++f)c+=this.strides[f]*n[f];return this.values[c]},r.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},r.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.toTensor=function(){return _i().makeTensor(this.values,this.shape,this.dtype)},r}(),_i=null,Dh=null;function UNe(r){_i=r}var $n=function(){function r(e,t,n,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=qn(e),this.strides=Tx(e),this.dataId=n,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.buffer=function(){return Yt(this,void 0,void 0,function(){var e;return Kt(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Dh.buffer(this.shape,this.dtype,e)]}})})},r.prototype.bufferSync=function(){return Dh.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return Yt(this,void 0,void 0,function(){var e;return Kt(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,jB(this.shape,e,this.dtype==="complex64")]}})})},r.prototype.arraySync=function(){return jB(this.shape,this.dataSync(),this.dtype==="complex64")},r.prototype.data=function(){return Yt(this,void 0,void 0,function(){var e,t;return Kt(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=_i().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(a){return sL(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}})})},r.prototype.dataToGPU=function(e){return this.throwIfDisposed(),_i().readToGPU(this.dataId,e)},r.prototype.dataSync=function(){this.throwIfDisposed();var e=_i().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return sL(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},r.prototype.bytes=function(){return Yt(this,void 0,void 0,function(){var e;return Kt(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,_i().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(_i().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.print=function(e){return e===void 0&&(e=!1),Dh.print(this,e)},r.prototype.clone=function(){return this.throwIfDisposed(),Dh.clone(this)},r.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return VNe(t,this.shape,this.dtype,e)},r.prototype.cast=function(e){return this.throwIfDisposed(),Dh.cast(this,e)},r.prototype.variable=function(e,t,n){return e===void 0&&(e=!0),this.throwIfDisposed(),_i().makeVariable(this,e,t,n)},r}();Object.defineProperty($n,Symbol.hasInstance,{value:function(r){return!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null}});function HNe(){return Cx("Tensor",function(){return $n})}HNe();var fx=function(r){zxe(e,r);function e(t,n,a,i){var o=r.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=n,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and "+("previous value ("+this.dtype+") must match"));if(!sc(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and "+("previous value ("+this.shape+") must match"));_i().disposeTensor(this),this.dataId=t.dataId,_i().incRef(this,null)},e.prototype.dispose=function(){_i().disposeVariable(this),this.isDisposedInternal=!0},e}($n);Object.defineProperty(fx,Symbol.hasInstance,{value:function(r){return r instanceof $n&&r.assign!=null&&r.assign instanceof Function}});var lL;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(lL||(lL={}));var hx;(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(hx||(hx={}));var px;(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(px||(px={}));var dx;(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(dx||(dx={}));var vx;(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(vx||(vx={}));var KNe={float32:dx,int32:hx,bool:px,complex64:vx};function jNe(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error("Can not upcast "+r+" with "+e)}return KNe[r][e]}function Mr(r,e){if(r.dtype===e.dtype)return[r,e];var t=jNe(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function XNe(r,e){re(r.dtype===e.dtype,function(){return"The dtypes of the first("+r.dtype+") and"+(" second("+e.dtype+") input must match")})}function $L(r){var e=[],t=new Set;return WL(r,e,t),e}function WL(r,e,t){if(r!=null){if(r instanceof $n){e.push(r);return}if(!!YNe(r)){var n=r;for(var a in n){var i=n[a];t.has(i)||(t.add(i),WL(i,e,t))}}}}function YNe(r){return Array.isArray(r)||typeof r=="object"}function Xw(r){return r.kernelName!=null}var cL=function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return r.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},r}(),Dx=function(){function r(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new cL}return r.prototype.ready=function(){return Yt(this,void 0,void 0,function(){var e,t,n,a;return Kt(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(n)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,n=e.asyncInit;if(n)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},r.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},r.prototype.registerBackend=function(e,t,n){return n===void 0&&(n=1),e in this.registryFactory?(Ah(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},r.prototype.setBackend=function(e){return Yt(this,void 0,void 0,function(){var t,n,a,i,o;return Kt(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,a=t.asyncInit,a?[4,n]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=n,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new LNe(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var e=this,t=tL(this.backendName);t.forEach(function(n){n.setupFunc!=null&&n.setupFunc(e.backendInstance)})},r.prototype.disposeRegisteredKernels=function(e){var t=this,n=tL(e);n.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},r.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(n==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var a=n.factory();if(a&&!(a instanceof Dke)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,Ah("Initialization of backend "+e+" failed"),Ah(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return Ah("Initialization of backend "+e+" failed"),Ah(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],a=this.initializeBackend(n),i=a.success,o=a.asyncInit;if(o||i)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),a=n.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(e,t){var n=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return n.startScope(a)},function(){return n.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},r.prototype.scopedRun=function(e,t,n){e();try{var a=n();return t(),a}catch(i){throw t(),i}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(e){var t=oe.runKernel(DL,{x:e}),n={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},l={dtype:s};return oe.runKernel(_L,u,l)}}},i=[];return this.addTapeNode(this.state.activeScope.name,n,[t],a,i,{}),t},r.prototype.runKernel=function(e,t,n){this.backendName==null&&this.backend;var a=QB(e,this.backendName)!=null;if(!a)throw new Error("Kernel '"+e+"' not registered for backend '"+this.backendName+"'");return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(e,t,n){var a=this.backend.numDataIds(),i=0;n.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak "+("("+s+" data ids) after running '"+e+"'"))},r.prototype.runKernelFunc=function(e){var t=this,n,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var l,c=Xw(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Xw(e)){var f=e.kernelName,h=e.inputs,p=e.attrs;this.backendName==null&&this.backend;var d=QB(f,this.backendName);re(d!=null,function(){return"Cannot find registered kernel '"+f+"' for backend '"+t.backendName+"'"}),u=function(){var x=t.backend.numDataIds();l=d.kernelFunc({inputs:h,attrs:p,backend:t.backend});var k=Array.isArray(l)?l:[l];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,x,k);var N=k.map(function(I){return I.rank!=null?I:t.makeTensorFromTensorInfo(I)});if(i){var T=t.getTensorsForGradient(f,h,N);a=t.saveTensorsForBackwardMode(T)}return N}}else{var m=e.forwardFunc,v=function(x){!i||(a=x.map(function(k){return t.keep(t.clone(k))}))};u=function(){var x=t.backend.numDataIds();l=t.tidy(function(){return m(t.backend,v)});var k=Array.isArray(l)?l:[l];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(c,x,k),k}}var g=e.inputs,y=e.attrs,b=Xw(e)?null:e.backwardsFunc,w;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?n=u():(w=t.profiler.profileKernel(c,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(w),n=w.outputs)}),i&&this.addTapeNode(c,g,n,b,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(x){return g[x]!=null?g[x].shape:null}),outputShapes:n.map(function(x){return x.shape}),kernelTimeMs:w.timeMs,extraInfo:w.extraInfo}),Array.isArray(l)?n:n[0]},r.prototype.saveTensorsForBackwardMode=function(e){var t=this,n=e.map(function(a){return t.keep(t.clone(a))});return n},r.prototype.getTensorsForGradient=function(e,t,n){var a=eL(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(re(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(l){return t[l]})):s=i.map(function(l){return t[l]});var u=n.filter(function(l,c){return o[c]});return s.concat(u)}return[]},r.prototype.makeTensor=function(e,t,n,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",a=a||this.backend;var i=e;n==="string"&&Nx(e[0])&&(i=e.map(function(c){return BNe(c)}));var o=a.write(i,t,n),s=new $n(t,n,o,this.nextTensorId());if(this.trackTensor(s,a),n==="string"){var u=this.state.tensorInfo.get(o),l=Bke(i);this.state.numBytes+=l-u.bytes,u.bytes=l}return s},r.prototype.makeTensorFromDataId=function(e,t,n,a){n=n||"float32";var i={dataId:e,shape:t,dtype:n};return this.makeTensorFromTensorInfo(i,a)},r.prototype.makeTensorFromTensorInfo=function(e,t){var n=e.dataId,a=e.shape,i=e.dtype,o=new $n(a,i,n,this.nextTensorId());return this.trackTensor(o,t),o},r.prototype.makeVariable=function(e,t,n,a){t===void 0&&(t=!0),n=n||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new fx(e,t,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},r.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*HB(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof fx||this.track(e)},r.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},r.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},r.prototype.disposeTensor=function(e){if(!!this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var n=e.size*HB(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},r.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},r.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},r.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},r.prototype.profile=function(e){return Yt(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c,f,h;return Kt(this,function(p){switch(p.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=p.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,pn(this.state.activeProfile.kernels.map(function(d){return d.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,p.label=2;case 2:p.trys.push([2,8,9,10]),i=Tm(this.state.activeProfile.kernels),o=i.next(),p.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=p.sent(),l=s,[4,s.extraInfo];case 5:l.extraInfo=p.sent(),p.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return c=p.sent(),f={error:c},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(e,t,n,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},l=eL(e);l!=null&&(a=l.gradFunc),a!=null&&(u.gradient=function(c){return c=c.map(function(f,h){if(f==null){var p=n[h],d=Ix(p.size,p.dtype);return s.makeTensor(d,p.shape,p.dtype)}return f}),a(c.length>1?c:c[0],i,o)}),this.state.activeTape.push(u)},r.prototype.keep=function(e){return e.kept=!0,e},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(e){for(var t=this,n=$L(e),a=new Set(n.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},r.prototype.gradients=function(e,t,n,a){var i=this;if(a===void 0&&(a=!1),re(t.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});re(o instanceof $n,function(){return"The result y returned by f() must be a tensor."});var s=WNe(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=n??ZNe(o.shape),qNe(u,s,function(c){return i.tidy(c)},QNe);var l=t.map(function(c){return u[c.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(c){var f,h;try{for(var p=Tm(c.saved),d=p.next();!d.done;d=p.next()){var m=d.value;m.dispose()}}catch(v){f={error:v}}finally{try{d&&!d.done&&(h=p.return)&&h.call(p)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:l}})},r.prototype.customGrad=function(e){var t=this;return re(KB(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];re(n.every(function(l){return l instanceof $n}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};n.forEach(function(l,c){o[c]=l});var s=function(l,c){return i=e.apply(void 0,pn(n,[c])),re(i.value instanceof $n,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),re(KB(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(l,c){var f=i.gradFunc(l,c),h=Array.isArray(f)?f:[f];re(h.length===n.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),re(h.every(function(d){return d instanceof $n}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return h.forEach(function(d,m){p[m]=function(){return d}}),p};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},r.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},r.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},r.prototype.readToGPU=function(e,t){var n=this.state.tensorInfo.get(e);return n.backend.readToGPU(e,t)},r.prototype.time=function(e){return Yt(this,void 0,void 0,function(){var t,n;return Kt(this,function(a){switch(a.label){case 0:return t=Am(),[4,this.backend.time(e)];case 1:return n=a.sent(),n.wallMs=Am()-t,[2,n]}})})},r.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),r.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new cL;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r}();Dx.nextTensorId=0;Dx.nextVariableId=0;function ZNe(r){var e=NL(qn(r),"float32");return oe.makeTensor(e,r,"float32")}function JNe(){var r=CL();if(r._tfengine==null){var e=new $ke(r);r._tfengine=new Dx(e)}return Gke(r._tfengine.ENV),UNe(function(){return r._tfengine}),r._tfengine}var oe=JNe();function QNe(r,e){var t={a:r,b:e};return oe.runKernel(AL,t)}function gs(r,e){var t=r;if(to(r))return e==="string"?[]:[r.length];if(!Array.isArray(r))return[];for(var n=[];Array.isArray(t)||to(t)&&e!=="string";)n.push(t.length),t=t[0];return Array.isArray(r)&&ai().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&qL(r,n,[]),n}function qL(r,e,t){if(t=t||[],!Array.isArray(r)&&!to(r)){re(e.length===0,function(){return"Element arr["+t.join("][")+"] is a primitive, "+("but should be an array/TypedArray of "+e[0]+" elements")});return}re(e.length>0,function(){return"Element arr["+t.join("][")+"] should be a primitive, "+("but is an array of "+r.length+" elements")}),re(r.length===e[0],function(){return"Element arr["+t.join("][")+"] should have "+e[0]+" "+("elements, but has "+r.length+" elements")});for(var n=e.slice(1),a=0;a<r.length;++a)qL(r[a],n,t.concat(a))}function fL(r,e,t,n){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==e||r==="numeric"&&e==="string")throw new Error("Argument '"+t+"' passed to '"+n+"' must "+("be "+r+" tensor, but got "+e+" tensor"))}}function z(r,e,t,n){if(n===void 0&&(n="numeric"),r instanceof $n)return fL(n,r.dtype,e,t),r;var a=Ex(r);if(a!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(a=n),fL(n,a,e,t),r==null||!to(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var i=r==null?"null":r.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a "+("Tensor or TensorLike, but got '"+i+"'"))}var o=gs(r,a);!to(r)&&!Array.isArray(r)&&(r=[r]);var s=!0,u=a!=="string"?LL(r,a):Bm(r,[],s);return oe.makeTensor(u,o,a)}function _m(r,e,t,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");var a=r;return a.map(function(i,o){return z(i,e+"["+o+"]",t,n)})}var VL="__op";function te(r){var e=Object.keys(r);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+(e.length+" keys."));var t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+VL;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];oe.startScope(t);try{var s=n.apply(void 0,pn(i));return TL(s)&&console.error("Cannot return a Promise inside of tidy."),oe.endScope(s),s}catch(u){throw oe.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function eEe(r){var e=z(r,"x","abs");if(e.dtype==="complex64"){var t={x:e};return oe.runKernel(d2e,t)}else{var t={x:e};return oe.runKernel(Hke,t)}}var ri=te({abs_:eEe});function tEe(r){var e=z(r,"x","acos"),t={x:e};return oe.runKernel(Kke,t)}var rEe=te({acos_:tEe});function nEe(r){var e=z(r,"x","acosh"),t={x:e};return oe.runKernel(jke,t)}var aEe=te({acosh_:nEe});function iEe(r,e){var t,n=z(r,"a","add"),a=z(e,"b","add");t=Le(Mr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return oe.runKernel(AL,i)}var un=te({add_:iEe});function oEe(r){re(Array.isArray(r),function(){return"The argument passed to tf.addN() must be a list of tensors"}),re(r.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+(""+r.length)});var e=r.map(function(a,i){return z(a,"tensors"+i,"addN")}),t=e[0];e.forEach(function(a){if(a.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(a){if(!sc(a.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var n=e;return oe.runKernel(Xke,n)}var sEe=te({addN_:oEe});function uEe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=z(r,"x","all","bool"),a={x:n},i={axis:e,keepDims:t};return oe.runKernel(Yke,a,i)}var lEe=te({all_:uEe});function cEe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=z(r,"x","any","bool"),a={x:n},i={axis:e,keepDims:t};return oe.runKernel(Zke,a,i)}var fEe=te({any_:cEe});function hEe(r,e){e===void 0&&(e=0);var t=z(r,"x","argMax"),n={x:t},a={axis:e};return oe.runKernel(Jke,n,a)}var pEe=te({argMax_:hEe});function dEe(r,e){e===void 0&&(e=0);var t=z(r,"x","argMin"),n={x:t},a={axis:e};return oe.runKernel(Qke,n,a)}var vEe=te({argMin_:dEe});function mEe(r){var e=z(r,"x","asin"),t={x:e};return oe.runKernel(e2e,t)}var gEe=te({asin_:mEe});function yEe(r){var e=z(r,"x","asinh"),t={x:e};return oe.runKernel(t2e,t)}var bEe=te({asinh_:yEe});function wEe(r){var e=z(r,"x","atan"),t={x:e};return oe.runKernel(r2e,t)}var xEe=te({atan_:wEe});function kEe(r,e){var t,n=z(r,"a","atan2"),a=z(e,"b","atan2");t=Le(Mr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return oe.runKernel(a2e,i)}var SEe=te({atan2_:kEe});function NEe(r){var e=z(r,"x","atanh"),t={x:e};return oe.runKernel(n2e,t)}var EEe=te({atanh_:NEe});function TEe(r,e){var t=z(r,"x","cast");if(!Mke(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var n={x:t},a={dtype:e};return oe.runKernel(_L,n,a)}var dn=te({cast_:TEe});function IEe(r,e,t,n,a,i,o){o===void 0&&(o="channelsLast");var s=Le(Dm(e),2),u=s[0],l=s[1],c;if(o==="channelsLast")c=[u,l,r[3],r[3]];else if(o==="channelsFirst")c=[u,l,r[1],r[1]];else throw new Error("Unknown dataFormat "+o);return Fx(r,c,t,n,a,i,!1,o)}function Fx(r,e,t,n,a,i,o,s){var u,l;o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var c=Le([-1,-1,-1,-1],4),f=c[0],h=c[1],p=c[2],d=c[3];if(s==="channelsLast")u=Le(r,4),f=u[0],h=u[1],p=u[2],d=u[3];else if(s==="channelsFirst")l=Le(r,4),f=l[0],d=l[1],h=l[2],p=l[3];else throw new Error("Unknown dataFormat "+s);var m=Le(e,4),v=m[0],g=m[1],y=m[3],b=Le(Dm(t),2),w=b[0],x=b[1],k=Le(Dm(n),2),N=k[0],T=k[1],I=mx(v,N),F=mx(g,T),D=_Ee(a,h,p,w,x,I,F,i,s),R=D.padInfo,P=D.outHeight,B=D.outWidth,q=o?y*d:y,O;return s==="channelsFirst"?O=[f,q,P,B]:s==="channelsLast"&&(O=[f,P,B,q]),{batchSize:f,dataFormat:s,inHeight:h,inWidth:p,inChannels:d,outHeight:P,outWidth:B,outChannels:q,padInfo:R,strideHeight:w,strideWidth:x,filterHeight:v,filterWidth:g,effectiveFilterHeight:I,effectiveFilterWidth:F,dilationHeight:N,dilationWidth:T,inShape:r,outShape:O,filterShape:e}}function CEe(r,e,t,n,a){n==null&&(n=AEe(r,e,t));var i=r[0],o=r[1],s=Fm((i-e+2*n)/t+1,a),u=Fm((o-e+2*n)/t+1,a);return[s,u]}function AEe(r,e,t,n){n===void 0&&(n=1);var a=mx(e,n);return Math.floor((r[0]*(t-1)-t+a)/2)}function Dm(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function mx(r,e){return e<=1?r:r+(r-1)*(e-1)}function _Ee(r,e,t,n,a,i,o,s,u){var l,c,f;if(typeof r=="number"){var h=r===0?"VALID":"NUMBER";l={top:r,bottom:r,left:r,right:r,type:h};var p=CEe([e,t],i,n,r,s);c=p[0],f=p[1]}else if(r==="same"){c=Math.ceil(e/n),f=Math.ceil(t/a);var d=Math.max(0,(c-1)*n+i-e),m=Math.max(0,(f-1)*a+o-t),v=Math.floor(d/2),g=d-v,y=Math.floor(m/2),b=m-y;l={top:v,bottom:g,left:y,right:b,type:"SAME"}}else if(r==="valid")l={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-i+1)/n),f=Math.ceil((t-o+1)/a);else if(typeof r=="object"){var v=u==="channelsLast"?r[1][0]:r[2][0],g=u==="channelsLast"?r[1][1]:r[2][1],y=u==="channelsLast"?r[2][0]:r[3][0],b=u==="channelsLast"?r[2][1]:r[3][1],h=v===0&&g===0&&y===0&&b===0?"VALID":"EXPLICIT";l={top:v,bottom:g,left:y,right:b,type:h},c=Fm((e-i+v+g)/n+1,s),f=Fm((t-o+y+b)/a+1,s)}else throw Error("Unknown padding parameter: "+r);return{padInfo:l,outHeight:c,outWidth:f}}function Fm(r,e){if(!e)return Math.trunc(r);switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode "+e)}}function Rm(r){var e=Le(Dm(r),3),t=e[0],n=e[1],a=e[2];return t===1&&n===1&&a===1}function ys(r,e){return Rm(r)||Rm(e)}function Ri(r,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in "+r+": pad must be an integer when using "+("dimRoundingMode "+t+" but got pad "+e+"."));if(typeof e=="number")re(Bh(e),function(){return"Error in "+r+": pad must be an integer when using "+("dimRoundingMode "+t+" but got pad "+e+".")});else if(typeof e=="object")e.forEach(function(n){n.forEach(function(a){re(Bh(a),function(){return"Error in "+r+": pad must be an integer when using "+("dimRoundingMode "+t+" but got pad "+a+".")})})});else throw Error("Error in "+r+": Unknown padding parameter: "+e)}}function DEe(r,e){var t=z(r,"x","reshape","string_or_numeric"),n={x:t},a={shape:e};return oe.runKernel(qSe,n,a)}var Te=te({reshape_:DEe});function FEe(r,e,t,n,a){var i=z(r,"x","avgPool","float32"),o=1;re(ys(t,o),function(){return"Error in avgPool: Either strides or dilations must be 1. "+("Got strides "+t+" and dilations '"+o+"'")});var s=i,u=!1;i.rank===3&&(u=!0,s=Te(i,[1,i.shape[0],i.shape[1],i.shape[2]])),re(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),Ri("avgPool",n,a);var l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=oe.runKernel(i2e,l,c);return f=dn(f,i.dtype),u?Te(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var GL=te({avgPool_:FEe});function REe(r,e,t,n,a,i){i===void 0&&(i="NDHWC");var o=z(r,"x","avgPool3d","float32"),s=o,u=!1;o.rank===4&&(u=!0,s=Te(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),re(s.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+s.rank+"."}),re(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+("but got dataFormat of "+i)}),Ri("avgPool3d",n,a);var l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=oe.runKernel(o2e,l,c);return f=dn(f,s.dtype),u?Te(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var OEe=te({avgPool3d_:REe});function PEe(r){var e=z(r,"x","clone","string_or_numeric"),t={x:e};return oe.runKernel(DL,t)}var ec=te({clone_:PEe});function MEe(r,e){e===void 0&&(e=0),re(r.length>=1,function(){return"Pass at least one tensor to concat"});var t=_m(r,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+i.dtype+". ")}),t.length===1)return ec(t[0]);var n=t,a={axis:e};return oe.runKernel(v2e,n,a)}var pa=te({concat_:MEe});function BEe(r,e,t,n){var a;t===void 0&&(t=!1),n===void 0&&(n=!1);var i=z(r,"a","matMul"),o=z(e,"b","matMul");a=Le(Mr(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:n};return oe.runKernel(s2e,s,u)}var Ht=te({matMul_:BEe});function LEe(r,e){var t,n=z(r,"a","mul"),a=z(e,"b","mul");t=Le(Mr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return oe.runKernel(SSe,i)}var Ct=te({mul_:LEe});function zEe(r){var e=z(r,"x","sigmoid","float32"),t={x:e};return oe.runKernel(nNe,t)}var tc=te({sigmoid_:zEe});function $Ee(r,e,t){var n=z(r,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");var a={x:n},i={begin:e,size:t};return oe.runKernel(QSe,a,i)}var Er=te({slice_:$Ee});function WEe(r){var e=z(r,"x","tanh","float32"),t={x:e};return oe.runKernel(kNe,t)}var gx=te({tanh_:WEe});function qEe(r,e,t,n,a,i){var o=z(r,"forgetBias","basicLSTMCell"),s=z(e,"lstmKernel","basicLSTMCell"),u=z(t,"lstmBias","basicLSTMCell"),l=z(n,"data","basicLSTMCell"),c=z(a,"c","basicLSTMCell"),f=z(i,"h","basicLSTMCell"),h=pa([l,f],1),p=Ht(h,s),d=un(p,u),m=d.shape[0],v=d.shape[1]/4,g=[m,v],y=Er(d,[0,0],g),b=Er(d,[0,v],g),w=Er(d,[0,v*2],g),x=Er(d,[0,v*3],g),k=un(Ct(tc(y),gx(b)),Ct(c,tc(un(o,w)))),N=Ct(gx(k),tc(x));return[k,N]}var VEe=te({basicLSTMCell_:qEe});function GEe(r,e,t){var n=z(r,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});re(n.rank>=1+e.length,function(){return"input rank is "+n.rank+" but should be > than blockShape.length "+e.length}),re(t.length===e.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length}),re(n.shape[0]%a===0,function(){return"input tensor batch is "+n.shape[0]+" but is not divisible by the product of "+("the elements of blockShape "+e.join(" * ")+" === "+a)});var i={x:n},o={blockShape:e,crops:t};return oe.runKernel(u2e,i,o)}var UL=te({batchToSpaceND_:GEe});function UEe(r){var e;return r.rank===0||r.rank===1?e=Te(r,[1,1,1,r.size]):r.rank===2?e=Te(r,[1,1,r.shape[0],r.shape[1]]):r.rank===3?e=Te(r,[1,r.shape[0],r.shape[1],r.shape[2]]):e=r,e}function HEe(r,e,t,n,a,i){i==null&&(i=.001);var o=z(r,"x","batchNorm"),s=z(e,"mean","batchNorm"),u=z(t,"variance","batchNorm"),l;a!=null&&(l=z(a,"scale","batchNorm"));var c;n!=null&&(c=z(n,"offset","batchNorm")),re(s.rank===u.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),re(c==null||s.rank===c.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),re(l==null||s.rank===l.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var f=UEe(o),h={x:f,scale:l,offset:c,mean:s,variance:u},p={varianceEpsilon:i},d=oe.runKernel(H2e,h,p);return Te(d,o.shape)}var zm=te({batchNorm_:HEe});function KEe(r,e,t,n,a,i){var o=z(r,"x","batchNorm"),s=z(e,"mean","batchNorm"),u=z(t,"variance","batchNorm"),l;a!=null&&(l=z(a,"scale","batchNorm"));var c;return n!=null&&(c=z(n,"offset","batchNorm")),re(o.rank===2,function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+(o.rank+".")}),re(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+("got rank "+s.rank+".")}),re(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+("but got rank "+u.rank+".")}),l!=null&&re(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+("but got rank "+l.rank+".")}),c!=null&&re(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+("but got rank "+c.rank+".")}),zm(o,s,u,c,l,i)}var jEe=te({batchNorm2d_:KEe});function XEe(r,e,t,n,a,i){var o=z(r,"x","batchNorm"),s=z(e,"mean","batchNorm"),u=z(t,"variance","batchNorm"),l;a!=null&&(l=z(a,"scale","batchNorm"));var c;return n!=null&&(c=z(n,"offset","batchNorm")),re(o.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+(o.rank+".")}),re(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+("got rank "+s.rank+".")}),re(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+("but got rank "+u.rank+".")}),l!=null&&re(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+("but got rank "+l.rank+".")}),c!=null&&re(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+("but got rank "+c.rank+".")}),zm(o,s,u,c,l,i)}var YEe=te({batchNorm3d_:XEe});function ZEe(r,e,t,n,a,i){var o=z(r,"x","batchNorm"),s=z(e,"mean","batchNorm"),u=z(t,"variance","batchNorm"),l;a!=null&&(l=z(a,"scale","batchNorm"));var c;return n!=null&&(c=z(n,"offset","batchNorm")),re(o.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+(o.rank+".")}),re(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+("got rank "+s.rank+".")}),re(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+("but got rank "+u.rank+".")}),l!=null&&re(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+("but got rank "+l.rank+".")}),c!=null&&re(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+("but got rank "+c.rank+".")}),zm(o,s,u,c,l,i)}var JEe=te({batchNorm4d_:ZEe});function QEe(r,e,t){var n=z(r,"x","bincount"),a=z(e,"weights","bincount");re(n.dtype==="int32",function(){return"Error in bincount: input "+("dtype must be int32, but got "+n.dtype)}),re(t>=0,function(){return"size must be non-negative, but got "+t+"."}),re(a.size===n.size||a.size===0,function(){return"Error in bincount: weights must have the same size as input or"+("0-length, but got input shape: "+n.shape+", weights shape: ")+(a.shape+".")});var i={x:n,weights:a},o={size:t};return oe.runKernel(l2e,i,o)}var HL=te({bincount_:QEe});function eTe(r,e){var t=z(r,"s0","broadcastArgs","int32"),n=z(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error("broadcastArgs(): first input must be a vector (rank=1). "+("Has rank "+t.rank));if(n.rank!==1)throw new Error("broadcastArgs(): second input must be a vector (rank=1). "+("Has rank "+n.rank));var a={s0:t,s1:n};return oe.runKernel(c2e,a)}var tTe=te({broadcastArgs_:eTe});function rTe(r,e){var t=z(r,"broadcastTo","x"),n=t.shape;if(e.some(function(f){return!(f>0)||f%1!==0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<t.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+t.rank+".");if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=Te(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): ["+n+"] cannot be broadcast to ["+e+"].");var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return ec(t);var l={x:t},c={reps:o};return oe.runKernel(FL,l,c)}var Em=te({broadcastTo_:rTe});function ms(r,e,t){return e===void 0&&(e="float32"),e=e||"float32",EL(r),new cx(r,e,t)}function nTe(r){var e=z(r,"x","ceil","float32"),t={x:e};return oe.runKernel(f2e,t)}var aTe=te({ceil_:nTe});function $m(r,e,t){var n={shape:r,value:e,dtype:t};return oe.runKernel(q2e,{},n)}function iTe(r,e,t){var n=z(r,"x","clipByValue");if(re(e<=t,function(){return"Error in clip: min ("+e+") must be "+("less than or equal to max ("+t+").")}),e===t)return $m(n.shape,e,n.dtype);var a={x:n},i={clipValueMin:e,clipValueMax:t};return oe.runKernel(h2e,a,i)}var oTe=te({clipByValue_:iTe});function sTe(r,e){var t=z(r,"real","complex"),n=z(e,"imag","complex");ui(t.shape,n.shape,"real and imag shapes, "+t.shape+" and "+n.shape+", must match in call to tf.complex().");var a={real:t,imag:n};return oe.runKernel(p2e,a)}var Iu=te({complex_:sTe});function uTe(r){return pa(r,0)}var lTe=te({concat1d_:uTe});function cTe(r,e){return pa(r,e)}var fTe=te({concat2d_:cTe});function hTe(r,e){return pa(r,e)}var pTe=te({concat3d_:hTe});function dTe(r,e){return pa(r,e)}var vTe=te({concat4d_:dTe});function mTe(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=z(r,"x","conv2d","float32"),u=z(e,"filter","conv2d","float32"),l=s,c=!1;s.rank===3&&(c=!0,l=Te(s,[1,s.shape[0],s.shape[1],s.shape[2]])),re(l.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),re(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+(u.rank+".")}),Ri("conv2d",n,o);var f=a==="NHWC"?l.shape[3]:l.shape[1];re(f===u.shape[2],function(){return"Error in conv2d: depth of input ("+f+") must match "+("input depth for filter "+u.shape[2]+".")}),re(ys(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+("Got strides "+t+" and dilations '"+i+"'")});var h={x:l,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=oe.runKernel(m2e,h,p);return c?Te(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Wm=te({conv2d_:mTe});function gTe(r,e,t,n,a,i,o){a===void 0&&(a="NWC"),i===void 0&&(i=1);var s=z(r,"x","conv1d"),u=z(e,"filter","conv1d"),l=s,c=!1;s.rank===2&&(c=!0,l=Te(s,[1,s.shape[0],s.shape[1]])),re(l.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),re(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+(u.rank+".")}),Ri("conv1d",n,o),re(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match "+("input depth for filter "+u.shape[1]+".")}),re(ys(t,i),function(){return"Error in conv1D: Either stride or dilation must be 1. "+("Got stride "+t+" and dilation '"+i+"'")}),re(a==="NWC",function(){return"Error in conv1d: got dataFormat of "+a+" but only NWC is currently supported."});var f=Te(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=Te(l,[l.shape[0],1,l.shape[1],l.shape[2]]),p=[1,t],d=[1,i],m="NHWC",v=Wm(h,f,p,n,m,d,o);return c?Te(v,[v.shape[2],v.shape[3]]):Te(v,[v.shape[0],v.shape[2],v.shape[3]])}var yTe=te({conv1d_:gTe});function bTe(r,e,t,n,a,i,o){i===void 0&&(i="NHWC"),re(r.length===e.rank,function(){return"Length of inShape "+("("+r.length+") and rank of dy ("+e.rank+") must match")});var s=r,u=e,l=!1;e.rank===3&&(l=!0,u=Te(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,r[0],r[1],r[2]]),re(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+(s.length+".")}),re(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+("rank "+u.rank)}),re(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+("rank "+t.rank)});var c=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];re(c===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must "+("match input depth for filter "+t.shape[2]+".")}),re(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+f+") must "+("match output depth for filter "+t.shape[3]+".")}),Ri("conv2dDerInput",a,o);var h={dy:u,filter:t},p={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=oe.runKernel(y2e,h,p);return l?Te(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var KL=te({conv2DBackpropInput_:bTe});function wTe(r,e,t,n,a,i){var o=z(r,"x","conv2dTranspose"),s=z(e,"filter","conv2dTranspose");return KL(t,o,s,n,a,"NHWC",i)}var xTe=te({conv2dTranspose_:wTe});function kTe(r,e,t,n,a,i){a===void 0&&(a="NDHWC"),i===void 0&&(i=[1,1,1]);var o=z(r,"x","conv3d"),s=z(e,"filter","conv3d"),u=o,l=!1;o.rank===4&&(l=!0,u=Te(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),re(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),re(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+(s.rank+".")}),re(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match "+("input depth for filter "+s.shape[3]+".")}),re(ys(t,i),function(){return"Error in conv3D: Either strides or dilations must be 1. "+("Got strides "+t+" and dilations '"+i+"'")}),re(a==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+a+" but only NDHWC is currently supported."});var c={x:u,filter:s},f={strides:t,pad:n,dataFormat:a,dilations:i},h=oe.runKernel(b2e,c,f);return l?Te(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var STe=te({conv3d_:kTe});function NTe(r,e,t,n,a){re(r.length===e.rank,function(){return"Length of inShape "+("("+r.length+") and rank of dy ("+e.rank+") must match")});var i=r,o=e,s=!1;e.rank===4&&(s=!0,o=Te(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,r[0],r[1],r[2],r[3]]);var u=i[4],l=o.shape[4];re(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+(i.length+".")}),re(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+("rank "+o.rank)}),re(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+("rank "+t.rank)}),re(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must "+("match input depth for filter "+t.shape[3]+".")}),re(l===t.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must "+("match output depth for filter "+t.shape[4]+".")});var c={dy:o,filter:t},f={pad:a,strides:n,inputShape:i},h=oe.runKernel(w2e,c,f);return s?Te(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var ETe=te({conv3DBackpropInput_:NTe});function TTe(r,e,t,n,a){var i=z(r,"x","conv3dTranspose"),o=z(e,"filter","conv3dTranspose");return ETe(t,i,o,n,a)}var ITe=te({conv3dTranspose_:TTe});function CTe(r){var e=z(r,"x","cos","float32"),t={x:e};return oe.runKernel(x2e,t)}var ATe=te({cos_:CTe});function _Te(r){var e=z(r,"x","cosh","float32"),t={x:e};return oe.runKernel(k2e,t)}var DTe=te({cosh_:_Te});function FTe(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=z(r,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:n};return oe.runKernel(S2e,i,o)}var RTe=te({cumprod_:FTe});function OTe(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=z(r,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:n};return oe.runKernel(N2e,i,o)}var PTe=te({cumsum_:OTe});function MTe(r,e,t,n){n===void 0&&(n=!1);var a=z(r,"x","denseBincount"),i=z(e,"weights","denseBincount");re(a.dtype==="int32",function(){return"Error in denseBincount: input "+("dtype must be int32, but got "+a.dtype)}),re(a.rank<=2,function(){return"Error in denseBincount: input must be at most rank 2, but got "+("rank "+a.rank+".")}),re(t>=0,function(){return"size must be non-negative, but got "+t+"."}),re(i.size===a.size||i.size===0,function(){return"Error in denseBincount: weights must have the same shape as x or "+("0-length, but got x shape: "+a.shape+", weights shape: ")+(i.shape+".")});var o={x:a,weights:i},s={size:t,binaryOutput:n};return oe.runKernel(T2e,o,s)}var BTe=te({denseBincount_:MTe});function LTe(r,e,t){t===void 0&&(t="NHWC");var n=z(r,"x","depthToSpace","float32"),a=t==="NHWC"?n.shape[1]:n.shape[2],i=t==="NHWC"?n.shape[2]:n.shape[3],o=t==="NHWC"?n.shape[3]:n.shape[1];re(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+e}),re(a*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `+a+" and "+e+`  for depthToSpace with input shape
    `+n.shape}),re(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `+i+" and "+e+` for depthToSpace with input shape
        `+n.shape}),re(o%(e*e)===0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+o+" for depthToSpace with input shape "+n.shape});var s={x:n},u={blockSize:e,dataFormat:t};return oe.runKernel(I2e,s,u)}var zTe=te({depthToSpace_:LTe});function $Te(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=z(r,"x","depthwiseConv2d","float32"),u=z(e,"filter","depthwiseConv2d","float32"),l=s,c=!1;s.rank===3&&(c=!0,l=Te(s,[1,s.shape[0],s.shape[1],s.shape[2]])),re(l.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+("rank "+l.rank+".")}),re(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+(u.rank+".")});var f=a==="NHWC"?l.shape[3]:l.shape[1];re(f===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels "+("("+f+") must match the inChannels dimension in ")+("filter "+u.shape[2]+".")}),Ri("depthwiseConv2d",n,o);var h={x:l,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=oe.runKernel(C2e,h,p);return c?Te(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Rx=te({depthwiseConv2d_:$Te});function WTe(r){var e=z(r,"x","diag"),t={x:e};return oe.runKernel(D2e,t)}var qTe=te({diag_:WTe});function VTe(r,e,t,n,a,i){a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC");var o=z(r,"x","dilation2d"),s=z(e,"filter","dilation2d");re(o.rank===3||o.rank===4,function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+(o.rank+".")}),re(s.rank===3,function(){return"Error in dilation2d: filter must be rank 3, but got rank "+(s.rank+".")}),re(i==="NHWC",function(){return"Error in dilation2d: Only NHWC is currently supported, "+("but got dataFormat of "+i)});var u=o,l=!1;o.rank===3&&(u=Te(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=!0);var c={x:u,filter:s},f={strides:t,pad:n,dilations:a},h=oe.runKernel(F2e,c,f);return l?Te(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var GTe=te({dilation2d_:VTe});function UTe(r,e){var t,n=z(r,"a","floorDiv"),a=z(e,"b","floorDiv");t=Le(Mr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return oe.runKernel(U2e,i)}var jL=te({floorDiv_:UTe});function HTe(r,e){var t,n=z(r,"a","div"),a=z(e,"b","div");if(t=Le(Mr(n,a),2),n=t[0],a=t[1],n.dtype==="int32"&&a.dtype==="int32")return jL(n,a);var i={a:n,b:a},o={};return oe.runKernel(R2e,i,o)}var In=te({div_:HTe});function KTe(r,e){for(var t=[],n=0;n<e.length;n++){var a=r[r.length-n-1],i=e.length-n-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function ln(r,e){for(var t=[],n=Math.max(r.length,e.length),a=0;a<n;a++){var i=r[r.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)t.unshift(o);else if(o===1)t.unshift(i);else if(i!==o){var s="Operands could not be broadcast together with shapes "+(r+" and "+e+".");throw Error(s)}else t.unshift(i)}return t}function jTe(r,e){var t,n=z(r,"a","equal","string_or_numeric"),a=z(e,"b","equal","string_or_numeric");t=Le(Mr(n,a),2),n=t[0],a=t[1],ln(n.shape,a.shape);var i={a:n,b:a};return oe.runKernel(B2e,i)}var XL=te({equal_:jTe});function XTe(r,e,t){var n=z(e,"a","where"),a=z(t,"b","where"),i=z(r,"condition","where","bool"),o=ln(ln(i.shape,n.shape),a.shape),s=Em(i,o),u=Em(n,o),l=Em(a,o),c={condition:s,t:u,e:l};return oe.runKernel(ZSe,c)}var ac=te({where_:XTe});function YTe(r){var e=z(r,"x","zerosLike"),t={x:e};return oe.runKernel(CNe,t)}var Ox=te({zerosLike_:YTe});function ZTe(r,e){var t,n=z(r,"a","div"),a=z(e,"b","div");t=Le(Mr(n,a),2),n=t[0],a=t[1];var i=In(n,a),o=Ox(i),s=XL(a,o);return ac(s,o,i)}var JTe=te({divNoNan_:ZTe});function QTe(r,e){var t=z(r,"t1","dot"),n=z(e,"t2","dot");re((t.rank===1||t.rank===2)&&(n.rank===1||n.rank===2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+(t.rank+" and "+n.rank+".")});var a=t.rank===1?t.size:t.shape[1],i=n.rank===1?n.size:n.shape[0];if(re(a===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+(a+" and "+i+".")}),t.rank===1&&n.rank===1){var o=Te(t,[1,-1]),s=Te(n,[-1,1]),u=Ht(o,s);return Te(u,[])}else if(t.rank===1&&n.rank===2){var o=Te(t,[1,-1]),s=Te(n,[n.shape[0],n.shape[1]]),u=Ht(o,s);return Te(u,[u.size])}else if(t.rank===2&&n.rank===1){var s=Te(n,[-1,1]),u=Ht(t,s);return Te(u,[u.size])}else{var s=Te(n,[n.shape[0],n.shape[1]]),u=Ht(t,s);return u}}var eIe=te({dot_:QTe});function tIe(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var n=e.map(function(i,o){return z(i,"tensors"+o,"einsum")}),a={equation:r};return oe.runKernel(O2e,n,a)}var rIe=te({einsum_:tIe});function nIe(r){var e=z(r,"x","elu","float32"),t={x:e};return oe.runKernel(P2e,t)}var YL=te({elu_:nIe});function aIe(r){var e=z(r,"x","erf");re(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=dn(e,"float32"));var t={x:e};return oe.runKernel(M2e,t)}var iIe=te({erf_:aIe});function oIe(r,e,t){for(var n=r.length+e.length,a=[],i=0,o=0,s=0;s<n;s++)t.indexOf(s)===-1?a.push(r[i++]):a.push(e[o++]);return a}function qm(r,e){var t=e.map(function(n){return 1});return oIe(r,t,e)}function sIe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=z(r,"x","max"),a={x:n},i={reductionIndices:e,keepDims:t};return oe.runKernel(hSe,a,i)}var rc=te({max_:sIe});function uIe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=z(r,"x","min"),a={x:n},i={axis:e,keepDims:t};return oe.runKernel(ySe,a,i)}var yx=te({min_:uIe});function lIe(r,e){var t,n=z(r,"base","pow"),a=z(e,"exp","pow");t=Le(Mr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return oe.runKernel(RSe,i)}var Px=te({pow_:lIe});function bs(r,e,t,n){if(n==null&&(n=Ex(r)),n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!to(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){EL(e);var a=qn(e),i=qn(t);re(a===i,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+(a+" values but has "+i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==qn(e.slice(o)):!0;re(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+("("+t+") does not match the provided ")+("shape ("+e+"). ")})}}return!to(r)&&!Array.isArray(r)&&(r=[r]),e=e||t,r=n!=="string"?LL(r,n):Bm(r,[],!0),oe.makeTensor(r,e,n)}function Ar(r,e){if((to(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&to(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],n=[];return bs(r,t,n,e)}function cIe(r){var e=z(r,"x","sqrt","float32"),t={x:e};return oe.runKernel(iNe,t)}var bx=te({sqrt_:cIe});function fIe(r){var e=z(r,"x","square"),t={};return oe.runKernel("Square",{x:e},t)}var Vm=te({square_:fIe});function hIe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=z(r,"x","sum");n.dtype==="bool"&&(n=dn(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return oe.runKernel(oNe,a,i)}var vr=te({sum_:hIe});function pIe(r,e,t,n){e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1),r=z(r,"x","norm");var a=ZL(r,e,t),i=a.shape;if(n){var o=Lm(t,r.shape);i=qm(a.shape,o)}return Te(a,i)}function ZL(r,e,t){if(t===void 0&&(t=null),r.rank===0)return ri(r);if(r.rank!==1&&t===null)return ZL(Te(r,[-1]),e,t);if(r.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return vr(ri(r),t);if(e===1/0)return rc(ri(r),t);if(e===-1/0)return yx(ri(r),t);if(e==="euclidean"||e===2)return bx(vr(Px(ri(r),Ar(2,"int32")),t));throw new Error("Error in norm: invalid ord value: "+e)}if(Array.isArray(t)&&t.length===2){if(e===1)return rc(vr(ri(r),t[0]),t[1]-1);if(e===1/0)return rc(vr(ri(r),t[1]),t[0]);if(e===-1/0)return yx(vr(ri(r),t[1]),t[0]);if(e==="fro"||e==="euclidean")return bx(vr(Vm(r),t));throw new Error("Error in norm: invalid ord value: "+e)}throw new Error("Error in norm: invalid axis: "+t)}var Gm=te({norm_:pIe});function dIe(r,e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),Gm(r,"euclidean",e,t)}var vIe=te({euclideanNorm_:dIe});function mIe(r){var e=z(r,"x","exp"),t={x:e};return oe.runKernel(L2e,t)}var Cu=te({exp_:mIe});function gIe(r,e){e===void 0&&(e=0);var t=z(r,"x","expandDims","string_or_numeric");re(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var n={input:t},a={dim:e};return oe.runKernel(z2e,n,a)}var Nu=te({expandDims_:gIe});function yIe(r){var e=z(r,"x","expm1"),t={x:e};return oe.runKernel($2e,t)}var bIe=te({expm1_:yIe});function wIe(r,e){var t=z(r,"x","tile","string_or_numeric");re(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" "+("must match length of reps "+e+".")});var n={x:t},a={reps:e};return oe.runKernel(FL,n,a)}var Ph=te({tile_:wIe});function xIe(r,e,t,n){n===void 0&&(n="float32"),e==null&&(e=r);for(var a=ms([r,e],n),i=r<=e?r:e,o=0;o<i;++o)a.set(1,o,o);var s=Te(a.toTensor(),[r,e]);if(t==null)return s;if(t.length===1)return Ph(Nu(s,0),[t[0],1,1]);if(t.length===2)return Ph(Nu(Nu(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return Ph(Nu(Nu(Nu(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+("batchShapes, but received "+t.length+"D."))}var JL=te({eye_:xIe});function kIe(r){var e=z(r,"x","floor","float32"),t={x:e};return oe.runKernel(G2e,t)}var QL=te({floor_:kIe});function SIe(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=0);var a=z(r,"x","gather"),i=z(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:n};return oe.runKernel(K2e,o,s)}var ez=te({gather_:SIe});function NIe(r,e){var t,n=z(r,"a","greater","string_or_numeric"),a=z(e,"b","greater","string_or_numeric");t=Le(Mr(n,a),2),n=t[0],a=t[1],ln(n.shape,a.shape);var i={a:n,b:a};return oe.runKernel(X2e,i)}var Um=te({greater_:NIe});function EIe(r,e){var t,n=z(r,"a","greaterEqual","string_or_numeric"),a=z(e,"b","greaterEqual","string_or_numeric");t=Le(Mr(n,a),2),n=t[0],a=t[1],ln(n.shape,a.shape);var i={a:n,b:a};return oe.runKernel(Y2e,i)}var tz=te({greaterEqual_:EIe});function TIe(r){var e=z(r,"input","imag"),t={input:e};return oe.runKernel(J2e,t)}var Hm=te({imag_:TIe});function IIe(r){var e=z(r,"x","isFinite"),t={x:e};return oe.runKernel(Q2e,t)}var CIe=te({isFinite_:IIe});function AIe(r){var e=z(r,"x","isInf"),t={x:e};return oe.runKernel(eSe,t)}var _Ie=te({isInf_:AIe});function DIe(r){var e=z(r,"x","isNaN"),t={x:e};return oe.runKernel(tSe,t)}var FIe=te({isNaN_:DIe});function RIe(r,e){e===void 0&&(e=.2);var t=z(r,"x","leakyRelu"),n={x:t},a={alpha:e};return oe.runKernel(rSe,n,a)}var rz=te({leakyRelu_:RIe});function OIe(r,e){var t,n=z(r,"a","less","string_or_numeric"),a=z(e,"b","less","string_or_numeric");t=Le(Mr(n,a),2),n=t[0],a=t[1],ln(n.shape,a.shape);var i={a:n,b:a};return oe.runKernel(nSe,i)}var PIe=te({less_:OIe});function MIe(r,e){var t,n=z(r,"a","lessEqual","string_or_numeric"),a=z(e,"b","lessEqual","string_or_numeric");t=Le(Mr(n,a),2),n=t[0],a=t[1],ln(n.shape,a.shape);var i={a:n,b:a};return oe.runKernel(aSe,i)}var Mx=te({lessEqual_:MIe});function BIe(r,e,t){if(t<=0)throw new Error("The number of values should be positive.");var n={start:r,stop:e,num:t};return oe.runKernel(iSe,{},n)}function LIe(r,e,t,n,a){e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),a===void 0&&(a=.5);var i=z(r,"x","localResponseNormalization");re(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+i.rank+"."}),re(Bh(e),function(){return"Error in localResponseNormalization: depthRadius must be an "+("integer but got depthRadius "+e+".")});var o=i,s=!1;i.rank===3&&(s=!0,o=Te(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},l={depthRadius:e,bias:t,alpha:n,beta:a},c=oe.runKernel(fSe,u,l);return s?Te(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var zIe=te({localResponseNormalization_:LIe});function $Ie(r){var e=z(r,"x","log","float32"),t={x:e};return oe.runKernel(oSe,t)}var Lh=te({log_:$Ie});function WIe(r){var e=z(r,"x","log1p"),t={x:e};return oe.runKernel(sSe,t)}var nz=te({log1p_:WIe});function To(r){return oe.customGrad(r)}function qIe(r){var e=z(r,"x","neg"),t={x:e};return oe.runKernel(NSe,t)}var Eo=te({neg_:qIe});function VIe(r){var e=z(r,"x","softplus"),t={x:e};return oe.runKernel(aNe,t)}var az=te({softplus_:VIe});function GIe(r){var e=z(r,"x","logSigmoid"),t=To(function(n){var a=Eo(az(Eo(n))),i=function(o){var s=Ct(o,tc(Eo(n)));return s};return{value:a,gradFunc:i}});return t(e)}var UIe=te({logSigmoid_:GIe});function HIe(r,e){var t,n=z(r,"a","sub"),a=z(e,"b","sub");t=Le(Mr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return oe.runKernel(wNe,i)}var Bt=te({sub_:HIe});function KIe(r,e){e===void 0&&(e=-1);var t=z(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+("Logits was rank "+t.rank+" and axis was "+e));var n=To(function(a,i){var o=!0,s=rc(a,e,!0),u=Bt(a,s),l=Bt(dn(u,"float32"),Lh(vr(Cu(u),e,o)));i([l]);var c=function(f,h){var p=Le(h,1),d=p[0],m=!0,v=Cu(d);return Bt(f,Ct(vr(f,e,m),v))};return{value:l,gradFunc:c}});return n(t)}var jIe=te({logSoftmax_:KIe});function XIe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=z(r,"x","logSumExp"),a=Lm(e,n.shape),i=rc(n,a,!0),o=Bt(n,i),s=Cu(o),u=vr(s,a),l=Lh(u),c=un(Te(i,l.shape),l);if(t){var f=qm(c.shape,a);return Te(c,f)}return c}var iz=te({logSumExp_:XIe});function YIe(r,e){var t=z(r,"a","logicalAnd","bool"),n=z(e,"b","logicalAnd","bool");ln(t.shape,n.shape);var a={a:t,b:n};return oe.runKernel(uSe,a)}var Om=te({logicalAnd_:YIe});function ZIe(r){var e=z(r,"x","logicalNot","bool"),t={x:e};return oe.runKernel(lSe,t)}var oz=te({logicalNot_:ZIe});function JIe(r,e){var t=z(r,"a","logicalOr","bool"),n=z(e,"b","logicalOr","bool");ln(t.shape,n.shape);var a={a:t,b:n};return oe.runKernel(cSe,a)}var sz=te({logicalOr_:JIe});function QIe(r,e){var t=z(r,"a","logicalXor","bool"),n=z(e,"b","logicalXor","bool");return ln(t.shape,n.shape),Om(sz(r,e),oz(Om(r,e)))}var eCe=te({logicalXor_:QIe});var xm=2147483648;function tCe(r,e,t){t===void 0&&(t="left");var n=z(r,"sortedSequence","searchSorted"),a=z(e,"values","searchSorted"),i=n.shape[n.shape.length-1],o=a.shape[a.shape.length-1],s=Te(n,[-1,i]),u=Te(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(qn(u.shape)>=xm)throw new Error("values tensor size must less than "+xm);if(s.shape[1]>=xm)throw new Error("trailing dim_size must less than "+xm+" for int32 output type, was "+s.shape[1]);var l={sortedSequence:s,values:u},c={side:t};return oe.runKernel(YSe,l,c)}var Bx=te({searchSorted_:tCe});function rCe(r,e){return Bx(r,e,"left")}function nCe(r,e,t,n,a){var i=z(r,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=Te(i,[1,i.shape[0],i.shape[1],i.shape[2]])),re(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),re(ys(t,o),function(){return"Error in maxPool: Either strides or dilations must be 1. "+("Got strides "+t+" and dilations '"+o+"'")}),Ri("maxPool",n,a);var l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=oe.runKernel(dSe,l,c);return u?Te(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var uz=te({maxPool_:nCe});function aCe(r,e,t,n,a,i){e===void 0&&(e=[1,1,1]),i===void 0&&(i="NDHWC");var o=z(r,"x","maxPool3d"),s=o,u=!1;o.rank===4&&(u=!0,s=Te(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),re(s.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+s.rank+"."}),re(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+("but got dataFormat of "+i)}),Ri("maxPool3d",n,a);var l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=oe.runKernel(vSe,l,c);return u?Te(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var iCe=te({maxPool3d_:aCe});function oCe(r,e,t,n,a){a===void 0&&(a=!1);var i=z(r,"x","maxPoolWithArgmax"),o={x:i},s={filterSize:e,strides:t,pad:n,includeBatchInIndex:a},u=oe.runKernel(mSe,o,s);return{result:u[0],indexes:u[1]}}var sCe=te({maxPoolWithArgmax_:oCe});function uCe(r,e){var t,n=z(r,"a","maximum"),a=z(e,"b","maximum");t=Le(Mr(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=dn(n,"int32"),a=dn(a,"int32")),ln(n.shape,a.shape);var i={a:n,b:a};return oe.runKernel(pSe,i)}var lCe=te({maximum_:uCe});function cCe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=z(r,"x","mean"),a={x:n},i={axis:e,keepDims:t};return oe.runKernel(gSe,a,i)}var Pm=te({mean_:cCe});function ic(r,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=ic(r,"float32"),n=ic(r,"float32");return Iu(t,n)}var a=Ix(qn(r),e);return oe.makeTensor(a,r,e)}function Tu(r,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Tu(r,"float32"),n=ic(r,"float32");return Iu(t,n)}var a=NL(qn(r),e);return oe.makeTensor(a,r,e)}function fCe(r,e,t){var n=(t===void 0?{}:t).indexing,a=n===void 0?"xy":n;if(a!=="xy"&&a!=="ij")throw new TypeError(a+" is not a valid third argument to meshgrid");if(r===void 0)return[];var i=z(r,"x","meshgrid",r instanceof $n?r.dtype:"float32");if(e===void 0)return[i];var o=z(e,"y","meshgrid",e instanceof $n?e.dtype:"float32"),s=qn(i.shape),u=qn(o.shape);return a==="xy"?(i=Te(i,[1,-1]),o=Te(o,[-1,1]),[Ht(Tu([u,1],i.dtype),i),Ht(o,Tu([1,s],o.dtype))]):(i=Te(i,[-1,1]),o=Te(o,[1,-1]),[Ht(i,Tu([1,u],i.dtype)),Ht(Tu([s,1],o.dtype),o)])}function hCe(r,e){var t,n=z(r,"a","minimum"),a=z(e,"b","minimum");t=Le(Mr(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=dn(n,"int32"),a=dn(a,"int32")),ln(n.shape,a.shape);var i={a:n,b:a};return oe.runKernel(bSe,i)}var lz=te({minimum_:hCe});function pCe(r,e,t){re(t==="reflect"||t==="symmetric",function(){return"Invalid mode. Mode must be either reflect or symmetric. "+("Got "+t+".")});var n=z(r,"x","mirrorPad");if(n.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");re(e.length===n.rank,function(){return"Padding doesn't match input. Must be "+n.rank+". "+("Got "+e.length+".")});for(var a=t==="reflect"?1:0,i=function(l){re(e[l].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),re(e[l][0]>=0&&e[l][0]<=n.shape[l]-a&&e[l][1]>=0&&e[l][1]<=n.shape[l]-a,function(){return"Padding in dimension "+l+" cannot be greater than or equal "+("to "+(n.shape[l]-a)+" or less than 0 for input of ")+("shape "+n.shape)})},o=0;o<n.rank;o++)i(o);var s={paddings:e,mode:t},u={x:n};return oe.runKernel(wSe,u,s)}var dCe=te({mirrorPad_:pCe});function vCe(r,e){var t,n=z(r,"a","mod"),a=z(e,"b","mod");t=Le(Mr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return oe.runKernel(xSe,i)}var mCe=te({mod_:vCe});function gCe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1),r=z(r,"x","moments");var n=Lm(e,r.shape),a=Pm(r,n,t),i=a.shape;t||(i=qm(a.shape,n));var o=Vm(Bt(dn(r,"float32"),Te(a,i))),s=Pm(o,n,t);return{mean:a,variance:s}}var yCe=te({moments_:gCe});function bCe(r,e,t,n){for(var a=z(e,"data","multiRNNCell"),i=_m(t,"c","multiRNNCell"),o=_m(n,"h","multiRNNCell"),s=a,u=[],l=0;l<r.length;l++){var c=r[l](s,i[l],o[l]);u.push(c[0]),u.push(c[1]),s=c[1]}for(var f=[],h=[],l=0;l<u.length;l+=2)f.push(u[l]),h.push(u[l+1]);return[f,h]}var wCe=te({multiRNNCell_:bCe});function xCe(r,e,t,n){n===void 0&&(n=!1);var a=z(r,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+(i+"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+o);t=t||Math.random();var s=o===1?Te(a,[1,-1]):a,u={logits:s},l={numSamples:e,seed:t,normalized:n},c=oe.runKernel(kSe,u,l);return o===1?Te(c,[c.size]):c}var kCe=te({multinomial_:xCe});function SCe(r,e){var t,n=z(r,"a","notEqual","string_or_numeric"),a=z(e,"b","notEqual","string_or_numeric");t=Le(Mr(n,a),2),n=t[0],a=t[1],ln(n.shape,a.shape);var i={a:n,b:a};return oe.runKernel(ESe,i)}var cz=te({notEqual_:SCe});function NCe(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n=0),a===void 0&&(a="int32"),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=z(r,"indices","oneHot","int32"),o={indices:i},s={dtype:a,depth:e,onValue:t,offValue:n};return oe.runKernel(_Se,o,s)}var ECe=te({oneHot_:NCe});function TCe(r){var e=z(r,"x","onesLike"),t={x:e};return oe.runKernel(ASe,t)}var ICe=te({onesLike_:TCe});function CCe(r,e){var t=z(r,"v1","outerProduct"),n=z(e,"v2","outerProduct");re(t.rank===1&&n.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+(t.rank+" and "+n.rank+".")});var a=Te(t,[-1,1]),i=Te(n,[1,-1]);return Ht(a,i)}var ACe=te({outerProduct_:CCe});function _Ce(r,e,t){t===void 0&&(t=0);var n=z(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:n};return oe.runKernel(FSe,i,a)}var Vh=te({pad_:_Ce});function DCe(r,e,t){return t===void 0&&(t=0),re(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Vh(r,[e],t)}var FCe=te({pad1d_:DCe});function RCe(r,e,t){return t===void 0&&(t=0),re(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Vh(r,e,t)}var OCe=te({pad2d_:RCe});function PCe(r,e,t){return t===void 0&&(t=0),re(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Vh(r,e,t)}var MCe=te({pad3d_:PCe});function BCe(r,e,t){return t===void 0&&(t=0),re(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Vh(r,e,t)}var LCe=te({pad4d_:BCe});function zCe(r,e,t){var n=z(r,"x","spaceToBatchND");re(n.rank>=1+e.length,function(){return"input rank "+n.rank+" should be > than [blockShape] "+e.length}),re(t.length===e.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length}),re(n.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions "+n.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()});var a={x:n},i={blockShape:e,paddings:t};return oe.runKernel(sNe,a,i)}var fz=te({spaceToBatchND_:zCe});function $Ce(r,e,t,n,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),n===0&&(n="valid");var s=z(r,"x","maxPool"),u=s,l=!1;s.rank===3&&(l=!0,u=Te(s,[1,s.shape[0],s.shape[1],s.shape[2]])),re(ys(i,a),function(){return"Error in pool: Either strides or dilations must be 1. "+("Got strides "+i+" and dilations '"+a+"'")});var c=IEe(u.shape,e,i,a,n),f=[c.dilationHeight,c.dilationWidth],h;n==="same"?h=qCe([c.filterHeight,c.filterWidth],f):h=[[0,0],[0,0]];var p=f[0]===1&&f[1]===1,d=Le(WCe([c.inHeight,c.inWidth],f,h),2),m=d[0],v=d[1],g=p?n:"valid",y=p?u:fz(u,f,m),b=t==="avg"?function(){return GL(y,e,i,g,o)}:function(){return uz(y,e,i,g,o)},w=b(),x=p?w:UL(w,f,v);return l?Te(x,[x.shape[1],x.shape[2],x.shape[3]]):x}function WCe(r,e,t){var n=t.map(function(c){return c[0]}),a=t.map(function(c){return c[1]}),i=r.concat(n,a),o=e.map(function(c,f){return(c-i[f]%c)%c}),s=a.map(function(c,f){return c+o[f]}),u=e.map(function(c,f){return[n[f],s[f]]}),l=e.map(function(c,f){return[0,o[f]]});return[u,l]}function qCe(r,e){var t=r.map(function(o,s){return o+(o-1)*(e[s]-1)}),n=t.map(function(o){return o-1}),a=n.map(function(o){return Math.floor(o/2)}),i=n.map(function(o,s){return o-a[s]});return n.map(function(o,s){return[a[s],i[s]]})}var VCe=te({pool_:$Ce});function GCe(r,e){var t=z(r,"x","prelu"),n=z(e,"alpha","prelu"),a={x:t,alpha:n};return oe.runKernel(OSe,a)}var hz=te({prelu_:GCe});function UCe(r,e){e===void 0&&(e=!1),console.log(r.toString(e))}function HCe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=z(r,"x","prod");n.dtype==="bool"&&(n=dn(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return oe.runKernel(PSe,a,i)}var KCe=te({prod_:HCe});function jCe(r,e,t,n){var a=r.map(function(c,f){return z(c,"tensors"+f,"raggedGather","int32")}),i=z(e,"paramsDenseValues","raggedGather"),o=z(t,"indices","raggedGather","int32"),s={paramsNestedSplits:a,paramsDenseValues:i,indices:o},u={outputRaggedRank:n},l=oe.runKernel(MSe,s,u);return{outputNestedSplits:l.slice(0,l.length-1),outputDenseValues:l[l.length-1]}}var XCe=te({raggedGather_:jCe});function YCe(r,e,t,n,a){var i=z(r,"shape","raggedTensorToTensor","int32"),o=z(e,"values","raggedTensorToTensor"),s=z(t,"defaultValue","raggedTensorToTensor",o.dtype),u=n.map(function(f,h){return z(f,"tensors"+h,"raggedTensorToTensor","int32")}),l={shape:i,values:o,defaultValue:s,rowPartitionTensors:u},c={rowPartitionTypes:a};return oe.runKernel(BSe,l,c)}var ZCe=te({raggedTensorToTensor_:YCe});function JCe(r,e,t){var n=qn(r),a=null;if(t==null||t==="float32")a=new Float32Array(n);else if(t==="int32")a=new Int32Array(n);else if(t==="bool")a=new Uint8Array(n);else throw new Error("Unknown data type "+t);for(var i=0;i<n;i++)a[i]=e();return oe.makeTensor(a,r,t)}var QCe=te({rand_:JCe}),Du=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function eAe(r){if(r.__esModule)return r;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(r).forEach(function(t){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}),e}function Fu(r){var e={exports:{}};return r(e,e.exports),e.exports}var tAe=Fu(function(r){(function(e,t,n){function a(u){var l=this,c=s();l.next=function(){var f=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=f-(l.c=f|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(u),l.s0<0&&(l.s0+=1),l.s1-=c(u),l.s1<0&&(l.s1+=1),l.s2-=c(u),l.s2<0&&(l.s2+=1),c=null}function i(u,l){return l.c=u.c,l.s0=u.s0,l.s1=u.s1,l.s2=u.s2,l}function o(u,l){var c=new a(u),f=l&&l.state,h=c.next;return h.int32=function(){return c.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,c),h.state=function(){return i(c,{})}),h}function s(){var u=4022871197,l=function(c){c=String(c);for(var f=0;f<c.length;f++){u+=c.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return l}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(Du,r,!1)}),rAe=Fu(function(r){(function(e,t,n){function a(s){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(Du,r,!1)}),nAe=Fu(function(r){(function(e,t,n){function a(s){var u=this,l="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(Du,r,!1)}),aAe=Fu(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var c=u.x,f=u.i,h,p;return h=c[f],h^=h>>>7,p=h^h<<24,h=c[f+1&7],p^=h^h>>>10,h=c[f+3&7],p^=h^h>>>3,h=c[f+4&7],p^=h^h<<7,h=c[f+7&7],h=h^h<<13,p^=h^h<<9,c[f]=p,u.i=f+1&7,p};function l(c,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8&&(p[7]=-1),c.x=p,c.i=0,h=256;h>0;--h)c.next()}l(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(c.x&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(Du,r,!1)}),iAe=Fu(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var c=u.w,f=u.X,h=u.i,p,d;return u.w=c=c+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(c^c>>>16)|0};function l(c,f){var h,p,d,m,v,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,m=-32;m<y;++m)f&&(p^=f.charCodeAt((m+32)%f.length)),m===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(v=v+1640531527|0,h=g[m&127]^=p+v,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,m=4*128;m>0;--m)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;c.w=v,c.X=g,c.i=d}l(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(c.X&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(Du,r,!1)}),oAe=Fu(function(r){(function(e,t,n){function a(s){var u=this,l="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)u.b^=l.charCodeAt(c)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(Du,r,!1)}),sAe={},uAe={__proto__:null,default:sAe},lAe=eAe(uAe),Ru=Fu(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),l=n.pow(2,o),c=l*2,f=a-1,h;function p(w,x,k){var N=[];x=x==!0?{entropy:!0}:x||{};var T=g(v(x.entropy?[w,b(t)]:w??y(),3),N),I=new d(N),F=function(){for(var D=I.g(i),R=u,P=0;D<l;)D=(D+P)*a,R*=a,P=I.g(1);for(;D>=c;)D/=2,R/=2,P>>>=1;return(D+P)/R};return F.int32=function(){return I.g(4)|0},F.quick=function(){return I.g(4)/4294967296},F.double=F,g(b(I.S),t),(x.pass||k||function(D,R,P,B){return B&&(B.S&&m(B,I),D.state=function(){return m(I,{})}),P?(n[s]=D,R):D})(F,T,"global"in x?x.global:this==n,x.state)}function d(w){var x,k=w.length,N=this,T=0,I=N.i=N.j=0,F=N.S=[];for(k||(w=[k++]);T<a;)F[T]=T++;for(T=0;T<a;T++)F[T]=F[I=f&I+w[T%k]+(x=F[T])],F[I]=x;(N.g=function(D){for(var R,P=0,B=N.i,q=N.j,O=N.S;D--;)R=O[B=f&B+1],P=P*a+O[f&(O[B]=O[q=f&q+R])+(O[q]=R)];return N.i=B,N.j=q,P})(a)}function m(w,x){return x.i=w.i,x.j=w.j,x.S=w.S.slice(),x}function v(w,x){var k=[],N=typeof w,T;if(x&&N=="object")for(T in w)try{k.push(v(w[T],x-1))}catch{}return k.length?k:N=="string"?w:w+"\0"}function g(w,x){for(var k=w+"",N,T=0;T<k.length;)x[f&T]=f&(N^=x[f&T]*19)+k.charCodeAt(T++);return b(x)}function y(){try{var w;return h&&(w=h.randomBytes)?w=w(a):(w=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var x=e.navigator,k=x&&x.plugins;return[+new Date,e,k,e.screen,b(t)]}}function b(w){return String.fromCharCode.apply(0,w)}if(g(n.random(),t),r.exports){r.exports=p;try{h=lAe}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:Du,[],Math)});Ru.alea=tAe;Ru.xor128=rAe;Ru.xorwow=nAe;Ru.xorshift7=aAe;Ru.xor4096=iAe;Ru.tychei=oAe;var Lx=Ru;var zx=function(){function r(e,t,n,a,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);var o=i||Math.random();this.random=Lx.alea(o.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,a=!1;!a;){var i=void 0,o=void 0,s=void 0;do i=2*this.random()-1,o=2*this.random()-1,s=i*i+o*o;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*i*u,n=this.mean+this.stdDev*o*u,(!this.truncated||this.isValidTruncated(t))&&(a=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)},r.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},r.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},r}(),cAe=function(){function r(e,t,n,a){this.alpha=e,this.beta=1/t,this.dtype=n;var i=a||Math.random();this.randu=Lx.alea(i.toString()),this.randn=new zx(0,1,n,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var e,t,n,a,i,o;;){do a=this.randn.nextValue(),o=1+this.c*a;while(o<=0);if(o*=o*o,e=a*a,t=1-.331*e*e,n=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<t||Math.log(i)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},r.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},r}(),fAe=function(){function r(e,t,n,a){var i=this;if(e===void 0&&(e=0),t===void 0&&(t=1),this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=n,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=Lx.alea(a)}return r.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r}();function hAe(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t==null&&(t=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error("Unsupported data type "+n);for(var i=new cAe(e,t,n,a),o=ms(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var pAe=te({randomGamma_:hAe});function dAe(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),n!=null&&n==="bool")throw new Error("Unsupported data type "+n);for(var i=new zx(e,t,n,!1,a),o=ms(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var pz=te({randomNormal_:dAe});function vAe(r,e,t){if(e!=null&&e==="bool")throw new Error("Unsupported data type "+e);return pz(r,0,1,e,t)}var mAe=te({randomStandardNormal_:vAe});function gAe(r,e,t,n,a){e===void 0&&(e=0),t===void 0&&(t=1),n===void 0&&(n="float32");for(var i=ms(r,n),o=new fAe(e,t,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}var dz=te({randomUniform_:gAe});function zh(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t===0)throw new Error("Cannot have a step of zero");var a={start:r,stop:e,step:t,dtype:n};return oe.runKernel(LSe,{},a)}function yAe(r){var e=z(r,"input","real"),t={input:e};return oe.runKernel(zSe,t)}var $h=te({real_:yAe});function bAe(r){var e=z(r,"x","reciprocal"),t={x:e};return oe.runKernel($Se,t)}var wAe=te({reciprocal_:bAe});function xAe(r){var e=z(r,"x","relu"),t={x:e};return oe.runKernel(WSe,t)}var Km=te({relu_:xAe});function kAe(r){var e=z(r,"x","relu6"),t={x:e};return oe.runKernel(USe,t)}var vz=te({relu6_:kAe});function SAe(r,e){var t=z(r,"x","reverse"),n={x:t},a={dims:e};return oe.runKernel(HSe,n,a)}var Au=te({reverse_:SAe});function NAe(r){var e=z(r,"x","reverse");return re(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),Au(e,0)}var EAe=te({reverse1d_:NAe});function TAe(r,e){var t=z(r,"x","reverse");return re(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),Au(t,e)}var IAe=te({reverse2d_:TAe});function CAe(r,e){var t=z(r,"x","reverse");return re(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),Au(t,e)}var AAe=te({reverse3d_:CAe});function _Ae(r,e){var t=z(r,"x","reverse");return re(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),Au(t,e)}var DAe=te({reverse4d_:_Ae});function FAe(r){var e=z(r,"x","round"),t={x:e};return oe.runKernel(KSe,t)}var mz=te({round_:FAe});function RAe(r){var e=z(r,"x","rsqrt","float32"),t={x:e};return oe.runKernel(jSe,t)}var OAe=te({rsqrt_:RAe});function PAe(r){var e=z(r,"x","selu"),t={x:e};return oe.runKernel(JSe,t)}var MAe=te({selu_:PAe});function BAe(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC");var s=z(r,"x","separableConv2d"),u=z(e,"depthwiseFilter","separableConv2d"),l=z(t,"pointwiseFilter","separableConv2d"),c=s,f=!1;if(s.rank===3&&(f=!0,c=Te(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");re(c.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got "+("rank "+c.rank+".")}),re(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+("got rank "+u.rank+".")}),re(l.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+("got rank "+u.rank+".")}),re(l.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter "+(" must be 1, but got "+l.shape[0]+".")}),re(l.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise "+("filter must be 1, but got "+l.shape[1]+".")});var h=u.shape[2],p=u.shape[3];re(l.shape[2]===h*p,function(){return"Error in separableConv2d: the third dimension of pointwise filter "+("must be "+h*p+", ")+("but got "+l.shape[2]+".")});var d=Rx(c,u,n,a,o,i),m=1,v=Wm(d,l,m,"valid",o);return f?Te(v,[v.shape[1],v.shape[2],v.shape[3]]):v}var LAe=te({separableConv2d_:BAe});function zAe(r,e){return Yt(this,void 0,void 0,function(){var t,n,a,i,o,s,c,u,l,c,f;return Kt(this,function(h){switch(h.label){case 0:return t=z(r,"x","setdiff1d"),n=z(e,"y","setdiff1d"),re(t.dtype===n.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+n.dtype+")."}),re(t.rank===1,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),re(n.rank===1,function(){return"y should be 1D tensor, but got y ("+n.shape+")."}),[4,t.data()];case 1:return a=h.sent(),[4,n.data()];case 2:for(i=h.sent(),o=new Set(i),s=0,c=0;c<a.length;c++)o.has(a[c])||s++;for(u=new cx([s],t.dtype),l=new cx([s],"int32"),c=0,f=0;c<a.length;c++)o.has(a[c])||(u.values[f]=a[c],l.values[f]=c,f++);return[2,[u.toTensor(),l.toTensor()]]}})})}var $Ae=zAe;function WAe(r){var e=z(r,"x","sign"),t={x:e};return oe.runKernel(rNe,t)}var qAe=te({sign_:WAe});function VAe(r){var e=z(r,"x","sin","float32"),t={x:e};return oe.runKernel(eNe,t)}var GAe=te({sin_:VAe});function UAe(r){var e=z(r,"x","sinh"),t={x:e};return oe.runKernel(tNe,t)}var HAe=te({sinh_:UAe});function KAe(r,e,t){var n=z(r,"x","slice1d");return re(n.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+n.rank+" tensor"}),Er(n,[e],[t])}var jAe=te({slice1d_:KAe});function XAe(r,e,t){var n=z(r,"x","slice2d");return re(n.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+n.rank+" tensor"}),Er(n,e,t)}var YAe=te({slice2d_:XAe});function ZAe(r,e,t){var n=z(r,"x","slice3d");return re(n.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+n.rank+" tensor"}),Er(n,e,t)}var JAe=te({slice3d_:ZAe});function QAe(r,e,t){var n=z(r,"x","slice4d");return re(n.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+n.rank+" tensor"}),Er(n,e,t)}var e_e=te({slice4d_:QAe});function t_e(r,e){e===void 0&&(e=-1);var t=z(r,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+("Logits was rank "+t.rank+" and dim was "+e));var n={logits:t},a={dim:e};return oe.runKernel(lNe,n,a)}var r_e=te({softmax_:t_e});function n_e(r){re(r.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 "+("but got "+r.dtype+".")});var e={input:r};return oe.runKernel(W2e,e)}var $x=te({fft_:n_e});function a_e(r){re(r.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 "+("but got "+r.dtype+".")});var e={input:r};return oe.runKernel(Z2e,e)}var Mm=te({ifft_:a_e});function i_e(r){var e=r.shape[r.shape.length-1],t=r.size/e,n;if(e<=2){var a=Te(r,[t,e]);n=Mm(a)}else{var i=[t,2*(e-1)],o=Te($h(r),[t,e]),s=Te(Hm(r),[t,e]),u=Au(Er(o,[0,1],[t,e-2]),1),l=Ct(Au(Er(s,[0,1],[t,e-2]),1),Ar(-1)),c=pa([o,u],1),f=pa([s,l],1),a=Te(Iu(c,f),[i[0],i[1]]);n=Mm(a)}if(n=$h(n),r.rank===3&&r.shape[0]!==0){var h=n,p=r.shape[0];n=Te(n,[p,n.shape[0]/p,n.shape[1]]),h.dispose()}return n}var gz=te({irfft_:i_e});function o_e(r,e,t){t===void 0&&(t=0);var n=z(r,"x","split"),a={x:n},i={numOrSizeSplits:e,axis:t};return oe.runKernel(uNe,a,i)}var Wh=te({split_:o_e});function s_e(r,e){re(r.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+r.dtype});var t=r.shape[r.shape.length-1],n=r.size/t,a;if(e!=null&&e<t){var i=r.shape.map(function(g){return 0}),o=r.shape.map(function(g){return g});o[r.shape.length-1]=e,a=Er(r,i,o),t=e}else if(e!=null&&e>t){var s=r.shape.map(function(g){return g});s[r.shape.length-1]=e-t,a=pa([r,ic(s)],r.shape.length-1),t=e}else a=r;var u=Ox(a),l=Te(Iu(a,u),[n,t]),c=$x(l),f=Math.floor(t/2)+1,h=$h(c),p=Hm(c),d=Wh(h,[f,t-f],h.shape.length-1),m=Wh(p,[f,t-f],p.shape.length-1),v=a.shape.slice();return v[a.shape.length-1]=f,Te(Iu(d[0],m[0]),v)}var Wx=te({rfft_:s_e});function u_e(r,e){var t,n=z(r,"a","squaredDifference"),a=z(e,"b","squaredDifference");t=Le(Mr(n,a),2),n=t[0],a=t[1],ln(n.shape,a.shape);var i={a:n,b:a},o={};return oe.runKernel(vNe,i,o)}var yz=te({squaredDifference_:u_e});function l_e(r,e){var t=z(r,"x","squeeze","string_or_numeric");return Te(t,Fke(t.shape,e).newShape)}var qx=te({squeeze_:l_e});function c_e(r,e){e===void 0&&(e=0);var t=_m(r,"tensors","stack","string_or_numeric");re(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&re(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var n=t,a={axis:e};return oe.runKernel(DSe,n,a)}var qh=te({stack_:c_e});function f_e(r,e){e===void 0&&(e=0);var t=z(r,"x","step"),n={x:t},a={alpha:e};return oe.runKernel(ANe,n,a)}var bz=te({step_:f_e});function h_e(r,e,t,n,a,i,o,s,u){a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),u===void 0&&(u=0);var l=z(r,"x","stridedSlice","string_or_numeric"),c={x:l},f={begin:e,end:t,strides:n,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return oe.runKernel(mNe,c,f)}var p_e=te({stridedSlice_:h_e});function d_e(r){var e=z(r,"x","tan","float32"),t={x:e};return oe.runKernel(xNe,t)}var v_e=te({tan_:d_e});function Vx(r,e,t){var n=gs(r,t);return bs(r,e,n,t)}function Di(r,e){oc(r);var t=gs(r,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");var n=null;return bs(r,n,t,e)}function Mh(r,e,t){if(oc(r),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var n=gs(r,t);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return bs(r,e,n,t)}function m_e(r,e,t){if(oc(r),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var n=gs(r,t);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return bs(r,e,n,t)}function g_e(r,e,t){if(oc(r),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var n=gs(r,t);if(n.length!==4&&n.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return bs(r,e,n,t)}function y_e(r,e,t){if(oc(r),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var n=gs(r,t);if(n.length!==5&&n.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return bs(r,e,n,t)}function b_e(r,e,t){if(oc(r),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var n=gs(r,t);if(n.length!==6&&n.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||n,bs(r,e,n,t)}function w_e(r,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var n=z(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=n.shape[n.shape.length-1];if(e<0)throw new Error("'k' passed to topk() must be >= 0 but got "+e);if(e>a)throw new Error("'k' passed to topk() must be <= the last dimension ("+a+") "+("but got "+e));var i={x:n},o={k:e,sorted:t},s=Le(oe.runKernel(SNe,i,o),2),u=s[0],l=s[1];return{values:u,indices:l}}var x_e=te({topk_:w_e});function k_e(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),n!=null&&n==="bool")throw new Error("Unsupported data type $ { dtype }");for(var i=new zx(e,t,n,!0,a),o=ms(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var S_e=te({truncatedNormal_:k_e});function N_e(r,e){e===void 0&&(e=0);var t=z(r,"x","unique","string_or_numeric");re(t.rank>0,function(){return"The input tensor must be at least 1D"});var n={x:t},a={axis:e},i=Le(oe.runKernel(ENe,n,a),2),o=i[0],s=i[1];return{values:o,indices:s}}var E_e=te({unique_:N_e});function T_e(r,e,t){var n=z(r,"x","unsortedSegmentSum"),a=z(e,"segmentIds","unsortedSegmentSum","int32");re(Bh(t),function(){return"numSegments must be of dtype int"});var i={x:n,segmentIds:a},o={numSegments:t};return oe.runKernel(INe,i,o)}var I_e=te({unsortedSegmentSum_:T_e});function C_e(r,e){e===void 0&&(e=0);var t=z(r,"x","unstack","string_or_numeric");re(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"});var n={value:t},a={axis:e};return oe.runKernel(TNe,n,a)}var Gx=te({unstack_:C_e});function A_e(r,e){return Bx(r,e,"right")}function __e(r,e,t,n){return e===void 0&&(e=!0),oe.makeVariable(r,e,t,n)}function D_e(r,e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(n);for(var a=ms(r,"int32"),i=ms([t.length,r.length],"int32"),n=0;n<t.length;n++){var o=a.indexToLoc(t[n]),s=n*r.length;i.values.set(o,s)}return i.toTensor()}function F_e(r){return Yt(this,void 0,void 0,function(){var e,t,n;return Kt(this,function(a){switch(a.label){case 0:return e=z(r,"condition","whereAsync","bool"),[4,e.data()];case 1:return t=a.sent(),n=D_e(e.shape,t),r!==e&&e.dispose(),[2,n]}})})}var wz=F_e;function R_e(r,e,t){return Yt(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,f,h,p,d,m;return Kt(this,function(v){switch(v.label){case 0:for(n=z(r,"tensor","boolMask"),a=z(e,"mask","boolMask","bool"),i=t??0,o=a.rank,s=n.shape,re(o>0,function(){return"mask cannot be scalar"}),ui(s.slice(i,i+o),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=i;l<i+o;l++)u*=s[l];return c=s.slice(0,i).concat([u],s.slice(i+o)),f=Te(n,c),h=Te(a,[-1]),[4,wz(h)];case 1:return p=v.sent(),d=qx(p,[1]),m=ez(f,d,i),r!==n&&n.dispose(),e!==a&&a.dispose(),d.dispose(),f.dispose(),h.dispose(),p.dispose(),[2,m]}})})}var O_e=R_e;function P_e(r,e){return oe.tidy(r,e)}function M_e(r){var e=$L(r);e.forEach(function(t){return t.dispose()})}function B_e(r,e,t){var n=z(r,"x","transpose");if(e==null&&(e=n.shape.map(function(o,s){return s}).reverse()),re(n.rank===e.length,function(){return"Error in transpose: rank of input "+n.rank+" "+("must match length of perm "+e+".")}),e.forEach(function(o){re(o>=0&&o<n.rank,function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+(" but got "+e)})}),n.rank<=1)return n.clone();var a={x:n},i={perm:e};return n.dtype==="complex64"?P_e(function(){var o=$h(n),s=Hm(n);return o=oe.runKernel(Kw,{x:o},i),s=oe.runKernel(Kw,{x:s},i),t&&(s=Eo(s)),Iu(o,s)}):oe.runKernel(Kw,a,i)}var wx=te({transpose_:B_e});function L_e(r,e,t,n,a){a===void 0&&(a=!0);var i=z(r,"v","movingAverage"),o=z(e,"x","movingAverage"),s=z(t,"decay","movingAverage");XNe(i,o),re(sc(i.shape,o.shape),function(){return"Shape mismatch in v and x"});var u=Ar(1),l=Bt(u,s),c=Ct(Bt(o,i),l);if(a){re(n!=null,function(){return"When using zeroDebias: true, step is required."});var f=z(n,"step","movingAverage");c=In(c,Bt(u,Px(s,f)))}return un(i,c)}var z_e=te({movingAverage_:L_e});function $_e(r,e,t){var n=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+("shape[sliceDim:], got updates.shape: "+t.shape)+(", indices.shape: "+e.shape+", shape: "+r)+(", sliceDim: "+n+", and batchDim: "+a+".");if(t.rank<a)throw new Error(i+(" update.rank < "+a+". "));if(r.length<n+(t.rank-a))throw new Error(i+(" Output shape length < "+(n+(t.rank-a))));if(t.rank!==a+r.length-n)throw new Error(i+(" update.rank != "+(a+r.length-n)));for(var o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+(" updates.shape["+o+"] ("+t.shape[o]+") != indices.shape["+o+"] ("+e.shape[o]+")."));for(var o=0;o<t.rank-a;++o)if(t.shape[o+a]!==r[o+n])throw new Error(i+(" updates.shape["+(o+a)+"] ("+t.shape[o+a]+") != shape["+(o+a)+"] ("+r[o+a]+")"))}function W_e(r,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+(" but the rank was "+e.rank+"."));if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+(" but the rank was "+r.rank+"."));if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(r.size===0)throw new Error("Updates specified for empty output. updates shape: "+r.shape)}$_e(t,e,r)}function q_e(r,e,t){var n=z(r,"indices","scatterND","int32"),a=z(e,"updates","scatterND");W_e(a,n,t);var i={indices:n,updates:a},o={shape:t};return oe.runKernel(XSe,i,o)}var V_e=te({scatterND_:q_e});function G_e(r,e,t,n){if(r.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+(" but the dtype was "+r.dtype+"."));if(r.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+(" but got shape "+r.shape+"."));var a=r.rank>0?r.shape[0]:1,i=r.rank>1?r.shape[1]:1;if(t.length!==i)throw new Error("outputShape has incorrect number of elements:,"+(" "+t.length+", should be: "+i+"."));var o=e.size;if(!(e.rank===0||e.rank===1&&o===a))throw new Error("sparseValues has incorrect shape "+(e.shape+", should be [] or ["+a+"]"));if(e.dtype!==n.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function U_e(r,e,t,n){n===void 0&&(n=0);var a=z(r,"sparseIndices","sparseToDense","int32"),i=z(e,"sparseValues","sparseToDense","string_or_numeric"),o=z(n,"defaultValue","sparseToDense",i.dtype);G_e(a,i,t,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:t};return oe.runKernel(dNe,s,u)}var H_e=te({sparseToDense_:U_e});function K_e(r,e){var t=z(e,"indices","gatherND","int32"),n=z(r,"x","gatherND","string_or_numeric"),a={params:n,indices:t};return oe.runKernel(j2e,a)}var j_e=te({gatherND_:K_e});function X_e(r,e){if(e==null)return r.shape.slice();if(sc(r.shape,e))return e;if(r.shape.length===e.length){for(var t=[],n=0;n<r.shape.length;n++)e[n]==null&&r.shape[n]!=null?t.push(r.shape[n]):t.push(e[n]);return t}return e}function Y_e(r,e,t,n){var a=z(r,"x","dropout");if(re(a.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be "+("scaled, but got a "+a.dtype+" tensor instead.")}),re(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got "+e+"."}),e===0)return r instanceof $n?a.clone():a;var i=X_e(a,t),o=1-e,s=In(QL(un(dz(i,0,1,"float32",n),o)),o);return Ct(a,s)}var Z_e=te({dropout_:Y_e});function xz(r){return Math.floor(Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))))}function Ux(r,e,t){for(var n=1-r%2,a=new Float32Array(r),i=0;i<r;++i){var o=2*Math.PI*i/(r+n-1);a[i]=e-t*Math.cos(o)}return Di(a,"float32")}function J_e(r,e,t){return t===void 0&&(t=1),Yt(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,f,h,p,d,m,v,v;return Kt(this,function(g){switch(g.label){case 0:return n=z(r,"predictions","inTopK"),a=z(e,"targets","inTopK"),re(n.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, "+("but got "+n.rank)}),re(n.rank-1===a.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+(n.rank+" and targets rank "+a.rank)}),ui(n.shape.slice(0,n.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=n.shape[n.shape.length-1],re(t>0&&t<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last "+("dimension ("+i+"), but got "+t)}),[4,n.data()];case 1:return o=g.sent(),[4,a.data()];case 2:for(s=g.sent(),u=Le([o.length/i,i],2),l=u[0],c=u[1],f=Rke("bool",l),h=0;h<l;h++){for(p=h*c,d=o.subarray(p,p+c),m=[],v=0;v<d.length;v++)m.push({value:d[v],index:v});for(m.sort(function(y,b){return b.value-y.value}),f[h]=0,v=0;v<t;v++)if(m[v].index===s[h]){f[h]=1;break}}return r!==n&&n.dispose(),e!==a&&a.dispose(),[2,Vx(f,a.shape,"bool")]}})})}var Q_e=J_e;function eDe(r,e,t,n,a,i,o){i===void 0&&(i="NHWC");var s=r;r.rank===3&&(s=Te(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=Te(e,[1,e.shape[0],e.shape[1],e.shape[2]])),re(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+(s.shape+".")}),re(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+(u.shape+".")}),re(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+(t+".")});var l=i==="NHWC"?s.shape[3]:s.shape[1],c=i==="NHWC"?u.shape[3]:u.shape[1];re(l===t[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must "+("match input depth in filter ("+t[2]+".")}),re(c===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must "+("match output depth for filter ("+t[3]+").")}),Ri("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return oe.runKernel(g2e,f,h)}var tDe=te({conv2DBackpropFilter_:eDe});function Hx(r,e,t){if(t==null||t==="linear")return r;if(t==="relu")return Ct(r,bz(e));throw new Error("Cannot compute gradient for fused activation "+t+".")}function Kx(r,e){var t=e,n=KTe(r.shape,e.shape);return n.length>0&&(t=vr(t,n)),Te(t,r.shape)}function jx(r,e,t,n){if(e==="linear")return r;if(e==="relu")return Km(r);if(e==="elu")return YL(r);if(e==="relu6")return vz(r);if(e==="prelu")return hz(r,t);if(e==="leakyrelu")return rz(r,n);if(e==="sigmoid")return tc(r);throw new Error("Unknown fused activation "+e+".")}var Xx=function(r,e){var t=r>0;return!t||e==="linear"};function rDe(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,l=u===void 0?[1,1]:u,c=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,m=r.leakyreluAlpha;if(p=p||"linear",Xx(oe.state.gradientDepth,p)===!1){re(s==="NHWC",function(){return"Error in fused conv2d: got dataFormat of "+s+" but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."});var v=Wm(t,n,a,i,s,l,c);return f!=null&&(v=un(v,f)),jx(v,p,d,m)}var g=z(t,"x","conv2d","float32"),y=z(n,"filter","conv2d","float32"),b=g,w=!1;g.rank===3&&(w=!0,b=Te(g,[1,g.shape[0],g.shape[1],g.shape[2]])),re(b.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+(b.rank+".")}),re(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+(y.rank+".")}),Ri("fused conv2d",i,c);var x=s==="NHWC"?b.shape[3]:b.shape[1];re(y.shape[2]===x,function(){return"Error in conv2d: depth of input ("+x+") must match "+("input depth for filter "+y.shape[2]+".")}),re(ys(a,l),function(){return"Error in conv2D: Either strides or dilations must be 1. "+("Got strides "+a+" and dilations '"+l+"'")});var k=Fx(b.shape,y.shape,a,l,i,c),N;f!=null&&(N=z(f,"bias","fused conv2d"),e=Le(Mr(N,g),1),N=e[0],s==="NHWC"?ln(k.outShape,N.shape):(re(N.shape.length<=1,function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+("rank-"+N.shape.length+".")}),re(N.shape.length===0||N.shape[0]===k.outChannels||N.shape[0]===1,function(){return"Error in fused conv2d: bias shape ("+N.shape+") is not compatible with the number of output channels "+("("+k.outChannels+")")})));var T;if(d!=null){var I=d.shape;if(re(I.length<=1||I.length===3,function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+("rank-"+I.length+".")}),I.length===1)re(I[0]===1||I[0]===k.outChannels,function(){return"Error in fused conv2d: PReLU activation weights "+("("+I+") is not compatible with the number of output ")+("channels ("+k.outChannels+").")});else if(I.length===3)try{ln(I,k.outShape)}catch{var F="Error in fused conv2d: PReLU activation weights ("+I+") is not compatible with the output shape of the conv2d "+("("+k.outShape+").");throw Error(F)}T=z(d,"prelu weights","fused conv2d")}var D=function(O,V){re(s==="NHWC",function(){return"Error in gradient of fused conv2D: got dataFormat of "+s+" but only NHWC is currently supported."});var K=Le(V,4),Z=K[0],j=K[1],ee=K[2],le=K[3],se=Hx(O,ee,p);re(Rm(l),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+("are not yet supported in gradients. Got dilations '"+l+"'")});var ce=KL(j.shape,se,Z,a,i),he=tDe(j,se,Z.shape,a,i),xe=[ce,he];if(le!=null){var Se=Kx(le,se);xe.push(Se)}return xe},R={x:b,filter:y,bias:N,preluActivationWeights:T},P={strides:a,pad:i,dataFormat:s,dilations:l,dimRoundingMode:c,activation:p,leakyreluAlpha:m};if(f==null){var B=To(function(O,V,K){var Z=oe.runKernel(ZB,R,P);return K([V,O,Z]),w&&(Z=Te(Z,[Z.shape[1],Z.shape[2],Z.shape[3]])),{value:Z,gradFunc:D}});return B(b,y)}else{var q=To(function(O,V,K,Z){var j=oe.runKernel(ZB,R,P);return Z([V,O,j,K]),w&&(j=Te(j,[j.shape[1],j.shape[2],j.shape[3]])),{value:j,gradFunc:D}});return q(b,y,N)}}var nDe=te({fusedConv2d_:rDe});function aDe(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=r;r.rank===3&&(s=Te(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=Te(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var l={x:s,dy:u},c={strides:n,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return oe.runKernel(A2e,l,c)}var iDe=te({depthwiseConv2dNativeBackpropFilter_:aDe});function oDe(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=Te(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var l={dy:s,filter:t},c={strides:n,pad:a,dimRoundingMode:o,dilations:i,inputShape:r},f=oe.runKernel(_2e,l,c);return u?Te(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var sDe=te({depthwiseConv2dNativeBackpropInput_:oDe});function uDe(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,l=u===void 0?[1,1]:u,c=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,m=r.leakyreluAlpha;if(Xx(oe.state.gradientDepth,p)===!1){var v=Rx(t,n,a,i,s,l,c);return f!=null&&(v=un(v,f)),jx(v,p,d,m)}var g=z(t,"x","depthwiseConv2d","float32"),y=z(n,"filter","depthwiseConv2d","float32"),b=g,w=!1;g.rank===3&&(w=!0,b=Te(g,[1,g.shape[0],g.shape[1],g.shape[2]])),re(b.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+("rank "+b.rank+".")}),re(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+("but got rank "+y.rank+".")}),re(b.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels "+("("+b.shape[3]+") must match the inChannels dimension in ")+("filter "+y.shape[2]+".")}),l==null&&(l=[1,1]),re(ys(a,l),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+("be 1. Got strides "+a+" and dilations '"+l+"'")}),Ri("fused depthwiseConv2d",i,c);var x=Fx(b.shape,y.shape,a,l,i,c,!0),k;f!=null&&(k=z(f,"bias","fused conv2d"),e=Le(Mr(k,g),1),k=e[0],ln(x.outShape,k.shape));var N;d!=null&&(N=z(d,"prelu weights","fused depthwiseConv2d"));var T=function(P,B){re(Rm(l),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+("'"+l+"'")});var q=Le(B,4),O=q[0],V=q[1],K=q[2],Z=q[3],j=Hx(P,K,p),ee=sDe(V.shape,j,O,a,i,l,c),le=iDe(V,j,O.shape,a,i,l,c);if(Z!=null){var se=Kx(k,j);return[ee,le,se]}return[ee,le]},I={x:b,filter:y,bias:k,preluActivationWeights:N},F={strides:a,pad:i,dataFormat:s,dilations:l,dimRoundingMode:c,activation:p,leakyreluAlpha:m};if(f==null){var D=To(function(P,B,q){var O=oe.runKernel(JB,I,F);return q([B,P,O]),w&&(O=Te(O,[O.shape[1],O.shape[2],O.shape[3]])),{value:O,gradFunc:T}});return D(b,y)}else{var R=To(function(P,B,q,O){var V=oe.runKernel(JB,I,F);return O([B,P,V,q]),w&&(V=Te(V,[V.shape[1],V.shape[2],V.shape[3]])),{value:V,gradFunc:T}});return R(b,y,k)}}var lDe=te({fusedDepthwiseConv2d_:uDe});function cDe(r){var e,t,n=r.a,a=r.b,i=r.transposeA,o=i===void 0?!1:i,s=r.transposeB,u=s===void 0?!1:s,l=r.bias,c=r.activation,f=c===void 0?"linear":c,h=r.preluActivationWeights,p=r.leakyreluAlpha,d=p===void 0?.2:p;if(Xx(oe.state.gradientDepth,f)===!1){var m=Ht(n,a,o,u);return l!=null&&(m=un(m,l)),jx(m,f,h,d)}var v=z(n,"a","fused matMul"),g=z(a,"b","fused matMul");e=Le(Mr(v,g),2),v=e[0],g=e[1];var y=o?v.shape[v.rank-2]:v.shape[v.rank-1],b=u?g.shape[g.rank-1]:g.shape[g.rank-2],w=o?v.shape[v.rank-1]:v.shape[v.rank-2],x=u?g.shape[g.rank-2]:g.shape[g.rank-1],k=v.shape.slice(0,-2),N=g.shape.slice(0,-2),T=qn(k),I=qn(N);re(y===b,function(){return"Error in fused matMul: inner shapes ("+y+") and ("+(b+") of Tensors with shapes "+v.shape+" and ")+(g.shape+" and transposeA="+o)+(" and transposeB="+u+" must match.")});var F=ln(v.shape.slice(0,-2),g.shape.slice(0,-2)),D=F.concat([w,x]),R=o?Te(v,[T,y,w]):Te(v,[T,w,y]),P=u?Te(g,[I,x,b]):Te(g,[I,b,x]),B;l!=null&&(B=z(l,"bias","fused matMul"),t=Le(Mr(B,v),1),B=t[0],ln(D,B.shape));var q;h!=null&&(q=z(h,"prelu weights","fused matMul"));var O=function(ee,le){var se=Le(le,4),ce=se[0],he=se[1],xe=se[2],Se=se[3],we=Hx(Te(ee,xe.shape),xe,f),ke,Ne;if(!o&&!u?(ke=Ht(we,he,!1,!0),Ne=Ht(ce,we,!0,!1)):!o&&u?(ke=Ht(we,he,!1,!1),Ne=Ht(we,ce,!0,!1)):o&&!u?(ke=Ht(he,we,!1,!0),Ne=Ht(ce,we,!1,!1)):(ke=Ht(he,we,!0,!0),Ne=Ht(we,ce,!0,!0)),l!=null){var Ae=Kx(Se,we);return[ke,Ne,Ae]}else return[ke,Ne]},V={a:R,b:P,bias:B,preluActivationWeights:q},K={transposeA:o,transposeB:u,activation:f,leakyreluAlpha:d};if(l==null){var Z=To(function(ee,le,se){var ce=oe.runKernel(YB,V,K);return se([ee,le,ce]),{value:Te(ce,D),gradFunc:O}});return Z(R,P)}else{var j=To(function(ee,le,se,ce){var he=oe.runKernel(YB,V,K);return ce([ee,le,he,se]),{value:Te(he,D),gradFunc:O}});return j(R,P,B)}}var fDe=te({fusedMatMul_:cDe});var hDe={__proto__:null,conv2d:nDe,depthwiseConv2d:lDe,matMul:fDe};function pDe(r){return Ux(r,.54,.46)}var dDe=te({hammingWindow_:pDe});function vDe(r){return Ux(r,.5,.5)}var kz=te({hannWindow_:vDe});function mDe(r,e,t,n,a){n===void 0&&(n=!1),a===void 0&&(a=0);for(var i=0,o=[];i+e<=r.size;)o.push(Er(r,i,e)),i+=t;if(n)for(;i<r.size;){var s=i+e-r.size,u=pa([Er(r,i,e-s),$m([s],a)]);o.push(u),i+=t}return o.length===0?Mh([],[0,e]):Te(pa(o),[o.length,e])}var Sz=te({frame_:mDe});function gDe(r,e,t,n,a){a===void 0&&(a=kz),n==null&&(n=xz(e));var i=Sz(r,e,t),o=Ct(i,a(e));return Wx(o,n)}var yDe=te({stft_:gDe});function bDe(r,e,t,n,a,i){a===void 0&&(a="bilinear"),i===void 0&&(i=0);var o=z(r,"image","cropAndResize"),s=z(e,"boxes","cropAndResize","float32"),u=z(t,"boxInd","cropAndResize","int32"),l=s.shape[0];re(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,"+("but got rank "+o.rank+".")}),re(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] "+("but had shape "+s.shape+".")}),re(u.rank===1&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] "+("but had shape "+s.shape+".")}),re(n.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+("length "+n.length+".")}),re(n[0]>=1&&n[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+n}),re(a==="bilinear"||a==="nearest",function(){return"method must be bilinear or nearest, but was "+a});var c={image:o,boxes:s,boxInd:u},f={method:a,extrapolationValue:i,cropSize:n},h=oe.runKernel(E2e,c,f);return h}var wDe=te({cropAndResize_:bDe});function xDe(r){var e=z(r,"image","flipLeftRight","float32");re(e.rank===4,function(){return"Error in flipLeftRight: image must be rank 4,"+("but got rank "+e.rank+".")});var t={image:e},n=oe.runKernel(V2e,t,{});return n}var kDe=te({flipLeftRight_:xDe});function SDe(r){var e=z(r,"image","grayscaleToRGB"),t=e.rank-1,n=e.shape[t];re(e.rank>=2,function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+("but got rank "+e.rank+".")}),re(n===1,function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+("should be size 1, but got size "+n+".")});var a=new Array(e.rank);return a.fill(1,0,t),a[t]=3,Ph(e,a)}var NDe=te({grayscaleToRGB_:SDe});function EDe(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=.5);var a=z(r,"image","rotateWithOffset","float32");re(a.rank===4,function(){return"Error in rotateWithOffset: image must be rank 4,"+("but got rank "+a.rank+".")});var i={image:a},o={radians:e,fillValue:t,center:n},s=oe.runKernel(_Ne,i,o);return s}var TDe=te({rotateWithOffset_:EDe});function uc(r,e,t,n,a,i){n==null&&(n=.5),a==null&&(a=Number.NEGATIVE_INFINITY),i==null&&(i=0);var o=r.shape[0];return t=Math.min(t,o),re(0<=n&&n<=1,function(){return"iouThreshold must be in [0, 1], but was '"+n+"'"}),re(r.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+r.rank+"'"}),re(r.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+r.shape[1]}),re(e.rank===1,function(){return"scores must be a 1D tensor"}),re(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected "+o+", "+("but was "+e.shape[0])}),re(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+i+"'"}),{maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i}}function IDe(r,e,t,n,a){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var i=z(r,"boxes","nonMaxSuppression","float32"),o=z(e,"scores","nonMaxSuppression","float32"),s=uc(i,o,t,n,a);t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:n,scoreThreshold:a};return oe.runKernel(TSe,{boxes:i,scores:o},u)}var CDe=te({nonMaxSuppression_:IDe});function ADe(r,e,t){var n=_De(r,e,t),a=n<0?-(n+1):n;r.splice(a,0,e)}function _De(r,e,t){return FDe(r,e,t||DDe)}function DDe(r,e){return r>e?1:r<e?-1:0}function FDe(r,e,t){for(var n=0,a=r.length,i=0,o=!1;n<a;){i=n+(a-n>>>1);var s=t(e,r[i]);s>0?n=i+1:(a=i,o=!s)}return o?n:-n-1}function RDe(r,e,t,n,a){return Yx(r,e,t,n,a,0)}function ODe(r,e,t,n,a,i){return Yx(r,e,t,n,a,0,!1,i,!0)}function PDe(r,e,t,n,a,i){return Yx(r,e,t,n,a,i,!0)}function Yx(r,e,t,n,a,i,o,s,u){o===void 0&&(o=!1),s===void 0&&(s=!1),u===void 0&&(u=!1);for(var l=[],c=0;c<e.length;c++)e[c]>a&&l.push({score:e[c],boxIndex:c,suppressBeginIndex:0});l.sort(hL);for(var f=i>0?-.5/i:0,h=[],p=[];h.length<t&&l.length>0;){var d=l.pop(),m=d.score,v=d.boxIndex,g=d.suppressBeginIndex;if(m<a)break;for(var y=!1,b=h.length-1;b>=g;--b){var w=MDe(r,v,h[b]);if(w>=n){y=!0;break}if(d.score=d.score*BDe(n,f,w),d.score<=a)break}d.suppressBeginIndex=h.length,y||(d.score===m?(h.push(v),p.push(d.score)):d.score>a&&ADe(l,d,hL))}var x=h.length,k=t-x;s&&k>0&&(h.push.apply(h,pn(new Array(k).fill(0))),p.push.apply(p,pn(new Array(k).fill(0))));var N={selectedIndices:h};return o&&(N.selectedScores=p),u&&(N.validOutputs=x),N}function MDe(r,e,t){var n=r.subarray(e*4,e*4+4),a=r.subarray(t*4,t*4+4),i=Math.min(n[0],n[2]),o=Math.min(n[1],n[3]),s=Math.max(n[0],n[2]),u=Math.max(n[1],n[3]),l=Math.min(a[0],a[2]),c=Math.min(a[1],a[3]),f=Math.max(a[0],a[2]),h=Math.max(a[1],a[3]),p=(s-i)*(u-o),d=(f-l)*(h-c);if(p<=0||d<=0)return 0;var m=Math.max(i,l),v=Math.max(o,c),g=Math.min(s,f),y=Math.min(u,h),b=Math.max(g-m,0)*Math.max(y-v,0);return b/(p+d-b)}function BDe(r,e,t){var n=Math.exp(e*t*t);return t<=r?n:0}function hL(r,e){return r.score-e.score||r.score===e.score&&e.boxIndex-r.boxIndex}function LDe(r,e,t,n,a){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),Yt(this,void 0,void 0,function(){var i,o,s,u,l,c,f;return Kt(this,function(h){switch(h.label){case 0:return i=z(r,"boxes","nonMaxSuppressionAsync"),o=z(e,"scores","nonMaxSuppressionAsync"),s=uc(i,o,t,n,a),t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold,[4,Promise.all([i.data(),o.data()])];case 1:return u=h.sent(),l=u[0],c=u[1],f=RDe(l,c,t,n,a).selectedIndices,i!==r&&i.dispose(),o!==e&&o.dispose(),[2,Di(f,"int32")]}})})}var zDe=LDe;function $De(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var o=z(r,"boxes","nonMaxSuppression"),s=z(e,"scores","nonMaxSuppression"),u=uc(o,s,t,n,a,i);t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma;var l={boxes:o,scores:s},c={maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i},f=oe.runKernel(CSe,l,c);return{selectedIndices:f[0],selectedScores:f[1]}}var WDe=te({nonMaxSuppressionWithScore_:$De});function qDe(r,e,t,n,a,i){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),Yt(this,void 0,void 0,function(){var o,s,u,l,c,f,h,p,d;return Kt(this,function(m){switch(m.label){case 0:return o=z(r,"boxes","nonMaxSuppressionAsync"),s=z(e,"scores","nonMaxSuppressionAsync"),u=uc(o,s,t,n,a,i),t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return l=m.sent(),c=l[0],f=l[1],h=PDe(c,f,t,n,a,i),p=h.selectedIndices,d=h.selectedScores,o!==r&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:Di(p,"int32"),selectedScores:Di(d)}]}})})}var VDe=qDe;function GDe(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1);var o=z(r,"boxes","nonMaxSuppression"),s=z(e,"scores","nonMaxSuppression"),u=uc(o,s,t,n,a,null),l=u.maxOutputSize,c=u.iouThreshold,f=u.scoreThreshold,h={boxes:o,scores:s},p={maxOutputSize:l,iouThreshold:c,scoreThreshold:f,padToMaxOutputSize:i},d=oe.runKernel(ISe,h,p);return{selectedIndices:d[0],validOutputs:d[1]}}var UDe=te({nonMaxSuppressionPadded_:GDe});function HDe(r,e,t,n,a,i){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1),Yt(this,void 0,void 0,function(){var o,s,u,l,c,f,h,p,d,m,v,g;return Kt(this,function(y){switch(y.label){case 0:return o=z(r,"boxes","nonMaxSuppressionAsync"),s=z(e,"scores","nonMaxSuppressionAsync"),u=uc(o,s,t,n,a,null),l=u.maxOutputSize,c=u.iouThreshold,f=u.scoreThreshold,[4,Promise.all([o.data(),s.data()])];case 1:return h=Le.apply(void 0,[y.sent(),2]),p=h[0],d=h[1],m=ODe(p,d,l,c,f,i),v=m.selectedIndices,g=m.validOutputs,o!==r&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:Di(v,"int32"),validOutputs:Ar(g,"int32")}]}})})}var KDe=HDe;function jDe(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=z(r,"images","resizeBilinear");re(a.rank===3||a.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+("rank "+a.rank+".")}),re(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+(e+".")}),re(n===!1||t===!1,function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=Te(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Le(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},l=oe.runKernel(GSe,s,u);return o?Te(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var XDe=te({resizeBilinear_:jDe});function YDe(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=z(r,"images","resizeNearestNeighbor");re(a.rank===3||a.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+("rank "+a.rank+".")}),re(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+(e+".")}),re(a.dtype==="float32"||a.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"}),re(n===!1||t===!1,function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=Te(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Le(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},l=oe.runKernel(VSe,s,u);return o?Te(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var ZDe=te({resizeNearestNeighbor_:YDe});function JDe(r,e,t,n){var a;e===void 0&&(e="binary"),t===void 0&&(t=!1),n===void 0&&(n=.5);var i=z(r,"image","threshold"),o=.2989,s=.587,u=.114,l=i.shape[0]*i.shape[1],c=Ct(Di([n]),255),f,h,p,d;if(re(i.rank===3,function(){return"Error in threshold: image must be rank 3,"+("but got rank "+i.rank+".")}),re(i.shape[2]===3||i.shape[2]===1,function(){return"Error in threshold: image color channel must be equal to 3 or 1"+("but got "+i.shape[2]+".")}),re(i.dtype==="int32"||i.dtype==="float32",function(){return"Error in dtype: image dtype must be int32 or float32,"+("but got dtype "+i.dtype+".")}),re(e==="otsu"||e==="binary",function(){return"Method must be binary or otsu, but was "+e}),i.shape[2]===3){a=Le(Wh(i,[1,1,1],-1),3),f=a[0],h=a[1],p=a[2];var m=Ct(f,o),v=Ct(h,s),g=Ct(p,u);d=un(un(m,v),g)}else d=r;if(e==="otsu"){var y=HL(dn(mz(d),"int32"),Vx([]),256);c=QDe(y,l)}var b=t?Mx(d,c):Um(d,c),w=dn(Ct(b,255),"int32");return w}function QDe(r,e){for(var t=Di([-1]),n=Di([0]),a=Di([0]),i,o,s,u,l,c,f=0;f<r.size-1;f++){i=Er(r,0,f+1),o=Er(r,f+1),l=In(vr(i),e),c=In(vr(o),e);var h=vr(Ct(i,zh(0,i.size)));s=In(h,vr(i));var p=$m(o.shape,i.size),d=un(zh(0,o.size),p),m=Ct(o,d);u=In(vr(m),vr(o));var v=Bt(s,u),g=Bt(s,u),y=Ct(l,c);a=Ct(Ct(y,v),g);var b=Um(a,n);n=ac(b,a,n),t=ac(b,Di([f]),t)}return t}var e3e=te({threshold_:JDe});function t3e(r,e,t,n,a,i){t===void 0&&(t="nearest"),n===void 0&&(n="constant"),a===void 0&&(a=0);var o=z(r,"image","transform","float32"),s=z(e,"transforms","transform","float32");re(o.rank===4,function(){return"Error in transform: image must be rank 4,"+("but got rank "+o.rank+".")}),re(s.rank===2&&(s.shape[0]===o.shape[0]||s.shape[0]===1)&&s.shape[1]===8,function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"}),re(i==null||i.length===2,function(){return"Error in transform: outputShape must be [height, width] or null, "+("but got "+i+".")});var u={image:o,transforms:s},l={interpolation:t,fillMode:n,fillValue:a,outputShape:i};return oe.runKernel(NNe,u,l)}var r3e=te({transform_:t3e});function n3e(r,e,t){re(e%1===0,function(){return"bandPart(): numLower must be an integer, got "+e+"."}),re(t%1===0,function(){return"bandPart(): numUpper must be an integer, got "+t+"."});var n=z(r,"a","bandPart");re(n.rank>=2,function(){return"bandPart(): Rank must be at least 2, got "+n.rank+"."});var a=n.shape,i=Le(n.shape.slice(-2),2),o=i[0],s=i[1];if(!(e<=o))throw new Error("bandPart(): numLower ("+e+")"+(" must not be greater than the number of rows ("+o+")."));if(!(t<=s))throw new Error("bandPart(): numUpper ("+t+")"+(" must not be greater than the number of columns ("+s+")."));e<0&&(e=o),t<0&&(t=s);var u=Te(zh(0,o,1,"int32"),[-1,1]),l=zh(0,s,1,"int32"),c=Bt(u,l),f=Om(Mx(c,Ar(+e,"int32")),tz(c,Ar(-t,"int32"))),h=ic([o,s],n.dtype);return Te(qh(Gx(Te(n,[-1,o,s])).map(function(p){return ac(f,p,h)})),a)}var a3e=te({bandPart_:n3e});function i3e(r){var e;if(Array.isArray(r)){e=!1,re(r!=null&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=r[0].shape[0],n=function(u){re(r[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+("("+r[u].shape[0]+" vs. "+t+")")})},a=1;a<r.length;++a)n(a)}else e=!0,r=Wh(r,r.shape[0],0).map(function(u){return qx(u,[0])});re(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+r.length+") exceeds "+("number of dimensions ("+r[0].shape[0]+").")});for(var i=[],o=r,s=function(u){i.push(oe.tidy(function(){var l=o[u];if(u>0)for(var c=0;c<u;++c){var f=Ct(vr(Ct(i[c],l)),i[c]);l=Bt(l,f)}return In(l,Gm(l,"euclidean"))}))},a=0;a<r.length;++a)s(a);return e?qh(i,0):i}var o3e=te({gramSchmidt_:i3e});function s3e(r,e){if(e===void 0&&(e=!1),re(r.rank>=2,function(){return"qr() requires input tensor to have a rank >= 2, but got rank "+r.rank}),r.rank===2)return pL(r,e);var t=r.shape.slice(0,r.shape.length-2).reduce(function(u,l){return u*l}),n=Gx(Te(r,[t,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),a=[],i=[];n.forEach(function(u){var l=Le(pL(u,e),2),c=l[0],f=l[1];a.push(c),i.push(f)});var o=Te(qh(a,0),r.shape),s=Te(qh(i,0),r.shape);return[o,s]}function pL(r,e){return e===void 0&&(e=!1),oe.tidy(function(){re(r.shape.length===2,function(){return"qr2d() requires a 2D Tensor, but got a "+r.shape.length+"D Tensor."});for(var t=r.shape[0],n=r.shape[1],a=JL(t),i=ec(r),o=Mh([[1]],[1,1]),s=ec(o),u=t>=n?n:t,l=function(f){var h,p=i,d=s,m=a;h=Le(oe.tidy(function(){var v=Er(i,[f,f],[t-f,1]),g=Gm(v),y=Er(i,[f,f],[1,1]),b=ac(Um(y,0),Mh([[-1]]),Mh([[1]])),w=Bt(y,Ct(b,g)),x=In(v,w);x.shape[0]===1?s=ec(o):s=pa([o,Er(x,[1,0],[x.shape[0]-1,x.shape[1]])],0);var k=Eo(In(Ht(b,w),g)),N=Er(i,[f,0],[t-f,n]),T=Ct(k,s),I=wx(s);if(f===0)i=Bt(N,Ht(T,Ht(I,N)));else{var F=Bt(N,Ht(T,Ht(I,N)));i=pa([Er(i,[0,0],[f,n]),F],0)}var D=wx(T),R=Er(a,[0,f],[t,a.shape[1]-f]);if(f===0)a=Bt(R,Ht(Ht(R,s),D));else{var P=Bt(R,Ht(Ht(R,s),D));a=pa([Er(a,[0,0],[t,f]),P],1)}return[s,i,a]}),3),s=h[0],i=h[1],a=h[2],M_e([p,d,m])},c=0;c<u;++c)l(c);return!e&&t>n&&(a=Er(a,[0,0],[t,n]),i=Er(i,[0,0],[n,n])),[a,i]})}var u3e=te({qr_:s3e});var Wn;(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Wn||(Wn={}));function l3e(r,e,t){t===void 0&&(t=Wn.SUM_BY_NONZERO_WEIGHTS);var n=z(r,"losses","computeWeightedLoss"),a=null;e!=null&&(a=z(e,"weights","computeWeightedLoss"));var i=a==null?n:Ct(n,a);if(t===Wn.NONE)return i;if(t===Wn.SUM)return vr(i);if(t===Wn.MEAN){if(a==null)return Pm(i);var o=n.size/a.size,s=In(vr(i),vr(a));return o>1?In(s,Ar(o)):s}if(t===Wn.SUM_BY_NONZERO_WEIGHTS){if(a==null)return In(vr(i),Ar(n.size));var u=Ct(a,Tu(n.shape)),l=dn(vr(cz(u,Ar(0))),"float32");return In(vr(i),l)}throw Error("Unknown reduction: "+t)}var Io=te({computeWeightedLoss_:l3e});function c3e(r,e,t,n){n===void 0&&(n=Wn.SUM_BY_NONZERO_WEIGHTS);var a=z(r,"labels","absoluteDifference"),i=z(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=z(t,"weights","absoluteDifference")),ui(a.shape,i.shape,"Error in absoluteDifference: ");var s=ri(Bt(a,i));return Io(s,o,n)}var f3e=te({absoluteDifference_:c3e});function h3e(r,e,t,n,a){a===void 0&&(a=Wn.SUM_BY_NONZERO_WEIGHTS);var i=z(r,"labels","cosineDistance"),o=z(e,"predictions","cosineDistance"),s=null;n!=null&&(s=z(n,"weights","cosineDistance")),ui(i.shape,o.shape,"Error in cosineDistance: ");var u=Ar(1),l=Bt(u,vr(Ct(i,o),t,!0));return Io(l,s,a)}var p3e=te({cosineDistance_:h3e});function d3e(r,e,t,n){n===void 0&&(n=Wn.SUM_BY_NONZERO_WEIGHTS);var a=z(r,"labels","hingeLoss"),i=z(e,"predictions","hingeLoss"),o=null;t!=null&&(o=z(t,"weights","hingeLoss")),ui(a.shape,i.shape,"Error in hingeLoss: ");var s=Ar(1);a=Bt(Ct(Ar(2),a),s);var u=Km(Bt(s,Ct(a,i)));return Io(u,o,n)}var v3e=te({hingeLoss_:d3e});function m3e(r,e,t,n,a){n===void 0&&(n=1),a===void 0&&(a=Wn.SUM_BY_NONZERO_WEIGHTS);var i=z(r,"labels","huberLoss"),o=z(e,"predictions","huberLoss"),s=null;t!=null&&(s=z(t,"weights","huberLoss")),ui(i.shape,o.shape,"Error in huberLoss: ");var u=Ar(n),l=ri(Bt(o,i)),c=lz(l,u),f=Bt(l,c),h=un(Ct(Ar(.5),Vm(c)),Ct(u,f));return Io(h,s,a)}var g3e=te({huberLoss_:m3e});function y3e(r,e,t,n,a){n===void 0&&(n=1e-7),a===void 0&&(a=Wn.SUM_BY_NONZERO_WEIGHTS);var i=z(r,"labels","logLoss"),o=z(e,"predictions","logLoss"),s=null;t!=null&&(s=z(t,"weights","logLoss")),ui(i.shape,o.shape,"Error in logLoss: ");var u=Ar(1),l=Ar(n),c=Eo(Ct(i,Lh(un(o,l)))),f=Ct(Bt(u,i),Lh(un(Bt(u,o),l))),h=Bt(c,f);return Io(h,s,a)}var b3e=te({logLoss_:y3e});function w3e(r,e,t,n){n===void 0&&(n=Wn.SUM_BY_NONZERO_WEIGHTS);var a=z(r,"labels","meanSquaredError"),i=z(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=z(t,"weights","meanSquaredError")),ui(a.shape,i.shape,"Error in meanSquaredError: ");var s=yz(a,i);return Io(s,o,n)}var x3e=te({meanSquaredError_:w3e});function k3e(r,e){var t=z(r,"labels","sigmoidCrossEntropyWithLogits"),n=z(e,"logits","sigmoidCrossEntropyWithLogits");ui(t.shape,n.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=Km(n),i=Ct(n,t),o=nz(Cu(Eo(ri(n))));return un(Bt(a,i),o)}function S3e(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=Wn.SUM_BY_NONZERO_WEIGHTS);var i=z(r,"multiClassLabels","sigmoidCrossEntropy"),o=z(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=z(t,"weights","sigmoidCrossEntropy")),ui(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),n>0){var u=Ar(n),l=Ar(1),c=Ar(.5);i=un(Ct(i,Bt(l,u)),Ct(c,u))}var f=k3e(i,o);return Io(f,s,a)}var N3e=te({sigmoidCrossEntropy_:S3e});function E3e(r,e,t){if(t===void 0&&(t=-1),t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+("supported. Labels / logits was rank "+e.rank+" ")+("and dim was "+t));var n=To(function(a,i,o){var s=!0,u=iz(i,[t],s),l=Bt(dn(i,"float32"),u);o([a,l]);var c=Eo(Ct(l,a)),f=vr(c,[t]),h=function(p,d){var m=Le(d,2),v=m[0],g=m[1],y=qm(p.shape,[t]);return[Ct(Te(p,y),Bt(dn(v,"float32"),Cu(g))),Ct(Te(p,y),Bt(Cu(g),dn(v,"float32")))]};return{value:f,gradFunc:h}});return n(r,e)}function T3e(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=Wn.SUM_BY_NONZERO_WEIGHTS);var i=z(r,"onehotLabels","softmaxCrossEntropy"),o=z(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=z(t,"weights","softmaxCrossEntropy")),ui(i.shape,o.shape,"Error in softmaxCrossEntropy: "),n>0){var u=Ar(n),l=Ar(1),c=Ar(i.shape[1]);i=un(Ct(i,Bt(l,u)),In(u,c))}var f=E3e(i,o);return Io(f,s,a)}var I3e=te({softmaxCrossEntropy_:T3e});function C3e(r,e,t,n){var a=z(r,"indices","sparseFillEmptyRows","int32"),i=z(e,"values","sparseFillEmptyRows"),o=z(t,"denseShape","sparseFillEmptyRows","int32"),s=z(n,"defaultValue","sparseFillEmptyRows",i.dtype);if(a.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        `+a.shape);if(i.rank!==1)throw new Error("Values should be Tensor1D but received shape "+i.shape);if(o.rank!==1)throw new Error("Dense shape should be Tensor1D but received shape "+o.shape);if(s.rank!==0)throw new Error("Default value should be a scalar but received shape "+s.shape);var u={indices:a,values:i,denseShape:o,defaultValue:s},l=oe.runKernel(cNe,u);return{outputIndices:l[0],outputValues:l[1],emptyRowIndicator:l[2],reverseIndexMap:l[3]}}var A3e=te({sparseFillEmptyRows_:C3e});function _3e(r,e,t){var n=z(r,"inputIndices","sparseReshape","int32"),a=z(e,"inputShape","sparseReshape","int32"),i=z(t,"newShape","sparseReshape","int32");if(n.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        `+n.shape);if(a.rank!==1)throw new Error("Input shape should be Tensor1D but received shape "+a.shape);if(i.rank!==1)throw new Error("New shape should be Tensor1D but received shape "+i.shape);var o={inputIndices:n,inputShape:a,newShape:i},s=oe.runKernel(fNe,o);return{outputIndices:s[0],outputShape:s[1]}}var D3e=te({sparseReshape_:_3e});function F3e(r,e,t){var n=z(r,"data","sparseSegmentMean"),a=z(e,"indices","sparseSegmentMean","int32"),i=z(t,"segmentIds","sparseSegmentMean","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          `+a.shape);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          `+i.shape);var o={data:n,indices:a,segmentIds:i};return oe.runKernel(hNe,o)}var R3e=te({sparseSegmentMean_:F3e});function O3e(r,e,t){var n=z(r,"data","sparseSegmentSum"),a=z(e,"indices","sparseSegmentSum","int32"),i=z(t,"segmentIds","sparseSegmentSum","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         `+a.shape);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         `+i.shape);var o={data:n,indices:a,segmentIds:i};return oe.runKernel(pNe,o)}var P3e=te({sparseSegmentSum_:O3e});function M3e(r,e,t,n,a,i,o,s){var u=z(r,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error("Data must be a vector, saw: "+u.shape);var l=z(e,"dataSplits","stringNGrams");if(l.dtype!=="int32")throw new Error("Data splits must be of datatype int32");var c={separator:t,nGramWidths:n,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},f={data:u,dataSplits:l},h=oe.runKernel(gNe,f,c);return{nGrams:h[0],nGramsSplits:h[1]}}var B3e=te({stringNGrams_:M3e});function L3e(r,e,t){t===void 0&&(t=!0);var n=z(r,"input","stringSplit","string"),a=z(e,"delimiter","stringSplit","string");if(n.rank!==1)throw new Error("Input should be Tensor1D but received shape "+n.shape);if(a.rank!==0)throw new Error("Delimiter should be a scalar but received shape "+a.shape);var i={skipEmpty:t},o={input:n,delimiter:a},s=oe.runKernel(yNe,o,i);return{indices:s[0],values:s[1],shape:s[2]}}var z3e=te({stringSplit_:L3e});function $3e(r,e){var t=z(r,"input","stringToHashBucketFast","string"),n={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");var a={input:t};return oe.runKernel(bNe,a,n)}var W3e=te({stringToHashBucketFast_:$3e});var q3e={fft:$x,ifft:Mm,rfft:Wx,irfft:gz},V3e={hammingWindow:dDe,hannWindow:kz,frame:Sz,stft:yDe},G3e={flipLeftRight:kDe,grayscaleToRGB:NDe,resizeNearestNeighbor:ZDe,resizeBilinear:XDe,rotateWithOffset:TDe,cropAndResize:wDe,nonMaxSuppression:CDe,nonMaxSuppressionAsync:zDe,nonMaxSuppressionWithScore:WDe,nonMaxSuppressionWithScoreAsync:VDe,nonMaxSuppressionPadded:UDe,nonMaxSuppressionPaddedAsync:KDe,threshold:e3e,transform:r3e},U3e={bandPart:a3e,gramSchmidt:o3e,qr:u3e},H3e={absoluteDifference:f3e,computeWeightedLoss:Io,cosineDistance:p3e,hingeLoss:v3e,huberLoss:g3e,logLoss:b3e,meanSquaredError:x3e,sigmoidCrossEntropy:N3e,softmaxCrossEntropy:I3e},K3e={sparseFillEmptyRows:A3e,sparseReshape:D3e,sparseSegmentMean:R3e,sparseSegmentSum:P3e},j3e={stringNGrams:B3e,stringSplit:z3e,stringToHashBucketFast:W3e};var yn={__proto__:null,abs:ri,acos:rEe,acosh:aEe,add:un,addN:sEe,all:lEe,any:fEe,argMax:pEe,argMin:vEe,asin:gEe,asinh:bEe,atan:xEe,atan2:SEe,atanh:EEe,avgPool:GL,avgPool3d:OEe,basicLSTMCell:VEe,batchToSpaceND:UL,batchNorm:zm,batchNorm2d:jEe,batchNorm3d:YEe,batchNorm4d:JEe,bincount:HL,broadcastArgs:tTe,broadcastTo:Em,buffer:ms,cast:dn,ceil:aTe,clipByValue:oTe,clone:ec,complex:Iu,concat:pa,concat1d:lTe,concat2d:fTe,concat3d:pTe,concat4d:vTe,conv1d:yTe,conv2d:Wm,conv2dTranspose:xTe,conv3d:STe,conv3dTranspose:ITe,cos:ATe,cosh:DTe,cumprod:RTe,cumsum:PTe,denseBincount:BTe,depthToSpace:zTe,depthwiseConv2d:Rx,diag:qTe,dilation2d:GTe,div:In,divNoNan:JTe,dot:eIe,einsum:rIe,elu:YL,equal:XL,erf:iIe,euclideanNorm:vIe,exp:Cu,expandDims:Nu,expm1:bIe,eye:JL,fill:$m,floor:QL,floorDiv:jL,gather:ez,greater:Um,greaterEqual:tz,imag:Hm,isFinite:CIe,isInf:_Ie,isNaN:FIe,leakyRelu:rz,less:PIe,lessEqual:Mx,linspace:BIe,localResponseNormalization:zIe,log:Lh,log1p:nz,logSigmoid:UIe,logSoftmax:jIe,logSumExp:iz,logicalAnd:Om,logicalNot:oz,logicalOr:sz,logicalXor:eCe,lowerBound:rCe,matMul:Ht,max:rc,maxPool:uz,maxPool3d:iCe,maxPoolWithArgmax:sCe,maximum:lCe,mean:Pm,meshgrid:fCe,min:yx,minimum:lz,mirrorPad:dCe,mod:mCe,moments:yCe,mul:Ct,multiRNNCell:wCe,multinomial:kCe,neg:Eo,notEqual:cz,oneHot:ECe,ones:Tu,onesLike:ICe,outerProduct:ACe,pad:Vh,pad1d:FCe,pad2d:OCe,pad3d:MCe,pad4d:LCe,pool:VCe,pow:Px,prelu:hz,print:UCe,prod:KCe,raggedGather:XCe,raggedTensorToTensor:ZCe,rand:QCe,randomGamma:pAe,randomNormal:pz,randomStandardNormal:mAe,randomUniform:dz,range:zh,real:$h,reciprocal:wAe,relu:Km,relu6:vz,reshape:Te,reverse:Au,reverse1d:EAe,reverse2d:IAe,reverse3d:AAe,reverse4d:DAe,round:mz,rsqrt:OAe,scalar:Ar,selu:MAe,separableConv2d:LAe,setdiff1dAsync:$Ae,sigmoid:tc,sign:qAe,sin:GAe,sinh:HAe,slice:Er,slice1d:jAe,slice2d:YAe,slice3d:JAe,slice4d:e_e,softmax:r_e,softplus:az,spaceToBatchND:fz,fft:$x,ifft:Mm,irfft:gz,rfft:Wx,split:Wh,sqrt:bx,square:Vm,squaredDifference:yz,squeeze:qx,stack:qh,step:bz,stridedSlice:p_e,sub:Bt,sum:vr,tan:v_e,tanh:gx,tensor:Vx,tensor1d:Di,tensor2d:Mh,tensor3d:m_e,tensor4d:g_e,tensor5d:y_e,tensor6d:b_e,tile:Ph,topk:x_e,truncatedNormal:S_e,unique:E_e,unsortedSegmentSum:I_e,unstack:Gx,upperBound:A_e,variable:__e,where:ac,whereAsync:wz,zeros:ic,zerosLike:Ox,op:te,OP_SCOPE_SUFFIX:VL,booleanMaskAsync:O_e,transpose:wx,norm:Gm,movingAverage:z_e,scatterND:V_e,searchSorted:Bx,sparseToDense:H_e,gatherND:j_e,dropout:Z_e,enclosingPowerOfTwo:xz,cosineWindow:Ux,inTopKAsync:Q_e,image:G3e,linalg:U3e,losses:H3e,spectral:q3e,fused:hDe,signal:V3e,sparse:K3e,string:j3e};var X3e=function(r,e,t,n){switch(n===void 0&&(n=yn),r.op){case"BiasAdd":case"AddV2":case"Add":return[n.add(C("a",r,e,t),C("b",r,e,t))];case"AddN":return[n.addN(C("tensors",r,e,t))];case"FloorMod":case"Mod":return[n.mod(C("a",r,e,t),C("b",r,e,t))];case"Mul":return[n.mul(C("a",r,e,t),C("b",r,e,t))];case"RealDiv":case"Div":return[n.div(C("a",r,e,t),C("b",r,e,t))];case"DivNoNan":return[n.divNoNan(C("a",r,e,t),C("b",r,e,t))];case"FloorDiv":return[n.floorDiv(C("a",r,e,t),C("b",r,e,t))];case"Sub":return[n.sub(C("a",r,e,t),C("b",r,e,t))];case"Minimum":return[n.minimum(C("a",r,e,t),C("b",r,e,t))];case"Maximum":return[n.maximum(C("a",r,e,t),C("b",r,e,t))];case"Pow":return[n.pow(C("a",r,e,t),C("b",r,e,t))];case"SquaredDifference":return[n.squaredDifference(C("a",r,e,t),C("b",r,e,t))];default:throw TypeError("Node type "+r.op+" is not implemented")}};var Y3e=function(r,e,t,n){switch(n===void 0&&(n=yn),r.op){case"Abs":case"ComplexAbs":return[n.abs(C("x",r,e,t))];case"Acos":return[n.acos(C("x",r,e,t))];case"Acosh":return[n.acosh(C("x",r,e,t))];case"Asin":return[n.asin(C("x",r,e,t))];case"Asinh":return[n.asinh(C("x",r,e,t))];case"Atan":return[n.atan(C("x",r,e,t))];case"Atan2":return[n.atan2(C("x",r,e,t),C("y",r,e,t))];case"Atanh":return[n.atanh(C("x",r,e,t))];case"Ceil":return[n.ceil(C("x",r,e,t))];case"Complex":return[n.complex(C("real",r,e,t),C("imag",r,e,t))];case"Cos":return[n.cos(C("x",r,e,t))];case"Cosh":return[n.cosh(C("x",r,e,t))];case"Elu":return[n.elu(C("x",r,e,t))];case"Erf":return[n.erf(C("x",r,e,t))];case"Exp":return[n.exp(C("x",r,e,t))];case"Expm1":return[n.expm1(C("x",r,e,t))];case"Floor":return[n.floor(C("x",r,e,t))];case"Log":return[n.log(C("x",r,e,t))];case"Log1p":return[n.log1p(C("x",r,e,t))];case"Imag":return[n.imag(C("x",r,e,t))];case"Neg":return[n.neg(C("x",r,e,t))];case"Reciprocal":return[n.reciprocal(C("x",r,e,t))];case"Real":return[n.real(C("x",r,e,t))];case"Relu":return[n.relu(C("x",r,e,t))];case"Round":return[n.round(C("x",r,e,t))];case"Selu":return[n.selu(C("x",r,e,t))];case"Sigmoid":return[n.sigmoid(C("x",r,e,t))];case"Sin":return[n.sin(C("x",r,e,t))];case"Sign":return[n.sign(C("x",r,e,t))];case"Sinh":return[n.sinh(C("x",r,e,t))];case"Softplus":return[n.softplus(C("x",r,e,t))];case"Sqrt":return[n.sqrt(C("x",r,e,t))];case"Square":return[n.square(C("x",r,e,t))];case"Tanh":return[n.tanh(C("x",r,e,t))];case"Tan":return[n.tan(C("x",r,e,t))];case"ClipByValue":return[n.clipByValue(C("x",r,e,t),C("clipValueMin",r,e,t),C("clipValueMax",r,e,t))];case"Relu6":return[n.relu6(C("x",r,e,t))];case"Rsqrt":return[n.rsqrt(Tn(r.inputNames[0],e,t))];case"Prod":return[n.prod(C("x",r,e,t),C("axes",r,e,t))];case"LeakyRelu":return[n.leakyRelu(C("x",r,e,t),C("alpha",r,e,t))];case"Prelu":return[n.prelu(C("x",r,e,t),C("alpha",r,e,t))];case"IsNan":return[n.isNaN(Tn(r.inputNames[0],e,t))];default:throw TypeError("Node type "+r.op+" is not implemented")}};function ni(r,e,t){if(t===void 0&&(t=""),!(typeof r=="number"||typeof e=="number")){$e.util.assert(r.length===e.length,function(){return t+(" Shapes "+r+" and "+e+" must match")});for(var n=0;n<r.length;n++){var a=r[n],i=e[n];$e.util.assert(a<0||i<0||a===i,function(){return t+(" Shapes "+r+" and "+e+" must match")})}}}function dL(r){return!(typeof r=="number"||r.some(function(e){return e<0}))}function Fh(r,e,t){var n=xx(r,t),a=!dL(n);if(a&&e.length===0)throw new Error("Tried to calculate elements of an empty list"+(" with non-fully-defined elementShape: "+n));if(a&&e.forEach(function(i){n=xx(i.shape,n)}),!dL(n))throw new Error("Non-fully-defined elementShape: "+n);return n}function xx(r,e){if(typeof r=="number")return e;if(typeof e=="number")return r;if(r.length!==e.length)throw new Error("Incompatible ranks during merge: "+r+" vs. "+e);for(var t=[],n=0;n<r.length;++n){var a=r[n],i=e[n];if(a>=0&&i>=0&&a!==i)throw new Error("Incompatible shape during merge: "+r+" vs. "+e);t[n]=a>=0?a:i}return t}var Z3e=function(){function r(e,t,n,a,i,o,s){this.name=e,this.dtype=t,this.maxSize=n,this.elementShape=a,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=$e.scalar(0),$e.keep(this.idTensor)}return Object.defineProperty(r.prototype,"id",{get:function(){return this.idTensor.id},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"closed",{get:function(){return this.closed_},enumerable:!0,configurable:!0}),r.prototype.clearAndClose=function(e){this.tensors.forEach(function(t){(e==null||!e.has(t.tensor.id))&&t.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()},r.prototype.size=function(){return this.tensors.length},r.prototype.read=function(e){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(e<0||e>=this.size())throw new Error("Tried to read from index "+e+", but array size is: "+this.size());var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray "+this.name+": Could not read index "+e+" twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor},r.prototype.readMany=function(e){var t=this;return e.map(function(n){return t.read(n)})},r.prototype.write=function(e,t){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index "+e+", but array is not resizeable and size is: "+this.maxSize);var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+`,
          because the value dtype is `+t.dtype+", but TensorArray dtype is "+this.dtype+".");if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=t.shape),ni(this.elementShape,t.shape,"TensorArray "+this.name+": Could not write to TensorArray index "+e+"."),n.read)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+", because it has already been read.");if(n.written)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+e+", because it has already been written.");n.tensor=t,$e.keep(t),n.written=!0,this.tensors[e]=n},r.prototype.writeMany=function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray "+this.name+": could not write multiple tensors,"+("because the index size: "+e.length+" is not the same as tensors size: "+t.length+"."));e.forEach(function(a,i){return n.write(a,t[i])})},r.prototype.gather=function(e,t){if(!!t&&t!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but gather requested dtype "+t);if(e)e=e.slice(0,this.size());else{e=[];for(var n=0;n<this.size();n++)e.push(n)}if(e.length===0)return $e.tensor([],[0].concat(this.elementShape));var a=this.readMany(e);return ni(this.elementShape,a[0].shape,"TensorArray shape mismatch: "),$e.stack(a,0)},r.prototype.concat=function(e){if(!!e&&e!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but concat requested dtype "+e);if(this.size()===0)return $e.tensor([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var a=this.readMany(t);return ni(this.elementShape,a[0].shape,"TensorArray shape mismatch: tensor array shape ("+this.elementShape+") vs first tensor shape ("+a[0].shape+")"),$e.concat(a,0)},r.prototype.scatter=function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+t.dtype);if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+e.length+" vs. "+t.shape[0]);var n=Math.max.apply(Math,pn(e));if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size ("+n+"  vs. "+this.maxSize+")");this.writeMany(e,$e.unstack(t,0))},r.prototype.split=function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+t.dtype);var a=0,i=e.map(function(c){return a+=c,a});if(a!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        `+a+", and tensor's shape is: "+t.shape);if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths ("+this.maxSize+" vs. "+e.length+"), and the TensorArray is not marked as dynamically resizeable");var o=a===0?0:t.size/a,s=[];$e.tidy(function(){t=$e.reshape(t,[1,a,o]);for(var c=0;c<e.length;++c){var f=c===0?0:i[c-1],h=[0,f,0],p=[1,e[c],o];s[c]=$e.reshape($e.slice(t,h,p),n.elementShape)}return s});for(var u=[],l=0;l<e.length;l++)u[l]=l;this.writeMany(u,s)},r}(),jm=function(){function r(e,t,n,a){a===void 0&&(a=-1),this.tensors=e,this.elementShape=t,this.elementDtype=n,e?.forEach(function(i){if(n!==i.dtype)throw new Error("Invalid data types; op elements "+n+", but list elements "+i.dtype);ni(t,i.shape,"TensorList shape mismatch: "),$e.keep(i)}),this.idTensor=$e.scalar(0),this.maxNumElements=a,$e.keep(this.idTensor)}return Object.defineProperty(r.prototype,"id",{get:function(){return this.idTensor.id},enumerable:!0,configurable:!0}),r.prototype.copy=function(){return new r(pn(this.tensors),this.elementShape,this.elementDtype)},r.prototype.clearAndClose=function(e){this.tensors.forEach(function(t){(e==null||!e.has(t.id))&&t.dispose()}),this.tensors.length=0,this.idTensor.dispose()},r.prototype.size=function(){return this.tensors.length},r.prototype.stack=function(e,t,n){var a=this;if(n===void 0&&(n=-1),t!==this.elementDtype)throw new Error("Invalid data types; op elements "+t+", but list elements "+this.elementDtype);if(n!==-1&&this.tensors.length!==n)throw new Error("Operation expected a list with "+n+" elements but got a list with "+this.tensors.length+" elements.");ni(e,this.elementShape,"TensorList shape mismatch: ");var i=Fh(this.elementShape,this.tensors,e);return $e.tidy(function(){var o=a.tensors.map(function(s){return $e.reshape(s,i)});return $e.stack(o,0)})},r.prototype.popBack=function(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements "+t+", but list elements "+this.elementDtype);if(this.size()===0)throw new Error("Trying to pop from an empty list.");var n=Fh(this.elementShape,this.tensors,e),a=this.tensors.pop();return a.kept=!1,ni(a.shape,e,"TensorList shape mismatch: "),$e.reshape(a,n)},r.prototype.pushBack=function(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements "+e.dtype+", but list elements "+this.elementDtype);if(ni(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");$e.keep(e),this.tensors.push(e)},r.prototype.resize=function(e){if(e<0)throw new Error("TensorListResize expects size to be non-negative. Got: "+e);if(this.maxNumElements!==-1&&e>this.maxNumElements)throw new Error("TensorListResize input size "+e+" is greater maxNumElement "+this.maxNumElements+".");var t=new r([],this.elementShape,this.elementDtype,this.maxNumElements);t.tensors.length=e;for(var n=0;n<Math.min(this.tensors.length,e);++n)t.tensors[n]=this.tensors[n];return t},r.prototype.getItem=function(e,t,n){if(n!==this.elementDtype)throw new Error("Invalid data types; op elements "+n+", but list elements "+this.elementDtype);if(e<0||e>this.tensors.length)throw new Error("Trying to access element "+e+" in a list with "+this.tensors.length+" elements.");if(this.tensors[e]==null)throw new Error("element at index "+e+" is null.");ni(this.tensors[e].shape,t,"TensorList shape mismatch: ");var a=Fh(this.elementShape,this.tensors,t);return $e.reshape(this.tensors[e],a)},r.prototype.setItem=function(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements "+t.dtype+", but list elements "+this.elementDtype);if(e<0||this.maxNumElements!==-1&&e>=this.maxNumElements)throw new Error("Trying to set element "+e+" in a list with max "+this.maxNumElements+" elements.");ni(this.elementShape,t.shape,"TensorList shape mismatch: "),$e.keep(t),this.tensors[e]!=null&&(this.tensors[e].kept=!1),this.tensors[e]=t},r.prototype.gather=function(e,t,n){var a=this;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements "+t+", but list elements "+this.elementDtype);ni(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());var i=Fh(this.elementShape,this.tensors,n);return e.length===0?$e.tensor([],[0].concat(i)):$e.tidy(function(){var o=e.map(function(s){return $e.reshape(a.tensors[s],i)});return $e.stack(o,0)})},r.prototype.concat=function(e,t){var n=this;if(!!e&&e!==this.elementDtype)throw new Error("TensorList dtype is "+this.elementDtype+" but concat requested dtype "+e);ni(this.elementShape,t,"TensorList shape mismatch: ");var a=Fh(this.elementShape,this.tensors,t);return this.size()===0?$e.tensor([],[0].concat(a)):$e.tidy(function(){var i=n.tensors.map(function(o){return $e.reshape(o,a)});return $e.concat(i,0)})},r}();function J3e(r,e,t){var n=r.dtype;if(r.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: "+r.shape);if(r.dtype!==t)throw new Error("Invalid data types; op elements "+r.dtype+", but list elements "+t);var a=r.shape.slice(1);ni(a,e,"TensorList shape mismatch: ");var i=$e.unstack(r);return new jm(i,e,n)}function Q3e(r,e,t,n){return new jm([],r,e,n)}function eFe(r,e,t,n){if(e.length!==r.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+e.length+" vs. "+r.shape[0]);var a=Math.max.apply(Math,pn(e));if(n!=null&&n!==-1&&a>=n)throw new Error("Max index must be < array size ("+a+"  vs. "+n+")");var i=new jm([],t,r.dtype,n),o=$e.unstack(r,0);return e.forEach(function(s,u){i.setItem(s,o[u])}),i}function tFe(r,e,t){var n=0,a=e.map(function(f){return n+=f,n});if(n!==r.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        `+n+", and tensor's shape is: "+r.shape);for(var i=r.shape.slice(1),o=xx(i,t),s=n===0?0:r.size/n,u=$e.tidy(function(){var f=[];r=$e.reshape(r,[1,n,s]);for(var h=0;h<e.length;++h){var p=h===0?0:a[h-1],d=[0,p,0],m=[1,e[h],s];f[h]=$e.reshape($e.slice(r,d,m),o)}return r.dispose(),f}),l=new jm([],t,r.dtype,e.length),c=0;c<u.length;c++)l.setItem(c,u[c]);return l}var rFe=void 0,nFe=function(r,e,t){return Yt(rFe,void 0,void 0,function(){var n,a,i,o,l,h,s,u,l,c,f,h,p,d,m,m,y,v,y,g,y,y,y,zr,b,nt,w,x,k,N,T,I,ce,dt,F,D,he,R,Ne,Ae,P,B,q,xe,Se,O,it,V,ft,K,at,yr,Z,j,ee,le,se,_t,ce,dt,Ue,_t,he,nt,Je,Ue,xe,Se,nt,Ze,Ue,nt,st,we,Ze,ke,Ue,Ne,Ae,nt,st,Ue,_t,nt,st,Ze,Ue,Et,nt,st,Ue,it,Ue,ft,nt,_t,dt,Ue,_t,nt,Je,Ue,at,nt,yr,Ue,_t,Ue,_t,zr,wn,Vr;return Kt(this,function($r){switch($r.label){case 0:switch(n=r.op,n){case"If":return[3,1];case"StatelessIf":return[3,1];case"While":return[3,3];case"StatelessWhile":return[3,3];case"LoopCond":return[3,9];case"Switch":return[3,10];case"Merge":return[3,12];case"Enter":return[3,13];case"Exit":return[3,14];case"NextIteration":return[3,15];case"TensorArrayV3":return[3,16];case"TensorArrayWriteV3":return[3,17];case"TensorArrayReadV3":return[3,18];case"TensorArrayGatherV3":return[3,19];case"TensorArrayScatterV3":return[3,20];case"TensorArrayConcatV3":return[3,21];case"TensorArraySplitV3":return[3,22];case"TensorArraySizeV3":return[3,23];case"TensorArrayCloseV3":return[3,24];case"TensorListSetItem":return[3,25];case"TensorListGetItem":return[3,26];case"TensorListScatterV2":return[3,27];case"TensorListScatter":return[3,27];case"TensorListReserve":return[3,28];case"EmptyTensorList":return[3,28];case"TensorListGather":return[3,29];case"TensorListStack":return[3,30];case"TensorListFromTensor":return[3,31];case"TensorListConcat":return[3,32];case"TensorListConcatV2":return[3,32];case"TensorListPushBack":return[3,33];case"TensorListPopBack":return[3,34];case"TensorListSplit":return[3,35];case"TensorListLength":return[3,36];case"TensorListResize":return[3,37]}return[3,38];case 1:return a=C("thenBranch",r,e,t),i=C("elseBranch",r,e,t),o=C("cond",r,e,t),l=C("args",r,e,t),[4,o.data()];case 2:return h=$r.sent(),h[0]?[2,t.functionMap[a].executeFunctionAsync(l,t.tensorArrayMap,t.tensorListMap)]:[2,t.functionMap[i].executeFunctionAsync(l,t.tensorArrayMap,t.tensorListMap)];case 3:return s=C("body",r,e,t),u=C("cond",r,e,t),l=C("args",r,e,t),[4,t.functionMap[u].executeFunctionAsync(l,t.tensorArrayMap,t.tensorListMap)];case 4:return c=$r.sent(),f=l.map(function(br){return br.id}),[4,c[0].data()];case 5:h=$r.sent(),c.forEach(function(br){!br.kept&&f.indexOf(br.id)===-1&&br.dispose()}),p=l,d=function(){var br,jn,xn;return Kt(this,function(Xn){switch(Xn.label){case 0:return br=p,[4,t.functionMap[s].executeFunctionAsync(p,t.tensorArrayMap,t.tensorListMap)];case 1:return p=Xn.sent(),jn=p.map(function(Dr){return Dr.id}),br.forEach(function(Dr){!Dr.kept&&f.indexOf(Dr.id)===-1&&jn.indexOf(Dr.id)===-1&&Dr.dispose()}),[4,t.functionMap[u].executeFunctionAsync(p,t.tensorArrayMap,t.tensorListMap)];case 2:return xn=Xn.sent(),[4,xn[0].data()];case 3:return h=Xn.sent(),xn.forEach(function(Dr){!Dr.kept&&f.indexOf(Dr.id)===-1&&jn.indexOf(Dr.id)===-1&&Dr.dispose()}),[2]}})},$r.label=6;case 6:return h[0]?[5,d()]:[3,8];case 7:return $r.sent(),[3,6];case 8:return[2,p];case 9:return m=C("pred",r,e,t),[2,[No(m)]];case 10:return m=C("pred",r,e,t),y=C("data",r,e,t),y.kept||(y=No(y)),[4,m.data()];case 11:return[2,$r.sent()[0]?[void 0,y]:[y,void 0]];case 12:return v=r.inputNames.find(function(br){return Tn(br,e,t)!==void 0}),v?(y=Tn(v,e,t),[2,[No(y)]]):[2,void 0];case 13:return g=C("frameName",r,e,t),y=C("tensor",r,e,t),t.enterFrame(g),[2,[No(y)]];case 14:return y=C("tensor",r,e,t),t.exitFrame(),[2,[No(y)]];case 15:return y=C("tensor",r,e,t),t.nextIteration(),[2,[No(y)]];case 16:return zr=C("size",r,e,t),b=C("dtype",r,e,t),nt=C("elementShape",r,e,t),w=C("dynamicSize",r,e,t),x=C("clearAfterRead",r,e,t),k=C("identicalElementShapes",r,e,t),N=C("name",r,e,t),T=new Z3e(N,b,zr,nt,k,w,x),t.addTensorArray(T),[2,[T.idTensor,$e.scalar(1)]];case 17:return I=C("tensorArrayId",r,e,t),ce=C("index",r,e,t),dt=C("tensor",r,e,t),F=t.getTensorArray(I.id),F.write(ce,dt),[2,[F.idTensor]];case 18:return D=C("tensorArrayId",r,e,t),he=C("index",r,e,t),R=t.getTensorArray(D.id),[2,[R.read(he)]];case 19:return Ne=C("tensorArrayId",r,e,t),Ae=C("indices",r,e,t),P=C("dtype",r,e,t),B=t.getTensorArray(Ne.id),[2,[B.gather(Ae,P)]];case 20:return q=C("tensorArrayId",r,e,t),xe=C("indices",r,e,t),Se=C("tensor",r,e,t),O=t.getTensorArray(q.id),O.scatter(xe,Se),[2,[O.idTensor]];case 21:return it=C("tensorArrayId",r,e,t),V=t.getTensorArray(it.id),ft=C("dtype",r,e,t),[2,[V.concat(ft)]];case 22:return K=C("tensorArrayId",r,e,t),at=C("tensor",r,e,t),yr=C("lengths",r,e,t),Z=t.getTensorArray(K.id),Z.split(yr,at),[2,[Z.idTensor]];case 23:return j=C("tensorArrayId",r,e,t),ee=t.getTensorArray(j.id),[2,[$e.scalar(ee.size(),"int32")]];case 24:return le=C("tensorArrayId",r,e,t),se=t.getTensorArray(le.id),se.clearAndClose(),[2,[se.idTensor]];case 25:return _t=C("tensorListId",r,e,t),ce=C("index",r,e,t),dt=C("tensor",r,e,t),Ue=t.getTensorList(_t.id),Ue.setItem(ce,dt),[2,[Ue.idTensor]];case 26:return _t=C("tensorListId",r,e,t),he=C("index",r,e,t),nt=C("elementShape",r,e,t),Je=C("elementDType",r,e,t),Ue=t.getTensorList(_t.id),[2,[Ue.getItem(he,nt,Je)]];case 27:return xe=C("indices",r,e,t),Se=C("tensor",r,e,t),nt=C("elementShape",r,e,t),Ze=C("numElements",r,e,t),Ue=eFe(Se,xe,nt,Ze),t.addTensorList(Ue),[2,[Ue.idTensor]];case 28:return nt=C("elementShape",r,e,t),st=C("elementDType",r,e,t),we=void 0,r.op==="TensorListReserve"?we="numElements":we="maxNumElements",Ze=C(we,r,e,t),ke=r.op==="TensorListReserve"?-1:Ze,Ue=Q3e(nt,st,Ze,ke),t.addTensorList(Ue),[2,[Ue.idTensor]];case 29:return Ne=C("tensorListId",r,e,t),Ae=C("indices",r,e,t),nt=C("elementShape",r,e,t),st=C("elementDType",r,e,t),Ue=t.getTensorList(Ne.id),[2,[Ue.gather(Ae,st,nt)]];case 30:return _t=C("tensorListId",r,e,t),nt=C("elementShape",r,e,t),st=C("elementDType",r,e,t),Ze=C("numElements",r,e,t),Ue=t.getTensorList(_t.id),[2,[Ue.stack(nt,st,Ze)]];case 31:return Et=C("tensor",r,e,t),nt=C("elementShape",r,e,t),st=C("elementDType",r,e,t),Ue=J3e(Et,nt,st),t.addTensorList(Ue),[2,[Ue.idTensor]];case 32:return it=C("tensorListId",r,e,t),Ue=t.getTensorList(it.id),ft=C("dtype",r,e,t),nt=C("elementShape",r,e,t),[2,[Ue.concat(ft,nt)]];case 33:return _t=C("tensorListId",r,e,t),dt=C("tensor",r,e,t),Ue=t.getTensorList(_t.id),Ue.pushBack(dt),[2,[Ue.idTensor]];case 34:return _t=C("tensorListId",r,e,t),nt=C("elementShape",r,e,t),Je=C("elementDType",r,e,t),Ue=t.getTensorList(_t.id),[2,[Ue.popBack(nt,Je)]];case 35:return at=C("tensor",r,e,t),nt=C("elementShape",r,e,t),yr=C("lengths",r,e,t),Ue=tFe(at,yr,nt),t.addTensorList(Ue),[2,[Ue.idTensor]];case 36:return _t=C("tensorListId",r,e,t),Ue=t.getTensorList(_t.id),[2,[$e.scalar(Ue.size(),"int32")]];case 37:return _t=C("tensorListId",r,e,t),zr=C("size",r,e,t),wn=t.getTensorList(_t.id),Vr=wn.resize(zr),t.addTensorList(Vr),[2,[Vr.idTensor]];case 38:throw TypeError("Node type "+r.op+" is not implemented")}})})};function vL(r,e,t){var n=Le(C("fusedOps",r,e,t),2),a=n[0],i=n[1],o=a==="biasadd",s=!o,u=i==="prelu",l=a==="fusedbatchnorm",c=C("numArgs",r,e,t);if(o){if(u&&c!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!u&&o&&c!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(l)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");var f=C("strides",r,e,t),h=km(r,e,t),p=C("dataFormat",r,e,t).toUpperCase(),d=C("dilations",r,e,t),m=Le(C("args",r,e,t),2),v=m[0],g=m[1];s&&(g=v,v=void 0);var y=C("leakyreluAlpha",r,e,t);return{stride:f,pad:h,dataFormat:p,dilations:d,biasArg:v,preluArg:g,activationFunc:i,leakyreluAlpha:y}}var aFe=function(r,e,t,n){switch(n===void 0&&(n=yn),r.op){case"Conv1D":{var a=C("stride",r,e,t),i=C("pad",r,e,t),o=C("dataFormat",r,e,t).toUpperCase(),s=C("dilation",r,e,t);return[n.conv1d(C("x",r,e,t),C("filter",r,e,t),a,i,o,s)]}case"Conv2D":{var a=C("strides",r,e,t),i=km(r,e,t),o=C("dataFormat",r,e,t).toUpperCase(),u=C("dilations",r,e,t);return[n.conv2d(C("x",r,e,t),C("filter",r,e,t),[a[1],a[2]],i,o,[u[1],u[2]])]}case"_FusedConv2D":{var l=vL(r,e,t),a=l.stride,i=l.pad,o=l.dataFormat,u=l.dilations,c=l.biasArg,f=l.preluArg,h=l.activationFunc,p=l.leakyreluAlpha;return[n.fused.conv2d({x:C("x",r,e,t),filter:C("filter",r,e,t),strides:[a[1],a[2]],pad:i,dataFormat:o,dilations:[u[1],u[2]],bias:c,activation:h,preluActivationWeights:f,leakyreluAlpha:p})]}case"FusedDepthwiseConv2dNative":{var d=vL(r,e,t),a=d.stride,i=d.pad,o=d.dataFormat,u=d.dilations,c=d.biasArg,f=d.preluArg,h=d.activationFunc,p=d.leakyreluAlpha;return[n.fused.depthwiseConv2d({x:C("x",r,e,t),filter:C("filter",r,e,t),strides:[a[1],a[2]],pad:i,dataFormat:o,dilations:[u[1],u[2]],bias:c,activation:h,preluActivationWeights:f,leakyreluAlpha:p})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{var m=C("outputShape",r,e,t),a=C("strides",r,e,t),i=km(r,e,t);return[n.conv2dTranspose(C("x",r,e,t),C("filter",r,e,t),m,[a[1],a[2]],i)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{var a=C("strides",r,e,t),i=km(r,e,t),u=C("dilations",r,e,t),o=C("dataFormat",r,e,t).toUpperCase();return[n.depthwiseConv2d(C("input",r,e,t),C("filter",r,e,t),[a[1],a[2]],i,o,[u[1],u[2]])]}case"Conv3D":{var a=C("strides",r,e,t),i=C("pad",r,e,t),o=C("dataFormat",r,e,t).toUpperCase(),u=C("dilations",r,e,t);return[n.conv3d(C("x",r,e,t),C("filter",r,e,t),[a[1],a[2],a[3]],i,o,[u[1],u[2],u[3]])]}case"AvgPool":{var a=C("strides",r,e,t),i=C("pad",r,e,t),v=C("kernelSize",r,e,t);return[n.avgPool(C("x",r,e,t),[v[1],v[2]],[a[1],a[2]],i)]}case"MaxPool":{var a=C("strides",r,e,t),i=C("pad",r,e,t),v=C("kernelSize",r,e,t);return[n.maxPool(C("x",r,e,t),[v[1],v[2]],[a[1],a[2]],i)]}case"MaxPoolWithArgmax":{var a=C("strides",r,e,t),i=C("pad",r,e,t),v=C("kernelSize",r,e,t),g=C("includeBatchInIndex",r,e,t),y=n.maxPoolWithArgmax(C("x",r,e,t),[v[1],v[2]],[a[1],a[2]],i,g),b=y.result,w=y.indexes;return[b,w]}case"AvgPool3D":{var a=C("strides",r,e,t),i=C("pad",r,e,t),v=C("kernelSize",r,e,t);return[n.avgPool3d(C("x",r,e,t),[v[1],v[2],v[3]],[a[1],a[2],a[3]],i)]}case"MaxPool3D":{var a=C("strides",r,e,t),i=C("pad",r,e,t),v=C("kernelSize",r,e,t);return[n.maxPool3d(C("x",r,e,t),[v[1],v[2],v[3]],[a[1],a[2],a[3]],i)]}case"Dilation2D":{var x=C("strides",r,e,t),i=C("pad",r,e,t),u=C("dilations",r,e,t),k=x[1],N=x[2],T=u[1],I=u[2];return[n.dilation2d(C("x",r,e,t),C("filter",r,e,t),[k,N],i,[T,I],"NHWC")]}default:throw TypeError("Node type "+r.op+" is not implemented")}};var iFe=function(r,e,t,n){switch(n===void 0&&(n=yn),r.op){case"Fill":{var a=C("shape",r,e,t),i=C("dtype",r,e,t),o=C("value",r,e,t);return[n.fill(a,o,i)]}case"LinSpace":{var s=C("start",r,e,t),u=C("stop",r,e,t),l=C("num",r,e,t);return[n.linspace(s,u,l)]}case"Multinomial":{var c=C("logits",r,e,t),f=C("numSamples",r,e,t),h=C("seed",r,e,t);return[n.multinomial(c,f,h)]}case"OneHot":{var p=C("indices",r,e,t),d=C("depth",r,e,t),m=C("onValue",r,e,t),v=C("offValue",r,e,t),i=C("dtype",r,e,t);return[n.oneHot(p,d,m,v,i)]}case"Ones":return[n.ones(C("shape",r,e,t),C("dtype",r,e,t))];case"OnesLike":return[n.onesLike(C("x",r,e,t))];case"RandomStandardNormal":return[n.randomStandardNormal(C("shape",r,e,t),C("dtype",r,e,t),C("seed",r,e,t))];case"RandomUniform":return[n.randomUniform(C("shape",r,e,t),C("minval",r,e,t),C("maxval",r,e,t),C("dtype",r,e,t))];case"Range":{var s=C("start",r,e,t),u=C("stop",r,e,t),g=C("step",r,e,t);return[n.range(s,u,g,C("dtype",r,e,t))]}case"TruncatedNormal":{var a=C("shape",r,e,t),y=C("mean",r,e,t),b=C("stdDev",r,e,t),h=C("seed",r,e,t);return[n.truncatedNormal(a,y,b,C("dtype",r,e,t),h)]}case"Zeros":return[n.zeros(C("shape",r,e,t),C("dtype",r,e,t))];case"ZerosLike":return[n.zerosLike(C("x",r,e,t))];default:throw TypeError("Node type "+r.op+" is not implemented")}},oFe=void 0;function Yw(r,e,t){var n=C("boxes",r,e,t),a=C("scores",r,e,t),i=C("maxOutputSize",r,e,t),o=C("iouThreshold",r,e,t),s=C("scoreThreshold",r,e,t),u=C("softNmsSigma",r,e,t);return{boxes:n,scores:a,maxOutputSize:i,iouThreshold:o,scoreThreshold:s,softNmsSigma:u}}var sFe=function(r,e,t,n,a){return a===void 0&&(a=yn),Yt(oFe,void 0,void 0,function(){var i,o,f,h,p,d,m,s,g,u,f,h,p,d,m,l,g,c,f,h,p,d,m,v,g;return Kt(this,function(y){switch(y.label){case 0:switch(i=r.op,i){case"NonMaxSuppressionV5":return[3,1];case"NonMaxSuppressionV4":return[3,3];case"NonMaxSuppressionV3":return[3,5];case"NonMaxSuppressionV2":return[3,5];case"Where":return[3,7];case"ListDiff":return[3,9]}return[3,10];case 1:return o=Yw(r,e,t),f=o.boxes,h=o.scores,p=o.maxOutputSize,d=o.iouThreshold,m=o.scoreThreshold,s=o.softNmsSigma,[4,a.image.nonMaxSuppressionWithScoreAsync(f,h,p,d,m,s)];case 2:return g=y.sent(),[2,[g.selectedIndices,g.selectedScores]];case 3:return u=Yw(r,e,t),f=u.boxes,h=u.scores,p=u.maxOutputSize,d=u.iouThreshold,m=u.scoreThreshold,l=C("padToMaxOutputSize",r,e,t),[4,a.image.nonMaxSuppressionPaddedAsync(f,h,p,d,m,l)];case 4:return g=y.sent(),[2,[g.selectedIndices,g.validOutputs]];case 5:return c=Yw(r,e,t),f=c.boxes,h=c.scores,p=c.maxOutputSize,d=c.iouThreshold,m=c.scoreThreshold,[4,a.image.nonMaxSuppressionAsync(f,h,p,d,m)];case 6:return[2,[y.sent()]];case 7:return v=a.cast(C("condition",r,e,t),"bool"),[4,a.whereAsync(v)];case 8:return g=[y.sent()],v.dispose(),[2,g];case 9:return[2,a.setdiff1dAsync(C("x",r,e,t),C("y",r,e,t))];case 10:throw TypeError("Node type "+r.op+" is not implemented")}})})};var uFe=function(r,e,t,n){switch(n===void 0&&(n=yn),r.op){case"LowerBound":{var a=C("sortedSequence",r,e,t),i=C("values",r,e,t);return[n.lowerBound(a,i)]}case"TopKV2":{var o=C("x",r,e,t),s=C("k",r,e,t),u=C("sorted",r,e,t),l=n.topk(o,s,u);return[l.values,l.indices]}case"UpperBound":{var a=C("sortedSequence",r,e,t),i=C("values",r,e,t);return[n.upperBound(a,i)]}case"Unique":{var o=C("x",r,e,t),l=n.unique(o);return[l.values,l.indices]}case"UniqueV2":{var o=C("x",r,e,t),c=C("axis",r,e,t),l=n.unique(o,c);return[l.values,l.indices]}default:throw TypeError("Node type "+r.op+" is not implemented")}};var lFe=function(r,e,t,n){switch(n===void 0&&(n=yn),r.op){case"Const":return e[r.name];case"PlaceholderWithDefault":var a=C("default",r,e,t);return[Tn(r.name,e,t)||a];case"Placeholder":return[Tn(r.name,e,t)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{var i=C("x",r,e,t);return[No(i)]}case"IdentityN":return C("x",r,e,t).map(function(h){return No(h)});case"Snapshot":var o=C("x",r,e,t);return[No(o)];case"Shape":return[n.tensor1d(C("x",r,e,t).shape,"int32")];case"ShapeN":return C("x",r,e,t).map(function(h){return n.tensor1d(h.shape)});case"Size":return[n.scalar(C("x",r,e,t).size,"int32")];case"Rank":return[n.scalar(C("x",r,e,t).rank,"int32")];case"NoOp":return[n.scalar(1)];case"Print":var s=C("x",r,e,t),u=C("data",r,e,t),l=C("message",r,e,t),c=C("summarize",r,e,t);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(l);for(var f=0;f<u.length;f++)console.log(Array.prototype.slice.call(u[f].dataSync()).slice(0,c));return[s];default:throw TypeError("Node type "+r.op+" is not implemented")}},cFe=function(){function r(e,t){this.keyDType=e,this.valueDType=t,this.handle=$e.scalar(0),this.tensorMap=new Map,$e.keep(this.handle)}return Object.defineProperty(r.prototype,"id",{get:function(){return this.handle.id},enumerable:!0,configurable:!0}),r.prototype.clearAndClose=function(){this.tensorMap.forEach(function(e){return e.dispose()}),this.tensorMap.clear(),this.handle.dispose()},r.prototype.size=function(){return this.tensorMap.size},r.prototype.tensorSize=function(){return Ar(this.size(),"int32")},r.prototype.import=function(e,t){return Yt(this,void 0,void 0,function(){var n,a=this;return Kt(this,function(i){switch(i.label){case 0:return this.checkKeyAndValueTensor(e,t),[4,e.data()];case 1:return n=i.sent(),this.tensorMap.forEach(function(o){return o.dispose()}),this.tensorMap.clear(),[2,$e.tidy(function(){var o=$e.unstack(t),s=n.length,u=o.length;$e.util.assert(s===u,function(){return"The number of elements doesn't match, keys has "+(s+" elements, the values has "+u+" ")+"elements."});for(var l=0;l<s;l++){var c=n[l],f=o[l];$e.keep(f),a.tensorMap.set(c,f)}return a.handle})]}})})},r.prototype.find=function(e,t){return Yt(this,void 0,void 0,function(){var n,a=this;return Kt(this,function(i){switch(i.label){case 0:return this.checkKeyAndValueTensor(e,t),[4,e.data()];case 1:return n=i.sent(),[2,$e.tidy(function(){for(var o=[],s=0;s<n.length;s++){var u=n[s],l=a.findWithDefault(u,t);o.push(l)}return $e.stack(o)})]}})})},r.prototype.findWithDefault=function(e,t){var n=this.tensorMap.get(e);return n??t},r.prototype.checkKeyAndValueTensor=function(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype "+this.keyDType+", but got "+(""+e.dtype));if(t.dtype!==this.valueDType)throw new Error("Expect value dtype "+this.valueDType+", but got "+(""+t.dtype))},r}(),fFe=void 0,hFe=function(r,e,t,n){return Yt(fFe,void 0,void 0,function(){var a,i,o,f,c,u,s,f,c,u,l,f,c,f;return Kt(this,function(h){switch(h.label){case 0:switch(a=r.op,a){case"HashTable":return[3,1];case"HashTableV2":return[3,1];case"LookupTableImport":return[3,2];case"LookupTableImportV2":return[3,2];case"LookupTableFind":return[3,4];case"LookupTableFindV2":return[3,4];case"LookupTableSize":return[3,6];case"LookupTableSizeV2":return[3,6]}return[3,7];case 1:return i=C("keyDType",r,e,t),o=C("valueDType",r,e,t),f=new cFe(i,o),n.addHashTable(r.name,f),[2,[f.handle]];case 2:return c=C("tableHandle",r,e,t,n),u=C("keys",r,e,t),s=C("values",r,e,t),f=n.getHashTableById(c.id),[4,f.import(u,s)];case 3:return[2,[h.sent()]];case 4:return c=C("tableHandle",r,e,t,n),u=C("keys",r,e,t),l=C("defaultValue",r,e,t),f=n.getHashTableById(c.id),[4,f.find(u,l)];case 5:return[2,[h.sent()]];case 6:return c=C("tableHandle",r,e,t,n),f=n.getHashTableById(c.id),[2,[f.tensorSize()]];case 7:throw TypeError("Node type "+r.op+" is not implemented")}})})};var pFe=function(r,e,t,n){switch(n===void 0&&(n=yn),r.op){case"ResizeBilinear":{var a=C("images",r,e,t),i=C("size",r,e,t),o=C("alignCorners",r,e,t),s=C("halfPixelCenters",r,e,t);return[n.image.resizeBilinear(a,[i[0],i[1]],o,s)]}case"ResizeNearestNeighbor":{var a=C("images",r,e,t),i=C("size",r,e,t),o=C("alignCorners",r,e,t),s=C("halfPixelCenters",r,e,t);return[n.image.resizeNearestNeighbor(a,[i[0],i[1]],o,s)]}case"CropAndResize":{var u=C("image",r,e,t),l=C("boxes",r,e,t),c=C("boxInd",r,e,t),f=C("cropSize",r,e,t),h=C("method",r,e,t),p=C("extrapolationValue",r,e,t);return[n.image.cropAndResize(u,l,c,f,h,p)]}case"ImageProjectiveTransformV3":{var a=C("images",r,e,t),d=C("transforms",r,e,t),m=C("outputShape",r,e,t),v=C("fillValue",r,e,t),g=C("interpolation",r,e,t),y=C("fillMode",r,e,t);return[n.image.transform(a,d,g.toLowerCase(),y.toLowerCase(),v,m)]}default:throw TypeError("Node type "+r.op+" is not implemented")}};var dFe=function(r,e,t,n){switch(n===void 0&&(n=yn),r.op){case"Equal":return[n.equal(C("a",r,e,t),C("b",r,e,t))];case"NotEqual":return[n.notEqual(C("a",r,e,t),C("b",r,e,t))];case"Greater":return[n.greater(C("a",r,e,t),C("b",r,e,t))];case"GreaterEqual":return[n.greaterEqual(C("a",r,e,t),C("b",r,e,t))];case"Less":return[n.less(C("a",r,e,t),C("b",r,e,t))];case"LessEqual":return[n.lessEqual(C("a",r,e,t),C("b",r,e,t))];case"LogicalAnd":return[n.logicalAnd(C("a",r,e,t),C("b",r,e,t))];case"LogicalNot":return[n.logicalNot(C("a",r,e,t))];case"LogicalOr":return[n.logicalOr(C("a",r,e,t),C("b",r,e,t))];case"Select":case"SelectV2":return[n.where(C("condition",r,e,t),C("a",r,e,t),C("b",r,e,t))];default:throw TypeError("Node type "+r.op+" is not implemented")}},vFe=function(r,e,t,n){switch(n===void 0&&(n=yn),r.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[n.matMul(C("a",r,e,t),C("b",r,e,t),C("transposeA",r,e,t),C("transposeB",r,e,t))];case"Einsum":return[n.einsum.apply(n,pn([C("equation",r,e,t)],C("tensors",r,e,t)))];case"Transpose":return[n.transpose(C("x",r,e,t),C("perm",r,e,t))];case"_FusedMatMul":var a=Le(C("fusedOps",r,e,t),2),i=a[0],o=a[1],s=i==="biasadd",u=o==="prelu",l=C("numArgs",r,e,t),c=C("leakyreluAlpha",r,e,t);if(s){if(u&&l!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!u&&l!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var f=Le(C("args",r,e,t),2),h=f[0],p=f[1];return[n.fused.matMul({a:C("a",r,e,t),b:C("b",r,e,t),transposeA:C("transposeA",r,e,t),transposeB:C("transposeB",r,e,t),bias:h,activation:o,preluActivationWeights:p,leakyreluAlpha:c})];default:throw TypeError("Node type "+r.op+" is not implemented")}};var mFe=function(r,e,t,n){switch(n===void 0&&(n=yn),r.op){case"EuclideanNorm":return[n.euclideanNorm(C("x",r,e,t),C("axis",r,e,t),C("keepDims",r,e,t))];case"FusedBatchNorm":case"FusedBatchNormV2":return[n.batchNorm(C("x",r,e,t),C("mean",r,e,t),C("variance",r,e,t),C("offset",r,e,t),C("scale",r,e,t),C("epsilon",r,e,t))];case"FusedBatchNormV3":return[n.batchNorm(C("x",r,e,t),C("mean",r,e,t),C("variance",r,e,t),C("offset",r,e,t),C("scale",r,e,t),C("epsilon",r,e,t))];case"LRN":return[n.localResponseNormalization(C("x",r,e,t),C("radius",r,e,t),C("bias",r,e,t),C("alpha",r,e,t),C("beta",r,e,t))];case"Softmax":return[n.softmax(C("x",r,e,t))];case"LogSoftmax":return[n.logSoftmax(C("x",r,e,t))];case"SparseToDense":return[n.sparseToDense(C("sparseIndices",r,e,t),C("outputShape",r,e,t),C("sparseValues",r,e,t),C("defaultValue",r,e,t))];default:throw TypeError("Node type "+r.op+" is not implemented")}};var gFe=function(r,e,t,n){switch(n===void 0&&(n=yn),r.op){case"Max":{var a=C("axis",r,e,t),i=C("keepDims",r,e,t);return[n.max(C("x",r,e,t),a,i)]}case"Mean":{var a=C("axis",r,e,t),i=C("keepDims",r,e,t);return[n.mean(C("x",r,e,t),a,i)]}case"Min":{var a=C("axis",r,e,t),i=C("keepDims",r,e,t);return[n.min(C("x",r,e,t),a,i)]}case"Sum":{var a=C("axis",r,e,t),i=C("keepDims",r,e,t);return[n.sum(C("x",r,e,t),a,i)]}case"All":{var a=C("axis",r,e,t),i=C("keepDims",r,e,t);return[n.all(C("x",r,e,t),a,i)]}case"Any":{var a=C("axis",r,e,t),i=C("keepDims",r,e,t);return[n.any(C("x",r,e,t),a,i)]}case"ArgMax":{var a=C("axis",r,e,t);return[n.argMax(C("x",r,e,t),a)]}case"ArgMin":{var a=C("axis",r,e,t);return[n.argMin(C("x",r,e,t),a)]}case"Prod":{var a=C("axis",r,e,t),i=C("keepDims",r,e,t);return[n.prod(C("x",r,e,t),a,i)]}case"Cumprod":{var a=C("axis",r,e,t),o=C("exclusive",r,e,t),s=C("reverse",r,e,t);return[n.cumprod(C("x",r,e,t),a,o,s)]}case"Cumsum":{var a=C("axis",r,e,t),o=C("exclusive",r,e,t),s=C("reverse",r,e,t);return[n.cumsum(C("x",r,e,t),a,o,s)]}case"Bincount":var u=C("x",r,e,t),l=C("weights",r,e,t),c=C("size",r,e,t);return[n.bincount(u,l,c)];case"DenseBincount":{var f=C("x",r,e,t),h=C("weights",r,e,t),p=C("size",r,e,t),d=C("binaryOutput",r,e,t);return[n.denseBincount(f,h,p,d)]}default:throw TypeError("Node type "+r.op+" is not implemented")}};var yFe=function(r,e,t,n){switch(n===void 0&&(n=yn),r.op){case"ConcatV2":case"Concat":{var a=C("n",r,e,t),i=C("axis",r,e,t),o=C("tensors",r,e,t);return o=o.slice(0,a),[n.concat(o,i)]}case"Gather":{var s=C("x",r,e,t),u=C("indices",r,e,t);return[n.gather(s,n.cast(u,"int32"),0)]}case"GatherV2":{var i=C("axis",r,e,t),l=C("batchDims",r,e,t),s=C("x",r,e,t),u=C("indices",r,e,t);return[n.gather(s,n.cast(u,"int32"),i,l)]}case"Reverse":{for(var c=C("dims",r,e,t),i=[],f=0;f<c.length;f++)c[f]&&i.push(f);var s=C("x",r,e,t);return[n.reverse(s,i)]}case"ReverseV2":{var i=C("axis",r,e,t),s=C("x",r,e,t);return[n.reverse(s,i)]}case"Slice":{var h=C("begin",r,e,t),p=C("size",r,e,t);return[n.slice(C("x",r,e,t),h,p)]}case"StridedSlice":{var h=C("begin",r,e,t),d=C("end",r,e,t),m=C("strides",r,e,t),v=C("beginMask",r,e,t),g=C("endMask",r,e,t),y=C("ellipsisMask",r,e,t),b=C("newAxisMask",r,e,t),w=C("shrinkAxisMask",r,e,t),x=C("x",r,e,t);return[n.stridedSlice(x,h,d,m,v,g,y,b,w)]}case"Pack":return $e.tidy(function(){var P=C("axis",r,e,t),B=C("tensors",r,e,t),q=B[0].shape,O=n.squeeze(B[0]).shape,V=B.map(function(K){var Z=$e.util.arraysEqual(K.shape,q);if(!Z&&!$e.util.arraysEqual(n.squeeze(K).shape,O))throw new Error("the input tensors shape does not match");return Z?K:n.reshape(K,q)});return[n.stack(V,P)]});case"Unpack":{var i=C("axis",r,e,t),x=C("tensor",r,e,t);return n.unstack(x,i)}case"Tile":{var k=C("reps",r,e,t);return[n.tile(C("x",r,e,t),k)]}case"Split":case"SplitV":{var i=C("axis",r,e,t),N=C("numOrSizeSplits",r,e,t),x=C("x",r,e,t);return n.split(x,N,i)}case"ScatterNd":{var u=C("indices",r,e,t),T=C("values",r,e,t),I=C("shape",r,e,t);return[n.scatterND(u,T,I)]}case"GatherNd":{var F=C("x",r,e,t),u=C("indices",r,e,t);return[n.gatherND(F,u)]}case"SparseToDense":{var u=C("sparseIndices",r,e,t),I=C("outputShape",r,e,t),D=C("sparseValues",r,e,t),R=C("defaultValue",r,e,t);return[n.sparseToDense(u,D,I,D.dtype===R.dtype?R:n.cast(R,D.dtype))]}default:throw TypeError("Node type "+r.op+" is not implemented")}};var bFe=function(r,e,t,n){switch(n===void 0&&(n=yn),r.op){case"SparseFillEmptyRows":{var a=n.sparse.sparseFillEmptyRows(C("indices",r,e,t),C("values",r,e,t),C("denseShape",r,e,t),C("defaultValue",r,e,t)),i=a.outputIndices,o=a.outputValues,s=a.emptyRowIndicator,u=a.reverseIndexMap;return[i,o,s,u]}case"SparseReshape":{var l=n.sparse.sparseReshape(C("inputIndices",r,e,t),C("inputShape",r,e,t),C("newShape",r,e,t)),i=l.outputIndices,c=l.outputShape;return[i,c]}case"SparseSegmentMean":{var f=n.sparse.sparseSegmentMean(C("data",r,e,t),C("indices",r,e,t),C("segmentIds",r,e,t));return[f]}case"SparseSegmentSum":{var f=n.sparse.sparseSegmentSum(C("data",r,e,t),C("indices",r,e,t),C("segmentIds",r,e,t));return[f]}default:throw TypeError("Node type "+r.op+" is not implemented")}};var wFe=function(r,e,t,n){switch(n===void 0&&(n=yn),r.op){case"FFT":return[n.fft(C("x",r,e,t))];case"IFFT":return[n.ifft(C("x",r,e,t))];case"RFFT":return[n.rfft(C("x",r,e,t))];case"IRFFT":return[n.irfft(C("x",r,e,t))];default:throw TypeError("Node type "+r.op+" is not implemented")}};var xFe=function(r,e,t,n){switch(n===void 0&&(n=yn),r.op){case"StringNGrams":{var a=n.string.stringNGrams(C("data",r,e,t),C("dataSplits",r,e,t),C("separator",r,e,t),C("nGramWidths",r,e,t),C("leftPad",r,e,t),C("rightPad",r,e,t),C("padWidth",r,e,t),C("preserveShortSequences",r,e,t)),i=a.nGrams,o=a.nGramsSplits;return[i,o]}case"StringSplit":{var s=n.string.stringSplit(C("input",r,e,t),C("delimiter",r,e,t),C("skipEmpty",r,e,t)),u=s.indices,l=s.values,c=s.shape;return[u,l,c]}case"StringToHashBucketFast":{var f=n.string.stringToHashBucketFast(C("input",r,e,t),C("numBuckets",r,e,t));return[f]}default:throw TypeError("Node type "+r.op+" is not implemented")}};var kFe=function(r,e,t,n){switch(n===void 0&&(n=yn),r.op){case"Cast":return[n.cast(C("x",r,e,t),C("dtype",r,e,t))];case"ExpandDims":{var a=C("axis",r,e,t);return[n.expandDims(C("x",r,e,t),a)]}case"Squeeze":{var a=C("axis",r,e,t);return[n.squeeze(C("x",r,e,t),a)]}case"Reshape":return[n.reshape(C("x",r,e,t),C("shape",r,e,t))];case"MirrorPad":return[n.mirrorPad(C("x",r,e,t),C("padding",r,e,t),C("mode",r,e,t))];case"PadV2":case"Pad":return[n.pad(C("x",r,e,t),C("padding",r,e,t),C("constantValue",r,e,t))];case"SpaceToBatchND":{var i=C("blockShape",r,e,t),o=C("paddings",r,e,t);return[n.spaceToBatchND(C("x",r,e,t),i,o)]}case"BatchToSpaceND":{var i=C("blockShape",r,e,t),s=C("crops",r,e,t);return[n.batchToSpaceND(C("x",r,e,t),i,s)]}case"DepthToSpace":{var u=C("blockSize",r,e,t),l=C("dataFormat",r,e,t).toUpperCase();return[n.depthToSpace(C("x",r,e,t),u,l)]}case"BroadcastTo":return[n.broadcastTo(C("x",r,e,t),C("shape",r,e,t))];case"BroadcastArgs":return[n.broadcastArgs(C("s0",r,e,t),C("s1",r,e,t))];default:throw TypeError("Node type "+r.op+" is not implemented")}};function mL(r,e,t,n,a){a===void 0&&(a=qB.tidy);var i=function(o,s,u){switch(o.category){case"arithmetic":return a(function(){return X3e(o,s,u)});case"basic_math":return a(function(){return Y3e(o,s,u)});case"control":return nFe(o,s,u);case"convolution":return a(function(){return aFe(o,s,u)});case"creation":return a(function(){return iFe(o,s,u)});case"dynamic":return sFe(o,s,u);case"evaluation":return a(function(){return uFe(o,s,u)});case"image":return a(function(){return pFe(o,s,u)});case"graph":return a(function(){return lFe(o,s,u)});case"logical":return a(function(){return dFe(o,s,u)});case"matrices":return a(function(){return vFe(o,s,u)});case"normalization":return a(function(){return mFe(o,s,u)});case"reduction":return a(function(){return gFe(o,s,u)});case"slice_join":return a(function(){return yFe(o,s,u)});case"sparse":return a(function(){return bFe(o,s,u)});case"spectral":return a(function(){return wFe(o,s,u)});case"string":return a(function(){return xFe(o,s,u)});case"transformation":return a(function(){return kFe(o,s,u)});case"hash_table":return hFe(o,s,u,n);case"custom":var l=wL(o.op);if(l&&l.customExecutor)return l.customExecutor(new Cke(o,s,u));throw TypeError("Custom op "+o.op+" is not registered.");default:throw TypeError("Unknown op '"+o.op+"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(r,e,t);return qB.util.isPromise(i)?i.then(function(o){return[].concat(o)}):[].concat(i)}var gL=function(){function r(e,t,n,a){e===void 0&&(e={}),t===void 0&&(t={}),n===void 0&&(n={}),a===void 0&&(a={}),this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=n,this.functionMap=a,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return r.prototype.newFrame=function(e,t){return{id:e,frameName:t,iterationId:0}},Object.defineProperty(r.prototype,"currentContext",{get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!0,configurable:!0}),r.prototype.generateCurrentContextIds=function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e},r.prototype.contextIdforContexts=function(e){return e?e.map(function(t){return t.id===0&&t.iterationId===0?"":t.frameName+"-"+t.iterationId}).join("/"):""},r.prototype.enterFrame=function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},r.prototype.exitFrame=function(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")},r.prototype.nextIteration=function(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")},r.prototype.getWeight=function(e){return this.weightMap[e]},r.prototype.addTensorArray=function(e){this.tensorArrayMap[e.id]=e},r.prototype.getTensorArray=function(e){return this.tensorArrayMap[e]},r.prototype.addTensorList=function(e){this.tensorListMap[e.id]=e},r.prototype.getTensorList=function(e){return this.tensorListMap[e]},r.prototype.dispose=function(e){for(var t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(var t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)},r}();function yL(r,e,t,n){var a=new Set,i=[],o=null,s=null,u=new Set,l=Object.keys(r).map(function(p){return fa(p)[0]}),c=[];n!=null&&(c=n.map(function(p){return fa(p.name)[0]}));for(var f=pn(e);f.length>0;){var h=f.pop();if((Nz(h)||IFe(h)||CFe(h))&&o==null&&(o=h,s=o.children.map(function(p){return p.name}).filter(function(p){return a.has(p)})),a.add(h.name),t[h.name]==null&&l.indexOf(h.name)===-1&&c.indexOf(h.name)===-1){if(h.inputs.length===0){i.push(h.name);continue}h.inputs.forEach(function(p){u.has(p.name)||(u.add(p.name),f.push(p))})}}return{inputs:r,outputs:e,usedNodes:a,missingInputs:i,dynamicNode:o,syncInputs:s}}function SFe(r,e,t){var n=t.usedNodes,a=t.inputs,i=[],o=Object.keys(a).map(function(f){return fa(f)[0]}).map(function(f){return r.nodes[f]}),s=r.initNodes;o.forEach(function(f){n.has(f.name)&&i.push(f)}),r.weights.forEach(function(f){n.has(f.name)&&i.push(f)}),s?.forEach(function(f){n.has(f.name)&&i.push(f)});for(var u=new Set,l=[];i.length>0;){var c=i.pop();u.add(c.name),e[c.name]||l.push(c),c.children.forEach(function(f){!u.has(f.name)&&n.has(f.name)&&f.inputs.every(function(h){return u.has(h.name)})&&i.push(f)})}return l}var NFe=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],EFe=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],TFe=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function Nz(r){return NFe.indexOf(r.op)>=0}function IFe(r){return EFe.indexOf(r.op)>=0}function CFe(r){return TFe.indexOf(r.op)>=0}var bL=function(){function r(e,t){var n=this;this.graph=e,this.parent=t,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.intermediateTensors={},this.keepTensorForDebug=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,e.functions!=null&&Object.keys(e.functions).forEach(function(a){n._functionExecutorMap[a]=new r(e.functions[a],n)})}return Object.defineProperty(r.prototype,"weightIds",{get:function(){return this.parent?this.parent.weightIds:this._weightIds},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"functionExecutorMap",{get:function(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"weightMap",{get:function(){return this.parent?this.parent.weightMap:this._weightMap},set:function(e){var t=Object.keys(e).map(function(n){return e[n].map(function(a){return a.id})});this._weightIds=[].concat.apply([],pn(t)),this._weightMap=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"resourceManager",{set:function(e){this._resourceManager=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputs",{get:function(){return this._inputs.map(function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"outputs",{get:function(){return this._outputs.map(function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputNodes",{get:function(){return this._inputs.map(function(e){return e.signatureKey||e.name})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"outputNodes",{get:function(){return this._outputs.map(function(e){var t=e.signatureKey||e.name;return e.defaultOutput?t+":"+e.defaultOutput:t})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"functions",{get:function(){var e=this;return Object.keys(this._functions).reduce(function(t,n){return t[n]=e._functions[n].signature,t},{})},enumerable:!0,configurable:!0}),r.prototype.getCompilationKey=function(e,t){var n=e.map(function(i){return i.name}).sort(),a=t.map(function(i){return i.name}).sort();return n.join(this.SEPERATOR)+"--"+a.join(this.SEPERATOR)},r.prototype.compile=function(e,t){var n=yL(e,t,this.weightMap,this._initNodes),a=n.missingInputs,i=n.dynamicNode,o=n.syncInputs;if(i!=null)throw new Error("This execution contains the node '"+i.name+"', which has "+("the dynamic op '"+i.op+"'. Please use ")+"model.executeAsync() instead. Alternatively, to avoid the "+("dynamic ops, specify the inputs ["+o+"]"));if(a.length>0){var s=t.map(function(l){return l.name}),u=Object.keys(e);throw new Error("Cannot compute the outputs ["+s+"] from the provided inputs "+("["+u+"]. Missing the following inputs: ["+a+"]"))}return SFe(this.graph,this.weightMap,n)},r.prototype.execute=function(e,t){var n=this;e=this.mapInputs(e);var a=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var i=a.map(function(h){return n.graph.nodes[fa(h)[0]]}),o=t.map(function(h){return fa(h)[0]}),s=o.map(function(h){return n.graph.nodes[h]});this.resetIntermediateTensors(),s.length===0&&(s=this._outputs);var u=this.getCompilationKey(i,s),l=this.compiledMap.get(u);l==null&&(l=this.compile(e,s),this.compiledMap.set(u,l));var c={},f={};return $e.tidy(function(){var h=new gL(n.weightMap,c,f,n.functionExecutorMap),p=Object.assign({},n.weightMap);Object.keys(e).forEach(function(b){var w=Le(fa(b),2),x=w[0],k=w[1],N=[];N[k]=e[b],p[x]=N});for(var d=n.getFrozenTensorIds(p),m={},v=0;v<l.length;v++){var g=l[v];if(!p[g.name]){var y=mL(g,p,h,n._resourceManager);if($e.util.isPromise(y))throw new Error("The execution of the op '"+g.op+"' returned a promise. Please use model.executeAsync() instead.");p[g.name]=y,n.checkTensorForDisposal(g.name,g,p,h,d,o,m)}}return n.parent==null&&h.dispose(d),t.map(function(b){return Tn(b,p,h)})})},r.prototype.getFrozenTensorIds=function(e){var t=[].concat.apply([],Object.keys(e).map(function(n){return e[n]}).map(function(n){return n.map(function(a){return a.id})}));return new Set(t)},r.prototype.checkTensorForDisposal=function(e,t,n,a,i,o,s){var u=this;t.category==="control"||o.indexOf(e)!==-1||(n[e].forEach(function(l){l!=null&&(s[l.id]=(s[l.id]||0)+t.children.length)}),t.inputs.forEach(function(l){if(l.category!=="control"){var c=qxe(l.name,n,a);c?.forEach(function(f){if(f&&!f.kept&&!i.has(f.id)){var h=s[f.id];if(h===1){if(!u.keepTensorForDebug)f.dispose();else{var p=Le(eo(t.name,a),2),d=p[0],m=p[1];u.intermediateTensors[d]||(u.intermediateTensors[d]=[]),u.intermediateTensors[d][m]=f}delete s[f.id]}else h!=null&&s[f.id]--}})}}))},r.prototype.executeAsync=function(e,t){return Yt(this,void 0,void 0,function(){return Kt(this,function(n){return[2,this._executeAsync(e,t)]})})},r.prototype.disposeIntermediateTensors=function(){var e=this;!this.intermediateTensors||(Object.keys(this.intermediateTensors).forEach(function(t){return e.intermediateTensors[t].forEach(function(n){return n.dispose()})}),this.disposeTensorsMap())},r.prototype.disposeTensorsMap=function(){var e=this;!this.tensorsMap||Object.keys(this.tensorsMap).forEach(function(t){var n=e.tensorsMap[t];n.forEach(function(a){a&&!a.kept&&!a.isDisposed&&!e.keepIds.has(a.id)&&a.dispose()})})},r.prototype.getIntermediateTensors=function(){return this.tensorsMap},r.prototype.resetIntermediateTensors=function(){for(var e in this.intermediateTensors)this.intermediateTensors[e].forEach(function(t){return t.dispose()}),delete this.intermediateTensors[e]},r.prototype._executeAsync=function(e,t,n,a,i){return n===void 0&&(n=!1),a===void 0&&(a={}),i===void 0&&(i={}),Yt(this,void 0,void 0,function(){var o,s,u,l,c,f=this;return Kt(this,function(h){switch(h.label){case 0:n||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t));try{this.keepTensorForDebug=$e.env().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(p){console.warn(p.message)}return this.resetIntermediateTensors(),o=new gL(this.weightMap,a,i,this.functionExecutorMap),s=this,[4,this.executeWithControlFlow(e,o,t,n)];case 1:return s.tensorsMap=h.sent(),u=t.map(function(p){return Tn(p,f.tensorsMap,o)}),l=u.map(function(p){return p.id}),c=Object.keys(e).map(function(p){return e[p].id}),this.keepIds=new Set(pn(l,c,this.weightIds)),this.keepTensorForDebug||this.disposeTensorsMap(),this.parent==null&&o.dispose(this.keepIds),[2,u]}})})},r.prototype.executeFunctionAsync=function(e,t,n){return Yt(this,void 0,void 0,function(){var a,i=this;return Kt(this,function(o){return a=e.reduce(function(s,u,l){return s[i.inputs[l].name]=u,s},{}),[2,this._executeAsync(a,this.outputNodes,!0,t,n)]})})},r.prototype.executeWithControlFlow=function(e,t,n,a){return Yt(this,void 0,void 0,function(){var i,o,s,u,l,c,f,h,p,d,m,v,g,y,b,w,x,k=this;return Kt(this,function(N){switch(N.label){case 0:i=Object.keys(e),o=i.map(function(T){return k.graph.nodes[fa(T)[0]]}),s=n.map(function(T){return fa(T)[0]}),u=s.map(function(T){return k.graph.nodes[T]}),u.length===0&&(u=this._outputs),l=yL(e,u,this.weightMap,this._initNodes),c=l.usedNodes,f=l.missingInputs,h=l.dynamicNode,p=l.syncInputs,d=pn(o,this.graph.weights,this._initNodes||[]).map(function(T){return{node:T,contexts:t.currentContext}}),m=Object.assign({},this.weightMap),Object.keys(e).forEach(function(T){var I=Le(fa(T),2),F=I[0],D=I[1],R=[];R[D]=e[T],m[F]=R}),v={},g=this.getFrozenTensorIds(m),y={},N.label=1;case 1:return d.length>0?(b=this.processStack(o,d,t,m,y,g,s,v,c),[4,Promise.all(b)]):[3,3];case 2:return N.sent(),[3,1];case 3:if(h==null&&!a&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),w=u.filter(function(T){return!Nz(T)&&!Tn(T.name,m,t)}).map(function(T){return T.name}),w.length>0)throw x="",h!=null&&(x="Alternatively, to avoid the dynamic ops, use model.execute() "+("and specify the inputs ["+p+"]")),new Error("Cannot compute the outputs ["+w+"] from the provided "+("inputs ["+i+"]. Consider providing the following inputs: ")+("["+f+"]. "+x));return[2,m]}})})},r.prototype.processStack=function(e,t,n,a,i,o,s,u,l){for(var c=this,f=[],h=function(){var d,m,v=t.pop();n.currentContext=v.contexts;var g="";if(v.node.op==="Enter"&&C("isConstant",v.node,a,n)&&(d=Le(eo(v.node.name,n),1),g=d[0]),a[v.node.name]==null){var y=mL(v.node,a,n,p._resourceManager);g||(m=Le(eo(v.node.name,n),1),g=m[0]);var b=n.currentContext;$e.util.isPromise(y)?f.push(y.then(function(w){return a[g]=w,n.currentContext=b,c.checkTensorForDisposal(g,v.node,a,n,o,s,u),c.processChildNodes(v.node,t,n,a,i,l),w})):(a[g]=y,p.checkTensorForDisposal(g,v.node,a,n,o,s,u),p.processChildNodes(v.node,t,n,a,i,l))}else p.processChildNodes(v.node,t,n,a,i,l)},p=this;t.length>0;)h();return f},r.prototype.processChildNodes=function(e,t,n,a,i,o){e.children.forEach(function(s){var u=Le(eo(s.name,n),1),l=u[0];i[l]||!o.has(s.name)||(s.op==="Merge"?s.inputNames.some(function(c){return!!Tn(c,a,n)})&&(i[l]=!0,t.push({contexts:n.currentContext,node:s})):s.inputNames.every(function(c){return!!Tn(c,a,n)})&&(i[l]=!0,t.push({contexts:n.currentContext,node:s})))})},r.prototype.dispose=function(){var e=this;Object.keys(this.weightMap).forEach(function(t){return e.weightMap[t].forEach(function(n){return n.dispose()})})},r.prototype.checkInputShapeAndType=function(e){var t=this;Object.keys(e).forEach(function(n){var a=e[n],i=Le(fa(n),1),o=i[0],s=t.graph.nodes[o];if(s.attrParams.shape&&s.attrParams.shape.value){var u=s.attrParams.shape.value,l=u.length===a.shape.length&&a.shape.every(function(c,f){return u[f]===-1||u[f]===c});$e.util.assert(l,function(){return"The shape of dict['"+s.name+"'] provided in "+("model.execute(dict) must be ["+u+"], but was ")+("["+a.shape+"]")})}s.attrParams.dtype&&s.attrParams.dtype.value&&$e.util.assert(a.dtype===s.attrParams.dtype.value,function(){return"The dtype of dict['"+s.name+"'] provided in model.execute(dict) must be "+(s.attrParams.dtype.value+", but was "+a.dtype)})})},r.prototype.mapInputs=function(e){var t={};for(var n in e)if(this._signature!=null&&this._signature.inputs!=null&&this._signature.inputs[n]!=null){var a=this._signature.inputs[n];t[a.name]=e[n]}else t[n]=e[n];return t},r.prototype.checkInputs=function(e){var t=this,n=Object.keys(e).filter(function(a){var i=Le(fa(a),1),o=i[0];return t.graph.nodes[o]==null});if(n.length>0)throw new Error("The dict provided in model.execute(dict) has "+("keys: ["+n+"] that are not part of graph"))},r.prototype.mapOutputs=function(e){var t=this;return e.map(function(n){if(t._signature!=null&&t._signature.outputs!=null&&t._signature.outputs[n]!=null){var a=t._signature.outputs[n];return a.name}return n},{})},r.prototype.checkOutputs=function(e){var t=this;e.forEach(function(n){var a=Le(fa(n),1),i=a[0];if(!t.graph.nodes[i])throw new Error("The output '"+n+"' is not found in the graph")})},r}(),AFe=function(){function r(e,t){e===void 0&&(e={}),t===void 0&&(t={}),this.hashTableNameToHandle=e,this.hashTableMap=t}return r.prototype.addHashTable=function(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t},r.prototype.getHashTableHandleByName=function(e){return this.hashTableNameToHandle[e]},r.prototype.getHashTableById=function(e){return this.hashTableMap[e]},r.prototype.dispose=function(){for(var e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(var t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]},r}(),_Fe="?tfjs-format=file",DFe="model.json",Zx=function(){function r(e,t,n){t===void 0&&(t={}),n===void 0&&(n=$e.io),this.modelUrl=e,this.loadOptions=t,this.version="n/a",this.io=n,t==null&&(this.loadOptions={}),this.resourceManager=new AFe}return Object.defineProperty(r.prototype,"modelVersion",{get:function(){return this.version},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"metadata",{get:function(){return this.artifacts.userDefinedMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"modelSignature",{get:function(){return this.signature},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"modelStructuredOutputKeys",{get:function(){return this.structuredOutputKeys},enumerable:!0,configurable:!0}),r.prototype.findIOHandler=function(){var e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{var t=this.io.getLoadHandlers(e,this.loadOptions);if(t.length===0)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one ("+t.length+") load handlers for "+("URL '"+[e]+"'"));this.handler=t[0]}},r.prototype.load=function(){var e=this;if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");var t=this.handler.load();return $e.util.isPromise(t)?t.then(function(n){return e.loadSync(n)}):this.loadSync(t)},r.prototype.loadSync=function(e){this.artifacts=e;var t=this.artifacts.modelTopology,n=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){var a=this.artifacts.userDefinedMetadata;a.signature!=null&&(n=a.signature),a.structuredOutputKeys!=null&&(this.structuredOutputKeys=a.structuredOutputKeys)}this.signature=n,this.version=t.versions.producer+"."+t.versions.minConsumer;var i=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new bL(GB.Instance.transformGraph(t,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(i),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){var o=GB.Instance.transformGraph(e.modelInitializer);this.initializer=new bL(o),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0},r.prototype.save=function(e,t){return Yt(this,void 0,void 0,function(){var n;return Kt(this,function(a){if(typeof e=="string"){if(n=this.io.getSaveHandlers(e),n.length===0)throw new Error("Cannot find any save handlers for URL '"+e+"'");if(n.length>1)throw new Error("Found more than one ("+n.length+") save handlers for "+("URL '"+e+"'"));e=n[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[2,e.save(this.artifacts)]})})},r.prototype.predict=function(e,t){var n=this,a=this.execute(e,this.outputNodes);if(this.structuredOutputKeys){var i=a instanceof $e.Tensor?[a]:a,o={};return i.forEach(function(s,u){return o[n.structuredOutputKeys[u]]=s}),o}return a},r.prototype.normalizeInputs=function(e){if(!(e instanceof $e.Tensor)&&!Array.isArray(e))return e;if(e=Array.isArray(e)?e:[e],e.length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,"+("the graph model has "+this.inputNodes.length+" placeholders, ")+("while there are "+e.length+" input tensors."));return this.inputNodes.reduce(function(t,n,a){return t[n]=e[a],t},{})},r.prototype.normalizeOutputs=function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]},r.prototype.execute=function(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var n=this.executor.execute(e,t);return n.length>1?n:n[0]},r.prototype.executeAsync=function(e,t){return Yt(this,void 0,void 0,function(){var n;return Kt(this,function(a){switch(a.label){case 0:return e=this.normalizeInputs(e),t=this.normalizeOutputs(t),[4,this.executor.executeAsync(e,t)];case 1:return n=a.sent(),[2,n.length>1?n:n[0]]}})})},r.prototype.getIntermediateTensors=function(){return this.executor.getIntermediateTensors()},r.prototype.disposeIntermediateTensors=function(){this.executor.disposeIntermediateTensors()},r.prototype.convertTensorMapToTensorsMap=function(e){return Object.keys(e).reduce(function(t,n){return t[n]=[e[n]],t},{})},r.prototype.dispose=function(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()},r}();function FFe(r,e,t){return e===void 0&&(e={}),t===void 0&&(t=$e.io),Yt(this,void 0,void 0,function(){var n;return Kt(this,function(a){switch(a.label){case 0:if(r==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");return e==null&&(e={}),e.fromTFHub&&typeof r=="string"&&(r=OFe(r)),n=new Zx(r,e,t),[4,n.load()];case 1:return a.sent(),[2,n]}})})}function RFe(r){if(r==null)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");var e;if(r instanceof Array){var t=Le(r,2),n=t[0],a=t[1];if(!n)throw new Error("modelJSON must be the first element of the array");if(!a||!(a instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in n))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in n))throw new Error("Model JSON is missing 'weightsManifest'");var i=$e.io.getWeightSpecs(n.weightsManifest),o=$e.io.getModelArtifactsForJSONSync(n,i,a);e=$e.io.fromMemorySync(o)}else if("load"in r)e=r;else if("modelTopology"in r&&"weightSpecs"in r&&"weightData"in r)e=$e.io.fromMemorySync(r);else throw new Error("Unknown model format");var s=new Zx(e);return s.load(),s}function OFe(r){return r.endsWith("/")||(r=r+"/"),""+r+DFe+_Fe}var PFe="3.21.0";ws.GraphModel=Zx;ws.deregisterOp=Wxe;ws.loadGraphModel=FFe;ws.loadGraphModelSync=RFe;ws.registerOp=$xe;ws.version_converter=PFe});var Jx=ue(()=>{});var Tz=ue(()=>{});var Kz=ue(Vn=>{"use strict";Object.defineProperty(Vn,"__esModule",{value:!0});var _r=ru();function MFe(r){if(r&&r.__esModule)return r;var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var Tr=MFe(_r),ek=function(r,e){return ek=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},ek(r,e)};function zt(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");ek(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Me(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(f){o(f)}}function u(c){try{l(n.throw(c))}catch(f){o(f)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(r,e||[])).next())})}function Be(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(l){return function(c){return u([l,c])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=l[0]&2?a.return:l[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,l[1])).done)return i;switch(a=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,a=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){t.label=l[1];break}if(l[0]===6&&t.label<i[1]){t.label=i[1],i=l;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(l);break}i[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(c){l=[6,c],a=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Ou(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function BFe(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function LFe(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(BFe(arguments[e]));return r}var Pu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function zFe(r){if(r.__esModule)return r;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(r).forEach(function(t){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}),e}function Mu(r){var e={exports:{}};return r(e,e.exports),e.exports}var $Fe=Mu(function(r){(function(e,t,n){function a(u){var l=this,c=s();l.next=function(){var f=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=f-(l.c=f|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(u),l.s0<0&&(l.s0+=1),l.s1-=c(u),l.s1<0&&(l.s1+=1),l.s2-=c(u),l.s2<0&&(l.s2+=1),c=null}function i(u,l){return l.c=u.c,l.s0=u.s0,l.s1=u.s1,l.s2=u.s2,l}function o(u,l){var c=new a(u),f=l&&l.state,h=c.next;return h.int32=function(){return c.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,c),h.state=function(){return i(c,{})}),h}function s(){var u=4022871197,l=function(c){c=String(c);for(var f=0;f<c.length;f++){u+=c.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return l}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(Pu,r,!1)}),WFe=Mu(function(r){(function(e,t,n){function a(s){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(Pu,r,!1)}),qFe=Mu(function(r){(function(e,t,n){function a(s){var u=this,l="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(Pu,r,!1)}),VFe=Mu(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var c=u.x,f=u.i,h,p;return h=c[f],h^=h>>>7,p=h^h<<24,h=c[f+1&7],p^=h^h>>>10,h=c[f+3&7],p^=h^h>>>3,h=c[f+4&7],p^=h^h<<7,h=c[f+7&7],h=h^h<<13,p^=h^h<<9,c[f]=p,u.i=f+1&7,p};function l(c,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8&&(p[7]=-1),c.x=p,c.i=0,h=256;h>0;--h)c.next()}l(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(c.x&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(Pu,r,!1)}),GFe=Mu(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var c=u.w,f=u.X,h=u.i,p,d;return u.w=c=c+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(c^c>>>16)|0};function l(c,f){var h,p,d,m,v,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,m=-32;m<y;++m)f&&(p^=f.charCodeAt((m+32)%f.length)),m===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(v=v+1640531527|0,h=g[m&127]^=p+v,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,m=4*128;m>0;--m)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;c.w=v,c.X=g,c.i=d}l(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(c.X&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(Pu,r,!1)}),UFe=Mu(function(r){(function(e,t,n){function a(s){var u=this,l="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)u.b^=l.charCodeAt(c)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(Pu,r,!1)}),HFe={},KFe={__proto__:null,default:HFe},jFe=zFe(KFe),Bu=Mu(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),l=n.pow(2,o),c=l*2,f=a-1,h;function p(w,x,k){var N=[];x=x==!0?{entropy:!0}:x||{};var T=g(v(x.entropy?[w,b(t)]:w??y(),3),N),I=new d(N),F=function(){for(var D=I.g(i),R=u,P=0;D<l;)D=(D+P)*a,R*=a,P=I.g(1);for(;D>=c;)D/=2,R/=2,P>>>=1;return(D+P)/R};return F.int32=function(){return I.g(4)|0},F.quick=function(){return I.g(4)/4294967296},F.double=F,g(b(I.S),t),(x.pass||k||function(D,R,P,B){return B&&(B.S&&m(B,I),D.state=function(){return m(I,{})}),P?(n[s]=D,R):D})(F,T,"global"in x?x.global:this==n,x.state)}function d(w){var x,k=w.length,N=this,T=0,I=N.i=N.j=0,F=N.S=[];for(k||(w=[k++]);T<a;)F[T]=T++;for(T=0;T<a;T++)F[T]=F[I=f&I+w[T%k]+(x=F[T])],F[I]=x;(N.g=function(D){for(var R,P=0,B=N.i,q=N.j,O=N.S;D--;)R=O[B=f&B+1],P=P*a+O[f&(O[B]=O[q=f&q+R])+(O[q]=R)];return N.i=B,N.j=q,P})(a)}function m(w,x){return x.i=w.i,x.j=w.j,x.S=w.S.slice(),x}function v(w,x){var k=[],N=typeof w,T;if(x&&N=="object")for(T in w)try{k.push(v(w[T],x-1))}catch{}return k.length?k:N=="string"?w:w+"\0"}function g(w,x){for(var k=w+"",N,T=0;T<k.length;)x[f&T]=f&(N^=x[f&T]*19)+k.charCodeAt(T++);return b(x)}function y(){try{var w;return h&&(w=h.randomBytes)?w=w(a):(w=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var x=e.navigator,k=x&&x.plugins;return[+new Date,e,k,e.screen,b(t)]}}function b(w){return String.fromCharCode.apply(0,w)}if(g(n.random(),t),r.exports){r.exports=p;try{h=jFe}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:Pu,[],Math)});Bu.alea=$Fe;Bu.xor128=WFe;Bu.xorwow=qFe;Bu.xorshift7=VFe;Bu.xor4096=GFe;Bu.tychei=UFe;var _z=Bu;function XFe(r,e){return Zm(r,e)}function Zm(r,e,t,n){if(t===void 0&&(t=new Map),n===void 0&&(n=new Set),r==null)return null;if(typeof Blob=="function"&&r instanceof Blob)return r.slice();if(n.has(r))throw new Error("Circular references are not supported.");if(t.has(r))return t.get(r);var a=e(r);if(a.recurse&&a.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse)if(lc(r)){var i=Array.isArray(r)?[]:{};n.add(r);for(var o in r){var s=r[o],u=Zm(s,e,t,n);i[o]=u}return n.delete(r),r.__proto__&&(i.__proto__=r.__proto__),i}else throw new Error("Can't recurse into non-iterable type: "+r);else return t.set(r,a.value),a.value}function YFe(r,e){return e===void 0&&(e=Fz),Dz(r,e)}function Dz(r,e,t){t===void 0&&(t=new Set);var n=r[0];if(t.has(n))throw new Error("Circular references are not supported.");var a=e(r);if(a.recurse&&a.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse)if(lc(n)){var i=Array.isArray(n)?[]:{};t.add(n);var o=function(u){var l=r.map(function(f){return f[u]}),c=Dz(l,e,t);i[u]=c};for(var s in n)o(s);return t.delete(n),i}else throw new Error("Can't recurse into non-iterable type: "+n);else return a.value}function Fz(r){return r===null?null:lc(r[0])?{value:null,recurse:!0}:{value:r,recurse:!1}}function Rz(r,e){return Me(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c,f;return Be(this,function(h){switch(h.label){case 0:t=new Map,Zm(r,e,t),h.label=1;case 1:h.trys.push([1,6,7,8]),n=Ou(Array.from(t.keys())),a=n.next(),h.label=2;case 2:return a.done?[3,5]:(i=a.value,o=t.get(i),Tr.util.isPromise(o)?[4,o]:[3,4]);case 3:s=h.sent(),t.set(i,s),h.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return u=h.sent(),c={error:u},[3,8];case 7:try{a&&!a.done&&(f=n.return)&&f.call(n)}finally{if(c)throw c.error}return[7];case 8:return l=Zm(r,e,t),[2,l]}})})}function lc(r){var e=!1;if(Tr.env().get("IS_BROWSER"))e=r instanceof TextDecoder;else{var t=Jx().StringDecoder;e=r instanceof t}return r!=null&&!ArrayBuffer.isView(r)&&(Array.isArray(r)||typeof r=="object"&&!(r instanceof Tr.Tensor)&&!(r instanceof Promise)&&!e)}function ZFe(r){return r==null||JFe(r)||Array.isArray(r)||typeof r=="object"&&r instanceof Tr.Tensor||Tr.util.isTypedArray(r)}function JFe(r){return r===null||typeof r!="object"&&typeof r!="function"}function QFe(r){return XFe(r,eRe)}function eRe(r){return r instanceof Tr.Tensor?{value:r.clone(),recurse:!1}:lc(r)?{value:null,recurse:!0}:{value:r,recurse:!1}}var Oz=function(){function r(e){if(this.capacity=e,this.begin=0,this.end=0,e==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}return r.prototype.wrap=function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity},r.prototype.get=function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]},r.prototype.set=function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t},r.prototype.length=function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e},r.prototype.isFull=function(){return this.length()===this.capacity},r.prototype.isEmpty=function(){return this.length()===0},r.prototype.push=function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)},r.prototype.pushAll=function(e){var t,n;try{for(var a=Ou(e),i=a.next();!i.done;i=a.next()){var o=i.value;this.push(o)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},r.prototype.pop=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e},r.prototype.unshift=function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)},r.prototype.shift=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e},r.prototype.shuffleExcise=function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n},r}(),Pz=function(r){zt(e,r);function e(){return r.call(this,e.INITIAL_CAPACITY)||this}return e.prototype.isFull=function(){return!1},e.prototype.push=function(t){r.prototype.isFull.call(this)&&this.expand(),r.prototype.push.call(this,t)},e.prototype.unshift=function(t){r.prototype.isFull.call(this)&&this.expand(),r.prototype.unshift.call(this,t)},e.prototype.expand=function(){for(var t=this.capacity*2,n=new Array(t),a=this.length(),i=0;i<a;i++)n[i]=this.get(this.wrap(this.begin+i));this.data=n,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=a},e}(Oz);Pz.INITIAL_CAPACITY=32;function Mz(r){return new nRe(r)}function tk(r){return new aRe(r)}function tRe(r,e){return new Bz(r,e)}function rRe(r,e){return e===void 0&&(e=xs.FAIL),new pRe(r,e)}var cn=function(){function r(){}return r.prototype.toArray=function(){return Me(this,void 0,void 0,function(){var e,t;return Be(this,function(n){switch(n.label){case 0:return e=[],[4,this.next()];case 1:t=n.sent(),n.label=2;case 2:return t.done?[3,4]:(e.push(t.value),[4,this.next()]);case 3:return t=n.sent(),[3,2];case 4:return[2,e]}})})},r.prototype.toArrayForTest=function(){return Me(this,void 0,void 0,function(){var e,t,n;return Be(this,function(a){switch(a.label){case 0:return e=this.prefetch(100),t=[],[4,e.next()];case 1:n=a.sent(),a.label=2;case 2:return n.done?[3,4]:(t.push(n.value),[4,e.next()]);case 3:return n=a.sent(),[3,2];case 4:return[2,t]}})})},r.prototype.resolveFully=function(){return Me(this,void 0,void 0,function(){var e;return Be(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:e=t.sent(),t.label=2;case 2:return e.done?[3,4]:[4,this.next()];case 3:return e=t.sent(),[3,2];case 4:return[2]}})})},r.prototype.resolveWhile=function(e){return Me(this,void 0,void 0,function(){var t,n;return Be(this,function(a){switch(a.label){case 0:return[4,this.next()];case 1:t=a.sent(),n=e(t.value),a.label=2;case 2:return!t.done&&n?[4,this.next()]:[3,4];case 3:return t=a.sent(),n=e(t.value),[3,2];case 4:return[2]}})})},r.prototype.handleErrors=function(e){return new fRe(this,e)},r.prototype.filter=function(e){return new lRe(this,e)},r.prototype.map=function(e){return new cRe(this,e)},r.prototype.mapAsync=function(e){return new Iz(this,e)},r.prototype.serialMapAsync=function(e){return new Iz(this,e).serial()},r.prototype.flatmap=function(e){return new hRe(this,e)},r.prototype.forEachAsync=function(e){return Me(this,void 0,void 0,function(){return Be(this,function(t){return[2,this.map(e).resolveFully()]})})},r.prototype.serialForEach=function(e){return Me(this,void 0,void 0,function(){return Be(this,function(t){return[2,this.serialMapAsync(e).resolveWhile(function(n){return n===!0})]})})},r.prototype.rowMajorBatch=function(e,t){return t===void 0&&(t=!0),new uRe(this,e,t)},r.prototype.columnMajorBatch=function(e,t,n){t===void 0&&(t=!0),n===void 0&&(n=Fz);var a=this.rowMajorBatch(e,t);return a.map(function(i){return YFe(i,n)})},r.prototype.concatenate=function(e,t){return new Bz(Mz([this,e]),t)},r.prototype.take=function(e){return e<0||e==null?this:new sRe(this,e)},r.prototype.skip=function(e){return e<0||e==null?this:new oRe(this,e)},r.prototype.prefetch=function(e){return new Lz(this,e)},r.prototype.shuffle=function(e,t){return new dRe(this,e,t)},r.prototype.serial=function(){return new iRe(this)},r}(),nRe=function(r){zt(e,r);function e(t){var n=r.call(this)||this;return n.items=t,n.trav=0,n}return e.prototype.summary=function(){return"Array of "+this.items.length+" items"},e.prototype.next=function(){return Me(this,void 0,void 0,function(){var t;return Be(this,function(n){return this.trav>=this.items.length?[2,{value:null,done:!0}]:(t=this.items[this.trav],this.trav++,[2,{value:QFe(t),done:!1}])})})},e}(cn),aRe=function(r){zt(e,r);function e(t){var n=r.call(this)||this;return n.nextFn=t,n}return e.prototype.summary=function(){return"Function call"},e.prototype.next=function(){return Me(this,void 0,void 0,function(){return Be(this,function(t){try{return[2,this.nextFn()]}catch(n){throw n.message="Error thrown while iterating through a dataset: "+n.message,n}return[2]})})},e}(cn),iRe=function(r){zt(e,r);function e(t){var n=r.call(this)||this;return n.upstream=t,n.lastRead=Promise.resolve({value:null,done:!1}),n}return e.prototype.summary=function(){return this.upstream.summary()+" -> Serial"},e.prototype.next=function(){return Me(this,void 0,void 0,function(){var t=this;return Be(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Me(this,void 0,void 0,function(){return Be(this,function(t){return[2,this.upstream.next()]})})},e}(cn),oRe=function(r){zt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.maxCount=n,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return this.upstream.summary()+" -> Skip"},e.prototype.next=function(){return Me(this,void 0,void 0,function(){var t=this;return Be(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Me(this,void 0,void 0,function(){var t;return Be(this,function(n){switch(n.label){case 0:return this.count++<this.maxCount?[4,this.upstream.next()]:[3,2];case 1:return t=n.sent(),t.done?[2,t]:(Tr.dispose(t.value),[3,0]);case 2:return[2,this.upstream.next()]}})})},e}(cn),sRe=function(r){zt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.maxCount=n,a.count=0,a}return e.prototype.summary=function(){return this.upstream.summary()+" -> Take"},e.prototype.next=function(){return Me(this,void 0,void 0,function(){return Be(this,function(t){return this.count++>=this.maxCount?[2,{value:null,done:!0}]:[2,this.upstream.next()]})})},e}(cn),uRe=function(r){zt(e,r);function e(t,n,a){a===void 0&&(a=!0);var i=r.call(this)||this;return i.upstream=t,i.batchSize=n,i.enableSmallLastBatch=a,i.lastRead=Promise.resolve({value:null,done:!1}),i}return e.prototype.summary=function(){return this.upstream.summary()+" -> RowMajorBatch"},e.prototype.next=function(){return Me(this,void 0,void 0,function(){var t=this;return Be(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Me(this,void 0,void 0,function(){var t,n;return Be(this,function(a){switch(a.label){case 0:t=[],a.label=1;case 1:return t.length<this.batchSize?[4,this.upstream.next()]:[3,3];case 2:return n=a.sent(),n.done?this.enableSmallLastBatch&&t.length>0?[2,{value:t,done:!1}]:[2,{value:null,done:!0}]:(t.push(n.value),[3,1]);case 3:return[2,{value:t,done:!1}]}})})},e}(cn),lRe=function(r){zt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.predicate=n,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return this.upstream.summary()+" -> Filter"},e.prototype.next=function(){return Me(this,void 0,void 0,function(){var t=this;return Be(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Me(this,void 0,void 0,function(){var t;return Be(this,function(n){switch(n.label){case 0:return[4,this.upstream.next()];case 1:return t=n.sent(),t.done||this.predicate(t.value)?[2,t]:(Tr.dispose(t.value),[3,0]);case 2:return[2]}})})},e}(cn),cRe=function(r){zt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.transform=n,a}return e.prototype.summary=function(){return this.upstream.summary()+" -> Map"},e.prototype.next=function(){return Me(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c;return Be(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:if(t=f.sent(),t.done)return[2,{value:null,done:!0}];n=Tr.tensor_util.getTensorsInContainer(t.value),a=this.transform(t.value),i=Tr.tensor_util.getTensorsInContainer(a);try{for(o=Ou(n),s=o.next();!s.done;s=o.next())u=s.value,Tr.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){l={error:h}}finally{try{s&&!s.done&&(c=o.return)&&c.call(o)}finally{if(l)throw l.error}}return[2,{value:a,done:!1}]}})})},e}(cn),fRe=function(r){zt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.handler=n,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return this.upstream.summary()+" -> handleErrors"},e.prototype.next=function(){return Me(this,void 0,void 0,function(){var t=this;return Be(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Me(this,void 0,void 0,function(){var t;return Be(this,function(n){switch(n.label){case 0:n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.upstream.next()];case 2:return[2,n.sent()];case 3:return t=n.sent(),this.handler(t)?[3,4]:[2,{value:null,done:!0}];case 4:return[3,0];case 5:return[2]}})})},e}(cn),Iz=function(r){zt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.transform=n,a}return e.prototype.summary=function(){return this.upstream.summary()+" -> AsyncMap"},e.prototype.next=function(){return Me(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c;return Be(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:return t=f.sent(),t.done?[2,{value:null,done:!0}]:(n=Tr.tensor_util.getTensorsInContainer(t.value),[4,this.transform(t.value)]);case 2:a=f.sent(),i=Tr.tensor_util.getTensorsInContainer(a);try{for(o=Ou(n),s=o.next();!s.done;s=o.next())u=s.value,Tr.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){l={error:h}}finally{try{s&&!s.done&&(c=o.return)&&c.call(o)}finally{if(l)throw l.error}}return[2,{value:a,done:!1}]}})})},e}(cn),rk=function(r){zt(e,r);function e(){var t=r.call(this)||this;return t.outputQueue=new Pz,t.lastRead=Promise.resolve({value:null,done:!1}),t}return e.prototype.next=function(){return Me(this,void 0,void 0,function(){var t=this;return Be(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Me(this,void 0,void 0,function(){return Be(this,function(t){switch(t.label){case 0:return this.outputQueue.length()!==0?[3,2]:[4,this.pump()];case 1:return t.sent()?[3,0]:[2,{value:null,done:!0}];case 2:return[2,{value:this.outputQueue.shift(),done:!1}]}})})},e}(cn),hRe=function(r){zt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.transform=n,a}return e.prototype.summary=function(){return this.upstream.summary()+" -> Flatmap"},e.prototype.pump=function(){return Me(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c;return Be(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:if(t=f.sent(),t.done)return[2,!1];n=Tr.tensor_util.getTensorsInContainer(t.value),a=this.transform(t.value),i=Tr.tensor_util.getTensorsInContainer(a),this.outputQueue.pushAll(a);try{for(o=Ou(n),s=o.next();!s.done;s=o.next())u=s.value,Tr.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){l={error:h}}finally{try{s&&!s.done&&(c=o.return)&&c.call(o)}finally{if(l)throw l.error}}return[2,!0]}})})},e}(rk),Bz=function(r){zt(e,r);function e(t,n){var a=r.call(this)||this;return a.baseErrorHandler=n,a.lastRead=null,a.iterator=null,a.moreIterators=t,a}return e.prototype.summary=function(){var t="TODO: fill in upstream of chained summaries";return t+" -> Chained"},e.prototype.next=function(){return Me(this,void 0,void 0,function(){return Be(this,function(t){return this.lastRead=this.readFromChain(this.lastRead),[2,this.lastRead]})})},e.prototype.readFromChain=function(t){return Me(this,void 0,void 0,function(){var n,a;return Be(this,function(i){switch(i.label){case 0:return[4,t];case 1:return i.sent(),this.iterator!=null?[3,3]:[4,this.moreIterators.next()];case 2:if(n=i.sent(),n.done)return[2,{value:null,done:!0}];this.iterator=n.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler)),i.label=3;case 3:return[4,this.iterator.next()];case 4:return a=i.sent(),a.done?(this.iterator=null,[2,this.readFromChain(t)]):[2,a]}})})},e}(cn),xs;(function(r){r[r.FAIL=0]="FAIL",r[r.SHORTEST=1]="SHORTEST",r[r.LONGEST=2]="LONGEST"})(xs||(xs={}));var pRe=function(r){zt(e,r);function e(t,n){n===void 0&&(n=xs.FAIL);var a=r.call(this)||this;return a.iterators=t,a.mismatchMode=n,a.count=0,a.currentPromise=null,a}return e.prototype.summary=function(){var t="TODO: fill in upstream of zip summaries";return"{"+t+"} -> Zip"},e.prototype.nextState=function(t){return Me(this,void 0,void 0,function(){function n(s){if(s instanceof cn){var u=s.next();return{value:u.then(function(l){return a++,l.done&&i++,l.value}),recurse:!1}}else return{value:null,recurse:!0}}var a,i,o;return Be(this,function(s){switch(s.label){case 0:return[4,t];case 1:return s.sent(),a=0,i=0,[4,Rz(this.iterators,n)];case 2:if(o=s.sent(),a===i)return[2,{value:null,done:!0}];if(i>0)switch(this.mismatchMode){case xs.FAIL:throw new Error("Zipped streams should have the same length. "+("Mismatched at element "+this.count+"."));case xs.SHORTEST:return[2,{value:null,done:!0}];case xs.LONGEST:}return this.count++,[2,{value:o,done:!1}]}})})},e.prototype.next=function(){return Me(this,void 0,void 0,function(){return Be(this,function(t){return this.currentPromise=this.nextState(this.currentPromise),[2,this.currentPromise]})})},e}(cn),Lz=function(r){zt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.bufferSize=n,a.buffer=new Oz(n),a}return e.prototype.summary=function(){return this.upstream.summary()+" -> Prefetch"},e.prototype.refill=function(){for(;!this.buffer.isFull();){var t=this.upstream.next();this.buffer.push(t)}},e.prototype.next=function(){return this.refill(),this.buffer.shift()},e}(cn),dRe=function(r){zt(e,r);function e(t,n,a){var i=r.call(this,t,n)||this;return i.upstream=t,i.windowSize=n,i.upstreamExhausted=!1,i.random=_z.alea(a||Tr.util.now().toString()),i.lastRead=Promise.resolve({value:null,done:!1}),i}return e.prototype.next=function(){return Me(this,void 0,void 0,function(){var t=this;return Be(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.randomInt=function(t){return Math.floor(this.random()*t)},e.prototype.chooseIndex=function(){return this.randomInt(this.buffer.length())},e.prototype.serialNext=function(){return Me(this,void 0,void 0,function(){var t,n;return Be(this,function(a){switch(a.label){case 0:this.upstreamExhausted||this.refill(),a.label=1;case 1:return this.buffer.isEmpty()?[3,3]:(t=this.chooseIndex(),[4,this.buffer.shuffleExcise(t)]);case 2:if(n=a.sent(),n.done)this.upstreamExhausted=!0;else return this.refill(),[2,n];return[3,1];case 3:return[2,{value:null,done:!0}]}})})},e}(Lz),cc=function(){function r(){this.size=null}return r.prototype.batch=function(e,t){var n=this;t===void 0&&(t=!0);var a=this;Tr.util.assert(e>0,function(){return`batchSize needs to be positive, but it is
      `+e});var i;return this.size===1/0||this.size==null?i=this.size:t?i=Math.ceil(this.size/e):i=Math.floor(this.size/e),va(function(){return Me(n,void 0,void 0,function(){return Be(this,function(o){switch(o.label){case 0:return[4,a.iterator()];case 1:return[2,o.sent().columnMajorBatch(e,t,gRe)]}})})},i)},r.prototype.concatenate=function(e){var t=this,n=this,a;return this.size===1/0||e.size===1/0?a=1/0:this.size!=null&&e.size!=null?a=this.size+e.size:a=null,va(function(){return Me(t,void 0,void 0,function(){var i,o;return Be(this,function(s){switch(s.label){case 0:return[4,n.iterator()];case 1:return o=(i=s.sent()).concatenate,[4,e.iterator()];case 2:return[2,o.apply(i,[s.sent()])]}})})},a)},r.prototype.filter=function(e){var t=this,n=this,a;return this.size===1/0?a=1/0:a=null,va(function(){return Me(t,void 0,void 0,function(){return Be(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().filter(function(o){return Tr.tidy(function(){return e(o)})})]}})})},a)},r.prototype.forEachAsync=function(e){return Me(this,void 0,void 0,function(){return Be(this,function(t){switch(t.label){case 0:return[4,this.iterator()];case 1:return[2,t.sent().forEachAsync(e)]}})})},r.prototype.map=function(e){var t=this,n=this;return va(function(){return Me(t,void 0,void 0,function(){return Be(this,function(a){switch(a.label){case 0:return[4,n.iterator()];case 1:return[2,a.sent().map(function(i){return Tr.tidy(function(){return e(i)})})]}})})},this.size)},r.prototype.mapAsync=function(e){var t=this,n=this;return va(function(){return Me(t,void 0,void 0,function(){return Be(this,function(a){switch(a.label){case 0:return[4,n.iterator()];case 1:return[2,a.sent().mapAsync(e)]}})})},this.size)},r.prototype.prefetch=function(e){var t=this;if(e==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var n=this;return va(function(){return Me(t,void 0,void 0,function(){return Be(this,function(a){switch(a.label){case 0:return[4,n.iterator()];case 1:return[2,a.sent().prefetch(e)]}})})},this.size)},r.prototype.repeat=function(e){var t=this,n=this,a;return this.size!=null&&e>0?a=this.size*e:e===0?a=0:this.size!=null&&(e===void 0||e<0)?a=1/0:a=null,va(function(){return Me(t,void 0,void 0,function(){var i,o=this;return Be(this,function(s){return i=tk(function(){return Me(o,void 0,void 0,function(){var u;return Be(this,function(l){switch(l.label){case 0:return u={},[4,n.iterator()];case 1:return[2,(u.value=l.sent(),u.done=!1,u)]}})})}),[2,tRe(i.take(e))]})})},a)},r.prototype.skip=function(e){var t=this,n=this,a;return this.size!=null&&e>=0&&this.size>=e?a=this.size-e:this.size!=null&&(this.size<e||e===void 0||e<0)?a=0:a=null,va(function(){return Me(t,void 0,void 0,function(){return Be(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().skip(e)]}})})},a)},r.prototype.shuffle=function(e,t,n){var a=this;if(n===void 0&&(n=!0),e==null||e<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting "+("bufferSize to the dataset size ("+this.size+" elements)"));var i=this,o=_z.alea(t||Tr.util.now().toString());return va(function(){return Me(a,void 0,void 0,function(){var s;return Be(this,function(u){switch(u.label){case 0:return s=o.int32(),n&&(s+=o.int32()),[4,i.iterator()];case 1:return[2,u.sent().shuffle(e,s.toString())]}})})},this.size)},r.prototype.take=function(e){var t=this,n=this,a;return this.size!=null&&this.size>e?a=e:this.size!=null&&this.size<=e?a=this.size:a=null,va(function(){return Me(t,void 0,void 0,function(){return Be(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().take(e)]}})})},a)},r.prototype.toArray=function(){return Me(this,void 0,void 0,function(){return Be(this,function(e){switch(e.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,e.sent().toArray()]}})})},r.prototype.toArrayForTest=function(){return Me(this,void 0,void 0,function(){return Be(this,function(e){switch(e.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,e.sent().toArrayForTest()]}})})},r}();cc.MAX_BUFFER_SIZE=1e4;function va(r,e){return e===void 0&&(e=null),new(function(t){zt(n,t);function n(){var a=t.apply(this,LFe(arguments))||this;return a.size=e,a}return n.prototype.iterator=function(){return Me(this,void 0,void 0,function(){return Be(this,function(a){return[2,r()]})})},n}(cc))}function vRe(r){var e=this;return va(function(){return Me(e,void 0,void 0,function(){return Be(this,function(t){return[2,Mz(r)]})})},r.length)}function mRe(r){var e=this;if(!lc(r))throw new Error("The argument to zip() must be an object or array.");var t;if(Array.isArray(r))for(var n=0;n<r.length;n++)t=t==null?r[n].size:Math.min(t,r[n].size);else if(r instanceof Object)for(var a in r)t=t==null?r[a].size:Math.min(t,r[a].size);return va(function(){return Me(e,void 0,void 0,function(){var i;return Be(this,function(o){switch(o.label){case 0:return[4,Rz(r,function(s){if(s instanceof cc)return{value:s.iterator(),recurse:!1};if(lc(s))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")})];case 1:return i=o.sent(),[2,rRe(i,xs.SHORTEST)]}})})},t)}function gRe(r){if(r===null)return null;var e=r[0];if(ZFe(e)){var t=yRe(r);return{value:t,recurse:!1}}return{value:null,recurse:!0}}function yRe(r){if(r.length===0)throw new Error("Can't make a batch of zero elements.");return r[0]instanceof Tr.Tensor?Tr.stack(r):Tr.tensor(r)}var zz=function(r){zt(e,r);function e(t){var n=r.call(this)||this;return n.input=t,n}return e.prototype.iterator=function(){return Me(this,void 0,void 0,function(){var t,n,a;return Be(this,function(i){switch(i.label){case 0:return[4,this.input.iterator()];case 1:return t=i.sent(),n=t.decodeUTF8(),a=n.split(`
`).map(function(o){return o.endsWith("\r")&&(o=o.slice(0,-1)),o}),[2,a]}})})},e}(cc),Xm='"',Gh=Symbol("out"),Cz=Symbol("field"),Ym=Symbol("quote"),Qx=Symbol("quoteafterquote"),Az=Symbol("quoteinquote"),$z=function(r){zt(e,r);function e(t,n){var a=r.call(this)||this;return a.input=t,a.hasHeader=!0,a.fullColumnNames=null,a.columnNamesValidated=!1,a.columnConfigs=null,a.configuredColumnsOnly=!1,a.delimiter=",",a.delimWhitespace=!1,a.base=new zz(t),n||(n={}),a.hasHeader=n.hasHeader!==!1,a.fullColumnNames=n.columnNames,a.columnConfigs=n.columnConfigs,a.configuredColumnsOnly=n.configuredColumnsOnly,n.delimWhitespace?(_r.util.assert(n.delimiter==null,function(){return"Delimiter should not be provided when delimWhitespace is true."}),a.delimWhitespace=!0,a.delimiter=" "):a.delimiter=n.delimiter?n.delimiter:",",a}return e.prototype.columnNames=function(){return Me(this,void 0,void 0,function(){return Be(this,function(t){switch(t.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:t.sent(),t.label=2;case 2:return[2,this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames]}})})},e.prototype.setColumnNames=function(){return Me(this,void 0,void 0,function(){var t,n,a,i,o,s,u,l,c,f=this;return Be(this,function(h){switch(h.label){case 0:return[4,this.maybeReadHeaderLine()];case 1:if(t=h.sent(),!this.fullColumnNames&&!t)throw new Error("Column names must be provided if there is no header line.");if(this.fullColumnNames&&t&&_r.util.assert(t.length===this.fullColumnNames.length,function(){return"The length of provided columnNames ("+f.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+")."}),this.fullColumnNames||(this.fullColumnNames=t),n=this.fullColumnNames.reduce(function(p,d){return p[d]=p[d]+1||1,p},{}),a=Object.keys(n).filter(function(p){return n[p]>1}),_r.util.assert(a.length===0,function(){return"Duplicate column names found: "+a.toString()}),this.columnConfigs)try{for(i=Ou(Object.keys(this.columnConfigs)),o=i.next();!o.done;o=i.next())if(s=o.value,u=this.fullColumnNames.indexOf(s),u===-1)throw new Error('The key "'+s+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}catch(p){l={error:p}}finally{try{o&&!o.done&&(c=i.return)&&c.call(i)}finally{if(l)throw l.error}}return this.columnNamesValidated=!0,[2]}})})},e.prototype.maybeReadHeaderLine=function(){return Me(this,void 0,void 0,function(){var t,n,a,i;return Be(this,function(o){switch(o.label){case 0:return this.hasHeader?[4,this.base.iterator()]:[3,3];case 1:return t=o.sent(),[4,t.next()];case 2:if(n=o.sent(),n.done)throw new Error("No data was found for CSV parsing.");return a=n.value,i=this.parseRow(a,!1),[2,i];case 3:return[2,null]}})})},e.prototype.iterator=function(){return Me(this,void 0,void 0,function(){var t,n=this;return Be(this,function(a){switch(a.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:a.sent(),a.label=2;case 2:return[4,this.base.iterator()];case 3:return t=a.sent(),this.hasHeader&&(t=t.skip(1)),[2,t.map(function(i){return n.makeDataElement(i)})]}})})},e.prototype.makeDataElement=function(t){for(var n=this.parseRow(t),a={},i={},o=0;o<this.fullColumnNames.length;o++){var s=this.fullColumnNames[o],u=this.columnConfigs?this.columnConfigs[s]:null;if(!(this.configuredColumnsOnly&&!u)){var l=n[o],c=null;if(l==="")if(u&&u.default!==void 0)c=u.default;else{if(u&&(u.required||u.isLabel))throw new Error("Required column "+s+" is empty in this line: "+t);c=void 0}else{var f=Number(l);if(isNaN(f))u&&u.dtype==="bool"?c=this.getBoolean(l):c=l;else if(!u||!u.dtype)c=f;else switch(u.dtype){case"float32":c=f;break;case"int32":c=Math.floor(f);break;case"bool":c=this.getBoolean(l);break;default:c=f}}u&&u.isLabel?i[s]=c:a[s]=c}}return Object.keys(i).length===0?a:{xs:a,ys:i}},e.prototype.getBoolean=function(t){return t==="1"||t.toLowerCase()==="true"?1:0},e.prototype.parseRow=function(t,n){n===void 0&&(n=!0);for(var a=[],i=0,o=t.length,s=Gh,u=0;u<o;u++)switch(s){case Gh:switch(t.charAt(u)){case Xm:i=u+1,s=Ym;break;case this.delimiter:if(i=u+1,this.delimiter===" "&&this.delimWhitespace)break;a.push(""),s=Gh;break;default:s=Cz,i=u;break}break;case Cz:switch(t.charAt(u)){case this.delimiter:a.push(t.substring(i,u)),s=Gh,i=u+1;break}break;case Ym:switch(t.charAt(u)){case Xm:s=Qx;break}break;case Qx:switch(t.charAt(u)){case this.delimiter:a.push(t.substring(i,u-1)),s=Gh,i=u+1;break;case Xm:s=Ym;break;default:s=Az;break}break;case Az:switch(t.charAt(u)){case Xm:s=Ym;break}break}if(s===Qx?a.push(t.substring(i,o-1)):a.push(t.substring(i)),n&&a.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have "+this.fullColumnNames.length+" elements in a row, but got "+a);return a},e}(cc),bRe=function(r){zt(e,r);function e(t){var n=r.call(this)||this;n.microphoneConfig=t,n.isClosed=!1,n.fftSize=t.fftSize||1024;var a=Math.log2(n.fftSize);if(n.fftSize<0||a<4||a>14||!Number.isInteger(a))throw new Error("Invalid fftSize: it must be a power of 2 between "+("2 to 4 and 2 to 14, but got "+n.fftSize));if(n.numFrames=t.numFramesPerSpectrogram||43,n.sampleRateHz=t.sampleRateHz,n.columnTruncateLength=t.columnTruncateLength||n.fftSize,n.audioTrackConstraints=t.audioTrackConstraints,n.smoothingTimeConstant=t.smoothingTimeConstant||0,n.includeSpectrogram=t.includeSpectrogram!==!1,n.includeWaveform=t.includeWaveform===!0,!n.includeSpectrogram&&!n.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return n}return e.prototype.summary=function(){return"microphone"},e.create=function(t){return t===void 0&&(t={}),Me(this,void 0,void 0,function(){var n;return Be(this,function(a){switch(a.label){case 0:if(!_r.env().get("IS_BROWSER"))throw new Error("microphone API is only supported in browser environment.");return n=new e(t),[4,n.start()];case 1:return a.sent(),[2,n]}})})},e.prototype.start=function(){return Me(this,void 0,void 0,function(){var t,n,a,i;return Be(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),t=this,[4,navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null?!0:this.audioTrackConstraints,video:!1})];case 1:return t.stream=o.sent(),[3,3];case 2:throw n=o.sent(),new Error("Error thrown while initializing video stream: "+n.message);case 3:if(!this.stream)throw new Error("Could not obtain audio from microphone.");if(a=window.AudioContext||window.webkitAudioContext,this.audioContext=new a,!this.sampleRateHz)this.sampleRateHz=this.audioContext.sampleRate;else if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error("Mismatch in sampling rate: "+("Expected: "+this.sampleRateHz+"; ")+("Actual: "+this.audioContext.sampleRate));return i=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.fftSize*2,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,i.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize),[2]}})})},e.prototype.next=function(){return Me(this,void 0,void 0,function(){var t,n,a,i,o;return Be(this,function(s){switch(s.label){case 0:return this.isClosed?[2,{value:null,done:!0}]:[4,this.getAudioData()];case 1:return a=s.sent(),this.includeSpectrogram&&(i=this.flattenQueue(a.freqDataQueue),t=this.getTensorFromAudioDataArray(i,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(o=this.flattenQueue(a.timeDataQueue),n=this.getTensorFromAudioDataArray(o,[this.numFrames*this.fftSize,1])),[2,{value:{spectrogram:t,waveform:n},done:!1}]}})})},e.prototype.capture=function(){return Me(this,void 0,void 0,function(){return Be(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:return[2,t.sent().value]}})})},e.prototype.getAudioData=function(){return Me(this,void 0,void 0,function(){var t,n,a,i=this;return Be(this,function(o){return t=[],n=[],a=0,[2,new Promise(function(s){var u=setInterval(function(){i.includeSpectrogram&&(i.analyser.getFloatFrequencyData(i.freqData),i.freqData[0]===-1/0&&s({freqDataQueue:t,timeDataQueue:n}),t.push(i.freqData.slice(0,i.columnTruncateLength))),i.includeWaveform&&(i.analyser.getFloatTimeDomainData(i.timeData),n.push(i.timeData.slice())),++a===i.numFrames&&(clearInterval(u),s({freqDataQueue:t,timeDataQueue:n}))},i.fftSize/i.sampleRateHz*1e3)})]})})},e.prototype.stop=function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())},e.prototype.toArray=function(){throw new Error("Can not convert infinite audio stream to array.")},e.prototype.getSampleRate=function(){return this.sampleRateHz},e.prototype.flattenQueue=function(t){var n=t[0].length,a=new Float32Array(t.length*n);return t.forEach(function(i,o){return a.set(i,o*n)}),a},e.prototype.getTensorFromAudioDataArray=function(t,n){var a=new Float32Array(_r.util.sizeFromShape(n));return a.set(t,a.length-t.length),_r.tensor(a,n)},e}(cn),wRe=function(r){zt(e,r);function e(t,n){var a=r.call(this)||this;if(a.webcamVideoElement=t,a.webcamConfig=n,a.isClosed=!0,a.resize=!1,a.needToResize())if(a.resize=!0,a.cropSize=[a.webcamConfig.resizeHeight,a.webcamConfig.resizeWidth],a.cropBoxInd=_r.tensor1d([0],"int32"),a.webcamConfig.centerCrop){var i=a.webcamConfig.resizeWidth*1/a.webcamVideoElement.width,o=a.webcamConfig.resizeHeight*1/a.webcamVideoElement.height,s=(1-i)/2,u=(1-o)/2,l=s+i,c=o+u;a.cropBox=_r.tensor2d([u,s,c,l],[1,4])}else a.cropBox=_r.tensor2d([0,0,1,1],[1,4]);return a}return e.prototype.summary=function(){return"webcam"},e.create=function(t,n){return n===void 0&&(n={}),Me(this,void 0,void 0,function(){var a;return Be(this,function(i){switch(i.label){case 0:if(!_r.env().get("IS_BROWSER"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!t){if(t=document.createElement("video"),!n.resizeWidth||!n.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");t.width=n.resizeWidth,t.height=n.resizeHeight}return a=new e(t,n),[4,a.start()];case 1:return i.sent(),[2,a]}})})},e.prototype.start=function(){return Me(this,void 0,void 0,function(){var t,n,a=this;return Be(this,function(i){switch(i.label){case 0:this.webcamConfig.facingMode&&_r.util.assert(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",function(){return"Invalid webcam facing mode: "+a.webcamConfig.facingMode+". Please provide 'user' or 'environment'"}),i.label=1;case 1:return i.trys.push([1,3,,4]),t=this,[4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})];case 2:return t.stream=i.sent(),[3,4];case 3:throw n=i.sent(),n.message="Error thrown while initializing video stream: "+n.message,n;case 4:if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(o){console.log(o),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,[2,new Promise(function(o){a.webcamVideoElement.onloadedmetadata=function(){o()}})]}})})},e.prototype.next=function(){return Me(this,void 0,void 0,function(){var t;return Be(this,function(n){if(this.isClosed)return[2,{value:null,done:!0}];try{t=_r.browser.fromPixels(this.webcamVideoElement)}catch(a){throw new Error("Error thrown converting video to pixels: "+JSON.stringify(a))}if(this.resize)try{return[2,{value:this.cropAndResizeFrame(t),done:!1}]}catch(a){throw new Error("Error thrown cropping the video: "+a.message)}finally{t.dispose()}else return[2,{value:t,done:!1}];return[2]})})},e.prototype.needToResize=function(){return!!(this.webcamConfig.resizeWidth&&this.webcamConfig.resizeHeight&&(this.webcamVideoElement.width!==this.webcamConfig.resizeWidth||this.webcamVideoElement.height!==this.webcamConfig.resizeHeight))},e.prototype.cropAndResizeFrame=function(t){var n=this;return _r.tidy(function(){var a=_r.expandDims(_r.cast(t,"float32"),0),i;i=_r.image.cropAndResize(a,n.cropBox,n.cropBoxInd,n.cropSize,"bilinear");var o=i.shape;return _r.reshape(i,o.slice(1))})},e.prototype.capture=function(){return Me(this,void 0,void 0,function(){return Be(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:return[2,t.sent().value]}})})},e.prototype.stop=function(){var t=this.stream.getTracks();t.forEach(function(n){return n.stop()});try{this.webcamVideoElement.srcObject=null}catch(n){console.log(n),this.webcamVideoElement.src=null}this.isClosed=!0},e.prototype.toArray=function(){throw new Error("Can not convert infinite video stream to array.")},e}(cn);var Wz=function(){function r(){}return r}(),qz=function(r){zt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.split=function(t){return new xRe(this,t)},e}(cn),xRe=function(r){zt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.impl=new kRe(t,n),a}return e.prototype.summary=function(){return this.impl.summary()},e.prototype.next=function(){return Me(this,void 0,void 0,function(){return Be(this,function(t){return[2,this.impl.next()]})})},e}(qz),kRe=function(r){zt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.separator=n,a.carryover="",a}return e.prototype.summary=function(){return this.upstream.summary()+" -> Split('"+this.separator+"')"},e.prototype.pump=function(){return Me(this,void 0,void 0,function(){var t,n,a,i,o,s,u;return Be(this,function(l){switch(l.label){case 0:return[4,this.upstream.next()];case 1:if(t=l.sent(),t.done)return this.carryover===""?[2,!1]:(this.outputQueue.push(this.carryover),this.carryover="",[2,!0]);n=t.value.split(this.separator),n[0]=this.carryover+n[0];try{for(a=Ou(n.slice(0,-1)),i=a.next();!i.done;i=a.next())o=i.value,this.outputQueue.push(o)}catch(c){s={error:c}}finally{try{i&&!i.done&&(u=a.return)&&u.call(a)}finally{if(s)throw s.error}}return this.carryover=n[n.length-1],[2,!0]}})})},e}(rk),SRe=function(r){zt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.decodeUTF8=function(){return new NRe(this)},e}(cn),NRe=function(r){zt(e,r);function e(t){var n=r.call(this)||this;return n.upstream=t,n.impl=new ERe(t),n}return e.prototype.summary=function(){return this.impl.summary()},e.prototype.next=function(){return Me(this,void 0,void 0,function(){return Be(this,function(t){return[2,this.impl.next()]})})},e}(qz),ERe=function(r){zt(e,r);function e(t){var n=r.call(this)||this;if(n.upstream=t,_r.env().get("IS_BROWSER"))n.decoder=new TextDecoder("utf-8");else{var a=Jx().StringDecoder;n.decoder=new a("utf8")}return n}return e.prototype.summary=function(){return this.upstream.summary()+" -> Utf8"},e.prototype.pump=function(){return Me(this,void 0,void 0,function(){var t,n,a;return Be(this,function(i){switch(i.label){case 0:return[4,this.upstream.next()];case 1:return t=i.sent(),t.done?[2,!1]:(n=t.value,_r.env().get("IS_BROWSER")?a=this.decoder.decode(n,{stream:!0}):a=this.decoder.write(Buffer.from(n.buffer)),this.outputQueue.push(a),[2,!0])}})})},e}(rk),Vz=function(r){zt(e,r);function e(t,n){n===void 0&&(n={});var a=r.call(this)||this;return a.file=t,a.options=n,_r.util.assert(t instanceof Uint8Array||(_r.env().get("IS_BROWSER")?t instanceof File||t instanceof Blob:!1),function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."}),a.offset=n.offset||0,a.chunkSize=n.chunkSize||1024*1024,a}return e.prototype.summary=function(){return"FileChunks "+this.file},e.prototype.next=function(){return Me(this,void 0,void 0,function(){var t,n,a=this;return Be(this,function(i){switch(i.label){case 0:return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?[2,{value:null,done:!0}]:(t=new Promise(function(o,s){var u=a.offset+a.chunkSize;if(a.file instanceof Uint8Array)o(new Uint8Array(a.file.slice(a.offset,u)));else{var l=new FileReader;l.onload=function(f){var h=l.result;if(h instanceof ArrayBuffer&&(h=new Uint8Array(h)),!(h instanceof Uint8Array))return s(new TypeError("FileReader returned unknown type."));o(h)},l.onabort=function(f){return s(new Error("Aborted"))},l.onerror=function(f){return s(new Error(f.type))};var c=a.file.slice(a.offset,u);l.readAsArrayBuffer(c)}a.offset=u}),n={},[4,t]);case 1:return[2,(n.value=i.sent(),n.done=!1,n)]}})})},e}(SRe);function TRe(r,e,t){return e===void 0&&(e={}),Me(this,void 0,void 0,function(){var n,a,i,o,s;return Be(this,function(u){switch(u.label){case 0:return typeof r=="string"?n=r:(n=r.url,a=IRe(r)),[4,(t||_r.util.fetch)(n,a)];case 1:return i=u.sent(),i.ok?(s=Uint8Array.bind,[4,i.arrayBuffer()]):[3,3];case 2:return o=new(s.apply(Uint8Array,[void 0,u.sent()])),[2,new Vz(o,e)];case 3:throw new Error(i.statusText)}})})}var IRe=function(r){var e={method:r.method,headers:r.headers,body:r.body,mode:r.mode,credentials:r.credentials,cache:r.cache,redirect:r.redirect,referrer:r.referrer,integrity:r.integrity};return e};function Gz(r){return typeof r=="string"&&r.slice(0,7)==="file://"}var Uz=function(r){zt(e,r);function e(t,n){n===void 0&&(n={});var a=r.call(this)||this;return a.input=t,a.options=n,a}return e.prototype.iterator=function(){return Me(this,void 0,void 0,function(){var t;return Be(this,function(n){return Gz(this.input)&&_r.env().get("IS_NODE")&&(t=Tz(),this.input=t.readFileSync(this.input.slice(7))),[2,new Vz(this.input,this.options)]})})},e}(Wz),Hz=function(r){zt(e,r);function e(t,n){n===void 0&&(n={});var a=r.call(this)||this;return a.url=t,a.fileOptions=n,a}return e.prototype.iterator=function(){return Me(this,void 0,void 0,function(){return Be(this,function(t){return Gz(this.url)?[2,new Uz(this.url,this.fileOptions).iterator()]:[2,TRe(this.url,this.fileOptions)]})})},e}(Wz);function CRe(r,e){return e===void 0&&(e={}),new $z(new Hz(r),e)}function ARe(r){var e=this,t=tk(r);return va(function(){return Me(e,void 0,void 0,function(){return Be(this,function(n){return[2,t]})})})}function _Re(r){var e=this;return va(function(){return Me(e,void 0,void 0,function(){var t;return Be(this,function(n){switch(n.label){case 0:return[4,r()];case 1:return t=n.sent(),[2,tk(function(){return t.next()})]}})})})}function DRe(r,e){return Me(this,void 0,void 0,function(){return Be(this,function(t){return[2,wRe.create(r,e)]})})}function FRe(r){return Me(this,void 0,void 0,function(){return Be(this,function(e){return[2,bRe.create(r)]})})}var RRe="3.21.0";Vn.CSVDataset=$z;Vn.Dataset=cc;Vn.FileDataSource=Uz;Vn.TextLineDataset=zz;Vn.URLDataSource=Hz;Vn.array=vRe;Vn.csv=CRe;Vn.func=ARe;Vn.generator=_Re;Vn.microphone=FRe;Vn.version_data=RRe;Vn.webcam=DRe;Vn.zip=mRe});var Xz=ue((jz,nk)=>{(function(r,e,t){function n(s){var u=this,l=o();u.next=function(){var c=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=c-(u.c=c|0)},u.c=1,u.s0=l(" "),u.s1=l(" "),u.s2=l(" "),u.s0-=l(s),u.s0<0&&(u.s0+=1),u.s1-=l(s),u.s1<0&&(u.s1+=1),u.s2-=l(s),u.s2<0&&(u.s2+=1),l=null}function a(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function i(s,u){var l=new n(s),c=u&&u.state,f=l.next;return f.int32=function(){return l.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,c&&(typeof c=="object"&&a(c,l),f.state=function(){return a(l,{})}),f}function o(){var s=4022871197,u=function(l){l=String(l);for(var c=0;c<l.length;c++){s+=l.charCodeAt(c);var f=.02519603282416938*s;s=f>>>0,f-=s,f*=s,s=f>>>0,f-=s,s+=f*4294967296}return(s>>>0)*23283064365386963e-26};return u}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.alea=i})(jz,typeof nk=="object"&&nk,typeof define=="function"&&define)});var Zz=ue((Yz,ak)=>{(function(r,e,t){function n(o){var s=this,u="";s.x=0,s.y=0,s.z=0,s.w=0,s.next=function(){var c=s.x^s.x<<11;return s.x=s.y,s.y=s.z,s.z=s.w,s.w^=s.w>>>19^c^c>>>8},o===(o|0)?s.x=o:u+=o;for(var l=0;l<u.length+64;l++)s.x^=u.charCodeAt(l)|0,s.next()}function a(o,s){return s.x=o.x,s.y=o.y,s.z=o.z,s.w=o.w,s}function i(o,s){var u=new n(o),l=s&&s.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},c.int32=u.next,c.quick=c,l&&(typeof l=="object"&&a(l,u),c.state=function(){return a(u,{})}),c}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xor128=i})(Yz,typeof ak=="object"&&ak,typeof define=="function"&&define)});var Qz=ue((Jz,ik)=>{(function(r,e,t){function n(o){var s=this,u="";s.next=function(){var c=s.x^s.x>>>2;return s.x=s.y,s.y=s.z,s.z=s.w,s.w=s.v,(s.d=s.d+362437|0)+(s.v=s.v^s.v<<4^(c^c<<1))|0},s.x=0,s.y=0,s.z=0,s.w=0,s.v=0,o===(o|0)?s.x=o:u+=o;for(var l=0;l<u.length+64;l++)s.x^=u.charCodeAt(l)|0,l==u.length&&(s.d=s.x<<10^s.x>>>4),s.next()}function a(o,s){return s.x=o.x,s.y=o.y,s.z=o.z,s.w=o.w,s.v=o.v,s.d=o.d,s}function i(o,s){var u=new n(o),l=s&&s.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},c.int32=u.next,c.quick=c,l&&(typeof l=="object"&&a(l,u),c.state=function(){return a(u,{})}),c}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xorwow=i})(Jz,typeof ik=="object"&&ik,typeof define=="function"&&define)});var t$=ue((e$,ok)=>{(function(r,e,t){function n(o){var s=this;s.next=function(){var l=s.x,c=s.i,f,h,p;return f=l[c],f^=f>>>7,h=f^f<<24,f=l[c+1&7],h^=f^f>>>10,f=l[c+3&7],h^=f^f>>>3,f=l[c+4&7],h^=f^f<<7,f=l[c+7&7],f=f^f<<13,h^=f^f<<9,l[c]=h,s.i=c+1&7,h};function u(l,c){var f,h,p=[];if(c===(c|0))h=p[0]=c;else for(c=""+c,f=0;f<c.length;++f)p[f&7]=p[f&7]<<15^c.charCodeAt(f)+p[f+1&7]<<13;for(;p.length<8;)p.push(0);for(f=0;f<8&&p[f]===0;++f);for(f==8?h=p[7]=-1:h=p[f],l.x=p,l.i=0,f=256;f>0;--f)l.next()}u(s,o)}function a(o,s){return s.x=o.x.slice(),s.i=o.i,s}function i(o,s){o==null&&(o=+new Date);var u=new n(o),l=s&&s.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},c.int32=u.next,c.quick=c,l&&(l.x&&a(l,u),c.state=function(){return a(u,{})}),c}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xorshift7=i})(e$,typeof ok=="object"&&ok,typeof define=="function"&&define)});var n$=ue((r$,sk)=>{(function(r,e,t){function n(o){var s=this;s.next=function(){var l=s.w,c=s.X,f=s.i,h,p;return s.w=l=l+1640531527|0,p=c[f+34&127],h=c[f=f+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,p=c[f]=p^h,s.i=f,p+(l^l>>>16)|0};function u(l,c){var f,h,p,d,m,v=[],g=128;for(c===(c|0)?(h=c,c=null):(c=c+"\0",h=0,g=Math.max(g,c.length)),p=0,d=-32;d<g;++d)c&&(h^=c.charCodeAt((d+32)%c.length)),d===0&&(m=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,d>=0&&(m=m+1640531527|0,f=v[d&127]^=h+m,p=f==0?p+1:0);for(p>=128&&(v[(c&&c.length||0)&127]=-1),p=127,d=4*128;d>0;--d)h=v[p+34&127],f=v[p=p+1&127],h^=h<<13,f^=f<<17,h^=h>>>15,f^=f>>>12,v[p]=h^f;l.w=m,l.X=v,l.i=p}u(s,o)}function a(o,s){return s.i=o.i,s.w=o.w,s.X=o.X.slice(),s}function i(o,s){o==null&&(o=+new Date);var u=new n(o),l=s&&s.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},c.int32=u.next,c.quick=c,l&&(l.X&&a(l,u),c.state=function(){return a(u,{})}),c}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xor4096=i})(r$,typeof sk=="object"&&sk,typeof define=="function"&&define)});var i$=ue((a$,uk)=>{(function(r,e,t){function n(o){var s=this,u="";s.next=function(){var c=s.b,f=s.c,h=s.d,p=s.a;return c=c<<25^c>>>7^f,f=f-h|0,h=h<<24^h>>>8^p,p=p-c|0,s.b=c=c<<20^c>>>12^f,s.c=f=f-h|0,s.d=h<<16^f>>>16^p,s.a=p-c|0},s.a=0,s.b=0,s.c=-1640531527,s.d=1367130551,o===Math.floor(o)?(s.a=o/4294967296|0,s.b=o|0):u+=o;for(var l=0;l<u.length+20;l++)s.b^=u.charCodeAt(l)|0,s.next()}function a(o,s){return s.a=o.a,s.b=o.b,s.c=o.c,s.d=o.d,s}function i(o,s){var u=new n(o),l=s&&s.state,c=function(){return(u.next()>>>0)/4294967296};return c.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},c.int32=u.next,c.quick=c,l&&(typeof l=="object"&&a(l,u),c.state=function(){return a(u,{})}),c}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.tychei=i})(a$,typeof uk=="object"&&uk,typeof define=="function"&&define)});var s$=ue((o$,Jm)=>{(function(r,e,t){var n=256,a=6,i=52,o="random",s=t.pow(n,a),u=t.pow(2,i),l=u*2,c=n-1,f;function h(b,w,x){var k=[];w=w==!0?{entropy:!0}:w||{};var N=v(m(w.entropy?[b,y(e)]:b??g(),3),k),T=new p(k),I=function(){for(var F=T.g(a),D=s,R=0;F<u;)F=(F+R)*n,D*=n,R=T.g(1);for(;F>=l;)F/=2,D/=2,R>>>=1;return(F+R)/D};return I.int32=function(){return T.g(4)|0},I.quick=function(){return T.g(4)/4294967296},I.double=I,v(y(T.S),e),(w.pass||x||function(F,D,R,P){return P&&(P.S&&d(P,T),F.state=function(){return d(T,{})}),R?(t[o]=F,D):F})(I,N,"global"in w?w.global:this==t,w.state)}function p(b){var w,x=b.length,k=this,N=0,T=k.i=k.j=0,I=k.S=[];for(x||(b=[x++]);N<n;)I[N]=N++;for(N=0;N<n;N++)I[N]=I[T=c&T+b[N%x]+(w=I[N])],I[T]=w;(k.g=function(F){for(var D,R=0,P=k.i,B=k.j,q=k.S;F--;)D=q[P=c&P+1],R=R*n+q[c&(q[P]=q[B=c&B+D])+(q[B]=D)];return k.i=P,k.j=B,R})(n)}function d(b,w){return w.i=b.i,w.j=b.j,w.S=b.S.slice(),w}function m(b,w){var x=[],k=typeof b,N;if(w&&k=="object")for(N in b)try{x.push(m(b[N],w-1))}catch{}return x.length?x:k=="string"?b:b+"\0"}function v(b,w){for(var x=b+"",k,N=0;N<x.length;)w[c&N]=c&(k^=w[c&N]*19)+x.charCodeAt(N++);return y(w)}function g(){try{var b;return f&&(b=f.randomBytes)?b=b(n):(b=new Uint8Array(n),(r.crypto||r.msCrypto).getRandomValues(b)),y(b)}catch{var w=r.navigator,x=w&&w.plugins;return[+new Date,r,x,r.screen,y(e)]}}function y(b){return String.fromCharCode.apply(0,b)}if(v(t.random(),e),typeof Jm=="object"&&Jm.exports){Jm.exports=h;try{f=Id()}catch{}}else typeof define=="function"&&define.amd?define(function(){return h}):t["seed"+o]=h})(typeof self<"u"?self:o$,[],Math)});var l$=ue((Vit,u$)=>{var ORe=Xz(),PRe=Zz(),MRe=Qz(),BRe=t$(),LRe=n$(),zRe=i$(),Lu=s$();Lu.alea=ORe;Lu.xor128=PRe;Lu.xorwow=MRe;Lu.xorshift7=BRe;Lu.xor4096=LRe;Lu.tychei=zRe;u$.exports=Lu});var EW=ue(Xh=>{"use strict";Object.defineProperty(Xh,"__esModule",{value:!0});var E=ru(),$Re=l$();function WRe(r){if(r&&r.__esModule)return r;var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var qRe=WRe($Re),ck=function(r,e){return ck=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},ck(r,e)};function VRe(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");ck(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function c$(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(f){o(f)}}function u(c){try{l(n.throw(c))}catch(f){o(f)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(r,e||[])).next())})}function f$(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(l){return function(c){return u([l,c])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=l[0]&2?a.return:l[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,l[1])).done)return i;switch(a=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,a=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){t.label=l[1];break}if(l[0]===6&&t.label<i[1]){t.label=i[1],i=l;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(l);break}i[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(c){l=[6,c],a=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function pc(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function tt(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function Oi(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(tt(arguments[e]));return r}function Ve(r,e){Array.isArray(r)||(r=[r]),r.forEach(function(t){t!=null&&E.util.assert(t.dtype!=="complex64",function(){return e+" does not support complex64 tensors in the CPU backend."})})}var GRe=E.kernel_impls.whereImpl,pk=function(r){VRe(e,r);function e(){var t=r.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new E.DataStorage(t,E.engine()),t}return e.prototype.nextDataId=function(){return e.nextDataId++},e.prototype.write=function(t,n,a){this.firstUse&&(this.firstUse=!1,E.env().get("IS_NODE")&&E.backend_util.warn(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));var i={id:this.nextDataId()};return this.data.set(i,{values:t,dtype:a,refCount:1}),i},e.prototype.makeTensorInfo=function(t,n,a){var i;if(n==="string"&&a!=null&&a.length>0&&E.util.isString(a[0])){var o=a.map(function(s){return E.util.encodeString(s)});i=this.write(o,t,n)}else i=this.write(a,t,n);return{dataId:i,shape:t,dtype:n}},e.prototype.refCount=function(t){if(this.data.has(t)){var n=this.data.get(t);return n.refCount}return 0},e.prototype.incRef=function(t){var n=this.data.get(t);n.refCount++},e.prototype.decRef=function(t){if(this.data.has(t)){var n=this.data.get(t);n.refCount--}},e.prototype.move=function(t,n,a,i,o){this.data.set(t,{values:n,dtype:i,refCount:o})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return c$(this,void 0,void 0,function(){return f$(this,function(n){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var n=this.data.get(t),a=n.dtype,i=n.complexTensorInfos;if(a==="complex64"){var o=this.readSync(i.real.dataId),s=this.readSync(i.imag.dataId);return E.backend_util.mergeRealAndImagArrays(o,s)}return this.data.get(t).values},e.prototype.bufferSync=function(t){var n=this.readSync(t.dataId);if(t.dtype==="string")try{var a=n.map(function(i){return E.util.decodeString(i)});return E.buffer(t.shape,t.dtype,a)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return E.buffer(t.shape,t.dtype,n)},e.prototype.makeOutput=function(t,n,a){return E.engine().makeTensorFromTensorInfo(this.makeTensorInfo(n,a,t),this)},e.prototype.disposeData=function(t,n){if(n===void 0&&(n=!1),this.data.has(t)){if(this.data.get(t).refCount--,!n&&this.data.get(t).refCount>0)return!1;var a=this.data.get(t).complexTensorInfos;a!=null&&(this.disposeData(a.real.dataId,!0),this.disposeData(a.imag.dataId,!0)),this.data.delete(t)}return!0},e.prototype.disposeIntermediateTensorInfo=function(t){this.disposeData(t.dataId)},e.prototype.time=function(t){return c$(this,void 0,void 0,function(){var n,a;return f$(this,function(i){return n=E.util.now(),t(),a=E.util.now()-n,[2,{kernelMs:a}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.where=function(t){Ve([t],"where");var n=this.readSync(t.dataId);return GRe(t.shape,n)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return r.prototype.epsilon.call(this)},e}(E.KernelBackend);pk.nextDataId=0;function b$(r){for(var e=new Float32Array(r.length),t=0;t<r.length;++t)e[t]=Math.abs(r[t]);return e}var URe=function(r){var e=r.inputs.x,t=r.backend;Ve(e,"abs");var n=new Float32Array(E.util.sizeFromShape(e.shape)),a=t.data.get(e.dataId).values;return n=b$(a),t.makeOutput(n,e.shape,e.dtype)},HRe={kernelName:E.Abs,backendName:"cpu",kernelFunc:URe};function jr(r){return function(e,t,n,a,i){var o=E.backend_util.assertAndGetBroadcastShape(e,t),s=o.length,u=E.util.computeStrides(o),l=E.util.sizeFromShape(o),c=E.util.getTypedArrayFromDType(i,l),f=e.length,h=t.length,p=E.util.computeStrides(e),d=E.util.computeStrides(t),m=E.backend_util.getBroadcastDims(e,o),v=E.backend_util.getBroadcastDims(t,o);if(m.length+v.length===0)for(var g=0;g<c.length;++g)c[g]=r(n[g%n.length],a[g%a.length]);else for(var y=function(b){var w=E.util.indexToLoc(b,s,u),x=w.slice(-f);m.forEach(function(I){return x[I]=0});var k=E.util.locToIndex(x,f,p),N=w.slice(-h);v.forEach(function(I){return N[I]=0});var T=E.util.locToIndex(N,h,d);c[b]=r(n[k],a[T])},g=0;g<c.length;++g)y(g);return[c,o]}}function ma(r){var e=r.inputs,t=r.backend,n=e.real,a=e.imag,i=t.data.get(n.dataId).values,o=t.data.get(a.dataId).values,s=t.makeTensorInfo(n.shape,"complex64"),u=t.data.get(s.dataId);return u.complexTensorInfos={real:t.makeTensorInfo(n.shape,"float32",i),imag:t.makeTensorInfo(a.shape,"float32",o)},s}var KRe={kernelName:E.Complex,backendName:"cpu",kernelFunc:ma};function Qm(r,e,t){if(t===void 0&&(t="float32"),t==="complex64"){var n=Qm(r,e,"float32"),a=Qm(r,e,"float32");return ma({inputs:{real:n,imag:a},backend:r})}var i=E.util.makeZerosTypedArray(E.util.sizeFromShape(e),t);return r.makeTensorInfo(e,t,i)}function ro(r){var e=r.inputs,t=r.backend,n=e.x;return t.incRef(n.dataId),{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}var jRe={kernelName:E.Identity,backendName:"cpu",kernelFunc:ro};function zu(r){var e=r.inputs,t=r.backend,n=e.input,a=t.data.get(n.dataId).complexTensorInfos.real,i=t.data.get(a.dataId).values;return t.makeTensorInfo(a.shape,a.dtype,i)}var XRe={kernelName:E.Real,backendName:"cpu",kernelFunc:zu};function w$(r,e,t,n){if(n==="int32"){var a=Int32Array.from(r);return[e,"int32",a]}if(n==="bool"){var i=E.util.toTypedArray([0],t),o=tt(jr(function(l,c){return l!==c?1:0})(e,[],r,i,"bool"),2),s=o[0],u=o[1];return[u,"bool",s]}throw new Error("Error in Cast: failed to cast "+t+" to "+n)}function ks(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.dtype;if(i==="complex64"){if(a.dtype==="complex64")return ro({inputs:{x:a},backend:t});var o=Qm(t,a.shape,a.dtype),s=ks({inputs:{x:a},backend:t,attrs:{dtype:"float32"}}),u=ma({inputs:{real:s,imag:o},backend:t});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}if(a.dtype==="complex64"){var l=zu({inputs:{input:a},backend:t}),u=ks({inputs:{x:l},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(l),u}if(!E.util.hasEncodingLoss(a.dtype,i)){var u=ro({inputs:{x:a},backend:t});return{dataId:u.dataId,shape:u.shape,dtype:i}}var c=t.data.get(a.dataId).values,f=tt(w$(c,a.shape,a.dtype,i),3),h=f[0],p=f[1],d=f[2];return t.makeTensorInfo(h,p,d)}var YRe={kernelName:E.Cast,backendName:"cpu",kernelFunc:ks};function fn(r,e,t,n){return t==null?function(a){var i=a.inputs,o=a.backend,s=i.a,u=i.b,l=o;Ve([s,u],r);var c=l.data.get(s.dataId).values,f=l.data.get(u.dataId).values,h=s.dtype==="string"?E.backend_util.fromUint8ToStringArray(c):c,p=s.dtype==="string"?E.backend_util.fromUint8ToStringArray(f):f,d=n||s.dtype,m=tt(e(s.shape,u.shape,h,p,d),2),v=m[0],g=m[1];return l.makeTensorInfo(g,d,v)}:function(a){var i=a.inputs,o=a.backend,s=i.a,u=i.b,l=o;if(s.dtype==="complex64"||u.dtype==="complex64"){var c=ks({inputs:{x:s},backend:l,attrs:{dtype:"complex64"}}),f=l.data.get(c.dataId),h=f.complexTensorInfos.real,p=f.complexTensorInfos.imag,d=l.data.get(h.dataId).values,m=l.data.get(p.dataId).values,v=ks({inputs:{x:u},backend:l,attrs:{dtype:"complex64"}}),g=l.data.get(v.dataId),y=g.complexTensorInfos.real,b=g.complexTensorInfos.imag,w=l.data.get(y.dataId).values,x=l.data.get(b.dataId).values,k=tt(t(s.shape,u.shape,d,m,w,x),3),N=k[0],T=k[1],I=k[2],F=l.makeTensorInfo(I,"float32",N),D=l.makeTensorInfo(I,"float32",T),R=ma({inputs:{real:F,imag:D},backend:l});return l.disposeIntermediateTensorInfo(c),l.disposeIntermediateTensorInfo(v),l.disposeIntermediateTensorInfo(F),l.disposeIntermediateTensorInfo(D),R}else{var P=l.data.get(s.dataId).values,B=l.data.get(u.dataId).values,q=n||s.dtype,O=tt(e(s.shape,u.shape,P,B,q),2),V=O[0],I=O[1];return l.makeTensorInfo(I,q,V)}}}function dk(r){return function(e,t,n,a,i,o){var s=E.backend_util.assertAndGetBroadcastShape(e,t),u=E.util.sizeFromShape(s),l=s.length,c=E.util.computeStrides(s),f=E.util.getTypedArrayFromDType("float32",u),h=E.util.getTypedArrayFromDType("float32",u),p=E.backend_util.getBroadcastDims(e,s),d=E.backend_util.getBroadcastDims(t,s),m=E.backend_util.mergeRealAndImagArrays(n,a),v=E.backend_util.mergeRealAndImagArrays(i,o),g=e.length,y=E.util.computeStrides(e),b=t.length,w=E.util.computeStrides(t);if(p.length+d.length===0)for(var x=0;x<f.length;x++){var k=x%m.length,N=x%v.length,T=r(m[k*2],m[k*2+1],v[N*2],v[N*2+1]);f[x]=T.real,h[x]=T.imag}else for(var I=function(F){var D=E.util.indexToLoc(F,l,c),R=D.slice(-g);p.forEach(function(V){return R[V]=0});var P=E.util.locToIndex(R,g,y),B=D.slice(-b);d.forEach(function(V){return B[V]=0});var q=E.util.locToIndex(B,b,w),O=r(m[P*2],m[P*2+1],v[q*2],v[q*2+1]);f[F]=O.real,h[F]=O.imag},x=0;x<f.length;x++)I(x);return[f,h,s]}}var x$=jr(function(r,e){return r+e}),ZRe=dk(function(r,e,t,n){return{real:r+t,imag:e+n}}),dc=fn(E.Add,x$,ZRe),JRe={kernelName:E.Add,backendName:"cpu",kernelFunc:dc};function vk(r,e,t,n,a){for(var i=E.util.sizeFromShape(n),o=E.util.makeZerosTypedArray(a,t),s=0;s<r.length;s++){var u=r[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(i>0?o[u]+=e[s]:o[u]+=1)}return o}function k$(r,e,t,n){n===void 0&&(n=!1);for(var a=r.shape[0],i=r.shape[1],o=E.buffer([a,t],e.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var l=r.get(s,u);if(l<0)throw new Error("Input x must be non-negative!");l>=t||(n?o.set(1,s,l):e.size>0?o.set(o.get(s,l)+e.get(s,u),s,l):o.set(o.get(s,l)+1,s,l))}return o}function Ss(r){return function(e,t,n){for(var a=E.util.getTypedArrayFromDType(t,e.length),i=0;i<e.length;++i)a[i]=r(e[i],n);return a}}function Ut(r,e,t){return function(n){var a=n.inputs,i=n.attrs,o=n.backend,s=a.x;if(Ve(s,r),s.dtype==="string"||t==="string")throw new Error("unaryKernelFunc does not support string input/output");for(var u=o,l=u.data.get(s.dataId).values,c=E.util.sizeFromShape(s.shape),f=t||s.dtype,h=E.util.getArrayFromDType(f,c),p=0;p<c;++p)h[p]=e(l[p],i);return u.makeTensorInfo(s.shape,f,h)}}function gc(r,e,t){return function(n){var a=n.inputs,i=n.attrs,o=n.backend,s=a.x;if(Ve(s,r),s.dtype==="string"||t==="string")throw new Error("unaryKernelFunc does not support string input/output");var u=o,l=u.data.get(s.dataId).values,c=t||s.dtype,f=e(l,c,i);return u.makeTensorInfo(s.shape,c,f)}}var S$=Ss(function(r){return Math.ceil(r)}),QRe=gc(E.Ceil,S$),eOe={kernelName:E.Ceil,backendName:"cpu",kernelFunc:QRe};function N$(r,e,t,n){var a=E.util.getArrayFromDType(t,E.util.sizeFromShape(e));if(n&&t!=="string"){var i=0;r.forEach(function(s){var u=E.util.sizeFromShape(s.shape);a.set(s.vals,i),i+=u})}else{var o=0;r.forEach(function(s){for(var u=t==="string"?E.backend_util.fromUint8ToStringArray(s.vals):s.vals,l=0,c=0;c<s.shape[0];++c)for(var f=c*e[1]+o,h=0;h<s.shape[1];++h)a[f+h]=u[l++];o+=s.shape[1]})}return a}var E$=jr(function(r,e){return r===e?1:0}),T$=fn(E.Equal,E$,null,"bool"),tOe={kernelName:E.Equal,backendName:"cpu",kernelFunc:T$};var I$=Ss(function(r){return Math.exp(r)}),C$=gc(E.Exp,I$,"float32"),rOe={kernelName:E.Exp,backendName:"cpu",kernelFunc:C$};var A$=Ss(function(r){return Math.expm1(r)}),nOe=gc(E.Expm1,A$),aOe={kernelName:E.Expm1,backendName:"cpu",kernelFunc:nOe};var _$=Ss(function(r){return Math.floor(r)}),iOe=gc(E.Floor,_$),oOe={kernelName:E.Floor,backendName:"cpu",kernelFunc:iOe};function D$(r,e,t,n,a,i,o,s,u){for(var l=E.buffer([n,i],t),c=0;c<n;c++){for(var f=[],h=0,p=0;p<a;p++){var d=r[c*a+p];h+=d*o[p],f.push(d)}if(h<0||h>=u/i)throw new Error("Invalid indices: "+f+" does not index into "+s);for(var m=0;m<i;m++)l.values[c*i+m]=e.get.apply(e,Oi(e.indexToLoc(h*i+m)))}return l}function F$(r,e,t){for(var n=E.buffer(t,r.dtype),a=0;a<n.size;++a){var i=n.indexToLoc(a),o=i.slice(),s=o[0],u=o[2],l=e.locToIndex([s,u]);o[2]=e.values[l];var c=r.locToIndex(o);0<=c&&c<r.values.length&&(n.values[a]=r.values[c])}return n}var R$=jr(function(r,e){return r>e?1:0}),sOe=fn(E.Greater,R$,null,"bool"),uOe={kernelName:E.Greater,backendName:"cpu",kernelFunc:sOe};var O$=jr(function(r,e){return r>=e?1:0}),lOe=fn(E.GreaterEqual,O$,null,"bool"),cOe={kernelName:E.GreaterEqual,backendName:"cpu",kernelFunc:lOe};var P$=jr(function(r,e){return r<e?1:0}),fOe=fn(E.Less,P$,null,"bool"),hOe={kernelName:E.Less,backendName:"cpu",kernelFunc:fOe};var M$=jr(function(r,e){return r<=e?1:0}),pOe=fn(E.LessEqual,M$,null,"bool"),dOe={kernelName:E.LessEqual,backendName:"cpu",kernelFunc:pOe};function B$(r,e,t){var n=(e-r)/(t-1),a=E.util.makeZerosTypedArray(t,"float32");a[0]=r;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return a}var L$=Ss(function(r){return Math.log(r)}),vOe=gc(E.Log,L$),mOe={kernelName:E.Log,backendName:"cpu",kernelFunc:vOe};function z$(r,e,t,n){for(var a=E.util.getTypedArrayFromDType(n,E.util.sizeFromShape(t)),i=0;i<a.length;++i){for(var o=i*e,s=r[o],u=0;u<e;++u){var l=r[o+u];(Number.isNaN(l)||l>s)&&(s=l)}a[i]=s}return a}var $$=jr(function(r,e){return Math.max(r,e)}),gOe=fn(E.Maximum,$$),yOe={kernelName:E.Maximum,backendName:"cpu",kernelFunc:gOe};var W$=jr(function(r,e){return Math.min(r,e)}),bOe=fn(E.Minimum,W$),wOe={kernelName:E.Minimum,backendName:"cpu",kernelFunc:bOe};var mk=jr(function(r,e){return r*e}),xOe=dk(function(r,e,t,n){return{real:r*t-e*n,imag:r*n+e*t}}),ng=fn(E.Multiply,mk,xOe),kOe={kernelName:E.Multiply,backendName:"cpu",kernelFunc:ng};function q$(r,e,t){var n=E.util.createScalarValue(-1,t);return mk([],e,n,r,t)}function SOe(r){var e=r.inputs,t=r.backend,n=e.x;Ve(n,"neg");var a=t.data.get(n.dataId).values,i=tt(q$(a,n.shape,n.dtype),2),o=i[0],s=i[1];return t.makeTensorInfo(s,n.dtype,o)}var NOe={kernelName:E.Neg,backendName:"cpu",kernelFunc:SOe};var V$=jr(function(r,e){return r!==e?1:0}),EOe=fn(E.NotEqual,V$,null,"bool"),TOe={kernelName:E.NotEqual,backendName:"cpu",kernelFunc:EOe};function gk(r,e,t,n,a){for(var i=e.length,o=E.util.sizeFromShape(e),s=E.util.computeStrides(e),u=E.util.computeStrides(a),l=E.util.getTypedArrayFromDType(t,E.util.sizeFromShape(a)),c=0;c<o;++c){for(var f=E.util.indexToLoc(c,i,s),h=new Array(f.length),p=0;p<h.length;p++)h[p]=f[n[p]];var d=E.util.locToIndex(h,i,u);l[d]=r[c]}return l}function Gn(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.x,i=t.perm;Ve(a,"transpose");for(var o=a.shape.length,s=new Array(o),u=0;u<s.length;u++)s[u]=a.shape[i[u]];var l=n.data.get(a.dataId).values,c=gk(l,a.shape,a.dtype,i,s),f=n.write(c,s,a.dtype);return{dataId:f,shape:s,dtype:a.dtype}}var IOe={kernelName:E.Transpose,backendName:"cpu",kernelFunc:Gn};function G$(r,e,t,n){for(var a=tt(E.backend_util.computeOutAndReduceShapes(r,n),2),i=a[0],o=a[1],s=E.upcastType(e,"int32"),u=E.util.makeZerosTypedArray(E.util.sizeFromShape(i),s),l=E.util.sizeFromShape(o),c=0;c<u.length;++c){for(var f=c*l,h=1,p=0;p<l;++p)h*=t[f+p];u[c]=h}return{outVals:u,outShape:i,outDtype:s}}function COe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;Ve(a,"prod");var s=a.shape.length,u=E.util.parseAxisParam(i,a.shape),l=E.backend_util.getAxesPermutation(u,s),c=u,f=a,h=[];l!=null&&(f=Gn({inputs:{x:a},backend:t,attrs:{perm:l}}),h.push(f),c=E.backend_util.getInnerMostAxes(c.length,s));var p=t.data.get(f.dataId).values,d=G$(f.shape,f.dtype,p,c),m=d.outVals,v=d.outShape,g=d.outDtype,y=v;return o&&(y=E.backend_util.expandShapeToKeepDim(v,u)),h.forEach(function(b){return t.disposeIntermediateTensorInfo(b)}),t.makeTensorInfo(y,g,m)}var AOe={kernelName:E.Prod,backendName:"cpu",kernelFunc:COe};function _Oe(r,e,t){r.forEach(function(n,a){if(n<0||n>=t){var i=E.util.indexToLoc(a,e.length,E.util.computeStrides(e)).join(",");throw new Error("indices["+i+"] = "+n+" is not in [0, "+t+")")}})}function DOe(r,e){for(var t=0;t<r.length;++t){var n=r[t],a=t===r.length-1?e:r[t+1].length;if(n.length===0)throw new Error("Ragged splits may not be empty");if(n[0]<0)throw new Error("Ragged splits must be non-negative");if(n[n.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<n.length;++i)if(n[i-1]>n[i])throw new Error("Ragged splits must be sorted in ascending order")}}function FOe(r,e,t,n){var a=[],i=0,o=e.length-1+t.length,s=new Array(o).fill(null).map(function(){return[0]});DOe(t,n);for(var u=1,l=0;l<e.length-1;++l){u*=e[l];for(var c=e[l+1],f=1;f<u+1;++f)s[l].push(f*c)}for(var f=0;f<r.length;++f){for(var h=r[f],p=r[f]+1,l=0;l<t.length;++l){var d=t[l],m=l+e.length-1;if(m>=0)for(var v=s[m],g=v[v.length-1]-d[h],y=h;y<p;++y)s[m].push(d[y+1]+g);h=d[h],p=d[p]}p!==h&&(a.push([h,p]),i+=p-h)}return{outSplits:s,valueSlices:a,numValues:i}}function ROe(r){for(var e=[],t=function(a){var i=r[a].length,o=E.util.getArrayFromDType("int32",i);e.push(o),r[a].forEach(function(s,u){return o[u]=s})},n=0;n<r.length;++n)t(n);return e}function h$(r,e){for(var t=r.slice(0,e);t.length<e;)t.push(1);for(var n=e;n<r.length;n++)t[e-1]*=r[n];return t}function OOe(r,e,t,n,a,i){var o,s,u=h$(e,2)[1],l=h$(i,2)[1],c=0;try{for(var f=pc(t),h=f.next();!h.done;h=f.next())for(var p=h.value,d=p[0];d<p[1];++d){for(var m=0;m<n;++m)a[c*l+m]=r[d*u+m];++c}}catch(v){o={error:v}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}}function POe(r,e,t,n,a){var i=e.slice();i[0]=a;var o=E.util.getArrayFromDType(t,E.util.sizeFromShape(i)),s=r.length,u=s===0?0:s/e[0];return OOe(r,e,n,u,o,i),[o,i]}function U$(r,e,t,n,a,i,o,s){if(r.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");var u=e[0][0]-1;if(_Oe(i,o,u),n.length===0)throw new Error("params.rank must be nonzero");var l=n[0],c=FOe(i,o,r,l),f=c.outSplits,h=c.valueSlices,p=c.numValues,d=ROe(f),m=POe(t,n,a,h,p);return[d,m[0],m[1]]}var li=E.backend_util.RowPartitionType,MOe=function(){function r(e,t,n,a,i,o,s,u,l,c){this.shape=e,this.shapeShape=t,this.values=n,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=E.backend_util.getRowPartitionTypesHelper(c),this.raggedRank=E.backend_util.getRaggedRank(this.rowPartitionTypes)}return r.prototype.getRowPartitionTypeByDimension=function(e){return this.rowPartitionTypes[0]===li.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]},r.prototype.getRowPartitionTensor=function(e){return this.rowPartitionTypes[0]===li.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]},r.prototype.getMaxWidth=function(e){var t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case li.VALUE_ROWIDS:return r.getMaxWidthValueRowID(t);case li.ROW_SPLITS:return r.getMaxWidthRowSplit(t);default:throw new Error("Cannot handle partition type "+li[this.getRowPartitionTypeByDimension(e-1)])}},r.getMaxWidthRowSplit=function(e){var t=e.length;if(t===0||t===1)return 0;for(var n=0,a=0;a<t-1;++a){var i=e[a+1]-e[a];i>n&&(n=i)}return n},r.getMaxWidthValueRowID=function(e){var t=e.length;if(t===0)return 0;for(var n=0,a=e[0],i=0,o=1;o<t;++o){var s=e[o];s!==a&&(a=s,i=Math.max(o-n,i),n=o)}return Math.max(t-n,i)},r.prototype.tensorShapeFromTensor=function(e,t,n){if(n===void 0&&(n=!0),t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return d$(e,n)},r.prototype.calculateOutputSize=function(e){var t=this.valuesShape,n=this.defaultValueShape;E.backend_util.validateDefaultValueShape(n,t);var a=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=E.backend_util.combineRaggedTensorToTensorShapes(this.raggedRank,a,t),o=i;o[0]<0&&(o[0]=e);for(var s=1;s<=this.raggedRank;++s)o[s]<0&&(o[s]=this.getMaxWidth(s));return o},r.prototype.calculateFirstParentOutputIndex=function(e,t,n){for(var a=Math.min(e,n),i=[],o=0,s=0;s<a;++s,o+=t)i.push(o);for(var s=a;s<e;++s)i.push(-1);return E.util.assert(i.length===e,function(){return"Final length of result must be equal to firstDimension."}),i},r.prototype.calculateOutputIndexRowSplit=function(e,t,n,a){for(var i=e.length,o=[],s=0;s<i-1;++s){var u=e[s+1]-e[s],l=Math.min(a,u),c=t[s];c===-1&&(l=0);for(var f=0;f<l;++f)o.push(c),c+=n;for(var f=0;f<u-l;++f)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o},r.prototype.calculateOutputIndexValueRowID=function(e,t,n,a){var i=e.length,o=[];if(i===0)return[];var s=0,u=e[0];if(u>=t.length)throw new Error("Got currentValueRowId="+u+", which is not less than "+t.length);var l=t[u];o.push(l);for(var c=1;c<i;++c){var f=e[c];if(f===u)l>=0&&(++s,s<a?l+=n:l=-1);else{if(s=0,u=f,f>=t.length)throw new Error("Got nextValueRowId="+f+" which is not less than "+t.length);l=t[f]}o.push(l)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o},r.prototype.calculateOutputIndex=function(e,t,n,a){var i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case li.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,n,a);case li.ROW_SPLITS:if(i.length-1>t.length)throw new Error("Row partition size is greater than output size: "+(i.length-1)+" > "+t.length);return this.calculateOutputIndexRowSplit(i,t,n,a);default:throw new Error("Unsupported partition type: "+li[o])}},r.prototype.getFirstDimensionSize=function(){var e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case li.FIRST_DIM_SIZE:return e[0];case li.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case li.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type "+li[t])}},r.prototype.compute=function(){var e=this.rowPartitionValues[0];if(e.length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var t=this.getFirstDimensionSize(),n=this.calculateOutputSize(t),a=new Array(this.raggedRank+1);a[a.length-1]=1;for(var i=a.length-2;i>=0;--i)a[i]=a[i+1]*n[i+1];var o=d$(n,!1),s=E.util.getArrayFromDType(this.valuesDType,E.util.sizeFromShape(o)),u=a[0]*n[0];if(u>0){for(var l=this.calculateFirstParentOutputIndex(t,a[0],n[0]),i=1;i<=this.raggedRank;++i){var c=this.calculateOutputIndex(i-1,l,a[i],n[i]);l=c}this.setOutput(this.raggedRank,l,s,o)}return[o,s]},r.prototype.setOutput=function(e,t,n,a){if(n.length!==0){var i=this.values,o=n,s=a.slice();s=s.slice(e+1);var u=E.util.sizeFromShape(s),l=t.length,c=this.defaultValue;if(c.length!==u&&c.length!==1){var f=this.defaultValueShape;E.tidy(function(){var x=E.reshape(c,f),k=E.broadcastTo(x,s);c=k.dataSync()})}for(var h=0,p=0,d=0,m=0;m<=l;++m){var v=m<l?t[m]:-1;if(v===d){++d;continue}if(p<d){var g=i.subarray(h*u),y=o.subarray(p*u),b=(d-p)*u;p$(y,g,b)}if(m>=l){var w=n.length;v=Math.floor(w/u)}if(v>d)if(this.defaultValue.length===1)o.subarray(d*u,v*u).fill(this.defaultValue[0]),d=v;else for(;v>d;){var y=o.slice(d*u);p$(y,c,u),++d}v<0?(h=m+1,p=d):(h=m,p=d,d=p+1)}}},r}();function p$(r,e,t){for(var n=0;n<t;n++)r[n]=e[n]}function d$(r,e){var t,n,a=[];try{for(var i=pc(r),o=i.next();!o.done;o=i.next()){var s=o.value;if(s<0){if(!e)throw new Error("Dimension "+s+" must be >= 0");if(s<-1)throw new Error("Dimension "+s+" must be >= -1");s=-1}a.push(s)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a}function H$(r,e,t,n,a,i,o,s,u,l){return new MOe(r,e,t,n,a,i,o,s,u,l).compute()}function K$(r,e,t,n){var a=r===e,i=r<e&&t<0,o=e<r&&t>1;if(a||i||o)return E.util.makeZerosTypedArray(0,n);var s=Math.abs(Math.ceil((e-r)/t)),u=E.util.makeZerosTypedArray(s,n);e<r&&t===1&&(t=-1),u[0]=r;for(var l=1;l<u.length;l++)u[l]=u[l-1]+t;return u}var j$=Ss(function(r){return 1/Math.sqrt(r)}),BOe=gc(E.Rsqrt,j$),LOe={kernelName:E.Rsqrt,backendName:"cpu",kernelFunc:BOe};function hc(r,e,t,n,a,i,o,s,u,l){var c=[n/a,a],f=r.values,h=e.values;if(n===0)return E.buffer(t,e.dtype);var p=E.buffer(c,e.dtype);typeof u=="string"||typeof u=="number"?p.values.fill(u):typeof u=="boolean"&&p.values.fill(+u);for(var d=0;d<i;d++){for(var m=[],v=0,g=0;g<o;g++){var y=f[d*o+g];m.push(y),v+=y*s[g]}if(v<0||v>=n/a)throw new Error("Invalid indices: "+m+" does not index into "+t);for(var b=0;b<a;b++)l?p.values[v*a+b]+=h[d*a+b]:p.values[v*a+b]=e.rank===0?h[0]:h[d*a+b]}return p}var zOe=Ss(function(r){return 1/(1+Math.exp(-r))}),X$=Ut(E.Sigmoid,function(r){return 1/(1+Math.exp(-r))}),$Oe={kernelName:E.Sigmoid,backendName:"cpu",kernelFunc:X$};function Y$(r,e,t,n,a){var i=E.slice_util.isSliceContinous(n,e,t),o=E.util.sizeFromShape(t),s=E.util.computeStrides(n);if(i){var u=E.slice_util.computeFlatOffset(e,s);return a==="string"?r.slice(u,u+o):r.subarray(u,u+o)}for(var l=a==="string"?E.backend_util.fromUint8ToStringArray(r):r,c=E.buffer(n,a,l),f=E.buffer(t,a),h=0;h<f.size;++h){var p=f.indexToLoc(h),d=p.map(function(m,v){return m+e[v]});f.set.apply(f,Oi([c.get.apply(c,Oi(d))],p))}return a==="string"?E.backend_util.fromStringArrayToUint8(f.values):f.values}function $u(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.begin,o=n.size;Ve(a,"slice");var s=tt(E.slice_util.parseSliceParams(a,i,o),2),u=s[0],l=s[1];E.slice_util.assertParamsValid(a,u,l);var c=t.data.get(a.dataId).values,f=Y$(c,u,l,a.shape,a.dtype);return t.makeTensorInfo(l,a.dtype,f)}var WOe={kernelName:E.Slice,backendName:"cpu",kernelFunc:$u};function Z$(r,e,t,n,a,i,o){var s=e[0],u=i[0],l=new Array(u),c=new Array(s),f=e[1];if(u===0){if(s!==0)throw new Error(E.backend_util.getSparseFillEmptyRowsIndicesDenseShapeMismatch(s));var h=E.util.getArrayFromDType(t,0),p=E.util.getArrayFromDType(a,0);return[h,[0,f],p,l,c]}for(var d=!0,m=0,v=new Array(u).fill(0),g=0;g<s;++g){var y=r[g*f];if(y<0)throw new Error(E.backend_util.getSparseFillEmptyRowsNegativeIndexErrorMessage(g,y));if(y>=u)throw new Error(E.backend_util.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(g,y,u));++v[y],d=d&&y>=m,m=y}for(var b=!0,y=0;y<u;++y){var w=v[y]===0;l[y]=w,b=b&&!w,v[y]=Math.max(v[y],1),y>0&&(v[y]+=v[y-1])}if(b&&d){for(var h=r,p=n,g=0;g<s;++g)c[g]=g;return[h,[s,f],p,l,c]}else{for(var x=v[u-1],h=E.util.getArrayFromDType(t,x*f),p=E.util.getArrayFromDType(a,x),k=new Array(u).fill(0),g=0;g<s;++g){var y=r[g*f],N=k[y],T=(y===0?0:v[y-1])+N;k[y]++;for(var I=0;I<f;++I)h[T*f+I]=r[g*f+I];p[T]=n[g],c[g]=T}for(var y=0;y<u;++y){var F=k[y];if(F===0){var D=y===0?0:v[y-1];h[D*f+0]=y;for(var R=1;R<f;++R)h[D*f+R]=0;p[D]=o}}return[h,[x,f],p,l,c]}}function J$(r,e,t,n,a){for(var i=E.util.sizeFromShape(n),o=e[0],s=a.length,u=[],l=1,c=-1,f=0;f<s;++f){var h=a[f];if(h===-1){if(c!==-1)throw new Error(E.backend_util.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(c,f));c=f,u.push(1)}else{if(h<0)throw new Error(E.backend_util.getSparseReshapeNegativeOutputDimErrorMessage(f,h));l*=h,u.push(h)}}if(c!==-1){if(l<=0)throw new Error(E.backend_util.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());var p=Math.trunc(i/l);if(l*p!==i)throw new Error(E.backend_util.getSparseReshapeInputOutputMultipleErrorMessage(n,u));u[c]=p}var d=E.util.sizeFromShape(u);if(d!==i)throw new Error(E.backend_util.getSparseReshapeInputOutputMismatchErrorMessage(n,u));var m=n.length,v=[];if(m>0){v[m-1]=1;for(var f=m-2;f>=0;--f)v[f]=v[f+1]*n[f+1]}var g=[];if(s>0){g[s-1]=1;for(var f=s-2;f>=0;--f)g[f]=g[f+1]*u[f+1]}for(var y=E.util.getArrayFromDType(t,o*s),b=0;b<o;++b){for(var w=0,x=0;x<m;++x)w+=r[b*m+x]*v[x];for(var x=0;x<s;++x)y[b*s+x]=Math.trunc(w/g[x]),w%=g[x]}return[y,[o,s],u]}function yk(r,e,t,n,a,i,o){i===void 0&&(i=!1),o===void 0&&(o=0);var s=n.length,u=[e[0],r.length/e[0]],l=u[1],c=s>0?a[s-1]+1:0,f=c;if(f<0)throw new Error(E.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var h=e.slice();h[0]=f;var p=h.reduce(function(N,T){return N*T},1),d=E.util.getArrayFromDType(t,p);if(s===0)return f>0&&d.fill(o),[d,h];if(f<=0)throw new Error(E.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());for(var m=0,v=1,g=0,y=a[m];;){var b=0;if(v<s){if(b=a[v],y===b){++v;continue}if(y>=b)throw new Error(E.backend_util.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=f)throw new Error(E.backend_util.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,f));y>g&&d.fill(o,g*l,y*l);for(var w=m;w<v;++w){var x=n[w];if(x<0||x>=u[0])throw new Error(E.backend_util.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(w,n[w],u[0]));for(var k=0;k<l;k++)d[y*l+k]+=r[x*l+k]}if(i)for(var k=0;k<l;k++)d[y*l+k]/=v-m;if(m=v,++v,g=y+1,y=b,v>s)break}return g<f&&d.fill(o,g*l,f*l),[d,h]}var qOe=Ss(function(r){return Math.sqrt(r)}),VOe=Ut(E.Sqrt,function(r){return Math.sqrt(r)}),GOe={kernelName:E.Sqrt,backendName:"cpu",kernelFunc:VOe};var Q$=jr(function(r,e){var t=r-e;return t*t}),UOe=fn(E.SquaredDifference,Q$),HOe={kernelName:E.SquaredDifference,backendName:"cpu",kernelFunc:UOe};function eW(r,e,t,n){for(var a=E.buffer(r,e.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*t[u]+n[u];a.set.apply(a,Oi([e.get.apply(e,Oi(s))],o))}return a}var KOe=function(){function r(e,t,n,a,i,o){this.separator=E.util.encodeString(e),this.nGramWidths=t,this.leftPad=E.util.encodeString(n),this.rightPad=E.util.encodeString(a),this.padWidth=i,this.preserveShort=o}return r.prototype.getPadWidth=function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)},r.prototype.getNumNGrams=function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)},r.prototype.createNGrams=function(e,t,n,a,i,o){for(var s=function(c){var f=u.getPadWidth(o),h=Math.max(0,f-c),p=Math.max(0,f-(i-(c+1))),d=o-(h+p),m=t+(h>0?0:c-f),v=0;v+=h*u.leftPad.length;for(var g=0;g<d;++g)v+=e[m+g].length;v+=p*u.rightPad.length;var y=h+p+d-1;v+=y*u.separator.length,n[a+c]=new Uint8Array(v);for(var b=n[a+c],w=0,x=function(k){return k.forEach(function(N){return b[w++]=N})},g=0;g<h;++g)x(u.leftPad),x(u.separator);for(var g=0;g<d-1;++g)x(e[m+g]),x(u.separator);if(d>0){x(e[m+d-1]);for(var g=0;g<p;++g)x(u.separator),x(u.rightPad)}else{for(var g=0;g<p-1;++g)x(u.rightPad),x(u.separator);x(u.rightPad)}},u=this,l=0;l<i;++l)s(l)},r.prototype.compute=function(e,t){var n=this,a=e.length,i=t.length;if(i>0){var o=t[0];if(o!==0)throw new Error("First split value must be 0, got "+o);for(var s=1;s<i;++s){var u=t[s]>=o;if(u=u&&t[s]<=a,!u)throw new Error("Invalid split value "+t[s]+", must be in ["+o+", "+a+"]");o=t[s]}if(o!==a)throw new Error("Last split value must be data size. Expected "+a+", got "+o)}var l=i-1,c=E.util.getArrayFromDType("int32",i);if(a===0||i===0){for(var f=new Array(a),s=0;s<=l;++s)c[s]=0;return[f,c]}c[0]=0;for(var h=function(g){var y=t[g]-t[g-1],b=0;p.nGramWidths.forEach(function(w){b+=n.getNumNGrams(y,w)}),p.preserveShort&&y>0&&b===0&&(b=1),c[g]=c[g-1]+b},p=this,s=1;s<=l;++s)h(s);for(var d=new Array(c[l]),m=function(g){var y=t[g],b=c[g];if(v.nGramWidths.forEach(function(N){var T=t[g+1]-t[g],I=n.getNumNGrams(T,N);n.createNGrams(e,y,d,b,I,N),b+=I}),v.preserveShort&&b===c[g]){var w=t[g+1]-t[g];if(w===0)return"continue";var x=w+2*v.padWidth,k=1;v.createNGrams(e,y,d,b,k,x)}},v=this,s=0;s<l;++s)m(s);return[d,c]},r}();function tW(r,e,t,n,a,i,o,s){return new KOe(t,n,a,i,o,s).compute(r,e)}function jOe(r,e,t,n){if(!!r.length){if(e.length===0){for(var a=0;a<r.length;++a)n.push(r.subarray(a,a+1));return}if(e.length===1){for(var i=e[0],o=r.indexOf(i);o!==-1;){var s=r.subarray(0,o);(!t||s.length!==0)&&n.push(s),r=r.subarray(o+1),o=r.indexOf(i)}(!t||r.length!==0)&&n.push(r);return}for(var u=0,a=0;a<r.length+1;a++)if(a===r.length||e.indexOf(r[a])!==-1){var s=r.subarray(u,a);(!t||s.length!==0)&&n.push(s),u=a+1}}}function rW(r,e,t){for(var n=r.length,a=[],i=0,o=0,s=new Array(n),u=0;u<n;++u){var l=a.length;jOe(r[u],e,t,a);var c=a.length-l;s[u]=c,i+=c,o=Math.max(o,c)}for(var f=E.util.getArrayFromDType("int32",i*2),h=new Array(i),p=[n,o],d=0,u=0;u<n;++u)for(var m=0;m<s[u];++m)f[d*2]=u,f[d*2+1]=m,h[d]=a[d],++d;return[f,h,p]}function nW(r,e){for(var t=E.util.getArrayFromDType("int32",r.length),n=0;n<r.length;++n)t[n]=E.util.fingerPrint64(r[n]).modulo(e).getLowBitsUnsigned();return t}var aW=jr(function(r,e){return r-e}),XOe=dk(function(r,e,t,n){return{real:r-t,imag:e-n}}),bk=fn(E.Sub,aW,XOe),YOe={kernelName:E.Sub,backendName:"cpu",kernelFunc:bk};function iW(r,e){for(var t=new Array(r.rank),n=0;n<t.length;n++)t[n]=r.shape[n]*e[n];for(var a=E.buffer(t,r.dtype),n=0;n<a.values.length;++n){for(var i=a.indexToLoc(n),o=new Array(r.rank),s=0;s<o.length;s++)o[s]=i[s]%r.shape[s];var u=r.locToIndex(o);a.values[n]=r.values[u]}return a}var Hh=function(r,e){var t=e.value-r.value;return t===0?r.index-e.index:t};function oW(r,e,t,n){for(t===void 0&&(t=0),n===void 0&&(n=r.length-1);n>t;){if(n-t>600){var a=n-t+1,i=e-t+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2),l=Math.max(t,Math.floor(e-i*s/a+u)),c=Math.min(n,Math.floor(e+(a-i)*s/a+u));oW(r,e,l,c)}var f=r[e],h=t,p=n;for(E.util.swap(r,t,e),Hh(r[n],f)>0&&E.util.swap(r,t,n);h<p;){for(E.util.swap(r,h,p),h++,p--;Hh(r[h],f)<0;)h=h+1;for(;Hh(r[p],f)>0;)p=p-1}Hh(r[t],f)===0?E.util.swap(r,t,p):(p=p+1,E.util.swap(r,p,n)),p<=e&&(t=p+1),e<=p&&(n=p-1)}}function sW(r,e,t,n,a){for(var i=e[e.length-1],o=tt([r.length/i,i],2),s=o[0],u=o[1],l=E.util.getTypedArrayFromDType(t,s*n),c=E.util.getTypedArrayFromDType("int32",s*n),f=function(d){var m=d*u,v=r.subarray(m,m+u),g=new Array(v.length);v.forEach(function(k,N){return g[N]={value:k,index:N}}),n<g.length&&(oW(g,n),g=g.slice(0,n)),a&&g.sort(Hh);for(var y=d*n,b=l.subarray(y,y+n),w=c.subarray(y,y+n),x=0;x<n;x++)b[x]=g[x].value,w[x]=g[x].index},h=0;h<s;h++)f(h);var p=e.slice();return p[p.length-1]=n,[E.buffer(p,t,l),E.buffer(p,"int32",c)]}function uW(r,e,t,n){for(var a=E.util.parseAxisParam(e,t)[0],i=[1,t[0],1],o=0;o<a;o++)i[0]*=t[o];i[1]=t[a];for(var o=a+1;o<t.length;o++)i[2]*=t[o];for(var s={},u=new Int32Array(t[a]),l=new E.TensorBuffer(i,n,r),c=[],f=i[0]===1&&i[2]===1,o=0;o<t[a];o++){var h=void 0;if(f)h=r[o].toString();else{for(var p=[],d=0;d<i[0];d++)for(var m=0;m<i[2];m++)p.push(l.get(d,o,m));h=p.join(",")}if(s[h]!==void 0)u[o]=s[h];else{var v=Object.keys(s).length;s[h]=v,u[o]=v,c.push(o)}}var g=i.slice();g[1]=Object.keys(s).length;var y=new E.TensorBuffer(g,n);c.forEach(function(w,x){for(var k=0;k<i[0];k++)for(var N=0;N<i[2];N++)y.set(l.get(k,w,N),k,x,N)});var b=t.slice();return b[a]=g[1],{outputValues:y.values,outputShape:b,indices:u}}var ZOe={__proto__:null,simpleAbsImpl:b$,addImpl:x$,bincountImpl:vk,bincountReduceImpl:k$,castImpl:w$,ceilImpl:S$,concatImpl:N$,equalImpl:E$,expImpl:I$,expm1Impl:A$,floorImpl:_$,gatherNdImpl:D$,gatherV2Impl:F$,greaterImpl:R$,greaterEqualImpl:O$,lessImpl:P$,lessEqualImpl:M$,linSpaceImpl:B$,logImpl:L$,maxImpl:z$,maximumImpl:$$,minimumImpl:W$,multiplyImpl:mk,negImpl:q$,notEqualImpl:V$,prodImpl:G$,raggedGatherImpl:U$,raggedTensorToTensorImpl:H$,rangeImpl:K$,rsqrtImpl:j$,scatterImpl:hc,sigmoidImpl:zOe,sliceImpl:Y$,sparseFillEmptyRowsImpl:Z$,sparseReshapeImpl:J$,sparseSegmentReductionImpl:yk,sqrtImpl:qOe,squaredDifferenceImpl:Q$,stridedSliceImpl:eW,stringNGramsImpl:tW,stringSplitImpl:rW,stringToHashBucketFastImpl:nW,subImpl:aW,tileImpl:iW,topKImpl:sW,transposeImpl:gk,uniqueImpl:uW};var JOe="3.21.0";E.registerBackend("cpu",function(){return new pk},1);var lW=Ut(E.Elu,function(r){return r>=0?r:Math.exp(r)-1}),QOe={kernelName:E.Elu,backendName:"cpu",kernelFunc:lW};function cW(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.alpha;Ve([a],"leakyRelu");for(var o=E.util.sizeFromShape(a.shape),s=t.data.get(a.dataId).values,u=E.util.getTypedArrayFromDType("float32",o),l=0;l<s.length;l++)u[l]=s[l]<0?i*s[l]:s[l];return t.makeTensorInfo(a.shape,"float32",u)}var ePe={kernelName:E.LeakyRelu,backendName:"cpu",kernelFunc:cW},tPe=jr(function(r,e){return r<0?e*r:r});function fW(r){var e=r.inputs,t=r.backend,n=e.x,a=e.alpha;Ve([n,a],"prelu");var i=t.data.get(n.dataId).values,o=t.data.get(a.dataId).values,s=tt(tPe(n.shape,a.shape,i,o,"float32"),2),u=s[0],l=s[1];return t.makeTensorInfo(l,"float32",u)}var rPe={kernelName:E.Prelu,backendName:"cpu",kernelFunc:fW};var hW=Ut(E.Relu,function(r){return Math.max(0,r)}),nPe={kernelName:E.Relu,backendName:"cpu",kernelFunc:hW};var pW=Ut(E.Relu6,function(r){return Math.min(Math.max(0,r),6)}),aPe={kernelName:E.Relu6,backendName:"cpu",kernelFunc:pW};function eg(r,e,t,n,a){if(t==="linear")return ro({inputs:{x:e},backend:r});if(t==="relu")return hW({inputs:{x:e},backend:r});if(t==="elu")return lW({inputs:{x:e},backend:r});if(t==="relu6")return pW({inputs:{x:e},backend:r});if(t==="prelu")return fW({inputs:{x:e,alpha:n},backend:r});if(t==="leakyrelu")return cW({inputs:{x:e},backend:r,attrs:{alpha:a}});if(t==="sigmoid")return X$({inputs:{x:e},backend:r});throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}function Qt(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.shape,o=E.util.sizeFromShape(a.shape),s=E.util.inferFromImplicitShape(i,o),u=E.util.sizeFromShape(s);E.util.assert(o===u,function(){return"The new shape ("+s+") has "+u+" elements and the old "+("shape ("+a.shape+") has "+o+" elements. The new shape and old ")+"shape must have the same number of elements."}),t.incRef(a.dataId);var l=t.data.get(a.dataId);if(l.complexTensorInfos!=null){var c=l.complexTensorInfos.real,f=l.complexTensorInfos.imag;c.shape=s,f.shape=s}return{dataId:a.dataId,shape:s,dtype:a.dtype}}var iPe={kernelName:E.Reshape,backendName:"cpu",kernelFunc:Qt};function dW(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.a,i=e.b,o=n.transposeA,s=n.transposeB;Ve([a,i],"matMul");var u=a.shape.length,l=i.shape.length,c=o?a.shape[u-2]:a.shape[u-1],f=s?i.shape[l-1]:i.shape[l-2],h=o?a.shape[u-1]:a.shape[u-2],p=s?i.shape[l-2]:i.shape[l-1],d=a.shape.slice(0,-2),m=i.shape.slice(0,-2),v=E.util.sizeFromShape(d),g=E.util.sizeFromShape(m),y=E.broadcast_util.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)),b=y.concat([h,p]);E.util.assert(c===f,function(){return"Error in matMul: inner shapes ("+c+") and ("+(f+") of Tensors with shapes "+a.shape+" and ")+(i.shape+" and transposeA="+o)+(" and transposeB="+s+" must match.")});for(var w=o?[v,c,h]:[v,h,c],x=s?[g,p,f]:[g,f,p],k=Qt({inputs:{x:a},backend:t,attrs:{shape:w}}),N=Qt({inputs:{x:i},backend:t,attrs:{shape:x}}),T=o?k.shape[1]:k.shape[2],I=o?k.shape[2]:k.shape[1],F=s?N.shape[1]:N.shape[2],D=Math.max(v,g),R=t.data.get(k.dataId).values,P=t.data.get(N.dataId).values,B=E.util.computeStrides(k.shape),q=E.util.computeStrides(N.shape),O=tt(o?[B[0],1,B[1]]:[B[0],B[1],1],3),V=O[0],K=O[1],Z=O[2],j=tt(s?[1,q[1],q[0]]:[q[1],1,q[0]],3),ee=j[0],le=j[1],se=j[2],ce=I*F,he=E.buffer([D,I,F],k.dtype),xe=he.values,Se=t.blockSize,we=0;we<D;we++)for(var ke=0;ke<I;ke+=Se)for(var Ne=0;Ne<F;Ne+=Se)for(var Ae=0;Ae<T;Ae+=Se)for(var Ze=Math.min(ke+Se,I),Et=Math.min(Ne+Se,F),st=Math.min(Ae+Se,T),it=ke;it<Ze;it++)for(var ft=Ne;ft<Et;ft++){for(var dt=0,Je=Ae;Je<st;Je++){var at=Math.min(we,v-1)*V,nt=Math.min(we,g-1)*se,yr=R[at+it*K+Je*Z],Ue=P[Je*ee+ft*le+nt];dt+=yr*Ue}xe[we*ce+(it*F+ft)]+=dt}return t.disposeIntermediateTensorInfo(k),t.disposeIntermediateTensorInfo(N),t.makeTensorInfo(b,he.dtype,he.values)}var oPe={kernelName:E.BatchMatMul,backendName:"cpu",kernelFunc:dW};function sPe(r){var e,t,n=r.inputs,a=r.backend,i=r.attrs,o=n.a,s=n.b,u=n.bias,l=n.preluActivationWeights,c=i.transposeA,f=i.transposeB,h=i.activation,p=i.leakyreluAlpha,d,m,v,g=[],y=dW({inputs:{a:o,b:s},attrs:{transposeA:c,transposeB:f},backend:a});d=y,u&&(m=dc({inputs:{a:d,b:u},backend:a}),g.push(d),d=m),h&&(v=eg(a,d,h,l,p),g.push(d),d=v);try{for(var b=pc(g),w=b.next();!w.done;w=b.next()){var x=w.value;a.disposeIntermediateTensorInfo(x)}}catch(k){e={error:k}}finally{try{w&&!w.done&&(t=b.return)&&t.call(b)}finally{if(e)throw e.error}}return d}var uPe={kernelName:E._FusedMatMul,backendName:"cpu",kernelFunc:sPe};var lPe=Ut(E.Acos,function(r){return Math.acos(r)}),cPe={kernelName:E.Acos,backendName:"cpu",kernelFunc:lPe};var fPe=Ut(E.Acosh,function(r){return Math.acosh(r)}),hPe={kernelName:E.Acosh,backendName:"cpu",kernelFunc:fPe};function pPe(r){var e=r.inputs,t=r.backend,n=e;Ve(e,"addN");for(var a=n.map(function(c){return t.data.get(c.dataId).values}),i=E.buffer(n[0].shape,n[0].dtype),o=i.values,s=0;s<n.length;s++)for(var u=a[s],l=0;l<o.length;l++)o[l]+=u[l];return t.makeTensorInfo(i.shape,i.dtype,i.values)}var dPe={kernelName:E.AddN,backendName:"cpu",kernelFunc:pPe};function vPe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;Ve(a,"all");var s=E.util.parseAxisParam(i,a.shape),u=s,l=E.backend_util.getAxesPermutation(u,a.shape.length),c=a;l!=null&&(c=Gn({inputs:{x:a},backend:t,attrs:{perm:l}}),u=E.backend_util.getInnerMostAxes(u.length,a.shape.length)),E.backend_util.assertAxesAreInnerMostDims("all",u,c.shape.length);for(var f=tt(E.backend_util.computeOutAndReduceShapes(c.shape,u),2),h=f[0],p=f[1],d=E.util.sizeFromShape(p),m=E.util.makeZerosTypedArray(E.util.sizeFromShape(h),c.dtype),v=t.data.get(c.dataId).values,g=0;g<m.length;++g){for(var y=g*d,b=v[y],w=0;w<d;++w){var x=v[y+w];b=b&&x}m[g]=b}l!=null&&t.disposeIntermediateTensorInfo(c);var k=t.makeTensorInfo(h,c.dtype,m);if(o){var N=E.backend_util.expandShapeToKeepDim(h,s),T=Qt({inputs:{x:k},backend:t,attrs:{shape:N}});return t.disposeIntermediateTensorInfo(k),T}return k}var mPe={kernelName:E.All,backendName:"cpu",kernelFunc:vPe};function gPe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;Ve(a,"any");var s=E.util.parseAxisParam(i,a.shape),u=s,l=E.backend_util.getAxesPermutation(u,a.shape.length),c=a;l!=null&&(c=Gn({inputs:{x:a},backend:t,attrs:{perm:l}}),u=E.backend_util.getInnerMostAxes(u.length,a.shape.length)),E.backend_util.assertAxesAreInnerMostDims("any",u,c.shape.length);for(var f=tt(E.backend_util.computeOutAndReduceShapes(c.shape,u),2),h=f[0],p=f[1],d=E.util.sizeFromShape(p),m=E.util.makeZerosTypedArray(E.util.sizeFromShape(h),c.dtype),v=t.data.get(c.dataId).values,g=0;g<m.length;++g){for(var y=g*d,b=v[y],w=0;w<d;++w){var x=v[y+w];b=b||x}m[g]=b}l!=null&&t.disposeIntermediateTensorInfo(c);var k=t.makeTensorInfo(h,c.dtype,m);if(o){var N=E.backend_util.expandShapeToKeepDim(h,s),T=Qt({inputs:{x:k},backend:t,attrs:{shape:N}});return t.disposeIntermediateTensorInfo(k),T}return k}var yPe={kernelName:E.Any,backendName:"cpu",kernelFunc:gPe};function bPe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis;Ve(a,"argMax");var o=E.util.parseAxisParam(i,a.shape),s=E.backend_util.getAxesPermutation(o,a.shape.length),u=a,l=[];s!=null&&(u=Gn({inputs:{x:a},backend:t,attrs:{perm:s}}),l.push(u),o=E.backend_util.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],E.backend_util.assertAxesAreInnerMostDims("argMax",o,u.shape.length);for(var c=tt(E.backend_util.computeOutAndReduceShapes(u.shape,o),2),f=c[0],h=c[1],p=E.util.sizeFromShape(f),d=E.util.makeZerosTypedArray(p,"int32"),m=E.util.sizeFromShape(h),v=t.data.get(u.dataId).values,g=0;g<d.length;++g){for(var y=g*m,b=v[y],w=0,x=0;x<m;++x){var k=v[y+x];k>b&&(b=k,w=x)}d[g]=w}return l.forEach(function(N){return t.disposeIntermediateTensorInfo(N)}),t.makeTensorInfo(f,"int32",d)}var wPe={kernelName:E.ArgMax,backendName:"cpu",kernelFunc:bPe};function xPe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis;Ve(a,"argMin");var o=E.util.parseAxisParam(i,a.shape),s=E.backend_util.getAxesPermutation(o,a.shape.length),u=a,l=[];s!=null&&(u=Gn({inputs:{x:a},backend:t,attrs:{perm:s}}),l.push(u),o=E.backend_util.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],E.backend_util.assertAxesAreInnerMostDims("argMin",o,u.shape.length);for(var c=tt(E.backend_util.computeOutAndReduceShapes(u.shape,o),2),f=c[0],h=c[1],p=E.util.sizeFromShape(f),d=E.util.makeZerosTypedArray(p,"int32"),m=E.util.sizeFromShape(h),v=t.data.get(u.dataId).values,g=0;g<d.length;++g){for(var y=g*m,b=v[y],w=0,x=0;x<m;++x){var k=v[y+x];k<b&&(b=k,w=x)}d[g]=w}return l.forEach(function(N){return t.disposeIntermediateTensorInfo(N)}),t.makeTensorInfo(f,"int32",d)}var kPe={kernelName:E.ArgMin,backendName:"cpu",kernelFunc:xPe};var SPe=Ut(E.Asin,function(r){return Math.asin(r)}),NPe={kernelName:E.Asin,backendName:"cpu",kernelFunc:SPe};var EPe=Ut(E.Asinh,function(r){return Math.asinh(r)}),TPe={kernelName:E.Asinh,backendName:"cpu",kernelFunc:EPe};var IPe=Ut(E.Atan,function(r){return Math.atan(r)}),CPe={kernelName:E.Atan,backendName:"cpu",kernelFunc:IPe};var APe=jr(function(r,e){return Math.atan2(r,e)}),_Pe=fn(E.Atan2,APe),DPe={kernelName:E.Atan2,backendName:"cpu",kernelFunc:_Pe};var FPe=Ut(E.Atanh,function(r){return Math.atanh(r)}),RPe={kernelName:E.Atanh,backendName:"cpu",kernelFunc:FPe};function wk(r,e,t,n,a,i){for(var o=a.strideHeight,s=a.strideWidth,u=a.dilationHeight,l=a.dilationWidth,c=a.effectiveFilterHeight,f=a.effectiveFilterWidth,h=a.padInfo.top,p=a.padInfo.left,d=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=E.buffer(a.outShape,t),v=m.values,g=a.outShape[1]*a.outShape[2]*a.outShape[3],y=a.outShape[2]*a.outShape[3],b=a.outShape[3],w=0;w<a.batchSize;++w)for(var x=w*g,k=w*n[0],N=0;N<a.inChannels;++N)for(var T=0;T<a.outHeight;++T)for(var I=T*o-h,F=Math.max(0,I),D=Math.min(a.inHeight,c+I),R=x+T*y,P=0;P<a.outWidth;++P){for(var B=P*s-p,q=Math.max(0,B),O=Math.min(a.inWidth,f+B),V=d,K=0,Z=0,j=F;j<D;j+=u){for(var ee=k+j*n[1],le=q;le<O;le+=l){var se=ee+le*n[2],ce=r[se+N];i==="max"&&ce>V?V=ce:i==="avg"&&(K+=ce,Z++)}if(isNaN(V))break}var he=R+P*b+N;v[he]=i==="avg"?K/Z:V}return m}function vW(r,e,t,n,a,i){a===void 0&&(a=!1),i===void 0&&(i=!1);for(var o=E.buffer(n.outShape,"int32"),s=n.strideHeight,u=n.strideWidth,l=n.dilationHeight,c=n.dilationWidth,f=n.effectiveFilterHeight,h=n.effectiveFilterWidth,p=n.padInfo.top,d=n.padInfo.left,m=E.buffer(e,t,r),v=0;v<n.batchSize;++v)for(var g=0;g<n.inChannels;++g)for(var y=0;y<n.outHeight;++y){for(var b=y*s-p,w=b;w<0;)w+=l;for(var x=Math.min(n.inHeight,f+b),k=0;k<n.outWidth;++k){for(var N=k*u-d,T=N;T<0;)T+=c;for(var I=Math.min(n.inWidth,h+N),F=Number.NEGATIVE_INFINITY,D=-1,R=w;R<x;R+=l)for(var P=R-b,B=T;B<I;B+=c){var q=B-N,O=m.get(v,R,B,g);O>F&&(F=O,a?D=i?((v*n.inHeight+R)*n.inWidth+B)*n.inChannels+g:(R*n.inWidth+B)*n.inChannels+g:D=P*h+q)}o.set(D,v,y,k,g)}}return o}function mW(r,e,t,n,a,i){for(var o=a.strideDepth,s=a.strideHeight,u=a.strideWidth,l=a.dilationDepth,c=a.dilationHeight,f=a.dilationWidth,h=a.effectiveFilterDepth,p=a.effectiveFilterHeight,d=a.effectiveFilterWidth,m=a.padInfo.front,v=a.padInfo.top,g=a.padInfo.left,y=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=E.buffer(a.outShape,t),w=b.values,x=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],k=a.outShape[2]*a.outShape[3]*a.outShape[4],N=a.outShape[3]*a.outShape[4],T=a.outShape[4],I=0;I<a.batchSize;++I)for(var F=I*x,D=I*n[0],R=0;R<a.inChannels;++R)for(var P=0;P<a.outDepth;++P){for(var B=P*o-m,q=B;q<0;)q+=l;for(var O=Math.min(a.inDepth,h+B),V=F+P*k,K=0;K<a.outHeight;++K){for(var Z=K*s-v,j=Z;j<0;)j+=c;for(var ee=Math.min(a.inHeight,p+Z),le=V+K*N,se=0;se<a.outWidth;++se){for(var ce=se*u-g,he=ce;he<0;)he+=f;for(var xe=Math.min(a.inWidth,d+ce),Se=le+se*T,we=y,ke=0,Ne=0,Ae=q;Ae<O;Ae+=l){for(var Ze=D+Ae*n[1],Et=j;Et<ee;Et+=c){for(var st=Ze+Et*n[2],it=he;it<xe;it+=f){var ft=st+it*n[3],dt=r[ft+R];if(i==="max"&&dt>we?we=dt:i==="avg"&&(ke+=dt,Ne++),isNaN(we))break}if(isNaN(we))break}if(isNaN(we))break}var Je=Se+R;w[Je]=i==="avg"?ke/Ne:we}}}return b}function OPe(r,e){for(var t=E.buffer(e.outShape,"int32"),n=e.strideDepth,a=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,s=e.dilationHeight,u=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,f=e.effectiveFilterWidth,h=e.padInfo.front,p=e.padInfo.top,d=e.padInfo.left,m=0;m<e.batchSize;++m)for(var v=0;v<e.inChannels;++v)for(var g=0;g<e.outDepth;++g){for(var y=g*n-h,b=y;b<0;)b+=o;for(var w=Math.min(e.inDepth,l+y),x=0;x<e.outHeight;++x){for(var k=x*a-p,N=k;N<0;)N+=s;for(var T=Math.min(e.inHeight,c+k),I=0;I<e.outWidth;++I){for(var F=I*i-d,D=F;D<0;)D+=u;for(var R=Math.min(e.inWidth,f+F),P=Number.NEGATIVE_INFINITY,B=-1,q=b;q<w;q+=o)for(var O=q-y,V=N;V<T;V+=s)for(var K=V-k,Z=D;Z<R;Z+=u){var j=Z-F,ee=r.get(m,q,V,Z,v);ee>=P&&(P=ee,B=O*c*f+K*c+j)}t.set(B,m,g,x,I,v)}}}return t}function PPe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;Ve(a,"avgPool");var i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,l=1;E.util.assert(E.backend_util.eitherStridesOrDilationsAreOne(o,l),function(){return"Error in avgPool: Either strides or dilations must be 1. "+("Got strides "+o+" and dilations '"+l+"'")});var c=E.backend_util.computePool2DInfo(a.shape,i,o,l,s,u),f;if(c.filterWidth===1&&c.filterHeight===1&&E.util.arraysEqual(c.inShape,c.outShape))f=ro({inputs:{x:a},backend:t});else{var h=t.data.get(a.dataId).values,p=E.util.computeStrides(a.shape),d=wk(h,a.shape,a.dtype,p,c,"avg");f=t.makeTensorInfo(c.outShape,a.dtype,d.values)}return f}var MPe={kernelName:E.AvgPool,backendName:"cpu",kernelFunc:PPe};function BPe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,l=n.dataFormat;Ve(a,"avgPool3d");var c=E.backend_util.computePool3DInfo(a.shape,i,o,1,s,u,l),f=t.data.get(a.dataId).values,h=mW(f,a.shape,a.dtype,E.util.computeStrides(a.shape),c,"avg");return t.makeTensorInfo(h.shape,"float32",h.values)}var LPe={kernelName:E.AvgPool3D,backendName:"cpu",kernelFunc:BPe};function zPe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=n.filterSize,s=n.strides,u=n.pad,l=n.dimRoundingMode;Ve([a,i],"avgPool3DGrad");for(var c=E.backend_util.computePool3DInfo(i.shape,o,s,1,u,l),f=c.strideDepth,h=c.strideHeight,p=c.strideWidth,d=c.filterDepth,m=c.filterHeight,v=c.filterWidth,g=c.dilationDepth,y=c.dilationHeight,b=c.dilationWidth,w=c.effectiveFilterDepth,x=c.effectiveFilterHeight,k=c.effectiveFilterWidth,N=w-1-c.padInfo.front,T=k-1-c.padInfo.left,I=x-1-c.padInfo.top,F=E.buffer(i.shape,"float32"),D=1/(d*m*v),R=t.bufferSync(a),P=0;P<c.batchSize;++P)for(var B=0;B<c.inChannels;++B)for(var q=0;q<c.inDepth;++q)for(var O=0;O<c.inHeight;++O)for(var V=0;V<c.inWidth;++V){for(var K=q-N,Z=O-I,j=V-T,ee=0,le=0;le<w;le+=g){var se=(K+le)/f;if(!(se<0||se>=c.outDepth||Math.floor(se)!==se))for(var ce=0;ce<x;ce+=y){var he=(Z+ce)/h;if(!(he<0||he>=c.outHeight||Math.floor(he)!==he))for(var xe=0;xe<k;xe+=b){var Se=(j+xe)/p;if(!(Se<0||Se>=c.outWidth||Math.floor(Se)!==Se)){var we=R.get(P,se,he,Se,B);ee+=we}}}}F.set(ee*D,P,q,O,V,B)}return t.makeTensorInfo(F.shape,F.dtype,F.values)}var $Pe={kernelName:E.AvgPool3DGrad,backendName:"cpu",kernelFunc:zPe};function WPe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=i;Ve([a,i],"avgPoolGrad");for(var s=n.filterSize,u=n.strides,l=n.pad,c=E.backend_util.computePool2DInfo(o.shape,s,u,1,l),f=c.strideHeight,h=c.strideWidth,p=c.filterHeight,d=c.filterWidth,m=c.dilationHeight,v=c.dilationWidth,g=c.effectiveFilterHeight,y=c.effectiveFilterWidth,b=y-1-c.padInfo.left,w=g-1-c.padInfo.top,x=E.buffer(o.shape,"float32"),k=1/(p*d),N=t.data.get(a.dataId).values,T=E.buffer(a.shape,"float32",N),I=0;I<c.batchSize;++I)for(var F=0;F<c.inChannels;++F)for(var D=0;D<c.inHeight;++D)for(var R=0;R<c.inWidth;++R){for(var P=D-w,B=R-b,q=0,O=0;O<g;O+=m){var V=(P+O)/f;if(!(V<0||V>=c.outHeight||Math.floor(V)!==V))for(var K=0;K<y;K+=v){var Z=(B+K)/h;if(!(Z<0||Z>=c.outWidth||Math.floor(Z)!==Z)){var j=T.get(I,V,Z,F);q+=j}}}x.set(q*k,I,D,R,F)}return t.makeTensorInfo(x.shape,x.dtype,x.values)}var qPe={kernelName:E.AvgPoolGrad,backendName:"cpu",kernelFunc:WPe};function VPe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.scale,o=e.offset,s=e.mean,u=e.variance;E.util.assert(s.shape.length===u.shape.length,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),E.util.assert(o==null||s.shape.length===o.shape.length,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),E.util.assert(i==null||s.shape.length===i.shape.length,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),Ve([a,s,u,i,o],"batchNorm");var l=n.varianceEpsilon;l==null&&(l=.001);for(var c=t.data.get(a.dataId).values,f=t.data.get(s.dataId).values,h=t.data.get(u.dataId).values,p=i?t.data.get(i.dataId).values:new Float32Array([1]),d=o?t.data.get(o.dataId).values:new Float32Array([0]),m=new Float32Array(c.length),v=d.length,g=p.length,y=h.length,b=f.length,w=0,x=0,k=0,N=0,T=0;T<c.length;++T)m[T]=d[w++]+(c[T]-f[x++])*p[k++]/Math.sqrt(h[N++]+l),w>=v&&(w=0),x>=b&&(x=0),k>=g&&(k=0),N>=y&&(N=0);return t.makeTensorInfo(a.shape,a.dtype,m)}var GPe={kernelName:E.FusedBatchNorm,backendName:"cpu",kernelFunc:VPe};function UPe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockShape,o=n.crops;Ve([a],"batchToSpaceND");var s=i.reduce(function(g,y){return g*y}),u=E.backend_util.getReshaped(a.shape,i,s),l=E.backend_util.getPermuted(u.length,i.length),c=E.backend_util.getReshapedPermuted(a.shape,i,s),f=E.backend_util.getSliceBeginCoords(o,i.length),h=E.backend_util.getSliceSize(c,o,i.length),p=Qt({inputs:{x:a},backend:t,attrs:{shape:u}}),d=Gn({inputs:{x:p},backend:t,attrs:{perm:l}}),m=Qt({inputs:{x:d},backend:t,attrs:{shape:c}}),v=$u({inputs:{x:m},backend:t,attrs:{begin:f,size:h}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(m),v}var HPe={kernelName:E.BatchToSpaceND,backendName:"cpu",kernelFunc:UPe};function KPe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.weights,o=n.size,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,l=vk(s,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,l)}var jPe={kernelName:E.Bincount,backendName:"cpu",kernelFunc:KPe};function XPe(r){var e=r.inputs,t=r.backend,n=e.s0,a=e.s1,i=t.data.get(n.dataId).values,o=t.data.get(a.dataId).values,s=E.backend_util.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return t.makeTensorInfo([s.length],"int32",Int32Array.from(s))}var YPe={kernelName:E.BroadcastArgs,backendName:"cpu",kernelFunc:XPe};var ZPe=Ut(E.ClipByValue,function(r,e){var t=e;return r>t.clipValueMax?t.clipValueMax:r<t.clipValueMin?t.clipValueMin:r}),JPe={kernelName:E.ClipByValue,backendName:"cpu",kernelFunc:ZPe};var QPe=function(r){for(var e=r.inputs.x,t=r.backend,n=new Float32Array(E.util.sizeFromShape(e.shape)),a=t.data.get(e.dataId),i=a.complexTensorInfos.real,o=a.complexTensorInfos.imag,s=t.data.get(i.dataId).values,u=t.data.get(o.dataId).values,l=0;l<s.length;l++){var c=s[l],f=u[l];n[l]=Math.hypot(c,f)}return t.makeOutput(n,e.shape,"float32")},eMe={kernelName:E.ComplexAbs,backendName:"cpu",kernelFunc:QPe};function vc(r){var e=r.inputs,t=r.backend,n=e.input,a=t.data.get(n.dataId).complexTensorInfos.imag,i=t.data.get(a.dataId).values;return t.makeTensorInfo(a.shape,a.dtype,i)}var tMe={kernelName:E.Imag,backendName:"cpu",kernelFunc:vc};function mc(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.axis,i=E.util.parseAxisParam(a,e[0].shape)[0],o=e.map(function(w){return w.shape});E.backend_util.assertParamsConsistent(o,i);var s=E.backend_util.computeOutShape(e.map(function(w){return w.shape}),i);if(E.util.sizeFromShape(s)===0)return t.makeTensorInfo(s,e[0].dtype,[]);var u=e.filter(function(w){return E.util.sizeFromShape(w.shape)>0});if(u.length===1)return ro({inputs:{x:u[0]},backend:t});if(u[0].dtype==="complex64"){var l=u.map(function(w){return zu({inputs:{input:w},backend:t})}),c=u.map(function(w){return vc({inputs:{input:w},backend:t})}),f=mc({inputs:l,backend:t,attrs:{axis:i}}),h=mc({inputs:c,backend:t,attrs:{axis:i}}),p=ma({inputs:{real:f,imag:h},backend:t});return l.forEach(function(w){return t.disposeIntermediateTensorInfo(w)}),c.forEach(function(w){return t.disposeIntermediateTensorInfo(w)}),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),p}var d=u.map(function(w){var x=E.util.sizeFromShape(w.shape.slice(i)),k=[-1,x];return Qt({inputs:{x:w},backend:t,attrs:{shape:k}})}),m=d.map(function(w){return{vals:t.data.get(w.dataId).values,shape:w.shape}});s=E.backend_util.computeOutShape(d.map(function(w){return w.shape}),1);var v=d[0].shape[0]===1,g=N$(m,s,e[0].dtype,v),y=E.backend_util.computeOutShape(u.map(function(w){return w.shape}),i),b=t.makeTensorInfo(y,e[0].dtype,g);return d.forEach(function(w){return t.disposeIntermediateTensorInfo(w)}),b}var rMe={kernelName:E.Concat,backendName:"cpu",kernelFunc:mc};function gW(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dataFormat,l=n.dilations,c=n.dimRoundingMode;Ve([a,i],"conv2d");for(var f=E.backend_util.convertConv2DDataFormat(u),h=E.backend_util.computeConv2DInfo(a.shape,i.shape,o,l,s,c,!1,f),p=h.filterHeight,d=h.filterWidth,m=h.dilationHeight,v=h.dilationWidth,g=h.padInfo.left,y=h.padInfo.top,b=h.dataFormat==="channelsLast",w=new E.TensorBuffer(h.outShape,a.dtype),x=E.util.computeStrides(a.shape),k=E.util.computeStrides(i.shape),N=x[0],T=b?x[1]:x[2],I=b?x[2]:1,F=b?1:x[1],D=w.strides[0],R=b?w.strides[1]:w.strides[2],P=b?w.strides[2]:1,B=b?1:w.strides[1],q=t.data.get(a.dataId).values,O=t.data.get(i.dataId).values,V=w.values,K=0;K<h.batchSize;++K)for(var Z=K*N,j=K*D,ee=0;ee<h.outHeight;++ee)for(var le=j+ee*R,se=ee*h.strideHeight-y,ce=0;ce<p;++ce){var he=se+ce*m;if(!(he<0||he>=h.inHeight))for(var xe=ce*k[0],Se=Z+he*T,we=0;we<h.outWidth;++we)for(var ke=le+we*P,Ne=we*h.strideWidth-g,Ae=0;Ae<d;++Ae){var Ze=Ne+Ae*v;if(!(Ze<0||Ze>=h.inWidth))for(var Et=xe+Ae*k[1],st=Se+Ze*I,it=Et,ft=0;ft<h.inChannels;++ft){for(var dt=q[st+ft*F],Je=0;Je<h.outChannels;++Je)V[ke+Je*B]+=dt*O[it+Je];it+=h.outChannels}}}return t.makeTensorInfo(w.shape,w.dtype,V)}var nMe={kernelName:E.Conv2D,backendName:"cpu",kernelFunc:gW};function aMe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.pad,u=n.dataFormat,l=n.dimRoundingMode,c=n.filterShape;Ve([a,i],"conv2dBackpropFilter");for(var f=E.backend_util.convertConv2DDataFormat(u),h=E.backend_util.computeConv2DInfo(a.shape,c,o,1,s,l,!1,f),p=h.strideHeight,d=h.strideWidth,m=h.filterHeight,v=h.filterWidth,g=h.dataFormat==="channelsLast",y=new E.TensorBuffer(h.filterShape,"float32"),b=h.padInfo.left,w=h.padInfo.top,x=t.data.get(a.dataId).values,k=t.data.get(i.dataId).values,N=new E.TensorBuffer(a.shape,a.dtype,x),T=new E.TensorBuffer(i.shape,i.dtype,k),I=0;I<m;++I)for(var F=Math.max(0,Math.ceil((w-I)/p)),D=Math.min(h.outHeight,(h.inHeight+w-I)/p),R=0;R<v;++R)for(var P=Math.max(0,Math.ceil((b-R)/d)),B=Math.min(h.outWidth,(h.inWidth+b-R)/d),q=0;q<h.inChannels;++q)for(var O=0;O<h.outChannels;++O){for(var V=0,K=0;K<h.batchSize;++K)for(var Z=F;Z<D;++Z)for(var j=I+Z*p-w,ee=P;ee<B;++ee){var le=R+ee*d-b;g?V+=N.get(K,j,le,q)*T.get(K,Z,ee,O):V+=N.get(K,q,j,le)*T.get(K,O,Z,ee)}y.set(V,I,R,q,O)}return t.makeTensorInfo(y.shape,y.dtype,y.values)}var iMe={kernelName:E.Conv2DBackpropFilter,backendName:"cpu",kernelFunc:aMe};function oMe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.inputShape,s=n.strides,u=n.pad,l=n.dataFormat,c=n.dimRoundingMode;Ve([a,i],"conv2dBackpropInput");var f=E.util.computeStrides(i.shape),h=E.util.computeStrides(a.shape),p=E.backend_util.convertConv2DDataFormat(l),d=E.backend_util.computeConv2DInfo(o,i.shape,s,1,u,c,!1,p),m=new E.TensorBuffer(d.inShape,"float32"),v=m.values,g=t.data.get(a.dataId).values,y=t.data.get(i.dataId).values,b=tt(f,3),w=b[0],x=b[1],k=b[2],N=d.batchSize,T=d.filterHeight,I=d.filterWidth,F=d.inChannels,D=d.inHeight,R=d.inWidth,P=d.outChannels,B=d.outHeight,q=d.outWidth,O=d.strideHeight,V=d.strideWidth;p=d.dataFormat;for(var K=T-1-d.padInfo.top,Z=I-1-d.padInfo.left,j=p==="channelsLast",ee=m.strides[0],le=j?m.strides[1]:m.strides[2],se=j?m.strides[2]:1,ce=j?1:m.strides[1],he=h[0],xe=j?h[1]:h[2],Se=j?h[2]:1,we=j?1:h[1],ke=0;ke<N;++ke)for(var Ne=0;Ne<F;++Ne)for(var Ae=0;Ae<D;++Ae)for(var Ze=Ae-K,Et=Math.max(0,Math.ceil(Ze/O)),st=Math.min(B,(T+Ze)/O),it=0;it<R;++it){for(var ft=it-Z,dt=Math.max(0,Math.ceil(ft/V)),Je=Math.min(q,(I+ft)/V),at=0,nt=Et;nt<st;++nt)for(var yr=nt*O-Ze,Ue=dt;Ue<Je;++Ue)for(var _t=Ue*V-ft,zr=he*ke+xe*nt+Se*Ue,wn=w*(T-1-yr)+x*(I-1-_t)+k*Ne,Vr=0;Vr<P;++Vr){var $r=g[zr+we*Vr],br=y[wn+Vr];at+=$r*br}var jn=ee*ke+le*Ae+se*it+ce*Ne;v[jn]=at}return t.makeTensorInfo(m.shape,m.dtype,m.values)}var sMe={kernelName:E.Conv2DBackpropInput,backendName:"cpu",kernelFunc:oMe};function uMe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations;Ve([a,i],"conv3d");for(var l=E.backend_util.computeConv3DInfo(a.shape,i.shape,o,u,s),c=l.filterDepth,f=l.filterHeight,h=l.filterWidth,p=l.dilationDepth,d=l.dilationHeight,m=l.dilationWidth,v=l.padInfo,g=v.front,y=v.left,b=v.top,w=new E.TensorBuffer(l.outShape,a.dtype),x=t.data.get(a.dataId).values,k=t.data.get(i.dataId).values,N=w.values,T=E.util.computeStrides(a.shape),I=E.util.computeStrides(i.shape),F=0;F<l.batchSize;++F)for(var D=F*T[0],R=F*w.strides[0],P=0;P<l.outDepth;++P)for(var B=R+P*w.strides[1],q=P*l.strideDepth-g,O=0;O<c;++O){var V=q+O*p;if(!(V<0||V>=l.inDepth))for(var K=O*I[0],Z=D+V*T[1],j=0;j<l.outHeight;++j)for(var ee=B+j*w.strides[2],le=j*l.strideHeight-b,se=0;se<f;++se){var ce=le+se*d;if(!(ce<0||ce>=l.inHeight))for(var he=K+se*I[1],xe=Z+ce*T[2],Se=0;Se<l.outWidth;++Se)for(var we=ee+Se*l.outChannels,ke=Se*l.strideWidth-y,Ne=0;Ne<h;++Ne){var Ae=ke+Ne*m;if(!(Ae<0||Ae>=l.inWidth))for(var Ze=he+Ne*I[2],Et=xe+Ae*l.inChannels,st=Ze,it=0;it<l.inChannels;++it){for(var ft=x[Et+it],dt=0;dt<l.outChannels;++dt)N[we+dt]+=ft*k[st+dt];st+=l.outChannels}}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}var lMe={kernelName:E.Conv3D,backendName:"cpu",kernelFunc:uMe};function cMe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.pad,u=n.filterShape;Ve([a,i],"conv3dBackpropFilterV2");for(var l=E.util.computeStrides(a.shape),c=E.util.computeStrides(i.shape),f=E.backend_util.computeConv3DInfo(a.shape,u,o,1,s),h=f.strideDepth,p=f.strideHeight,d=f.strideWidth,m=f.filterDepth,v=f.filterHeight,g=f.filterWidth,y=new E.TensorBuffer(f.filterShape,"float32"),b=y.values,w=tt(y.strides,4),x=w[0],k=w[1],N=w[2],T=w[3],I=t.data.get(i.dataId).values,F=tt(c,4),D=F[0],R=F[1],P=F[2],B=F[3],q=t.data.get(a.dataId).values,O=tt(l,4),V=O[0],K=O[1],Z=O[2],j=O[3],ee=f.padInfo.front,le=f.padInfo.left,se=f.padInfo.top,ce=0;ce<m;++ce)for(var he=Math.max(0,Math.ceil((ee-ce)/h)),xe=Math.min(f.outDepth,(f.inDepth+ee-ce)/h),Se=ce*x,we=0;we<v;++we)for(var ke=Math.max(0,Math.ceil((se-we)/p)),Ne=Math.min(f.outHeight,(f.inHeight+se-we)/p),Ae=we*k+Se,Ze=0;Ze<g;++Ze)for(var Et=Math.max(0,Math.ceil((le-Ze)/d)),st=Math.min(f.outWidth,(f.inWidth+le-Ze)/d),it=Ze*N+Ae,ft=0;ft<f.inChannels;++ft)for(var dt=ft*T+it,Je=0;Je<f.outChannels;++Je){for(var at=0,nt=0;nt<f.batchSize;++nt)for(var yr=nt*V,Ue=nt*D,_t=he;_t<xe;++_t)for(var zr=ce+_t*h-ee,wn=zr*K+yr,Vr=_t*R+Ue,$r=ke;$r<Ne;++$r)for(var br=we+$r*p-se,jn=br*Z+wn,xn=$r*P+Vr,Xn=Et;Xn<st;++Xn){var Dr=Ze+Xn*d-le,so=Dr*j+jn,ol=Xn*B+xn;at+=q[so+ft]*I[ol+Je]}b[dt+Je]=at}return t.makeTensorInfo(y.shape,y.dtype,y.values)}var fMe={kernelName:E.Conv3DBackpropFilterV2,backendName:"cpu",kernelFunc:cMe};function hMe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.pad,s=n.strides,u=n.inputShape;Ve([a],"conv3dBackpropInputV2");for(var l=E.util.computeStrides(a.shape),c=E.util.computeStrides(i.shape),f=E.backend_util.computeConv3DInfo(u,i.shape,s,1,o),h=new E.TensorBuffer(f.inShape,"float32"),p=h.values,d=tt(h.strides,4),m=d[0],v=d[1],g=d[2],y=d[3],b=t.data.get(a.dataId).values,w=tt(l,4),x=w[0],k=w[1],N=w[2],T=w[3],I=t.data.get(i.dataId).values,F=tt(c,4),D=F[0],R=F[1],P=F[2],B=F[3],q=f.batchSize,O=f.filterDepth,V=f.filterHeight,K=f.filterWidth,Z=f.inChannels,j=f.inDepth,ee=f.inHeight,le=f.inWidth,se=f.outChannels,ce=f.outDepth,he=f.outHeight,xe=f.outWidth,Se=f.strideDepth,we=f.strideHeight,ke=f.strideWidth,Ne=O-1-f.padInfo.front,Ae=V-1-f.padInfo.top,Ze=K-1-f.padInfo.left,Et=0;Et<q;++Et)for(var st=0;st<Z;++st)for(var it=0;it<j;++it)for(var ft=it-Ne,dt=Math.max(0,Math.ceil(ft/Se)),Je=Math.min(ce,(O+ft)/Se),at=0;at<ee;++at)for(var nt=at-Ae,yr=Math.max(0,Math.ceil(nt/we)),Ue=Math.min(he,(V+nt)/we),_t=0;_t<le;++_t){for(var zr=_t-Ze,wn=Math.max(0,Math.ceil(zr/ke)),Vr=Math.min(xe,(K+zr)/ke),$r=0,br=dt;br<Je;++br)for(var jn=br*Se-ft,xn=yr;xn<Ue;++xn)for(var Xn=xn*we-nt,Dr=wn;Dr<Vr;++Dr)for(var so=Dr*ke-zr,ol=x*Et+k*br+N*xn+T*Dr,Lp=D*(O-1-jn)+R*(V-1-Xn)+P*(K-1-so)+B*st,uo=0;uo<se;++uo){var Fs=b[ol+uo],sl=I[Lp+uo];$r+=Fs*sl}p[m*Et+v*it+g*at+y*_t+st]=$r}return t.makeTensorInfo(h.shape,h.dtype,h.values)}var pMe={kernelName:E.Conv3DBackpropInputV2,backendName:"cpu",kernelFunc:hMe};var dMe=Ut(E.Cos,function(r){return Math.cos(r)}),vMe={kernelName:E.Cos,backendName:"cpu",kernelFunc:dMe};var mMe=Ut(E.Cosh,function(r){return Math.cosh(r)}),gMe={kernelName:E.Cosh,backendName:"cpu",kernelFunc:mMe};function yMe(r){for(var e=r.inputs,t=r.backend,n=r.attrs,a=e.image,i=e.boxes,o=e.boxInd,s=n.cropSize,u=n.method,l=n.extrapolationValue,c=tt(a.shape,4),f=c[0],h=c[1],p=c[2],d=c[3],m=i.shape[0],v=tt(s,2),g=v[0],y=v[1],b=E.buffer([m,g,y,d],"float32"),w=t.data.get(i.dataId).values,x=t.data.get(o.dataId).values,k=t.data.get(a.dataId).values,N=E.util.computeStrides(a.shape),T=E.util.computeStrides(b.shape),I=0;I<m;I++){var F=I*4,D=w[F],R=w[F+1],P=w[F+2],B=w[F+3],q=x[I];if(!(q>=f))for(var O=g>1?(P-D)*(h-1)/(g-1):0,V=y>1?(B-R)*(p-1)/(y-1):0,K=0;K<g;K++){var Z=g>1?D*(h-1)+K*O:.5*(D+P)*(h-1);if(Z<0||Z>h-1){for(var j=0;j<y;j++)for(var ee=0;ee<d;ee++){var le=ee+j*T[2]+K*T[1]+I*T[0];b.values[le]=l}continue}if(u==="bilinear")for(var se=Math.floor(Z),ce=Math.ceil(Z),he=Z-se,j=0;j<y;j++){var xe=y>1?R*(p-1)+j*V:.5*(R+B)*(p-1);if(xe<0||xe>p-1){for(var ee=0;ee<d;ee++){var le=ee+j*T[2]+K*T[1]+I*T[0];b.values[le]=l}continue}for(var Se=Math.floor(xe),we=Math.ceil(xe),ke=xe-Se,ee=0;ee<d;ee++){var le=ee+Se*N[2]+se*N[1]+q*N[0],Ne=k[le];le=ee+we*N[2]+se*N[1]+q*N[0];var Ae=k[le];le=ee+Se*N[2]+ce*N[1]+q*N[0];var Ze=k[le];le=ee+we*N[2]+ce*N[1]+q*N[0];var Et=k[le],st=Ne+(Ae-Ne)*ke,it=Ze+(Et-Ze)*ke;le=ee+j*T[2]+K*T[1]+I*T[0],b.values[le]=st+(it-st)*he}}else for(var j=0;j<y;++j){var xe=y>1?R*(p-1)+j*V:.5*(R+B)*(p-1);if(xe<0||xe>p-1){for(var ee=0;ee<d;ee++){var le=ee+j*T[2]+K*T[1]+I*T[0];b.values[le]=l}continue}for(var ft=Math.round(xe),dt=Math.round(Z),ee=0;ee<d;ee++){var Je=ee+ft*N[2]+dt*N[1]+q*N[0],at=ee+j*T[2]+K*T[1]+I*T[0];b.values[at]=k[Je]}}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}var bMe={kernelName:E.CropAndResize,backendName:"cpu",kernelFunc:yMe};function wMe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.exclusive,s=n.reverse;Ve(a,"cumprod");var u=E.backend_util.getAxesPermutation([i],a.shape.length),l=a;u!=null&&(l=Gn({inputs:{x:a},backend:t,attrs:{perm:u}}));var c=E.backend_util.getInnerMostAxes(1,a.shape.length)[0];if(c!==l.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most "+("axis="+(l.shape.length-1)+" but got axis="+c));for(var f=E.upcastType(l.dtype,"int32"),h=E.util.makeOnesTypedArray(E.util.sizeFromShape(l.shape),f),p=t.data.get(l.dataId).values,d=l.shape[l.shape.length-1],m=s?function(N,T){return N+d-T-1}:function(N,T){return N+T},v=0;v<p.length;v+=d)for(var g=0;g<d;g++){var y=m(v,g);if(g===0)h[y]=o?1:p[y];else{var b=m(v,g-1);h[y]=o?p[b]*h[b]:p[y]*h[b]}}var w=t.makeTensorInfo(l.shape,f,h);if(u!=null){var x=E.backend_util.getUndoAxesPermutation(u),k=Gn({inputs:{x:w},backend:t,attrs:{perm:x}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(l),k}return w}var xMe={kernelName:E.Cumprod,backendName:"cpu",kernelFunc:wMe};function kMe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.exclusive,s=n.reverse;Ve(a,"cumsum");var u=E.backend_util.getAxesPermutation([i],a.shape.length),l=a;u!=null&&(l=Gn({inputs:{x:a},backend:t,attrs:{perm:u}}));var c=E.backend_util.getInnerMostAxes(1,a.shape.length)[0];if(c!==l.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most "+("axis="+(l.shape.length-1)+" but got axis="+c));for(var f=E.upcastType(l.dtype,"int32"),h=E.util.makeZerosTypedArray(E.util.sizeFromShape(l.shape),f),p=t.data.get(l.dataId).values,d=l.shape[l.shape.length-1],m=s?function(N,T){return N+d-T-1}:function(N,T){return N+T},v=0;v<p.length;v+=d)for(var g=0;g<d;g++){var y=m(v,g);if(g===0)h[y]=o?0:p[y];else{var b=m(v,g-1);h[y]=o?p[b]+h[b]:p[y]+h[b]}}var w=t.makeTensorInfo(l.shape,f,h);if(u!=null){var x=E.backend_util.getUndoAxesPermutation(u),k=Gn({inputs:{x:w},backend:t,attrs:{perm:x}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(l),k}return w}var SMe={kernelName:E.Cumsum,backendName:"cpu",kernelFunc:kMe};function NMe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.weights,o=n.size,s=n.binaryOutput;if(a.shape.length===1){var u=t.data.get(a.dataId).values,l=t.data.get(i.dataId).values,c=vk(u,l,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,c)}else if(a.shape.length===2){var f=t.bufferSync(a),h=t.bufferSync(i),p=k$(f,h,o,s);return t.makeTensorInfo(p.shape,i.dtype,p.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+(a.shape.length+"."))}var EMe={kernelName:E.DenseBincount,backendName:"cpu",kernelFunc:NMe};function TMe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockSize,o=n.dataFormat;E.util.assert(o==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+o});for(var s=a.shape[0],u=a.shape[1],l=a.shape[2],c=a.shape[3],f=u*i,h=l*i,p=c/(i*i),d=t.data.get(a.dataId).values,m=new Float32Array(s*f*h*p),v=0,g=0;g<s;++g)for(var y=0;y<f;++y)for(var b=Math.floor(y/i),w=y%i,x=0;x<h;++x)for(var k=Math.floor(x/i),N=x%i,T=(w*i+N)*p,I=0;I<p;++I){var F=I+T,D=F+c*(k+l*(b+u*g));m[v++]=d[D]}return t.makeTensorInfo([s,f,h,p],a.dtype,m)}var IMe={kernelName:E.DepthToSpace,backendName:"cpu",kernelFunc:TMe};function yW(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,l=n.dimRoundingMode;Ve([a,i],"depthwiseConv2DNative");var c=E.util.computeStrides(a.shape),f=E.util.computeStrides(i.shape),h=u;h==null&&(h=[1,1]),E.util.assert(E.backend_util.eitherStridesOrDilationsAreOne(o,h),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+("1. Got strides "+o+" and dilations '"+h+"'")});for(var p=E.backend_util.computeConv2DInfo(a.shape,i.shape,o,h,s,l,!0),d=p.filterHeight,m=p.filterWidth,v=p.dilationHeight,g=p.dilationWidth,y=p.padInfo,b=y.left,w=y.top,x=p.outChannels/p.inChannels,k=new E.TensorBuffer(p.outShape,a.dtype),N=t.data.get(a.dataId).values,T=t.data.get(i.dataId).values,I=k.values,F=0;F<p.batchSize;++F)for(var D=F*c[0],R=F*k.strides[0],P=0;P<p.outHeight;++P)for(var B=R+P*k.strides[1],q=P*p.strideHeight-w,O=0;O<d;++O){var V=q+O*v;if(!(V<0||V>=p.inHeight))for(var K=O*f[0],Z=D+V*c[1],j=0;j<p.outWidth;++j)for(var ee=B+j*k.strides[2],le=j*p.strideWidth-b,se=0;se<m;++se){var ce=le+se*g;if(!(ce<0||ce>=p.inWidth))for(var he=K+se*f[1],xe=Z+ce*p.inChannels,Se=ee,we=he,ke=0;ke<p.inChannels;++ke){for(var Ne=N[xe+ke],Ae=0;Ae<x;++Ae)I[Se+Ae]+=Ne*T[we+Ae];Se+=x,we+=x}}}return t.makeTensorInfo(k.shape,k.dtype,k.values)}var CMe={kernelName:E.DepthwiseConv2dNative,backendName:"cpu",kernelFunc:yW};function AMe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.dilations,u=n.pad,l=n.dimRoundingMode,c=n.filterShape;Ve([a,i],"depthwiseConv2dNativeBackpropFilter");for(var f=E.backend_util.computeConv2DInfo(a.shape,c,o,s,u,l,!0),h=f.strideHeight,p=f.strideWidth,d=f.filterHeight,m=f.filterWidth,v=new E.TensorBuffer(f.filterShape,"float32"),g=f.padInfo.left,y=f.padInfo.top,b=f.outChannels/f.inChannels,w=t.data.get(a.dataId).values,x=new E.TensorBuffer(a.shape,a.dtype,w),k=t.data.get(i.dataId).values,N=new E.TensorBuffer(i.shape,i.dtype,k),T=0;T<d;++T)for(var I=Math.max(0,Math.ceil((y-T)/h)),F=Math.min(f.outHeight,(f.inHeight+y-T)/h),D=0;D<m;++D)for(var R=Math.max(0,Math.ceil((g-D)/p)),P=Math.min(f.outWidth,(f.inWidth+g-D)/p),B=0;B<f.outChannels;++B){for(var q=Math.trunc(B/b),O=B%b,V=0,K=0;K<f.batchSize;++K)for(var Z=I;Z<F;++Z)for(var j=T+Z*h-y,ee=R;ee<P;++ee){var le=D+ee*p-g;V+=x.get(K,j,le,q)*N.get(K,Z,ee,B)}v.set(V,T,D,q,O)}return t.makeTensorInfo(v.shape,v.dtype,v.values)}var _Me={kernelName:E.DepthwiseConv2dNativeBackpropFilter,backendName:"cpu",kernelFunc:AMe};function DMe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.strides,s=n.dilations,u=n.pad,l=n.dimRoundingMode,c=n.inputShape;Ve([a,i],"depthwiseConv2DNativeBackpropInput");for(var f=E.util.computeStrides(a.shape),h=E.util.computeStrides(i.shape),p=E.backend_util.computeConv2DInfo(c,i.shape,o,s,u,l,!0),d=new E.TensorBuffer(p.inShape,"float32"),m=d.values,v=tt(d.strides,3),g=v[0],y=v[1],b=v[2],w=t.data.get(a.dataId).values,x=tt(f,3),k=x[0],N=x[1],T=x[2],I=t.data.get(i.dataId).values,F=tt(h,3),D=F[0],R=F[1],P=F[2],B=p.batchSize,q=p.filterHeight,O=p.filterWidth,V=p.inChannels,K=p.inHeight,Z=p.inWidth,j=p.outChannels,ee=p.outHeight,le=p.outWidth,se=p.strideHeight,ce=p.strideWidth,he=q-1-p.padInfo.top,xe=O-1-p.padInfo.left,Se=j/V,we=0;we<B;++we)for(var ke=0;ke<V;++ke)for(var Ne=0;Ne<K;++Ne)for(var Ae=Ne-he,Ze=Math.max(0,Math.ceil(Ae/se)),Et=Math.min(ee,(q+Ae)/se),st=0;st<Z;++st){for(var it=st-xe,ft=Math.max(0,Math.ceil(it/ce)),dt=Math.min(le,(O+it)/ce),Je=0,at=Ze;at<Et;++at)for(var nt=at*se-Ae,yr=ft;yr<dt;++yr)for(var Ue=yr*ce-it,_t=k*we+N*at+T*yr,zr=D*(q-1-nt)+R*(O-1-Ue)+P*ke,wn=0;wn<Se;++wn){var Vr=ke*Se+wn,$r=w[_t+Vr],br=I[zr+wn];Je+=$r*br}m[g*we+y*Ne+b*st+ke]=Je}return t.makeTensorInfo(d.shape,d.dtype,d.values)}var FMe={kernelName:E.DepthwiseConv2dNativeBackpropInput,backendName:"cpu",kernelFunc:DMe};function RMe(r){for(var e=r.inputs,t=r.backend,n=e.x,a=E.util.sizeFromShape(n.shape),i=t.data.get(n.dataId).values,o=E.buffer([a,a],n.dtype),s=o.values,u=0;u<i.length;u++)s[u*a+u]=i[u];var l=Oi(n.shape,n.shape);return t.makeTensorInfo(l,o.dtype,o.values)}var OMe={kernelName:E.Diag,backendName:"cpu",kernelFunc:RMe};var PMe={kernelName:E.Dilation2D,backendName:"cpu",kernelFunc:function(r){for(var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,l=t,c=l.data.get(a.dataId).values,f=a.shape.length,h=l.data.get(i.dataId).values,p=i.shape.length,d=E.backend_util.computeDilation2DInfo(a.shape,i.shape,o,s,"NHWC",u),m=d.batchSize,v=d.inHeight,g=d.inWidth,y=d.inChannels,b=d.outHeight,w=d.outWidth,x=d.padInfo,k=d.strideHeight,N=d.strideWidth,T=d.filterHeight,I=d.filterWidth,F=d.dilationHeight,D=d.dilationWidth,R=d.outShape,P=E.util.sizeFromShape(R),B=R.length,q=E.util.getArrayFromDType(a.dtype,P),O=0;O<m;++O)for(var V=0;V<b;++V)for(var K=V*k-x.top,Z=0;Z<w;++Z)for(var j=Z*N-x.left,ee=0;ee<y;++ee){for(var le=Number.MIN_SAFE_INTEGER,se=0;se<T;++se){var ce=K+se*F;if(ce>=0&&ce<v)for(var he=0;he<I;++he){var xe=j+he*D;if(xe>=0&&xe<g){var Se=E.util.locToIndex([O,ce,xe,ee],f,E.util.computeStrides(a.shape)),we=E.util.locToIndex([se,he,ee],p,E.util.computeStrides(i.shape)),ke=c[Se]+h[we];ke>le&&(le=ke)}}}var Ne=E.util.locToIndex([O,V,Z,ee],B,E.util.computeStrides(R));q[Ne]=le}var Ae=l.write(E.util.toTypedArray(q,a.dtype),R,a.dtype);return{dataId:Ae,shape:R,dtype:a.dtype}}};var MMe={kernelName:E.Dilation2DBackpropFilter,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.dy,s=n.strides,u=n.pad,l=n.dilations,c=t,f=E.util.toNestedArray(a.shape,c.data.get(a.dataId).values),h=E.util.toNestedArray(i.shape,c.data.get(i.dataId).values),p=E.backend_util.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",l),d=p.batchSize,m=p.inHeight,v=p.inWidth,g=p.inChannels,y=p.outHeight,b=p.outWidth,w=p.padInfo,x=p.strideHeight,k=p.strideWidth,N=p.filterHeight,T=p.filterWidth,I=p.dilationHeight,F=p.dilationWidth,D=p.outShape;E.util.assert(o.rank===D.length,function(){return"Error in "+E.Dilation2DBackpropFilter+", dy "+("must have the same rank as output "+D.length+", but got ")+(""+o.rank)});for(var R=E.util.toNestedArray(D,c.data.get(o.dataId).values),P=E.util.makeZerosNestedTypedArray(i.shape,i.dtype),B=0;B<d;++B)for(var q=0;q<y;++q)for(var O=q*x-w.top,V=0;V<b;++V)for(var K=V*k-w.left,Z=0;Z<g;++Z){for(var j=Number.MIN_SAFE_INTEGER,ee=0,le=0,se=0;se<N;++se){var ce=O+se*I;if(ce>=0&&ce<m)for(var he=0;he<T;++he){var xe=K+he*F;if(xe>=0&&xe<v){var Se=f[B][ce][xe][Z]+h[se][he][Z];Se>j&&(j=Se,ee=se,le=he)}}}P[ee][le][Z]+=R[B][q][V][Z]}var we=c.write(E.util.toTypedArray(P,a.dtype),i.shape,i.dtype);return{dataId:we,shape:i.shape,dtype:i.dtype}}};var BMe={kernelName:E.Dilation2DBackpropInput,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.dy,s=n.strides,u=n.pad,l=n.dilations,c=t,f=E.util.toNestedArray(a.shape,c.data.get(a.dataId).values),h=E.util.toNestedArray(i.shape,c.data.get(i.dataId).values),p=E.backend_util.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",l),d=p.batchSize,m=p.inHeight,v=p.inWidth,g=p.inChannels,y=p.outHeight,b=p.outWidth,w=p.padInfo,x=p.strideHeight,k=p.strideWidth,N=p.filterHeight,T=p.filterWidth,I=p.dilationHeight,F=p.dilationWidth,D=p.outShape;E.util.assert(o.rank===D.length,function(){return"Error in "+E.Dilation2DBackpropInput+", dy "+("must have the same rank as output "+D.length+", but got ")+(""+o.rank)});for(var R=E.util.toNestedArray(D,c.data.get(o.dataId).values),P=E.util.makeZerosNestedTypedArray(a.shape,a.dtype),B=0;B<d;++B)for(var q=0;q<y;++q)for(var O=q*x-w.top,V=0;V<b;++V)for(var K=V*k-w.left,Z=0;Z<g;++Z){for(var j=Number.MIN_SAFE_INTEGER,ee=O<0?0:O,le=K<0?0:K,se=0;se<N;++se){var ce=O+se*I;if(ce>=0&&ce<m)for(var he=0;he<T;++he){var xe=K+he*F;if(xe>=0&&xe<v){var Se=f[B][ce][xe][Z]+h[se][he][Z];Se>j&&(j=Se,ee=ce,le=xe)}}}P[B][ee][le][Z]+=R[B][q][V][Z]}var we=c.write(E.util.toTypedArray(P,a.dtype),a.shape,a.dtype);return{dataId:we,shape:a.shape,dtype:a.dtype}}};function jh(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;Ve(a,"sum");var s;a.dtype==="bool"?s=ks({inputs:{x:a},backend:t,attrs:{dtype:"int32"}}):s=ro({inputs:{x:a},backend:t});var u=s.shape.length,l=E.util.parseAxisParam(i,s.shape),c=E.backend_util.getAxesPermutation(l,u),f=l,h=s;c!=null&&(h=Gn({inputs:{x:s},backend:t,attrs:{perm:c}}),f=E.backend_util.getInnerMostAxes(f.length,u)),E.backend_util.assertAxesAreInnerMostDims("sum",f,h.shape.length);for(var p=tt(E.backend_util.computeOutAndReduceShapes(h.shape,f),2),d=p[0],m=p[1],v=E.backend_util.upcastType(h.dtype,"int32"),g=Qm(t,d,v),y=E.util.sizeFromShape(m),b=t.data.get(g.dataId).values,w=t.data.get(h.dataId).values,x=0;x<b.length;++x){for(var k=x*y,N=0,T=0;T<y;++T)N+=w[k+T];b[x]=N}if(o){var I=E.backend_util.expandShapeToKeepDim(g.shape,l),F=g;g=Qt({inputs:{x:g},backend:t,attrs:{shape:I}}),t.disposeIntermediateTensorInfo(F)}return t.disposeIntermediateTensorInfo(s),c!=null&&t.disposeIntermediateTensorInfo(h),g}var LMe={kernelName:E.Sum,backendName:"cpu",kernelFunc:jh};function zMe(r){var e,t,n,a,i=r.inputs,o=r.backend,s=r.attrs,u=s.equation,l=i,c=E.backend_util.decodeEinsumEquation(u,l.length),f=c.allDims,h=c.summedDims,p=c.idDims;E.backend_util.checkEinsumDimSizes(f.length,p,l);for(var d=E.backend_util.getEinsumComputePath(h,p),m=d.path,v=d.steps,g=v.length,y=null,b=f.length,w=[],x=0;x<g;++x){try{for(var k=(e=void 0,pc(v[x])),N=k.next();!N.done;N=k.next()){var T=N.value,I=E.backend_util.getEinsumPermutation(b,p[T]),F=I.permutationIndices,D=I.expandDims,R=void 0;E.backend_util.isIdentityPermutation(F)?R=l[T]:(R=Gn({inputs:{x:l[T]},backend:o,attrs:{perm:F}}),w.push(R));for(var P=R.shape.slice(),B=0;B<D.length;++B)P.splice(D[B],0,1);E.util.arraysEqual(R.shape,P)||(R=Qt({inputs:{x:R},backend:o,attrs:{shape:P}}),w.push(R)),y===null?y=R:(y=ng({inputs:{a:R,b:y},backend:o}),w.push(y))}}catch(K){e={error:K}}finally{try{N&&!N.done&&(t=k.return)&&t.call(k)}finally{if(e)throw e.error}}x<g-1&&(m[x]>=0&&(y=jh({inputs:{x:y},backend:o,attrs:{axis:m[x]-(f.length-b),keepDims:!1}}),w.push(y)),b--)}try{for(var q=pc(w),O=q.next();!O.done;O=q.next()){var V=O.value;V!==y&&o.disposeIntermediateTensorInfo(V)}}catch(K){n={error:K}}finally{try{O&&!O.done&&(a=q.return)&&a.call(q)}finally{if(n)throw n.error}}return y}var $Me={kernelName:E.Einsum,backendName:"cpu",kernelFunc:zMe};function WMe(r){var e=r.inputs,t=r.backend,n=e.dy,a=e.y;Ve([n,a],"eluGrad");for(var i=new Float32Array(E.util.sizeFromShape(a.shape)),o=t.data.get(a.dataId).values,s=t.data.get(n.dataId).values,u=0;u<o.length;++u){var l=o[u];l>=1?i[u]=s[u]:i[u]=s[u]*(l+1)}return t.makeTensorInfo(a.shape,"float32",i)}var qMe={kernelName:E.EluGrad,backendName:"cpu",kernelFunc:WMe};var VMe=E.backend_util.ERF_P,GMe=E.backend_util.ERF_A1,UMe=E.backend_util.ERF_A2,HMe=E.backend_util.ERF_A3,KMe=E.backend_util.ERF_A4,jMe=E.backend_util.ERF_A5,XMe=Ut(E.Erf,function(r){var e=Math.sign(r),t=Math.abs(r),n=1/(1+VMe*t);return e*(1-((((jMe*n+KMe)*n+HMe)*n+UMe)*n+GMe)*n*Math.exp(-t*t))}),YMe={kernelName:E.Erf,backendName:"cpu",kernelFunc:XMe};function tg(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.input,i=n.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(E.util.assert(-(o+1)<=i,function(){return"Axis must be in the interval ["+-(o+1)+", "+o+"]"}),u=o+i+1),s.splice(u,0,1),Qt({inputs:{x:a},backend:t,attrs:{shape:s}})}var ZMe={kernelName:E.ExpandDims,backendName:"cpu",kernelFunc:tg};var JMe=jr(function(r,e){return r/e}),xk=fn(E.RealDiv,JMe),fk={kernelName:E.RealDiv,backendName:"cpu",kernelFunc:xk};function bW(r,e,t){for(var n=r.shape,a=n[0],i=n[1],o=t.data.get(r.dataId),s=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,l=[a,i],c=E.util.sizeFromShape(l),f=E.util.getTypedArrayFromDType("float32",c),h=E.util.getTypedArrayFromDType("float32",c),p=0;p<a;p++){for(var d=$u({inputs:{x:s},backend:t,attrs:{begin:[p,0],size:[1,i]}}),m=$u({inputs:{x:u},backend:t,attrs:{begin:[p,0],size:[1,i]}}),v=ma({inputs:{real:d,imag:m},backend:t}),g=QMe(v,e,t),y=g.real,b=g.imag,w=E.backend_util.mergeRealAndImagArrays(y,b),x=0;x<i;x++){var k=E.backend_util.getComplexWithIndex(w,x);f[p*i+x]=k.real,h[p*i+x]=k.imag}t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(v)}var N=t.makeTensorInfo(l,"float32",f),T=t.makeTensorInfo(l,"float32",h),I=ma({inputs:{real:N,imag:T},backend:t});return t.disposeIntermediateTensorInfo(N),t.disposeIntermediateTensorInfo(T),I}function QMe(r,e,t){var n=E.util.sizeFromShape(r.shape),a=t.data.get(r.dataId),i=t.data.get(a.complexTensorInfos.real.dataId).values,o=t.data.get(a.complexTensorInfos.imag.dataId).values;if(e4e(n)){var s=hk(i,o,n,e,t),u=[r.shape[0],r.shape[1]];if(e){var l=t.makeTensorInfo(u,"float32",s.real),c=t.makeTensorInfo(u,"float32",s.imag),f=t.makeTensorInfo([],"float32",E.util.createScalarValue(n,"float32")),h=ro({inputs:{x:f},backend:t}),p=fk.kernelFunc({inputs:{a:l,b:f},backend:t}),d=fk.kernelFunc({inputs:{a:c,b:h},backend:t}),m=t.data.get(p.dataId).values,v=t.data.get(d.dataId).values;return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),{real:m,imag:v}}return s}else{var g=E.backend_util.mergeRealAndImagArrays(i,o),y=t4e(g,n,e);return E.backend_util.splitRealAndImagArrays(y)}}function e4e(r){return(r&r-1)===0}function hk(r,e,t,n,a){if(t===1)return{real:r,imag:e};var i=E.backend_util.mergeRealAndImagArrays(r,e),o=t/2,s=E.backend_util.complexWithEvenIndex(i),u=s.real,l=s.imag,c=[u.length],f=a.makeTensorInfo(c,"float32",u),h=a.makeTensorInfo(c,"float32",l),p=ma({inputs:{real:f,imag:h},backend:a}),d=E.backend_util.complexWithOddIndex(i),m=d.real,v=d.imag,g=[m.length],y=a.makeTensorInfo(g,"float32",m),b=a.makeTensorInfo(g,"float32",v),w=ma({inputs:{real:y,imag:b},backend:a}),x=hk(u,l,o,n,a),k=x.real,N=x.imag,T=[k.length],I=a.makeTensorInfo(T,"float32",k),F=a.makeTensorInfo(T,"float32",N),D=ma({inputs:{real:I,imag:F},backend:a}),R=hk(m,v,o,n,a),P=R.real,B=R.imag,q=[P.length],O=a.makeTensorInfo(q,"float32",P),V=a.makeTensorInfo(q,"float32",B),K=ma({inputs:{real:O,imag:V},backend:a}),Z=E.backend_util.exponents(t,n),j=[Z.real.length],ee=a.makeTensorInfo(j,"float32",Z.real),le=a.makeTensorInfo(j,"float32",Z.imag),se=ma({inputs:{real:ee,imag:le},backend:a}),ce=ng({inputs:{a:se,b:K},backend:a}),he=dc({inputs:{a:D,b:ce},backend:a}),xe=bk({inputs:{a:D,b:ce},backend:a}),Se=zu({inputs:{input:he},backend:a}),we=zu({inputs:{input:xe},backend:a}),ke=vc({inputs:{input:he},backend:a}),Ne=vc({inputs:{input:xe},backend:a}),Ae=mc({inputs:[Se,we],backend:a,attrs:{axis:0}}),Ze=mc({inputs:[ke,Ne],backend:a,attrs:{axis:0}}),Et=a.data.get(Ae.dataId).values,st=a.data.get(Ze.dataId).values;return a.disposeIntermediateTensorInfo(f),a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(y),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(w),a.disposeIntermediateTensorInfo(I),a.disposeIntermediateTensorInfo(F),a.disposeIntermediateTensorInfo(D),a.disposeIntermediateTensorInfo(O),a.disposeIntermediateTensorInfo(V),a.disposeIntermediateTensorInfo(K),a.disposeIntermediateTensorInfo(ee),a.disposeIntermediateTensorInfo(le),a.disposeIntermediateTensorInfo(se),a.disposeIntermediateTensorInfo(ce),a.disposeIntermediateTensorInfo(he),a.disposeIntermediateTensorInfo(xe),a.disposeIntermediateTensorInfo(Se),a.disposeIntermediateTensorInfo(ke),a.disposeIntermediateTensorInfo(we),a.disposeIntermediateTensorInfo(Ne),a.disposeIntermediateTensorInfo(Ae),a.disposeIntermediateTensorInfo(Ze),{real:Et,imag:st}}function t4e(r,e,t){for(var n=new Float32Array(e*2),a=0;a<e;a++){for(var i=0,o=0,s=0;s<e;s++){var u=E.backend_util.exponent(a*s,e,t),l=E.backend_util.getComplexWithIndex(r,s);i+=l.real*u.real-l.imag*u.imag,o+=l.real*u.imag+l.imag*u.real}t&&(i/=e,o/=e),E.backend_util.assignToTypedArray(n,i,o,a)}return n}function r4e(r){var e=r.inputs,t=r.backend,n=e.input,a=E.util.sizeFromShape(n.shape),i=n.shape[n.shape.length-1],o=a/i,s=Qt({inputs:{x:n},backend:t,attrs:{shape:[o,i]}}),u=bW(s,!1,t),l=Qt({inputs:{x:u},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(u),l}var n4e={kernelName:E.FFT,backendName:"cpu",kernelFunc:r4e};function kk(r){var e=r.backend,t=r.attrs,n=t.shape,a=t.value,i=t.dtype,o=i||E.util.inferDtype(a),s=E.util.getArrayFromDType(o,E.util.sizeFromShape(n));return i4e(s,a,o),e.makeTensorInfo(n,o,s)}var a4e={kernelName:E.Fill,backendName:"cpu",kernelFunc:kk};function i4e(r,e,t){r.fill(e)}var o4e={kernelName:E.FlipLeftRight,backendName:"cpu",kernelFunc:function(r){var e=r.inputs;r.attrs;for(var t=r.backend,n=e.image,a=t,i=E.util.getTypedArrayFromDType(n.dtype,E.util.sizeFromShape(n.shape)),o=tt(n.shape,4),s=o[0],u=o[1],l=o[2],c=o[3],f=a.data.get(n.dataId).values,h=0;h<s;h++)for(var p=h*l*u*c,d=0;d<u;d++)for(var m=d*(l*c),v=0;v<l;v++)for(var g=v*c,y=0;y<c;y++){var b=Math.round(l-v-1),w=p+m+g+y,x=f[w];if(b>=0&&b<l){var k=b*c,N=p+m+k+y;x=f[N]}i[w]=x}var T=a.write(i,n.shape,n.dtype);return{dataId:T,shape:n.shape,dtype:n.dtype}}};var s4e=jr(function(r,e){return Math.floor(r/e)}),u4e=fn(E.FloorDiv,s4e,null,"int32"),l4e={kernelName:E.FloorDiv,backendName:"cpu",kernelFunc:u4e};function c4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=n.strides,l=n.pad,c=n.dataFormat,f=n.dilations,h=n.dimRoundingMode,p=n.activation,d=n.leakyreluAlpha,m=gW({inputs:{x:a,filter:i},backend:t,attrs:{strides:u,pad:l,dataFormat:c,dilations:f,dimRoundingMode:h}});if(o){var v=m;if(c==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){var g=Qt({inputs:{x:o},backend:t,attrs:{shape:[o.shape[0],1,1]}});m=dc({inputs:{a:m,b:g},backend:t}),t.disposeIntermediateTensorInfo(g)}else m=dc({inputs:{a:m,b:o},backend:t});t.disposeIntermediateTensorInfo(v)}if(p){var v=m;if(c==="NCHW"&&p==="prelu"&&s.shape.length===1&&s.shape[0]!==1){var y=Qt({inputs:{x:s},backend:t,attrs:{shape:[s.shape[0],1,1]}});m=eg(t,m,p,y,d),t.disposeIntermediateTensorInfo(y)}else m=eg(t,m,p,s,d);t.disposeIntermediateTensorInfo(v)}return m}var f4e={kernelName:E.FusedConv2D,backendName:"cpu",kernelFunc:c4e};function h4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=n.strides,l=n.pad,c=n.dataFormat,f=n.dilations,h=n.dimRoundingMode,p=n.activation,d=n.leakyreluAlpha,m=yW({inputs:{x:a,filter:i},backend:t,attrs:{strides:u,pad:l,dataFormat:c,dilations:f,dimRoundingMode:h}});if(o){var v=m;m=dc({inputs:{a:m,b:o},backend:t}),t.disposeIntermediateTensorInfo(v)}if(p){var v=m;m=eg(t,m,p,s,d),t.disposeIntermediateTensorInfo(v)}return m}var p4e={kernelName:E.FusedDepthwiseConv2D,backendName:"cpu",kernelFunc:h4e};function d4e(r){var e=r.inputs,t=r.backend,n=e.params,a=e.indices,i=E.util.sizeFromShape(n.shape),o=a.shape,s=o[o.length-1],u=tt(E.backend_util.prepareAndValidate(n,a),4),l=u[0],c=u[1],f=u[2],h=u[3];if(c===0)return t.makeTensorInfo(l,n.dtype,[]);var p=t.data.get(a.dataId).values,d=t.bufferSync(n),m=D$(p,d,n.dtype,c,s,f,h,n.shape,i);return t.makeTensorInfo(l,n.dtype,m.values)}var v4e={kernelName:E.GatherNd,backendName:"cpu",kernelFunc:d4e};function m4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.indices,o=n.axis,s=n.batchDims;Ve([a,i],"gatherV2");for(var u=E.util.parseAxisParam(o,a.shape)[0],l=t.data.get(i.dataId).values,c=a.shape[u],f=function(k){var N=l[k];E.util.assert(N<=c-1&&N>=0,function(){return"GatherV2: the index value "+N+" is not in [0, "+(c-1)+"]"})},h=0;h<l.length;++h)f(h);var p=s;s==null&&(p=0);var d=E.util.sizeFromShape(i.shape),m=E.backend_util.segment_util.collectGatherOpShapeInfo(a,i,u,p),v=Qt({inputs:{x:a},backend:t,attrs:{shape:[m.batchSize,m.outerSize,m.dimSize,m.sliceSize]}}),g=Qt({inputs:{x:i},backend:t,attrs:{shape:[m.batchSize,d/m.batchSize]}}),y=[m.batchSize,m.outerSize,d/m.batchSize,m.sliceSize],b=t.bufferSync(g),w=t.bufferSync(v),x=F$(w,b,y);return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(g),t.makeTensorInfo(m.outputShape,x.dtype,x.values)}var g4e={kernelName:E.GatherV2,backendName:"cpu",kernelFunc:m4e};function y4e(r){var e=r.inputs,t=r.backend,n=e.input,a=E.util.sizeFromShape(n.shape),i=n.shape[n.shape.length-1],o=a/i,s=Qt({inputs:{x:n},backend:t,attrs:{shape:[o,i]}}),u=bW(s,!0,t),l=Qt({inputs:{x:u},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(u),l}var b4e={kernelName:E.IFFT,backendName:"cpu",kernelFunc:y4e};var w4e=Ut(E.IsFinite,function(r){return Number.isFinite(r)?1:0},"bool"),x4e={kernelName:E.IsFinite,backendName:"cpu",kernelFunc:w4e};var k4e=Ut(E.IsInf,function(r){return Math.abs(r)===1/0?1:0},"bool"),S4e={kernelName:E.IsInf,backendName:"cpu",kernelFunc:k4e};var N4e=Ut(E.IsNan,function(r){return Number.isNaN(r)?1:0},"bool"),E4e={kernelName:E.IsNan,backendName:"cpu",kernelFunc:N4e};function T4e(r){var e=r.backend,t=r.attrs,n=t.start,a=t.stop,i=t.num,o=B$(n,a,i);return e.makeTensorInfo([o.length],"float32",o)}var I4e={kernelName:E.LinSpace,backendName:"cpu",kernelFunc:T4e};var C4e=Ut(E.Log1p,function(r){return Math.log1p(r)}),A4e={kernelName:E.Log1p,backendName:"cpu",kernelFunc:C4e};var _4e=jr(function(r,e){return r&&e}),D4e=fn(E.LogicalAnd,_4e,null,"bool"),F4e={kernelName:E.LogicalAnd,backendName:"cpu",kernelFunc:D4e};var R4e=Ut(E.LogicalNot,function(r){return r?0:1},"bool"),O4e={kernelName:E.LogicalNot,backendName:"cpu",kernelFunc:R4e};var P4e=jr(function(r,e){return r||e}),M4e=fn(E.LogicalOr,P4e,null,"bool"),B4e={kernelName:E.LogicalOr,backendName:"cpu",kernelFunc:M4e};function L4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.depthRadius,o=n.bias,s=n.alpha,u=n.beta;Ve(a,"LRN");var l=a.shape[3],c=l-1,f=t.data.get(a.dataId).values,h=E.util.sizeFromShape(a.shape),p=new Float32Array(h);function d(y){for(var b=y%l,w=y-b+Math.max(0,b-i),x=y-b+Math.min(b+i,c),k=0;w<=x;w++){var N=f[w];k+=N*N}return k}for(var m=0;m<h;m++){var v=d(m),g=f[m]*Math.pow(o+s*v,-u);p[m]=g}return t.makeTensorInfo(a.shape,a.dtype,p)}var z4e={kernelName:E.LRN,backendName:"cpu",kernelFunc:L4e};function $4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.y,o=e.dy,s=n.depthRadius,u=n.bias,l=n.alpha,c=n.beta;Ve(o,"LRNGrad");for(var f=E.util.sizeFromShape(o.shape),h=o.shape[3],p=t.data.get(o.dataId).values,d=t.data.get(a.dataId).values,m=t.data.get(i.dataId).values,v=new Float32Array(f),g=f,y=0;y<g;y++){for(var b=y%h,w=y-b+Math.max(0,b-s),x=y-b+Math.min(h,b+s+1),k=0,N=w;N<x;N++)k+=Math.pow(d[N],2);k=l*k+u;for(var N=w;N<x;N++){var T=-2*l*c*d[N]*m[y]/k;y===N&&(T+=Math.pow(k,-c)),T*=p[y],v[N]+=T}}return t.makeTensorInfo(o.shape,a.dtype,v)}var W4e={kernelName:E.LRNGrad,backendName:"cpu",kernelFunc:$4e};function wW(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.reductionIndices,o=n.keepDims,s=t,u=a.shape,l=u.length,c=E.util.parseAxisParam(i,u),f=c,h=E.backend_util.getAxesPermutation(f,l),p=s.data.get(a.dataId).values;if(h!=null){for(var d=new Array(l),m=0;m<d.length;m++)d[m]=u[h[m]];p=gk(p,u,a.dtype,h,d),f=E.backend_util.getInnerMostAxes(f.length,l),u=d}Ve(a,"max"),E.backend_util.assertAxesAreInnerMostDims("max",f,l);var v=tt(E.backend_util.computeOutAndReduceShapes(u,f),2),g=v[0],y=v[1],b=E.util.sizeFromShape(y),w=z$(p,b,g,a.dtype),x=s.write(w,g,a.dtype),k=g;if(o){var d=E.backend_util.expandShapeToKeepDim(g,c);k=d}return{dataId:x,shape:k,dtype:a.dtype}}var q4e={kernelName:E.Max,backendName:"cpu",kernelFunc:wW};function V4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;Ve(a,"maxPool");var i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,l=1;E.util.assert(E.backend_util.eitherStridesOrDilationsAreOne(o,l),function(){return"Error in maxPool: Either strides or dilations must be 1. "+("Got strides "+o+" and dilations '"+l+"'")});var c=E.backend_util.computePool2DInfo(a.shape,i,o,l,s,u),f;if(c.filterWidth===1&&c.filterHeight===1&&E.util.arraysEqual(c.inShape,c.outShape))f=ro({inputs:{x:a},backend:t});else{var h=t.data.get(a.dataId).values,p=E.util.computeStrides(a.shape),d=wk(h,a.shape,a.dtype,p,c,"max");f=t.makeTensorInfo(c.outShape,a.dtype,d.values)}return f}var G4e={kernelName:E.MaxPool,backendName:"cpu",kernelFunc:V4e};function U4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,l=n.dataFormat;Ve(a,"maxPool3d");var c=E.backend_util.computePool3DInfo(a.shape,i,o,1,s,u,l),f=t.data.get(a.dataId).values,h=mW(f,a.shape,a.dtype,E.util.computeStrides(a.shape),c,"max");return t.makeTensorInfo(h.shape,"float32",h.values)}var H4e={kernelName:E.MaxPool3D,backendName:"cpu",kernelFunc:U4e};function K4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=n.filterSize,s=n.strides,u=n.pad,l=n.dimRoundingMode;Ve([a,i],"maxPool3DGrad");for(var c=E.backend_util.computePool3DInfo(i.shape,o,s,1,u,l),f=t.bufferSync(i),h=OPe(f,c),p=c.strideDepth,d=c.strideHeight,m=c.strideWidth,v=c.dilationDepth,g=c.dilationHeight,y=c.dilationWidth,b=c.effectiveFilterDepth,w=c.effectiveFilterHeight,x=c.effectiveFilterWidth,k=b-1-c.padInfo.front,N=x-1-c.padInfo.left,T=w-1-c.padInfo.top,I=E.buffer(i.shape,"float32"),F=t.bufferSync(a),D=0;D<c.batchSize;++D)for(var R=0;R<c.inChannels;++R)for(var P=0;P<c.inDepth;++P)for(var B=0;B<c.inHeight;++B)for(var q=0;q<c.inWidth;++q){for(var O=P-k,V=B-T,K=q-N,Z=0,j=0;j<b;j+=v){var ee=(O+j)/p;if(!(ee<0||ee>=c.outDepth||Math.floor(ee)!==ee))for(var le=0;le<w;le+=g){var se=(V+le)/d;if(!(se<0||se>=c.outHeight||Math.floor(se)!==se))for(var ce=0;ce<x;ce+=y){var he=(K+ce)/m;if(!(he<0||he>=c.outWidth||Math.floor(he)!==he)){var xe=b*w*x-1-h.get(D,ee,se,he,R),Se=j*w*x+le*x+ce,we=xe===Se?1:0;if(we!==0){var ke=F.get(D,ee,se,he,R);Z+=ke*we}}}}}I.set(Z,D,P,B,q,R)}return t.makeTensorInfo(I.shape,I.dtype,I.values)}var j4e={kernelName:E.MaxPool3DGrad,backendName:"cpu",kernelFunc:K4e};function X4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=e.output,s=i;Ve([i,o],"maxPoolGrad");for(var u=n.filterSize,l=n.strides,c=n.pad,f=n.dimRoundingMode,h=E.backend_util.computePool2DInfo(s.shape,u,l,1,c,f),p=t.data.get(s.dataId).values,d=E.buffer(h.outShape,s.dtype,vW(p,s.shape,s.dtype,h).values),m=h.strideHeight,v=h.strideWidth,g=h.dilationHeight,y=h.dilationWidth,b=h.effectiveFilterHeight,w=h.effectiveFilterWidth,x=w-1-h.padInfo.left,k=b-1-h.padInfo.top,N=E.buffer(s.shape,"float32"),T=t.data.get(a.dataId).values,I=E.buffer(a.shape,"float32",T),F=0;F<h.batchSize;++F)for(var D=0;D<h.inChannels;++D)for(var R=0;R<h.inHeight;++R)for(var P=0;P<h.inWidth;++P){for(var B=R-k,q=P-x,O=0,V=0;V<b;V+=g){var K=(B+V)/m;if(!(K<0||K>=h.outHeight||Math.floor(K)!==K))for(var Z=0;Z<w;Z+=y){var j=(q+Z)/v;if(!(j<0||j>=h.outWidth||Math.floor(j)!==j)){var ee=b*w-1-d.get(F,K,j,D),le=V*w+Z,se=ee===le?1:0;if(se!==0){var ce=I.get(F,K,j,D);O+=ce*se}}}}N.set(O,F,R,P,D)}return t.makeTensorInfo(N.shape,N.dtype,N.values)}var Y4e={kernelName:E.MaxPoolGrad,backendName:"cpu",kernelFunc:X4e};function Z4e(r,e,t,n,a){var i=E.util.computeStrides(e),o=wk(r,e,t,i,a,"max"),s=vW(r,e,t,a,!0,n);return[o.values,s.values]}var J4e={kernelName:E.MaxPoolWithArgmax,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.x,i=t.filterSize,o=t.strides,s=t.pad,u=t.includeBatchInIndex,l=n;Ve(a,"MaxPoolWithArgmax");var c=l.data.get(a.dataId).values,f=E.backend_util.computePool2DInfo(a.shape,i,o,[1,1],s),h=tt(Z4e(c,a.shape,a.dtype,u,f),2),p=h[0],d=h[1],m=l.write(p,f.outShape,a.dtype),v=l.write(d,f.outShape,a.dtype);return[{dataId:m,shape:f.outShape,dtype:a.dtype},{dataId:v,shape:f.outShape,dtype:"int32"}]}};function Q4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=E.util.parseAxisParam(i,a.shape),u=E.backend_util.computeOutAndReduceShapes(a.shape,s),l=u[1],c=E.util.sizeFromShape(l),f=[],h=t.makeTensorInfo([],"float32",new Float32Array([c]));f.push(h);var p=ks({inputs:{x:a},backend:t,attrs:{dtype:"float32"}});f.push(p);var d=xk({inputs:{a:p,b:h},backend:t});f.push(d);var m=jh({inputs:{x:d},backend:t,attrs:{axis:i,keepDims:o}});return f.forEach(function(v){return t.disposeIntermediateTensorInfo(v)}),m}var eBe={kernelName:E.Mean,backendName:"cpu",kernelFunc:Q4e};function tBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;Ve(a,"min");var s=E.util.parseAxisParam(i,a.shape),u=s,l=E.backend_util.getAxesPermutation(u,a.shape.length),c=a;l!=null&&(c=Gn({inputs:{x:a},backend:t,attrs:{perm:l}}),u=E.backend_util.getInnerMostAxes(u.length,a.shape.length)),E.backend_util.assertAxesAreInnerMostDims("min",u,c.shape.length);for(var f=tt(E.backend_util.computeOutAndReduceShapes(c.shape,u),2),h=f[0],p=f[1],d=E.util.sizeFromShape(p),m=E.util.makeZerosTypedArray(E.util.sizeFromShape(h),c.dtype),v=t.data.get(c.dataId).values,g=0;g<m.length;++g){for(var y=g*d,b=v[y],w=0;w<d;++w){var x=v[y+w];(Number.isNaN(x)||x<b)&&(b=x)}m[g]=b}l!=null&&t.disposeIntermediateTensorInfo(c);var k=t.makeTensorInfo(h,c.dtype,m);if(o){var N=E.backend_util.expandShapeToKeepDim(h,s),T=Qt({inputs:{x:k},backend:t,attrs:{shape:N}});return t.disposeIntermediateTensorInfo(k),T}return k}var rBe={kernelName:E.Min,backendName:"cpu",kernelFunc:tBe};function nBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.paddings,o=n.mode;Ve(a,"mirrorPad");for(var s=i.map(function(N,T){return N[0]+a.shape[T]+N[1]}),u=i.map(function(N){return N[0]}),l=i.map(function(N,T){return N[0]+a.shape[T]}),c=o==="reflect"?0:1,f=t.data.get(a.dataId).values,h=a.shape.length,p=E.util.computeStrides(a.shape),d=E.util.sizeFromShape(s),m=s.length,v=E.util.computeStrides(s),g=E.util.getTypedArrayFromDType(a.dtype,d),y=0;y<d;y++){for(var b=E.util.indexToLoc(y,m,v),w=0;w<m;w++)b[w]<u[w]?b[w]=u[w]*2-b[w]-c:b[w]>=l[w]&&(b[w]=(l[w]-1)*2-b[w]+c);b=b.map(function(N,T){return N-u[T]});var x=E.util.locToIndex(b,h,p);g[y]=f[x]}var k=t.write(g,s,a.dtype);return{dataId:k,shape:s,dtype:a.dtype}}var aBe={kernelName:E.MirrorPad,backendName:"cpu",kernelFunc:nBe};var iBe=jr(function(r,e){var t=r%e;return r<0&&e<0||r>=0&&e>=0?t:(t+e)%e}),oBe=fn(E.Mod,iBe),sBe={kernelName:E.Mod,backendName:"cpu",kernelFunc:oBe};function xW(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.logits,i=n.dim,o=a.shape.length,s=i;if(s===-1&&(s=o-1),s!==o-1)throw Error("Softmax along a non-last dimension is not yet supported. "+("Logits was rank "+o+" and dim was "+s));var u=E.util.parseAxisParam([s],a.shape),l=wW({inputs:{x:a},backend:t,attrs:{reductionIndices:u,keepDims:!1}}),c=E.backend_util.expandShapeToKeepDim(l.shape,u),f=Qt({inputs:{x:l},backend:t,attrs:{shape:c}}),h=bk({inputs:{a,b:f},backend:t}),p=C$({inputs:{x:h},backend:t}),d=jh({inputs:{x:p},backend:t,attrs:{axis:u,keepDims:!1}}),m=Qt({inputs:{x:d},backend:t,attrs:{shape:c}}),v=xk({inputs:{a:p,b:m},backend:t});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(m),v}var uBe={kernelName:E.Softmax,backendName:"cpu",kernelFunc:xW};function lBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.logits,i=n.numSamples,o=n.seed,s=n.normalized;Ve(a,"multinomial");for(var u=s?a:xW({inputs:{logits:a},backend:t,attrs:{dim:-1}}),l=u.shape[0],c=u.shape[1],f=t.data.get(u.dataId).values,h=[l,i],p=E.util.makeZerosTypedArray(E.util.sizeFromShape(h),"int32"),d=0;d<l;++d){var m=d*c,v=new Float32Array(c-1);v[0]=f[m];for(var g=1;g<v.length;++g)v[g]=v[g-1]+f[m+g];for(var y=qRe.alea(o.toString()),b=d*i,w=0;w<i;++w){var x=y();p[b+w]=v.length;for(var g=0;g<v.length;g++)if(x<v[g]){p[b+w]=g;break}}}return s||t.disposeIntermediateTensorInfo(u),t.makeTensorInfo(h,"int32",p)}var cBe={kernelName:E.Multinomial,backendName:"cpu",kernelFunc:lBe};var fBe=E.kernel_impls.nonMaxSuppressionV3Impl;function hBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold;Ve(a,"NonMaxSuppression");var l=t.data.get(a.dataId).values,c=t.data.get(i.dataId).values,f=fBe(l,c,o,s,u).selectedIndices;return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}var pBe={kernelName:E.NonMaxSuppressionV3,backendName:"cpu",kernelFunc:hBe};var dBe=E.kernel_impls.nonMaxSuppressionV4Impl;function vBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,l=n.padToMaxOutputSize;Ve(a,"NonMaxSuppressionPadded");var c=t.data.get(a.dataId).values,f=t.data.get(i.dataId).values,h=dBe(c,f,o,s,u,l),p=h.selectedIndices,d=h.validOutputs;return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([d]))]}var mBe={kernelName:E.NonMaxSuppressionV4,backendName:"cpu",kernelFunc:vBe};var gBe=E.kernel_impls.nonMaxSuppressionV5Impl;function yBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,l=n.softNmsSigma;Ve(a,"NonMaxSuppressionWithScore");var c=t.data.get(a.dataId).values,f=t.data.get(i.dataId).values,h=o,p=s,d=u,m=l,v=gBe(c,f,h,p,d,m),g=v.selectedIndices,y=v.selectedScores;return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var bBe={kernelName:E.NonMaxSuppressionV5,backendName:"cpu",kernelFunc:yBe};function wBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.indices,i=n.dtype,o=n.depth,s=n.onValue,u=n.offValue;Ve(a,"oneHot");var l=E.util.sizeFromShape(a.shape),c=new Float32Array(l*o);c.fill(u);for(var f=t.data.get(a.dataId).values,h=0;h<l;++h)f[h]>=0&&f[h]<o&&(c[h*o+f[h]]=s);return t.makeTensorInfo(Oi(a.shape,[o]),i,c)}var xBe={kernelName:E.OneHot,backendName:"cpu",kernelFunc:wBe};function rg(r){var e=r.inputs,t=r.backend,n=e.x;if(n.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(n.dtype==="complex64"){var a=zu({inputs:{input:n},backend:t}),i=rg({inputs:{x:a},backend:t}),o=vc({inputs:{input:n},backend:t}),s=rg({inputs:{x:o},backend:t}),u=ma({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return kk({backend:t,attrs:{shape:n.shape,value:0,dtype:n.dtype}})}var kBe={kernelName:E.ZerosLike,backendName:"cpu",kernelFunc:rg};function kW(r){var e=r.inputs,t=r.backend,n=e.x;if(n.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(n.dtype==="complex64"){var a=zu({inputs:{input:n},backend:t}),i=kW({inputs:{x:a},backend:t}),o=vc({inputs:{input:n},backend:t}),s=rg({inputs:{x:o},backend:t}),u=ma({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return kk({backend:t,attrs:{shape:n.shape,value:1,dtype:n.dtype}})}var SBe={kernelName:E.OnesLike,backendName:"cpu",kernelFunc:kW};function SW(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.axis;if(e.length===1)return tg({inputs:{input:e[0]},backend:t,attrs:{dim:a}});var i=e[0].shape,o=e[0].dtype;e.forEach(function(c){E.util.assertShapesMatch(i,c.shape,"All tensors passed to stack must have matching shapes"),E.util.assert(o===c.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=[],u=e.map(function(c){var f=tg({inputs:{input:c},backend:t,attrs:{dim:a}});return s.push(f),f}),l=mc({inputs:u,backend:t,attrs:{axis:a}});return s.forEach(function(c){return t.disposeIntermediateTensorInfo(c)}),l}var NBe={kernelName:E.Pack,backendName:"cpu",kernelFunc:SW};function EBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.paddings,o=n.constantValue;Ve(a,"pad");var s=i.map(function(k,N){return k[0]+a.shape[N]+k[1]}),u=i.map(function(k){return k[0]}),l=t.data.get(a.dataId).values,c=E.util.sizeFromShape(a.shape),f=a.shape.length,h=E.util.computeStrides(a.shape),p=E.util.sizeFromShape(s),d=s.length,m=E.util.computeStrides(s),v=E.util.getTypedArrayFromDType(a.dtype,p);o!==0&&v.fill(o);for(var g=0;g<c;g++){var y=E.util.indexToLoc(g,f,h),b=y.map(function(k,N){return k+u[N]}),w=E.util.locToIndex(b,d,m);v[w]=l[g]}var x=t.write(v,s,a.dtype);return{dataId:x,shape:s,dtype:a.dtype}}var NW={kernelName:E.PadV2,backendName:"cpu",kernelFunc:EBe};var TBe=jr(function(r,e){return Math.pow(r,e)}),IBe=fn(E.Pow,TBe),CBe={kernelName:E.Pow,backendName:"cpu",kernelFunc:IBe};function ABe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.paramsNestedSplits,i=e.paramsDenseValues,o=e.indices;n.outputRaggedRank;var s=a.map(function(g){return t.data.get(g.dataId).values}),u=a.map(function(g){return g.shape}),l=t.data.get(i.dataId).values,c=t.data.get(o.dataId).values,f=tt(U$(s,u,l,i.shape,i.dtype,c,o.shape),3),h=f[0],p=f[1],d=f[2],m=h.map(function(g){return t.makeTensorInfo([g.length],"int32",g)}),v=t.makeTensorInfo(d,i.dtype,p);return m.concat([v])}var _Be={kernelName:E.RaggedGather,backendName:"cpu",kernelFunc:ABe};function DBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.shape,i=e.values,o=e.defaultValue,s=e.rowPartitionTensors,u=n.rowPartitionTypes,l=t.data.get(a.dataId).values,c=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,h=s.map(function(g){return t.data.get(g.dataId).values}),p=s.map(function(g){return g.shape}),d=tt(H$(l,a.shape,c,i.shape,i.dtype,f,o.shape,h,p,u),2),m=d[0],v=d[1];return t.makeTensorInfo(m,i.dtype,v)}var FBe={kernelName:E.RaggedTensorToTensor,backendName:"cpu",kernelFunc:DBe};function RBe(r){var e=r.backend,t=r.attrs,n=t.start,a=t.stop,i=t.dtype,o=t.step,s=K$(n,a,o,i);return e.makeTensorInfo([s.length],i,s)}var OBe={kernelName:E.Range,backendName:"cpu",kernelFunc:RBe};var PBe=Ut(E.Reciprocal,function(r){return 1/r}),MBe={kernelName:E.Reciprocal,backendName:"cpu",kernelFunc:PBe};function BBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=n.alignCorners,o=n.halfPixelCenters,s=n.size;Ve(a,"resizeBilinear");for(var u=E.util.computeStrides(a.shape),l=tt(s,2),c=l[0],f=l[1],h=tt(a.shape,4),p=h[0],d=h[1],m=h[2],v=h[3],g=t.data.get(a.dataId).values,y=new Float32Array(E.util.sizeFromShape([p,c,f,v])),b=[i&&c>1?d-1:d,i&&f>1?m-1:m],w=[i&&c>1?c-1:c,i&&f>1?f-1:f],x=0,k=b[0]/w[0],N=b[1]/w[1],T=0;T<p;T++)for(var I=0;I<c;I++){var F=void 0;o?F=k*(I+.5)-.5:F=k*I;for(var D=Math.max(0,Math.floor(F)),R=F-D,P=Math.min(d-1,Math.ceil(F)),B=T*u[0]+D*u[1],q=T*u[0]+P*u[1],O=0;O<f;O++){var V=void 0;o?V=N*(O+.5)-.5:V=N*O;for(var K=Math.max(0,Math.floor(V)),Z=V-K,j=Math.min(m-1,Math.ceil(V)),ee=B+K*u[2],le=q+K*u[2],se=B+j*u[2],ce=q+j*u[2],he=0;he<v;he++){var xe=g[ee+he],Se=g[le+he],we=g[se+he],ke=g[ce+he],Ne=xe+(we-xe)*Z,Ae=Se+(ke-Se)*Z,Ze=Ne+(Ae-Ne)*R;y[x++]=Ze}}}return t.makeTensorInfo([p,c,f,v],"float32",y)}var LBe={kernelName:E.ResizeBilinear,backendName:"cpu",kernelFunc:BBe};function zBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=e.dy,o=n.alignCorners;Ve([i,a],"resizeBilinearGrad");for(var s=E.util.computeStrides(a.shape),u=tt(a.shape,4),l=u[0],c=u[1],f=u[2],h=u[3],p=tt(i.shape,3),d=p[1],m=p[2],v=new Float32Array(l*c*f*h),g=[o&&d>1?c-1:c,o&&m>1?f-1:f],y=[o&&d>1?d-1:d,o&&m>1?m-1:m],b=g[0]/y[0],w=g[1]/y[1],x=t.data.get(i.dataId).values,k=0,N=0;N<l;N++)for(var T=N*s[0],I=0;I<d;I++)for(var F=I*b,D=Math.floor(F),R=Math.min(Math.ceil(F),c-1),P=T+D*s[1],B=T+R*s[1],q=F-D,O=1-q,V=0;V<m;V++)for(var K=V*w,Z=Math.floor(K),j=Math.min(Math.ceil(K),f-1),ee=K-Z,le=1-ee,se=P+Z*s[2],ce=P+j*s[2],he=B+Z*s[2],xe=B+j*s[2],Se=O*le,we=O*ee,ke=q*le,Ne=q*ee,Ae=0;Ae<h;Ae++){var Ze=x[k++];v[se+Ae]+=Ze*Se,v[ce+Ae]+=Ze*we,v[he+Ae]+=Ze*ke,v[xe+Ae]+=Ze*Ne}return t.makeTensorInfo([l,f,c,h],"float32",v)}var $Be={kernelName:E.ResizeBilinearGrad,backendName:"cpu",kernelFunc:zBe};function WBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=n.alignCorners,o=n.halfPixelCenters,s=n.size;Ve(a,"resizeNearestNeighbor");for(var u=E.util.computeStrides(a.shape),l=tt(s,2),c=l[0],f=l[1],h=tt(a.shape,4),p=h[0],d=h[1],m=h[2],v=h[3],g=t.data.get(a.dataId).values,y=new Float32Array(p*c*f*v),b=[i&&c>1?d-1:d,i&&f>1?m-1:m],w=[i&&c>1?c-1:c,i&&f>1?f-1:f],x=b[0]/w[0],k=b[1]/w[1],N=0,T=0;T<p;T++)for(var I=T*u[0],F=0;F<c;F++){var D=o?x*(F+.5):x*F,R=Math.min(d-1,i?Math.round(D):Math.floor(D));o&&(R=Math.max(0,R));for(var P=I+R*u[1],B=0;B<f;B++){var q=o?k*(B+.5):k*B,O=Math.min(m-1,i?Math.round(q):Math.floor(q));o&&(O=Math.max(0,O));for(var V=P+O*u[2],K=0;K<v;K++){var Z=g[V+K];y[N++]=Z}}}return t.makeTensorInfo([p,c,f,v],a.dtype,y)}var qBe={kernelName:E.ResizeNearestNeighbor,backendName:"cpu",kernelFunc:WBe};function VBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=e.dy,o=n.alignCorners;Ve([i,a],"resizeNearestNeighborGrad");for(var s=E.util.computeStrides(a.shape),u=E.util.computeStrides(i.shape),l=tt(a.shape,4),c=l[0],f=l[1],h=l[2],p=l[3],d=tt(i.shape,3),m=d[1],v=d[2],g=new Float32Array(c*f*h*p),y=t.data.get(i.dataId).values,b=[o&&m>1?f-1:f,o&&v>1?h-1:h],w=[o&&m>1?m-1:m,o&&v>1?v-1:v],x=b[0]/w[0],k=b[1]/w[1],N=1/x,T=1/k,I=Math.ceil(N)*2+2,F=Math.ceil(T)*2+2,D=0;D<c;D++)for(var R=D*s[0],P=0;P<f;P++)for(var B=R+P*s[1],q=Math.floor(P*N),O=Math.floor(q-I/2),V=0;V<h;V++)for(var K=B+V*s[2],Z=Math.floor(V*T),j=Math.floor(Z-F/2),ee=0;ee<p;ee++){for(var le=0,se=0;se<I;se++){var ce=se+O;if(!(ce<0||ce>=m)){var he=R+ce*u[1],xe=ce*x,Se=Math.min(f-1,o?Math.round(xe):Math.floor(xe));if(P===Se)for(var we=0;we<F;we++){var ke=we+j;if(!(ke<0||ke>=v)){var Ne=he+ke*u[2],Ae=ke*k,Ze=Math.min(h-1,o?Math.round(Ae):Math.floor(Ae));V===Ze&&(le+=y[Ne+ee])}}}}g[K+ee]=le}return t.makeTensorInfo(a.shape,a.dtype,g)}var GBe={kernelName:E.ResizeNearestNeighborGrad,backendName:"cpu",kernelFunc:VBe};function UBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.dims;Ve(a,"reverse");var o=a.shape.length,s=E.util.parseAxisParam(i,a.shape);if(o===0)return ro({inputs:{x:a},backend:t});for(var u=new E.TensorBuffer(a.shape,a.dtype),l=t.bufferSync(a),c=function(h){var p=u.indexToLoc(h),d=p.slice();s.forEach(function(m){return d[m]=a.shape[m]-1-d[m]}),u.set.apply(u,Oi([l.get.apply(l,Oi(d))],p))},f=0;f<u.size;f++)c(f);return t.makeTensorInfo(u.shape,u.dtype,u.values)}var HBe={kernelName:E.Reverse,backendName:"cpu",kernelFunc:UBe},KBe={kernelName:E.RotateWithOffset,backendName:"cpu",kernelFunc:function(r){for(var e=r.inputs,t=r.attrs,n=r.backend,a=e.image,i=t.radians,o=t.fillValue,s=t.center,u=n,l=E.util.getTypedArrayFromDType(a.dtype,E.util.sizeFromShape(a.shape)),c=tt(a.shape,4),f=c[0],h=c[1],p=c[2],d=c[3],m=tt(E.backend_util.getImageCenter(s,h,p),2),v=m[0],g=m[1],y=255,b=Math.sin(i),w=Math.cos(i),x=u.data.get(a.dataId).values,k=0;k<f;k++)for(var N=k*p*h*d,T=0;T<h;T++)for(var I=T*(p*d),F=0;F<p;F++)for(var D=F*d,R=0;R<d;R++){var P=[f,T,F,R],B=P[2],q=P[1],O=(B-v)*w-(q-g)*b,V=(B-v)*b+(q-g)*w;O=Math.round(O+v),V=Math.round(V+g);var K=o;if(typeof o!="number"&&(R===3?K=y:K=o[R]),O>=0&&O<p&&V>=0&&V<h){var Z=V*(p*d),j=O*d,ee=N+Z+j+R;K=x[ee]}var le=N+I+D+R;l[le]=K}var se=u.write(l,a.shape,a.dtype);return{dataId:se,shape:a.shape,dtype:a.dtype}}};var jBe=Ut(E.Round,function(r){var e=Math.floor(r);return r-e<.5?Math.floor(r):r-e>.5?Math.ceil(r):e%2===0?e:e+1}),XBe={kernelName:E.Round,backendName:"cpu",kernelFunc:jBe};function YBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.indices,i=e.updates,o=n.shape,s=E.backend_util.calculateShapes(i,a,o),u=s.sliceRank,l=s.numUpdates,c=s.sliceSize,f=s.strides,h=s.outputSize,p=!0,d=t.bufferSync(a),m=t.bufferSync(i),v=hc(d,m,o,h,c,l,u,f,0,p);return t.makeTensorInfo(o,v.dtype,v.values)}var ZBe={kernelName:E.ScatterNd,backendName:"cpu",kernelFunc:YBe};function JBe(r,e){for(var t=0,n=r.length,a=0;t<n;)a=Math.floor((t+n)/2),r[a]<e?t=a+1:n=a;return n}function QBe(r,e){for(var t=0,n=r.length,a=0;t<n;)a=Math.floor((t+n)/2),r[a]<=e?t=a+1:n=a;return n}function eLe(r,e,t,n,a,i){for(var o=E.util.getArrayFromDType("int32",t*a),s=0;s<t;++s)for(var u=r.slice(s*n,(s+1)*n),l=s*a,c=0;c<a;++c)o[l+c]=i==="left"?JBe(u,e[c+l]):QBe(u,e[c+l]);return o}function tLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.sortedSequence,i=e.values,o=n.side,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,l=eLe(s,u,a.shape[0],a.shape[1],i.shape[1],o);return t.makeTensorInfo(i.shape,"int32",l)}var rLe={kernelName:E.SearchSorted,backendName:"cpu",kernelFunc:tLe};function nLe(r){var e=r.inputs,t=r.backend,n=e.condition,a=e.t,i=e.e;Ve([n,a,i],"select");for(var o=n.shape.length,s=t.data.get(n.dataId).values,u=t.data.get(a.dataId).values,l=t.data.get(i.dataId).values,c=E.upcastType(a.dtype,i.dtype),f=E.util.makeZerosTypedArray(E.util.sizeFromShape(a.shape),c),h=0,p=o===0||o>1||a.shape.length===1?1:E.util.sizeFromShape(a.shape.slice(1)),d=0;d<s.length;d++)for(var m=0;m<p;m++)s[d]===1?f[h++]=u[d]:f[h++]=l[d];return t.makeTensorInfo(a.shape,c,f)}var aLe={kernelName:E.Select,backendName:"cpu",kernelFunc:nLe};var iLe=E.backend_util.SELU_SCALEALPHA,oLe=E.backend_util.SELU_SCALE,sLe=Ut(E.Selu,function(r){return r>=0?oLe*r:iLe*(Math.exp(r)-1)}),uLe={kernelName:E.Selu,backendName:"cpu",kernelFunc:sLe};var lLe=Ut(E.Sign,function(r){return r<0?-1:r>0?1:0}),cLe={kernelName:E.Sign,backendName:"cpu",kernelFunc:lLe};var fLe=Ut(E.Sin,function(r){return Math.sin(r)}),hLe={kernelName:E.Sin,backendName:"cpu",kernelFunc:fLe};var pLe=Ut(E.Sinh,function(r){return Math.sinh(r)}),dLe={kernelName:E.Sinh,backendName:"cpu",kernelFunc:pLe};var vLe=11920928955078125e-23,v$=Math.log(vLe)+2,mLe=Ut(E.Softplus,function(r){var e=r>-v$,t=r<v$,n=Math.exp(r),a;return t?a=n:e?a=r:a=Math.log(1+n),a}),gLe={kernelName:E.Softplus,backendName:"cpu",kernelFunc:mLe};function yLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockShape,o=n.paddings;Ve([a],"spaceToBatchND");var s=E.util.sizeFromShape(i),u=[[0,0]];u.push.apply(u,Oi(o));for(var l=1+i.length;l<a.shape.length;++l)u.push([0,0]);var c=NW.kernelFunc({inputs:{x:a},backend:t,attrs:{paddings:u,constantValue:0}}),f=E.backend_util.getReshaped(c.shape,i,s,!1),h=E.backend_util.getPermuted(f.length,i.length,!1),p=E.backend_util.getReshapedPermuted(c.shape,i,s,!1),d={x:c},m={shape:f},v=Qt({inputs:d,backend:t,attrs:m}),g={x:v},y={perm:h},b=Gn({inputs:g,backend:t,attrs:y}),w={x:b},x={shape:p},k=Qt({inputs:w,backend:t,attrs:x});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(b),k}var bLe={kernelName:E.SpaceToBatchND,backendName:"cpu",kernelFunc:yLe};function wLe(r){var e=r.inputs,t=r.backend,n=e.indices,a=e.values,i=e.denseShape,o=e.defaultValue;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        `+i.shape);if(n.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        `+n.shape);if(a.shape.length!==1)throw new Error(`Values must be a vector, saw:
        `+a.shape);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        `+o.shape);var s=t.data.get(n.dataId).values,u=t.data.get(a.dataId).values,l=t.data.get(i.dataId).values,c=t.data.get(o.dataId).values[0],f=tt(Z$(s,n.shape,n.dtype,u,a.dtype,l,c),5),h=f[0],p=f[1],d=f[2],m=f[3],v=f[4];return[t.makeTensorInfo(p,n.dtype,h),t.makeTensorInfo([p[0]],a.dtype,d),t.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(function(g){return Number(g)}))),t.makeTensorInfo([v.length],n.dtype,new Int32Array(v))]}var xLe={kernelName:E.SparseFillEmptyRows,backendName:"cpu",kernelFunc:wLe};function kLe(r){var e=r.inputs,t=r.backend,n=e.inputIndices,a=e.inputShape,i=e.newShape;if(n.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        `+n.shape);if(a.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        `+a.shape);if(i.shape.length!==1)throw new Error("Target shape should be a vector but received shape "+i.shape);var o=Array.from(t.data.get(a.dataId).values),s=t.data.get(n.dataId).values,u=Array.from(t.data.get(i.dataId).values),l=tt(J$(s,n.shape,n.dtype,o,u),3),c=l[0],f=l[1],h=l[2];return[t.makeTensorInfo(f,n.dtype,c),t.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}var SLe={kernelName:E.SparseReshape,backendName:"cpu",kernelFunc:kLe};function NLe(r){var e=r.inputs,t=r.backend,n=e.data,a=e.indices,i=e.segmentIds;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          `+a.shape);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          `+i.shape);if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=t.data.get(n.dataId).values,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,l=tt(yk(o,n.shape,n.dtype,s,u,!0),2),c=l[0],f=l[1];return t.makeTensorInfo(f,n.dtype,c)}var ELe={kernelName:E.SparseSegmentMean,backendName:"cpu",kernelFunc:NLe};function TLe(r){var e=r.inputs,t=r.backend,n=e.data,a=e.indices,i=e.segmentIds;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         `+a.shape);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         `+i.shape);if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=t.data.get(n.dataId).values,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,l=tt(yk(o,n.shape,n.dtype,s,u),2),c=l[0],f=l[1];return t.makeTensorInfo(f,n.dtype,c)}var ILe={kernelName:E.SparseSegmentSum,backendName:"cpu",kernelFunc:TLe};function CLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.sparseIndices,i=e.sparseValues,o=e.defaultValue,s=n.outputShape,u=E.backend_util.calculateShapes(i,a,s),l=u.sliceRank,c=u.numUpdates,f=u.sliceSize,h=u.strides,p=u.outputSize,d=!1,m=t.bufferSync(a),v;switch(i.dtype){case"bool":{var g=t.bufferSync(i),y=Boolean(t.data.get(o.dataId).values[0]);v=hc(m,g,s,p,f,c,l,h,y,d);break}case"float32":{var g=t.bufferSync(i),y=t.data.get(o.dataId).values[0];v=hc(m,g,s,p,f,c,l,h,y,d);break}case"int32":{var g=t.bufferSync(i),y=t.data.get(o.dataId).values[0];v=hc(m,g,s,p,f,c,l,h,y,d);break}case"string":{var g=t.bufferSync(i),y=E.util.decodeString(t.data.get(o.dataId).values[0]);v=hc(m,g,s,p,f,c,l,h,y,d);break}default:throw new Error("Unsupported type "+i.dtype)}return t.makeTensorInfo(s,v.dtype,v.values)}var ALe={kernelName:E.SparseToDense,backendName:"cpu",kernelFunc:CLe};function _Le(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.numOrSizeSplits,o=n.axis,s=E.util.parseAxisParam(o,a.shape)[0],u=E.backend_util.prepareSplitSize(a,i,s),l=new Array(a.shape.length).fill(0),c=a.shape.slice();return u.map(function(f){var h=Oi(c);h[s]=f;var p=$u({inputs:{x:a},backend:t,attrs:{begin:l,size:h}});return l[s]+=f,p})}var DLe={kernelName:E.SplitV,backendName:"cpu",kernelFunc:_Le};var FLe={kernelName:E.Square,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e.x,a=t;Ve(n,"square");for(var i=a.data.get(n.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}var l=a.write(o,n.shape,n.dtype);return{dataId:l,shape:n.shape,dtype:n.dtype}}};var RLe=Ut(E.Step,function(r,e){var t=e;return isNaN(r)?NaN:r>0?1:t.alpha}),OLe={kernelName:E.Step,backendName:"cpu",kernelFunc:RLe};function PLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.begin,o=n.end,s=n.strides,u=n.beginMask,l=n.endMask,c=n.ellipsisMask,f=n.newAxisMask,h=n.shrinkAxisMask;Ve(a,"stridedSlice");var p=E.slice_util.sliceInfo(a.shape,i,o,s,u,l,c,f,h),d=p.finalShapeSparse,m=p.finalShape,v=p.isIdentity,g=p.sliceDim0,y=p.isSimpleSlice,b=p.begin,w=p.end,x=p.strides,k;if(v)k=Qt({inputs:{x:a},backend:t,attrs:{shape:m}});else if(g||y){E.util.assert(a.shape.length>=1,function(){return"Input must have rank at least 1, got: "+a.shape.length});var N=E.slice_util.computeOutShape(b,w,x),T=$u({inputs:{x:a},backend:t,attrs:{begin:b,size:N}});k=Qt({inputs:{x:T},backend:t,attrs:{shape:m}}),t.disposeIntermediateTensorInfo(T)}else{var I=t.bufferSync(a),F=eW(d,I,x,b);k=t.makeTensorInfo(m,F.dtype,F.values)}return k}var MLe={kernelName:E.StridedSlice,backendName:"cpu",kernelFunc:PLe};function BLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.separator,i=n.nGramWidths,o=n.leftPad,s=n.rightPad,u=n.padWidth,l=n.preserveShortSequences,c=e.data,f=e.dataSplits,h=t.data.get(c.dataId).values,p=t.data.get(f.dataId).values,d=tt(tW(h,p,a,i,o,s,u,l),2),m=d[0],v=d[1];return[t.makeTensorInfo([m.length],"string",m),t.makeTensorInfo(f.shape,"int32",v)]}var LLe={kernelName:E.StringNGrams,backendName:"cpu",kernelFunc:BLe};function zLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.skipEmpty,i=e.input,o=e.delimiter;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error("Input must be a vector, got shape: "+i.shape);if(o.shape.length!==0)throw new Error("Delimiter must be a scalar, got shape: "+o.shape);var s=t.data.get(i.dataId).values,u=t.data.get(o.dataId).values[0],l=tt(rW(s,u,a),3),c=l[0],f=l[1],h=l[2],p=f.length;return[t.makeTensorInfo([p,2],"int32",c),t.makeTensorInfo([p],"string",f),t.makeTensorInfo([2],"int32",new Int32Array(h))]}var $Le={kernelName:E.StringSplit,backendName:"cpu",kernelFunc:zLe};function WLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.numBuckets,i=e.input;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");var o=t.data.get(i.dataId).values,s=nW(o,a);return t.makeTensorInfo(i.shape,"int32",s)}var qLe={kernelName:E.StringToHashBucketFast,backendName:"cpu",kernelFunc:WLe};var VLe=Ut(E.Tan,function(r){return Math.tan(r)}),GLe={kernelName:E.Tan,backendName:"cpu",kernelFunc:VLe};var ULe=Ut(E.Tanh,function(r){return Math.tanh(r)}),HLe={kernelName:E.Tanh,backendName:"cpu",kernelFunc:ULe};function KLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.reps;Ve(a,"tile");var o=iW(t.bufferSync(a),i);return t.makeTensorInfo(o.shape,o.dtype,o.values)}var jLe={kernelName:E.Tile,backendName:"cpu",kernelFunc:KLe};function XLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.k,o=n.sorted;Ve(a,"topk");var s=t.data.get(a.dataId).values,u=tt(sW(s,a.shape,a.dtype,i,o),2),l=u[0],c=u[1];return[t.makeTensorInfo(l.shape,l.dtype,l.values),t.makeTensorInfo(c.shape,c.dtype,c.values)]}var YLe={kernelName:E.TopK,backendName:"cpu",kernelFunc:XLe};function ZLe(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.image,i=e.transforms,o=t.interpolation,s=t.fillMode,u=t.fillValue,l=t.outputShape,c=tt(a.shape,4),f=c[0],h=c[1],p=c[2],d=c[3],m=tt(l??[h,p],2),v=m[0],g=m[1],y=[f,v,g,d],b=E.util.computeStrides(a.shape),w=b[0],x=b[1],k=b[2],N=E.util.computeStrides(y),T=N[0],I=N[1],F=N[2],D=E.util.getTypedArrayFromDType(a.dtype,E.util.sizeFromShape(y));D.fill(u);for(var R=n.data.get(a.dataId).values,P=n.data.get(i.dataId).values,B=0;B<f;++B){for(var q=i.shape[0]===1?P:P.subarray(B*8,B*8+8),O=0;O<v;++O)for(var V=0;V<g;++V)for(var K=0;K<d;++K){var Z=void 0,j=q[6]*V+q[7]*O+1;if(j!==0){var ee=(q[0]*V+q[1]*O+q[2])/j,le=(q[3]*V+q[4]*O+q[5])/j,se=m$(ee,p,s),ce=m$(le,h,s);switch(o){case"nearest":Z=nze(R,h,p,w,x,k,B,ce,se,K,u);break;case"bilinear":Z=aze(R,h,p,w,x,k,B,ce,se,K,u);break;default:throw new Error("Error in Transform: Expect 'nearest' or "+("'bilinear', but got "+o))}var he=B*T+O*I+V*F+K;D[he]=Z}}return n.makeTensorInfo(y,a.dtype,D)}var xe=n.write(D,y,a.dtype);return{dataId:xe,shape:a.shape,dtype:a.dtype}}var JLe={kernelName:E.Transform,backendName:"cpu",kernelFunc:ZLe};function m$(r,e,t){switch(t){case"reflect":return QLe(r,e);case"wrap":return eze(r,e);case"nearest":return rze(r,e);case"constant":default:return tze(r)}}function QLe(r,e){var t=r;if(t<0)if(e<=1)t=0;else{var n=2*e;t<n&&(t=n*Math.trunc(-t/n)+t),t=t<-e?t+n:-t-1}else if(t>e-1)if(e<=1)t=0;else{var n=2*e;t-=n*Math.trunc(t/n),t>=e&&(t=n-t-1)}return E.util.clamp(0,t,e-1)}function eze(r,e){var t=r;if(t<0)if(e<=1)t=0;else{var n=e-1;t+=e*(Math.trunc(-t/n)+1)}else if(t>e-1)if(e<=1)t=0;else{var n=e-1;t-=e*Math.trunc(t/n)}return E.util.clamp(0,t,e-1)}function tze(r,e){return r}function rze(r,e){return E.util.clamp(0,r,e-1)}function Kh(r,e,t,n,a,i,o,s,u,l,c){var f=o*n+s*a+u*i+l;return 0<=s&&s<e&&0<=u&&u<t?r[f]:c}function nze(r,e,t,n,a,i,o,s,u,l,c){var f=Math.round(s),h=Math.round(u);return Kh(r,e,t,n,a,i,o,f,h,l,c)}function aze(r,e,t,n,a,i,o,s,u,l,c){var f=Math.floor(s),h=Math.floor(u),p=f+1,d=h+1,m=(d-u)*Kh(r,e,t,n,a,i,o,f,h,l,c)+(u-h)*Kh(r,e,t,n,a,i,o,f,d,l,c),v=(d-u)*Kh(r,e,t,n,a,i,o,p,h,l,c)+(u-h)*Kh(r,e,t,n,a,i,o,p,d,l,c);return(p-s)*m+(s-f)*v}function ize(r){var e=r.inputs,t=r.attrs,n=r.backend,a=t.axis,i=e.x;Ve(i,"unique");var o=n.data.get(i.dataId).values,s=uW(o,a,i.shape,i.dtype),u=s.outputValues,l=s.outputShape,c=s.indices;return[n.makeTensorInfo(l,i.dtype,u),n.makeTensorInfo([c.length],"int32",c)]}var oze={kernelName:E.Unique,backendName:"cpu",kernelFunc:ize};function sze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.value,i=n.axis;i<0&&(i+=a.shape.length);for(var o=a.shape.length,s=a.shape[i],u=new Array(o-1),l=0,c=0;c<o;c++)c!==i&&(u[l++]=a.shape[c]);var f=new Array(o).fill(0),h=a.shape.slice();h[i]=1;for(var p=new Array(s),c=0;c<p.length;c++){f[i]=c;var d=$u({inputs:{x:a},backend:t,attrs:{begin:f,size:h}});p[c]=Qt({inputs:{x:d},backend:t,attrs:{shape:u}}),t.disposeIntermediateTensorInfo(d)}return p}var uze={kernelName:E.Unpack,backendName:"cpu",kernelFunc:sze};function lze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.segmentIds,o=n.numSegments;Ve(a,"unsortedSegmentSum");for(var s=a.shape.length,u=i.shape.length,l=[],c=[],f=s-u,h=i,p=0;p<f;++p){var d=tg({inputs:{input:h},backend:t,attrs:{dim:p+1}});h=d,c.push(d)}for(var p=0;p<o;++p){var m=E.util.createScalarValue(p,"int32"),v=t.makeTensorInfo([],"int32",m),g=T$({inputs:{a:v,b:h},backend:t}),y=ks({inputs:{x:g},backend:t,attrs:{dtype:"float32"}}),b=ng({inputs:{a:y,b:a},backend:t}),w=jh({inputs:{x:b},backend:t,attrs:{axis:0,keepDims:!1}});l.push(w),c.push(v),c.push(g),c.push(y),c.push(b),c.push(w)}var x=SW({inputs:l,backend:t,attrs:{axis:0}});return c.forEach(function(k){return t.disposeIntermediateTensorInfo(k)}),x}var cze={kernelName:E.UnsortedSegmentSum,backendName:"cpu",kernelFunc:lze},lk,g$,fze=[uPe,HRe,cPe,hPe,JRe,dPe,mPe,yPe,wPe,kPe,NPe,TPe,CPe,DPe,RPe,MPe,LPe,$Pe,qPe,oPe,GPe,HPe,jPe,YPe,YRe,eOe,JPe,KRe,eMe,rMe,nMe,iMe,sMe,lMe,fMe,pMe,vMe,gMe,bMe,xMe,SMe,EMe,IMe,CMe,_Me,FMe,OMe,PMe,MMe,BMe,$Me,QOe,qMe,tOe,YMe,rOe,ZMe,aOe,n4e,a4e,o4e,oOe,l4e,f4e,p4e,v4e,g4e,uOe,cOe,jRe,b4e,tMe,x4e,S4e,E4e,ePe,hOe,dOe,I4e,mOe,A4e,F4e,O4e,B4e,z4e,W4e,q4e,yOe,G4e,H4e,j4e,Y4e,J4e,eBe,rBe,wOe,aBe,sBe,cBe,kOe,NOe,pBe,mBe,bBe,TOe,xBe,SBe,NBe,NW,CBe,rPe,AOe,_Be,FBe,OBe,XRe,fk,MBe,nPe,aPe,iPe,LBe,$Be,qBe,GBe,HBe,KBe,XBe,LOe,ZBe,rLe,aLe,uLe,$Oe,cLe,hLe,dLe,WOe,uBe,gLe,bLe,xLe,SLe,ELe,ILe,ALe,DLe,GOe,FLe,HOe,OLe,MLe,LLe,$Le,qLe,YOe,LMe,GLe,HLe,jLe,YLe,JLe,IOe,oze,uze,cze,kBe];try{for(Uh=pc(fze),fc=Uh.next();!fc.done;fc=Uh.next())y$=fc.value,E.registerKernel(y$)}catch(r){lk={error:r}}finally{try{fc&&!fc.done&&(g$=Uh.return)&&g$.call(Uh)}finally{if(lk)throw lk.error}}var y$,Uh,fc;Xh.MathBackendCPU=pk;Xh.shared=ZOe;Xh.version_cpu=JOe});var _V=ue(no=>{"use strict";Object.defineProperty(no,"__esModule",{value:!0});var S=ru();function hze(r){if(r&&r.__esModule)return r;var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var pze=hze(S),Ek=function(r,e){return Ek=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},Ek(r,e)};function dze(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Ek(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function xc(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(c){try{l(n.next(c))}catch(f){o(f)}}function u(c){try{l(n.throw(c))}catch(f){o(f)}}function l(c){c.done?i(c.value):a(c.value).then(s,u)}l((n=n.apply(r,e||[])).next())})}function kc(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(l){return function(c){return u([l,c])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=l[0]&2?a.return:l[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,l[1])).done)return i;switch(a=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,a=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){t.label=l[1];break}if(l[0]===6&&t.label<i[1]){t.label=i[1],i=l;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(l);break}i[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(c){l=[6,c],a=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function ga(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function qe(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function Xr(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(qe(arguments[e]));return r}var qu={},ag={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function eq(r,e){qu[r]=e}function Pi(r,e){if(!(r in qu)||e!=null){var t=mze(r,e);if(t!==null)qu[r]=t;else return console.log("Could not get context for WebGL version",r),null}var n=qu[r];return n==null||n.isContextLost()?(delete qu[r],Pi(r)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),qu[r])}function vze(r){if(typeof OffscreenCanvas<"u"&&r===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function mze(r,e){if(r!==1&&r!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=e??vze(r);return t.addEventListener("webglcontextlost",function(n){n.preventDefault(),delete qu[r]},!1),S.env().getBool("SOFTWARE_WEBGL_ENABLED")&&(ag.failIfMajorPerformanceCaveat=!1),r===1?t.getContext("webgl",ag)||t.getContext("experimental-webgl",ag):t.getContext("webgl2",ag)}var tp;(function(r){r[r.DENSE=0]="DENSE",r[r.SHARED_BATCH=1]="SHARED_BATCH"})(tp||(tp={}));var Ra;(function(r){r[r.RENDER=0]="RENDER",r[r.UPLOAD=1]="UPLOAD",r[r.PIXELS=2]="PIXELS",r[r.DOWNLOAD=3]="DOWNLOAD"})(Ra||(Ra={}));var vn;(function(r){r[r.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",r[r.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",r[r.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",r[r.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",r[r.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(vn||(vn={}));function op(r,e){return[e,r]}function gze(r,e){return r*e}function ig(r){var e=S.util.sizeFromShape(r),t=Math.ceil(e/4);return S.util.sizeToSquarishShape(t)}function Nc(r,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(r/2))]}function yze(r,e){var t=qe(Nc(r,e),2),n=t[0],a=t[1];return n*a*4}function Rk(r,e){var t=r,n,a,i,o,s,u,l,c,f,h;return S.env().getNumber("WEBGL_VERSION")===2?(n=t.R32F,a=t.R16F,i=t.RGBA16F,o=t.RGBA32F,s=t.RED,l=4,c=1,f=t.HALF_FLOAT,h=t.FLOAT,u=t.RGBA8):(n=r.RGBA,a=r.RGBA,i=r.RGBA,o=t.RGBA,s=r.RGBA,l=4,c=4,f=e!=null?e.HALF_FLOAT_OES:null,h=r.FLOAT,u=r.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:a,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:s,downloadTextureFormat:u,downloadUnpackNumChannels:l,defaultNumChannels:c,textureTypeHalfFloat:f,textureTypeFloat:h}}function We(r,e){var t=e();return S.env().getBool("DEBUG")&&bze(r),t}function bze(r){var e=r.getError();if(e!==r.NO_ERROR)throw new Error("WebGL Error: "+rq(r,e))}var wze=596e-10,xze=65504;function tq(r){return!!(S.env().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||r===0||wze<Math.abs(r)&&Math.abs(r)<xze)}function rq(r,e){switch(e){case r.NO_ERROR:return"NO_ERROR";case r.INVALID_ENUM:return"INVALID_ENUM";case r.INVALID_VALUE:return"INVALID_VALUE";case r.INVALID_OPERATION:return"INVALID_OPERATION";case r.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case r.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case r.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function Zh(r,e){return Ao(r,function(){return r.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function nq(r,e){var t=Ao(r,function(){return r.createShader(r.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(We(r,function(){return r.shaderSource(t,e)}),We(r,function(){return r.compileShader(t)}),r.getShaderParameter(t,r.COMPILE_STATUS)===!1)throw console.log(r.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function aq(r,e){var t=Ao(r,function(){return r.createShader(r.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(We(r,function(){return r.shaderSource(t,e)}),We(r,function(){return r.compileShader(t)}),S.env().get("ENGINE_COMPILE_ONLY"))return t;if(r.getShaderParameter(t,r.COMPILE_STATUS)===!1)throw Ok(e,r.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}var kze=/ERROR: [0-9]+:([0-9]+):/g;function Ok(r,e){var t=kze.exec(e);if(t==null){console.log("Couldn't parse line number in error: "+e),console.log(r);return}for(var n=+t[1],a=r.split(`
`),i=a.length.toString().length+2,o=a.map(function(h,p){return S.util.rightPad((p+1).toString(),i)+h}),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var l=o.slice(0,n-1),c=o.slice(n-1,n),f=o.slice(n);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log("%c "+S.util.rightPad(c[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join(`
`))}function iq(r){return Ao(r,function(){return r.createProgram()},"Unable to create WebGLProgram.")}function oq(r,e){if(We(r,function(){return r.linkProgram(e)}),!S.env().get("ENGINE_COMPILE_ONLY")&&r.getProgramParameter(e,r.LINK_STATUS)===!1)throw console.log(r.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function lg(r,e){if(We(r,function(){return r.validateProgram(e)}),r.getProgramParameter(e,r.VALIDATE_STATUS)===!1)throw console.log(r.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function sq(r,e){var t=Ao(r,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return We(r,function(){return r.bindBuffer(r.ARRAY_BUFFER,t)}),We(r,function(){return r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW)}),t}function uq(r,e){var t=Ao(r,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return We(r,function(){return r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t)}),We(r,function(){return r.bufferData(r.ELEMENT_ARRAY_BUFFER,e,r.STATIC_DRAW)}),t}function Sze(){return S.env().getNumber("WEBGL_VERSION")===2?1:4}function lq(r){return Ao(r,function(){return r.createTexture()},"Unable to create WebGLTexture.")}function cq(r,e){var t=S.env().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(r<=0||e<=0){var n="["+r+"x"+e+"]";throw new Error("Requested texture size "+n+" is invalid.")}if(r>t||e>t){var n="["+r+"x"+e+"]",a="["+t+"x"+t+"]";throw new Error("Requested texture size "+n+" greater than WebGL maximum on this browser / GPU "+a+".")}}function fq(r){return Ao(r,function(){return r.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Tk(r,e,t,n,a,i,o){var s=r.getAttribLocation(e,t);return s===-1?!1:(We(r,function(){return r.bindBuffer(r.ARRAY_BUFFER,n)}),We(r,function(){return r.vertexAttribPointer(s,a,r.FLOAT,!1,i,o)}),We(r,function(){return r.enableVertexAttribArray(s)}),!0)}function hq(r,e,t){gq(r,t),We(r,function(){return r.activeTexture(r.TEXTURE0+t)}),We(r,function(){return r.bindTexture(r.TEXTURE_2D,e)})}function Nze(r,e){gq(r,e),We(r,function(){return r.activeTexture(r.TEXTURE0+e)}),We(r,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function pq(r,e,t){return Ao(r,function(){return r.getUniformLocation(e,t)},'uniform "'+t+'" not present in program.')}function dq(r,e,t){return r.getUniformLocation(e,t)}function vq(r,e,t,n){We(r,function(){return hq(r,e,n)}),We(r,function(){return r.uniform1i(t,n)})}function Eze(r){We(r,function(){return r.bindFramebuffer(r.FRAMEBUFFER,null)}),We(r,function(){return r.viewport(0,0,r.canvas.width,r.canvas.height)}),We(r,function(){return r.scissor(0,0,r.canvas.width,r.canvas.height)})}function cg(r,e,t){We(r,function(){return r.bindFramebuffer(r.FRAMEBUFFER,t)}),We(r,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0)})}function Ik(r,e){We(r,function(){return r.bindFramebuffer(r.FRAMEBUFFER,e)}),We(r,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0)})}function Jh(r){var e=r.checkFramebufferStatus(r.FRAMEBUFFER);if(e!==r.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+mq(r,e))}function mq(r,e){switch(e){case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case r.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function Ao(r,e,t){var n=We(r,function(){return e()});if(n==null)throw new Error(t);return n}function gq(r,e){var t=r.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=e+r.TEXTURE0;if(n<r.TEXTURE0||n>t){var a="[gl.TEXTURE0, gl.TEXTURE"+t+"]";throw new Error("textureUnit must be in "+a+".")}}function Gu(r,e){return e===void 0&&(e=2),S.util.sizeFromShape(r.slice(0,r.length-e))}function Uu(r){if(r.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[r.length>1?r[r.length-2]:1,r[r.length-1]]}function fg(r){var e=[1,1,1],t=r.length===0||r.length===1&&r[0]===1;return t||(e=Xr([Gu(r)],Uu(r))),e}function yq(r,e){var t;e===void 0&&(e=!1);var n=S.env().getNumber("WEBGL_MAX_TEXTURE_SIZE"),a=S.env().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");if(a===1/0&&S.env().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(a=n/2),e&&(n=n*2,a=a*2,r=r.map(function(h,p){return p>=r.length-2?S.util.nearestLargerEven(r[p]):r[p]}),r.length===1&&(r=[2,r[0]])),r.length!==2){var i=S.util.squeezeShape(r);r=i.newShape}var o=S.util.sizeFromShape(r),s=null;r.length<=1&&o<=n?s=[1,o]:r.length===2&&r[0]<=n&&r[1]<=n?s=r:r.length===3&&r[0]*r[1]<=n&&r[2]<=n?s=[r[0]*r[1],r[2]]:r.length===3&&r[0]<=n&&r[1]*r[2]<=n?s=[r[0],r[1]*r[2]]:r.length===4&&r[0]*r[1]*r[2]<=n&&r[3]<=n?s=[r[0]*r[1]*r[2],r[3]]:r.length===4&&r[0]<=n&&r[1]*r[2]*r[3]<=n&&(s=[r[0],r[1]*r[2]*r[3]]);var u=s!=null&&Math.max.apply(Math,Xr(s))>a&&Math.min.apply(Math,Xr(s))<=(e?2:1)&&Math.min.apply(Math,Xr(s))>0;if(s==null||u)if(e){var l=Gu(r),c=2,f=2;r.length&&(t=qe(Uu(r),2),c=t[0],f=t[1]),o=l*(c/2)*(f/2),s=S.util.sizeToSquarishShape(o).map(function(h){return h*2})}else s=S.util.sizeToSquarishShape(o);return s}function og(r){return r%2===0}function rp(r,e){if(r=r.slice(-2),e=e.slice(-2),S.util.arraysEqual(r,e)||!r.length||!e.length||r[0]===0||r[1]===0||e[0]===0||e[1]===0)return!0;if(r.length!==e.length){var t=r.slice(-1)[0],n=e.slice(-1)[0];if(t===n||og(t)&&og(n)&&(r[0]===1||e[0]===1))return!0}return r[1]===e[1]&&og(r[0])&&og(e[0])}var hg,pg;function bq(r){if(hg==null){var e=Pi(r);hg=e.getParameter(e.MAX_TEXTURE_SIZE)}return hg}function Tze(){hg=null}function Ize(){pg=null}function wq(r){if(pg==null){var e=Pi(r);pg=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,pg)}function xq(r){if(r===0)return 0;var e,t=Pi(r);return Oa(t,"EXT_disjoint_timer_query_webgl2")&&r===2?e=2:Oa(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function Oa(r,e){var t=r.getExtension(e);return t!=null}function Ck(r){try{var e=Pi(r);if(e!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function kq(r){if(r===0)return!1;var e=Pi(r);if(r===1){if(!Oa(e,"OES_texture_float"))return!1}else if(!Oa(e,"EXT_color_buffer_float"))return!1;var t=Ak(e);return t}function Sq(r){if(r===0)return!1;var e=Pi(r);if(r===1){if(!Oa(e,"OES_texture_float")||!Oa(e,"WEBGL_color_buffer_float"))return!1}else{if(Oa(e,"EXT_color_buffer_float"))return Ak(e);var t="EXT_color_buffer_half_float";if(Oa(e,t)){var n=e.getExtension(t);return Cze(e,n)}return!1}var a=Ak(e);return a}function Ak(r){var e=Rk(r),t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t);var n=1,a=1;r.texImage2D(r.TEXTURE_2D,0,e.internalFormatFloat,n,a,0,e.textureFormatFloat,e.textureTypeFloat,null);var i=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,i),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0);var o=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(t),r.deleteFramebuffer(i),o}function Cze(r,e){var t=Rk(r,e),n=r.createTexture();r.bindTexture(r.TEXTURE_2D,n);var a=1,i=1;r.texImage2D(r.TEXTURE_2D,0,t.internalFormatHalfFloat,a,i,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);var o=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,o),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,n,0);var s=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(n),r.deleteFramebuffer(o),s}function Nq(r){if(r!==2)return!1;var e=Pi(r),t=e.fenceSync!=null;return t}function Ec(r,e){Array.isArray(r)||(r=[r]),r.forEach(function(t){t!=null&&S.util.assert(t.dtype!=="complex64",function(){return e+" does not support complex64 tensors in the WebGL backend."})})}var Aze={__proto__:null,callAndCheck:We,canBeRepresented:tq,getWebGLErrorMessage:rq,getExtensionOrThrow:Zh,createVertexShader:nq,createFragmentShader:aq,logShaderSourceAndInfoLog:Ok,createProgram:iq,linkProgram:oq,validateProgram:lg,createStaticVertexBuffer:sq,createStaticIndexBuffer:uq,getNumChannels:Sze,createTexture:lq,validateTextureSize:cq,createFramebuffer:fq,bindVertexBufferToProgramAttribute:Tk,bindTextureUnit:hq,unbindTextureUnit:Nze,getProgramUniformLocationOrThrow:pq,getProgramUniformLocation:dq,bindTextureToProgramUniformSampler:vq,bindCanvasToFramebuffer:Eze,bindColorTextureToFramebuffer:cg,unbindColorTextureFromFramebuffer:Ik,validateFramebuffer:Jh,getFramebufferErrorMessage:mq,getBatchDim:Gu,getRowsCols:Uu,getShapeAs3D:fg,getTextureShapeFromLogicalShape:yq,isReshapeFree:rp,getWebGLMaxTextureSize:bq,resetMaxTextureSize:Tze,resetMaxTexturesInShader:Ize,getMaxTexturesInShader:wq,getWebGLDisjointQueryTimerVersion:xq,hasExtension:Oa,isWebGLVersionEnabled:Ck,isCapableOfRenderingToFloatTexture:kq,isDownloadFloatTextureEnabled:Sq,isWebGLFenceEnabled:Nq,assertNotComplex:Ec};var Xe=S.env();Xe.registerFlag("HAS_WEBGL",function(){return Xe.getNumber("WEBGL_VERSION")>0});Xe.registerFlag("WEBGL_VERSION",function(){return Ck(2)?2:Ck(1)?1:0});Xe.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",function(){return!1});Xe.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return Xe.get("WEBGL_VERSION")===2});Xe.registerFlag("WEBGL_CPU_FORWARD",function(){return!0});Xe.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1});Xe.registerFlag("WEBGL_PACK",function(){return Xe.getBool("HAS_WEBGL")});Xe.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return Xe.getBool("WEBGL_PACK")});Xe.registerFlag("WEBGL_PACK_CLIP",function(){return Xe.getBool("WEBGL_PACK")});Xe.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return Xe.getBool("WEBGL_PACK")});Xe.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return Xe.getBool("WEBGL_PACK")});Xe.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return Xe.getBool("WEBGL_PACK")});Xe.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return Xe.getBool("WEBGL_PACK")});Xe.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return Xe.getBool("WEBGL_PACK")});Xe.registerFlag("WEBGL_PACK_REDUCE",function(){return Xe.getBool("WEBGL_PACK")});Xe.registerFlag("WEBGL_LAZILY_UNPACK",function(){return Xe.getBool("WEBGL_PACK")});Xe.registerFlag("WEBGL_CONV_IM2COL",function(){return Xe.getBool("WEBGL_PACK")});Xe.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return bq(Xe.getNumber("WEBGL_VERSION"))});Xe.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return wq(Xe.getNumber("WEBGL_VERSION"))});Xe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var r=Xe.getNumber("WEBGL_VERSION");return r===0?0:xq(r)});Xe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return Xe.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!S.device_util.isMobile()});Xe.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return kq(Xe.getNumber("WEBGL_VERSION"))});Xe.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return Xe.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Xe.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")});Xe.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return Sq(Xe.getNumber("WEBGL_VERSION"))});Xe.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return Nq(Xe.getNumber("WEBGL_VERSION"))});Xe.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){var r=Xe.getBool("WEBGL_RENDER_FLOAT32_ENABLED");return r?4:0});Xe.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",function(){return-1},function(r){if(r<0&&r!==-1)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never "+("delete) or at least 0, but got "+r+"."))});Xe.registerFlag("WEBGL_FLUSH_THRESHOLD",function(){return S.device_util.isMobile()?1:-1},function(r){if(r<0&&r!==-1)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never "+("manual flush) or at least 0, but got "+r+"."))});Xe.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",function(){return 128});Xe.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",function(){return!1});Xe.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",function(){return 1e5});Xe.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",function(){return 128});Xe.registerFlag("WEBGL_EXP_CONV",function(){return!1});Xe.registerFlag("SOFTWARE_WEBGL_ENABLED",function(){return Xe.getBool("IS_TEST")});Xe.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",function(){return 1/0});Xe.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",function(){return!1});Xe.registerFlag("WEBGL2_ISNAN_CUSTOM",function(){return!1});function _n(){var r,e,t,n,a,i,o,s,u,l;return S.env().getNumber("WEBGL_VERSION")===2?(r="#version 300 es",e="in",t="out",n="in",a="texture",i="outputColor",o="out vec4 outputColor;",s=S.env().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",u="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(r="",e="attribute",t="varying",n="varying",a="texture2D",i="gl_FragColor",o="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:r,attribute:e,varyingVs:t,varyingFs:n,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function Hu(r,e,t){t===void 0&&(t="index");var n=S.util.computeStrides(e);return n.map(function(a,i){var o="int "+r[i]+" = "+t+" / "+a,s=i===n.length-1?"int "+r[i+1]+" = "+t+" - "+r[i]+" * "+a:"index -= "+r[i]+" * "+a;return o+"; "+s+";"}).join("")}function bg(r,e,t){t===void 0&&(t="index");var n=S.util.computeStrides(e);return n.map(function(a,i){var o="int "+r[i]+" = "+t+" / outShapeStrides["+i+"]",s=i===n.length-1?"int "+r[i+1]+" = "+t+" - "+r[i]+" * outShapeStrides["+i+"]":"index -= "+r[i]+" * outShapeStrides["+i+"]";return o+"; "+s+";"}).join("")}function _ze(r,e){var t=r.length,n=r.map(function(o){return e+"["+o+"]"}),a=new Array(t-1);a[t-2]=n[t-1];for(var i=t-3;i>=0;--i)a[i]="("+a[i+1]+" * "+n[i+1]+")";return a}function Dze(r,e,t){t===void 0&&(t="index");var n=r.map(function(i,o){return o}),a=_ze(n,e);return a.map(function(i,o){var s="int "+r[o]+" = "+t+" / "+a[o],u=o===a.length-1?"int "+r[o+1]+" = "+t+" - "+r[o]+" * "+a[o]:"index -= "+r[o]+" * "+a[o];return s+"; "+u+";"}).join("")}function Pk(r){var e=S.util.computeStrides(r).map(function(t){return t.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+e[0]+" + coords.y * "+e[1]+` + coords.z;
  }
`}function Mk(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}var Eq=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`,Tq=S.backend_util.getBroadcastDims;function Fze(r,e,t){var n=[];if(r.forEach(function(p){var d=S.util.sizeFromShape(p.shapeInfo.logicalShape);if(p.shapeInfo.isUniform?n.push("uniform float "+p.name+(d>1?"["+d+"]":"")+";"):(n.push("uniform sampler2D "+p.name+";"),n.push("uniform int offset"+p.name+";")),t.enableShapeUniforms){var m=Bk(t.packedInputs,p.shapeInfo.logicalShape,p.shapeInfo.texShape).uniformShape;switch(m.length){case 1:n.push("uniform int "+p.name+"Shape;");break;case 2:n.push("uniform ivec2 "+p.name+"Shape;");break;case 3:n.push("uniform ivec3 "+p.name+"Shape;");break;case 4:n.push("uniform ivec4 "+p.name+"Shape;");break}n.push("uniform ivec2 "+p.name+"TexShape;")}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:n.push("uniform int outShape;");break;case 2:n.push("uniform ivec2 outShape;"),n.push("uniform int outShapeStrides;");break;case 3:n.push("uniform ivec3 outShape;"),n.push("uniform ivec2 outShapeStrides;");break;case 4:n.push("uniform ivec4 outShape;"),n.push("uniform ivec3 outShapeStrides;");break}n.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(function(p){n.push("uniform "+p.type+" "+p.name+(p.arrayIndex?"["+p.arrayIndex+"]":"")+";")});var a=n.join(`
`),i=r.map(function(p){return Rze(p,e,t.packedInputs,t.enableShapeUniforms)}).join(`
`),o=e.texShape,s=_n(),u=Mze(s),l,c,f=zze(s);e.isPacked?(l=Oze(e.logicalShape,o,t.enableShapeUniforms),c=Lze(s)):(l=Pze(e.logicalShape,o,t.enableShapeUniforms),c=Bze(s)),t.packedInputs&&(f+=Vze);var h=[f,u,c,a,l,i,t.userCode].join(`
`);return h}function Tc(r,e){e===void 0&&(e=!1);var t=r.shapeInfo.logicalShape;switch(t.length){case 0:return t$e(r,e);case 1:return n$e(r,e);case 2:return i$e(r,e);case 3:return s$e(r,e);case 4:return l$e(r,e);case 5:return c$e(r);case 6:return f$e(r);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function Iq(r,e){var t=r.shapeInfo.logicalShape;switch(t.length){case 0:return e$e(r);case 1:return r$e(r,e);case 2:return a$e(r,e);case 3:return o$e(r,e);default:return u$e(r,e)}}function Rze(r,e,t,n){t===void 0&&(t=!1);var a="";t?a+=Iq(r,n):a+=Tc(r,n);var i=r.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(t?a+=h$e(r,e):a+=p$e(r,e)),a}function Oze(r,e,t){switch(r.length){case 0:return Cq();case 1:return Gze(r,e,t);case 2:return Jze(r,e,t);case 3:return Hze(r,e,t);default:return jze(r,e,t)}}function Pze(r,e,t){switch(r.length){case 0:return Cq();case 1:return Uze(r,e,t);case 2:return Qze(r,e,t);case 3:return Kze(r,e,t);case 4:return Xze(r,e,t);case 5:return Yze(r,e);case 6:return Zze(r,e);default:throw new Error(r.length+"-D output sampling is not yet supported")}}function Mze(r){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+r.texture2D+`(textureSampler, uv).r;
    }
  `}function Bze(r){return`
    void setOutput(float val) {
      `+r.output+` = vec4(val, 0, 0, 0);
    }
  `}function Lze(r){return`
    void setOutput(vec4 val) {
      `+r.output+` = val;
    }
  `}function zze(r){var e=r.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+r.varyingFs+` vec2 resultUV;
    `+r.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+r.defineSpecialNaN+`
    `+r.defineSpecialInf+`
    `+r.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+$ze+`
    `+Wze+`
    `+qze+`
  `;return e}var $ze=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Wze=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,qze=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Vze=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Cq(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function Gze(r,e,t){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return n[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+n[1]+`.0);
      }
    `:n[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+n[0]+`.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+n[0]+", "+n[1]+`));
      return 2 * (resTexRC.x * `+n[1]+` + resTexRC.y);
    }
  `}function Uze(r,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * `+e[1]+`.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * `+e[0]+`.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+e[0]+", "+e[1]+`));
      return resTexRC.x * `+e[1]+` + resTexRC.y;
    }
  `}function Hze(r,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],a=Math.ceil(r[2]/2),i=a*Math.ceil(r[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+n[0]+", "+n[1]+`));
      int index = resTexRC.x * `+n[1]+` + resTexRC.y;

      int b = index / `+i+`;
      index -= b * `+i+`;

      int r = 2 * (index / `+a+`);
      int c = imod(index, `+a+`) * 2;

      return ivec3(b, r, c);
    }
  `}function Kze(r,e,t){if(t){var n=bg(["r","c","d"],r);return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    `+n+`
    return ivec3(r, c, d);
  }
`}var a=Hu(["r","c","d"],r);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+e[0]+", "+e[1]+`));
      int index = resTexRC.x * `+e[1]+` + resTexRC.y;
      `+a+`
      return ivec3(r, c, d);
    }
  `}function jze(r,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;for(var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],a=Math.ceil(r[r.length-1]/2),i=a*Math.ceil(r[r.length-2]/2),o=i,s="",u="b, r, c",l=2;l<r.length-1;l++)o*=r[r.length-l-1],s=`
      int b`+l+" = index / "+o+`;
      index -= b`+l+" * "+o+`;
    `+s,u="b"+l+", "+u;return`
    ivec`+r.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+n[0]+", "+n[1]+`));
      int index = resTexRC.x * `+n[1]+` + resTexRC.y;

      `+s+`

      int b = index / `+i+`;
      index -= b * `+i+`;

      int r = 2 * (index / `+a+`);
      int c = imod(index, `+a+`) * 2;

      return ivec`+r.length+"("+u+`);
    }
  `}function Xze(r,e,t){if(t){var n=bg(["r","c","d","d2"],r);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      `+n+`
      return ivec4(r, c, d, d2);
    }
  `}var a=Hu(["r","c","d","d2"],r);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+e[0]+", "+e[1]+`));
      int index = resTexRC.x * `+e[1]+` + resTexRC.y;
      `+a+`
      return ivec4(r, c, d, d2);
    }
  `}function Yze(r,e){var t=Hu(["r","c","d","d2","d3"],r);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+e[0]+`,
                             `+e[1]+`));

      int index = resTexRC.x * `+e[1]+` + resTexRC.y;

      `+t+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function Zze(r,e){var t=Hu(["r","c","d","d2","d3","d4"],r);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+e[0]+", "+e[1]+`));
      int index = resTexRC.x * `+e[1]+` + resTexRC.y;

      `+t+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function Jze(r,e,t){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(S.util.arraysEqual(r,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+n[0]+", "+n[1]+`));
      }
    `;var a=Math.ceil(r[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+n[0]+", "+n[1]+`));

      int index = resTexRC.x * `+n[1]+` + resTexRC.y;
      int r = 2 * (index / `+a+`);
      int c = imod(index, `+a+`) * 2;

      return ivec2(r, c);
    }
  `}function Qze(r,e,t){return S.util.arraysEqual(r,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+e[0]+", "+e[1]+`));
      }
    `:r[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+e[0]+", "+e[1]+`));
        int index = resTexRC.x * `+e[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:r[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+e[0]+", "+e[1]+`));
        int index = resTexRC.x * `+e[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+e[0]+", "+e[1]+`));
      int index = resTexRC.x * `+e[1]+` + resTexRC.y;
      int r = index / `+r[1]+`;
      int c = index - r * `+r[1]+`;
      return ivec2(r, c);
    }
  `}function Ku(r){return"offset"+r}function e$e(r){var e=r.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),n=_n();return`
    vec4 `+t+`() {
      return `+n.texture2D+"("+e+`, halfCR);
    }
  `}function t$e(r,e){var t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(r.shapeInfo.isUniform)return"float "+n+"() {return "+t+";}";var a=qe(r.shapeInfo.texShape,2),i=a[0],o=a[1];if(i===1&&o===1)return`
      float `+n+`() {
        return sampleTexture(`+t+`, halfCR);
      }
    `;var s=Ku(t);if(e)return`
    float `+n+`() {
      vec2 uv = uvFromFlat(`+t+"TexShape[0], "+t+"TexShape[1], "+s+`);
      return sampleTexture(`+t+`, uv);
    }
  `;var u=qe(r.shapeInfo.texShape,2),l=u[0],c=u[1];return`
    float `+n+`() {
      vec2 uv = uvFromFlat(`+l+", "+c+", "+s+`);
      return sampleTexture(`+t+`, uv);
    }
  `}function r$e(r,e){var t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),a=r.shapeInfo.texShape,i=_n();if(e)return`
    vec4 `+n+`(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(`+t+"TexShape[0]) / 2.0), ceil(float("+t+`TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return `+i.texture2D+"("+t+`, uv);
    }
  `;var o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return`
    vec4 `+n+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+o[0]+", "+o[1]+`, index);
      return `+i.texture2D+"("+t+`, uv);
    }
  `}function n$e(r,e){var t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(r.shapeInfo.isUniform)return`
      float `+n+`(int index) {
        `+Ic(r)+`
      }
    `;var a=r.shapeInfo.texShape,i=a[0],o=a[1];if(o===1&&i===1)return`
      float `+n+`(int index) {
        return sampleTexture(`+t+`, halfCR);
      }
    `;var s=Ku(t);return o===1?e?`
      float `+n+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+s+") + 0.5) / float("+t+`TexShape[0]));
        return sampleTexture(`+t+`, uv);
      }
    `:`
      float `+n+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+s+") + 0.5) / "+i+`.0);
        return sampleTexture(`+t+`, uv);
      }
    `:i===1?e?`
      float `+n+`(int index) {
        vec2 uv = vec2((float(index + `+s+") + 0.5) / float("+t+`TexShape[1]), 0.5);
        return sampleTexture(`+t+`, uv);
      }
    `:`
      float `+n+`(int index) {
        vec2 uv = vec2((float(index + `+s+") + 0.5) / "+o+`.0, 0.5);
        return sampleTexture(`+t+`, uv);
      }
    `:e?`
    float `+n+`(int index) {
      vec2 uv = uvFromFlat(`+t+"TexShape[0], "+t+"TexShape[1], index + "+s+`);
      return sampleTexture(`+t+`, uv);
    }
  `:`
    float `+n+`(int index) {
      vec2 uv = uvFromFlat(`+i+", "+o+", index + "+s+`);
      return sampleTexture(`+t+`, uv);
    }
  `}function a$e(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=r.shapeInfo.texShape,o=i[0],s=i[1],u=_n();if(i!=null&&S.util.arraysEqual(t,i))return e?`
      vec4 `+a+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+n+"TexShape[1], "+n+`TexShape[0]);

        return `+u.texture2D+"("+n+`, uv);
      }
    `:`
      vec4 `+a+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+s+".0, "+o+`.0);

        return `+u.texture2D+"("+n+`, uv);
      }
    `;if(e)return`
    vec4 `+a+`(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(`+n+"TexShape[0]) / 2.0), ceil(float("+n+`TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(`+n+`Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return `+u.texture2D+"("+n+`, uv);
    }
  `;var l=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],c=Math.ceil(t[1]/2);return`
    vec4 `+a+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+c+", "+l[0]+", "+l[1]+`, row, col);
      return `+u.texture2D+"("+n+`, uv);
    }
  `}function i$e(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=r.shapeInfo.texShape;if(i!=null&&S.util.arraysEqual(t,i)){if(e)return`
      float `+a+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+n+"TexShape[1], "+n+`TexShape[0]);
        return sampleTexture(`+n+`, uv);
      }
    `;var o=i[0],s=i[1];return`
    float `+a+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+s+".0, "+o+`.0);
      return sampleTexture(`+n+`, uv);
    }
  `}var u=S.util.squeezeShape(t),l=u.newShape,c=u.keptDims,f=l;if(f.length<t.length){var h=Cc(r,f),p=["row","col"];return`
      `+Tc(h,e)+`
      float `+a+`(int row, int col) {
        return `+a+"("+Ac(p,c)+`);
      }
    `}if(r.shapeInfo.isUniform)return`
      float `+a+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+t[1]+`, 1)));
        `+Ic(r)+`
      }
    `;var d=i[0],m=i[1],v=Ku(n);return m===1?e?`
      float `+a+`(int row, int col) {
        float index = dot(vec3(row, col, `+v+"), vec3("+n+`Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(`+n+`TexShape[0]));
        return sampleTexture(`+n+`, uv);
      }
    `:`
    float `+a+`(int row, int col) {
      float index = dot(vec3(row, col, `+v+"), vec3("+t[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+d+`.0);
      return sampleTexture(`+n+`, uv);
    }
  `:d===1?e?`
      float `+a+`(int row, int col) {
        float index = dot(vec3(row, col, `+v+"), vec3("+n+`Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(`+n+`TexShape[1]), 0.5);
        return sampleTexture(`+n+`, uv);
      }
    `:`
    float `+a+`(int row, int col) {
      float index = dot(vec3(row, col, `+v+"), vec3("+t[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+m+`.0, 0.5);
      return sampleTexture(`+n+`, uv);
    }
  `:e?`
      float `+a+`(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+n+"Shape[1] + col + "+v+`;
        vec2 uv = uvFromFlat(`+n+"TexShape[0], "+n+`TexShape[1], index);
        return sampleTexture(`+n+`, uv);
      }
    `:`
  float `+a+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+t[1]+" + col + "+v+`;
    vec2 uv = uvFromFlat(`+d+", "+m+`, index);
    return sampleTexture(`+n+`, uv);
  }
`}function o$e(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=r.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(t[0]===1){var s=t.slice(1),u=[1,2],l=Cc(r,s),c=["b","row","col"];return`
        `+Iq(l,e)+`
        vec4 `+a+`(int b, int row, int col) {
          return `+a+"("+Ac(c,u)+`);
        }
      `}var f=_n();if(e)return`
    vec4 `+a+`(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(`+n+"TexShape[0]) / 2.0), ceil(float("+n+`TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(`+n+`Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(`+n+`Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return `+f.texture2D+"("+n+`, uv);
    }
  `;var h=o[0],p=o[1],d=Math.ceil(t[2]/2),m=d*Math.ceil(t[1]/2);return`
    vec4 `+a+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+h+", "+p+", "+m+", "+d+`, b, row, col);
      return `+f.texture2D+"("+n+`, uv);
    }
  `}function s$e(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[1]*t[2],o=t[2],s=S.util.squeezeShape(t),u=s.newShape,l=s.keptDims,c=u;if(c.length<t.length){var f=Cc(r,c),h=["row","col","depth"];return`
        `+Tc(f,e)+`
        float `+a+`(int row, int col, int depth) {
          return `+a+"("+Ac(h,l)+`);
        }
      `}if(r.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+i+", "+o+`, 1)));
        `+Ic(r)+`
      }
    `;var p=r.shapeInfo.texShape,d=p[0],m=p[1],v=r.shapeInfo.flatOffset;if(m===i&&v==null)return e?`
      float `+a+`(int row, int col, int depth) {
        int stride1 = `+n+`Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+n+"TexShape[1], "+n+`TexShape[0]);
        return sampleTexture(`+n+`, uv);
      }
    `:`
        float `+a+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+o+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+m+".0, "+d+`.0);
          return sampleTexture(`+n+`, uv);
        }
      `;if(m===o&&v==null)return e?`
      float `+a+`(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(`+n+`Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+n+"TexShape[1], "+n+`TexShape[0]);
        return sampleTexture(`+n+`, uv);
      }
    `:`
    float `+a+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+t[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+m+".0, "+d+`.0);
      return sampleTexture(`+n+`, uv);
    }
  `;var g=Ku(n);return e?`
    float `+a+`(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = `+n+"Shape[1] * "+n+`Shape[2];
      int stride1 = `+n+`Shape[2];
      int index = row * stride0 + col * stride1 + depth + `+g+`;
      vec2 uv = uvFromFlat(`+n+"TexShape[0], "+n+`TexShape[1], index);
      return sampleTexture(`+n+`, uv);
    }
    `:`
      float `+a+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+i+" + col * "+o+" + depth + "+g+`;
        vec2 uv = uvFromFlat(`+d+", "+m+`, index);
        return sampleTexture(`+n+`, uv);
      }
  `}function u$e(r,e){var t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),a=_n();if(e)return`
    vec4 `+n+`(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(`+t+`Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(`+t+`Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= `+t+`Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(`+t+"TexShape[0]) / 2.0), ceil(float("+t+`TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return `+a.texture2D+"("+t+`, uv);
    }
  `;for(var i=r.shapeInfo.logicalShape,o=i.length,s=r.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],l=u[0],c=u[1],f=Math.ceil(i[o-1]/2),h=f*Math.ceil(i[o-2]/2),p="int b, int row, int col",d="b * "+h+" + (row / 2) * "+f+" + (col / 2)",m=2;m<o-1;m++)p="int b"+m+", "+p,h*=i[o-m-1],d="b"+m+" * "+h+" + "+d;return`
    vec4 `+n+"("+p+`) {
      int index = `+d+`;
      int texR = index / `+c+`;
      int texC = index - texR * `+c+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+c+", "+l+`);
      return `+a.texture2D+"("+t+`, uv);
    }
  `}function l$e(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[3],o=t[2]*i,s=t[1]*o,u=S.util.squeezeShape(t),l=u.newShape,c=u.keptDims;if(l.length<t.length){var f=Cc(r,l),h=["row","col","depth","depth2"];return`
      `+Tc(f,e)+`
      float `+a+`(int row, int col, int depth, int depth2) {
        return `+a+"("+Ac(h,c)+`);
      }
    `}if(r.shapeInfo.isUniform)return`
      float `+a+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+s+", "+o+", "+i+`, 1)));
        `+Ic(r)+`
      }
    `;var p=r.shapeInfo.flatOffset,d=r.shapeInfo.texShape,m=d[0],v=d[1],g="int stride2 = "+n+"Shape[3];",y="int stride1 = "+n+"Shape[2] * stride2;",b="int stride0 = "+n+"Shape[1] * stride1;";if(v===s&&p==null)return e?`
      float `+a+`(int row, int col, int depth, int depth2) {
        `+g+`
        `+y+`
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+n+"TexShape[1], "+n+`TexShape[0]);
        return sampleTexture(`+n+`, uv);
      }
    `:`
      float `+a+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+o+", "+i+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+v+".0, "+m+`.0);
        return sampleTexture(`+n+`, uv);
      }
    `;if(v===i&&p==null)return e?`
      float `+a+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+n+"Shape[1] * "+n+"Shape[2], "+n+`Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+n+"TexShape[1], "+n+`TexShape[0]);
        return sampleTexture(`+n+`, uv);
      }
    `:`
      float `+a+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+t[1]*t[2]+", "+t[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+v+".0, "+m+`.0);
        return sampleTexture(`+n+`, uv);
      }
    `;var w=Ku(n);return e?`
    float `+a+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      `+g+`
      `+y+`
      `+b+`
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(`+n+"TexShape[0], "+n+"TexShape[1], index + "+w+`);
      return sampleTexture(`+n+`, uv);
    }
  `:`
    float `+a+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+s+" + col * "+o+` +
          depth * `+i+` + depth2;
      vec2 uv = uvFromFlat(`+m+", "+v+", index + "+w+`);
      return sampleTexture(`+n+`, uv);
    }
  `}function c$e(r){var e=r.shapeInfo.logicalShape,t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),a=e[4],i=e[3]*a,o=e[2]*i,s=e[1]*o,u=S.util.squeezeShape(e),l=u.newShape,c=u.keptDims;if(l.length<e.length){var f=Cc(r,l),h=["row","col","depth","depth2","depth3"];return`
      `+Tc(f)+`
      float `+n+`(int row, int col, int depth, int depth2, int depth3) {
        return `+n+"("+Ac(h,c)+`);
      }
    `}if(r.shapeInfo.isUniform)return`
      float `+n+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+s+", "+o+", "+i+", "+a+`)) +
          depth3;
        `+Ic(r)+`
      }
    `;var p=r.shapeInfo.flatOffset,d=r.shapeInfo.texShape,m=d[0],v=d[1];if(v===s&&p==null)return`
      float `+n+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+o+", "+i+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+v+".0, "+m+`.0);
        return sampleTexture(`+t+`, uv);
      }
    `;if(v===a&&p==null)return`
      float `+n+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+e[1]*e[2]*e[3]+`,
               `+e[2]*e[3]+", "+e[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+v+".0, "+m+`.0);
        return sampleTexture(`+t+`, uv);
      }
    `;var g=Ku(t);return`
    float `+n+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+s+" + col * "+o+" + depth * "+i+` +
          depth2 * `+a+" + depth3 + "+g+`;
      vec2 uv = uvFromFlat(`+m+", "+v+`, index);
      return sampleTexture(`+t+`, uv);
    }
  `}function f$e(r){var e=r.shapeInfo.logicalShape,t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),a=S.util.squeezeShape(e),i=a.newShape,o=a.keptDims;if(i.length<e.length){var s=Cc(r,i),u=["row","col","depth","depth2","depth3","depth4"];return`
      `+Tc(s)+`
      float `+n+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+n+"("+Ac(u,o)+`);
      }
    `}var l=e[5],c=e[4]*l,f=e[3]*c,h=e[2]*f,p=e[1]*h;if(r.shapeInfo.isUniform)return`
      float `+n+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+p+", "+h+", "+f+", "+c+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+l+`, 1)));
        `+Ic(r)+`
      }
    `;var d=r.shapeInfo.flatOffset,m=r.shapeInfo.texShape,v=m[0],g=m[1];if(g===p&&d==null)return`
      float `+n+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+h+", "+f+", "+c+", "+l+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+g+".0, "+v+`.0);
        return sampleTexture(`+t+`, uv);
      }
    `;if(g===l&&d==null)return`
      float `+n+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+e[1]*e[2]*e[3]*e[4]+`,
               `+e[2]*e[3]*e[4]+`,
               `+e[3]*e[4]+`,
               `+e[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+g+".0, "+v+`.0);
        return sampleTexture(`+t+`, uv);
      }
    `;var y=Ku(t);return`
    float `+n+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+p+" + col * "+h+" + depth * "+f+` +
          depth2 * `+c+" + depth3 * "+l+" + depth4 + "+y+`;
      vec2 uv = uvFromFlat(`+v+", "+g+`, index);
      return sampleTexture(`+t+`, uv);
    }
  `}function Ic(r){var e=r.name,t=S.util.sizeFromShape(r.shapeInfo.logicalShape);return t<2?"return "+e+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function h$e(r,e){var t=r.name,n=t.charAt(0).toUpperCase()+t.slice(1),a="get"+n+"AtOutCoords",i=r.shapeInfo.logicalShape.length,o=e.logicalShape.length,s=Tq(r.shapeInfo.logicalShape,e.logicalShape),u=er(o),l=o-i,c,f=["x","y","z","w","u","v"];i===0?c="":o<2&&s.length>=1?c="coords = 0;":c=s.map(function(w){return"coords."+f[w+l]+" = 0;"}).join(`
`);var h="";o<2&&i>0?h="coords":h=r.shapeInfo.logicalShape.map(function(w,x){return"coords."+f[x+l]}).join(", ");var p="return outputValue;",d=S.util.sizeFromShape(r.shapeInfo.logicalShape),m=d===1,v=S.util.sizeFromShape(e.logicalShape),g=v===1;if(i===1&&!m&&!g)p=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(m&&!g)o===1?p=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:p=`
        return vec4(outputValue.x);
      `;else if(s.length){var y=i-2,b=i-1;s.indexOf(y)>-1&&s.indexOf(b)>-1?p="return vec4(outputValue.x);":s.indexOf(y)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":s.indexOf(b)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 `+a+`() {
      `+u+` coords = getOutputCoords();
      `+c+`
      vec4 outputValue = get`+n+"("+h+`);
      `+p+`
    }
  `}function p$e(r,e){var t=r.name,n=t.charAt(0).toUpperCase()+t.slice(1),a="get"+n+"AtOutCoords",i=e.texShape,o=r.shapeInfo.texShape,s=r.shapeInfo.logicalShape.length,u=e.logicalShape.length;if(!r.shapeInfo.isUniform&&s===u&&r.shapeInfo.flatOffset==null&&S.util.arraysEqual(o,i))return`
      float `+a+`() {
        return sampleTexture(`+t+`, resultUV);
      }
    `;var l=er(u),c=Tq(r.shapeInfo.logicalShape,e.logicalShape),f=u-s,h,p=["x","y","z","w","u","v"];s===0?h="":u<2&&c.length>=1?h="coords = 0;":h=c.map(function(m){return"coords."+p[m+f]+" = 0;"}).join(`
`);var d="";return u<2&&s>0?d="coords":d=r.shapeInfo.logicalShape.map(function(m,v){return"coords."+p[v+f]}).join(", "),`
    float `+a+`() {
      `+l+` coords = getOutputCoords();
      `+h+`
      return get`+n+"("+d+`);
    }
  `}function er(r){if(r<=1)return"int";if(r===2)return"ivec2";if(r===3)return"ivec3";if(r===4)return"ivec4";if(r===5)return"ivec5";if(r===6)return"ivec6";throw Error("GPU for rank "+r+" is not yet supported")}function Bk(r,e,t){var n=S.util.squeezeShape(e),a=n.newShape,i=n.keptDims,o=e.length,s=r&&o===3&&e[0]===1,u=s?e.slice(1):a,l=!r&&o>1&&!S.util.arraysEqual(e,t)&&a.length<o||s,c=l?u:e;return{useSqueezeShape:l,uniformShape:c,keptDims:i}}function Cc(r,e){var t=JSON.parse(JSON.stringify(r));return t.shapeInfo.logicalShape=e,t}function Ac(r,e){return e.map(function(t){return r[t]}).join(", ")}function d$e(r,e,t,n){var a=t.map(function(c,f){var h={logicalShape:c.shape,texShape:c.isUniform?null:c.texData.texShape,isUniform:c.isUniform,isPacked:c.isUniform?!1:c.texData.isPacked,flatOffset:null};return c.texData!=null&&c.texData.slice!=null&&c.texData.slice.flatOffset>0&&(h.flatOffset=c.texData.slice.flatOffset),{name:e.variableNames[f],shapeInfo:h}}),i=a.map(function(c){return c.shapeInfo}),o={logicalShape:n.shape,texShape:n.texData.texShape,isUniform:!1,isPacked:n.texData.isPacked,flatOffset:null},s=Fze(a,o,e),u=aq(r.gl,s),l=r.createProgram(u);return S.env().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:u,source:s,webGLProgram:l,inShapeInfos:i,outShapeInfo:o,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:e,fragmentShader:u,source:s,webGLProgram:l,inShapeInfos:i,outShapeInfo:o},Aq(r,e,l))}function Aq(r,e,t){var n={},a={},i={},o=[],s,u,l,c=null,f=null;f=r.getUniformLocation(t,"NAN",!1),S.env().getNumber("WEBGL_VERSION")===1&&(c=r.getUniformLocation(t,"INFINITY",!1));for(var h=!1,p=0;p<e.variableNames.length;p++){var d=e.variableNames[p];n[d]=r.getUniformLocation(t,d,h),n["offset"+d]=r.getUniformLocation(t,"offset"+d,h),e.enableShapeUniforms&&(a[d+"Shape"]=r.getUniformLocation(t,d+"Shape",h),i[d+"TexShape"]=r.getUniformLocation(t,d+"TexShape",h))}return e.enableShapeUniforms&&(s=r.getUniformLocation(t,"outShape",h),l=r.getUniformLocation(t,"outShapeStrides",h),u=r.getUniformLocation(t,"outTexShape",h)),e.customUniforms&&e.customUniforms.forEach(function(m,v){o[v]=r.getUniformLocation(t,m.name,h)}),{uniformLocations:n,customUniformLocations:o,infLoc:c,nanLoc:f,inShapesLocations:a,inTexShapesLocations:i,outShapeLocation:s,outShapeStridesLocation:l,outTexShapeLocation:u}}function TW(r,e){if(r.length!==e.length)throw Error("Binary was compiled with "+r.length+" inputs, but "+("was executed with "+e.length+" inputs"));r.forEach(function(t,n){var a=t.logicalShape,i=e[n],o=i.shape;if(!S.util.arraysEqual(a,o))throw Error("Binary was compiled with different shapes than "+("the current args. Shapes "+a+" and "+o+" must match"));if(!(t.isUniform&&i.isUniform)){var s=t.texShape,u=i.isUniform?null:i.texData.texShape;if(!S.util.arraysEqual(s,u))throw Error("Binary was compiled with different texture shapes than the"+(" current args. Shape "+s+" and "+u+" must match"))}})}function v$e(r,e,t,n,a){e.program.enableShapeUniforms||(TW(e.inShapeInfos,t),TW([e.outShapeInfo],[n]));var i=n.texData.texture,o=n.texData.texShape;n.texData.isPacked?r.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):r.setOutputMatrixTexture(i.texture,o[0],o[1]),r.setProgram(e.webGLProgram),S.env().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&r.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&r.gl.uniform1f(e.nanLoc,NaN),t.forEach(function(l,c){var f=e.program.variableNames[c],h=e.uniformLocations[f],p=e.uniformLocations["offset"+f],d=e.inShapesLocations[f+"Shape"],m=e.inTexShapesLocations[f+"TexShape"];if(d){var v=Bk(e.program.packedInputs,l.shape,l.texData.texShape).uniformShape;switch(v.length){case 1:r.gl.uniform1iv(d,new Int32Array(v));break;case 2:r.gl.uniform2iv(d,new Int32Array(v));break;case 3:r.gl.uniform3iv(d,new Int32Array(v));break;case 4:r.gl.uniform4iv(d,new Int32Array(v));break}}if(m&&r.gl.uniform2i(m,l.texData.texShape[0],l.texData.texShape[1]),h!=null){if(l.isUniform){if(S.util.sizeFromShape(l.shape)<2)r.gl.uniform1f(h,l.uniformValues[0]);else{var g=l.uniformValues;g instanceof Float32Array||(g=new Float32Array(g)),r.gl.uniform1fv(h,g)}return}l.texData.slice!=null&&p!=null&&r.gl.uniform1i(p,l.texData.slice.flatOffset),r.setInputMatrixTexture(l.texData.texture.texture,h,c)}});var s=e.outShapeLocation;if(s)switch(n.shape.length){case 1:r.gl.uniform1iv(s,new Int32Array(n.shape));break;case 2:r.gl.uniform2iv(s,new Int32Array(n.shape));break;case 3:r.gl.uniform3iv(s,new Int32Array(n.shape));break;case 4:r.gl.uniform4iv(s,new Int32Array(n.shape));break}if(e.outShapeStridesLocation){var u=S.util.computeStrides(n.shape);switch(n.shape.length){case 2:r.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(u));break;case 3:r.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(u));break;case 4:r.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(u));break}}e.outTexShapeLocation&&r.gl.uniform2i(e.outTexShapeLocation,n.texData.texShape[0],n.texData.texShape[1]),e.program.customUniforms&&a&&e.program.customUniforms.forEach(function(l,c){var f=e.customUniformLocations[c],h=a[c];if(l.type==="float")r.gl.uniform1fv(f,h);else if(l.type==="vec2")r.gl.uniform2fv(f,h);else if(l.type==="vec3")r.gl.uniform3fv(f,h);else if(l.type==="vec4")r.gl.uniform4fv(f,h);else if(l.type==="int")r.gl.uniform1iv(f,h);else if(l.type==="ivec2")r.gl.uniform2iv(f,h);else if(l.type==="ivec3")r.gl.uniform3iv(f,h);else if(l.type==="ivec4")r.gl.uniform4iv(f,h);else throw Error("uniform type "+l.type+" is not supported yet.")}),r.executeProgram()}function m$e(r,e,t){var n="";e.concat(t).forEach(function(o){var s=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(r.enableShapeUniforms&&!o.isUniform){var u=o.texData.texShape,l=Bk(r.packedInputs,o.shape,u),c=l.useSqueezeShape,f=l.uniformShape,h=l.keptDims,p="",d="",m="";if(f.length===1&&r.packedInputs){var v=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];p=(v[0]>1)+"_"+(v[1]>1)}else if(f.length===2&&!r.packedInputs)d=(f[0]>1)+"_"+(f[1]>1);else if(f.length>2&&!r.packedInputs){var g=S.util.computeStrides(f);m=(g[0]===u[1])+"_"+(g[g.length-1]===u[1])}var y=o.shape.length,b=f.length===2&&S.util.arraysEqual(o.shape,u),w=S.util.sizeFromShape(o.shape)===1,x=S.backend_util.getBroadcastDims(o.shape,t.shape),k=!r.packedInputs&&y===t.shape.length&&S.util.arraysEqual(u,t.texData.texShape),N=r.packedInputs||f.length>2?"":(u[0]>1)+"_"+(u[1]>1);n+=y+"_"+k+"_"+(c?h:"")+"_"+f.length+"_"+w+"_"+x+"_"+b+"_"+p+"_"+d+"_"+m+"_"+N+"_"+s}else{var T=o.isUniform?"uniform":o.texData.texShape;n+=o.shape+"_"+T+"_"+s}});var a=r.userCode,i=r.constructor.name;return i+="_"+n+"_"+a+(""+S.env().getNumber("WEBGL_VERSION")),i}function Dn(r){return S.env().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&r<=4}var g$e=function(){function r(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=tp.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var t=_n();this.outputShape=e,this.enableShapeUniforms=Dn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+(this.enableShapeUniforms?bg(["r","c","d"],e):Hu(["r","c","d"],e))+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `}return r}();var y$e=function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=tp.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var t=_n();this.outputShape=e,this.enableShapeUniforms=Dn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+(this.enableShapeUniforms?bg(["r","c","d"],e):Hu(["r","c","d"],e))+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `}return r}();var b$e=function(){function r(e){this.variableNames=["A"],this.outTexUsage=Ra.DOWNLOAD;var t=_n();this.outputShape=e,this.userCode=`
      `+Eq+`

      void main() {
        float x = getAAtOutCoords();
        `+t.output+` = encode_float(x);
      }
    `}return r}();var w$e=function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Ra.DOWNLOAD;var t=_n();this.outputShape=e,this.userCode=`
      `+Eq+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+t.output+` = encode_float(x);
      }
    `}return r}();var x$e=function(){function r(e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=_n();this.outputShape=e,this.enableShapeUniforms=Dn(this.outputShape.length);var a="result";t&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      `+(this.enableShapeUniforms?Mk():Pk(e))+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);

        int r = flatIndex / texShape[1];
        int c = imod(flatIndex, texShape[1]);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
        vec4 values = `+n.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+n.output+" = vec4("+a+`, 0., 0., 0.);
      }
    `}return r}();var k$e=function(){function r(e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=_n();this.outputShape=e,this.enableShapeUniforms=Dn(this.outputShape.length);var a="",i="result";t&&(i="floor(result * 255. + 0.5)");for(var o=0;o<=1;o++)for(var s=0;s<=1;s++){var u=o*2+s;a+=`
          localCoords = coords;
          if(localCoords[2] + `+s+" < "+(this.enableShapeUniforms?"outShape[2]":""+e[2])+`) {
          localCoords[2] += `+s+`;
          if (localCoords[1] + `+o+" < "+(this.enableShapeUniforms?"outShape[1]":""+e[1])+`) {
            localCoords[1] += `+o+`;

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = `+n.texture2D+`(A, uv);

            if (offset == 0) {
              result[`+u+`] = values[0];
            } else if (offset == 1) {
              result[`+u+`] = values[1];
            } else if (offset == 2) {
              result[`+u+`] = values[2];
            } else {
              result[`+u+`] = values[3];
            }
          }
        }
        `}this.userCode=`
        `+(this.enableShapeUniforms?Mk():Pk(e))+`

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          `+a+`

          `+n.output+" = "+i+`;
        }
    `}return r}();function _q(r){var e=_n(),t=e.version+`
    precision highp float;
    `+e.attribute+` vec3 clipSpacePos;
    `+e.attribute+` vec2 uv;
    `+e.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return nq(r,t)}function Dq(r){var e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return sq(r,e)}function Fq(r){var e=new Uint16Array([0,1,2,2,1,3]);return uq(r,e)}function sp(r,e,t,n,a,i){cq(e,t);var o=lq(r),s=r.TEXTURE_2D;return We(r,function(){return r.bindTexture(s,o)}),We(r,function(){return r.texParameteri(s,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE)}),We(r,function(){return r.texParameteri(s,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)}),We(r,function(){return r.texParameteri(s,r.TEXTURE_MIN_FILTER,r.NEAREST)}),We(r,function(){return r.texParameteri(s,r.TEXTURE_MAG_FILTER,r.NEAREST)}),S.env().getNumber("WEBGL_VERSION")===1?We(r,function(){return r.texImage2D(s,0,n,e,t,0,a,i,null)}):We(r,function(){return r.texStorage2D(s,1,n,e,t)}),We(r,function(){return r.bindTexture(r.TEXTURE_2D,null)}),{texture:o,texShape:[t,e]}}function Lk(r){return r.internalFormatFloat}function Rq(r,e,t,n){var a=qe(op(e,t),2),i=a[0],o=a[1];return sp(r,i,o,Lk(n),n.textureFormatFloat,r.FLOAT)}function zk(r){return r.internalFormatHalfFloat}function Oq(r,e,t,n){var a=qe(op(e,t),2),i=a[0],o=a[1];return sp(r,i,o,zk(n),n.textureFormatFloat,n.textureTypeHalfFloat)}function $k(r){return r.downloadTextureFormat}function Pq(r,e,t,n){var a=qe(op(e,t),2),i=a[0],o=a[1];return sp(r,i,o,$k(n),r.RGBA,r.UNSIGNED_BYTE)}function Wk(r){return r.internalFormatPackedFloat}function Mq(r,e,t,n){var a=qe(Nc(e,t),2),i=a[0],o=a[1];return sp(r,i,o,Wk(n),r.RGBA,r.FLOAT)}function qk(r){return r.internalFormatPackedHalfFloat}function Bq(r,e,t,n){var a=qe(Nc(e,t),2),i=a[0],o=a[1];return sp(r,i,o,qk(n),r.RGBA,n.textureTypeHalfFloat)}function Lq(r,e,t){var n=0,a=3*4,i=3*4+2*4;We(r,function(){return r.bindBuffer(r.ARRAY_BUFFER,t)});var o=Tk(r,e,"clipSpacePos",t,3,i,n);return o&&Tk(r,e,"uv",t,2,i,a)}function zq(r,e,t,n,a,i){We(r,function(){return r.bindTexture(r.TEXTURE_2D,e)});var o,s,u;a instanceof Uint8Array?(o=new Uint8Array(t*n*4),s=r.UNSIGNED_BYTE,u=r.RGBA):(o=new Float32Array(t*n*4),s=r.FLOAT,u=i.internalFormatPackedFloat),o.set(a),S.env().getNumber("WEBGL_VERSION")===2?We(r,function(){return r.texSubImage2D(r.TEXTURE_2D,0,0,0,t,n,r.RGBA,s,o)}):We(r,function(){return r.texImage2D(r.TEXTURE_2D,0,u,t,n,0,r.RGBA,s,o)}),We(r,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function $q(r,e,t){We(r,function(){return r.bindTexture(r.TEXTURE_2D,e)}),t.data instanceof Uint8Array?S.env().getNumber("WEBGL_VERSION")===2?We(r,function(){return r.texSubImage2D(r.TEXTURE_2D,0,0,0,t.width,t.height,r.RGBA,r.UNSIGNED_BYTE,t.data)}):We(r,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t.width,t.height,0,r.RGBA,r.UNSIGNED_BYTE,t.data)}):S.env().getNumber("WEBGL_VERSION")===2?We(r,function(){return r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,t)}):We(r,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t)}),We(r,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function Wq(r,e,t,n){var a=r.createBuffer();We(r,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,a)});var i=4,o=4,s=i*o*e*t;return We(r,function(){return r.bufferData(r.PIXEL_PACK_BUFFER,s,r.STREAM_READ)}),We(r,function(){return r.readPixels(0,0,t,e,r.RGBA,r.FLOAT,0)}),We(r,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,null)}),a}function qq(r,e,t){var n=r,a=new Float32Array(t);return n.bindBuffer(n.PIXEL_PACK_BUFFER,e),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,a),n.bindBuffer(n.PIXEL_PACK_BUFFER,null),a}function Vq(r,e,t,n){var a=qe(op(e,t),2),i=a[0],o=a[1],s=4,u=new Uint8Array(gze(e*t,s));return We(r,function(){return r.readPixels(0,0,i,o,n.downloadTextureFormat,r.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function Gq(r,e,t,n,a,i,o,s){var u=r,l=new Float32Array(yze(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function Uq(r,e,t){var n=new Float32Array(e*t*4);return We(r,function(){return r.readPixels(0,0,t,e,r.RGBA,r.FLOAT,n)}),n}var S$e={__proto__:null,createVertexShader:_q,createVertexBuffer:Dq,createIndexBuffer:Fq,getInternalFormatForFloat32MatrixTexture:Lk,createFloat32MatrixTexture:Rq,getInternalFormatForFloat16MatrixTexture:zk,createFloat16MatrixTexture:Oq,getInternalFormatForUnsignedBytesMatrixTexture:$k,createUnsignedBytesMatrixTexture:Pq,getInternalFormatForPackedMatrixTexture:Wk,createPackedMatrixTexture:Mq,getInternalFormatForFloat16PackedMatrixTexture:qk,createFloat16PackedMatrixTexture:Bq,bindVertexProgramAttributeStreams:Lq,uploadDenseMatrixToTexture:zq,uploadPixelDataToTexture:$q,createBufferFromOutputTexture:Wq,downloadFloat32MatrixFromBuffer:qq,downloadByteEncodedFloatMatrixFromOutputTexture:Vq,downloadPackedMatrixFromBuffer:Gq,downloadMatrixFromPackedOutputTexture:Uq},dg=function(){function r(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=S.env().getNumber("WEBGL_VERSION");e!=null?(this.gl=e,eq(t,e)):this.gl=Pi(t);var n="WEBGL_color_buffer_float",a="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),S.env().getNumber("WEBGL_VERSION")===1){var i="OES_texture_float",o="OES_texture_half_float";if(this.textureFloatExtension=Zh(this.gl,i),Oa(this.gl,o))this.textureHalfFloatExtension=Zh(this.gl,o);else if(S.env().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),Oa(this.gl,a))this.colorBufferHalfFloatExtension=Zh(this.gl,a);else if(S.env().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",Oa(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else if(Oa(this.gl,a))this.colorBufferHalfFloatExtension=this.gl.getExtension(a);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=Dq(this.gl),this.indexBuffer=Fq(this.gl),this.framebuffer=fq(this.gl),this.textureConfig=Rk(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(r.prototype,"debug",{get:function(){return S.env().getBool("DEBUG")},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;We(t,function(){return t.finish()}),We(t,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),We(t,function(){return t.deleteFramebuffer(e.framebuffer)}),We(t,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),We(t,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),We(t,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},r.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),Rq(this.gl,e,t,this.textureConfig)},r.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),Oq(this.gl,e,t,this.textureConfig)},r.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),Pq(this.gl,e,t,this.textureConfig)},r.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),$q(this.gl,e,t)},r.prototype.uploadDenseMatrixToTexture=function(e,t,n,a){this.throwIfDisposed(),zq(this.gl,e,t,n,a,this.textureConfig)},r.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Bq(this.gl,e,t,this.textureConfig)},r.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Mq(this.gl,e,t,this.textureConfig)},r.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(Ik(this.gl,this.framebuffer),this.outputTexture=null),We(this.gl,function(){return t.gl.deleteTexture(e)})},r.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var a=this;return this.downloadMatrixDriver(e,function(){return Vq(a.gl,t,n,a.textureConfig)})},r.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,a,i,o){return Gq(this.gl,e,t,n,a,i,o,this.textureConfig)},r.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return qq(this.gl,e,t)},r.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var a=Wq(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),a},r.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},r.prototype.createFence=function(e){var t=this,n,a;if(S.env().getBool("WEBGL_FENCE_API_ENABLED")){var i=e,o=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),a=function(){var s=i.clientWaitSync(o,0,0);return s===i.ALREADY_SIGNALED||s===i.CONDITION_SATISFIED},n=o}else S.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),a=function(){return t.isQueryAvailable(n,S.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):a=function(){return!0};return{query:n,isFencePassed:a}},r.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var a=this;return this.downloadMatrixDriver(e,function(){return Uq(a.gl,t,n)})},r.prototype.createProgram=function(e){var t=this;this.throwIfDisposed();var n=this.gl;this.vertexShader==null&&(this.vertexShader=_q(n));var a=iq(n);return We(n,function(){return n.attachShader(a,t.vertexShader)}),We(n,function(){return n.attachShader(a,e)}),oq(n,a),this.debug&&lg(n,a),this.vertexAttrsAreBound||(this.setProgram(a),this.vertexAttrsAreBound=Lq(n,this.program,this.vertexBuffer)),a},r.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&We(this.gl,function(){return t.gl.deleteProgram(e)})},r.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&lg(this.gl,this.program),We(this.gl,function(){return t.gl.useProgram(e)})},r.prototype.getUniformLocation=function(e,t,n){return n===void 0&&(n=!0),this.throwIfDisposed(),n?pq(this.gl,e,t):dq(this.gl,e,t)},r.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),We(this.gl,function(){return n.gl.getAttribLocation(e,t)})},r.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},r.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),vq(this.gl,e,t,n)},r.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},r.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var a=qe(Nc(t,n),2),i=a[0],o=a[1];this.setOutputMatrixTextureDriver(e,i,o)},r.prototype.setOutputMatrixWriteRegion=function(e,t,n,a){this.setOutputMatrixWriteRegionDriver(n,e,a,t)},r.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,a){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},r.prototype.debugValidate=function(){this.program!=null&&lg(this.gl,this.program),Jh(this.gl)},r.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),We(e,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},r.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),We(this.gl,function(){return e.gl.finish()})},r.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Zh(this.gl,S.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},r.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},r.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},r.prototype.beginQuery=function(){if(S.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var a=this.getQueryTimerExtensionWebGL1(),i=a.createQueryEXT();return a.beginQueryEXT(a.TIME_ELAPSED_EXT,i),i},r.prototype.endQuery=function(){if(S.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2();e.endQuery(t.TIME_ELAPSED_EXT);return}var n=this.getQueryTimerExtensionWebGL1();n.endQueryEXT(n.TIME_ELAPSED_EXT)},r.prototype.waitForQueryAndGetTime=function(e){return xc(this,void 0,void 0,function(){var t=this;return kc(this,function(n){switch(n.label){case 0:return[4,S.util.repeatedTry(function(){return t.disposed||t.isQueryAvailable(e,S.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(e,S.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},r.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var n=this.gl,a=n.getQueryParameter(e,n.QUERY_RESULT);return a/1e6}else{var i=this.getQueryTimerExtensionWebGL1(),a=i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT);return a/1e6}},r.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var n=this.gl,a=this.getQueryTimerExtensionWebGL2(),i=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{var a=this.getQueryTimerExtensionWebGL1(),i=a.getQueryObjectEXT(e,a.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),i&&!this.disjoint}},r.prototype.pollFence=function(e){var t=this;return new Promise(function(n){t.addItemToPoll(function(){return e.isFencePassed()},function(){return n()})})},r.prototype.pollItems=function(){for(var e=N$e(this.itemsToPoll.map(function(a){return a.isDoneFn})),t=0;t<=e;++t){var n=this.itemsToPoll[t].resolveFn;n()}this.itemsToPoll=this.itemsToPoll.slice(e+1)},r.prototype.addItemToPoll=function(e,t){var n=this;if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),!(this.itemsToPoll.length>1)){var a=void 0;"setTimeoutCustom"in S.env().platform&&(a=S.env().platform.setTimeoutCustom.bind(S.env().platform)),S.util.repeatedTry(function(){return n.pollItems(),n.itemsToPoll.length===0},function(){return 0},null,a)}},r.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),cg(this.gl,e,this.framebuffer),this.debug&&Jh(this.gl)},r.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(cg(this.gl,this.outputTexture,this.framebuffer),this.debug&&Jh(this.gl)):Ik(this.gl,this.framebuffer)},r.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},r.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var a=this.gl;cg(a,e,this.framebuffer),this.debug&&Jh(a),this.outputTexture=e,We(a,function(){return a.viewport(0,0,t,n)}),We(a,function(){return a.scissor(0,0,t,n)})},r.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,a){var i=this;this.throwIfDisposed(),We(this.gl,function(){return i.gl.scissor(e,t,n,a)})},r.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},r.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},r}();function N$e(r){for(var e=0;e<r.length;++e){var t=r[e]();if(!t)break}return e-1}function E$e(r){for(var e=new Float32Array(r.length),t=0;t<r.length;++t)e[t]=Math.abs(r[t]);return e}function fi(r){return function(e,t,n,a,i){var o=S.backend_util.assertAndGetBroadcastShape(e,t),s=o.length,u=S.util.computeStrides(o),l=S.util.sizeFromShape(o),c=S.util.getTypedArrayFromDType(i,l),f=e.length,h=t.length,p=S.util.computeStrides(e),d=S.util.computeStrides(t),m=S.backend_util.getBroadcastDims(e,o),v=S.backend_util.getBroadcastDims(t,o);if(m.length+v.length===0)for(var g=0;g<c.length;++g)c[g]=r(n[g%n.length],a[g%a.length]);else for(var y=function(b){var w=S.util.indexToLoc(b,s,u),x=w.slice(-f);m.forEach(function(I){return x[I]=0});var k=S.util.locToIndex(x,f,p),N=w.slice(-h);v.forEach(function(I){return N[I]=0});var T=S.util.locToIndex(N,h,d);c[b]=r(n[k],a[T])},g=0;g<c.length;++g)y(g);return[c,o]}}function T$e(r,e,t,n){if(n==="int32"){var a=Int32Array.from(r);return[e,"int32",a]}if(n==="bool"){var i=S.util.toTypedArray([0],t),o=qe(fi(function(l,c){return l!==c?1:0})(e,[],r,i,"bool"),2),s=o[0],u=o[1];return[u,"bool",s]}throw new Error("Error in Cast: failed to cast "+t+" to "+n)}var I$e=fi(function(r,e){return r+e});function C$e(r,e,t,n,a){for(var i=S.util.sizeFromShape(n),o=S.util.makeZerosTypedArray(a,t),s=0;s<r.length;s++){var u=r[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(i>0?o[u]+=e[s]:o[u]+=1)}return o}function A$e(r,e,t,n){n===void 0&&(n=!1);for(var a=r.shape[0],i=r.shape[1],o=S.buffer([a,t],e.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var l=r.get(s,u);if(l<0)throw new Error("Input x must be non-negative!");l>=t||(n?o.set(1,s,l):e.size>0?o.set(o.get(s,l)+e.get(s,u),s,l):o.set(o.get(s,l)+1,s,l))}return o}function Ns(r){return function(e,t,n){for(var a=S.util.getTypedArrayFromDType(t,e.length),i=0;i<e.length;++i)a[i]=r(e[i],n);return a}}var _$e=Ns(function(r){return Math.ceil(r)});function D$e(r,e,t,n){var a=S.util.getArrayFromDType(t,S.util.sizeFromShape(e));if(n&&t!=="string"){var i=0;r.forEach(function(s){var u=S.util.sizeFromShape(s.shape);a.set(s.vals,i),i+=u})}else{var o=0;r.forEach(function(s){for(var u=t==="string"?S.backend_util.fromUint8ToStringArray(s.vals):s.vals,l=0,c=0;c<s.shape[0];++c)for(var f=c*e[1]+o,h=0;h<s.shape[1];++h)a[f+h]=u[l++];o+=s.shape[1]})}return a}var F$e=fi(function(r,e){return r===e?1:0});var R$e=Ns(function(r){return Math.exp(r)});var O$e=Ns(function(r){return Math.expm1(r)});var P$e=Ns(function(r){return Math.floor(r)});function M$e(r,e,t,n,a,i,o,s,u){for(var l=S.buffer([n,i],t),c=0;c<n;c++){for(var f=[],h=0,p=0;p<a;p++){var d=r[c*a+p];h+=d*o[p],f.push(d)}if(h<0||h>=u/i)throw new Error("Invalid indices: "+f+" does not index into "+s);for(var m=0;m<i;m++)l.values[c*i+m]=e.get.apply(e,Xr(e.indexToLoc(h*i+m)))}return l}function B$e(r,e,t){for(var n=S.buffer(t,r.dtype),a=0;a<n.size;++a){var i=n.indexToLoc(a),o=i.slice(),s=o[0],u=o[2],l=e.locToIndex([s,u]);o[2]=e.values[l];var c=r.locToIndex(o);0<=c&&c<r.values.length&&(n.values[a]=r.values[c])}return n}var L$e=fi(function(r,e){return r>e?1:0});var z$e=fi(function(r,e){return r>=e?1:0});var $$e=fi(function(r,e){return r<e?1:0});var W$e=fi(function(r,e){return r<=e?1:0});function q$e(r,e,t){var n=(e-r)/(t-1),a=S.util.makeZerosTypedArray(t,"float32");a[0]=r;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return a}var V$e=Ns(function(r){return Math.log(r)});function G$e(r,e,t,n){for(var a=S.util.getTypedArrayFromDType(n,S.util.sizeFromShape(t)),i=0;i<a.length;++i){for(var o=i*e,s=r[o],u=0;u<e;++u){var l=r[o+u];(Number.isNaN(l)||l>s)&&(s=l)}a[i]=s}return a}var U$e=fi(function(r,e){return Math.max(r,e)});var H$e=fi(function(r,e){return Math.min(r,e)});var Hq=fi(function(r,e){return r*e});function K$e(r,e,t){var n=S.util.createScalarValue(-1,t);return Hq([],e,n,r,t)}var j$e=fi(function(r,e){return r!==e?1:0});function X$e(r,e,t,n,a){for(var i=e.length,o=S.util.sizeFromShape(e),s=S.util.computeStrides(e),u=S.util.computeStrides(a),l=S.util.getTypedArrayFromDType(t,S.util.sizeFromShape(a)),c=0;c<o;++c){for(var f=S.util.indexToLoc(c,i,s),h=new Array(f.length),p=0;p<h.length;p++)h[p]=f[n[p]];var d=S.util.locToIndex(h,i,u);l[d]=r[c]}return l}function Y$e(r,e,t,n){for(var a=qe(S.backend_util.computeOutAndReduceShapes(r,n),2),i=a[0],o=a[1],s=S.upcastType(e,"int32"),u=S.util.makeZerosTypedArray(S.util.sizeFromShape(i),s),l=S.util.sizeFromShape(o),c=0;c<u.length;++c){for(var f=c*l,h=1,p=0;p<l;++p)h*=t[f+p];u[c]=h}return{outVals:u,outShape:i,outDtype:s}}function Z$e(r,e,t){r.forEach(function(n,a){if(n<0||n>=t){var i=S.util.indexToLoc(a,e.length,S.util.computeStrides(e)).join(",");throw new Error("indices["+i+"] = "+n+" is not in [0, "+t+")")}})}function J$e(r,e){for(var t=0;t<r.length;++t){var n=r[t],a=t===r.length-1?e:r[t+1].length;if(n.length===0)throw new Error("Ragged splits may not be empty");if(n[0]<0)throw new Error("Ragged splits must be non-negative");if(n[n.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<n.length;++i)if(n[i-1]>n[i])throw new Error("Ragged splits must be sorted in ascending order")}}function Q$e(r,e,t,n){var a=[],i=0,o=e.length-1+t.length,s=new Array(o).fill(null).map(function(){return[0]});J$e(t,n);for(var u=1,l=0;l<e.length-1;++l){u*=e[l];for(var c=e[l+1],f=1;f<u+1;++f)s[l].push(f*c)}for(var f=0;f<r.length;++f){for(var h=r[f],p=r[f]+1,l=0;l<t.length;++l){var d=t[l],m=l+e.length-1;if(m>=0)for(var v=s[m],g=v[v.length-1]-d[h],y=h;y<p;++y)s[m].push(d[y+1]+g);h=d[h],p=d[p]}p!==h&&(a.push([h,p]),i+=p-h)}return{outSplits:s,valueSlices:a,numValues:i}}function eWe(r){for(var e=[],t=function(a){var i=r[a].length,o=S.util.getArrayFromDType("int32",i);e.push(o),r[a].forEach(function(s,u){return o[u]=s})},n=0;n<r.length;++n)t(n);return e}function IW(r,e){for(var t=r.slice(0,e);t.length<e;)t.push(1);for(var n=e;n<r.length;n++)t[e-1]*=r[n];return t}function tWe(r,e,t,n,a,i){var o,s,u=IW(e,2)[1],l=IW(i,2)[1],c=0;try{for(var f=ga(t),h=f.next();!h.done;h=f.next())for(var p=h.value,d=p[0];d<p[1];++d){for(var m=0;m<n;++m)a[c*l+m]=r[d*u+m];++c}}catch(v){o={error:v}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}}function rWe(r,e,t,n,a){var i=e.slice();i[0]=a;var o=S.util.getArrayFromDType(t,S.util.sizeFromShape(i)),s=r.length,u=s===0?0:s/e[0];return tWe(r,e,n,u,o,i),[o,i]}function nWe(r,e,t,n,a,i,o,s){if(r.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");var u=e[0][0]-1;if(Z$e(i,o,u),n.length===0)throw new Error("params.rank must be nonzero");var l=n[0],c=Q$e(i,o,r,l),f=c.outSplits,h=c.valueSlices,p=c.numValues,d=eWe(f),m=rWe(t,n,a,h,p);return[d,m[0],m[1]]}var ci=S.backend_util.RowPartitionType,aWe=function(){function r(e,t,n,a,i,o,s,u,l,c){this.shape=e,this.shapeShape=t,this.values=n,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=l,this.rowPartitionTypes=S.backend_util.getRowPartitionTypesHelper(c),this.raggedRank=S.backend_util.getRaggedRank(this.rowPartitionTypes)}return r.prototype.getRowPartitionTypeByDimension=function(e){return this.rowPartitionTypes[0]===ci.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]},r.prototype.getRowPartitionTensor=function(e){return this.rowPartitionTypes[0]===ci.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]},r.prototype.getMaxWidth=function(e){var t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case ci.VALUE_ROWIDS:return r.getMaxWidthValueRowID(t);case ci.ROW_SPLITS:return r.getMaxWidthRowSplit(t);default:throw new Error("Cannot handle partition type "+ci[this.getRowPartitionTypeByDimension(e-1)])}},r.getMaxWidthRowSplit=function(e){var t=e.length;if(t===0||t===1)return 0;for(var n=0,a=0;a<t-1;++a){var i=e[a+1]-e[a];i>n&&(n=i)}return n},r.getMaxWidthValueRowID=function(e){var t=e.length;if(t===0)return 0;for(var n=0,a=e[0],i=0,o=1;o<t;++o){var s=e[o];s!==a&&(a=s,i=Math.max(o-n,i),n=o)}return Math.max(t-n,i)},r.prototype.tensorShapeFromTensor=function(e,t,n){if(n===void 0&&(n=!0),t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return AW(e,n)},r.prototype.calculateOutputSize=function(e){var t=this.valuesShape,n=this.defaultValueShape;S.backend_util.validateDefaultValueShape(n,t);var a=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=S.backend_util.combineRaggedTensorToTensorShapes(this.raggedRank,a,t),o=i;o[0]<0&&(o[0]=e);for(var s=1;s<=this.raggedRank;++s)o[s]<0&&(o[s]=this.getMaxWidth(s));return o},r.prototype.calculateFirstParentOutputIndex=function(e,t,n){for(var a=Math.min(e,n),i=[],o=0,s=0;s<a;++s,o+=t)i.push(o);for(var s=a;s<e;++s)i.push(-1);return S.util.assert(i.length===e,function(){return"Final length of result must be equal to firstDimension."}),i},r.prototype.calculateOutputIndexRowSplit=function(e,t,n,a){for(var i=e.length,o=[],s=0;s<i-1;++s){var u=e[s+1]-e[s],l=Math.min(a,u),c=t[s];c===-1&&(l=0);for(var f=0;f<l;++f)o.push(c),c+=n;for(var f=0;f<u-l;++f)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o},r.prototype.calculateOutputIndexValueRowID=function(e,t,n,a){var i=e.length,o=[];if(i===0)return[];var s=0,u=e[0];if(u>=t.length)throw new Error("Got currentValueRowId="+u+", which is not less than "+t.length);var l=t[u];o.push(l);for(var c=1;c<i;++c){var f=e[c];if(f===u)l>=0&&(++s,s<a?l+=n:l=-1);else{if(s=0,u=f,f>=t.length)throw new Error("Got nextValueRowId="+f+" which is not less than "+t.length);l=t[f]}o.push(l)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o},r.prototype.calculateOutputIndex=function(e,t,n,a){var i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case ci.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,n,a);case ci.ROW_SPLITS:if(i.length-1>t.length)throw new Error("Row partition size is greater than output size: "+(i.length-1)+" > "+t.length);return this.calculateOutputIndexRowSplit(i,t,n,a);default:throw new Error("Unsupported partition type: "+ci[o])}},r.prototype.getFirstDimensionSize=function(){var e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case ci.FIRST_DIM_SIZE:return e[0];case ci.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case ci.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type "+ci[t])}},r.prototype.compute=function(){var e=this.rowPartitionValues[0];if(e.length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var t=this.getFirstDimensionSize(),n=this.calculateOutputSize(t),a=new Array(this.raggedRank+1);a[a.length-1]=1;for(var i=a.length-2;i>=0;--i)a[i]=a[i+1]*n[i+1];var o=AW(n,!1),s=S.util.getArrayFromDType(this.valuesDType,S.util.sizeFromShape(o)),u=a[0]*n[0];if(u>0){for(var l=this.calculateFirstParentOutputIndex(t,a[0],n[0]),i=1;i<=this.raggedRank;++i){var c=this.calculateOutputIndex(i-1,l,a[i],n[i]);l=c}this.setOutput(this.raggedRank,l,s,o)}return[o,s]},r.prototype.setOutput=function(e,t,n,a){if(n.length!==0){var i=this.values,o=n,s=a.slice();s=s.slice(e+1);var u=S.util.sizeFromShape(s),l=t.length,c=this.defaultValue;if(c.length!==u&&c.length!==1){var f=this.defaultValueShape;S.tidy(function(){var x=S.reshape(c,f),k=S.broadcastTo(x,s);c=k.dataSync()})}for(var h=0,p=0,d=0,m=0;m<=l;++m){var v=m<l?t[m]:-1;if(v===d){++d;continue}if(p<d){var g=i.subarray(h*u),y=o.subarray(p*u),b=(d-p)*u;CW(y,g,b)}if(m>=l){var w=n.length;v=Math.floor(w/u)}if(v>d)if(this.defaultValue.length===1)o.subarray(d*u,v*u).fill(this.defaultValue[0]),d=v;else for(;v>d;){var y=o.slice(d*u);CW(y,c,u),++d}v<0?(h=m+1,p=d):(h=m,p=d,d=p+1)}}},r}();function CW(r,e,t){for(var n=0;n<t;n++)r[n]=e[n]}function AW(r,e){var t,n,a=[];try{for(var i=ga(r),o=i.next();!o.done;o=i.next()){var s=o.value;if(s<0){if(!e)throw new Error("Dimension "+s+" must be >= 0");if(s<-1)throw new Error("Dimension "+s+" must be >= -1");s=-1}a.push(s)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a}function iWe(r,e,t,n,a,i,o,s,u,l){return new aWe(r,e,t,n,a,i,o,s,u,l).compute()}function oWe(r,e,t,n){var a=r===e,i=r<e&&t<0,o=e<r&&t>1;if(a||i||o)return S.util.makeZerosTypedArray(0,n);var s=Math.abs(Math.ceil((e-r)/t)),u=S.util.makeZerosTypedArray(s,n);e<r&&t===1&&(t=-1),u[0]=r;for(var l=1;l<u.length;l++)u[l]=u[l-1]+t;return u}var sWe=Ns(function(r){return 1/Math.sqrt(r)});function uWe(r,e,t,n,a,i,o,s,u,l){var c=[n/a,a],f=r.values,h=e.values;if(n===0)return S.buffer(t,e.dtype);var p=S.buffer(c,e.dtype);typeof u=="string"||typeof u=="number"?p.values.fill(u):typeof u=="boolean"&&p.values.fill(+u);for(var d=0;d<i;d++){for(var m=[],v=0,g=0;g<o;g++){var y=f[d*o+g];m.push(y),v+=y*s[g]}if(v<0||v>=n/a)throw new Error("Invalid indices: "+m+" does not index into "+t);for(var b=0;b<a;b++)l?p.values[v*a+b]+=h[d*a+b]:p.values[v*a+b]=e.rank===0?h[0]:h[d*a+b]}return p}var lWe=Ns(function(r){return 1/(1+Math.exp(-r))});function cWe(r,e,t,n,a){var i=S.slice_util.isSliceContinous(n,e,t),o=S.util.sizeFromShape(t),s=S.util.computeStrides(n);if(i){var u=S.slice_util.computeFlatOffset(e,s);return a==="string"?r.slice(u,u+o):r.subarray(u,u+o)}for(var l=a==="string"?S.backend_util.fromUint8ToStringArray(r):r,c=S.buffer(n,a,l),f=S.buffer(t,a),h=0;h<f.size;++h){var p=f.indexToLoc(h),d=p.map(function(m,v){return m+e[v]});f.set.apply(f,Xr([c.get.apply(c,Xr(d))],p))}return a==="string"?S.backend_util.fromStringArrayToUint8(f.values):f.values}function fWe(r,e,t,n,a,i,o){var s=e[0],u=i[0],l=new Array(u),c=new Array(s),f=e[1];if(u===0){if(s!==0)throw new Error(S.backend_util.getSparseFillEmptyRowsIndicesDenseShapeMismatch(s));var h=S.util.getArrayFromDType(t,0),p=S.util.getArrayFromDType(a,0);return[h,[0,f],p,l,c]}for(var d=!0,m=0,v=new Array(u).fill(0),g=0;g<s;++g){var y=r[g*f];if(y<0)throw new Error(S.backend_util.getSparseFillEmptyRowsNegativeIndexErrorMessage(g,y));if(y>=u)throw new Error(S.backend_util.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(g,y,u));++v[y],d=d&&y>=m,m=y}for(var b=!0,y=0;y<u;++y){var w=v[y]===0;l[y]=w,b=b&&!w,v[y]=Math.max(v[y],1),y>0&&(v[y]+=v[y-1])}if(b&&d){for(var h=r,p=n,g=0;g<s;++g)c[g]=g;return[h,[s,f],p,l,c]}else{for(var x=v[u-1],h=S.util.getArrayFromDType(t,x*f),p=S.util.getArrayFromDType(a,x),k=new Array(u).fill(0),g=0;g<s;++g){var y=r[g*f],N=k[y],T=(y===0?0:v[y-1])+N;k[y]++;for(var I=0;I<f;++I)h[T*f+I]=r[g*f+I];p[T]=n[g],c[g]=T}for(var y=0;y<u;++y){var F=k[y];if(F===0){var D=y===0?0:v[y-1];h[D*f+0]=y;for(var R=1;R<f;++R)h[D*f+R]=0;p[D]=o}}return[h,[x,f],p,l,c]}}function hWe(r,e,t,n,a){for(var i=S.util.sizeFromShape(n),o=e[0],s=a.length,u=[],l=1,c=-1,f=0;f<s;++f){var h=a[f];if(h===-1){if(c!==-1)throw new Error(S.backend_util.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(c,f));c=f,u.push(1)}else{if(h<0)throw new Error(S.backend_util.getSparseReshapeNegativeOutputDimErrorMessage(f,h));l*=h,u.push(h)}}if(c!==-1){if(l<=0)throw new Error(S.backend_util.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());var p=Math.trunc(i/l);if(l*p!==i)throw new Error(S.backend_util.getSparseReshapeInputOutputMultipleErrorMessage(n,u));u[c]=p}var d=S.util.sizeFromShape(u);if(d!==i)throw new Error(S.backend_util.getSparseReshapeInputOutputMismatchErrorMessage(n,u));var m=n.length,v=[];if(m>0){v[m-1]=1;for(var f=m-2;f>=0;--f)v[f]=v[f+1]*n[f+1]}var g=[];if(s>0){g[s-1]=1;for(var f=s-2;f>=0;--f)g[f]=g[f+1]*u[f+1]}for(var y=S.util.getArrayFromDType(t,o*s),b=0;b<o;++b){for(var w=0,x=0;x<m;++x)w+=r[b*m+x]*v[x];for(var x=0;x<s;++x)y[b*s+x]=Math.trunc(w/g[x]),w%=g[x]}return[y,[o,s],u]}function pWe(r,e,t,n,a,i,o){i===void 0&&(i=!1),o===void 0&&(o=0);var s=n.length,u=[e[0],r.length/e[0]],l=u[1],c=s>0?a[s-1]+1:0,f=c;if(f<0)throw new Error(S.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var h=e.slice();h[0]=f;var p=h.reduce(function(N,T){return N*T},1),d=S.util.getArrayFromDType(t,p);if(s===0)return f>0&&d.fill(o),[d,h];if(f<=0)throw new Error(S.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());for(var m=0,v=1,g=0,y=a[m];;){var b=0;if(v<s){if(b=a[v],y===b){++v;continue}if(y>=b)throw new Error(S.backend_util.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=f)throw new Error(S.backend_util.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,f));y>g&&d.fill(o,g*l,y*l);for(var w=m;w<v;++w){var x=n[w];if(x<0||x>=u[0])throw new Error(S.backend_util.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(w,n[w],u[0]));for(var k=0;k<l;k++)d[y*l+k]+=r[x*l+k]}if(i)for(var k=0;k<l;k++)d[y*l+k]/=v-m;if(m=v,++v,g=y+1,y=b,v>s)break}return g<f&&d.fill(o,g*l,f*l),[d,h]}var dWe=Ns(function(r){return Math.sqrt(r)});function vWe(r,e,t,n){for(var a=S.buffer(r,e.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*t[u]+n[u];a.set.apply(a,Xr([e.get.apply(e,Xr(s))],o))}return a}var mWe=function(){function r(e,t,n,a,i,o){this.separator=S.util.encodeString(e),this.nGramWidths=t,this.leftPad=S.util.encodeString(n),this.rightPad=S.util.encodeString(a),this.padWidth=i,this.preserveShort=o}return r.prototype.getPadWidth=function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)},r.prototype.getNumNGrams=function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)},r.prototype.createNGrams=function(e,t,n,a,i,o){for(var s=function(c){var f=u.getPadWidth(o),h=Math.max(0,f-c),p=Math.max(0,f-(i-(c+1))),d=o-(h+p),m=t+(h>0?0:c-f),v=0;v+=h*u.leftPad.length;for(var g=0;g<d;++g)v+=e[m+g].length;v+=p*u.rightPad.length;var y=h+p+d-1;v+=y*u.separator.length,n[a+c]=new Uint8Array(v);for(var b=n[a+c],w=0,x=function(k){return k.forEach(function(N){return b[w++]=N})},g=0;g<h;++g)x(u.leftPad),x(u.separator);for(var g=0;g<d-1;++g)x(e[m+g]),x(u.separator);if(d>0){x(e[m+d-1]);for(var g=0;g<p;++g)x(u.separator),x(u.rightPad)}else{for(var g=0;g<p-1;++g)x(u.rightPad),x(u.separator);x(u.rightPad)}},u=this,l=0;l<i;++l)s(l)},r.prototype.compute=function(e,t){var n=this,a=e.length,i=t.length;if(i>0){var o=t[0];if(o!==0)throw new Error("First split value must be 0, got "+o);for(var s=1;s<i;++s){var u=t[s]>=o;if(u=u&&t[s]<=a,!u)throw new Error("Invalid split value "+t[s]+", must be in ["+o+", "+a+"]");o=t[s]}if(o!==a)throw new Error("Last split value must be data size. Expected "+a+", got "+o)}var l=i-1,c=S.util.getArrayFromDType("int32",i);if(a===0||i===0){for(var f=new Array(a),s=0;s<=l;++s)c[s]=0;return[f,c]}c[0]=0;for(var h=function(g){var y=t[g]-t[g-1],b=0;p.nGramWidths.forEach(function(w){b+=n.getNumNGrams(y,w)}),p.preserveShort&&y>0&&b===0&&(b=1),c[g]=c[g-1]+b},p=this,s=1;s<=l;++s)h(s);for(var d=new Array(c[l]),m=function(g){var y=t[g],b=c[g];if(v.nGramWidths.forEach(function(N){var T=t[g+1]-t[g],I=n.getNumNGrams(T,N);n.createNGrams(e,y,d,b,I,N),b+=I}),v.preserveShort&&b===c[g]){var w=t[g+1]-t[g];if(w===0)return"continue";var x=w+2*v.padWidth,k=1;v.createNGrams(e,y,d,b,k,x)}},v=this,s=0;s<l;++s)m(s);return[d,c]},r}();function gWe(r,e,t,n,a,i,o,s){return new mWe(t,n,a,i,o,s).compute(r,e)}function yWe(r,e,t,n){if(!!r.length){if(e.length===0){for(var a=0;a<r.length;++a)n.push(r.subarray(a,a+1));return}if(e.length===1){for(var i=e[0],o=r.indexOf(i);o!==-1;){var s=r.subarray(0,o);(!t||s.length!==0)&&n.push(s),r=r.subarray(o+1),o=r.indexOf(i)}(!t||r.length!==0)&&n.push(r);return}for(var u=0,a=0;a<r.length+1;a++)if(a===r.length||e.indexOf(r[a])!==-1){var s=r.subarray(u,a);(!t||s.length!==0)&&n.push(s),u=a+1}}}function bWe(r,e,t){for(var n=r.length,a=[],i=0,o=0,s=new Array(n),u=0;u<n;++u){var l=a.length;yWe(r[u],e,t,a);var c=a.length-l;s[u]=c,i+=c,o=Math.max(o,c)}for(var f=S.util.getArrayFromDType("int32",i*2),h=new Array(i),p=[n,o],d=0,u=0;u<n;++u)for(var m=0;m<s[u];++m)f[d*2]=u,f[d*2+1]=m,h[d]=a[d],++d;return[f,h,p]}function wWe(r,e){for(var t=S.util.getArrayFromDType("int32",r.length),n=0;n<r.length;++n)t[n]=S.util.fingerPrint64(r[n]).modulo(e).getLowBitsUnsigned();return t}var xWe=fi(function(r,e){return r-e});function kWe(r,e){for(var t=new Array(r.rank),n=0;n<t.length;n++)t[n]=r.shape[n]*e[n];for(var a=S.buffer(t,r.dtype),n=0;n<a.values.length;++n){for(var i=a.indexToLoc(n),o=new Array(r.rank),s=0;s<o.length;s++)o[s]=i[s]%r.shape[s];var u=r.locToIndex(o);a.values[n]=r.values[u]}return a}var Qh=function(r,e){var t=e.value-r.value;return t===0?r.index-e.index:t};function Kq(r,e,t,n){for(t===void 0&&(t=0),n===void 0&&(n=r.length-1);n>t;){if(n-t>600){var a=n-t+1,i=e-t+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2),l=Math.max(t,Math.floor(e-i*s/a+u)),c=Math.min(n,Math.floor(e+(a-i)*s/a+u));Kq(r,e,l,c)}var f=r[e],h=t,p=n;for(S.util.swap(r,t,e),Qh(r[n],f)>0&&S.util.swap(r,t,n);h<p;){for(S.util.swap(r,h,p),h++,p--;Qh(r[h],f)<0;)h=h+1;for(;Qh(r[p],f)>0;)p=p-1}Qh(r[t],f)===0?S.util.swap(r,t,p):(p=p+1,S.util.swap(r,p,n)),p<=e&&(t=p+1),e<=p&&(n=p-1)}}function SWe(r,e,t,n,a){for(var i=e[e.length-1],o=qe([r.length/i,i],2),s=o[0],u=o[1],l=S.util.getTypedArrayFromDType(t,s*n),c=S.util.getTypedArrayFromDType("int32",s*n),f=function(d){var m=d*u,v=r.subarray(m,m+u),g=new Array(v.length);v.forEach(function(k,N){return g[N]={value:k,index:N}}),n<g.length&&(Kq(g,n),g=g.slice(0,n)),a&&g.sort(Qh);for(var y=d*n,b=l.subarray(y,y+n),w=c.subarray(y,y+n),x=0;x<n;x++)b[x]=g[x].value,w[x]=g[x].index},h=0;h<s;h++)f(h);var p=e.slice();return p[p.length-1]=n,[S.buffer(p,t,l),S.buffer(p,"int32",c)]}function NWe(r,e,t,n){for(var a=S.util.parseAxisParam(e,t)[0],i=[1,t[0],1],o=0;o<a;o++)i[0]*=t[o];i[1]=t[a];for(var o=a+1;o<t.length;o++)i[2]*=t[o];for(var s={},u=new Int32Array(t[a]),l=new S.TensorBuffer(i,n,r),c=[],f=i[0]===1&&i[2]===1,o=0;o<t[a];o++){var h=void 0;if(f)h=r[o].toString();else{for(var p=[],d=0;d<i[0];d++)for(var m=0;m<i[2];m++)p.push(l.get(d,o,m));h=p.join(",")}if(s[h]!==void 0)u[o]=s[h];else{var v=Object.keys(s).length;s[h]=v,u[o]=v,c.push(o)}}var g=i.slice();g[1]=Object.keys(s).length;var y=new S.TensorBuffer(g,n);c.forEach(function(w,x){for(var k=0;k<i[0];k++)for(var N=0;N<i[2];N++)y.set(l.get(k,w,N),k,x,N)});var b=t.slice();return b[a]=g[1],{outputValues:y.values,outputShape:b,indices:u}}var EWe=I$e,jq=C$e,TWe=A$e,IWe=T$e,CWe=_$e,AWe=D$e,_We=F$e,DWe=R$e,FWe=O$e,RWe=P$e,OWe=M$e,PWe=B$e,MWe=L$e,BWe=z$e,LWe=$$e,zWe=W$e,$We=q$e,WWe=V$e,qWe=G$e,VWe=U$e,GWe=H$e,UWe=Hq,HWe=K$e,KWe=j$e,jWe=Y$e,XWe=nWe,YWe=iWe,ZWe=oWe,JWe=sWe,QWe=uWe,eqe=lWe,Xq=E$e,tqe=cWe,rqe=fWe,nqe=hWe,Yq=pWe,aqe=dWe,iqe=vWe,oqe=gWe,sqe=bWe,uqe=wWe,lqe=xWe,cqe=kWe,fqe=SWe,Vk=X$e,hqe=NWe;function Zq(r,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return r+"."+t})}function Cn(r,e){return e===1?[r]:Zq(r,e)}function pqe(r,e){if(r===1)return"rc";for(var t="",n=0;n<r;n++)t+=e[n],n<r-1&&(t+=",");return t}var dqe=function(){function r(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=Dn(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=Cn("rc",this.rank),n=er(this.rank),a=this.getOutOfBoundsCondition(t),i=this.getSetup(t),o=this.getOutput(t);this.userCode=`
        void main() {
          `+n+` rc = getOutputCoords();

          if(`+a+`) {
            setOutput(vec4(0));
          } else {
            `+i+`

            setOutput(vec4(`+o+`));
          }
        }
      `}}return r.prototype.getSourceCoordsArr=function(e){for(var t=[],n=0;n<=1;n++)for(var a=0;a<=1;a++){for(var i=(n===0?"r":"rp1")+", "+(a===0?"c":"cp1"),o=2;o<this.rank;o++)i=e[e.length-1-o]+","+i;t.push(i)}return t},r.prototype.getOutOfBoundsCondition=function(e){if(this.rank===1)return"rc > "+(this.enableShapeUniforms?"outShape":this.outputShape[0]);for(var t="",n=this.rank-2;n<this.rank;n++)t+=e[n]+" >= "+(this.enableShapeUniforms?"outShape["+n+"]":this.outputShape[n]),n<this.rank-1&&(t+="||");return t},r.prototype.getSetup=function(e){if(this.rank===1)return"";var t=e.slice(-2),n=this.enableShapeUniforms?"outShape["+this.rank+" - 1]":this.outputShape[this.rank-1],a=this.enableShapeUniforms?"outShape["+this.rank+" - 2]":this.outputShape[this.rank-2];return`
      int r = `+t[0]+`;
      int c = `+t[1]+`;
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= `+n+`;
      bool rEdge = rp1 >= `+a+`;
    `},r.prototype.getOutput=function(e){var t=this.getSourceCoordsArr(e);if(this.rank===1){var n=this.enableShapeUniforms?"outShape":this.outputShape[0];return"getA(rc), (rc + 1 >= "+n+" ? 0. : getA(rc + 1)), 0, 0"}return"getA("+t[0]+`),
            cEdge ? 0. : getA(`+t[1]+`),
            rEdge ? 0. : getA(`+t[2]+`),
            rEdge || cEdge ? 0. : getA(`+t[3]+")"},r}();var Jq=function(){function r(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=Dn(this.outputShape.length);for(var n="",a=0;a<4;a++){var i="thisRC = rc;";a%2===1&&(i+="thisRC.z += 1;"),a>1&&(i+="thisRC.y += 1;"),n+=`
        `+i+`
        `+(a>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+a+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(a>0?"}":"")+`
      `}this.userCode=`
      `+vqe(t,this.enableShapeUniforms)+`
      `+(this.enableShapeUniforms?Mk():Pk(e))+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+(this.enableShapeUniforms?"outShape[1]":e[1])+`;
        int cols = `+(this.enableShapeUniforms?"outShape[2]":e[2])+`;

        `+n+`

        setOutput(result);
      }
    `}return r}();function vqe(r,e){var t=e?Dze(["r","c","d"],"inputShape"):Hu(["r","c","d"],r);return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+t+`
      return ivec3(r, c, d);
    }
  `}var mqe=function(){function r(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return r.prototype.acquireTexture=function(e,t,n){var a=DW(t,n),i=FW(e,a,n);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);var o=_W(e,a,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[i].shift();return this.usedTextures[i].push(s),s}var u;return a===vn.PACKED_2X2_FLOAT32?u=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):a===vn.PACKED_2X2_FLOAT16?u=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):a===vn.UNPACKED_FLOAT32?u=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):a===vn.UNPACKED_FLOAT16?u=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):a===vn.PACKED_4X1_UNSIGNED_BYTE&&(u=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(u),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),u},r.prototype.releaseTexture=function(e,t,n,a){if(this.freeTextures!=null){var i=DW(n,a),o=FW(t,i,a);o in this.freeTextures||(this.freeTextures[o]=[]);var s=_W(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,a),u=S.env().get("WEBGL_DELETE_TEXTURE_THRESHOLD");u!==-1&&this._numBytesAllocated>u?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=s):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=s),this.numUsedTextures--;var l=this.usedTextures[o],c=l.indexOf(e);if(c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");l.splice(c,1),this.log()}},r.prototype.log=function(){if(!!this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")");var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: "+this._numBytesAllocated),console.log("Bytes unused: "+this._numBytesFree+" ("+Math.round(100*t)+"%)")}},Object.defineProperty(r.prototype,"numBytesAllocated",{get:function(){return this._numBytesAllocated},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"numBytesFree",{get:function(){return this._numBytesFree},enumerable:!0,configurable:!0}),r.prototype.getNumUsedTextures=function(){return this.numUsedTextures},r.prototype.getNumFreeTextures=function(){return this.numFreeTextures},r.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(n){e.gpgpu.deleteMatrixTexture(n.texture)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(a){e.gpgpu.deleteMatrixTexture(a.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}},r}();function gqe(r,e){var t=r;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===r.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error("Unknown internal format "+e)}function _W(r,e,t,n,a){var i=yqe(e,n),o;if(a){var s=qe(Nc(r[0],r[1]),2),u=s[0],l=s[1];o=u*l}else{var c=qe(op(r[0],r[1]),2),f=c[0],h=c[1];o=f*h}var p=gqe(t,i);return o*p}function yqe(r,e){switch(r){case vn.PACKED_2X2_FLOAT32:return Wk(e);case vn.PACKED_2X2_FLOAT16:return qk(e);case vn.UNPACKED_FLOAT32:return Lk(e);case vn.UNPACKED_FLOAT16:return zk(e);case vn.PACKED_4X1_UNSIGNED_BYTE:return $k(e);default:throw new Error("Unknown physical texture type "+r)}}function bqe(r){return S.env().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?r?vn.PACKED_2X2_FLOAT32:vn.UNPACKED_FLOAT32:r?vn.PACKED_2X2_FLOAT16:vn.UNPACKED_FLOAT16}function DW(r,e){if(r===Ra.UPLOAD)return vn.PACKED_2X2_FLOAT32;if(r===Ra.RENDER||r==null)return bqe(e);if(r===Ra.DOWNLOAD||r===Ra.PIXELS)return vn.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+r)}function FW(r,e,t){return r[0]+"_"+r[1]+"_"+e+"_"+t}var Co=function(){function r(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=Dn(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        `+t+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}return r}(),hi="if (isnan(x)) return x;",wqe="return x;",RW="return abs(x);",xqe="return (x >= 0.0) ? x : (exp(x) - 1.0);",kqe=hi+`
  return (x < 0.0) ? 0.0 : x;
`,Sqe=hi+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,yc="return x;",Nqe="return 1.0 / (1.0 + exp(-1.0 * x));";var Eqe="return x;",Tqe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Iqe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Cqe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Aqe="return 1.0 / (1.0 + exp(-1.0 * x));",Vu=function(){function r(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=Dn(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+t+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}return r}();var _qe=function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=Dn(this.outputShape.length);var t=e.length,n=Cn("rc",t),a=er(t),i=pqe(t,n),o=n.slice(-2),s=t<=1?"rc":"vec2("+o.join(",")+")";this.userCode=`
      void main() {
        `+a+` rc = getOutputCoords();
        vec4 packedInput = getA(`+i+`);

        setOutput(getChannel(packedInput, `+s+`));
      }
    `}return r}(),Dqe=S.kernel_impls.whereImpl,Fqe=1e-7,Rqe=1e-4,sg={};function Oqe(r){return r in sg||(sg[r]={}),sg[r]}var Pqe=S.env().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),Mqe=600;function Bqe(){return S.env().global.screen==null?1024:S.env().global.screen.height*S.env().global.screen.width*window.devicePixelRatio*Mqe/1024/1024}var Gk=function(r){dze(e,r);function e(t){var n=r.call(this)||this;if(n.pendingRead=new WeakMap,n.pendingDisposal=new WeakSet,n.dataRefCount=new WeakMap,n.numBytesInGPU=0,n.uploadWaitMs=0,n.downloadWaitMs=0,n.lastGlFlushTime=0,n.warnedAboutMemory=!1,n.pendingDeletes=0,n.disposed=!1,!S.env().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");var a;if(t!=null){if(t instanceof dg)a=t;else{var i=Pi(S.env().getNumber("WEBGL_VERSION"),t);a=new dg(i)}n.binaryCache={},n.gpgpuCreatedLocally=!1}else{var i=Pi(S.env().getNumber("WEBGL_VERSION"));a=new dg(i),n.binaryCache=Oqe(S.env().getNumber("WEBGL_VERSION")),n.gpgpuCreatedLocally=!0}return n.gpgpu=a,n.canvas=n.gpgpu.gl.canvas,n.textureManager=new mqe(n.gpgpu),n.numMBBeforeWarning=Bqe(),n.texData=new S.DataStorage(n,S.engine()),n}return e.prototype.nextDataId=function(){return e.nextDataId++},e.prototype.numDataIds=function(){return this.texData.numDataIds()-this.pendingDeletes},e.prototype.write=function(t,n,a){if((S.env().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||S.env().getBool("DEBUG"))&&this.checkNumericalProblems(t),a==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var i={id:this.nextDataId()};return this.texData.set(i,{shape:n,dtype:a,values:t,usage:Ra.UPLOAD,refCount:1}),i},e.prototype.refCount=function(t){if(this.texData.has(t)){var n=this.texData.get(t);return n.refCount}return 0},e.prototype.incRef=function(t){var n=this.texData.get(t);n.refCount++},e.prototype.decRef=function(t){if(this.texData.has(t)){var n=this.texData.get(t);n.refCount--}},e.prototype.move=function(t,n,a,i,o){if(S.env().getBool("DEBUG")&&this.checkNumericalProblems(n),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:a,dtype:i,values:n,usage:Ra.UPLOAD,refCount:o})},e.prototype.disposeIntermediateTensorInfo=function(t){this.disposeData(t.dataId)},e.prototype.readSync=function(t){var n=this.texData.get(t),a=n.values,i=n.dtype,o=n.complexTensorInfos,s=n.slice,u=n.shape,l=n.isPacked;if(s!=null){var c=void 0;l?c=new Vu(u,yc):c=new Co(u,yc);var f=this.runWebGLProgram(c,[{dataId:t,shape:u,dtype:i}],i),h=this.readSync(f.dataId);return this.disposeIntermediateTensorInfo(f),h}if(a!=null)return this.convertAndCacheOnCPU(t);if(i==="string")return a;var p=this.activeTimers!=null,d;p&&(d=S.util.now());var m;if(i==="complex64"){var v=this.readSync(o.real.dataId),g=this.readSync(o.imag.dataId);m=S.backend_util.mergeRealAndImagArrays(v,g)}else m=this.getValuesFromTexture(t);return p&&(this.downloadWaitMs+=S.util.now()-d),this.convertAndCacheOnCPU(t,m)},e.prototype.read=function(t){return xc(this,void 0,void 0,function(){var n,a,i,o,s,u,l,c,f,h,p,d,m,v,g,y,b,w,x,k,N,T,I;return kc(this,function(F){switch(F.label){case 0:if(this.pendingRead.has(t))return n=this.pendingRead.get(t),[2,new Promise(function(D){return n.push(D)})];if(a=this.texData.get(t),i=a.values,o=a.shape,s=a.slice,u=a.dtype,l=a.complexTensorInfos,c=a.isPacked,s!=null)return f=void 0,c?f=new Vu(o,yc):f=new Co(o,yc),h=this.runWebGLProgram(f,[{dataId:t,shape:o,dtype:u}],u),p=this.read(h.dataId),this.disposeIntermediateTensorInfo(h),[2,p];if(i!=null)return[2,this.convertAndCacheOnCPU(t)];if(S.env().getBool("DEBUG")&&!S.env().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&S.env().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return d=null,u!=="complex64"&&S.env().get("WEBGL_BUFFER_SUPPORTED")&&(m=this.decode(t),v=this.texData.get(m.dataId),d=(I=this.gpgpu).createBufferFromTexture.apply(I,Xr([v.texture.texture],ig(o)))),this.pendingRead.set(t,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:F.sent(),F.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([this.read(l.real.dataId),this.read(l.imag.dataId)])];case 3:return y=F.sent(),b=y[0],w=y[1],g=S.backend_util.mergeRealAndImagArrays(b,w),[3,5];case 4:d==null?g=this.getValuesFromTexture(t):(x=S.util.sizeFromShape(o),g=this.gpgpu.downloadFloat32MatrixFromBuffer(d,x)),F.label=5;case 5:return m!=null&&this.disposeIntermediateTensorInfo(m),d!=null&&(k=this.gpgpu.gl,We(k,function(){return k.deleteBuffer(d)})),N=this.convertAndCacheOnCPU(t,g),T=this.pendingRead.get(t),this.pendingRead.delete(t),T.forEach(function(D){return D(N)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&S.engine().removeDataId(t,this),this.pendingDeletes--),[2,N]}})})},e.prototype.readToGPU=function(t,n){n===void 0&&(n={});var a=this.texData.get(t),i=a.values,o=a.shape,s=a.slice,u=a.dtype,l=a.isPacked,c=a.texture;if(u==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(s!=null){var f=void 0;l?f=new Vu(o,yc):f=new Co(o,yc);var h=this.runWebGLProgram(f,[{dataId:t,shape:o,dtype:u}],u),p=this.readToGPU(h,n);return this.disposeIntermediateTensorInfo(h),p}if(c==null)throw i!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");var d=this.decode(t,n.customTexShape),m=S.engine().makeTensorFromTensorInfo(d),v=this.texData.get(d.dataId);return Object.assign({tensorRef:m},v.texture)},e.prototype.bufferSync=function(t){var n=this.readSync(t.dataId);if(t.dtype==="string")try{var a=n.map(function(i){return S.util.decodeString(i)});return S.buffer(t.shape,t.dtype,a)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return S.buffer(t.shape,t.dtype,n)},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var n=0;n<t.length;n++){var a=t[n];if(!tq(a))throw S.env().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+a+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+a+" cannot be represented on this device.")}},e.prototype.getValuesFromTexture=function(t){var n,a=this.texData.get(t),i=a.shape,o=a.dtype,s=a.isPacked,u=S.util.sizeFromShape(i);if(S.env().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var l=this.decode(t),c=this.texData.get(l.dataId),f=(n=this.gpgpu).downloadMatrixFromPackedTexture.apply(n,Xr([c.texture.texture],ig(i))).subarray(0,u);return this.disposeIntermediateTensorInfo(l),f}var h=S.env().getBool("WEBGL_PACK")&&s===!0,p=h?fg(i):i,d=h?new w$e(p):new b$e(p),m=this.runWebGLProgram(d,[{shape:p,dtype:o,dataId:t}],"float32"),v=this.texData.get(m.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(v.texture.texture,v.texShape[0],v.texShape[1]).subarray(0,u);return this.disposeIntermediateTensorInfo(m),g},e.prototype.timerAvailable=function(){return S.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0},e.prototype.time=function(t){var n=this,a=this.activeTimers,i=[],o=!1;this.programTimersStack==null?(this.programTimersStack=i,o=!0):this.activeTimers.push(i),this.activeTimers=i,t();var s=S.util.flatten(this.activeTimers.map(function(c){return c.query})).filter(function(c){return c!=null}),u=S.util.flatten(this.activeTimers.map(function(c){return c.name})).filter(function(c){return c!=null});this.activeTimers=a,o&&(this.programTimersStack=null);var l={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return function(){return xc(n,void 0,void 0,function(){var c;return kc(this,function(f){switch(f.label){case 0:return S.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(s)]:[3,2];case 1:return c=f.sent(),l.kernelMs=S.util.sum(c),l.getExtraProfileInfo=function(){return c.map(function(h,p){return{name:u[p],ms:h}}).map(function(h){return h.name+": "+h.ms}).join(", ")},[3,3];case 2:l.kernelMs={error:"WebGL query timers are not supported in this environment."},f.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,l]}})})}()},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}},e.prototype.startTimer=function(){return S.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:S.util.now(),endMs:null}},e.prototype.endTimer=function(t){return S.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=S.util.now(),t)},e.prototype.getQueryTime=function(t){return xc(this,void 0,void 0,function(){var n;return kc(this,function(a){return S.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:(n=t,[2,n.endMs-n.startMs])})})},e.prototype.disposeData=function(t,n){if(n===void 0&&(n=!1),this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(n?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!n&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);var a=this.texData.get(t).complexTensorInfos;return a!=null&&(this.disposeData(a.real.dataId,n),this.disposeData(a.imag.dataId,n)),this.texData.delete(t),!0},e.prototype.releaseGPUData=function(t){var n=this.texData.get(t),a=n.texture,i=n.dtype,o=n.texShape,s=n.usage,u=n.isPacked,l=n.slice,c=l&&l.origDataId||t,f=this.dataRefCount.get(c);f>1?this.dataRefCount.set(c,f-1):(this.dataRefCount.delete(c),a!=null&&(this.numBytesInGPU-=this.computeBytes(o,i),this.textureManager.releaseTexture(a,o,s,u)));var h=this.texData.get(t);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.shouldExecuteOnCPU=function(t,n){var a=this;return n===void 0&&(n=Pqe),S.env().getBool("WEBGL_CPU_FORWARD")&&t.every(function(i){return a.texData.get(i.dataId).texture==null&&S.util.sizeFromShape(i.shape)<n})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.where=function(t){S.backend_util.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var n=t.dataSync();return Dqe(t.shape,n)},e.prototype.packedUnaryOp=function(t,n,a){var i=new Vu(t.shape,n),o=this.compileAndRun(i,[t],a);return S.engine().makeTensorFromTensorInfo(o)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t])&&t.dtype!=="complex64"){var n=Xq(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,n)}if(S.env().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,RW,t.dtype);var a=new Co(t.shape,RW),i=this.compileAndRun(a,[t]);return S.engine().makeTensorFromTensorInfo(i)},e.prototype.makeTensorInfo=function(t,n,a){var i;if(n==="string"&&a!=null&&a.length>0&&S.util.isString(a[0])){var o=a.map(function(s){return S.util.encodeString(s)});i=this.write(o,t,n)}else i=this.write(a,t,n);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:n}},e.prototype.makeOutput=function(t,n,a){return S.engine().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,a),this)},e.prototype.unpackTensor=function(t){var n=new _qe(t.shape);return this.runWebGLProgram(n,[t],t.dtype)},e.prototype.packTensor=function(t){var n=new dqe(t.shape),a=!0;return this.runWebGLProgram(n,[t],t.dtype,null,a)},e.prototype.packedReshape=function(t,n){var a=Xr([Gu(t.shape)],Uu(t.shape)),i={dtype:t.dtype,shape:a,dataId:t.dataId},o=Xr([Gu(n)],Uu(n)),s=new Jq(o,a),u=!0,l=[a],c=this.runWebGLProgram(s,[i],t.dtype,l,u);return{dataId:c.dataId,shape:n,dtype:c.dtype}},e.prototype.decode=function(t,n){var a=this.texData.get(t),i=a.isPacked,o=a.shape,s=a.dtype;if(n!=null){var u=S.util.sizeFromShape(o),l=n[0]*n[1]*4;S.util.assert(u<=l,function(){return"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."})}var c=fg(o),f;i?f=new y$e(c):f=new g$e(c);var h=!0,p=[n??ig(c)],d=this.runWebGLProgram(f,[{shape:c,dtype:s,dataId:t}],s,p,h,n);return{dtype:s,shape:o,dataId:d.dataId}},e.prototype.runWebGLProgram=function(t,n,a,i,o,s){var u=this;o===void 0&&(o=!1);var l=this.makeTensorInfo(t.outputShape,a),c=this.texData.get(l.dataId);if(t.packedOutput&&(c.isPacked=!0),t.outPackingScheme===tp.DENSE){var f=s??ig(t.outputShape);c.texShape=f.map(function(k){return k*2})}if(t.outTexUsage!=null&&(c.usage=t.outTexUsage),S.util.sizeFromShape(l.shape)===0)return c.values=S.util.getTypedArrayFromDType(l.dtype,0),l;var h=[],p=n.map(function(k){if(k.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var N=u.texData.get(k.dataId);if(N.texture==null){if(!t.packedInputs&&S.util.sizeFromShape(k.shape)<=S.env().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:k.shape,texData:null,isUniform:!0,uniformValues:N.values};t.packedInputs&&(N.isPacked=!0,N.shape=k.shape)}if(u.uploadToGPU(k.dataId),!!N.isPacked!=!!t.packedInputs)k=N.isPacked?u.unpackTensor(k):u.packTensor(k),h.push(k),N=u.texData.get(k.dataId);else if(N.isPacked&&!rp(N.shape,k.shape)){var T=k,I=k.shape;k.shape=N.shape,k=u.packedReshape(k,I),h.push(k),N=u.texData.get(k.dataId),T.shape=I}return{shape:k.shape,texData:N,isUniform:!1}});this.uploadToGPU(l.dataId);var d={shape:l.shape,texData:c,isUniform:!1},m=m$e(t,p,d),v=this.getAndSaveBinary(m,function(){return d$e(u.gpgpu,t,p,d)}),g=this.activeTimers!=null,y;g&&(y=this.startTimer()),S.env().get("ENGINE_COMPILE_ONLY")||v$e(this.gpgpu,v,p,d,i),h.forEach(function(k){return u.disposeIntermediateTensorInfo(k)}),g&&(y=this.endTimer(y),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(y)}));var b=S.env().get("WEBGL_FLUSH_THRESHOLD");if(b>0){var w=S.util.now();w-this.lastGlFlushTime>b&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=w)}if(!S.env().getBool("WEBGL_LAZILY_UNPACK")&&c.isPacked&&o===!1){var x=this.unpackTensor(l);return this.disposeIntermediateTensorInfo(l),x}return l},e.prototype.compileAndRun=function(t,n,a,i,o){o===void 0&&(o=!1),a=a||n[0].dtype;var s=this.runWebGLProgram(t,n,a,i,o);return s},e.prototype.getAndSaveBinary=function(t,n){return t in this.binaryCache||(this.binaryCache[t]=n()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;if(!this.disposed){if(!S.env().getBool("IS_TEST")){var n=Object.keys(this.binaryCache);n.forEach(function(a){t.gpgpu.deleteProgram(t.binaryCache[a].webGLProgram),delete t.binaryCache[a]})}this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=S.tidy(function(){if(!S.env().get("WEBGL_RENDER_FLOAT32_ENABLED")){var n=S.env().getBool("DEBUG");S.env().set("DEBUG",!1);var a=t.abs(S.scalar(1e-8)).dataSync()[0];if(S.env().set("DEBUG",n),a>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?Fqe:Rqe},e.prototype.uploadToGPU=function(t){var n,a=this.texData.get(t),i=a.shape,o=a.dtype,s=a.values,u=a.texture,l=a.usage,c=a.isPacked;if(u==null){var f=this.activeTimers!=null,h;f&&(h=S.util.now());var p=a.texShape;if(p==null&&(p=yq(i,c),a.texShape=p),s!=null){var d=fg(i),m=void 0,v=p[1],g=p[0],y=s instanceof Uint8Array||s instanceof Uint8ClampedArray;(c||!y)&&(n=qe(Nc(p[0],p[1]),2),v=n[0],g=n[1]),c?m=new k$e(d,y):m=new x$e(d,y);var b=y?[g,v]:p,w=this.makeTensorInfo(b,o),x=this.texData.get(w.dataId);y?x.usage=Ra.PIXELS:x.usage=Ra.UPLOAD,x.texShape=b,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(w.dataId),v,g,s);var k=[[g,v]],N=!0,T=this.runWebGLProgram(m,[w],o,k,N),I=this.texData.get(T.dataId);a.texShape=I.texShape,a.isPacked=I.isPacked,a.usage=I.usage,S.env().get("ENGINE_COMPILE_ONLY")?this.disposeData(T.dataId):(a.texture=I.texture,a.values=null,this.texData.delete(T.dataId)),this.disposeIntermediateTensorInfo(w),f&&(this.uploadWaitMs+=S.util.now()-h)}else{var F=this.acquireTexture(p,l,o,c);a.texture=F}}},e.prototype.convertAndCacheOnCPU=function(t,n){var a=this.texData.get(t),i=a.dtype;return this.releaseGPUData(t),n!=null&&(a.values=Lqe(n,i)),a.values},e.prototype.acquireTexture=function(t,n,a,i){if(this.numBytesInGPU+=this.computeBytes(t,a),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,n,i)},e.prototype.computeBytes=function(t,n){return t[0]*t[1]*S.util.bytesPerElement(n)},e.prototype.checkCompileCompletion=function(){var t,n;try{for(var a=ga(Object.entries(this.binaryCache)),i=a.next();!i.done;i=a.next()){var o=qe(i.value,2),s=o[1];this.checkCompletion_(s)}}catch(u){t={error:u}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},e.prototype.checkCompileCompletionAsync=function(){return xc(this,void 0,void 0,function(){var t,n,a,i,c,o,s,u,l,c,f,h,p,d,m=this;return kc(this,function(v){if(t=[],this.gpgpu.parallelCompilationExtension){try{for(n=ga(Object.entries(this.binaryCache)),a=n.next();!a.done;a=n.next())i=qe(a.value,2),c=i[1],t.push(this.checkCompletionAsync_(c))}catch(g){f={error:g}}finally{try{a&&!a.done&&(h=n.return)&&h.call(n)}finally{if(f)throw f.error}}return[2,Promise.all(t)]}else{o=function(g){var y=new Promise(function(b){try{m.checkCompletion_(g),b(!0)}catch(w){throw w}});t.push(y)};try{for(s=ga(Object.entries(this.binaryCache)),u=s.next();!u.done;u=s.next())l=qe(u.value,2),c=l[1],o(c)}catch(g){p={error:g}}finally{try{u&&!u.done&&(d=s.return)&&d.call(s)}finally{if(p)throw p.error}}return[2,Promise.all(t)]}})})},e.prototype.checkCompletionAsync_=function(t){return xc(this,void 0,void 0,function(){return kc(this,function(n){switch(n.label){case 0:return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?[2,this.checkCompletion_(t)]:[3,1];case 1:return[4,S.nextFrame()];case 2:return n.sent(),[2,this.checkCompletionAsync_(t)]}})})},e.prototype.checkCompletion_=function(t){if(this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(Ok(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0},e.prototype.getUniformLocations=function(){var t,n;try{for(var a=ga(Object.entries(this.binaryCache)),i=a.next();!i.done;i=a.next()){var o=qe(i.value,2),s=o[1],u=Aq(this.gpgpu,s.program,s.webGLProgram),l=u.uniformLocations,c=u.customUniformLocations,f=u.infLoc,h=u.nanLoc,p=u.inShapesLocations,d=u.inTexShapesLocations,m=u.outShapeLocation,v=u.outShapeStridesLocation,g=u.outTexShapeLocation;s.uniformLocations=l,s.customUniformLocations=c,s.infLoc=f,s.nanLoc=h,s.inShapesLocations=p,s.inTexShapesLocations=d,s.outShapeLocation=m,s.outShapeStridesLocation=v,s.outTexShapeLocation=g}}catch(y){t={error:y}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},e}(S.KernelBackend);Gk.nextDataId=0;function Lqe(r,e){if(e==="float32"||e==="complex64")return r;if(e==="int32"||e==="bool"){for(var t=e==="int32"?new Int32Array(r.length):new Uint8Array(r.length),n=0;n<t.length;++n)t[n]=Math.round(r[n]);return t}else throw new Error("Unknown dtype "+e)}var zqe="3.21.0";function Qq(){S.env().set("WEBGL_FORCE_F16_TEXTURES",!0)}S.device_util.isBrowser()&&S.registerBackend("webgl",function(){return new Gk},2);var $qe={forceHalfFloat:Qq};var Uk=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`,Sc=function(){function r(e,t,n){this.variableNames=["A","B"],this.outputShape=S.backend_util.assertAndGetBroadcastShape(t,n),this.enableShapeUniforms=Dn(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        `+e+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}return r}();var up=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`,lp=function(){function r(e,t,n,a){a===void 0&&(a=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=S.backend_util.assertAndGetBroadcastShape(t,n);var i=this.outputShape.length;this.enableShapeUniforms=Dn(i);var o="";if(a)if(i===0||S.util.sizeFromShape(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else{var s=er(i);if(o=`
          `+s+` coords = getOutputCoords();
        `,i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var u=Cn("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (`+u[i-2]+" + 1) >= outShape["+i+` - 2];
            bool nextColOutOfBounds =
              (`+u[i-1]+" + 1) >= outShape["+i+` - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:o+=`
            bool nextRowOutOfBounds =
              (`+u[i-2]+" + 1) >= "+this.outputShape[i-2]+`;
            bool nextColOutOfBounds =
              (`+u[i-1]+" + 1) >= "+this.outputShape[i-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+e+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+o+`

        setOutput(result);
      }
    `}return r}();function ya(r){var e=r.inputs,t=r.backend,n=e.x;return t.incRef(n.dataId),{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}var Wqe={kernelName:S.Identity,backendName:"webgl",kernelFunc:ya};function Es(r){var e=r.inputs,t=r.backend,n=e.real,a=e.imag,i=t.makeTensorInfo(n.shape,"complex64"),o=t.texData.get(i.dataId),s=ya({inputs:{x:n},backend:t}),u=ya({inputs:{x:a},backend:t});return o.complexTensorInfos={real:s,imag:u},i}var qqe={kernelName:S.Complex,backendName:"webgl",kernelFunc:Es};var eV="return (a < 0.) ? b * a : a;",tV=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Vqe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.alpha,o=t.makeTensorInfo([],"float32",S.util.createScalarValue(i,"float32")),s=S.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new lp(tV,a.shape,o.shape):new Sc(eV,a.shape,o.shape),u=t.runWebGLProgram(s,[a,o],"float32");return t.disposeIntermediateTensorInfo(o),u}var Gqe={kernelName:S.LeakyRelu,backendName:"webgl",kernelFunc:Vqe};var rV="return (a < 0.) ? b * a : a;",nV=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Uqe(r){var e=r.inputs,t=r.backend,n=e.x,a=e.alpha,i=S.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new lp(nV,n.shape,a.shape):new Sc(rV,n.shape,a.shape);return t.runWebGLProgram(i,[n,a],"float32")}var Hqe={kernelName:S.Prelu,backendName:"webgl",kernelFunc:Uqe},_c="if (isnan(x)) return x;";function Ft(r){var e=r.opSnippet,t=r.packedOpSnippet,n=r.cpuKernelImpl,a=r.dtype;return function(i){var o=i.inputs,s=i.backend,u=o.x,l=s,c=a||u.dtype;if(l.shouldExecuteOnCPU([u])&&n!=null){var f=l.texData.get(u.dataId),h=n(f.values,c);return l.makeTensorInfo(u.shape,c,h)}var p=S.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null,d;return p?d=new Vu(u.shape,t):d=new Co(u.shape,e),l.runWebGLProgram(d,[u],c)}}function mn(r){var e=r.opSnippet,t=r.packedOpSnippet,n=r.checkOutOfBounds,a=n===void 0?!1:n,i=r.supportsComplex,o=i===void 0?!1:i,s=r.cpuKernelImpl,u=r.dtype;return function(l){var c=l.inputs,f=l.backend,h=c.a,p=c.b,d=f;if(o&&h.dtype==="complex64"){var m=d.texData.get(h.dataId),v=d.texData.get(p.dataId),g=qe([[m.complexTensorInfos.real,v.complexTensorInfos.real],[m.complexTensorInfos.imag,v.complexTensorInfos.imag]].map(function(V){var K=qe(V,2),Z=K[0],j=K[1],ee={dataId:Z.dataId,dtype:Z.dtype,shape:h.shape},le={dataId:j.dataId,dtype:j.dtype,shape:p.shape},se=new Sc(e,h.shape,p.shape);return d.runWebGLProgram(se,[ee,le],S.upcastType(Z.dtype,j.dtype))}),2),y=g[0],b=g[1],w=Es({inputs:{real:y,imag:b},backend:d});return d.disposeIntermediateTensorInfo(y),d.disposeIntermediateTensorInfo(b),w}var x=u||S.upcastType(h.dtype,p.dtype);if((h.dtype==="string"||p.dtype==="string"||d.shouldExecuteOnCPU([h,p]))&&s!=null){var k=d.texData.get(h.dataId).values,N=d.texData.get(p.dataId).values,T=h.dtype==="string"?S.backend_util.fromUint8ToStringArray(k):k,I=h.dtype==="string"?S.backend_util.fromUint8ToStringArray(N):N,F=qe(s(h.shape,p.shape,T,I,x),2),D=F[0],R=F[1],P=d.makeTensorInfo(R,x),B=d.texData.get(P.dataId);return B.values=D,P}var q=S.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null,O;return q?O=new lp(t,h.shape,p.shape,a):O=new Sc(e,h.shape,p.shape),d.runWebGLProgram(O,[h,p],x)}}function np(r,e){if(e===void 0&&(e=!1),r==="linear")return e?Eqe:wqe;if(r==="relu")return e?Iqe:kqe;if(r==="elu")return e?Tqe:xqe;if(r==="relu6")return e?Cqe:Sqe;if(r==="prelu")return e?nV:rV;if(r==="leakyrelu")return e?tV:eV;if(r==="sigmoid")return e?Aqe:Nqe;throw new Error("Activation "+r+" has not been implemented for the WebGL backend.")}var aV=function(){function r(e,t,n,a,i,o,s,u,l){a===void 0&&(a=!1),i===void 0&&(i=!1),o===void 0&&(o=!1),s===void 0&&(s=null),u===void 0&&(u=!1),l===void 0&&(l=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=Dn(this.outputShape.length);var c=a?e[1]:e[2],f=Math.ceil(c/2),h=a?"i * 2, rc.y":"rc.y, i * 2",p=i?"rc.z, i * 2":"i * 2, rc.z",d=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],v="",g="";s&&(u?v=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+s+`
        }`:l?v=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          `+s+`
        }`:v=`vec4 activation(vec4 x) {
          `+s+`
        }`,g="result = activation(result);");var y=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),l&&this.variableNames.push("leakyreluAlpha");var b="rc.x",w="rc.x";e[0]<t[0]?b="int(min(float(rc.x), "+(e[0]-1)+".))":t[0]<e[0]&&(w="int(min(float(rc.x), "+(t[0]-1)+".))"),this.userCode=`
      `+v+`
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = `+f+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+f+`; i++) {
          int batchA = `+b+`;
          int batchB = `+w+`;
          vec4 a = getMatrixA(batchA, `+h+`);
          vec4 b = getMatrixB(batchB, `+p+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+d[0]+" * "+m[0]+`);
          result += (`+d[1]+" * "+m[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+y+`

        `+g+`

        setOutput(result);
      }
    `}return r}();var OW={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},PW=function(){function r(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=S.backend_util.assertAndGetBroadcastShape(t,n),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+e+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}return r}(),MW="return a * b;";function Hk(r){var e=r.inputs,t=r.backend,n=e.a,a=e.b,i=S.backend_util.upcastType(n.dtype,a.dtype);if(n.dtype==="complex64"){var o=t.texData.get(n.dataId),s=t.texData.get(a.dataId),u=new PW(OW.REAL,n.shape,a.shape),l=new PW(OW.IMAG,n.shape,a.shape),c=[{dataId:o.complexTensorInfos.real.dataId,dtype:o.complexTensorInfos.real.dtype,shape:n.shape},{dataId:o.complexTensorInfos.imag.dataId,dtype:o.complexTensorInfos.imag.dtype,shape:n.shape},{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:a.shape},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:a.shape}],f=t.runWebGLProgram(u,c,"float32"),h=t.runWebGLProgram(l,c,"float32"),p=Es({inputs:{real:f,imag:h},backend:t});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),p}if(t.shouldExecuteOnCPU([n,a])){var o=t.texData.get(n.dataId),s=t.texData.get(a.dataId),d=qe(UWe(n.shape,a.shape,o.values,s.values,i),2),m=d[0],v=d[1],g=t.makeTensorInfo(v,i),y=t.texData.get(g.dataId);return y.values=m,g}var b;return S.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?b=new lp(MW,n.shape,a.shape):b=new Sc(MW,n.shape,a.shape),t.runWebGLProgram(b,[n,a],i)}var Kqe={kernelName:S.Multiply,backendName:"webgl",kernelFunc:Hk};function jqe(r,e,t){var n=Xr([Gu(r.shape)],Uu(r.shape)),a={dtype:r.dtype,shape:n,dataId:r.dataId},i=Xr([Gu(e)],Uu(e)),o=new Jq(i,n),s=!0,u=[n],l=t.runWebGLProgram(o,[a],r.dtype,u,s);return{dataId:l.dataId,shape:e,dtype:l.dtype}}function Oe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.shape,o=t,s=S.util.sizeFromShape(a.shape),u=S.util.inferFromImplicitShape(i,s),l=S.util.sizeFromShape(u);S.util.assert(s===l,function(){return"The new shape ("+u+") has "+l+" elements and the old "+("shape ("+a.shape+") has "+s+" elements. The new shape and old ")+"shape must have the same number of elements."});var c=o.texData.get(a.dataId);return c.isPacked&&!rp(a.shape,u)&&!(c.texture!==null&&rp(c.shape,u))?jqe(a,u,o):(o.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype})}var Xqe={kernelName:S.Reshape,backendName:"webgl",kernelFunc:Oe};var BW=function(){function r(e,t){this.variableNames=["x"];var n=e.windowSize,a=e.batchSize,i=e.inSize,o=e.outSize;this.outputShape=[a,o];var s=Math.floor(n/4)*4,u=n%4,l="sumValue += dot(values, ones);";if(t!=null){var c=1/t;l="sumValue += dot(values * "+(S.util.isInt(c)?c.toPrecision(2):c)+", ones);"}var f="";i%n>0&&(f=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+f+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+n+`;

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+l+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          `+l+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          `+l+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          `+l+`
        }
        setOutput(sumValue);
      }
    `}return r}();var Yqe=function(){function r(e,t){this.variableNames=["x"];var n=e.windowSize,a=e.batchSize,i=e.inSize,o=e.outSize;this.outputShape=[a,o];var s="0.0",u="";t==="prod"?s="1.0":t==="min"?(s="1.0 / 1e-20",u="min"):t==="max"&&(s="-1.0 / 1e-20",u="max");var l=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="sum"?l="sumValue":t==="prod"?l="prodValue":t==="all"?l="allValue":t==="any"&&(l="anyValue");var c=Math.floor(n/4)*4,f=n%4,h=`
      if (`+(t==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(t==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+u+`(values, minMaxValue);
        if (`+(t==="min")+" || "+(t==="max")+`) {
          minMaxValue = `+u+`(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,p="vec4";t==="all"?(s="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,p="bvec4"):t==="any"&&(s="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,p="bvec4");var d="";i%n>0&&(d=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+s+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+d+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+n+`;

        vec4 minMaxValue = vec4(`+s+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+c+`; i += 4) {
          int inIdx = inOffset + i;
          `+p+" values = "+p+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+h+`
        }

        int inIdx = inOffset + `+c+`;
        if (`+(f===1)+`) {
          `+p+" values = "+p+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(f===2)+`) {
          `+p+" values = "+p+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(f===3)+`) {
          `+p+" values = "+p+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+h+`
        }
        setOutput(`+l+`);
      }
    `}return r}();function Zqe(r){for(var e=[];e.length===0||e[e.length-1].outSize!==1;){var t=e.length?e[e.length-1].outSize:r[1],n=S.backend_util.computeOptimalWindowSize(t);e.push({inSize:t,windowSize:n,outSize:Math.ceil(t/n)})}return e}function ju(r,e,t,n){for(var a=Zqe(r.shape),i=r,o=0;o<a.length;o++){var s=a[o],u=s.inSize,l=s.windowSize,c=s.outSize,f=void 0,h=void 0;t==="mean"?f=o===0?new BW({windowSize:l,inSize:u,batchSize:r.shape[0],outSize:c},u):new BW({windowSize:l,inSize:u,batchSize:r.shape[0],outSize:c}):f=new Yqe({windowSize:l,inSize:u,batchSize:r.shape[0],outSize:c},t),h=i,i=n.runWebGLProgram(f,[i],e),h.dataId!==r.dataId&&n.disposeIntermediateTensorInfo(h)}return i}var Jqe=function(){function r(e,t){this.variableNames=["A"];for(var n=new Array(e.length),a=0;a<n.length;a++)n[a]=e[t[a]];this.outputShape=n,this.rank=n.length;var i=er(this.rank),o=Qqe(t);this.userCode=`
    void main() {
      `+i+` resRC = getOutputCoords();
      setOutput(getA(`+o+`));
    }
    `}return r}();function Qqe(r){var e=r.length;if(e>6)throw Error("Transpose for rank "+e+" is not yet supported");for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],n=new Array(e),a=0;a<r.length;a++)n[r[a]]=t[a];return n.join()}var eVe=function(){function r(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),a=0;a<n.length;a++)n[a]=e[t[a]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");for(var i=er(this.rank),o=Zq("rc",this.rank),s=new Array(this.rank),a=0;a<t.length;a++)s[t[a]]=o[a];var u="vec2("+s.slice(-2).join()+")",l="++"+o[this.rank-1]+" < "+n[this.rank-1],c="getChannel(getA("+s.join()+"), "+u+")";this.userCode=`
    void main() {
      `+i+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+c+`;
      if(`+l+`) {
        result[1] = `+c+`;
      }
      --`+o[this.rank-1]+`;
      if(++`+o[this.rank-2]+" < "+n[this.rank-2]+`) {
        result[2] = `+c+`;
        if(`+l+`) {
          result[3] = `+c+`;
        }
      }
      setOutput(result);
    }
    `}return r}();function wg(r,e,t){var n=S.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new eVe(r.shape,e):new Jqe(r.shape,e);return t.runWebGLProgram(n,[r],r.dtype)}function tVe(r,e,t,n){var a=e,i=r.shape.length,o=S.util.parseAxisParam(a,r.shape),s=o,u=S.backend_util.getAxesPermutation(s,i),l=u!=null,c=r;l&&(c=wg(r,u,n),s=S.backend_util.getInnerMostAxes(s.length,i)),S.backend_util.assertAxesAreInnerMostDims("sum",s,i);var f=qe(S.backend_util.computeOutAndReduceShapes(c.shape,s),2),h=f[0],p=f[1],d=h;t&&(d=S.backend_util.expandShapeToKeepDim(h,o));var m=S.util.sizeFromShape(p),v=S.util.sizeFromShape(r.shape),g=v/m,y=Oe({inputs:{x:c},attrs:{shape:[g,m]},backend:n}),b=S.sumOutType(r.dtype),w=ju(y,b,"sum",n),x=Oe({inputs:{x:w},attrs:{shape:d},backend:n});return n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(w),l&&n.disposeIntermediateTensorInfo(c),x}function xg(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;return tVe(a,i,o,t)}var rVe={kernelName:S.Sum,backendName:"webgl",kernelFunc:xg};function An(r){for(var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.perm,o=t,s=a.shape.length,u=new Array(s),l=0;l<u.length;l++)u[l]=a.shape[i[l]];var c;if(o.shouldExecuteOnCPU([a])){var f=o.texData.get(a.dataId),h=f.values,p=Vk(h,a.shape,a.dtype,i,u);c=o.makeTensorInfo(u,a.dtype);var d=o.texData.get(c.dataId);d.values=p}else c=wg(a,i,o);return c}var nVe={kernelName:S.Transpose,backendName:"webgl",kernelFunc:An},iV=1e3;function mg(r){var e,t,n=r.a,a=r.b,i=r.transposeA,o=r.transposeB,s=r.backend,u=r.bias,l=u===void 0?null:u,c=r.preluActivationWeights,f=c===void 0?null:c,h=r.leakyreluAlpha,p=h===void 0?0:h,d=r.activation,m=d===void 0?null:d,v=n.shape.length,g=a.shape.length,y=i?n.shape[v-2]:n.shape[v-1],b=o?a.shape[g-1]:a.shape[g-2],w=i?n.shape[v-1]:n.shape[v-2],x=o?a.shape[g-2]:a.shape[g-1],k=n.shape.slice(0,-2),N=a.shape.slice(0,-2),T=S.util.sizeFromShape(k),I=S.util.sizeFromShape(N),F=S.broadcast_util.assertAndGetBroadcastShape(n.shape.slice(0,-2),a.shape.slice(0,-2)),D=F.concat([w,x]);S.util.assert(y===b,function(){return"Error in matMul: inner shapes ("+y+") and ("+(b+") of Tensors with shapes "+n.shape+" and ")+(a.shape+" and transposeA="+i)+(" and transposeB="+o+" must match.")});var R=i?[T,y,w]:[T,w,y],P=o?[I,x,b]:[I,b,x],B=Oe({inputs:{x:n},backend:s,attrs:{shape:R}}),q=Oe({inputs:{x:a},backend:s,attrs:{shape:P}}),O=[B,q],V=Math.max(T,I),K=i?B.shape[1]:B.shape[2],Z=l!=null,j=f!=null,ee=m==="leakyrelu",le=m!=null?np(m,!0):null,se=Z||j||ee||le!=null,ce;if((w===1||x===1)&&K>iV&&se===!1){var he=B,xe=q;i&&(he=An({inputs:{x:B},backend:s,attrs:{perm:[0,2,1]}}),O.push(he)),o&&(xe=An({inputs:{x:q},backend:s,attrs:{perm:[0,2,1]}}),O.push(xe));var Se=x!==1,we=x===1,ke=he;Se&&(ke=Oe({inputs:{x:he},backend:s,attrs:{shape:[V,K,1]}}),O.push(ke));var Ne=x===1?2:1,Ae=xe;we&&(Ae=Oe({inputs:{x:xe},backend:s,attrs:{shape:[V,1,K]}}),O.push(Ae));var Ze=Hk({inputs:{a:ke,b:Ae},backend:s});ce=xg({inputs:{x:Ze},backend:s,attrs:{axis:Ne,keepDims:!0}}),O.push(Ze)}else{var Et=S.upcastType(n.dtype,a.dtype),st=new aV(R,P,[V,w,x],i,o,Z,le,j,ee),it=[B,q];if(l!=null&&it.push(l),j&&it.push(f),ee){var ft=s.makeTensorInfo([],"float32",S.util.createScalarValue(p,"float32"));it.push(ft),O.push(ft)}ce=s.runWebGLProgram(st,it,Et)}var dt=Oe({inputs:{x:ce},backend:s,attrs:{shape:D}});O.push(ce);try{for(var Je=ga(O),at=Je.next();!at.done;at=Je.next()){var nt=at.value;s.disposeIntermediateTensorInfo(nt)}}catch(yr){e={error:yr}}finally{try{at&&!at.done&&(t=Je.return)&&t.call(Je)}finally{if(e)throw e.error}}return dt}function aVe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.a,i=e.b,o=e.bias,s=e.preluActivationWeights,u=n.transposeA,l=n.transposeB,c=n.activation,f=n.leakyreluAlpha;return mg({a,b:i,transposeA:u,transposeB:l,backend:t,bias:o,preluActivationWeights:s,leakyreluAlpha:f,activation:c})}var iVe={kernelName:S._FusedMatMul,backendName:"webgl",kernelFunc:aVe};var LW="return abs(x);";function oVe(r){var e=r.inputs,t=r.backend,n=e.x;if(t.shouldExecuteOnCPU([n])&&n.dtype!=="complex64"){var a=t.texData.get(n.dataId),i=Xq(a.values);return t.makeTensorInfo(n.shape,n.dtype,i)}var o;return S.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new Vu(n.shape,LW):o=new Co(n.shape,LW),t.runWebGLProgram(o,[n],n.dtype)}var sVe={kernelName:S.Abs,backendName:"webgl",kernelFunc:oVe};var uVe=hi+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,lVe=Ft({opSnippet:uVe}),cVe={kernelName:S.Acos,backendName:"webgl",kernelFunc:lVe};var fVe=hi+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,hVe=Ft({opSnippet:fVe}),pVe={kernelName:S.Acosh,backendName:"webgl",kernelFunc:hVe};var zW="return a + b;",dVe=mn({opSnippet:zW,packedOpSnippet:zW,supportsComplex:!0,cpuKernelImpl:EWe}),vVe={kernelName:S.Add,backendName:"webgl",kernelFunc:dVe};var mVe=function(){function r(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(function(i,o){return"T"+o});var n=[];this.variableNames.forEach(function(i){n.push("float v"+i+" = get"+i+"AtOutCoords();")});var a=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+n.join(`
        `)+`

        float result = `+a+`;
        setOutput(result);
      }
    `}return r}();var gVe=function(){function r(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(function(i,o){return"T"+o});var n=[];this.variableNames.forEach(function(i){n.push("vec4 v"+i+" = get"+i+"AtOutCoords();")});var a=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+n.join(`
        `)+`

        vec4 result = `+a+`;
        setOutput(result);
      }
    `}return r}();function vg(r){var e=r.inputs,t=r.backend,n=e;if(n.length===1)return ya({inputs:{x:n[0]},backend:t});if(n.length>S.env().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(n.length/2),i=vg({inputs:n.slice(0,a),backend:t}),o=vg({inputs:n.slice(a),backend:t});return vg({inputs:[i,o],backend:t})}var s=n.map(function(f){return f.dtype}).reduce(function(f,h){return S.upcastType(f,h)}),u=n.map(function(f){return f.shape}),l=S.env().getBool("WEBGL_PACK"),c=l?new gVe(n[0].shape,u):new mVe(n[0].shape,u);return t.runWebGLProgram(c,n,s)}var yVe={kernelName:S.AddN,backendName:"webgl",kernelFunc:vg};function bVe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=a.shape.length,u=S.util.parseAxisParam(i,a.shape),l=u,c=S.backend_util.getAxesPermutation(l,s),f=a;c!=null&&(f=An({inputs:{x:a},backend:t,attrs:{perm:c}}),l=S.backend_util.getInnerMostAxes(l.length,s)),S.backend_util.assertAxesAreInnerMostDims("all",l,s);var h=qe(S.backend_util.computeOutAndReduceShapes(f.shape,l),2),p=h[0],d=h[1],m=S.util.sizeFromShape(d),v=Oe({inputs:{x:f},backend:t,attrs:{shape:[-1,m]}}),g=ju(v,v.dtype,"all",t),y;if(o){var b=S.backend_util.expandShapeToKeepDim(p,u);y=Oe({inputs:{x:g},backend:t,attrs:{shape:b}})}else y=Oe({inputs:{x:g},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(g),c!=null&&t.disposeIntermediateTensorInfo(f),y}var wVe={kernelName:S.All,backendName:"webgl",kernelFunc:bVe};function xVe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=a.shape.length,u=S.util.parseAxisParam(i,a.shape),l=u,c=S.backend_util.getAxesPermutation(l,s),f=a;c!=null&&(f=An({inputs:{x:a},backend:t,attrs:{perm:c}}),l=S.backend_util.getInnerMostAxes(l.length,s)),S.backend_util.assertAxesAreInnerMostDims("any",l,s);var h=qe(S.backend_util.computeOutAndReduceShapes(f.shape,l),2),p=h[0],d=h[1],m=S.util.sizeFromShape(d),v=Oe({inputs:{x:f},backend:t,attrs:{shape:[-1,m]}}),g=ju(v,v.dtype,"any",t),y;if(o){var b=S.backend_util.expandShapeToKeepDim(p,u);y=Oe({inputs:{x:g},backend:t,attrs:{shape:b}})}else y=Oe({inputs:{x:g},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(g),c!=null&&t.disposeIntermediateTensorInfo(f),y}var kVe={kernelName:S.Any,backendName:"webgl",kernelFunc:xVe};var SVe=function(){function r(e,t,n){this.variableNames=["A"];var a=e.windowSize,i=e.batchSize,o=e.outSize;n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s=t==="max"?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+a+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+a+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}return r}();var NVe=function(){function r(e,t,n,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,S.util.assert(e.length>2,function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."});var i=e[e.length-1],o=Math.ceil(i/t);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),a||this.variableNames.push("bestIndicesA");var s=this.outputShape,u=s.length,l=er(u),c=Cn("coords",u),f,h;if(o===1){h=u+1;var p=er(h);f=`
        `+p+" sourceLocR = "+p+"("+c.join()+`, 0);
        ++`+c[u-1]+`;
        `+p+" sourceLocG = "+p+"("+c.join()+`, 0);
        ++`+c[u-2]+`;
        `+p+" sourceLocA = "+p+"("+c.join()+`, 0);
        --`+c[u-1]+`;
        `+p+" sourceLocB = "+p+"("+c.join()+`, 0);
        --`+c[u-2]+";"}else h=u,f=`
        `+l+` sourceLocR = coords;
        ++`+c[u-1]+`;
        `+l+` sourceLocG = coords;
        ++`+c[u-2]+`;
        `+l+` sourceLocA = coords;
        --`+c[u-1]+`;
        `+l+` sourceLocB = coords;
        --`+c[u-2]+";";var d=["x","y","z","w","u","v"].slice(0,h),m="."+d[h-1],v=d.map(function(I){return"int "+I}),g=Cn("sourceLocR",h-1).concat("inIdx.r"),y=Cn("sourceLocG",h-1).concat("inIdx.g"),b=Cn("sourceLocB",h-1).concat("inIdx.b"),w=Cn("sourceLocA",h-1).concat("inIdx.a"),x=n==="max"?"greaterThan":"lessThan",k=a?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+g.join()+`),
                             getBestIndicesAChannel(`+y.join()+`),
                             getBestIndicesAChannel(`+b.join()+`),
                             getBestIndicesAChannel(`+w.join()+")));",N=`vec4(
            getAChannel(`+g.join()+`),
            hasNextCol ? getAChannel(`+y.join()+`) : 0.,
            hasNextRow ? getAChannel(`+b.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+w.join()+") : 0.)",T=a?"":`
      float getBestIndicesAChannel(`+v.join()+`) {
        return getChannel(getBestIndicesA(`+d.join()+`),
                                          vec2(`+d.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+v.join()+`) {
        return getChannel(getA(`+d.join()+`),
                               vec2(`+d.slice(-2).join()+`));
      }
      `+T+`
      void main() {
        `+l+` coords = getOutputCoords();
        bool hasNextCol = `+c[u-1]+" < "+(s[u-1]-1)+`;
        bool hasNextRow = `+c[u-2]+" < "+(s[u-2]-1)+`;
        `+f+`
        ivec4 srcIdx = ivec4(sourceLocR`+m+", sourceLocG"+m+`,
          sourceLocB`+m+", sourceLocA"+m+") * "+t+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+N+`;

        for (int i = 0; i < `+t+`; i++) {
          inIdx = srcIdx;
          `+k+`
          vec4 candidate = `+N+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+x+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}return r}();function oV(r,e,t,n){n===void 0&&(n=null);var a=e.shape[0],i=e.shape[1];n!=null&&(a=n.shape[0],i=n.shape[1]);var o=S.backend_util.computeOptimalWindowSize(i),s={windowSize:o,inSize:i,batchSize:a,outSize:Math.ceil(i/o)},u=new SVe(s,t,n==null),l=[e];n!=null&&l.push(n);var c=r.runWebGLProgram(u,l,"int32");if(c.shape[1]===1)return c;var f=oV(r,e,t,c);return r.disposeIntermediateTensorInfo(c),f}function sV(r,e,t,n){n===void 0&&(n=null);var a=n!=null?n.shape:e.shape,i=a[a.length-1],o=S.backend_util.computeOptimalWindowSize(i),s=new NVe(a,o,t,n==null),u=n==null?[e]:[e,n],l=r.runWebGLProgram(s,u,"int32");if(l.shape.length===e.shape.length){var c=sV(r,e,t,l);return r.disposeIntermediateTensorInfo(l),c}return l}function uV(r,e,t,n){var a=[t];if(S.backend_util.assertAxesAreInnerMostDims("arg"+n.charAt(0).toUpperCase()+n.slice(1),a,e.shape.length),!S.env().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){var i=[],o=r.texData.get(e.dataId),s=o!==null&&o.isPacked,u=e;s&&(u=r.unpackTensor(e),i.push(u));var l=qe(S.backend_util.computeOutAndReduceShapes(u.shape,a),2),c=l[0],f=l[1],h=S.util.sizeFromShape(f),p=Oe({inputs:{x:u},backend:r,attrs:{shape:[-1,h]}});i.push(p);var d=oV(r,p,n);i.push(d);var m=Oe({inputs:{x:d},backend:r,attrs:{shape:c}});return i.forEach(function(v){return r.disposeIntermediateTensorInfo(v)}),m}return sV(r,e,n)}function EVe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=S.util.parseAxisParam(i,a.shape),s=S.backend_util.getAxesPermutation(o,a.shape.length),u=a,l=[];s!=null&&(u=An({inputs:{x:a},backend:t,attrs:{perm:s}}),l.push(u),o=S.backend_util.getInnerMostAxes(o.length,u.shape.length)),S.backend_util.assertAxesAreInnerMostDims("argMax",[o[0]],u.shape.length);var c=uV(t,u,o[0],"max");return l.forEach(function(f){return t.disposeIntermediateTensorInfo(f)}),c}var TVe={kernelName:S.ArgMax,backendName:"webgl",kernelFunc:EVe};function IVe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=S.util.parseAxisParam(i,a.shape),s=S.backend_util.getAxesPermutation(o,a.shape.length),u=a,l=[];s!=null&&(u=An({inputs:{x:a},backend:t,attrs:{perm:s}}),l.push(u),o=S.backend_util.getInnerMostAxes(o.length,u.shape.length)),S.backend_util.assertAxesAreInnerMostDims("argMin",[o[0]],u.shape.length);var c=uV(t,u,o[0],"min");return l.forEach(function(f){return t.disposeIntermediateTensorInfo(f)}),c}var CVe={kernelName:S.ArgMin,backendName:"webgl",kernelFunc:IVe};var AVe=hi+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,_Ve=Ft({opSnippet:AVe}),DVe={kernelName:S.Asin,backendName:"webgl",kernelFunc:_Ve};var FVe=hi+"return log(x + sqrt(x * x + 1.0));",RVe=Ft({opSnippet:FVe}),OVe={kernelName:S.Asinh,backendName:"webgl",kernelFunc:RVe};var PVe=hi+`
  return atan(x);
`,MVe=Ft({opSnippet:PVe}),BVe={kernelName:S.Atan,backendName:"webgl",kernelFunc:MVe};var LVe=Uk+`
  return atan(a, b);
`,zVe=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+up+`
  return result;
`,$Ve=mn({opSnippet:LVe,packedOpSnippet:zVe}),WVe={kernelName:S.Atan2,backendName:"webgl",kernelFunc:$Ve};var qVe=hi+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,VVe=Ft({opSnippet:qVe}),GVe={kernelName:S.Atanh,backendName:"webgl",kernelFunc:VVe};var ap=function(){function r(e,t,n,a,i){if(a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var o=e.filterWidth,s=e.strideHeight,u=e.strideWidth,l=e.dilationHeight,c=e.dilationWidth,f=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=e.padInfo.top,d=e.padInfo.left;this.outputShape=e.outShape;var m=t==="avg",v="((batch  * "+e.inHeight+" + xR) * "+e.inWidth+" + xC) * "+e.inChannels+" + d",g="(xR * "+e.inWidth+" + xC) * "+e.inChannels+" + d",y="0.0";if(m||(y="-1.0 / 1e-20"),n){var b=">=";this.userCode=`
        const ivec2 strides = ivec2(`+s+", "+u+`);
        const ivec2 pads = ivec2(`+p+", "+d+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+f+`;
              wR += `+l+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+h+`;
                wC += `+c+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value `+b+` currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = `+(a?i?v:g:"wR * "+h+" + wC")+`;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}var w="max",x=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(x="avgValue / count");var k=Math.floor(o/4)*4,N=o%4,T=`
      if (`+m+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = `+w+`(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+s+", "+u+`);
      const ivec2 pads = ivec2(`+p+", "+d+`);
      const float initializationValue = `+y+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+e.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+y+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+f+`;
            wR += `+l+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+e.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+k+`; wC += 4) {
            int xC = xCCorner + wC * `+c+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+c+`, d),
              getValue(batch, xR, xC + 2 * `+c+`, d),
              getValue(batch, xR, xC + 3 * `+c+`, d)
            );

            `+T+`
          }

          int xC = xCCorner + `+k+`;
          if (`+(N===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+T+`
          } else if (`+(N===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+c+`, d),
              initializationValue,
              initializationValue
            );

            `+T+`
          } else if (`+(N===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+c+`, d),
              getValue(batch, xR, xC + 2 * `+c+`, d),
              initializationValue
            );

            `+T+`
          }
        }
        setOutput(`+x+`);
      }
    `}return r}(),Kk=function(){function r(e,t,n,a,i){if(a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var o=e.filterWidth,s=e.strideDepth,u=e.strideHeight,l=e.strideWidth,c=e.dilationDepth,f=e.dilationHeight,h=e.dilationWidth,p=e.effectiveFilterDepth,d=e.effectiveFilterHeight,m=e.effectiveFilterWidth,v=e.padInfo.front,g=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;var b=t==="avg",w="0.0";if(b||(w="-1.0 / 1e-20"),n){var x=">=";this.userCode=`
        const ivec3 strides =
            ivec3(`+s+", "+u+", "+l+`);
        const ivec3 pads = ivec3(`+v+", "+g+", "+y+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+p+`;
              wD += `+c+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+e.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+d+`;
                wR += `+f+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+e.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+m+`;
                  wC += `+h+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+e.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value `+x+` currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = `+(a?i?"(((batch * "+e.inDepth+" + xD) * "+e.inHeight+" + xR) * "+e.inWidth+" + xC) * "+e.inChannels+" + ch":"((xD * "+e.inHeight+" + xR) * "+e.inWidth+" + xC) * "+e.inChannels+" + ch":"wD * "+d+" * "+m+` +
                      wR * `+m+" + wC")+`;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}var k="max",N=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(N="avgValue / count");var T=Math.floor(o/4)*4,I=o%4,F=`
      if (`+b+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = `+k+`(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+s+", "+u+", "+l+`);
      const ivec3 pads = ivec3(`+v+", "+g+", "+y+`);
      const float initializationValue = `+w+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+e.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+w+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+p+`;
            wD += `+c+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+e.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+d+`;
            wR += `+f+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+T+`; wC += 4) {
              int xC = xCCorner + wC * `+h+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+h+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+h+`, ch)
              );

              `+F+`
            }

            int xC = xCCorner + `+T+`;
            if (`+(I===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+F+`
            } else if (`+(I===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                initializationValue,
                initializationValue
              );

              `+F+`
            } else if (`+(I===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+h+`, ch),
                initializationValue
              );

              `+F+`
            }
          }
          setOutput(`+N+`);
        }
      }
    `}return r}();function UVe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;Ec(a,"avgPool");var i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,l=1;S.util.assert(S.backend_util.eitherStridesOrDilationsAreOne(o,l),function(){return"Error in avgPool: Either strides or dilations must be 1. "+("Got strides "+o+" and dilations '"+l+"'")});var c=S.backend_util.computePool2DInfo(a.shape,i,o,l,s,u);if(c.filterWidth===1&&c.filterHeight===1&&S.util.arraysEqual(c.inShape,c.outShape))return ya({inputs:{x:a},backend:t});var f=new ap(c,"avg",!1);return t.runWebGLProgram(f,[a],"float32")}var HVe={kernelName:S.AvgPool,backendName:"webgl",kernelFunc:UVe};function KVe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,l=n.dataFormat,c=[1,1,1],f=S.backend_util.computePool3DInfo(a.shape,i,o,c,s,u,l),h=new Kk(f,"avg",!1);return t.runWebGLProgram(h,[a],"float32")}var jVe={kernelName:S.AvgPool3D,backendName:"webgl",kernelFunc:KVe};var XVe=function(){function r(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,l=e.effectiveFilterWidth,c=u-1-e.padInfo.top,f=l-1-e.padInfo.left,h=1/(t*n);this.userCode=`
      const ivec2 pads = ivec2(`+c+", "+f+`);
      const float avgMultiplier = float(`+h+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+u+`;
            wR += `+o+`) {
          float dyR = float(dyRCorner + wR) / `+a+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+l+`;
            wC+= `+s+`) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}return r}(),YVe=function(){function r(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,a=e.filterWidth,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=e.dilationDepth,l=e.dilationHeight,c=e.dilationWidth,f=e.effectiveFilterDepth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,d=f-1-e.padInfo.front,m=h-1-e.padInfo.top,v=p-1-e.padInfo.left,g=1/(t*n*a);this.userCode=`
      const ivec3 pads = ivec3(`+d+", "+m+", "+v+`);
      const float avgMultiplier = float(`+g+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+f+`;
            wD += `+u+`) {
          float dyD = float(dyDCorner + wD) / `+i+`.0;

          if (dyD < 0.0 || dyD >= `+e.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+h+`;
              wR += `+l+`) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+p+`;
                wC += `+c+`) {
              float dyC = float(dyCCorner + wC) / `+s+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}return r}();function ZVe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=i,s=n.filterSize,u=n.strides,l=n.pad,c=n.dimRoundingMode,f=[1,1,1],h=S.backend_util.computePool3DInfo(o.shape,s,u,f,l,c),p=new YVe(h);return t.runWebGLProgram(p,[a],o.dtype)}var JVe={kernelName:S.AvgPool3DGrad,backendName:"webgl",kernelFunc:ZVe};function QVe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=i;Ec([a,i],"avgPoolGrad");var s=n.filterSize,u=n.strides,l=n.pad,c=S.backend_util.computePool2DInfo(o.shape,s,u,1,l),f=new XVe(c);return t.runWebGLProgram(f,[a],o.dtype)}var eGe={kernelName:S.AvgPoolGrad,backendName:"webgl",kernelFunc:QVe};function tGe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.a,i=e.b,o=n.transposeA,s=n.transposeB;return mg({a,b:i,transposeA:o,transposeB:s,backend:t})}var rGe={kernelName:S.BatchMatMul,backendName:"webgl",kernelFunc:tGe};var nGe=function(){function r(e,t,n,a,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],S.backend_util.assertAndGetBroadcastShape(e,t),S.backend_util.assertAndGetBroadcastShape(e,n);var s="0.0";a!=null&&(S.backend_util.assertAndGetBroadcastShape(e,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";i!=null&&(S.backend_util.assertAndGetBroadcastShape(e,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+s+`;
        float scale = `+u+`;
        float inv = scale * inversesqrt(variance + float(`+o+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}return r}();var aGe=function(){function r(e,t,n,a,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],S.backend_util.assertAndGetBroadcastShape(e,t),S.backend_util.assertAndGetBroadcastShape(e,n);var s="vec4(0.0)";a!=null&&(S.backend_util.assertAndGetBroadcastShape(e,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";i!=null&&(S.backend_util.assertAndGetBroadcastShape(e,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = `+s+`;
        vec4 scale = `+u+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+o+`));

        setOutput((x - mean) * inv + offset);
      }
    `}return r}();var iGe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.mean,o=e.variance,s=e.offset,u=e.scale;S.util.assert(i.shape.length===o.shape.length,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),S.util.assert(s==null||i.shape.length===s.shape.length,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),S.util.assert(u==null||i.shape.length===u.shape.length,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var l=n.varianceEpsilon;l==null&&(l=.001);var c=[a,i,o],f=null;s!=null&&(f=s.shape,c.push(s));var h=null;u!=null&&(h=u.shape,c.push(u));var p=S.env().getBool("WEBGL_PACK_NORMALIZATION")?new aGe(a.shape,i.shape,o.shape,f,h,l):new nGe(a.shape,i.shape,o.shape,f,h,l),d=t.runWebGLProgram(p,c,c[0].dtype);return d},oGe={kernelName:S.FusedBatchNorm,backendName:"webgl",kernelFunc:iGe};var sGe=function(){function r(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t=er(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var n=uGe(this.rank),a,i=e.map(function(o,s){return"sourceLoc."+_k[s]+" = start["+s+"] + coords."+_k[s]+";"});a=`
        `+t+` sourceLoc;
        `+t+` coords = getOutputCoords();
        `+i.join(`
`)+`
      `,this.userCode=`
      void main() {
        `+a+`
        setOutput(getSource(`+n+`));
      }
    `}return r}(),_k=["x","y","z","w","u","v"];function uGe(r){if(r===1)return"sourceLoc";if(r<=6)return _k.slice(0,r).map(function(e){return"sourceLoc."+e}).join(",");throw Error("Slicing for rank "+r+" is not yet supported")}var lGe=function(){function r(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var t=er(this.rank),n=Cn("coords",this.rank),a=Cn("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":"vec2("+a.slice(-2).join()+")",o="getChannel(getSource("+a.join()+"), "+i+")",s=`
      result.x = `+o+`;
      if (++`+n[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+a[this.rank-1]+`;
        result.y = `+o+`;
        --`+a[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+n[this.rank-1]+`;
      if (++`+n[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+a[this.rank-2]+`;
        result.z = `+o+`;
        if (++`+n[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+a[this.rank-1]+`;
          result.w = `+o+`;
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            `+t+"("+e.map(function(c,f){return"start["+f+"]"}).join()+");":e.map(function(c,f){return a[f]+" = "+n[f]+" + start["+f+"];"}).join(`
`);this.userCode=`
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+l+`
        vec4 result = vec4(0.);
        `+s+`
        `+u+`
        setOutput(result);
      }
    `}return r}();function cGe(r,e,t,n){var a=n.texData.get(r.dataId),i=n.makeTensorInfo(t,r.dtype),o=n.texData.get(i.dataId);Object.assign(o,a),o.refCount=1,o.shape=t,o.dtype=r.dtype;var s=S.slice_util.computeFlatOffset(e,S.util.computeStrides(r.shape));a.slice&&(s+=a.slice.flatOffset),o.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||r.dataId};var u=n.dataRefCount.get(o.slice.origDataId)||1;return n.dataRefCount.set(o.slice.origDataId,u+1),i}function Dc(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.begin,o=n.size,s=qe(S.slice_util.parseSliceParams(a,i,o),2),u=s[0],l=s[1];if(S.slice_util.assertParamsValid(a,u,l),S.util.sizeFromShape(l)===0)return t.makeTensorInfo(l,a.dtype,[]);if(t.shouldExecuteOnCPU([a])||a.dtype==="string"){var c=t.texData.get(a.dataId),f=tqe(c.values,u,l,a.shape,a.dtype);return t.makeTensorInfo(l,a.dtype,f)}var h=t.texData.get(a.dataId).isPacked,p=S.slice_util.isSliceContinous(a.shape,u,l);if(h||!p){var d=S.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new lGe(l):new sGe(l),m=[u];return t.runWebGLProgram(d,[a],a.dtype,m)}return t.uploadToGPU(a.dataId),cGe(a,u,l,t)}var fGe={kernelName:S.Slice,backendName:"webgl",kernelFunc:Dc};var hGe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockShape,o=n.crops;S.util.assert(a.shape.length<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var s=i.reduce(function(y,b){return y*b}),u=S.backend_util.getReshaped(a.shape,i,s),l=S.backend_util.getPermuted(u.length,i.length),c=S.backend_util.getReshapedPermuted(a.shape,i,s),f=S.backend_util.getSliceBeginCoords(o,i.length),h=S.backend_util.getSliceSize(c,o,i.length),p=[],d=Oe({inputs:{x:a},backend:t,attrs:{shape:u}}),m=An({inputs:{x:d},backend:t,attrs:{perm:l}}),v=Oe({inputs:{x:m},backend:t,attrs:{shape:c}}),g=Dc({inputs:{x:v},backend:t,attrs:{begin:f,size:h}});return p.push(d),p.push(m),p.push(v),p.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),g},pGe={kernelName:S.BatchToSpaceND,backendName:"webgl",kernelFunc:hGe};function dGe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.weights,o=n.size,s=t.readSync(a.dataId),u=t.readSync(i.dataId),l=jq(s,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,l)}var vGe={kernelName:S.Bincount,backendName:"webgl",kernelFunc:dGe};function mGe(r){var e=r.inputs,t=r.backend,n=e.s0,a=e.s1,i=t.readSync(n.dataId),o=t.readSync(a.dataId),s=S.backend_util.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return t.makeTensorInfo([s.length],"int32",Int32Array.from(s))}var gGe={kernelName:S.BroadcastArgs,backendName:"webgl",kernelFunc:mGe};var yGe="return float(a != b);",lV=mn({opSnippet:yGe,cpuKernelImpl:KWe,dtype:"bool"}),bGe={kernelName:S.NotEqual,backendName:"webgl",kernelFunc:lV};function cp(r){var e=r.inputs,t=r.backend,n=e.input,a=t.texData.get(n.dataId);return ya({inputs:{x:a.complexTensorInfos.real},backend:t})}var wGe={kernelName:S.Real,backendName:"webgl",kernelFunc:cp};var xGe="return float(int(x));";function kGe(r,e){var t=new Co(r.shape,xGe),n=e.runWebGLProgram(t,[r],"int32");return{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}function Dk(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.dtype;if(i==="complex64"){if(a.dtype==="complex64")return ya({inputs:{x:a},backend:t});var o=pze.zeros(a.shape),s=Dk({inputs:{x:a},backend:t,attrs:{dtype:"float32"}}),u=Es({inputs:{real:s,imag:o},backend:t});return o.dispose(),t.disposeIntermediateTensorInfo(s),u}if(a.dtype==="complex64"){var l=cp({inputs:{input:a},backend:t}),u=Dk({inputs:{x:l},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(l),u}if(!S.util.hasEncodingLoss(a.dtype,i)){var u=ya({inputs:{x:a},backend:t});return{dataId:u.dataId,shape:u.shape,dtype:i}}if(t.shouldExecuteOnCPU([a])){var c=t.texData.get(a.dataId).values,f=qe(IWe(c,a.shape,a.dtype,i),3),h=f[0],p=f[1],d=f[2];return t.makeTensorInfo(h,p,d)}if(i==="int32")return kGe(a,t);if(i==="bool"){var m=t.makeTensorInfo([],"bool",S.util.getTypedArrayFromDType("bool",1)),v={a,b:m},u=lV({inputs:v,backend:t});return t.disposeIntermediateTensorInfo(m),u}throw new Error("Error in Cast: failed to cast "+a.dtype+" to "+i)}var SGe={kernelName:S.Cast,backendName:"webgl",kernelFunc:Dk};var $W="return ceil(x);",NGe=Ft({opSnippet:$W,packedOpSnippet:$W,cpuKernelImpl:CWe}),EGe={kernelName:S.Ceil,backendName:"webgl",kernelFunc:NGe};var TGe=function(){function r(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return r}();var IGe=function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return r}();function CGe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.clipValueMin,o=n.clipValueMax,s;S.env().getBool("WEBGL_PACK_CLIP")?s=new IGe(a.shape):s=new TGe(a.shape);var u=[[i],[o]];return t.runWebGLProgram(s,[a],a.dtype,u)}var AGe={kernelName:S.ClipByValue,backendName:"webgl",kernelFunc:CGe};var _Ge=function(){function r(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}return r}();function WW(r,e){return{dataId:e.dataId,dtype:e.dtype,shape:r.shape}}function DGe(r){var e=r.inputs,t=r.backend,n=e.x,a=t.texData.get(n.dataId),i=new _Ge(n.shape),o=[WW(n,a.complexTensorInfos.real),WW(n,a.complexTensorInfos.imag)];return t.runWebGLProgram(i,o,o[0].dtype)}var FGe={kernelName:S.ComplexAbs,backendName:"webgl",kernelFunc:DGe};var RGe=function(){function r(e){this.outputShape=[],this.outputShape=S.backend_util.computeOutShape(e,1),this.variableNames=e.map(function(u,l){return"T"+l});var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];for(var a=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"],n=1;n<t.length;n++){var i=t[n-1];a.push("else if (yC < "+t[n]+") "+("setOutput(getT"+n+"(yR, yC-"+i+"));"))}var o=t.length,s=t[t.length-1];a.push("else setOutput(getT"+o+"(yR, yC-"+s+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+a.join(`
        `)+`
      }
    `}return r}();var OGe=function(){function r(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=S.backend_util.computeOutShape(e,t);var n=this.outputShape,a=n.length,i=er(a),o=Cn("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=e.map(function(g,y){return"T"+y});var u=new Array(e.length-1);u[0]=e[0][t];for(var l=1;l<u.length;l++)u[l]=u[l-1]+e[l][t];for(var c=s[t],f=s.slice(-2),h=s.join(),p="if ("+c+" < "+u[0]+`) {
        return getChannel(
            getT0(`+h+"), vec2("+f.join()+`));
        }`,l=1;l<u.length;l++){var d=u[l-1];p+=`
        if (`+c+" < "+u[l]+"  && "+c+" >= "+u[l-1]+`) {
          return getChannel(
            getT`+l+"("+ug(s,c,d)+`),
            vec2(`+ug(f,c,d)+`));
        }`}var m=u.length,v=u[u.length-1];p+=`
        return getChannel(
          getT`+m+"("+ug(s,c,v)+`),
          vec2(`+ug(f,c,v)+"));",this.userCode=`
      float getValue(`+s.map(function(g){return"int "+g})+`) {
        `+p+`
      }

      void main() {
        `+i+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+o+`), 0., 0., 0.);

        `+o[a-1]+" = "+o[a-1]+` + 1;
        if (`+o[a-1]+" < "+n[a-1]+`) {
          result.g = getValue(`+o+`);
        }

        `+o[a-2]+" = "+o[a-2]+` + 1;
        if (`+o[a-2]+" < "+n[a-2]+`) {
          result.a = getValue(`+o+`);
        }

        `+o[a-1]+" = "+o[a-1]+` - 1;
        if (`+o[a-2]+" < "+n[a-2]+` &&
            `+o[a-1]+" < "+n[a-1]+`) {
          result.b = getValue(`+o+`);
        }
        setOutput(result);
      }
    `}return r}();function ug(r,e,t){var n=r.indexOf(e),a=r.map(function(i,o){return o===n?i+" - "+t:i});return a.join()}function kg(r){var e=r.inputs,t=r.backend,n=e.input,a=t.texData.get(n.dataId);return ya({inputs:{x:a.complexTensorInfos.imag},backend:t})}var PGe={kernelName:S.Imag,backendName:"webgl",kernelFunc:kg};function ep(r,e,t){var n,a,i=r[0].dtype;if(i==="complex64"){var o=r.map(function(V){return cp({inputs:{input:V},backend:t})}),s=r.map(function(V){return kg({inputs:{input:V},backend:t})}),u=ep(o,e,t),l=ep(s,e,t),c=Es({inputs:{real:u,imag:l},backend:t});return o.forEach(function(V){return t.disposeIntermediateTensorInfo(V)}),s.forEach(function(V){return t.disposeIntermediateTensorInfo(V)}),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(l),c}var f=t.shouldExecuteOnCPU(r);if(i==="string"&&(f=!0),f){var h=r.map(function(V){var K=S.util.sizeFromShape(V.shape.slice(e)),Z=[-1,K];return Oe({inputs:{x:V},backend:t,attrs:{shape:Z}})}),p=h.map(function(V){return{vals:t.readSync(V.dataId),shape:V.shape}}),d=S.backend_util.computeOutShape(h.map(function(V){return V.shape}),1),m=h[0].shape[0]===1,v=AWe(p,d,i,m),g=S.backend_util.computeOutShape(r.map(function(V){return V.shape}),e),y=t.makeTensorInfo(g,i,v);return h.forEach(function(V){return t.disposeIntermediateTensorInfo(V)}),y}var b=S.env().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(r.length>b){for(var w=[],x=0;x<r.length;x+=b){var k=r.slice(x,x+b);w.push(ep(k,e,t))}var N=ep(w,e,t);try{for(var T=ga(w),I=T.next();!I.done;I=T.next()){var x=I.value;t.disposeIntermediateTensorInfo(x)}}catch(V){n={error:V}}finally{try{I&&!I.done&&(a=T.return)&&a.call(T)}finally{if(n)throw n.error}}return N}if(S.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&r[0].shape.length>1){var F=new OGe(r.map(function(V){return V.shape}),e);return t.runWebGLProgram(F,r,i)}var D=MGe(r,e,t),R=D.tensors2D,P=D.outShape,B=new RGe(R.map(function(V){return V.shape})),q=t.runWebGLProgram(B,R,i);R.forEach(function(V){return t.disposeIntermediateTensorInfo(V)});var O=Oe({inputs:{x:q},attrs:{shape:P},backend:t});return t.disposeIntermediateTensorInfo(q),O}function MGe(r,e,t){var n=S.backend_util.computeOutShape(r.map(function(i){return i.shape}),e),a=r.map(function(i){return Oe({inputs:{x:i},attrs:{shape:[-1,S.util.sizeFromShape(i.shape.slice(e))]},backend:t})});return{tensors2D:a,outShape:n}}function cV(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.axis,i=S.util.parseAxisParam(a,e[0].shape)[0],o=e.map(function(l){return l.shape});S.backend_util.assertParamsConsistent(o,i);var s=S.backend_util.computeOutShape(e.map(function(l){return l.shape}),i);if(S.util.sizeFromShape(s)===0)return t.makeTensorInfo(s,e[0].dtype,[]);var u=e.filter(function(l){return S.util.sizeFromShape(l.shape)>0});return u.length===1?ya({inputs:{x:u[0]},backend:t}):ep(u,i,t)}var BGe={kernelName:S.Concat,backendName:"webgl",kernelFunc:cV};var fV=function(){function r(e,t,n,a,i){t===void 0&&(t=!1),n===void 0&&(n=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,f=e.dilationWidth,h=e.filterHeight,p=e.filterWidth,d=Math.floor(e.inChannels/4)*4,m=e.inChannels%4,v=e.dataFormat==="channelsLast",g=v?1:2,y=v?2:3,b=v?3:1,w="",x="";n&&(a?w=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:i?w=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          `+n+`
        }`:w=`
          float activation(float x) {
            `+n+`
          }
        `,x="result = activation(result);");var k=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `+w+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+o+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+b+`];

        ivec2 xRCCorner =
            ivec2(coords[`+g+"], coords["+y+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+h+`; wR++) {
          int xR = xRCorner + wR * `+c+`;

          if (xR < 0 || xR >= `+e.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+p+`; wC++) {
            int xC = xCCorner + wC * `+f+`;

            if (xC < 0 || xC >= `+e.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+d+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+v+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(m===1)+`) {

              if (`+v+`) {
                dotProd +=
                    getX(batch, xR, xC, `+d+`) *
                    getW(wR, wC, `+d+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+d+`, xR, xC) *
                    getW(wR, wC, `+d+`, d2);
              }

            } else if (`+(m===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+d+`, d2),
                getW(wR, wC, `+d+` + 1, d2)
              );

              if (`+v+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+d+`),
                  getX(batch, xR, xC, `+d+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+d+`, xR, xC),
                  getX(batch, `+d+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(m===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+d+`, d2),
                getW(wR, wC, `+d+` + 1, d2),
                getW(wR, wC, `+d+` + 2, d2)
              );

              if (`+v+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+d+`),
                  getX(batch, xR, xC, `+d+` + 1),
                  getX(batch, xR, xC, `+d+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+d+`, xR, xC),
                  getX(batch, `+d+` + 1, xR, xC),
                  getX(batch, `+d+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+k+`
        `+x+`
        setOutput(result);
      }
    `}return r}(),LGe=function(){function r(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,a=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=e.dilationDepth,l=e.dilationHeight,c=e.dilationWidth,f=e.filterDepth,h=e.filterHeight,p=e.filterWidth,d=Math.floor(e.inChannels/4)*4,m=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+i+", "+o+", "+s+`);
      const ivec3 pads = ivec3(`+t+", "+n+", "+a+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+f+`; wF++) {
          int xF = xFCorner + wF * `+u+`;

          if (xF < 0 || xF >= `+e.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`; wR++) {
            int xR = xRCorner + wR * `+l+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+p+`; wC++) {
              int xC = xCCorner + wC * `+c+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+d+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(m===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+d+`) *
                  getW(wF, wR, wC, `+d+`, d2);
              } else if (`+(m===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+d+`),
                  getX(batch, xF, xR, xC, `+d+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+d+`, d2),
                  getW(wF, wR, wC, `+d+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(m===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+d+`),
                  getX(batch, xF, xR, xC, `+d+` + 1),
                  getX(batch, xF, xR, xC, `+d+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+d+`, d2),
                  getW(wF, wR, wC, `+d+` + 1, d2),
                  getW(wF, wR, wC, `+d+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}return r}();var hV=function(){function r(e,t,n,a,i){t===void 0&&(t=!1),n===void 0&&(n=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Dn(this.outputShape.length);for(var o=e.padInfo.left,s=e.strideWidth,u=e.dilationWidth,l=e.filterHeight,c=e.filterWidth,f=c,h=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`,p=0;p<c;p++)h+=`
           vec4 xTexelC`+p*2+`;
           int xTexelC`+p*2+`Ready;
           vec4 xTexelC`+(p*2+1)+`;
           int xTexelC`+(p*2+1)+`Ready;
           vec4 xC`+p+";";h+=`
     for (int r = 0; r < `+l+`; r++) {
      for (int d1 = 0; d1 < `+e.inChannels+`; d1 += 2) {
       `;for(var p=0;p<c;p++)h+=`
           xTexelC`+p*2+` = vec4(0.0);
           xTexelC`+p*2+`Ready = 0;
           xTexelC`+(p*2+1)+` = vec4(0.0);
           xTexelC`+(p*2+1)+`Ready = 0;
           xC`+p+" = vec4(0.0);";h+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(var d=0;d<(f+1)/2;d++){var m=d*2;if(h+=`
           xC = xCCorner + `+m*u+`;
           `,s===1){if(m<c&&(o%2===1?(h+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`+m+`Ready == 0) {
                   xTexelC`+m+` = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`+m+`.zw = vec2(0.0);
                   }
                   xTexelC`+m+`Ready = 1;
                 }
               `,u===1&&m>0?h+=`
                 xC`+m+" = vec4(xTexelC"+(m-2)+".zw, xTexelC"+m+`.xy);
                 `:h+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC`+m+" = vec4(previous.zw, xTexelC"+m+`.xy);
                   } else {
                     xC`+m+" = vec4(0.0, 0.0, xTexelC"+m+`.xy);
                   }
                   `):h+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC`+m+`Ready == 0) {
                   xTexelC`+m+` = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC`+m+`.zw = vec2(0.0);
                   }
                   xTexelC`+m+`Ready = 1;
                 }

                 xC`+m+" = xTexelC"+m+`;
                 `,m+1<c)){var v=o%2===0?S.util.nearestLargerEven(u):u;u%2===0&&o%2===1||u%2!==0&&o%2!==1?(h+=`
                   xCOffset = xC + imod(pads[1], 2) + `+v+`;

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`+(m+1)+`Ready == 0) {
                     xTexelC`+(m+1)+` = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC`+(m+1)+`.zw = vec2(0.0);
                     }
                     xTexelC`+(m+1)+`Ready = 1;
                   }
                   `,u>1?h+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC`+(m+1)+" = vec4(previous.zw, xTexelC"+(m+1)+`.xy);
                     } else {
                      xC`+(m+1)+" = vec4(0.0, 0.0, xTexelC"+(m+1)+`.xy);
                     }
                     `:h+=`
                     xC`+(m+1)+" = vec4(xTexelC"+m+".zw, xTexelC"+(m+1)+`.xy);
                     `):v===1?h+=`
                     xC`+(m+1)+" = xTexelC"+m+`;
                     `:h+=`
                     xCOffset = xC + `+v+`;

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`+(m+1)+`Ready == 0) {
                       xTexelC`+(m+1)+` = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC`+(m+1)+`.zw = vec2(0.0);
                       }
                       xTexelC`+(m+1)+`Ready = 1;
                     }

                     xC`+(m+1)+" = xTexelC"+(m+1)+`;
                     `}}else m<c&&(o%2===1?(h+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`+m+`Ready == 0) {
                   xTexelC`+m+` = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`+m+`.zw = vec2(0.0);
                   }
                   xTexelC`+m+`Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC`+(m+1)+`Ready == 0) {
                   xTexelC`+(m+1)+` = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC`+(m+1)+`.zw = vec2(0.0);
                   }
                   xTexelC`+(m+1)+`Ready = 1;
                 }

                 xC`+m+" = vec4(xTexelC"+m+".zw, xTexelC"+(m+1)+`.zw);
               `,m+1<c&&(h+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC`+(m+1)+" = vec4(xTexelC"+(m+1)+`.xy, final.xy);
                 `)):(h+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC`+m+`Ready == 0) {
                   xTexelC`+m+` = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC`+m+`.zw = vec2(0.0);
                   }
                   xTexelC`+m+`Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`+(m+1)+`Ready == 0) {
                   xTexelC`+(m+1)+` = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`+(m+1)+`.zw = vec2(0.);
                   }
                   xTexelC`+(m+1)+`Ready = 1;
                 }

                 xC`+m+` = vec4(
                   xTexelC`+m+".xy, xTexelC"+(m+1)+`.xy);
               `,m+1<c&&(h+=`
                   xC`+(m+1)+" = vec4(xTexelC"+m+".zw, xTexelC"+(m+1)+`.zw);
                 `)));m<c&&(h+=`
             wTexel = getW(r, `+m+`, d1, d2);
             dotProd += xC`+m+`.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < `+e.inChannels+`) {
               dotProd += xC`+m+`.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,m+1<c&&(h+=`
               wTexel = getW(r, `+(m+1)+`, d1, d2);
               dotProd += xC`+(m+1)+`.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < `+e.inChannels+`) {
                 dotProd += xC`+(m+1)+`.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}h+=`
     }
   `,h+=`
     }
   `,h+=`
     }
   `;var g="",y="";n&&(a?g=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           `+n+`
         }`:i?g=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           `+n+`
         }`:g=`vec4 activation(vec4 x) {
           `+n+`
         }`,y="result = activation(result);");var b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       `+g+`

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         `+h+`

         vec4 result = dotProd - vec4(0.000000000000001);
         `+b+`
         `+y+`
         setOutput(result);
       }
     `}return r}();var zGe=function(){function r(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=Dn(this.outputShape.length);for(var n=t.dataFormat,a=_n(),i=n==="channelsLast",o=i?1:2,s=i?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < "+e[2]+" && pos < "+e[1]+") {",l="",c=0;c<=1;c++)for(var f=0;f<=1;f++)l+=`
          blockIndex = rc.z + `+f+`;
          pos = rc.y + `+c+`;

          `+u+`
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[`+o+`] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[`+s+`] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (`+i+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(c*2+f)+`] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(c*2+f)+`] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+l+`

        `+a.output+` = result;
      }
    `}return r}();function gg(r,e){var t=r.length;return t>=3?e?Xr(r.slice(0,-3),[r[t-3]*r[t-2],r[t-1]]):Xr(r.slice(0,-3),[r[t-3],r[t-2]*r[t-1]]):!e&&t===1&&r[0]>1?[r[0],1]:null}function pV(r){var e,t,n=r.x,a=r.filter,i=r.convInfo,o=r.backend,s=r.bias,u=s===void 0?null:s,l=r.preluActivationWeights,c=l===void 0?null:l,f=r.leakyreluAlpha,h=f===void 0?0:f,p=r.activation,d=p===void 0?null:p,m=n.shape,v=o.texData.get(n.dataId),g=i.inChannels,y=m[0]*m[1]*m[2],b=i.outChannels,w=i.dataFormat==="channelsLast",x=!1,k=!1,N,T=[];if(c!=null){var I=gg(c.shape,w);I!=null&&(c=Oe({inputs:{x:c},backend:o,attrs:{shape:I}}),T.push(c))}if(u!=null){var I=gg(u.shape,w);I!=null&&(u=Oe({inputs:{x:u},backend:o,attrs:{shape:I}}),T.push(u))}var F=(y===1||b===1)&&g>iV,D=!F&&v.isPacked&&w&&v.texture!=null&&m[2]%2!==0&&S.util.arraysEqual(v.shape.slice(-3),m.slice(-3));if(D){var I=m[0]*m[1]*(m[2]+1),R={dataId:n.dataId,shape:[1,I,i.inChannels],dtype:n.dtype},P=v.shape;v.shape=v.shape.slice(),v.shape[v.shape.length-2]++,S.util.assert(rp(v.shape,R.shape),function(){return"packed reshape "+v.shape+" to "+R.shape+" isn't free"});var B=Oe({inputs:{x:a},backend:o,attrs:{shape:[1,i.inChannels,i.outChannels]}});T.push(B);var q=mg({a:R,b:B,backend:o,transposeA:x,transposeB:k,bias:u,activation:d,preluActivationWeights:c,leakyreluAlpha:h}),O=o.texData.get(q.dataId);S.util.assert(O.isPacked,function(){return"batchMatMul result is expected to be packed"}),v.shape=P,O.shape=i.outShape,N=ya({inputs:{x:q},backend:o}),N.shape=i.outShape,T.push(q)}else{var V=i.outHeight*i.outWidth,K=Oe({inputs:{x:n},backend:o,attrs:{shape:w?[i.batchSize,V,i.inChannels]:[i.batchSize,i.inChannels,V]}}),B=Oe({inputs:{x:a},backend:o,attrs:{shape:[1,i.inChannels,i.outChannels]}}),Z=mg({a:w?K:B,b:w?B:K,transposeA:!w,transposeB:k,backend:o,bias:u,activation:d,preluActivationWeights:c,leakyreluAlpha:h});N=Oe({inputs:{x:Z},backend:o,attrs:{shape:i.outShape}}),T.push(K),T.push(B),T.push(Z)}try{for(var j=ga(T),ee=j.next();!ee.done;ee=j.next()){var le=ee.value;o.disposeIntermediateTensorInfo(le)}}catch(se){e={error:se}}finally{try{ee&&!ee.done&&(t=j.return)&&t.call(j)}finally{if(e)throw e.error}}return N}function dV(r){var e,t,n=r.x,a=r.filter,i=r.convInfo,o=r.backend,s=r.bias,u=s===void 0?null:s,l=r.preluActivationWeights,c=l===void 0?null:l,f=r.leakyreluAlpha,h=f===void 0?0:f,p=r.activation,d=p===void 0?null:p,m=i.filterWidth,v=i.filterHeight,g=i.inChannels,y=i.outWidth,b=i.outHeight,w=i.dataFormat,x=w==="channelsLast",k=m*v*g,N=b*y,T=[i.batchSize,k,N],I=!0,F=!1,D=[];if(c!=null){var R=gg(c.shape,x);R!=null&&(c=Oe({inputs:{x:c},backend:o,attrs:{shape:R}}),D.push(c))}if(u!=null){var R=gg(u.shape,x);R!=null&&(u=Oe({inputs:{x:u},backend:o,attrs:{shape:R}}),D.push(u))}var P=Oe({inputs:{x:a},backend:o,attrs:{shape:[1,k,S.util.sizeFromShape(a.shape)/k]}});D.push(P);var B=new zGe(T,i),q=[n.shape,[i.padInfo.top,i.padInfo.left],[i.strideHeight,i.strideWidth],[i.dilationHeight,i.dilationWidth],[i.inChannels],[i.filterWidth*i.inChannels],[i.outWidth]],O=o.runWebGLProgram(B,[n],"float32",q),V=Oe({inputs:{x:O},backend:o,attrs:{shape:T}});D.push(O),D.push(V);var K=u!=null,Z=c!=null,j=d==="leakyrelu",ee=d?np(d,!0):null,le=new aV(x?V.shape:P.shape,x?P.shape:V.shape,x?[i.batchSize,N,i.outChannels]:[i.batchSize,i.outChannels,N],I,F,K,ee,Z,j),se=x?[V,P]:[P,V];if(u&&se.push(u),Z&&se.push(c),j){var ce=o.makeTensorInfo([],"float32",S.util.createScalarValue(h,"float32"));se.push(ce),D.push(ce)}var he=o.runWebGLProgram(le,se,"float32"),xe=Oe({inputs:{x:he},backend:o,attrs:{shape:i.outShape}});D.push(he);try{for(var Se=ga(D),we=Se.next();!we.done;we=Se.next()){var ke=we.value;o.disposeIntermediateTensorInfo(ke)}}catch(Ne){e={error:Ne}}finally{try{we&&!we.done&&(t=Se.return)&&t.call(Se)}finally{if(e)throw e.error}}return xe}function $Ge(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dataFormat,l=n.dilations,c=n.dimRoundingMode,f=S.backend_util.convertConv2DDataFormat(u),h=S.backend_util.computeConv2DInfo(a.shape,i.shape,o,l,s,c,!1,f),p;if(h.filterHeight===1&&h.filterWidth===1&&h.dilationHeight===1&&h.dilationWidth===1&&h.strideHeight===1&&h.strideWidth===1&&(h.padInfo.type==="SAME"||h.padInfo.type==="VALID"))p=pV({x:a,filter:i,convInfo:h,backend:t});else if(h.strideWidth<=2&&f==="channelsLast"&&S.env().getBool("WEBGL_EXP_CONV")){var d=new hV(h),m=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];p=t.runWebGLProgram(d,[a,i],"float32",m)}else if(S.env().getBool("WEBGL_CONV_IM2COL"))p=dV({x:a,filter:i,convInfo:h,backend:t});else{var d=new fV(h);p=t.runWebGLProgram(d,[a,i],"float32")}var v=Oe({inputs:{x:p},backend:t,attrs:{shape:h.outShape}});return t.disposeIntermediateTensorInfo(p),v}var WGe={kernelName:S.Conv2D,backendName:"webgl",kernelFunc:$Ge};var qGe=function(){function r(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,a=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yR = 0; yR < `+e.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+a+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+e.outWidth+`; yC++) {
              int xC = wC + yC * `+n+" - "+i+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              if (`+o+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}return r}(),VGe=function(){function r(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",s=t-1-e.padInfo.top,u=n-1-e.padInfo.left,l=o?1:2,c=o?2:3,f=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+s+", "+u+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+f+`];

        ivec2 dyCorner = ivec2(coords[`+l+"], coords["+c+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+a+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+n+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+n+` - 1 - wC;

            for (int d2 = 0; d2 < `+e.outChannels+`; d2++) {

              if (`+o+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}return r}(),GGe=function(){function r(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,a=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,s=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yF = 0; yF < `+e.outDepth+`; yF++) {
            int xF = wF + yF * `+t+" - "+i+`;

            if (xF < 0 || xF >= `+e.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+e.outHeight+`; yR++) {
              int xR = wR + yR * `+n+" - "+o+`;

              if (xR < 0 || xR >= `+e.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+e.outWidth+`; yC++) {
                int xC = wC + yC * `+a+" - "+s+`;

                if (xC < 0 || xC >= `+e.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}return r}(),UGe=function(){function r(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,a=e.filterWidth,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=t-1-e.padInfo.front,l=n-1-e.padInfo.top,c=a-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+u+", "+l+", "+c+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+t+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+i+`.0;

          if (dyF < 0.0 || dyF >= `+e.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+t+` - 1 - wF;

          for (int wR = 0; wR < `+n+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+n+` - 1 - wR;

            for (int wC = 0; wC < `+a+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+s+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+a+` - 1 - wC;

              for (int d2 = 0; d2 < `+e.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}return r}();function HGe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.pad,u=n.dataFormat,l=n.dimRoundingMode,c=n.filterShape,f=S.backend_util.convertConv2DDataFormat(u),h=S.backend_util.computeConv2DInfo(a.shape,c,o,1,s,l,!1,f),p=new qGe(h);return t.runWebGLProgram(p,[a,i],"float32")}var KGe={kernelName:S.Conv2DBackpropFilter,backendName:"webgl",kernelFunc:HGe};function jGe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.inputShape,s=n.strides,u=n.pad,l=n.dataFormat,c=n.dimRoundingMode,f=S.backend_util.convertConv2DDataFormat(l),h=S.backend_util.computeConv2DInfo(o,i.shape,s,1,u,c,!1,f),p=new VGe(h);return t.runWebGLProgram(p,[a,i],"float32")}var XGe={kernelName:S.Conv2DBackpropInput,backendName:"webgl",kernelFunc:jGe};function YGe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,l=S.backend_util.computeConv3DInfo(a.shape,i.shape,o,u,s),c=new LGe(l);return t.runWebGLProgram(c,[a,i],"float32")}var ZGe={kernelName:S.Conv3D,backendName:"webgl",kernelFunc:YGe};function JGe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.pad,u=n.filterShape,l=S.backend_util.computeConv3DInfo(a.shape,u,o,1,s),c=new GGe(l);return t.runWebGLProgram(c,[a,i],"float32")}var QGe={kernelName:S.Conv3DBackpropFilterV2,backendName:"webgl",kernelFunc:JGe};function eUe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.pad,s=n.strides,u=n.inputShape,l=S.backend_util.computeConv3DInfo(u,i.shape,s,1,o),c=new UGe(l);return t.runWebGLProgram(c,[a,i],"float32")}var tUe={kernelName:S.Conv3DBackpropInputV2,backendName:"webgl",kernelFunc:eUe};var rUe=_c+`
  return cos(x);
`,nUe=Ft({opSnippet:rUe}),aUe={kernelName:S.Cos,backendName:"webgl",kernelFunc:nUe};var iUe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,oUe=Ft({opSnippet:iUe}),sUe={kernelName:S.Cosh,backendName:"webgl",kernelFunc:oUe};var uUe=function(){function r(e,t,n,a,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=qe(e,4),s=o[0],u=o[1],l=o[2],c=o[3],f=qe(t,1),h=f[0],p=qe(n,2),d=p[0],m=p[1];this.outputShape=[h,d,m,c];var v=a==="bilinear"?1:0,g=qe([u-1+".0",l-1+".0"],2),y=g[0],b=g[1],w=qe(d>1?[""+(u-1)/(d-1),"(y2-y1) * height_ratio","y1*"+y+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+y],3),x=w[0],k=w[1],N=w[2],T=qe(m>1?[""+(l-1)/(m-1),"(x2-x1) * width_ratio","x1*"+b+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+b],3),I=T[0],F=T[1],D=T[2];this.userCode=`
      const float height_ratio = float(`+x+`);
      const float width_ratio = float(`+I+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+s+`) {
          return;
        }

        float height_scale = `+k+`;
        float width_scale = `+F+`;

        float in_y = `+N+`;
        if( in_y < 0.0 || in_y > `+y+` ) {
          setOutput(float(`+i+`));
          return;
        }
        float in_x = `+D+`;
        if( in_x < 0.0 || in_x > `+b+` ) {
          setOutput(float(`+i+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+v+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}return r}();var lUe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.image,i=e.boxes,o=e.boxInd,s=n.cropSize,u=n.method,l=n.extrapolationValue,c=new uUe(a.shape,i.shape,s,u,l);return t.runWebGLProgram(c,[a,i,o],"float32")},cUe={kernelName:S.CropAndResize,backendName:"webgl",kernelFunc:lUe},ip;(function(r){r.Prod="*",r.Sum="+"})(ip||(ip={}));var qW=function(){function r(e,t,n,a){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];var i=this.outputShape.length,o=this.op===ip.Prod?"1.0":"0.0",s=n?o:"getX("+VW(i,"coords",this.op)+")",u=this.outputShape[this.outputShape.length-1],l="",c="";n?(l=a?"end != "+(u-1):"end != 0",c=a?"end + 1":"end - 1"):(l=a?"end + pow2 < "+u:"end >= pow2",c=a?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        `+er(i)+` coords = getOutputCoords();
        int end = `+GW(i,"coords",this.op)+`;
        float val = `+s+`;
        int pow2 = int(pow(2.0, index));
        if (`+l+`) {
          int idx = `+c+`;
          `+GW(i,"coords",this.op)+` = idx;
          val `+this.op+"= getX("+VW(i,"coords",this.op)+`);
        }
        setOutput(val);
      }
    `}return r}();function VW(r,e,t){if(r===1)return""+e;if(r===2)return e+".x, "+e+".y";if(r===3)return e+".x, "+e+".y, "+e+".z";if(r===4)return e+".x, "+e+".y, "+e+".z, "+e+".w";throw new Error("Cumulative "+t+" for rank "+r+" is not yet supported")}function GW(r,e,t){if(r===1)return""+e;if(r===2)return e+".y";if(r===3)return e+".z";if(r===4)return e+".w";throw new Error("Cumulative "+t+" for rank "+r+" is not yet supported")}function vV(r,e,t,n,a,i){var o=e.shape.length,s=S.backend_util.getAxesPermutation([n],o),u=e;s!=null&&(u=An({inputs:{x:e},backend:t,attrs:{perm:s}}));var l=S.backend_util.getInnerMostAxes(1,o)[0];if(l!==o-1)throw new Error("WebGL cumprod shader expects an inner-most axis="+(e.shape.length-1)+" "+("but got axis="+n));for(var c=u.shape[l],f=ya({inputs:{x:u},backend:t}),h=0;h<=Math.ceil(Math.log2(c))-1;h++){var p=new qW(r,u.shape,!1,i),d=[[h]],m=f;f=t.runWebGLProgram(p,[f],f.dtype,d),t.disposeIntermediateTensorInfo(m)}if(a){var p=new qW(r,u.shape,a,i),m=f;f=t.runWebGLProgram(p,[f],f.dtype),t.disposeIntermediateTensorInfo(m)}if(s!=null){var v=S.backend_util.getUndoAxesPermutation(s),g=An({inputs:{x:f},backend:t,attrs:{perm:v}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(u),g}return f}function fUe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.exclusive,s=n.reverse;return vV(ip.Prod,a,t,i,o,s)}var hUe={kernelName:S.Cumprod,backendName:"webgl",kernelFunc:fUe};function pUe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.exclusive,s=n.reverse;return vV(ip.Sum,a,t,i,o,s)}var dUe={kernelName:S.Cumsum,backendName:"webgl",kernelFunc:pUe};function vUe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.weights,o=n.size,s=n.binaryOutput;if(a.shape.length===1){var u=t.readSync(a.dataId),l=t.readSync(i.dataId),c=jq(u,l,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,c)}else if(a.shape.length===2){var f=t.bufferSync(a),h=t.bufferSync(i),p=TWe(f,h,o,s);return t.makeTensorInfo(p.shape,i.dtype,p.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+(a.shape.length+"."))}var mUe={kernelName:S.DenseBincount,backendName:"webgl",kernelFunc:vUe};var gUe=function(){function r(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return r.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},r.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},r.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},r.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},r.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},r}();function yUe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockSize,o=n.dataFormat,s=a.shape[0],u=o==="NHWC"?a.shape[1]:a.shape[2],l=o==="NHWC"?a.shape[2]:a.shape[3],c=o==="NHWC"?a.shape[3]:a.shape[1],f=u*i,h=l*i,p=c/(i*i),d=o==="NHWC"?[s,f,h,p]:[s,p,f,h],m=new gUe(d,i,o);return t.runWebGLProgram(m,[a],a.dtype)}var bUe={kernelName:S.DepthToSpace,backendName:"webgl",kernelFunc:yUe};var mV=function(){function r(e,t,n,a,i){t===void 0&&(t=!1),n===void 0&&(n=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Dn(this.outputShape.length);var o=e.filterHeight,s=e.filterWidth,u=e.outChannels/e.inChannels,l="",c="";n&&(a?l=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:i?l=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          `+n+`
        }`:l=`
          float activation(float x) {
            `+n+`
          }
        `,c="result = activation(result);");var f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `+l+`

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+u+`;
        int q = d2 - d1 * `+u+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+o+`; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < `+s+`; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+f+`
        `+c+`
        setOutput(result);
      }
    `}return r}();var gV=function(){function r(e,t,n,a,i){t===void 0&&(t=!1),n===void 0&&(n=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Dn(this.outputShape.length);for(var o=e.outChannels/e.inChannels,s=e.padInfo.left,u=e.strideWidth,l=e.dilationWidth,c=e.filterHeight,f=e.filterWidth,h=f,p=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`,d=0;d<f;d++)p+=`
          vec4 xTexelC`+d*2+`;
          int xTexelC`+d*2+`Ready;
          vec4 xTexelC`+(d*2+1)+`;
          int xTexelC`+(d*2+1)+`Ready;
          vec4 xC`+d+";";p+=`
    for (int r = 0; r < `+c+`; r++) {
      `;for(var d=0;d<f;d++)p+=`
          xTexelC`+d*2+` = vec4(0.0);
          xTexelC`+d*2+`Ready = 0;
          xTexelC`+(d*2+1)+` = vec4(0.0);
          xTexelC`+(d*2+1)+`Ready = 0;
          xC`+d+" = vec4(0.0);";p+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(var m=0;m<(h+1)/2;m++){var v=m*2;if(p+=`
          xC = xCCorner + `+v*l+`;
          `,u===1){if(v<f&&(s%2===1?(p+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`+v+`Ready == 0) {
                  xTexelC`+v+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`+v+`.zw = vec2(0.0);
                  }
                  xTexelC`+v+`Ready = 1;
                }
              `,l===1&&v>0?p+=`
                xC`+v+" = vec4(xTexelC"+(v-2)+".zw, xTexelC"+v+`.xy);
                `:p+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC`+v+" = vec4(previous.zw, xTexelC"+v+`.xy);
                  } else {
                    xC`+v+" = vec4(0.0, 0.0, xTexelC"+v+`.xy);
                  }
                  `):p+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC`+v+`Ready == 0) {
                  xTexelC`+v+` = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC`+v+`.zw = vec2(0.0);
                  }
                  xTexelC`+v+`Ready = 1;
                }

                xC`+v+" = xTexelC"+v+`;
                `,v+1<f)){var g=s%2===0?S.util.nearestLargerEven(l):l;l%2===0&&s%2===1||l%2!==0&&s%2!==1?(p+=`
                  xCOffset = xC + imod(pads[1], 2) + `+g+`;

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`+(v+1)+`Ready == 0) {
                    xTexelC`+(v+1)+` = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC`+(v+1)+`.zw = vec2(0.0);
                    }
                    xTexelC`+(v+1)+`Ready = 1;
                  }
                  `,l>1?p+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC`+(v+1)+" = vec4(previous.zw, xTexelC"+(v+1)+`.xy);
                    } else {
                     xC`+(v+1)+" = vec4(0.0, 0.0, xTexelC"+(v+1)+`.xy);
                    }
                    `:p+=`
                    xC`+(v+1)+" = vec4(xTexelC"+v+".zw, xTexelC"+(v+1)+`.xy);
                    `):g===1?p+=`
                    xC`+(v+1)+" = xTexelC"+v+`;
                    `:p+=`
                    xCOffset = xC + `+g+`;

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`+(v+1)+`Ready == 0) {
                      xTexelC`+(v+1)+` = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC`+(v+1)+`.zw = vec2(0.0);
                      }
                      xTexelC`+(v+1)+`Ready = 1;
                    }

                    xC`+(v+1)+" = xTexelC"+(v+1)+`;
                    `}}else v<f&&(s%2===1?(p+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`+v+`Ready == 0) {
                  xTexelC`+v+` = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`+v+`.zw = vec2(0.0);
                  }
                  xTexelC`+v+`Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC`+(v+1)+`Ready == 0) {
                  xTexelC`+(v+1)+` = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC`+(v+1)+`.zw = vec2(0.0);
                  }
                  xTexelC`+(v+1)+`Ready = 1;
                }

                xC`+v+" = vec4(xTexelC"+v+".zw, xTexelC"+(v+1)+`.zw);
              `,v+1<f&&(p+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC`+(v+1)+" = vec4(xTexelC"+(v+1)+`.xy, final.xy);
                `)):(p+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC`+v+`Ready == 0) {
                  xTexelC`+v+` = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC`+v+`.zw = vec2(0.0);
                  }
                  xTexelC`+v+`Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`+(v+1)+`Ready == 0) {
                  xTexelC`+(v+1)+` = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`+(v+1)+`.zw = vec2(0.);
                  }
                  xTexelC`+(v+1)+`Ready = 1;
                }

                xC`+v+` = vec4(
                  xTexelC`+v+".xy, xTexelC"+(v+1)+`.xy);
              `,v+1<f&&(p+=`
                  xC`+(v+1)+" = vec4(xTexelC"+v+".zw, xTexelC"+(v+1)+`.zw);
                `)));v<f&&(p+=`
            wTexel = getW(r, `+v+`, d1, q);
            dotProd += xC`+v+` * vec4(wTexel.xz, wTexel.xz);
          `,v+1<f&&(p+=`
              wTexel = getW(r, `+(v+1)+`, d1, q);
              dotProd += xC`+(v+1)+` * vec4(wTexel.xz, wTexel.xz);
            `))}p+=`
    }
  `,p+=`
      }
    `;var y="",b="";n&&(a?y=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+n+`
        }`:i?y=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          `+n+`
        }`:y=`vec4 activation(vec4 x) {
          `+n+`
        }`,b="result = activation(result);");var w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `+y+`

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+o+`;
        int q = d2 - d1 * `+o+`;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        `+p+`

        vec4 result = dotProd - vec4(0.000000000000001);
        `+w+`
        `+b+`
        setOutput(result);
      }
    `}return r}();function wUe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,l=n.dimRoundingMode,c=u;c==null&&(c=[1,1]),S.util.assert(S.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+("1. Got strides "+o+" and dilations '"+c+"'")});var f=S.backend_util.computeConv2DInfo(a.shape,i.shape,o,c,s,l,!0),h;S.env().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?h=new gV(f):h=new mV(f);var p=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return t.runWebGLProgram(h,[a,i],"float32",p)}var xUe={kernelName:S.DepthwiseConv2dNative,backendName:"webgl",kernelFunc:wUe};var kUe=function(){function r(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,a=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+o+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+e.batchSize+`; b++) {
          for (int yR = 0; yR < `+e.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+a+`;

            if (xR < 0 || xR >= `+e.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+e.outWidth+`; yC++) {
              int xC = wC + yC * `+n+" - "+i+`;

              if (xC < 0 || xC >= `+e.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}return r}(),SUe=function(){function r(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,s=n-1-e.padInfo.left,u=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+a+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+n+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+n+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+u+`; dm++) {
              int d2 = d1 * `+u+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}return r}();function NUe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.dilations,u=n.pad,l=n.dimRoundingMode,c=n.filterShape,f=S.backend_util.computeConv2DInfo(a.shape,c,o,s,u,l,!0),h=new kUe(f);return t.runWebGLProgram(h,[a,i],"float32")}var EUe={kernelName:S.DepthwiseConv2dNativeBackpropFilter,backendName:"webgl",kernelFunc:NUe};function TUe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.strides,s=n.dilations,u=n.pad,l=n.dimRoundingMode,c=n.inputShape,f=S.backend_util.computeConv2DInfo(c,i.shape,o,s,u,l,!0),h=new SUe(f);return t.runWebGLProgram(h,[a,i],"float32")}var IUe={kernelName:S.DepthwiseConv2dNativeBackpropInput,backendName:"webgl",kernelFunc:TUe};var CUe=function(){function r(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}return r}();function AUe(r){var e=r.inputs,t=r.backend,n=e.x,a=Xr(n.shape,n.shape),i=S.util.sizeFromShape(n.shape),o=Oe({inputs:{x:n},backend:t,attrs:{shape:[i]}}),s=new CUe(i),u=t.runWebGLProgram(s,[o],o.dtype),l=Oe({inputs:{x:u},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(u),l}var _Ue={kernelName:S.Diag,backendName:"webgl",kernelFunc:AUe};var DUe=function(){function r(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.inHeight,n=e.inWidth,a=e.padInfo,i=e.strideHeight,o=e.strideWidth,s=e.filterHeight,u=e.filterWidth,l=e.dilationHeight,c=e.dilationWidth,f=a.top,h=a.left;this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+o+`);
      const ivec2 pads = ivec2(`+f+", "+h+`);
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < `+s+`; h++) {
          int hIn = hBeg + h * `+l+`;

          if (hIn >= 0 && hIn < `+t+`) {
            for (int w = 0; w < `+u+`; w++) {
              int wIn = wBeg + w * `+c+`;

              if (wIn >= 0 && wIn < `+n+`) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}return r}();function FUe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,l=S.backend_util.computeDilation2DInfo(a.shape,i.shape,o,s,"NHWC",u),c,f=new DUe(l);c=t.runWebGLProgram(f,[a,i],"float32");var h=Oe({inputs:{x:c},backend:t,attrs:{shape:l.outShape}});return t.disposeIntermediateTensorInfo(c),h}var RUe={kernelName:S.Dilation2D,backendName:"webgl",kernelFunc:FUe};function OUe(r){var e,t,n,a,i=r.inputs,o=r.backend,s=r.attrs,u=s.equation,l=i,c=S.backend_util.decodeEinsumEquation(u,l.length),f=c.allDims,h=c.summedDims,p=c.idDims;S.backend_util.checkEinsumDimSizes(f.length,p,l);for(var d=S.backend_util.getEinsumComputePath(h,p),m=d.path,v=d.steps,g=v.length,y=null,b=f.length,w=[],x=0;x<g;++x){try{for(var k=(e=void 0,ga(v[x])),N=k.next();!N.done;N=k.next()){var T=N.value,I=S.backend_util.getEinsumPermutation(b,p[T]),F=I.permutationIndices,D=I.expandDims,R=void 0;S.backend_util.isIdentityPermutation(F)?R=l[T]:(R=An({inputs:{x:l[T]},backend:o,attrs:{perm:F}}),w.push(R));for(var P=R.shape.slice(),B=0;B<D.length;++B)P.splice(D[B],0,1);S.util.arraysEqual(R.shape,P)||(R=Oe({inputs:{x:R},backend:o,attrs:{shape:P}}),w.push(R)),y===null?y=R:(y=Hk({inputs:{a:R,b:y},backend:o}),w.push(y))}}catch(K){e={error:K}}finally{try{N&&!N.done&&(t=k.return)&&t.call(k)}finally{if(e)throw e.error}}x<g-1&&(m[x]>=0&&(y=xg({inputs:{x:y},backend:o,attrs:{axis:m[x]-(f.length-b),keepDims:!1}}),w.push(y)),b--)}try{for(var q=ga(w),O=q.next();!O.done;O=q.next()){var V=O.value;V!==y&&o.disposeIntermediateTensorInfo(V)}}catch(K){n={error:K}}finally{try{O&&!O.done&&(a=q.return)&&a.call(q)}finally{if(n)throw n.error}}return y}var PUe={kernelName:S.Einsum,backendName:"webgl",kernelFunc:OUe};var MUe="return (x >= 0.0) ? x : (exp(x) - 1.0);",BUe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,LUe=Ft({opSnippet:MUe,packedOpSnippet:BUe}),zUe={kernelName:S.Elu,backendName:"webgl",kernelFunc:LUe};var $Ue="return (b >= 1.0) ? a : a * (b + 1.0);",WUe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,qUe=function(r){var e=r.inputs,t=r.backend,n=e.dy,a=e.y,i=S.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new lp(WUe,n.shape,a.shape):new Sc($Ue,n.shape,a.shape);return t.runWebGLProgram(i,[n,a],n.dtype)},VUe={kernelName:S.EluGrad,backendName:"webgl",kernelFunc:qUe};var GUe=`
  return vec4(equal(a, b));
`,UUe="return float(a == b);",HUe=mn({opSnippet:UUe,packedOpSnippet:GUe,dtype:"bool",cpuKernelImpl:_We}),KUe={kernelName:S.Equal,backendName:"webgl",kernelFunc:HUe};var jUe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = `+S.backend_util.ERF_P+`;
  float a1 = `+S.backend_util.ERF_A1+`;
  float a2 = `+S.backend_util.ERF_A2+`;
  float a3 = `+S.backend_util.ERF_A3+`;
  float a4 = `+S.backend_util.ERF_A4+`;
  float a5 = `+S.backend_util.ERF_A5+`;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,XUe=Ft({opSnippet:jUe}),YUe={kernelName:S.Erf,backendName:"webgl",kernelFunc:XUe};var ZUe=_c+`
  return exp(x);
`,JUe=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,yV=Ft({opSnippet:ZUe,packedOpSnippet:JUe,cpuKernelImpl:DWe,dtype:"float32"}),QUe={kernelName:S.Exp,backendName:"webgl",kernelFunc:yV};function Fk(r){var e=r.inputs,t=r.attrs,n=r.backend,a=t.dim,i=e.input,o=i.shape.length,s=i.shape.slice(),u=a;return a<0&&(S.util.assert(-(o+1)<=a,function(){return"Axis must be in the interval ["+-(o+1)+", "+o+"]"}),u=o+a+1),s.splice(u,0,1),Oe({inputs:{x:i},backend:n,attrs:{shape:s}})}var e6e={kernelName:S.ExpandDims,backendName:"webgl",kernelFunc:Fk};var UW="return exp(x) - 1.0;",t6e=Ft({opSnippet:UW,packedOpSnippet:UW,cpuKernelImpl:FWe}),r6e={kernelName:S.Expm1,backendName:"webgl",kernelFunc:t6e};var HW=function(){function r(e,t,n){this.variableNames=["real","imag"];var a=t[1];this.outputShape=t;var i=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,o=n?a+".0":"1.0",s;if(e==="real")s="return real * expR - imag * expI;";else if(e==="imag")s="return real * expI + imag * expR;";else throw new Error('FFT component must be either "real" or "imag", got '+e+".");this.userCode=`
      const float exponentMultiplier = `+i+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+s+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+a+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+a+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+o+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}return r}();function bV(r,e,t){var n=t.texData.get(r.dataId),a=S.util.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],o=a/i,s=Oe({inputs:{x:r},backend:t,attrs:{shape:[o,i]}}),u=s.shape,l=new HW("real",u,e),c=new HW("imag",u,e),f=[{dataId:n.complexTensorInfos.real.dataId,dtype:n.complexTensorInfos.real.dtype,shape:u},{dataId:n.complexTensorInfos.imag.dataId,dtype:n.complexTensorInfos.imag.dtype,shape:u}],h=t.runWebGLProgram(l,f,"float32"),p=t.runWebGLProgram(c,f,"float32"),d=Es({inputs:{real:h,imag:p},backend:t});t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p);var m=Oe({inputs:{x:d},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(d),m}function n6e(r){var e=r.inputs,t=r.backend,n=e.input;return bV(n,!1,t)}var a6e={kernelName:S.FFT,backendName:"webgl",kernelFunc:n6e};var i6e=function(){function r(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return r}();function fp(r){var e=r.backend,t=r.attrs,n=t.shape,a=t.value,i=t.dtype;if(i=i||S.util.inferDtype(a),i==="string"){var o=S.util.getArrayFromDType(i,S.util.sizeFromShape(n));return o.fill(a),e.makeTensorInfo(n,i,o)}else{var s=new i6e(n,a),u=[[a]];return e.runWebGLProgram(s,[],i,u)}}var o6e={kernelName:S.Fill,backendName:"webgl",kernelFunc:fp};var s6e=function(){function r(e){this.variableNames=["Image"],this.outputShape=[];var t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = `+t+` - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < `+t+`) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}return r}();var u6e={kernelName:S.FlipLeftRight,backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e.image,a=t,i=new s6e(n.shape),o=a.runWebGLProgram(i,[n],n.dtype);return o}};var KW="return floor(x);",l6e=Ft({opSnippet:KW,packedOpSnippet:KW,cpuKernelImpl:RWe}),c6e={kernelName:S.Floor,backendName:"webgl",kernelFunc:l6e};var f6e=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,h6e=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,p6e=mn({opSnippet:f6e,packedOpSnippet:h6e,dtype:"int32"}),d6e={kernelName:S.FloorDiv,backendName:"webgl",kernelFunc:p6e},v6e=function(){function r(e){this.variableNames=["A"];var t=_n(),n=qe(e,2),a=n[0],i=n[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+i+".0, "+a+`.0);

        vec4 values = `+t.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}return r}(),m6e=function(){function r(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=_n(),n=qe(e,2),a=n[0],i=n[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+i+".0, "+a+`.0);
            vec4 values = `+t.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+t.output+` = result;
      }
    `}return r}(),g6e={kernelName:S.FromPixels,backendName:"webgl",kernelFunc:y6e},bc,Sk=S.env().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function y6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.pixels,i=n.numChannels,o=typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement,u=qe(o?[a.videoWidth,a.videoHeight]:[a.width,a.height],2),l=u[0],c=u[1],f=[c,l],h=[c,l,i];if(s||o){var p=S.env().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(bc==null||p!==Sk)&&(Sk=p,bc=document.createElement("canvas").getContext("2d",{willReadFrequently:Sk})),bc.canvas.width=l,bc.canvas.height=c,bc.drawImage(a,0,0,l,c),a=bc.canvas}var d=t.makeTensorInfo(f,"int32");t.texData.get(d.dataId).usage=Ra.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(d.dataId),a);var m=S.env().getBool("WEBGL_PACK")?new m6e(h):new v6e(h),v=t.runWebGLProgram(m,[d],"int32");return t.disposeData(d.dataId),v}function b6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=n.strides,l=n.pad,c=n.dataFormat,f=n.dilations,h=n.dimRoundingMode,p=n.activation,d=n.leakyreluAlpha,m=S.backend_util.convertConv2DDataFormat(c),v=S.backend_util.computeConv2DInfo(a.shape,i.shape,u,f,l,h,!1,m),g,y=[],b=o!=null,w=s!=null,x=p==="leakyrelu",k=function(){var P=[a,i],B=function(O,V){if(V==="NCHW"&&O.shape.length===1&&O.shape[0]!==1){var K=Oe({inputs:{x:O},backend:t,attrs:{shape:[O.shape[0],1,1]}});return y.push(K),K}return O};if(b&&P.push(B(o,c)),w&&P.push(B(s,c)),x){var q=t.makeTensorInfo([],"float32",S.util.createScalarValue(d,"float32"));P.push(q),y.push(q)}return P};if(v.filterHeight===1&&v.filterWidth===1&&v.dilationHeight===1&&v.dilationWidth===1&&v.strideHeight===1&&v.strideWidth===1&&(v.padInfo.type==="SAME"||v.padInfo.type==="VALID"))g=pV({x:a,filter:i,convInfo:v,backend:t,bias:o,activation:p,preluActivationWeights:s,leakyreluAlpha:d});else if(v.strideWidth<=2&&m==="channelsLast"&&S.env().getBool("WEBGL_EXP_CONV")){var N=p?np(p,!0):null,T=new hV(v,b,N,w,x),I=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],F=k();g=t.runWebGLProgram(T,F,"float32",I)}else if(S.env().getBool("WEBGL_CONV_IM2COL"))g=dV({x:a,filter:i,convInfo:v,backend:t,bias:o,activation:p,preluActivationWeights:s,leakyreluAlpha:d});else{var N=p?np(p,!1):null,T=new fV(v,b,N,w,x),D=k();g=t.runWebGLProgram(T,D,"float32")}var R=Oe({inputs:{x:g},backend:t,attrs:{shape:v.outShape}});return y.push(g),y.forEach(function(P){return t.disposeIntermediateTensorInfo(P)}),R}var w6e={kernelName:S.FusedConv2D,backendName:"webgl",kernelFunc:b6e};function x6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=n.strides,l=n.pad,c=n.dilations,f=n.dimRoundingMode,h=n.activation,p=n.leakyreluAlpha,d=[],m=c;m==null&&(m=[1,1]),S.util.assert(S.backend_util.eitherStridesOrDilationsAreOne(u,m),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+("1. Got strides "+u+" and dilations '"+m+"'")});var v=S.backend_util.computeConv2DInfo(a.shape,i.shape,u,m,l,f,!0),g=S.env().getBool("WEBGL_PACK_DEPTHWISECONV")&&v.strideWidth<=2&&v.outChannels/v.inChannels===1,y=h?np(h,g):null,b=[a,i],w=o!=null,x=s!=null,k=h==="leakyrelu";if(w&&b.push(o),x&&b.push(s),k){var N=t.makeTensorInfo([],"float32",S.util.createScalarValue(p,"float32"));b.push(N),d.push(N)}var T;g?T=new gV(v,w,y,x,k):T=new mV(v,w,y,x,k);var I=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],F=t.runWebGLProgram(T,b,"float32",I);return d.forEach(function(D){return t.disposeIntermediateTensorInfo(D)}),F}var k6e={kernelName:S.FusedDepthwiseConv2D,backendName:"webgl",kernelFunc:x6e},S6e=function(){function r(e,t,n,a){this.sliceDim=e,this.strides=t,this.paramsShape=a,this.variableNames=["x","indices"],this.outputShape=n;for(var i=er(n.length),o=`
    int index;`,s=0;s<this.sliceDim;s++)o+=`
          index = round(getIndices(coords[0], `+s+`));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= `+this.paramsShape[s]+`;
          flattenIndex += index * `+this.strides[s]+";";this.userCode=`
         void main() {
          `+i+` coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          `+o+`

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}return r}();function N6e(r){var e=r.inputs,t=r.backend,n=e.params,a=e.indices,i=a.shape,o=i[i.length-1],s=S.util.sizeFromShape(n.shape),u=qe(S.backend_util.prepareAndValidate(n,a),4),l=u[0],c=u[1],f=u[2],h=u[3],p=Oe({inputs:{x:a},backend:t,attrs:{shape:[c,o]}}),d=Oe({inputs:{x:n},backend:t,attrs:{shape:[S.util.sizeFromShape(n.shape)/f,f]}});if(t.shouldExecuteOnCPU([n,a])||n.dtype==="string"){var m=t.readSync(a.dataId),v=t.bufferSync(n),g=OWe(m,v,n.dtype,c,o,f,h,n.shape,s);return t.makeTensorInfo(l,n.dtype,g.values)}var y=new S6e(o,h,[c,f],n.shape),b=t.runWebGLProgram(y,[d,p],d.dtype),w=Oe({inputs:{x:b},backend:t,attrs:{shape:l}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(b),w}var E6e={kernelName:S.GatherNd,backendName:"webgl",kernelFunc:N6e};var T6e=function(){function r(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;var n=er(this.rank),a=I6e(e);this.userCode=`
      void main() {
        `+n+` resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < `+e[2]+`) ? 1.0 : 0.0;
        setOutput(inBounds * getA(`+a+`));
      }
    `}return r}();function I6e(r,e){for(var t=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[],a=0;a<r.length;a++)a===2?n.push("index"):n.push(""+t[a]);return n.join()}function wV(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.indices,o=n.axis,s=n.batchDims,u=S.util.parseAxisParam(o,a.shape)[0];if(S.env().get("DEBUG"))for(var l=t.readSync(i.dataId),c=a.shape[u],f=function(I){var F=l[I];S.util.assert(F<=c-1&&F>=0,function(){return"GatherV2: the index value "+F+" is not in [0, "+(c-1)+"]"})},h=0;h<l.length;++h)f(h);var p=S.backend_util.segment_util.collectGatherOpShapeInfo(a,i,u,s),d=S.util.sizeFromShape(i.shape),m=[],v=Oe({inputs:{x:a},backend:t,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),g=Oe({inputs:{x:i},backend:t,attrs:{shape:[p.batchSize,d/p.batchSize]}});m.push(v),m.push(g);var y=[p.batchSize,p.outerSize,d/p.batchSize,p.sliceSize];if(t.shouldExecuteOnCPU([a,i])||a.dtype==="string"){var b=t.bufferSync(g),w=t.bufferSync(v),x=PWe(w,b,y);return m.forEach(function(I){return t.disposeIntermediateTensorInfo(I)}),t.makeTensorInfo(p.outputShape,x.dtype,x.values)}var k=new T6e(v.shape,y),N=t.runWebGLProgram(k,[v,g],v.dtype);m.push(N);var T=Oe({inputs:{x:N},backend:t,attrs:{shape:p.outputShape}});return m.forEach(function(I){return t.disposeIntermediateTensorInfo(I)}),T}var C6e={kernelName:S.GatherV2,backendName:"webgl",kernelFunc:wV};var A6e="return float(a > b);",_6e=`
  return vec4(greaterThan(a, b));
`,D6e=mn({opSnippet:A6e,packedOpSnippet:_6e,cpuKernelImpl:MWe,dtype:"bool"}),F6e={kernelName:S.Greater,backendName:"webgl",kernelFunc:D6e};var R6e="return float(a >= b);",O6e=`
  return vec4(greaterThanEqual(a, b));
`,P6e=mn({opSnippet:R6e,packedOpSnippet:O6e,dtype:"bool",cpuKernelImpl:BWe}),M6e={kernelName:S.GreaterEqual,backendName:"webgl",kernelFunc:P6e};function B6e(r){var e=r.inputs,t=r.backend,n=e.input;return bV(n,!0,t)}var L6e={kernelName:S.IFFT,backendName:"webgl",kernelFunc:B6e};var z6e="return float(!isnan(x) && !isinf(x));",$6e=Ft({opSnippet:z6e,dtype:"bool"}),W6e={kernelName:S.IsFinite,backendName:"webgl",kernelFunc:$6e};var q6e="return float(isinf(x));",V6e=Ft({opSnippet:q6e,dtype:"bool"}),G6e={kernelName:S.IsInf,backendName:"webgl",kernelFunc:V6e};var U6e="return float(isnan(x));",H6e=Ft({opSnippet:U6e,dtype:"bool"}),K6e={kernelName:S.IsNan,backendName:"webgl",kernelFunc:H6e};var j6e="return float(a < b);",X6e=`
  return vec4(lessThan(a, b));
`,Y6e=mn({opSnippet:j6e,packedOpSnippet:X6e,cpuKernelImpl:LWe,dtype:"bool"}),Z6e={kernelName:S.Less,backendName:"webgl",kernelFunc:Y6e};var J6e="return float(a <= b);",Q6e=`
  return vec4(lessThanEqual(a, b));
`,eHe=mn({opSnippet:J6e,packedOpSnippet:Q6e,cpuKernelImpl:zWe,dtype:"bool"}),tHe={kernelName:S.LessEqual,backendName:"webgl",kernelFunc:eHe};function rHe(r){var e=r.backend,t=r.attrs,n=t.start,a=t.stop,i=t.num,o=$We(n,a,i);return e.makeTensorInfo([o.length],"float32",o)}var nHe={kernelName:S.LinSpace,backendName:"webgl",kernelFunc:rHe};var aHe=_c+`
  return x < 0.0 ? 0./0. : log(x);
`,iHe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,oHe=Ft({opSnippet:aHe,packedOpSnippet:iHe,cpuKernelImpl:WWe}),sHe={kernelName:S.Log,backendName:"webgl",kernelFunc:oHe};var uHe=_c+`
  return log(1.0 + x);
`,lHe=Ft({opSnippet:uHe}),cHe={kernelName:S.Log1p,backendName:"webgl",kernelFunc:lHe};var fHe="return float(a >= 1.0 && b >= 1.0);",hHe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,pHe=mn({opSnippet:fHe,packedOpSnippet:hHe,dtype:"bool"}),dHe={kernelName:S.LogicalAnd,backendName:"webgl",kernelFunc:pHe};var vHe="return float(!(x >= 1.0));",mHe=Ft({opSnippet:vHe}),gHe={kernelName:S.LogicalNot,backendName:"webgl",kernelFunc:mHe};var yHe="return float(a >= 1.0 || b >= 1.0);",bHe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,wHe=mn({opSnippet:yHe,packedOpSnippet:bHe,dtype:"bool"}),xHe={kernelName:S.LogicalOr,backendName:"webgl",kernelFunc:wHe};var kHe=function(){function r(e,t,n,a,i){this.variableNames=["x"],this.outputShape=[];var o=t,s=e[3]-1;this.outputShape=e;var u,l="float("+n+") + float("+a+") * sum";i===.5?u="inversesqrt("+l+")":i===1?u="1.0/("+l+")":u="exp(log("+l+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+o+"; j <= "+o+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+u+`;
        setOutput(val);
      }
    `}return r}();var SHe=function(){function r(e,t,n,a,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o=t,s=e[3]-1;this.outputShape=e;var u,l="float("+n+") + float("+a+") * sum";i===.5?u="inversesqrt("+l+")":i===1?u="1.0/("+l+")":u="exp(log("+l+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+o+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+o+"; j <= "+o+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+s+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+u+`;
        setOutput(result);
      }
    `}return r}();var NHe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.depthRadius,o=n.bias,s=n.alpha,u=n.beta,l=S.env().getBool("WEBGL_PACK_NORMALIZATION")?new SHe(a.shape,i,o,s,u):new kHe(a.shape,i,o,s,u);return t.runWebGLProgram(l,[a],a.dtype)},EHe={kernelName:S.LRN,backendName:"webgl",kernelFunc:NHe};var THe=function(){function r(e,t,n,a,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=a,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+t+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+t+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+a+") * norm + float("+n+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+a+`)
                * float(`+i+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+i+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}return r}();var IHe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.y,o=e.dy,s=n.depthRadius,u=n.bias,l=n.alpha,c=n.beta,f=new THe(a.shape,s,u,l,c);return t.runWebGLProgram(f,[a,i,o],a.dtype)},CHe={kernelName:S.LRNGrad,backendName:"webgl",kernelFunc:IHe};function AHe(r,e,t,n){var a=S.util.sizeFromShape(e),i=S.util.sizeFromShape(r.shape),o=i/a,s=Oe({inputs:{x:r},attrs:{shape:[o,a]},backend:n}),u=ju(s,r.dtype,"max",n),l=Oe({inputs:{x:u},attrs:{shape:t},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),l}function xV(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.reductionIndices,o=n.keepDims,s=a.shape.length,u=S.util.parseAxisParam(i,a.shape),l=u,c=S.backend_util.getAxesPermutation(l,s),f=c!=null,h=t.shouldExecuteOnCPU([a]),p=a;if(f){if(h){for(var d=t.texData.get(p.dataId),m=d.values,v=new Array(s),g=0;g<v.length;g++)v[g]=a.shape[c[g]];var y=Vk(m,a.shape,a.dtype,c,v);p=t.makeTensorInfo(v,a.dtype);var b=t.texData.get(p.dataId);b.values=y}else p=wg(a,c,t);l=S.backend_util.getInnerMostAxes(l.length,s)}S.backend_util.assertAxesAreInnerMostDims("max",l,s);var w=qe(S.backend_util.computeOutAndReduceShapes(p.shape,l),2),x=w[0],k=w[1],N=x;o&&(N=S.backend_util.expandShapeToKeepDim(x,u));var T;if(h){var d=t.texData.get(p.dataId),m=d.values,I=qWe(m,S.util.sizeFromShape(k),N,a.dtype);T=t.makeTensorInfo(N,a.dtype);var F=t.texData.get(T.dataId);F.values=I}else T=AHe(p,k,N,t);return f&&t.disposeIntermediateTensorInfo(p),T}var _He={kernelName:S.Max,backendName:"webgl",kernelFunc:xV};var DHe=Uk+`
  return max(a, b);
`,FHe=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+up+`
  return result;
`,RHe=mn({opSnippet:DHe,packedOpSnippet:FHe,cpuKernelImpl:VWe}),OHe={kernelName:S.Maximum,backendName:"webgl",kernelFunc:RHe};function PHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;Ec(a,"maxPool");var i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,l=1;S.util.assert(S.backend_util.eitherStridesOrDilationsAreOne(o,l),function(){return"Error in maxPool: Either strides or dilations must be 1. "+("Got strides "+o+" and dilations '"+l+"'")});var c=S.backend_util.computePool2DInfo(a.shape,i,o,l,s,u);if(c.filterWidth===1&&c.filterHeight===1&&S.util.arraysEqual(c.inShape,c.outShape))return ya({inputs:{x:a},backend:t});var f=new ap(c,"max",!1);return t.runWebGLProgram(f,[a],a.dtype)}var MHe={kernelName:S.MaxPool,backendName:"webgl",kernelFunc:PHe};function BHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.dataFormat,l=n.dimRoundingMode,c=[1,1,1],f=S.backend_util.computePool3DInfo(a.shape,i,o,c,s,l,u),h=new Kk(f,"max",!1);return t.runWebGLProgram(h,[a],a.dtype)}var LHe={kernelName:S.MaxPool3D,backendName:"webgl",kernelFunc:BHe};var zHe=function(){function r(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,a=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,s=i-1-e.padInfo.top,u=o-1-e.padInfo.left,l=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(`+s+", "+u+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+i+`;
          wR += `+a+`) {
          float dyR = float(dyRCorner + wR) / `+t+`.0;

          if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+o+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+n+`.0;

            if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+l+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+o+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}return r}(),$He=function(){function r(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,a=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterDepth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,f=u-1-e.padInfo.front,h=l-1-e.padInfo.top,p=c-1-e.padInfo.left,d=u*l*c-1;this.userCode=`
      const ivec3 pads = ivec3(`+f+", "+h+", "+p+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+u+`;
           wD += `+i+`) {
          float dyD = float(dyDCorner + wD) / `+t+`.0;

          if (dyD < 0.0 || dyD >= `+e.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+l+`;
              wR += `+o+`) {
            float dyR = float(dyRCorner + wR) / `+n+`.0;

            if (dyR < 0.0 || dyR >= `+e.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+c+`;
                wC += `+s+`) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+e.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+d+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+l+" * "+c+` +
                  wR * `+c+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}return r}();function WHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=i,s=n.filterSize,u=n.strides,l=n.pad,c=n.dimRoundingMode,f=[1,1,1],h=S.backend_util.computePool3DInfo(o.shape,s,u,f,l,c),p=new Kk(h,"max",!0),d=t.runWebGLProgram(p,[o],o.dtype),m=new $He(h),v=t.runWebGLProgram(m,[a,d],o.dtype);return t.disposeIntermediateTensorInfo(d),v}var qHe={kernelName:S.MaxPool3DGrad,backendName:"webgl",kernelFunc:WHe};function VHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=e.output,s=i;Ec([i,o],"maxPoolGrad");var u=n.filterSize,l=n.strides,c=n.pad,f=n.dimRoundingMode,h=S.backend_util.computePool2DInfo(s.shape,u,l,1,c,f),p=!0,d=new ap(h,"max",p),m=t.runWebGLProgram(d,[s],s.dtype),v=new zHe(h),g=t.runWebGLProgram(v,[a,m],s.dtype);return t.disposeIntermediateTensorInfo(m),g}var GHe={kernelName:S.MaxPoolGrad,backendName:"webgl",kernelFunc:VHe};function UHe(r,e,t,n){var a=new ap(t,"max",!1),i=n.runWebGLProgram(a,[r],"float32");a=new ap(t,"max",!0,!0,e);var o=n.runWebGLProgram(a,[r],"float32");return[i,o]}var HHe={kernelName:S.MaxPoolWithArgmax,backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.x,i=t.filterSize,o=t.strides,s=t.pad,u=t.includeBatchInIndex,l=n;S.util.assert(a.shape.length===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+a.shape.length+"."});var c=[1,1];S.util.assert(S.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in maxPool: Either strides or dilations must be 1. "+("Got strides "+o+" and dilations '"+c+"'")});var f=S.backend_util.computePool2DInfo(a.shape,i,o,c,s),h=qe(UHe(a,u,f,l),2),p=h[0],d=h[1];return[p,d]}};function KHe(r,e,t,n){var a=S.util.sizeFromShape(e),i=S.util.sizeFromShape(r.shape),o=i/a,s=Oe({inputs:{x:r},attrs:{shape:[o,a]},backend:n}),u=ju(s,"float32","mean",n),l=Oe({inputs:{x:u},attrs:{shape:t},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),l}var jHe={kernelName:S.Mean,backendName:"webgl",kernelFunc:function(r){var e,t,n=r.inputs,a=r.attrs,i=r.backend,o=n.x,s=a.keepDims,u=a.axis,l=i,c=o.shape.length,f=S.util.parseAxisParam(u,o.shape),h=f,p=S.backend_util.getAxesPermutation(h,c),d=p!=null,m=l.shouldExecuteOnCPU([o]),v=[],g=o;if(d){if(m){for(var y=l.texData.get(g.dataId),b=y.values,w=new Array(c),x=0;x<w.length;x++)w[x]=o.shape[p[x]];var k=Vk(b,o.shape,o.dtype,p,w);g=l.makeTensorInfo(w,o.dtype);var N=l.texData.get(g.dataId);N.values=k}else g=wg(o,p,l);v.push(g),h=S.backend_util.getInnerMostAxes(h.length,c)}S.backend_util.assertAxesAreInnerMostDims("sum",h,c);var T=qe(S.backend_util.computeOutAndReduceShapes(g.shape,h),2),I=T[0],F=T[1],D=I;s&&(D=S.backend_util.expandShapeToKeepDim(I,f));var R=KHe(g,F,D,l);try{for(var P=ga(v),B=P.next();!B.done;B=P.next()){var x=B.value;l.disposeIntermediateTensorInfo(x)}}catch(q){e={error:q}}finally{try{B&&!B.done&&(t=P.return)&&t.call(P)}finally{if(e)throw e.error}}return R}};function XHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=a.shape.length,u=S.util.parseAxisParam(i,a.shape),l=u,c=S.backend_util.getAxesPermutation(l,s),f=a;c!=null&&(f=An({inputs:{x:a},backend:t,attrs:{perm:c}}),l=S.backend_util.getInnerMostAxes(l.length,a.shape.length)),S.backend_util.assertAxesAreInnerMostDims("min",l,s);var h=qe(S.backend_util.computeOutAndReduceShapes(f.shape,l),2),p=h[0],d=h[1],m=S.util.sizeFromShape(d),v=Oe({inputs:{x:f},backend:t,attrs:{shape:[-1,m]}}),g=ju(v,v.dtype,"min",t),y;if(o){var b=S.backend_util.expandShapeToKeepDim(p,u);y=Oe({inputs:{x:g},backend:t,attrs:{shape:b}})}else y=Oe({inputs:{x:g},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(g),c!=null&&t.disposeIntermediateTensorInfo(f),y}var YHe={kernelName:S.Min,backendName:"webgl",kernelFunc:XHe};var ZHe=Uk+`
  return min(a, b);
`,JHe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+up+`
  return result;
`,QHe=mn({opSnippet:ZHe,packedOpSnippet:JHe,cpuKernelImpl:GWe}),eKe={kernelName:S.Minimum,backendName:"webgl",kernelFunc:QHe};var tKe=function(){function r(e,t,n){this.variableNames=["x"],this.outputShape=t.map(function(c,f){return c[0]+e[f]+c[1]});var a=e.length,i=er(a),o=t.map(function(c){return c[0]}).join(","),s=t.map(function(c,f){return c[0]+e[f]}).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),l=n==="reflect"?0:1;if(a===1){this.userCode=`
        int start = `+o+`;
        int end = `+s+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - `+l+`;
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + `+l+`;
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      `+i+" start = "+i+"("+o+`);
      `+i+" end = "+i+"("+s+`);

      void main() {
        `+i+` outC = getOutputCoords();
        for (int i = 0; i < `+a+`; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - `+l+`;
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + `+l+`;
          }
        }
        `+i+` coords = outC - start;
        setOutput(getX(`+u+`));
      }
    `}return r}();var rKe=function(){function r(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(m,v){return m[0]+e[v]+m[1]});var a=e.length,i=er(a),o=t.map(function(m){return m[0]}).join(","),s=t.map(function(m,v){return m[0]+e[v]}).join(","),u=Cn("rc",a),l=Cn("source",a),c=u[a-1]+" < "+this.outputShape[a-1],f=a===1?"source":"vec2("+l.slice(-2).join()+")",h=n==="reflect"?0:1,p="";if(a===1){var d=`
        `+i+` source = rc;
        if (source < start) {
          source = start * 2 - source - `+h+`;
        } else if (source >= end) {
          source = (end - 1) * 2 - source + `+h+`;
        }
        source -= start;
      `;p=`
        `+i+` rc = outputLoc;
        `+d+`
        result[0] = getChannel(getX(`+l.join()+"), "+f+`);
        `+u[a-1]+` += 1;
        if(`+c+`) {
          `+d+`
          result[1] = getChannel(getX(`+l.join()+"), "+f+`);
        }
      `}else{var d=`
        `+i+` source = rc;
        `+i+" lt = "+i+`(lessThan(source, start));
        `+i+" gte = "+i+`(greaterThanEqual(source, end));
        `+i+` orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - `+h+`) +
                gte * ((end - 1) * 2 - source + `+h+`);
        source -= start;
      `;p=`
        `+i+` rc = outputLoc;
        `+d+`
        result[0] = getChannel(getX(`+l.join()+"), "+f+`);
        `+u[a-1]+` += 1;
        if(`+c+`) {
          `+d+`
          result[1] = getChannel(getX(`+l.join()+"), "+f+`);
        }
        rc = outputLoc;
        `+u[a-2]+` += 1;
        if(`+u[a-2]+" < "+this.outputShape[a-2]+`) {
          `+d+`
          result[2] = getChannel(getX(`+l.join()+"), "+f+`);
          `+u[a-1]+` += 1;
          if(`+c+`) {
            `+d+`
            result[3] = getChannel(getX(`+l.join()+"), "+f+`);
          }
        }
      `}this.userCode=`
      const `+i+" start = "+i+"("+o+`);
      const `+i+" end = "+i+"("+s+`);

      void main() {
        `+i+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+p+`
        setOutput(result);
      }
    `}return r}();var nKe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.paddings,o=n.mode,s=S.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new rKe(a.shape,i,o):new tKe(a.shape,i,o),u=t.runWebGLProgram(s,[a],a.dtype);return u},aKe={kernelName:S.MirrorPad,backendName:"webgl",kernelFunc:nKe};var iKe=`if (b == 0.0) return NAN;
  return mod(a, b);`,oKe=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+up+`
  return result;
`,sKe=mn({opSnippet:iKe,packedOpSnippet:oKe}),uKe={kernelName:S.Mod,backendName:"webgl",kernelFunc:sKe};var lKe=function(){function r(e,t,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return r}();var cKe=`
if (a == b) {
  return 1.0;
};
return a / b;`,fKe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,kV=mn({opSnippet:cKe,packedOpSnippet:fKe,checkOutOfBounds:!0}),hKe={kernelName:S.RealDiv,backendName:"webgl",kernelFunc:kV};var jW="return a - b;",SV=mn({opSnippet:jW,packedOpSnippet:jW,supportsComplex:!0,cpuKernelImpl:lqe}),pKe={kernelName:S.Sub,backendName:"webgl",kernelFunc:SV};function NV(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.logits,i=n.dim,o=S.util.parseAxisParam([i],a.shape),s=xV({inputs:{x:a},backend:t,attrs:{reductionIndices:o,keepDims:!1}}),u=S.backend_util.expandShapeToKeepDim(s.shape,o),l=Oe({inputs:{x:s},backend:t,attrs:{shape:u}}),c=SV({inputs:{a,b:l},backend:t}),f=yV({inputs:{x:c},backend:t}),h=xg({inputs:{x:f},backend:t,attrs:{axis:o,keepDims:!1}}),p=Oe({inputs:{x:h},backend:t,attrs:{shape:u}}),d=kV({inputs:{a:f,b:p},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),d}var dKe={kernelName:S.Softmax,backendName:"webgl",kernelFunc:NV};function vKe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.logits,i=n.numSamples,o=n.seed,s=n.normalized,u=s?a:NV({inputs:{logits:a},backend:t,attrs:{dim:a.shape.length-1}}),l=u.shape[0],c=u.shape[1],f=new lKe(l,c,i),h=[[o]],p=t.runWebGLProgram(f,[u],"int32",h);return s||t.disposeIntermediateTensorInfo(u),p}var mKe={kernelName:S.Multinomial,backendName:"webgl",kernelFunc:vKe},gKe=hi+`
  return -x;
`,yKe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function bKe(r){var e=r.inputs,t=r.backend,n=e.x;if(t.shouldExecuteOnCPU([n])){var a=t.texData.get(n.dataId),i=qe(HWe(a.values,n.shape,n.dtype),2),o=i[0],s=i[1];return t.makeTensorInfo(s,n.dtype,o)}var u;return S.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")?u=new Vu(n.shape,yKe):u=new Co(n.shape,gKe),t.runWebGLProgram(u,[n],n.dtype)}var wKe={kernelName:S.Neg,backendName:"webgl",kernelFunc:bKe};var xKe=S.kernel_impls.nonMaxSuppressionV3Impl;function kKe(r){S.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,l=t.readSync(a.dataId),c=t.readSync(i.dataId),f=xKe(l,c,o,s,u).selectedIndices;return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}var SKe={kernelName:S.NonMaxSuppressionV3,backendName:"webgl",kernelFunc:kKe};var NKe=S.kernel_impls.nonMaxSuppressionV4Impl;function EKe(r){S.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,l=n.padToMaxOutputSize,c=t.readSync(a.dataId),f=t.readSync(i.dataId),h=NKe(c,f,o,s,u,l),p=h.selectedIndices,d=h.validOutputs;return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([d]))]}var TKe={kernelName:S.NonMaxSuppressionV4,backendName:"webgl",kernelFunc:EKe};var IKe=S.kernel_impls.nonMaxSuppressionV5Impl;function CKe(r){S.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,l=n.softNmsSigma,c=t.readSync(a.dataId),f=t.readSync(i.dataId),h=o,p=s,d=u,m=l,v=IKe(c,f,h,p,d,m),g=v.selectedIndices,y=v.selectedScores;return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var AKe={kernelName:S.NonMaxSuppressionV5,backendName:"webgl",kernelFunc:CKe};var _Ke=function(){function r(e,t,n,a){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+a+"), float("+n+`),
                      float(index == coords.y)));
      }
    `}return r}(),DKe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.indices,i=n.dtype,o=n.depth,s=n.onValue,u=n.offValue,l=S.util.sizeFromShape(a.shape),c=new _Ke(l,o,s,u),f=Oe({inputs:{x:a},backend:t,attrs:{shape:[l]}}),h=t.runWebGLProgram(c,[f],i);t.disposeIntermediateTensorInfo(f);var p=Xr(a.shape,[o]),d=Oe({inputs:{x:h},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(h),d},FKe={kernelName:S.OneHot,backendName:"webgl",kernelFunc:DKe};function yg(r){var e=r.inputs,t=r.backend,n=e.x;if(n.dtype==="complex64"){var a=cp({inputs:{input:n},backend:t}),i=yg({inputs:{x:a},backend:t}),o=kg({inputs:{input:n},backend:t}),s=yg({inputs:{x:o},backend:t}),u=Es({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return fp({attrs:{shape:n.shape,dtype:n.dtype,value:n.dtype==="string"?"":0},backend:t})}var RKe={kernelName:S.ZerosLike,backendName:"webgl",kernelFunc:yg};function EV(r){var e=r.inputs,t=r.backend,n=e.x;if(n.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(n.dtype==="complex64"){var a=cp({inputs:{input:n},backend:t}),i=EV({inputs:{x:a},backend:t}),o=kg({inputs:{input:n},backend:t}),s=yg({inputs:{x:o},backend:t}),u=Es({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return fp({attrs:{shape:n.shape,dtype:n.dtype,value:1},backend:t})}var OKe={kernelName:S.OnesLike,backendName:"webgl",kernelFunc:EV};function PKe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.axis;if(e.length===1)return Fk({inputs:{input:e[0]},backend:t,attrs:{dim:a}});var i=e[0].shape,o=e[0].dtype;e.forEach(function(c){S.util.assertShapesMatch(i,c.shape,"All tensors passed to stack must have matching shapes"),S.util.assert(o===c.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=[],u=e.map(function(c){var f=Fk({inputs:{input:c},backend:t,attrs:{dim:a}});return s.push(f),f}),l=cV({inputs:u,backend:t,attrs:{axis:a}});return s.forEach(function(c){return t.disposeIntermediateTensorInfo(c)}),l}var MKe={kernelName:S.Pack,backendName:"webgl",kernelFunc:PKe};var BKe=function(){function r(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(function(l,c){return l[0]+e[c]+l[1]});var a=e.length,i=er(a),o=t.map(function(l){return l[0]}).join(","),s=t.map(function(l,c){return l[0]+e[c]}).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);if(a===1){this.userCode=`
        int start = `+o+`;
        int end = `+s+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      `+i+" start = "+i+"("+o+`);
      `+i+" end = "+i+"("+s+`);

      void main() {
        `+i+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          `+i+` coords = outC - start;
          setOutput(getX(`+u+`));
        }
      }
    `}return r}();var LKe=function(){function r(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(function(g,y){return g[0]+e[y]+g[1]});for(var a=e.length,i=er(a),o=t.map(function(g){return g[0]}).join(","),s=t.map(function(g,y){return g[0]+e[y]}).join(","),u=Cn("rc",a),l=Cn("source",a),c=u[a-1]+" < "+this.outputShape[a-1],f=a===1?"source":"vec2("+l.slice(-2).join()+")",h=[i+" rc = outputLoc;",u[a-1]+` += 1;
       if(`+c+`) {
      `,a===1?"":`}
       rc = outputLoc;
       `+u[a-2]+` += 1;
       if(`+u[a-2]+" < "+this.outputShape[a-2]+") {",a===1?"":"  "+u[a-1]+` += 1;
         if(`+c+") {"],p=a===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",d="",m=0,v=a===1?2:4;m<v;m++)d+=`
        `+h[m]+`
        if (`+p+`) {
          result[`+m+`] = float(value);
        } else {
          `+i+` source = rc - start;
          result[`+m+"] = getChannel(getX("+l.join()+"), "+f+`);
        }
      `;d+=a===1?"} ":"}}",this.userCode=`
      const `+i+" start = "+i+"("+o+`);
      const `+i+" end = "+i+"("+s+`);

      void main() {
        `+i+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+d+`
        setOutput(result);
      }
    `}return r}();var TV=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.paddings,o=n.constantValue;if(S.util.sizeFromShape(a.shape)===0){var s=i.map(function(c,f){return c[0]+a.shape[f]+c[1]});return fp({backend:t,attrs:{shape:s,value:o,dtype:a.dtype}})}var u=S.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new LKe(a.shape,i,o):new BKe(a.shape,i,o),l=[[o]];return t.runWebGLProgram(u,[a],a.dtype,l)},zKe={kernelName:S.PadV2,backendName:"webgl",kernelFunc:TV};var $Ke=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,WKe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+up+`
  return result;
`,qKe=mn({opSnippet:$Ke,packedOpSnippet:WKe}),VKe={kernelName:S.Pow,backendName:"webgl",kernelFunc:qKe};function GKe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=a.shape.length,u=[],l=S.util.parseAxisParam(i,a.shape),c=l,f=S.backend_util.getAxesPermutation(c,s),h=a;f!=null&&(h=An({inputs:{x:a},backend:t,attrs:{perm:f}}),c=S.backend_util.getInnerMostAxes(c.length,s),u.push(h)),S.backend_util.assertAxesAreInnerMostDims("prod",c,s);var p;if(t.shouldExecuteOnCPU([h])){var d=t.texData.get(h.dataId).values,m=jWe(h.shape,h.dtype,d,c),v=m.outVals,g=m.outShape,y=m.outDtype;p=t.makeTensorInfo(g,y,v)}else{var b=qe(S.backend_util.computeOutAndReduceShapes(h.shape,c),2),g=b[0],w=b[1],x=S.util.sizeFromShape(w),k=Oe({inputs:{x:h},backend:t,attrs:{shape:[-1,x]}}),N=S.sumOutType(a.dtype),T=ju(k,N,"prod",t);p=Oe({inputs:{x:T},backend:t,attrs:{shape:g}}),u.push(k),u.push(T)}if(o){u.push(p);var I=S.backend_util.expandShapeToKeepDim(p.shape,l);p=Oe({inputs:{x:p},backend:t,attrs:{shape:I}})}return u.forEach(function(F){return t.disposeIntermediateTensorInfo(F)}),p}var UKe={kernelName:S.Prod,backendName:"webgl",kernelFunc:GKe};function HKe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.paramsNestedSplits,i=e.paramsDenseValues,o=e.indices;n.outputRaggedRank;var s=a.map(function(g){return t.readSync(g.dataId)}),u=a.map(function(g){return g.shape}),l=t.readSync(i.dataId),c=t.readSync(o.dataId),f=qe(XWe(s,u,l,i.shape,i.dtype,c,o.shape),3),h=f[0],p=f[1],d=f[2],m=h.map(function(g){return t.makeTensorInfo([g.length],"int32",g)}),v=t.makeTensorInfo(d,i.dtype,p);return m.concat([v])}var KKe={kernelName:S.RaggedGather,backendName:"webgl",kernelFunc:HKe};function jKe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.shape,i=e.values,o=e.defaultValue,s=e.rowPartitionTensors,u=n.rowPartitionTypes,l=t.readSync(a.dataId),c=t.readSync(i.dataId),f=t.readSync(o.dataId),h=s.map(function(g){return t.readSync(g.dataId)}),p=s.map(function(g){return g.shape}),d=qe(YWe(l,a.shape,c,i.shape,i.dtype,f,o.shape,h,p,u),2),m=d[0],v=d[1];return t.makeTensorInfo(m,i.dtype,v)}var XKe={kernelName:S.RaggedTensorToTensor,backendName:"webgl",kernelFunc:jKe};var IV=function(r){var e=r.backend,t=r.attrs,n=t.start,a=t.stop,i=t.step,o=t.dtype,s=ZWe(n,a,i,o);return e.makeTensorInfo([s.length],o,s)},YKe={kernelName:S.Range,backendName:"webgl",kernelFunc:IV};var ZKe="return 1.0 / x;",JKe=Ft({opSnippet:ZKe}),QKe={kernelName:S.Reciprocal,backendName:"webgl",kernelFunc:JKe};var e5e=hi+`
  return (x < 0.0) ? 0.0 : x;
`,t5e=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,r5e=Ft({opSnippet:e5e,packedOpSnippet:t5e}),n5e={kernelName:S.Relu,backendName:"webgl",kernelFunc:r5e};var a5e=hi+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,i5e=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,o5e=Ft({opSnippet:a5e,packedOpSnippet:i5e}),s5e={kernelName:S.Relu6,backendName:"webgl",kernelFunc:o5e};var u5e=function(){function r(e,t,n,a,i){this.variableNames=["A"],this.outputShape=[];var o=qe(e,4),s=o[0],u=o[1],l=o[2],c=o[3];this.outputShape=[s,t,n,c];var f=[a&&t>1?u-1:u,a&&n>1?l-1:l],h=[a&&t>1?t-1:t,a&&n>1?n-1:n],p;i?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+f[0]/h[0]+`,
          `+f[1]/h[1]+`);
      const vec2 inputShapeRC = vec2(`+u+".0, "+l+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = `+p+`;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}return r}();var l5e=function(){function r(e,t,n,a,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=qe(e,4),s=o[0],u=o[1],l=o[2],c=o[3];this.outputShape=[s,t,n,c];var f=[a&&t>1?u-1:u,a&&n>1?l-1:l],h=[a&&t>1?t-1:t,a&&n>1?n-1:n],p;i?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+f[0]/h[0]+`,
          `+f[1]/h[1]+`,
          `+f[1]/h[1]+`);
      const vec3 inputShapeRC = vec3(`+u+".0, "+l+`.0,
                                     `+l+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = `+p+`;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(c-1)+`;
        bool hasNextRow = coords.z < `+(n-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}return r}();function c5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=n.alignCorners,o=n.halfPixelCenters,s=n.size,u=qe(s,2),l=u[0],c=u[1],f=S.env().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new l5e(a.shape,l,c,i,o):new u5e(a.shape,l,c,i,o);return t.runWebGLProgram(f,[a],"float32")}var f5e={kernelName:S.ResizeBilinear,backendName:"webgl",kernelFunc:c5e};var h5e=function(){function r(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;var a=qe(t,3),i=a[1],o=a[2],s=qe(e,3),u=s[1],l=s[2],c=[n&&u>1?i-1:i,n&&l>1?o-1:o],f=[n&&u>1?u-1:u,n&&l>1?l-1:l],h=c[0]/f[0],p=c[1]/f[1],d=1/h,m=1/p,v=Math.ceil(d)*2+2,g=Math.ceil(m)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+p+`);

        const float invHeightScale = float(`+d+`);
        const float invWidthScale = float(`+m+`);

        const int winHeight = int(`+v+`);
        const int winWidth = int(`+g+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+u+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+l+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(i-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(o-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}return r}();function p5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=e.dy,o=n.alignCorners,s=new h5e(i.shape,a.shape,o);return t.runWebGLProgram(s,[i],i.dtype)}var d5e={kernelName:S.ResizeBilinearGrad,backendName:"webgl",kernelFunc:p5e};var v5e=function(){function r(e,t,n,a,i){this.variableNames=["A"],this.outputShape=[];var o=qe(e,4),s=o[0],u=o[1],l=o[2],c=o[3];this.outputShape=[s,t,n,c];var f=[a&&t>1?u-1:u,a&&n>1?l-1:l],h=[a&&t>1?t-1:t,a&&n>1?n-1:n],p=a?"0.5":"0.0",d;i?d="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+f[0]/h[0]+`,
          `+f[1]/h[1]+`);
      const vec2 inputShapeRC = vec2(`+u+".0, "+l+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = `+d+`;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+p+`)));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}return r}();var m5e=function(){function r(e,t,n,a,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=qe(e,4),s=o[0],u=o[1],l=o[2],c=o[3];this.outputShape=[s,t,n,c];var f=[a&&t>1?u-1:u,a&&n>1?l-1:l],h=[a&&t>1?t-1:t,a&&n>1?n-1:n],p=a?"0.5":"0.0",d;i?d="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+f[0]/h[0]+`,
          `+f[1]/h[1]+`,
          `+f[1]/h[1]+`);
      const vec3 inputShapeRC = vec3(`+u+".0, "+l+`.0,
                                     `+l+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = `+d+`;

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+p+`)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(c-1)+`;
        bool hasNextRow = coords.z < `+(n-1)+`;

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}return r}();function g5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=n.alignCorners,o=n.halfPixelCenters,s=n.size,u=qe(s,2),l=u[0],c=u[1],f=S.env().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new m5e(a.shape,l,c,i,o):new v5e(a.shape,l,c,i,o);return t.runWebGLProgram(f,[a],a.dtype)}var y5e={kernelName:S.ResizeNearestNeighbor,backendName:"webgl",kernelFunc:g5e};var b5e=function(){function r(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;var a=qe(t,3),i=a[1],o=a[2],s=qe(e,3),u=s[1],l=s[2],c=[n&&u>1?i-1:i,n&&l>1?o-1:o],f=[n&&u>1?u-1:u,n&&l>1?l-1:l],h=c[0]/f[0],p=c[1]/f[1],d=1/h,m=1/p,v=Math.ceil(d)*2+2,g=Math.ceil(m)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+p+`);

        const float invHeightScale = float(`+d+`);
        const float invWidthScale = float(`+m+`);

        const int winHeight = int(`+v+`);
        const int winWidth = int(`+g+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+u+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+l+`) {
              continue;
            }

            float sourceFracRow =
              float(`+c[0]+`) *
                (float(dyR) / float(`+f[0]+`));

            float sourceFracCol =
                float(`+c[1]+`) *
                  (float(dyC) / float(`+f[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+i+`) - 1),
                `+n+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+o+`) - 1),
                `+n+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}return r}();function w5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=e.dy,o=n.alignCorners,s=new b5e(i.shape,a.shape,o);return t.runWebGLProgram(s,[i],i.dtype)}var x5e={kernelName:S.ResizeNearestNeighborGrad,backendName:"webgl",kernelFunc:w5e};var k5e=function(){function r(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,n===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+e[0]+` - coord - 1));
        }
      `;return}var a=function(s){return t.indexOf(s)!==-1&&e[s]!==1?e[s]+" - coords["+s+"] - 1":"coords["+s+"]"},i=e.map(function(s,u){return a(u)}).join(","),o=er(n);this.userCode=`
      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+i+`));
      }
    `}return r}();var S5e=function(){function r(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var a=Cn("rc",n),i=a[n-1]+" + 1 < "+this.outputShape[n-1],o=a[n-2]+" + 1 < "+this.outputShape[n-2],s=er(n);n===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+e[0]+` - rc - 1),
            `+e[0]+` - rc - 1);
          if(`+i+`){
              result.g = getChannel(getX(`+e[0]+` - (rc  + 1) - 1),
                `+e[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          `+s+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+u(a.slice())+`;
          if(`+i+`){
            result.g = `+l(a.slice())+`;
          }
          if(`+o+`) {
            result.b = `+c(a.slice())+`;
            if(`+i+`) {
              result.a = `+f(a.slice())+`;
            }
          }
          setOutput(result);
        }
    `;function u(d){return h(d)}function l(d){return d[n-1]="("+d[n-1]+" + 1)",h(d)}function c(d){return d[n-2]="("+d[n-2]+" + 1)",h(d)}function f(d){return d[n-1]="("+d[n-1]+" + 1)",d[n-2]="("+d[n-2]+" + 1)",h(d)}function h(d){var m=e.map(function(y,b){return p(b,d)}),v=m.join(","),g=m.slice(-2).join(",");return"getChannel(getX("+v+"), vec2("+g+"))"}function p(d,m){return t.indexOf(d)!==-1&&e[d]!==1?e[d]+" - "+m[d]+" - 1":""+m[d]}}return r}();function N5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.dims,o=a.shape.length,s=S.util.parseAxisParam(i,a.shape);if(o===0)return ya({inputs:{x:a},backend:t});var u=S.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new S5e(a.shape,s):new k5e(a.shape,s);return t.runWebGLProgram(u,[a],a.dtype)}var E5e={kernelName:S.Reverse,backendName:"webgl",kernelFunc:N5e};var T5e=function(){function r(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];var n=e[1],a=e[2];this.outputShape=e;var i="";typeof t=="number"?i="float outputValue = "+t.toFixed(2)+";":i=`
        vec3 fill = vec3(`+t.join(",")+`);
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          `+i+`
          if(coordX >= 0 && coordX < `+a+" && coordY >= 0 && coordY < "+n+`) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}return r}(),I5e={kernelName:S.RotateWithOffset,backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.image,i=t.radians,o=t.fillValue,s=t.center,u=n,l=new T5e(a.shape,o),c=qe(S.backend_util.getImageCenter(s,a.shape[1],a.shape[2]),2),f=c[0],h=c[1],p=[[f,h,Math.sin(i),Math.cos(i)]],d=u.runWebGLProgram(l,[a],a.dtype,p);return d}};var C5e=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,A5e=Ft({opSnippet:C5e}),_5e={kernelName:S.Round,backendName:"webgl",kernelFunc:A5e};var D5e="return inversesqrt(x);",F5e=Ft({opSnippet:D5e,cpuKernelImpl:JWe}),R5e={kernelName:S.Rsqrt,backendName:"webgl",kernelFunc:F5e};var CV=function(){function r(e,t,n,a,i,o,s){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var u=er(i.length),l=er(o.length),c="";n===1?c="i":n===2&&(c="i, j");var f="getIndices("+c+")",h="";a===1?h="i":a===2&&(h="i, coords[1]");var p="getUpdates("+h+")",d=t>1?"strides[j]":"strides";this.userCode=`
        `+u+" strides = "+u+"("+i+`);

        void main() {
          `+l+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+e+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+t+`; j++) {
              int index = round(`+f+`);
              flattenedIndex += index * `+d+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+p+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}return r}();function O5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.indices,i=e.updates,o=n.shape,s=S.backend_util.calculateShapes(i,a,o),u=s.sliceRank,l=s.numUpdates,c=s.sliceSize,f=s.strides,h=s.outputSize,p=[h/c,c];if(h===0)return t.makeTensorInfo(o,a.dtype);var d=Oe({inputs:{x:a},backend:t,attrs:{shape:[l,u]}}),m=Oe({inputs:{x:i},backend:t,attrs:{shape:[l,c]}}),v=t.makeTensorInfo([],"float32",new Float32Array([0])),g=new CV(l,u,d.shape.length,m.shape.length,f,p),y=t.runWebGLProgram(g,[m,d,v],m.dtype),b=Oe({inputs:{x:y},backend:t,attrs:{shape:o}});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(v),b}var P5e={kernelName:S.ScatterNd,backendName:"webgl",kernelFunc:O5e};var M5e=function(){function r(e,t,n,a){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,n];var i="while (left < right) {",o="for (int i = 0; i < "+Math.ceil(Math.log2(t+1))+"; ++i) { if (left >= right) break;",s=S.env().getNumber("WEBGL_VERSION")===2?i:o,u=a==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         `+s+`
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) `+u+` value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}return r}();function B5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.sortedSequence,i=e.values,o=n.side,s=new M5e(a.shape[0],a.shape[1],i.shape[1],o),u=[[a.shape[1]]];return t.runWebGLProgram(s,[a,i],"int32",u)}var L5e={kernelName:S.SearchSorted,backendName:"webgl",kernelFunc:B5e};var z5e=function(){function r(e,t,n){this.variableNames=["c","a","b"],this.outputShape=t;var a,i;if(n>4)throw Error("Where for rank "+n+" is not yet supported");if(n===1)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],l=0;l<t.length;l++)u.push(""+o[l]),l<e&&s.push(""+o[l]);a=s.join(),i=u.join()}var c=er(n);this.userCode=`
      void main() {
        `+c+` resRC = getOutputCoords();
        float cVal = getC(`+a+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+i+`));
        } else {
          setOutput(getB(`+i+`));
        }
      }
    `}return r}();function $5e(r){var e=r.inputs,t=r.backend,n=e.condition,a=e.t,i=e.e,o=new z5e(n.shape.length,a.shape,a.shape.length);return t.runWebGLProgram(o,[n,a,i],S.upcastType(a.dtype,i.dtype))}var W5e={kernelName:S.Select,backendName:"webgl",kernelFunc:$5e};var q5e=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+S.backend_util.SELU_SCALEALPHA+`;
  float scale = `+S.backend_util.SELU_SCALE+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,V5e=Ft({opSnippet:q5e}),G5e={kernelName:S.Selu,backendName:"webgl",kernelFunc:V5e};var U5e=_c+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,H5e=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,K5e=Ft({opSnippet:U5e,packedOpSnippet:H5e,cpuKernelImpl:eqe}),j5e={kernelName:S.Sigmoid,backendName:"webgl",kernelFunc:K5e};var X5e=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,Y5e=Ft({opSnippet:X5e}),Z5e={kernelName:S.Sign,backendName:"webgl",kernelFunc:Y5e};var J5e=_c+`
  return sin(x);
`,Q5e=Ft({opSnippet:J5e}),eje={kernelName:S.Sin,backendName:"webgl",kernelFunc:Q5e};var tje=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,rje=Ft({opSnippet:tje}),nje={kernelName:S.Sinh,backendName:"webgl",kernelFunc:rje};var aje=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,ije=Ft({opSnippet:aje}),oje={kernelName:S.Softplus,backendName:"webgl",kernelFunc:ije},sje=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockShape,o=n.paddings;S.util.assert(a.shape.length<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var s=i.reduce(function(y,b){return y*b}),u=[[0,0]];u.push.apply(u,Xr(o));for(var l=1+i.length;l<a.shape.length;++l)u.push([0,0]);var c=[],f=TV({inputs:{x:a},backend:t,attrs:{paddings:u,constantValue:0}}),h=S.backend_util.getReshaped(f.shape,i,s,!1),p=S.backend_util.getPermuted(h.length,i.length,!1),d=S.backend_util.getReshapedPermuted(f.shape,i,s,!1),m=Oe({inputs:{x:f},backend:t,attrs:{shape:h}}),v=An({inputs:{x:m},backend:t,attrs:{perm:p}}),g=Oe({inputs:{x:v},backend:t,attrs:{shape:d}});return c.push(f),c.push(m),c.push(v),c.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),g},uje={kernelName:S.SpaceToBatchND,backendName:"webgl",kernelFunc:sje};function lje(r){var e=r.inputs,t=r.backend,n=e.indices,a=e.values,i=e.denseShape,o=e.defaultValue;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         `+i.shape);if(n.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         `+n.shape);if(a.shape.length!==1)throw new Error(`Values must be a vector, saw:
         `+a.shape);if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        `+o.shape);var s=t.readSync(n.dataId),u=t.readSync(a.dataId),l=t.readSync(i.dataId),c=t.readSync(o.dataId)[0],f=qe(rqe(s,n.shape,n.dtype,u,a.dtype,l,c),5),h=f[0],p=f[1],d=f[2],m=f[3],v=f[4];return[t.makeTensorInfo(p,n.dtype,h),t.makeTensorInfo([p[0]],a.dtype,d),t.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(function(g){return Number(g)}))),t.makeTensorInfo([v.length],n.dtype,new Int32Array(v))]}var cje={kernelName:S.SparseFillEmptyRows,backendName:"webgl",kernelFunc:lje};function fje(r){var e=r.inputs,t=r.backend,n=e.inputIndices,a=e.inputShape,i=e.newShape;if(n.shape.length!==2)throw new Error("Input indices should be a matrix but received shape "+n.shape);if(a.shape.length!==1)throw new Error("Input shape should be a vector but received shape "+a.shape);if(i.shape.length!==1)throw new Error("Target shape should be a vector but received shape "+i.shape);var o=Array.from(t.readSync(a.dataId)),s=t.readSync(n.dataId),u=Array.from(t.readSync(i.dataId)),l=qe(nqe(s,n.shape,n.dtype,o,u),3),c=l[0],f=l[1],h=l[2];return[t.makeTensorInfo(f,n.dtype,c),t.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}var hje={kernelName:S.SparseReshape,backendName:"webgl",kernelFunc:fje};function pje(r){var e=r.inputs,t=r.backend,n=e.data,a=e.indices,i=e.segmentIds;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              `+a.shape);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              `+i.shape);var o=t.readSync(n.dataId),s=t.readSync(a.dataId),u=t.readSync(i.dataId),l=qe(Yq(o,n.shape,n.dtype,s,u,!0),2),c=l[0],f=l[1];return t.makeTensorInfo(f,n.dtype,c)}var dje={kernelName:S.SparseSegmentMean,backendName:"webgl",kernelFunc:pje};function vje(r){var e=r.inputs,t=r.backend,n=e.data,a=e.indices,i=e.segmentIds;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             `+a.shape);if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             `+i.shape);var o=t.readSync(n.dataId),s=t.readSync(a.dataId),u=t.readSync(i.dataId),l=qe(Yq(o,n.shape,n.dtype,s,u),2),c=l[0],f=l[1];return t.makeTensorInfo(f,n.dtype,c)}var mje={kernelName:S.SparseSegmentSum,backendName:"webgl",kernelFunc:vje};function gje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.sparseIndices,i=e.sparseValues,o=e.defaultValue,s=n.outputShape,u=S.backend_util.calculateShapes(i,a,s),l=u.sliceRank,c=u.numUpdates,f=u.sliceSize,h=u.strides,p=u.outputSize,d=!1;if(i.dtype==="string"){var m=t.bufferSync(a),v=t.bufferSync(i),g=S.util.decodeString(t.readSync(o.dataId)[0]),y=QWe(m,v,s,p,f,c,l,h,g,d);return t.makeTensorInfo(s,y.dtype,y.values)}var b=new CV(c,l,a.shape.length,i.shape.length,h,[p,1],d),w=t.runWebGLProgram(b,[i,a,o],i.dtype),x=Oe({inputs:{x:w},backend:t,attrs:{shape:s}});return t.disposeIntermediateTensorInfo(w),x}var yje={kernelName:S.SparseToDense,backendName:"webgl",kernelFunc:gje};function bje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.numOrSizeSplits,o=n.axis,s=S.util.parseAxisParam(o,a.shape)[0],u=S.backend_util.prepareSplitSize(a,i,s),l=a.shape.length,c=new Array(l).fill(0),f=a.shape.slice();return u.map(function(h){var p=Xr(f);p[s]=h;var d=Dc({inputs:{x:a},backend:t,attrs:{begin:c,size:p}});return c[s]+=h,d})}var wje={kernelName:S.SplitV,backendName:"webgl",kernelFunc:bje};var XW="return sqrt(x);",xje=Ft({opSnippet:XW,packedOpSnippet:XW,cpuKernelImpl:aqe}),kje={kernelName:S.Sqrt,backendName:"webgl",kernelFunc:xje};var Sje="return x * x;",Nje=Ft({opSnippet:Sje}),Eje={kernelName:S.Square,backendName:"webgl",kernelFunc:Nje};var YW="return (a - b) * (a - b);",Tje=mn({opSnippet:YW,packedOpSnippet:YW}),Ije={kernelName:S.SquaredDifference,backendName:"webgl",kernelFunc:Tje};function Cje(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.x,i=hi+(`
    return x > 0.0 ? 1.0 : float(`+t.alpha+`);
  `),o=new Co(a.shape,i);return n.runWebGLProgram(o,[a],a.dtype)}var Aje={kernelName:S.Step,backendName:"webgl",kernelFunc:Cje};var _je=function(){function r(e,t,n){this.variableNames=["x"],this.outputShape=n;var a=n.length,i=er(n.length),o=er(n.length),s="";if(a===1)s="coords * strides + begin";else{var u=0;s=n.map(function(l,c){return u++,n.length===1?"coords * strides["+c+"] + begin["+c+"]":"coords["+(u-1)+"] * strides["+c+"] + begin["+c+"]"}).join(",")}this.userCode=`
      `+i+" begin = "+i+"("+e+`);
      `+i+" strides = "+i+"("+t+`);

      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+s+`));
      }
    `}return r}();function Dje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.begin,o=n.end,s=n.strides,u=n.beginMask,l=n.endMask,c=n.ellipsisMask,f=n.newAxisMask,h=n.shrinkAxisMask,p=S.slice_util.sliceInfo(a.shape,i,o,s,u,l,c,f,h),d=p.finalShapeSparse,m=p.finalShape,v=p.isIdentity,g=p.sliceDim0,y=p.isSimpleSlice,b=p.begin,w=p.end,x=p.strides,k;if(v)k=Oe({inputs:{x:a},backend:t,attrs:{shape:m}});else if(g||y){S.util.assert(a.shape.length>=1,function(){return"Input must have rank at least 1, got: "+a.shape.length});var N=S.slice_util.computeOutShape(b,w,x),T=Dc({inputs:{x:a},backend:t,attrs:{begin:b,size:N}});k=Oe({inputs:{x:T},backend:t,attrs:{shape:m}}),t.disposeIntermediateTensorInfo(T)}else{var I=t.shouldExecuteOnCPU([a]);if(I){var F=t.readSync(a.dataId),D=S.buffer(a.shape,a.dtype,F),R=iqe(d,D,x,b);k=t.makeTensorInfo(m,a.dtype,R.values)}else{var P=new _je(b,x,d);k=t.runWebGLProgram(P,[a],a.dtype)}}var B=Oe({inputs:{x:k},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(k),B}var Fje={kernelName:S.StridedSlice,backendName:"webgl",kernelFunc:Dje};function Rje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.separator,i=n.nGramWidths,o=n.leftPad,s=n.rightPad,u=n.padWidth,l=n.preserveShortSequences,c=e.data,f=e.dataSplits,h=t.readSync(c.dataId),p=t.readSync(f.dataId),d=qe(oqe(h,p,a,i,o,s,u,l),2),m=d[0],v=d[1];return[t.makeTensorInfo([m.length],"string",m),t.makeTensorInfo(f.shape,"int32",v)]}var Oje={kernelName:S.StringNGrams,backendName:"webgl",kernelFunc:Rje};function Pje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.skipEmpty,i=e.input,o=e.delimiter;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error("Input must be a vector, got shape: "+i.shape);if(o.shape.length!==0)throw new Error("Delimiter must be a scalar, got shape: "+o.shape);var s=t.readSync(i.dataId),u=t.readSync(o.dataId)[0],l=qe(sqe(s,u,a),3),c=l[0],f=l[1],h=l[2],p=f.length;return[t.makeTensorInfo([p,2],"int32",c),t.makeTensorInfo([p],"string",f),t.makeTensorInfo([2],"int32",new Int32Array(h))]}var Mje={kernelName:S.StringSplit,backendName:"webgl",kernelFunc:Pje};function Bje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.numBuckets,i=e.input;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");var o=t.readSync(i.dataId),s=uqe(o,a);return t.makeTensorInfo(i.shape,"int32",s)}var Lje={kernelName:S.StringToHashBucketFast,backendName:"webgl",kernelFunc:Bje};var zje="return tan(x);",$je=Ft({opSnippet:zje}),Wje={kernelName:S.Tan,backendName:"webgl",kernelFunc:$je};var qje=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,Vje=Ft({opSnippet:qje}),Gje={kernelName:S.Tanh,backendName:"webgl",kernelFunc:Vje};var Uje=function(){function r(e,t){this.variableNames=["A"];for(var n=new Array(e.length),a=0;a<n.length;a++)n[a]=e[a]*t[a];this.outputShape=n,this.rank=n.length;var i=er(this.rank),o=Hje(e);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `}return r}();function Hje(r){var e=r.length;if(e>5)throw Error("Tile for rank "+e+" is not yet supported");if(e===1)return"imod(resRC, "+r[0]+")";for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],n=[],a=0;a<r.length;a++)n.push("imod("+t[a]+", "+r[a]+")");return n.join()}function AV(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.reps;if(a.dtype==="string"||a.shape.length>5){var o=t.readSync(a.dataId),s=a.dtype==="string"?o.map(function(h){return S.util.decodeString(h)}):o,u=S.buffer(a.shape,a.dtype,s),l=cqe(u,i);return t.makeTensorInfo(l.shape,l.dtype,l.values)}var c=new Uje(a.shape,i),f=t.runWebGLProgram(c,[a],a.dtype);return f}var Kje={kernelName:S.Tile,backendName:"webgl",kernelFunc:AV},jje=function(){function r(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}return r}(),Xje=function(){function r(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}return r}();function Wu(r,e){e!==null&&r.disposeIntermediateTensorInfo(e)}function ZW(r){for(var e=1;e<r;)e*=2;return e}function Yje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.k,o=n.sorted,s=S.env().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=S.env().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),l=a.shape,c=l[l.length-1];if(t.shouldExecuteOnCPU([a])||c<s||i>u){var f=t.readSync(a.dataId),h=qe(fqe(f,l,a.dtype,i,o),2),p=h[0],d=h[1];return[t.makeTensorInfo(p.shape,p.dtype,p.values),t.makeTensorInfo(d.shape,d.dtype,d.values)]}if(i===0)return l[l.length-1]=0,[t.makeTensorInfo(l,a.dtype,[]),t.makeTensorInfo(l,"int32",[])];if(c===1)return[a,fp({attrs:{shape:l,dtype:"int32",value:0},backend:t})];var m=t.texData.get(a.dataId),v=m!==null&&m.isPacked,g=v?t.unpackTensor(a):a,y=S.util.sizeFromShape(l),b=y/c,w=Oe({inputs:{x:g},attrs:{shape:[b,c]},backend:t});v&&Wu(t,g);for(var x=ZW(i),k=ZW(c),N=null,T=function(){return N===null?[w,w]:[w,N]},I=function(se,ce,he){var xe=T(),Se=new jje(he),we=N===null?1:0,ke=[[c],[we],[Number.NEGATIVE_INFINITY],[se],[ce]],Ne=N;N=t.runWebGLProgram(Se,xe,"int32",ke),Wu(t,Ne)},F=1;F<x;F*=2)for(var D=F*2,R=F;R>=1;R/=2)I(D,R,[b,k]);for(var P=k;P>x;P/=2){var B=T(),q=new Xje([b,P/2]),O=N===null?1:0,V=[[c],[O],[x]],K=N;N=t.runWebGLProgram(q,B,"int32",V),Wu(t,K);for(var F=x/2,D=F*2,R=F;R>=1;R/=2)I(D,R,N.shape)}var Z=N;N=Dc({inputs:{x:N},backend:t,attrs:{begin:0,size:[b,i]}}),Wu(t,Z);var j=wV({inputs:{x:w,indices:N},backend:t,attrs:{axis:1,batchDims:1}});Wu(t,w);var ee=l.slice(0,-1);ee.push(i),Z=N,N=Oe({inputs:{x:N},attrs:{shape:ee},backend:t}),Wu(t,Z);var le=j;return j=Oe({inputs:{x:j},attrs:{shape:ee},backend:t}),Wu(t,le),[j,N]}var Zje={kernelName:S.TopK,backendName:"webgl",kernelFunc:Yje};var Jje=function(){function r(e,t,n,a,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;var s=n==="nearest"?1:2,u;switch(a){case"constant":u=1;break;case"reflect":u=2;break;case"wrap":u=3;break;case"nearest":u=4;break;default:u=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(`+u+` == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (`+u+` == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (`+u+` == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < `+e+" && 0 <= coordX && coordX < "+t+`) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(`+i+`);
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(`+i+`);
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(`+t+`));
                float mapY = mapCoord(inY, float(`+e+`));

                if (`+s+` == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}return r}();function Qje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.image,i=e.transforms,o=n.interpolation,s=n.fillMode,u=n.fillValue,l=n.outputShape,c=qe(a.shape,4),f=c[0],h=c[1],p=c[2],d=c[3],m=qe(l??[h,p],2),v=m[0],g=m[1],y=[f,v,g,d],b=new Jje(h,p,o,s,u,y);return t.runWebGLProgram(b,[a,i],"float32")}var e8e={kernelName:S.Transform,backendName:"webgl",kernelFunc:Qje};function t8e(r){var e=r.inputs,t=r.attrs,n=r.backend,a=t.axis,i=e.x;Ec(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=n.readSync(i.dataId),s=hqe(o,a,i.shape,i.dtype),u=s.outputValues,l=s.outputShape,c=s.indices;return[n.makeTensorInfo(l,i.dtype,u),n.makeTensorInfo([c.length],"int32",c)]}var r8e={kernelName:S.Unique,backendName:"webgl",kernelFunc:t8e};function n8e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.value,i=n.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],l=new Array(s-1),c=0,f=0;f<s;f++)f!==i&&(l[c++]=o.shape[f]);var h=[],p=new Array(s).fill(0),d=o.shape.slice();d[i]=1;for(var m=new Array(u),f=0;f<m.length;f++){p[i]=f;var v=Dc({inputs:{x:o},backend:t,attrs:{begin:p,size:d}}),g=Oe({inputs:{x:v},backend:t,attrs:{shape:l}});m[f]=g,h.push(v)}return h.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),m}var a8e={kernelName:S.Unpack,backendName:"webgl",kernelFunc:n8e};var i8e=function(){function r(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,a=e.batchSize,i=e.inSize,o=e.numSegments,s=o*Math.ceil(i/n);this.outputShape=[a,s];var u="0.0",l="sumValue",c=Math.floor(n/4)*4,f=n%4,h=`
        sumValue += dot(values, segFilter);
    `,p="";i%n>0&&(p=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `);var d="";i%n>0&&(d=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = `+u+`;

      float getValue(int batch, int inIdx) {
        `+p+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+d+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+o+")) * float("+n+`));
        int currentSeg = int(mod(float(outIdx), float(`+o+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+c+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+h+`
        }

        int inIdx = inOffset + `+c+`;
        if (`+(f===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+h+`
        } else if (`+(f===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+h+`
        } else if (`+(f===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+h+`
        }
        setOutput(`+l+`);
      }
    `}return r}();function o8e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.segmentIds,o=n.numSegments,s=a.shape.length,u=[],l=0,c=S.backend_util.getAxesPermutation([l],s),f=a;c!=null&&(f=An({inputs:{x:a},backend:t,attrs:{perm:c}}),u.push(f),l=S.backend_util.getInnerMostAxes(1,s)[0]);var h=S.backend_util.segment_util.computeOutShape(f.shape,l,o),p=S.util.sizeFromShape([f.shape[l]]),d=Oe({inputs:{x:f},backend:t,attrs:{shape:[-1,p]}});u.push(d);var m=S.sumOutType(a.dtype),v=function(x,k,N,T,I){var F=x.shape[0],D=x.shape[1],R=S.backend_util.segment_util.segOpComputeOptimalWindowSize(D,I),P={windowSize:R,inSize:D,batchSize:F,numSegments:I},B=new i8e(P,k),q=t.compileAndRun(B,[x,N],T);if(u.push(q),q.shape[1]===I)return q;var O=IV({backend:t,attrs:{start:0,stop:I,step:1,dtype:"float32"}}),V=AV({inputs:{x:O},backend:t,attrs:{reps:[D/R]}});u.push(O),u.push(V);var K=v(q,k,V,T,I);return K},g=v(d,"unsortedSegmentSum",i,m,o),y=Oe({inputs:{x:g},backend:t,attrs:{shape:h}}),b=y;if(c!=null){u.push(y);var w=S.backend_util.getUndoAxesPermutation(c);b=An({inputs:{x:b},backend:t,attrs:{perm:w}})}return u.forEach(function(x){return t.disposeIntermediateTensorInfo(x)}),b}var s8e={kernelName:S.UnsortedSegmentSum,backendName:"webgl",kernelFunc:o8e},Nk,JW,u8e=[iVe,sVe,cVe,pVe,vVe,yVe,wVe,kVe,TVe,CVe,DVe,OVe,BVe,WVe,GVe,HVe,jVe,JVe,eGe,rGe,oGe,pGe,vGe,gGe,SGe,EGe,AGe,qqe,FGe,BGe,WGe,KGe,XGe,ZGe,QGe,tUe,aUe,sUe,cUe,hUe,dUe,mUe,bUe,xUe,EUe,IUe,_Ue,RUe,PUe,zUe,VUe,KUe,YUe,QUe,e6e,r6e,a6e,o6e,u6e,c6e,d6e,g6e,w6e,k6e,E6e,C6e,F6e,M6e,Wqe,L6e,PGe,W6e,G6e,K6e,Gqe,Z6e,tHe,nHe,sHe,cHe,dHe,gHe,xHe,EHe,CHe,_He,OHe,MHe,LHe,qHe,GHe,HHe,jHe,YHe,eKe,aKe,uKe,mKe,Kqe,wKe,SKe,TKe,AKe,bGe,FKe,OKe,MKe,zKe,VKe,Hqe,UKe,KKe,XKe,YKe,wGe,hKe,QKe,n5e,s5e,Xqe,f5e,d5e,y5e,x5e,E5e,I5e,_5e,R5e,P5e,L5e,W5e,G5e,j5e,Z5e,eje,nje,fGe,dKe,oje,uje,cje,hje,dje,mje,yje,wje,kje,Eje,Ije,Aje,Fje,Oje,Mje,Lje,pKe,rVe,Wje,Gje,Kje,Zje,e8e,nVe,r8e,a8e,s8e,RKe];try{for(Yh=ga(u8e),wc=Yh.next();!wc.done;wc=Yh.next())QW=wc.value,S.registerKernel(QW)}catch(r){Nk={error:r}}finally{try{wc&&!wc.done&&(JW=Yh.return)&&JW.call(Yh)}finally{if(Nk)throw Nk.error}}var QW,Yh,wc;no.GPGPUContext=dg;no.MathBackendWebGL=Gk;no.forceHalfFloat=Qq;no.gpgpu_util=S$e;no.setWebGLContext=eq;no.version_webgl=zqe;no.webgl=$qe;no.webgl_util=Aze});var Mp=ue(nl=>{"use strict";Object.defineProperty(nl,"__esModule",{value:!0});function l8e(r){return r&&typeof r=="object"&&"default"in r?r.default:r}var Zk=ru(),rG=JR(),c8e=l8e(rG),Jk=WB(),Qk=Ez(),nG=Kz(),f8e=EW(),h8e=_V(),aG="Abs",iG="Acos",oG="Acosh",x2="Add",sG="AddN",p8e="All",d8e="Any",uG="ArgMax",lG="ArgMin",cG="Asin",fG="Asinh",hG="Atan",pG="Atanh",dG="Atan2",vG="AvgPool",v8e="AvgPoolGrad",mG="AvgPool3D",m8e="AvgPool3DGrad",gG="BatchMatMul",yG="BatchToSpaceND",g8e="Bincount",y8e="BroadcastTo",b8e="BroadcastArgs",k2="Cast",bG="Ceil",wG="ClipByValue",w8e="Complex",xG="ComplexAbs",kG="Concat",SG="Conv2D",x8e="Conv2DBackpropFilter",NG="Conv2DBackpropInput",EG="Conv3D",k8e="Conv3DBackpropFilterV2",S8e="Conv3DBackpropInputV2",TG="Cos",IG="Cosh",N8e="Cumprod",CG="Cumsum",E8e="CropAndResize",T8e="DenseBincount",I8e="DepthToSpace",AG="DepthwiseConv2dNative",C8e="DepthwiseConv2dNativeBackpropFilter",A8e="DepthwiseConv2dNativeBackpropInput",_8e="Diag",_G="Dilation2D",D8e="Dilation2DBackpropInput",F8e="Dilation2DBackpropFilter",DG="RealDiv",R8e="Einsum",FG="Elu",O8e="EluGrad",RG="Erf",P8e="Equal",OG="Exp",PG="ExpandDims",MG="Expm1",M8e="FFT",B8e="Fill",L8e="FlipLeftRight",BG="Floor",LG="FloorDiv",zG="FusedBatchNorm",$G="GatherV2",z8e="GatherNd",$8e="Greater",WG="GreaterEqual",S2="Identity",W8e="IFFT",q8e="Imag",qG="IsFinite",VG="IsInf",GG="IsNan",UG="LeakyRelu",V8e="Less",G8e="LessEqual",HG="Log",KG="Log1p",U8e="LogicalAnd",H8e="LogicalNot",K8e="LogicalOr",j8e="LogSoftmax",jG="LRN",X8e="LRNGrad",XG="Max",YG="Maximum",ZG="MaxPool",Y8e="MaxPoolGrad",JG="MaxPool3D",Z8e="MaxPool3DGrad",J8e="MaxPoolWithArgmax",QG="Mean",eU="Min",tU="Minimum",rU="MirrorPad",nU="Mod",Q8e="Multinomial",aU="Multiply",iU="Neg",e7e="NotEqual",t7e="NonMaxSuppressionV3",r7e="NonMaxSuppressionV4",n7e="NonMaxSuppressionV5",oU="OnesLike",sU="OneHot",uU="Pack",lU="PadV2",cU="Pow",fU="Prelu",hU="Prod",a7e="RaggedGather",i7e="RaggedTensorToTensor",o7e="Range",s7e="Real",pU="Reciprocal",dU="Relu",vU="Reshape",mU="ResizeNearestNeighbor",u7e="ResizeNearestNeighborGrad",gU="ResizeBilinear",l7e="ResizeBilinearGrad",yU="Relu6",bU="Reverse",wU="Round",xU="Rsqrt",c7e="ScatterNd",f7e="SearchSorted",kU="Select",SU="Selu",NU="Slice",EU="Sin",TU="Sinh",IU="Sign",CU="Sigmoid",AU="Softplus",_U="Sqrt",DU="Sum",FU="SpaceToBatchND",RU="SplitV",OU="Softmax",h7e="SparseFillEmptyRows",p7e="SparseReshape",d7e="SparseSegmentMean",v7e="SparseSegmentSum",m7e="SparseToDense",PU="SquaredDifference",g7e="Square",y7e="StridedSlice",b7e="StringNGrams",w7e="StringSplit",x7e="StringToHashBucketFast",MU="Sub",BU="Tan",LU="Tanh",N2="Tile",k7e="TopK",S7e="Transform",Ng="Transpose",N7e="Unique",zU="Unpack",$U="UnsortedSegmentSum",WU="ZerosLike",qU="Step",DV="FromPixels",E7e="RotateWithOffset",FV="_FusedMatMul",RV="FusedConv2D",OV="FusedDepthwiseConv2D";var T7e=1e-7,I7e=1e-4,e2=class{refCount(e){return Pa("refCount")}incRef(e){return Pa("incRef")}timerAvailable(){return!0}time(e){return Pa("time")}read(e){return Pa("read")}readSync(e){return Pa("readSync")}readToGPU(e,t){return Pa("readToGPU")}numDataIds(){return Pa("numDataIds")}disposeData(e,t){return Pa("disposeData")}write(e,t,n){return Pa("write")}move(e,t,n,a,i){return Pa("move")}memory(){return Pa("memory")}floatPrecision(){return Pa("floatPrecision")}epsilon(){return this.floatPrecision()===32?T7e:I7e}dispose(){return Pa("dispose")}};function Pa(r){throw new Error(`'${r}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function U(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function oo(r,e,t=""){U(Kc(r,e),()=>t+` Shapes ${r} and ${e} must match`)}function E2(r){U(r!=null,()=>"The input to the tensor constructor must be a non-null value.")}function Lg(r,e=[],t=!1){if(e==null&&(e=[]),Array.isArray(r)||ao(r)&&!t)for(let n=0;n<r.length;++n)Lg(r[n],e,t);else e.push(r);return e}function ba(r){if(r.length===0)return 1;let e=r[0];for(let t=1;t<r.length;t++)e*=r[t];return e}function Kc(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function wp(r){return r%1===0}function Eg(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function Li(r,e){let t=e.length;return r=r==null?e.map((n,a)=>a):[].concat(r),U(r.every(n=>n>=-t&&n<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${r}`),U(r.every(n=>wp(n)),()=>`All values in axis param must be integers but got axis ${r}`),r.map(n=>n<0?t+n:n)}function C7e(r,e){let t=[],n=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:Li(e,r).sort(),o=0;for(let s=0;s<r.length;++s){if(i!=null){if(i[o]===s&&r[s]!==1)throw new Error(`Can't squeeze axis ${s} since its dim '${r[s]}' is not 1`);(i[o]==null||i[o]>s)&&r[s]===1&&(t.push(r[s]),n.push(s)),i[o]<=s&&o++}r[s]!==1&&(t.push(r[s]),n.push(s))}return{newShape:t,keptDims:n}}function A7e(r,e){let t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else if(r==="string")t=new Array(e);else throw new Error(`Unknown data type ${r}`);return t}function _7e(r,e){for(let t=0;t<r.length;t++){let n=r[t];if(isNaN(n)||!isFinite(n))throw Error(`A tensor of type ${e} being uploaded contains ${n}.`)}}function D7e(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function ao(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}function PV(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error(`Unknown dtype ${r}`)}function F7e(r){if(r==null)return 0;let e=0;return r.forEach(t=>e+=t.length),e}function T2(r){return typeof r=="string"||r instanceof String}function R7e(r){return typeof r=="boolean"}function O7e(r){return typeof r=="number"}function I2(r){return Array.isArray(r)?I2(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":O7e(r)?"float32":T2(r)?"string":R7e(r)?"bool":"float32"}function t2(r){return!!(r&&r.constructor&&r.call&&r.apply)}function C2(r){let e=r.length;if(e<2)return[];let t=new Array(e-1);t[e-2]=r[e-1];for(let n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function VU(r,e,t,n=!1){let a=new Array;if(e.length===1){let i=e[0]*(n?2:1);for(let o=0;o<i;o++)a[o]=t[r+o]}else{let i=e[0],o=e.slice(1),s=o.reduce((u,l)=>u*l)*(n?2:1);for(let u=0;u<i;u++)a[u]=VU(r+u*s,o,t,n)}return a}function MV(r,e,t=!1){if(r.length===0)return e[0];let n=r.reduce((a,i)=>a*i)*(t?2:1);if(n===0)return[];if(n!==e.length)throw new Error(`[${r}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return VU(0,r,e,t)}function GU(r,e){let t=A2(r,e);for(let n=0;n<t.length;n++)t[n]=1;return t}function A2(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error(`Unknown data type ${e}`)}function UU(r){r.forEach(e=>{U(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${r}].`)})}function HU(r){return r&&r.then&&typeof r.then=="function"}var BV="tfjsflags",r2=class{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=P7e,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(Br().getBool("IS_TEST")||Br().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){let a=this.urlFlags[e];Br().getBool("IS_TEST")||Br().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${a}.`),this.set(e,a)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];let t=this.evaluateFlag(e);if(HU(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;let e=this.getQueryParams(this.global.location.search);BV in e&&e[BV].split(",").forEach(n=>{let[a,i]=n.split(":");this.urlFlags[a]=B7e(a,i)})}};function P7e(r){let e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...n)=>(M7e(e,n[0],n[1]),n.join("="))),e}function M7e(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function B7e(r,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if(`${+e}`===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${r}.`)}function Br(){return KU}var KU=null;function L7e(r){KU=r}var jk;function jU(){if(jk==null){let r;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");jk=r}return jk}function z7e(){let r=jU();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function _2(r,e){let t=z7e();if(t.has(r))return t.get(r);{let n=e();return t.set(r,n),t.get(r)}}function Fc(...r){Br().getBool("IS_TEST")||Br().getBool("PROD")||console.warn(...r)}var XU=_2("kernelRegistry",()=>new Map),n2=_2("gradRegistry",()=>new Map);function a2(r,e){let t=W7e(r,e);return XU.get(t)}function LV(r){return n2.get(r)}function zV(r){let e=XU.entries(),t=[];for(;;){let{done:n,value:a}=e.next();if(n)break;let[i,o]=a,[s]=i.split("_");s===r&&t.push(o)}return t}function $7e(r){let{kernelName:e}=r;n2.has(e)&&Br().getBool("DEBUG")&&Fc(`Overriding the gradient for '${e}'`),n2.set(e,r)}function W7e(r,e){return`${e}_${r}`}var q7e=c8e||rG;function D2(r){return q7e.fromString(r,!0,16)}var Hit=D2("c3a5c85c97cb3127"),Kit=D2("b492b66fbe98f273"),jit=D2("9ae16a3b2f90404f");function V7e(r,e){return r instanceof Float32Array&&e==="float32"||r instanceof Int32Array&&e==="int32"||r instanceof Uint8Array&&e==="bool"}function YU(r,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=Lg(r)),Br().getBool("DEBUG")&&_7e(r,e),V7e(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){let t=new Uint8Array(r.length);for(let n=0;n<t.length;++n)Math.round(r[n])!==0&&(t[n]=1);return t}else throw new Error(`Unknown data type ${e}`)}function _g(){return Br().platform.now()}function G7e(r,e="utf-8"){return e=e||"utf-8",Br().platform.encode(r,e)}function $V(r,e="utf-8"){return e=e||"utf-8",Br().platform.decode(r,e)}var i2=class{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new o2)}profileKernel(e,t,n){let a,i=()=>{a=n()},o,s=_g();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(let l of a)l.dataSync();o=Promise.resolve({kernelMs:_g()-s})}if(Br().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let l=0;l<a.length;l++){let c=a[l];c.data().then(f=>{U7e(f,c.dtype,e)})}return{kernelName:e,outputs:a,inputs:t,timeMs:o.then(l=>l.kernelMs),extraInfo:o.then(l=>l.getExtraProfileInfo!=null?l.getExtraProfileInfo():"")}}logKernelProfile(e){let{kernelName:t,outputs:n,timeMs:a,inputs:i,extraInfo:o}=e;n.forEach(s=>{Promise.all([s.data(),a,o]).then(u=>{this.logger.logKernelProfile(t,s,u[0],u[1],i,u[2])})})}};function U7e(r,e,t){if(e!=="float32")return!1;for(let n=0;n<r.length;n++){let a=r[n];if(isNaN(a)||!isFinite(a))return console.warn(`Found ${a} in the result of '${t}'`),!0}return!1}var o2=class{logKernelProfile(e,t,n,a,i,o){let s=typeof a=="number"?Eg(`${a}ms`,9):a.error,u=Eg(e,25),l=t.rank,c=t.size,f=Eg(t.shape.toString(),14),h="";for(let p in i){let d=i[p];if(d!=null){let m=d.shape||t.shape,v=m.length;h+=`${p}: ${v}D ${v>0?m:""} `}}console.log(`%c${u}	%c${s}	%c${l}D ${f}	%c${c}	%c${h}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};function H7e(r,e,t){let n={},a={};for(let u=0;u<e.length;u++)n[e[u].id]=!0;for(let u=0;u<r.length;u++){let l=r[u],c=l.inputs;for(let f in c){let h=c[f],p=!1;for(let d=0;d<e.length;d++)if(n[h.id]){l.outputs.forEach(m=>n[m.id]=!0),p=!0,a[l.id]=!0;break}if(p)break}}let i={};i[t.id]=!0;let o={};for(let u=r.length-1;u>=0;u--){let l=r[u],c=l.inputs;for(let f=0;f<l.outputs.length;f++)if(i[l.outputs[f].id]){for(let h in c)i[c[h].id]=!0,o[l.id]=!0;break}}let s=[];for(let u=0;u<r.length;u++){let l=r[u];if(a[l.id]&&o[l.id]){let c={};for(let h in l.inputs){let p=l.inputs[h];n[p.id]&&(c[h]=p)}let f=Object.assign({},l);f.inputs=c,f.outputs=l.outputs,s.push(f)}}return s}function K7e(r,e,t,n){for(let a=e.length-1;a>=0;a--){let i=e[a],o=[];if(i.outputs.forEach(u=>{let l=r[u.id];l!=null?o.push(l):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);let s=i.gradient(o);for(let u in i.inputs){if(!(u in s))throw new Error(`Cannot backprop through input ${u}. Available gradients found: ${Object.keys(s)}.`);let l=t(()=>s[u]());if(l.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${u} must have 'float32' dtype, but has '${l.dtype}'`);let c=i.inputs[u];if(!Kc(l.shape,c.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${u}' has shape '${l.shape}', which does not match the shape of the input '${c.shape}'`);if(r[c.id]==null)r[c.id]=l;else{let f=r[c.id];r[c.id]=n(f,l),f.dispose()}}}}var WV=20,hp=3,Xk=7;function j7e(r,e,t,n){let a=C2(e),i=X7e(r,e,t,a),o=e.length,s=Tg(r,e,t,a,i),u=["Tensor"];return n&&(u.push(`  dtype: ${t}`),u.push(`  rank: ${o}`),u.push(`  shape: [${e}]`),u.push("  values:")),u.push(s.map(l=>"    "+l).join(`
`)),u.join(`
`)}function X7e(r,e,t,n){let a=ba(e),i=n[n.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?gp(r):r;if(s>1)for(let l=0;l<a/i;l++){let c=l*i;for(let f=0;f<i;f++)o[f]=Math.max(o[f],mp(u[c+f],0,t).length)}return o}function mp(r,e,t){let n;return Array.isArray(r)?n=`${parseFloat(r[0].toFixed(Xk))} + ${parseFloat(r[1].toFixed(Xk))}j`:T2(r)?n=`'${r}'`:t==="bool"?n=ZU(r):n=parseFloat(r.toFixed(Xk)).toString(),Eg(n,e)}function ZU(r){return r===0?"false":"true"}function Tg(r,e,t,n,a,i=!0){let o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){let m=gp(r);return[mp(m[0],0,t)]}return t==="bool"?[ZU(r[0])]:[r[0].toString()]}if(u===1){if(s>WV){let v=hp*o,g=Array.from(r.slice(0,v)),y=Array.from(r.slice((s-hp)*o,s*o));return t==="complex64"&&(g=gp(g),y=gp(y)),["["+g.map((b,w)=>mp(b,a[w],t)).join(", ")+", ..., "+y.map((b,w)=>mp(b,a[s-hp+w],t)).join(", ")+"]"]}let m=t==="complex64"?gp(r):Array.from(r);return["["+m.map((v,g)=>mp(v,a[g],t)).join(", ")+"]"]}let l=e.slice(1),c=n.slice(1),f=n[0]*o,h=[];if(s>WV){for(let m=0;m<hp;m++){let v=m*f,g=v+f;h.push(...Tg(r.slice(v,g),l,t,c,a,!1))}h.push("...");for(let m=s-hp;m<s;m++){let v=m*f,g=v+f;h.push(...Tg(r.slice(v,g),l,t,c,a,m===s-1))}}else for(let m=0;m<s;m++){let v=m*f,g=v+f;h.push(...Tg(r.slice(v,g),l,t,c,a,m===s-1))}let p=u===2?",":"";h[0]="["+h[0]+p;for(let m=1;m<h.length-1;m++)h[m]=" "+h[m]+p;let d=`,
`;for(let m=2;m<u;m++)d+=`
`;return h[h.length-1]=" "+h[h.length-1]+"]"+(i?"":d),h}function gp(r){let e=[];for(let t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var s2=class{constructor(e,t,n){if(this.dtype=t,this.shape=e.slice(),this.size=ba(e),n!=null){let a=n.length;U(a===this.size,()=>`Length of values '${a}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||A7e(t,this.size),this.strides=C2(e)}set(e,...t){t.length===0&&(t=[0]),U(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);let n=this.locToIndex(t);this.values[n]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(let a of e){if(a<0||a>=this.shape[t]){let i=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(i)}t++}let n=e[e.length-1];for(let a=0;a<e.length-1;++a)n+=this.strides[a]*e[a];return this.values[n]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];let t=new Array(this.shape.length);for(let n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return Mi().makeTensor(this.values,this.shape,this.dtype)}},Mi=null,pp=null,Y7e=null;function Z7e(r){Mi=r}function J7e(r){Y7e=r}var bn=class{constructor(e,t,n,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=ba(e),this.strides=C2(e),this.dataId=n,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){let e=await this.data();return pp.buffer(this.shape,this.dtype,e)}bufferSync(){return pp.buffer(this.shape,this.dtype,this.dataSync())}async array(){let e=await this.data();return MV(this.shape,e,this.dtype==="complex64")}arraySync(){return MV(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();let e=Mi().read(this.dataId);if(this.dtype==="string"){let t=await e;try{return t.map(n=>$V(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Mi().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();let e=Mi().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>$V(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();let e=await Mi().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(Mi().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return pp.print(this,e)}clone(){return this.throwIfDisposed(),pp.clone(this)}toString(e=!1){let t=this.dataSync();return j7e(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),pp.cast(this,e)}variable(e=!0,t,n){return this.throwIfDisposed(),Mi().makeVariable(this,e,t,n)}};Object.defineProperty(bn,Symbol.hasInstance,{value:r=>!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null});function ye(){return _2("Tensor",()=>bn)}ye();var Mc=class extends bn{constructor(e,t,n,a){super(e.shape,e.dtype,e.dataId,a),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!Kc(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Mi().disposeTensor(this),this.dataId=e.dataId,Mi().incRef(this,null)}dispose(){Mi().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(Mc,Symbol.hasInstance,{value:r=>r instanceof bn&&r.assign!=null&&r.assign instanceof Function});var qV;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(qV||(qV={}));var u2;(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(u2||(u2={}));var l2;(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(l2||(l2={}));var c2;(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(c2||(c2={}));var f2;(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(f2||(f2={}));var Q7e={float32:c2,int32:u2,bool:l2,complex64:f2};function eXe(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${r} with ${e}`)}return Q7e[r][e]}function Lr(r,e){if(r.dtype===e.dtype)return[r,e];let t=eXe(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function tXe(r,e){U(r.dtype===e.dtype,()=>`The dtypes of the first(${r.dtype}) and second(${e.dtype}) input must match`)}function JU(r){let e=[];return QU(r,e,new Set),e}function QU(r,e,t){if(r==null)return;if(r instanceof bn){e.push(r);return}if(!rXe(r))return;let n=r;for(let a in n){let i=n[a];t.has(i)||(t.add(i),QU(i,e,t))}}function rXe(r){return Array.isArray(r)||typeof r=="object"}function Yk(r){return r.kernelName!=null}var Dg=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(let e in this.registeredVariables)this.registeredVariables[e].dispose()}},Is=class{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Dg}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;let e=this.getSortedBackends();for(let t=0;t<e.length;t++){let n=e[t];if(await this.initializeBackend(n).success){await this.setBackend(n);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){let{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){let{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,n=1){return e in this.registryFactory?(Fc(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;let{success:t,asyncInit:n}=this.initializeBackend(e);if(!(n?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new i2(this.backendInstance),!0}setupRegisteredKernels(){zV(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){zV(e).forEach(n=>{n.disposeFunc!=null&&n.disposeFunc(this.registry[e])})}initializeBackend(e){let t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{let n=t.factory();if(n&&!(n instanceof e2)&&typeof n.then=="function"){let a=++this.pendingBackendInitId,i=n.then(o=>a<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(a<this.pendingBackendInitId||(this.pendingBackendInit=null,Fc(`Initialization of backend ${e} failed`),Fc(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=n,{success:!0,asyncInit:!1}}catch(n){return Fc(`Initialization of backend ${e} failed`),Fc(n.stack||n.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){let e=this.getSortedBackends();for(let t=0;t<e.length;t++){let n=e[t],{success:a,asyncInit:i}=this.initializeBackend(n);if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){let n=this.state.tensorInfo.get(t),a=n.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let n=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");n=e}let a;return this.scopedRun(()=>this.startScope(n),()=>this.endScope(a),()=>(a=t(),a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),a))}scopedRun(e,t,n){e();try{let a=n();return t(),a}catch(a){throw t(),a}}nextTensorId(){return Is.nextTensorId++}nextVariableId(){return Is.nextVariableId++}clone(e){let t=ae.runKernel(S2,{x:e}),n={x:e},a=o=>({x:()=>{let s="float32",u={x:o},l={dtype:s};return ae.runKernel(k2,u,l)}}),i=[];return this.addTapeNode(this.state.activeScope.name,n,[t],a,i,{}),t}runKernel(e,t,n){if(this.backendName==null&&this.backend,!(a2(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,n){let a=this.backend.numDataIds(),i=0;n.forEach(u=>{i+=u.dtype==="complex64"?3:1});let o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${s} data ids) after running '${e}'`)}runKernelFunc(e){let t,n=[],a=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let s;this.backendName==null&&this.backend;let u,l=Yk(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Yk(e)){let{kernelName:d,inputs:m,attrs:v}=e;this.backendName==null&&this.backend;let g=a2(d,this.backendName);U(g!=null,()=>`Cannot find registered kernel '${d}' for backend '${this.backendName}'`),s=()=>{let y=this.backend.numDataIds();u=g.kernelFunc({inputs:m,attrs:v,backend:this.backend});let b=Array.isArray(u)?u:[u];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(d,y,b);let w=b.map(x=>x.rank!=null?x:this.makeTensorFromTensorInfo(x));if(a){let x=this.getTensorsForGradient(d,m,w);n=this.saveTensorsForBackwardMode(x)}return w}}else{let{forwardFunc:d}=e,m=v=>{!a||(n=v.map(g=>this.keep(this.clone(g))))};s=()=>{let v=this.backend.numDataIds();u=this.tidy(()=>d(this.backend,m));let g=Array.isArray(u)?u:[u];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(l,v,g),g}}let{inputs:c,attrs:f}=e,h=Yk(e)?null:e.backwardsFunc,p;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=s():(p=this.profiler.profileKernel(l,c,()=>s()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),t=p.outputs)}),a&&this.addTapeNode(l,c,t,h,n,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map(d=>c[d]!=null?c[d].shape:null),outputShapes:t.map(d=>d.shape),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(u)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(n=>this.keep(this.clone(n)))}getTensorsForGradient(e,t,n){let a=LV(e);if(a!=null){let i=a.inputsToSave||[],o=a.outputsToSave||[],s;a.saveAllInputs?(U(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),s=Object.keys(t).map(l=>t[l])):s=i.map(l=>t[l]);let u=n.filter((l,c)=>o[c]);return s.concat(u)}return[]}makeTensor(e,t,n,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",a=a||this.backend;let i=e;n==="string"&&T2(e[0])&&(i=e.map(u=>G7e(u)));let o=a.write(i,t,n),s=new bn(t,n,o,this.nextTensorId());if(this.trackTensor(s,a),n==="string"){let u=this.state.tensorInfo.get(o),l=F7e(i);this.state.numBytes+=l-u.bytes,u.bytes=l}return s}makeTensorFromDataId(e,t,n,a){n=n||"float32";let i={dataId:e,shape:t,dtype:n};return this.makeTensorFromTensorInfo(i,a)}makeTensorFromTensorInfo(e,t){let{dataId:n,shape:a,dtype:i}=e,o=new bn(a,i,n,this.nextTensorId());return this.trackTensor(o,t),o}makeVariable(e,t=!0,n,a){n=n||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));let i=new Mc(e,t,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*PV(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof Mc||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;let t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){let n=e.size*PV(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(let e in this.state.registeredVariables){let t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){let e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;let t=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(a=>a.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n;for(let a of this.state.activeProfile.kernels)a.kernelTimeMs=await a.kernelTimeMs,a.extraInfo=await a.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,n,a,i,o){let s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},u=LV(e);u!=null&&(a=u.gradFunc),a!=null&&(s.gradient=l=>(l=l.map((c,f)=>{if(c==null){let h=n[f],p=A2(h.size,h.dtype);return this.makeTensor(p,h.shape,h.dtype)}return c}),a(l.length>1?l:l[0],i,o))),this.state.activeTape.push(s)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){let t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){let t=JU(e),n=new Set(t.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){let o=this.state.activeScope.track[i];!o.kept&&!n.has(o.id)&&o.dispose()}let a=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(i=>{!i.kept&&i.scopeId===a.id&&this.track(i)})}gradients(e,t,n,a=!1){if(U(t.length>0,()=>"gradients() received an empty list of xs."),n!=null&&n.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);let i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));U(i instanceof bn,()=>"The result y returned by f() must be a tensor.");let o=H7e(this.state.activeTape,t,i);if(!a&&o.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let s={};s[i.id]=n??nXe(i.shape),K7e(s,o,l=>this.tidy(l),iXe);let u=t.map(l=>s[l.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(l=>{for(let c of l.saved)c.dispose()}),this.state.activeTape=null),{value:i,grads:u}})}customGrad(e){return U(t2(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{U(t.every(s=>s instanceof bn),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let n,a={};t.forEach((s,u)=>{a[u]=s});let i=(s,u)=>(n=e(...t,u),U(n.value instanceof bn,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),U(t2(n.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),n.value),o=(s,u)=>{let l=n.gradFunc(s,u),c=Array.isArray(l)?l:[l];U(c.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),U(c.every(h=>h instanceof bn),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let f={};return c.forEach((h,p)=>{f[p]=()=>h}),f};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:a})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){let t=_g(),n=await this.backend.time(e);return n.wallMs=_g()-t,n}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Dg;for(let e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}};Is.nextTensorId=0;Is.nextVariableId=0;function nXe(r){let e=GU(ba(r),"float32");return ae.makeTensor(e,r,"float32")}function aXe(){let r=jU();if(r._tfengine==null){let e=new r2(r);r._tfengine=new Is(e)}return L7e(r._tfengine.ENV),Z7e(()=>r._tfengine),r._tfengine}var ae=aXe();function iXe(r,e){let t={a:r,b:e};return ae.runKernel(x2,t)}function Ap(r,e){let t=r;if(ao(r))return e==="string"?[]:[r.length];if(!Array.isArray(r))return[];let n=[];for(;Array.isArray(t)||ao(t)&&e!=="string";)n.push(t.length),t=t[0];return Array.isArray(r)&&Br().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&e6(r,n,[]),n}function e6(r,e,t){if(t=t||[],!Array.isArray(r)&&!ao(r)){U(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}U(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${r.length} elements`),U(r.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${r.length} elements`);let n=e.slice(1);for(let a=0;a<r.length;++a)e6(r[a],n,t.concat(a))}function VV(r,e,t,n){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==e||r==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${n}' must be ${r} tensor, but got ${e} tensor`)}}function W(r,e,t,n="numeric"){if(r instanceof bn)return VV(n,r.dtype,e,t),r;let a=I2(r);if(a!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(a=n),VV(n,a,e,t),r==null||!ao(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){let u=r==null?"null":r.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${u}'`)}let i=Ap(r,a);!ao(r)&&!Array.isArray(r)&&(r=[r]);let s=a!=="string"?YU(r,a):Lg(r,[],!0);return ae.makeTensor(s,i,a)}function Fg(r,e,t,n="numeric"){if(!Array.isArray(r))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return r.map((i,o)=>W(i,`${e}[${o}]`,t,n))}var oXe="__op";function Y(r){let e=Object.keys(r);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+oXe;let a=(...i)=>{ae.startScope(t);try{let o=n(...i);return HU(o)&&console.error("Cannot return a Promise inside of tidy."),ae.endScope(o),o}catch(o){throw ae.endScope(null),o}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function sXe(r,e){let t=W(r,"x","cast");if(!D7e(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");let n={x:t},a={dtype:e};return ae.runKernel(k2,n,a)}var Ye=Y({cast_:sXe});function uXe(r,e){let t=W(r,"a","mul"),n=W(e,"b","mul");[t,n]=Lr(t,n);let a={a:t,b:n};return ae.runKernel(aU,a)}var pe=Y({mul_:uXe});function lXe(r,e=0){let n={x:W(r,"x","step")},a={alpha:e};return ae.runKernel(qU,n,a)}var _p=Y({step_:lXe});var t6={kernelName:aG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>pe(r,_p(Ye(t,"float32"),-1))}}};function cXe(r,e){let t=W(r,"a","floorDiv"),n=W(e,"b","floorDiv");[t,n]=Lr(t,n);let a={a:t,b:n};return ae.runKernel(LG,a)}var r6=Y({floorDiv_:cXe});function fXe(r,e){let t=W(r,"a","div"),n=W(e,"b","div");if([t,n]=Lr(t,n),t.dtype==="int32"&&n.dtype==="int32")return r6(t,n);let a={a:t,b:n},i={};return ae.runKernel(DG,a,i)}var gt=Y({div_:fXe});function hXe(r){let t={x:W(r,"x","neg")};return ae.runKernel(iU,t)}var rn=Y({neg_:hXe});function Dp(r,e,t,n){if(n==null&&(n=I2(r)),n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!ao(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){UU(e);let a=ba(e),i=ba(t);U(a===i,()=>`Based on the provided shape, [${e}], the tensor should have ${a} values but has ${i}`);for(let o=0;o<t.length;++o){let s=t[o],u=o===t.length-1?s!==ba(e.slice(o)):!0;U(t[o]===e[o]||!u,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!ao(r)&&!Array.isArray(r)&&(r=[r]),e=e||t,r=n!=="string"?YU(r,n):Lg(r,[],!0),ae.makeTensor(r,e,n)}function kt(r,e){if((ao(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&ao(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Dp(r,[],[],e)}function pXe(r){let t={x:W(r,"x","sqrt","float32")};return ae.runKernel(_U,t)}var xa=Y({sqrt_:pXe});function dXe(r){let e=W(r,"x","square"),t={};return ae.runKernel("Square",{x:e},t)}var tr=Y({square_:dXe});function vXe(r,e){let t=W(r,"a","sub"),n=W(e,"b","sub");[t,n]=Lr(t,n);let a={a:t,b:n};return ae.runKernel(MU,a)}var ot=Y({sub_:vXe});var mXe={kernelName:iG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=tr(Ye(t,"float32")),a=xa(ot(kt(1),n));return rn(gt(r,a))}}}};var gXe={kernelName:oG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=xa(ot(tr(Ye(t,"float32")),1));return gt(r,n)}}}};function hn(r,e){let t=[];for(let n=0;n<e.length;n++){let a=r[r.length-n-1],i=e.length-n-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function rr(r,e){let t=[],n=Math.max(r.length,e.length);for(let a=0;a<n;a++){let i=r[r.length-a-1];i==null&&(i=1);let o=e[e.length-a-1];if(o==null&&(o=1),i===1)t.unshift(o);else if(o===1)t.unshift(i);else if(i!==o){let s=`Operands could not be broadcast together with shapes ${r} and ${e}.`;throw Error(s)}else t.unshift(i)}return t}function yXe(r,e){let n={x:W(r,"x","reshape","string_or_numeric")},a={shape:e};return ae.runKernel(vU,n,a)}var fe=Y({reshape_:yXe});function bXe(r,e=null,t=!1){let n=W(r,"x","sum");n.dtype==="bool"&&(n=Ye(n,"int32"));let a={x:n},i={axis:e,keepDims:t};return ae.runKernel(DU,a,i)}var ct=Y({sum_:bXe});var wXe={kernelName:x2,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=rr(t.shape,n.shape);return{a:()=>{let s=r,u=hn(t.shape,a);return u.length>0&&(s=ct(s,u)),fe(s,t.shape)},b:()=>{let s=r,u=hn(n.shape,a);return u.length>0&&(s=ct(s,u)),fe(s,n.shape)}}}};var xXe={kernelName:sG,saveAllInputs:!0,gradFunc:(r,e)=>{let t={};return e.forEach((n,a)=>{t[a]=()=>r.clone()}),t}};function kXe(r){let t={x:W(r,"x","zerosLike")};return ae.runKernel(WU,t)}var Ot=Y({zerosLike_:kXe});var SXe={kernelName:uG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Ot(t)}}};var NXe={kernelName:lG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Ot(t)}}};var EXe={kernelName:cG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>gt(r,xa(ot(kt(1),tr(Ye(t,"float32")))))}}};function TXe(r,e){let t=W(r,"a","add"),n=W(e,"b","add");[t,n]=Lr(t,n);let a={a:t,b:n};return ae.runKernel(x2,a)}var Qe=Y({add_:TXe});var IXe={kernelName:fG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=xa(Qe(kt(1),tr(Ye(t,"float32"))));return gt(r,n)}}}};var CXe={kernelName:dG,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=rr(t.shape,n.shape);return{a:()=>{let s=Qe(tr(t),tr(n)),u=pe(r,gt(n,s)),l=hn(t.shape,a);return l.length>0&&(u=ct(u,l)),fe(u,t.shape)},b:()=>{let s=Qe(tr(t),tr(n)),u=rn(pe(r,gt(t,s))),l=hn(n.shape,a);return l.length>0&&(u=ct(u,l)),fe(u,n.shape)}}}};var AXe={kernelName:hG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>gt(r,Qe(tr(Ye(t,"float32")),1))}}};var _Xe={kernelName:pG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>gt(r,ot(kt(1),tr(Ye(t,"float32"))))}}};function DXe(r,e,t,n,a,i,o="channelsLast"){let[s,u]=Rg(e),l;if(o==="channelsLast")l=[s,u,r[3],r[3]];else if(o==="channelsFirst")l=[s,u,r[1],r[1]];else throw new Error(`Unknown dataFormat ${o}`);return F2(r,l,t,n,a,i,!1,o)}function F2(r,e,t,n,a,i,o=!1,s="channelsLast"){let[u,l,c,f]=[-1,-1,-1,-1];if(s==="channelsLast")[u,l,c,f]=r;else if(s==="channelsFirst")[u,f,l,c]=r;else throw new Error(`Unknown dataFormat ${s}`);let[h,p,,d]=e,[m,v]=Rg(t),[g,y]=Rg(n),b=h2(h,g),w=h2(p,y),{padInfo:x,outHeight:k,outWidth:N}=OXe(a,l,c,m,v,b,w,i,s),T=o?d*f:d,I;return s==="channelsFirst"?I=[u,T,k,N]:s==="channelsLast"&&(I=[u,k,N,T]),{batchSize:u,dataFormat:s,inHeight:l,inWidth:c,inChannels:f,outHeight:k,outWidth:N,outChannels:T,padInfo:x,strideHeight:m,strideWidth:v,filterHeight:h,filterWidth:p,effectiveFilterHeight:b,effectiveFilterWidth:w,dilationHeight:g,dilationWidth:y,inShape:r,outShape:I,filterShape:e}}function FXe(r,e,t,n,a){n==null&&(n=RXe(r,e,t));let i=r[0],o=r[1],s=Og((i-e+2*n)/t+1,a),u=Og((o-e+2*n)/t+1,a);return[s,u]}function RXe(r,e,t,n=1){let a=h2(e,n);return Math.floor((r[0]*(t-1)-t+a)/2)}function Rg(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function h2(r,e){return e<=1?r:r+(r-1)*(e-1)}function OXe(r,e,t,n,a,i,o,s,u){let l,c,f;if(typeof r=="number"){l={top:r,bottom:r,left:r,right:r,type:r===0?"VALID":"NUMBER"};let p=FXe([e,t],i,n,r,s);c=p[0],f=p[1]}else if(r==="same"){c=Math.ceil(e/n),f=Math.ceil(t/a);let h=Math.max(0,(c-1)*n+i-e),p=Math.max(0,(f-1)*a+o-t),d=Math.floor(h/2),m=h-d,v=Math.floor(p/2),g=p-v;l={top:d,bottom:m,left:v,right:g,type:"SAME"}}else if(r==="valid")l={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-i+1)/n),f=Math.ceil((t-o+1)/a);else if(typeof r=="object"){let h=u==="channelsLast"?r[1][0]:r[2][0],p=u==="channelsLast"?r[1][1]:r[2][1],d=u==="channelsLast"?r[2][0]:r[3][0],m=u==="channelsLast"?r[2][1]:r[3][1];l={top:h,bottom:p,left:d,right:m,type:h===0&&p===0&&d===0&&m===0?"VALID":"EXPLICIT"},c=Og((e-i+h+p)/n+1,s),f=Og((t-o+d+m)/a+1,s)}else throw Error(`Unknown padding parameter: ${r}`);return{padInfo:l,outHeight:c,outWidth:f}}function Og(r,e){if(!e)return Math.trunc(r);switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error(`Unknown roundingMode ${e}`)}}function Zu(r){let[e,t,n]=Rg(r);return e===1&&t===1&&n===1}function Po(r,e){return Zu(r)||Zu(e)}function Kn(r,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${r}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")U(wp(e),()=>`Error in ${r}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(n=>{n.forEach(a=>{U(wp(a),()=>`Error in ${r}: pad must be an integer when using dimRoundingMode ${t} but got pad ${a}.`)})});else throw Error(`Error in ${r}: Unknown padding parameter: ${e}`)}}function PXe(r,e,t,n,a,i){let o=W(r,"dy","avgPool3dGrad"),s=W(e,"input","avgPool3dGrad"),u=o,l=s,c=!1;s.rank===4&&(c=!0,u=fe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),l=fe(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),U(u.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),U(l.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${l.rank}.`),Kn("avgPool3dGrad",a,i);let f={dy:u,input:l},h={filterSize:t,strides:n,pad:a,dimRoundingMode:i},p=ae.runKernel(m8e,f,h);return c?fe(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var MXe=Y({avgPool3dGrad_:PXe});var BXe={kernelName:mG,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{filterSize:a,strides:i,pad:o,dimRoundingMode:s}=t;return{x:()=>MXe(r,n,a,i,o,s)}}};function LXe(r,e,t,n,a){let i=W(r,"dy","avgPoolGrad"),o=W(e,"input","avgPoolGrad");U(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let s=o,u=i,l=!1;o.rank===3&&(l=!0,s=fe(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=fe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),U(u.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${u.rank}.`),U(s.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${s.rank}.`);let c={dy:u,input:s},f={filterSize:t,strides:n,pad:a},h=ae.runKernel(v8e,c,f);return l?fe(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var zXe=Y({avgPoolGrad_:LXe});var $Xe={kernelName:vG,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{filterSize:a,strides:i,pad:o}=t;return{x:()=>zXe(r,n,a,i,o)}}};function WXe(r,e,t=!1,n=!1){let a=W(r,"a","matMul"),i=W(e,"b","matMul");[a,i]=Lr(a,i);let o={a,b:i},s={transposeA:t,transposeB:n};return ae.runKernel(gG,o,s)}var Rt=Y({matMul_:WXe});var qXe={kernelName:gG,inputsToSave:["a","b"],gradFunc:(r,e,t)=>{let[n,a]=e,{transposeA:i,transposeB:o}=t;return!i&&!o?{a:()=>Rt(r,a,!1,!0),b:()=>Rt(n,r,!0,!1)}:!i&&o?{a:()=>Rt(r,a,!1,!1),b:()=>Rt(r,n,!0,!1)}:i&&!o?{a:()=>Rt(a,r,!1,!0),b:()=>Rt(n,r,!1,!1)}:{a:()=>Rt(a,r,!0,!0),b:()=>Rt(r,n,!0,!0)}}};function VXe(r,e,t){let n=W(r,"x","spaceToBatchND");U(n.rank>=1+e.length,()=>`input rank ${n.rank} should be > than [blockShape] ${e.length}`),U(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),U(n.shape.reduce((o,s,u)=>u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o,!0),()=>`input spatial dimensions ${n.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);let a={x:n},i={blockShape:e,paddings:t};return ae.runKernel(FU,a,i)}var R2=Y({spaceToBatchND_:VXe});var GXe={kernelName:yG,gradFunc:(r,e,t)=>{let{blockShape:n,crops:a}=t;return{x:()=>R2(r,n,a)}}};var UXe={kernelName:y8e,gradFunc:(r,e,t)=>{let n=t,a=n.inputShape,i=n.shape,o=Array.from(i);for(let u=a.length-1;u>=0;u--)if(a[u]===i[u])o[u]=1;else if(a[u]!==1)throw new Error(`broadcastTo(): [${a}] cannot be broadcast to [${i}].`);let s=[];for(let u=0;u<o.length;u++)o[u]>1&&s.push(u);return{x:()=>ct(r,s,!0)}}};var HXe={kernelName:k2,gradFunc:r=>({x:()=>r.clone()})};var KXe={kernelName:bG,gradFunc:r=>({x:()=>Ot(r)})};function jXe(r,e){let t=W(r,"a","greaterEqual","string_or_numeric"),n=W(e,"b","greaterEqual","string_or_numeric");[t,n]=Lr(t,n),rr(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(WG,a)}var Fp=Y({greaterEqual_:jXe});function XXe(r,e){let t=W(r,"a","lessEqual","string_or_numeric"),n=W(e,"b","lessEqual","string_or_numeric");[t,n]=Lr(t,n),rr(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(G8e,a)}var jc=Y({lessEqual_:XXe});function YXe(r,e){let t=W(r,"a","logicalAnd","bool"),n=W(e,"b","logicalAnd","bool");rr(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(U8e,a)}var Bc=Y({logicalAnd_:YXe});function ZXe(r){let t={x:W(r,"x","clone","string_or_numeric")};return ae.runKernel(S2,t)}var bp=Y({clone_:ZXe});function JXe(r,e){let t=W(r,"broadcastTo","x"),n=t.shape;if(e.some(l=>!(l>0)||l%1!==0))throw new Error(`broadcastTo(): Invalid broadcast shape [${e}].`);if(e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){let l=t.shape.slice();for(;l.length<e.length;)l.unshift(1);t=fe(t,l)}let a=t.shape,i=Array.from(e);for(let l=e.length-1;l>=0;l--)if(a[l]===e[l])i[l]=1;else if(t.shape[l]!==1)throw new Error(`broadcastTo(): [${n}] cannot be broadcast to [${e}].`);if(i.map((l,c)=>l>1?c:-1).filter(l=>l>=0).length===0)return bp(t);let s={x:t},u={reps:i};return ae.runKernel(N2,s,u)}var Ig=Y({broadcastTo_:JXe});function QXe(r,e,t){let n=W(e,"a","where"),a=W(t,"b","where"),i=W(r,"condition","where","bool"),o=rr(rr(i.shape,n.shape),a.shape),s=Ig(i,o),u=Ig(n,o),l=Ig(a,o),c={condition:s,t:u,e:l};return ae.runKernel(kU,c)}var Ba=Y({where_:QXe});var e9e={kernelName:wG,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{clipValueMin:a,clipValueMax:i}=t;return{x:()=>Ba(Bc(Fp(n,a),jc(n,i)),r,Ot(r))}}};var t9e={kernelName:xG,inputsToSave:["x"],gradFunc:t6.gradFunc};function r9e(r,e,t=0){let a={x:W(r,"x","split")},i={numOrSizeSplits:e,axis:t};return ae.runKernel(RU,a,i)}var Lc=Y({split_:r9e});var n9e={kernelName:kG,saveAllInputs:!0,gradFunc:(r,e,t)=>{let n=e.map(u=>u.shape),{axis:a}=t,i=Li(a,e[0].shape)[0],o=n.map(u=>u[i]);return Lc(r,o,i).map(u=>()=>u)}};function a9e(r,e,t,n,a,i="NHWC",o){let s=r;r.rank===3&&(s=fe(r,[1,r.shape[0],r.shape[1],r.shape[2]]));let u=e;u.rank===3&&(u=fe(e,[1,e.shape[0],e.shape[1],e.shape[2]])),U(s.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${s.shape}.`),U(u.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`),U(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);let l=i==="NHWC"?s.shape[3]:s.shape[1],c=i==="NHWC"?u.shape[3]:u.shape[1];U(l===t[2],()=>`Error in conv2dDerFilter: depth of input ${l}) must match input depth in filter (${t[2]}.`),U(c===t[3],()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${t[3]}).`),Kn("conv2dDerFilter",a,o);let f={x:s,dy:u},h={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return ae.runKernel(x8e,f,h)}var O2=Y({conv2DBackpropFilter_:a9e});function i9e(r,e,t,n,a,i="NHWC",o){U(r.length===e.rank,()=>`Length of inShape (${r.length}) and rank of dy (${e.rank}) must match`);let s=r,u=e,l=!1;e.rank===3&&(l=!0,u=fe(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,r[0],r[1],r[2]]),U(s.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${s.length}.`),U(u.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`),U(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);let c=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];U(c===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${t.shape[2]}.`),U(f===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${t.shape[3]}.`),Kn("conv2dDerInput",a,o);let h={dy:u,filter:t},p={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=ae.runKernel(NG,h,p);return l?fe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var P2=Y({conv2DBackpropInput_:i9e});var o9e={kernelName:SG,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let[n,a]=e,{dilations:i,strides:o,pad:s,dataFormat:u}=t;return U(Zu(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>P2(n.shape,r,a,o,s,u),filter:()=>O2(n,r,a.shape,o,s,u)}}};function s9e(r,e,t,n,a="NHWC",i=[1,1],o){let s=W(r,"x","conv2d","float32"),u=W(e,"filter","conv2d","float32"),l=s,c=!1;s.rank===3&&(c=!0,l=fe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),U(l.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${l.rank}.`),U(u.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`),Kn("conv2d",n,o);let f=a==="NHWC"?l.shape[3]:l.shape[1];U(f===u.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${u.shape[2]}.`),U(Po(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);let h={x:l,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=ae.runKernel(SG,h,p);return c?fe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Rp=Y({conv2d_:s9e});var u9e={kernelName:NG,inputsToSave:["dy","filter"],gradFunc:(r,e,t)=>{let[n,a]=e,{strides:i,pad:o,dataFormat:s,dimRoundingMode:u}=t;return{dy:()=>Rp(r,a,i,o,s,1,u),filter:()=>O2(r,n,a.shape,i,o,s,u)}}};function l9e(r,e,t,n,a){let i=r;r.rank===4&&(i=fe(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));let o=e;o.rank===4&&(o=fe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),U(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),U(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),U(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),U(i.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${t[3]}.`),U(o.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${t[4]}).`);let s={x:i,dy:o},u={strides:n,pad:a,filterShape:t};return ae.runKernel(k8e,s,u)}var c9e=Y({conv3DBackpropFilter_:l9e});function f9e(r,e,t,n,a){U(r.length===e.rank,()=>`Length of inShape (${r.length}) and rank of dy (${e.rank}) must match`);let i=r,o=e,s=!1;e.rank===4&&(s=!0,o=fe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,r[0],r[1],r[2],r[3]]);let u=i[4],l=o.shape[4];U(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),U(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),U(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),U(u===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${t.shape[3]}.`),U(l===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${l}) must match output depth for filter ${t.shape[4]}.`);let c={dy:o,filter:t},f={pad:a,strides:n,inputShape:i},h=ae.runKernel(S8e,c,f);return s?fe(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var n6=Y({conv3DBackpropInput_:f9e});var h9e={kernelName:EG,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let{dilations:n,strides:a,pad:i}=t;U(Zu(n),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${n}'`);let[o,s]=e;return{x:()=>n6(o.shape,r,s,a,i),filter:()=>c9e(o,r,s.shape,a,i)}}};function p9e(r){let t={x:W(r,"x","sin","float32")};return ae.runKernel(EU,t)}var a6=Y({sin_:p9e});var d9e={kernelName:TG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>pe(rn(a6(Ye(t,"float32"))),r)}}};function v9e(r){let t={x:W(r,"x","sinh")};return ae.runKernel(TU,t)}var i6=Y({sinh_:v9e});var m9e={kernelName:IG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>pe(i6(Ye(t,"float32")),r)}}};function g9e(r,e){for(let t=0;t<r.length;++t)if(r[r.length-t-1]!==e-1-t)return!1;return!0}function y9e(r,e,t){let n=r.length+e.length,a=[],i=0,o=0;for(let s=0;s<n;s++)t.indexOf(s)===-1?a.push(r[i++]):a.push(e[o++]);return a}function b9e(r,e){let t=[],n=r.length;for(let i=0;i<n;i++)e.indexOf(i)===-1&&t.push(r[i]);let a=e.map(i=>r[i]);return[t,a]}function zc(r,e){let t=e.map(n=>1);return y9e(r,t,e)}function o6(r,e){if(g9e(r,e))return null;let t=[];for(let n=0;n<e;++n)r.indexOf(n)===-1&&t.push(n);return r.forEach(n=>t.push(n)),t}function M2(r){return r.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function w9e(r,e=0,t=!1,n=!1){let i={x:W(r,"x","cumsum")},o={axis:e,exclusive:t,reverse:n};return ae.runKernel(CG,i,o)}var s6=Y({cumsum_:w9e});function x9e(r){Br().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}J7e(x9e);function tn(r,e){return ae.tidy(r,e)}function wa(r){JU(r).forEach(t=>t.dispose())}function k9e(r){return ae.keep(r)}function S9e(r,e){let t=W(r,"real","complex"),n=W(e,"imag","complex");oo(t.shape,n.shape,`real and imag shapes, ${t.shape} and ${n.shape}, must match in call to tf.complex().`);let a={real:t,imag:n};return ae.runKernel(w8e,a)}var $c=Y({complex_:S9e});function N9e(r){let t={input:W(r,"input","imag")};return ae.runKernel(q8e,t)}var B2=Y({imag_:N9e});function E9e(r){let t={input:W(r,"input","real")};return ae.runKernel(s7e,t)}var Pg=Y({real_:E9e});function T9e(r,e,t){let n=W(r,"x","transpose");if(e==null&&(e=n.shape.map((o,s)=>s).reverse()),U(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of perm ${e}.`),e.forEach(o=>{U(o>=0&&o<n.rank,()=>`All entries in 'perm' must be between 0 and ${n.rank-1} but got ${e}`)}),n.rank<=1)return n.clone();let a={x:n},i={perm:e};return n.dtype==="complex64"?tn(()=>{let o=Pg(n),s=B2(n);return o=ae.runKernel(Ng,{x:o},i),s=ae.runKernel(Ng,{x:s},i),t&&(s=rn(s)),$c(o,s)}):ae.runKernel(Ng,a,i)}var io=Y({transpose_:T9e});var I9e={kernelName:CG,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{axis:a,exclusive:i,reverse:o}=t;return{x:()=>{let s=o6([a],n.rank),u=s6(r,a,i,!o);return s!=null&&(u=io(u,s)),u}}}};function C9e(r,e,t,n,a,i=[1,1],o){let s=r;r.rank===3&&(s=fe(r,[1,r.shape[0],r.shape[1],r.shape[2]]));let u=e;u.rank===3&&(u=fe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l={x:s,dy:u},c={strides:n,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return ae.runKernel(C8e,l,c)}var u6=Y({depthwiseConv2dNativeBackpropFilter_:C9e});function A9e(r,e,t,n,a,i=[1,1],o){let s=e,u=!1;e.rank===3&&(u=!0,s=fe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let l={dy:s,filter:t},c={strides:n,pad:a,dimRoundingMode:o,dilations:i,inputShape:r},f=ae.runKernel(A8e,l,c);return u?fe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var l6=Y({depthwiseConv2dNativeBackpropInput_:A9e});var _9e={kernelName:AG,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let{dilations:n,strides:a,pad:i,dimRoundingMode:o}=t,s=n??[1,1];U(Zu(s),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`);let[u,l]=e;return U(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${u.rank}.`),U(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${l.rank}.`),U(u.shape[3]===l.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`),U(Po(a,s),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${a} and dilations '${s}'.`),Kn("depthwiseConv2d",i,o),{x:()=>l6(u.shape,r,l,a,i,s,o),filter:()=>u6(u,r,l.shape,a,i,s,o)}}};var D9e={kernelName:_G,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let[n,a]=e,i={x:n,filter:a,dy:r},o={x:n,filter:a,dy:r};return{x:()=>ae.runKernel(D8e,i,t),filter:()=>ae.runKernel(F8e,o,t)}}};var F9e={kernelName:FG,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e,n={dy:r,y:t};return{x:()=>ae.runKernel(O8e,n)}}};function R9e(r){let t={x:W(r,"x","exp")};return ae.runKernel(OG,t)}var Bi=Y({exp_:R9e});var O9e={kernelName:RG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e,n=pe(Bi(rn(tr(t))),2/Math.sqrt(Math.PI));return{x:()=>pe(r,n)}}};var P9e={kernelName:OG,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e;return{x:()=>pe(r,t)}}};var M9e={kernelName:PG,inputsToSave:["input"],gradFunc:(r,e)=>{let[t]=e;return{input:()=>fe(r,t.shape)}}};var B9e={kernelName:MG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>pe(r,Bi(t))}}};var L9e={kernelName:BG,gradFunc:r=>({x:()=>Ot(r)})};var z9e={kernelName:LG,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=rr(t.shape,n.shape);return{a:()=>{let s=gt(r,Ye(n,"float32")),u=hn(t.shape,a);return u.length>0?fe(ct(s,u),t.shape):s},b:()=>{let s=pe(r,Ye(t,"float32")),u=hn(n.shape,a);u.length>0&&(s=fe(ct(s,u),n.shape));let l=tr(n);return rn(gt(s,Ye(l,"float32")))}}}};function $9e(r){let t={x:W(r,"x","rsqrt","float32")};return ae.runKernel(xU,t)}var c6=Y({rsqrt_:$9e});function W9e(r,e){let t=W(r,"x","tile","string_or_numeric");U(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);let n={x:t},a={reps:e};return ae.runKernel(N2,n,a)}var Oc=Y({tile_:W9e});var q9e={kernelName:zG,inputsToSave:["x","mean","variance","scale"],gradFunc:(r,e,t)=>{let{varianceEpsilon:n}=t,[a,i,o,s]=e,u=s??kt(1),l=hn(i.shape,a.shape),c=[];if(i.rank===1){for(let w=0;w<a.shape.length-1;++w)c.push(a.shape[w]);c.push(1)}let f=ot(a,i),h=pe(r,u),p=c6(Qe(o,kt(n))),d=pe(pe(pe(p,p),p),kt(-.5));return{x:()=>i.rank===1?fe(pe(pe(r,Oc(fe(p,[1,1,1,i.shape[0]]),c)),u),a.shape):fe(pe(pe(r,p),u),a.shape),mean:()=>{let w=pe(pe(p,kt(-1)),h);return i.rank===1&&(w=ct(w,l)),fe(w,i.shape)},variance:()=>{let w=pe(pe(d,f),h);return i.rank===1&&(w=ct(w,l)),fe(w,i.shape)},scale:()=>{let w=pe(f,p),x=pe(r,w);return i.rank===1&&(x=ct(x,l)),fe(x,i.shape)},offset:()=>{let w=r;return i.rank===1&&(w=ct(w,l)),fe(w,i.shape)}}}};function V9e(r,e,t){let n=W(r,"x","unsortedSegmentSum"),a=W(e,"segmentIds","unsortedSegmentSum","int32");U(wp(t),()=>"numSegments must be of dtype int");let i={x:n,segmentIds:a},o={numSegments:t};return ae.runKernel($U,i,o)}var f6=Y({unsortedSegmentSum_:V9e});var G9e={kernelName:$G,inputsToSave:["x","indices"],gradFunc:(r,e,t)=>{let[n,a]=e,{axis:i}=t,o=Li(i,n.shape)[0];return{x:()=>{let u=n.shape,l=a.size,c=u.slice(0,o),f=c.length,h=u.slice(i,u.length).slice(1),p=h.length,d=GV(0,f),m=GV(f+1,f+1+p),v=UV([c,[l],h]),g=fe(r,v),y=fe(a,[l]),b=UV([[f],d,m]),w=io(g,b),x=f6(w,y,n.shape[o]),k=M2(b);return x=io(x,k),x},indices:()=>a}}};function GV(r,e){let t=[];for(let n=r;n<e;++n)t.push(n);return t}function UV(r){let e=[];for(let t=0;t<r.length;++t)for(let n=0;n<r[t].length;++n)e.push(r[t][n]);return e}var U9e={kernelName:WG,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e;return{a:()=>Ot(t),b:()=>Ot(n)}}};var H9e={kernelName:S2,gradFunc:r=>({x:()=>Ye(r,"float32")})};var K9e={kernelName:qG,gradFunc:r=>({x:()=>Ot(r)})};var j9e={kernelName:VG,gradFunc:r=>({x:()=>Ot(r)})};var X9e={kernelName:GG,gradFunc:r=>({x:()=>Ot(r)})};function Y9e(r,e){let t=W(r,"a","greater","string_or_numeric"),n=W(e,"b","greater","string_or_numeric");[t,n]=Lr(t,n),rr(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel($8e,a)}var Mo=Y({greater_:Y9e});var Z9e={kernelName:UG,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{alpha:a}=t,i=Mo(n,0);return{x:()=>Ba(i,r,pe(r,a))}}};var J9e={kernelName:KG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>gt(r,Qe(t,1))}}};var Q9e={kernelName:HG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>gt(r,Ye(t,"float32"))}}};var eYe={kernelName:j8e,inputsToSave:[],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n]=e,{axis:a}=t;return{logits:()=>{let o=Bi(n);return ot(r,pe(ct(r,a,!0),o))}}}};function tYe(r,e,t,n=5,a=1,i=1,o=.5){let s={x:r,y:e,dy:t},u={depthRadius:n,bias:a,alpha:i,beta:o};return ae.runKernel(X8e,s,u)}var rYe=Y({localResponseNormalizationBackprop_:tYe});var nYe={kernelName:jG,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n,a]=e,{depthRadius:i,bias:o,alpha:s,beta:u}=t;return{x:()=>rYe(n,a,r,i,o,s,u)}}};function aYe(r,e){let t=W(r,"a","equal","string_or_numeric"),n=W(e,"b","equal","string_or_numeric");[t,n]=Lr(t,n),rr(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(P8e,a)}var L2=Y({equal_:aYe});function h6(r,e,t,n){return e.rank<t.rank&&(e=fe(e,zc(e.shape,n))),r.rank<t.rank&&(r=fe(r,zc(r.shape,n))),{x:()=>pe(r,Ye(L2(t,e),r.dtype))}}var HV={kernelName:XG,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let n=t,{reductionIndices:a}=n,i=e[0],o=e[1],s=Li(a,i.shape),u=h6(r,o,i,s);return{x:()=>u.x()}}};function iYe(r,e){let t=W(r,"a","less","string_or_numeric"),n=W(e,"b","less","string_or_numeric");[t,n]=Lr(t,n),rr(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(V8e,a)}var p6=Y({less_:iYe});var oYe={kernelName:YG,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e;return{a:()=>pe(r,Ye(Fp(t,n),"float32")),b:()=>pe(r,Ye(p6(t,n),"float32"))}}};function sYe(r,e,t,n,a,i,o){let s=W(r,"dy","maxPool3dGrad"),u=W(e,"input","maxPool3dGrad"),l=W(t,"output","maxPool3dGrad"),c=s,f=u,h=l,p=!1;u.rank===4&&(p=!0,c=fe(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),f=fe(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=fe(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),U(c.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),U(f.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${f.rank}.`),U(h.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${h.rank}.`),Kn("maxPool3dGrad",i,o);let d={dy:c,input:f,output:h},m={filterSize:n,strides:a,pad:i,dimRoundingMode:o},v=ae.runKernel(Z8e,d,m);return p?fe(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}var uYe=Y({maxPool3dGrad_:sYe});var lYe={kernelName:JG,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n,a]=e,{filterSize:i,strides:o,pad:s,dimRoundingMode:u}=t;return{x:()=>uYe(r,n,a,i,o,s,u)}}};function cYe(r,e,t,n,a,i,o){let s=W(r,"dy","maxPoolGrad"),u=W(e,"input","maxPoolGrad"),l=W(t,"output","maxPoolGrad");U(u.rank===s.rank,()=>`Rank of input (${u.rank}) does not match rank of dy (${s.rank})`),U(s.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${s.rank}.`),U(u.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${u.rank}.`),Kn("maxPoolGrad",i,o);let c={dy:s,input:u,output:l},f={filterSize:n,strides:a,pad:i,dimRoundingMode:o};return ae.runKernel(Y8e,c,f)}var fYe=Y({maxPoolGrad_:cYe});var hYe={kernelName:ZG,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n,a]=e,{filterSize:i,strides:o,pad:s}=t;return{x:()=>fYe(r,n,a,i,o,s)}}};function Wc(r,e="float32"){if(e==="complex64"){let n=Wc(r,"float32"),a=Wc(r,"float32");return $c(n,a)}let t=A2(ba(r),e);return ae.makeTensor(t,r,e)}function Op(r,e="float32"){if(e==="complex64"){let n=Op(r,"float32"),a=Wc(r,"float32");return $c(n,a)}let t=GU(ba(r),e);return ae.makeTensor(t,r,e)}var pYe={kernelName:QG,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{axis:a}=t,i=Li(a,n.shape),s=b9e(n.shape,i)[1],u=ba(s);return{x:()=>{let c=n.shape.slice();i.forEach(p=>{c[p]=1});let f=fe(r,c);return gt(pe(f,Op(n.shape,"float32")),u)}}}};var dYe={kernelName:eU,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let n=t,{axis:a}=n,[i,o]=e,s=Li(a,i.shape),u=h6(r,o,i,s);return{x:()=>u.x()}}};var vYe={kernelName:tU,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e;return{a:()=>pe(r,Ye(jc(t,n),"float32")),b:()=>pe(r,Ye(Mo(t,n),"float32"))}}};function mYe(r,e,t){let n=W(r,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");let a={x:n},i={begin:e,size:t};return ae.runKernel(NU,a,i)}var $t=Y({slice_:mYe});var gYe={kernelName:rU,inputsToSave:["x"],gradFunc:(r,e,t)=>{let n=e[0],{paddings:a}=t,i=a.map(o=>o[0]);return{x:()=>$t(r,i,n.shape)}}};function yYe(r){let t={x:W(r,"x","floor","float32")};return ae.runKernel(BG,t)}var z2=Y({floor_:yYe});var bYe={kernelName:nU,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=rr(t.shape,n.shape);return{a:()=>{let s=hn(t.shape,a);return s.length>0?fe(ct(r,s),t.shape):r},b:()=>{let s=pe(r,rn(z2(gt(t,n)))),u=hn(n.shape,a);return u.length>0?fe(ct(s,u),n.shape):s}}}};var wYe={kernelName:aU,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=rr(t.shape,n.shape);return{a:()=>{let s=pe(r,Ye(n,"float32")),u=hn(t.shape,a);return u.length>0?fe(ct(s,u),t.shape):s},b:()=>{let s=pe(r,Ye(t,"float32")),u=hn(n.shape,a);return u.length>0?fe(ct(s,u),n.shape):s}}}};var xYe={kernelName:iU,gradFunc:r=>({x:()=>rn(r)})};var kYe={kernelName:sU,inputsToSave:["indices"],gradFunc:(r,e)=>{let t=e[0];return{indices:()=>Wc(t.shape,"float32")}}};var SYe={kernelName:oU,gradFunc:r=>({x:()=>Ot(r)})};function NYe(r,e=0){let t=W(r,"x","unstack","string_or_numeric");U(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);let n={value:t},a={axis:e};return ae.runKernel(zU,n,a)}var zg=Y({unstack_:NYe});var EYe={kernelName:uU,saveAllInputs:!0,gradFunc:(r,e,t)=>{let{axis:n}=t;return zg(r,n).map(i=>()=>i)}};var KV={kernelName:lU,inputsToSave:["x"],gradFunc:(r,e,t)=>{let n=e[0],{paddings:a}=t,i=a.map(o=>o[0]);return{x:()=>$t(r,i,n.shape)}}};function TYe(r){let t={x:W(r,"x","log","float32")};return ae.runKernel(HG,t)}var qc=Y({log_:TYe});function IYe(r,e){let t=W(r,"base","pow"),n=W(e,"exp","pow");[t,n]=Lr(t,n);let a={a:t,b:n};return ae.runKernel(cU,a)}var Ju=Y({pow_:IYe});var CYe={kernelName:cU,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(r,e)=>{let[t,n,a]=e,i=t,o=n,s=rr(i.shape,o.shape);return{a:()=>{let c=Ye(o,"float32"),f=pe(r,pe(c,Ju(i,ot(c,kt(1))))),h=hn(i.shape,s);return h.length>0&&(f=ct(f,h)),fe(f,i.shape)},b:()=>{let c=Mo(i,0),f=Ba(c,qc(i),Ot(i)),h=pe(r,pe(a,f)),p=hn(o.shape,s);return p.length>0&&(h=ct(h,p)),fe(h,o.shape)}}}};var AYe={kernelName:fU,inputsToSave:["x","alpha"],gradFunc:(r,e)=>{let[t,n]=e,a=Mo(t,0);return{x:()=>Ba(a,r,pe(r,n)),alpha:()=>{let i=Ba(a,Ot(r),pe(r,t)),o=hn(n.shape,r.shape);return o.length>0&&(i=ct(i,o)),fe(i,n.shape)}}}};function _Ye(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var ka=Br();ka.registerFlag("DEBUG",()=>!1,r=>{r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});ka.registerFlag("IS_BROWSER",()=>_Ye());ka.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");ka.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));ka.registerFlag("PROD",()=>!1);ka.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>ka.getBool("DEBUG"));ka.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);ka.registerFlag("IS_TEST",()=>!1);ka.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>!0);ka.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);ka.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);ka.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);ka.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);function DYe(r,e,t){let n=Ap(r,t);return Dp(r,e,n,t)}var $2=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function jV(r){return $2?Buffer.byteLength(r):new Blob([r]).size}function FYe(r){if($2)return Buffer.from(r).toString("base64");let e=new Uint8Array(r),t="";for(let n=0,a=e.length;n<a;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function RYe(r){if($2){let n=Buffer.from(r,"base64");return n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}let e=atob(r),t=new Uint8Array(e.length);for(let n=0;n<e.length;++n)t.set([e.charCodeAt(n)],n);return t.buffer}function OYe(r){if(r.length===1)return r[0];let e=0;r.forEach(a=>{e+=a.byteLength});let t=new Uint8Array(e),n=0;return r.forEach(a=>{t.set(new Uint8Array(a),n),n+=a.byteLength}),t.buffer}function d6(r,e){let t={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy,weightsManifest:e};return r.signature!=null&&(t.signature=r.signature),r.userDefinedMetadata!=null&&(t.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(t.modelInitializer=r.modelInitializer),r.trainingConfig!=null&&(t.trainingConfig=r.trainingConfig),t}function PYe(r,e,t){let n={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy};if(r.trainingConfig!=null&&(n.trainingConfig=r.trainingConfig),r.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");n.weightSpecs=e,n.weightData=t}return r.signature!=null&&(n.signature=r.signature),r.userDefinedMetadata!=null&&(n.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(n.modelInitializer=r.modelInitializer),n}async function MYe(r,e){let t,n;return r.weightsManifest!=null&&([t,n]=await e(r.weightsManifest)),PYe(r,t,n)}function $g(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:jV(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:jV(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:r.weightData.byteLength}}function BYe(r){let e=[];for(let t of r)e.push(...t.weights);return e}var en=class{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return en.instance==null&&(en.instance=new en),en.instance}static registerSaveRouter(e){en.getInstance().saveRouters.push(e)}static registerLoadRouter(e){en.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return en.getHandlers(e,"save")}static getLoadHandlers(e,t){return en.getHandlers(e,"load",t)}static getHandlers(e,t,n){let a=[];return(t==="load"?en.getInstance().loadRouters:en.getInstance().saveRouters).forEach(o=>{let s=o(e,n);s!==null&&a.push(s)}),a}};var LYe="tensorflowjs",zYe=1,yp="models_store",Cg="model_info_store";function $Ye(){if(!Br().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let r=typeof window>"u"?self:window,e=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function WYe(r){let e=r.result;e.createObjectStore(yp,{keyPath:"modelPath"}),e.createObjectStore(Cg,{keyPath:"modelPath"})}var Vc=class{constructor(e){if(this.indexedDB=$Ye(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((n,a)=>{let i=this.indexedDB.open(LYe,zYe);i.onupgradeneeded=()=>WYe(i),i.onsuccess=()=>{let o=i.result;if(t==null){let s=o.transaction(yp,"readonly"),l=s.objectStore(yp).get(this.modelPath);l.onsuccess=()=>{if(l.result==null)return o.close(),a(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));n(l.result.modelArtifacts)},l.onerror=c=>(o.close(),a(l.error)),s.oncomplete=()=>o.close()}else{let s=$g(t),u=o.transaction(Cg,"readwrite"),l=u.objectStore(Cg),c=l.put({modelPath:this.modelPath,modelArtifactsInfo:s}),f;c.onsuccess=()=>{f=o.transaction(yp,"readwrite");let p=f.objectStore(yp).put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:s});p.onsuccess=()=>n({modelArtifactsInfo:s}),p.onerror=d=>{l=u.objectStore(Cg);let m=l.delete(this.modelPath);m.onsuccess=()=>(o.close(),a(p.error)),m.onerror=v=>(o.close(),a(p.error))}},c.onerror=h=>(o.close(),a(c.error)),u.oncomplete=()=>{f==null?o.close():f.oncomplete=()=>o.close()}}},i.onerror=o=>a(i.error)})}};Vc.URL_SCHEME="indexeddb://";var v6=r=>Br().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Vc.URL_SCHEME)?qYe(r.slice(Vc.URL_SCHEME.length)):null;en.registerSaveRouter(v6);en.registerLoadRouter(v6);function qYe(r){return new Vc(r)}var dp="/",vp="tensorflowjs_models",VYe="info",GYe="model_topology",UYe="weight_specs",HYe="weight_data",KYe="model_metadata";function jYe(r){return{info:[vp,r,VYe].join(dp),topology:[vp,r,GYe].join(dp),weightSpecs:[vp,r,UYe].join(dp),weightData:[vp,r,HYe].join(dp),modelMetadata:[vp,r,KYe].join(dp)}}function XYe(r){for(let e of Object.values(r))window.localStorage.removeItem(e)}var Gc=class{constructor(e){if(!Br().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=jYe(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),a=$g(e);try{this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,FYe(e.weightData));let i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:a}}catch{throw XYe(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${a.modelTopologyBytes}, weightSpecsBytes=${a.weightSpecsBytes}, weightDataBytes=${a.weightDataBytes}.`)}}}async load(){let e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let t={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(n==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=n;let a=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(a==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=a;let i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){let s=JSON.parse(i);t.format=s.format,t.generatedBy=s.generatedBy,t.convertedBy=s.convertedBy,s.signature!=null&&(t.signature=s.signature),s.userDefinedMetadata!=null&&(t.userDefinedMetadata=s.userDefinedMetadata),s.modelInitializer!=null&&(t.modelInitializer=s.modelInitializer),s.trainingConfig!=null&&(t.trainingConfig=s.trainingConfig)}let o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=RYe(o),t}};Gc.URL_SCHEME="localstorage://";var m6=r=>Br().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Gc.URL_SCHEME)?YYe(r.slice(Gc.URL_SCHEME.length)):null;en.registerSaveRouter(m6);en.registerLoadRouter(m6);function YYe(r){return new Gc(r)}var ZYe="model",JYe=".json",QYe=".weights.bin";function XV(r){return new Promise(e=>setTimeout(e)).then(r)}var Fo=class{constructor(e){if(!Br().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(Fo.URL_SCHEME)&&(e=e.slice(Fo.URL_SCHEME.length)),(e==null||e.length===0)&&(e=ZYe),this.modelJsonFileName=e+JYe,this.weightDataFileName=e+QYe}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");let t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],a=d6(e,n),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),o=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(o.download=this.modelJsonFileName,o.href=i,await XV(()=>o.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){let s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;s.download=this.weightDataFileName,s.href=t,await XV(()=>s.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:$g(e)}}}};Fo.URL_SCHEME="downloads://";var eZe=r=>Br().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Fo.URL_SCHEME)?tZe(r.slice(Fo.URL_SCHEME.length)):null;en.registerSaveRouter(eZe);function tZe(r="model"){return new Fo(r)}function YV(r,e,t,n){o(r),t=t??0,n=n??1,s(t,n);let a=0,i=u=>(u.then(l=>{let c=t+ ++a/r.length*(n-t);return e(c),l}),u);function o(u){U(u!=null&&Array.isArray(u)&&u.length>0,()=>"promises must be a none empty array")}function s(u,l){U(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${u}`),U(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${l}`),U(l>=u,()=>`startFraction must be no more than endFraction, but got startFraction ${u} and endFraction ${l}`)}return Promise.all(r.map(i))}async function rZe(r,e){e==null&&(e={});let t=e.fetchFunc==null?Br().platform.fetch:e.fetchFunc,n=r.map(f=>t(f,e.requestInit,{isBinary:!0})),a=0,i=.5,s=(e.onProgress==null?await Promise.all(n):await YV(n,e.onProgress,a,i)).map(f=>f.arrayBuffer()),u=.5,l=1;return e.onProgress==null?await Promise.all(s):await YV(s,e.onProgress,u,l)}var nZe="application/octet-stream",aZe="application/json",xp=class{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(U(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=Br().platform.fetch,U(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&U(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;let n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=d6(e,n);t.body.append("model.json",new Blob([JSON.stringify(a)],{type:aZe}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:nZe}),"model.weights.bin");let i=await this.fetch(this.path,t);if(i.ok)return{modelArtifactsInfo:$g(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async load(){let e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}let n=t.modelTopology,a=t.weightsManifest;if(n==null&&a==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return MYe(t,i=>this.loadWeights(i))}async loadWeights(e){let t=Array.isArray(this.path)?this.path[1]:this.path,[n,a]=iZe(t),i=this.weightPathPrefix||n,o=BYe(e),s=[],u=[];for(let c of e)for(let f of c.paths)this.weightUrlConverter!=null?u.push(this.weightUrlConverter(f)):s.push(i+f+a);this.weightUrlConverter&&s.push(...await Promise.all(u));let l=await rZe(s,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[o,OYe(l)]}};xp.URL_SCHEME_REGEX=/^https?:\/\//;function iZe(r){let e=r.lastIndexOf("/"),t=r.lastIndexOf("?"),n=r.substring(0,e),a=t>e?r.substring(t):"";return[n+"/",a]}function ZV(r){return r.match(xp.URL_SCHEME_REGEX)!=null}var g6=(r,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(r)?t=r.every(n=>ZV(n)):t=ZV(r),t)return oZe(r,e)}return null};en.registerSaveRouter(g6);en.registerLoadRouter(g6);function oZe(r,e){return new xp(r,e)}function sZe(r,e,t=1,n=0,a="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);let o={indices:W(r,"indices","oneHot","int32")},s={dtype:a,depth:e,onValue:t,offValue:n};return ae.runKernel(sU,o,s)}var p2=Y({oneHot_:sZe});function uZe(r,e,t){let n=W(r,"labels","confusionMatrix"),a=W(e,"predictions","confusionMatrix");U(t==null||t>0&&Number.isInteger(t),()=>`If provided, numClasses must be a positive integer, but got ${t}`),U(n.rank===1,()=>`Expected the rank of labels to be 1, but got ${n.rank}`),U(a.rank===1,()=>`Expected the rank of predictions to be 1, but got ${a.rank}`),U(n.shape[0]===a.shape[0],()=>`Mismatch in the number of examples: ${n.shape[0]} vs. ${a.shape[0]}. Labels and predictions should have the same number of elements.`),U(t>0&&Number.isInteger(t),()=>`numClasses is required to be a positive integer, but got ${t}`);let i=p2(Ye(n,"int32"),t),o=p2(Ye(a,"int32"),t),s=io(i),u=Rt(s,o);return Ye(u,"int32")}var Xit=Y({confusionMatrix_:uZe});function lZe(r,e,t){if(E2(r),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");let n=Ap(r,t);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Dp(r,e,n,t)}var Xu;function cZe(r,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(r==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let t=!1,n=!1,a=!1,i=!1,o=!1,s=!1;if(r.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&r instanceof ImageData)n=!0;else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)a=!0;else if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)i=!0;else if(r.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&r instanceof ImageBitmap)s=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${r.constructor.name}`);if(a2(DV,ae.backendName)!=null){let d={pixels:r},m={numChannels:e};return ae.runKernel(DV,d,m)}let[l,c]=a?[r.videoWidth,r.videoHeight]:[r.width,r.height],f;if(o)f=r.getContext("2d").getImageData(0,0,l,c).data;else if(n||t)f=r.data;else if(i||a||s){if(Xu==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")Xu=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else Xu=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Xu.canvas.width=l,Xu.canvas.height=c,Xu.drawImage(r,0,0,l,c),f=Xu.getImageData(0,0,l,c).data}let h;if(e===4)h=new Int32Array(f);else{let d=l*c;h=new Int32Array(d*e);for(let m=0;m<d;m++)for(let v=0;v<e;++v)h[m*e+v]=f[m*4+v]}return lZe(h,[c,l,e],"int32")}var Yit=Y({fromPixels_:cZe});function fZe(r,e,t){let n=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${r}, sliceDim: ${n}, and batchDim: ${a}.`;if(t.rank<a)throw new Error(i+` update.rank < ${a}. `);if(r.length<n+(t.rank-a))throw new Error(i+` Output shape length < ${n+(t.rank-a)}`);if(t.rank!==a+r.length-n)throw new Error(i+` update.rank != ${a+r.length-n}`);for(let o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+` updates.shape[${o}] (${t.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<t.rank-a;++o)if(t.shape[o+a]!==r[o+n])throw new Error(i+` updates.shape[${o+a}] (${t.shape[o+a]}) != shape[${o+a}] (${r[o+a]})`)}function hZe(r,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(r.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${r.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(r.size===0)throw new Error(`Updates specified for empty output. updates shape: ${r.shape}`)}fZe(t,e,r)}function pZe(r,e,t){let n,a=r.shape.length;typeof e=="number"?n=[e,...new Array(a-1).fill(0)]:e.length<a?n=e.concat(new Array(a-e.length).fill(0)):n=e.slice(),n.forEach(o=>{U(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=[t,...new Array(a-1).fill(-1)]:t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map((o,s)=>o>=0?o:(U(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${s}.`),r.shape[s]-n[s])),[n,i]}var d2=class{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}},Do=class{constructor(){this.classNameMap={}}static getMap(){return Do.instance==null&&(Do.instance=new Do),Do.instance}static register(e){Do.getMap().classNameMap[e.className]=[e,e.fromConfig]}};function Qu(r){U(r.className!=null,()=>"Class being registered does not have the static className property defined."),U(typeof r.className=="string",()=>"className is required to be a string, but got type "+typeof r.className),U(r.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),Do.register(r)}function dZe(r){let e=W(r,"x","abs");if(e.dtype==="complex64"){let t={x:e};return ae.runKernel(xG,t)}else{let t={x:e};return ae.runKernel(aG,t)}}var Ma=Y({abs_:dZe});function vZe(r){let t={x:W(r,"x","acos")};return ae.runKernel(iG,t)}var mZe=Y({acos_:vZe});function gZe(r){let t={x:W(r,"x","acosh")};return ae.runKernel(oG,t)}var yZe=Y({acosh_:gZe});function bZe(r){U(Array.isArray(r),()=>"The argument passed to tf.addN() must be a list of tensors"),U(r.length>=1,()=>`Must pass at least one tensor to tf.addN(), but got ${r.length}`);let e=r.map((a,i)=>W(a,`tensors${i}`,"addN")),t=e[0];e.forEach(a=>{if(a.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(a=>{if(!Kc(a.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});let n=e;return ae.runKernel(sG,n)}var Zit=Y({addN_:bZe});function wZe(r,e=null,t=!1){let a={x:W(r,"x","all","bool")},i={axis:e,keepDims:t};return ae.runKernel(p8e,a,i)}var xZe=Y({all_:wZe});function kZe(r,e=null,t=!1){let a={x:W(r,"x","any","bool")},i={axis:e,keepDims:t};return ae.runKernel(d8e,a,i)}var SZe=Y({any_:kZe});function NZe(r,e=0){let n={x:W(r,"x","argMax")},a={axis:e};return ae.runKernel(uG,n,a)}var EZe=Y({argMax_:NZe});function TZe(r,e=0){let n={x:W(r,"x","argMin")},a={axis:e};return ae.runKernel(lG,n,a)}var IZe=Y({argMin_:TZe});function CZe(r){let t={x:W(r,"x","asin")};return ae.runKernel(cG,t)}var AZe=Y({asin_:CZe});function _Ze(r){let t={x:W(r,"x","asinh")};return ae.runKernel(fG,t)}var DZe=Y({asinh_:_Ze});function FZe(r){let t={x:W(r,"x","atan")};return ae.runKernel(hG,t)}var RZe=Y({atan_:FZe});function OZe(r,e){let t=W(r,"a","atan2"),n=W(e,"b","atan2");[t,n]=Lr(t,n);let a={a:t,b:n};return ae.runKernel(dG,a)}var PZe=Y({atan2_:OZe});function MZe(r){let t={x:W(r,"x","atanh")};return ae.runKernel(pG,t)}var BZe=Y({atanh_:MZe});function LZe(r,e,t,n,a){let i=W(r,"x","avgPool","float32"),o=1;U(Po(t,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);let s=i,u=!1;i.rank===3&&(u=!0,s=fe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),U(s.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${s.rank}.`),Kn("avgPool",n,a);let l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=ae.runKernel(vG,l,c);return f=Ye(f,i.dtype),u?fe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var y6=Y({avgPool_:LZe});function zZe(r,e,t,n,a,i="NDHWC"){let o=W(r,"x","avgPool3d","float32"),s=o,u=!1;o.rank===4&&(u=!0,s=fe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),U(s.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${s.rank}.`),U(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),Kn("avgPool3d",n,a);let l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=ae.runKernel(mG,l,c);return f=Ye(f,s.dtype),u?fe(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var Jit=Y({avgPool3d_:zZe});function $Ze(r,e=0){U(r.length>=1,()=>"Pass at least one tensor to concat");let t=Fg(r,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),t.length===1)return bp(t[0]);let n=t,a={axis:e};return ae.runKernel(kG,n,a)}var Hn=Y({concat_:$Ze});function WZe(r){let t={x:W(r,"x","sigmoid","float32")};return ae.runKernel(CU,t)}var Yu=Y({sigmoid_:WZe});function qZe(r){let t={x:W(r,"x","tanh","float32")};return ae.runKernel(LU,t)}var v2=Y({tanh_:qZe});function VZe(r,e,t,n,a,i){let o=W(r,"forgetBias","basicLSTMCell"),s=W(e,"lstmKernel","basicLSTMCell"),u=W(t,"lstmBias","basicLSTMCell"),l=W(n,"data","basicLSTMCell"),c=W(a,"c","basicLSTMCell"),f=W(i,"h","basicLSTMCell"),h=Hn([l,f],1),p=Rt(h,s),d=Qe(p,u),m=d.shape[0],v=d.shape[1]/4,g=[m,v],y=$t(d,[0,0],g),b=$t(d,[0,v],g),w=$t(d,[0,v*2],g),x=$t(d,[0,v*3],g),k=Qe(pe(Yu(y),v2(b)),pe(c,Yu(Qe(o,w)))),N=pe(v2(k),Yu(x));return[k,N]}var Qit=Y({basicLSTMCell_:VZe});function GZe(r,e,t){let n=W(r,"x","batchToSpaceND"),a=e.reduce((s,u)=>s*u);U(n.rank>=1+e.length,()=>`input rank is ${n.rank} but should be > than blockShape.length ${e.length}`),U(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),U(n.shape[0]%a===0,()=>`input tensor batch is ${n.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${a}`);let i={x:n},o={blockShape:e,crops:t};return ae.runKernel(yG,i,o)}var W2=Y({batchToSpaceND_:GZe});function UZe(r){let e;return r.rank===0||r.rank===1?e=fe(r,[1,1,1,r.size]):r.rank===2?e=fe(r,[1,1,r.shape[0],r.shape[1]]):r.rank===3?e=fe(r,[1,r.shape[0],r.shape[1],r.shape[2]]):e=r,e}function HZe(r,e,t,n,a,i){i==null&&(i=.001);let o=W(r,"x","batchNorm"),s=W(e,"mean","batchNorm"),u=W(t,"variance","batchNorm"),l;a!=null&&(l=W(a,"scale","batchNorm"));let c;n!=null&&(c=W(n,"offset","batchNorm")),U(s.rank===u.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),U(c==null||s.rank===c.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),U(l==null||s.rank===l.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let h={x:UZe(o),scale:l,offset:c,mean:s,variance:u},p={varianceEpsilon:i},d=ae.runKernel(zG,h,p);return fe(d,o.shape)}var Wg=Y({batchNorm_:HZe});function KZe(r,e,t,n,a,i){let o=W(r,"x","batchNorm"),s=W(e,"mean","batchNorm"),u=W(t,"variance","batchNorm"),l;a!=null&&(l=W(a,"scale","batchNorm"));let c;return n!=null&&(c=W(n,"offset","batchNorm")),U(o.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`),U(s.rank===2||s.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${s.rank}.`),U(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`),l!=null&&U(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&U(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`),Wg(o,s,u,c,l,i)}var eot=Y({batchNorm2d_:KZe});function jZe(r,e,t,n,a,i){let o=W(r,"x","batchNorm"),s=W(e,"mean","batchNorm"),u=W(t,"variance","batchNorm"),l;a!=null&&(l=W(a,"scale","batchNorm"));let c;return n!=null&&(c=W(n,"offset","batchNorm")),U(o.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`),U(s.rank===3||s.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${s.rank}.`),U(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`),l!=null&&U(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&U(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`),Wg(o,s,u,c,l,i)}var tot=Y({batchNorm3d_:jZe});function XZe(r,e,t,n,a,i){let o=W(r,"x","batchNorm"),s=W(e,"mean","batchNorm"),u=W(t,"variance","batchNorm"),l;a!=null&&(l=W(a,"scale","batchNorm"));let c;return n!=null&&(c=W(n,"offset","batchNorm")),U(o.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`),U(s.rank===4||s.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${s.rank}.`),U(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`),l!=null&&U(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&U(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`),Wg(o,s,u,c,l,i)}var rot=Y({batchNorm4d_:XZe});function YZe(r,e,t){let n=W(r,"x","bincount"),a=W(e,"weights","bincount");U(n.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${n.dtype}`),U(t>=0,()=>`size must be non-negative, but got ${t}.`),U(a.size===n.size||a.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${n.shape}, weights shape: ${a.shape}.`);let i={x:n,weights:a},o={size:t};return ae.runKernel(g8e,i,o)}var ZZe=Y({bincount_:YZe});function JZe(r,e){let t=W(r,"s0","broadcastArgs","int32"),n=W(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error(`broadcastArgs(): first input must be a vector (rank=1). Has rank ${t.rank}`);if(n.rank!==1)throw new Error(`broadcastArgs(): second input must be a vector (rank=1). Has rank ${n.rank}`);let a={s0:t,s1:n};return ae.runKernel(b8e,a)}var not=Y({broadcastArgs_:JZe});function Pp(r,e="float32",t){return e=e||"float32",UU(r),new s2(r,e,t)}function QZe(r){let t={x:W(r,"x","ceil","float32")};return ae.runKernel(bG,t)}var eJe=Y({ceil_:QZe});function qg(r,e,t){let n={shape:r,value:e,dtype:t};return ae.runKernel(B8e,{},n)}function tJe(r,e,t){let n=W(r,"x","clipByValue");if(U(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return qg(n.shape,e,n.dtype);let a={x:n},i={clipValueMin:e,clipValueMax:t};return ae.runKernel(wG,a,i)}var rJe=Y({clipByValue_:tJe});function nJe(r){return Hn(r,0)}var aot=Y({concat1d_:nJe});function aJe(r,e){return Hn(r,e)}var iot=Y({concat2d_:aJe});function iJe(r,e){return Hn(r,e)}var oot=Y({concat3d_:iJe});function oJe(r,e){return Hn(r,e)}var sot=Y({concat4d_:oJe});function sJe(r,e,t,n,a="NWC",i=1,o){let s=W(r,"x","conv1d"),u=W(e,"filter","conv1d"),l=s,c=!1;s.rank===2&&(c=!0,l=fe(s,[1,s.shape[0],s.shape[1]])),U(l.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${l.rank}.`),U(u.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`),Kn("conv1d",n,o),U(l.shape[2]===u.shape[1],()=>`Error in conv1d: depth of input (${l.shape[2]}) must match input depth for filter ${u.shape[1]}.`),U(Po(t,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${i}'`),U(a==="NWC",()=>`Error in conv1d: got dataFormat of ${a} but only NWC is currently supported.`);let f=fe(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=fe(l,[l.shape[0],1,l.shape[1],l.shape[2]]),v=Rp(h,f,[1,t],n,"NHWC",[1,i],o);return c?fe(v,[v.shape[2],v.shape[3]]):fe(v,[v.shape[0],v.shape[2],v.shape[3]])}var uJe=Y({conv1d_:sJe});function lJe(r,e,t,n,a,i){let o=W(r,"x","conv2dTranspose"),s=W(e,"filter","conv2dTranspose");return P2(t,o,s,n,a,"NHWC",i)}var cJe=Y({conv2dTranspose_:lJe});function fJe(r,e,t,n,a="NDHWC",i=[1,1,1]){let o=W(r,"x","conv3d"),s=W(e,"filter","conv3d"),u=o,l=!1;o.rank===4&&(l=!0,u=fe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),U(u.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`),U(s.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${s.rank}.`),U(u.shape[4]===s.shape[3],()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${s.shape[3]}.`),U(Po(t,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),U(a==="NDHWC",()=>`Error in conv3d: got dataFormat of ${a} but only NDHWC is currently supported.`);let c={x:u,filter:s},f={strides:t,pad:n,dataFormat:a,dilations:i},h=ae.runKernel(EG,c,f);return l?fe(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var uot=Y({conv3d_:fJe});function hJe(r,e,t,n,a){let i=W(r,"x","conv3dTranspose"),o=W(e,"filter","conv3dTranspose");return n6(t,i,o,n,a)}var lot=Y({conv3dTranspose_:hJe});function pJe(r){let t={x:W(r,"x","cos","float32")};return ae.runKernel(TG,t)}var q2=Y({cos_:pJe});function dJe(r){let t={x:W(r,"x","cosh","float32")};return ae.runKernel(IG,t)}var b6=Y({cosh_:dJe});function vJe(r,e=0,t=!1,n=!1){let i={x:W(r,"x","cumprod")},o={axis:e,exclusive:t,reverse:n};return ae.runKernel(N8e,i,o)}var m2=Y({cumprod_:vJe});function mJe(r,e,t,n=!1){let a=W(r,"x","denseBincount"),i=W(e,"weights","denseBincount");U(a.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${a.dtype}`),U(a.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${a.rank}.`),U(t>=0,()=>`size must be non-negative, but got ${t}.`),U(i.size===a.size||i.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${a.shape}, weights shape: ${i.shape}.`);let o={x:a,weights:i},s={size:t,binaryOutput:n};return ae.runKernel(T8e,o,s)}var cot=Y({denseBincount_:mJe});function gJe(r,e,t="NHWC"){let n=W(r,"x","depthToSpace","float32"),a=t==="NHWC"?n.shape[1]:n.shape[2],i=t==="NHWC"?n.shape[2]:n.shape[3],o=t==="NHWC"?n.shape[3]:n.shape[1];U(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),U(a*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${a} and ${e}  for depthToSpace with input shape
    ${n.shape}`),U(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${n.shape}`),U(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${n.shape}`);let s={x:n},u={blockSize:e,dataFormat:t};return ae.runKernel(I8e,s,u)}var yJe=Y({depthToSpace_:gJe});function bJe(r,e,t,n,a="NHWC",i=[1,1],o){let s=W(r,"x","depthwiseConv2d","float32"),u=W(e,"filter","depthwiseConv2d","float32"),l=s,c=!1;s.rank===3&&(c=!0,l=fe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),U(l.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${l.rank}.`),U(u.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`);let f=a==="NHWC"?l.shape[3]:l.shape[1];U(f===u.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${f}) must match the inChannels dimension in filter ${u.shape[2]}.`),Kn("depthwiseConv2d",n,o);let h={x:l,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=ae.runKernel(AG,h,p);return c?fe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var V2=Y({depthwiseConv2d_:bJe});function wJe(r){let t={x:W(r,"x","diag")};return ae.runKernel(_8e,t)}var fot=Y({diag_:wJe});function xJe(r,e,t,n,a=[1,1],i="NHWC"){let o=W(r,"x","dilation2d"),s=W(e,"filter","dilation2d");U(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),U(s.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${s.rank}.`),U(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let u=o,l=!1;o.rank===3&&(u=fe(o,[1,o.shape[0],o.shape[1],o.shape[2]]),l=!0);let c={x:u,filter:s},f={strides:t,pad:n,dilations:a},h=ae.runKernel(_G,c,f);return l?fe(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var kJe=Y({dilation2d_:xJe});function SJe(r,e){let t=W(r,"a","div"),n=W(e,"b","div");[t,n]=Lr(t,n);let a=gt(t,n),i=Ot(a),o=L2(n,i);return Ba(o,i,a)}var NJe=Y({divNoNan_:SJe});function EJe(r,e){let t=W(r,"t1","dot"),n=W(e,"t2","dot");U((t.rank===1||t.rank===2)&&(n.rank===1||n.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${n.rank}.`);let a=t.rank===1?t.size:t.shape[1],i=n.rank===1?n.size:n.shape[0];if(U(a===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${a} and ${i}.`),t.rank===1&&n.rank===1){let o=fe(t,[1,-1]),s=fe(n,[-1,1]),u=Rt(o,s);return fe(u,[])}else if(t.rank===1&&n.rank===2){let o=fe(t,[1,-1]),s=fe(n,[n.shape[0],n.shape[1]]),u=Rt(o,s);return fe(u,[u.size])}else if(t.rank===2&&n.rank===1){let o=fe(n,[-1,1]),s=Rt(t,o);return fe(s,[s.size])}else{let o=fe(n,[n.shape[0],n.shape[1]]);return Rt(t,o)}}var TJe=Y({dot_:EJe});function IJe(r,...e){let t=e.map((a,i)=>W(a,`tensors${i}`,"einsum")),n={equation:r};return ae.runKernel(R8e,t,n)}var hot=Y({einsum_:IJe});function CJe(r){let t={x:W(r,"x","elu","float32")};return ae.runKernel(FG,t)}var w6=Y({elu_:CJe});function AJe(r){let e=W(r,"x","erf");U(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=Ye(e,"float32"));let t={x:e};return ae.runKernel(RG,t)}var _Je=Y({erf_:AJe});function DJe(r,e=null,t=!1){let a={x:W(r,"x","max")},i={reductionIndices:e,keepDims:t};return ae.runKernel(XG,a,i)}var Pc=Y({max_:DJe});function FJe(r,e=null,t=!1){let a={x:W(r,"x","min")},i={axis:e,keepDims:t};return ae.runKernel(eU,a,i)}var g2=Y({min_:FJe});function RJe(r,e="euclidean",t=null,n=!1){r=W(r,"x","norm");let a=x6(r,e,t),i=a.shape;if(n){let o=Li(t,r.shape);i=zc(a.shape,o)}return fe(a,i)}function x6(r,e,t=null){if(r.rank===0)return Ma(r);if(r.rank!==1&&t===null)return x6(fe(r,[-1]),e,t);if(r.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return ct(Ma(r),t);if(e===1/0)return Pc(Ma(r),t);if(e===-1/0)return g2(Ma(r),t);if(e==="euclidean"||e===2)return xa(ct(Ju(Ma(r),kt(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return Pc(ct(Ma(r),t[0]),t[1]-1);if(e===1/0)return Pc(ct(Ma(r),t[1]),t[0]);if(e===-1/0)return g2(ct(Ma(r),t[1]),t[0]);if(e==="fro"||e==="euclidean")return xa(ct(tr(r),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}var Vg=Y({norm_:RJe});function OJe(r,e=null,t=!1){return Vg(r,"euclidean",e,t)}var PJe=Y({euclideanNorm_:OJe});function MJe(r,e=0){let t=W(r,"x","expandDims","string_or_numeric");U(e<=t.rank,()=>"Axis must be <= rank of the tensor");let n={input:t},a={dim:e};return ae.runKernel(PG,n,a)}var Ts=Y({expandDims_:MJe});function BJe(r){let t={x:W(r,"x","expm1")};return ae.runKernel(MG,t)}var LJe=Y({expm1_:BJe});function zJe(r,e,t,n="float32"){e==null&&(e=r);let a=Pp([r,e],n),i=r<=e?r:e;for(let s=0;s<i;++s)a.set(1,s,s);let o=fe(a.toTensor(),[r,e]);if(t==null)return o;if(t.length===1)return Oc(Ts(o,0),[t[0],1,1]);if(t.length===2)return Oc(Ts(Ts(o,0),0),[t[0],t[1],1,1]);if(t.length===3)return Oc(Ts(Ts(Ts(o,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}var $Je=Y({eye_:zJe});function WJe(r,e,t=0,n=0){let a=W(r,"x","gather"),i=W(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:n};return ae.runKernel($G,o,s)}var k6=Y({gather_:WJe});function qJe(r){let t={x:W(r,"x","isFinite")};return ae.runKernel(qG,t)}var VJe=Y({isFinite_:qJe});function GJe(r){let t={x:W(r,"x","isInf")};return ae.runKernel(VG,t)}var UJe=Y({isInf_:GJe});function HJe(r){let t={x:W(r,"x","isNaN")};return ae.runKernel(GG,t)}var KJe=Y({isNaN_:HJe});function jJe(r,e=.2){let n={x:W(r,"x","leakyRelu")},a={alpha:e};return ae.runKernel(UG,n,a)}var S6=Y({leakyRelu_:jJe});function XJe(r,e=5,t=1,n=1,a=.5){let i=W(r,"x","localResponseNormalization");U(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),U(wp(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,s=!1;i.rank===3&&(s=!0,o=fe(i,[1,i.shape[0],i.shape[1],i.shape[2]]));let u={x:o},l={depthRadius:e,bias:t,alpha:n,beta:a},c=ae.runKernel(jG,u,l);return s?fe(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var YJe=Y({localResponseNormalization_:XJe});function ZJe(r){let t={x:W(r,"x","log1p")};return ae.runKernel(KG,t)}var N6=Y({log1p_:ZJe});function JJe(r,e){U(t2(r),()=>"The f passed in variableGrads(f) must be a function"),U(e==null||Array.isArray(e)&&e.every(l=>l instanceof Mc),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");let t=e!=null;if(!t){e=[];for(let l in ae.registeredVariables)e.push(ae.registeredVariables[l])}let n=t?e.filter(l=>!l.trainable):null,a=e.length;e=e.filter(l=>l.trainable),U(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${a} variables is trainable.`);let i=!0,{value:o,grads:s}=ae.gradients(r,e,null,i);U(s.some(l=>l!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),U(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);let u={};return e.forEach((l,c)=>{s[c]!=null&&(u[l.name]=s[c])}),n?.forEach(l=>u[l.name]=null),{value:o,grads:u}}function Ro(r){return ae.customGrad(r)}function QJe(r){let t={x:W(r,"x","softplus")};return ae.runKernel(AU,t)}var E6=Y({softplus_:QJe});function eQe(r){let e=W(r,"x","logSigmoid");return Ro(n=>({value:rn(E6(rn(n))),gradFunc:o=>pe(o,Yu(rn(n)))}))(e)}var tQe=Y({logSigmoid_:eQe});function rQe(r,e=-1){let t=W(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return Ro((a,i)=>{let s=Pc(a,e,!0),u=ot(a,s),l=ot(Ye(u,"float32"),qc(ct(Bi(u),e,!0)));return i([l]),{value:l,gradFunc:(f,h)=>{let[p]=h,d=!0,m=Bi(p);return ot(f,pe(ct(f,e,d),m))}}})(t)}var nQe=Y({logSoftmax_:rQe});function aQe(r,e=null,t=!1){let n=W(r,"x","logSumExp"),a=Li(e,n.shape),i=Pc(n,a,!0),o=ot(n,i),s=Bi(o),u=ct(s,a),l=qc(u),c=Qe(fe(i,l.shape),l);if(t){let f=zc(c.shape,a);return fe(c,f)}return c}var T6=Y({logSumExp_:aQe});function iQe(r){let t={x:W(r,"x","logicalNot","bool")};return ae.runKernel(H8e,t)}var G2=Y({logicalNot_:iQe});function oQe(r,e){let t=W(r,"a","logicalOr","bool"),n=W(e,"b","logicalOr","bool");rr(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(K8e,a)}var I6=Y({logicalOr_:oQe});function sQe(r,e){let t=W(r,"a","logicalXor","bool"),n=W(e,"b","logicalXor","bool");return rr(t.shape,n.shape),Bc(I6(r,e),G2(Bc(r,e)))}var uQe=Y({logicalXor_:sQe});var Sg=2147483648;function lQe(r,e,t="left"){let n=W(r,"sortedSequence","searchSorted"),a=W(e,"values","searchSorted"),i=n.shape[n.shape.length-1],o=a.shape[a.shape.length-1],s=fe(n,[-1,i]),u=fe(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(ba(u.shape)>=Sg)throw new Error(`values tensor size must less than ${Sg}`);if(s.shape[1]>=Sg)throw new Error(`trailing dim_size must less than ${Sg} for int32 output type, was ${s.shape[1]}`);let l={sortedSequence:s,values:u},c={side:t};return ae.runKernel(f7e,l,c)}var pot=Y({searchSorted_:lQe});function cQe(r,e,t,n,a){let i=W(r,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=fe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),U(s.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.rank}.`),U(Po(t,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),Kn("maxPool",n,a);let l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=ae.runKernel(ZG,l,c);return u?fe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var C6=Y({maxPool_:cQe});function fQe(r,e=[1,1,1],t,n,a,i="NDHWC"){let o=W(r,"x","maxPool3d"),s=o,u=!1;o.rank===4&&(u=!0,s=fe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),U(s.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${s.rank}.`),U(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),Kn("maxPool3d",n,a);let l={x:s},c={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=ae.runKernel(JG,l,c);return u?fe(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var dot=Y({maxPool3d_:fQe});function hQe(r,e,t,n,a=!1){let o={x:W(r,"x","maxPoolWithArgmax")},s={filterSize:e,strides:t,pad:n,includeBatchInIndex:a},u=ae.runKernel(J8e,o,s);return{result:u[0],indexes:u[1]}}var vot=Y({maxPoolWithArgmax_:hQe});function pQe(r,e){let t=W(r,"a","maximum"),n=W(e,"b","maximum");[t,n]=Lr(t,n),t.dtype==="bool"&&(t=Ye(t,"int32"),n=Ye(n,"int32")),rr(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(YG,a)}var U2=Y({maximum_:pQe});function dQe(r,e=null,t=!1){let a={x:W(r,"x","mean")},i={axis:e,keepDims:t};return ae.runKernel(QG,a,i)}var Mg=Y({mean_:dQe});function vQe(r,e){let t=W(r,"a","minimum"),n=W(e,"b","minimum");[t,n]=Lr(t,n),t.dtype==="bool"&&(t=Ye(t,"int32"),n=Ye(n,"int32")),rr(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(tU,a)}var A6=Y({minimum_:vQe});function mQe(r,e,t){U(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);let n=W(r,"x","mirrorPad");if(n.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");U(e.length===n.rank,()=>`Padding doesn't match input. Must be ${n.rank}. Got ${e.length}.`);let a=t==="reflect"?1:0;for(let s=0;s<n.rank;s++)U(e[s].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),U(e[s][0]>=0&&e[s][0]<=n.shape[s]-a&&e[s][1]>=0&&e[s][1]<=n.shape[s]-a,()=>`Padding in dimension ${s} cannot be greater than or equal to ${n.shape[s]-a} or less than 0 for input of shape ${n.shape}`);let i={paddings:e,mode:t},o={x:n};return ae.runKernel(rU,o,i)}var gQe=Y({mirrorPad_:mQe});function yQe(r,e){let t=W(r,"a","mod"),n=W(e,"b","mod");[t,n]=Lr(t,n);let a={a:t,b:n};return ae.runKernel(nU,a)}var bQe=Y({mod_:yQe});function wQe(r,e=null,t=!1){r=W(r,"x","moments");let n=Li(e,r.shape),a=Mg(r,n,t),i=a.shape;t||(i=zc(a.shape,n));let o=tr(ot(Ye(r,"float32"),fe(a,i))),s=Mg(o,n,t);return{mean:a,variance:s}}var mot=Y({moments_:wQe});function xQe(r,e,t,n){let a=W(e,"data","multiRNNCell"),i=Fg(t,"c","multiRNNCell"),o=Fg(n,"h","multiRNNCell"),s=a,u=[];for(let f=0;f<r.length;f++){let h=r[f](s,i[f],o[f]);u.push(h[0]),u.push(h[1]),s=h[1]}let l=[],c=[];for(let f=0;f<u.length;f+=2)l.push(u[f]),c.push(u[f+1]);return[l,c]}var got=Y({multiRNNCell_:xQe});function kQe(r,e,t,n=!1){let a=W(r,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error(`Error in multinomial: you need at least 2 outcomes, but got ${i}.`);if(o>2)throw new Error(`Rank of probabilities must be 1 or 2, but is ${o}`);t=t||Math.random();let u={logits:o===1?fe(a,[1,-1]):a},l={numSamples:e,seed:t,normalized:n},c=ae.runKernel(Q8e,u,l);return o===1?fe(c,[c.size]):c}var yot=Y({multinomial_:kQe});function SQe(r,e){let t=W(r,"a","notEqual","string_or_numeric"),n=W(e,"b","notEqual","string_or_numeric");[t,n]=Lr(t,n),rr(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(e7e,a)}var _6=Y({notEqual_:SQe});function NQe(r){let t={x:W(r,"x","onesLike")};return ae.runKernel(oU,t)}var EQe=Y({onesLike_:NQe});function TQe(r,e){let t=W(r,"v1","outerProduct"),n=W(e,"v2","outerProduct");U(t.rank===1&&n.rank===1,()=>`Error in outerProduct: inputs must be rank 1, but got ranks ${t.rank} and ${n.rank}.`);let a=fe(t,[-1,1]),i=fe(n,[1,-1]);return Rt(a,i)}var bot=Y({outerProduct_:TQe});function IQe(r,e,t=0){let n=W(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let a={paddings:e,constantValue:t},i={x:n};return ae.runKernel(lU,i,a)}var Xc=Y({pad_:IQe});function CQe(r,e,t=0){return U(e.length===2,()=>"Invalid number of paddings. Must be length of 2."),Xc(r,[e],t)}var wot=Y({pad1d_:CQe});function AQe(r,e,t=0){return U(e.length===2&&e[0].length===2&&e[1].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Xc(r,e,t)}var xot=Y({pad2d_:AQe});function _Qe(r,e,t=0){return U(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Xc(r,e,t)}var kot=Y({pad3d_:_Qe});function DQe(r,e,t=0){return U(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),Xc(r,e,t)}var Sot=Y({pad4d_:DQe});function FQe(r,e,t,n,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),n===0&&(n="valid");let s=W(r,"x","maxPool"),u=s,l=!1;s.rank===3&&(l=!0,u=fe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),U(Po(i,a),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${a}'`);let c=DXe(u.shape,e,i,a,n),f=[c.dilationHeight,c.dilationWidth],h;n==="same"?h=OQe([c.filterHeight,c.filterWidth],f):h=[[0,0],[0,0]];let p=f[0]===1&&f[1]===1,[d,m]=RQe([c.inHeight,c.inWidth],f,h),v=p?n:"valid",g=p?u:R2(u,f,d),b=(t==="avg"?()=>y6(g,e,i,v,o):()=>C6(g,e,i,v,o))(),w=p?b:W2(b,f,m);return l?fe(w,[w.shape[1],w.shape[2],w.shape[3]]):w}function RQe(r,e,t){let n=t.map(c=>c[0]),a=t.map(c=>c[1]),i=r.concat(n,a),o=e.map((c,f)=>(c-i[f]%c)%c),s=a.map((c,f)=>c+o[f]),u=e.map((c,f)=>[n[f],s[f]]),l=e.map((c,f)=>[0,o[f]]);return[u,l]}function OQe(r,e){let n=r.map((o,s)=>o+(o-1)*(e[s]-1)).map(o=>o-1),a=n.map(o=>Math.floor(o/2)),i=n.map((o,s)=>o-a[s]);return n.map((o,s)=>[a[s],i[s]])}var PQe=Y({pool_:FQe});function MQe(r,e){let t=W(r,"x","prelu"),n=W(e,"alpha","prelu"),a={x:t,alpha:n};return ae.runKernel(fU,a)}var D6=Y({prelu_:MQe});function BQe(r,e=null,t=!1){let n=W(r,"x","prod");n.dtype==="bool"&&(n=Ye(n,"int32"));let a={x:n},i={axis:e,keepDims:t};return ae.runKernel(hU,a,i)}var LQe=Y({prod_:BQe});function zQe(r,e,t,n){let a=r.map((c,f)=>W(c,`tensors${f}`,"raggedGather","int32")),i=W(e,"paramsDenseValues","raggedGather"),o=W(t,"indices","raggedGather","int32"),s={paramsNestedSplits:a,paramsDenseValues:i,indices:o},u={outputRaggedRank:n},l=ae.runKernel(a7e,s,u);return{outputNestedSplits:l.slice(0,l.length-1),outputDenseValues:l[l.length-1]}}var Not=Y({raggedGather_:zQe});function $Qe(r,e,t,n,a){let i=W(r,"shape","raggedTensorToTensor","int32"),o=W(e,"values","raggedTensorToTensor"),s=W(t,"defaultValue","raggedTensorToTensor",o.dtype),u=n.map((f,h)=>W(f,`tensors${h}`,"raggedTensorToTensor","int32")),l={shape:i,values:o,defaultValue:s,rowPartitionTensors:u},c={rowPartitionTypes:a};return ae.runKernel(i7e,l,c)}var Eot=Y({raggedTensorToTensor_:$Qe});function WQe(r,e,t){let n=ba(r),a=null;if(t==null||t==="float32")a=new Float32Array(n);else if(t==="int32")a=new Int32Array(n);else if(t==="bool")a=new Uint8Array(n);else throw new Error(`Unknown data type ${t}`);for(let i=0;i<n;i++)a[i]=e();return ae.makeTensor(a,r,t)}var Tot=Y({rand_:WQe}),el=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function tl(r,e){return e={exports:{}},r(e,e.exports),e.exports}var qQe=tl(function(r){(function(e,t,n){function a(u){var l=this,c=s();l.next=function(){var f=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=f-(l.c=f|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(u),l.s0<0&&(l.s0+=1),l.s1-=c(u),l.s1<0&&(l.s1+=1),l.s2-=c(u),l.s2<0&&(l.s2+=1),c=null}function i(u,l){return l.c=u.c,l.s0=u.s0,l.s1=u.s1,l.s2=u.s2,l}function o(u,l){var c=new a(u),f=l&&l.state,h=c.next;return h.int32=function(){return c.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,c),h.state=function(){return i(c,{})}),h}function s(){var u=4022871197,l=function(c){c=String(c);for(var f=0;f<c.length;f++){u+=c.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return l}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(el,r,!1)}),VQe=tl(function(r){(function(e,t,n){function a(s){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(el,r,!1)}),GQe=tl(function(r){(function(e,t,n){function a(s){var u=this,l="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=l.charCodeAt(c)|0,c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(el,r,!1)}),UQe=tl(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var c=u.x,f=u.i,h,p,d;return h=c[f],h^=h>>>7,p=h^h<<24,h=c[f+1&7],p^=h^h>>>10,h=c[f+3&7],p^=h^h>>>3,h=c[f+4&7],p^=h^h<<7,h=c[f+7&7],h=h^h<<13,p^=h^h<<9,c[f]=p,u.i=f+1&7,p};function l(c,f){var h,p,d=[];if(f===(f|0))p=d[0]=f;else for(f=""+f,h=0;h<f.length;++h)d[h&7]=d[h&7]<<15^f.charCodeAt(h)+d[h+1&7]<<13;for(;d.length<8;)d.push(0);for(h=0;h<8&&d[h]===0;++h);for(h==8?p=d[7]=-1:p=d[h],c.x=d,c.i=0,h=256;h>0;--h)c.next()}l(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(c.x&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(el,r,!1)}),HQe=tl(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var c=u.w,f=u.X,h=u.i,p,d;return u.w=c=c+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(c^c>>>16)|0};function l(c,f){var h,p,d,m,v,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,m=-32;m<y;++m)f&&(p^=f.charCodeAt((m+32)%f.length)),m===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(v=v+1640531527|0,h=g[m&127]^=p+v,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,m=4*128;m>0;--m)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;c.w=v,c.X=g,c.i=d}l(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(c.X&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(el,r,!1)}),KQe=tl(function(r){(function(e,t,n){function a(s){var u=this,l="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)u.b^=l.charCodeAt(c)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var l=new a(s),c=u&&u.state,f=function(){return(l.next()>>>0)/4294967296};return f.double=function(){do var h=l.next()>>>11,p=(l.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=l.next,f.quick=f,c&&(typeof c=="object"&&i(c,l),f.state=function(){return i(l,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(el,r,!1)}),rl=tl(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),l=n.pow(2,o),c=l*2,f=a-1,h;function p(w,x,k){var N=[];x=x==!0?{entropy:!0}:x||{};var T=g(v(x.entropy?[w,b(t)]:w??y(),3),N),I=new d(N),F=function(){for(var D=I.g(i),R=u,P=0;D<l;)D=(D+P)*a,R*=a,P=I.g(1);for(;D>=c;)D/=2,R/=2,P>>>=1;return(D+P)/R};return F.int32=function(){return I.g(4)|0},F.quick=function(){return I.g(4)/4294967296},F.double=F,g(b(I.S),t),(x.pass||k||function(D,R,P,B){return B&&(B.S&&m(B,I),D.state=function(){return m(I,{})}),P?(n[s]=D,R):D})(F,T,"global"in x?x.global:this==n,x.state)}function d(w){var x,k=w.length,N=this,T=0,I=N.i=N.j=0,F=N.S=[];for(k||(w=[k++]);T<a;)F[T]=T++;for(T=0;T<a;T++)F[T]=F[I=f&I+w[T%k]+(x=F[T])],F[I]=x;(N.g=function(D){for(var R,P=0,B=N.i,q=N.j,O=N.S;D--;)R=O[B=f&B+1],P=P*a+O[f&(O[B]=O[q=f&q+R])+(O[q]=R)];return N.i=B,N.j=q,P})(a)}function m(w,x){return x.i=w.i,x.j=w.j,x.S=w.S.slice(),x}function v(w,x){var k=[],N=typeof w,T;if(x&&N=="object")for(T in w)try{k.push(v(w[T],x-1))}catch{}return k.length?k:N=="string"?w:w+"\0"}function g(w,x){for(var k=w+"",N,T=0;T<k.length;)x[f&T]=f&(N^=x[f&T]*19)+k.charCodeAt(T++);return b(x)}function y(){try{var w;return h&&(w=h.randomBytes)?w=w(a):(w=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var x=e.navigator,k=x&&x.plugins;return[+new Date,e,k,e.screen,b(t)]}}function b(w){return String.fromCharCode.apply(0,w)}if(g(n.random(),t),r.exports){r.exports=p;try{h=Id()}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:el,[],Math)});rl.alea=qQe;rl.xor128=VQe;rl.xorwow=GQe;rl.xorshift7=UQe;rl.xor4096=HQe;rl.tychei=KQe;var jQe=rl,H2=jQe.alea;var kp=class{constructor(e,t,n,a,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);let o=i||Math.random();this.random=H2(o.toString())}nextValue(){if(!isNaN(this.nextVal)){let a=this.nextVal;return this.nextVal=NaN,a}let e,t,n=!1;for(;!n;){let a,i,o;do a=2*this.random()-1,i=2*this.random()-1,o=a*a+i*i;while(o>=1||o===0);let s=Math.sqrt(-2*Math.log(o)/o);e=this.mean+this.stdDev*a*s,t=this.mean+this.stdDev*i*s,(!this.truncated||this.isValidTruncated(e))&&(n=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}},y2=class{constructor(e,t,n,a){this.alpha=e,this.beta=1/t,this.dtype=n;let i=a||Math.random();this.randu=H2(i.toString()),this.randn=new kp(0,1,n,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}nextValue(){let e,t,n,a,i,o;for(;;){do a=this.randn.nextValue(),o=1+this.c*a;while(o<=0);if(o*=o*o,e=a*a,t=1-.331*e*e,n=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<t||Math.log(i)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)}convertValue(e){return this.dtype==="float32"?e:Math.round(e)}},b2=class{constructor(e=0,t=1,n,a){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=n,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=H2(a)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}};function XQe(r,e,t=1,n="float32",a){if(t==null&&(t=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error(`Unsupported data type ${n}`);let i=new y2(e,t,n,a),o=Pp(r,n);for(let s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var Iot=Y({randomGamma_:XQe});function YQe(r,e=0,t=1,n,a){if(n!=null&&n==="bool")throw new Error(`Unsupported data type ${n}`);let i=new kp(e,t,n,!1,a),o=Pp(r,n);for(let s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var ZQe=Y({randomNormal_:YQe});function JQe(r,e,t){if(e!=null&&e==="bool")throw new Error(`Unsupported data type ${e}`);return ZQe(r,0,1,e,t)}var Cot=Y({randomStandardNormal_:JQe});function QQe(r,e=0,t=1,n="float32",a){let i=Pp(r,n),o=new b2(e,t,null,a);for(let s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}var eet=Y({randomUniform_:QQe});function Bg(r,e,t=1,n="float32"){if(t===0)throw new Error("Cannot have a step of zero");let a={start:r,stop:e,step:t,dtype:n};return ae.runKernel(o7e,{},a)}function tet(r){let t={x:W(r,"x","reciprocal")};return ae.runKernel(pU,t)}var ret=Y({reciprocal_:tet});function net(r){let t={x:W(r,"x","relu")};return ae.runKernel(dU,t)}var Gg=Y({relu_:net});function aet(r){let t={x:W(r,"x","relu6")};return ae.runKernel(yU,t)}var F6=Y({relu6_:aet});function iet(r,e){let n={x:W(r,"x","reverse")},a={dims:e};return ae.runKernel(bU,n,a)}var Cs=Y({reverse_:iet});function oet(r){let e=W(r,"x","reverse");return U(e.rank===1,()=>`Error in reverse1D: x must be rank 1 but got rank ${e.rank}.`),Cs(e,0)}var Aot=Y({reverse1d_:oet});function set(r,e){let t=W(r,"x","reverse");return U(t.rank===2,()=>`Error in reverse2D: x must be rank 2 but got rank ${t.rank}.`),Cs(t,e)}var _ot=Y({reverse2d_:set});function uet(r,e){let t=W(r,"x","reverse");return U(t.rank===3,()=>`Error in reverse3D: x must be rank 3 but got rank ${t.rank}.`),Cs(t,e)}var Dot=Y({reverse3d_:uet});function cet(r,e){let t=W(r,"x","reverse");return U(t.rank===4,()=>`Error in reverse4D: x must be rank 4 but got rank ${t.rank}.`),Cs(t,e)}var Fot=Y({reverse4d_:cet});function fet(r){let t={x:W(r,"x","round")};return ae.runKernel(wU,t)}var R6=Y({round_:fet});function het(r){let t={x:W(r,"x","selu")};return ae.runKernel(SU,t)}var pet=Y({selu_:het});function det(r,e,t,n,a,i=[1,1],o="NHWC"){let s=W(r,"x","separableConv2d"),u=W(e,"depthwiseFilter","separableConv2d"),l=W(t,"pointwiseFilter","separableConv2d"),c=s,f=!1;if(s.rank===3&&(f=!0,c=fe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");U(c.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${c.rank}.`),U(u.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`),U(l.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`),U(l.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${l.shape[0]}.`),U(l.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${l.shape[1]}.`);let h=u.shape[2],p=u.shape[3];U(l.shape[2]===h*p,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*p}, but got ${l.shape[2]}.`);let d=V2(c,u,n,a,o,i),v=Rp(d,l,1,"valid",o);return f?fe(v,[v.shape[1],v.shape[2],v.shape[3]]):v}var vet=Y({separableConv2d_:det});function met(r){let t={x:W(r,"x","sign")};return ae.runKernel(IU,t)}var get=Y({sign_:met});function yet(r,e,t){let n=W(r,"x","slice1d");return U(n.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${n.rank} tensor`),$t(n,[e],[t])}var Rot=Y({slice1d_:yet});function bet(r,e,t){let n=W(r,"x","slice2d");return U(n.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${n.rank} tensor`),$t(n,e,t)}var Oot=Y({slice2d_:bet});function wet(r,e,t){let n=W(r,"x","slice3d");return U(n.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${n.rank} tensor`),$t(n,e,t)}var Pot=Y({slice3d_:wet});function xet(r,e,t){let n=W(r,"x","slice4d");return U(n.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${n.rank} tensor`),$t(n,e,t)}var Mot=Y({slice4d_:xet});function ket(r,e=-1){let t=W(r,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);let n={logits:t},a={dim:e};return ae.runKernel(OU,n,a)}var Net=Y({softmax_:ket});function Eet(r){U(r.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${r.dtype}.`);let e={input:r};return ae.runKernel(M8e,e)}var O6=Y({fft_:Eet});function Tet(r){U(r.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${r.dtype}.`);let e={input:r};return ae.runKernel(W8e,e)}var w2=Y({ifft_:Tet});function Iet(r){let e=r.shape[r.shape.length-1],t=r.size/e,n;if(e<=2){let a=fe(r,[t,e]);n=w2(a)}else{let a=[t,2*(e-1)],i=fe(Pg(r),[t,e]),o=fe(B2(r),[t,e]),s=Cs($t(i,[0,1],[t,e-2]),1),u=pe(Cs($t(o,[0,1],[t,e-2]),1),kt(-1)),l=Hn([i,s],1),c=Hn([o,u],1),f=fe($c(l,c),[a[0],a[1]]);n=w2(f)}if(n=Pg(n),r.rank===3&&r.shape[0]!==0){let a=n,i=r.shape[0];n=fe(n,[i,n.shape[0]/i,n.shape[1]]),a.dispose()}return n}var Cet=Y({irfft_:Iet});function Aet(r,e){U(r.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${r.dtype}`);let t=r.shape[r.shape.length-1],n=r.size/t,a;if(e!=null&&e<t){let d=r.shape.map(v=>0),m=r.shape.map(v=>v);m[r.shape.length-1]=e,a=$t(r,d,m),t=e}else if(e!=null&&e>t){let d=r.shape.map(m=>m);d[r.shape.length-1]=e-t,a=Hn([r,Wc(d)],r.shape.length-1),t=e}else a=r;let i=Ot(a),o=fe($c(a,i),[n,t]),s=O6(o),u=Math.floor(t/2)+1,l=Pg(s),c=B2(s),f=Lc(l,[u,t-u],l.shape.length-1),h=Lc(c,[u,t-u],c.shape.length-1),p=a.shape.slice();return p[a.shape.length-1]=u,fe($c(f[0],h[0]),p)}var P6=Y({rfft_:Aet});function _et(r,e){let t=W(r,"a","squaredDifference"),n=W(e,"b","squaredDifference");[t,n]=Lr(t,n),rr(t.shape,n.shape);let a={a:t,b:n},i={};return ae.runKernel(PU,a,i)}var M6=Y({squaredDifference_:_et});function Det(r,e){let t=W(r,"x","squeeze","string_or_numeric");return fe(t,C7e(t.shape,e).newShape)}var B6=Y({squeeze_:Det});function Fet(r,e=0){let t=Fg(r,"tensors","stack","string_or_numeric");U(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&U(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");let n=t,a={axis:e};return ae.runKernel(uU,n,a)}var Uc=Y({stack_:Fet});function Ret(r,e,t,n,a=0,i=0,o=0,s=0,u=0){let c={x:W(r,"x","stridedSlice","string_or_numeric")},f={begin:e,end:t,strides:n,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return ae.runKernel(y7e,c,f)}var Oet=Y({stridedSlice_:Ret});function Pet(r){let t={x:W(r,"x","tan","float32")};return ae.runKernel(BU,t)}var Met=Y({tan_:Pet});function Rc(r,e){E2(r);let t=Ap(r,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Dp(r,null,t,e)}function Ag(r,e,t){if(E2(r),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");let n=Ap(r,t);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Dp(r,e,n,t)}function Bet(r,e=1,t=!0){let n=W(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");let a=n.shape[n.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>a)throw new Error(`'k' passed to topk() must be <= the last dimension (${a}) but got ${e}`);let i={x:n},o={k:e,sorted:t},[s,u]=ae.runKernel(k7e,i,o);return{values:s,indices:u}}var Let=Y({topk_:Bet});function zet(r,e=0,t=1,n,a){if(n!=null&&n==="bool")throw new Error("Unsupported data type $ { dtype }");let i=new kp(e,t,n,!0,a),o=Pp(r,n);for(let s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var Bot=Y({truncatedNormal_:zet});function $et(r,e=0){let t=W(r,"x","unique","string_or_numeric");U(t.rank>0,()=>"The input tensor must be at least 1D");let n={x:t},a={axis:e},[i,o]=ae.runKernel(N7e,n,a);return{values:i,indices:o}}var Wet=Y({unique_:$et});function qet(r,e,t,n,a=!0){let i=W(r,"v","movingAverage"),o=W(e,"x","movingAverage"),s=W(t,"decay","movingAverage");tXe(i,o),U(Kc(i.shape,o.shape),()=>"Shape mismatch in v and x");let u=kt(1),l=ot(u,s),c=pe(ot(o,i),l);if(a){U(n!=null,()=>"When using zeroDebias: true, step is required.");let f=W(n,"step","movingAverage");c=gt(c,ot(u,Ju(s,f)))}return Qe(i,c)}var Lot=Y({movingAverage_:qet});function Vet(r,e,t){let n=W(r,"indices","scatterND","int32"),a=W(e,"updates","scatterND");hZe(a,n,t);let i={indices:n,updates:a},o={shape:t};return ae.runKernel(c7e,i,o)}var zot=Y({scatterND_:Vet});function Get(r,e,t,n){if(r.dtype!=="int32")throw new Error(`tf.sparseToDense() expects the indices to be int32 type, but the dtype was ${r.dtype}.`);if(r.rank>2)throw new Error(`sparseIndices should be a scalar, vector, or matrix, but got shape ${r.shape}.`);let a=r.rank>0?r.shape[0]:1,i=r.rank>1?r.shape[1]:1;if(t.length!==i)throw new Error(`outputShape has incorrect number of elements:, ${t.length}, should be: ${i}.`);let o=e.size;if(!(e.rank===0||e.rank===1&&o===a))throw new Error(`sparseValues has incorrect shape ${e.shape}, should be [] or [${a}]`);if(e.dtype!==n.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function Uet(r,e,t,n=0){let a=W(r,"sparseIndices","sparseToDense","int32"),i=W(e,"sparseValues","sparseToDense","string_or_numeric"),o=W(n,"defaultValue","sparseToDense",i.dtype);Get(a,i,t,o);let s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:t};return ae.runKernel(m7e,s,u)}var $ot=Y({sparseToDense_:Uet});function Het(r,e){let t=W(e,"indices","gatherND","int32"),a={params:W(r,"x","gatherND","string_or_numeric"),indices:t};return ae.runKernel(z8e,a)}var Wot=Y({gatherND_:Het});function Ket(r,e){if(e==null)return r.shape.slice();if(Kc(r.shape,e))return e;if(r.shape.length===e.length){let t=[];for(let n=0;n<r.shape.length;n++)e[n]==null&&r.shape[n]!=null?t.push(r.shape[n]):t.push(e[n]);return t}return e}function jet(r,e,t,n){let a=W(r,"x","dropout");if(U(a.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${a.dtype} tensor instead.`),U(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return r instanceof bn?a.clone():a;let i=Ket(a,t),o=1-e,s=gt(z2(Qe(eet(i,0,1,"float32",n),o)),o);return pe(a,s)}var qot=Y({dropout_:jet});function Xet(r){return Math.floor(Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))))}function L6(r,e,t){let n=1-r%2,a=new Float32Array(r);for(let i=0;i<r;++i){let o=2*Math.PI*i/(r+n-1);a[i]=e-t*Math.cos(o)}return Rc(a,"float32")}function K2(r,e,t){if(t==null||t==="linear")return r;if(t==="relu")return pe(r,_p(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function j2(r,e){let t=e,n=hn(r.shape,e.shape);return n.length>0&&(t=ct(t,n)),fe(t,r.shape)}function X2(r,e,t,n){if(e==="linear")return r;if(e==="relu")return Gg(r);if(e==="elu")return w6(r);if(e==="relu6")return F6(r);if(e==="prelu")return D6(r,t);if(e==="leakyrelu")return S6(r,n);if(e==="sigmoid")return Yu(r);throw new Error(`Unknown fused activation ${e}.`)}var Y2=(r,e)=>!(r>0)||e==="linear";function Yet({x:r,filter:e,strides:t,pad:n,dataFormat:a="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:s,activation:u="linear",preluActivationWeights:l,leakyreluAlpha:c}){if(u=u||"linear",Y2(ae.state.gradientDepth,u)===!1){U(a==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${a} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let k=Rp(r,e,t,n,a,i,o);return s!=null&&(k=Qe(k,s)),X2(k,u,l,c)}let f=W(r,"x","conv2d","float32"),h=W(e,"filter","conv2d","float32"),p=f,d=!1;f.rank===3&&(d=!0,p=fe(f,[1,f.shape[0],f.shape[1],f.shape[2]])),U(p.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${p.rank}.`),U(h.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${h.rank}.`),Kn("fused conv2d",n,o);let m=a==="NHWC"?p.shape[3]:p.shape[1];U(h.shape[2]===m,()=>`Error in conv2d: depth of input (${m}) must match input depth for filter ${h.shape[2]}.`),U(Po(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);let v=F2(p.shape,h.shape,t,i,n,o),g;s!=null&&(g=W(s,"bias","fused conv2d"),[g]=Lr(g,f),a==="NHWC"?rr(v.outShape,g.shape):(U(g.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${g.shape.length}.`),U(g.shape.length===0||g.shape[0]===v.outChannels||g.shape[0]===1,()=>`Error in fused conv2d: bias shape (${g.shape}) is not compatible with the number of output channels (${v.outChannels})`)));let y;if(l!=null){let k=l.shape;if(U(k.length<=1||k.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${k.length}.`),k.length===1)U(k[0]===1||k[0]===v.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${k}) is not compatible with the number of output channels (${v.outChannels}).`);else if(k.length===3)try{rr(k,v.outShape)}catch{let T=`Error in fused conv2d: PReLU activation weights (${k}) is not compatible with the output shape of the conv2d (${v.outShape}).`;throw Error(T)}y=W(l,"prelu weights","fused conv2d")}let b=(k,N)=>{U(a==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${a} but only NHWC is currently supported.`);let[T,I,F,D]=N,R=K2(k,F,u);U(Zu(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);let P=P2(I.shape,R,T,t,n),B=O2(I,R,T.shape,t,n),q=[P,B];if(D!=null){let O=j2(D,R);q.push(O)}return q},w={x:p,filter:h,bias:g,preluActivationWeights:y},x={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o,activation:u,leakyreluAlpha:c};return s==null?Ro((N,T,I)=>{let F=ae.runKernel(RV,w,x);return I([T,N,F]),d&&(F=fe(F,[F.shape[1],F.shape[2],F.shape[3]])),{value:F,gradFunc:b}})(p,h):Ro((N,T,I,F)=>{let D=ae.runKernel(RV,w,x);return F([T,N,D,I]),d&&(D=fe(D,[D.shape[1],D.shape[2],D.shape[3]])),{value:D,gradFunc:b}})(p,h,g)}var Vot=Y({fusedConv2d_:Yet});function Zet({x:r,filter:e,strides:t,pad:n,dataFormat:a="NHWC",dilations:i=[1,1],dimRoundingMode:o,bias:s,activation:u="linear",preluActivationWeights:l,leakyreluAlpha:c}){if(Y2(ae.state.gradientDepth,u)===!1){let x=V2(r,e,t,n,a,i,o);return s!=null&&(x=Qe(x,s)),X2(x,u,l,c)}let f=W(r,"x","depthwiseConv2d","float32"),h=W(e,"filter","depthwiseConv2d","float32"),p=f,d=!1;f.rank===3&&(d=!0,p=fe(f,[1,f.shape[0],f.shape[1],f.shape[2]])),U(p.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${p.rank}.`),U(h.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${h.rank}.`),U(p.shape[3]===h.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${p.shape[3]}) must match the inChannels dimension in filter ${h.shape[2]}.`),i==null&&(i=[1,1]),U(Po(t,i),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),Kn("fused depthwiseConv2d",n,o);let m=F2(p.shape,h.shape,t,i,n,o,!0),v;s!=null&&(v=W(s,"bias","fused conv2d"),[v]=Lr(v,f),rr(m.outShape,v.shape));let g;l!=null&&(g=W(l,"prelu weights","fused depthwiseConv2d"));let y=(x,k)=>{U(Zu(i),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${i}'`);let[N,T,I,F]=k,D=K2(x,I,u),R=l6(T.shape,D,N,t,n,i,o),P=u6(T,D,N.shape,t,n,i,o);if(F!=null){let B=j2(v,D);return[R,P,B]}return[R,P]},b={x:p,filter:h,bias:v,preluActivationWeights:g},w={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o,activation:u,leakyreluAlpha:c};return s==null?Ro((k,N,T)=>{let I=ae.runKernel(OV,b,w);return T([N,k,I]),d&&(I=fe(I,[I.shape[1],I.shape[2],I.shape[3]])),{value:I,gradFunc:y}})(p,h):Ro((k,N,T,I)=>{let F=ae.runKernel(OV,b,w);return I([N,k,F,T]),d&&(F=fe(F,[F.shape[1],F.shape[2],F.shape[3]])),{value:F,gradFunc:y}})(p,h,v)}var Got=Y({fusedDepthwiseConv2d_:Zet});function Jet({a:r,b:e,transposeA:t=!1,transposeB:n=!1,bias:a,activation:i="linear",preluActivationWeights:o,leakyreluAlpha:s=.2}){if(Y2(ae.state.gradientDepth,i)===!1){let D=Rt(r,e,t,n);return a!=null&&(D=Qe(D,a)),X2(D,i,o,s)}let u=W(r,"a","fused matMul"),l=W(e,"b","fused matMul");[u,l]=Lr(u,l);let c=t?u.shape[u.rank-2]:u.shape[u.rank-1],f=n?l.shape[l.rank-1]:l.shape[l.rank-2],h=t?u.shape[u.rank-1]:u.shape[u.rank-2],p=n?l.shape[l.rank-2]:l.shape[l.rank-1],d=u.shape.slice(0,-2),m=l.shape.slice(0,-2),v=ba(d),g=ba(m);U(c===f,()=>`Error in fused matMul: inner shapes (${c}) and (${f}) of Tensors with shapes ${u.shape} and ${l.shape} and transposeA=${t} and transposeB=${n} must match.`);let b=rr(u.shape.slice(0,-2),l.shape.slice(0,-2)).concat([h,p]),w=t?fe(u,[v,c,h]):fe(u,[v,h,c]),x=n?fe(l,[g,p,f]):fe(l,[g,f,p]),k;a!=null&&(k=W(a,"bias","fused matMul"),[k]=Lr(k,u),rr(b,k.shape));let N;o!=null&&(N=W(o,"prelu weights","fused matMul"));let T=(D,R)=>{let[P,B,q,O]=R,V=K2(fe(D,q.shape),q,i),K,Z;if(!t&&!n?(K=Rt(V,B,!1,!0),Z=Rt(P,V,!0,!1)):!t&&n?(K=Rt(V,B,!1,!1),Z=Rt(V,P,!0,!1)):t&&!n?(K=Rt(B,V,!1,!0),Z=Rt(P,V,!1,!1)):(K=Rt(B,V,!0,!0),Z=Rt(V,P,!0,!0)),a!=null){let j=j2(O,V);return[K,Z,j]}else return[K,Z]},I={a:w,b:x,bias:k,preluActivationWeights:N},F={transposeA:t,transposeB:n,activation:i,leakyreluAlpha:s};return a==null?Ro((R,P,B)=>{let q=ae.runKernel(FV,I,F);return B([R,P,q]),{value:fe(q,b),gradFunc:T}})(w,x):Ro((R,P,B,q)=>{let O=ae.runKernel(FV,I,F);return q([R,P,O,B]),{value:fe(O,b),gradFunc:T}})(w,x,k)}var Uot=Y({fusedMatMul_:Jet});function Qet(r){return L6(r,.54,.46)}var Hot=Y({hammingWindow_:Qet});function ett(r){return L6(r,.5,.5)}var ttt=Y({hannWindow_:ett});function rtt(r,e,t,n=!1,a=0){let i=0,o=[];for(;i+e<=r.size;)o.push($t(r,i,e)),i+=t;if(n)for(;i<r.size;){let s=i+e-r.size,u=Hn([$t(r,i,e-s),qg([s],a)]);o.push(u),i+=t}return o.length===0?Ag([],[0,e]):fe(Hn(o),[o.length,e])}var ntt=Y({frame_:rtt});function att(r,e,t,n,a=ttt){n==null&&(n=Xet(e));let i=ntt(r,e,t),o=pe(i,a(e));return P6(o,n)}var Kot=Y({stft_:att});function itt(r,e,t,n,a="bilinear",i=0){let o=W(r,"image","cropAndResize"),s=W(e,"boxes","cropAndResize","float32"),u=W(t,"boxInd","cropAndResize","int32"),l=s.shape[0];U(o.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`),U(s.rank===2&&s.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${l},4] but had shape ${s.shape}.`),U(u.rank===1&&u.shape[0]===l,()=>`Error in cropAndResize: boxInd must be have size [${l}] but had shape ${s.shape}.`),U(n.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${n.length}.`),U(n[0]>=1&&n[1]>=1,()=>`cropSize must be atleast [1,1], but was ${n}`),U(a==="bilinear"||a==="nearest",()=>`method must be bilinear or nearest, but was ${a}`);let c={image:o,boxes:s,boxInd:u},f={method:a,extrapolationValue:i,cropSize:n};return ae.runKernel(E8e,c,f)}var jot=Y({cropAndResize_:itt});function ott(r){let e=W(r,"image","flipLeftRight","float32");U(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);let t={image:e};return ae.runKernel(L8e,t,{})}var Xot=Y({flipLeftRight_:ott});function stt(r){let e=W(r,"image","grayscaleToRGB"),t=e.rank-1,n=e.shape[t];U(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),U(n===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${n}.`);let a=new Array(e.rank);return a.fill(1,0,t),a[t]=3,Oc(e,a)}var Yot=Y({grayscaleToRGB_:stt});function utt(r,e,t=0,n=.5){let a=W(r,"image","rotateWithOffset","float32");U(a.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${a.rank}.`);let i={image:a},o={radians:e,fillValue:t,center:n};return ae.runKernel(E7e,i,o)}var Zot=Y({rotateWithOffset_:utt});function Z2(r,e,t,n,a,i){n==null&&(n=.5),a==null&&(a=Number.NEGATIVE_INFINITY),i==null&&(i=0);let o=r.shape[0];return t=Math.min(t,o),U(0<=n&&n<=1,()=>`iouThreshold must be in [0, 1], but was '${n}'`),U(r.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${r.rank}'`),U(r.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${r.shape[1]}`),U(e.rank===1,()=>"scores must be a 1D tensor"),U(e.shape[0]===o,()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`),U(0<=i&&i<=1,()=>`softNmsSigma must be in [0, 1], but was '${i}'`),{maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i}}function ltt(r,e,t,n=.5,a=Number.NEGATIVE_INFINITY){let i=W(r,"boxes","nonMaxSuppression","float32"),o=W(e,"scores","nonMaxSuppression","float32"),s=Z2(i,o,t,n,a);t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold;let u={maxOutputSize:t,iouThreshold:n,scoreThreshold:a};return ae.runKernel(t7e,{boxes:i,scores:o},u)}var Jot=Y({nonMaxSuppression_:ltt});function ctt(r,e,t,n=.5,a=Number.NEGATIVE_INFINITY,i=0){let o=W(r,"boxes","nonMaxSuppression"),s=W(e,"scores","nonMaxSuppression"),u=Z2(o,s,t,n,a,i);t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma;let l={boxes:o,scores:s},c={maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i},f=ae.runKernel(n7e,l,c);return{selectedIndices:f[0],selectedScores:f[1]}}var Qot=Y({nonMaxSuppressionWithScore_:ctt});function ftt(r,e,t,n=.5,a=Number.NEGATIVE_INFINITY,i=!1){let o=W(r,"boxes","nonMaxSuppression"),s=W(e,"scores","nonMaxSuppression"),u=Z2(o,s,t,n,a,null),l=u.maxOutputSize,c=u.iouThreshold,f=u.scoreThreshold,h={boxes:o,scores:s},p={maxOutputSize:l,iouThreshold:c,scoreThreshold:f,padToMaxOutputSize:i},d=ae.runKernel(r7e,h,p);return{selectedIndices:d[0],validOutputs:d[1]}}var est=Y({nonMaxSuppressionPadded_:ftt});function htt(r,e,t=!1,n=!1){let a=W(r,"images","resizeBilinear");U(a.rank===3||a.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${a.rank}.`),U(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),U(n===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=a,o=!1;a.rank===3&&(o=!0,i=fe(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let[]=e,s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},l=ae.runKernel(gU,s,u);return o?fe(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var ptt=Y({resizeBilinear_:htt});function dtt(r,e,t=!1,n=!1){let a=W(r,"images","resizeNearestNeighbor");U(a.rank===3||a.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${a.rank}.`),U(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),U(a.dtype==="float32"||a.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),U(n===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=a,o=!1;a.rank===3&&(o=!0,i=fe(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let[]=e,s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},l=ae.runKernel(mU,s,u);return o?fe(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var vtt=Y({resizeNearestNeighbor_:dtt});function mtt(r,e="binary",t=!1,n=.5){let a=W(r,"image","threshold"),i=.2989,o=.587,s=.114,u=a.shape[0]*a.shape[1],l=pe(Rc([n]),255),c,f,h,p;if(U(a.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${a.rank}.`),U(a.shape[2]===3||a.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${a.shape[2]}.`),U(a.dtype==="int32"||a.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${a.dtype}.`),U(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),a.shape[2]===3){[c,f,h]=Lc(a,[1,1,1],-1);let v=pe(c,i),g=pe(f,o),y=pe(h,s);p=Qe(Qe(v,g),y)}else p=r;if(e==="otsu"){let v=ZZe(Ye(R6(p),"int32"),DYe([]),256);l=gtt(v,u)}let d=t?jc(p,l):Mo(p,l);return Ye(pe(d,255),"int32")}function gtt(r,e){let t=Rc([-1]),n=Rc([0]),a=Rc([0]),i,o,s,u,l,c;for(let f=0;f<r.size-1;f++){i=$t(r,0,f+1),o=$t(r,f+1),l=gt(ct(i),e),c=gt(ct(o),e);let h=ct(pe(i,Bg(0,i.size)));s=gt(h,ct(i));let p=qg(o.shape,i.size),d=Qe(Bg(0,o.size),p),m=pe(o,d);u=gt(ct(m),ct(o));let v=ot(s,u),g=ot(s,u),y=pe(l,c);a=pe(pe(y,v),g);let b=Mo(a,n);n=Ba(b,a,n),t=Ba(b,Rc([f]),t)}return t}var tst=Y({threshold_:mtt});function ytt(r,e,t="nearest",n="constant",a=0,i){let o=W(r,"image","transform","float32"),s=W(e,"transforms","transform","float32");U(o.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${o.rank}.`),U(s.rank===2&&(s.shape[0]===o.shape[0]||s.shape[0]===1)&&s.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),U(i==null||i.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${i}.`);let u={image:o,transforms:s},l={interpolation:t,fillMode:n,fillValue:a,outputShape:i};return ae.runKernel(S7e,u,l)}var rst=Y({transform_:ytt});function btt(r,e,t){U(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),U(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`);let n=W(r,"a","bandPart");U(n.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${n.rank}.`);let a=n.shape,[i,o]=n.shape.slice(-2);if(!(e<=i))throw new Error(`bandPart(): numLower (${e}) must not be greater than the number of rows (${i}).`);if(!(t<=o))throw new Error(`bandPart(): numUpper (${t}) must not be greater than the number of columns (${o}).`);e<0&&(e=i),t<0&&(t=o);let s=fe(Bg(0,i,1,"int32"),[-1,1]),u=Bg(0,o,1,"int32"),l=ot(s,u),c=Bc(jc(l,kt(+e,"int32")),Fp(l,kt(-t,"int32"))),f=Wc([i,o],n.dtype);return fe(Uc(zg(fe(n,[-1,i,o])).map(h=>Ba(c,h,f))),a)}var nst=Y({bandPart_:btt});function wtt(r){let e;if(Array.isArray(r)){e=!1,U(r!=null&&r.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");let a=r[0].shape[0];for(let i=1;i<r.length;++i)U(r[i].shape[0]===a,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${r[i].shape[0]} vs. ${a})`)}else e=!0,r=Lc(r,r.shape[0],0).map(a=>B6(a,[0]));U(r.length<=r[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${r.length}) exceeds number of dimensions (${r[0].shape[0]}).`);let t=[],n=r;for(let a=0;a<r.length;++a)t.push(ae.tidy(()=>{let i=n[a];if(a>0)for(let o=0;o<a;++o){let s=pe(ct(pe(t[o],i)),t[o]);i=ot(i,s)}return gt(i,Vg(i,"euclidean"))}));return e?Uc(t,0):t}var ast=Y({gramSchmidt_:wtt});function xtt(r,e=!1){if(U(r.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${r.rank}`),r.rank===2)return JV(r,e);{let t=r.shape.slice(0,r.shape.length-2).reduce((u,l)=>u*l),n=zg(fe(r,[t,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),a=[],i=[];n.forEach(u=>{let[l,c]=JV(u,e);a.push(l),i.push(c)});let o=fe(Uc(a,0),r.shape),s=fe(Uc(i,0),r.shape);return[o,s]}}function JV(r,e=!1){return ae.tidy(()=>{U(r.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${r.shape.length}D Tensor.`);let t=r.shape[0],n=r.shape[1],a=$Je(t),i=bp(r),o=Ag([[1]],[1,1]),s=bp(o),u=t>=n?n:t;for(let l=0;l<u;++l){let c=i,f=s,h=a;[s,i,a]=ae.tidy(()=>{let p=$t(i,[l,l],[t-l,1]),d=Vg(p),m=$t(i,[l,l],[1,1]),v=Ba(Mo(m,0),Ag([[-1]]),Ag([[1]])),g=ot(m,pe(v,d)),y=gt(p,g);y.shape[0]===1?s=bp(o):s=Hn([o,$t(y,[1,0],[y.shape[0]-1,y.shape[1]])],0);let b=rn(gt(Rt(v,g),d)),w=$t(i,[l,0],[t-l,n]),x=pe(b,s),k=io(s);if(l===0)i=ot(w,Rt(x,Rt(k,w)));else{let I=ot(w,Rt(x,Rt(k,w)));i=Hn([$t(i,[0,0],[l,n]),I],0)}let N=io(x),T=$t(a,[0,l],[t,a.shape[1]-l]);if(l===0)a=ot(T,Rt(Rt(T,s),N));else{let I=ot(T,Rt(Rt(T,s),N));a=Hn([$t(a,[0,0],[t,l]),I],1)}return[s,i,a]}),wa([c,f,h])}return!e&&t>n&&(a=$t(a,[0,0],[t,n]),i=$t(i,[0,0],[n,n])),[a,i]})}var ist=Y({qr_:xtt});var Un;(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Un||(Un={}));function ktt(r,e,t=Un.SUM_BY_NONZERO_WEIGHTS){let n=W(r,"losses","computeWeightedLoss"),a=null;e!=null&&(a=W(e,"weights","computeWeightedLoss"));let i=a==null?n:pe(n,a);if(t===Un.NONE)return i;if(t===Un.SUM)return ct(i);if(t===Un.MEAN){if(a==null)return Mg(i);{let o=n.size/a.size,s=gt(ct(i),ct(a));return o>1?gt(s,kt(o)):s}}if(t===Un.SUM_BY_NONZERO_WEIGHTS){if(a==null)return gt(ct(i),kt(n.size));{let o=pe(a,Op(n.shape)),s=Ye(ct(_6(o,kt(0))),"float32");return gt(ct(i),s)}}throw Error(`Unknown reduction: ${t}`)}var As=Y({computeWeightedLoss_:ktt});function Stt(r,e,t,n=Un.SUM_BY_NONZERO_WEIGHTS){let a=W(r,"labels","absoluteDifference"),i=W(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=W(t,"weights","absoluteDifference")),oo(a.shape,i.shape,"Error in absoluteDifference: ");let s=Ma(ot(a,i));return As(s,o,n)}var ost=Y({absoluteDifference_:Stt});function Ntt(r,e,t,n,a=Un.SUM_BY_NONZERO_WEIGHTS){let i=W(r,"labels","cosineDistance"),o=W(e,"predictions","cosineDistance"),s=null;n!=null&&(s=W(n,"weights","cosineDistance")),oo(i.shape,o.shape,"Error in cosineDistance: ");let u=kt(1),l=ot(u,ct(pe(i,o),t,!0));return As(l,s,a)}var sst=Y({cosineDistance_:Ntt});function Ett(r,e,t,n=Un.SUM_BY_NONZERO_WEIGHTS){let a=W(r,"labels","hingeLoss"),i=W(e,"predictions","hingeLoss"),o=null;t!=null&&(o=W(t,"weights","hingeLoss")),oo(a.shape,i.shape,"Error in hingeLoss: ");let s=kt(1);a=ot(pe(kt(2),a),s);let u=Gg(ot(s,pe(a,i)));return As(u,o,n)}var ust=Y({hingeLoss_:Ett});function Ttt(r,e,t,n=1,a=Un.SUM_BY_NONZERO_WEIGHTS){let i=W(r,"labels","huberLoss"),o=W(e,"predictions","huberLoss"),s=null;t!=null&&(s=W(t,"weights","huberLoss")),oo(i.shape,o.shape,"Error in huberLoss: ");let u=kt(n),l=Ma(ot(o,i)),c=A6(l,u),f=ot(l,c),h=Qe(pe(kt(.5),tr(c)),pe(u,f));return As(h,s,a)}var lst=Y({huberLoss_:Ttt});function Itt(r,e,t,n=1e-7,a=Un.SUM_BY_NONZERO_WEIGHTS){let i=W(r,"labels","logLoss"),o=W(e,"predictions","logLoss"),s=null;t!=null&&(s=W(t,"weights","logLoss")),oo(i.shape,o.shape,"Error in logLoss: ");let u=kt(1),l=kt(n),c=rn(pe(i,qc(Qe(o,l)))),f=pe(ot(u,i),qc(Qe(ot(u,o),l))),h=ot(c,f);return As(h,s,a)}var cst=Y({logLoss_:Itt});function Ctt(r,e,t,n=Un.SUM_BY_NONZERO_WEIGHTS){let a=W(r,"labels","meanSquaredError"),i=W(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=W(t,"weights","meanSquaredError")),oo(a.shape,i.shape,"Error in meanSquaredError: ");let s=M6(a,i);return As(s,o,n)}var fst=Y({meanSquaredError_:Ctt});function Att(r,e){let t=W(r,"labels","sigmoidCrossEntropyWithLogits"),n=W(e,"logits","sigmoidCrossEntropyWithLogits");oo(t.shape,n.shape,"Error in sigmoidCrossEntropyWithLogits: ");let a=Gg(n),i=pe(n,t),o=N6(Bi(rn(Ma(n))));return Qe(ot(a,i),o)}function _tt(r,e,t,n=0,a=Un.SUM_BY_NONZERO_WEIGHTS){let i=W(r,"multiClassLabels","sigmoidCrossEntropy"),o=W(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=W(t,"weights","sigmoidCrossEntropy")),oo(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),n>0){let l=kt(n),c=kt(1),f=kt(.5);i=Qe(pe(i,ot(c,l)),pe(f,l))}let u=Att(i,o);return As(u,s,a)}var hst=Y({sigmoidCrossEntropy_:_tt});function Dtt(r,e,t=-1){if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${t}`);return Ro((a,i,o)=>{let u=T6(i,[t],!0),l=ot(Ye(i,"float32"),u);o([a,l]);let c=rn(pe(l,a));return{value:ct(c,[t]),gradFunc:(p,d)=>{let[m,v]=d,g=zc(p.shape,[t]);return[pe(fe(p,g),ot(Ye(m,"float32"),Bi(v))),pe(fe(p,g),ot(Bi(v),Ye(m,"float32")))]}}})(r,e)}function Ftt(r,e,t,n=0,a=Un.SUM_BY_NONZERO_WEIGHTS){let i=W(r,"onehotLabels","softmaxCrossEntropy"),o=W(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=W(t,"weights","softmaxCrossEntropy")),oo(i.shape,o.shape,"Error in softmaxCrossEntropy: "),n>0){let l=kt(n),c=kt(1),f=kt(i.shape[1]);i=Qe(pe(i,ot(c,l)),gt(l,f))}let u=Dtt(i,o);return As(u,s,a)}var pst=Y({softmaxCrossEntropy_:Ftt});function Rtt(r,e,t,n){let a=W(r,"indices","sparseFillEmptyRows","int32"),i=W(e,"values","sparseFillEmptyRows"),o=W(t,"denseShape","sparseFillEmptyRows","int32"),s=W(n,"defaultValue","sparseFillEmptyRows",i.dtype);if(a.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        ${a.shape}`);if(i.rank!==1)throw new Error(`Values should be Tensor1D but received shape ${i.shape}`);if(o.rank!==1)throw new Error(`Dense shape should be Tensor1D but received shape ${o.shape}`);if(s.rank!==0)throw new Error(`Default value should be a scalar but received shape ${s.shape}`);let u={indices:a,values:i,denseShape:o,defaultValue:s},l=ae.runKernel(h7e,u);return{outputIndices:l[0],outputValues:l[1],emptyRowIndicator:l[2],reverseIndexMap:l[3]}}var dst=Y({sparseFillEmptyRows_:Rtt});function Ott(r,e,t){let n=W(r,"inputIndices","sparseReshape","int32"),a=W(e,"inputShape","sparseReshape","int32"),i=W(t,"newShape","sparseReshape","int32");if(n.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        ${n.shape}`);if(a.rank!==1)throw new Error(`Input shape should be Tensor1D but received shape ${a.shape}`);if(i.rank!==1)throw new Error(`New shape should be Tensor1D but received shape ${i.shape}`);let o={inputIndices:n,inputShape:a,newShape:i},s=ae.runKernel(p7e,o);return{outputIndices:s[0],outputShape:s[1]}}var vst=Y({sparseReshape_:Ott});function Ptt(r,e,t){let n=W(r,"data","sparseSegmentMean"),a=W(e,"indices","sparseSegmentMean","int32"),i=W(t,"segmentIds","sparseSegmentMean","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          ${a.shape}`);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          ${i.shape}`);let o={data:n,indices:a,segmentIds:i};return ae.runKernel(d7e,o)}var mst=Y({sparseSegmentMean_:Ptt});function Mtt(r,e,t){let n=W(r,"data","sparseSegmentSum"),a=W(e,"indices","sparseSegmentSum","int32"),i=W(t,"segmentIds","sparseSegmentSum","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         ${a.shape}`);if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         ${i.shape}`);let o={data:n,indices:a,segmentIds:i};return ae.runKernel(v7e,o)}var gst=Y({sparseSegmentSum_:Mtt});function Btt(r,e,t,n,a,i,o,s){let u=W(r,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error(`Data must be a vector, saw: ${u.shape}`);let l=W(e,"dataSplits","stringNGrams");if(l.dtype!=="int32")throw new Error("Data splits must be of datatype int32");let c={separator:t,nGramWidths:n,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},f={data:u,dataSplits:l},h=ae.runKernel(b7e,f,c);return{nGrams:h[0],nGramsSplits:h[1]}}var yst=Y({stringNGrams_:Btt});function Ltt(r,e,t=!0){let n=W(r,"input","stringSplit","string"),a=W(e,"delimiter","stringSplit","string");if(n.rank!==1)throw new Error(`Input should be Tensor1D but received shape ${n.shape}`);if(a.rank!==0)throw new Error(`Delimiter should be a scalar but received shape ${a.shape}`);let i={skipEmpty:t},o={input:n,delimiter:a},s=ae.runKernel(w7e,o,i);return{indices:s[0],values:s[1],shape:s[2]}}var bst=Y({stringSplit_:Ltt});function ztt(r,e){let t=W(r,"input","stringToHashBucketFast","string"),n={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");let a={input:t};return ae.runKernel(x7e,a,n)}var wst=Y({stringToHashBucketFast_:ztt});var Oo=class extends d2{minimize(e,t=!1,n){let{value:a,grads:i}=this.computeGradients(e,n);if(n!=null){let o=n.map(s=>({name:s.name,tensor:i[s.name]}));this.applyGradients(o)}else this.applyGradients(i);return wa(i),t?a:(a.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return JJe(e,t)}dispose(){this.iterations_!=null&&wa(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:kt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}};Object.defineProperty(Oo,Symbol.hasInstance,{value:r=>r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null});var Sp=class extends Oo{constructor(e,t,n=null){super(),this.learningRate=e,this.rho=t,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],n==null&&(this.epsilon=ae.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,a)=>{let i=ae.registeredVariables[n],o=!1;this.accumulatedGrads[a]==null&&(this.accumulatedGrads[a]={originalName:`${n}/accum_grad`,variable:tn(()=>Ot(i).variable(o))}),this.accumulatedUpdates[a]==null&&(this.accumulatedUpdates[a]={originalName:`${n}/accum_var`,variable:tn(()=>Ot(i).variable(o))});let s=Array.isArray(e)?e[a].tensor:e[n];if(s==null)return;let u=this.accumulatedGrads[a].variable,l=this.accumulatedUpdates[a].variable;tn(()=>{let c=Qe(pe(u,this.rho),pe(tr(s),1-this.rho)),f=pe(gt(xa(Qe(l,this.epsilon)),xa(Qe(u,this.epsilon))),s),h=Qe(pe(l,this.rho),pe(tr(f),1-this.rho));u.assign(c),l.assign(h);let p=Qe(pe(f,-this.learningRate),i);i.assign(p)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(wa(this.accumulatedGrads.map(e=>e.variable)),wa(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){let e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);let t=e.length/2,n=!1;this.accumulatedGrads=e.slice(0,t).map(a=>({originalName:a.name,variable:a.tensor.variable(n)})),this.accumulatedUpdates=e.slice(t,t*2).map(a=>({originalName:a.name,variable:a.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}};Sp.className="Adadelta";Qu(Sp);var Np=class extends Oo{constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,a)=>{let i=ae.registeredVariables[n];this.accumulatedGrads[a]==null&&(this.accumulatedGrads[a]={originalName:`${n}/accumulator`,variable:tn(()=>qg(i.shape,this.initialAccumulatorValue).variable(!1))});let o=Array.isArray(e)?e[a].tensor:e[n];if(o==null)return;let s=this.accumulatedGrads[a].variable;tn(()=>{let u=Qe(s,tr(o));s.assign(u);let l=Qe(pe(gt(o,xa(Qe(u,ae.backend.epsilon()))),-this.learningRate),i);i.assign(l)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&wa(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let t=!1;this.accumulatedGrads=e.map(n=>({originalName:n.name,variable:n.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}};Np.className="Adagrad";Qu(Np);var Ep=class extends Oo{constructor(e,t,n,a=null){super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=a,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],tn(()=>{this.accBeta1=kt(t).variable(),this.accBeta2=kt(n).variable()}),a==null&&(this.epsilon=ae.backend.epsilon())}applyGradients(e){let t=Array.isArray(e)?e.map(n=>n.name):Object.keys(e);tn(()=>{let n=ot(1,this.accBeta1),a=ot(1,this.accBeta2);t.forEach((i,o)=>{let s=ae.registeredVariables[i],u=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:tn(()=>Ot(s).variable(u))}),this.accumulatedSecondMoment[o]==null&&(this.accumulatedSecondMoment[o]={originalName:`${i}/v`,variable:tn(()=>Ot(s).variable(u))});let l=Array.isArray(e)?e[o].tensor:e[i];if(l==null)return;let c=this.accumulatedFirstMoment[o].variable,f=this.accumulatedSecondMoment[o].variable,h=Qe(pe(c,this.beta1),pe(l,1-this.beta1)),p=Qe(pe(f,this.beta2),pe(tr(l),1-this.beta2)),d=gt(h,n),m=gt(p,a);c.assign(h),f.assign(p);let v=Qe(pe(gt(d,Qe(xa(m),this.epsilon)),-this.learningRate),s);s.assign(v)}),this.accBeta1.assign(pe(this.accBeta1,this.beta1)),this.accBeta2.assign(pe(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&wa(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&wa(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){let e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),tn(()=>{this.accBeta1.assign(Ju(this.beta1,this.iterations_+1)),this.accBeta2.assign(Ju(this.beta2,this.iterations_+1))});let t=e.length/2,n=!1;this.accumulatedFirstMoment=e.slice(0,t).map(a=>({originalName:a.name,variable:a.tensor.variable(n)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(a=>({originalName:a.name,variable:a.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}};Ep.className="Adam";Qu(Ep);var Tp=class extends Oo{constructor(e,t,n,a=null,i=0){super(),this.learningRate=e,this.beta1=t,this.beta2=n,this.epsilon=a,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],tn(()=>{this.iteration=kt(0).variable(),this.accBeta1=kt(t).variable()}),a==null&&(this.epsilon=ae.backend.epsilon())}applyGradients(e){let t=Array.isArray(e)?e.map(n=>n.name):Object.keys(e);tn(()=>{let n=ot(1,this.accBeta1),a=gt(-this.learningRate,Qe(pe(this.iteration,this.decay),1));t.forEach((i,o)=>{let s=ae.registeredVariables[i],u=!1;this.accumulatedFirstMoment[o]==null&&(this.accumulatedFirstMoment[o]={originalName:`${i}/m`,variable:Ot(s).variable(u)}),this.accumulatedWeightedInfNorm[o]==null&&(this.accumulatedWeightedInfNorm[o]={originalName:`${i}/v`,variable:Ot(s).variable(u)});let l=Array.isArray(e)?e[o].tensor:e[i];if(l==null)return;let c=this.accumulatedFirstMoment[o].variable,f=this.accumulatedWeightedInfNorm[o].variable,h=Qe(pe(c,this.beta1),pe(l,1-this.beta1)),p=pe(f,this.beta2),d=Ma(l),m=U2(p,d);c.assign(h),f.assign(m);let v=Qe(pe(gt(a,n),gt(h,Qe(m,this.epsilon))),s);s.assign(v)}),this.iteration.assign(Qe(this.iteration,1)),this.accBeta1.assign(pe(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&wa(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&wa(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}};Tp.className="Adamax";Qu(Tp);var Hc=class extends Oo{constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,a)=>{let i=Array.isArray(e)?e[a].tensor:e[n];if(i==null)return;let o=ae.registeredVariables[n];tn(()=>{let s=Qe(pe(this.c,i),o);o.assign(s)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=k9e(kt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}};Hc.className="SGD";Qu(Hc);var Ip=class extends Hc{constructor(e,t,n=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=n,this.accumulations=[],this.m=kt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,a)=>{let i=ae.registeredVariables[n];this.accumulations[a]==null&&(this.accumulations[a]={originalName:`${n}/momentum`,variable:tn(()=>Ot(i).variable(!1))});let o=this.accumulations[a].variable,s=Array.isArray(e)?e[a].tensor:e[n];s!=null&&tn(()=>{let u,l=Qe(pe(this.m,o),s);this.useNesterov?u=Qe(pe(this.c,Qe(s,pe(l,this.m))),i):u=Qe(pe(this.c,l),i),o.assign(l),i.assign(u)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&wa(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let t=!1;this.accumulations=e.map(n=>({originalName:n.name,variable:n.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}};Ip.className="Momentum";Qu(Ip);var Cp=class extends Oo{constructor(e,t=.9,n=0,a=null,i=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=n,this.epsilon=a,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,a==null&&(this.epsilon=ae.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,a)=>{let i=ae.registeredVariables[n],o=!1;this.accumulatedMeanSquares[a]==null&&(this.accumulatedMeanSquares[a]={originalName:`${n}/rms`,variable:tn(()=>Ot(i).variable(o))}),this.accumulatedMoments[a]==null&&(this.accumulatedMoments[a]={originalName:`${n}/momentum`,variable:tn(()=>Ot(i).variable(o))}),this.accumulatedMeanGrads[a]==null&&this.centered&&(this.accumulatedMeanGrads[a]={originalName:`${n}/mg`,variable:tn(()=>Ot(i).variable(o))});let s=Array.isArray(e)?e[a].tensor:e[n];if(s==null)return;let u=this.accumulatedMeanSquares[a].variable,l=this.accumulatedMoments[a].variable;tn(()=>{let c=Qe(pe(u,this.decay),pe(tr(s),1-this.decay));if(this.centered){let f=this.accumulatedMeanGrads[a].variable,h=Qe(pe(f,this.decay),pe(s,1-this.decay)),p=gt(pe(s,this.learningRate),xa(ot(c,Qe(tr(h),this.epsilon)))),d=Qe(pe(l,this.momentum),p);u.assign(c),f.assign(h),l.assign(d);let m=ot(i,d);i.assign(m)}else{let f=Qe(pe(u,this.decay),pe(tr(s),1-this.decay)),h=Qe(pe(l,this.momentum),gt(pe(s,this.learningRate),xa(Qe(f,this.epsilon))));u.assign(f),l.assign(h);let p=ot(i,h);i.assign(p)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&wa(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&wa(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&wa(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){let e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);let t=this.centered?e.length/3:e.length/2,n=!1;this.accumulatedMeanSquares=e.slice(0,t).map(a=>({originalName:a.name,variable:a.tensor.variable(n)})),this.accumulatedMoments=e.slice(t,t*2).map(a=>({originalName:a.name,variable:a.tensor.variable(n)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(a=>({originalName:a.name,variable:a.tensor.variable(n)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}};Cp.className="RMSProp";Qu(Cp);var _o=class{static sgd(e){return new Hc(e)}static momentum(e,t,n=!1){return new Ip(e,t,n)}static rmsprop(e,t=.9,n=0,a=null,i=!1){return new Cp(e,t,n,a,i)}static adam(e=.001,t=.9,n=.999,a=null){return new Ep(e,t,n,a)}static adadelta(e=.001,t=.95,n=null){return new Sp(e,t,n)}static adamax(e=.002,t=.9,n=.999,a=null,i=0){return new Tp(e,t,n,a,i)}static adagrad(e,t=.1){return new Np(e,t)}};var xst={sgd:_o.sgd,momentum:_o.momentum,adadelta:_o.adadelta,adagrad:_o.adagrad,rmsprop:_o.rmsprop,adamax:_o.adamax,adam:_o.adam};var kst=(()=>typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:r=>r())();var QV;(function(r){r[r.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",r[r.VALUE_ROWIDS=1]="VALUE_ROWIDS",r[r.ROW_LENGTHS=2]="ROW_LENGTHS",r[r.ROW_SPLITS=3]="ROW_SPLITS",r[r.ROW_LIMITS=4]="ROW_LIMITS",r[r.ROW_STARTS=5]="ROW_STARTS"})(QV||(QV={}));var $tt=1.7580993408473768,Wtt=1.0507009873554805;function qtt(r,e,t){let n=r.shape.slice();n[t]=1;let a=fe(e,n),i=m2(r,t,!0,!1),o=m2(r,t,!0,!0),s=pe(i,o);return pe(a,s)}function Vtt(r,e,t){let n=r.shape.length,a=n-t.length,i=o6(t,n),o=r;i!=null&&(o=io(r,i));let s=o.shape.slice(),l=s.splice(n-t.length,t.length).reduce((h,p)=>h*p,1);s.push(l);let c=o.reshape(s),f=qtt(c,e,a);if(f=f.reshape(o.shape),i!=null){let h=M2(i);f=io(f,h)}return f}var Gtt={kernelName:hU,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{axis:a}=t,i=[];return a==null?i=n.shape.map((o,s)=>s):typeof a=="number"?i=[a]:i=a,{x:()=>Vtt(n,r,i)}}};var Utt={kernelName:DG,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=rr(t.shape,n.shape);return{a:()=>{let s=gt(r,Ye(n,"float32")),u=hn(t.shape,a);return u.length>0?fe(ct(s,u),t.shape):s},b:()=>{let s=pe(r,Ye(t,"float32")),u=hn(n.shape,a);u.length>0&&(s=fe(ct(s,u),n.shape));let l=tr(n);return rn(gt(s,Ye(l,"float32")))}}}};var Htt={kernelName:pU,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>gt(r,rn(tr(t)))}}};var Ktt={kernelName:yU,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e,n=pe(jc(t,6),_p(t));return{x:()=>pe(r,Ye(n,"float32"))}}};var jtt={kernelName:dU,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>pe(r,Ye(_p(t),"float32"))}}};var Xtt={kernelName:vU,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>fe(r,t.shape)}}};var Ytt={kernelName:gU,inputsToSave:["images"],gradFunc:(r,e,t)=>{let[n]=e,a={dy:r,images:n};return{images:()=>ae.runKernel(l7e,a,t)}}};var Ztt={kernelName:mU,inputsToSave:["images"],gradFunc:(r,e,t)=>{let[n]=e,a={dy:r,images:n};return{images:()=>ae.runKernel(u7e,a,t)}}};var Jtt={kernelName:bU,gradFunc:(r,e,t)=>{let{dims:n}=t,a=Li(n,r.shape);return{x:()=>Cs(r,a)}}};var Qtt={kernelName:wU,gradFunc:r=>({x:()=>Ot(r)})};var ert={kernelName:xU,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>rn(gt(r,pe(Ju(t,1.5),2)))}}};var trt={kernelName:kU,inputsToSave:["condition"],gradFunc:(r,e)=>{let[t]=e;return{condition:()=>Ye(Ot(t),"float32"),t:()=>pe(r,Ye(t,r.dtype)),e:()=>pe(r,Ye(G2(t),r.dtype))}}};var rrt={kernelName:SU,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=Mo(t,kt(0)),a=kt($tt),i=kt(Wtt),o=pe(r,i),s=pe(pe(r,a),Bi(Ye(t,"float32")));return Ba(n,o,s)}}}};var nrt={kernelName:CU,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e;return{x:()=>pe(r,pe(t,ot(kt(1),t)))}}};var art={kernelName:IU,gradFunc:r=>({x:()=>Ot(r)})};var irt={kernelName:EU,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>pe(q2(Ye(t,"float32")),r)}}};var ort={kernelName:TU,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>pe(b6(Ye(t,"float32")),r)}}};var srt={kernelName:NU,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{begin:a,size:i}=t,o=n.shape,[s,u]=pZe(n,a,i),l=[];for(let c=0;c<r.rank;c++)l.push([s[c],o[c]-s[c]-u[c]]);return{x:()=>Xc(r,l)}}};var urt={kernelName:OU,outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n]=e,{dim:a}=t,i=!0,o=pe(r,n);return{logits:()=>ot(o,pe(ct(o,[a],i),n))}}};var lrt={kernelName:AU,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>pe(r,Yu(t))}}};var eG={kernelName:FU,gradFunc:(r,e,t)=>{let{blockShape:n,paddings:a}=t;return{x:()=>W2(r,n,a)}}};var tG={kernelName:RU,gradFunc:(r,e,t)=>{let{axis:n}=t;return{x:()=>Hn(r,n)}}};var crt={kernelName:_U,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>gt(r,pe(xa(Ye(t,"float32")),2))}}};var frt={kernelName:g7e,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>pe(r,pe(Ye(t,"float32"),2))}}};var hrt={kernelName:PU,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=kt(2);return{a:()=>pe(r,pe(a,ot(t,n))),b:()=>pe(r,pe(a,ot(n,t)))}}};var prt={kernelName:qU,gradFunc:r=>({x:()=>Ot(r)})};var drt={kernelName:MU,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=rr(t.shape,n.shape);return{a:()=>{let s=r,u=hn(t.shape,a);return u.length>0&&(s=ct(s,u)),fe(s,t.shape)},b:()=>{let s=r,u=hn(n.shape,a);return u.length>0&&(s=ct(s,u)),fe(rn(s),n.shape)}}}};var vrt={kernelName:DU,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,a=n.shape.slice(),{axis:i}=t;Li(i,n.shape).forEach(l=>{a[l]=1});let s=fe(r,a),u=pe(s,Op(n.shape,"float32"));return{x:()=>u}}};var mrt={kernelName:BU,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>gt(r,tr(q2(t)))}}};var grt={kernelName:LU,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e;return{x:()=>pe(ot(kt(1),tr(t)),r)}}};var yrt={kernelName:N2,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{reps:a}=t;return{x:()=>{let o=Ot(n);if(n.rank===1)for(let s=0;s<a[0];++s)o=Qe(o,$t(r,[s*n.shape[0]],[n.shape[0]]));else if(n.rank===2)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)o=Qe(o,$t(r,[s*n.shape[0],u*n.shape[1]],[n.shape[0],n.shape[1]]));else if(n.rank===3)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)for(let l=0;l<a[2];++l)o=Qe(o,$t(r,[s*n.shape[0],u*n.shape[1],l*n.shape[2]],[n.shape[0],n.shape[1],n.shape[2]]));else if(n.rank===4)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)for(let l=0;l<a[2];++l)for(let c=0;c<a[3];++c)o=Qe(o,$t(r,[s*n.shape[0],u*n.shape[1],l*n.shape[2],c*n.shape[3]],[n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${n.rank} tensors yet.`);return o}}}};var brt={kernelName:Ng,gradFunc:(r,e,t)=>{let n=t,{perm:a}=n,i=M2(a);return{x:()=>io(r,i)}}};var wrt={kernelName:zU,gradFunc:(r,e,t)=>{let n=t,{axis:a}=n;return{value:()=>Uc(r,a)}}};var xrt={kernelName:$U,inputsToSave:["segmentIds"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>krt(r,t)}}};function krt(r,e){let t=U2(e,Ot(e)),n=k6(r,t),a=Fp(e,kt(0,"int32")),i=n.rank-a.rank;for(let s=0;s<i;++s)a=Ts(a,s+1);a=Bc(a,Op(n.shape,"bool"));let o=Ot(n);return Ba(a,n,o)}var Srt={kernelName:WU,gradFunc:r=>({x:()=>Ot(r)})};var Nrt=[t6,mXe,gXe,wXe,xXe,SXe,NXe,EXe,IXe,CXe,AXe,_Xe,BXe,$Xe,qXe,GXe,UXe,HXe,KXe,e9e,t9e,n9e,u9e,o9e,h9e,d9e,m9e,I9e,_9e,D9e,Utt,F9e,O9e,P9e,M9e,B9e,z9e,L9e,q9e,G9e,U9e,H9e,K9e,j9e,X9e,Z9e,J9e,Q9e,eYe,nYe,HV,HV,oYe,lYe,hYe,pYe,dYe,vYe,gYe,bYe,wYe,xYe,kYe,SYe,EYe,KV,KV,CYe,AYe,Gtt,Htt,Ktt,jtt,Xtt,Ytt,Ztt,Jtt,Qtt,ert,trt,rrt,nrt,art,irt,ort,srt,urt,lrt,eG,eG,tG,tG,crt,hrt,frt,prt,drt,vrt,mrt,grt,yrt,brt,wrt,xrt,Srt];for(let r of Nrt)$7e(r);ye().prototype.abs=function(){return this.throwIfDisposed(),Ma(this)};ye().prototype.acos=function(){return this.throwIfDisposed(),mZe(this)};ye().prototype.acosh=function(){return this.throwIfDisposed(),yZe(this)};ye().prototype.add=function(r){return this.throwIfDisposed(),Qe(this,r)};ye().prototype.all=function(r,e){return this.throwIfDisposed(),xZe(this,r,e)};ye().prototype.any=function(r,e){return this.throwIfDisposed(),SZe(this,r,e)};ye().prototype.argMax=function(r){return this.throwIfDisposed(),EZe(this,r)};ye().prototype.argMin=function(r){return this.throwIfDisposed(),IZe(this,r)};ye().prototype.asScalar=function(){return this.throwIfDisposed(),U(this.size===1,()=>"The array must have only 1 element."),fe(this,[])};ye().prototype.asType=function(r){return this.throwIfDisposed(),Ye(this,r)};ye().prototype.as1D=function(){return this.throwIfDisposed(),fe(this,[this.size])};ye().prototype.as2D=function(r,e){return this.throwIfDisposed(),fe(this,[r,e])};ye().prototype.as3D=function(r,e,t){return this.throwIfDisposed(),fe(this,[r,e,t])};ye().prototype.as4D=function(r,e,t,n){return this.throwIfDisposed(),fe(this,[r,e,t,n])};ye().prototype.as5D=function(r,e,t,n,a){return this.throwIfDisposed(),fe(this,[r,e,t,n,a])};ye().prototype.asin=function(){return this.throwIfDisposed(),AZe(this)};ye().prototype.asinh=function(){return this.throwIfDisposed(),DZe(this)};ye().prototype.atan=function(){return this.throwIfDisposed(),RZe(this)};ye().prototype.atan2=function(r){return this.throwIfDisposed(),PZe(this,r)};ye().prototype.atanh=function(){return this.throwIfDisposed(),BZe(this)};ye().prototype.avgPool=function(r,e,t,n){return this.throwIfDisposed(),y6(this,r,e,t,n)};ye().prototype.batchToSpaceND=function(r,e){return this.throwIfDisposed(),W2(this,r,e)};ye().prototype.batchNorm=function(r,e,t,n,a){return this.throwIfDisposed(),Wg(this,r,e,t,n,a)};ye().prototype.broadcastTo=function(r){return this.throwIfDisposed(),Ig(this,r)};ye().prototype.cast=function(r){return this.throwIfDisposed(),Ye(this,r)};ye().prototype.ceil=function(){return this.throwIfDisposed(),eJe(this)};ye().prototype.clipByValue=function(r,e){return this.throwIfDisposed(),rJe(this,r,e)};ye().prototype.concat=function(r,e){return this.throwIfDisposed(),r instanceof bn&&(r=[r]),Hn([this,...r],e)};ye().prototype.conv1d=function(r,e,t,n,a,i){return this.throwIfDisposed(),uJe(this,r,e,t,n,a,i)};ye().prototype.conv2dTranspose=function(r,e,t,n,a){return this.throwIfDisposed(),cJe(this,r,e,t,n,a)};ye().prototype.conv2d=function(r,e,t,n,a,i){return this.throwIfDisposed(),Rp(this,r,e,t,n,a,i)};ye().prototype.cos=function(){return this.throwIfDisposed(),q2(this)};ye().prototype.cosh=function(){return this.throwIfDisposed(),b6(this)};ye().prototype.cumprod=function(r,e,t){return this.throwIfDisposed(),m2(this,r,e,t)};ye().prototype.cumsum=function(r,e,t){return this.throwIfDisposed(),s6(this,r,e,t)};ye().prototype.depthToSpace=function(r,e){return this.throwIfDisposed(),yJe(this,r,e)};ye().prototype.depthwiseConv2d=function(r,e,t,n,a,i){return this.throwIfDisposed(),V2(this,r,e,t,n,a,i)};ye().prototype.dilation2d=function(r,e,t,n,a){return this.throwIfDisposed(),kJe(this,r,e,t,n,a)};ye().prototype.divNoNan=function(r){return this.throwIfDisposed(),NJe(this,r)};ye().prototype.div=function(r){return this.throwIfDisposed(),gt(this,r)};ye().prototype.dot=function(r){return this.throwIfDisposed(),TJe(this,r)};ye().prototype.elu=function(){return this.throwIfDisposed(),w6(this)};ye().prototype.equal=function(r){return this.throwIfDisposed(),L2(this,r)};ye().prototype.erf=function(){return this.throwIfDisposed(),_Je(this)};ye().prototype.euclideanNorm=function(r,e){return this.throwIfDisposed(),PJe(this,r,e)};ye().prototype.exp=function(){return this.throwIfDisposed(),Bi(this)};ye().prototype.expandDims=function(r){return this.throwIfDisposed(),Ts(this,r)};ye().prototype.expm1=function(){return this.throwIfDisposed(),LJe(this)};ye().prototype.fft=function(){return this.throwIfDisposed(),O6(this)};ye().prototype.flatten=function(){return this.throwIfDisposed(),fe(this,[this.size])};ye().prototype.floor=function(){return this.throwIfDisposed(),z2(this)};ye().prototype.floorDiv=function(r){return this.throwIfDisposed(),r6(this,r)};ye().prototype.gather=function(r,e){return this.throwIfDisposed(),k6(this,r,e)};ye().prototype.greaterEqual=function(r){return this.throwIfDisposed(),Fp(this,r)};ye().prototype.greater=function(r){return this.throwIfDisposed(),Mo(this,r)};ye().prototype.ifft=function(){return this.throwIfDisposed(),w2(this)};ye().prototype.irfft=function(){return this.throwIfDisposed(),Cet(this)};ye().prototype.isFinite=function(){return this.throwIfDisposed(),VJe(this)};ye().prototype.isInf=function(){return this.throwIfDisposed(),UJe(this)};ye().prototype.isNaN=function(){return this.throwIfDisposed(),KJe(this)};ye().prototype.leakyRelu=function(r){return this.throwIfDisposed(),S6(this,r)};ye().prototype.lessEqual=function(r){return this.throwIfDisposed(),jc(this,r)};ye().prototype.less=function(r){return this.throwIfDisposed(),p6(this,r)};ye().prototype.localResponseNormalization=function(r,e,t,n){return this.throwIfDisposed(),YJe(this,r,e,t,n)};ye().prototype.logSigmoid=function(){return this.throwIfDisposed(),tQe(this)};ye().prototype.logSoftmax=function(r){return this.throwIfDisposed(),nQe(this,r)};ye().prototype.logSumExp=function(r,e){return this.throwIfDisposed(),T6(this,r,e)};ye().prototype.log=function(){return this.throwIfDisposed(),qc(this)};ye().prototype.log1p=function(){return this.throwIfDisposed(),N6(this)};ye().prototype.logicalAnd=function(r){return this.throwIfDisposed(),Bc(this,r)};ye().prototype.logicalNot=function(){return this.throwIfDisposed(),G2(this)};ye().prototype.logicalOr=function(r){return this.throwIfDisposed(),I6(this,r)};ye().prototype.logicalXor=function(r){return this.throwIfDisposed(),uQe(this,r)};ye().prototype.matMul=function(r,e,t){return this.throwIfDisposed(),Rt(this,r,e,t)};ye().prototype.maxPool=function(r,e,t,n){return this.throwIfDisposed(),C6(this,r,e,t,n)};ye().prototype.max=function(r,e){return this.throwIfDisposed(),Pc(this,r,e)};ye().prototype.maximum=function(r){return this.throwIfDisposed(),U2(this,r)};ye().prototype.mean=function(r,e){return this.throwIfDisposed(),Mg(this,r,e)};ye().prototype.min=function(r,e){return this.throwIfDisposed(),g2(this,r,e)};ye().prototype.minimum=function(r){return this.throwIfDisposed(),A6(this,r)};ye().prototype.mirrorPad=function(r,e){return this.throwIfDisposed(),gQe(this,r,e)};ye().prototype.mod=function(r){return this.throwIfDisposed(),bQe(this,r)};ye().prototype.mul=function(r){return this.throwIfDisposed(),pe(this,r)};ye().prototype.neg=function(){return this.throwIfDisposed(),rn(this)};ye().prototype.norm=function(r,e,t){return this.throwIfDisposed(),Vg(this,r,e,t)};ye().prototype.notEqual=function(r){return this.throwIfDisposed(),_6(this,r)};ye().prototype.oneHot=function(r,e=1,t=0){return this.throwIfDisposed(),p2(this,r,e,t)};ye().prototype.onesLike=function(){return this.throwIfDisposed(),EQe(this)};ye().prototype.pad=function(r,e){return this.throwIfDisposed(),Xc(this,r,e)};ye().prototype.pool=function(r,e,t,n,a,i){return this.throwIfDisposed(),PQe(this,r,e,t,n,a,i)};ye().prototype.pow=function(r){return this.throwIfDisposed(),Ju(this,r)};ye().prototype.prelu=function(r){return this.throwIfDisposed(),D6(this,r)};ye().prototype.prod=function(r,e){return this.throwIfDisposed(),LQe(this,r,e)};ye().prototype.reciprocal=function(){return this.throwIfDisposed(),ret(this)};ye().prototype.relu=function(){return this.throwIfDisposed(),Gg(this)};ye().prototype.relu6=function(){return this.throwIfDisposed(),F6(this)};ye().prototype.reshapeAs=function(r){return this.throwIfDisposed(),fe(this,r.shape)};ye().prototype.reshape=function(r){return this.throwIfDisposed(),fe(this,r)};ye().prototype.resizeBilinear=function(r,e,t){return this.throwIfDisposed(),ptt(this,r,e,t)};ye().prototype.resizeNearestNeighbor=function(r,e,t){return this.throwIfDisposed(),vtt(this,r,e,t)};ye().prototype.reverse=function(r){return this.throwIfDisposed(),Cs(this,r)};ye().prototype.rfft=function(){return this.throwIfDisposed(),P6(this)};ye().prototype.round=function(){return this.throwIfDisposed(),R6(this)};ye().prototype.rsqrt=function(){return this.throwIfDisposed(),c6(this)};ye().prototype.selu=function(){return this.throwIfDisposed(),pet(this)};ye().prototype.separableConv2d=function(r,e,t,n,a,i){return this.throwIfDisposed(),vet(this,r,e,t,n,a,i)};ye().prototype.sigmoid=function(){return this.throwIfDisposed(),Yu(this)};ye().prototype.sign=function(){return this.throwIfDisposed(),get(this)};ye().prototype.sin=function(){return this.throwIfDisposed(),a6(this)};ye().prototype.sinh=function(){return this.throwIfDisposed(),i6(this)};ye().prototype.slice=function(r,e){return this.throwIfDisposed(),$t(this,r,e)};ye().prototype.softmax=function(r){return this.throwIfDisposed(),Net(this,r)};ye().prototype.softplus=function(){return this.throwIfDisposed(),E6(this)};ye().prototype.spaceToBatchND=function(r,e){return this.throwIfDisposed(),R2(this,r,e)};ye().prototype.split=function(r,e){return this.throwIfDisposed(),Lc(this,r,e)};ye().prototype.sqrt=function(){return this.throwIfDisposed(),xa(this)};ye().prototype.square=function(){return this.throwIfDisposed(),tr(this)};ye().prototype.squaredDifference=function(r){return this.throwIfDisposed(),M6(this,r)};ye().prototype.squeeze=function(r){return this.throwIfDisposed(),B6(this,r)};ye().prototype.stack=function(r,e){this.throwIfDisposed();let t=r instanceof bn?[this,r]:[this,...r];return Uc(t,e)};ye().prototype.step=function(r){return this.throwIfDisposed(),_p(this,r)};ye().prototype.stridedSlice=function(r,e,t,n,a,i,o,s){return this.throwIfDisposed(),Oet(this,r,e,t,n,a,i,o,s)};ye().prototype.sub=function(r){return this.throwIfDisposed(),ot(this,r)};ye().prototype.sum=function(r,e){return this.throwIfDisposed(),ct(this,r,e)};ye().prototype.tan=function(){return this.throwIfDisposed(),Met(this)};ye().prototype.tanh=function(){return this.throwIfDisposed(),v2(this)};ye().prototype.tile=function(r){return this.throwIfDisposed(),Oc(this,r)};ye().prototype.toBool=function(){return this.throwIfDisposed(),Ye(this,"bool")};ye().prototype.toFloat=function(){return this.throwIfDisposed(),Ye(this,"float32")};ye().prototype.toInt=function(){return this.throwIfDisposed(),Ye(this,"int32")};ye().prototype.topk=function(r,e){return this.throwIfDisposed(),Let(this,r,e)};ye().prototype.transpose=function(r){return this.throwIfDisposed(),io(this,r)};ye().prototype.unique=function(r){return this.throwIfDisposed(),Wet(this,r)};ye().prototype.unsortedSegmentSum=function(r,e){return this.throwIfDisposed(),f6(this,r,e)};ye().prototype.unstack=function(r){return this.throwIfDisposed(),zg(this,r)};ye().prototype.where=function(r,e){return this.throwIfDisposed(),Ba(r,this,e)};ye().prototype.zerosLike=function(){return this.throwIfDisposed(),Ot(this)};var Ert="3.21.0";var Trt={"tfjs-core":Zk.version_core,"tfjs-backend-cpu":f8e.version_cpu,"tfjs-backend-webgl":h8e.version_webgl,"tfjs-data":nG.version_data,"tfjs-layers":Jk.version_layers,"tfjs-converter":Qk.version_converter,tfjs:Ert};Object.keys(Zk).forEach(function(r){r!=="default"&&Object.defineProperty(nl,r,{enumerable:!0,get:function(){return Zk[r]}})});Object.keys(Jk).forEach(function(r){r!=="default"&&Object.defineProperty(nl,r,{enumerable:!0,get:function(){return Jk[r]}})});Object.keys(Qk).forEach(function(r){r!=="default"&&Object.defineProperty(nl,r,{enumerable:!0,get:function(){return Qk[r]}})});nl.data=nG;nl.version=Trt});var Ug=ue((Nst,W6)=>{var{add:Irt,isArray:Crt,isNumber:Art,pow:_rt,scale:z6,shape:Drt}=yf(),La=Mp(),Frt=(r,e)=>Irt(r,z6(e,-1)),Rrt=(r,e)=>z6(r,_rt(e,-1));function Ort(r){return Crt(r)&&Drt(r).length===2}function _s(r){return r instanceof La.Tensor}function Prt(r){return Art(r)&&parseInt(r)===r&&r>=0}function Mrt(r,e){return La.tidy(()=>(_s(r)||(r=La.tensor(r)),_s(e)||(e=La.tensor(e)),r.sub(e).pow(2).sum()))}function Brt(r,e){return La.tidy(()=>(_s(r)||(r=La.tensor(r)),_s(e)||(e=La.tensor(e)),r=r.expandDims(1),e=e.expandDims(0),r.sub(e).pow(2).sum(2)))}function $6(r){return La.tidy(()=>(_s(r)||(r=La.tensor(r)),r.div(r.abs())))}function Lrt(r,e){return La.tidy(()=>{_s(r)||(r=La.tensor(r)),_s(e)||(e=La.tensor(e));let t=r.sub(e).pow(2).sum(),n=r.sub(r.mean()).pow(2).sum(),a=La.scalar(1).sub(t.div(n));return $6(a).mul(a.abs().sqrt())})}W6.exports={subtract:Frt,divide:Rrt,isMatrix:Ort,isTFTensor:_s,isWholeNumber:Prt,missingAwareSquaredDistance:Mrt,outerSquaredDistances:Brt,sign:$6,rScore:Lrt}});var tS=ue((Est,V6)=>{var{assert:Ds,isUndefined:q6,normal:zrt,range:$rt}=yf(),{isMatrix:Hg,isWholeNumber:J2,outerSquaredDistances:Q2}=Ug(),al=Mp(),eS=class{constructor(e){Ds(typeof e=="object","`config` must be an object with properties `k`, `maxIterations` (optional), and `maxRestarts` (optional)!"),Ds(J2(e.k),"`k` must be a whole number!"),Ds(J2(e.maxIterations)||q6(e.maxIterations),"`maxIterations` must be a whole number or undefined!"),Ds(J2(e.maxRestarts)||q6(e.maxRestarts),"`maxRestarts` must be a whole number or undefined!");let t=this;t.k=e.k,t.maxIterations=e.maxIterations||300,t.centroids=null,t.maxRestarts=e.maxRestarts||10,t.tolerance=1e-4}initializeCentroids(e){Ds(Hg(e),"`x` must be a matrix!");let t=this;return al.tensor(zrt([t.k,e[0].length]))}fit(e){Ds(Hg(e),"`x` must be a matrix!");let t=this;return al.tidy(()=>{let n=al.tensor(e),a=1/0,i=null;return $rt(0,t.maxRestarts).forEach(()=>{let o=t.initializeCentroids(e),s=o.clone();for(let c=0;c<t.maxIterations;c++){let f=Q2(n,o).argMin(1).dataSync(),h=[];for(let d=0;d<t.k;d++){let m=[];if(f.forEach((v,g)=>{v===d&&m.push(g)}),m.length===0)return;h.push(n.gather(m).mean(0))}if(o=al.stack(h),s.sub(o).pow(2).sum().dataSync()[0]<t.tolerance)break;s=o.clone()}let u=Q2(n,o).argMin(1).dataSync(),l=o.gather(u).sub(n).pow(2).sum().dataSync()[0];l<a&&(a=l,i=o)}),t.centroids=i,i})}score(e){Ds(Hg(e),"`x` must be a matrix!");let t=this;return al.tidy(()=>{let n=t.predict(e),a=al.tensor(e);return t.centroids.gather(n).sub(a).pow(2).sum().dataSync()[0]})}predict(e){Ds(Hg(e),"`x` must be a matrix!");let t=this;return al.tidy(()=>Q2(e,t.centroids).argMin(1).dataSync())}destroy(){return this.centroids.dispose(),null}};V6.exports=eS});var aS=ue((Tst,U6)=>{var{assert:Wrt,int:G6,random:rS}=yf(),{isMatrix:qrt,outerSquaredDistances:Vrt}=Ug(),Grt=tS(),Bp=Mp(),nS=class extends Grt{initializeCentroids(e){Wrt(qrt(e),"`x` must be a matrix!");let t=this;return Bp.tidy(()=>{let n=Bp.tensor(e),a=[G6(rS()*e.length)];for(;a.length<t.k;){let i=a.map(c=>e[c]),o=Vrt(e,i).argMin(1).dataSync(),s=Bp.tidy(()=>Bp.tensor(i).gather(o).sub(n).pow(2).sum(1)),u=s.div(s.max()).dataSync(),l=0;for(let c=0;c<1e4;c++){l=G6(rS()*u.length);let f=u[l];if(rS()<f)break}a.push(l)}return Bp.tensor(a.map(i=>e[i]))})}};U6.exports=nS});var j6=ue((Ist,K6)=>{var{assert:zi,isArray:Urt,isBoolean:Hrt,isFunction:Krt,isUndefined:il,range:H6,shape:jrt,shuffle:Xrt}=yf(),{isMatrix:Yrt,isWholeNumber:iS}=Ug(),Zrt=aS(),Jrt=Mp(),oS=class{constructor(e){zi(typeof e=="object","`config` should be an object with properties `kValues`, `maxIterations` (optional), `numberOfFolds` (optional), and `shouldShuffle` (optional)!"),zi(Urt(e.kValues)||il(e.kValues),"`kValues` must be a list of k-values to test or undefined!"),zi(jrt(e.kValues).length===1,"`kValues` must be a 1-dimensional list of k-values to test!"),e.kValues.forEach(n=>{zi(typeof n=="number","`kValues` must be a 1-dimensional list of k-values (numbers) to test!")}),zi(iS(e.maxIterations)||il(e.maxIterations),"`maxIterations` must be a whole number or undefined!"),zi(iS(e.maxRestarts)||il(e.maxRestarts),"`maxRestarts` must be a whole number or undefined!"),zi(iS(e.numberOfFolds)||il(e.numberOfFolds),"`numberOfFolds` must be a whole number or undefined!"),zi(Hrt(e.shouldShuffle)||il(e.shouldShuffle),"`shouldShuffle` must be a boolean or undefined!"),zi(Krt(e.class)||il(e.class),"`class` should be a class, a function, or undefined!");let t=this;t.kValues=e.kValues||H6(1,16),t.maxIterations=e.maxIterations||300,t.maxRestarts=e.maxRestarts||10,t.numberOfFolds=e.numberOfFolds||4,t.shouldShuffle=!!e.shouldShuffle,t.class=e.class||Zrt,t.fittedModel=null}fit(e,t){zi(Yrt(e),"`x` must be a matrix!"),zi(il(t)||typeof t=="function","`callback` must be undefined or a function!");let n=this;n.shouldShuffle&&(e=Xrt(e));let a=!1,i=n.kValues[0],o=1/0,s=n.kValues[0],u=[];return n.kValues.forEach((l,c)=>{if(a)return;let f=0,h=[];for(let p=0;p<n.numberOfFolds;p++){if(t){let y=c/n.kValues.length+p/n.numberOfFolds*(1/n.kValues.length);t(y)}let d=H6(parseInt(e.length*p/n.numberOfFolds),parseInt(e.length*(p+1)/n.numberOfFolds)),m=e.filter((y,b)=>d.indexOf(b)<0),v=e.filter((y,b)=>d.indexOf(b)>-1),g=new n.class({k:l,...n});Jrt.tidy(()=>g.fit(m));try{let y=g.score(v);f+=y,h.push(y)}catch{f+=1e20,h.push(1e20)}}f>=.9*o&&(a=!0,s=i),o=f,i=l,u.push(h)}),n.fittedModel=new n.class({k:s,maxIterations:300,maxRestarts:50}),n.fittedModel.fit(e),u}get centroids(){return this.fittedModel.centroids}score(e,t){return this.fittedModel.score(e,t)}predict(e){return this.fittedModel.predict(e)}};K6.exports=oS});var Qrt=ue((Cst,X6)=>{X6.exports={TFKMeans:tS(),TFKMeansCV:j6(),TFKmeansPlusPlus:aS()}});Qrt();})();
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/** @license See the LICENSE file. */
