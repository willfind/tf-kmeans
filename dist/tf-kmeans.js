(()=>{var cte=Object.defineProperty;var lte=(r,e,t)=>e in r?cte(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var hd=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')});var O=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var o0=(r,e,t)=>(lte(r,typeof e!="symbol"?e+"":e,t),t);var yc=O(($St,sE)=>{var fte=new Function(`
  try {
    return this === window
  } catch(e) {}

  try {
    return typeof importScripts !== "undefined"
  } catch(e) {}

  return false
`),s0=class extends Error{constructor(e){fte()?super(e):super(`

\x1B[31m`+e+`
\x1B[0m`)}};sE.exports=s0});var $e=O((WSt,uE)=>{var hte=yc();uE.exports=function(r,e){if(!r)throw new hte(e)}});var St=O((USt,cE)=>{function pte(r){return r===null||typeof r>"u"}cE.exports=pte});var fE=O((VSt,lE)=>{lE.exports=[Array,ArrayBuffer,BigInt64Array,BigUint64Array,Float32Array,Float64Array,Int16Array,Int32Array,Int8Array,Uint16Array,Uint32Array,Uint8Array,Uint8ClampedArray]});var Ke=O((GSt,pE)=>{var dte=St(),hE=fE(),vte=hE.map(r=>r.name);function mte(r){try{return r instanceof Array?!0:dte(r.constructor)?!1:hE.indexOf(r.constructor)>-1||vte.indexOf(r.constructor.name)>-1}catch{return!1}}pE.exports=mte});var dt=O((HSt,dE)=>{function gte(r){try{return!!r._symbol&&r._symbol===Symbol.for("@jrc03c/js-math-tools/dataframe")}catch{return!1}}dE.exports=gte});var zn=O((jSt,vE)=>{function yte(r){return typeof r=="function"}vE.exports=yte});var at=O((KSt,mE)=>{function bte(r){return typeof r=="number"&&!isNaN(r)}mE.exports=bte});var Ho=O((XSt,gE)=>{var wte=Ke(),xte=St();function kte(r){return typeof r=="object"&&!xte(r)&&!wte(r)}gE.exports=kte});var ft=O((YSt,yE)=>{function Ste(r){try{return!!r._symbol&&r._symbol===Symbol.for("@jrc03c/js-math-tools/series")}catch{return!1}}yE.exports=Ste});var vf=O((JSt,xE)=>{var Nte=$e(),bE=Ke(),Tte=dt(),Ete=zn(),u0=at(),wE=Ho(),Ite=ft();function c0(r,e){if(Tte(r)){let i=c0(r.values,e);return i.length>0&&u0(i[0])&&i[0]>=0&&i[0]<r.index.length&&(i[0]=r.index[i[0]]),i.length>1&&u0(i[1])&&i[1]>=0&&i[1]<r.columns.length&&(i[1]=r.columns[i[1]]),i}if(Ite(r)){let i=c0(r.values,e);return i.length>0&&u0(i[0])&&i[0]>=0&&i[0]<r.index.length&&(i[0]=r.index[i[0]]),i}if(Nte(wE(r)||bE(r),"You must pass (1) an object, array, Series, or DataFrame and (2) a function or value into the `indexOf` function!"),!Ete(e)){let i=e;e=o=>o===i}function t(i,o,s){if(s=s||[],s.indexOf(i)>-1)return null;if(wE(i)){s.push(i);let u=Object.keys(i).concat(Object.getOwnPropertySymbols(i));for(let c=0;c<u.length;c++){let l=u[c],f=i[l];if(o(f))return[l];let h=t(f,o,s);if(h&&h.length>0)return[l].concat(h)}}else if(bE(i)){s.push(i);for(let u=0;u<i.length;u++){let c=i[u];if(o(c))return[u];let l=t(c,o,s);if(l&&l.length>0)return[u].concat(l)}}else if(o(i))return[];return null}function n(i){try{return e(i)}catch{return!1}}let a=t(r,n);return a&&a.length>0?a:null}xE.exports=c0});var vo=O((ZSt,TE)=>{var Cte=vf(),kE=Ke(),SE=dt(),NE=ft();function mf(r){function e(t){if(typeof t=="object"){if(t===null)return null;if(kE(t))return t instanceof Array?t.map(a=>mf(a)):t.slice();if(NE(t)){let a=t.copy();return a.values=mf(a.values),a}if(SE(t)){let a=t.copy();return a.values=mf(t.values),a}if(t instanceof Date)return new Date(t.getTime());t=l0(t);let n={};return Object.keys(t).concat(Object.getOwnPropertySymbols(t)).forEach(a=>{n[a]=mf(t[a])}),n}else return t}return e(l0(r))}function l0(r){function e(a,i,o){if(i=i||[],o=o||"",i.indexOf(a)>-1){let s=o.split("/").slice(o.startsWith("/")?1:0);if(s.some((c,l)=>{let f=s.slice(0,s.length-l-1),h=t;return f.forEach(p=>{h=h[p]}),h===a}))return`<reference to "${t===a?"/":"/"+Cte(t,a).join("/")}">`}return typeof a=="object"?a===null?null:(i.push(a),kE(a)?typeof a.constructor<"u"&&a.constructor.name!=="Array"?a.slice():a.map((s,u)=>e(s,i,o+"/"+u)):(Object.keys(a).concat(Object.getOwnPropertySymbols(a)).forEach(s=>{a[s]=e(a[s],i,o+"/"+s.toString())}),a)):a}let t=r,n=e(t);if(SE(r)){let a=r.copy();a._values=n.values,a._columns=n.columns,a._index=n.index,n=a}if(NE(r)){let a=r.copy();a.name=n.name,a._values=n.values,a._index=n.index,n=a}return n}TE.exports={copy:mf,decycle:l0}});var Er=O((QSt,CE)=>{var Ate=$e(),EE=Ke(),Dte=dt(),_te=ft();function IE(r){if(Dte(r)||_te(r))return IE(r.values);Ate(EE(r),"The `flatten` function only works on arrays, Series, and DataFrames!");function e(t){let n=[];return t.forEach(a=>{EE(a)?n=n.concat(e(a)):n.push(a)}),n}return e(r)}CE.exports=IE});var gf=O((eNt,AE)=>{function Fte(r){return r instanceof Date&&r.toString()!=="Invalid Date"}AE.exports=Fte});var ki=O((tNt,FE)=>{var{decycle:DE}=vo(),_E=Ke(),f0=gf();function Rte(r,e){function t(n,a){let i=typeof n;if(i!==typeof a)return!1;if(i==="undefined")return!0;if(i==="boolean"||i==="symbol")return n===a;if(i==="number"||i==="bigint")return n.toString()==="NaN"&&a.toString()==="NaN"?!0:n===a;if(i==="string"||i==="function")return n===a;if(i==="object"){if(n===null||a===null)return n===null&&a===null;{if(f0(n))return f0(a)?n.getTime()===a.getTime():!1;if(f0(a))return!1;if(n instanceof RegExp&&a instanceof RegExp)return n.toString()===a.toString();if(_E(n)!==_E(a))return!1;let s=Object.keys(n).concat(Object.getOwnPropertySymbols(n)),u=Object.keys(a).concat(Object.getOwnPropertySymbols(a));if(s.length!==u.length)return!1;for(let c=0;c<s.length;c++){let l=s[c];if(!t(n[l],a[l]))return!1}return!0}}}try{return t(r,e)}catch{return t(DE(r),DE(e))}}FE.exports=Rte});var Va=O((rNt,ME)=>{var Ote=$e(),Pte=Er(),Mte=Ke(),RE=dt(),Bte=zn(),OE=ft(),Lte=St();function yf(r){let e="abcdefg1234567890",t="";for(;t.length<r;)t+=e[parseInt(Math.random()*e.length)];return t}var qte=yf(256),zte=yf(256),$te=yf(256),Wte=yf(256),Ute=yf(256);function PE(r){if(RE(r)||OE(r))return PE(r.values);Ote(Mte(r),"The `set` function only works on arrays, Series, and DataFrames!");let e=[],t={};return Pte(r).forEach(n=>{let a=typeof n=="object"&&n===null?qte:Lte(n)?zte:Bte(n)?n.toString():typeof n=="symbol"?n.toString()+" - "+Ute:n===1/0?$te:n===-1/0?Wte:RE(n)?n.toJSONString():OE(n)?JSON.stringify(n.toObject()):JSON.stringify(n);t[a]||e.push(n),t[a]=!0}),e}ME.exports=PE});var bf=O((nNt,qE)=>{var Vte=$e(),h0=Er(),BE=Ke(),Gte=dt(),LE=ki(),Hte=zn(),jte=ft(),Kte=Va();function pd(r,e){if(Gte(r)||jte(r))return arguments.length>1?pd(r.values,e):pd(r.values,r.values);if(Vte(BE(r),"The first argument to the `count` function must be an array, Series, or DataFrame!"),Hte(e))return h0(r).filter(t=>e(t)).length;if(BE(e)){let t=h0(r);return Kte(e).map(n=>({value:n,count:t.filter(a=>LE(a,n)).length}))}else return arguments.length>1?h0(r).filter(t=>LE(t,e)).length:pd(r,r)}qE.exports=pd});var wf=O((aNt,$E)=>{var Xte=$e(),zE=Ke(),Yte=dt(),Jte=ft();function p0(r){if(Yte(r)||Jte(r))return p0(r.values);Xte(zE(r),"The `isJagged` function only works on arrays, Series, and DataFrames!");let e=0,t=null;for(let n=0;n<r.length;n++)if(zE(r[n])){if(e++,p0(r[n]))return!0;if(t===null)t=r[n].length;else if(r[n].length!==t)return!0}return e>0&&e<r.length}$E.exports=p0});var dd=O((iNt,VE)=>{var Zte=$e(),WE=Ke(),Qte=dt(),ere=ft();function UE(r){if(Qte(r)||ere(r))return UE(r.values);Zte(WE(r),"The `isNested` function only works on arrays, Series, and DataFrames!");for(let e=0;e<r.length;e++)if(WE(r[e]))return!0;return!1}VE.exports=UE});var jo=O((oNt,HE)=>{var Js=$e(),tre=Ke(),rre=dd(),nre=at(),are=St(),bc="You must pass a natural number or a one-dimensional array of natural numbers into the `ndarray` function!";function GE(r){Js(!are(r),bc),tre(r)||(r=[r]),Js(!rre(r),bc),Js(r.length>0,bc);let e=r[0];if(Js(nre(e),bc),Js(parseInt(e)===e,bc),Js(e>=0,bc),Js(e!==1/0,"We can't create an array containing an infinite number of values!"),r.length===1){let t=[];for(let n=0;n<e;n++)t.push(void 0);return t}else{let t=[];for(let n=0;n<e;n++)t.push(GE(r.slice(1)));return t}}HE.exports=GE});var xf=O((sNt,jE)=>{var ire=$e(),ore=Ke(),sre=dt(),ure=ft();function d0(r){if(sre(r)||ure(r)){let t=r.copy();return t.values=d0(t.values),t.index=d0(t.index),t}ire(ore(r),"The `reverse` function only works on arrays, Series, and DataFrames!");let e=[];for(let t=r.length-1;t>=0;t--)e.push(r[t]);return e}jE.exports=d0});var Ca=O((uNt,KE)=>{var v0=$e(),m0=at(),g0=St(),cre=xf();function lre(r,e,t=1){v0(!g0(r)&&!g0(e)&&!g0(t),"You must pass two numbers and optionally a step value to the `range` function!"),v0(m0(r)&&m0(e)&&m0(t),"You must pass two numbers and optionally a step value to the `range` function!"),v0(t>0,"The step value must be greater than 0! (NOTE: The step value is a magnitude; it does not indicate direction.)");let n=!1;if(r>e){n=!0;let i=r;r=e+t,e=i+t}let a=[];for(let i=r;i<e;i+=t)a.push(i);return n&&(a=cre(a)),a}KE.exports=lre});var dr=O((cNt,ZE)=>{var fre=$e(),XE=Ke(),hre=dt(),pre=ki(),dre=ft(),vre=St();function YE(r){if(!XE(r))return;let e=[r.length],t=0,n=r.map(a=>{let i=YE(a);return vre(i)?i:(t++,i.length===1?i[0]:i)});return t>0?t===r.length&&n.slice(0,-1).every((i,o)=>pre(i,n[o+1]))?e.concat(n[0]):(e.push(n),e):e}function JE(r){return hre(r)||dre(r)?JE(r.values):(fre(XE(r),"The `shape` function only works on arrays, Series, and DataFrames!"),YE(r))}ZE.exports=JE});var aI=O((lNt,nI)=>{var QE=$e(),mre=Ke(),gre=dt(),yre=wf(),bre=ft(),wre=St(),eI=yc(),vd=jo(),tI=Ca(),xre=Va(),kre=dr();function rI(r,e,t){if(wre(t)&&(t=0),QE(t===0||t===1||t==="vertical"||t==="horizontal",'The only valid axis values for use when appending data to a DataFrame are 0, 1, "vertical", and "horizontal". Note that 0 == "horizontal" and 1 == "vertical".'),mre(e)){QE(!yre(e),"The array of data you're trying to append to this DataFrame is jagged!");let n=kre(e);if(n.length===1)if(t===0){let a=r.copy();a._values.push(e);let i=Math.max(r.shape[1],n[0]);for(a._values.forEach(o=>{for(;o.length<i;)o.push(void 0)});a._index.length<a._values.length;)a._index.push("row"+a._index.length);for(;a._columns.length<i;)a._columns.push("col"+a._columns.length);return a}else{let a=Math.max(r.shape[0],n[0]),i=r.copy();for(tI(0,a).forEach(o=>{o>=i._values.length&&i._values.push(vd(r.shape[1])),i._values[o].push(e[o])});i._index.length<i._values.length;)i._index.push("row"+i._index.length);for(;i._columns.length<i._values[0].length;)i._columns.push("col"+i._columns.length);return i}else if(n.length===2)if(t===0){let a=Math.max(...e.map(o=>o.length).concat([r.shape[1]])),i=r.copy();for(i._values=i._values.concat(e).map(o=>{for(;o.length<a;)o.push(void 0);return o});i._index.length<i._values.length;)i._index.push("row"+i._index.length);for(;i._columns.length<a;)i._columns.push("col"+i._columns.length);return i}else{let a=Math.max(...e.map(s=>s.length))+r.shape[1],i=Math.max(r.shape[0],n[0]),o=r.copy();for(tI(0,i).forEach(s=>{for(s>=o._values.length&&o._values.push(vd(r.shape[1])),o._values[s]=o._values[s].concat(e[s]);o._values[s].length<a;)o._values[s].push(void 0)});o._index.length<o._values.length;)o._index.push("row"+o._index.length);for(;o._columns.length<a;)o._columns.push("col"+o._columns.length);return o}else throw new eI("Only 1- and 2-dimensional arrays can be appended to a DataFrame!")}else if(bre(e)){let n=rI(r,e.values,t);return t===0?n.index[n.index.length-1]=n.index.indexOf(e.name)>-1?e.name+" (2)":e.name:n.columns[n.columns.length-1]=n.columns.indexOf(e.name)>-1?e.name+" (2)":e.name,n}else if(gre(e))if(t===0){let n=r.copy(),a=xre(n._columns.concat(e._columns)).length;for(n._values.forEach(i=>{for(;i.length<a;)i.push(void 0)}),e.apply(i=>{let o=i.copy(),s=[];n._columns.forEach(u=>{let c=o._index.indexOf(u);c>-1?(s.push(o._values[c]),o._values.splice(c,1),o._index.splice(c,1)):s.push(void 0)}),n._values.push(s.concat(o._values))},1),n._columns=n._columns.concat(e._columns.filter(i=>n._columns.indexOf(i)<0));n._index.length<n._values.length;){let i="row"+n._index.length;n._index.push(i+(r._index.indexOf(i)>-1?" (2)":""))}return n}else{let n=r.copy();return n._index.forEach((a,i)=>{let o=e._index.indexOf(a);o>-1?n._values[i]=n._values[i].concat(e._values[o]):n._values[i]=n._values[i].concat(vd(e.shape[1]))}),e._index.forEach((a,i)=>{n._index.indexOf(a)<0&&(n._index.push(a),n._values.push(vd(n._columns.length).concat(e._values[i])))}),n._columns=n._columns.concat(e._columns.map(a=>a+(n._columns.indexOf(a)>-1?" (2)":""))),n}else throw new eI("Only 1- or 2-dimensional arrays, Series, and DataFrames can be appended to a DataFrame!")}nI.exports=rI});var cI=O((fNt,uI)=>{var iI=$e(),oI=Ke(),Sre=zn(),sI=St();function Nre(r,e,t,n,a){if(a=a||0,iI(Sre(n),"The first parameter to the `apply` method must be a function."),iI(a===0||a===1,"The second parameter to the `apply` method (the `axis`) must be 0 or 1."),a===0){let i={},o;if(t.columns.forEach((s,u)=>{let c=new e(t.values.map(f=>f[u]));c.name=s,c.index=t.index;let l=n(c,u,t);l instanceof e?i[s]=l.values:i[s]=l,sI(o)&&(o=l instanceof e||oI(l))}),o){let s=new r(i);return s.index=t.index,s}else{let s=new e(t.columns.map(u=>i[u]));return s.index=t.columns,s}}else if(a===1){let i,o=t.values.map((s,u)=>{let c=new e(s);c.name=t.index[u],c.index=t.columns;let l=n(c,u,t);return sI(i)&&(i=l instanceof e||oI(l)),l instanceof e?l.values:l});if(i){let s=new r(o);return s.index=t.index,s.columns=t.columns,s}else{let s=new e(o);return s.index=t.index,s}}}uI.exports=Nre});var ta=O((hNt,lI)=>{function Tre(r){return typeof r=="string"}lI.exports=Tre});var pI=O((pNt,hI)=>{var fI=$e(),Ere=Ke(),Ire=wf(),Cre=Ho(),Are=ta(),Dre=St(),_re=yc(),Fre=dr();function Rre(r,e,t,n,a){let i=s=>s instanceof r,o=s=>s instanceof e;if(Dre(a)){if(i(n))return t.append(n,1);if(o(n))return t.append(n,1);if(Cre(n)){let s=Math.max(...Object.keys(n).concat(Object.getOwnPropertySymbols(n)).map(u=>n[u].length));return Object.keys(n).concat(Object.getOwnPropertySymbols(n)).forEach(u=>{for(;n[u].length<s;)n[u].push(void 0)}),t.append(new r(n),1)}else throw new _re("You must pass a DataFrame, Series, or object into the `assign` method!")}else{fI(Are(n),"If passing two arguments into the `assign` method, then the first argument must be a string name!"),fI(Ere(a)&&!Ire(a)&&Fre(a).length===1,"If passing two arguments into the `assign` method, then the second argument must be a 1-dimensional array!");let s=t.append(a,1);return s.columns[s.columns.length-1]=n,s}}hI.exports=Rre});var vI=O((dNt,dI)=>{var{copy:Ore}=vo();function Pre(r,e){if(e.isEmpty)return new r;let t=new r(Ore(e.values));return t.columns=e.columns.slice(),t.index=e.index.slice(),t}dI.exports=Pre});var kI=O((vNt,xI)=>{var md=$e(),mI=Ke(),gI=at(),yI=ta(),bI=St(),wI=dr();function Mre(r,e,t,n,a){bI(n)&&(n=[]),bI(a)&&(a=[]),(yI(n)||gI(n))&&(n=[n]),(yI(a)||gI(a))&&(a=[a]),md(mI(n),"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings."),md(mI(a),"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings."),md(wI(n).length===1,"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings."),md(wI(a).length===1,"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings.");let i,o;t.index.forEach((u,c)=>{n.indexOf(u)<0&&n.indexOf(c)<0&&(i||(i=[]),i.push(u))}),t.columns.forEach((u,c)=>{a.indexOf(u)<0&&a.indexOf(c)<0&&(o||(o=[]),o.push(u))});let s=t.get(i,o);if(s instanceof e){let u=new r;u=u.assign(s),t.index.indexOf(s.name)>-1&&(u=u.transpose()),s=u}return s}xI.exports=Mre});var kf=O((mNt,SI)=>{var Bre=at();function Lre(r){return Bre(r)&&parseInt(r)===r}function qre(r){return Lre(r)&&r>=0}SI.exports=qre});var TI=O((gNt,NI)=>{var y0=$e(),zre=ta(),gd=St(),$re=kf(),Wre=dr();function Ure(r,e,t,n,a,i){n=n||0,y0(n===0||n===1,"The first parameter of the `dropMissing` method (the `axis`) must be 0 or 1."),i=i||0,y0($re(i),"The third parameter of the `dropMissing` method (the `threshold`) should be a whole number (meaning that data should be dropped if it contains more than `threshold` null values)."),a=i>0?"none":a||"any",y0(a==="any"||a==="all"||a==="none","The second parameter of the `dropMissing` method (the `condition` parameter, which indicates the condition under which data should be dropped) should be 'any' or 'all' (meaning that if 'any' of the data contains null values, then it should be dropped; or that if 'all' of the data contains null values, then it should be dropped).");function o(c){if(i>0){let l=0;for(let f=0;f<c.length;f++){let h=c[f];if(gd(h)&&l++,l>=i)return[]}}else if(a==="any")for(let l=0;l<c.length;l++){let f=c[l];if(gd(f))return[]}else if(a==="all"){for(let l=0;l<c.length;l++){let f=c[l];if(!gd(f))return c}return[]}return c}let s=t.copy(),u=Math.random().toString();if(n===0){s=s.assign(u,s.index);let c=s.values.map(o).filter(f=>f.length>0);if(Wre(c).length<2)return new r;s.values=c;let l=s.get(null,u);if(gd(l))return new r;zre(l)&&(l=[l]),l instanceof e&&(l=l.values),s.index=l,s=s.drop(null,u)}else if(n===1){let c={};if(s.columns.forEach((f,h)=>{let p=s.values.map(m=>m[h]),d=o(p);d.length>0&&(c[f]=d)}),Object.keys(c).length+Object.getOwnPropertySymbols(c).length===0)return new r;let l=new r(c);return l.index=s.index,l}return s}NI.exports=Ure});var b0=O((yNt,II)=>{var Vre=$e(),Gre=Ke(),Hre=dt(),jre=at(),Kre=ft();function EI(r){if(Hre(r)||Kre(r))return r.dropNaN(...Object.values(arguments).slice(1));Vre(Gre(r),"The `dropNaN` function only works on arrays, Series, and DataFrames!");let e=[];return r.forEach(t=>{try{return e.push(EI(t))}catch{if(jre(t))return e.push(t)}}),e}II.exports=EI});var AI=O((bNt,CI)=>{var w0=$e(),Xre=b0(),Yre=kf();function Jre(r,e,t,n,a){t=t||0,w0(t===0||t===1,"The first parameter of the `dropNaN` method (the `axis`) must be 0 or 1."),a=a||0,w0(Yre(a),"The third parameter of the `dropNaN` method (the `threshold`) should be a whole number (meaning that data should be dropped if it contains more than `threshold` NaN values)."),n=a>0?"none":n||"any",w0(n==="any"||n==="all"||n==="none","The second parameter of the `dropNaN` method (the `condition` parameter, which indicates the condition under which data should be dropped) should be 'any' or 'all' (meaning that if 'any' of the data contains NaN values, then it should be dropped; or that if 'all' of the data contains NaN values, then it should be dropped).");function i(s){let u=Xre(s);return a>0?s.length-u.length<a:n==="any"?u.length===s.length:n==="all"?u.length>0:!0}let o=e.copy();if(t===0){let s=o.index.filter(u=>{let c=o.get(u,null).values;return i(c)});return s.length>0?o.get(s,null):new r}else if(t===1){let s=o.columns.filter(u=>{let c=o.get(null,u).values;return i(c)});return s.length>0?o.get(null,s):new r}return o}CI.exports=Jre});var RI=O((wNt,FI)=>{var DI=$e(),Sf=Er(),Zre=zn(),Qre=St();function _I(r){let e={};return Sf(r).forEach((t,n)=>{e[t]=n}),e}function wc(r){return Object.keys(r).concat(Object.getOwnPropertySymbols(r)).sort((e,t)=>r[e]-r[t])}function ene(r,e,t,n,a){DI(Zre(n),"The `filter` method takes a single parameter: a function that is used to filter the values."),Qre(a)&&(a=0),DI(a===0||a===1,"The `axis` parameter to the `filter` method must be 0 or 1.");let i=t.copy();if(i.isEmpty)return i;let o=_I(i.index),s=_I(i.columns);if(a===0){let u=i.values.filter((c,l)=>{let f=new e(c);f.name=t.index[l],f.index=t.columns;let h=n(f,l,t);return h||delete o[i.index[l]],h});if(Sf(u).length===0)return new r;if(u.length===1){let c=new e(Sf(u));return c.name=wc(o)[0],c.index=wc(s),c}i.values=u,i.index=wc(o)}else if(a===1){i=i.transpose();let u=i.values.filter((c,l)=>{let f=new e(c);f.name=t.columns[l],f.index=t.index;let h=n(f,l,t);return h||delete s[i.index[l]],h});if(Sf(u).length===0)return new r;if(u.length===1){let c=new e(Sf(u));return c.name=wc(s)[0],c.index=wc(o),c}i.values=u,i.index=wc(s),i=i.transpose()}return i}FI.exports=ene});var MI=O((xNt,PI)=>{var Ga=$e(),yd=at(),bd=ta(),OI=St(),tne=Va();function rne(r,e,t){(bd(e)||yd(e))&&(e=[e]),(bd(t)||yd(t))&&(t=[t]);let n=tne((e||[]).concat(t||[]).map(a=>typeof a));return Ga(n.length<=2,"Only whole numbers and/or strings are allowed in `get` arrays!"),n.length===1&&Ga(n[0]==="string"||n[0]==="number","Only whole numbers and/or strings are allowed in `get` arrays!"),n.length===2&&(Ga(n.indexOf("string")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!"),Ga(n.indexOf("number")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!")),OI(e)||(e=e.map(a=>{if(bd(a))return Ga(r.index.indexOf(a)>-1,`Row "${a}" does not exist!`),a;if(yd(a))return Ga(a>=0,`Index ${a} is out of bounds!`),Ga(parseInt(a)===a,"Row numbers must be integers!"),Ga(a<r.index.length,`Index ${a} is out of bounds!`),r.index[a]})),OI(t)||(t=t.map(a=>{if(bd(a))return Ga(r.columns.indexOf(a)>-1,`Column "${a}" does not exist!`),a;if(yd(a))return Ga(a>=0,`Column ${a} is out of bounds!`),Ga(parseInt(a)===a,"Column numbers must be integers!"),Ga(a<r.columns.length,`Column ${a} is out of bounds!`),r.columns[a]})),r.getSubsetByNames(e,t)}PI.exports=rne});var Ko=O((kNt,LI)=>{var BI=$e(),nne=Ke(),ane=dt(),ine=zn(),one=ft(),sne=St();function une(r,e){try{return r<e?-1:r>e?1:0}catch{return r=typeof r=="object"&&r!==null?JSON.stringify(r):r.toString(),e=typeof e=="object"&&e!==null?JSON.stringify(e):e.toString(),r<e?-1:r>e?1:0}}function cne(r,e){if(sne(e)&&(e=une),ane(r)||one(r))return r.sort(...Object.values(arguments).slice(1));BI(nne(r),"The `sort` function only works on arrays, Series, and DataFrames!"),BI(ine(e),"The second parameter of the `sort` function must be a comparison function!");let t=r.slice();return t.sort(e),t}LI.exports=cne});var WI=O((SNt,$I)=>{var qI=$e(),zI=ta(),lne=St(),fne=Va(),hne=Ko();function pne(r){let e=r.toLowerCase(),t="";for(let a=0;a<e.length;a++){let i=e[a];i.match(/[a-z0-9]/g)?t+=i:t+=" "}let n=t.split(" ").filter(a=>a.length>0);return n[0]+n.slice(1).map(a=>a[0].toUpperCase()+a.substring(1)).join("")}function dne(r,e,t){lne(t)?t=e.columns:zI(t)&&(t=[t]);let n={};t.forEach(i=>{qI(zI(i),"You must pass either a string or a one-dimensional array of strings into the `getDummies` (AKA `oneHotEncode`) method!");let o=e.columns.indexOf(i);qI(o>-1,`The given DataFrame does not have a column called "${i}"!`);let s=e.values.map(c=>c[o]),u=hne(fne(s));s.forEach(c=>{u.forEach(l=>{let f=i+"_"+pne(l.toString());n[f]||(n[f]=[]),c===l?n[f].push(1):n[f].push(0)})})});let a=new r(n);return a.index=e.index,a}$I.exports=dne});var YI=O((NNt,XI)=>{var Xo=$e(),UI=Ke(),VI=at(),GI=St(),HI=kf(),jI=Ca(),KI=dr();function vne(r,e,t){let n=r.shape;GI(e)&&(e=jI(0,n[0])),GI(t)&&(t=jI(0,n[1])),VI(e)&&(e=[e]),VI(t)&&(t=[t]),Xo(UI(e)&&UI(t),"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),Xo(KI(e).length===1&&KI(t).length===1,"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),Xo(e.length>0,"The `rowIndices` array must contain at least one index."),Xo(t.length>0,"The `colIndices` array must contain at least one index."),e.forEach(o=>{Xo(HI(o),"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),Xo(o<r.index.length,`The row index ${o} is out of bounds.`)}),t.forEach(o=>{Xo(HI(o),"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),Xo(o<r.columns.length,`The column index ${o} is out of bounds.`)});let a=e.map(o=>r.index[o]),i=t.map(o=>r.columns[o]);return r.getSubsetByNames(a,i)}XI.exports=vne});var tC=O((TNt,eC)=>{var Yo=$e(),x0=Er(),JI=Ke(),wd=ta(),ZI=St(),QI=dr();function mne(r,e,t,n,a){ZI(n)&&(n=t.index),ZI(a)&&(a=t.columns),wd(n)&&(n=[n]),wd(a)&&(a=[a]),Yo(JI(n)&&JI(a),"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),Yo(QI(n).length===1&&QI(a).length===1,"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),Yo(n.length>0,"The `rows` array must contain at least one row name."),Yo(a.length>0,"The `cols` array must contain at least one column name."),n.forEach(s=>{Yo(wd(s),"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),Yo(t.index.indexOf(s)>-1,`The row name "${s}" does not exist in the list of rows.`)}),a.forEach(s=>{Yo(wd(s),"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),Yo(t.columns.indexOf(s)>-1,`The column name "${s}" does not exist in the list of columns.`)});let i=n.map(s=>a.map(u=>t.values[t.index.indexOf(s)][t.columns.indexOf(u)]));if(n.length===1&&a.length===1)return x0(i)[0];if(n.length===1){let s=new e(x0(i));return s.name=n[0],s.index=a,s}if(a.length===1){let s=new e(x0(i));return s.name=a[0],s.index=n,s}let o=new r(i);return o.columns=a,o.index=n,o}eC.exports=mne});var nC=O((ENt,rC)=>{var gne=ta(),Nf=Ca();function yne(r,e,t){function n(h,p){return gne(h)&&h.length>p?h.substring(0,p-3)+"...":h}if(t.isEmpty)return console.table({}),console.log("Shape:",[0,0],`
`),t;let a=typeof window>"u"?20:10,i=parseInt(a/2),o=typeof process>"u"?10:Math.floor(process.stdout.columns/24)-1,s=parseInt(o/2),u=a>t.index.length?null:Nf(0,i).concat(Nf(t.index.length-i,t.index.length)),c=o>t.columns.length?null:Nf(0,s).concat(Nf(t.columns.length-s,t.columns.length)),l=t.get(u,c);l instanceof e&&(t.shape[0]===1?(l=new r([l.values]),l.index=t.index,l.columns=new e(t.columns).get(c).values):t.shape[1]===1&&(l=new r([l.values]).transpose(),l.index=new e(t.index).get(u).values,l.columns=t.columns)),a<=t.index.length&&(l._index.splice(i,0,"..."),l._values.splice(i,0,Nf(0,l.columns.length).map(()=>"..."))),o<=t.columns.length&&(l._columns.splice(s,0,"..."),l._values=l._values.map(h=>(h.splice(s,0,"..."),h)));let f=28;return l instanceof e?(l.values=l.values.map(h=>n(h,f)),l.name=n(l.name,f),l.index=l.index.map(h=>n(h,f))):(l.values=l.values.map(h=>h.map(p=>n(p,f))),l.columns=l.columns.map(h=>n(h,f)),l.index=l.index.map(h=>n(h,f))),console.table(l.toDetailedObject()),console.log("Shape:",t.shape,`
`),t}rC.exports=yne});var xd=O((INt,aC)=>{var bne=$e(),wne=at();function xne(r,e){bne(wne(r),"The `leftPad` function only works on numbers!");let t=r.toString();for(;t.length<e;)t="0"+t;return t}aC.exports=xne});var oC=O((CNt,iC)=>{var kne=xd(),Sne=Ca();function Nne(r,e){let t=e?r:r.copy();return t.index=Sne(0,r.shape[0]).map(n=>"row"+kne(n,(t.index.length-1).toString().length)),t}iC.exports=Nne});var Tf=O((ANt,uC)=>{var Tne=$e(),Ene=Er(),Ine=Ke(),Cne=dt(),Ane=ft();function sC(r){if(Cne(r)||Ane(r))return sC(r.values);Tne(Ine(r),"The `product` function only works on arrays, Series, and DataFrames!");try{return r.length===0?NaN:Ene(r).reduce((e,t)=>e*t,1)}catch{return NaN}}uC.exports=sC});var kd=O((DNt,hC)=>{var Ef=$e(),cC=Er(),lC=Ke(),Dne=dt(),fC=at(),_ne=ft(),Fne=Tf(),Rne=dr();function k0(r,e){if(Dne(r)||_ne(r))return k0(r.values,e);if(Ef(lC(r),"The first argument passed into the `reshape` function must be an array!"),fC(e)&&(e=[e]),Ef(lC(e),"The second argument passed into the `reshape` function must be a whole number or a one-dimensional array of whole numbers!"),Ef(Rne(e).length===1,"The first argument passed into the `reshape` function must be a whole number or a one-dimensional array of whole numbers!"),e.forEach(i=>{Ef(fC(i)&&parseInt(i)===i&&i>0,"The first argument passed into the `reshape` function must be a whole number or a one-dimensional array of whole numbers!")}),e.length===0)return cC(r);let t=cC(r);if(e.length===1&&e[0]===t.length)return t;Ef(Fne(e)===t.length,"The new shape doesn't match the number of values available in `x` (the first argument passed into the `reshape` function)!");let n=[],a=parseInt(t.length/e[0]);for(let i=0;i<e[0];i++){let o=t.slice(i*a,(i+1)*a);n.push(k0(o,e.slice(1)))}return n}hC.exports=k0});var xc=O((_Nt,bC)=>{var{copy:vC}=vo(),One=$e(),Pne=Ke(),Mne=at(),mC=St(),Bne=jo(),Lne=Tf(),qne=kd(),gC=Math.pow(2,64),vr=[];yC(parseInt(Math.random()*gC));function zne(r,e){r=Dn(r);function t(){r+=Dn("0x9e3779b97f4a7c15");let a=vC(r);return a=(a^a>>BigInt(30))*Dn("0xbf58476d1ce4e5b9"),a=(a^a>>BigInt(27))*Dn("0x94d049bb133111eb"),a^a>>BigInt(31)}let n=[];for(let a=0;a<e;a++)n.push(t());return n}function Dn(r){return BigInt.asUintN(64,BigInt(r))}function pC(r,e){return r=Dn(r),e=BigInt(e),Dn(Dn(r<<e)|Dn(r>>Dn(BigInt(64)-e)))}function yC(r){if(mC(r))return vC(vr);{One(Mne(r),"If passing a value into the `seed` function, then that value must be an integer!");let e=zne(parseInt(r),4);vr[0]=e[0],vr[1]=e[1],vr[2]=e[2],vr[3]=e[3]}}function dC(){let r=Dn(pC(vr[0]+vr[3],23)+vr[0]),e=Dn(vr[1]<<BigInt(17));return vr[2]=Dn(vr[2]^vr[0]),vr[3]=Dn(vr[3]^vr[1]),vr[1]=Dn(vr[1]^vr[2]),vr[0]=Dn(vr[0]^vr[3]),vr[2]=Dn(vr[2]^e),vr[3]=pC(vr[3],45),parseInt(r)/gC}function $ne(r){return mC(r)?dC():(Pne(r)||(r=[r]),qne(Bne(Lne(r)).map(dC),r))}bC.exports={random:$ne,seed:yC}});var Sd=O((FNt,wC)=>{var{random:Wne}=xc(),Une=$e(),Vne=Ke(),Gne=dt(),Hne=ft();function jne(r){if(Gne(r)||Hne(r))return r.shuffle(...Object.values(arguments).slice(1));Une(Vne(r),"The `shuffle` function only works on arrays, Series, and DataFrames!");let e=[],t=r.slice();for(let n=0;n<r.length;n++){let a=parseInt(Wne()*t.length);e.push(t.splice(a,1)[0])}return e}wC.exports=jne});var SC=O((RNt,kC)=>{var Kne=$e(),Xne=St(),xC=Sd();function Yne(r,e){return Xne(e)&&(e=0),Kne(e===0||e===1,"The `axis` parameter to the `shuffle` must be 0, 1, or undefined."),r.get(e===0?xC(r.index):null,e===1?xC(r.columns):null)}kC.exports=Yne});var Nd=O((ONt,NC)=>{function Jne(r){return typeof r=="boolean"}NC.exports=Jne});var AC=O((PNt,CC)=>{var{random:Zne}=xc(),ra=$e(),Qne=Er(),TC=Ke(),S0=Nd(),IC=zn(),Td=at(),kc=ta(),N0=St(),eae=Ca(),EC=dr(),T0=Ko();function tae(r,e,t){return IC(e)?rae(r,e,t):nae(r,e,t)}function rae(r,e,t){if(t=N0(t)?0:t,ra(IC(e),"When sorting a DataFrame using a function, the first argument to the `sort` method must be a function!"),ra(Td(t),"When sorting a DataFrame using a function, the second argument to the `sort` method must be null, undefined, 0, or 1 to indicate the axis along which the data should be sorted! An axis of 0 means that the rows will be sorted relative to each other, whereas an axis of 1 means that the columns will be sorted relative to each other."),t===0){let n=T0(r.index,(a,i)=>e(r.get(a,null),r.get(i,null)));return r.get(n,null)}else{let n=T0(r.columns,(a,i)=>e(r.get(null,a),r.get(null,i)));return r.get(null,n)}}function nae(r,e,t){let n=r.copy(),a=Zne().toString();return n=n.assign(a,n.index),N0(e)&&(e=[a],t=[!0]),(Td(e)||kc(e))&&(e=[e],(S0(t)||kc(t))&&(t=[t])),ra(TC(e),"The first parameter of the `sort` method must be (1) a string or index representing a column name or index, respectively; (2) a 1-dimensional array of strings and/or indices; or (3) null."),ra(EC(e).length===1,"The first parameter of the `sort` method must be (1) a string or index representing a column name or index, respectively; (2) a 1-dimensional array of strings and/or indices; or (3) null."),N0(t)&&(t=eae(0,e.length).map(()=>!0)),ra(TC(t),"The second parameter of the `sort` method must be (1) a string or boolean representing the sort direction ('ascending' / 'descending', or true / false); (2) a 1-dimensional array of strings and/or booleans; or (3) null."),ra(EC(t).length===1,"The second parameter of the `sort` method must be (1) a string or boolean representing the sort direction ('ascending' / 'descending', or true / false); (2) a 1-dimensional array of strings and/or booleans; or (3) null."),ra(e.length===t.length,"The arrays passed into the `sort` method must be equal in length."),e=e.map(i=>{if(ra(kc(i)||Td(i),"Column references can either be column names (as strings) or column indices (as whole numbers)."),kc(i)){let o=n.columns.indexOf(i);return ra(o>-1,`The column "${i}" does not exist!`),o}if(Td(i))return ra(parseInt(i)===i,"Column indices must be whole numbers!"),ra(i>=0,`The column index ${i} is out of bounds!`),ra(i<n.columns.length,`The index ${i} is out of bounds!`),i}),t=t.map(i=>{if(ra(kc(i)||S0(i),"Direction references can either be strings ('ascending' or 'descending') or booleans (true or false)."),kc(i)){let o=i.trim().toLowerCase();return ra(o==="ascending"||o==="descending","Direction references can either be strings ('ascending' or 'descending') or booleans (true or false)."),o==="ascending"}if(S0(i))return i}),n.values=T0(n.values,(i,o)=>{let s=0;for(;i[e[s]]===o[e[s]]&&s<e.length;)s++;let u=t[s];if(i[e[s]]===o[e[s]])return 0;if(i[e[s]]<o[e[s]])return u?-1:1;if(i[e[s]]>o[e[s]])return u?1:-1}),n.index=Qne(n.get(null,a).values),n=n.dropColumns(a),n}CC.exports=tae});var _C=O((MNt,DC)=>{var aae=$e(),iae=St();function oae(r,e){iae(e)?e=0:aae(e===0||e===1,"The axis parameter of the `toDetailedObject` method must be undefined, 0, or 1. An axis of 0 indicates that the returned object should be organized first by rows and then by columns. An axis of 1 indicates that the returned object should be organized first by columns and then by rows.");let t={};return e===0?r.index.forEach((n,a)=>{let i={};r.columns.forEach((o,s)=>{i[o]=r.values[a][s]}),t[n]=i}):r.columns.forEach((n,a)=>{let i={};r.index.forEach((o,s)=>{i[o]=r.values[s][a]}),t[n]=i}),t}DC.exports=oae});var E0=O((BNt,FC)=>{function sae(r,e){return JSON.stringify(r.toObject(e))}FC.exports=sae});var RC=O((LNt,C0)=>{var I0=yc(),uae=E0();function cae(r,e,t){let n=uae(r,t),a=!1,i=!1,o,s;try{let u=e;if(e.includes("/")){let l=e.split("/");u=l[l.length-1]}let c=document.createElement("a");c.href=`data:application/json;charset=utf-8,${encodeURIComponent(n)}`,c.download=u,c.dispatchEvent(new MouseEvent("click")),a=!0}catch(u){o=u}try{let u=hd("fs"),c=hd("path");u.writeFileSync(c.resolve(e),n,"utf8"),i=!0}catch(u){s=u}if(!a&&!i)throw typeof window<"u"?new I0(o):typeof C0<"u"?new I0(s):new I0("I don't know what's going wrong, but it doesn't seem like you're in Node or the browser, and we couldn't download and/or write the file to disk!");return r}C0.exports=cae});var PC=O((qNt,OC)=>{function lae(r){let e={};return r.columns.forEach(t=>{e[t]=r.get(t).values}),e}OC.exports=lae});var Zs=O((zNt,LC)=>{var MC=$e(),fae=Ke(),hae=dt(),pae=ft(),dae=jo(),BC=xf(),vae=dr();function mae(r){if(hae(r)||pae(r))return r.transpose();MC(fae(r),"The `transpose` function only works on arrays, Series, and DataFrames!");let e=vae(r);if(MC(e.length<=2,"I'm not smart enough to know how to transpose arrays that have more than 2 dimensions. Sorry for the inconvenience! Please only pass 1- or 2-dimensional arrays into the `transpose` function!"),e.length===1)return BC(r);if(e.length===2){let t=dae(BC(e));for(let n=0;n<e[0];n++)for(let a=0;a<e[1];a++)t[a][n]=r[n][a];return t}}LC.exports=mae});var WC=O(($Nt,$C)=>{var qC=$e(),gae=Ke(),yae=dt(),bae=dd(),wae=ft(),xae=dr();function zC(r,e,t){if(wae(t))return new r(e.values.concat(t.values));if(gae(t)){let n=xae(t);qC(n.length===1&&!bae(n),"Only vectors can be appended to Series!");let a=e.copy();return t.forEach((i,o)=>{a._values.push(i),a._index.push("item"+(e.values.length+o))}),a}return qC(!yae(t),"DataFrames cannot be appended to Series!"),zC(e,[t])}$C.exports=zC});var VC=O((WNt,UC)=>{var kae=$e(),Sae=zn();function Nae(r,e){kae(Sae(e),"The parameter to the `apply` method must be a function.");let t=r.copy();return t._values=t._values.map((n,a)=>e(n,a)),t}UC.exports=Nae});var HC=O((UNt,GC)=>{var Tae=St();function Eae(r){let e=r.copy(),t=[];return e._values=e.values.filter((n,a)=>Tae(n)?!1:(t.push(e.index[a]),!0)),e._index=t,e}GC.exports=Eae});var KC=O((VNt,jC)=>{var Iae=at();function Cae(r,e){let t=[],n=[];e.values.forEach((i,o)=>{Iae(i)&&(n.push(i),t.push(e.index[o]))});let a=new r(n);return a.name=e.name,a.index=t,a}jC.exports=Cae});var YC=O((GNt,XC)=>{var{copy:Aae}=vo();function Dae(r,e,t){let n=e.copy(),a=Aae(n.index),i=[],o=n.values.filter((s,u)=>{let c=t(s,u,n.values);return c||i.push(n.index[u]),c});return i.forEach(s=>{a.splice(a.indexOf(s),1)}),o.length===0?(n=new r,n.name=e.name,n):(n.values=o,n.index=a,n)}XC.exports=Dae});var ZC=O((HNt,JC)=>{var Jo=$e(),_ae=at(),Fae=ta(),Rae=St(),Oae=Va();function Pae(r,e){(Fae(e)||_ae(e))&&(e=[e]);let t=Oae((e||[]).map(n=>typeof n));return Jo(t.length<=2,"Only whole numbers and/or strings are allowed in `get` arrays!"),t.length===1&&Jo(t[0]==="string"||t[0]==="number","Only whole numbers and/or strings are allowed in `get` arrays!"),t.length===2&&(Jo(t.indexOf("string")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!"),Jo(t.indexOf("number")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!")),Rae(e)||(e=e.map(n=>{if(typeof n=="string")return Jo(r.index.indexOf(n)>-1,`Index "${n}" does not exist!`),n;if(typeof n=="number")return Jo(n>=0,`Index ${n} is out of bounds!`),Jo(parseInt(n)===n,"Indices must be integers!"),Jo(n<r.index.length,`Index ${n} is out of bounds!`),r.index[n]})),r.getSubsetByNames(e)}JC.exports=Pae});var eA=O((jNt,QC)=>{var If=$e(),Mae=Ke(),Bae=St(),Lae=kf(),qae=Ca(),zae=dr();function $ae(r,e){let t=r.shape;Bae(e)&&(e=qae(0,t[0])),If(Mae(e),"The `indices` array must be 1-dimensional array of whole numbers."),If(zae(e).length===1,"The `indices` array must be a 1-dimensional array of whole numbers."),If(e.length>0,"The `indices` array must contain at least one index."),e.forEach(a=>{If(Lae(a),"The `indices` array must be a 1-dimensional array of whole numbers."),If(a<r.index.length,`The row index ${a} is out of bounds.`)});let n=e.map(a=>r.index[a]);return r.getSubsetByNames(n)}QC.exports=$ae});var rA=O((KNt,tA)=>{var Cf=$e(),Wae=Ke(),Uae=ta(),Vae=St(),Gae=dr();function Hae(r,e,t){Vae(t)&&(t=e.index),Cf(Wae(t),"The `indices` array must be a 1-dimensional array of strings."),Cf(Gae(t).length===1,"The `indices` array must be a 1-dimensional array of strings."),Cf(t.length>0,"The `indices` array must contain at least one index name."),t.forEach(i=>{Cf(Uae(i),"The `indices` array must contain only strings."),Cf(e.index.indexOf(i)>-1,`The name "${i}" does not exist in the index.`)});let n=t.map(i=>e.values[e.index.indexOf(i)]);if(n.length===1)return n[0];let a=new r(n);return a.index=t,a.name=e.name,a}tA.exports=Hae});var iA=O((XNt,aA)=>{var{copy:jae}=vo(),nA=Ca();function Kae(r){let e=r.copy(),t=typeof window>"u"?20:10;if(e.index.length>t){e=e.get(nA(0,t/2).concat(nA(e.index.length-t/2,e.index.length)));let a=jae(e.index);a.splice(parseInt(a.length/2),0,"..."),e.values.push("..."),e.index.push("..."),e=e.get(a)}let n={};return e.values.forEach((a,i)=>{let o={};o[e.name]=a,n[e.index[i]]=o}),console.table(n),console.log("Shape:",r.shape,`
`),r}aA.exports=Kae});var sA=O((YNt,oA)=>{var Xae=Sd();function Yae(r){let e=r.copy();return e.get(Xae(e.index))}oA.exports=Yae});var cA=O((JNt,uA)=>{var Jae=$e(),Zae=zn(),Qae=St(),eie=Ko(),tie=Zs();function rie(r,e,t){t=t||((u,c)=>u<c?-1:1),Jae(Qae(t)||Zae(t),"You must pass undefined, null, or a comparison function as the second argument to the `sort` method!");let n=tie([e.values,e.index]),a=eie(n,(u,c)=>t(u[0],c[0])),i=[],o=[];a.forEach(u=>{i.push(u[0]),o.push(u[1])});let s=new r;return s._values=i,s._index=o,s.name=e.name,s}uA.exports=rie});var hA=O((ZNt,fA)=>{var nie=Ko(),lA=Zs();function aie(r,e){let t=lA([e.values,e.index]);t=lA(nie(t,(a,i)=>{if(a[1]===i[1])return 0;if(a[1]<i[1])return-1;if(a[1]>i[1])return 1}));let n=new r(t[0]);return n.index=t[1],n.name=e.name,n}fA.exports=aie});var dA=O((QNt,pA)=>{function iie(r){let e={};return e[r.name]={},r.index.forEach((t,n)=>{e[r.name][t]=r.values[n]}),e}pA.exports=iie});var bA=O((eTt,yA)=>{var{copy:Ed}=vo(),mo=$e(),A0=Ke(),oie=ta(),sie=St(),vA=xd(),mA=Ca(),Id=xf(),uie=WC(),cie=VC(),lie=HC(),fie=KC(),hie=YC(),pie=ZC(),die=eA(),vie=rA(),mie=iA(),gie=sA(),yie=cA(),bie=hA(),wie=dA(),Af=dr(),xie=Zs(),gA=Symbol.for("@jrc03c/js-math-tools/series");yA.exports=function(r){class e{static[Symbol.hasInstance](n){try{return!!n._symbol&&n._symbol===gA}catch{return!1}}constructor(n){if(this.name="data",Object.defineProperty(this,"_symbol",{configurable:!1,enumerable:!1,writable:!1,value:gA}),Object.defineProperty(this,"_values",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(this,"values",{configurable:!0,enumerable:!0,get(){return this._values},set(a){mo(A0(a),"The new values must be a 1-dimensional array!");let i=Af(a);mo(i.length===1,"The new array of values must be 1-dimensional!"),i[0]<this._index.length?this._index=this._index.slice(0,i[0]):i[0]>this._index.length&&(this._index=this._index.concat(mA(this._index.length,i[0]).map(o=>"item"+vA(o,(a.length-1).toString().length)))),this._values=a}}),Object.defineProperty(this,"_index",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(this,"index",{configurable:!0,enumerable:!0,get(){return this._index},set(a){mo(A0(a),"The new index must be a 1-dimensional array of strings!"),mo(a.length===this.shape[0],"The new index must be the same length as the old index!"),mo(Af(a).length===1,"The new index must be a 1-dimensional array of strings!"),a.forEach(i=>{mo(oie(i),"All of the row names must be strings!")}),this._index=a}}),n){if(n instanceof e)this.name=n.name,this.values=Ed(n.values),this.index=Ed(n.index);else if(A0(n)){let a=Af(n);mo(a.length===1,"When passing an array into the constructor of a Series, the array must be 1-dimensional!"),this.values=n}else if(n instanceof Object){let a=Object.keys(n).concat(Object.getOwnPropertySymbols(n)).map(s=>s.toString());mo(a.length===1,"When passing an object into the constructor of a Series, the object must have only 1 key-value pair, where the key is the name of the data and the value is the 1-dimensional array of values!");let i=a[0],o=n[i];mo(Af(o).length===1,"When passing an object into the constructor of a Series, the object must have only 1 key-value pair, where the key is the name of the data and the value is the 1-dimensional array of values!"),this.name=i,this.values=o.slice()}}}get shape(){return Af(this.values)}get length(){return this.shape[0]}get isEmpty(){return this.values.filter(n=>!sie(n)).length===0}clear(){let n=this.copy();return n.values.forEach((a,i)=>{n.values[i]=void 0}),n}get(n){return pie(this,n)}getSubsetByNames(n){return vie(e,this,n)}getSubsetByIndices(n){return die(this,n)}loc(n){return this.getSubsetByNames(n)}iloc(n){return this.getSubsetByIndices(n)}reverse(){let n=new e(Id(this.values));return n.index=Id(this.index),n.name=this.name,n}resetIndex(){let n=this.copy();return n.index=mA(0,this.shape[0]).map(a=>"item"+vA(a,(n.index.length-1).toString().length)),n}copy(){let n=new e;return n._values=Ed(this.values),n._index=Ed(this.index),n.name=this.name,n}append(n){return uie(e,this,n)}apply(n){return cie(this,n)}concat(n){return this.append(n)}dropMissing(n,a){return lie(this,n,a)}dropNaN(){return fie(e,this)}toObject(){return wie(this)}print(){return mie(this)}shuffle(){return gie(this)}sort(n){return yie(e,this,n)}sortByIndex(){return bie(e,this)}filter(n){return hie(e,this,n)}toDataFrame(){let n=new r(xie([this.values]));return n.columns=[this.name],n.index=this.index,n}transpose(){let n=this.copy();return n.values=Id(n.values),n.index=Id(n.index),n}getDummies(){return this.toDataFrame().getDummies()}oneHotEncode(){return this.getDummies()}}return e}});var _f=O((tTt,NA)=>{var{copy:D0}=vo(),Ha=$e(),wA=bf(),kie=aI(),Sie=cI(),Nie=pI(),Tie=vI(),Eie=kI(),Iie=TI(),Cie=AI(),Aie=RI(),Die=MI(),xA=WI(),_ie=YI(),Fie=tC(),Rie=nC(),Oie=oC(),Pie=SC(),Mie=AC(),Bie=_C(),Lie=RC(),qie=E0(),zie=PC(),$ie=Er(),Df=Ke(),Wie=Ho(),_0=St(),F0=xd(),Uie=jo(),R0=Ca(),Vie=Va(),Sc=dr(),kA=Zs(),SA=Symbol.for("@jrc03c/js-math-tools/dataframe");function Cd(r){let e="abcdefghijklmnopqrstuvwxyz1234567890",t="";for(let n=0;n<r;n++)t+=e[parseInt(Math.random()*e.length)];return t}var nn=class{static[Symbol.hasInstance](e){try{return!!e._symbol&&e._symbol===SA}catch{return!1}}constructor(e){if(Object.defineProperty(this,"_symbol",{configurable:!1,enumerable:!1,writable:!1,value:SA}),Object.defineProperty(this,"_values",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(this,"values",{configurable:!0,enumerable:!0,get(){return this._values.length===0||!_0(this._values[0])&&this._values[0].length===0?[[]]:this._values},set(t){Ha(Df(t),"The new values must be a 2-dimensional array!");let n=Sc(t);Ha(n.length===2,"The new array of values must be 2-dimensional!"),n[0]<this._index.length?this._index=this._index.slice(0,n[0]):n[0]>this._index.length&&(this._index=this._index.concat(R0(this._index.length,n[0]).map(a=>"row"+F0(a,(n[0]-1).toString().length)))),n[1]<this._columns.length?this._columns=this._columns.slice(0,n[1]):n[1]>this._columns.length&&(this._columns=this._columns.concat(R0(this._columns.length,n[1]).map(a=>"col"+F0(a,(n[1]-1).toString().length)))),this._values=t}}),Object.defineProperty(this,"_columns",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(this,"columns",{configurable:!0,enumerable:!0,get(){return this._columns},set(t){Ha(Df(t),"The new columns list must be a 1-dimensional array of strings!"),Ha(this.isEmpty||t.length===this.shape[1],"The new columns list must be the same length as the old columns list!"),Ha(Sc(t).length===1,"The new columns list must be a 1-dimensional array of strings!"),t=t.map(a=>(typeof a!="string"&&(a=JSON.stringify(a)||a.toString()),a.trim().length===0?"untitled_"+Cd(8):a.trim()));let n=(()=>{let a=wA(t),i={};return a.forEach(o=>{i[o.value]=o.count}),i})();t=t.map(a=>n[a]>1?a+"_"+Cd(8):a),this._columns=t}}),Object.defineProperty(this,"_index",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(this,"index",{configurable:!0,enumerable:!0,get(){return this._index},set(t){Ha(Df(t),"The new index must be a 1-dimensional array of strings!"),Ha(this.isEmpty||t.length===this.shape[0],"The new index must be the same length as the old index!"),Ha(Sc(t).length===1,"The new index must be a 1-dimensional array of strings!"),t=t.map(a=>(typeof a!="string"&&(a=JSON.stringify(a)||a.toString()),a.trim().length===0?"untitled_"+Cd(8):a.trim()));let n=(()=>{let a=wA(t),i={};return a.forEach(o=>{i[o.value]=o.count}),i})();t=t.map(a=>n[a]>1?a+"_"+Cd(8):a),this._index=t}}),Ha(_0(e)||Wie(e)||Df(e),"The `data` passed into the constructor of a DataFrame must be either (1) an object where the key-value pairs are (respectively) column names and 1-dimensional arrays of values, or (2) a 2-dimensional array of values."),e)if(e instanceof nn)this.values=D0(e.values),this.columns=D0(e.columns),this.index=D0(e.index);else if(Df(e)){let t=Sc(e);Ha(t.length===2,"The `data` array passed into the constructor of a DataFrame must be 2-dimensional!"),Ha(Vie(e.map(n=>n.length)).length===1,"The 2-dimensional array passed into the constructor of a DataFrame must not contain sub-arrays (i.e., rows) of different lengths!"),this.values=e}else{this._columns=Object.keys(e).concat(Object.getOwnPropertySymbols(e)).map(o=>o.toString());let t=[],n=null,a=null;this._columns.forEach(o=>{_0(a)&&(n=o,a=e[o].length),Ha(e[o].length===a,`The object passed into the DataFrame constructor contains arrays of different lengths! The key "${n}" points to an array containing ${a} items, and the key "${o}" points to an array containing ${e[o].length} items.`),a=e[o].length;let s=e[o];t.push(s)}),this._values=kA(t);let i=Sc(this.values);this._index=R0(0,i[0]).map(o=>"row"+F0(o,(i[0]-1).toString().length))}}get shape(){return Sc(this.values)}get length(){return this.shape[0]}get width(){return this.shape[1]}get rows(){return this.index}set rows(e){this.index=e}get isEmpty(){return $ie(this.values).length===0}clear(){let e=new nn(Uie(this.shape));return e.columns=this.columns.slice(),e.index=this.index.slice(),e}get(e,t){if(arguments.length===0)return this;if(arguments.length===1)try{return this.get(null,e)}catch{return this.get(e,null)}return Die(this,e,t)}getSubsetByNames(e,t){return Fie(nn,Zo,this,e,t)}getSubsetByIndices(e,t){return _ie(this,e,t)}getDummies(e){return xA(nn,this,e)}oneHotEncode(e){return xA(nn,this,e)}transpose(){let e=new nn(kA(this.values));return e.columns=this.index.slice(),e.index=this.columns.slice(),e}get T(){return this.transpose()}resetIndex(e){return Oie(this,e)}copy(){return Tie(nn,this)}assign(e,t){return Nie(nn,Zo,this,e,t)}apply(e,t){return Sie(nn,Zo,this,e,t)}dropMissing(e,t,n){return Iie(nn,Zo,this,e,t,n)}dropNaN(e,t,n){return Cie(nn,this,e,t,n)}drop(e,t){return Eie(nn,Zo,this,e,t)}dropColumns(e){return this.drop(null,e)}dropRows(e){return this.drop(e,null)}toDetailedObject(e){return Bie(this,e)}toObject(){return zie(this)}toJSONString(e){return qie(this,e)}saveAsJSON(e,t){return Lie(this,e,t)}print(){return Rie(nn,Zo,this)}sort(e,t){return Mie(this,e,t)}sortByIndex(){return this.sort()}filter(e,t){return Aie(nn,Zo,this,e,t)}shuffle(e){return Pie(this,e)}append(e,t){return kie(this,e,t)}concat(e,t){return this.append(e,t)}join(e,t){return this.append(e,t)}toString(){return JSON.stringify(this)}},Zo=bA()(nn);NA.exports={DataFrame:nn,Series:Zo}});var Nc=O((rTt,EA)=>{var Gie=$e(),Hie=Er(),jie=Ke(),Kie=dt(),Xie=ft();function TA(r){if(Kie(r)||Xie(r))return TA(r.values);Gie(jie(r),"The `max` function only works on arrays, Series, and DataFrames!");try{r=Hie(r);let e=-1/0;for(let t of r)t>e&&(e=t);return e}catch{return NaN}}EA.exports=TA});var jt=O((nTt,_A)=>{var{DataFrame:IA,Series:CA}=_f(),AA=$e(),Ff=Ke(),O0=dt(),DA=ki(),Yie=zn(),P0=ft(),Jie=Nc(),Zie=Ca(),Ad=dr();function Qie(r){return Ff(r)||P0(r)||O0(r)}function eoe(r){return AA(Yie(r),"You must pass a function into the `vectorize` function!"),function e(){let t,n,a=[],i=[],o=Object.keys(arguments).filter(s=>{let u=arguments[s];return Ff(u)?!0:P0(u)?(t=!0,a.push(u),!0):O0(u)?(n=!0,i.push(u),!0):!1}).map(s=>arguments[s]);if(o.slice(0,-1).forEach((s,u)=>{AA(DA(Ff(s)?Ad(s):s.shape,Ff(o[u+1])?Ad(o[u+1]):o[u+1].shape),`When passing multiple arrays into the \`${r.name}\` function, all of the arrays must have the same shape!`)}),o.length>0){let s=Jie(o.map(c=>c.length?c.length:c.values.length)),u=Zie(0,s).map(c=>{let l=Object.keys(arguments).map(f=>{if(Qie(arguments[f])){if(Ff(arguments[f]))return arguments[f][c];if(P0(arguments[f]))return arguments[f].values[c];if(O0(arguments[f]))return arguments[f].values[c]}else return arguments[f]});return e(...l)});if(n)try{if(i.length===1&&DA(Ad(i[0]),Ad(u))){let c=new IA(u);return c.index=i[0].index.slice(),c.columns=i[0].columns.slice(),c}else return new IA(u)}catch{return u}if(t)try{if(a.length===1&&a[0].length===u.length){let c=new CA(u);return c.name=a[0].name,c.index=a[0].index.slice(),c}else return new CA(u)}catch{return u}return u}else return r(...arguments)}}_A.exports=eoe});var Dd=O((aTt,FA)=>{var toe=at(),roe=jt();function noe(r){try{return toe(r)?Math.abs(r):NaN}catch{return NaN}}FA.exports=roe(noe)});var _d=O((iTt,RA)=>{var aoe=at(),ioe=jt();function ooe(){try{let r=0,e=Object.values(arguments);for(let t=0;t<e.length;t++){if(!aoe(e[t]))return NaN;r+=e[t]}return r}catch{return NaN}}RA.exports=ioe(ooe)});var Rf=O((oTt,OA)=>{var soe=jt();function uoe(r,e){try{return e(r)}catch{return NaN}}OA.exports=soe(uoe)});var MA=O((sTt,PA)=>{var coe=at(),loe=jt();function foe(r){try{return coe(r)?Math.acos(r):NaN}catch{return NaN}}PA.exports=loe(foe)});var LA=O((uTt,BA)=>{var hoe=at(),poe=jt();function doe(r){try{return hoe(r)?Math.asin(r):NaN}catch{return NaN}}BA.exports=poe(doe)});var zA=O((cTt,qA)=>{var voe=at(),moe=jt();function goe(r){try{return voe(r)?Math.atan(r):NaN}catch{return NaN}}qA.exports=moe(goe)});var WA=O((lTt,$A)=>{var yoe=$e(),boe=vf(),woe=Ke(),xoe=dt(),koe=ft(),Soe=Nc();function M0(r){if(xoe(r)){let e=M0(r.values);return[r.index[e[0]],r.columns[e[1]]]}if(koe(r)){let e=M0(r.values);return[r.index[e]]}yoe(woe(r),"The `argmax` function only works on arrays, Series, and DataFrames!");try{let e=boe(r,Soe(r));return e?e.length===0?void 0:e.length===1?e[0]:e:void 0}catch{return}}$A.exports=M0});var Fd=O((fTt,VA)=>{var Noe=$e(),Toe=Er(),Eoe=Ke(),Ioe=dt(),Coe=ft();function UA(r){if(Ioe(r)||Coe(r))return UA(r.values);Noe(Eoe(r),"The `min` function only works on arrays, Series, and DataFrames!");try{r=Toe(r);let e=1/0;for(let t of r)t<e&&(e=t);return e}catch{return NaN}}VA.exports=UA});var HA=O((hTt,GA)=>{var Aoe=$e(),Doe=vf(),_oe=Ke(),Foe=dt(),Roe=ft(),Ooe=Fd();function B0(r){if(Foe(r)){let e=B0(r.values);return[r.index[e[0]],r.columns[e[1]]]}if(Roe(r)){let e=B0(r.values);return[r.index[e]]}Aoe(_oe(r),"The `argmin` function only works on arrays, Series, and DataFrames!");try{let e=Doe(r,Ooe(r));return e?e.length===0?void 0:e.length===1?e[0]:e:void 0}catch{return}}GA.exports=B0});var $0=O((pTt,XA)=>{var jA=Ke(),L0=Nd(),Poe=dt(),q0=gf(),Moe=ki(),KA=at(),Boe=Ho(),Loe=ft(),z0=St();function go(r,e){if(Poe(r)||Loe(r))return r.apply(t=>go(t,e));if(jA(r))return r.map(t=>go(t,e));if(e==="null")return null;if(e==="number"){if(z0(r))return NaN;let t=go(r,"boolean");if(L0(t))return t?1:0;try{JSON.parse(r)}catch{let i=go(r,"date");if(q0(i))return i.getTime()}let n=parseFloat(r);return isNaN(n)?NaN:n}if(e==="boolean"){if(L0(r))return r;if(KA(r))return r===0?!1:r===1?!0:null;try{let t=(typeof r=="object"?r.toString()==="null"?"false":JSON.stringify(r):r.toString()).trim().toLowerCase();return t==="true"||t==="yes"||t==="y"?!0:t==="false"||t==="no"||t==="n"?!1:null}catch{return null}}if(e==="date"){if(q0(r))return r;if(z0(r))return null;let t=parseFloat(r);if(!isNaN(t)){let a=new Date(r);return q0(a)?a:null}let n=Date.parse(r);return isNaN(n)?null:new Date(n)}if(e==="object"){if(Boe(r))return r;let t=go(r,"boolean");if(L0(t))return null;try{let a=go(r,"number");if(KA(a))return JSON.parse(r),null}catch{}let n=go(r,"date");if(n)return n;try{let a=JSON.parse(r);return jA(a)?a.map(i=>go(i,e)):a}catch{return null}}if(e==="string")return z0(r)?Moe(r,void 0)?"undefined":"null":r instanceof Date?r.toJSON():(()=>typeof r=="object"?r===null?"null":JSON.stringify(r):r.toString())()}XA.exports=go});var JA=O((dTt,YA)=>{var qoe=at(),zoe=jt();function $oe(r){try{return qoe(r)?Math.ceil(r):NaN}catch{return NaN}}YA.exports=zoe($oe)});var eD=O((vTt,QA)=>{var Woe=Dd(),ZA=at(),Uoe=St(),Voe=jt();function Goe(r,e){try{if(!ZA(r))return NaN;if(Uoe(e))e=1e-10;else if(!ZA(e))return NaN;return Woe(r)<e?0:r}catch{return NaN}}QA.exports=Voe(Goe)});var rD=O((mTt,tD)=>{var W0=at(),Hoe=jt();function joe(r,e,t){try{return W0(r)?W0(e)?W0(t)?r<e?e:r>t?t:r:NaN:NaN:NaN}catch{return NaN}}tD.exports=Hoe(joe)});var aD=O((gTt,nD)=>{var U0=$e(),Koe=Er(),Xoe=Ke(),Yoe=dt(),Joe=at(),Zoe=ft();function V0(r,e){if(Yoe(r)||Zoe(r))return V0(r.values,e);if(U0(Xoe(r),"The `combinations` function only works on arrays, Series, and DataFrames!"),U0(Joe(e),"`r` must be a whole number!"),r=Koe(r),e>r.length)return[r];if(e<=0)return[[]];if(U0(e===parseInt(e),"`r` must be a whole number!"),r.length<2)return r;let t=[];return r.forEach((n,a)=>{let i=r.slice(a+1);if(i.length<e-1)return;V0(i,e-1).forEach(s=>{t.push([n].concat(s))})}),t}nD.exports=V0});var Rd=O((yTt,oD)=>{var Qoe=$e(),ese=Er(),tse=Ke(),rse=dt(),nse=ft();function iD(r){if(rse(r)||nse(r))return iD(r.values);Qoe(tse(r),"The `mean` function only works on arrays, Series, and DataFrames!");try{let e=ese(r),t=0;return e.forEach(n=>{t+=n}),t/e.length}catch{return NaN}}oD.exports=iD});var H0=O((bTt,hD)=>{var sD=$e(),uD=Ke(),Od=at(),cD=ft(),lD=Rd(),fD=dr();function G0(r,e){if(cD(r))return G0(r.values,e);if(cD(e))return G0(r,e.values);sD(uD(r)&&uD(e)&&fD(r).length===1&&fD(e).length===1,"The `covariance` function only works on 1-dimensional arrays and Series!"),sD(r.length===e.length,"The two arrays or Series passed into the `covariance` function must have the same length!");try{let t=lD(r),n=lD(e);if(!Od(t)||!Od(n))return NaN;let a=Math.max(r.length,e.length),i=0;for(let o=0;o<a;o++){if(!Od(r[o]))return NaN;if(!Od(e[o]))return NaN;i+=(r[o]-t)*(e[o]-n)}return i/r.length}catch{return NaN}}hD.exports=G0});var Pd=O((wTt,pD)=>{var ase=at(),ise=jt();function ose(r){try{return ase(r)?Math.sqrt(r):NaN}catch{return NaN}}pD.exports=ise(ose)});var j0=O((xTt,vD)=>{var sse=$e(),use=Er(),cse=Ke(),lse=dt(),fse=at(),hse=ft(),pse=Rd();function dD(r){if(lse(r)||hse(r))return dD(r.values);sse(cse(r),"The `variance` function only works on arrays, Series, and DataFrames!");try{let e=use(r),t=pse(e),n=0;for(let a=0;a<e.length;a++){if(!fse(e[a]))return NaN;n+=(e[a]-t)*(e[a]-t)}return n/e.length}catch{return NaN}}vD.exports=dD});var Md=O((kTt,gD)=>{var dse=$e(),vse=Ke(),mse=dt(),gse=ft(),yse=Pd(),bse=j0();function mD(r){if(mse(r)||gse(r))return mD(r.values);dse(vse(r),"The `std` function only works on arrays, Series, and DataFrames!");try{return yse(bse(r))}catch{return NaN}}gD.exports=mD});var ND=O((STt,SD)=>{var yD=$e(),wse=H0(),bD=Ke(),wD=ft(),xD=dr(),kD=Md();function K0(r,e){if(wD(r))return K0(r.values,e);if(wD(e))return K0(r,e.values);yD(bD(r)&&bD(e)&&xD(r).length===1&&xD(e).length===1,"The `correl` function only works on 1-dimensional arrays and Series!"),yD(r.length===e.length,"The two arrays or Series passed into the `correl` function must have the same length!");try{return wse(r,e)/(kD(r)*kD(e))}catch{return NaN}}SD.exports=K0});var ED=O((NTt,TD)=>{var xse=at(),kse=jt();function Sse(r){try{return xse(r)?Math.cos(r):NaN}catch{return NaN}}TD.exports=kse(Sse)});var CD=O((TTt,ID)=>{ID.exports=Object.freeze({boolean:"boolean",date:"date",null:"null",number:"number",object:"object",string:"string"})});var OD=O((ETt,RD)=>{var Nse=$e(),AD=Ke(),DD=dt(),Tse=ki(),_D=ft(),FD=Va();function X0(r,e){if(DD(r)||_D(r))return X0(r.values,e);if(DD(e)||_D(e))return X0(r,e.values);Nse(AD(r)&&AD(e),"The `diff` function only works on arrays, Series, and DataFrames!");let t=FD(r),n=FD(e),a=[];return t.forEach(i=>{n.findIndex(o=>Tse(o,i))<0&&a.push(i)}),a}RD.exports=X0});var Bd=O((ITt,MD)=>{var PD=at(),Ese=jt();function Ise(r,e){try{return PD(r)?PD(e)?Math.pow(r,e):NaN:NaN}catch{return NaN}}MD.exports=Ese(Ise)});var Y0=O((CTt,BD)=>{var Cse=at(),Ase=jt();function Dse(){try{let r=Object.values(arguments);if(r.length===0)return NaN;let e=1;for(let t=0;t<r.length;t++){if(!Cse(r[t]))return NaN;e*=r[t]}return e}catch{return NaN}}BD.exports=Ase(Dse)});var Tc=O((ATt,LD)=>{var _se=Y0();function Fse(){return _se(...arguments)}LD.exports=Fse});var J0=O((DTt,qD)=>{var Rse=_d(),Ose=Tc();function Pse(r,e){return Rse(r,Ose(e,-1))}qD.exports=Pse});var Ld=O((_Tt,$D)=>{var Mse=$e(),Bse=Er(),Lse=Ke(),qse=dt(),zse=ft();function zD(r){if(qse(r)||zse(r))return zD(r.values);Mse(Lse(r),"The `sum` function only works on arrays, Series, and DataFrames!");try{return r.length===0?NaN:Bse(r).reduce((e,t)=>e+t,0)}catch{return NaN}}$D.exports=zD});var KD=O((FTt,jD)=>{var $se=Dd(),Wse=$e(),WD=Ke(),UD=dt(),Use=ki(),VD=at(),GD=ft(),Vse=Bd(),HD=dr(),Gse=Pd(),Hse=J0(),jse=Ld();function Z0(r,e){if(VD(r)&&VD(e))return $se(r-e);if(UD(r)||GD(r))return Z0(r.values,e);if(UD(e)||GD(e))return Z0(r,e.values);WD(r)&&WD(e)&&Wse(Use(HD(r),HD(e)),"If passing two arrays, Series, or DataFrames into the `distance` function, then those objects must have the same shape!");try{return Gse(jse(Vse(Hse(r,e),2)))}catch{return NaN}}jD.exports=Z0});var YD=O((RTt,XD)=>{var Kse=Bd(),Xse=Tc();function Yse(r,e){return Xse(r,Kse(e,-1))}XD.exports=Yse});var eb=O((OTt,r_)=>{var{DataFrame:JD,Series:ZD}=_f(),qd=$e(),QD=Er(),e_=Ke(),Q0=dt(),Jse=at(),zd=ft(),Zse=Tc(),$d=dr(),Qse=Ld(),t_=Zs();function Qo(r,e){if(Q0(r)){let a=Qo(r.values,e);if($d(a).length===1){let i=new ZD(a);return i.name=zd(e)?e.name:i.name,i.index=r.index.slice(),i}else{let i=new JD(a);return i.index=r.index.slice(),Q0(e)&&(i.columns=e.columns.slice()),i}}if(Q0(e)){let a=Qo(r,e.values);if($d(a).length===1){let i=new ZD(a);return i.name=zd(r)?r.name:i.name,i.index=e.columns.slice(),i}else{let i=new JD(a);return i.columns=e.columns.slice(),i}}if(zd(r))return Qo(r.values,e);if(zd(e))return Qo(r,e.values);qd(e_(r)&&e_(e),"The `dot` function only works on arrays, Series, and DataFrames!"),QD(r).concat(QD(e)).forEach(a=>{qd(Jse(a),"One of the arrays you passed into the `dot` function contains non-numerical values!")});let t=$d(r),n=$d(e);if(qd(t.length<=2&&n.length<=2,"I'm not smart enough to know how to get the dot-product of arrays that have more than 2 dimensions. Sorry for the inconvenience! Please only pass 1- or 2-dimensional arrays into the `dot` function!"),qd(t[t.length-1]===n[0],`There's a dimension misalignment in the two arrays you passed into the \`dot\` function. (${t[t.length-1]} !== ${n[0]})`),t.length===1&&n.length===1)return Qse(Zse(r,e));if(t.length===1&&n.length===2)return t_(e).map(a=>Qo(r,a));if(t.length===2&&n.length===1)return r.map(a=>Qo(a,e));if(t.length===2&&n.length===2){let a=t_(e),i=[];for(let o=0;o<r.length;o++){let s=[];for(let u=0;u<a.length;u++)s.push(Qo(r[o],a[u]));i.push(s)}return i}}r_.exports=Qo});var tb=O((PTt,a_)=>{var eue=$e(),tue=Ke(),rue=dt(),nue=ft(),aue=St();function n_(r){if(rue(r)||nue(r))return r.dropMissing(...Object.values(arguments).slice(1));eue(tue(r),"The `dropMissing` function only works on arrays, Series, and DataFrames!");let e=[];return r.forEach(t=>{try{return e.push(n_(t))}catch{aue(t)||e.push(t)}}),e}a_.exports=n_});var h_=O((MTt,f_)=>{var i_=$e(),o_=Ke(),s_=dt(),iue=ki(),u_=ft(),c_=St(),l_=dr();function Wd(r,e){if(s_(r)||u_(r))return Wd(r.values,e);if(s_(e)||u_(e))return Wd(r,e.values);i_(o_(r)&&o_(e),"The `dropMissingPairwise` function only works on arrays, Series, and DataFrames!"),i_(iue(l_(r),l_(e)),"The two arrays, Series, and/or DataFrames passed into the `dropMissingPairwise` function must have the same shape!");let t=[],n=[];for(let a=0;a<r.length;a++)try{let[i,o]=Wd(r[a],e[a]);t.push(i),n.push(o)}catch{!c_(r[a])&&!c_(e[a])&&(t.push(r[a]),n.push(e[a]))}return[t,n]}f_.exports=Wd});var w_=O((BTt,b_)=>{var p_=$e(),d_=Ke(),v_=dt(),oue=ki(),m_=at(),g_=ft(),y_=dr();function Ud(r,e){if(v_(r)||g_(r))return Ud(r.values,e);if(v_(e)||g_(e))return Ud(r,e.values);p_(d_(r)&&d_(e),"The `dropNaNPairwise` only works on arrays, Series, and DataFrames!"),p_(oue(y_(r),y_(e)),"The two arrays, Series, and/or DataFrames passed into the `dropNaNPairwise` must have the same shape!");let t=[],n=[];for(let a=0;a<r.length;a++)try{let[i,o]=Ud(r[a],e[a]);t.push(i),n.push(o)}catch{m_(r[a])&&m_(e[a])&&(t.push(r[a]),n.push(e[a]))}return[t,n]}b_.exports=Ud});var k_=O((LTt,x_)=>{var sue=tb();function uue(r){return sue(r)}x_.exports=uue});var N_=O((qTt,S_)=>{var cue=at(),lue=jt();function fue(r){try{return cue(r)?Math.exp(r):NaN}catch{return NaN}}S_.exports=lue(fue)});var I_=O((zTt,E_)=>{var hue=jt();function T_(r){try{return r!==parseInt(r)?NaN:r<=1?1:r*T_(r-1)}catch{return NaN}}E_.exports=hue(T_)});var __=O(($Tt,D_)=>{var pue=$e(),due=Er(),C_=Ke(),vue=dt(),mue=zn(),A_=Ho(),gue=ft();function rb(r,e){if(vue(r))return rb(due(r.values),e);if(gue(r))return rb(r.values,e);if(pue(A_(r)||C_(r),"You must pass (1) an object, array, Series, or DataFrame and (2) a function or value into the `find` function!"),!mue(e)){let a=e;e=i=>i===a}function t(a,i,o){if(o=o||[],o.indexOf(a)>-1)return null;if(A_(a)){o.push(a);let s=Object.keys(a).concat(Object.getOwnPropertySymbols(a));for(let u=0;u<s.length;u++){let c=s[u],l=a[c];if(i(l))return l;let f=t(l,i,o);if(f)return f}}else if(C_(a)){o.push(a);for(let s=0;s<a.length;s++){let u=a[s];if(i(u))return u;let c=t(u,i,o);if(c)return c}}else if(i(a))return a;return null}function n(a){try{return e(a)}catch{return!1}}return t(r,n)}D_.exports=rb});var P_=O((WTt,O_)=>{var yue=$e(),bue=Er(),F_=Ke(),wue=dt(),xue=zn(),R_=Ho(),kue=ft();function nb(r,e){if(wue(r))return nb(bue(r.values),e);if(kue(r))return nb(r.values,e);if(yue(R_(r)||F_(r),"You must pass (1) an object, array, Series, or DataFrame and (2) a function or value into the `findAll` function!"),!xue(e)){let i=e;e=o=>o===i}function t(i,o,s){if(s=s||[],s.indexOf(i)>-1)return null;if(R_(i)){s.push(i);let u=Object.keys(i).concat(Object.getOwnPropertySymbols(i)),c=[];for(let l=0;l<u.length;l++){let f=u[l],h=i[f],p=!1;o(h)&&(c.push(h),p=!0);let d=t(h,o,s);d&&d.length>0&&d.slice(p?1:0).forEach(m=>c.push(m))}return c}else if(F_(i)){s.push(i);let u=[];for(let c=0;c<i.length;c++){let l=i[c],f=!1;o(l)&&(u.push(l),f=!0);let h=t(l,o,s);h&&h.length>0&&h.slice(f?1:0).forEach(p=>u.push(p))}return u}else if(o(i))return[i];return null}function n(i){try{return e(i)}catch{return!1}}let a=t(r,n);return a&&a.length>0?a:null}O_.exports=nb});var B_=O((UTt,M_)=>{var Sue=at(),Nue=jt();function Tue(r){try{if(r==="Infinity")return 1/0;if(r==="-Infinity")return-1/0;let e=JSON.parse(r);return Sue(e)?e:NaN}catch{return NaN}}M_.exports=Nue(Tue)});var q_=O((VTt,L_)=>{var Eue=at(),Iue=jt();function Cue(r){try{return Eue(r)?Math.floor(r):NaN}catch{return NaN}}L_.exports=Iue(Cue)});var ab=O((GTt,z_)=>{var Aue=at(),Due=Tf(),_ue=kd();function Fue(r){Aue(r)&&(r=[r]);let e=[],t=Due(r);for(let n=0;n<t;n++)e.push(0);return _ue(e,r)}z_.exports=Fue});var W_=O((HTt,$_)=>{var Vd=$e(),Rue=at(),Oue=St(),Pue=ab();function Mue(r){Vd(!Oue(r),"You must pass an integer greater than 0 (representing the size) into the `identity` function!"),Vd(Rue(r),"You must pass an integer greater than 0 (representing the size) into the `identity` function!"),Vd(parseInt(r)===r,"You must pass an integer greater than 0 (representing the size) into the `identity` function!"),Vd(r>0,"You must pass an integer greater than 0 (representing the size) into the `identity` function!");let e=Pue([r,r]);for(let t=0;t<r;t++)e[t][t]=1;return e}$_.exports=Mue});var V_=O((jTt,U_)=>{U_.exports=["true","false","yes","no"]});var H_=O((KTt,G_)=>{G_.exports=["null","none","nan","na","n/a","","undefined"]});var J_=O((XTt,Y_)=>{var Bue=Rf(),Lue=$e(),que=V_(),zue=$0(),$ue=bf(),K_=Er(),ib=Ke(),Wue=dt(),j_=gf(),X_=at(),Uue=ft(),Vue=ta(),Gue=H_();function Gd(r){return r.type==="number"&&(typeof r.value<"u"?r.isInteger=parseInt(r.value)===r.value:r.isInteger=K_(r.values).every(e=>X_(e)?parseInt(e)===e:!0)),r}function Hd(r){if(Wue(r)){let a=r.copy(),i=Hd(r.values);return a.values=i.values,Gd({type:i.type,values:a})}if(Uue(r)){let a=r.copy(),i=Hd(r.values);return a.values=i.values,Gd({type:i.type,values:a})}if(!ib(r)){let a=Hd([r]);return a.value=a.values[0],delete a.values,Gd(a)}Lue(ib(r),"The `inferType` function only works on arrays, Series, and DataFrames!");let e=K_(r).map(a=>{if(a===void 0)return"null";try{if(typeof a=="object"){let s=new Date(a.getTime());if(j_(s))return"date"}}catch{}Vue(a)||(a=JSON.stringify(a));let o=a.toLowerCase().trim();if(Gue.indexOf(o)>-1)return"null";if(que.indexOf(o)>-1)return"boolean";try{let s=JSON.parse(a);return X_(s)?"number":typeof s=="object"?ib(s)?"string":"object":"string"}catch{let u=new Date(a);return j_(u)?"date":"string"}}),n=$ue(e).sort((a,i)=>i.count-a.count)[0].value;return Gd({type:n,values:Bue(r,a=>zue(a,n))})}Y_.exports=Hd});var Q_=O((YTt,Z_)=>{var Hue=at(),jue=jt();function Kue(r){try{let e=JSON.parse(r);return Hue(e)?parseInt(e):NaN}catch{return NaN}}Z_.exports=jue(Kue)});var t3=O((JTt,e3)=>{var Xue=$e(),Yue=Ke(),Jue=dt(),Zue=ki(),Que=ft(),ob=Va();function ece(){let r=Object.values(arguments).map(t=>Jue(t)||Que(t)?ob(t.values):(Xue(Yue(t),"The `intersect` function only works on arrays, Series, and DataFrames!"),ob(t)));return ob(r).filter(t=>r.every(n=>n.findIndex(a=>Zue(a,t))>-1))}e3.exports=ece});var i3=O((ZTt,a3)=>{var r3=_d(),es=$e(),tce=eb(),rce=Er(),nce=Ke(),ace=dt(),sb=at(),n3=Tc(),ice=dr();function jd(r){if(ace(r)){let t=r.copy();return t.values=jd(t.values),t}es(nce(r),"The `inverse` function only works on square 2-dimensional arrays or DataFrames!"),rce(r).forEach(t=>es(sb(t),"The array passed into the `inverse` function must contain only numbers!"));let e=ice(r);if(es(e.length===2,"The array passed into the `inverse` function must be exactly two-dimensional and square!"),es(e[0]===e[1],"The array passed into the `inverse` function must be exactly two-dimensional and square!"),es(e[0]>=0,"The array passed into the `inverse` function must be exactly two-dimensional and square!"),e[0]===0)return r;if(e[0]===1)return es(r[0][0]!==0,"This matrix cannot be inverted!"),1/r[0][0];if(e[0]===2){let t=r[0][0],n=r[0][1],a=r[1][0],i=r[1][1],o=t*i-n*a;es(o!==0,"This matrix cannot be inverted!");let s=[[i,-n],[-a,t]];return n3(s,1/o)}else if(e[0]>1){let t=(n,a)=>sb(n)||sb(a)?n3(n,a):tce(n,a);for(let n=1;n<e[0]-1;n++)try{let a=r.slice(0,n).map(m=>m.slice(0,n)),i=r.slice(0,n).map(m=>m.slice(n,e[0])),o=r.slice(n,e[0]).map(m=>m.slice(0,n)),s=r.slice(n,e[0]).map(m=>m.slice(n,e[0])),u=jd(a),c=jd(r3(s,t(-1,t(t(o,u),i)))),l=r3(u,t(t(t(t(u,i),c),o),u)),f=t(-1,t(t(u,i),c)),h=t(-1,t(t(c,o),u)),p=c;return l.map((m,v)=>m.concat(f[v])).concat(h.map((m,v)=>m.concat(p[v])))}catch{}es(!1,"This matrix cannot be inverted!")}}a3.exports=jd});var s3=O((QTt,o3)=>{var oce=new Function(`
    try {
      return this === window
    } catch(e) {}

    try {
      return !!importScripts
    } catch(e){}

    return false
  `);o3.exports=oce});var c3=O((eEt,u3)=>{var ub=at(),sce=jt();function uce(r,e,t){try{return ub(r)?ub(e)?ub(t)?t*(e-r)+r:NaN:NaN:NaN}catch{return NaN}}u3.exports=sce(uce)});var h3=O((tEt,f3)=>{var l3=at(),cce=St(),lce=jt();function fce(r,e){try{return e=cce(e)?Math.E:e,l3(r)?l3(e)?Math.log(r)/Math.log(e):NaN:NaN}catch{return NaN}}f3.exports=lce(fce)});var v3=O((rEt,d3)=>{var hce=$e(),pce=Er(),dce=Ke(),vce=dt(),mce=ft(),gce=Ko();function p3(r){if(vce(r)||mce(r))return p3(r.values);hce(dce(r),"The `median` function only works on arrays, Series, and DataFrames!");try{let e=gce(pce(r));return e.length===0?NaN:e.length%2===0?(e[e.length/2-1]+e[e.length/2])/2:e[parseInt(e.length/2)]}catch{return NaN}}d3.exports=p3});var y3=O((nEt,g3)=>{var m3=at(),yce=jt();function bce(r,e){try{return m3(r)?m3(e)?r%e:NaN:NaN}catch{return NaN}}g3.exports=yce(bce)});var k3=O((aEt,x3)=>{var wce=$e(),xce=bf(),kce=Er(),Sce=Ke(),Nce=dt(),Tce=ft(),Ece=Va(),b3=Ko();function w3(r){if(Nce(r)||Tce(r))return w3(r.values);wce(Sce(r),"The `mode` function only works on arrays, Series, and DataFrames!");try{if(r.length===0)return NaN;let e=kce(r);if(e.length===0)return NaN;let t={},n=Ece(e);n.forEach(s=>{t[s]=xce(e,s)});let a=b3(n,(s,u)=>t[u]-t[s]),i=a[0];return b3(a.filter(s=>t[s]===t[i]))}catch{return NaN}}x3.exports=w3});var E3=O((iEt,T3)=>{var{random:S3}=xc(),Ice=Rf(),Cce=St(),Ace=jo();function N3(){let r=S3(),e=S3();return Math.sqrt(-2*Math.log(r))*Math.cos(2*Math.PI*e)}function Dce(r){return Cce(r)?N3():Ice(Ace(r),N3)}T3.exports=Dce});var C3=O((oEt,I3)=>{var _ce=Rf(),Fce=jo();function Rce(r){return _ce(Fce(r),()=>1)}I3.exports=Rce});var D3=O((sEt,A3)=>{var cb=$e(),Oce=Er(),Pce=Ke(),Mce=dt(),Bce=at(),Lce=ft(),qce=St();function Kd(r,e){if(Mce(r)||Lce(r))return Kd(r.values,e);if(cb(Pce(r),"The `permutations` function only works on arrays, Series, and DataFrames!"),qce(e)&&(e=r.length),cb(Bce(e),"`r` must be a whole number!"),r=Oce(r),e>r.length)return Kd(r);if(e<=0)return[[]];if(cb(e===parseInt(e),"`r` must be a whole number!"),r.length<2)return r;let t=[];return r.forEach((n,a)=>{let i=r.slice(0,a),o=r.slice(a+1),s=i.concat(o);Kd(s,e-1).forEach(c=>{t.push([n].concat(c))})}),t}A3.exports=Kd});var F3=O((uEt,_3)=>{var{DataFrame:zce,Series:$ce}=_f(),Wce=Ke(),Uce=dt(),Vce=wf(),Gce=ft(),Hce=dr();function jce(){Object.keys(arguments).forEach(r=>{let e=arguments[r];if(Wce(e))if(Vce(e))console.log(e);else{let t=Hce(e);t.length===1?new $ce(e).print():t.length==2?new zce(e).print():console.log(e)}else Uce(e)||Gce(e)?e.print():console.log(e)})}_3.exports=jce});var P3=O((cEt,O3)=>{var Kce=Ke(),Xce=at(),R3=St(),Yce=Nc(),Jce=Fd(),Zce=jt(),Qce=Zce(function(r,e,t,n,a){try{return[r,e,t,n,a].every(i=>Xce(i))?t-e===0?NaN:(a-n)*(r-e)/(t-e)+n:NaN}catch{return NaN}});function ele(r,e,t,n,a){return Kce(r)&&R3(n)&&R3(a)&&(n=e,a=t,e=Jce(r),t=Yce(r)),Qce(r,e,t,n,a)}O3.exports=ele});var B3=O((lEt,M3)=>{var tle=at(),rle=jt();function nle(r){try{return tle(r)?Math.round(r):NaN}catch{return NaN}}M3.exports=rle(nle)});var q3=O((fEt,L3)=>{var ale=at(),ile=jt();function ole(r){try{return ale(r)?r<0?-1:r>0?1:0:NaN}catch{return NaN}}L3.exports=ile(ole)});var $3=O((hEt,z3)=>{var sle=at(),ule=jt();function cle(r){try{return sle(r)?Math.sin(r):NaN}catch{return NaN}}z3.exports=ule(cle)});var U3=O((pEt,W3)=>{var lle=Md();function fle(r){return lle(r)}W3.exports=fle});var G3=O((dEt,V3)=>{var hle=at(),ple=jt();function dle(r){try{return hle(r)?Math.tan(r):NaN}catch{return NaN}}V3.exports=ple(dle)});var Xd=O((vEt,K3)=>{var H3=$e(),j3=zn();function vle(r,e){H3(j3(r),"`fn` must be a function!");let t=new Date;return e?r(...e):r(),new Date-t}async function mle(r,e){H3(j3(r),"`fn` must be a function!");let t=new Date;return e?await r(...e):await r(),new Date-t}K3.exports={timeSync:vle,timeAsync:mle}});var Y3=O((mEt,X3)=>{var gle=Ke(),yle=dt(),ble=ft(),wle=Va();function xle(){return wle([...arguments].map(r=>gle(r)?r:yle(r)||ble(r)?r.values:[r]))}X3.exports=xle});var Z3=O((gEt,J3)=>{var kle=$e(),Sle=Ke(),Nle=dt(),Tle=ft(),Ele=St(),Ile=Nc(),Cle=Ca();function Ale(){let r=[],e=Object.values(arguments).map(t=>((Nle(t)||Tle(t))&&(t=t.values),kle(Sle(t),"The `zip` function only works on arrays, Series, and DataFrames!"),t));return Cle(0,Ile(e.map(t=>t.length))).forEach(t=>{let n=[];e.forEach(a=>{let i=a[t];n.push(Ele(i)?void 0:i)}),r.push(n)}),r}J3.exports=Ale});var Mt=O((yEt,lb)=>{var{copy:Dle,decycle:_le}=vo(),{DataFrame:Fle,Series:Rle}=_f(),Ec={abs:Dd(),add:_d(),apply:Rf(),arccos:MA(),arcsin:LA(),arctan:zA(),argmax:WA(),argmin:HA(),assert:$e(),cast:$0(),ceil:JA(),chop:eD(),clamp:rD(),combinations:aD(),copy:Dle,correl:ND(),cos:ED(),count:bf(),covariance:H0(),DataFrame:Fle,dataTypes:CD(),decycle:_le,diff:OD(),distance:KD(),divide:YD(),dot:eb(),dropMissing:tb(),dropMissingPairwise:h_(),dropNaN:b0(),dropNaNPairwise:w_(),dropUndefined:k_(),exp:N_(),factorial:I_(),find:__(),findAll:P_(),flatten:Er(),float:B_(),floor:q_(),identity:W_(),indexOf:vf(),inferType:J_(),int:Q_(),intersect:t3(),inverse:i3(),isArray:Ke(),isBoolean:Nd(),isBrowser:s3(),isDataFrame:dt(),isDate:gf(),isEqual:ki(),isFunction:zn(),isJagged:wf(),isNested:dd(),isNumber:at(),isObject:Ho(),isSeries:ft(),isString:ta(),isUndefined:St(),lerp:c3(),log:h3(),MathError:yc(),max:Nc(),mean:Rd(),median:v3(),min:Fd(),mod:y3(),mode:k3(),multiply:Y0(),ndarray:jo(),normal:E3(),ones:C3(),permutations:D3(),pow:Bd(),print:F3(),product:Tf(),random:xc().random,range:Ca(),remap:P3(),reshape:kd(),reverse:xf(),round:B3(),scale:Tc(),seed:xc().seed,Series:Rle,set:Va(),shape:dr(),shuffle:Sd(),sign:q3(),sin:$3(),sort:Ko(),sqrt:Pd(),std:Md(),stdev:U3(),subtract:J0(),sum:Ld(),tan:G3(),time:Xd().timeSync,timeSync:Xd().timeSync,timeAsync:Xd().timeAsync,transpose:Zs(),union:Y3(),variance:j0(),vectorize:jt(),zeros:ab(),zip:Z3(),dump:function(){let r=typeof globalThis<"u"?globalThis:typeof global<"u"?global:typeof window<"u"?window:typeof self<"u"?self:void 0;if(!r)throw new Ec.MathError("Cannot dump functions into global scope because none of `globalThis`, `global`, `window`, or `self` exist in the current context!");Object.keys(Ec).forEach(e=>{try{Object.defineProperty(r,e,{configurable:!1,enumerable:!0,writable:!1,value:Ec[e]})}catch{r[e]=Ec[e]}})}};typeof lb<"u"&&(lb.exports=Ec);typeof window<"u"&&(window.JSMathTools=Ec)});var Q3=O(()=>{});var eF=O(()=>{});var Yd=O(()=>{});var mu=O(D=>{"use strict";function Ole(r,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){if(n!=="default"&&!(n in r)){var a=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,a.get?a:{enumerable:!0,get:function(){return t[n]}})}})}),r}var gb=function(r,e){return gb=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},gb(r,e)};function xo(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");gb(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Ue(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(f){o(f)}}function u(l){try{c(n.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((n=n.apply(r,e||[])).next())})}function Ve(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function vn(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Se(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function Et(r,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}var Ple=1e-7,Mle=1e-4,Ble=function(){function r(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return r.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},r.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},r.prototype.has=function(e){return this.data.has(e)},r.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},r.prototype.numDataIds=function(){return this.dataIdsCount},r}(),kF=function(){function r(){}return r.prototype.refCount=function(e){return na("refCount")},r.prototype.incRef=function(e){return na("incRef")},r.prototype.timerAvailable=function(){return!0},r.prototype.time=function(e){return na("time")},r.prototype.read=function(e){return na("read")},r.prototype.readSync=function(e){return na("readSync")},r.prototype.readToGPU=function(e,t){return na("readToGPU")},r.prototype.numDataIds=function(){return na("numDataIds")},r.prototype.disposeData=function(e,t){return na("disposeData")},r.prototype.write=function(e,t,n){return na("write")},r.prototype.move=function(e,t,n,a,i){return na("move")},r.prototype.createTensorFromGPUData=function(e,t,n){return na("createTensorFromGPUData")},r.prototype.memory=function(){return na("memory")},r.prototype.floatPrecision=function(){return na("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?Ple:Mle},r.prototype.dispose=function(){return na("dispose")},r}();function na(r){throw new Error("'".concat(r,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function SF(r){for(var e=r.length,t=0;e>0;)t=Math.random()*e|0,e--,nv(r,e,t)}function Lle(r,e){if(r.length!==e.length)throw new Error("Array sizes must match to be shuffled together "+"First array length was ".concat(r.length)+"Second array length was ".concat(e.length));for(var t=r.length,n=0;t>0;)n=Math.random()*t|0,t--,nv(r,t,n),nv(e,t,n)}function zf(r,e,t){return Math.max(r,Math.min(e,t))}function qle(r){return r%2===0?r:r+1}function nv(r,e,t){var n=r[e];r[e]=r[t],r[t]=n}function zle(r){for(var e=0,t=0;t<r.length;t++)e+=r[t];return e}function $le(r,e){var t=Math.random();return e*t+(1-t)*r}function Wle(r,e){for(var t=0,n=0;n<r.length;n++){var a=Number(r[n])-Number(e[n]);t+=a*a}return t}function W(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function Fn(r,e,t){t===void 0&&(t=""),W(ko(r,e),function(){return t+" Shapes ".concat(r," and ").concat(e," must match")})}function hu(r){W(r!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Vt(r){if(r.length===0)return 1;for(var e=r[0],t=1;t<r.length;t++)e*=r[t];return e}function Ule(r){return r.length===0}function NF(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==null&&e[t]!==null&&r[t]!==e[t])return!1;return!0}function ko(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function Bc(r){return r%1===0}function Vle(r){if(Math.tanh!=null)return Math.tanh(r);if(r===1/0)return 1;if(r===-1/0)return-1;var e=Math.exp(2*r);return(e-1)/(e+1)}function Gle(r){var e=Math.ceil(Math.sqrt(r));return[e,Math.ceil(r/e)]}function Hle(r){for(var e=new Uint32Array(r),t=0;t<r;++t)e[t]=t;return SF(e),e}function Bf(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function jle(r,e,t,n){return e===void 0&&(e=function(a){return 0}),new Promise(function(a,i){var o=0,s=function(){if(r()){a();return}o++;var u=e(o);if(t!=null&&o>=t){i();return}n!=null?n(s,u):setTimeout(s,u)};s()})}function Kle(r,e){for(var t=1,n=-1,a=0;a<r.length;++a)if(r[a]>=0)t*=r[a];else if(r[a]===-1){if(n!==-1)throw Error("Shapes can only have 1 implicit size. "+"Found -1 at dim ".concat(n," and dim ").concat(a));n=a}else if(r[a]<0)throw Error("Shapes can not be < 0. Found ".concat(r[a]," at dim ").concat(a));if(n===-1){if(e>0&&e!==t)throw Error("Size(".concat(e,") must match the product of shape ").concat(r));return r}if(t===0)throw Error("Cannot infer the missing size in [".concat(r,"] when ")+"there are 0 elements");if(e%t!==0)throw Error("The implicit shape can't be a fractional number. "+"Got ".concat(e," / ").concat(t));var i=r.slice();return i[n]=e/t,i}function th(r,e){var t=e.length;return r=r==null?e.map(function(n,a){return a}):[].concat(r),W(r.every(function(n){return n>=-t&&n<t}),function(){return"All values in axis param must be in range [-".concat(t,", ").concat(t,") but ")+"got axis ".concat(r)}),W(r.every(function(n){return Bc(n)}),function(){return"All values in axis param must be integers but "+"got axis ".concat(r)}),r.map(function(n){return n<0?t+n:n})}function TF(r,e){for(var t=[],n=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:th(e,r).sort(),o=0,s=0;s<r.length;++s){if(i!=null){if(i[o]===s&&r[s]!==1)throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(r[s],"' is not 1"));(i[o]==null||i[o]>s)&&r[s]===1&&(t.push(r[s]),n.push(s)),i[o]<=s&&o++}r[s]!==1&&(t.push(r[s]),n.push(s))}return{newShape:t,keptDims:n}}function EF(r,e){return Ub(r,e)}function Ub(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else if(r==="string")t=new Array(e);else throw new Error("Unknown data type ".concat(r));return t}function IF(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type ".concat(e," being uploaded contains ").concat(n,"."))}}function CF(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function Xle(r,e){return!(e==="complex64"||e==="float32"&&r!=="complex64"||e==="int32"&&r!=="float32"&&r!=="complex64"||e==="bool"&&r==="bool")}function av(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype ".concat(r))}function AF(r){if(r==null)return 0;var e=0;return r.forEach(function(t){return e+=t.length}),e}function ns(r){return typeof r=="string"||r instanceof String}function DF(r){return typeof r=="boolean"}function _F(r){return typeof r=="number"}function rh(r){return Array.isArray(r)?rh(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":_F(r)?"float32":ns(r)?"string":DF(r)?"bool":"float32"}function ss(r){return!!(r&&r.constructor&&r.call&&r.apply)}function iv(r,e){for(var t=e;t<r;++t)if(r%t===0)return t;return r}function $c(r){var e=r.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=r[e-1];for(var n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function FF(r,e,t,n){n===void 0&&(n=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(n?2:1),o=0;o<i;o++)a[o]=t[r+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(l,f){return l*f})*(n?2:1),o=0;o<i;o++)a[o]=FF(r+o*u,s,t,n);return a}function _c(r,e,t){if(t===void 0&&(t=!1),r.length===0)return e[0];var n=r.reduce(function(a,i){return a*i})*(t?2:1);if(n===0)return[];if(n!==e.length)throw new Error("[".concat(r,"] does not match the input size ").concat(e.length).concat(t?" for a complex tensor":"","."));return FF(0,r,e,t)}function Yle(r,e){if(Array.isArray(r))return r;if(e==="float32")return r instanceof Float32Array?r:new Float32Array(r);if(e==="int32")return r instanceof Int32Array?r:new Int32Array(r);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(r));throw new Error("Unknown dtype ".concat(e))}function Vb(r,e){for(var t=mv(r,e),n=0;n<t.length;n++)t[n]=1;return t}function mv(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error("Unknown data type ".concat(e))}function Jle(r,e){var t=r.reduce(function(n,a){return n*a},1);if(e==null||e==="float32")return _c(r,new Float32Array(t));if(e==="int32")return _c(r,new Int32Array(t));if(e==="bool")return _c(r,new Uint8Array(t));throw new Error("Unknown data type ".concat(e))}function oa(r){r.forEach(function(e){W(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(r,"].")})})}function Zle(r,e,t){if(e===0)return 0;if(e===1)return r[0];for(var n=r[r.length-1],a=0;a<r.length-1;++a)n+=t[a]*r[a];return n}function Qle(r,e,t){if(e===0)return[];if(e===1)return[r];for(var n=new Array(e),a=0;a<n.length-1;++a)n[a]=Math.floor(r/t[a]),r-=n[a]*t[a];return n[n.length-1]=r,n}function gv(r){return r&&r.then&&typeof r.then=="function"}var tF="tfjsflags",RF=function(){function r(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=efe,this.populateURLFlags()}return r.prototype.setPlatform=function(e,t){this.platform!=null&&(yt().getBool("IS_TEST")||yt().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t},r.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){var a=this.urlFlags[e];yt().getBool("IS_TEST")||yt().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(a,".")),this.set(e,a)}},r.prototype.getAsync=function(e){return Ue(this,void 0,void 0,function(){var t,n;return Ve(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,n=e,[4,this.evaluateFlag(e)]);case 1:return t[n]=a.sent(),[2,this.flags[e]]}})})},r.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(gv(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},r.prototype.getNumber=function(e){return this.get(e)},r.prototype.getBool=function(e){return this.get(e)},r.prototype.getString=function(e){return this.get(e)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!1,configurable:!0}),r.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},r.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()},r.prototype.setFlags=function(e){this.flags=Object.assign({},e)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if(tF in t){var n=t[tF].split(",");n.forEach(function(a){var i=Se(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=rfe(o,s)})}}},r}();function efe(r){var e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];return tfe(e,n[0],n[1]),n.join("=")}),e}function tfe(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function rfe(r,e){var t=e.toLowerCase();return t==="true"||t==="false"?t==="true":"".concat(+t)===t?+t:e}function yt(){return D.ENV}D.ENV=null;function nfe(r){D.ENV=r}var fb;function OF(){if(fb==null){var r=void 0;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");fb=r}return fb}function afe(){var r=OF();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function Gb(r,e){var t=afe();if(t.has(r))return t.get(r);var n=e();return t.set(r,n),t.get(r)}var PF="Abs",MF="Acos",BF="Acosh",Hb="Add",LF="AddN",qF="All",zF="Any",$F="ArgMax",WF="ArgMin",UF="Asin",VF="Asinh",GF="Atan",HF="Atanh",jF="Atan2",KF="AvgPool",ife="AvgPoolGrad",XF="AvgPool3D",ofe="AvgPool3DGrad",YF="BatchMatMul",JF="BatchToSpaceND",ZF="Bincount",QF="BitwiseAnd",sfe="BroadcastTo",eR="BroadcastArgs",jb="Cast",tR="Ceil",rR="ClipByValue",nR="Complex",aR="ComplexAbs",iR="Concat",oR="Conv2D",sR="Conv2DBackpropFilter",uR="Conv2DBackpropInput",cR="Conv3D",ufe="Conv3DBackpropFilterV2",lR="Conv3DBackpropInputV2",fR="Cos",hR="Cosh",pR="Cumprod",dR="Cumsum",vR="CropAndResize",mR="DenseBincount",gR="DepthToSpace",yR="DepthwiseConv2dNative",bR="DepthwiseConv2dNativeBackpropFilter",wR="DepthwiseConv2dNativeBackpropInput",xR="Diag",kR="Dilation2D",cfe="Dilation2DBackpropInput",lfe="Dilation2DBackpropFilter",Kb="Draw",SR="RealDiv",NR="Einsum",TR="Elu",ffe="EluGrad",ER="Erf",IR="Equal",CR="Exp",AR="ExpandDims",DR="Expm1",_R="FFT",FR="Fill",RR="FlipLeftRight",OR="Floor",PR="FloorDiv",MR="FusedBatchNorm",BR="GatherV2",LR="GatherNd",qR="Greater",zR="GreaterEqual",Xb="Identity",$R="IFFT",WR="Imag",UR="IsFinite",VR="IsInf",GR="IsNan",HR="LeakyRelu",jR="Less",KR="LessEqual",XR="LinSpace",YR="Log",JR="Log1p",ZR="LogicalAnd",QR="LogicalNot",eO="LogicalOr",hfe="LogicalXor",pfe="LogSoftmax",dfe="LowerBound",tO="LRN",vfe="LRNGrad",mfe="MatrixBandPart",rO="Max",nO="Maximum",aO="MaxPool",gfe="MaxPoolGrad",iO="MaxPool3D",yfe="MaxPool3DGrad",oO="MaxPoolWithArgmax",sO="Mean",uO="Min",cO="Minimum",lO="MirrorPad",fO="Mod",hO="Multinomial",pO="Multiply",dO="Neg",vO="NotEqual",mO="NonMaxSuppressionV3",gO="NonMaxSuppressionV4",yO="NonMaxSuppressionV5",bO="OnesLike",wO="OneHot",xO="Pack",kO="PadV2",bfe="Pool",SO="Pow",NO="Prelu",TO="Prod",EO="RaggedGather",IO="RaggedRange",CO="RaggedTensorToTensor",AO="Range",DO="Real",_O="Reciprocal",FO="Relu",RO="Reshape",OO="ResizeNearestNeighbor",wfe="ResizeNearestNeighborGrad",PO="ResizeBilinear",xfe="ResizeBilinearGrad",MO="Relu6",BO="Reverse",LO="Round",qO="Rsqrt",zO="ScatterNd",$O="TensorScatterUpdate",WO="SearchSorted",UO="Select",VO="Selu",GO="Slice",HO="Sin",jO="Sinh",KO="Sign",XO="Sigmoid",YO="Softplus",JO="Sqrt",ZO="Sum",QO="SpaceToBatchND",eP="SplitV",tP="Softmax",rP="SparseFillEmptyRows",nP="SparseReshape",aP="SparseSegmentMean",iP="SparseSegmentSum",oP="SparseToDense",sP="SquaredDifference",kfe="Square",uP="StaticRegexReplace",cP="StridedSlice",lP="StringNGrams",fP="StringSplit",hP="StringToHashBucketFast",pP="Sub",dP="Tan",vP="Tanh",Yb="Tile",mP="TopK",gP="Transform",Qd="Transpose",yP="Unique",bP="Unpack",wP="UnsortedSegmentSum",Sfe="UpperBound",xP="ZerosLike",kP="Step",yb="FromPixels",SP="RotateWithOffset",bb="_FusedMatMul",wb="FusedConv2D",xb="FusedDepthwiseConv2D";function rs(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];yt().getBool("IS_TEST")||yt().getBool("PROD")||console.warn.apply(console,Et([],Se(r),!1))}function Nfe(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];yt().getBool("IS_TEST")||yt().getBool("PROD")||console.log.apply(console,Et([],Se(r),!1))}var Lc=Gb("kernelRegistry",function(){return new Map}),$f=Gb("gradRegistry",function(){return new Map});function Wf(r,e){var t=Jb(r,e);return Lc.get(t)}function kb(r){return $f.get(r)}function ov(r){for(var e=Lc.entries(),t=[];;){var n=e.next(),a=n.done,i=n.value;if(a)break;var o=Se(i,2),s=o[0],u=o[1],c=Se(s.split("_"),1),l=c[0];l===r&&t.push(u)}return t}function NP(r){var e=r.kernelName,t=r.backendName,n=Jb(e,t);Lc.has(n)&&rs("The kernel '".concat(e,"' for backend ")+"'".concat(t,"' is already registered")),Lc.set(n,r)}function Tfe(r){var e=r.kernelName;$f.has(e)&&yt().getBool("DEBUG")&&rs("Overriding the gradient for '".concat(e,"'")),$f.set(e,r)}function Efe(r,e){var t=Jb(r,e);if(!Lc.has(t))throw new Error("The kernel '".concat(r,"' for backend ")+"'".concat(e,"' is not registered"));Lc.delete(t)}function Ife(r){if(!$f.has(r))throw new Error("The gradient '".concat(r,"' for backend is not registered"));$f.delete(r)}function Cfe(r,e){var t=ov(r);t.forEach(function(n){var a=Object.assign({},n,{backendName:e});NP(a)})}function Jb(r,e){return"".concat(e,"_").concat(r)}function TP(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}var pu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Afe(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var EP=tr,ja=null;try{ja=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function tr(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}tr.prototype.__isLong__;Object.defineProperty(tr.prototype,"__isLong__",{value:!0});function sa(r){return(r&&r.__isLong__)===!0}tr.isLong=sa;var rF={},nF={};function du(r,e){var t,n,a;return e?(r>>>=0,(a=0<=r&&r<256)&&(n=nF[r],n)?n:(t=rr(r,(r|0)<0?-1:0,!0),a&&(nF[r]=t),t)):(r|=0,(a=-128<=r&&r<128)&&(n=rF[r],n)?n:(t=rr(r,r<0?-1:0,!1),a&&(rF[r]=t),t))}tr.fromInt=du;function Ka(r,e){if(isNaN(r))return e?ru:Xa;if(e){if(r<0)return ru;if(r>=IP)return DP}else{if(r<=-iF)return aa;if(r+1>=iF)return AP}return r<0?Ka(-r,e).neg():rr(r%qc|0,r/qc|0,e)}tr.fromNumber=Ka;function rr(r,e,t){return new tr(r,e,t)}tr.fromBits=rr;var sv=Math.pow;function Zb(r,e,t){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return Xa;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return Zb(r.substring(1),e,t).neg();for(var a=Ka(sv(t,8)),i=Xa,o=0;o<r.length;o+=8){var s=Math.min(8,r.length-o),u=parseInt(r.substring(o,o+s),t);if(s<8){var c=Ka(sv(t,s));i=i.mul(c).add(Ka(u))}else i=i.mul(a),i=i.add(Ka(u))}return i.unsigned=e,i}tr.fromString=Zb;function Ti(r,e){return typeof r=="number"?Ka(r,e):typeof r=="string"?Zb(r,e):rr(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}tr.fromValue=Ti;var aF=1<<16,Dfe=1<<24,qc=aF*aF,IP=qc*qc,iF=IP/2,oF=du(Dfe),Xa=du(0);tr.ZERO=Xa;var ru=du(0,!0);tr.UZERO=ru;var Dc=du(1);tr.ONE=Dc;var CP=du(1,!0);tr.UONE=CP;var Sb=du(-1);tr.NEG_ONE=Sb;var AP=rr(-1,2147483647,!1);tr.MAX_VALUE=AP;var DP=rr(-1,-1,!0);tr.MAX_UNSIGNED_VALUE=DP;var aa=rr(0,-2147483648,!1);tr.MIN_VALUE=aa;var _e=tr.prototype;_e.toInt=function(){return this.unsigned?this.low>>>0:this.low};_e.toNumber=function(){return this.unsigned?(this.high>>>0)*qc+(this.low>>>0):this.high*qc+(this.low>>>0)};_e.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(aa)){var t=Ka(e),n=this.div(t),a=n.mul(t).sub(this);return n.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Ka(sv(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};_e.getHighBits=function(){return this.high};_e.getHighBitsUnsigned=function(){return this.high>>>0};_e.getLowBits=function(){return this.low};_e.getLowBitsUnsigned=function(){return this.low>>>0};_e.getNumBitsAbs=function(){if(this.isNegative())return this.eq(aa)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};_e.isZero=function(){return this.high===0&&this.low===0};_e.eqz=_e.isZero;_e.isNegative=function(){return!this.unsigned&&this.high<0};_e.isPositive=function(){return this.unsigned||this.high>=0};_e.isOdd=function(){return(this.low&1)===1};_e.isEven=function(){return(this.low&1)===0};_e.equals=function(e){return sa(e)||(e=Ti(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};_e.eq=_e.equals;_e.notEquals=function(e){return!this.eq(e)};_e.neq=_e.notEquals;_e.ne=_e.notEquals;_e.lessThan=function(e){return this.comp(e)<0};_e.lt=_e.lessThan;_e.lessThanOrEqual=function(e){return this.comp(e)<=0};_e.lte=_e.lessThanOrEqual;_e.le=_e.lessThanOrEqual;_e.greaterThan=function(e){return this.comp(e)>0};_e.gt=_e.greaterThan;_e.greaterThanOrEqual=function(e){return this.comp(e)>=0};_e.gte=_e.greaterThanOrEqual;_e.ge=_e.greaterThanOrEqual;_e.compare=function(e){if(sa(e)||(e=Ti(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};_e.comp=_e.compare;_e.negate=function(){return!this.unsigned&&this.eq(aa)?aa:this.not().add(Dc)};_e.neg=_e.negate;_e.add=function(e){sa(e)||(e=Ti(e));var t=this.high>>>16,n=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,p=0;return p+=i+c,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=n+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,rr(h<<16|p,l<<16|f,this.unsigned)};_e.subtract=function(e){return sa(e)||(e=Ti(e)),this.add(e.neg())};_e.sub=_e.subtract;_e.multiply=function(e){if(this.isZero())return Xa;if(sa(e)||(e=Ti(e)),ja){var t=ja.mul(this.low,this.high,e.low,e.high);return rr(t,ja.get_high(),this.unsigned)}if(e.isZero())return Xa;if(this.eq(aa))return e.isOdd()?aa:Xa;if(e.eq(aa))return this.isOdd()?aa:Xa;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(oF)&&e.lt(oF))return Ka(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*l,p+=d>>>16,d&=65535,p+=i*l,h+=p>>>16,p&=65535,p+=o*c,h+=p>>>16,p&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=n*l+a*c+i*u+o*s,f&=65535,rr(p<<16|d,f<<16|h,this.unsigned)};_e.mul=_e.multiply;_e.divide=function(e){if(sa(e)||(e=Ti(e)),e.isZero())throw Error("division by zero");if(ja){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?ja.div_u:ja.div_s)(this.low,this.high,e.low,e.high);return rr(t,ja.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?ru:Xa;var n,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return ru;if(e.gt(this.shru(1)))return CP;i=ru}else{if(this.eq(aa)){if(e.eq(Dc)||e.eq(Sb))return aa;if(e.eq(aa))return Dc;var o=this.shr(1);return n=o.div(e).shl(1),n.eq(Xa)?e.isNegative()?Dc:Sb:(a=this.sub(e.mul(n)),i=n.add(a.div(e)),i)}else if(e.eq(aa))return this.unsigned?ru:Xa;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Xa}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:sv(2,s-48),c=Ka(n),l=c.mul(e);l.isNegative()||l.gt(a);)n-=u,c=Ka(n,this.unsigned),l=c.mul(e);c.isZero()&&(c=Dc),i=i.add(c),a=a.sub(l)}return i};_e.div=_e.divide;_e.modulo=function(e){if(sa(e)||(e=Ti(e)),ja){var t=(this.unsigned?ja.rem_u:ja.rem_s)(this.low,this.high,e.low,e.high);return rr(t,ja.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};_e.mod=_e.modulo;_e.rem=_e.modulo;_e.not=function(){return rr(~this.low,~this.high,this.unsigned)};_e.and=function(e){return sa(e)||(e=Ti(e)),rr(this.low&e.low,this.high&e.high,this.unsigned)};_e.or=function(e){return sa(e)||(e=Ti(e)),rr(this.low|e.low,this.high|e.high,this.unsigned)};_e.xor=function(e){return sa(e)||(e=Ti(e)),rr(this.low^e.low,this.high^e.high,this.unsigned)};_e.shiftLeft=function(e){return sa(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?rr(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):rr(0,this.low<<e-32,this.unsigned)};_e.shl=_e.shiftLeft;_e.shiftRight=function(e){return sa(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?rr(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):rr(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};_e.shr=_e.shiftRight;_e.shiftRightUnsigned=function(e){if(sa(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var n=this.low;return rr(n>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?rr(t,0,this.unsigned):rr(t>>>e-32,0,this.unsigned)};_e.shru=_e.shiftRightUnsigned;_e.shr_u=_e.shiftRightUnsigned;_e.toSigned=function(){return this.unsigned?rr(this.low,this.high,!1):this};_e.toUnsigned=function(){return this.unsigned?this:rr(this.low,this.high,!0)};_e.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};_e.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};_e.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};tr.fromBytes=function(e,t,n){return n?tr.fromBytesLE(e,t):tr.fromBytesBE(e,t)};tr.fromBytesLE=function(e,t){return new tr(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};tr.fromBytesBE=function(e,t){return new tr(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var _P=Afe(EP),_fe=Ole({__proto__:null,default:_P},[EP]),tu=_P||_fe;function nh(r){return tu.fromString(r,!0,16)}var FP=nh("c3a5c85c97cb3127"),eu=nh("b492b66fbe98f273"),_n=nh("9ae16a3b2f90404f");function Nb(r){return r.xor(r.shru(47))}function RP(r,e,t){var n=r.slice(e,e+t);return tu.fromBytes(Array.from(n),!0,!0)}function Jt(r,e){return RP(r,e,8)}function sF(r,e){return RP(r,e,4)}function an(r,e){return e===0?r:r.shru(e).or(r.shl(64-e))}function is(r,e,t){t===void 0&&(t=nh("9ddfea08eb382d69"));var n=r.xor(e).mul(t);n=n.xor(n.shru(47));var a=e.xor(n).mul(t);return a=a.xor(a.shru(47)),a=a.mul(t),a}function Ffe(r,e,t,n,a,i){a=a.add(r),i=an(i.add(a).add(n),21);var o=a;return a=a.add(e),a=a.add(t),i=i.add(an(a,44)),[a.add(n),i.add(o)]}function Jd(r,e,t,n){return Ffe(Jt(r,e),Jt(r,e+8),Jt(r,e+16),Jt(r,e+24),t,n)}function Rfe(r,e){if(e===void 0&&(e=r.length),e>=8){var t=_n.add(e*2),n=Jt(r,0).add(_n),a=Jt(r,e-8),i=an(a,37).mul(t).add(n),o=an(n,25).add(a).mul(t);return is(i,o,t)}if(e>=4){var t=_n.add(e*2),n=sF(r,0);return is(n.shl(3).add(e),sF(r,e-4),t)}if(e>0){var n=r[0],a=r[e>>1],i=r[e-1],s=n+(a<<8),u=e+(i<<2);return Nb(_n.mul(s).xor(FP.mul(u))).mul(_n)}return _n}function Ofe(r,e){e===void 0&&(e=r.length);var t=_n.add(e*2),n=Jt(r,0).mul(eu),a=Jt(r,8),i=Jt(r,e-8).mul(t),o=Jt(r,e-16).mul(_n);return is(an(n.add(a),43).add(an(i,30)).add(o),n.add(an(a.add(_n),18)).add(i),t)}function Pfe(r,e){e===void 0&&(e=r.length);var t=_n.add(e*2),n=Jt(r,0).mul(_n),a=Jt(r,8),i=Jt(r,e-8).mul(t),o=Jt(r,e-16).mul(_n),s=an(n.add(a),43).add(an(i,30)).add(o),u=is(s,n.add(an(a.add(_n),18)).add(i),t),c=Jt(r,16).mul(t),l=Jt(r,24),f=s.add(Jt(r,e-32)).mul(t),h=u.add(Jt(r,e-24)).mul(t);return is(an(c.add(l),43).add(an(f,30)).add(h),c.add(an(l.add(n),18)).add(f),t)}function Mfe(r,e){var t,n;e===void 0&&(e=r.length);var a=tu.fromNumber(81,!0);if(e<=32)return e<=16?Rfe(r,e):Ofe(r,e);if(e<=64)return Pfe(r,e);var i=a,o=a.mul(eu).add(113),s=Nb(o.mul(_n).add(113)).mul(_n),u=[tu.UZERO,tu.UZERO],c=[tu.UZERO,tu.UZERO];i=i.mul(_n).add(Jt(r,0));var l=0,f=(e-1>>6)*64,h=f+(e-1&63)-63;do i=an(i.add(o).add(u[0]).add(Jt(r,l+8)),37).mul(eu),o=an(o.add(u[1]).add(Jt(r,l+48)),42).mul(eu),i=i.xor(c[1]),o=o.add(u[0]).add(Jt(r,l+40)),s=an(s.add(c[0]),33).mul(eu),u=Jd(r,l,u[1].mul(eu),i.add(c[0])),c=Jd(r,l+32,s.add(c[1]),o.add(Jt(r,l+16))),t=Se([i,s],2),s=t[0],i=t[1],l+=64;while(l!==f);var p=eu.add(s.and(255).shl(1));return l=h,c[0]=c[0].add(e-1&63),u[0]=u[0].add(c[0]),c[0]=c[0].add(u[0]),i=an(i.add(o).add(u[0]).add(Jt(r,l+8)),37).mul(p),o=an(o.add(u[1]).add(Jt(r,l+48)),42).mul(p),i=i.xor(c[1].mul(9)),o=o.add(u[0].mul(9).add(Jt(r,l+40))),s=an(s.add(c[0]),33).mul(p),u=Jd(r,l,u[1].mul(p),i.add(c[0])),c=Jd(r,l+32,s.add(c[1]),o.add(Jt(r,l+16))),n=Se([i,s],2),s=n[0],i=n[1],is(is(u[0],c[0],p).add(Nb(o).mul(FP)).add(s),is(u[1],c[1],p).add(i),p)}function Bfe(r,e){return e==="string"?ah(r):yv([r],e)}function Lfe(r,e){return r instanceof Float32Array&&e==="float32"||r instanceof Int32Array&&e==="int32"||r instanceof Uint8Array&&e==="bool"}function yv(r,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=us(r)),yt().getBool("DEBUG")&&IF(r,e),Lfe(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){for(var t=new Uint8Array(r.length),n=0;n<t.length;++n)Math.round(r[n])!==0&&(t[n]=1);return t}else throw new Error("Unknown data type ".concat(e))}function Uf(){return yt().platform.now()}function qfe(r,e){return yt().platform.fetch(r,e)}function ah(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",yt().platform.encode(r,e)}function uv(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",yt().platform.decode(r,e)}function on(r){return yt().platform.isTypedArray!=null?yt().platform.isTypedArray(r):TP(r)}function us(r,e,t){var n,a;if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),typeof r=="boolean"||typeof r=="number"||typeof r=="string"||gv(r)||r==null||on(r)&&t)e.push(r);else if(Array.isArray(r)||on(r))for(var i=0;i<r.length;++i)us(r[i],e,t);else{var o=-1;try{for(var s=vn(Object.keys(r)),u=s.next();!u.done;u=s.next()){var c=u.value;/^([1-9]+[0-9]*|0)$/.test(c)&&(o=Math.max(o,Number(c)))}}catch(l){n={error:l}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}for(var i=0;i<=o;i++)us(r[i],e,t)}return e}var zfe={__proto__:null,arraysEqual:ko,arraysEqualWithNull:NF,assert:W,assertNonNegativeIntegerDimensions:oa,assertNonNull:hu,assertShapesMatch:Fn,bytesFromStringArray:AF,bytesPerElement:av,checkConversionForErrors:IF,clamp:zf,computeStrides:$c,convertBackendValuesAndArrayBuffer:Yle,createScalarValue:Bfe,createShuffledIndices:Hle,decodeString:uv,distSquared:Wle,encodeString:ah,fetch:qfe,fingerPrint64:Mfe,flatten:us,getArrayFromDType:Ub,getTypedArrayFromDType:EF,hasEncodingLoss:Xle,hexToLong:nh,indexToLoc:Qle,inferDtype:rh,inferFromImplicitShape:Kle,isBoolean:DF,isFunction:ss,isInt:Bc,isNumber:_F,isPromise:gv,isScalarShape:Ule,isString:ns,isTypedArray:on,isValidDtype:CF,locToIndex:Zle,makeOnesTypedArray:Vb,makeZerosNestedTypedArray:Jle,makeZerosTypedArray:mv,nearestDivisor:iv,nearestLargerEven:qle,now:Uf,parseAxisParam:th,randUniform:$le,repeatedTry:jle,rightPad:Bf,shuffle:SF,shuffleCombo:Lle,sizeFromShape:Vt,sizeToSquarishShape:Gle,squeezeShape:TF,sum:zle,swap:nv,tanh:Vle,toNestedArray:_c,toTypedArray:yv},$fe=function(){function r(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new Ufe)}return r.prototype.profileKernel=function(e,t,n){var a,i,o,s=function(){o=n()},u,c=Uf();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var l=vn(o),f=l.next();!f.done;f=l.next()){var h=f.value;h.dataSync()}}catch(v){a={error:v}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:Uf()-c})}if(yt().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var p=function(v){var g=o[v];g.data().then(function(y){Wfe(y,g.dtype,e)})},d=0;d<o.length;d++)p(d);var m={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(v){return v.kernelMs}),extraInfo:u.then(function(v){return v.getExtraProfileInfo!=null?v.getExtraProfileInfo():""})};return m},r.prototype.logKernelProfile=function(e){var t=this,n=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(c){t.logger.logKernelProfile(n,u,c[0],c[1],o,c[2])})})},r}();function Wfe(r,e,t){if(e!=="float32")return!1;for(var n=0;n<r.length;n++){var a=r[n];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(t,"'")),!0}return!1}var Ufe=function(){function r(){}return r.prototype.logKernelProfile=function(e,t,n,a,i,o){var s=typeof a=="number"?Bf("".concat(a,"ms"),9):a.error,u=Bf(e,25),c=t.rank,l=t.size,f=Bf(t.shape.toString(),14),h="";for(var p in i){var d=i[p];if(d!=null){var m=d.shape||t.shape,v=m.length;h+="".concat(p,": ").concat(v,"D ").concat(v>0?m:""," ")}}console.log("%c".concat(u,"	%c").concat(s,"	%c").concat(c,"D ").concat(f,"	%c").concat(l,"	%c").concat(h,"	%c").concat(o),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r}();function Vfe(r,e,t){for(var n={},a={},i=0;i<e.length;i++)n[e[i].id]=!0;for(var i=0;i<r.length;i++){var o=r[i],s=o.inputs;for(var u in s){for(var c=s[u],l=!1,f=0;f<e.length;f++)if(n[c.id]){o.outputs.forEach(function(w){return n[w.id]=!0}),l=!0,a[o.id]=!0;break}if(l)break}}var h={};h[t.id]=!0;for(var p={},i=r.length-1;i>=0;i--)for(var o=r[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,p[o.id]=!0;break}for(var d=[],i=0;i<r.length;i++){var o=r[i];if(a[o.id]&&p[o.id]){var m={};for(var u in o.inputs){var v=o.inputs[u];n[v.id]&&(m[u]=v)}var g=Object.assign({},o);g.inputs=m,g.outputs=o.outputs,d.push(g)}}return d}function Gfe(r,e,t,n){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var p=r[h.id];p!=null?u.push(p):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(s.kernelName,"."));var c=s.gradient(u),l=function(h){if(!(h in c))throw new Error("Cannot backprop through input ".concat(h,". ")+"Available gradients found: ".concat(Object.keys(c),"."));var p=t(function(){return c[h]()});if(p.dtype!=="float32")throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"".concat(h," must have 'float32' dtype, but has '").concat(p.dtype,"'"));var d=s.inputs[h];if(!ko(p.shape,d.shape))throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"'".concat(h,"' has shape '").concat(p.shape,"', which does not match ")+"the shape of the input '".concat(d.shape,"'"));if(r[d.id]==null)r[d.id]=p;else{var m=r[d.id];r[d.id]=n(m,p),m.dispose()}};for(var f in s.inputs)l(f)},i=e.length-1;i>=0;i--)a(i)}var uF=20,Of=3,hb=7;function Hfe(r,e,t,n){var a=$c(e),i=jfe(r,e,t,a),o=e.length,s=ev(r,e,t,a,i),u=["Tensor"];return n&&(u.push("  dtype: ".concat(t)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(e,"]")),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function jfe(r,e,t,n){var a=Vt(e),i=n[n.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?Mf(r):r;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,f=0;f<i;f++)o[f]=Math.max(o[f],Pf(u[l+f],0,t).length);return o}function Pf(r,e,t){var n;return Array.isArray(r)?n="".concat(parseFloat(r[0].toFixed(hb))," + ")+"".concat(parseFloat(r[1].toFixed(hb)),"j"):ns(r)?n="'".concat(r,"'"):t==="bool"?n=OP(r):n=parseFloat(r.toFixed(hb)).toString(),Bf(n,e)}function OP(r){return r===0?"false":"true"}function ev(r,e,t,n,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var c=Mf(r);return[Pf(c[0],0,t)]}return t==="bool"?[OP(r[0])]:[r[0].toString()]}if(u===1){if(s>uF){var l=Of*o,f=Array.from(r.slice(0,l)),h=Array.from(r.slice((s-Of)*o,s*o));return t==="complex64"&&(f=Mf(f),h=Mf(h)),["["+f.map(function(T,E){return Pf(T,a[E],t)}).join(", ")+", ..., "+h.map(function(T,E){return Pf(T,a[s-Of+E],t)}).join(", ")+"]"]}var p=t==="complex64"?Mf(r):Array.from(r);return["["+p.map(function(T,E){return Pf(T,a[E],t)}).join(", ")+"]"]}var d=e.slice(1),m=n.slice(1),v=n[0]*o,g=[];if(s>uF){for(var y=0;y<Of;y++){var w=y*v,b=w+v;g.push.apply(g,Et([],Se(ev(r.slice(w,b),d,t,m,a,!1)),!1))}g.push("...");for(var y=s-Of;y<s;y++){var w=y*v,b=w+v;g.push.apply(g,Et([],Se(ev(r.slice(w,b),d,t,m,a,y===s-1)),!1))}}else for(var y=0;y<s;y++){var w=y*v,b=w+v;g.push.apply(g,Et([],Se(ev(r.slice(w,b),d,t,m,a,y===s-1)),!1))}var x=u===2?",":"";g[0]="["+(s>0?g[0]+x:"");for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+x;for(var S=`,
`,y=2;y<u;y++)S+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":S),g}function Mf(r){for(var e=[],t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var cv=function(){function r(e,t,n){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=Vt(e),n!=null){var i=n.length;W(i===this.size,function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Ub(t,this.size),this.strides=$c(e)}return r.prototype.set=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];n.length===0&&(n=[0]),W(n.length===this.rank,function(){return"The number of provided coordinates (".concat(n.length,") must ")+"match the rank (".concat(t.rank,")")});var i=this.locToIndex(n);this.values[i]=e},r.prototype.get=function(){for(var e,t,n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];n.length===0&&(n=[0]);var i=0;try{for(var o=vn(n),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var c="Requested out of range element at ".concat(n,". ")+"  Buffer shape=".concat(this.shape);throw new Error(c)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var l=n[n.length-1],f=0;f<n.length-1;++f)l+=this.strides[f]*n[f];return this.values[l]},r.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},r.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),r.prototype.toTensor=function(){return Si().makeTensor(this.values,this.shape,this.dtype)},r}(),Si=null,Ic=null;function Kfe(r){Si=r}function Xfe(r){Ic=r}var Gr=function(){function r(e,t,n,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Vt(e),this.strides=$c(e),this.dataId=n,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),r.prototype.buffer=function(){return Ue(this,void 0,void 0,function(){var e;return Ve(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Ic.buffer(this.shape,this.dtype,e)]}})})},r.prototype.bufferSync=function(){return Ic.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return Ue(this,void 0,void 0,function(){var e;return Ve(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,_c(this.shape,e,this.dtype==="complex64")]}})})},r.prototype.arraySync=function(){return _c(this.shape,this.dataSync(),this.dtype==="complex64")},r.prototype.data=function(){return Ue(this,void 0,void 0,function(){var e,t;return Ve(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=Si().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(a){return uv(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}})})},r.prototype.dataToGPU=function(e){return this.throwIfDisposed(),Si().readToGPU(this.dataId,e)},r.prototype.dataSync=function(){this.throwIfDisposed();var e=Si().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return uv(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},r.prototype.bytes=function(){return Ue(this,void 0,void 0,function(){var e;return Ve(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,Si().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Si().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!1,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.print=function(e){return e===void 0&&(e=!1),Ic.print(this,e)},r.prototype.clone=function(){return this.throwIfDisposed(),Ic.clone(this)},r.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return Hfe(t,this.shape,this.dtype,e)},r.prototype.cast=function(e){return this.throwIfDisposed(),Ic.cast(this,e)},r.prototype.variable=function(e,t,n){return e===void 0&&(e=!0),this.throwIfDisposed(),Si().makeVariable(this,e,t,n)},r}();Object.defineProperty(Gr,Symbol.hasInstance,{value:function(r){return!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null}});function PP(){return Gb("Tensor",function(){return Gr})}PP();var Vf=function(r){xo(e,r);function e(t,n,a,i){var o=r.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=n,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(t.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!ko(t.shape,this.shape))throw new Error("shape of the new value (".concat(t.shape,") and ")+"previous value (".concat(this.shape,") must match"));Si().disposeTensor(this),this.dataId=t.dataId,Si().incRef(this,null)},e.prototype.dispose=function(){Si().disposeVariable(this),this.isDisposedInternal=!0},e}(Gr);Object.defineProperty(Vf,Symbol.hasInstance,{value:function(r){return r instanceof Gr&&r.assign!=null&&r.assign instanceof Function}});D.Rank=void 0;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(D.Rank||(D.Rank={}));var Tb;(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(Tb||(Tb={}));var Eb;(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(Eb||(Eb={}));var Ib;(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(Ib||(Ib={}));var Cb;(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(Cb||(Cb={}));var Yfe={float32:Ib,int32:Tb,bool:Eb,complex64:Cb};function bv(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error("Can not upcast ".concat(r," with ").concat(e))}return Yfe[r][e]}function Jfe(r){return bv(r,"int32")}function MP(r){return r!=null&&typeof r=="object"&&"texture"in r&&r.texture instanceof WebGLTexture}function BP(r){return typeof GPUBuffer<"u"&&r!=null&&typeof r=="object"&&"buffer"in r&&r.buffer instanceof GPUBuffer}function Ir(r,e){if(r.dtype===e.dtype)return[r,e];var t=bv(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function LP(r,e){W(r.dtype===e.dtype,function(){return"The dtypes of the first(".concat(r.dtype,") and")+" second(".concat(e.dtype,") input must match")})}function Zfe(r,e){return e.some(function(t){return t.id===r.id})}function Qb(r){var e=[],t=new Set;return qP(r,e,t),e}function qP(r,e,t){if(r!=null){if(r instanceof Gr){e.push(r);return}if(!!Qfe(r)){var n=r;for(var a in n){var i=n[a];t.has(i)||(t.add(i),qP(i,e,t))}}}}function Qfe(r){return Array.isArray(r)||typeof r=="object"}var ehe={__proto__:null,assertTypesMatch:LP,getTensorsInContainer:Qb,isTensorInList:Zfe,makeTypesMatch:Ir};function pb(r){return r.kernelName!=null}var cF=function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return r.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},r}(),ew=function(){function r(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new cF}return r.prototype.ready=function(){return Ue(this,void 0,void 0,function(){var e,t,n,a;return Ve(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(n)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,n=e.asyncInit;if(n)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!1,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},r.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},r.prototype.registerBackend=function(e,t,n){return n===void 0&&(n=1),e in this.registryFactory?(rs("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},r.prototype.setBackend=function(e){return Ue(this,void 0,void 0,function(){var t,n,a,i,o;return Ve(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '".concat(e,"' not found in registry"));return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,a=t.asyncInit,a?[4,n]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=n,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new $fe(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var e=this,t=ov(this.backendName);t.forEach(function(n){n.setupFunc!=null&&n.setupFunc(e.backendInstance)})},r.prototype.disposeRegisteredKernels=function(e){var t=this,n=ov(e);n.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},r.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(n==null)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var a=n.factory();if(a&&!(a instanceof kF)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,rs("Initialization of backend ".concat(e," failed")),rs(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return rs("Initialization of backend ".concat(e," failed")),rs(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],a=this.initializeBackend(n),i=a.success,o=a.asyncInit;if(o||i)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),a=n.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(e,t){var n=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return n.startScope(a)},function(){return n.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},r.prototype.scopedRun=function(e,t,n){e();try{var a=n();return t(),a}catch(i){throw t(),i}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(e){var t=j.runKernel(Xb,{x:e}),n={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},c={dtype:s};return j.runKernel(jb,u,c)}}},i=[];return this.addTapeNode(this.state.activeScope.name,n,[t],a,i,{}),t},r.prototype.runKernel=function(e,t,n){this.backendName==null&&this.backend;var a=Wf(e,this.backendName)!=null;if(!a)throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(e,t,n){var a=this.backend.numDataIds(),i=0;n.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(s," data ids) after running '").concat(e,"'"))},r.prototype.runKernelFunc=function(e){var t=this,n,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var c,l=pb(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(pb(e)){var f=e.kernelName,h=e.inputs,p=e.attrs;this.backendName==null&&this.backend;var d=Wf(f,this.backendName);W(d!=null,function(){return"Cannot find registered kernel '".concat(f,"' for backend '").concat(t.backendName,"'")}),u=function(){var x=t.backend.numDataIds();c=d.kernelFunc({inputs:h,attrs:p,backend:t.backend});var S=Array.isArray(c)?c:[c];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,x,S);var T=S.map(function(C){return C.rank!=null?C:t.makeTensorFromTensorInfo(C)});if(i){var E=t.getTensorsForGradient(f,h,T);a=t.saveTensorsForBackwardMode(E)}return T}}else{var m=e.forwardFunc,v=function(x){!i||(a=x.map(function(S){return t.keep(t.clone(S))}))};u=function(){var x=t.backend.numDataIds();c=t.tidy(function(){return m(t.backend,v)});var S=Array.isArray(c)?c:[c];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(l,x,S),S}}var g=e.inputs,y=e.attrs,w=pb(e)?null:e.backwardsFunc,b;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?n=u():(b=t.profiler.profileKernel(l,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(b),n=b.outputs)}),i&&this.addTapeNode(l,g,n,w,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(x){return g[x]!=null?g[x].shape:null}),outputShapes:n.map(function(x){return x.shape}),kernelTimeMs:b.timeMs,extraInfo:b.extraInfo}),Array.isArray(c)?n:n[0]},r.prototype.saveTensorsForBackwardMode=function(e){var t=this,n=e.map(function(a){return t.keep(t.clone(a))});return n},r.prototype.getTensorsForGradient=function(e,t,n){var a=kb(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(W(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(c){return t[c]})):s=i.map(function(c){return t[c]});var u=n.filter(function(c,l){return o[l]});return s.concat(u)}return[]},r.prototype.makeTensor=function(e,t,n,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",a=a||this.backend;var i=e;n==="string"&&ns(e[0])&&(i=e.map(function(l){return ah(l)}));var o=a.write(i,t,n),s=new Gr(t,n,o,this.nextTensorId());if(this.trackTensor(s,a),n==="string"){var u=this.state.tensorInfo.get(o),c=AF(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},r.prototype.makeTensorFromDataId=function(e,t,n,a){n=n||"float32";var i={dataId:e,shape:t,dtype:n};return this.makeTensorFromTensorInfo(i,a)},r.prototype.makeTensorFromTensorInfo=function(e,t){var n=e.dataId,a=e.shape,i=e.dtype,o=new Gr(a,i,n,this.nextTensorId());return this.trackTensor(o,t),o},r.prototype.makeVariable=function(e,t,n,a){t===void 0&&(t=!0),n=n||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new Vf(e,t,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name ".concat(i.name," was already registered"));return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},r.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*av(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof Vf||this.track(e)},r.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},r.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},r.prototype.disposeTensor=function(e){if(!!this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var n=e.size*av(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},r.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},r.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},r.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},r.prototype.profile=function(e){return Ue(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h;return Ve(this,function(p){switch(p.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=p.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,Et([],Se(this.state.activeProfile.kernels.map(function(d){return d.totalBytesSnapshot})),!1)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,p.label=2;case 2:p.trys.push([2,8,9,10]),i=vn(this.state.activeProfile.kernels),o=i.next(),p.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=p.sent(),c=s,[4,s.extraInfo];case 5:c.extraInfo=p.sent(),p.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return l=p.sent(),f={error:l},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(e,t,n,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},c=kb(e);c!=null&&(a=c.gradFunc),a!=null&&(u.gradient=function(l){return l=l.map(function(f,h){if(f==null){var p=n[h],d=mv(p.size,p.dtype);return s.makeTensor(d,p.shape,p.dtype)}return f}),a(l.length>1?l:l[0],i,o)}),this.state.activeTape.push(u)},r.prototype.keep=function(e){return e.kept=!0,e},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(e){for(var t=this,n=Qb(e),a=new Set(n.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},r.prototype.gradients=function(e,t,n,a){var i=this;if(a===void 0&&(a=!1),W(t.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});W(o instanceof Gr,function(){return"The result y returned by f() must be a tensor."});var s=Vfe(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=n??the(o.shape),Gfe(u,s,function(l){return i.tidy(l)},rhe);var c=t.map(function(l){return u[l.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(l){var f,h;try{for(var p=vn(l.saved),d=p.next();!d.done;d=p.next()){var m=d.value;m.dispose()}}catch(v){f={error:v}}finally{try{d&&!d.done&&(h=p.return)&&h.call(p)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:c}})},r.prototype.customGrad=function(e){var t=this;return W(ss(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];W(n.every(function(c){return c instanceof Gr}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};n.forEach(function(c,l){o[l]=c});var s=function(c,l){return i=e.apply(void 0,Et([],Se(Et(Et([],Se(n),!1),[l],!1)),!1)),W(i.value instanceof Gr,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),W(ss(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(c,l){var f=i.gradFunc(c,l),h=Array.isArray(f)?f:[f];W(h.length===n.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),W(h.every(function(d){return d instanceof Gr}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return h.forEach(function(d,m){p[m]=function(){return d}}),p};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},r.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},r.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},r.prototype.readToGPU=function(e,t){var n=this.state.tensorInfo.get(e);return n.backend.readToGPU(e,t)},r.prototype.time=function(e){return Ue(this,void 0,void 0,function(){var t,n;return Ve(this,function(a){switch(a.label){case 0:return t=Uf(),[4,this.backend.time(e)];case 1:return n=a.sent(),n.wallMs=Uf()-t,[2,n]}})})},r.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!1,configurable:!0}),r.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new cF;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r}();ew.nextTensorId=0;ew.nextVariableId=0;function the(r){var e=Vb(Vt(r),"float32");return j.makeTensor(e,r,"float32")}function zP(){var r=OF();if(r._tfengine==null){var e=new RF(r);r._tfengine=new ew(e)}return nfe(r._tfengine.ENV),Kfe(function(){return r._tfengine}),r._tfengine}var j=zP();function rhe(r,e){var t={a:r,b:e};return j.runKernel(Hb,t)}function nhe(){return typeof navigator<"u"&&navigator!=null}var Ab;function ahe(r){Ab=r}function ihe(r){if(Ab!==void 0)return Ab;if(r||nhe()){if(r||(r=navigator),r.product==="ReactNative")return!0;var e=r.userAgent||r.vendor||(typeof window<"u"?window.opera:"");if(!e){var t=r;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function $P(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var ohe={__proto__:null,isBrowser:$P,isMobile:ihe,mockIsMobile:ahe};var Wn=yt();Wn.registerFlag("DEBUG",function(){return!1},function(r){r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Wn.registerFlag("IS_BROWSER",function(){return $P()});Wn.registerFlag("IS_NODE",function(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"});Wn.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)});Wn.registerFlag("IS_SAFARI",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)});Wn.registerFlag("PROD",function(){return!1});Wn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Wn.getBool("DEBUG")});Wn.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0});Wn.registerFlag("IS_TEST",function(){return!1});Wn.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",function(){return Wn.getBool("DEBUG")});Wn.registerFlag("WRAP_TO_IMAGEBITMAP",function(){return!1});Wn.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",function(){return!1});Wn.registerFlag("USE_SETTIMEOUTCUSTOM",function(){return!1});function Ki(r,e){var t=r;if(on(r))return e==="string"?[]:[r.length];if(MP(r)){var n=r.channels||"RGBA";return[r.height,r.width*n.length]}else if(BP(r))return[r.buffer.size/(e==null?4:av(e))];if(!Array.isArray(r))return[];for(var a=[];Array.isArray(t)||on(t)&&e!=="string";)a.push(t.length),t=t[0];return Array.isArray(r)&&yt().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&WP(r,a,[]),a}function WP(r,e,t){if(t=t||[],!Array.isArray(r)&&!on(r)){W(e.length===0,function(){return"Element arr[".concat(t.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(e[0]," elements")});return}W(e.length>0,function(){return"Element arr[".concat(t.join("]["),"] should be a primitive, ")+"but is an array of ".concat(r.length," elements")}),W(r.length===e[0],function(){return"Element arr[".concat(t.join("]["),"] should have ").concat(e[0]," ")+"elements, but has ".concat(r.length," elements")});for(var n=e.slice(1),a=0;a<r.length;++a)WP(r[a],n,t.concat(a))}function lF(r,e,t,n){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==e||r==="numeric"&&e==="string")throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must ")+"be ".concat(r," tensor, but got ").concat(e," tensor"))}}function P(r,e,t,n){if(n===void 0&&(n="numeric"),r instanceof PP())return lF(n,r.dtype,e,t),r;var a=rh(r);if(a!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(a=n),lF(n,a,e,t),r==null||!on(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var i=r==null?"null":r.constructor.name;throw new Error("Argument '".concat(e,"' passed to '").concat(t,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=Ki(r,a);!on(r)&&!Array.isArray(r)&&(r=[r]);var s=!0,u=a!=="string"?yv(r,a):us(r,[],s);return j.makeTensor(u,o,a)}function Gf(r,e,t,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument ".concat(e," passed to ").concat(t," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=r;return a.map(function(i,o){return P(i,"".concat(e,"[").concat(o,"]"),t,n)})}var UP="__op";function H(r){var e=Object.keys(r);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(e.length," keys."));var t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+UP;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];j.startScope(t);try{var s=n.apply(void 0,Et([],Se(i),!1));return gv(s)&&console.error("Cannot return a Promise inside of tidy."),j.endScope(s),s}catch(u){throw j.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function she(r,e){var t=P(r,"real","complex"),n=P(e,"imag","complex");Fn(t.shape,n.shape,"real and imag shapes, ".concat(t.shape," and ").concat(n.shape,", ")+"must match in call to tf.complex().");var a={real:t,imag:n};return j.runKernel(nR,a)}var cs=H({complex_:she});function hs(r,e,t,n){if(n==null)n=rh(r);else if(n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(BP(r)||MP(r)){if(n!=="float32"&&n!=="int32")throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(n,"."));return j.backend.createTensorFromGPUData(r,e||t,n)}if(!on(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){oa(e);var a=Vt(e),i=Vt(t);W(a===i,function(){return"Based on the provided shape, [".concat(e,"], the tensor should have ")+"".concat(a," values but has ").concat(i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==Vt(e.slice(o)):!0;W(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(t,") does not match the provided ")+"shape (".concat(e,"). ")})}}return!on(r)&&!Array.isArray(r)&&(r=[r]),e=e||t,r=n!=="string"?yv(r,n):us(r,[],!0),j.makeTensor(r,e,n)}function Fc(r,e,t){var n=Ki(r,t);return hs(r,e,n,t)}var ou={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},So=function(){function r(e){if(this.shards=[],this.previousShardIndex=0,e!=null&&(e instanceof Array||(e=[e]),e=e.map(function(o){return on(o)?o.buffer:o}),e.length!==0)){this.bufferUniformSize=e[0].byteLength;for(var t=0,n=0;n<e.length;n++){var a=e[n];n!==e.length-1&&a.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);var i=t+a.byteLength;this.shards.push({buffer:a,start:t,end:i}),t=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}}return r.join=function(e){return new r(e).slice()},r.prototype.slice=function(e,t){if(e===void 0&&(e=0),t===void 0&&(t=this.byteLength),this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);var n=this.findShardForByte(e);if(n===-1)throw new Error("Could not find start shard for byte ".concat(e));for(var a=t-e,i=new ArrayBuffer(a),o=new Uint8Array(i),s=0,u=n;u<this.shards.length;u++){var c=this.shards[u],l=e+s,f=l-c.start,h=s,p=Math.min(t,c.end),d=p-c.start,m=new Uint8Array(c.buffer,f,d-f);if(o.set(m,h),s+=m.length,t<c.end)break}return i},r.prototype.findShardForByte=function(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(a){return e<a.start?-1:e>=a.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;var n=uhe(this.shards,t);return n===-1?-1:(this.previousShardIndex=n,this.previousShardIndex)},r}();function uhe(r,e){for(var t=0,n=r.length;t<=n;){var a=Math.floor((n-t)/2)+t,i=e(r[a]);if(i===0)return a;i<0?n=a:t=a+1}return-1}function che(){yt().set("PROD",!0)}function lhe(){yt().set("DEBUG",!0)}function fhe(){yt().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function hhe(r){yt().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function phe(){j.disposeVariables()}function dhe(){return j}function vhe(){return j.memory()}function mhe(r){return j.profile(r)}function Hr(r,e){return j.tidy(r,e)}function $n(r){var e=Qb(r);e.forEach(function(t){return t.dispose()})}function VP(r){return j.keep(r)}function ghe(r){return j.time(r)}function yhe(r){return j.setBackend(r)}function bhe(){return j.ready()}function GP(){return j.backendName}function whe(r){j.removeBackend(r)}function xhe(r){return j.findBackend(r)}function khe(r){return j.findBackendFactory(r)}function She(r,e,t){return t===void 0&&(t=1),j.registerBackend(r,e,t)}function HP(){return j.backend}function Nhe(r,e){yt().setPlatform(r,e)}var ls=4;function The(r,e){return Ue(this,void 0,void 0,function(){var t,n,a,i,o,s,u=this;return Ve(this,function(c){switch(c.label){case 0:for(t=[],n=[],a=Array.isArray(r)?r.map(function(l){return l.name}):Object.keys(r),i=function(l){var f=a[l],h=Array.isArray(r)?r[l].tensor:r[f];if(h.dtype!=="float32"&&h.dtype!=="int32"&&h.dtype!=="bool"&&h.dtype!=="string"&&h.dtype!=="complex64")throw new Error("Unsupported dtype in weight '".concat(f,"': ").concat(h.dtype));var p={name:f,shape:h.shape,dtype:h.dtype};if(h.dtype==="string"){var d=new Promise(function(m){return Ue(u,void 0,void 0,function(){var v,g,y,w,b,x,S;return Ve(this,function(T){switch(T.label){case 0:return[4,h.bytes()];case 1:for(v=T.sent(),g=v.reduce(function(E,C){return E+C.length},0)+ls*v.length,y=new Uint8Array(g),w=0,b=0;b<v.length;b++)x=v[b],S=new Uint8Array(new Uint32Array([x.length]).buffer),y.set(S,w),w+=ls,y.set(x,w),w+=x.length;return m(y),[2]}})})});n.push(d)}else n.push(h.data());e!=null&&(p.group=e),t.push(p)},o=0;o<a.length;++o)i(o);return[4,Promise.all(n)];case 1:return s=c.sent(),[2,{data:Ahe(s),specs:t}]}})})}function jP(r,e){var t,n,a=new So(r),i={},o=0;try{for(var s=vn(e),u=s.next();!u.done;u=s.next()){var c=u.value,l=Ehe(c,function(f,h){return a.slice(o+f,o+h)});i[c.name]=KP(c,a.slice(o,o+l)),o+=l}}catch(f){t={error:f}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return i}function Ehe(r,e){var t=Vt(r.shape),n;if("quantization"in r){var a=r.quantization;n=ou[a.dtype]}else if(r.dtype==="string"){for(var i=0,o=0;o<t;o++)i+=ls+new Uint32Array(e(i,i+ls))[0];return i}else n=ou[r.dtype];return t*n}function Ihe(r,e){return Ue(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c;return Ve(this,function(l){switch(l.label){case 0:return t=Vt(r.shape),"quantization"in r?(a=r.quantization,n=ou[a.dtype],[3,7]):[3,1];case 1:if(r.dtype!=="string")return[3,6];i=0,o=0,l.label=2;case 2:return o<t?(s=i,u=ls,c=Uint32Array.bind,[4,e(i,i+ls)]):[3,5];case 3:i=s+(u+new(c.apply(Uint32Array,[void 0,l.sent()]))()[0]),l.label=4;case 4:return o++,[3,2];case 5:return[2,i];case 6:n=ou[r.dtype],l.label=7;case 7:return[2,t*n]}})})}function KP(r,e){var t=r.name,n=r.dtype,a=r.shape,i=Vt(a),o,s=0;if("quantization"in r){var u=r.quantization;if(u.dtype==="uint8"||u.dtype==="uint16"){if(!("min"in u&&"scale"in u))throw new Error("Weight ".concat(r.name," with quantization ").concat(u.dtype," ")+"doesn't have corresponding metadata min and scale.")}else if(u.dtype==="float16"){if(n!=="float32")throw new Error("Weight ".concat(r.name," is quantized with ").concat(u.dtype," ")+"which only supports weights of type float32 not ".concat(n,"."))}else throw new Error("Weight ".concat(r.name," has unknown ")+"quantization dtype ".concat(u.dtype,". ")+"Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.");var c=ou[u.dtype],l=u.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(n==="float32")if(u.dtype==="uint8"||u.dtype==="uint16"){o=new Float32Array(l.length);for(var f=0;f<l.length;f++){var h=l[f];o[f]=h*u.scale+u.min}}else if(u.dtype==="float16"){var p=Mhe();o=p(l)}else throw new Error("Unsupported quantization type ".concat(u.dtype," ")+"for weight type float32.");else if(n==="int32"){if(u.dtype!=="uint8"&&u.dtype!=="uint16")throw new Error("Unsupported quantization type ".concat(u.dtype," ")+"for weight type int32.");o=new Int32Array(l.length);for(var f=0;f<l.length;f++){var h=l[f];o[f]=Math.round(h*u.scale+u.min)}}else throw new Error("Unsupported dtype in weight '".concat(t,"': ").concat(n));s+=i*c}else if(n==="string"){var d=Vt(r.shape);o=[];for(var f=0;f<d;f++){var m=new Uint32Array(e.slice(s,s+ls))[0];s+=ls;var v=new Uint8Array(e.slice(s,s+m));o.push(v),s+=m}}else{var g=ou[n];if(n==="float32")o=new Float32Array(e);else if(n==="int32")o=new Int32Array(e);else if(n==="bool")o=new Uint8Array(e);else if(n==="complex64"){o=new Float32Array(e);for(var y=new Float32Array(o.length/2),w=new Float32Array(o.length/2),f=0;f<y.length;f++)y[f]=o[f*2],w[f]=o[f*2+1];var b=Fc(y,a,"float32"),x=Fc(w,a,"float32"),S=cs(b,x);return b.dispose(),x.dispose(),S}else throw new Error("Unsupported dtype in weight '".concat(t,"': ").concat(n));s+=i*g}return Fc(o,a,n)}function fF(r,e,t){return Ue(this,void 0,void 0,function(){var n,a,i,o,s,u;return Ve(this,function(c){switch(c.label){case 0:n=new Uint8Array(e),c.label=1;case 1:return n.byteLength<t?[4,r.read()]:[3,3];case 2:if(a=c.sent(),i=a.done,o=a.value,i&&o==null)throw s=t-n.byteLength,new Error("Reader is done but ".concat(s," bytes are still expected"));return u=new Uint8Array(n.length+o.byteLength),u.set(n,0),u.set(new Uint8Array(o),n.length),n=u,[3,1];case 3:return[2,n.buffer]}})})}function Che(r,e){return Ue(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h,p,d,m=this;return Ve(this,function(v){switch(v.label){case 0:t={},n=r.getReader(),a=new ArrayBuffer(0),v.label=1;case 1:v.trys.push([1,7,8,9]),i=vn(e),o=i.next(),v.label=2;case 2:return o.done?[3,6]:(s=o.value,[4,Ihe(s,function(g,y){return Ue(m,void 0,void 0,function(){return Ve(this,function(w){switch(w.label){case 0:return[4,fF(n,a,y)];case 1:return a=w.sent(),[2,a.slice(g,y)]}})})})]);case 3:return u=v.sent(),[4,fF(n,a,u)];case 4:a=v.sent(),c=a.slice(0,u),a=a.slice(u),l=KP(s,c),t[s.name]=l,GP()==="webgpu"&&(f=HP(),"uploadToGPU"in f&&Vt(l.shape)>=yt().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&f.uploadToGPU(l.dataId)),v.label=5;case 5:return o=i.next(),[3,2];case 6:return[3,9];case 7:return h=v.sent(),p={error:h},[3,9];case 8:try{o&&!o.done&&(d=i.return)&&d.call(i)}finally{if(p)throw p.error}return[7];case 9:return[2,t]}})})}function Ahe(r){if(r===null)throw new Error("Invalid input value: ".concat(JSON.stringify(r)));var e=0,t=[];r.forEach(function(i){if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(i.constructor.name))});var n=new Uint8Array(e),a=0;return t.forEach(function(i){n.set(new Uint8Array(i.buffer),a),a+=i.byteLength}),n.buffer}var tw=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function hF(r){return tw?Buffer.byteLength(r,"utf8"):new Blob([r]).size}function Dhe(r){if(tw)return Buffer.from(r).toString("base64");for(var e=new Uint8Array(r),t="",n=0,a=e.length;n<a;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function _he(r){if(tw){var e=Buffer.from(r,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var t=atob(r),n=new Uint8Array(t.length),a=0;a<t.length;++a)n.set([t.charCodeAt(a)],a);return n.buffer}function Fhe(r){return So.join(r)}function pF(r){var e="/";for(r=r.trim();r.endsWith(e);)r=r.slice(0,r.length-1);var t=r.split(e);return t[t.length-1]}function XP(r,e){var t={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy,weightsManifest:e};return r.signature!=null&&(t.signature=r.signature),r.userDefinedMetadata!=null&&(t.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(t.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(t.initializerSignature=r.initializerSignature),r.trainingConfig!=null&&(t.trainingConfig=r.trainingConfig),t}function YP(r,e,t){var n={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy};if(r.trainingConfig!=null&&(n.trainingConfig=r.trainingConfig),r.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");n.weightSpecs=e,n.weightData=t}return r.signature!=null&&(n.signature=r.signature),r.userDefinedMetadata!=null&&(n.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(n.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(n.initializerSignature=r.initializerSignature),n}function rw(r,e){return Ue(this,void 0,void 0,function(){var t,n,a;return Ve(this,function(i){switch(i.label){case 0:return r.weightsManifest==null?[3,2]:[4,e(r.weightsManifest)];case 1:a=Se.apply(void 0,[i.sent(),2]),t=a[0],n=a[1],i.label=2;case 2:return[2,YP(r,t,n)]}})})}function ih(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:hF(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:hF(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:new So(r.weightData).byteLength}}function Db(r){var e,t,n=[];try{for(var a=vn(r),i=a.next();!i.done;i=a.next()){var o=i.value;n.push.apply(n,Et([],Se(o.weights),!1))}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}function Rhe(){var r=function(n){for(var a=n<<13,i=0;(a&8388608)===0;)i-=8388608,a<<=1;return a&=-8388609,i+=947912704,a|i},e=new Uint32Array(2048);e[0]=0;for(var t=1;t<1024;t++)e[t]=r(t);for(var t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function Ohe(){var r=new Uint32Array(64);r[0]=0,r[31]=1199570944,r[32]=2147483648,r[63]=3347054592;for(var e=1;e<31;e++)r[e]=e<<23;for(var e=33;e<63;e++)r[e]=2147483648+(e-32<<23);return r}function Phe(){for(var r=new Uint32Array(64),e=0;e<64;e++)r[e]=1024;return r[0]=r[32]=0,r}function Mhe(){var r=Rhe(),e=Ohe(),t=Phe();return function(n){for(var a=new ArrayBuffer(4*n.length),i=new Uint32Array(a),o=0;o<n.length;o++){var s=n[o],u=r[t[s>>10]+(s&1023)]+e[s>>10];i[o]=u}return new Float32Array(a)}}var _a=function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerSaveRouter=function(e){r.getInstance().saveRouters.push(e)},r.registerLoadRouter=function(e){r.getInstance().loadRouters.push(e)},r.getSaveHandlers=function(e){return r.getHandlers(e,"save")},r.getLoadHandlers=function(e,t){return r.getHandlers(e,"load",t)},r.getHandlers=function(e,t,n){var a=[],i=t==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters;return i.forEach(function(o){var s=o(e,n);s!==null&&a.push(s)}),a},r}(),Bhe=function(r){return _a.registerSaveRouter(r)},Lhe=function(r){return _a.registerLoadRouter(r)},qhe=function(r){return _a.getSaveHandlers(r)},zhe=function(r,e){return _a.getLoadHandlers(r,e)},_b="tensorflowjs",Fb=1,nu="models_store",as="model_info_store";function JP(){if(!yt().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=typeof window>"u"?self:window,e=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Rb(r){var e=r.result;e.createObjectStore(nu,{keyPath:"modelPath"}),e.createObjectStore(as,{keyPath:"modelPath"})}var su=function(){function r(e){if(this.indexedDB=JP(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return r.prototype.save=function(e){return Ue(this,void 0,void 0,function(){return Ve(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},r.prototype.load=function(){return Ue(this,void 0,void 0,function(){return Ve(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},r.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(a,i){var o=n.indexedDB.open(_b,Fb);o.onupgradeneeded=function(){return Rb(o)},o.onsuccess=function(){var s=o.result;if(t==null){var u=s.transaction(nu,"readonly"),c=u.objectStore(nu),l=c.get(n.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),i(new Error("Cannot find model with path '".concat(n.modelPath,"' ")+"in IndexedDB."));a(l.result.modelArtifacts)},l.onerror=function(v){return s.close(),i(l.error)},u.oncomplete=function(){return s.close()}}else{t.weightData=So.join(t.weightData);var f=ih(t),h=s.transaction(as,"readwrite"),p=h.objectStore(as),d;try{d=p.put({modelPath:n.modelPath,modelArtifactsInfo:f})}catch(v){return i(v)}var m;d.onsuccess=function(){m=s.transaction(nu,"readwrite");var v=m.objectStore(nu),g;try{g=v.put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:f})}catch(y){return i(y)}g.onsuccess=function(){return a({modelArtifactsInfo:f})},g.onerror=function(y){p=h.objectStore(as);var w=p.delete(n.modelPath);w.onsuccess=function(){return s.close(),i(g.error)},w.onerror=function(b){return s.close(),i(g.error)}}},d.onerror=function(v){return s.close(),i(d.error)},h.oncomplete=function(){m==null?s.close():m.oncomplete=function(){return s.close()}}}},o.onerror=function(s){return i(o.error)}})},r}();su.URL_SCHEME="indexeddb://";var ZP=function(r){return yt().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(su.URL_SCHEME)?$he(r.slice(su.URL_SCHEME.length)):null};_a.registerSaveRouter(ZP);_a.registerLoadRouter(ZP);function $he(r){return new su(r)}function Whe(r){return r.startsWith(su.URL_SCHEME)?r.slice(su.URL_SCHEME.length):r}var Uhe=function(){function r(){this.indexedDB=JP()}return r.prototype.listModels=function(){return Ue(this,void 0,void 0,function(){var e=this;return Ve(this,function(t){return[2,new Promise(function(n,a){var i=e.indexedDB.open(_b,Fb);i.onupgradeneeded=function(){return Rb(i)},i.onsuccess=function(){var o=i.result,s=o.transaction(as,"readonly"),u=s.objectStore(as),c=u.getAll();c.onsuccess=function(){var l,f,h={};try{for(var p=vn(c.result),d=p.next();!d.done;d=p.next()){var m=d.value;h[m.modelPath]=m.modelArtifactsInfo}}catch(v){l={error:v}}finally{try{d&&!d.done&&(f=p.return)&&f.call(p)}finally{if(l)throw l.error}}n(h)},c.onerror=function(l){return o.close(),a(c.error)},s.oncomplete=function(){return o.close()}},i.onerror=function(o){return a(i.error)}})]})})},r.prototype.removeModel=function(e){return Ue(this,void 0,void 0,function(){var t=this;return Ve(this,function(n){return e=Whe(e),[2,new Promise(function(a,i){var o=t.indexedDB.open(_b,Fb);o.onupgradeneeded=function(){return Rb(o)},o.onsuccess=function(){var s=o.result,u=s.transaction(as,"readwrite"),c=u.objectStore(as),l=c.get(e),f;l.onsuccess=function(){if(l.result==null)return s.close(),i(new Error("Cannot find model with path '".concat(e,"' ")+"in IndexedDB."));var h=c.delete(e),p=function(){f=s.transaction(nu,"readwrite");var d=f.objectStore(nu),m=d.delete(e);m.onsuccess=function(){return a(l.result.modelArtifactsInfo)},m.onerror=function(v){return i(l.error)}};h.onsuccess=p,h.onerror=function(d){return p(),s.close(),i(l.error)}},l.onerror=function(h){return s.close(),i(l.error)},u.oncomplete=function(){f==null?s.close():f.oncomplete=function(){return s.close()}}},o.onerror=function(s){return i(o.error)}})]})})},r}(),yo="/",Cc="tensorflowjs_models",QP="info",Vhe="model_topology",Ghe="weight_specs",Hhe="weight_data",jhe="model_metadata";function eM(r){return{info:[Cc,r,QP].join(yo),topology:[Cc,r,Vhe].join(yo),weightSpecs:[Cc,r,Ghe].join(yo),weightData:[Cc,r,Hhe].join(yo),modelMetadata:[Cc,r,jhe].join(yo)}}function tM(r){var e,t;try{for(var n=vn(Object.values(r)),a=n.next();!a.done;a=n.next()){var i=a.value;window.localStorage.removeItem(i)}}catch(o){e={error:o}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}}function Khe(r){var e=r.split(yo);if(e.length<3)throw new Error("Invalid key format: ".concat(r));return e.slice(1,e.length-1).join(yo)}function Xhe(r){return r.startsWith(uu.URL_SCHEME)?r.slice(uu.URL_SCHEME.length):r}var uu=function(){function r(e){if(!yt().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=eM(this.modelPath)}return r.prototype.save=function(e){return Ue(this,void 0,void 0,function(){var t,n,a,i,o;return Ve(this,function(s){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),a=ih(e),i=So.join(e.weightData);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,Dhe(i)),o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),[2,{modelArtifactsInfo:a}]}catch{throw tM(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."))}return[2]})})},r.prototype.load=function(){return Ue(this,void 0,void 0,function(){var e,t,n,a,i,o,s;return Ve(this,function(u){if(e=JSON.parse(this.LS.getItem(this.keys.info)),e==null)throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},n=JSON.parse(this.LS.getItem(this.keys.topology)),n==null)throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");if(t.modelTopology=n,a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)),a==null)throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");if(t.weightSpecs=a,i=this.LS.getItem(this.keys.modelMetadata),i!=null&&(o=JSON.parse(i),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,o.signature!=null&&(t.signature=o.signature),o.userDefinedMetadata!=null&&(t.userDefinedMetadata=o.userDefinedMetadata),o.modelInitializer!=null&&(t.modelInitializer=o.modelInitializer),o.initializerSignature!=null&&(t.initializerSignature=o.initializerSignature),o.trainingConfig!=null&&(t.trainingConfig=o.trainingConfig)),s=this.LS.getItem(this.keys.weightData),s==null)throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));return t.weightData=_he(s),[2,t]})})},r}();uu.URL_SCHEME="localstorage://";var rM=function(r){return yt().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(uu.URL_SCHEME)?Yhe(r.slice(uu.URL_SCHEME.length)):null};_a.registerSaveRouter(rM);_a.registerLoadRouter(rM);function Yhe(r){return new uu(r)}var Jhe=function(){function r(){W(yt().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),W(typeof window>"u"||typeof window.localStorage<"u",function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return r.prototype.listModels=function(){return Ue(this,void 0,void 0,function(){var e,t,n,a,i,o;return Ve(this,function(s){for(e={},t=Cc+yo,n=yo+QP,a=0;a<this.LS.length;++a)i=this.LS.key(a),i.startsWith(t)&&i.endsWith(n)&&(o=Khe(i),e[o]=JSON.parse(this.LS.getItem(i)));return[2,e]})})},r.prototype.removeModel=function(e){return Ue(this,void 0,void 0,function(){var t,n;return Ve(this,function(a){if(e=Xhe(e),t=eM(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '".concat(e,"'"));return n=JSON.parse(this.LS.getItem(t.info)),tM(t),[2,n]})})},r}(),Rc="://",fs=function(){function r(){this.managers={}}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerManager=function(e,t){W(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(Rc)&&(e=e.slice(0,e.indexOf(Rc))),W(e.length>0,function(){return"scheme must not be an empty string."});var n=r.getInstance();W(n.managers[e]==null,function(){return"A model store manager is already registered for scheme '".concat(e,"'.")}),n.managers[e]=t},r.getManager=function(e){var t=r.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '".concat(e,"'"));return t},r.getSchemes=function(){return Object.keys(r.getInstance().managers)},r}();function tv(r){if(r.indexOf(Rc)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+"".concat(fs.getSchemes().join(",")));return{scheme:r.split(Rc)[0],path:r.split(Rc)[1]}}function nM(r,e,t){return t===void 0&&(t=!1),Ue(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f;return Ve(this,function(h){switch(h.label){case 0:return W(r!==e,function(){return"Old path and new path are the same: '".concat(r,"'")}),n=_a.getLoadHandlers(r),W(n.length>0,function(){return"Copying failed because no load handler is found for source URL ".concat(r,".")}),W(n.length<2,function(){return"Copying failed because more than one (".concat(n.length,") ")+"load handlers for source URL ".concat(r,".")}),a=n[0],i=_a.getSaveHandlers(e),W(i.length>0,function(){return"Copying failed because no save handler is found for destination "+"URL ".concat(e,".")}),W(i.length<2,function(){return"Copying failed because more than one (".concat(n.length,") ")+"save handlers for destination URL ".concat(e,".")}),o=i[0],s=tv(r).scheme,u=tv(r).path,c=s===tv(r).scheme,[4,a.load()];case 1:return l=h.sent(),t&&c?[4,fs.getManager(s).removeModel(u)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[4,o.save(l)];case 4:return f=h.sent(),t&&!c?[4,fs.getManager(s).removeModel(u)]:[3,6];case 5:h.sent(),h.label=6;case 6:return[2,f.modelArtifactsInfo]}})})}function Zhe(){return Ue(this,void 0,void 0,function(){var r,e,t,n,a,i,o,s,u,c,l;return Ve(this,function(f){switch(f.label){case 0:r=fs.getSchemes(),e={},f.label=1;case 1:f.trys.push([1,6,7,8]),t=vn(r),n=t.next(),f.label=2;case 2:return n.done?[3,5]:(a=n.value,[4,fs.getManager(a).listModels()]);case 3:i=f.sent();for(o in i)s=a+Rc+o,e[s]=i[o];f.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return u=f.sent(),c={error:u},[3,8];case 7:try{n&&!n.done&&(l=t.return)&&l.call(t)}finally{if(c)throw c.error}return[7];case 8:return[2,e]}})})}function Qhe(r){return Ue(this,void 0,void 0,function(){var e,t;return Ve(this,function(n){return e=tv(r),t=fs.getManager(e.scheme),[2,t.removeModel(e.path)]})})}function epe(r,e){return Ue(this,void 0,void 0,function(){var t;return Ve(this,function(n){return t=!1,[2,nM(r,e,t)]})})}function tpe(r,e){return Ue(this,void 0,void 0,function(){var t;return Ve(this,function(n){return t=!0,[2,nM(r,e,t)]})})}var rpe=function(){function r(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}return r.prototype.fetch=function(e,t){return fetch(e,t)},r.prototype.now=function(){return performance.now()},r.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},r.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},r.prototype.setTimeoutCustom=function(e,t){var n=this;if(typeof window>"u"||!yt().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(function(){window.postMessage({name:n.messageName,index:n.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",function(a){if(a.source===window&&a.data.name===n.messageName){a.stopPropagation();var i=n.functionRefs[a.data.index];i(),n.handledMessageCount++,n.handledMessageCount===n.functionRefs.length&&(n.functionRefs=[],n.handledMessageCount=0)}},!0))},r.prototype.isTypedArray=function(e){return TP(e)},r}();if(yt().get("IS_BROWSER")){yt().setPlatform("browser",new rpe);try{fs.registerManager(uu.URL_SCHEME,new Jhe)}catch{}try{fs.registerManager(su.URL_SCHEME,new Uhe)}catch{}}var npe={importFetch:function(){return Q3()}},db,ape=function(){function r(){this.util=eF(),this.textEncoder=new this.util.TextEncoder}return r.prototype.fetch=function(e,t){return yt().global.fetch!=null?yt().global.fetch(e,t):(db==null&&(db=npe.importFetch()),db(e,t))},r.prototype.now=function(){var e=process.hrtime();return e[0]*1e3+e[1]/1e6},r.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)},r.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},r.prototype.isTypedArray=function(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)},r}();yt().get("IS_NODE")&&!yt().get("IS_BROWSER")&&yt().setPlatform("node",new ape);function bo(r,e,t){return e===void 0&&(e="float32"),e=e||"float32",oa(r),new cv(r,e,t)}function ipe(r,e){var t=P(r,"x","cast");if(!CF(e))throw new Error("Failed to cast to unknown dtype ".concat(e));if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var n={x:t},a={dtype:e};return j.runKernel(jb,n,a)}var nr=H({cast_:ipe});function ope(r){var e=P(r,"x","clone","string_or_numeric"),t={x:e};return j.runKernel(Xb,t)}var iu=H({clone_:ope});function aM(r,e){e===void 0&&(e=!1),console.log(r.toString(e))}zP();var spe={buffer:bo,cast:nr,clone:iu,print:aM};Xfe(spe);function upe(r,e){var t,n=P(r,"a","add"),a=P(e,"b","add");t=Se(Ir(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return j.runKernel(Hb,i)}var ht=H({add_:upe});function cpe(r,e){var t,n=P(r,"a","floorDiv"),a=P(e,"b","floorDiv");t=Se(Ir(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return j.runKernel(PR,i)}var iM=H({floorDiv_:cpe});function lpe(r,e){var t,n=P(r,"a","div"),a=P(e,"b","div");if(t=Se(Ir(n,a),2),n=t[0],a=t[1],n.dtype==="int32"&&a.dtype==="int32")return iM(n,a);var i={a:n,b:a},o={};return j.runKernel(SR,i,o)}var er=H({div_:lpe});function fpe(r,e){var t,n=P(r,"a","mul"),a=P(e,"b","mul");t=Se(Ir(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return j.runKernel(pO,i)}var Me=H({mul_:fpe});function hpe(r){var e=P(r,"x","abs");if(e.dtype==="complex64"){var t={x:e};return j.runKernel(aR,t)}else{var t={x:e};return j.runKernel(PF,t)}}var Aa=H({abs_:hpe});function ppe(r){var e=P(r,"x","acos"),t={x:e};return j.runKernel(MF,t)}var dpe=H({acos_:ppe});function vpe(r){var e=P(r,"x","acosh"),t={x:e};return j.runKernel(BF,t)}var mpe=H({acosh_:vpe});function gpe(r){W(Array.isArray(r),function(){return"The argument passed to tf.addN() must be a list of tensors"}),W(r.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+"".concat(r.length)});var e=r.map(function(a,i){return P(a,"tensors".concat(i),"addN")}),t=e[0];e.forEach(function(a){if(a.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(a){if(!ko(a.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var n=e;return j.runKernel(LF,n)}var ype=H({addN_:gpe});function bpe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=P(r,"x","all","bool"),a={x:n},i={axis:e,keepDims:t};return j.runKernel(qF,a,i)}var wpe=H({all_:bpe});function xpe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=P(r,"x","any","bool"),a={x:n},i={axis:e,keepDims:t};return j.runKernel(zF,a,i)}var kpe=H({any_:xpe});function Spe(r,e){e===void 0&&(e=0);var t=P(r,"x","argMax"),n={x:t},a={axis:e};return j.runKernel($F,n,a)}var Npe=H({argMax_:Spe});function Tpe(r,e){e===void 0&&(e=0);var t=P(r,"x","argMin"),n={x:t},a={axis:e};return j.runKernel(WF,n,a)}var Epe=H({argMin_:Tpe});function Ipe(r){var e=P(r,"x","asin"),t={x:e};return j.runKernel(UF,t)}var Cpe=H({asin_:Ipe});function Ape(r){var e=P(r,"x","asinh"),t={x:e};return j.runKernel(VF,t)}var Dpe=H({asinh_:Ape});function _pe(r){var e=P(r,"x","atan"),t={x:e};return j.runKernel(GF,t)}var Fpe=H({atan_:_pe});function Rpe(r,e){var t,n=P(r,"a","atan2"),a=P(e,"b","atan2");t=Se(Ir(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return j.runKernel(jF,i)}var Ope=H({atan2_:Rpe});function Ppe(r){var e=P(r,"x","atanh"),t={x:e};return j.runKernel(HF,t)}var Mpe=H({atanh_:Ppe});function Bpe(r,e,t,n,a,i){a===void 0&&(a="NHWC");var o=r[3],s=Et(Et([],Se(e),!1),[o],!1),u=uM(a);return oh(r,s,t,i,n,null,null,u)}function oM(r,e,t,n,a,i,o){o===void 0&&(o="channelsLast");var s=Se(Hf(e),2),u=s[0],c=s[1],l;if(o==="channelsLast")l=[u,c,r[3],r[3]];else if(o==="channelsFirst")l=[u,c,r[1],r[1]];else throw new Error("Unknown dataFormat ".concat(o));return oh(r,l,t,n,a,i,!1,o)}function Lpe(r,e,t,n,a,i,o){o===void 0&&(o="NDHWC");var s=Se(Ob(e),3),u=s[0],c=s[1],l=s[2],f,h;if(o==="NDHWC")h="channelsLast",f=[u,c,l,r[4],r[4]];else if(o==="NCDHW")h="channelsFirst",f=[u,c,l,r[1],r[1]];else throw new Error("Unknown dataFormat ".concat(o));return sM(r,f,t,n,a,!1,h,i)}function oh(r,e,t,n,a,i,o,s){var u,c;o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var l=Se([-1,-1,-1,-1],4),f=l[0],h=l[1],p=l[2],d=l[3];if(s==="channelsLast")u=Se(r,4),f=u[0],h=u[1],p=u[2],d=u[3];else if(s==="channelsFirst")c=Se(r,4),f=c[0],d=c[1],h=c[2],p=c[3];else throw new Error("Unknown dataFormat ".concat(s));var m=Se(e,4),v=m[0],g=m[1],y=m[3],w=Se(Hf(t),2),b=w[0],x=w[1],S=Se(Hf(n),2),T=S[0],E=S[1],C=Oc(v,T),R=Oc(g,E),_=$pe(a,h,p,b,x,C,R,i,s),M=_.padInfo,$=_.outHeight,z=_.outWidth,q=o?y*d:y,L;return s==="channelsFirst"?L=[f,q,$,z]:s==="channelsLast"&&(L=[f,$,z,q]),{batchSize:f,dataFormat:s,inHeight:h,inWidth:p,inChannels:d,outHeight:$,outWidth:z,outChannels:q,padInfo:M,strideHeight:b,strideWidth:x,filterHeight:v,filterWidth:g,effectiveFilterHeight:C,effectiveFilterWidth:R,dilationHeight:T,dilationWidth:E,inShape:r,outShape:L,filterShape:e}}function sM(r,e,t,n,a,i,o,s){var u,c;i===void 0&&(i=!1),o===void 0&&(o="channelsLast");var l=Se([-1,-1,-1,-1,-1],5),f=l[0],h=l[1],p=l[2],d=l[3],m=l[4];if(o==="channelsLast")u=Se(r,5),f=u[0],h=u[1],p=u[2],d=u[3],m=u[4];else if(o==="channelsFirst")c=Se(r,5),f=c[0],m=c[1],h=c[2],p=c[3],d=c[4];else throw new Error("Unknown dataFormat ".concat(o));var v=Se(e,5),g=v[0],y=v[1],w=v[2],b=v[4],x=Se(Ob(t),3),S=x[0],T=x[1],E=x[2],C=Se(Ob(n),3),R=C[0],_=C[1],M=C[2],$=Oc(g,R),z=Oc(y,_),q=Oc(w,M),L=Wpe(a,h,p,d,S,T,E,$,z,q,s),U=L.padInfo,Y=L.outDepth,Z=L.outHeight,V=L.outWidth,X=i?b*m:b,ne;return o==="channelsFirst"?ne=[f,X,Y,Z,V]:o==="channelsLast"&&(ne=[f,Y,Z,V,X]),{batchSize:f,dataFormat:o,inDepth:h,inHeight:p,inWidth:d,inChannels:m,outDepth:Y,outHeight:Z,outWidth:V,outChannels:X,padInfo:U,strideDepth:S,strideHeight:T,strideWidth:E,filterDepth:g,filterHeight:y,filterWidth:w,effectiveFilterDepth:$,effectiveFilterHeight:z,effectiveFilterWidth:q,dilationDepth:R,dilationHeight:_,dilationWidth:M,inShape:r,outShape:ne,filterShape:e}}function qpe(r,e,t,n,a){n==null&&(n=nw(r,e,t));var i=r[0],o=r[1],s=jf((i-e+2*n)/t+1,a),u=jf((o-e+2*n)/t+1,a);return[s,u]}function zpe(r,e,t,n,a,i){a==null&&(a=nw(r,e[0],n[0]));for(var o=[0,0,0,t],s=0;s<3;s++)r[s]+2*a>=e[s]&&(o[s]=jf((r[s]-e[s]+2*a)/n[s]+1,i));return o}function nw(r,e,t,n){n===void 0&&(n=1);var a=Oc(e,n);return Math.floor((r[0]*(t-1)-t+a)/2)}function Hf(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function Ob(r){return typeof r=="number"?[r,r,r]:r}function Oc(r,e){return e<=1?r:r+(r-1)*(e-1)}function $pe(r,e,t,n,a,i,o,s,u){var c,l,f;if(typeof r=="number"){var h=r===0?"VALID":"NUMBER";c={top:r,bottom:r,left:r,right:r,type:h};var p=qpe([e,t],i,n,r,s);l=p[0],f=p[1]}else if(r==="same"){l=Math.ceil(e/n),f=Math.ceil(t/a);var d=Math.max(0,(l-1)*n+i-e),m=Math.max(0,(f-1)*a+o-t),v=Math.floor(d/2),g=d-v,y=Math.floor(m/2),w=m-y;c={top:v,bottom:g,left:y,right:w,type:"SAME"}}else if(r==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-i+1)/n),f=Math.ceil((t-o+1)/a);else if(typeof r=="object"){var v=u==="channelsLast"?r[1][0]:r[2][0],g=u==="channelsLast"?r[1][1]:r[2][1],y=u==="channelsLast"?r[2][0]:r[3][0],w=u==="channelsLast"?r[2][1]:r[3][1],h=v===0&&g===0&&y===0&&w===0?"VALID":"EXPLICIT";c={top:v,bottom:g,left:y,right:w,type:h},l=jf((e-i+v+g)/n+1,s),f=jf((t-o+y+w)/a+1,s)}else throw Error("Unknown padding parameter: ".concat(r));return{padInfo:c,outHeight:l,outWidth:f}}function Wpe(r,e,t,n,a,i,o,s,u,c,l){var f,h,p,d;if(r==="valid"&&(r=0),typeof r=="number"){var m=r===0?"VALID":"NUMBER";f={top:r,bottom:r,left:r,right:r,front:r,back:r,type:m};var v=zpe([e,t,n,1],[s,u,c],1,[a,i,o],r,l);h=v[0],p=v[1],d=v[2]}else if(r==="same"){h=Math.ceil(e/a),p=Math.ceil(t/i),d=Math.ceil(n/o);var g=(h-1)*a+s-e,y=(p-1)*i+u-t,w=(d-1)*o+c-n,b=Math.floor(g/2),x=g-b,S=Math.floor(y/2),T=y-S,E=Math.floor(w/2),C=w-E;f={top:S,bottom:T,left:E,right:C,front:b,back:x,type:"SAME"}}else throw Error("Unknown padding parameter: ".concat(r));return{padInfo:f,outDepth:h,outHeight:p,outWidth:d}}function jf(r,e){if(!e)return Math.trunc(r);switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode ".concat(e))}}function Kf(r){var e=Se(Hf(r),3),t=e[0],n=e[1],a=e[2];return t===1&&n===1&&a===1}function No(r,e){return Kf(r)||Kf(e)}function cu(r){return Hf(r).every(function(e){return e>0})}function uM(r){if(r==="NHWC")return"channelsLast";if(r==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat ".concat(r))}function Ja(r,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,"."));if(typeof e=="number")W(Bc(e),function(){return"Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,".")});else if(typeof e=="object")e.forEach(function(n){n.forEach(function(a){W(Bc(a),function(){return"Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(a,".")})})});else throw Error("Error in ".concat(r,": Unknown padding parameter: ").concat(e))}}function Upe(r,e){var t=P(r,"x","reshape","string_or_numeric"),n={x:t},a={shape:e};return j.runKernel(RO,n,a)}var me=H({reshape_:Upe});function Vpe(r,e,t,n,a){var i=P(r,"x","avgPool","float32"),o=1;W(No(t,o),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")});var s=i,u=!1;i.rank===3&&(u=!0,s=me(i,[1,i.shape[0],i.shape[1],i.shape[2]])),W(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(s.rank,".")}),Ja("avgPool",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=j.runKernel(KF,c,l);return f=nr(f,i.dtype),u?me(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var cM=H({avgPool_:Vpe});function Gpe(r,e,t,n,a,i){i===void 0&&(i="NDHWC");var o=P(r,"x","avgPool3d","float32"),s=o,u=!1;o.rank===4&&(u=!0,s=me(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),W(s.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),W(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),W(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,function(){return"Error in avgPool3d: Stride must be > 0, but got '".concat(t,"'")}),Ja("avgPool3d",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=j.runKernel(XF,c,l);return f=nr(f,s.dtype),u?me(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var Hpe=H({avgPool3d_:Gpe});function jpe(r,e){e===void 0&&(e=0),W(r.length>=1,function(){return"Pass at least one tensor to concat"});var t=Gf(r,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `.concat(i.dtype,". "))}),t.length===1)return iu(t[0]);var n=t,a={axis:e};return j.runKernel(iR,n,a)}var ia=H({concat_:jpe});function Kpe(r,e,t,n){var a;t===void 0&&(t=!1),n===void 0&&(n=!1);var i=P(r,"a","matMul"),o=P(e,"b","matMul");a=Se(Ir(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:n};return j.runKernel(YF,s,u)}var zt=H({matMul_:Kpe});function Xpe(r){var e=P(r,"x","sigmoid","float32"),t={x:e};return j.runKernel(XO,t)}var Pc=H({sigmoid_:Xpe});function Ype(r,e,t){var n=P(r,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");var a={x:n},i={begin:e,size:t};return j.runKernel(GO,a,i)}var mr=H({slice_:Ype});function Jpe(r){var e=P(r,"x","tanh","float32"),t={x:e};return j.runKernel(vP,t)}var Pb=H({tanh_:Jpe});function Zpe(r,e,t,n,a,i){var o=P(r,"forgetBias","basicLSTMCell"),s=P(e,"lstmKernel","basicLSTMCell"),u=P(t,"lstmBias","basicLSTMCell"),c=P(n,"data","basicLSTMCell"),l=P(a,"c","basicLSTMCell"),f=P(i,"h","basicLSTMCell"),h=ia([c,f],1),p=zt(h,s),d=ht(p,u),m=d.shape[0],v=d.shape[1]/4,g=[m,v],y=mr(d,[0,0],g),w=mr(d,[0,v],g),b=mr(d,[0,v*2],g),x=mr(d,[0,v*3],g),S=ht(Me(Pc(y),Pb(w)),Me(l,Pc(ht(o,b)))),T=Me(Pb(S),Pc(x));return[S,T]}var Qpe=H({basicLSTMCell_:Zpe});function ede(r,e,t){var n=P(r,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});W(n.rank>=1+e.length,function(){return"input rank is ".concat(n.rank," but should be > than blockShape.length ").concat(e.length)}),W(t.length===e.length,function(){return"crops.length is ".concat(t.length," but should be equal to blockShape.length  ").concat(e.length)}),W(n.shape[0]%a===0,function(){return"input tensor batch is ".concat(n.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(e.join(" * ")," === ").concat(a)});var i={x:n},o={blockShape:e,crops:t};return j.runKernel(JF,i,o)}var lM=H({batchToSpaceND_:ede});function tde(r){var e;return r.rank===0||r.rank===1?e=me(r,[1,1,1,r.size]):r.rank===2?e=me(r,[1,1,r.shape[0],r.shape[1]]):r.rank===3?e=me(r,[1,r.shape[0],r.shape[1],r.shape[2]]):e=r,e}function rde(r,e,t,n,a,i){i==null&&(i=.001);var o=P(r,"x","batchNorm"),s=P(e,"mean","batchNorm"),u=P(t,"variance","batchNorm"),c;a!=null&&(c=P(a,"scale","batchNorm"));var l;n!=null&&(l=P(n,"offset","batchNorm")),W(s.rank===u.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),W(l==null||s.rank===l.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),W(c==null||s.rank===c.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var f=tde(o),h={x:f,scale:c,offset:l,mean:s,variance:u},p={varianceEpsilon:i},d=j.runKernel(MR,h,p);return me(d,o.shape)}var wv=H({batchNorm_:rde});function nde(r,e,t,n,a,i){var o=P(r,"x","batchNorm"),s=P(e,"mean","batchNorm"),u=P(t,"variance","batchNorm"),c;a!=null&&(c=P(a,"scale","batchNorm"));var l;return n!=null&&(l=P(n,"offset","batchNorm")),W(o.rank===2,function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(o.rank,".")}),W(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(s.rank,".")}),W(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&W(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&W(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(l.rank,".")}),wv(o,s,u,l,c,i)}var ade=H({batchNorm2d_:nde});function ide(r,e,t,n,a,i){var o=P(r,"x","batchNorm"),s=P(e,"mean","batchNorm"),u=P(t,"variance","batchNorm"),c;a!=null&&(c=P(a,"scale","batchNorm"));var l;return n!=null&&(l=P(n,"offset","batchNorm")),W(o.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(o.rank,".")}),W(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(s.rank,".")}),W(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&W(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&W(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(l.rank,".")}),wv(o,s,u,l,c,i)}var ode=H({batchNorm3d_:ide});function sde(r,e,t,n,a,i){var o=P(r,"x","batchNorm"),s=P(e,"mean","batchNorm"),u=P(t,"variance","batchNorm"),c;a!=null&&(c=P(a,"scale","batchNorm"));var l;return n!=null&&(l=P(n,"offset","batchNorm")),W(o.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(o.rank,".")}),W(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(s.rank,".")}),W(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&W(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&W(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(l.rank,".")}),wv(o,s,u,l,c,i)}var ude=H({batchNorm4d_:sde});function cde(r,e,t){var n=P(r,"x","bincount"),a=P(e,"weights","bincount");W(n.dtype==="int32",function(){return"Error in bincount: input "+"dtype must be int32, but got ".concat(n.dtype)}),W(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),W(a.size===n.size||a.size===0,function(){return"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(n.shape,", weights shape: ")+"".concat(a.shape,".")});var i={x:n,weights:a},o={size:t};return j.runKernel(ZF,i,o)}var fM=H({bincount_:cde});function lde(r,e){var t=P(r,"x","bitwiseAnd"),n=P(e,"y","bitwiseAnd");if(!ko(t.shape,n.shape))throw new Error("BitwiseAnd: Tensors must have the same shape. x: ".concat(t.shape,", y: ").concat(n.shape));if(t.dtype!=="int32"||n.dtype!=="int32")throw new Error("BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ".concat(t.dtype," and type of y: ").concat(n.dtype));var a={a:t,b:n};return j.runKernel(QF,a)}var fde=H({bitwiseAnd_:lde});function hde(r,e){var t=P(r,"s0","broadcastArgs","int32"),n=P(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error("broadcastArgs(): first input must be a vector (rank=1). "+"Has rank ".concat(t.rank));if(n.rank!==1)throw new Error("broadcastArgs(): second input must be a vector (rank=1). "+"Has rank ".concat(n.rank));var a={s0:t,s1:n};return j.runKernel(eR,a)}var pde=H({broadcastArgs_:hde});function dde(r,e){var t=P(r,"broadcastTo","x"),n=t.shape;if(oa(e),e.length<t.rank)throw new Error("broadcastTo(): shape.length=".concat(e.length," < input.rank=").concat(t.rank,"."));if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=me(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): [".concat(n,"] cannot be broadcast to [").concat(e,"]."));var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return iu(t);var c={x:t},l={reps:o};return j.runKernel(Yb,c,l)}var rv=H({broadcastTo_:dde});function vde(r){var e=P(r,"x","ceil","float32"),t={x:e};return j.runKernel(tR,t)}var mde=H({ceil_:vde});function sh(r,e,t){oa(r),t=t||rh(e);var n={shape:r,value:e,dtype:t};return j.runKernel(FR,{},n)}function gde(r,e,t){var n=P(r,"x","clipByValue");if(W(e<=t,function(){return"Error in clip: min (".concat(e,") must be ")+"less than or equal to max (".concat(t,").")}),e===t)return sh(n.shape,e,n.dtype);var a={x:n},i={clipValueMin:e,clipValueMax:t};return j.runKernel(rR,a,i)}var yde=H({clipByValue_:gde});function bde(r){return ia(r,0)}var wde=H({concat1d_:bde});function xde(r,e){return ia(r,e)}var kde=H({concat2d_:xde});function Sde(r,e){return ia(r,e)}var Nde=H({concat3d_:Sde});function Tde(r,e){return ia(r,e)}var Ede=H({concat4d_:Tde});function Ide(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=P(r,"x","conv2d","float32"),u=P(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=me(s,[1,s.shape[0],s.shape[1],s.shape[2]])),W(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")}),W(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")}),Ja("conv2d",n,o);var f=a==="NHWC"?c.shape[3]:c.shape[1];W(f===u.shape[2],function(){return"Error in conv2d: depth of input (".concat(f,") must match ")+"input depth for filter ".concat(u.shape[2],".")}),W(No(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),W(cu(i),function(){return"Error in conv2D: Dilated rates should be larger than 0."}),W(cu(t),function(){return"Error in conv2D: Strides should be larger than 0."});var h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=j.runKernel(oR,h,p);return l?me(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var xv=H({conv2d_:Ide});function Cde(r,e,t,n,a,i,o){a===void 0&&(a="NWC"),i===void 0&&(i=1);var s=P(r,"x","conv1d"),u=P(e,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=me(s,[1,s.shape[0],s.shape[1]])),W(c.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")}),W(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+"".concat(u.rank,".")}),Ja("conv1d",n,o),W(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match ")+"input depth for filter ".concat(u.shape[1],".")}),W(No(t,i),function(){return"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(t," and dilation '").concat(i,"'")}),W(cu(i),function(){return"Error in conv1D: Dilated rates should be larger than 0."}),W(cu(t),function(){return"Error in conv1D: Stride should be larger than 0."}),W(a==="NWC",function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")});var f=me(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=me(c,[c.shape[0],1,c.shape[1],c.shape[2]]),p=[1,t],d=[1,i],m="NHWC",v=xv(h,f,p,n,m,d,o);return l?me(v,[v.shape[2],v.shape[3]]):me(v,[v.shape[0],v.shape[2],v.shape[3]])}var Ade=H({conv1d_:Cde});function Dde(r,e,t,n,a,i,o){i===void 0&&(i="NHWC"),W(r.length===e.rank,function(){return"Length of inShape "+"(".concat(r.length,") and rank of dy (").concat(e.rank,") must match")});var s=r,u=e,c=!1;e.rank===3&&(c=!0,u=me(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,r[0],r[1],r[2]]),W(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")}),W(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)}),W(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(t.rank)});var l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];W(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(t.shape[2],".")}),W(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output (".concat(f,") must ")+"match output depth for filter ".concat(t.shape[3],".")}),Ja("conv2dDerInput",a,o);var h={dy:u,filter:t},p={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=j.runKernel(uR,h,p);return c?me(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var hM=H({conv2DBackpropInput_:Dde});function _de(r,e,t,n,a,i){var o=P(r,"x","conv2dTranspose"),s=P(e,"filter","conv2dTranspose");return hM(t,o,s,n,a,"NHWC",i)}var Fde=H({conv2dTranspose_:_de});function Rde(r,e,t,n,a,i){a===void 0&&(a="NDHWC"),i===void 0&&(i=[1,1,1]);var o=P(r,"x","conv3d"),s=P(e,"filter","conv3d"),u=o,c=!1;o.rank===4&&(c=!0,u=me(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),W(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")}),W(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+"".concat(s.rank,".")}),W(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match ")+"input depth for filter ".concat(s.shape[3],".")}),W(No(t,i),function(){return"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),W(a==="NDHWC",function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")}),W(cu(i),function(){return"Error in conv3D: Dilated rates should be larger than 0."}),W(cu(t),function(){return"Error in conv3D: Strides should be larger than 0."});var l={x:u,filter:s},f={strides:t,pad:n,dataFormat:a,dilations:i},h=j.runKernel(cR,l,f);return c?me(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var Ode=H({conv3d_:Rde});function Pde(r,e,t,n,a){W(r.length===e.rank,function(){return"Length of inShape "+"(".concat(r.length,") and rank of dy (").concat(e.rank,") must match")});var i=r,o=e,s=!1;e.rank===4&&(s=!0,o=me(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,r[0],r[1],r[2],r[3]]);var u=i[4],c=o.shape[4];W(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")}),W(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)}),W(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(t.rank)}),W(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(t.shape[3],".")}),W(c===t.shape[4],function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(t.shape[4],".")});var l={dy:o,filter:t},f={pad:a,strides:n,inputShape:i},h=j.runKernel(lR,l,f);return s?me(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var Mde=H({conv3DBackpropInput_:Pde});function Bde(r,e,t,n,a){var i=P(r,"x","conv3dTranspose"),o=P(e,"filter","conv3dTranspose");return Mde(t,i,o,n,a)}var Lde=H({conv3dTranspose_:Bde});function qde(r){var e=P(r,"x","cos","float32"),t={x:e};return j.runKernel(fR,t)}var zde=H({cos_:qde});function $de(r){var e=P(r,"x","cosh","float32"),t={x:e};return j.runKernel(hR,t)}var Wde=H({cosh_:$de});function Ude(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=P(r,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:n};return j.runKernel(pR,i,o)}var Vde=H({cumprod_:Ude});function Gde(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=P(r,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:n};return j.runKernel(dR,i,o)}var Hde=H({cumsum_:Gde});function jde(r,e,t,n){n===void 0&&(n=!1);var a=P(r,"x","denseBincount"),i=P(e,"weights","denseBincount");W(a.dtype==="int32",function(){return"Error in denseBincount: input "+"dtype must be int32, but got ".concat(a.dtype)}),W(a.rank<=2,function(){return"Error in denseBincount: input must be at most rank 2, but got "+"rank ".concat(a.rank,".")}),W(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),W(i.size===a.size||i.size===0,function(){return"Error in denseBincount: weights must have the same shape as x or "+"0-length, but got x shape: ".concat(a.shape,", weights shape: ")+"".concat(i.shape,".")});var o={x:a,weights:i},s={size:t,binaryOutput:n};return j.runKernel(mR,o,s)}var Kde=H({denseBincount_:jde});function Xde(r,e,t){t===void 0&&(t="NHWC");var n=P(r,"x","depthToSpace","float32"),a=t==="NHWC"?n.shape[1]:n.shape[2],i=t==="NHWC"?n.shape[2]:n.shape[3],o=t==="NHWC"?n.shape[3]:n.shape[1];W(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(e)}),W(a*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(a," and ").concat(e,`  for depthToSpace with input shape
    `).concat(n.shape)}),W(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(i," and ").concat(e,` for depthToSpace with input shape
        `).concat(n.shape)}),W(o%(e*e)===0,function(){return"Dimension size must be evenly divisible by ".concat(e*e," but is ").concat(o," for depthToSpace with input shape ").concat(n.shape)});var s={x:n},u={blockSize:e,dataFormat:t};return j.runKernel(gR,s,u)}var Yde=H({depthToSpace_:Xde});function Jde(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=P(r,"x","depthwiseConv2d","float32"),u=P(e,"filter","depthwiseConv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=me(s,[1,s.shape[0],s.shape[1],s.shape[2]])),W(c.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(c.rank,".")}),W(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")});var f=a==="NHWC"?c.shape[3]:c.shape[1];W(f===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels "+"(".concat(f,") must match the inChannels dimension in ")+"filter ".concat(u.shape[2],".")}),Ja("depthwiseConv2d",n,o);var h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=j.runKernel(yR,h,p);return l?me(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var aw=H({depthwiseConv2d_:Jde});function Zde(r){var e=P(r,"x","diag"),t={x:e};return j.runKernel(xR,t)}var Qde=H({diag_:Zde});function eve(r,e,t,n,a,i){a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC");var o=P(r,"x","dilation2d"),s=P(e,"filter","dilation2d");W(o.rank===3||o.rank===4,function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(o.rank,".")}),W(s.rank===3,function(){return"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(s.rank,".")}),W(i==="NHWC",function(){return"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(i)});var u=o,c=!1;o.rank===3&&(u=me(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),W(u.shape[3]===s.shape[2],function(){return"Error in dilation2d:  input and filter must have the same depth: ".concat(u.shape[3]," vs ").concat(s.shape[2])});var l={x:u,filter:s},f={strides:t,pad:n,dilations:a},h=j.runKernel(kR,l,f);return c?me(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var tve=H({dilation2d_:eve});function pM(r,e){for(var t=r.length,n=[],a=0;a<t;a++){var i=t-1-a,o=r[i]||1,s=e[e.length-1-a]||1;s>1&&o===1&&n.unshift(i)}return n}function iw(r,e){for(var t=[],n=0;n<e.length;n++){var a=r[r.length-n-1],i=e.length-n-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function jr(r,e){for(var t=Math.max(r.length,e.length),n=new Array(t),a=0;a<t;a++){var i=r[r.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)n[t-a-1]=o;else if(o===1)n[t-a-1]=i;else if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(r," and ").concat(e,".");throw Error(s)}else n[t-a-1]=i}return n}var rve={__proto__:null,assertAndGetBroadcastShape:jr,getBroadcastDims:pM,getReductionAxes:iw};function nve(r,e){var t,n=P(r,"a","equal","string_or_numeric"),a=P(e,"b","equal","string_or_numeric");t=Se(Ir(n,a),2),n=t[0],a=t[1],jr(n.shape,a.shape);var i={a:n,b:a};return j.runKernel(IR,i)}var dM=H({equal_:nve});function ave(r,e,t){var n=P(e,"a","where"),a=P(t,"b","where"),i=P(r,"condition","where","bool"),o=jr(jr(i.shape,n.shape),a.shape),s=rv(i,o),u=rv(n,o),c=rv(a,o),l={condition:s,t:u,e:c};return j.runKernel(UO,l)}var os=H({where_:ave});function ive(r){var e=P(r,"x","zerosLike"),t={x:e};return j.runKernel(xP,t)}var Da=H({zerosLike_:ive});function ove(r,e){var t,n=P(r,"a","div"),a=P(e,"b","div");t=Se(Ir(n,a),2),n=t[0],a=t[1];var i=er(n,a),o=Da(i),s=dM(a,o);return os(s,o,i)}var sve=H({divNoNan_:ove});function uve(r,e){var t=P(r,"t1","dot"),n=P(e,"t2","dot");W((t.rank===1||t.rank===2)&&(n.rank===1||n.rank===2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(t.rank," and ").concat(n.rank,".")});var a=t.rank===1?t.size:t.shape[1],i=n.rank===1?n.size:n.shape[0];if(W(a===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+"".concat(a," and ").concat(i,".")}),t.rank===1&&n.rank===1){var o=me(t,[1,-1]),s=me(n,[-1,1]),u=zt(o,s);return me(u,[])}else if(t.rank===1&&n.rank===2){var o=me(t,[1,-1]),s=me(n,[n.shape[0],n.shape[1]]),u=zt(o,s);return me(u,[u.size])}else if(t.rank===2&&n.rank===1){var s=me(n,[-1,1]),u=zt(t,s);return me(u,[u.size])}else{var s=me(n,[n.shape[0],n.shape[1]]),u=zt(t,s);return u}}var cve=H({dot_:uve});function lve(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var n=e.map(function(i,o){return P(i,"tensors".concat(o),"einsum")}),a={equation:r};return j.runKernel(NR,n,a)}var Ac=H({einsum_:lve});function fve(r){var e=P(r,"x","elu","float32"),t={x:e};return j.runKernel(TR,t)}var vM=H({elu_:fve});function hve(r,e){var t=P(r,"x","ensureShape","string_or_numeric");if(!NF(t.shape,e))throw new Error("EnsureShape: Shape of tensor ".concat(t.shape," is not compatible with expected shape ").concat(e));return r}var pve=H({ensureShape_:hve});function dve(r){var e=P(r,"x","erf");W(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=nr(e,"float32"));var t={x:e};return j.runKernel(ER,t)}var vve=H({erf_:dve});function ow(r,e){for(var t=0;t<r.length;++t)if(r[r.length-t-1]!==e-1-t)return!1;return!0}function mM(r,e,t){for(var n=r.length+e.length,a=[],i=0,o=0,s=0;s<n;s++)t.indexOf(s)===-1?a.push(r[i++]):a.push(e[o++]);return a}function mve(r,e){for(var t=[],n=r.length,a=0;a<n;a++)e.indexOf(a)===-1&&t.push(r[a]);var i=e.map(function(o){return r[o]});return[t,i]}function uh(r,e){var t=e.map(function(n){return 1});return mM(r,t,e)}function gve(r,e,t){W(ow(e,t),function(){return"".concat(r," supports only inner-most axes for now. ")+"Got axes ".concat(e," and rank-").concat(t," input.")})}function yve(r,e){if(ow(r,e))return null;for(var t=[],n=0;n<e;++n)r.indexOf(n)===-1&&t.push(n);return r.forEach(function(a){return t.push(a)}),t}function bve(r){return r.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function wve(r,e){for(var t=[],n=e-r;n<e;++n)t.push(n);return t}function xve(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=P(r,"x","max"),a={x:n},i={reductionIndices:e,keepDims:t};return j.runKernel(rO,a,i)}var Mc=H({max_:xve});function kve(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=P(r,"x","min"),a={x:n},i={axis:e,keepDims:t};return j.runKernel(uO,a,i)}var Mb=H({min_:kve});function Sve(r,e){var t,n=P(r,"base","pow"),a=P(e,"exp","pow");t=Se(Ir(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return j.runKernel(SO,i)}var Xf=H({pow_:Sve});function Kt(r,e){if((on(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&on(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],n=[];return hs(r,t,n,e)}function Nve(r){var e=P(r,"x","sqrt","float32"),t={x:e};return j.runKernel(JO,t)}var wo=H({sqrt_:Nve});function Tve(r){var e=P(r,"x","square"),t={};return j.runKernel("Square",{x:e},t)}var Ni=H({square_:Tve});function Eve(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=P(r,"x","sum");n.dtype==="bool"&&(n=nr(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return j.runKernel(ZO,a,i)}var Qt=H({sum_:Eve});function Ive(r,e,t,n){e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1),r=P(r,"x","norm");var a=gM(r,e,t),i=a.shape;if(n){var o=th(t,r.shape);i=uh(a.shape,o)}return me(a,i)}function gM(r,e,t){if(t===void 0&&(t=null),r.rank===0)return Aa(r);if(r.rank!==1&&t===null)return gM(me(r,[-1]),e,t);if(r.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Qt(Aa(r),t);if(e===1/0)return Mc(Aa(r),t);if(e===-1/0)return Mb(Aa(r),t);if(e==="euclidean"||e===2)return wo(Qt(Xf(Aa(r),Kt(2,"int32")),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}if(Array.isArray(t)&&t.length===2){if(e===1)return Mc(Qt(Aa(r),t[0]),t[1]-1);if(e===1/0)return Mc(Qt(Aa(r),t[1]),t[0]);if(e===-1/0)return Mb(Qt(Aa(r),t[1]),t[0]);if(e==="fro"||e==="euclidean")return wo(Qt(Ni(r),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}throw new Error("Error in norm: invalid axis: ".concat(t))}var kv=H({norm_:Ive});function Cve(r,e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),kv(r,"euclidean",e,t)}var Ave=H({euclideanNorm_:Cve});function Dve(r){var e=P(r,"x","exp"),t={x:e};return j.runKernel(CR,t)}var lu=H({exp_:Dve});function _ve(r,e){e===void 0&&(e=0);var t=P(r,"x","expandDims","string_or_numeric");W(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var n={input:t},a={dim:e};return j.runKernel(AR,n,a)}var ts=H({expandDims_:_ve});function Fve(r){var e=P(r,"x","expm1"),t={x:e};return j.runKernel(DR,t)}var Rve=H({expm1_:Fve});function Ove(r,e){var t=P(r,"x","tile","string_or_numeric");W(t.rank===e.length,function(){return"Error in transpose: rank of input ".concat(t.rank," ")+"must match length of reps ".concat(e,".")});var n={x:t},a={reps:e};return j.runKernel(Yb,n,a)}var Lf=H({tile_:Ove});function Pve(r,e,t,n){n===void 0&&(n="float32"),e==null&&(e=r);for(var a=bo([r,e],n),i=r<=e?r:e,o=0;o<i;++o)a.set(1,o,o);var s=me(a.toTensor(),[r,e]);if(t==null)return s;if(t.length===1)return Lf(ts(s,0),[t[0],1,1]);if(t.length===2)return Lf(ts(ts(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return Lf(ts(ts(ts(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(t.length,"D."))}var yM=H({eye_:Pve});function Mve(r){var e=P(r,"x","floor","float32"),t={x:e};return j.runKernel(OR,t)}var bM=H({floor_:Mve});function Bve(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=0);var a=P(r,"x","gather"),i=P(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:n};return j.runKernel(BR,o,s)}var wM=H({gather_:Bve});function Lve(r,e){var t,n=P(r,"a","greater","string_or_numeric"),a=P(e,"b","greater","string_or_numeric");t=Se(Ir(n,a),2),n=t[0],a=t[1],jr(n.shape,a.shape);var i={a:n,b:a};return j.runKernel(qR,i)}var Sv=H({greater_:Lve});function qve(r,e){var t,n=P(r,"a","greaterEqual","string_or_numeric"),a=P(e,"b","greaterEqual","string_or_numeric");t=Se(Ir(n,a),2),n=t[0],a=t[1],jr(n.shape,a.shape);var i={a:n,b:a};return j.runKernel(zR,i)}var xM=H({greaterEqual_:qve});function zve(r){var e=P(r,"input","imag"),t={input:e};return j.runKernel(WR,t)}var Nv=H({imag_:zve});function $ve(r){var e=P(r,"x","isFinite"),t={x:e};return j.runKernel(UR,t)}var Wve=H({isFinite_:$ve});function Uve(r){var e=P(r,"x","isInf"),t={x:e};return j.runKernel(VR,t)}var Vve=H({isInf_:Uve});function Gve(r){var e=P(r,"x","isNaN"),t={x:e};return j.runKernel(GR,t)}var Hve=H({isNaN_:Gve});function jve(r,e){e===void 0&&(e=.2);var t=P(r,"x","leakyRelu"),n={x:t},a={alpha:e};return j.runKernel(HR,n,a)}var kM=H({leakyRelu_:jve});function Kve(r,e){var t,n=P(r,"a","less","string_or_numeric"),a=P(e,"b","less","string_or_numeric");t=Se(Ir(n,a),2),n=t[0],a=t[1],jr(n.shape,a.shape);var i={a:n,b:a};return j.runKernel(jR,i)}var Bb=H({less_:Kve});function Xve(r,e){var t,n=P(r,"a","lessEqual","string_or_numeric"),a=P(e,"b","lessEqual","string_or_numeric");t=Se(Ir(n,a),2),n=t[0],a=t[1],jr(n.shape,a.shape);var i={a:n,b:a};return j.runKernel(KR,i)}var sw=H({lessEqual_:Xve});function Yve(r,e,t){if(t<=0)throw new Error("The number of values should be positive.");var n={start:r,stop:e,num:t};return j.runKernel(XR,{},n)}function Jve(r,e,t,n,a){e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),a===void 0&&(a=.5);var i=P(r,"x","localResponseNormalization");W(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `.concat(i.rank,".")}),W(Bc(e),function(){return"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(e,".")});var o=i,s=!1;i.rank===3&&(s=!0,o=me(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:e,bias:t,alpha:n,beta:a},l=j.runKernel(tO,u,c);return s?me(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var Zve=H({localResponseNormalization_:Jve});function Qve(r){var e=P(r,"x","log","float32"),t={x:e};return j.runKernel(YR,t)}var Yf=H({log_:Qve});function eme(r){var e=P(r,"x","log1p"),t={x:e};return j.runKernel(JR,t)}var SM=H({log1p_:eme});function tme(r){return W(ss(r),function(){return"The f passed in grad(f) must be a function"}),function(e,t){var n=P(e,"x","tf.grad","string_or_numeric"),a=t!=null?P(t,"dy","tf.grad"):null;return j.tidy(function(){var i=j.gradients(function(){return r(n)},[n],a),o=i.value,s=i.grads;return a!=null&&Fn(o.shape,a.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),Tv(s),s[0]})}}function rme(r){return W(ss(r),function(){return"The f passed in grads(f) must be a function"}),function(e,t){W(Array.isArray(e),function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"});var n=Gf(e,"args","tf.grads","string_or_numeric"),a=t!=null?P(t,"dy","tf.grads"):null;return j.tidy(function(){var i=j.gradients(function(){return r.apply(void 0,Et([],Se(n),!1))},n,a),o=i.value,s=i.grads;return a!=null&&Fn(o.shape,a.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Tv(s),s})}}function nme(r){return W(ss(r),function(){return"The f passed in valueAndGrad(f) must be a function"}),function(e,t){W(e instanceof Gr,function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"}),W(t==null||t instanceof Gr,function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"});var n=j.gradients(function(){return r(e)},[e],t),a=n.grads,i=n.value;return Tv(a),{grad:a[0],value:i}}}function ame(r){return W(ss(r),function(){return"The f passed in valueAndGrads(f) must be a function"}),function(e,t){W(Array.isArray(e)&&e.every(function(a){return a instanceof Gr}),function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"}),W(t==null||t instanceof Gr,function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"});var n=j.gradients(function(){return r.apply(void 0,Et([],Se(e),!1))},e,t);return t!=null&&Fn(n.value.shape,t.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),Tv(n.grads),n}}function NM(r,e){W(ss(r),function(){return"The f passed in variableGrads(f) must be a function"}),W(e==null||Array.isArray(e)&&e.every(function(f){return f instanceof Vf}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t){e=[];for(var n in j.registeredVariables)e.push(j.registeredVariables[n])}var a=t?e.filter(function(f){return!f.trainable}):null,i=e.length;e=e.filter(function(f){return f.trainable}),W(e.length>0,function(){return"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(i," variables is ")+"trainable."});var o=!0,s=j.gradients(r,e,null,o),u=s.value,c=s.grads;W(c.some(function(f){return f!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),W(u.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(u.rank," tensor")});var l={};return e.forEach(function(f,h){c[h]!=null&&(l[f.name]=c[h])}),a?.forEach(function(f){return l[f.name]=null}),{value:u,grads:l}}function Xi(r){return j.customGrad(r)}function Tv(r){var e=r.filter(function(t){return t==null}).length;if(e>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}function ime(r){var e=P(r,"x","neg"),t={x:e};return j.runKernel(dO,t)}var ji=H({neg_:ime});function ome(r){var e=P(r,"x","softplus"),t={x:e};return j.runKernel(YO,t)}var TM=H({softplus_:ome});function sme(r){var e=P(r,"x","logSigmoid"),t=Xi(function(n){var a=ji(TM(ji(n))),i=function(o){var s=Me(o,Pc(ji(n)));return s};return{value:a,gradFunc:i}});return t(e)}var ume=H({logSigmoid_:sme});function cme(r,e){var t,n=P(r,"a","sub"),a=P(e,"b","sub");t=Se(Ir(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return j.runKernel(pP,i)}var Tt=H({sub_:cme});function lme(r,e){e===void 0&&(e=-1);var t=P(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and axis was ").concat(e));var n=Xi(function(a,i){var o=!0,s=Mc(a,e,!0),u=Tt(a,s),c=Tt(nr(u,"float32"),Yf(Qt(lu(u),e,o)));i([c]);var l=function(f,h){var p=Se(h,1),d=p[0],m=!0,v=lu(d);return Tt(f,Me(Qt(f,e,m),v))};return{value:c,gradFunc:l}});return n(t)}var fme=H({logSoftmax_:lme});function hme(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=P(r,"x","logSumExp"),a=th(e,n.shape),i=Mc(n,a,!0),o=Tt(n,i),s=lu(o),u=Qt(s,a),c=Yf(u),l=ht(me(i,c.shape),c);if(t){var f=uh(l.shape,a);return me(l,f)}return l}var EM=H({logSumExp_:hme});function pme(r,e){var t=P(r,"a","logicalAnd","bool"),n=P(e,"b","logicalAnd","bool");jr(t.shape,n.shape);var a={a:t,b:n};return j.runKernel(ZR,a)}var lv=H({logicalAnd_:pme});function dme(r){var e=P(r,"x","logicalNot","bool"),t={x:e};return j.runKernel(QR,t)}var IM=H({logicalNot_:dme});function vme(r,e){var t=P(r,"a","logicalOr","bool"),n=P(e,"b","logicalOr","bool");jr(t.shape,n.shape);var a={a:t,b:n};return j.runKernel(eO,a)}var CM=H({logicalOr_:vme});function mme(r,e){var t=P(r,"a","logicalXor","bool"),n=P(e,"b","logicalXor","bool");return jr(t.shape,n.shape),lv(CM(r,e),IM(lv(r,e)))}var gme=H({logicalXor_:mme});var Zd=2147483648;function yme(r,e,t){t===void 0&&(t="left");var n=P(r,"sortedSequence","searchSorted"),a=P(e,"values","searchSorted"),i=n.shape[n.shape.length-1],o=a.shape[a.shape.length-1],s=me(n,[-1,i]),u=me(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(Vt(u.shape)>=Zd)throw new Error("values tensor size must less than ".concat(Zd));if(s.shape[1]>=Zd)throw new Error("trailing dim_size must less than ".concat(Zd," for int32 output type, was ").concat(s.shape[1]));var c={sortedSequence:s,values:u},l={side:t};return j.runKernel(WO,c,l)}var uw=H({searchSorted_:yme});function bme(r,e){return uw(r,e,"left")}function wme(r,e,t,n,a){var i=P(r,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=me(i,[1,i.shape[0],i.shape[1],i.shape[2]])),W(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(s.rank,".")}),W(No(t,o),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")}),Ja("maxPool",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=j.runKernel(aO,c,l);return u?me(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var AM=H({maxPool_:wme});function xme(r,e,t,n,a,i){e===void 0&&(e=[1,1,1]),i===void 0&&(i="NDHWC");var o=P(r,"x","maxPool3d"),s=o,u=!1;o.rank===4&&(u=!0,s=me(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),W(s.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),W(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),Ja("maxPool3d",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=j.runKernel(iO,c,l);return u?me(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var kme=H({maxPool3d_:xme});function Sme(r,e,t,n,a){a===void 0&&(a=!1);var i=P(r,"x","maxPoolWithArgmax"),o={x:i},s={filterSize:e,strides:t,pad:n,includeBatchInIndex:a},u=j.runKernel(oO,o,s);return{result:u[0],indexes:u[1]}}var Nme=H({maxPoolWithArgmax_:Sme});function Tme(r,e){var t,n=P(r,"a","maximum"),a=P(e,"b","maximum");t=Se(Ir(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=nr(n,"int32"),a=nr(a,"int32")),jr(n.shape,a.shape);var i={a:n,b:a};return j.runKernel(nO,i)}var DM=H({maximum_:Tme});function Eme(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=P(r,"x","mean"),a={x:n},i={axis:e,keepDims:t};return j.runKernel(sO,a,i)}var fv=H({mean_:Eme});function zc(r,e){if(e===void 0&&(e="float32"),oa(r),e==="complex64"){var t=zc(r,"float32"),n=zc(r,"float32");return cs(t,n)}var a=mv(Vt(r),e);return j.makeTensor(a,r,e)}function au(r,e){if(e===void 0&&(e="float32"),oa(r),e==="complex64"){var t=au(r,"float32"),n=zc(r,"float32");return cs(t,n)}var a=Vb(Vt(r),e);return j.makeTensor(a,r,e)}function Ime(r,e,t){var n=t===void 0?{}:t,a=n.indexing,i=a===void 0?"xy":a;if(i!=="xy"&&i!=="ij")throw new TypeError("".concat(i," is not a valid third argument to meshgrid"));if(r===void 0)return[];var o=P(r,"x","meshgrid",r instanceof Gr?r.dtype:"float32");if(e===void 0)return[o];var s=P(e,"y","meshgrid",e instanceof Gr?e.dtype:"float32"),u=Vt(o.shape),c=Vt(s.shape);return i==="xy"?(o=me(o,[1,-1]),s=me(s,[-1,1]),[zt(au([c,1],o.dtype),o),zt(s,au([1,u],s.dtype))]):(o=me(o,[-1,1]),s=me(s,[1,-1]),[zt(o,au([1,c],o.dtype)),zt(au([u,1],s.dtype),s)])}function Cme(r,e){var t,n=P(r,"a","minimum"),a=P(e,"b","minimum");t=Se(Ir(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=nr(n,"int32"),a=nr(a,"int32")),jr(n.shape,a.shape);var i={a:n,b:a};return j.runKernel(cO,i)}var hv=H({minimum_:Cme});function Ame(r,e,t){W(t==="reflect"||t==="symmetric",function(){return"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(t,".")});var n=P(r,"x","mirrorPad");if(n.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");W(e.length===n.rank,function(){return"Padding doesn't match input. Must be ".concat(n.rank,". ")+"Got ".concat(e.length,".")});for(var a=t==="reflect"?1:0,i=function(c){W(e[c].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),W(e[c][0]>=0&&e[c][0]<=n.shape[c]-a&&e[c][1]>=0&&e[c][1]<=n.shape[c]-a,function(){return"Padding in dimension ".concat(c," cannot be greater than or equal ")+"to ".concat(n.shape[c]-a," or less than 0 for input of ")+"shape ".concat(n.shape)})},o=0;o<n.rank;o++)i(o);var s={paddings:e,mode:t},u={x:n};return j.runKernel(lO,u,s)}var Dme=H({mirrorPad_:Ame});function _me(r,e){var t,n=P(r,"a","mod"),a=P(e,"b","mod");t=Se(Ir(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return j.runKernel(fO,i)}var Fme=H({mod_:_me});function Rme(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1),r=P(r,"x","moments");var n=th(e,r.shape),a=fv(r,n,t),i=a.shape;t||(i=uh(a.shape,n));var o=Ni(Tt(nr(r,"float32"),me(a,i))),s=fv(o,n,t);return{mean:a,variance:s}}var Ome=H({moments_:Rme});function Pme(r,e,t,n){for(var a=P(e,"data","multiRNNCell"),i=Gf(t,"c","multiRNNCell"),o=Gf(n,"h","multiRNNCell"),s=a,u=[],c=0;c<r.length;c++){var l=r[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}for(var f=[],h=[],c=0;c<u.length;c+=2)f.push(u[c]),h.push(u[c+1]);return[f,h]}var Mme=H({multiRNNCell_:Pme});function Bme(r,e,t,n){n===void 0&&(n=!1);var a=P(r,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+"".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));t=t||Math.random();var s=o===1?me(a,[1,-1]):a,u={logits:s},c={numSamples:e,seed:t,normalized:n},l=j.runKernel(hO,u,c);return o===1?me(l,[l.size]):l}var Lme=H({multinomial_:Bme});function qme(r,e){var t,n=P(r,"a","notEqual","string_or_numeric"),a=P(e,"b","notEqual","string_or_numeric");t=Se(Ir(n,a),2),n=t[0],a=t[1],jr(n.shape,a.shape);var i={a:n,b:a};return j.runKernel(vO,i)}var _M=H({notEqual_:qme});function zme(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n=0),a===void 0&&(a="int32"),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(e));var i=P(r,"indices","oneHot","int32"),o={indices:i},s={dtype:a,depth:e,onValue:t,offValue:n};return j.runKernel(wO,o,s)}var Lb=H({oneHot_:zme});function $me(r){var e=P(r,"x","onesLike"),t={x:e};return j.runKernel(bO,t)}var Wme=H({onesLike_:$me});function Ume(r,e){var t=P(r,"v1","outerProduct"),n=P(e,"v2","outerProduct");W(t.rank===1&&n.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+"".concat(t.rank," and ").concat(n.rank,".")});var a=me(t,[-1,1]),i=me(n,[1,-1]);return zt(a,i)}var Vme=H({outerProduct_:Ume});function Gme(r,e,t){t===void 0&&(t=0);var n=P(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:n};return j.runKernel(kO,i,a)}var ch=H({pad_:Gme});function Hme(r,e,t){return t===void 0&&(t=0),W(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),ch(r,[e],t)}var jme=H({pad1d_:Hme});function Kme(r,e,t){return t===void 0&&(t=0),W(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),ch(r,e,t)}var Xme=H({pad2d_:Kme});function Yme(r,e,t){return t===void 0&&(t=0),W(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),ch(r,e,t)}var Jme=H({pad3d_:Yme});function Zme(r,e,t){return t===void 0&&(t=0),W(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),ch(r,e,t)}var Qme=H({pad4d_:Zme});function ege(r,e,t){var n=P(r,"x","spaceToBatchND");W(n.rank>=1+e.length,function(){return"input rank ".concat(n.rank," should be > than [blockShape] ").concat(e.length)}),W(t.length===e.length,function(){return"paddings.shape[0] ".concat(t.length," must be equal to [blockShape] ").concat(e.length)}),W(n.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions ".concat(n.shape.slice(1)," with paddings ").concat(t.toString()," must be divisible by blockShapes ").concat(e.toString())});var a={x:n},i={blockShape:e,paddings:t};return j.runKernel(QO,a,i)}var FM=H({spaceToBatchND_:ege});function tge(r,e,t,n,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),n===0&&(n="valid");var s=P(r,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=me(s,[1,s.shape[0],s.shape[1],s.shape[2]])),W(No(i,a),function(){return"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'")});var l=oM(u.shape,e,i,a,n),f=[l.dilationHeight,l.dilationWidth],h;n==="same"?h=nge([l.filterHeight,l.filterWidth],f):h=[[0,0],[0,0]];var p=f[0]===1&&f[1]===1,d=Se(rge([l.inHeight,l.inWidth],f,h),2),m=d[0],v=d[1],g=p?n:"valid",y=p?u:FM(u,f,m),w=t==="avg"?function(){return cM(y,e,i,g,o)}:function(){return AM(y,e,i,g,o)},b=w(),x=p?b:lM(b,f,v);return c?me(x,[x.shape[1],x.shape[2],x.shape[3]]):x}function rge(r,e,t){var n=t.map(function(l){return l[0]}),a=t.map(function(l){return l[1]}),i=r.concat(n,a),o=e.map(function(l,f){return(l-i[f]%l)%l}),s=a.map(function(l,f){return l+o[f]}),u=e.map(function(l,f){return[n[f],s[f]]}),c=e.map(function(l,f){return[0,o[f]]});return[u,c]}function nge(r,e){var t=r.map(function(o,s){return o+(o-1)*(e[s]-1)}),n=t.map(function(o){return o-1}),a=n.map(function(o){return Math.floor(o/2)}),i=n.map(function(o,s){return o-a[s]});return n.map(function(o,s){return[a[s],i[s]]})}var age=H({pool_:tge});function ige(r,e){var t=P(r,"x","prelu"),n=P(e,"alpha","prelu"),a={x:t,alpha:n};return j.runKernel(NO,a)}var RM=H({prelu_:ige});function oge(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=P(r,"x","prod");n.dtype==="bool"&&(n=nr(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return j.runKernel(TO,a,i)}var sge=H({prod_:oge});function uge(r,e,t,n){var a=r.map(function(l,f){return P(l,"tensors".concat(f),"raggedGather","int32")}),i=P(e,"paramsDenseValues","raggedGather"),o=P(t,"indices","raggedGather","int32"),s={paramsNestedSplits:a,paramsDenseValues:i,indices:o},u={outputRaggedRank:n},c=j.runKernel(EO,s,u);return{outputNestedSplits:c.slice(0,c.length-1),outputDenseValues:c[c.length-1]}}var cge=H({raggedGather_:uge});function lge(r,e,t){var n=P(r,"starts","raggedRange"),a=P(e,"limits","raggedRange",n.dtype),i=P(t,"deltas","raggedRange",n.dtype),o={starts:n,limits:a,deltas:i},s=j.runKernel(IO,o);return{rtNestedSplits:s[0],rtDenseValues:s[1]}}var fge=H({raggedRange_:lge});function hge(r,e,t,n,a){var i=P(r,"shape","raggedTensorToTensor","int32"),o=P(e,"values","raggedTensorToTensor"),s=P(t,"defaultValue","raggedTensorToTensor",o.dtype),u=n.map(function(f,h){return P(f,"tensors".concat(h),"raggedTensorToTensor","int32")}),c={shape:i,values:o,defaultValue:s,rowPartitionTensors:u},l={rowPartitionTypes:a};return j.runKernel(CO,c,l)}var pge=H({raggedTensorToTensor_:hge});function dge(r,e,t){oa(r);var n=Vt(r),a=null;if(t==null||t==="float32")a=new Float32Array(n);else if(t==="int32")a=new Int32Array(n);else if(t==="bool")a=new Uint8Array(n);else throw new Error("Unknown data type ".concat(t));for(var i=0;i<n;i++)a[i]=e();return j.makeTensor(a,r,t)}var vge=H({rand_:dge}),OM={exports:{}};(function(r){(function(e,t,n){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(pu,r,!1)})(OM);var mge=OM.exports,PM={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(pu,r,!1)})(PM);var gge=PM.exports,MM={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(pu,r,!1)})(MM);var yge=MM.exports,BM={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,p;return h=l[f],h^=h>>>7,p=h^h<<24,h=l[f+1&7],p^=h^h>>>10,h=l[f+3&7],p^=h^h>>>3,h=l[f+4&7],p^=h^h<<7,h=l[f+7&7],h=h^h<<13,p^=h^h<<9,l[f]=p,u.i=f+1&7,p};function c(l,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8?p[7]=-1:p[h],l.x=p,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(pu,r,!1)})(BM);var bge=BM.exports,LM={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,p,d;return u.w=l=l+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(l^l>>>16)|0};function c(l,f){var h,p,d,m,v,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,m=-32;m<y;++m)f&&(p^=f.charCodeAt((m+32)%f.length)),m===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(v=v+1640531527|0,h=g[m&127]^=p+v,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,m=4*128;m>0;--m)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;l.w=v,l.X=g,l.i=d}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(pu,r,!1)})(LM);var wge=LM.exports,qM={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(pu,r,!1)})(qM);var xge=qM.exports,zM={exports:{}};(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),c=n.pow(2,o),l=c*2,f=a-1,h;function p(b,x,S){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(v(x.entropy?[b,w(t)]:b??y(),3),T),C=new d(T),R=function(){for(var _=C.g(i),M=u,$=0;_<c;)_=(_+$)*a,M*=a,$=C.g(1);for(;_>=l;)_/=2,M/=2,$>>>=1;return(_+$)/M};return R.int32=function(){return C.g(4)|0},R.quick=function(){return C.g(4)/4294967296},R.double=R,g(w(C.S),t),(x.pass||S||function(_,M,$,z){return z&&(z.S&&m(z,C),_.state=function(){return m(C,{})}),$?(n[s]=_,M):_})(R,E,"global"in x?x.global:this==n,x.state)}function d(b){var x,S=b.length,T=this,E=0,C=T.i=T.j=0,R=T.S=[];for(S||(b=[S++]);E<a;)R[E]=E++;for(E=0;E<a;E++)R[E]=R[C=f&C+b[E%S]+(x=R[E])],R[C]=x;(T.g=function(_){for(var M,$=0,z=T.i,q=T.j,L=T.S;_--;)M=L[z=f&z+1],$=$*a+L[f&(L[z]=L[q=f&q+M])+(L[q]=M)];return T.i=z,T.j=q,$})(a)}function m(b,x){return x.i=b.i,x.j=b.j,x.S=b.S.slice(),x}function v(b,x){var S=[],T=typeof b,E;if(x&&T=="object")for(E in b)try{S.push(v(b[E],x-1))}catch{}return S.length?S:T=="string"?b:b+"\0"}function g(b,x){for(var S=b+"",T,E=0;E<S.length;)x[f&E]=f&(T^=x[f&E]*19)+S.charCodeAt(E++);return w(x)}function y(){try{var b;return h&&(b=h.randomBytes)?b=b(a):(b=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(b)),w(b)}catch{var x=e.navigator,S=x&&x.plugins;return[+new Date,e,S,e.screen,w(t)]}}function w(b){return String.fromCharCode.apply(0,b)}if(g(n.random(),t),r.exports){r.exports=p;try{h=Yd()}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:pu,[],Math)})(zM);var kge=zM.exports,Sge=mge,Nge=gge,Tge=yge,Ege=bge,Ige=wge,Cge=xge,vu=kge;vu.alea=Sge;vu.xor128=Nge;vu.xorwow=Tge;vu.xorshift7=Ege;vu.xor4096=Ige;vu.tychei=Cge;var cw=vu,Age=.001,$M=.1;function Dge(r,e,t){return t==null&&(t=lw()),qb(r,e,function(n,a){return fw(n,a,t)})}function lw(){return j.backend.floatPrecision()===32?Age:$M}function qb(r,e,t){var n=!0;if((on(r)||on(e))&&(n=!1),on(r)&&on(e)&&(n=!0),n){var a=r.constructor.name,i=e.constructor.name;if(a!==i)throw new Error("Arrays are of different type. Actual: ".concat(a,". ")+"Expected: ".concat(i))}if(Array.isArray(r)&&Array.isArray(e)){var o=Ki(r),s=Ki(e);if(!ko(o,s))throw new Error("Arrays have different shapes. "+"Actual: [".concat(o,"]. Expected: [").concat(s,"]"))}var u=on(r)?r:us(r),c=on(e)?e:us(e);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: ".concat(u.length," vs ")+"expected: ".concat(c.length,`.
`)+"Actual:   ".concat(u,`.
`)+"Expected: ".concat(c,"."));for(var l=0;l<c.length;++l){var f=u[l],h=c[l];if(!t(f,h))throw new Error("Arrays differ: actual[".concat(l,"] = ").concat(f,", expected[").concat(l,"] = ").concat(h,`.
`)+"Actual:   ".concat(u,`.
`)+"Expected: ".concat(c,"."))}typeof expect<"u"&&expect().nothing()}function _ge(r,e){r().then(function(){return e.fail()},function(){return e()}),typeof expect<"u"&&expect().nothing()}function Fge(r,e){var t=typeof e=="string"||typeof e=="number"||typeof e=="boolean"?[e]:e;return ns(r)||ns(r[0])||ns(e)||ns(e[0])?qb(r,t,function(n,a){return n==a}):qb(r,e,function(n,a){return fw(n,a,0)})}function Rge(r,e,t){if(t==null&&(t=lw()),!fw(r,e,t))throw new Error("Numbers differ: actual === ".concat(r,", expected === ").concat(e));typeof expect<"u"&&expect().nothing()}function fw(r,e,t){return!isFinite(r)&&!isFinite(e)?!0:!(isNaN(r)||isNaN(e)||Math.abs(r-e)>t)}function Oge(r,e,t){for(var n=0;n<r.length;n++)if(r[n]<e||r[n]>t)throw new Error("Value out of range:".concat(r[n]," low: ").concat(e,", high: ").concat(t))}function Pge(r,e){var t=new Float32Array(r),n=new Float32Array(e);if(t.length!==n.length)throw new Error("Expected ArrayBuffer to be of length "+"".concat(n.length,", but it was ").concat(t.length));for(var a=0;a<n.length;a++)if(t[a]!==n[a])throw new Error("Expected ArrayBuffer value at ".concat(a," to be ")+"".concat(n[a]," but got ").concat(t[a]," instead"))}function WM(r){for(var e=0;e<r.length;e++){var t=r[e];Array.isArray(t)?WM(t):r[e]=ah(t)}return r}function Mge(r){var e=document.createElement("video");return"playsInline"in e&&(e.playsInline=!0),e.muted=!0,e.loop=!0,e.style.position="fixed",e.style.left="0px",e.style.top="0px",e.preload="auto",e.appendChild(r),new Promise(function(t){e.addEventListener("loadeddata",function(n){return t(e)}),e.load()})}function Bge(r){return Ue(this,void 0,void 0,function(){return Ve(this,function(e){switch(e.label){case 0:return[4,r.play()];case 1:return e.sent(),"requestVideoFrameCallback"in r?[4,new Promise(function(t){r.requestVideoFrameCallback(t)})]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})}var Lge={__proto__:null,TEST_EPSILON_FLOAT16:$M,createVideoElement:Mge,encodeStrings:WM,expectArrayBuffersEqual:Pge,expectArraysClose:Dge,expectArraysEqual:Fge,expectNumbersClose:Rge,expectPromiseToFail:_ge,expectValuesInRange:Oge,play:Bge,testEpsilon:lw};var hw=function(){function r(e,t,n,a,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);var o=i||Math.random();this.random=cw.alea(o.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,a=!1;!a;){var i=void 0,o=void 0,s=void 0;do i=2*this.random()-1,o=2*this.random()-1,s=i*i+o*o;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*i*u,n=this.mean+this.stdDev*o*u,(!this.truncated||this.isValidTruncated(t))&&(a=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)},r.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},r.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},r}(),qge=function(){function r(e,t,n,a){this.alpha=e,this.beta=1/t,this.dtype=n;var i=a||Math.random();this.randu=cw.alea(i.toString()),this.randn=new hw(0,1,n,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var e,t,n,a,i,o;;){do a=this.randn.nextValue(),o=1+this.c*a;while(o<=0);if(o*=o*o,e=a*a,t=1-.331*e*e,n=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<t||Math.log(i)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},r.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},r}(),zge=function(){function r(e,t,n,a){e===void 0&&(e=0),t===void 0&&(t=1);var i=this;if(this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=n,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(e," - ").concat(t," <= 1 and dtype is not float"));this.random=cw.alea(a)}return r.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r}();function $ge(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n="float32"),oa(r),t==null&&(t=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error("Unsupported data type ".concat(n));for(var i=new qge(e,t,n,a),o=bo(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var Wge=H({randomGamma_:$ge});function Uge(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),oa(r),n!=null&&n==="bool")throw new Error("Unsupported data type ".concat(n));for(var i=new hw(e,t,n,!1,a),o=bo(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var UM=H({randomNormal_:Uge});function Vge(r,e,t){if(e!=null&&e==="bool")throw new Error("Unsupported data type ".concat(e));return UM(r,0,1,e,t)}var Gge=H({randomStandardNormal_:Vge});function Hge(r,e,t,n,a){e===void 0&&(e=0),t===void 0&&(t=1),n===void 0&&(n="float32"),oa(r);for(var i=bo(r,n),o=new zge(e,t,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}var pw=H({randomUniform_:Hge});function jge(r,e,t,n){return pw(r,e,t,"int32",n)}var Kge=H({randomUniformInt_:jge});function Jf(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t===0)throw new Error("Cannot have a step of zero");var a={start:r,stop:e,step:t,dtype:n};return j.runKernel(AO,{},a)}function Xge(r){var e=P(r,"input","real"),t={input:e};return j.runKernel(DO,t)}var Zf=H({real_:Xge});function Yge(r){var e=P(r,"x","reciprocal"),t={x:e};return j.runKernel(_O,t)}var Jge=H({reciprocal_:Yge});function Zge(r){var e=P(r,"x","relu"),t={x:e};return j.runKernel(FO,t)}var Ev=H({relu_:Zge});function Qge(r){var e=P(r,"x","relu6"),t={x:e};return j.runKernel(MO,t)}var VM=H({relu6_:Qge});function eye(r,e){var t=P(r,"x","reverse"),n={x:t},a={dims:e};return j.runKernel(BO,n,a)}var fu=H({reverse_:eye});function tye(r){var e=P(r,"x","reverse");return W(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(e.rank,".")}),fu(e,0)}var rye=H({reverse1d_:tye});function nye(r,e){var t=P(r,"x","reverse");return W(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(t.rank,".")}),fu(t,e)}var aye=H({reverse2d_:nye});function iye(r,e){var t=P(r,"x","reverse");return W(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(t.rank,".")}),fu(t,e)}var oye=H({reverse3d_:iye});function sye(r,e){var t=P(r,"x","reverse");return W(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(t.rank,".")}),fu(t,e)}var uye=H({reverse4d_:sye});function cye(r){var e=P(r,"x","round"),t={x:e};return j.runKernel(LO,t)}var GM=H({round_:cye});function lye(r){var e=P(r,"x","rsqrt","float32"),t={x:e};return j.runKernel(qO,t)}var fye=H({rsqrt_:lye});function hye(r){var e=P(r,"x","selu"),t={x:e};return j.runKernel(VO,t)}var pye=H({selu_:hye});function dye(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC");var s=P(r,"x","separableConv2d"),u=P(e,"depthwiseFilter","separableConv2d"),c=P(t,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(s.rank===3&&(f=!0,l=me(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");W(l.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(l.rank,".")}),W(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),W(c.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),W(c.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(c.shape[0],".")}),W(c.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(c.shape[1],".")});var h=u.shape[2],p=u.shape[3];W(c.shape[2]===h*p,function(){return"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(h*p,", ")+"but got ".concat(c.shape[2],".")});var d=aw(l,u,n,a,o,i),m=1,v=xv(d,c,m,"valid",o);return f?me(v,[v.shape[1],v.shape[2],v.shape[3]]):v}var vye=H({separableConv2d_:dye});function mye(r,e){return Ue(this,void 0,void 0,function(){var t,n,a,i,o,s,l,u,c,l,f;return Ve(this,function(h){switch(h.label){case 0:return t=P(r,"x","setdiff1d"),n=P(e,"y","setdiff1d"),W(t.dtype===n.dtype,function(){return"x and y should have the same dtype, but got x (".concat(t.dtype,") and y (").concat(n.dtype,").")}),W(t.rank===1,function(){return"x should be 1D tensor, but got x (".concat(t.shape,").")}),W(n.rank===1,function(){return"y should be 1D tensor, but got y (".concat(n.shape,").")}),[4,t.data()];case 1:return a=h.sent(),[4,n.data()];case 2:for(i=h.sent(),o=new Set(i),s=0,l=0;l<a.length;l++)o.has(a[l])||s++;for(u=new cv([s],t.dtype),c=new cv([s],"int32"),l=0,f=0;l<a.length;l++)o.has(a[l])||(u.values[f]=a[l],c.values[f]=l,f++);return[2,[u.toTensor(),c.toTensor()]]}})})}var gye=mye;function yye(r){var e=P(r,"x","sign"),t={x:e};return j.runKernel(KO,t)}var bye=H({sign_:yye});function wye(r){var e=P(r,"x","sin","float32"),t={x:e};return j.runKernel(HO,t)}var xye=H({sin_:wye});function kye(r){var e=P(r,"x","sinh"),t={x:e};return j.runKernel(jO,t)}var Sye=H({sinh_:kye});function Nye(r,e,t){var n=P(r,"x","slice1d");return W(n.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(n.rank," tensor")}),mr(n,[e],[t])}var Tye=H({slice1d_:Nye});function Eye(r,e,t){var n=P(r,"x","slice2d");return W(n.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(n.rank," tensor")}),mr(n,e,t)}var Iye=H({slice2d_:Eye});function Cye(r,e,t){var n=P(r,"x","slice3d");return W(n.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(n.rank," tensor")}),mr(n,e,t)}var Aye=H({slice3d_:Cye});function Dye(r,e,t){var n=P(r,"x","slice4d");return W(n.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(n.rank," tensor")}),mr(n,e,t)}var _ye=H({slice4d_:Dye});function Fye(r,e){e===void 0&&(e=-1);var t=P(r,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and dim was ").concat(e));var n={logits:t},a={dim:e};return j.runKernel(tP,n,a)}var Rye=H({softmax_:Fye});function Oye(r){W(r.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(r.dtype,".")});var e={input:r};return j.runKernel(_R,e)}var dw=H({fft_:Oye});function Pye(r){W(r.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(r.dtype,".")});var e={input:r};return j.runKernel($R,e)}var pv=H({ifft_:Pye});function Mye(r){var e=r.shape[r.shape.length-1],t=r.size/e,n;if(e<=2){var a=me(r,[t,e]);n=pv(a)}else{var i=[t,2*(e-1)],o=me(Zf(r),[t,e]),s=me(Nv(r),[t,e]),u=fu(mr(o,[0,1],[t,e-2]),1),c=Me(fu(mr(s,[0,1],[t,e-2]),1),Kt(-1)),l=ia([o,u],1),f=ia([s,c],1),a=me(cs(l,f),[i[0],i[1]]);n=pv(a)}if(n=Zf(n),r.rank===3&&r.shape[0]!==0){var h=n,p=r.shape[0];n=me(n,[p,n.shape[0]/p,n.shape[1]]),h.dispose()}return n}var HM=H({irfft_:Mye});function Bye(r,e,t){t===void 0&&(t=0);var n=P(r,"x","split"),a={x:n},i={numOrSizeSplits:e,axis:t};return j.runKernel(eP,a,i)}var Qf=H({split_:Bye});function Lye(r,e){W(r.dtype==="float32",function(){return"The dtype for rfft() must be real value but got ".concat(r.dtype)});var t=r.shape[r.shape.length-1],n=r.size/t,a;if(e!=null&&e<t){var i=r.shape.map(function(g){return 0}),o=r.shape.map(function(g){return g});o[r.shape.length-1]=e,a=mr(r,i,o),t=e}else if(e!=null&&e>t){var s=r.shape.map(function(g){return g});s[r.shape.length-1]=e-t,a=ia([r,zc(s)],r.shape.length-1),t=e}else a=r;var u=Da(a),c=me(cs(a,u),[n,t]),l=dw(c),f=Math.floor(t/2)+1,h=Zf(l),p=Nv(l),d=Qf(h,[f,t-f],h.shape.length-1),m=Qf(p,[f,t-f],p.shape.length-1),v=a.shape.slice();return v[a.shape.length-1]=f,me(cs(d[0],m[0]),v)}var vw=H({rfft_:Lye});function qye(r,e){var t,n=P(r,"a","squaredDifference"),a=P(e,"b","squaredDifference");t=Se(Ir(n,a),2),n=t[0],a=t[1],jr(n.shape,a.shape);var i={a:n,b:a},o={};return j.runKernel(sP,i,o)}var jM=H({squaredDifference_:qye});function zye(r,e){var t=P(r,"x","squeeze","string_or_numeric");return me(t,TF(t.shape,e).newShape)}var mw=H({squeeze_:zye});function $ye(r,e){e===void 0&&(e=0);var t=Gf(r,"tensors","stack","string_or_numeric");W(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&W(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var n=t,a={axis:e};return j.runKernel(xO,n,a)}var eh=H({stack_:$ye});function Wye(r,e){e===void 0&&(e=0);var t=P(r,"x","step"),n={x:t},a={alpha:e};return j.runKernel(kP,n,a)}var KM=H({step_:Wye});function Uye(r,e,t,n,a,i,o,s,u){a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),u===void 0&&(u=0);var c=P(r,"x","stridedSlice","string_or_numeric"),l={x:c},f={begin:e,end:t,strides:n,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return j.runKernel(cP,l,f)}var Vye=H({stridedSlice_:Uye});function Gye(r){var e=P(r,"x","tan","float32"),t={x:e};return j.runKernel(dP,t)}var Hye=H({tan_:Gye});function Ya(r,e){hu(r);var t=Ki(r,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");var n=null;return hs(r,n,t,e)}function qf(r,e,t){if(hu(r),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var n=Ki(r,t);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return hs(r,e,n,t)}function XM(r,e,t){if(hu(r),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var n=Ki(r,t);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return hs(r,e,n,t)}function jye(r,e,t){if(hu(r),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var n=Ki(r,t);if(n.length!==4&&n.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return hs(r,e,n,t)}function Kye(r,e,t){if(hu(r),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var n=Ki(r,t);if(n.length!==5&&n.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return hs(r,e,n,t)}function Xye(r,e,t){if(hu(r),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var n=Ki(r,t);if(n.length!==6&&n.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||n,hs(r,e,n,t)}function gw(r,e,t){var n=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(t.shape)+", indices.shape: ".concat(e.shape,", shape: ").concat(r)+", sliceDim: ".concat(n,", and batchDim: ").concat(a,".");if(t.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(r.length<n+(t.rank-a))throw new Error(i+" Output shape length < ".concat(n+(t.rank-a)));if(t.rank!==a+r.length-n)throw new Error(i+" update.rank != ".concat(a+r.length-n));for(var o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(t.shape[o],") != indices.shape[").concat(o,"] (").concat(e.shape[o],")."));for(var o=0;o<t.rank-a;++o)if(t.shape[o+a]!==r[o+n])throw new Error(i+" updates.shape[".concat(o+a,"] (").concat(t.shape[o+a],") != shape[").concat(o+a,"] (").concat(r[o+a],")"))}function Iv(r,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(r.rank,"."));if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(e.dtype));if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(t));if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: ".concat(e.shape));if(r.size===0)throw new Error("Updates specified for empty output. updates shape: ".concat(r.shape))}gw(t,e,r)}function YM(r,e,t){for(var n=e.shape.length,a=n>1?e.shape[n-1]:1,i=t.length,o=1,s=a;s<i;++s)o*=t[s];var u=a<1?1:a,c=Vt(e.shape)/u,l=Et(Et([],Se($c(t.slice(0,a))),!1),[1],!1),f=Vt(t);return{sliceRank:a,numUpdates:c,sliceSize:o,strides:l,outputSize:f}}var Yye={__proto__:null,calculateShapes:YM,validateInput:Iv,validateUpdateShape:gw};function Jye(r,e,t){var n=P(r,"tensor","tensorScatterupdate"),a=P(e,"indices","tensorScatterupdate","int32"),i=P(t,"updates","tensorScatterupdate");if(Iv(i,a,n.shape),n.dtype!==i.dtype)throw new Error("tensor and updates must have the same dtype, instead they are ".concat(n.dtype," and ").concat(i.dtype,"."));var o={tensor:n,indices:a,updates:i},s={};return j.runKernel($O,o,s)}var Zye=H({tensorScatterUpdate_:Jye});function Qye(r,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var n=P(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=n.shape[n.shape.length-1];if(e<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(e));if(e>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") ")+"but got ".concat(e));var i={x:n},o={k:e,sorted:t},s=Se(j.runKernel(mP,i,o),2),u=s[0],c=s[1];return{values:u,indices:c}}var e0e=H({topk_:Qye});function t0e(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),oa(r),n!=null&&n==="bool")throw new Error("Unsupported data type $ { dtype }");for(var i=new hw(e,t,n,!0,a),o=bo(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var r0e=H({truncatedNormal_:t0e});function n0e(r,e){e===void 0&&(e=0);var t=P(r,"x","unique","string_or_numeric");W(t.rank>0,function(){return"The input tensor must be at least 1D"});var n={x:t},a={axis:e},i=Se(j.runKernel(yP,n,a),2),o=i[0],s=i[1];return{values:o,indices:s}}var a0e=H({unique_:n0e});function i0e(r,e,t){var n=P(r,"x","unsortedSegmentSum"),a=P(e,"segmentIds","unsortedSegmentSum","int32");W(Bc(t),function(){return"numSegments must be of dtype int"});var i={x:n,segmentIds:a},o={numSegments:t};return j.runKernel(wP,i,o)}var o0e=H({unsortedSegmentSum_:i0e});function s0e(r,e){e===void 0&&(e=0);var t=P(r,"x","unstack","string_or_numeric");W(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = ".concat(e," is not in [-").concat(t.shape.length,", ").concat(t.shape.length,")")});var n={value:t},a={axis:e};return j.runKernel(bP,n,a)}var yw=H({unstack_:s0e});function u0e(r,e){return uw(r,e,"right")}function c0e(r,e,t,n){return e===void 0&&(e=!0),j.makeVariable(r,e,t,n)}function JM(r,e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(n);for(var a=bo(r,"int32"),i=bo([t.length,r.length],"int32"),n=0;n<t.length;n++){var o=a.indexToLoc(t[n]),s=n*r.length;i.values.set(o,s)}return i.toTensor()}function l0e(r){return Ue(this,void 0,void 0,function(){var e,t,n;return Ve(this,function(a){switch(a.label){case 0:return e=P(r,"condition","whereAsync","bool"),[4,e.data()];case 1:return t=a.sent(),n=JM(e.shape,t),r!==e&&e.dispose(),[2,n]}})})}var ZM=l0e;function f0e(r,e,t){return Ue(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p,d,m;return Ve(this,function(v){switch(v.label){case 0:for(n=P(r,"tensor","boolMask"),a=P(e,"mask","boolMask","bool"),i=t??0,o=a.rank,s=n.shape,W(o>0,function(){return"mask cannot be scalar"}),Fn(s.slice(i,i+o),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+o;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+o)),f=me(n,l),h=me(a,[-1]),[4,ZM(h)];case 1:return p=v.sent(),d=mw(p,[1]),m=wM(f,d,i),r!==n&&n.dispose(),e!==a&&a.dispose(),d.dispose(),f.dispose(),h.dispose(),p.dispose(),[2,m]}})})}var h0e=f0e;function p0e(r,e,t){var n=P(r,"x","transpose");if(e==null&&(e=n.shape.map(function(o,s){return s}).reverse()),W(n.rank===e.length,function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of perm ".concat(e,".")}),e.forEach(function(o){W(o>=0&&o<n.rank,function(){return"All entries in 'perm' must be between 0 and ".concat(n.rank-1)+" but got ".concat(e)})}),n.rank<=1)return n.clone();var a={x:n},i={perm:e};return n.dtype==="complex64"?Hr(function(){var o=Zf(n),s=Nv(n);return o=j.runKernel(Qd,{x:o},i),s=j.runKernel(Qd,{x:s},i),t&&(s=ji(s)),cs(o,s)}):j.runKernel(Qd,a,i)}var dv=H({transpose_:p0e});function d0e(r,e,t,n,a){a===void 0&&(a=!0);var i=P(r,"v","movingAverage"),o=P(e,"x","movingAverage"),s=P(t,"decay","movingAverage");LP(i,o),W(ko(i.shape,o.shape),function(){return"Shape mismatch in v and x"});var u=Kt(1),c=Tt(u,s),l=Me(Tt(o,i),c);if(a){W(n!=null,function(){return"When using zeroDebias: true, step is required."});var f=P(n,"step","movingAverage");l=er(l,Tt(u,Xf(s,f)))}return ht(i,l)}var v0e=H({movingAverage_:d0e});function m0e(r,e,t){oa(t);var n=P(r,"indices","scatterND","int32"),a=P(e,"updates","scatterND");Iv(a,n,t);var i={indices:n,updates:a},o={shape:t};return j.runKernel(zO,i,o)}var g0e=H({scatterND_:m0e});function y0e(r,e,t,n){if(r.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+" but the dtype was ".concat(r.dtype,"."));if(r.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+" but got shape ".concat(r.shape,"."));var a=r.rank>0?r.shape[0]:1,i=r.rank>1?r.shape[1]:1;if(t.length!==i)throw new Error("outputShape has incorrect number of elements:,"+" ".concat(t.length,", should be: ").concat(i,"."));var o=e.size;if(!(e.rank===0||e.rank===1&&o===a))throw new Error("sparseValues has incorrect shape "+"".concat(e.shape,", should be [] or [").concat(a,"]"));if(e.dtype!==n.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function b0e(r,e,t,n){n===void 0&&(n=0),oa(t);var a=P(r,"sparseIndices","sparseToDense","int32"),i=P(e,"sparseValues","sparseToDense","string_or_numeric"),o=P(n,"defaultValue","sparseToDense",i.dtype);y0e(a,i,t,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:t};return j.runKernel(oP,s,u)}var w0e=H({sparseToDense_:b0e});function x0e(r,e){var t=P(e,"indices","gatherND","int32"),n=P(r,"x","gatherND","string_or_numeric"),a={params:n,indices:t};return j.runKernel(LR,a)}var k0e=H({gatherND_:x0e});function S0e(r,e){if(e==null)return r.shape.slice();if(ko(r.shape,e))return e;if(r.shape.length===e.length){for(var t=[],n=0;n<r.shape.length;n++)e[n]==null&&r.shape[n]!=null?t.push(r.shape[n]):t.push(e[n]);return t}return e}function N0e(r,e,t,n){var a=P(r,"x","dropout");if(W(a.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(a.dtype," tensor instead.")}),W(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got ".concat(e,".")}),e===0)return r instanceof Gr?a.clone():a;var i=S0e(a,t),o=1-e,s=er(bM(ht(pw(i,0,1,"float32",n),o)),o);return Me(a,s)}var T0e=H({dropout_:N0e});function QM(r){return Math.floor(Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))))}function bw(r,e,t){for(var n=1-r%2,a=new Float32Array(r),i=0;i<r;++i){var o=2*Math.PI*i/(r+n-1);a[i]=e-t*Math.cos(o)}return Ya(a,"float32")}function E0e(r,e,t){return t===void 0&&(t=1),Ue(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p,d,m,v,v;return Ve(this,function(g){switch(g.label){case 0:return n=P(r,"predictions","inTopK"),a=P(e,"targets","inTopK"),W(n.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, "+"but got ".concat(n.rank)}),W(n.rank-1===a.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+"".concat(n.rank," and targets rank ").concat(a.rank)}),Fn(n.shape.slice(0,n.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=n.shape[n.shape.length-1],W(t>0&&t<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last "+"dimension (".concat(i,"), but got ").concat(t)}),[4,n.data()];case 1:return o=g.sent(),[4,a.data()];case 2:for(s=g.sent(),u=Se([o.length/i,i],2),c=u[0],l=u[1],f=EF("bool",c),h=0;h<c;h++){for(p=h*l,d=o.subarray(p,p+l),m=[],v=0;v<d.length;v++)m.push({value:d[v],index:v});for(m.sort(function(y,w){return w.value-y.value}),f[h]=0,v=0;v<t;v++)if(m[v].index===s[h]){f[h]=1;break}}return r!==n&&n.dispose(),e!==a&&a.dispose(),[2,Fc(f,a.shape,"bool")]}})})}var I0e=E0e;function C0e(r,e,t,n,a,i,o){i===void 0&&(i="NHWC");var s=r;r.rank===3&&(s=me(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=me(e,[1,e.shape[0],e.shape[1],e.shape[2]])),W(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")}),W(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")}),W(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(t,".")});var c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];W(c===t[2],function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(t[2],".")}),W(l===t[3],function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(t[3],").")}),Ja("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return j.runKernel(sR,f,h)}var A0e=H({conv2DBackpropFilter_:C0e});function Cv(r,e,t){if(t==null||t==="linear")return r;if(t==="relu")return Me(r,KM(e));throw new Error("Cannot compute gradient for fused activation ".concat(t,"."))}function Av(r,e){var t=e,n=iw(r.shape,e.shape);return n.length>0&&(t=Qt(t,n)),me(t,r.shape)}function Dv(r,e,t,n){if(e==="linear")return r;if(e==="relu")return Ev(r);if(e==="elu")return vM(r);if(e==="relu6")return VM(r);if(e==="prelu")return RM(r,t);if(e==="leakyrelu")return kM(r,n);if(e==="sigmoid")return Pc(r);throw new Error("Unknown fused activation ".concat(e,"."))}var _v=function(r,e){var t=r>0;return!t||e==="linear"};function D0e(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,c=u===void 0?[1,1]:u,l=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,m=r.leakyreluAlpha;if(p=p||"linear",_v(j.state.gradientDepth,p)===!1){W(s==="NHWC",function(){return"Error in fused conv2d: got dataFormat of ".concat(s," but ")+"only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."});var v=xv(t,n,a,i,s,c,l);return f!=null&&(v=ht(v,f)),Dv(v,p,d,m)}var g=P(t,"x","conv2d","float32"),y=P(n,"filter","conv2d","float32"),w=g,b=!1;g.rank===3&&(b=!0,w=me(g,[1,g.shape[0],g.shape[1],g.shape[2]])),W(w.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(w.rank,".")}),W(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(y.rank,".")}),Ja("fused conv2d",i,l);var x=s==="NHWC"?w.shape[3]:w.shape[1];W(y.shape[2]===x,function(){return"Error in conv2d: depth of input (".concat(x,") must match ")+"input depth for filter ".concat(y.shape[2],".")}),W(No(a,c),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(a," and dilations '").concat(c,"'")});var S=oh(w.shape,y.shape,a,c,i,l),T;f!=null&&(T=P(f,"bias","fused conv2d"),e=Se(Ir(T,g),1),T=e[0],s==="NHWC"?jr(S.outShape,T.shape):(W(T.shape.length<=1,function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+"rank-".concat(T.shape.length,".")}),W(T.shape.length===0||T.shape[0]===S.outChannels||T.shape[0]===1,function(){return"Error in fused conv2d: bias shape (".concat(T.shape,") is not ")+"compatible with the number of output channels "+"(".concat(S.outChannels,")")})));var E;if(d!=null){var C=d.shape;if(W(C.length<=1||C.length===3,function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+"rank-".concat(C.length,".")}),C.length===1)W(C[0]===1||C[0]===S.outChannels,function(){return"Error in fused conv2d: PReLU activation weights "+"(".concat(C,") is not compatible with the number of output ")+"channels (".concat(S.outChannels,").")});else if(C.length===3)try{jr(C,S.outShape)}catch{var R="Error in fused conv2d: PReLU activation weights (".concat(C,") ")+"is not compatible with the output shape of the conv2d "+"(".concat(S.outShape,").");throw Error(R)}E=P(d,"prelu weights","fused conv2d")}var _=function(L,U){W(s==="NHWC",function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(s," but only NHWC is currently supported.")});var Y=Se(U,4),Z=Y[0],V=Y[1],X=Y[2],ne=Y[3],re=Cv(L,X,p);W(Kf(c),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(c,"'")});var se=hM(V.shape,re,Z,a,i),le=A0e(V,re,Z.shape,a,i),de=[se,le];if(ne!=null){var ke=Av(ne,re);de.push(ke)}return de},M={x:w,filter:y,bias:T,preluActivationWeights:E},$={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:p,leakyreluAlpha:m};if(f==null){var z=Xi(function(L,U,Y){var Z=j.runKernel(wb,M,$);return Y([U,L,Z]),b&&(Z=me(Z,[Z.shape[1],Z.shape[2],Z.shape[3]])),{value:Z,gradFunc:_}});return z(w,y)}else{var q=Xi(function(L,U,Y,Z){var V=j.runKernel(wb,M,$);return Z([U,L,V,Y]),b&&(V=me(V,[V.shape[1],V.shape[2],V.shape[3]])),{value:V,gradFunc:_}});return q(w,y,T)}}var _0e=H({fusedConv2d_:D0e});function F0e(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=r;r.rank===3&&(s=me(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=me(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={x:s,dy:u},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return j.runKernel(bR,c,l)}var R0e=H({depthwiseConv2dNativeBackpropFilter_:F0e});function O0e(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=me(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={dy:s,filter:t},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,inputShape:r},f=j.runKernel(wR,c,l);return u?me(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var P0e=H({depthwiseConv2dNativeBackpropInput_:O0e});function M0e(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,c=u===void 0?[1,1]:u,l=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,m=r.leakyreluAlpha;if(_v(j.state.gradientDepth,p)===!1){var v=aw(t,n,a,i,s,c,l);return f!=null&&(v=ht(v,f)),Dv(v,p,d,m)}var g=P(t,"x","depthwiseConv2d","float32"),y=P(n,"filter","depthwiseConv2d","float32"),w=g,b=!1;g.rank===3&&(b=!0,w=me(g,[1,g.shape[0],g.shape[1],g.shape[2]])),W(w.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(w.rank,".")}),W(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+"but got rank ".concat(y.rank,".")}),W(w.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels "+"(".concat(w.shape[3],") must match the inChannels dimension in ")+"filter ".concat(y.shape[2],".")}),c==null&&(c=[1,1]),W(No(a,c),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+"be 1. Got strides ".concat(a," and dilations '").concat(c,"'")}),Ja("fused depthwiseConv2d",i,l);var x=oh(w.shape,y.shape,a,c,i,l,!0),S;f!=null&&(S=P(f,"bias","fused conv2d"),e=Se(Ir(S,g),1),S=e[0],jr(x.outShape,S.shape));var T;d!=null&&(T=P(d,"prelu weights","fused depthwiseConv2d"));var E=function($,z){W(Kf(c),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(c,"'")});var q=Se(z,4),L=q[0],U=q[1],Y=q[2],Z=q[3],V=Cv($,Y,p),X=P0e(U.shape,V,L,a,i,c,l),ne=R0e(U,V,L.shape,a,i,c,l);if(Z!=null){var re=Av(S,V);return[X,ne,re]}return[X,ne]},C={x:w,filter:y,bias:S,preluActivationWeights:T},R={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:p,leakyreluAlpha:m};if(f==null){var _=Xi(function($,z,q){var L=j.runKernel(xb,C,R);return q([z,$,L]),b&&(L=me(L,[L.shape[1],L.shape[2],L.shape[3]])),{value:L,gradFunc:E}});return _(w,y)}else{var M=Xi(function($,z,q,L){var U=j.runKernel(xb,C,R);return L([z,$,U,q]),b&&(U=me(U,[U.shape[1],U.shape[2],U.shape[3]])),{value:U,gradFunc:E}});return M(w,y,S)}}var B0e=H({fusedDepthwiseConv2d_:M0e});function L0e(r){var e,t,n=r.a,a=r.b,i=r.transposeA,o=i===void 0?!1:i,s=r.transposeB,u=s===void 0?!1:s,c=r.bias,l=r.activation,f=l===void 0?"linear":l,h=r.preluActivationWeights,p=r.leakyreluAlpha,d=p===void 0?.2:p;if(_v(j.state.gradientDepth,f)===!1){var m=zt(n,a,o,u);return c!=null&&(m=ht(m,c)),Dv(m,f,h,d)}var v=P(n,"a","fused matMul"),g=P(a,"b","fused matMul");e=Se(Ir(v,g),2),v=e[0],g=e[1];var y=o?v.shape[v.rank-2]:v.shape[v.rank-1],w=u?g.shape[g.rank-1]:g.shape[g.rank-2],b=o?v.shape[v.rank-1]:v.shape[v.rank-2],x=u?g.shape[g.rank-2]:g.shape[g.rank-1],S=v.shape.slice(0,-2),T=g.shape.slice(0,-2),E=Vt(S),C=Vt(T);W(y===w,function(){return"Error in fused matMul: inner shapes (".concat(y,") and (")+"".concat(w,") of Tensors with shapes ").concat(v.shape," and ")+"".concat(g.shape," and transposeA=").concat(o)+" and transposeB=".concat(u," must match.")});var R=jr(v.shape.slice(0,-2),g.shape.slice(0,-2)),_=R.concat([b,x]),M=o?me(v,[E,y,b]):me(v,[E,b,y]),$=u?me(g,[C,x,w]):me(g,[C,w,x]),z;c!=null&&(z=P(c,"bias","fused matMul"),t=Se(Ir(z,v),1),z=t[0],jr(_,z.shape));var q;h!=null&&(q=P(h,"prelu weights","fused matMul"));var L=function(X,ne){var re=Se(ne,4),se=re[0],le=re[1],de=re[2],ke=re[3],he=Cv(me(X,de.shape),de,f),ye,xe;if(!o&&!u?(ye=zt(he,le,!1,!0),xe=zt(se,he,!0,!1)):!o&&u?(ye=zt(he,le,!1,!1),xe=zt(he,se,!0,!1)):o&&!u?(ye=zt(le,he,!1,!0),xe=zt(se,he,!1,!1)):(ye=zt(le,he,!0,!0),xe=zt(he,se,!0,!0)),c!=null){var De=Av(ke,he);return[ye,xe,De]}else return[ye,xe]},U={a:M,b:$,bias:z,preluActivationWeights:q},Y={transposeA:o,transposeB:u,activation:f,leakyreluAlpha:d};if(c==null){var Z=Xi(function(X,ne,re){var se=j.runKernel(bb,U,Y);return re([X,ne,se]),{value:me(se,_),gradFunc:L}});return Z(M,$)}else{var V=Xi(function(X,ne,re,se){var le=j.runKernel(bb,U,Y);return se([X,ne,le,re]),{value:me(le,_),gradFunc:L}});return V(M,$,z)}}var q0e=H({fusedMatMul_:L0e});var z0e={__proto__:null,conv2d:_0e,depthwiseConv2d:B0e,matMul:q0e};function $0e(r){return bw(r,.54,.46)}var W0e=H({hammingWindow_:$0e});function U0e(r){return bw(r,.5,.5)}var e4=H({hannWindow_:U0e});function V0e(r,e,t,n,a){n===void 0&&(n=!1),a===void 0&&(a=0);for(var i=0,o=[];i+e<=r.size;)o.push(mr(r,i,e)),i+=t;if(n)for(;i<r.size;){var s=i+e-r.size,u=ia([mr(r,i,e-s),sh([s],a)]);o.push(u),i+=t}return o.length===0?qf([],[0,e]):me(ia(o),[o.length,e])}var t4=H({frame_:V0e});function G0e(r,e,t,n,a){a===void 0&&(a=e4),n==null&&(n=QM(e));var i=t4(r,e,t),o=Me(i,a(e));return vw(o,n)}var H0e=H({stft_:G0e});function j0e(r,e,t,n,a,i){a===void 0&&(a="bilinear"),i===void 0&&(i=0);var o=P(r,"image","cropAndResize"),s=P(e,"boxes","cropAndResize","float32"),u=P(t,"boxInd","cropAndResize","int32"),c=s.shape[0];W(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),W(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] ")+"but had shape ".concat(s.shape,".")}),W(u.rank===1&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] ")+"but had shape ".concat(s.shape,".")}),W(n.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(n.length,".")}),W(n[0]>=1&&n[1]>=1,function(){return"cropSize must be atleast [1,1], but was ".concat(n)}),W(a==="bilinear"||a==="nearest",function(){return"method must be bilinear or nearest, but was ".concat(a)});var l={image:o,boxes:s,boxInd:u},f={method:a,extrapolationValue:i,cropSize:n},h=j.runKernel(vR,l,f);return h}var K0e=H({cropAndResize_:j0e});function X0e(r){var e=P(r,"image","flipLeftRight","float32");W(e.rank===4,function(){return"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(e.rank,".")});var t={image:e},n=j.runKernel(RR,t,{});return n}var Y0e=H({flipLeftRight_:X0e});function J0e(r){var e=P(r,"image","grayscaleToRGB"),t=e.rank-1,n=e.shape[t];W(e.rank>=2,function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(e.rank,".")}),W(n===1,function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(n,".")});var a=new Array(e.rank);return a.fill(1,0,t),a[t]=3,Lf(e,a)}var Z0e=H({grayscaleToRGB_:J0e});function Q0e(r){var e=P(r,"image","RGBToGrayscale"),t=e.rank-1,n=e.shape[t];W(e.rank>=2,function(){return"Error in RGBToGrayscale: images must be at least rank 2, "+"but got rank ".concat(e.rank,".")}),W(n===3,function(){return"Error in RGBToGrayscale: last dimension of an RGB image "+"should be size 3, but got size ".concat(n,".")});var a=e.dtype,i=nr(e,"float32"),o=Ya([.2989,.587,.114]),s;switch(e.rank){case 2:s=Ac("ij,j->i",i,o);break;case 3:s=Ac("ijk,k->ij",i,o);break;case 4:s=Ac("ijkl,l->ijk",i,o);break;case 5:s=Ac("ijklm,m->ijkl",i,o);break;case 6:s=Ac("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return s=ts(s,-1),nr(s,a)}var ebe=H({rgbToGrayscale_:Q0e});function tbe(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=.5);var a=P(r,"image","rotateWithOffset","float32");W(a.rank===4,function(){return"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,".")});var i={image:a},o={radians:e,fillValue:t,center:n},s=j.runKernel(SP,i,o);return s}var rbe=H({rotateWithOffset_:tbe});function Wc(r,e,t,n,a,i){n==null&&(n=.5),a==null&&(a=Number.NEGATIVE_INFINITY),i==null&&(i=0);var o=r.shape[0];return t=Math.min(t,o),W(0<=n&&n<=1,function(){return"iouThreshold must be in [0, 1], but was '".concat(n,"'")}),W(r.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '".concat(r.rank,"'")}),W(r.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(r.shape[1])}),W(e.rank===1,function(){return"scores must be a 1D tensor"}),W(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(e.shape[0])}),W(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")}),{maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i}}function nbe(r,e,t,n,a){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var i=P(r,"boxes","nonMaxSuppression","float32"),o=P(e,"scores","nonMaxSuppression","float32"),s=Wc(i,o,t,n,a);t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:n,scoreThreshold:a};return j.runKernel(mO,{boxes:i,scores:o},u)}var abe=H({nonMaxSuppression_:nbe});function ibe(r,e,t){var n=obe(r,e,t),a=n<0?-(n+1):n;r.splice(a,0,e)}function obe(r,e,t){return ube(r,e,t||sbe)}function sbe(r,e){return r>e?1:r<e?-1:0}function ube(r,e,t){for(var n=0,a=r.length,i=0,o=!1;n<a;){i=n+(a-n>>>1);var s=t(e,r[i]);s>0?n=i+1:(a=i,o=!s)}return o?n:-n-1}function r4(r,e,t,n,a){return ww(r,e,t,n,a,0)}function n4(r,e,t,n,a,i){return ww(r,e,t,n,a,0,!1,i,!0)}function a4(r,e,t,n,a,i){return ww(r,e,t,n,a,i,!0)}function ww(r,e,t,n,a,i,o,s,u){o===void 0&&(o=!1),s===void 0&&(s=!1),u===void 0&&(u=!1);for(var c=[],l=0;l<e.length;l++)e[l]>a&&c.push({score:e[l],boxIndex:l,suppressBeginIndex:0});c.sort(dF);for(var f=i>0?-.5/i:0,h=[],p=[];h.length<t&&c.length>0;){var d=c.pop(),m=d.score,v=d.boxIndex,g=d.suppressBeginIndex;if(m<a)break;for(var y=!1,w=h.length-1;w>=g;--w){var b=cbe(r,v,h[w]);if(b>=n){y=!0;break}if(d.score=d.score*lbe(n,f,b),d.score<=a)break}d.suppressBeginIndex=h.length,y||(d.score===m?(h.push(v),p.push(d.score)):d.score>a&&ibe(c,d,dF))}var x=h.length,S=t-x;s&&S>0&&(h.push.apply(h,Et([],Se(new Array(S).fill(0)),!1)),p.push.apply(p,Et([],Se(new Array(S).fill(0)),!1)));var T={selectedIndices:h};return o&&(T.selectedScores=p),u&&(T.validOutputs=x),T}function cbe(r,e,t){var n=r.subarray(e*4,e*4+4),a=r.subarray(t*4,t*4+4),i=Math.min(n[0],n[2]),o=Math.min(n[1],n[3]),s=Math.max(n[0],n[2]),u=Math.max(n[1],n[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),f=Math.max(a[0],a[2]),h=Math.max(a[1],a[3]),p=(s-i)*(u-o),d=(f-c)*(h-l);if(p<=0||d<=0)return 0;var m=Math.max(i,c),v=Math.max(o,l),g=Math.min(s,f),y=Math.min(u,h),w=Math.max(g-m,0)*Math.max(y-v,0);return w/(p+d-w)}function lbe(r,e,t){var n=Math.exp(e*t*t);return t<=r?n:0}function dF(r,e){return r.score-e.score||r.score===e.score&&e.boxIndex-r.boxIndex}function fbe(r,e,t,n,a){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),Ue(this,void 0,void 0,function(){var i,o,s,u,c,l,f;return Ve(this,function(h){switch(h.label){case 0:return i=P(r,"boxes","nonMaxSuppressionAsync"),o=P(e,"scores","nonMaxSuppressionAsync"),s=Wc(i,o,t,n,a),t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold,[4,Promise.all([i.data(),o.data()])];case 1:return u=h.sent(),c=u[0],l=u[1],f=r4(c,l,t,n,a).selectedIndices,i!==r&&i.dispose(),o!==e&&o.dispose(),[2,Ya(f,"int32")]}})})}var hbe=fbe;function pbe(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var o=P(r,"boxes","nonMaxSuppression"),s=P(e,"scores","nonMaxSuppression"),u=Wc(o,s,t,n,a,i);t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma;var c={boxes:o,scores:s},l={maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i},f=j.runKernel(yO,c,l);return{selectedIndices:f[0],selectedScores:f[1]}}var dbe=H({nonMaxSuppressionWithScore_:pbe});function vbe(r,e,t,n,a,i){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),Ue(this,void 0,void 0,function(){var o,s,u,c,l,f,h,p,d;return Ve(this,function(m){switch(m.label){case 0:return o=P(r,"boxes","nonMaxSuppressionAsync"),s=P(e,"scores","nonMaxSuppressionAsync"),u=Wc(o,s,t,n,a,i),t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return c=m.sent(),l=c[0],f=c[1],h=a4(l,f,t,n,a,i),p=h.selectedIndices,d=h.selectedScores,o!==r&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:Ya(p,"int32"),selectedScores:Ya(d)}]}})})}var mbe=vbe;function gbe(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1);var o=P(r,"boxes","nonMaxSuppression"),s=P(e,"scores","nonMaxSuppression"),u=Wc(o,s,t,n,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,h={boxes:o,scores:s},p={maxOutputSize:c,iouThreshold:l,scoreThreshold:f,padToMaxOutputSize:i},d=j.runKernel(gO,h,p);return{selectedIndices:d[0],validOutputs:d[1]}}var ybe=H({nonMaxSuppressionPadded_:gbe});function bbe(r,e,t,n,a,i){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1),Ue(this,void 0,void 0,function(){var o,s,u,c,l,f,h,p,d,m,v,g;return Ve(this,function(y){switch(y.label){case 0:return o=P(r,"boxes","nonMaxSuppressionAsync"),s=P(e,"scores","nonMaxSuppressionAsync"),u=Wc(o,s,t,n,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,[4,Promise.all([o.data(),s.data()])];case 1:return h=Se.apply(void 0,[y.sent(),2]),p=h[0],d=h[1],m=n4(p,d,c,l,f,i),v=m.selectedIndices,g=m.validOutputs,o!==r&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:Ya(v,"int32"),validOutputs:Kt(g,"int32")}]}})})}var wbe=bbe;function xbe(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=P(r,"images","resizeBilinear");W(a.rank===3||a.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),W(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(e,".")}),W(n===!1||t===!1,function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=me(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Se(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},c=j.runKernel(PO,s,u);return o?me(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var kbe=H({resizeBilinear_:xbe});function Sbe(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=P(r,"images","resizeNearestNeighbor");W(a.rank===3||a.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),W(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(e,".")}),W(a.dtype==="float32"||a.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"}),W(n===!1||t===!1,function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=me(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Se(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},c=j.runKernel(OO,s,u);return o?me(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var Nbe=H({resizeNearestNeighbor_:Sbe});function Tbe(r,e,t,n){var a;e===void 0&&(e="binary"),t===void 0&&(t=!1),n===void 0&&(n=.5);var i=P(r,"image","threshold"),o=.2989,s=.587,u=.114,c=i.shape[0]*i.shape[1],l=Me(Ya([n]),255),f,h,p,d;if(W(i.rank===3,function(){return"Error in threshold: image must be rank 3,"+"but got rank ".concat(i.rank,".")}),W(i.shape[2]===3||i.shape[2]===1,function(){return"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(i.shape[2],".")}),W(i.dtype==="int32"||i.dtype==="float32",function(){return"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(i.dtype,".")}),W(e==="otsu"||e==="binary",function(){return"Method must be binary or otsu, but was ".concat(e)}),i.shape[2]===3){a=Se(Qf(i,[1,1,1],-1),3),f=a[0],h=a[1],p=a[2];var m=Me(f,o),v=Me(h,s),g=Me(p,u);d=ht(ht(m,v),g)}else d=r;if(e==="otsu"){var y=fM(nr(GM(d),"int32"),Fc([]),256);l=Ebe(y,c)}var w=t?sw(d,l):Sv(d,l),b=nr(Me(w,255),"int32");return b}function Ebe(r,e){for(var t=Ya([-1]),n=Ya([0]),a=Ya([0]),i,o,s,u,c,l,f=0;f<r.size-1;f++){i=mr(r,0,f+1),o=mr(r,f+1),c=er(Qt(i),e),l=er(Qt(o),e);var h=Qt(Me(i,Jf(0,i.size)));s=er(h,Qt(i));var p=sh(o.shape,i.size),d=ht(Jf(0,o.size),p),m=Me(o,d);u=er(Qt(m),Qt(o));var v=Tt(s,u),g=Tt(s,u),y=Me(c,l);a=Me(Me(y,v),g);var w=Sv(a,n);n=os(w,a,n),t=os(w,Ya([f]),t)}return t}var Ibe=H({threshold_:Tbe});function Cbe(r,e,t,n,a,i){t===void 0&&(t="nearest"),n===void 0&&(n="constant"),a===void 0&&(a=0);var o=P(r,"image","transform","float32"),s=P(e,"transforms","transform","float32");W(o.rank===4,function(){return"Error in transform: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),W(s.rank===2&&(s.shape[0]===o.shape[0]||s.shape[0]===1)&&s.shape[1]===8,function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"}),W(i==null||i.length===2,function(){return"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(i,".")});var u={image:o,transforms:s},c={interpolation:t,fillMode:n,fillValue:a,outputShape:i};return j.runKernel(gP,u,c)}var Abe=H({transform_:Cbe});function Dbe(r,e,t){var n=P(r,"a","bandPart");W(n.rank>=2,function(){return"bandPart(): Rank must be at least 2, got ".concat(n.rank,".")});var a=n.shape,i=Se(n.shape.slice(-2),2),o=i[0],s=i[1],u,c;typeof e=="number"?(W(e%1===0,function(){return"bandPart(): numLower must be an integer, got ".concat(e,".")}),W(e<=o,function(){return"bandPart(): numLower (".concat(e,")")+" must not be greater than the number of rows (".concat(o,").")}),u=P(e<0?o:e,"numLower","bandPart")):(W(e.dtype==="int32",function(){return"bandPart(): numLower's dtype must be an int32."}),u=os(Bb(e,0),o,hv(e,o))),typeof t=="number"?(W(t%1===0,function(){return"bandPart(): numUpper must be an integer, got ".concat(t,".")}),W(t<=s,function(){return"bandPart(): numUpper (".concat(t,")")+" must not be greater than the number of columns (".concat(s,").")}),c=P(t<0?s:t,"numUpper","bandPart")):(W(t.dtype==="int32",function(){return"bandPart(): numUpper's dtype must be an int32."}),c=os(Bb(t,0),s,hv(t,s)));var l=me(Jf(0,o,1,"int32"),[-1,1]),f=Jf(0,s,1,"int32"),h=Tt(l,f),p=lv(sw(h,u),xM(h,ji(c))),d=zc([o,s],n.dtype);return me(eh(yw(me(n,[-1,o,s])).map(function(m){return os(p,m,d)})),a)}var _be=H({bandPart_:Dbe});function Fbe(r){var e;if(Array.isArray(r)){e=!1,W(r!=null&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=r[0].shape[0],n=function(u){W(r[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(r[u].shape[0]," vs. ").concat(t,")")})},a=1;a<r.length;++a)n(a)}else e=!0,r=Qf(r,r.shape[0],0).map(function(u){return mw(u,[0])});W(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors (".concat(r.length,") exceeds ")+"number of dimensions (".concat(r[0].shape[0],").")});for(var i=[],o=r,s=function(u){i.push(j.tidy(function(){var c=o[u];if(u>0)for(var l=0;l<u;++l){var f=Me(Qt(Me(i[l],c)),i[l]);c=Tt(c,f)}return er(c,kv(c,"euclidean"))}))},a=0;a<r.length;++a)s(a);return e?eh(i,0):i}var Rbe=H({gramSchmidt_:Fbe});function Obe(r,e){if(e===void 0&&(e=!1),W(r.rank>=2,function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(r.rank)}),r.rank===2)return vF(r,e);var t=r.shape.slice(0,r.shape.length-2).reduce(function(u,c){return u*c}),n=yw(me(r,[t,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),a=[],i=[];n.forEach(function(u){var c=Se(vF(u,e),2),l=c[0],f=c[1];a.push(l),i.push(f)});var o=me(eh(a,0),r.shape),s=me(eh(i,0),r.shape);return[o,s]}function vF(r,e){return e===void 0&&(e=!1),j.tidy(function(){W(r.shape.length===2,function(){return"qr2d() requires a 2D Tensor, but got a ".concat(r.shape.length,"D Tensor.")});for(var t=r.shape[0],n=r.shape[1],a=yM(t),i=iu(r),o=qf([[1]],[1,1]),s=iu(o),u=t>=n?n:t,c=function(f){var h,p=i,d=s,m=a;h=Se(j.tidy(function(){var v=mr(i,[f,f],[t-f,1]),g=kv(v),y=mr(i,[f,f],[1,1]),w=os(Sv(y,0),qf([[-1]]),qf([[1]])),b=Tt(y,Me(w,g)),x=er(v,b);x.shape[0]===1?s=iu(o):s=ia([o,mr(x,[1,0],[x.shape[0]-1,x.shape[1]])],0);var S=ji(er(zt(w,b),g)),T=mr(i,[f,0],[t-f,n]),E=Me(S,s),C=dv(s);if(f===0)i=Tt(T,zt(E,zt(C,T)));else{var R=Tt(T,zt(E,zt(C,T)));i=ia([mr(i,[0,0],[f,n]),R],0)}var _=dv(E),M=mr(a,[0,f],[t,a.shape[1]-f]);if(f===0)a=Tt(M,zt(zt(M,s),_));else{var $=Tt(M,zt(zt(M,s),_));a=ia([mr(a,[0,0],[t,f]),$],1)}return[s,i,a]}),3),s=h[0],i=h[1],a=h[2],$n([p,d,m])},l=0;l<u;++l)c(l);return!e&&t>n&&(a=mr(a,[0,0],[t,n]),i=mr(i,[0,0],[n,n])),[a,i]})}var Pbe=H({qr_:Obe});D.Reduction=void 0;(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(D.Reduction||(D.Reduction={}));function Mbe(r,e,t){t===void 0&&(t=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var n=P(r,"losses","computeWeightedLoss"),a=null;e!=null&&(a=P(e,"weights","computeWeightedLoss"));var i=a==null?n:Me(n,a);if(t===D.Reduction.NONE)return i;if(t===D.Reduction.SUM)return Qt(i);if(t===D.Reduction.MEAN){if(a==null)return fv(i);var o=n.size/a.size,s=er(Qt(i),Qt(a));return o>1?er(s,Kt(o)):s}if(t===D.Reduction.SUM_BY_NONZERO_WEIGHTS){if(a==null)return er(Qt(i),Kt(n.size));var u=Me(a,au(n.shape)),c=nr(Qt(_M(u,Kt(0))),"float32");return er(Qt(i),c)}throw Error("Unknown reduction: ".concat(t))}var To=H({computeWeightedLoss_:Mbe});function Bbe(r,e,t,n){n===void 0&&(n=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=P(r,"labels","absoluteDifference"),i=P(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=P(t,"weights","absoluteDifference")),Fn(a.shape,i.shape,"Error in absoluteDifference: ");var s=Aa(Tt(a,i));return To(s,o,n)}var Lbe=H({absoluteDifference_:Bbe});function qbe(r,e,t,n,a){a===void 0&&(a=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=P(r,"labels","cosineDistance"),o=P(e,"predictions","cosineDistance"),s=null;n!=null&&(s=P(n,"weights","cosineDistance")),Fn(i.shape,o.shape,"Error in cosineDistance: ");var u=Kt(1),c=Tt(u,Qt(Me(i,o),t,!0));return To(c,s,a)}var zbe=H({cosineDistance_:qbe});function $be(r,e,t,n){n===void 0&&(n=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=P(r,"labels","hingeLoss"),i=P(e,"predictions","hingeLoss"),o=null;t!=null&&(o=P(t,"weights","hingeLoss")),Fn(a.shape,i.shape,"Error in hingeLoss: ");var s=Kt(1);a=Tt(Me(Kt(2),a),s);var u=Ev(Tt(s,Me(a,i)));return To(u,o,n)}var Wbe=H({hingeLoss_:$be});function Ube(r,e,t,n,a){n===void 0&&(n=1),a===void 0&&(a=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=P(r,"labels","huberLoss"),o=P(e,"predictions","huberLoss"),s=null;t!=null&&(s=P(t,"weights","huberLoss")),Fn(i.shape,o.shape,"Error in huberLoss: ");var u=Kt(n),c=Aa(Tt(o,i)),l=hv(c,u),f=Tt(c,l),h=ht(Me(Kt(.5),Ni(l)),Me(u,f));return To(h,s,a)}var Vbe=H({huberLoss_:Ube});function Gbe(r,e,t,n,a){n===void 0&&(n=1e-7),a===void 0&&(a=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=P(r,"labels","logLoss"),o=P(e,"predictions","logLoss"),s=null;t!=null&&(s=P(t,"weights","logLoss")),Fn(i.shape,o.shape,"Error in logLoss: ");var u=Kt(1),c=Kt(n),l=ji(Me(i,Yf(ht(o,c)))),f=Me(Tt(u,i),Yf(ht(Tt(u,o),c))),h=Tt(l,f);return To(h,s,a)}var Hbe=H({logLoss_:Gbe});function jbe(r,e,t,n){n===void 0&&(n=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=P(r,"labels","meanSquaredError"),i=P(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=P(t,"weights","meanSquaredError")),Fn(a.shape,i.shape,"Error in meanSquaredError: ");var s=jM(a,i);return To(s,o,n)}var Kbe=H({meanSquaredError_:jbe});function Xbe(r,e){var t=P(r,"labels","sigmoidCrossEntropyWithLogits"),n=P(e,"logits","sigmoidCrossEntropyWithLogits");Fn(t.shape,n.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=Ev(n),i=Me(n,t),o=SM(lu(ji(Aa(n))));return ht(Tt(a,i),o)}function Ybe(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=P(r,"multiClassLabels","sigmoidCrossEntropy"),o=P(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=P(t,"weights","sigmoidCrossEntropy")),Fn(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),n>0){var u=Kt(n),c=Kt(1),l=Kt(.5);i=ht(Me(i,Tt(c,u)),Me(l,u))}var f=Xbe(i,o);return To(f,s,a)}var Jbe=H({sigmoidCrossEntropy_:Ybe});function Zbe(r,e,t){if(t===void 0&&(t=-1),t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(e.rank," ")+"and dim was ".concat(t));var n=Xi(function(a,i,o){var s=!0,u=EM(i,[t],s),c=Tt(nr(i,"float32"),u);o([a,c]);var l=ji(Me(c,a)),f=Qt(l,[t]),h=function(p,d){var m=Se(d,2),v=m[0],g=m[1],y=uh(p.shape,[t]);return[Me(me(p,y),Tt(nr(v,"float32"),lu(g))),Me(me(p,y),Tt(lu(g),nr(v,"float32")))]};return{value:f,gradFunc:h}});return n(r,e)}function Qbe(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=D.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=P(r,"onehotLabels","softmaxCrossEntropy"),o=P(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=P(t,"weights","softmaxCrossEntropy")),Fn(i.shape,o.shape,"Error in softmaxCrossEntropy: "),n>0){var u=Kt(n),c=Kt(1),l=Kt(i.shape[1]);i=ht(Me(i,Tt(c,u)),er(u,l))}var f=Zbe(i,o);return To(f,s,a)}var ewe=H({softmaxCrossEntropy_:Qbe});function twe(r,e,t,n){var a=P(r,"indices","sparseFillEmptyRows","int32"),i=P(e,"values","sparseFillEmptyRows"),o=P(t,"denseShape","sparseFillEmptyRows","int32"),s=P(n,"defaultValue","sparseFillEmptyRows",i.dtype);if(a.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        `.concat(a.shape));if(i.rank!==1)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(o.rank!==1)throw new Error("Dense shape should be Tensor1D but received shape ".concat(o.shape));if(s.rank!==0)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));var u={indices:a,values:i,denseShape:o,defaultValue:s},c=j.runKernel(rP,u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}var rwe=H({sparseFillEmptyRows_:twe});function nwe(r,e,t){var n=P(r,"inputIndices","sparseReshape","int32"),a=P(e,"inputShape","sparseReshape","int32"),i=P(t,"newShape","sparseReshape","int32");if(n.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        `.concat(n.shape));if(a.rank!==1)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(i.rank!==1)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));var o={inputIndices:n,inputShape:a,newShape:i},s=j.runKernel(nP,o);return{outputIndices:s[0],outputShape:s[1]}}var awe=H({sparseReshape_:nwe});function iwe(r,e,t){var n=P(r,"data","sparseSegmentMean"),a=P(e,"indices","sparseSegmentMean","int32"),i=P(t,"segmentIds","sparseSegmentMean","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          `.concat(i.shape));var o={data:n,indices:a,segmentIds:i};return j.runKernel(aP,o)}var owe=H({sparseSegmentMean_:iwe});function swe(r,e,t){var n=P(r,"data","sparseSegmentSum"),a=P(e,"indices","sparseSegmentSum","int32"),i=P(t,"segmentIds","sparseSegmentSum","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         `.concat(i.shape));var o={data:n,indices:a,segmentIds:i};return j.runKernel(iP,o)}var uwe=H({sparseSegmentSum_:swe});function cwe(r,e,t,n,a,i,o,s){var u=P(r,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error("Data must be a vector, saw: ".concat(u.shape));var c=P(e,"dataSplits","stringNGrams");if(c.dtype!=="int32")throw new Error("Data splits must be of datatype int32");var l={separator:t,nGramWidths:n,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},f={data:u,dataSplits:c},h=j.runKernel(lP,f,l);return{nGrams:h[0],nGramsSplits:h[1]}}var lwe=H({stringNGrams_:cwe});function fwe(r,e,t){t===void 0&&(t=!0);var n=P(r,"input","stringSplit","string"),a=P(e,"delimiter","stringSplit","string");if(n.rank!==1)throw new Error("Input should be Tensor1D but received shape ".concat(n.shape));if(a.rank!==0)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));var i={skipEmpty:t},o={input:n,delimiter:a},s=j.runKernel(fP,o,i);return{indices:s[0],values:s[1],shape:s[2]}}var hwe=H({stringSplit_:fwe});function pwe(r,e){var t=P(r,"input","stringToHashBucketFast","string"),n={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");var a={input:t};return j.runKernel(hP,a,n)}var dwe=H({stringToHashBucketFast_:pwe});function vwe(r,e,t,n){n===void 0&&(n=!0);var a=P(r,"input","staticRegexReplace","string"),i={pattern:e,rewrite:t,replaceGlobal:n};return j.runKernel(uP,{x:a},i)}var mwe=H({staticRegexReplace_:vwe});var gwe={fft:dw,ifft:pv,rfft:vw,irfft:HM},ywe={hammingWindow:W0e,hannWindow:e4,frame:t4,stft:H0e},bwe={flipLeftRight:Y0e,grayscaleToRGB:Z0e,resizeNearestNeighbor:Nbe,resizeBilinear:kbe,rgbToGrayscale:ebe,rotateWithOffset:rbe,cropAndResize:K0e,nonMaxSuppression:abe,nonMaxSuppressionAsync:hbe,nonMaxSuppressionWithScore:dbe,nonMaxSuppressionWithScoreAsync:mbe,nonMaxSuppressionPadded:ybe,nonMaxSuppressionPaddedAsync:wbe,threshold:Ibe,transform:Abe},wwe={bandPart:_be,gramSchmidt:Rbe,qr:Pbe},xwe={absoluteDifference:Lbe,computeWeightedLoss:To,cosineDistance:zbe,hingeLoss:Wbe,huberLoss:Vbe,logLoss:Hbe,meanSquaredError:Kbe,sigmoidCrossEntropy:Jbe,softmaxCrossEntropy:ewe},kwe={sparseFillEmptyRows:rwe,sparseReshape:awe,sparseSegmentMean:owe,sparseSegmentSum:uwe},Swe={stringNGrams:lwe,stringSplit:hwe,stringToHashBucketFast:dwe,staticRegexReplace:mwe};var Nwe=new Map,zb=new Map,i4=function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(e,t){return new e(t)},r}(),o4=function(){function r(){this.classNameMap={}}return r.getMap=function(){return r.instance==null&&(r.instance=new r),r.instance},r.register=function(e){r.getMap().classNameMap[e.className]=[e,e.fromConfig]},r}();function s4(r,e,t){W(r.className!=null,function(){return"Class being registered does not have the static className property defined."}),W(typeof r.className=="string",function(){return"className is required to be a string, but got type "+typeof r.className}),W(r.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=r.className);var n=t,a=e+">"+n;return o4.register(r),Nwe.set(a,r),zb.set(r,a),r}function Twe(r){return zb.has(r)?zb.get(r):r.className}var Ewe={__proto__:null,Serializable:i4,SerializationMap:o4,getRegisteredName:Twe,registerClass:s4},ps=function(r){xo(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.minimize=function(t,n,a){n===void 0&&(n=!1);var i=this.computeGradients(t,a),o=i.value,s=i.grads;if(a!=null){var u=a.map(function(c){return{name:c.name,tensor:s[c.name]}});this.applyGradients(u)}else this.applyGradients(s);return $n(s),n?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!1,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,n){return NM(t,n)},e.prototype.dispose=function(){this.iterations_!=null&&$n(this.iterations_)},e.prototype.saveIterations=function(){return Ue(this,void 0,void 0,function(){return Ve(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Kt(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return Ue(this,void 0,void 0,function(){return Ve(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return Ue(this,void 0,void 0,function(){return Ve(this,function(n){throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()))})})},e.prototype.extractIterations=function(t){return Ue(this,void 0,void 0,function(){var n;return Ve(this,function(a){switch(a.label){case 0:return n=this,[4,t[0].tensor.data()];case 1:return n.iterations_=a.sent()[0],[2,t.slice(1)]}})})},e}(i4);Object.defineProperty(ps,Symbol.hasInstance,{value:function(r){return r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null}});var xw=function(r){xo(e,r);function e(t,n,a){a===void 0&&(a=null);var i=r.call(this)||this;return i.learningRate=t,i.rho=n,i.epsilon=a,i.accumulatedGrads=[],i.accumulatedUpdates=[],a==null&&(i.epsilon=j.backend.epsilon()),i}return Object.defineProperty(e,"className",{get:function(){return"Adadelta"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=j.registeredVariables[i],u=!1;n.accumulatedGrads[o]==null&&(n.accumulatedGrads[o]={originalName:"".concat(i,"/accum_grad"),variable:Hr(function(){return Da(s).variable(u)})}),n.accumulatedUpdates[o]==null&&(n.accumulatedUpdates[o]={originalName:"".concat(i,"/accum_var"),variable:Hr(function(){return Da(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=n.accumulatedGrads[o].variable,f=n.accumulatedUpdates[o].variable;Hr(function(){var h=ht(Me(l,n.rho),Me(Ni(c),1-n.rho)),p=Me(er(wo(ht(f,n.epsilon)),wo(ht(l,n.epsilon))),c),d=ht(Me(f,n.rho),Me(Ni(p),1-n.rho));l.assign(h),f.assign(d);var m=ht(Me(p,-n.learningRate),s);s.assign(m)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&($n(this.accumulatedGrads.map(function(t){return t.variable})),$n(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return Ue(this,void 0,void 0,function(){var t;return Ve(this,function(n){switch(n.label){case 0:return t=Et(Et([],Se(this.accumulatedGrads),!1),Se(this.accumulatedUpdates),!1),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ue(this,void 0,void 0,function(){var n,a;return Ve(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=t.length/2,a=!1,this.accumulatedGrads=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedUpdates=t.slice(n,n*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.rho,n.epsilon)},e}(ps),kw=function(r){xo(e,r);function e(t,n){n===void 0&&(n=.1);var a=r.call(this)||this;return a.learningRate=t,a.initialAccumulatorValue=n,a.accumulatedGrads=[],a}return Object.defineProperty(e,"className",{get:function(){return"Adagrad"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=j.registeredVariables[i];if(n.accumulatedGrads[o]==null){var u=!1;n.accumulatedGrads[o]={originalName:"".concat(i,"/accumulator"),variable:Hr(function(){return sh(s.shape,n.initialAccumulatorValue).variable(u)})}}var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=n.accumulatedGrads[o].variable;Hr(function(){var f=ht(l,Ni(c));l.assign(f);var h=ht(Me(er(c,wo(ht(f,j.backend.epsilon()))),-n.learningRate),s);s.assign(h)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&$n(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ue(this,void 0,void 0,function(){return Ve(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return Ue(this,void 0,void 0,function(){var n;return Ve(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),n=!1,this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(n)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,n){return new t(n.learningRate,n.initialAccumulatorValue)},e}(ps),Sw=function(r){xo(e,r);function e(t,n,a,i){i===void 0&&(i=null);var o=r.call(this)||this;return o.learningRate=t,o.beta1=n,o.beta2=a,o.epsilon=i,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],Hr(function(){o.accBeta1=Kt(n).variable(),o.accBeta2=Kt(a).variable()}),i==null&&(o.epsilon=j.backend.epsilon()),o}return Object.defineProperty(e,"className",{get:function(){return"Adam"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Hr(function(){var i=Tt(1,n.accBeta1),o=Tt(1,n.accBeta2);a.forEach(function(s,u){var c=j.registeredVariables[s],l=!1;n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:Hr(function(){return Da(c).variable(l)})}),n.accumulatedSecondMoment[u]==null&&(n.accumulatedSecondMoment[u]={originalName:"".concat(s,"/v"),variable:Hr(function(){return Da(c).variable(l)})});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=n.accumulatedFirstMoment[u].variable,p=n.accumulatedSecondMoment[u].variable,d=ht(Me(h,n.beta1),Me(f,1-n.beta1)),m=ht(Me(p,n.beta2),Me(Ni(f),1-n.beta2)),v=er(d,i),g=er(m,o);h.assign(d),p.assign(m);var y=ht(Me(er(v,ht(wo(g),n.epsilon)),-n.learningRate),c);c.assign(y)}}),n.accBeta1.assign(Me(n.accBeta1,n.beta1)),n.accBeta2.assign(Me(n.accBeta2,n.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&$n(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&$n(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ue(this,void 0,void 0,function(){var t;return Ve(this,function(n){switch(n.label){case 0:return t=Et(Et([],Se(this.accumulatedFirstMoment),!1),Se(this.accumulatedSecondMoment),!1),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ue(this,void 0,void 0,function(){var n,a,i=this;return Ve(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),Hr(function(){i.accBeta1.assign(Xf(i.beta1,i.iterations_+1)),i.accBeta2.assign(Xf(i.beta2,i.iterations_+1))}),n=t.length/2,a=!1,this.accumulatedFirstMoment=t.slice(0,n).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),this.accumulatedSecondMoment=t.slice(n,n*2).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon)},e}(ps),Nw=function(r){xo(e,r);function e(t,n,a,i,o){i===void 0&&(i=null),o===void 0&&(o=0);var s=r.call(this)||this;return s.learningRate=t,s.beta1=n,s.beta2=a,s.epsilon=i,s.decay=o,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],Hr(function(){s.iteration=Kt(0).variable(),s.accBeta1=Kt(n).variable()}),i==null&&(s.epsilon=j.backend.epsilon()),s}return Object.defineProperty(e,"className",{get:function(){return"Adamax"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Hr(function(){var i=Tt(1,n.accBeta1),o=er(-n.learningRate,ht(Me(n.iteration,n.decay),1));a.forEach(function(s,u){var c=j.registeredVariables[s],l=!1;n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:Da(c).variable(l)}),n.accumulatedWeightedInfNorm[u]==null&&(n.accumulatedWeightedInfNorm[u]={originalName:"".concat(s,"/v"),variable:Da(c).variable(l)});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=n.accumulatedFirstMoment[u].variable,p=n.accumulatedWeightedInfNorm[u].variable,d=ht(Me(h,n.beta1),Me(f,1-n.beta1)),m=Me(p,n.beta2),v=Aa(f),g=DM(m,v);h.assign(d),p.assign(g);var y=ht(Me(er(o,i),er(d,ht(g,n.epsilon))),c);c.assign(y)}}),n.iteration.assign(ht(n.iteration,1)),n.accBeta1.assign(Me(n.accBeta1,n.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&$n(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&$n(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ue(this,void 0,void 0,function(){return Ve(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return Ue(this,void 0,void 0,function(){return Ve(this,function(n){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)},e}(ps),Fv=function(r){xo(e,r);function e(t){var n=r.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return Object.defineProperty(e,"className",{get:function(){return"SGD"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=j.registeredVariables[i];Hr(function(){var c=ht(Me(n.c,s),u);u.assign(c)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=VP(Kt(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return Ue(this,void 0,void 0,function(){return Ve(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return Ue(this,void 0,void 0,function(){return Ve(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:if(t=n.sent(),t.length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,n){return new t(n.learningRate)},e}(ps),Tw=function(r){xo(e,r);function e(t,n,a){a===void 0&&(a=!1);var i=r.call(this,t)||this;return i.learningRate=t,i.momentum=n,i.useNesterov=a,i.accumulations=[],i.m=Kt(i.momentum),i}return Object.defineProperty(e,"className",{get:function(){return"Momentum"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=j.registeredVariables[i];if(n.accumulations[o]==null){var u=!1;n.accumulations[o]={originalName:"".concat(i,"/momentum"),variable:Hr(function(){return Da(s).variable(u)})}}var c=n.accumulations[o].variable,l=Array.isArray(t)?t[o].tensor:t[i];l!=null&&Hr(function(){var f,h=ht(Me(n.m,c),l);n.useNesterov?f=ht(Me(n.c,ht(l,Me(h,n.m))),s):f=ht(Me(n.c,h),s),c.assign(h),s.assign(f)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&$n(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return Ue(this,void 0,void 0,function(){return Ve(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return Ue(this,void 0,void 0,function(){var n;return Ve(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),n=!1,this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(n)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,n){return new t(n.learningRate,n.momentum,n.useNesterov)},e}(Fv),Ew=function(r){xo(e,r);function e(t,n,a,i,o){n===void 0&&(n=.9),a===void 0&&(a=0),i===void 0&&(i=null),o===void 0&&(o=!1);var s=r.call(this)||this;if(s.learningRate=t,s.decay=n,s.momentum=a,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=o,i==null&&(s.epsilon=j.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return Object.defineProperty(e,"className",{get:function(){return"RMSProp"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=j.registeredVariables[i],u=!1;n.accumulatedMeanSquares[o]==null&&(n.accumulatedMeanSquares[o]={originalName:"".concat(i,"/rms"),variable:Hr(function(){return Da(s).variable(u)})}),n.accumulatedMoments[o]==null&&(n.accumulatedMoments[o]={originalName:"".concat(i,"/momentum"),variable:Hr(function(){return Da(s).variable(u)})}),n.accumulatedMeanGrads[o]==null&&n.centered&&(n.accumulatedMeanGrads[o]={originalName:"".concat(i,"/mg"),variable:Hr(function(){return Da(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=n.accumulatedMeanSquares[o].variable,f=n.accumulatedMoments[o].variable;Hr(function(){var h=ht(Me(l,n.decay),Me(Ni(c),1-n.decay));if(n.centered){var p=n.accumulatedMeanGrads[o].variable,d=ht(Me(p,n.decay),Me(c,1-n.decay)),m=er(Me(c,n.learningRate),wo(Tt(h,ht(Ni(d),n.epsilon)))),v=ht(Me(f,n.momentum),m);l.assign(h),p.assign(d),f.assign(v);var g=Tt(s,v);s.assign(g)}else{var y=ht(Me(l,n.decay),Me(Ni(c),1-n.decay)),v=ht(Me(f,n.momentum),er(Me(c,n.learningRate),wo(ht(y,n.epsilon))));l.assign(y),f.assign(v);var g=Tt(s,v);s.assign(g)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&$n(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&$n(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&$n(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ue(this,void 0,void 0,function(){var t;return Ve(this,function(n){switch(n.label){case 0:return t=Et(Et([],Se(this.accumulatedMeanSquares),!1),Se(this.accumulatedMoments),!1),this.centered&&t.push.apply(t,Et([],Se(this.accumulatedMeanGrads),!1)),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ue(this,void 0,void 0,function(){var n,a;return Ve(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=this.centered?t.length/3:t.length/2,a=!1,this.accumulatedMeanSquares=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedMoments=t.slice(n,n*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(n*2,n*3).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,n){return new t(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)},e}(ps),Iwe=[xw,kw,Sw,Nw,Tw,Ew,Fv];function Cwe(){var r,e;try{for(var t=vn(Iwe),n=t.next();!n.done;n=t.next()){var a=n.value;s4(a)}}catch(i){r={error:i}}finally{try{n&&!n.done&&(e=t.return)&&e.call(t)}finally{if(r)throw r.error}}}var Awe="model",Dwe=".json",_we=".weights.bin";function mF(r){return new Promise(function(e){return setTimeout(e)}).then(r)}var vv=function(){function r(e){if(!yt().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(r.URL_SCHEME)&&(e=e.slice(r.URL_SCHEME.length)),(e==null||e.length===0)&&(e=Awe),this.modelJsonFileName=e+Dwe,this.weightDataFileName=e+_we}return r.prototype.save=function(e){return Ue(this,void 0,void 0,function(){var t,n,a,i,o,s,u;return Ve(this,function(c){switch(c.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=So.join(e.weightData),n=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return a=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i=XP(e,a),o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),s=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor,s.download=this.modelJsonFileName,s.href=o,[4,mF(function(){return s.dispatchEvent(new MouseEvent("click"))})];case 2:return c.sent(),e.weightData==null?[3,4]:(u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor,u.download=this.weightDataFileName,u.href=n,[4,mF(function(){return u.dispatchEvent(new MouseEvent("click"))})]);case 3:c.sent(),c.label=4;case 4:return[2,{modelArtifactsInfo:ih(e)}]}})})},r}();vv.URL_SCHEME="downloads://";var Fwe=function(){function r(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, "+"but received ".concat(e));this.jsonFile=e[0],this.weightsFiles=e.slice(1)}return r.prototype.load=function(){return Ue(this,void 0,void 0,function(){var e=this;return Ve(this,function(t){return[2,new Promise(function(n,a){var i=new FileReader;i.onload=function(o){var s=JSON.parse(o.target.result),u=s.modelTopology;if(u==null){a(new Error("modelTopology field is missing from file ".concat(e.jsonFile.name)));return}var c=s.weightsManifest;if(c==null){a(new Error("weightManifest field is missing from file ".concat(e.jsonFile.name)));return}if(e.weightsFiles.length===0){n({modelTopology:u});return}var l=rw(s,function(f){return e.loadWeights(f)});n(l)},i.onerror=function(o){return a("Failed to read model topology and weights manifest JSON "+"from file '".concat(e.jsonFile.name,"'. BrowserFiles supports loading ")+"Keras-style tf.Model artifacts only.")},i.readAsText(e.jsonFile)})]})})},r.prototype.loadWeights=function(e){var t,n,a=this,i=[],o=[];try{for(var s=vn(e),u=s.next();!u.done;u=s.next()){var c=u.value;i.push.apply(i,Et([],Se(c.weights),!1)),o.push.apply(o,Et([],Se(c.paths),!1))}}catch(h){t={error:h}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}var l=this.checkManifestAndWeightFiles(e),f=o.map(function(h){return a.loadWeightsFile(h,l[h])});return Promise.all(f).then(function(h){return[i,h]})},r.prototype.loadWeightsFile=function(e,t){return new Promise(function(n,a){var i=new FileReader;i.onload=function(o){var s=o.target.result;n(s)},i.onerror=function(o){return a("Failed to weights data from file of path '".concat(e,"'."))},i.readAsArrayBuffer(t)})},r.prototype.checkManifestAndWeightFiles=function(e){var t,n,a=this,i=[],o=this.weightsFiles.map(function(f){return pF(f.name)}),s={};try{for(var u=vn(e),c=u.next();!c.done;c=u.next()){var l=c.value;l.paths.forEach(function(f){var h=pF(f);if(i.indexOf(h)!==-1)throw new Error("Duplicate file basename found in weights manifest: "+"'".concat(h,"'"));if(i.push(h),o.indexOf(h)===-1)throw new Error("Weight file with basename '".concat(h,"' is not provided."));s[f]=a.weightsFiles[o.indexOf(h)]})}}catch(f){t={error:f}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}if(i.length!==this.weightsFiles.length)throw new Error("Mismatch in the number of files in weights manifest "+"(".concat(i.length,") and the number of weight files provided ")+"(".concat(this.weightsFiles.length,")."));return s},r}(),Rwe=function(r){return yt().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(vv.URL_SCHEME)?Owe(r.slice(vv.URL_SCHEME.length)):null};_a.registerSaveRouter(Rwe);function Owe(r){return r===void 0&&(r="model"),new vv(r)}function Pwe(r){return new Fwe(r)}function gF(r,e,t,n){o(r),t=t??0,n=n??1,s(t,n);var a=0,i=function(u){return u.then(function(c){var l=t+ ++a/r.length*(n-t);return e(l),c}),u};function o(u){W(u!=null&&Array.isArray(u)&&u.length>0,function(){return"promises must be a none empty array"})}function s(u,c){W(u>=0&&u<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(u)}),W(c>=0&&c<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(c)}),W(c>=u,function(){return"startFraction must be no more than endFraction, but "+"got startFraction ".concat(u," and endFraction ")+"".concat(c)})}return Promise.all(r.map(i))}function u4(r,e){return Ue(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h;return Ve(this,function(p){switch(p.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?yt().platform.fetch:e.fetchFunc,n=r.map(function(d){return t(d,e.requestInit,{isBinary:!0})}),a=0,i=.5,e.onProgress!=null?[3,2]:[4,Promise.all(n)];case 1:return s=p.sent(),[3,4];case 2:return[4,gF(n,e.onProgress,a,i)];case 3:s=p.sent(),p.label=4;case 4:return o=s,u=o.map(function(d){return d.arrayBuffer()}),c=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(u)];case 5:return h=p.sent(),[3,8];case 6:return[4,gF(u,e.onProgress,c,l)];case 7:h=p.sent(),p.label=8;case 8:return f=h,[2,f]}})})}function Mwe(r,e){var t=this,n,a=e.fetchFunc==null?yt().platform.fetch:e.fetchFunc,i=0,o;return(n=e.onProgress)===null||n===void 0||n.call(e,0),new ReadableStream({pull:function(s){return Ue(t,void 0,void 0,function(){var u,c,l,f,h;return Ve(this,function(p){switch(p.label){case 0:return i<r.length?o?[3,2]:[4,a(r[i],e.requestInit,{isBinary:!0})]:[3,4];case 1:c=p.sent().body,o=c.getReader(),p.label=2;case 2:return[4,o.read()];case 3:return l=p.sent(),f=l.done,h=l.value,f?(i++,o=void 0,(u=e.onProgress)===null||u===void 0||u.call(e,i/r.length),[3,0]):(s.enqueue(h),[2]);case 4:return s.close(),[2]}})})}})}function Bwe(r,e,t,n){return e===void 0&&(e=""),Ue(this,void 0,void 0,function(){var a,i;return Ve(this,function(o){return a=function(s){return u4(s,{requestInit:n})},i=c4(a),[2,i(r,e,t)]})})}function c4(r){var e=this;return function(t,n,a){return n===void 0&&(n=""),Ue(e,void 0,void 0,function(){var i,o,s,u,c,l,f,h,p,d;return Ve(this,function(m){switch(m.label){case 0:if(i=t.map(function(){return!1}),o={},s=a!=null?a.map(function(){return!1}):[],u=[],t.forEach(function(v,g){var y=0;v.weights.forEach(function(w){var b="quantization"in w?w.quantization.dtype:w.dtype,x=ou[b]*Vt(w.shape),S=function(){i[g]=!0,o[g]==null&&(o[g]=[]),o[g].push({manifestEntry:w,groupOffset:y,sizeBytes:x})};a!=null?a.forEach(function(T,E){T===w.name&&(S(),s[E]=!0)}):S(),u.push(w.name),y+=x})}),!s.every(function(v){return v}))throw c=a.filter(function(v,g){return!s[g]}),new Error("Could not find weights in manifest with names: "+"".concat(c.join(", "),`. 
`)+"Manifest JSON has weights with names: "+"".concat(u.join(", "),"."));return l=i.reduce(function(v,g,y){return g&&v.push(y),v},[]),f=[],l.forEach(function(v){t[v].paths.forEach(function(g){var y=n+(n.endsWith("/")?"":"/")+g;f.push(y)})}),[4,r(f)];case 1:return h=m.sent(),p={},d=0,l.forEach(function(v){var g=t[v].paths.length,y=new So(h.slice(d,d+g)),w=o[v];w.forEach(function(b){var x=y.slice(b.groupOffset,b.groupOffset+b.sizeBytes),S=jP(x,[b.manifestEntry]);for(var T in S)p[T]=S[T]}),d+=g}),[2,p]}})})}}var Lwe="application/octet-stream",qwe="application/json",Iw=function(){function r(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(W(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=yt().platform.fetch,W(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&W(e.length===2,function(){return"URL paths for http must have a length of 2, "+"(actual length is ".concat(e.length,").")}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}return r.prototype.save=function(e){return Ue(this,void 0,void 0,function(){var t,n,a,i,o;return Ve(this,function(s){switch(s.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit),t.body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=XP(e,n),t.body.append("model.json",new Blob([JSON.stringify(a)],{type:qwe}),"model.json"),e.weightData!=null&&(i=So.join(e.weightData),t.body.append("model.weights.bin",new Blob([i],{type:Lwe}),"model.weights.bin")),[4,this.fetch(this.path,t)];case 1:if(o=s.sent(),o.ok)return[2,{modelArtifactsInfo:ih(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(o.status,"."))}})})},r.prototype.loadModelJSON=function(){return Ue(this,void 0,void 0,function(){var e,t,n,a,i;return Ve(this,function(o){switch(o.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(e=o.sent(),!e.ok)throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(e.status,". Please verify this URL points to ")+"the model JSON of the model to load.");o.label=2;case 2:return o.trys.push([2,4,,5]),[4,e.json()];case 3:return t=o.sent(),[3,5];case 4:throw o.sent(),n="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(a=t.modelTopology,i=t.weightsManifest,a==null&&i==null)throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");return[2,t]}})})},r.prototype.load=function(){return Ue(this,void 0,void 0,function(){var e,t=this;return Ve(this,function(n){switch(n.label){case 0:return this.loadOptions.streamWeights?[2,this.loadStream()]:[4,this.loadModelJSON()];case 1:return e=n.sent(),[2,rw(e,function(a){return t.loadWeights(a)})]}})})},r.prototype.loadStream=function(){return Ue(this,void 0,void 0,function(){var e,t,n,a,i=this;return Ve(this,function(o){switch(o.label){case 0:return[4,this.loadModelJSON()];case 1:return e=o.sent(),[4,this.getWeightUrls(e.weightsManifest)];case 2:return t=o.sent(),n=Db(e.weightsManifest),a=function(){return Mwe(t,i.loadOptions)},[2,Object.assign(Object.assign({},e),{weightSpecs:n,getWeightStream:a})]}})})},r.prototype.getWeightUrls=function(e){return Ue(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S;return Ve(this,function(T){switch(T.label){case 0:t=Array.isArray(this.path)?this.path[1]:this.path,n=Se(zwe(t),2),a=n[0],i=n[1],o=this.weightPathPrefix||a,s=[],u=[];try{for(c=vn(e),l=c.next();!l.done;l=c.next()){f=l.value;try{for(h=(x=void 0,vn(f.paths)),p=h.next();!p.done;p=h.next())d=p.value,this.weightUrlConverter!=null?u.push(this.weightUrlConverter(d)):s.push(o+d+i)}catch(E){x={error:E}}finally{try{p&&!p.done&&(S=h.return)&&S.call(h)}finally{if(x)throw x.error}}}}catch(E){w={error:E}}finally{try{l&&!l.done&&(b=c.return)&&b.call(c)}finally{if(w)throw w.error}}return this.weightUrlConverter?(v=(m=s.push).apply,g=[s],y=[[]],[4,Promise.all(u)]):[3,2];case 1:v.apply(m,g.concat([Et.apply(void 0,y.concat([Se.apply(void 0,[T.sent()]),!1]))])),T.label=2;case 2:return[2,s]}})})},r.prototype.loadWeights=function(e){return Ue(this,void 0,void 0,function(){var t,n,a;return Ve(this,function(i){switch(i.label){case 0:return[4,this.getWeightUrls(e)];case 1:return t=i.sent(),n=Db(e),[4,u4(t,this.loadOptions)];case 2:return a=i.sent(),[2,[n,a]]}})})},r}();Iw.URL_SCHEME_REGEX=/^https?:\/\//;function zwe(r){var e=r.lastIndexOf("/"),t=r.lastIndexOf("?"),n=r.substring(0,e),a=t>e?r.substring(t):"";return[n+"/",a]}function $b(r){return r.match(Iw.URL_SCHEME_REGEX)!=null}var l4=function(r,e){if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;var t=!0;return Array.isArray(r)?t=r.every(function(n){return $b(n)}):t=$b(r),t?Cw(r,e):null};_a.registerSaveRouter(l4);_a.registerLoadRouter(l4);function Cw(r,e){return new Iw(r,e)}function $we(r,e){return Cw(r,e)}var vb=function(){function r(e){this.modelArtifacts=e}return r.prototype.load=function(){return this.modelArtifacts},r}(),f4=function(){function r(e){this.saveHandler=e}return r.prototype.save=function(e){return this.saveHandler(e)},r}(),Wwe=function(){function r(e){e.load&&(this.load=function(){return Promise.resolve(e.load())}),e.save&&(this.save=function(t){return Promise.resolve(e.save(t))})}return r}();function Uwe(r,e,t,n){var a=arguments;return new Wwe(h4.apply(void 0,Et([],Se(a),!1)))}function h4(r,e,t,n){if(arguments.length===1){var a=r.modelTopology!=null||r.weightSpecs!=null;return a?new vb(r):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new vb({modelTopology:r}))}else return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new vb({modelTopology:r,weightSpecs:e,weightData:t,trainingConfig:n})}function Vwe(r){return new f4(r)}function Gwe(r){return new f4(r)}var Hwe={__proto__:null,CompositeArrayBuffer:So,browserFiles:Pwe,browserHTTPRequest:$we,concatenateArrayBuffers:Fhe,copyModel:epe,decodeWeights:jP,decodeWeightsStream:Che,encodeWeights:The,fromMemory:Uwe,fromMemorySync:h4,getLoadHandlers:zhe,getModelArtifactsForJSON:rw,getModelArtifactsForJSONSync:YP,getModelArtifactsInfoForJSON:ih,getSaveHandlers:qhe,getWeightSpecs:Db,http:Cw,isHTTPScheme:$b,listModels:Zhe,loadWeights:Bwe,moveModel:tpe,registerLoadRouter:Lhe,registerSaveRouter:Bhe,removeModel:Qhe,weightsLoaderFactory:c4,withSaveHandler:Vwe,withSaveHandlerSync:Gwe};function jwe(r,e,t){var n=P(r,"labels","confusionMatrix"),a=P(e,"predictions","confusionMatrix");W(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, "+"but got ".concat(t)}),W(n.rank===1,function(){return"Expected the rank of labels to be 1, but got ".concat(n.rank)}),W(a.rank===1,function(){return"Expected the rank of predictions to be 1, "+"but got ".concat(a.rank)}),W(n.shape[0]===a.shape[0],function(){return"Mismatch in the number of examples: "+"".concat(n.shape[0]," vs. ").concat(a.shape[0],". ")+"Labels and predictions should have the same number of elements."}),W(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+"".concat(t)});var i=Lb(nr(n,"int32"),t),o=Lb(nr(a,"int32"),t),s=dv(i),u=zt(s,o);return nr(u,"int32")}var Kwe=H({confusionMatrix_:jwe});var Xwe={__proto__:null,confusionMatrix:Kwe},Qs,yF=!1;function p4(r,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(r==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,n=!1,a=!1,i=!1,o=!1,s=!1;if(r.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&r instanceof ImageData)n=!0;else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)a=!0;else if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)i=!0;else if(r.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&r instanceof ImageBitmap)s=!0;else throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, "+"but was ".concat(r.constructor.name));var u=Wf(yb,j.backendName);if(u!=null){var c={pixels:r},l={numChannels:e};return j.runKernel(yb,c,l)}var f=Se(a?[r.videoWidth,r.videoHeight]:[r.width,r.height],2),h=f[0],p=f[1],d;if(o)d=r.getContext("2d").getImageData(0,0,h,p).data;else if(n||t)d=r.data;else if(i||a||s){if(Qs==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")Qs=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else Qs=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});Qs.canvas.width=h,Qs.canvas.height=p,Qs.drawImage(r,0,0,h,p),d=Qs.getImageData(0,0,h,p).data}var m;if(e===4)m=new Int32Array(d);else{var v=h*p;m=new Int32Array(v*e);for(var g=0;g<v;g++)for(var y=0;y<e;++y)m[g*e+y]=d[g*4+y]}var w=[p,h,e];return XM(m,w,"int32")}function Ywe(r){return r!=null&&r.data instanceof Uint8Array}function Jwe(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function Zwe(r){return r!=null&&r.width!==0&&r.height!==0}function Qwe(r){return Jwe()&&!(r instanceof ImageBitmap)&&Zwe(r)&&!Ywe(r)}function e1e(r,e){return e===void 0&&(e=3),Ue(this,void 0,void 0,function(){var t,n;return Ve(this,function(a){switch(a.label){case 0:if(t=null,!(yt().getBool("WRAP_TO_IMAGEBITMAP")&&Qwe(r)))return[3,5];n=void 0,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,createImageBitmap(r,{premultiplyAlpha:"none"})];case 2:return n=a.sent(),[3,4];case 3:return a.sent(),n=null,[3,4];case 4:return n!=null&&n.width===r.width&&n.height===r.height?t=n:t=r,[3,6];case 5:t=r,a.label=6;case 6:return[2,p4(t,e)]}})})}function d4(r){if(r.rank!==2&&r.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank ".concat(r.rank,"."));var e=r.rank===2?1:r.shape[2];if(e>4||e===2)throw new Error("toPixels only supports depth of size "+"1, 3 or 4 but got ".concat(e));if(r.dtype!=="float32"&&r.dtype!=="int32")throw new Error("Unsupported type for toPixels: ".concat(r.dtype,".")+" Please use float32 or int32 tensors.")}function t1e(r){var e=r?.alpha||1;if(e>1||e<0)throw new Error("Alpha value ".concat(e," is suppoed to be in range [0 - 1]."))}function r1e(r,e){return Ue(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h,p,d,m,v,g,y;return Ve(this,function(w){switch(w.label){case 0:return t=P(r,"img","toPixels"),r instanceof Gr||(n=t,t=nr(n,"int32"),n.dispose()),d4(t),a=Se(t.shape.slice(0,2),2),i=a[0],o=a[1],s=t.rank===2?1:t.shape[2],[4,t.data()];case 1:for(u=w.sent(),c=t.dtype==="float32"?255:1,l=new Uint8ClampedArray(o*i*4),f=0;f<i*o;++f){for(h=[0,0,0,255],p=0;p<s;p++){if(d=u[f*s+p],t.dtype==="float32"){if(d<0||d>1)throw new Error("Tensor values for a float32 Tensor must be in the "+"range [0 - 1] but encountered ".concat(d,"."))}else if(t.dtype==="int32"&&(d<0||d>255))throw new Error("Tensor values for a int32 Tensor must be in the "+"range [0 - 255] but encountered ".concat(d,"."));s===1?(h[0]=d*c,h[1]=d*c,h[2]=d*c):h[p]=d*c}m=f*4,l[m+0]=Math.round(h[0]),l[m+1]=Math.round(h[1]),l[m+2]=Math.round(h[2]),l[m+3]=Math.round(h[3])}return e!=null&&(yF||(v=Wf(Kb,j.backendName),v!=null&&(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),yF=!0)),e.width=o,e.height=i,g=e.getContext("2d"),y=new ImageData(l,o,i),g.putImageData(y,0,0)),t!==r&&t.dispose(),[2,l]}})})}function n1e(r,e,t){var n=P(r,"img","draw");if(!(r instanceof Gr)){var a=n;n=nr(a,"int32"),a.dispose()}d4(n),t1e(t?.imageOptions);var i={image:n},o={canvas:e,options:t};j.runKernel(Kb,i,o)}var a1e=H({fromPixels_:p4}),i1e={__proto__:null,draw:n1e,fromPixels:a1e,fromPixelsAsync:e1e,toPixels:r1e};function v4(r,e){var t=r.shape.length,n=e.shape.length;if(t<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+" but the rank was ".concat(t,"."));if(n<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(n,"."));if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type,"+" but the dtype was ".concat(e.dtype,"."));if(e.shape[n-1]>t)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+"".concat(e.shape[n-1]," vs. ").concat(t));if(Vt(r.shape)===0)throw new Error("Requested more than 0 entries, but input is empty."+" Input shape: ".concat(r.shape,"."));for(var a=e.shape,i=a[a.length-1],o=1,s=0;s<a.length-1;++s)o*=a[s];var u=r.shape,c=a.slice();c.pop();for(var l=1,s=i;s<t;++s)l*=u[s],c.push(u[s]);var f=Et(Et([],Se($c(r.shape).map(function(h){return h/l})),!1),[1],!1).slice(0,i);return[c,o,l,f]}var o1e={__proto__:null,prepareAndValidate:v4},Wb=-2,s1e=-1;function u1e(r,e,t){var n=r.shape.length;W(n===e.length,function(){return"Error in slice".concat(n,"D: Length of begin ").concat(e," must ")+"match the rank of the array (".concat(n,").")}),W(n===t.length,function(){return"Error in slice".concat(n,"D: Length of size ").concat(t," must ")+"match the rank of the array (".concat(n,").")});for(var a=function(o){W(e[o]+t[o]<=r.shape[o],function(){return"Error in slice".concat(n,"D: begin[").concat(o,"] + size[").concat(o,"] ")+"(".concat(e[o]+t[o],") would overflow input.shape[").concat(o,"] (").concat(r.shape[o],")")})},i=0;i<n;++i)a(i)}function c1e(r){for(var e=[],t=0;r>0;)r&1&&e.push(t),r/=2,t++;return e}function l1e(r,e,t){for(var n=[],a=0;a<r.length;a++)n[a]=Math.ceil((e[a]-r[a])/t[a]);return n}function m4(r,e,t,n){for(var a=Et([],Se(r),!1),i=a.length;i<n.length;i++)a.push(1);for(var i=0;i<t;i++)i===0?a[e]=1:(a.splice(e,0,1),a.pop());return a}function g4(r,e,t){return t<=r?t:t-(e-1)}function y4(r,e){for(var t=[],n=0;n<r;n++)t.push(e+n);return t}function f1e(r,e,t,n,a,i,o,s,u){var c=r.length,l=new Array(c),f=new Array(c),h=new Array(c);if(e.length&&t>0){var p=e[0],d=t+1;l=b4(o,p,d,n,r),f=w4(s,p,d,a,r),h=m4(i,p,d,r)}else for(var m=0;m<c;m++)l[m]=k4(o,n,i,r,m,u),f[m]=S4(s,a,i,r,m,u),h[m]=x4(i,m,u);return{begin:l,end:f,strides:h}}function b4(r,e,t,n,a){for(var i=Et([],Se(a),!1),o=y4(t,e),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=0;else{var u=g4(e,t,s),c=n[u];r&1<<u&&(c=0),i[s]=c}return i}function w4(r,e,t,n,a){for(var i=Et([],Se(a),!1),o=y4(t,e),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=Number.MAX_SAFE_INTEGER;else{var u=g4(e,t,s),c=n[u];r&1<<u&&(c=Number.MAX_SAFE_INTEGER),i[s]=c}for(var l=0;l<i.length;l++){var f=a[l];i[l]<0&&(i[l]+=f),i[l]=zf(0,i[l],a[l])}return i}function x4(r,e,t){var n=r[e];return(t&1<<e||n==null)&&(n=1),n}function k4(r,e,t,n,a,i){var o=e[a],s=t[a]||1;(r&1<<a||i&1<<a||o==null)&&(s>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);var u=n[a];return o<0&&(o+=u),o=zf(0,o,u-1),o}function S4(r,e,t,n,a,i){var o=e[a],s=t[a]||1;(r&1<<a||i&1<<a||o==null)&&(s>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);var u=n[a];return o<0&&(o+=u),s>0?o=zf(0,o,u):o=zf(-1,o,u-1),o}function h1e(r,e,t){for(var n=t.length,a=0;a<t.length;a++)if(t[a]>1){n=a;break}for(var a=n+1;a<t.length;a++)if(e[a]>0||t[a]!==r[a])return!1;return!0}function p1e(r,e){for(var t=r.length>0?r[r.length-1]:1,n=0;n<r.length-1;n++)t+=r[n]*e[n];return t}function d1e(r,e,t){var n,a=r.shape.length;typeof e=="number"?n=Et([e],Se(new Array(a-1).fill(0)),!1):e.length<a?n=e.concat(new Array(a-e.length).fill(0)):n=e.slice(),n.forEach(function(o){W(o!==-1,function(){return"slice() does not support negative begin indexing."})});var i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=Et([t],Se(new Array(a-1).fill(-1)),!1):t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map(function(o,s){return o>=0?o:(W(o===-1,function(){return"Negative size values should be exactly -1 but got "+"".concat(o," for the slice() size at index ").concat(s,".")}),r.shape[s]-n[s])}),[n,i]}function v1e(r,e,t,n,a,i,o,s,u){var c;if(n==null?(c=new Array(e.length),c.fill(1)):c=n,o!=null&&(o&o-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");for(var l=!1,f={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:c.slice(),beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u},h=0;h<f.dims;h++)l&&(1<<h&s)!==0&&f.numAddAxisAfterEllipsis++,1<<h&o&&(l=!0);l||(f.ellipsisMask|=1<<f.dims,f.dims++);var p={dims:r.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};m1e(f,p);for(var d=!0,m=!0,v=!0,g=[],y=[],h=0;h<r.length;++h){if(p.strides[h]===0)throw Error("strides[".concat(h,"] must be non-zero"));var w=!!(p.shrinkAxisMask&1<<h),b=r[h];if(b===-1){g.push(w?1:-1);continue}var x=[p.beginMask&1<<h,p.endMask&1<<h],S=[p.strides[h]>0?0:-1,p.strides[h]>0?b:b-1];if(w&&p.strides[h]<=0)throw Error("only stride 1 allowed on non-range indexing.");v=v&&p.strides[h]===1;var T=!!(p.beginMask&1<<h&&p.endMask&1<<h);if(p.beginValid&&p.endValid){if(w){var E=p.begin[h]<0?b+p.begin[h]:p.begin[h];if(p.begin[h]=E,p.end[h]=p.begin[h]+1,E<0||E>=b)throw Error("slice index ".concat(p.begin[h]," of dimension ").concat(h," out of bounds."))}else p.begin[h]=bF(p.begin[h],0,p.strides[h],b,x,S),p.end[h]=bF(p.end[h],1,p.strides[h],b,x,S);var C=p.strides[h]===1&&p.begin[h]===0&&p.end[h]===b;d=d&&C,m=m&&(h===0&&p.strides[h]===1||C)}else d=d&&p.strides[h]===1&&T,m=m&&(h===0&&p.strides[h]===1||T);var R=void 0,_=!1;if(p.beginValid&&p.endValid?(R=p.end[h]-p.begin[h],_=!0):w?(R=1,_=!0):T&&b>=0&&(p.strides[h]<0?R=-b:R=b,_=!0),_){var M=void 0;R===0||R<0!=p.strides[h]<0?M=0:M=Math.trunc(R/p.strides[h])+(R%p.strides[h]!==0?1:0),g.push(M)}else g.push(-1)}for(var $=0;$<p.finalShapeGatherIndices.length;++$){var z=p.finalShapeGatherIndices[$];z>=0?y.push(g[z]):z===Wb&&y.push(1)}var q=y.filter(function(L,U){return p.finalShapeGatherIndices[U]!==Wb});return{finalShapeSparse:q,finalShape:y,isIdentity:d,sliceDim0:m,isSimpleSlice:v,begin:p.begin,end:p.end,strides:p.strides}}function m1e(r,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;var t=0;e.beginValid=r.begin!=null,e.endValid=r.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(var n=0;n<r.dims;n++)if(1<<n&r.ellipsisMask)for(var a=Math.min(e.dims-(r.dims-n)+1+r.numAddAxisAfterEllipsis,e.dims);t<a;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=n;else if(1<<n&r.newAxisMask)e.finalShapeGatherIndices.push(Wb),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error("Index out of range using input dim ".concat(t,"; input ")+"has only ".concat(e.dims," dims, ").concat(e.begin.length,"."));r.begin!=null&&(e.begin[t]=r.begin[n]),r.end!=null&&(e.end[t]=r.end[n]),e.strides[t]=r.strides[n],r.beginMask&1<<n&&(e.beginMask|=1<<t),r.endMask&1<<n&&(e.endMask|=1<<t),r.shrinkAxisMask&1<<n?(e.finalShapeGatherIndices.push(s1e),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(n)),e.inputShapeGatherIndicesSparse[t]=n,t++}}function bF(r,e,t,n,a,i){if(a[e])return t>0?i[e]:i[e+1&1];var o=r<0?n+r:r;return o<i[0]?i[0]:o>i[1]?i[1]:o}var N4={__proto__:null,assertParamsValid:u1e,computeFlatOffset:p1e,computeOutShape:l1e,getNormalizedAxes:f1e,isSliceContinous:h1e,maskToAxes:c1e,parseSliceParams:d1e,sliceInfo:v1e,startForAxis:k4,startIndicesWithElidedDims:b4,stopForAxis:S4,stopIndicesWithElidedDims:w4,stridesForAxis:x4,stridesWithElidedDims:m4};var g1e="4.19.0";var T4=function(){function r(){}return r.sgd=function(e){return new Fv(e)},r.momentum=function(e,t,n){return n===void 0&&(n=!1),new Tw(e,t,n)},r.rmsprop=function(e,t,n,a,i){return t===void 0&&(t=.9),n===void 0&&(n=0),a===void 0&&(a=null),i===void 0&&(i=!1),new Ew(e,t,n,a,i)},r.adam=function(e,t,n,a){return e===void 0&&(e=.001),t===void 0&&(t=.9),n===void 0&&(n=.999),a===void 0&&(a=null),new Sw(e,t,n,a)},r.adadelta=function(e,t,n){return e===void 0&&(e=.001),t===void 0&&(t=.95),n===void 0&&(n=null),new xw(e,t,n)},r.adamax=function(e,t,n,a,i){return e===void 0&&(e=.002),t===void 0&&(t=.9),n===void 0&&(n=.999),a===void 0&&(a=null),i===void 0&&(i=0),new Nw(e,t,n,a,i)},r.adagrad=function(e,t){return t===void 0&&(t=.1),new kw(e,t)},r}();var y1e=T4;var b1e=function(){return typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:function(r){return r()}}();function w1e(){return new Promise(function(r){return b1e(function(){return r()})})}function x1e(r,e){var t=r[0].length;r.forEach(function(a,i){W(a.length===t,function(){return"Error in concat".concat(t,"D: rank of tensors[").concat(i,"] must be the same ")+"as the rank of the rest (".concat(t,")")})}),W(e>=0&&e<t,function(){return"Error in concat".concat(t,"D: axis must be between 0 and ").concat(t-1,".")});var n=r[0];r.forEach(function(a,i){for(var o=0;o<t;o++)W(o===e||a[o]===n[o],function(){return"Error in concat".concat(t,"D: Shape of tensors[").concat(i,"] (").concat(a,") ")+"does not match the shape of the rest (".concat(n,") ")+"along the non-concatenated axis ".concat(i,".")})})}function k1e(r,e){for(var t=r[0].slice(),n=1;n<r.length;n++)t[e]+=r[n][e];return t}var Hi;(function(r){r[r.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",r[r.VALUE_ROWIDS=1]="VALUE_ROWIDS",r[r.ROW_LENGTHS=2]="ROW_LENGTHS",r[r.ROW_SPLITS=3]="ROW_SPLITS",r[r.ROW_LIMITS=4]="ROW_LIMITS",r[r.ROW_STARTS=5]="ROW_STARTS"})(Hi||(Hi={}));function S1e(r,e,t){var n=new Array;if(t==null&&e==null)return n;if(e==null)for(;n.length<r+t.length;)n.push(-1);else n=e.slice();if(t==null)return n;if(r+t.length!==n.length)throw new Error("rt input.shape and shape=".concat(e," are incompatible: rt input.rank = ").concat(r+t.length,", but shape.rank = ").concat(n.length));for(var a=1;a<t.length;++a){var i=t[a],o=n[n.length-t.length+a],s=n[o];if(i>=0)if(s>=0){if(s!==i)throw new Error("rt input.shape and shape=".concat(e," are incompatible: rt input.shape[").concat(a+r,"] = ").concat(i," but shape[").concat(a+r,"] = ").concat(s))}else n[o]=i}return n}function N1e(r){var e,t,n={FIRST_DIM_SIZE:Hi.FIRST_DIM_SIZE,VALUE_ROWIDS:Hi.VALUE_ROWIDS,ROW_LENGTHS:Hi.ROW_LENGTHS,ROW_SPLITS:Hi.ROW_SPLITS,ROW_LIMITS:Hi.ROW_LIMITS,ROW_STARTS:Hi.ROW_STARTS},a=[];try{for(var i=vn(r),o=i.next();!o.done;o=i.next()){var s=o.value;if(s in n)a.push(n[s]);else break}}catch(u){e={error:u}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return a}function T1e(r){return r.length===0?0:r[0]===Hi.FIRST_DIM_SIZE?r.length-1:r.length}function E1e(r,e){if(!(r==null||e==null)){var t=r.length,n=e.length;if(t>=n)throw new Error("defaultValue.shape=".concat(r," and ragged tensor flatValues.shape=").concat(e,", are incompatible: defaultValue.rank = ").concat(t," must be less than ragged tensor input flatValues.rank = ").concat(n,")"));for(var a=0;a<Math.min(t,n-1);++a){var i=r[a],o=e[a+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error("defaultValue.shape=".concat(r,", and ragged tensor input flatValues.shape=").concat(e," are incompatible: defaultValue.shape[").concat(a-r.length,"] = ").concat(i," but ragged tensor input.flatValues.shape[").concat(a-r.length,"] = ").concat(o))}}}var Aw=30;function I1e(r){return r<=Aw?r:iv(r,Math.floor(Math.sqrt(r)))}function C1e(r,e,t){var n=t*(typeof r=="number"?r:r[0]),a=e*(typeof r=="number"?r:r[1]);return[n,a]}function A1e(r,e,t,n){n===void 0&&(n=!0);var a=[];if(n)a=a.concat(e.slice(0)),a.push(r[0]/t),a=a.concat(r.slice(1));else{a=a.concat(r[0]);for(var i=e.length,o=0;o<i;++o)a=a.concat([r[o+1]/e[o],e[o]]);a=a.concat(r.slice(i+1))}return a}function D1e(r,e,t){t===void 0&&(t=!0);var n=[];if(t){n.push(e);for(var a=e+1;a<r;++a)a<=2*e?(n.push(a),n.push(a-(e+1))):n.push(a)}else{for(var i=[],o=[],a=1;a<r;++a)a>=e*2+1||a%2===1?o.push(a):i.push(a);n.push.apply(n,Et([],Se(i),!1)),n.push(0),n.push.apply(n,Et([],Se(o),!1))}return n}function _1e(r,e,t,n){n===void 0&&(n=!0);var a=[];n?a.push(r[0]/t):a.push(r[0]*t);for(var i=1;i<r.length;++i)i<=e.length?n?a.push(e[i-1]*r[i]):a.push(r[i]/e[i-1]):a.push(r[i]);return a}function F1e(r,e){for(var t=[0],n=0;n<e;++n)t.push(r[n][0]);return t}function R1e(r,e,t){for(var n=r.slice(0,1),a=0;a<t;++a)n.push(r[a+1]-e[a][0]-e[a][1]);return n}var O1e=1.7580993408473768,P1e=1.0507009873554805;var M1e=.3275911,B1e=.254829592,L1e=-.284496736,q1e=1.421413741,z1e=-1.453152027,$1e=1.061405429;function W1e(r,e){if(r.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+"".concat(r.length,", imag: ").concat(e.length,"."));for(var t=new Float32Array(r.length*2),n=0;n<t.length;n+=2)t[n]=r[n/2],t[n+1]=e[n/2];return t}function U1e(r){for(var e=new Float32Array(r.length/2),t=new Float32Array(r.length/2),n=0;n<r.length;n+=2)e[n/2]=r[n],t[n/2]=r[n+1];return{real:e,imag:t}}function V1e(r){for(var e=Math.ceil(r.length/4),t=new Float32Array(e),n=new Float32Array(e),a=0;a<r.length;a+=4)t[Math.floor(a/4)]=r[a],n[Math.floor(a/4)]=r[a+1];return{real:t,imag:n}}function G1e(r){for(var e=Math.floor(r.length/4),t=new Float32Array(e),n=new Float32Array(e),a=2;a<r.length;a+=4)t[Math.floor(a/4)]=r[a],n[Math.floor(a/4)]=r[a+1];return{real:t,imag:n}}function H1e(r,e){var t=r[e*2],n=r[e*2+1];return{real:t,imag:n}}function j1e(r,e,t,n){r[n*2]=e,r[n*2+1]=t}function K1e(r,e){for(var t=new Float32Array(r/2),n=new Float32Array(r/2),a=0;a<Math.ceil(r/2);a++){var i=(e?2:-2)*Math.PI*(a/r);t[a]=Math.cos(i),n[a]=Math.sin(i)}return{real:t,imag:n}}function X1e(r,e,t){var n=(t?2:-2)*Math.PI*(r/e),a=Math.cos(n),i=Math.sin(n);return{real:a,imag:i}}var mb="->",Y1e=/->/g,wF=",",xF="...";function J1e(r,e){r=r.replace(/\s/g,"");var t=(r.length-r.replace(Y1e,"").length)/mb.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error('Equation must contain exactly one arrow ("'.concat(mb,'").'));var n=Se(r.split(mb),2),a=n[0],i=n[1];W(a.indexOf(xF)===-1,function(){return'The ellipsis notation ("'.concat(xF,'") is not supported yet.')});var o=a.split(wF),s=o.length;if(e!==s)throw new Error("Expected ".concat(s," input tensors, received ").concat(e));if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");for(var u=[],c=function(g){var y=i[g];if(!o.some(function(w){return w.indexOf(y)!==-1}))throw new Error("Output subscripts contain the label ".concat(y," ")+"not present in the input subscripts.");u.indexOf(y)===-1&&u.push(y)},l=0;l<i.length;++l)c(l);for(var l=0;l<a.length;++l){var f=a[l];u.indexOf(f)===-1&&f!==wF&&u.push(f)}for(var h=new Array(o.length),l=0;l<s;++l){if(new Set(o[l].split("")).size!==o[l].length)throw new Error("Found duplicate axes in input component ".concat(o[l],". ")+"Support for duplicate axes in input is not implemented yet.");h[l]=[];for(var p=0;p<o[l].length;++p)h[l].push(u.indexOf(o[l][p]))}for(var d=u.length,m=i.length,v=[],l=m;l<d;++l)v.push(l);return{allDims:u,summedDims:v,idDims:h}}function Z1e(r,e){var t=new Array(r);t.fill(-1);for(var n=0;n<e.length;++n)t[e[n]]=n;for(var a=[],n=0;n<r;++n)t[n]===-1&&a.push(n);return t=t.filter(function(i){return i!==-1}),{permutationIndices:t,expandDims:a}}function Q1e(r,e,t){for(var n=new Array(r),a=function(o){for(var s=t[o].shape,u=function(l){n[e[o][l]]===void 0?n[e[o][l]]=s[l]:W(n[e[o][l]]===s[l],function(){return"Expected dimension ".concat(n[e[o][l]]," at axis ").concat(l," ")+"of input shaped ".concat(JSON.stringify(s),", ")+"but got dimension ".concat(s[l])})},c=0;c<e[o].length;++c)u(c)},i=0;i<t.length;++i)a(i)}function exe(r,e){var t,n,a=r,i=[],o=0;r.length===0&&a.push(-1),o=r.length+1;for(var s=0;s<o;++s)i.push([]);for(var u=[],s=0;s<a.length;++s){var c=a[s],l=rxe(e,c);try{for(var f=(t=void 0,vn(l)),h=f.next();!h.done;h=f.next()){var p=h.value;u.indexOf(p)===-1&&(i[s].push(p),u.push(p))}}catch(m){t={error:m}}finally{try{h&&!h.done&&(n=f.return)&&n.call(f)}finally{if(t)throw t.error}}}return{path:a,steps:i}}function txe(r){return r.every(function(e,t){return e===t})}function rxe(r,e){for(var t=[],n=0;n<r.length;++n)(r[n].length===0||r[n].indexOf(e)!==-1||e===-1)&&t.push(n);return t}function nxe(r,e,t){t===void 0&&(t=0);var n=[];if(typeof e=="number")W(r.shape[t]%e===0,function(){return"Number of splits must evenly divide the axis."}),n=new Array(e).fill(r.shape[t]/e);else{var a=e.reduce(function(s,u){return u===-1&&(s+=1),s},0);W(a<=1,function(){return"There should be only one negative value in split array."});var i=e.indexOf(-1);if(i!==-1){var o=e.reduce(function(s,u){return u>0?s+u:s});e[i]=r.shape[t]-o}W(r.shape[t]===e.reduce(function(s,u){return s+u}),function(){return"The sum of sizes must match the size of the axis dimension."}),n=e}return n}function axe(r){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = `.concat(r)}function ixe(r,e){return"indices(".concat(r,", 0) is invalid: ").concat(e," < 0")}function oxe(r,e,t){return"indices(".concat(r,", 0) is invalid: ").concat(e," >= ").concat(t)}function sxe(r,e){return"only one output dimension may be -1, not both ".concat(r," and ").concat(e)}function uxe(r,e){return"size ".concat(r," must be non-negative, not ").concat(e)}function cxe(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function lxe(r,e){var t=Vt(r),n=Vt(e);return"Input to reshape is a SparseTensor with ".concat(t,`
  dense values, but the requested shape requires a multiple of `).concat(n,". inputShape=").concat(r," outputShape= ").concat(e)}function fxe(r,e){var t=Vt(r),n=Vt(e);return"Input to reshape is a tensor with ".concat(t," dense values, but the requested shape has ").concat(n,". inputShape=").concat(r," outputShape=").concat(e)}function hxe(){return"segment ids must be >= 0"}function pxe(){return"segment ids are not increasing"}function dxe(r,e){return"Segment id ".concat(r," out of range [0, ").concat(e,"), possibly because segmentIds input is not sorted.")}function vxe(r,e,t){return"Bad: indices[".concat(r,"] == ").concat(e," out of range [0, ").concat(t,")")}function mxe(r,e){var t=!1,n;for(r<=Aw?(n=r,t=!0):n=iv(r,Math.floor(Math.sqrt(r)));!t;)n>e||n===r?t=!0:n=iv(r,n+1);return n}function gxe(r,e,t){for(var n=[],a=r.length,i=0;i<a;i++)i!==e?n.push(r[i]):n.push(t);return n}function yxe(r,e,t,n){var a=e.shape.length,i=r.shape.length;if(n!==0&&(n<-a||n>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(n));if(n<0&&(n+=a),n>i)throw new Error("batchDims (".concat(n,`) must be less than rank(x) (
    `).concat(i,")."));if(t<n)throw new Error("batchDims (".concat(n,") must be less than or equal to axis (").concat(t,")."));for(var o=0;o<n;++o)if(r.shape[o]!==e.shape[o])throw new Error("x.shape[".concat(o,"]: ").concat(r.shape[o]," should be equal to indices.shape[").concat(o,"]: ").concat(e.shape[o],"."));for(var s=r.shape[t],u=[],c=1,l=1,f=1,o=0;o<n;++o)u.push(r.shape[o]),c*=r.shape[o];for(var o=n;o<t;o++)u.push(r.shape[o]),l*=r.shape[o];for(var o=n;o<a;o++)u.push(e.shape[o]);for(var o=t+1;o<i;o++)u.push(r.shape[o]),f*=r.shape[o];return{batchSize:c,sliceSize:f,outerSize:l,dimSize:s,outputShape:u}}var bxe={__proto__:null,collectGatherOpShapeInfo:yxe,computeOutShape:gxe,segOpComputeOptimalWindowSize:mxe};function wxe(r){try{return r.map(function(e){return uv(e)})}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(e))}}function xxe(r){return r.map(function(e){return ah(e)})}var kxe={__proto__:null,ERF_A1:B1e,ERF_A2:L1e,ERF_A3:q1e,ERF_A4:z1e,ERF_A5:$1e,ERF_P:M1e,PARALLELIZE_THRESHOLD:Aw,get RowPartitionType(){return Hi},SELU_SCALE:P1e,SELU_SCALEALPHA:O1e,applyActivation:Dv,assertAndGetBroadcastShape:jr,assertAxesAreInnerMostDims:gve,assertParamsConsistent:x1e,assignToTypedArray:j1e,axesAreInnerMostDims:ow,calculateShapes:YM,checkEinsumDimSizes:Q1e,checkPadOnDimRoundingMode:Ja,combineLocations:mM,combineRaggedTensorToTensorShapes:S1e,complexWithEvenIndex:V1e,complexWithOddIndex:G1e,computeConv2DInfo:oh,computeConv3DInfo:sM,computeDefaultPad:nw,computeDilation2DInfo:Bpe,computeOptimalWindowSize:I1e,computeOutAndReduceShapes:mve,computeOutShape:k1e,computePool2DInfo:oM,computePool3DInfo:Lpe,convertConv2DDataFormat:uM,decodeEinsumEquation:J1e,eitherStridesOrDilationsAreOne:No,expandShapeToKeepDim:uh,exponent:X1e,exponents:K1e,fromStringArrayToUint8:xxe,fromUint8ToStringArray:wxe,getAxesPermutation:yve,getBroadcastDims:pM,getComplexWithIndex:H1e,getEinsumComputePath:exe,getEinsumPermutation:Z1e,getFusedBiasGradient:Av,getFusedDyActivation:Cv,getImageCenter:C1e,getInnerMostAxes:wve,getPermuted:D1e,getRaggedRank:T1e,getReductionAxes:iw,getReshaped:A1e,getReshapedPermuted:_1e,getRowPartitionTypesHelper:N1e,getSliceBeginCoords:F1e,getSliceSize:R1e,getSparseFillEmptyRowsIndicesDenseShapeMismatch:axe,getSparseFillEmptyRowsNegativeIndexErrorMessage:ixe,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:oxe,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:cxe,getSparseReshapeInputOutputMismatchErrorMessage:fxe,getSparseReshapeInputOutputMultipleErrorMessage:lxe,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:sxe,getSparseReshapeNegativeOutputDimErrorMessage:uxe,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:vxe,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:hxe,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:pxe,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:dxe,getUndoAxesPermutation:bve,isIdentityPermutation:txe,log:Nfe,mergeRealAndImagArrays:W1e,prepareAndValidate:v4,prepareSplitSize:nxe,segment_util:bxe,shouldFuse:_v,slice_util:N4,splitRealAndImagArrays:U1e,stridesOrDilationsArePositive:cu,tupleValuesAreOne:Kf,upcastType:bv,validateDefaultValueShape:E1e,validateInput:Iv,validateUpdateShape:gw,warn:rs};var Sxe={__proto__:null,nonMaxSuppressionV3Impl:r4,nonMaxSuppressionV4Impl:n4,nonMaxSuppressionV5Impl:a4,whereImpl:JM};Cwe();D.Abs=PF;D.Acos=MF;D.Acosh=BF;D.AdadeltaOptimizer=xw;D.AdagradOptimizer=kw;D.AdamOptimizer=Sw;D.AdamaxOptimizer=Nw;D.Add=Hb;D.AddN=LF;D.All=qF;D.Any=zF;D.ArgMax=$F;D.ArgMin=WF;D.Asin=UF;D.Asinh=VF;D.Atan=GF;D.Atan2=jF;D.Atanh=HF;D.AvgPool=KF;D.AvgPool3D=XF;D.AvgPool3DGrad=ofe;D.AvgPoolGrad=ife;D.BatchMatMul=YF;D.BatchToSpaceND=JF;D.Bincount=ZF;D.BitwiseAnd=QF;D.BroadcastArgs=eR;D.BroadcastTo=sfe;D.Cast=jb;D.Ceil=tR;D.ClipByValue=rR;D.Complex=nR;D.ComplexAbs=aR;D.Concat=iR;D.Conv2D=oR;D.Conv2DBackpropFilter=sR;D.Conv2DBackpropInput=uR;D.Conv3D=cR;D.Conv3DBackpropFilterV2=ufe;D.Conv3DBackpropInputV2=lR;D.Cos=fR;D.Cosh=hR;D.CropAndResize=vR;D.Cumprod=pR;D.Cumsum=dR;D.DataStorage=Ble;D.DenseBincount=mR;D.DepthToSpace=gR;D.DepthwiseConv2dNative=yR;D.DepthwiseConv2dNativeBackpropFilter=bR;D.DepthwiseConv2dNativeBackpropInput=wR;D.Diag=xR;D.Dilation2D=kR;D.Dilation2DBackpropFilter=lfe;D.Dilation2DBackpropInput=cfe;D.Draw=Kb;D.Einsum=NR;D.Elu=TR;D.EluGrad=ffe;D.Environment=RF;D.Equal=IR;D.Erf=ER;D.Exp=CR;D.ExpandDims=AR;D.Expm1=DR;D.FFT=_R;D.Fill=FR;D.FlipLeftRight=RR;D.Floor=OR;D.FloorDiv=PR;D.FromPixels=yb;D.FusedBatchNorm=MR;D.FusedConv2D=wb;D.FusedDepthwiseConv2D=xb;D.GatherNd=LR;D.GatherV2=BR;D.Greater=qR;D.GreaterEqual=zR;D.IFFT=$R;D.Identity=Xb;D.Imag=WR;D.IsFinite=UR;D.IsInf=VR;D.IsNan=GR;D.KernelBackend=kF;D.LRN=tO;D.LRNGrad=vfe;D.LeakyRelu=HR;D.Less=jR;D.LessEqual=KR;D.LinSpace=XR;D.Log=YR;D.Log1p=JR;D.LogSoftmax=pfe;D.LogicalAnd=ZR;D.LogicalNot=QR;D.LogicalOr=eO;D.LogicalXor=hfe;D.LowerBound=dfe;D.MatrixBandPart=mfe;D.Max=rO;D.MaxPool=aO;D.MaxPool3D=iO;D.MaxPool3DGrad=yfe;D.MaxPoolGrad=gfe;D.MaxPoolWithArgmax=oO;D.Maximum=nO;D.Mean=sO;D.Min=uO;D.Minimum=cO;D.MirrorPad=lO;D.Mod=fO;D.MomentumOptimizer=Tw;D.Multinomial=hO;D.Multiply=pO;D.Neg=dO;D.NonMaxSuppressionV3=mO;D.NonMaxSuppressionV4=gO;D.NonMaxSuppressionV5=yO;D.NotEqual=vO;D.OP_SCOPE_SUFFIX=UP;D.OneHot=wO;D.OnesLike=bO;D.Optimizer=ps;D.OptimizerConstructors=T4;D.Pack=xO;D.PadV2=kO;D.Pool=bfe;D.Pow=SO;D.Prelu=NO;D.Prod=TO;D.RMSPropOptimizer=Ew;D.RaggedGather=EO;D.RaggedRange=IO;D.RaggedTensorToTensor=CO;D.Range=AO;D.Real=DO;D.RealDiv=SR;D.Reciprocal=_O;D.Relu=FO;D.Relu6=MO;D.Reshape=RO;D.ResizeBilinear=PO;D.ResizeBilinearGrad=xfe;D.ResizeNearestNeighbor=OO;D.ResizeNearestNeighborGrad=wfe;D.Reverse=BO;D.RotateWithOffset=SP;D.Round=LO;D.Rsqrt=qO;D.SGDOptimizer=Fv;D.ScatterNd=zO;D.SearchSorted=WO;D.Select=UO;D.Selu=VO;D.Sigmoid=XO;D.Sign=KO;D.Sin=HO;D.Sinh=jO;D.Slice=GO;D.Softmax=tP;D.Softplus=YO;D.SpaceToBatchND=QO;D.SparseFillEmptyRows=rP;D.SparseReshape=nP;D.SparseSegmentMean=aP;D.SparseSegmentSum=iP;D.SparseToDense=oP;D.SplitV=eP;D.Sqrt=JO;D.Square=kfe;D.SquaredDifference=sP;D.StaticRegexReplace=uP;D.Step=kP;D.StridedSlice=cP;D.StringNGrams=lP;D.StringSplit=fP;D.StringToHashBucketFast=hP;D.Sub=pP;D.Sum=ZO;D.Tan=dP;D.Tanh=vP;D.Tensor=Gr;D.TensorBuffer=cv;D.TensorScatterUpdate=$O;D.Tile=Yb;D.TopK=mP;D.Transform=gP;D.Transpose=Qd;D.Unique=yP;D.Unpack=bP;D.UnsortedSegmentSum=wP;D.UpperBound=Sfe;D.Variable=Vf;D.ZerosLike=xP;D._FusedMatMul=bb;D.abs=Aa;D.acos=dpe;D.acosh=mpe;D.add=ht;D.addN=ype;D.all=wpe;D.any=kpe;D.argMax=Npe;D.argMin=Epe;D.asin=Cpe;D.asinh=Dpe;D.atan=Fpe;D.atan2=Ope;D.atanh=Mpe;D.avgPool=cM;D.avgPool3d=Hpe;D.backend=HP;D.backend_util=kxe;D.basicLSTMCell=Qpe;D.batchNorm=wv;D.batchNorm2d=ade;D.batchNorm3d=ode;D.batchNorm4d=ude;D.batchToSpaceND=lM;D.bincount=fM;D.bitwiseAnd=fde;D.booleanMaskAsync=h0e;D.broadcastArgs=pde;D.broadcastTo=rv;D.broadcast_util=rve;D.browser=i1e;D.buffer=bo;D.cast=nr;D.ceil=mde;D.clipByValue=yde;D.clone=iu;D.complex=cs;D.concat=ia;D.concat1d=wde;D.concat2d=kde;D.concat3d=Nde;D.concat4d=Ede;D.conv1d=Ade;D.conv2d=xv;D.conv2dTranspose=Fde;D.conv3d=Ode;D.conv3dTranspose=Lde;D.copyRegisteredKernels=Cfe;D.cos=zde;D.cosh=Wde;D.cosineWindow=bw;D.cumprod=Vde;D.cumsum=Hde;D.customGrad=Xi;D.denseBincount=Kde;D.deprecationWarn=hhe;D.depthToSpace=Yde;D.depthwiseConv2d=aw;D.device_util=ohe;D.diag=Qde;D.dilation2d=tve;D.disableDeprecationWarnings=fhe;D.dispose=$n;D.disposeVariables=phe;D.div=er;D.divNoNan=sve;D.dot=cve;D.dropout=T0e;D.einsum=Ac;D.elu=vM;D.enableDebugMode=lhe;D.enableProdMode=che;D.enclosingPowerOfTwo=QM;D.engine=dhe;D.ensureShape=pve;D.env=yt;D.equal=dM;D.erf=vve;D.euclideanNorm=Ave;D.exp=lu;D.expandDims=ts;D.expm1=Rve;D.eye=yM;D.fft=dw;D.fill=sh;D.findBackend=xhe;D.findBackendFactory=khe;D.floor=bM;D.floorDiv=iM;D.fused=z0e;D.gather=wM;D.gatherND=k0e;D.gather_util=o1e;D.getBackend=GP;D.getGradient=kb;D.getKernel=Wf;D.getKernelsForBackend=ov;D.grad=tme;D.grads=rme;D.greater=Sv;D.greaterEqual=xM;D.ifft=pv;D.imag=Nv;D.image=bwe;D.inTopKAsync=I0e;D.io=Hwe;D.irfft=HM;D.isFinite=Wve;D.isInf=Vve;D.isNaN=Hve;D.keep=VP;D.kernel_impls=Sxe;D.leakyRelu=kM;D.less=Bb;D.lessEqual=sw;D.linalg=wwe;D.linspace=Yve;D.localResponseNormalization=Zve;D.log=Yf;D.log1p=SM;D.logSigmoid=ume;D.logSoftmax=fme;D.logSumExp=EM;D.logicalAnd=lv;D.logicalNot=IM;D.logicalOr=CM;D.logicalXor=gme;D.losses=xwe;D.lowerBound=bme;D.matMul=zt;D.math=Xwe;D.max=Mc;D.maxPool=AM;D.maxPool3d=kme;D.maxPoolWithArgmax=Nme;D.maximum=DM;D.mean=fv;D.memory=vhe;D.meshgrid=Ime;D.min=Mb;D.minimum=hv;D.mirrorPad=Dme;D.mod=Fme;D.moments=Ome;D.movingAverage=v0e;D.mul=Me;D.multiRNNCell=Mme;D.multinomial=Lme;D.neg=ji;D.nextFrame=w1e;D.norm=kv;D.notEqual=_M;D.oneHot=Lb;D.ones=au;D.onesLike=Wme;D.op=H;D.outerProduct=Vme;D.pad=ch;D.pad1d=jme;D.pad2d=Xme;D.pad3d=Jme;D.pad4d=Qme;D.pool=age;D.pow=Xf;D.prelu=RM;D.print=aM;D.prod=sge;D.profile=mhe;D.raggedGather=cge;D.raggedRange=fge;D.raggedTensorToTensor=pge;D.rand=vge;D.randomGamma=Wge;D.randomNormal=UM;D.randomStandardNormal=Gge;D.randomUniform=pw;D.randomUniformInt=Kge;D.range=Jf;D.ready=bhe;D.real=Zf;D.reciprocal=Jge;D.registerBackend=She;D.registerGradient=Tfe;D.registerKernel=NP;D.relu=Ev;D.relu6=VM;D.removeBackend=whe;D.reshape=me;D.reverse=fu;D.reverse1d=rye;D.reverse2d=aye;D.reverse3d=oye;D.reverse4d=uye;D.rfft=vw;D.round=GM;D.rsqrt=fye;D.scalar=Kt;D.scatterND=g0e;D.scatter_util=Yye;D.searchSorted=uw;D.selu=pye;D.separableConv2d=vye;D.serialization=Ewe;D.setBackend=yhe;D.setPlatform=Nhe;D.setdiff1dAsync=gye;D.sigmoid=Pc;D.sign=bye;D.signal=ywe;D.sin=xye;D.sinh=Sye;D.slice=mr;D.slice1d=Tye;D.slice2d=Iye;D.slice3d=Aye;D.slice4d=_ye;D.slice_util=N4;D.softmax=Rye;D.softplus=TM;D.spaceToBatchND=FM;D.sparse=kwe;D.sparseToDense=w0e;D.spectral=gwe;D.split=Qf;D.sqrt=wo;D.square=Ni;D.squaredDifference=jM;D.squeeze=mw;D.stack=eh;D.step=KM;D.stridedSlice=Vye;D.string=Swe;D.sub=Tt;D.sum=Qt;D.sumOutType=Jfe;D.tan=Hye;D.tanh=Pb;D.tensor=Fc;D.tensor1d=Ya;D.tensor2d=qf;D.tensor3d=XM;D.tensor4d=jye;D.tensor5d=Kye;D.tensor6d=Xye;D.tensorScatterUpdate=Zye;D.tensor_util=ehe;D.test_util=Lge;D.tidy=Hr;D.tile=Lf;D.time=ghe;D.topk=e0e;D.train=y1e;D.transpose=dv;D.truncatedNormal=r0e;D.unique=a0e;D.unregisterGradient=Ife;D.unregisterKernel=Efe;D.unsortedSegmentSum=o0e;D.unstack=yw;D.upcastType=bv;D.upperBound=u0e;D.util=zfe;D.valueAndGrad=nme;D.valueAndGrads=ame;D.variable=c0e;D.variableGrads=NM;D.version_core=g1e;D.where=os;D.whereAsync=ZM;D.zeros=zc;D.zerosLike=Da});var M4=O((EEt,P4)=>{P4.exports=ar;var Za=null;try{Za=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function ar(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}ar.prototype.__isLong__;Object.defineProperty(ar.prototype,"__isLong__",{value:!0});function ca(r){return(r&&r.__isLong__)===!0}ar.isLong=ca;var E4={},I4={};function yu(r,e){var t,n,a;return e?(r>>>=0,(a=0<=r&&r<256)&&(n=I4[r],n)?n:(t=ir(r,(r|0)<0?-1:0,!0),a&&(I4[r]=t),t)):(r|=0,(a=-128<=r&&r<128)&&(n=E4[r],n)?n:(t=ir(r,r<0?-1:0,!1),a&&(E4[r]=t),t))}ar.fromInt=yu;function Qa(r,e){if(isNaN(r))return e?gu:ei;if(e){if(r<0)return gu;if(r>=_4)return O4}else{if(r<=-A4)return ua;if(r+1>=A4)return R4}return r<0?Qa(-r,e).neg():ir(r%Vc|0,r/Vc|0,e)}ar.fromNumber=Qa;function ir(r,e,t){return new ar(r,e,t)}ar.fromBits=ir;var Rv=Math.pow;function _w(r,e,t){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return ei;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return _w(r.substring(1),e,t).neg();for(var a=Qa(Rv(t,8)),i=ei,o=0;o<r.length;o+=8){var s=Math.min(8,r.length-o),u=parseInt(r.substring(o,o+s),t);if(s<8){var c=Qa(Rv(t,s));i=i.mul(c).add(Qa(u))}else i=i.mul(a),i=i.add(Qa(u))}return i.unsigned=e,i}ar.fromString=_w;function Ei(r,e){return typeof r=="number"?Qa(r,e):typeof r=="string"?_w(r,e):ir(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}ar.fromValue=Ei;var C4=1<<16,Nxe=1<<24,Vc=C4*C4,_4=Vc*Vc,A4=_4/2,D4=yu(Nxe),ei=yu(0);ar.ZERO=ei;var gu=yu(0,!0);ar.UZERO=gu;var Uc=yu(1);ar.ONE=Uc;var F4=yu(1,!0);ar.UONE=F4;var Dw=yu(-1);ar.NEG_ONE=Dw;var R4=ir(-1,2147483647,!1);ar.MAX_VALUE=R4;var O4=ir(-1,-1,!0);ar.MAX_UNSIGNED_VALUE=O4;var ua=ir(0,-2147483648,!1);ar.MIN_VALUE=ua;var Fe=ar.prototype;Fe.toInt=function(){return this.unsigned?this.low>>>0:this.low};Fe.toNumber=function(){return this.unsigned?(this.high>>>0)*Vc+(this.low>>>0):this.high*Vc+(this.low>>>0)};Fe.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ua)){var t=Qa(e),n=this.div(t),a=n.mul(t).sub(this);return n.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Qa(Rv(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};Fe.getHighBits=function(){return this.high};Fe.getHighBitsUnsigned=function(){return this.high>>>0};Fe.getLowBits=function(){return this.low};Fe.getLowBitsUnsigned=function(){return this.low>>>0};Fe.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ua)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};Fe.isZero=function(){return this.high===0&&this.low===0};Fe.eqz=Fe.isZero;Fe.isNegative=function(){return!this.unsigned&&this.high<0};Fe.isPositive=function(){return this.unsigned||this.high>=0};Fe.isOdd=function(){return(this.low&1)===1};Fe.isEven=function(){return(this.low&1)===0};Fe.equals=function(e){return ca(e)||(e=Ei(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Fe.eq=Fe.equals;Fe.notEquals=function(e){return!this.eq(e)};Fe.neq=Fe.notEquals;Fe.ne=Fe.notEquals;Fe.lessThan=function(e){return this.comp(e)<0};Fe.lt=Fe.lessThan;Fe.lessThanOrEqual=function(e){return this.comp(e)<=0};Fe.lte=Fe.lessThanOrEqual;Fe.le=Fe.lessThanOrEqual;Fe.greaterThan=function(e){return this.comp(e)>0};Fe.gt=Fe.greaterThan;Fe.greaterThanOrEqual=function(e){return this.comp(e)>=0};Fe.gte=Fe.greaterThanOrEqual;Fe.ge=Fe.greaterThanOrEqual;Fe.compare=function(e){if(ca(e)||(e=Ei(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Fe.comp=Fe.compare;Fe.negate=function(){return!this.unsigned&&this.eq(ua)?ua:this.not().add(Uc)};Fe.neg=Fe.negate;Fe.add=function(e){ca(e)||(e=Ei(e));var t=this.high>>>16,n=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,p=0;return p+=i+c,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=n+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,ir(h<<16|p,l<<16|f,this.unsigned)};Fe.subtract=function(e){return ca(e)||(e=Ei(e)),this.add(e.neg())};Fe.sub=Fe.subtract;Fe.multiply=function(e){if(this.isZero())return ei;if(ca(e)||(e=Ei(e)),Za){var t=Za.mul(this.low,this.high,e.low,e.high);return ir(t,Za.get_high(),this.unsigned)}if(e.isZero())return ei;if(this.eq(ua))return e.isOdd()?ua:ei;if(e.eq(ua))return this.isOdd()?ua:ei;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(D4)&&e.lt(D4))return Qa(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*l,p+=d>>>16,d&=65535,p+=i*l,h+=p>>>16,p&=65535,p+=o*c,h+=p>>>16,p&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=n*l+a*c+i*u+o*s,f&=65535,ir(p<<16|d,f<<16|h,this.unsigned)};Fe.mul=Fe.multiply;Fe.divide=function(e){if(ca(e)||(e=Ei(e)),e.isZero())throw Error("division by zero");if(Za){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Za.div_u:Za.div_s)(this.low,this.high,e.low,e.high);return ir(t,Za.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?gu:ei;var n,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return gu;if(e.gt(this.shru(1)))return F4;i=gu}else{if(this.eq(ua)){if(e.eq(Uc)||e.eq(Dw))return ua;if(e.eq(ua))return Uc;var o=this.shr(1);return n=o.div(e).shl(1),n.eq(ei)?e.isNegative()?Uc:Dw:(a=this.sub(e.mul(n)),i=n.add(a.div(e)),i)}else if(e.eq(ua))return this.unsigned?gu:ei;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=ei}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:Rv(2,s-48),c=Qa(n),l=c.mul(e);l.isNegative()||l.gt(a);)n-=u,c=Qa(n,this.unsigned),l=c.mul(e);c.isZero()&&(c=Uc),i=i.add(c),a=a.sub(l)}return i};Fe.div=Fe.divide;Fe.modulo=function(e){if(ca(e)||(e=Ei(e)),Za){var t=(this.unsigned?Za.rem_u:Za.rem_s)(this.low,this.high,e.low,e.high);return ir(t,Za.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Fe.mod=Fe.modulo;Fe.rem=Fe.modulo;Fe.not=function(){return ir(~this.low,~this.high,this.unsigned)};Fe.and=function(e){return ca(e)||(e=Ei(e)),ir(this.low&e.low,this.high&e.high,this.unsigned)};Fe.or=function(e){return ca(e)||(e=Ei(e)),ir(this.low|e.low,this.high|e.high,this.unsigned)};Fe.xor=function(e){return ca(e)||(e=Ei(e)),ir(this.low^e.low,this.high^e.high,this.unsigned)};Fe.shiftLeft=function(e){return ca(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?ir(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):ir(0,this.low<<e-32,this.unsigned)};Fe.shl=Fe.shiftLeft;Fe.shiftRight=function(e){return ca(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?ir(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):ir(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Fe.shr=Fe.shiftRight;Fe.shiftRightUnsigned=function(e){if(ca(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var n=this.low;return ir(n>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?ir(t,0,this.unsigned):ir(t>>>e-32,0,this.unsigned)};Fe.shru=Fe.shiftRightUnsigned;Fe.shr_u=Fe.shiftRightUnsigned;Fe.toSigned=function(){return this.unsigned?ir(this.low,this.high,!1):this};Fe.toUnsigned=function(){return this.unsigned?this:ir(this.low,this.high,!0)};Fe.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Fe.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Fe.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};ar.fromBytes=function(e,t,n){return n?ar.fromBytesLE(e,t):ar.fromBytesBE(e,t)};ar.fromBytesLE=function(e,t){return new ar(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};ar.fromBytesBE=function(e,t){return new ar(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}});var Cz=O(wr=>{"use strict";var F=mu();function Txe(r){var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}function Exe(r,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){if(n!=="default"&&!(n in r)){var a=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,a.get?a:{enumerable:!0,get:function(){return t[n]}})}})}),r}var A=Txe(F),Uw=function(r,e){return Uw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},Uw(r,e)};function oe(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Uw(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Ce(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(f){o(f)}}function u(l){try{c(n.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((n=n.apply(r,e||[])).next())})}function Ee(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function fe(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function te(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function et(r,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}var ms=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e}(Error),Zi=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e}(Error),J=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e}(Error),wt=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e}(Error),Ixe=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e}(Error);(function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e})(Error);var qB=function(){function r(e){this.maxEntries=e||100,this.cache=new Map}return r.prototype.get=function(e){var t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t},r.prototype.put=function(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){var n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,t)},r.prototype.getMaxEntries=function(){return this.maxEntries},r.prototype.setMaxEntries=function(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got ".concat(e,"."));if(this.maxEntries>e)for(var t=0;t<this.maxEntries-e;t++){var n=this.cache.keys().next().value;this.cache.delete(n)}this.maxEntries=e},r}();function Su(r,e){if(Array.isArray(r)){for(var t=[],n=0;n<e;n++)t=t.concat(r);return t}else{var t=new Array(e);return t.fill(r),t}}function Yi(r,e){if(!r)throw new Ixe(e)}function B4(r,e){var t,n,a=0;try{for(var i=fe(r),o=i.next();!o.done;o=i.next()){var s=o.value;s===e&&a++}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a}function Un(r){return r.length===1?r[0]:r}function $t(r){return Array.isArray(r)?r:[r]}function Eo(r){var e=r.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2"),t=e.replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function bu(r){return r.length<=1||r.indexOf("_")===-1?r:r.replace(/[_]+(\w|$)/g,function(e,t){return t.toUpperCase()})}var ti={};function s1(r){if(r==null)return null;var e={};return e.className=r.getClassName(),e.config=r.getConfig(),e}function Vw(r){var e,t;if(!(r==null||typeof r!="object"))if(Array.isArray(r))r.forEach(function(u){return Vw(u)});else{var n=Object.keys(r);try{for(var a=fe(n),i=a.next();!i.done;i=a.next()){var o=i.value,s=r[o];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?r[o]=s.value:Vw(s))}}catch(u){e={error:u}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}}}function Ih(r,e,t,n,a){var i,o,s,u,c,l,f,h,p,d,m;if(e===void 0&&(e={}),t===void 0&&(t={}),n===void 0&&(n="object"),a===void 0&&(a=!1),typeof r=="string"){var v=r,g=void 0;if(v in t)g=t[v];else if(v in ti)g=ti[v];else if(g=e[v],g==null)throw new J("Unknown ".concat(n,": ").concat(r,". ")+`This may be due to one of the following reasons:
`+"1. The ".concat(n," is defined in Python, in which ")+`case it needs to be ported to TensorFlow.js or your JavaScript code.
`+"2. The custom ".concat(n," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");return g}else{var y=r;if(y.className==null||y.config==null)throw new J("".concat(n,": Improper config format: ")+"".concat(JSON.stringify(y),`.
`)+"'className' and 'config' must set.");var w=y.className,b=void 0,x=void 0;if(w in t?(i=te(t[w],2),b=i[0],x=i[1]):w in ti?(o=te(ti.className,2),b=o[0],x=o[1]):w in e&&(s=te(e[w],2),b=s[0],x=s[1]),b==null)throw new J("Unknown ".concat(n,": ").concat(w,". ")+`This may be due to one of the following reasons:
`+"1. The ".concat(n," is defined in Python, in which ")+`case it needs to be ported to TensorFlow.js or your JavaScript code.
`+"2. The custom ".concat(n," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");if(x!=null){var S={};try{for(var T=fe(Object.keys(ti)),E=T.next();!E.done;E=T.next()){var C=E.value;S[C]=ti[C]}}catch(Z){u={error:Z}}finally{try{E&&!E.done&&(c=T.return)&&c.call(T)}finally{if(u)throw u.error}}try{for(var R=fe(Object.keys(t)),_=R.next();!_.done;_=R.next()){var C=_.value;S[C]=t[C]}}catch(Z){l={error:Z}}finally{try{_&&!_.done&&(f=R.return)&&f.call(R)}finally{if(l)throw l.error}}var M=y.config;M.customObjects=S;var $=Object.assign({},ti);try{for(var z=fe(Object.keys(t)),q=z.next();!q.done;q=z.next()){var C=q.value;ti[C]=t[C]}}catch(Z){h={error:Z}}finally{try{q&&!q.done&&(p=z.return)&&p.call(z)}finally{if(h)throw h.error}}Vw(y.config);var L=x(b,y.config,t,a);return ti=Object.assign({},$),L}else{var $=Object.assign({},ti);try{for(var U=fe(Object.keys(t)),Y=U.next();!Y.done;Y=U.next()){var C=Y.value;ti[C]=t[C]}}catch(X){d={error:X}}finally{try{Y&&!Y.done&&(m=U.return)&&m.call(U)}finally{if(d)throw d.error}}var L=new b(y.config);return ti=Object.assign({},$),L}}}function Cxe(r,e){return r<e?-1:r>e?1:0}function Ov(r,e){return-1*Cxe(r,e)}function gs(r){var e,t;if(r==null)return r;var n=[];try{for(var a=fe(r),i=a.next();!i.done;i=a.next()){var o=i.value;n.indexOf(o)===-1&&n.push(o)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}function Axe(r){if(r==null)throw new J("Invalid value in obj: ".concat(JSON.stringify(r)));for(var e in r)if(r.hasOwnProperty(e))return!1;return!0}function Tu(r,e,t){if(t!=null&&r.indexOf(t)<0)throw new J("".concat(t," is not a valid ").concat(e,".  Valid values are ").concat(r," or null/undefined."))}function u1(r,e,t,n){return t===void 0&&(t=0),n===void 0&&(n=1/0),Yi(t>=0),Yi(n>=t),Array.isArray(r)&&r.length>=t&&r.length<=n&&r.every(function(a){return typeof a===e})}function sn(r,e){Array.isArray(r)?(F.util.assert(r.length>0,function(){return"".concat(e," is unexpectedly an empty array.")}),r.forEach(function(t,n){return sn(t,"element ".concat(n+1," of ").concat(e))})):F.util.assert(Number.isInteger(r)&&r>0,function(){return"Expected ".concat(e," to be a positive integer, but got ")+"".concat(zB(r),".")})}function zB(r){return r===null?"null":Array.isArray(r)?"["+r.map(function(e){return zB(e)}).join(",")+"]":typeof r=="string"?'"'.concat(r,'"'):"".concat(r)}function Dxe(r,e,t){var n=t!=null?t():F.util.now(),a,i=function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var u=t!=null?t():F.util.now();return u-n<e||(n=u,a=r.apply(void 0,et([],te(o),!1))),a};return i}function $B(r){return r==="relu"?"relu":r==="linear"?"linear":r==="elu"?"elu":null}var _xe=0;function WB(){return _xe++}var Pv={};function sm(r){return r===void 0&&(r=""),r in Pv||(Pv[r]=0),Pv[r]+=1,r+Pv[r].toString()}var Fxe=["channelsFirst","channelsLast"],Rxe=["nearest","bilinear"],Oxe=["valid","same","causal"],Pxe=["max","avg"],Mxe=["sum","mul","concat","ave"];var Gc=new Map;function qr(r){Tu(Fxe,"DataFormat",r)}function Bxe(r){Tu(Rxe,"InterpolationFormat",r)}function Ra(r){Tu(Oxe,"PaddingMode",r)}function UB(r){Tu(Pxe,"PoolMode",r)}var xh=[],L4="/";function xu(r,e){xh.push(r);try{var t=e();return xh.pop(),t}catch(n){throw xh.pop(),n}}function Lxe(){return xh.length===0?"":xh.join(L4)+L4}function VB(r){if(!HB(r))throw new Error("Not a valid tensor name: '"+r+"'");return Lxe()+r}function GB(r){if(!HB(r))throw new Error("Not a valid tensor name: '"+r+"'");Gc.has(r)||Gc.set(r,0);var e=Gc.get(r);if(Gc.set(r,Gc.get(r)+1),e>0){var t="".concat(r,"_").concat(e);return Gc.set(t,1),t}else return r}var qxe=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function HB(r){return!!r.match(qxe)}function zxe(r){return r===parseInt(r.toString(),10)}function ys(r,e,t){e==null&&(e=0),t==null&&(t=r.length);for(var n=1,a=e;a<t;++a)n*=r[a];return n}function Zc(r){if(r.length===0)return Number.NaN;for(var e=Number.POSITIVE_INFINITY,t=0;t<r.length;t++){var n=r[t];n<e&&(e=n)}return e}function bs(r){if(r.length===0)return Number.NaN;for(var e=Number.NEGATIVE_INFINITY,t=0;t<r.length;t++){var n=r[t];n>e&&(e=n)}return e}function Fi(r,e){if(e<r)throw new J("end (".concat(e,") < begin (").concat(r,") is forbidden."));for(var t=[],n=r;n<e;++n)t.push(n);return t}var Fw;function Yr(){return Fw==null&&(Fw=F.backend().epsilon()),Fw}function Ri(){return"channelsLast"}function Qi(r,e){return A.cast(r,e)}function Ch(r,e){e===void 0&&(e=-1);var t=r.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),A.reshape(r,t)}function $xe(r,e){return F.tidy(function(){if(r.shape.length!==2)throw new J("repeat() expects a rank-2 tensor, but received a "+"rank-".concat(r.shape.length," tensor."));var t=Ch(r,1);return Gw(t,[1,e,1])})}function Wxe(r){var e=[ys(r.shape)];return A.reshape(r,e)}function Uxe(r){if(r.rank<=1)throw new J("batchFlatten requires a minimum rank of 2. Got rank: ".concat(r.rank,"."));var e=[r.shape[0],ys(r.shape,1)];return A.reshape(r,e)}function ku(r,e,t){return F.tidy(function(){switch(r.rank){case 1:return A.slice1d(r,e,t);case 2:return A.slice2d(r,[e,0],[t,r.shape[1]]);case 3:return A.slice3d(r,[e,0,0],[t,r.shape[1],r.shape[2]]);case 4:return A.slice4d(r,[e,0,0,0],[t,r.shape[1],r.shape[2],r.shape[3]]);case 5:return A.slice(r,[e,0,0,0,0],[t,r.shape[1],r.shape[2],r.shape[3],r.shape[4]]);case 6:return A.slice(r,[e,0,0,0,0,0],[t,r.shape[1],r.shape[2],r.shape[3],r.shape[4],r.shape[5]]);default:throw new J("sliceAlongFirstAxis() received an unsupported tensor rank: "+"".concat(r.rank))}})}function Rw(r,e,t){return F.tidy(function(){switch(r.rank){case 1:return A.slice1d(r,e,t);case 2:return A.slice2d(r,[0,e],[r.shape[0],t]);case 3:return A.slice3d(r,[0,0,e],[r.shape[0],r.shape[1],t]);case 4:return A.slice4d(r,[0,0,0,e],[r.shape[0],r.shape[1],r.shape[2],t]);default:throw new J("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(r.rank))}})}function Mv(r,e,t,n){return F.tidy(function(){switch(r.rank){case 1:return A.slice1d(r,e,t);case 2:switch(n){case 1:return ku(r,e,t);case 2:return Rw(r,e,t);default:throw new J("The axis is not within the rank of the tensor "+"".concat(n))}case 3:switch(n){case 1:return ku(r,e,t);case 2:return A.slice3d(r,[0,e,0],[r.shape[0],t,r.shape[2]]);case 3:return Rw(r,e,t);default:throw new J("The axis is not within the rank of the tensor "+"".concat(n))}case 4:switch(n){case 1:return ku(r,e,t);case 2:return A.slice4d(r,[0,e,0,0],[r.shape[0],t,r.shape[2],r.shape[3]]);case 3:return A.slice4d(r,[0,0,e,0],[r.shape[0],r.shape[1],t,r.shape[3]]);case 4:return Rw(r,e,t);default:throw new J("The axis is not within the rank of the tensor "+"".concat(n))}default:throw new J("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(r.rank))}})}function c1(r,e){e===void 0&&(e=-1);var t;return e<0&&(t=r[0].rank,t!==0?e=t:e=0),e===r[0].rank&&(e=-1),A.concat(r,e)}function q4(r,e){switch(r.rank){case 1:return A.concat1d([r,e]);case 2:return A.concat2d([r,e],0);case 3:return A.concat3d([r,e],0);case 4:return A.concat4d([r,e],0);default:throw new J("concatAlongFirstAxis() received an unsupported "+"tensor rank: ".concat(r.rank))}}function Gw(r,e){if(Array.isArray(e)||(e=[e]),r.rank!==e.length)throw new J("The length of input n (".concat(e.length,") does not match ")+"the number of dimensions in input x (".concat(r.rank,")"));return A.tile(r,e)}function um(r,e,t,n,a){return e===void 0&&(e=0),t===void 0&&(t=1),A.randomNormal(r,e,t,n,a)}function eo(r,e,t,n){if(r.rank<2||e.rank<2)throw new wt("dot requires both inputs to be rank >= 2"+" but got x shape = ".concat(r.shape," and y shape = ").concat(e.shape));if(e.rank>=3){var a=r.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(a!==i)throw new wt("If rank y >= 3, then the second last dim"+" of y must equal the last dim of x but got x shape = ".concat(r.shape," and ")+" y shape = ".concat(e.shape))}if(r.rank===2&&e.rank===2){var o=!1,s=!1;return A.fused.matMul({a:r,b:e,transposeA:o,transposeB:s,bias:n?Hw(r.rank,n,Ri()):null,activation:t})}else{var u=r.shape.slice(),c=u.pop();r=A.reshape(r,[-1,c]);var l=e.shape.slice(),f=l.pop(),i=l.pop(),h=et(et([],te(l),!1),[f],!1),p=Array.from({length:e.rank},function(y,w){return w===0?e.rank-2:w<=e.rank-2?w-1:w});e=A.reshape(A.transpose(e,p),[i,-1]);var d=et(et([],te(u),!1),te(h),!1),o=!1,s=!1;return A.reshape(A.fused.matMul({a:r,b:e,transposeA:o,transposeB:s,bias:n?Hw(r.rank,n,Ri()):null,activation:t}),d)}}function jB(r,e,t){return F.tidy(function(){return Array.isArray(e)?e=F.tensor1d(e,"int32"):e=A.cast(e,"int32"),A.gather(r,e,t)})}function Ah(r){return A.mul(r,r)}function Hw(r,e,t){var n=e.shape;if(e.rank!==1&&e.rank!==r)throw new J("Unexpected bias dimensions: ".concat(e.rank)+"; expected it to be 1 or ".concat(r));if(r===5){if(t==="channelsFirst")return n.length===1?A.reshape(e,[1,n[0],1,1,1]):A.reshape(e,[1,n[3],n[0],n[1],n[2]]);if(t==="channelsLast")return n.length===1?A.reshape(e,[1,1,1,1,n[0]]):A.reshape(e,[1].concat(n))}else if(r===4){if(t==="channelsFirst")return n.length===1?A.reshape(e,[1,n[0],1,1]):A.reshape(e,[1,n[2],n[0],n[1]]);if(t==="channelsLast")return n.length===1?A.reshape(e,[1,1,1,n[0]]):A.reshape(e,[1].concat(n))}else if(r===3){if(t==="channelsFirst")return n.length===1?A.reshape(e,[1,n[0],1]):A.reshape(e,[1,n[1],n[0]]);if(t==="channelsLast")return n.length===1?A.reshape(e,[1,1,n[0]]):A.reshape(e,[1].concat(n))}else if(r<3)return e;throw new J("Unsupported input rank by biasAdd: ".concat(e.rank))}function Mi(r,e,t){return F.tidy(function(){return t==null&&(t=Ri()),qr(t),A.add(r,Hw(r.rank,e,t))})}function Vxe(r,e){if(e===void 0&&(e=1),e!==1)throw new wt("Support for alpha values other than 1 (".concat(e,") is not implemented ")+"yet.");return A.elu(r)}function Gxe(r){return F.tidy(function(){return A.div(r,A.add(A.abs(r),1))})}function KB(r,e,t,n){return F.tidy(function(){return A.dropout(r,e,t,n)})}function Hxe(r){return F.tidy(function(){var e=A.add(.5,A.mul(.2,r));return A.clipByValue(e,0,1)})}function Dh(r,e,t){return t===void 0&&(t=!1),t?r():e()}var jxe=["fanIn","fanOut","fanAvg"],Kxe=["normal","uniform","truncatedNormal"];function Xxe(r){Tu(jxe,"FanMode",r)}function Yxe(r){Tu(Kxe,"Distribution",r)}var oi=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.fromConfigUsesCustomObjects=function(){return!1},e.prototype.getConfig=function(){return{}},e}(F.serialization.Serializable),l1=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return F.zeros(t,n)},e}(oi);l1.className="Zeros";F.serialization.registerClass(l1);var cm=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return F.ones(t,n)},e}(oi);cm.className="Ones";F.serialization.registerClass(cm);var f1=function(r){oe(e,r);function e(t){var n=r.call(this)||this;if(typeof t!="object")throw new J("Expected argument of type ConstantConfig but got ".concat(t));if(t.value===void 0)throw new J("config must have value set but got ".concat(t));return n.value=t.value,n}return e.prototype.apply=function(t,n){var a=this;return F.tidy(function(){return F.mul(F.scalar(a.value),F.ones(t,n))})},e.prototype.getConfig=function(){return{value:this.value}},e}(oi);f1.className="Constant";F.serialization.registerClass(f1);var h1=function(r){oe(e,r);function e(t){var n=r.call(this)||this;return n.DEFAULT_MINVAL=-.05,n.DEFAULT_MAXVAL=.05,n.minval=t.minval||n.DEFAULT_MINVAL,n.maxval=t.maxval||n.DEFAULT_MAXVAL,n.seed=t.seed,n}return e.prototype.apply=function(t,n){return F.randomUniform(t,this.minval,this.maxval,n,this.seed)},e.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},e}(oi);h1.className="RandomUniform";F.serialization.registerClass(h1);var p1=function(r){oe(e,r);function e(t){var n=r.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=t.mean||n.DEFAULT_MEAN,n.stddev=t.stddev||n.DEFAULT_STDDEV,n.seed=t.seed,n}return e.prototype.apply=function(t,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new wt("randomNormal does not support dType ".concat(n,"."));return um(t,this.mean,this.stddev,n,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e}(oi);p1.className="RandomNormal";F.serialization.registerClass(p1);var d1=function(r){oe(e,r);function e(t){var n=r.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=t.mean||n.DEFAULT_MEAN,n.stddev=t.stddev||n.DEFAULT_STDDEV,n.seed=t.seed,n}return e.prototype.apply=function(t,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new wt("truncatedNormal does not support dType ".concat(n,"."));return F.truncatedNormal(t,this.mean,this.stddev,n,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e}(oi);d1.className="TruncatedNormal";F.serialization.registerClass(d1);var v1=function(r){oe(e,r);function e(t){var n=r.call(this)||this;return n.gain=t.gain!=null?t.gain:1,n}return e.prototype.apply=function(t,n){var a=this;return F.tidy(function(){if(t.length!==2||t[0]!==t[1])throw new J("Identity matrix initializer can only be used for 2D square matrices.");return F.mul(a.gain,F.eye(t[0]))})},e.prototype.getConfig=function(){return{gain:this.gain}},e}(oi);v1.className="Identity";F.serialization.registerClass(v1);function Jxe(r,e){e===void 0&&(e="channelsLast");var t,n;if(qr(e),r.length===2)t=r[0],n=r[1];else if([3,4,5].indexOf(r.length)!==-1){if(e==="channelsFirst"){var a=ys(r,2);t=r[1]*a,n=r[0]*a}else if(e==="channelsLast"){var a=ys(r,0,r.length-2);t=r[r.length-2]*a,n=r[r.length-1]*a}}else{var i=ys(r);t=Math.sqrt(i),n=Math.sqrt(i)}return[t,n]}var Vn=function(r){oe(e,r);function e(t){var n=r.call(this)||this;if(t.scale<0)throw new J("scale must be a positive float. Got: ".concat(t.scale));return n.scale=t.scale==null?1:t.scale,n.mode=t.mode==null?"fanIn":t.mode,Xxe(n.mode),n.distribution=t.distribution==null?"normal":t.distribution,Yxe(n.distribution),n.seed=t.seed,n}return e.prototype.apply=function(t,n){var a=Jxe(t),i=a[0],o=a[1],s=this.scale;if(this.mode==="fanIn"?s/=Math.max(1,i):this.mode==="fanOut"?s/=Math.max(1,o):s/=Math.max(1,(i+o)/2),this.distribution==="normal"){var u=Math.sqrt(s);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new wt("".concat(this.getClassName()," does not support dType ").concat(n,"."));return F.truncatedNormal(t,0,u,n,this.seed)}else{var c=Math.sqrt(3*s);return F.randomUniform(t,-c,c,n,this.seed)}},e.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},e}(oi);Vn.className="VarianceScaling";F.serialization.registerClass(Vn);var lm=function(r){oe(e,r);function e(t){return r.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Vn.className},e}(Vn);lm.className="GlorotUniform";F.serialization.registerClass(lm);var fm=function(r){oe(e,r);function e(t){return r.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Vn.className},e}(Vn);fm.className="GlorotNormal";F.serialization.registerClass(fm);var hm=function(r){oe(e,r);function e(t){return r.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Vn.className},e}(Vn);hm.className="HeNormal";F.serialization.registerClass(hm);var pm=function(r){oe(e,r);function e(t){return r.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Vn.className},e}(Vn);pm.className="HeUniform";F.serialization.registerClass(pm);var dm=function(r){oe(e,r);function e(t){return r.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Vn.className},e}(Vn);dm.className="LeCunNormal";F.serialization.registerClass(dm);var vm=function(r){oe(e,r);function e(t){return r.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Vn.className},e}(Vn);vm.className="LeCunUniform";F.serialization.registerClass(vm);var m1=function(r){oe(e,r);function e(t){var n=r.call(this)||this;return n.DEFAULT_GAIN=1,n.ELEMENTS_WARN_SLOW=2e3,n.gain=t.gain==null?n.DEFAULT_GAIN:t.gain,n.seed=t.seed,n}return e.prototype.apply=function(t,n){var a=this;return F.tidy(function(){if(t.length<2)throw new wt("Shape must be at least 2D.");if(n!=="int32"&&n!=="float32"&&n!==void 0)throw new TypeError("Unsupported data type ".concat(n,"."));n=n;var i=F.util.sizeFromShape(t.slice(0,-1)),o=t[t.length-1],s=i*o;s>a.ELEMENTS_WARN_SLOW&&console.warn("Orthogonal initializer is being called on a matrix with more "+"than ".concat(a.ELEMENTS_WARN_SLOW," (").concat(s,") elements: ")+"Slowness may result.");var u=[Math.max(o,i),Math.min(o,i)],c=um(u,0,1,n,a.seed),l=F.linalg.qr(c,!1),f=l[0],h=l[1],p=h.flatten().stridedSlice([0],[Math.min(o,i)*Math.min(o,i)],[Math.min(o,i)+1]);return f=F.mul(f,p.sign()),i<o&&(f=f.transpose()),F.mul(F.scalar(a.gain),f.reshape(t))})},e.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},e}(oi);m1.className="Orthogonal";F.serialization.registerClass(m1);var z4={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function $4(r,e){return e===void 0&&(e={}),Ih(r,F.serialization.SerializationMap.getMap().classNameMap,e,"initializer")}function Cr(r){return s1(r)}function gr(r){if(typeof r=="string"){var e=r in z4?z4[r]:r;if(e==="GlorotNormal")return new fm;if(e==="GlorotUniform")return new lm;if(e==="HeNormal")return new hm;if(e==="HeUniform")return new pm;if(e==="LeCunNormal")return new dm;if(e==="LeCunUniform")return new vm;var t={};return t.className=e,t.config={},$4(t)}else return r instanceof oi?r:$4(r)}function jw(r){return Array.isArray(r)&&Array.isArray(r[0])}function Uv(r){return r.length===0?[]:Array.isArray(r[0])?r:[r]}function ut(r){var e;if(Array.isArray(r)){if(r.length!==1)throw new J("Expected Tensor length to be 1; got ".concat(r.length));e=r[0]}else e=r;return e}function Rt(r){if(Array.isArray(r)&&Array.isArray(r[0])){if(r.length===1)return r=r,r[0];throw new J("Expected exactly 1 Shape; got ".concat(r.length))}else return r}function Vv(r){var e,t,n=0;try{for(var a=fe(r),i=a.next();!i.done;i=a.next()){var o=i.value;o.shape.length===0?n+=1:n+=o.shape.reduce(function(s,u){return s*u})}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}var W4="Variable",XB=function(){function r(e,t,n,a,i){t===void 0&&(t="float32"),n===void 0&&(n=W4),a===void 0&&(a=!0),i===void 0&&(i=null),this.dtype=t??"float32",this.shape=e.shape,this.id=WB(),n=n??W4,this.originalName=VB(n),this.name=GB(this.originalName),this.trainable_=a,this.constraint=i,this.val=A.variable(e,this.trainable_,this.name,this.dtype)}return r.prototype.read=function(){return this.assertNotDisposed(),this.val},r.prototype.write=function(e){return this.assertNotDisposed(),Zxe(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this},r.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},r.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))},Object.defineProperty(r.prototype,"trainable",{get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e},enumerable:!1,configurable:!0}),r}();function Zxe(r,e){if(r.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(r.shape)+" vs. "+JSON.stringify(e.shape))}function Kw(r){return r.map(function(e){return e.read()})}function g1(r){r.forEach(function(e){var t=e[0];t.write(e[1])})}var Kr=function(){function r(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}return r}(),Oi=function(){function r(e,t,n,a,i,o,s){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=WB(),o!=null&&(this.originalName=VB(o),this.name=GB(this.originalName)),this.rank=t.length}return r}(),Qxe=0,mm=function(){function r(e,t){var n,a;this.callArgs=t,this.id=Qxe++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;try{for(var i=fe(e.inboundLayers),o=i.next();!o.done;o=i.next()){var s=o.value;s?.outboundNodes.push(this)}}catch(u){n={error:u}}finally{try{o&&!o.done&&(a=i.return)&&a.call(i)}finally{if(n)throw n.error}}e.outboundLayer.inboundNodes.push(this)}return r.prototype.getConfig=function(){var e,t,n=[];try{for(var a=fe(this.inboundLayers),i=a.next();!i.done;i=a.next()){var o=i.value;o!=null?n.push(o.name):n.push(null)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:n,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},r}(),eke=0,xt=function(r){oe(e,r);function e(t){t===void 0&&(t={});var n=r.call(this)||this;n._callHook=null,n._addedWeightNames=[],n._stateful=!1,n.id=eke++,n.activityRegularizer=null,n.inputSpec=null,n.supportsMasking=!1,n._trainableWeights=[],n._nonTrainableWeights=[],n._losses=[],n._updates=[],n._built=!1,n.inboundNodes=[],n.outboundNodes=[];var a=t.name;if(!a){var i=n.getClassName();a=Eo(i)+"_"+sm(i)}if(n.name=a,n.trainable_=t.trainable==null?!0:t.trainable,t.inputShape!=null||t.batchInputShape!=null){var o=void 0;if(t.batchInputShape!=null)o=t.batchInputShape;else if(t.inputShape!=null){var s=null;t.batchSize!=null&&(s=t.batchSize),o=[s].concat(t.inputShape)}n.batchInputShape=o;var u=t.dtype;u==null&&(u=t.inputDType),u==null&&(u="float32"),n.dtype=u}return t.weights!=null?n.initialWeights=t.weights:n.initialWeights=null,n._refCount=null,n.fastWeightInitDuringBuild=!1,n}return e.nodeKey=function(t,n){return t.name+"_ib-"+n.toString()},e.prototype.getNodeAtIndex=function(t,n){if(this.inboundNodes.length===0)throw new Zi("The layer has never been called "+"and thus has no defined ".concat(n,"."));if(this.inboundNodes.length<=t)throw new J("Asked to get ".concat(n," at node ").concat(t,", ")+"but the layer has only ".concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[t]},e.prototype.getInputAt=function(t){return Un(this.getNodeAtIndex(t,"input").inputTensors)},e.prototype.getOutputAt=function(t){return Un(this.getNodeAtIndex(t,"output").outputTensors)},Object.defineProperty(e.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new ms("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(this.inboundNodes.length===0)throw new ms("Layer ".concat(this.name)+" is not connected, no input to return.");return Un(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){if(this.inboundNodes.length===0)throw new ms("Layer ".concat(this.name)+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new ms("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return Un(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this._losses},enumerable:!1,configurable:!0}),e.prototype.calculateLosses=function(){return this.losses.map(function(t){return t()})},Object.defineProperty(e.prototype,"updates",{get:function(){return this._updates},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"built",{get:function(){return this._built},set:function(t){this._built=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this._trainableWeights.forEach(function(n){return n.trainable=t}),this.trainable_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable_?this._trainableWeights.filter(function(t){return t.trainable}):[]},set:function(t){this._trainableWeights=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._trainableWeights.filter(function(t){return!t.trainable}).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(t){this._nonTrainableWeights=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stateful",{get:function(){return this._stateful},enumerable:!1,configurable:!0}),e.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},e.prototype.assertInputCompatibility=function(t){var n=$t(t);if(!(this.inputSpec==null||this.inputSpec.length===0)){var a=$t(this.inputSpec);if(n.length!==a.length)throw new J("Layer ".concat(this.name," expects ").concat(a.length," inputs, ")+"but it received ".concat(n.length," input tensors. ")+"Input received: ".concat(t));for(var i=0;i<n.length;i++){var o=n[i],s=a[i];if(s!=null){var u=o.rank;if(s.ndim!=null&&u!==s.ndim)throw new J("Input ".concat(i," is incompatible with layer ").concat(this.name,": ")+"expected ndim=".concat(s.ndim,", found ndim=").concat(u));if(s.maxNDim!=null&&u>s.maxNDim)throw new J("Input ".concat(i," is incompatible with layer ").concat(this.name)+": expected max_ndim=".concat(s.maxNDim,", found ndim=").concat(u));if(s.minNDim!=null&&u<s.minNDim)throw new J("Input ".concat(i," is incompatible with layer ").concat(this.name)+": expected min_ndim=".concat(s.minNDim,", found ndim=").concat(u,"."));if(s.dtype!=null&&o.dtype!==s.dtype)throw new J("Input ".concat(i," is incompatible with layer ").concat(this.name," ")+": expected dtype=".concat(s.dtype,", found dtype=").concat(o.dtype,"."));if(s.axes){var c=o.shape;for(var l in s.axes){var f=Number(l),h=s.axes[l],p=f>=0?c[f]:c[c.length+f];if(h!=null&&[h,null].indexOf(p)===-1)throw new J("Input ".concat(i," is incompatible with layer ")+"".concat(this.name,": expected axis ").concat(f," of input shape to ")+"have value ".concat(h," but got shape ").concat(c,"."))}}if(s.shape!=null)for(var d=0;d<s.shape.length;++d){var m=s.shape[d],v=o.shape[d];if(m!=null&&v!=null&&m!==v)throw new J("Input ".concat(i," is incompatible with layer ")+"".concat(this.name,": expected shape=").concat(s.shape,", ")+"found shape=".concat(o.shape,"."))}}}}},e.prototype.call=function(t,n){return t},e.prototype.invokeCallHook=function(t,n){this._callHook!=null&&this._callHook(t,n)},e.prototype.setCallHook=function(t){this._callHook=t},e.prototype.clearCallHook=function(){this._callHook=null},e.prototype.apply=function(t,n){var a=this;n=n||{},this.assertNotDisposed();var i=$t(t),o=nke(t),s=ake(t);if(o===s)throw new J("Arguments to apply() must be all SymbolicTensors or all Tensors");return xu(this.name,function(){var u,c,l,f;if(!a.built){a.assertInputCompatibility(t);var h=[];try{for(var p=fe($t(t)),d=p.next();!d.done;d=p.next()){var m=d.value;h.push(m.shape)}}catch(C){u={error:C}}finally{try{d&&!d.done&&(c=p.return)&&c.call(p)}finally{if(u)throw u.error}}a.build(Un(h)),a.built=!0,a.initialWeights&&a.setWeights(a.initialWeights),a._refCount===null&&s&&(a._refCount=1)}if(a.assertInputCompatibility(t),s){var v=a.call(t,n);a.supportsMasking&&a.setMaskMetadata(t,v);var g=$t(v),y=[];try{for(var w=fe(g),b=w.next();!b.done;b=w.next()){var x=b.value;i.indexOf(x)!==-1&&(x=x.clone()),y.push(x)}}catch(C){l={error:C}}finally{try{b&&!b.done&&(f=w.return)&&f.call(w)}finally{if(l)throw l.error}}if(v=Un(y),a.activityRegularizer!=null)throw new wt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return v}else{var S=tke(t),T=a.computeOutputShape(S),v=void 0,E=rke(t);if(a.warnOnIncompatibleInputShape(Array.isArray(t)?S[0]:S),T!=null&&T.length>0&&Array.isArray(T[0])?v=T.map(function(R,_){return new Oi(E,R,a,$t(t),n,a.name,_)}):v=new Oi(E,T,a,$t(t),n,a.name),a.addInboundNode(t,v,null,null,S,T,n),a._refCount++,a.activityRegularizer!=null)throw new wt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return v}})},e.prototype.warnOnIncompatibleInputShape=function(t){if(this.batchInputShape!=null)if(t.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+"".concat(JSON.stringify(t),") does not match that of the ")+"batchInputShape (".concat(JSON.stringify(this.batchInputShape),") ")+"of the layer ".concat(this.name));else{var n=!1;this.batchInputShape.forEach(function(a,i){a!=null&&t[i]!=null&&t[i]!==a&&(n=!0)}),n&&console.warn("The shape of the input tensor "+"(".concat(JSON.stringify(t),") does not ")+"match the expectation of layer ".concat(this.name,": ")+"".concat(JSON.stringify(this.batchInputShape)))}},Object.defineProperty(e.prototype,"outputShape",{get:function(){var t,n;if(this.inboundNodes==null||this.inboundNodes.length===0)throw new ms("The layer ".concat(this.name," has never been called and thus has no ")+"defined output shape.");var a=[];try{for(var i=fe(this.inboundNodes),o=i.next();!o.done;o=i.next()){var s=o.value,u=JSON.stringify(s.outputShapes);a.indexOf(u)===-1&&a.push(u)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}if(a.length===1){var c=this.inboundNodes[0].outputShapes;return Array.isArray(c)&&Array.isArray(c[0])&&c.length===1?c[0]:c}else throw new ms("The layer ".concat(this.name," has multiple inbound nodes with different ")+'output shapes. Hence the notion of "output shape" is ill-defined for the layer.')},enumerable:!1,configurable:!0}),e.prototype.countParams=function(){if(!this.built)throw new Zi("You tried to call countParams() on ".concat(this.name,", ")+"but the layer is not built yet. Build it first by calling build(batchInputShape).");return Vv(this.weights)},e.prototype.build=function(t){this.built=!0},e.prototype.getWeights=function(t){return t===void 0&&(t=!1),Kw(t?this.trainableWeights:this.weights)},e.prototype.setWeights=function(t){var n=this;F.tidy(function(){var a=n.weights;if(a.length!==t.length)throw new J('You called setWeights(weights) on layer "'.concat(n.name,'" ')+"with a weight list of length ".concat(t.length,", ")+"but the layer was expecting ".concat(a.length," weights. ")+"Provided weights: ".concat(t,"..."));if(a.length!==0){for(var i=[],o=Kw(a),s=0;s<o.length;++s){var u=o[s],c=a[s],l=t[s];if(!F.util.arraysEqual(u.shape,l.shape))throw new J("Layer weight shape ".concat(u.shape," ")+"not compatible with provided weight shape ".concat(l.shape));i.push([c,l])}g1(i)}})},e.prototype.addWeight=function(t,n,a,i,o,s,u,c){if(this._addedWeightNames.indexOf(t)!==-1)throw new J("Duplicate weight name ".concat(t," for layer ").concat(this.name));this._addedWeightNames.push(t),a==null&&(a="float32"),this.fastWeightInitDuringBuild&&(i=c!=null?c():gr("zeros"));var l=i.apply(n,a),f=new XB(l,a,t,s,u);return l.dispose(),o!=null&&this.addLoss(function(){return o.apply(f.read())}),s==null&&(s=!0),s?this._trainableWeights.push(f):this._nonTrainableWeights.push(f),f},e.prototype.setFastWeightInitDuringBuild=function(t){this.fastWeightInitDuringBuild=t},e.prototype.addLoss=function(t){var n;t==null||Array.isArray(t)&&t.length===0||(t=$t(t),this._losses!==void 0&&this._losses!==null&&(n=this.losses).push.apply(n,et([],te(t),!1)))},e.prototype.computeOutputShape=function(t){return t},e.prototype.computeMask=function(t,n){var a=this;if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(function(i){if(i!=null)throw new TypeError("Layer ".concat(a.name," does not support masking, ")+"but was passed an inputMask.")});else throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.");return null}return n},e.prototype.setMaskMetadata=function(t,n,a){if(!!this.supportsMasking){var i=this.computeMask(t,a),o=$t(n),s=$t(i);if(o.length!==s.length)throw new Error("".concat(this.name," outputs ").concat(o.length," tensors ")+"but ".concat(o.length," masks for those tensors"));for(var u=0;u<o.length;u++)o[u].kerasMask=s[u]}},e.prototype.addInboundNode=function(t,n,a,i,o,s,u){var c,l;u===void 0&&(u=null);var f=$t(t);n=$t(n),a=$t(a),i=$t(i),o=Uv(o),s=Uv(s);var h=[],p=[],d=[];try{for(var m=fe(f),v=m.next();!v.done;v=m.next()){var g=v.value;h.push(g.sourceLayer),p.push(g.nodeIndex),d.push(g.tensorIndex)}}catch(w){c={error:w}}finally{try{v&&!v.done&&(l=m.return)&&l.call(m)}finally{if(c)throw c.error}}new mm({outboundLayer:this,inboundLayers:h,nodeIndices:p,tensorIndices:d,inputTensors:f,outputTensors:n,inputMasks:a,outputMasks:i,inputShapes:o,outputShapes:s},u);for(var y=0;y<n.length;y++)n[y].sourceLayer=this,n[y].nodeIndex=this.inboundNodes.length-1,n[y].tensorIndex=y},e.prototype.getConfig=function(){var t={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(t.batchInputShape=this.batchInputShape),this.dtype!=null&&(t.dtype=this.dtype),t},e.prototype.disposeWeights=function(){return this.weights.forEach(function(t){return t.dispose()}),this.weights.length},e.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Layer '".concat(this.name,"' is already disposed."))},e.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been ")+"built yet.");if(this._refCount===null)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used ")+"yet.");this.assertNotDisposed();var t=0;return--this._refCount===0&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}},e}(F.serialization.Serializable);function tke(r){var e,t;r=$t(r);var n=[];try{for(var a=fe(r),i=a.next();!i.done;i=a.next()){var o=i.value;n.push(o.shape)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return Un(n)}function rke(r){return"float32"}function YB(r,e,t){var n,a;if((e==null||t!=null&&t>0)&&(e=r.sourceLayer,t=r.nodeIndex),e.inboundNodes.length===0)return[r];var i=e.inboundNodes[t];if(i.inboundLayers.length===0)return i.inputTensors;for(var o=[],s=0;s<i.inboundLayers.length;s++){var u=i.inputTensors[s],c=i.inboundLayers[s],l=i.nodeIndices[s],f=YB(u,c,l);try{for(var h=(n=void 0,fe(f)),p=h.next();!p.done;p=h.next()){var d=p.value;o.indexOf(d)===-1&&o.push(d)}}catch(m){n={error:m}}finally{try{p&&!p.done&&(a=h.return)&&a.call(h)}finally{if(n)throw n.error}}}return o}function nke(r){var e,t,n=!0;try{for(var a=fe($t(r)),i=a.next();!i.done;i=a.next()){var o=i.value;if(!(o instanceof Oi)){n=!1;break}}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}function ake(r){var e,t,n=!0;try{for(var a=fe($t(r)),i=a.next();!i.done;i=a.next()){var o=i.value;if(o instanceof Oi){n=!1;break}}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}var rl=function(r){oe(e,r);function e(t){var n=r.call(this,{dtype:t.dtype,name:t.name!=null?t.name:sm("input").toString()})||this;if(t.batchSize==null&&(t.batchSize=null),t.sparse==null&&(t.sparse=!1),n.trainable=!1,n.built=!0,n.sparse=t.sparse,t.inputShape!=null&&t.batchInputShape!=null)throw new J("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=t.batchInputShape;if(a==null){if(t.inputShape==null)throw new J("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[t.batchSize].concat(t.inputShape)}else if(t.batchSize!=null)throw new J("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=t.dtype||"float32";n.batchInputShape=a,n.dtype=i,n.inputSpec=[{shape:a}];var o=new Oi(n.dtype,n.batchInputShape,n,[],{},n.name);return o.nodeIndex=0,o.tensorIndex=0,new mm({outboundLayer:n,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),n}return e.prototype.apply=function(t,n){throw new J("Cannot pass any input to an "+"InputLayer's apply() method. InputLayer name: ".concat(this.name))},e.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},e.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},e}(xt);rl.className="InputLayer";F.serialization.registerClass(rl);function JB(r){if(r.batchShape==null&&r.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(r.batchShape!=null&&r.shape!=null)throw new J("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var e=r.batchShape;r.shape!=null&&e==null&&(e=[null].concat(r.shape));var t=r.dtype;t==null&&(t="float32");var n=new rl({batchInputShape:e,name:r.name,dtype:t,sparse:r.sparse}),a=n.inboundNodes[0].outputTensors;return a[0]}function ike(r,e){if(r.dtype==null||r.dtype===e.dtype)return e;try{return F.cast(e,r.dtype)}catch{throw new J("The dtype of the feed (".concat(e.dtype,") can not be cast to the dtype ")+"of the key '".concat(r.name,"' (").concat(r.dtype,")."))}}var Kc=function(){function r(e){var t,n;if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof r)for(var a in e.id2Value)this.id2Value[a]=e.id2Value[a],a in e.id2Mask&&(this.id2Mask[a]=e.id2Mask[a]);else{if(e==null)return;try{for(var i=fe(e),o=i.next();!o.done;o=i.next()){var s=o.value;this.add(s.key,s.value)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}}return r.prototype.add=function(e,t,n){if(this.id2Value[e.id]==null)this.id2Value[e.id]=ike(e,t),this.name2Id[e.name]=e.id,n!=null&&(this.id2Mask[e.id]=n);else throw new J("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this},r.prototype.addFeed=function(e){this.add(e.key,e.value)},r.prototype.hasKey=function(e){return this.id2Value[e.id]!=null},r.prototype.names=function(){return Object.keys(this.name2Id)},r.prototype.getValue=function(e){if(e instanceof Oi){if(this.id2Value[e.id]==null)throw new J("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}else{var t=this.name2Id[e];if(t==null)throw new J("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}},r.prototype.getMask=function(e){if(e instanceof Oi){if(this.id2Value[e.id]==null)throw new J("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}else{var t=this.name2Id[e];if(t==null)throw new J("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}},r.prototype.disposeMasks=function(){this.id2Mask!=null&&F.dispose(this.id2Mask)},r}(),Gv=new qB,Hv=new qB;function oke(r){Gv?.setMaxEntries(r),Hv?.setMaxEntries(r)}function gh(r,e,t,n){var a,i,o,s,u=t==null?!1:t.training,c=Array.isArray(r),l=c?r:[r],f=l.map(function(le){return le.name}),h=[],p=e.names();try{for(var d=fe(f),m=d.next();!m.done;m=d.next()){var v=m.value;p.indexOf(v)!==-1?h.push(e.getValue(v)):h.push(null)}}catch(le){a={error:le}}finally{try{m&&!m.done&&(i=d.return)&&i.call(d)}finally{if(a)throw a.error}}n!=null&&(n.maxNumTensors=-1/0,n.minNumTensors=1/0);var g=f.join(",")+"|"+e.names().sort().join(","),y=Gv.get(g),w;if(y==null){var b=ske(l,e);y=b.sorted,w=b.recipientCounts,Gv.put(g,y),Hv.put(g,w)}w={},u||Object.assign(w,Hv.get(g));for(var x=new Kc(e),S=0;S<y.length;++S){if(n!=null){var T=F.memory().numTensors;T>n.maxNumTensors&&(n.maxNumTensors=T),T<n.minNumTensors&&(n.minNumTensors=T)}var E=y[S],C=E.sourceLayer;if(!(C instanceof rl)){var R=[],_=[],M=[],$=!1;try{for(var z=(o=void 0,fe(E.inputs)),q=z.next();!q.done;q=z.next()){var L=q.value,U=x.getValue(L),Y=x.getMask(L);R.push(U),_.push(Y),Y!=null&&($=!0),u||(w[L.name]--,w[L.name]===0&&!e.hasKey(L)&&f.indexOf(L.name)===-1&&!U.isDisposed&&L.sourceLayer.stateful!==!0&&M.push(U))}}catch(le){o={error:le}}finally{try{q&&!q.done&&(s=z.return)&&s.call(z)}finally{if(o)throw o.error}}$&&(t=t||{},t.mask=_[0]);var Z=$t(C.apply(R,t)),V=null;C.supportsMasking&&(V=C.computeMask(R,_));for(var X=cke(E),ne=Array.isArray(X)?X:[X],re=0;re<ne.length;++re){x.hasKey(ne[re])||x.add(ne[re],Z[re],Array.isArray(V)?V[0]:V);var se=f.indexOf(ne[re].name);se!==-1&&(h[se]=Z[re])}u||F.dispose(M)}}return x.disposeMasks(),c?h:h[0]}function ske(r,e){var t,n,a,i;F.util.assert(r!=null&&r.length>0,function(){return"Expected at least one fetch, got none"});var o=[],s={};if(r.length===1){var u=U4(r[0],e);o=u.sorted,s=u.recipientMap}else{var c=new Set;try{for(var l=fe(r),f=l.next();!f.done;f=l.next()){var h=f.value,p=U4(h,e),d=p.sorted,m=p.recipientMap;try{for(var v=(a=void 0,fe(d)),g=v.next();!g.done;g=v.next()){var y=g.value;c.has(y.name)||(o.push(y),c.add(y.name))}}catch(x){a={error:x}}finally{try{g&&!g.done&&(i=v.return)&&i.call(v)}finally{if(a)throw a.error}}var w=function(x){s[x]==null&&(s[x]=new Set),m[x].forEach(function(S){return s[x].add(S)})};for(var b in m)w(b)}}catch(x){t={error:x}}finally{try{f&&!f.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}}return{sorted:o,recipientCounts:uke(s)}}function uke(r){var e={};for(var t in r)e[t]=r[t].size;return e}function U4(r,e){var t,n,a,i,o=new Set,s=[],u={};try{for(var c=fe(e.names()),l=c.next();!l.done;l=c.next()){var f=l.value;o.add(f)}}catch(w){t={error:w}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}var h=[],p=[];for(h.push(r);h.length>0;){var d=h[h.length-1];if(o.has(d.name)){h.pop();continue}var m=p[p.length-1]===h.length-1;if(d.inputs.length===0||m)h.pop(),s.push(d),o.add(d.name),m&&p.pop();else{p.push(h.length-1);try{for(var v=(a=void 0,fe(d.inputs)),g=v.next();!g.done;g=v.next()){var y=g.value;u[y.name]==null&&(u[y.name]=new Set),u[y.name].add(d.name),!o.has(y.name)&&h.push(y)}}catch(w){a={error:w}}finally{try{g&&!g.done&&(i=v.return)&&i.call(v)}finally{if(a)throw a.error}}}}return{sorted:s,recipientMap:u}}function cke(r){var e,t,n;if(r.sourceLayer.inboundNodes.length===1)n=r.sourceLayer.output;else{for(var a=null,i=0;i<r.sourceLayer.inboundNodes.length;++i)try{for(var o=(e=void 0,fe(r.sourceLayer.inboundNodes[i].outputTensors)),s=o.next();!s.done;s=o.next()){var u=s.value;if(u.id===r.id){a=i;break}}}catch(c){e={error:c}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}n=r.sourceLayer.getOutputAt(a)}return n}var lke=F.env();lke.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",function(){return 100},oke);var ZB="Abs",fke="Acos",hke="Acosh",y1="Add",pke="AddN",dke="ArgMax",vke="ArgMin",mke="Asin",gke="Asinh",yke="Atan",bke="Atanh",wke="Atan2",xke="AvgPool",kke="AvgPoolGrad",Ske="AvgPool3D",Nke="AvgPool3DGrad",QB="BatchMatMul",eL="BatchToSpaceND",Tke="BroadcastTo",b1="Cast",Eke="Ceil",Ike="ClipByValue",Cke="Complex",tL="ComplexAbs",rL="Concat",nL="Conv2D",Ake="Conv2DBackpropFilter",aL="Conv2DBackpropInput",Dke="Conv3D",_ke="Conv3DBackpropFilterV2",Fke="Conv3DBackpropInputV2",iL="Cos",oL="Cosh",Rke="Cumprod",sL="Cumsum",Oke="DepthwiseConv2dNative",Pke="DepthwiseConv2dNativeBackpropFilter",Mke="DepthwiseConv2dNativeBackpropInput",Bke="Dilation2D",Lke="Dilation2DBackpropInput",qke="Dilation2DBackpropFilter",uL="RealDiv",zke="Elu",$ke="EluGrad",Wke="Erf",Uke="Equal",cL="Exp",lL="ExpandDims",Vke="Expm1",Gke="Fill",fL="Floor",hL="FloorDiv",Hke="FusedBatchNorm",pL="GatherV2",jke="Greater",dL="GreaterEqual",w1="Identity",Kke="Imag",Xke="IsFinite",Yke="IsInf",Jke="IsNan",Zke="LeakyRelu",Qke="Less",e2e="LessEqual",vL="Log",t2e="Log1p",r2e="LogicalAnd",n2e="LogicalNot",a2e="LogSoftmax",i2e="LRN",o2e="LRNGrad",s2e="Max",mL="Maximum",u2e="MaxPool",c2e="MaxPoolGrad",l2e="MaxPool3D",f2e="MaxPool3DGrad",h2e="Mean",p2e="Min",d2e="Minimum",v2e="MirrorPad",m2e="Mod",gL="Multiply",yL="Neg",g2e="OnesLike",y2e="OneHot",bL="Pack",wL="PadV2",xL="Pow",b2e="Prelu",w2e="Prod",x2e="Real",k2e="Reciprocal",S2e="Relu",kL="Reshape",N2e="ResizeNearestNeighbor",T2e="ResizeNearestNeighborGrad",E2e="ResizeBilinear",I2e="ResizeBilinearGrad",C2e="Relu6",SL="Reverse",A2e="Round",NL="Rsqrt",D2e="TensorScatterUpdate",TL="Select",_2e="Selu",EL="Slice",IL="Sin",CL="Sinh",F2e="Sign",AL="Sigmoid",R2e="Softplus",DL="Sqrt",_L="Sum",FL="SpaceToBatchND",RL="SplitV",O2e="Softmax",P2e="SquaredDifference",M2e="Square",OL="Sub",B2e="Tan",L2e="Tanh",x1="Tile",qv="Transpose",PL="Unpack",ML="UnsortedSegmentSum",BL="ZerosLike",LL="Step";var q2e=1e-7,z2e=1e-4,$2e=function(){function r(){}return r.prototype.refCount=function(e){return la("refCount")},r.prototype.incRef=function(e){return la("incRef")},r.prototype.timerAvailable=function(){return!0},r.prototype.time=function(e){return la("time")},r.prototype.read=function(e){return la("read")},r.prototype.readSync=function(e){return la("readSync")},r.prototype.readToGPU=function(e,t){return la("readToGPU")},r.prototype.numDataIds=function(){return la("numDataIds")},r.prototype.disposeData=function(e,t){return la("disposeData")},r.prototype.write=function(e,t,n){return la("write")},r.prototype.move=function(e,t,n,a,i){return la("move")},r.prototype.createTensorFromGPUData=function(e,t,n){return la("createTensorFromGPUData")},r.prototype.memory=function(){return la("memory")},r.prototype.floatPrecision=function(){return la("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?q2e:z2e},r.prototype.dispose=function(){return la("dispose")},r}();function la(r){throw new Error("'".concat(r,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function Ne(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function W2e(r,e,t){t===void 0&&(t=""),Ne(k1(r,e),function(){return t+" Shapes ".concat(r," and ").concat(e," must match")})}function to(r){if(r.length===0)return 1;for(var e=r[0],t=1;t<r.length;t++)e*=r[t];return e}function k1(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function jv(r){return r%1===0}function zv(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function Eu(r,e){var t=e.length;return r=r==null?e.map(function(n,a){return a}):[].concat(r),Ne(r.every(function(n){return n>=-t&&n<t}),function(){return"All values in axis param must be in range [-".concat(t,", ").concat(t,") but ")+"got axis ".concat(r)}),Ne(r.every(function(n){return jv(n)}),function(){return"All values in axis param must be integers but "+"got axis ".concat(r)}),r.map(function(n){return n<0?t+n:n})}function U2e(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else if(r==="string")t=new Array(e);else throw new Error("Unknown data type ".concat(r));return t}function V2e(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type ".concat(e," being uploaded contains ").concat(n,"."))}}function G2e(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function Xw(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype ".concat(r))}function H2e(r){if(r==null)return 0;var e=0;return r.forEach(function(t){return e+=t.length}),e}function S1(r){return typeof r=="string"||r instanceof String}function j2e(r){return typeof r=="boolean"}function K2e(r){return typeof r=="number"}function gm(r){return Array.isArray(r)?gm(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":K2e(r)?"float32":S1(r)?"string":j2e(r)?"bool":"float32"}function Yw(r){return!!(r&&r.constructor&&r.call&&r.apply)}function N1(r){var e=r.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=r[e-1];for(var n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function qL(r,e,t,n){n===void 0&&(n=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(n?2:1),o=0;o<i;o++)a[o]=t[r+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(l,f){return l*f})*(n?2:1),o=0;o<i;o++)a[o]=qL(r+o*u,s,t,n);return a}function V4(r,e,t){if(t===void 0&&(t=!1),r.length===0)return e[0];var n=r.reduce(function(a,i){return a*i})*(t?2:1);if(n===0)return[];if(n!==e.length)throw new Error("[".concat(r,"] does not match the input size ").concat(e.length).concat(t?" for a complex tensor":"","."));return qL(0,r,e,t)}function zL(r,e){for(var t=T1(r,e),n=0;n<t.length;n++)t[n]=1;return t}function T1(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error("Unknown data type ".concat(e))}function _h(r){r.forEach(function(e){Ne(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(r,"].")})})}function E1(r){return r&&r.then&&typeof r.then=="function"}var G4="tfjsflags",X2e=function(){function r(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Y2e,this.populateURLFlags()}return r.prototype.setPlatform=function(e,t){this.platform!=null&&(yr().getBool("IS_TEST")||yr().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t},r.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){var a=this.urlFlags[e];yr().getBool("IS_TEST")||yr().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(a,".")),this.set(e,a)}},r.prototype.getAsync=function(e){return Ce(this,void 0,void 0,function(){var t,n;return Ee(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,n=e,[4,this.evaluateFlag(e)]);case 1:return t[n]=a.sent(),[2,this.flags[e]]}})})},r.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(E1(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},r.prototype.getNumber=function(e){return this.get(e)},r.prototype.getBool=function(e){return this.get(e)},r.prototype.getString=function(e){return this.get(e)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!1,configurable:!0}),r.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},r.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()},r.prototype.setFlags=function(e){this.flags=Object.assign({},e)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if(G4 in t){var n=t[G4].split(",");n.forEach(function(a){var i=te(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=Z2e(o,s)})}}},r}();function Y2e(r){var e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];return J2e(e,n[0],n[1]),n.join("=")}),e}function J2e(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Z2e(r,e){var t=e.toLowerCase();return t==="true"||t==="false"?t==="true":"".concat(+t)===t?+t:e}function yr(){return $L}var $L=null;function Q2e(r){$L=r}var Ow;function WL(){if(Ow==null){var r=void 0;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");Ow=r}return Ow}function eSe(){var r=WL();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function I1(r,e){var t=eSe();if(t.has(r))return t.get(r);var n=e();return t.set(r,n),t.get(r)}function jc(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];yr().getBool("IS_TEST")||yr().getBool("PROD")||console.warn.apply(console,et([],te(r),!1))}var UL=I1("kernelRegistry",function(){return new Map}),Jw=I1("gradRegistry",function(){return new Map});function H4(r,e){var t=rSe(r,e);return UL.get(t)}function j4(r){return Jw.get(r)}function K4(r){for(var e=UL.entries(),t=[];;){var n=e.next(),a=n.done,i=n.value;if(a)break;var o=te(i,2),s=o[0],u=o[1],c=te(s.split("_"),1),l=c[0];l===r&&t.push(u)}return t}function tSe(r){var e=r.kernelName;Jw.has(e)&&yr().getBool("DEBUG")&&jc("Overriding the gradient for '".concat(e,"'")),Jw.set(e,r)}function rSe(r,e){return"".concat(e,"_").concat(r)}function nSe(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}var Iu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function aSe(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function iSe(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){if(this instanceof n){var a=[null];a.push.apply(a,arguments);var i=Function.bind.apply(e,a);return new i}return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var a=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,a.get?a:{enumerable:!0,get:function(){return r[n]}})}),t}var VL=or,ri=null;try{ri=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function or(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}or.prototype.__isLong__;Object.defineProperty(or.prototype,"__isLong__",{value:!0});function ha(r){return(r&&r.__isLong__)===!0}or.isLong=ha;var X4={},Y4={};function Cu(r,e){var t,n,a;return e?(r>>>=0,(a=0<=r&&r<256)&&(n=Y4[r],n)?n:(t=sr(r,(r|0)<0?-1:0,!0),a&&(Y4[r]=t),t)):(r|=0,(a=-128<=r&&r<128)&&(n=X4[r],n)?n:(t=sr(r,r<0?-1:0,!1),a&&(X4[r]=t),t))}or.fromInt=Cu;function ni(r,e){if(isNaN(r))return e?wu:ai;if(e){if(r<0)return wu;if(r>=GL)return KL}else{if(r<=-Z4)return fa;if(r+1>=Z4)return jL}return r<0?ni(-r,e).neg():sr(r%Qc|0,r/Qc|0,e)}or.fromNumber=ni;function sr(r,e,t){return new or(r,e,t)}or.fromBits=sr;var Kv=Math.pow;function C1(r,e,t){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return ai;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return C1(r.substring(1),e,t).neg();for(var a=ni(Kv(t,8)),i=ai,o=0;o<r.length;o+=8){var s=Math.min(8,r.length-o),u=parseInt(r.substring(o,o+s),t);if(s<8){var c=ni(Kv(t,s));i=i.mul(c).add(ni(u))}else i=i.mul(a),i=i.add(ni(u))}return i.unsigned=e,i}or.fromString=C1;function Bi(r,e){return typeof r=="number"?ni(r,e):typeof r=="string"?C1(r,e):sr(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}or.fromValue=Bi;var J4=1<<16,oSe=1<<24,Qc=J4*J4,GL=Qc*Qc,Z4=GL/2,Q4=Cu(oSe),ai=Cu(0);or.ZERO=ai;var wu=Cu(0,!0);or.UZERO=wu;var Xc=Cu(1);or.ONE=Xc;var HL=Cu(1,!0);or.UONE=HL;var Zw=Cu(-1);or.NEG_ONE=Zw;var jL=sr(-1,2147483647,!1);or.MAX_VALUE=jL;var KL=sr(-1,-1,!0);or.MAX_UNSIGNED_VALUE=KL;var fa=sr(0,-2147483648,!1);or.MIN_VALUE=fa;var Re=or.prototype;Re.toInt=function(){return this.unsigned?this.low>>>0:this.low};Re.toNumber=function(){return this.unsigned?(this.high>>>0)*Qc+(this.low>>>0):this.high*Qc+(this.low>>>0)};Re.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(fa)){var t=ni(e),n=this.div(t),a=n.mul(t).sub(this);return n.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=ni(Kv(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};Re.getHighBits=function(){return this.high};Re.getHighBitsUnsigned=function(){return this.high>>>0};Re.getLowBits=function(){return this.low};Re.getLowBitsUnsigned=function(){return this.low>>>0};Re.getNumBitsAbs=function(){if(this.isNegative())return this.eq(fa)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};Re.isZero=function(){return this.high===0&&this.low===0};Re.eqz=Re.isZero;Re.isNegative=function(){return!this.unsigned&&this.high<0};Re.isPositive=function(){return this.unsigned||this.high>=0};Re.isOdd=function(){return(this.low&1)===1};Re.isEven=function(){return(this.low&1)===0};Re.equals=function(e){return ha(e)||(e=Bi(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Re.eq=Re.equals;Re.notEquals=function(e){return!this.eq(e)};Re.neq=Re.notEquals;Re.ne=Re.notEquals;Re.lessThan=function(e){return this.comp(e)<0};Re.lt=Re.lessThan;Re.lessThanOrEqual=function(e){return this.comp(e)<=0};Re.lte=Re.lessThanOrEqual;Re.le=Re.lessThanOrEqual;Re.greaterThan=function(e){return this.comp(e)>0};Re.gt=Re.greaterThan;Re.greaterThanOrEqual=function(e){return this.comp(e)>=0};Re.gte=Re.greaterThanOrEqual;Re.ge=Re.greaterThanOrEqual;Re.compare=function(e){if(ha(e)||(e=Bi(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Re.comp=Re.compare;Re.negate=function(){return!this.unsigned&&this.eq(fa)?fa:this.not().add(Xc)};Re.neg=Re.negate;Re.add=function(e){ha(e)||(e=Bi(e));var t=this.high>>>16,n=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,p=0;return p+=i+c,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=n+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,sr(h<<16|p,l<<16|f,this.unsigned)};Re.subtract=function(e){return ha(e)||(e=Bi(e)),this.add(e.neg())};Re.sub=Re.subtract;Re.multiply=function(e){if(this.isZero())return ai;if(ha(e)||(e=Bi(e)),ri){var t=ri.mul(this.low,this.high,e.low,e.high);return sr(t,ri.get_high(),this.unsigned)}if(e.isZero())return ai;if(this.eq(fa))return e.isOdd()?fa:ai;if(e.eq(fa))return this.isOdd()?fa:ai;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(Q4)&&e.lt(Q4))return ni(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*l,p+=d>>>16,d&=65535,p+=i*l,h+=p>>>16,p&=65535,p+=o*c,h+=p>>>16,p&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=n*l+a*c+i*u+o*s,f&=65535,sr(p<<16|d,f<<16|h,this.unsigned)};Re.mul=Re.multiply;Re.divide=function(e){if(ha(e)||(e=Bi(e)),e.isZero())throw Error("division by zero");if(ri){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?ri.div_u:ri.div_s)(this.low,this.high,e.low,e.high);return sr(t,ri.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?wu:ai;var n,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return wu;if(e.gt(this.shru(1)))return HL;i=wu}else{if(this.eq(fa)){if(e.eq(Xc)||e.eq(Zw))return fa;if(e.eq(fa))return Xc;var o=this.shr(1);return n=o.div(e).shl(1),n.eq(ai)?e.isNegative()?Xc:Zw:(a=this.sub(e.mul(n)),i=n.add(a.div(e)),i)}else if(e.eq(fa))return this.unsigned?wu:ai;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=ai}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:Kv(2,s-48),c=ni(n),l=c.mul(e);l.isNegative()||l.gt(a);)n-=u,c=ni(n,this.unsigned),l=c.mul(e);c.isZero()&&(c=Xc),i=i.add(c),a=a.sub(l)}return i};Re.div=Re.divide;Re.modulo=function(e){if(ha(e)||(e=Bi(e)),ri){var t=(this.unsigned?ri.rem_u:ri.rem_s)(this.low,this.high,e.low,e.high);return sr(t,ri.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Re.mod=Re.modulo;Re.rem=Re.modulo;Re.not=function(){return sr(~this.low,~this.high,this.unsigned)};Re.and=function(e){return ha(e)||(e=Bi(e)),sr(this.low&e.low,this.high&e.high,this.unsigned)};Re.or=function(e){return ha(e)||(e=Bi(e)),sr(this.low|e.low,this.high|e.high,this.unsigned)};Re.xor=function(e){return ha(e)||(e=Bi(e)),sr(this.low^e.low,this.high^e.high,this.unsigned)};Re.shiftLeft=function(e){return ha(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?sr(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):sr(0,this.low<<e-32,this.unsigned)};Re.shl=Re.shiftLeft;Re.shiftRight=function(e){return ha(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?sr(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):sr(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Re.shr=Re.shiftRight;Re.shiftRightUnsigned=function(e){if(ha(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var n=this.low;return sr(n>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?sr(t,0,this.unsigned):sr(t>>>e-32,0,this.unsigned)};Re.shru=Re.shiftRightUnsigned;Re.shr_u=Re.shiftRightUnsigned;Re.toSigned=function(){return this.unsigned?sr(this.low,this.high,!1):this};Re.toUnsigned=function(){return this.unsigned?this:sr(this.low,this.high,!0)};Re.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Re.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Re.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};or.fromBytes=function(e,t,n){return n?or.fromBytesLE(e,t):or.fromBytesBE(e,t)};or.fromBytesLE=function(e,t){return new or(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};or.fromBytesBE=function(e,t){return new or(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var XL=aSe(VL),sSe=Exe({__proto__:null,default:XL},[VL]),uSe=XL||sSe;function A1(r){return uSe.fromString(r,!0,16)}A1("c3a5c85c97cb3127");A1("b492b66fbe98f273");A1("9ae16a3b2f90404f");function cSe(r,e){return r instanceof Float32Array&&e==="float32"||r instanceof Int32Array&&e==="int32"||r instanceof Uint8Array&&e==="bool"}function YL(r,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=kh(r)),yr().getBool("DEBUG")&&V2e(r,e),cSe(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){for(var t=new Uint8Array(r.length),n=0;n<t.length;++n)Math.round(r[n])!==0&&(t[n]=1);return t}else throw new Error("Unknown data type ".concat(e))}function Xv(){return yr().platform.now()}function lSe(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",yr().platform.encode(r,e)}function eB(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",yr().platform.decode(r,e)}function ii(r){return yr().platform.isTypedArray!=null?yr().platform.isTypedArray(r):nSe(r)}function kh(r,e,t){var n,a;if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),typeof r=="boolean"||typeof r=="number"||typeof r=="string"||E1(r)||r==null||ii(r)&&t)e.push(r);else if(Array.isArray(r)||ii(r))for(var i=0;i<r.length;++i)kh(r[i],e,t);else{var o=-1;try{for(var s=fe(Object.keys(r)),u=s.next();!u.done;u=s.next()){var c=u.value;/^([1-9]+[0-9]*|0)$/.test(c)&&(o=Math.max(o,Number(c)))}}catch(l){n={error:l}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}for(var i=0;i<=o;i++)kh(r[i],e,t)}return e}var fSe=function(){function r(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new pSe)}return r.prototype.profileKernel=function(e,t,n){var a,i,o,s=function(){o=n()},u,c=Xv();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var l=fe(o),f=l.next();!f.done;f=l.next()){var h=f.value;h.dataSync()}}catch(v){a={error:v}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:Xv()-c})}if(yr().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var p=function(v){var g=o[v];g.data().then(function(y){hSe(y,g.dtype,e)})},d=0;d<o.length;d++)p(d);var m={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(v){return v.kernelMs}),extraInfo:u.then(function(v){return v.getExtraProfileInfo!=null?v.getExtraProfileInfo():""})};return m},r.prototype.logKernelProfile=function(e){var t=this,n=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(c){t.logger.logKernelProfile(n,u,c[0],c[1],o,c[2])})})},r}();function hSe(r,e,t){if(e!=="float32")return!1;for(var n=0;n<r.length;n++){var a=r[n];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(t,"'")),!0}return!1}var pSe=function(){function r(){}return r.prototype.logKernelProfile=function(e,t,n,a,i,o){var s=typeof a=="number"?zv("".concat(a,"ms"),9):a.error,u=zv(e,25),c=t.rank,l=t.size,f=zv(t.shape.toString(),14),h="";for(var p in i){var d=i[p];if(d!=null){var m=d.shape||t.shape,v=m.length;h+="".concat(p,": ").concat(v,"D ").concat(v>0?m:""," ")}}console.log("%c".concat(u,"	%c").concat(s,"	%c").concat(c,"D ").concat(f,"	%c").concat(l,"	%c").concat(h,"	%c").concat(o),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r}();function dSe(r,e,t){for(var n={},a={},i=0;i<e.length;i++)n[e[i].id]=!0;for(var i=0;i<r.length;i++){var o=r[i],s=o.inputs;for(var u in s){for(var c=s[u],l=!1,f=0;f<e.length;f++)if(n[c.id]){o.outputs.forEach(function(w){return n[w.id]=!0}),l=!0,a[o.id]=!0;break}if(l)break}}var h={};h[t.id]=!0;for(var p={},i=r.length-1;i>=0;i--)for(var o=r[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,p[o.id]=!0;break}for(var d=[],i=0;i<r.length;i++){var o=r[i];if(a[o.id]&&p[o.id]){var m={};for(var u in o.inputs){var v=o.inputs[u];n[v.id]&&(m[u]=v)}var g=Object.assign({},o);g.inputs=m,g.outputs=o.outputs,d.push(g)}}return d}function vSe(r,e,t,n){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var p=r[h.id];p!=null?u.push(p):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(s.kernelName,"."));var c=s.gradient(u),l=function(h){if(!(h in c))throw new Error("Cannot backprop through input ".concat(h,". ")+"Available gradients found: ".concat(Object.keys(c),"."));var p=t(function(){return c[h]()});if(p.dtype!=="float32")throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"".concat(h," must have 'float32' dtype, but has '").concat(p.dtype,"'"));var d=s.inputs[h];if(!k1(p.shape,d.shape))throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"'".concat(h,"' has shape '").concat(p.shape,"', which does not match ")+"the shape of the input '".concat(d.shape,"'"));if(r[d.id]==null)r[d.id]=p;else{var m=r[d.id];r[d.id]=n(m,p),m.dispose()}};for(var f in s.inputs)l(f)},i=e.length-1;i>=0;i--)a(i)}var tB=20,lh=3,Pw=7;function mSe(r,e,t,n){var a=N1(e),i=gSe(r,e,t,a),o=e.length,s=$v(r,e,t,a,i),u=["Tensor"];return n&&(u.push("  dtype: ".concat(t)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(e,"]")),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function gSe(r,e,t,n){var a=to(e),i=n[n.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?bh(r):r;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,f=0;f<i;f++)o[f]=Math.max(o[f],yh(u[l+f],0,t).length);return o}function yh(r,e,t){var n;return Array.isArray(r)?n="".concat(parseFloat(r[0].toFixed(Pw))," + ")+"".concat(parseFloat(r[1].toFixed(Pw)),"j"):S1(r)?n="'".concat(r,"'"):t==="bool"?n=JL(r):n=parseFloat(r.toFixed(Pw)).toString(),zv(n,e)}function JL(r){return r===0?"false":"true"}function $v(r,e,t,n,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var c=bh(r);return[yh(c[0],0,t)]}return t==="bool"?[JL(r[0])]:[r[0].toString()]}if(u===1){if(s>tB){var l=lh*o,f=Array.from(r.slice(0,l)),h=Array.from(r.slice((s-lh)*o,s*o));return t==="complex64"&&(f=bh(f),h=bh(h)),["["+f.map(function(T,E){return yh(T,a[E],t)}).join(", ")+", ..., "+h.map(function(T,E){return yh(T,a[s-lh+E],t)}).join(", ")+"]"]}var p=t==="complex64"?bh(r):Array.from(r);return["["+p.map(function(T,E){return yh(T,a[E],t)}).join(", ")+"]"]}var d=e.slice(1),m=n.slice(1),v=n[0]*o,g=[];if(s>tB){for(var y=0;y<lh;y++){var w=y*v,b=w+v;g.push.apply(g,et([],te($v(r.slice(w,b),d,t,m,a,!1)),!1))}g.push("...");for(var y=s-lh;y<s;y++){var w=y*v,b=w+v;g.push.apply(g,et([],te($v(r.slice(w,b),d,t,m,a,y===s-1)),!1))}}else for(var y=0;y<s;y++){var w=y*v,b=w+v;g.push.apply(g,et([],te($v(r.slice(w,b),d,t,m,a,y===s-1)),!1))}var x=u===2?",":"";g[0]="["+(s>0?g[0]+x:"");for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+x;for(var S=`,
`,y=2;y<u;y++)S+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":S),g}function bh(r){for(var e=[],t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}(function(){function r(e,t,n){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=to(e),n!=null){var i=n.length;Ne(i===this.size,function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||U2e(t,this.size),this.strides=N1(e)}return r.prototype.set=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];n.length===0&&(n=[0]),Ne(n.length===this.rank,function(){return"The number of provided coordinates (".concat(n.length,") must ")+"match the rank (".concat(t.rank,")")});var i=this.locToIndex(n);this.values[i]=e},r.prototype.get=function(){for(var e,t,n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];n.length===0&&(n=[0]);var i=0;try{for(var o=fe(n),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var c="Requested out of range element at ".concat(n,". ")+"  Buffer shape=".concat(this.shape);throw new Error(c)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var l=n[n.length-1],f=0;f<n.length-1;++f)l+=this.strides[f]*n[f];return this.values[l]},r.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},r.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),r.prototype.toTensor=function(){return Ci().makeTensor(this.values,this.shape,this.dtype)},r})();var Ci=null,fh=null;function ySe(r){Ci=r}var Ai=function(){function r(e,t,n,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=to(e),this.strides=N1(e),this.dataId=n,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),r.prototype.buffer=function(){return Ce(this,void 0,void 0,function(){var e;return Ee(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,fh.buffer(this.shape,this.dtype,e)]}})})},r.prototype.bufferSync=function(){return fh.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return Ce(this,void 0,void 0,function(){var e;return Ee(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,V4(this.shape,e,this.dtype==="complex64")]}})})},r.prototype.arraySync=function(){return V4(this.shape,this.dataSync(),this.dtype==="complex64")},r.prototype.data=function(){return Ce(this,void 0,void 0,function(){var e,t;return Ee(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=Ci().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(a){return eB(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}})})},r.prototype.dataToGPU=function(e){return this.throwIfDisposed(),Ci().readToGPU(this.dataId,e)},r.prototype.dataSync=function(){this.throwIfDisposed();var e=Ci().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return eB(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},r.prototype.bytes=function(){return Ce(this,void 0,void 0,function(){var e;return Ee(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,Ci().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Ci().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!1,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.print=function(e){return e===void 0&&(e=!1),fh.print(this,e)},r.prototype.clone=function(){return this.throwIfDisposed(),fh.clone(this)},r.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return mSe(t,this.shape,this.dtype,e)},r.prototype.cast=function(e){return this.throwIfDisposed(),fh.cast(this,e)},r.prototype.variable=function(e,t,n){return e===void 0&&(e=!0),this.throwIfDisposed(),Ci().makeVariable(this,e,t,n)},r}();Object.defineProperty(Ai,Symbol.hasInstance,{value:function(r){return!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null}});function ZL(){return I1("Tensor",function(){return Ai})}ZL();var Yv=function(r){oe(e,r);function e(t,n,a,i){var o=r.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=n,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(t.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!k1(t.shape,this.shape))throw new Error("shape of the new value (".concat(t.shape,") and ")+"previous value (".concat(this.shape,") must match"));Ci().disposeTensor(this),this.dataId=t.dataId,Ci().incRef(this,null)},e.prototype.dispose=function(){Ci().disposeVariable(this),this.isDisposedInternal=!0},e}(Ai);Object.defineProperty(Yv,Symbol.hasInstance,{value:function(r){return r instanceof Ai&&r.assign!=null&&r.assign instanceof Function}});var rB;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(rB||(rB={}));var Qw;(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(Qw||(Qw={}));var e1;(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(e1||(e1={}));var t1;(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(t1||(t1={}));var r1;(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(r1||(r1={}));var bSe={float32:t1,int32:Qw,bool:e1,complex64:r1};function wSe(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error("Can not upcast ".concat(r," with ").concat(e))}return bSe[r][e]}function QL(r){return r!=null&&typeof r=="object"&&"texture"in r&&r.texture instanceof WebGLTexture}function eq(r){return typeof GPUBuffer<"u"&&r!=null&&typeof r=="object"&&"buffer"in r&&r.buffer instanceof GPUBuffer}function Oa(r,e){if(r.dtype===e.dtype)return[r,e];var t=wSe(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function tq(r){var e=[],t=new Set;return rq(r,e,t),e}function rq(r,e,t){if(r!=null){if(r instanceof Ai){e.push(r);return}if(!!xSe(r)){var n=r;for(var a in n){var i=n[a];t.has(i)||(t.add(i),rq(i,e,t))}}}}function xSe(r){return Array.isArray(r)||typeof r=="object"}function Mw(r){return r.kernelName!=null}var nB=function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return r.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},r}(),D1=function(){function r(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new nB}return r.prototype.ready=function(){return Ce(this,void 0,void 0,function(){var e,t,n,a;return Ee(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(n)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,n=e.asyncInit;if(n)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!1,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},r.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},r.prototype.registerBackend=function(e,t,n){return n===void 0&&(n=1),e in this.registryFactory?(jc("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},r.prototype.setBackend=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o;return Ee(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '".concat(e,"' not found in registry"));return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,a=t.asyncInit,a?[4,n]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=n,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new fSe(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var e=this,t=K4(this.backendName);t.forEach(function(n){n.setupFunc!=null&&n.setupFunc(e.backendInstance)})},r.prototype.disposeRegisteredKernels=function(e){var t=this,n=K4(e);n.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},r.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(n==null)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var a=n.factory();if(a&&!(a instanceof $2e)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,jc("Initialization of backend ".concat(e," failed")),jc(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return jc("Initialization of backend ".concat(e," failed")),jc(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],a=this.initializeBackend(n),i=a.success,o=a.asyncInit;if(o||i)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),a=n.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(e,t){var n=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return n.startScope(a)},function(){return n.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},r.prototype.scopedRun=function(e,t,n){e();try{var a=n();return t(),a}catch(i){throw t(),i}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(e){var t=ve.runKernel(w1,{x:e}),n={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},c={dtype:s};return ve.runKernel(b1,u,c)}}},i=[];return this.addTapeNode(this.state.activeScope.name,n,[t],a,i,{}),t},r.prototype.runKernel=function(e,t,n){this.backendName==null&&this.backend;var a=H4(e,this.backendName)!=null;if(!a)throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(e,t,n){var a=this.backend.numDataIds(),i=0;n.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(s," data ids) after running '").concat(e,"'"))},r.prototype.runKernelFunc=function(e){var t=this,n,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var c,l=Mw(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Mw(e)){var f=e.kernelName,h=e.inputs,p=e.attrs;this.backendName==null&&this.backend;var d=H4(f,this.backendName);Ne(d!=null,function(){return"Cannot find registered kernel '".concat(f,"' for backend '").concat(t.backendName,"'")}),u=function(){var x=t.backend.numDataIds();c=d.kernelFunc({inputs:h,attrs:p,backend:t.backend});var S=Array.isArray(c)?c:[c];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,x,S);var T=S.map(function(C){return C.rank!=null?C:t.makeTensorFromTensorInfo(C)});if(i){var E=t.getTensorsForGradient(f,h,T);a=t.saveTensorsForBackwardMode(E)}return T}}else{var m=e.forwardFunc,v=function(x){!i||(a=x.map(function(S){return t.keep(t.clone(S))}))};u=function(){var x=t.backend.numDataIds();c=t.tidy(function(){return m(t.backend,v)});var S=Array.isArray(c)?c:[c];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(l,x,S),S}}var g=e.inputs,y=e.attrs,w=Mw(e)?null:e.backwardsFunc,b;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?n=u():(b=t.profiler.profileKernel(l,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(b),n=b.outputs)}),i&&this.addTapeNode(l,g,n,w,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(x){return g[x]!=null?g[x].shape:null}),outputShapes:n.map(function(x){return x.shape}),kernelTimeMs:b.timeMs,extraInfo:b.extraInfo}),Array.isArray(c)?n:n[0]},r.prototype.saveTensorsForBackwardMode=function(e){var t=this,n=e.map(function(a){return t.keep(t.clone(a))});return n},r.prototype.getTensorsForGradient=function(e,t,n){var a=j4(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(Ne(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(c){return t[c]})):s=i.map(function(c){return t[c]});var u=n.filter(function(c,l){return o[l]});return s.concat(u)}return[]},r.prototype.makeTensor=function(e,t,n,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",a=a||this.backend;var i=e;n==="string"&&S1(e[0])&&(i=e.map(function(l){return lSe(l)}));var o=a.write(i,t,n),s=new Ai(t,n,o,this.nextTensorId());if(this.trackTensor(s,a),n==="string"){var u=this.state.tensorInfo.get(o),c=H2e(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},r.prototype.makeTensorFromDataId=function(e,t,n,a){n=n||"float32";var i={dataId:e,shape:t,dtype:n};return this.makeTensorFromTensorInfo(i,a)},r.prototype.makeTensorFromTensorInfo=function(e,t){var n=e.dataId,a=e.shape,i=e.dtype,o=new Ai(a,i,n,this.nextTensorId());return this.trackTensor(o,t),o},r.prototype.makeVariable=function(e,t,n,a){t===void 0&&(t=!0),n=n||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new Yv(e,t,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name ".concat(i.name," was already registered"));return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},r.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*Xw(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof Yv||this.track(e)},r.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},r.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},r.prototype.disposeTensor=function(e){if(!!this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var n=e.size*Xw(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},r.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},r.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},r.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},r.prototype.profile=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h;return Ee(this,function(p){switch(p.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=p.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,et([],te(this.state.activeProfile.kernels.map(function(d){return d.totalBytesSnapshot})),!1)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,p.label=2;case 2:p.trys.push([2,8,9,10]),i=fe(this.state.activeProfile.kernels),o=i.next(),p.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=p.sent(),c=s,[4,s.extraInfo];case 5:c.extraInfo=p.sent(),p.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return l=p.sent(),f={error:l},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(e,t,n,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},c=j4(e);c!=null&&(a=c.gradFunc),a!=null&&(u.gradient=function(l){return l=l.map(function(f,h){if(f==null){var p=n[h],d=T1(p.size,p.dtype);return s.makeTensor(d,p.shape,p.dtype)}return f}),a(l.length>1?l:l[0],i,o)}),this.state.activeTape.push(u)},r.prototype.keep=function(e){return e.kept=!0,e},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(e){for(var t=this,n=tq(e),a=new Set(n.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},r.prototype.gradients=function(e,t,n,a){var i=this;if(a===void 0&&(a=!1),Ne(t.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});Ne(o instanceof Ai,function(){return"The result y returned by f() must be a tensor."});var s=dSe(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=n??kSe(o.shape),vSe(u,s,function(l){return i.tidy(l)},NSe);var c=t.map(function(l){return u[l.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(l){var f,h;try{for(var p=fe(l.saved),d=p.next();!d.done;d=p.next()){var m=d.value;m.dispose()}}catch(v){f={error:v}}finally{try{d&&!d.done&&(h=p.return)&&h.call(p)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:c}})},r.prototype.customGrad=function(e){var t=this;return Ne(Yw(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];Ne(n.every(function(c){return c instanceof Ai}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};n.forEach(function(c,l){o[l]=c});var s=function(c,l){return i=e.apply(void 0,et([],te(et(et([],te(n),!1),[l],!1)),!1)),Ne(i.value instanceof Ai,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),Ne(Yw(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(c,l){var f=i.gradFunc(c,l),h=Array.isArray(f)?f:[f];Ne(h.length===n.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),Ne(h.every(function(d){return d instanceof Ai}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return h.forEach(function(d,m){p[m]=function(){return d}}),p};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},r.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},r.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},r.prototype.readToGPU=function(e,t){var n=this.state.tensorInfo.get(e);return n.backend.readToGPU(e,t)},r.prototype.time=function(e){return Ce(this,void 0,void 0,function(){var t,n;return Ee(this,function(a){switch(a.label){case 0:return t=Xv(),[4,this.backend.time(e)];case 1:return n=a.sent(),n.wallMs=Xv()-t,[2,n]}})})},r.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!1,configurable:!0}),r.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new nB;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r}();D1.nextTensorId=0;D1.nextVariableId=0;function kSe(r){var e=zL(to(r),"float32");return ve.makeTensor(e,r,"float32")}function SSe(){var r=WL();if(r._tfengine==null){var e=new X2e(r);r._tfengine=new D1(e)}return Q2e(r._tfengine.ENV),ySe(function(){return r._tfengine}),r._tfengine}var ve=SSe();function NSe(r,e){var t={a:r,b:e};return ve.runKernel(y1,t)}function TSe(r,e){var t=r;if(ii(r))return e==="string"?[]:[r.length];if(QL(r)){var n=r.channels||"RGBA";return[r.height,r.width*n.length]}else if(eq(r))return[r.buffer.size/(e==null?4:Xw(e))];if(!Array.isArray(r))return[];for(var a=[];Array.isArray(t)||ii(t)&&e!=="string";)a.push(t.length),t=t[0];return Array.isArray(r)&&yr().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&nq(r,a,[]),a}function nq(r,e,t){if(t=t||[],!Array.isArray(r)&&!ii(r)){Ne(e.length===0,function(){return"Element arr[".concat(t.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(e[0]," elements")});return}Ne(e.length>0,function(){return"Element arr[".concat(t.join("]["),"] should be a primitive, ")+"but is an array of ".concat(r.length," elements")}),Ne(r.length===e[0],function(){return"Element arr[".concat(t.join("]["),"] should have ").concat(e[0]," ")+"elements, but has ".concat(r.length," elements")});for(var n=e.slice(1),a=0;a<r.length;++a)nq(r[a],n,t.concat(a))}function aB(r,e,t,n){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==e||r==="numeric"&&e==="string")throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must ")+"be ".concat(r," tensor, but got ").concat(e," tensor"))}}function Ie(r,e,t,n){if(n===void 0&&(n="numeric"),r instanceof ZL())return aB(n,r.dtype,e,t),r;var a=gm(r);if(a!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(a=n),aB(n,a,e,t),r==null||!ii(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var i=r==null?"null":r.constructor.name;throw new Error("Argument '".concat(e,"' passed to '").concat(t,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=TSe(r,a);!ii(r)&&!Array.isArray(r)&&(r=[r]);var s=!0,u=a!=="string"?YL(r,a):kh(r,[],s);return ve.makeTensor(u,o,a)}function aq(r,e,t,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument ".concat(e," passed to ").concat(t," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=r;return a.map(function(i,o){return Ie(i,"".concat(e,"[").concat(o,"]"),t,n)})}var ESe="__op";function He(r){var e=Object.keys(r);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(e.length," keys."));var t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+ESe;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];ve.startScope(t);try{var s=n.apply(void 0,et([],te(i),!1));return E1(s)&&console.error("Cannot return a Promise inside of tidy."),ve.endScope(s),s}catch(u){throw ve.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function ISe(r,e){var t=Ie(r,"x","cast");if(!G2e(e))throw new Error("Failed to cast to unknown dtype ".concat(e));if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var n={x:t},a={dtype:e};return ve.runKernel(b1,n,a)}var At=He({cast_:ISe});function CSe(r,e){var t,n=Ie(r,"a","mul"),a=Ie(e,"b","mul");t=te(Oa(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ve.runKernel(gL,i)}var be=He({mul_:CSe});function ASe(r,e){e===void 0&&(e=0);var t=Ie(r,"x","step"),n={x:t},a={alpha:e};return ve.runKernel(LL,n,a)}var _1=He({step_:ASe}),iq={kernelName:ZB,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(r,_1(At(n,"float32"),-1))}}}};function DSe(r,e){var t,n=Ie(r,"a","floorDiv"),a=Ie(e,"b","floorDiv");t=te(Oa(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ve.runKernel(hL,i)}var _Se=He({floorDiv_:DSe});function FSe(r,e){var t,n=Ie(r,"a","div"),a=Ie(e,"b","div");if(t=te(Oa(n,a),2),n=t[0],a=t[1],n.dtype==="int32"&&a.dtype==="int32")return _Se(n,a);var i={a:n,b:a},o={};return ve.runKernel(uL,i,o)}var Wt=He({div_:FSe});function RSe(r){var e=Ie(r,"x","neg"),t={x:e};return ve.runKernel(yL,t)}var si=He({neg_:RSe});function OSe(r,e,t,n){if(n==null)n=gm(r);else if(n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(eq(r)||QL(r)){if(n!=="float32"&&n!=="int32")throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(n,"."));return ve.backend.createTensorFromGPUData(r,e||t,n)}if(!ii(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){_h(e);var a=to(e),i=to(t);Ne(a===i,function(){return"Based on the provided shape, [".concat(e,"], the tensor should have ")+"".concat(a," values but has ").concat(i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==to(e.slice(o)):!0;Ne(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(t,") does not match the provided ")+"shape (".concat(e,"). ")})}}return!ii(r)&&!Array.isArray(r)&&(r=[r]),e=e||t,r=n!=="string"?YL(r,n):kh(r,[],!0),ve.makeTensor(r,e,n)}function Or(r,e){if((ii(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&ii(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],n=[];return OSe(r,t,n,e)}function PSe(r){var e=Ie(r,"x","sqrt","float32"),t={x:e};return ve.runKernel(DL,t)}var Pi=He({sqrt_:PSe});function MSe(r){var e=Ie(r,"x","square"),t={};return ve.runKernel("Square",{x:e},t)}var Pr=He({square_:MSe});function BSe(r,e){var t,n=Ie(r,"a","sub"),a=Ie(e,"b","sub");t=te(Oa(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ve.runKernel(OL,i)}var mn=He({sub_:BSe}),LSe={kernelName:fke,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){var a=Pr(At(n,"float32")),i=Pi(mn(Or(1),a));return si(Wt(r,i))}}}},qSe={kernelName:hke,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){var a=Pi(mn(Pr(At(n,"float32")),1));return Wt(r,a)}}}};function gn(r,e){for(var t=[],n=0;n<e.length;n++){var a=r[r.length-n-1],i=e.length-n-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function Nn(r,e){for(var t=Math.max(r.length,e.length),n=new Array(t),a=0;a<t;a++){var i=r[r.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)n[t-a-1]=o;else if(o===1)n[t-a-1]=i;else if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(r," and ").concat(e,".");throw Error(s)}else n[t-a-1]=i}return n}function zSe(r,e){var t=Ie(r,"x","reshape","string_or_numeric"),n={x:t},a={shape:e};return ve.runKernel(kL,n,a)}var tt=He({reshape_:zSe});function $Se(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=Ie(r,"x","sum");n.dtype==="bool"&&(n=At(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return ve.runKernel(_L,a,i)}var Ar=He({sum_:$Se}),WSe={kernelName:y1,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=Nn(n.shape,a.shape),o=function(){var u=r,c=gn(n.shape,i);return c.length>0&&(u=Ar(u,c)),tt(u,n.shape)},s=function(){var u=r,c=gn(a.shape,i);return c.length>0&&(u=Ar(u,c)),tt(u,a.shape)};return{a:o,b:s}}};var USe={kernelName:pke,saveAllInputs:!0,gradFunc:function(r,e){var t={};return e.forEach(function(n,a){t[a]=function(){return r.clone()}}),t}};function VSe(r){var e=Ie(r,"x","zerosLike"),t={x:e};return ve.runKernel(BL,t)}var Bt=He({zerosLike_:VSe}),GSe={kernelName:dke,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Bt(n)}}}},HSe={kernelName:vke,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Bt(n)}}}},jSe={kernelName:mke,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Wt(r,Pi(mn(Or(1),Pr(At(n,"float32")))))}}}};function KSe(r,e){var t,n=Ie(r,"a","add"),a=Ie(e,"b","add");t=te(Oa(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ve.runKernel(y1,i)}var It=He({add_:KSe}),XSe={kernelName:gke,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){var a=Pi(It(Or(1),Pr(At(n,"float32"))));return Wt(r,a)}}}},YSe={kernelName:wke,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=Nn(n.shape,a.shape),o=function(){var u=It(Pr(n),Pr(a)),c=be(r,Wt(a,u)),l=gn(n.shape,i);return l.length>0&&(c=Ar(c,l)),tt(c,n.shape)},s=function(){var u=It(Pr(n),Pr(a)),c=si(be(r,Wt(n,u))),l=gn(a.shape,i);return l.length>0&&(c=Ar(c,l)),tt(c,a.shape)};return{a:o,b:s}}},JSe={kernelName:yke,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Wt(r,It(Pr(At(n,"float32")),1))}}}},ZSe={kernelName:bke,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Wt(r,mn(Or(1),Pr(At(n,"float32"))))}}}};function oq(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function Sh(r){var e=te(oq(r),3),t=e[0],n=e[1],a=e[2];return t===1&&n===1&&a===1}function sq(r,e){return Sh(r)||Sh(e)}function iB(r){return oq(r).every(function(e){return e>0})}function Au(r,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,"."));if(typeof e=="number")Ne(jv(e),function(){return"Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,".")});else if(typeof e=="object")e.forEach(function(n){n.forEach(function(a){Ne(jv(a),function(){return"Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(a,".")})})});else throw Error("Error in ".concat(r,": Unknown padding parameter: ").concat(e))}}function QSe(r,e,t,n,a,i){var o=Ie(r,"dy","avgPool3dGrad"),s=Ie(e,"input","avgPool3dGrad"),u=o,c=s,l=!1;s.rank===4&&(l=!0,u=tt(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=tt(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),Ne(u.rank===5,function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank "+"".concat(u.rank,".")}),Ne(c.rank===5,function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank "+"".concat(c.rank,".")}),Au("avgPool3dGrad",a,i);var f={dy:u,input:c},h={filterSize:t,strides:n,pad:a,dimRoundingMode:i},p=ve.runKernel(Nke,f,h);return l?tt(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var eNe=He({avgPool3dGrad_:QSe}),tNe={kernelName:Ske,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.filterSize,o=t.strides,s=t.pad,u=t.dimRoundingMode;return{x:function(){return eNe(r,a,i,o,s,u)}}}};function rNe(r,e,t,n,a){var i=Ie(r,"dy","avgPoolGrad"),o=Ie(e,"input","avgPoolGrad");Ne(o.rank===i.rank,function(){return"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")});var s=o,u=i,c=!1;o.rank===3&&(c=!0,s=tt(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=tt(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Ne(u.rank===4,function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank "+"".concat(u.rank,".")}),Ne(s.rank===4,function(){return"Error in avgPoolGrad: input must be rank 4 but got rank "+"".concat(s.rank,".")});var l={dy:u,input:s},f={filterSize:t,strides:n,pad:a},h=ve.runKernel(kke,l,f);return c?tt(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var nNe=He({avgPoolGrad_:rNe}),aNe={kernelName:xke,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.filterSize,o=t.strides,s=t.pad;return{x:function(){return nNe(r,a,i,o,s)}}}};function iNe(r,e,t,n){var a;t===void 0&&(t=!1),n===void 0&&(n=!1);var i=Ie(r,"a","matMul"),o=Ie(e,"b","matMul");a=te(Oa(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:n};return ve.runKernel(QB,s,u)}var ds=He({matMul_:iNe}),oNe={kernelName:QB,inputsToSave:["a","b"],gradFunc:function(r,e,t){var n=te(e,2),a=n[0],i=n[1],o=t.transposeA,s=t.transposeB;return!o&&!s?{a:function(){return ds(r,i,!1,!0)},b:function(){return ds(a,r,!0,!1)}}:!o&&s?{a:function(){return ds(r,i,!1,!1)},b:function(){return ds(r,a,!0,!1)}}:o&&!s?{a:function(){return ds(i,r,!1,!0)},b:function(){return ds(a,r,!1,!1)}}:{a:function(){return ds(i,r,!0,!0)},b:function(){return ds(r,a,!0,!0)}}}};function sNe(r,e,t){var n=Ie(r,"x","spaceToBatchND");Ne(n.rank>=1+e.length,function(){return"input rank ".concat(n.rank," should be > than [blockShape] ").concat(e.length)}),Ne(t.length===e.length,function(){return"paddings.shape[0] ".concat(t.length," must be equal to [blockShape] ").concat(e.length)}),Ne(n.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions ".concat(n.shape.slice(1)," with paddings ").concat(t.toString()," must be divisible by blockShapes ").concat(e.toString())});var a={x:n},i={blockShape:e,paddings:t};return ve.runKernel(FL,a,i)}var uNe=He({spaceToBatchND_:sNe});var cNe={kernelName:eL,gradFunc:function(r,e,t){var n=t.blockShape,a=t.crops;return{x:function(){return uNe(r,n,a)}}}};var lNe={kernelName:Tke,gradFunc:function(r,e,t){for(var n=t,a=n.inputShape,i=n.shape,o=Array.from(i),s=a.length-1;s>=0;s--)if(a[s]===i[s])o[s]=1;else if(a[s]!==1)throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(i,"]."));for(var u=[],s=0;s<o.length;s++)o[s]>1&&u.push(s);return{x:function(){return Ar(r,u,!0)}}}};var fNe={kernelName:b1,gradFunc:function(r){return{x:function(){return r.clone()}}}};var hNe={kernelName:Eke,gradFunc:function(r){return{x:function(){return Bt(r)}}}};function pNe(r,e){var t,n=Ie(r,"a","greaterEqual","string_or_numeric"),a=Ie(e,"b","greaterEqual","string_or_numeric");t=te(Oa(n,a),2),n=t[0],a=t[1],Nn(n.shape,a.shape);var i={a:n,b:a};return ve.runKernel(dL,i)}var F1=He({greaterEqual_:pNe});function dNe(r,e){var t,n=Ie(r,"a","lessEqual","string_or_numeric"),a=Ie(e,"b","lessEqual","string_or_numeric");t=te(Oa(n,a),2),n=t[0],a=t[1],Nn(n.shape,a.shape);var i={a:n,b:a};return ve.runKernel(e2e,i)}var R1=He({lessEqual_:dNe});function vNe(r,e){var t=Ie(r,"a","logicalAnd","bool"),n=Ie(e,"b","logicalAnd","bool");Nn(t.shape,n.shape);var a={a:t,b:n};return ve.runKernel(r2e,a)}var uq=He({logicalAnd_:vNe});function mNe(r){var e=Ie(r,"x","clone","string_or_numeric"),t={x:e};return ve.runKernel(w1,t)}var cq=He({clone_:mNe});function gNe(r,e){var t=Ie(r,"broadcastTo","x"),n=t.shape;if(_h(e),e.length<t.rank)throw new Error("broadcastTo(): shape.length=".concat(e.length," < input.rank=").concat(t.rank,"."));if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=tt(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): [".concat(n,"] cannot be broadcast to [").concat(e,"]."));var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return cq(t);var c={x:t},l={reps:o};return ve.runKernel(x1,c,l)}var Bw=He({broadcastTo_:gNe});function yNe(r,e,t){var n=Ie(e,"a","where"),a=Ie(t,"b","where"),i=Ie(r,"condition","where","bool"),o=Nn(Nn(i.shape,n.shape),a.shape),s=Bw(i,o),u=Bw(n,o),c=Bw(a,o),l={condition:s,t:u,e:c};return ve.runKernel(TL,l)}var Nu=He({where_:yNe}),bNe={kernelName:Ike,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.clipValueMin,o=t.clipValueMax;return{x:function(){return Nu(uq(F1(a,i),R1(a,o)),r,Bt(r))}}}};var wNe={kernelName:tL,inputsToSave:["x"],gradFunc:iq.gradFunc};function xNe(r,e,t){t===void 0&&(t=0);var n=Ie(r,"x","split"),a={x:n},i={numOrSizeSplits:e,axis:t};return ve.runKernel(RL,a,i)}var kNe=He({split_:xNe});var SNe={kernelName:rL,saveAllInputs:!0,gradFunc:function(r,e,t){var n=e.map(function(u){return u.shape}),a=t.axis,i=Eu(a,e[0].shape)[0],o=n.map(function(u){return u[i]}),s=kNe(r,o,i);return s.map(function(u){return function(){return u}})}};function NNe(r,e,t,n,a,i,o){i===void 0&&(i="NHWC");var s=r;r.rank===3&&(s=tt(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=tt(e,[1,e.shape[0],e.shape[1],e.shape[2]])),Ne(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")}),Ne(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")}),Ne(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(t,".")});var c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];Ne(c===t[2],function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(t[2],".")}),Ne(l===t[3],function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(t[3],").")}),Au("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return ve.runKernel(Ake,f,h)}var lq=He({conv2DBackpropFilter_:NNe});function TNe(r,e,t,n,a,i,o){i===void 0&&(i="NHWC"),Ne(r.length===e.rank,function(){return"Length of inShape "+"(".concat(r.length,") and rank of dy (").concat(e.rank,") must match")});var s=r,u=e,c=!1;e.rank===3&&(c=!0,u=tt(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,r[0],r[1],r[2]]),Ne(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")}),Ne(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)}),Ne(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(t.rank)});var l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];Ne(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(t.shape[2],".")}),Ne(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output (".concat(f,") must ")+"match output depth for filter ".concat(t.shape[3],".")}),Au("conv2dDerInput",a,o);var h={dy:u,filter:t},p={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=ve.runKernel(aL,h,p);return c?tt(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var ENe=He({conv2DBackpropInput_:TNe}),INe={kernelName:nL,inputsToSave:["x","filter"],gradFunc:function(r,e,t){var n=te(e,2),a=n[0],i=n[1],o=t.dilations,s=t.strides,u=t.pad,c=t.dataFormat;return Ne(Sh(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(o,"'")}),{x:function(){return ENe(a.shape,r,i,s,u,c)},filter:function(){return lq(a,r,i.shape,s,u,c)}}}};function CNe(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=Ie(r,"x","conv2d","float32"),u=Ie(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=tt(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Ne(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")}),Ne(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")}),Au("conv2d",n,o);var f=a==="NHWC"?c.shape[3]:c.shape[1];Ne(f===u.shape[2],function(){return"Error in conv2d: depth of input (".concat(f,") must match ")+"input depth for filter ".concat(u.shape[2],".")}),Ne(sq(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),Ne(iB(i),function(){return"Error in conv2D: Dilated rates should be larger than 0."}),Ne(iB(t),function(){return"Error in conv2D: Strides should be larger than 0."});var h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=ve.runKernel(nL,h,p);return l?tt(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var ANe=He({conv2d_:CNe}),DNe={kernelName:aL,inputsToSave:["dy","filter"],gradFunc:function(r,e,t){var n=te(e,2),a=n[0],i=n[1],o=t.strides,s=t.pad,u=t.dataFormat,c=t.dimRoundingMode;return{dy:function(){return ANe(r,i,o,s,u,1,c)},filter:function(){return lq(r,a,i.shape,o,s,u,c)}}}};function _Ne(r,e,t,n,a){var i=r;r.rank===4&&(i=tt(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));var o=e;o.rank===4&&(o=tt(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),Ne(i.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+"".concat(i.shape,".")}),Ne(o.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+"".concat(o.shape,".")}),Ne(t.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+"".concat(t,".")}),Ne(i.shape[4]===t[3],function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must ")+"match input depth in filter (".concat(t[3],".")}),Ne(o.shape[4]===t[4],function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must ")+"match output depth for filter (".concat(t[4],").")});var s={x:i,dy:o},u={strides:n,pad:a,filterShape:t};return ve.runKernel(_ke,s,u)}var FNe=He({conv3DBackpropFilter_:_Ne});function RNe(r,e,t,n,a){Ne(r.length===e.rank,function(){return"Length of inShape "+"(".concat(r.length,") and rank of dy (").concat(e.rank,") must match")});var i=r,o=e,s=!1;e.rank===4&&(s=!0,o=tt(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,r[0],r[1],r[2],r[3]]);var u=i[4],c=o.shape[4];Ne(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")}),Ne(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)}),Ne(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(t.rank)}),Ne(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(t.shape[3],".")}),Ne(c===t.shape[4],function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(t.shape[4],".")});var l={dy:o,filter:t},f={pad:a,strides:n,inputShape:i},h=ve.runKernel(Fke,l,f);return s?tt(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var ONe=He({conv3DBackpropInput_:RNe}),PNe={kernelName:Dke,inputsToSave:["x","filter"],gradFunc:function(r,e,t){var n=t.dilations,a=t.strides,i=t.pad;Ne(Sh(n),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are "+"not yet supported in gradients. Got dilations '".concat(n,"'")});var o=te(e,2),s=o[0],u=o[1];return{x:function(){return ONe(s.shape,r,u,a,i)},filter:function(){return FNe(s,r,u.shape,a,i)}}}};function MNe(r){var e=Ie(r,"x","sin","float32"),t={x:e};return ve.runKernel(IL,t)}var BNe=He({sin_:MNe}),LNe={kernelName:iL,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(si(BNe(At(n,"float32"))),r)}}}};function qNe(r){var e=Ie(r,"x","sinh"),t={x:e};return ve.runKernel(CL,t)}var zNe=He({sinh_:qNe}),$Ne={kernelName:oL,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(zNe(At(n,"float32")),r)}}}};function WNe(r,e){for(var t=0;t<r.length;++t)if(r[r.length-t-1]!==e-1-t)return!1;return!0}function UNe(r,e,t){for(var n=r.length+e.length,a=[],i=0,o=0,s=0;s<n;s++)t.indexOf(s)===-1?a.push(r[i++]):a.push(e[o++]);return a}function VNe(r,e){for(var t=[],n=r.length,a=0;a<n;a++)e.indexOf(a)===-1&&t.push(r[a]);var i=e.map(function(o){return r[o]});return[t,i]}function oB(r,e){var t=e.map(function(n){return 1});return UNe(r,t,e)}function fq(r,e){if(WNe(r,e))return null;for(var t=[],n=0;n<e;++n)r.indexOf(n)===-1&&t.push(n);return r.forEach(function(a){return t.push(a)}),t}function O1(r){return r.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function GNe(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=Ie(r,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:n};return ve.runKernel(sL,i,o)}var HNe=He({cumsum_:GNe});function Xr(r,e){return ve.tidy(r,e)}function Fa(r){var e=tq(r);e.forEach(function(t){return t.dispose()})}function jNe(r){return ve.keep(r)}function KNe(r,e){var t=Ie(r,"real","complex"),n=Ie(e,"imag","complex");W2e(t.shape,n.shape,"real and imag shapes, ".concat(t.shape," and ").concat(n.shape,", ")+"must match in call to tf.complex().");var a={real:t,imag:n};return ve.runKernel(Cke,a)}var P1=He({complex_:KNe});function XNe(r){var e=Ie(r,"input","imag"),t={input:e};return ve.runKernel(Kke,t)}var YNe=He({imag_:XNe});function JNe(r){var e=Ie(r,"input","real"),t={input:e};return ve.runKernel(x2e,t)}var ZNe=He({real_:JNe});function QNe(r,e,t){var n=Ie(r,"x","transpose");if(e==null&&(e=n.shape.map(function(o,s){return s}).reverse()),Ne(n.rank===e.length,function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of perm ".concat(e,".")}),e.forEach(function(o){Ne(o>=0&&o<n.rank,function(){return"All entries in 'perm' must be between 0 and ".concat(n.rank-1)+" but got ".concat(e)})}),n.rank<=1)return n.clone();var a={x:n},i={perm:e};return n.dtype==="complex64"?Xr(function(){var o=ZNe(n),s=YNe(n);return o=ve.runKernel(qv,{x:o},i),s=ve.runKernel(qv,{x:s},i),t&&(s=si(s)),P1(o,s)}):ve.runKernel(qv,a,i)}var el=He({transpose_:QNe}),eTe={kernelName:sL,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.axis,o=t.exclusive,s=t.reverse;return{x:function(){var u=fq([i],a.rank),c=HNe(r,i,o,!s);return u!=null&&(c=el(c,u)),c}}}};function tTe(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=r;r.rank===3&&(s=tt(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=tt(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={x:s,dy:u},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return ve.runKernel(Pke,c,l)}var rTe=He({depthwiseConv2dNativeBackpropFilter_:tTe});function nTe(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=tt(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={dy:s,filter:t},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,inputShape:r},f=ve.runKernel(Mke,c,l);return u?tt(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var aTe=He({depthwiseConv2dNativeBackpropInput_:nTe}),iTe={kernelName:Oke,inputsToSave:["x","filter"],gradFunc:function(r,e,t){var n=t.dilations,a=t.strides,i=t.pad,o=t.dimRoundingMode,s=n??[1,1];Ne(Sh(s),function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(s,"'")});var u=te(e,2),c=u[0],l=u[1];return Ne(c.rank===4,function(){return"Error in gradient of depthwiseConv2dNative: input must be "+"rank 4, but got rank ".concat(c.rank,".")}),Ne(l.rank===4,function(){return"Error in gradient of depthwiseConv2dNative: filter must be "+"rank 4, but got rank ".concat(l.rank,".")}),Ne(c.shape[3]===l.shape[2],function(){return"Error in gradient of depthwiseConv2d: number of input "+"channels (".concat(c.shape[3],") must match the inChannels dimension ")+"in filter ".concat(l.shape[2],".")}),Ne(sq(a,s),function(){return"Error in gradient of depthwiseConv2d: Either strides or "+"dilations must be  1. Got strides ".concat(a," and dilations ")+"'".concat(s,"'.")}),Au("depthwiseConv2d",i,o),{x:function(){return aTe(c.shape,r,l,a,i,s,o)},filter:function(){return rTe(c,r,l.shape,a,i,s,o)}}}},oTe={kernelName:Bke,inputsToSave:["x","filter"],gradFunc:function(r,e,t){var n=te(e,2),a=n[0],i=n[1],o={x:a,filter:i,dy:r},s={x:a,filter:i,dy:r};return{x:function(){return ve.runKernel(Lke,o,t)},filter:function(){return ve.runKernel(qke,s,t)}}}},sTe={kernelName:zke,outputsToSave:[!0],gradFunc:function(r,e){var t=te(e,1),n=t[0],a={dy:r,y:n};return{x:function(){return ve.runKernel($ke,a)}}}};function uTe(r){var e=Ie(r,"x","exp"),t={x:e};return ve.runKernel(cL,t)}var ym=He({exp_:uTe}),cTe={kernelName:Wke,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0],a=be(ym(si(Pr(n))),2/Math.sqrt(Math.PI));return{x:function(){return be(r,a)}}}},lTe={kernelName:cL,outputsToSave:[!0],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(r,n)}}}},fTe={kernelName:lL,inputsToSave:["input"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{input:function(){return tt(r,n.shape)}}}},hTe={kernelName:Vke,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(r,ym(n))}}}};var pTe={kernelName:fL,gradFunc:function(r){return{x:function(){return Bt(r)}}}},dTe={kernelName:hL,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=Nn(n.shape,a.shape),o=function(){var u=Wt(r,At(a,"float32")),c=gn(n.shape,i);return c.length>0?tt(Ar(u,c),n.shape):u},s=function(){var u=be(r,At(n,"float32")),c=gn(a.shape,i);c.length>0&&(u=tt(Ar(u,c),a.shape));var l=Pr(a);return si(Wt(u,At(l,"float32")))};return{a:o,b:s}}};function vTe(r){var e=Ie(r,"x","rsqrt","float32"),t={x:e};return ve.runKernel(NL,t)}var mTe=He({rsqrt_:vTe});function gTe(r,e){var t=Ie(r,"x","tile","string_or_numeric");Ne(t.rank===e.length,function(){return"Error in transpose: rank of input ".concat(t.rank," ")+"must match length of reps ".concat(e,".")});var n={x:t},a={reps:e};return ve.runKernel(x1,n,a)}var yTe=He({tile_:gTe}),bTe={kernelName:Hke,inputsToSave:["x","mean","variance","scale"],gradFunc:function(r,e,t){var n=t.varianceEpsilon,a=te(e,4),i=a[0],o=a[1],s=a[2],u=a[3],c=u??Or(1),l=gn(o.shape,i.shape),f=[];if(o.rank===1){for(var h=0;h<i.shape.length-1;++h)f.push(i.shape[h]);f.push(1)}var p=mn(i,o),d=be(r,c),m=mTe(It(s,Or(n))),v=be(be(be(m,m),m),Or(-.5)),g=function(){return o.rank===1?tt(be(be(r,yTe(tt(m,[1,1,1,o.shape[0]]),f)),c),i.shape):tt(be(be(r,m),c),i.shape)},y=function(){var S=be(be(m,Or(-1)),d);return o.rank===1&&(S=Ar(S,l)),tt(S,o.shape)},w=function(){var S=be(be(v,p),d);return o.rank===1&&(S=Ar(S,l)),tt(S,o.shape)},b=function(){var S=be(p,m),T=be(r,S);return o.rank===1&&(T=Ar(T,l)),tt(T,o.shape)},x=function(){var S=r;return o.rank===1&&(S=Ar(S,l)),tt(S,o.shape)};return{x:g,mean:y,variance:w,scale:b,offset:x}}};function wTe(r,e){e===void 0&&(e=0);var t=aq(r,"tensors","stack","string_or_numeric");Ne(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&Ne(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var n=t,a={axis:e};return ve.runKernel(bL,n,a)}var hq=He({stack_:wTe});function xTe(r,e,t){var n=Ie(r,"x","unsortedSegmentSum"),a=Ie(e,"segmentIds","unsortedSegmentSum","int32");Ne(jv(t),function(){return"numSegments must be of dtype int"});var i={x:n,segmentIds:a},o={numSegments:t};return ve.runKernel(ML,i,o)}var kTe=He({unsortedSegmentSum_:xTe}),STe={kernelName:pL,inputsToSave:["x","indices"],gradFunc:function(r,e,t){var n=te(e,2),a=n[0],i=n[1],o=t.axis,s=t.batchDims,u=Eu(o,a.shape)[0],c=function(p,d,m){return function(){var v=p.shape,g=d.size,y=v.slice(0,u),w=y.length,b=v.slice(o,v.length).slice(1),x=b.length,S=sB(0,w),T=sB(w+1,w+1+x),E=uB([y,[g],b]),C=tt(m,E),R=tt(d,[g]),_=uB([[w],S,T]),M=el(C,_),$=kTe(M,R,p.shape[u]),z=O1(_);return $=el($,z),$}};if(s===1){var l=a.shape[0],f=a.split(l,0),h=function(){var p=hq(f.map(function(d,m){return c(d,i.slice(m,1),r.slice(m,1))()}));return p.reshape(a.shape)};return{x:h,indices:function(){return i}}}else return{x:c(a,i,r),indices:function(){return i}}}};function sB(r,e){for(var t=[],n=r;n<e;++n)t.push(n);return t}function uB(r){for(var e=[],t=0;t<r.length;++t)for(var n=0;n<r[t].length;++n)e.push(r[t][n]);return e}var NTe={kernelName:dL,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1];return{a:function(){return Bt(n)},b:function(){return Bt(a)}}}};var TTe={kernelName:w1,gradFunc:function(r){return{x:function(){return At(r,"float32")}}}};var ETe={kernelName:Xke,gradFunc:function(r){return{x:function(){return Bt(r)}}}};var ITe={kernelName:Yke,gradFunc:function(r){return{x:function(){return Bt(r)}}}};var CTe={kernelName:Jke,gradFunc:function(r){return{x:function(){return Bt(r)}}}};function ATe(r,e){var t,n=Ie(r,"a","greater","string_or_numeric"),a=Ie(e,"b","greater","string_or_numeric");t=te(Oa(n,a),2),n=t[0],a=t[1],Nn(n.shape,a.shape);var i={a:n,b:a};return ve.runKernel(jke,i)}var Fh=He({greater_:ATe}),DTe={kernelName:Zke,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.alpha,o=Fh(a,0);return{x:function(){return Nu(o,r,be(r,i))}}}},_Te={kernelName:t2e,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Wt(r,It(n,1))}}}},FTe={kernelName:vL,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Wt(r,At(n,"float32"))}}}},RTe={kernelName:a2e,inputsToSave:[],outputsToSave:[!0],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.axis;return{logits:function(){var o=!0,s=ym(a);return mn(r,be(Ar(r,i,o),s))}}}};function OTe(r,e,t,n,a,i,o){n===void 0&&(n=5),a===void 0&&(a=1),i===void 0&&(i=1),o===void 0&&(o=.5);var s={x:r,y:e,dy:t},u={depthRadius:n,bias:a,alpha:i,beta:o};return ve.runKernel(o2e,s,u)}var PTe=He({localResponseNormalizationBackprop_:OTe}),MTe={kernelName:i2e,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=te(e,2),a=n[0],i=n[1],o=t.depthRadius,s=t.bias,u=t.alpha,c=t.beta;return{x:function(){return PTe(a,i,r,o,s,u,c)}}}};function BTe(r,e){var t,n=Ie(r,"a","equal","string_or_numeric"),a=Ie(e,"b","equal","string_or_numeric");t=te(Oa(n,a),2),n=t[0],a=t[1],Nn(n.shape,a.shape);var i={a:n,b:a};return ve.runKernel(Uke,i)}var LTe=He({equal_:BTe});function pq(r,e,t,n){return e.rank<t.rank&&(e=tt(e,oB(e.shape,n))),r.rank<t.rank&&(r=tt(r,oB(r.shape,n))),{x:function(){var a=be(r,At(LTe(t,e),r.dtype));return a}}}var cB={kernelName:s2e,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=t,a=n.reductionIndices,i=e[0],o=e[1],s=Eu(a,i.shape),u=pq(r,o,i,s);return{x:function(){return u.x()}}}};function qTe(r,e){var t,n=Ie(r,"a","less","string_or_numeric"),a=Ie(e,"b","less","string_or_numeric");t=te(Oa(n,a),2),n=t[0],a=t[1],Nn(n.shape,a.shape);var i={a:n,b:a};return ve.runKernel(Qke,i)}var zTe=He({less_:qTe}),$Te={kernelName:mL,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=function(){return be(r,At(F1(n,a),"float32"))},o=function(){return be(r,At(zTe(n,a),"float32"))};return{a:i,b:o}}};function WTe(r,e,t,n,a,i,o){var s=Ie(r,"dy","maxPool3dGrad"),u=Ie(e,"input","maxPool3dGrad"),c=Ie(t,"output","maxPool3dGrad"),l=s,f=u,h=c,p=!1;u.rank===4&&(p=!0,l=tt(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),f=tt(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=tt(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),Ne(l.rank===5,function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank "+"".concat(l.rank,".")}),Ne(f.rank===5,function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank "+"".concat(f.rank,".")}),Ne(h.rank===5,function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank "+"".concat(h.rank,".")}),Au("maxPool3dGrad",i,o);var d={dy:l,input:f,output:h},m={filterSize:n,strides:a,pad:i,dimRoundingMode:o},v=ve.runKernel(f2e,d,m);return p?tt(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}var UTe=He({maxPool3dGrad_:WTe}),VTe={kernelName:l2e,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=te(e,2),a=n[0],i=n[1],o=t.filterSize,s=t.strides,u=t.pad,c=t.dimRoundingMode;return{x:function(){return UTe(r,a,i,o,s,u,c)}}}};function GTe(r,e,t,n,a,i,o){var s=Ie(r,"dy","maxPoolGrad"),u=Ie(e,"input","maxPoolGrad"),c=Ie(t,"output","maxPoolGrad");Ne(u.rank===s.rank,function(){return"Rank of input (".concat(u.rank,") does not match rank of dy ")+"(".concat(s.rank,")")}),Ne(s.rank===4,function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank "+"".concat(s.rank,".")}),Ne(u.rank===4,function(){return"Error in maxPoolGrad: input must be rank 4 but got rank "+"".concat(u.rank,".")}),Au("maxPoolGrad",i,o);var l={dy:s,input:u,output:c},f={filterSize:n,strides:a,pad:i,dimRoundingMode:o};return ve.runKernel(c2e,l,f)}var HTe=He({maxPoolGrad_:GTe}),jTe={kernelName:u2e,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=te(e,2),a=n[0],i=n[1],o=t.filterSize,s=t.strides,u=t.pad;return{x:function(){return HTe(r,a,i,o,s,u)}}}};function Jv(r,e){if(e===void 0&&(e="float32"),_h(r),e==="complex64"){var t=Jv(r,"float32"),n=Jv(r,"float32");return P1(t,n)}var a=T1(to(r),e);return ve.makeTensor(a,r,e)}function bm(r,e){if(e===void 0&&(e="float32"),_h(r),e==="complex64"){var t=bm(r,"float32"),n=Jv(r,"float32");return P1(t,n)}var a=zL(to(r),e);return ve.makeTensor(a,r,e)}var KTe={kernelName:h2e,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.axis,o=Eu(i,a.shape),s=VNe(a.shape,o),u=s[1],c=to(u),l=function(){var f=a.shape.slice();o.forEach(function(d){f[d]=1});var h=tt(r,f),p=Wt(be(h,bm(a.shape,"float32")),c);return p};return{x:l}}},XTe={kernelName:p2e,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=t,a=n.axis,i=te(e,2),o=i[0],s=i[1],u=Eu(a,o.shape),c=pq(r,s,o,u);return{x:function(){return c.x()}}}},YTe={kernelName:d2e,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=function(){return be(r,At(R1(n,a),"float32"))},o=function(){return be(r,At(Fh(n,a),"float32"))};return{a:i,b:o}}};function JTe(r,e,t){var n=Ie(r,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");var a={x:n},i={begin:e,size:t};return ve.runKernel(EL,a,i)}var Yc=He({slice_:JTe});var ZTe={kernelName:v2e,inputsToSave:["x"],gradFunc:function(r,e,t){var n=e[0],a=t.paddings,i=a.map(function(o){return o[0]});return{x:function(){return Yc(r,i,n.shape)}}}};function QTe(r){var e=Ie(r,"x","floor","float32"),t={x:e};return ve.runKernel(fL,t)}var eEe=He({floor_:QTe}),tEe={kernelName:m2e,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=Nn(n.shape,a.shape),o=function(){var u=gn(n.shape,i);return u.length>0?tt(Ar(r,u),n.shape):r},s=function(){var u=be(r,si(eEe(Wt(n,a)))),c=gn(a.shape,i);return c.length>0?tt(Ar(u,c),a.shape):u};return{a:o,b:s}}},rEe={kernelName:gL,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=Nn(n.shape,a.shape),o=function(){var u=be(r,At(a,"float32")),c=gn(n.shape,i);return c.length>0?tt(Ar(u,c),n.shape):u},s=function(){var u=be(r,At(n,"float32")),c=gn(a.shape,i);return c.length>0?tt(Ar(u,c),a.shape):u};return{a:o,b:s}}};var nEe={kernelName:yL,gradFunc:function(r){return{x:function(){return si(r)}}}};var aEe={kernelName:y2e,inputsToSave:["indices"],gradFunc:function(r,e){var t=e[0];return{indices:function(){return Jv(t.shape,"float32")}}}};var iEe={kernelName:g2e,gradFunc:function(r){return{x:function(){return Bt(r)}}}};function oEe(r,e){e===void 0&&(e=0);var t=Ie(r,"x","unstack","string_or_numeric");Ne(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = ".concat(e," is not in [-").concat(t.shape.length,", ").concat(t.shape.length,")")});var n={value:t},a={axis:e};return ve.runKernel(PL,n,a)}var sEe=He({unstack_:oEe});var uEe={kernelName:bL,saveAllInputs:!0,gradFunc:function(r,e,t){var n=t.axis,a=sEe(r,n);return a.map(function(i){return function(){return i}})}};var lB={kernelName:wL,inputsToSave:["x"],gradFunc:function(r,e,t){var n=e[0],a=t.paddings,i=a.map(function(o){return o[0]});return{x:function(){return Yc(r,i,n.shape)}}}};function cEe(r){var e=Ie(r,"x","log","float32"),t={x:e};return ve.runKernel(vL,t)}var lEe=He({log_:cEe});function fEe(r,e){var t,n=Ie(r,"base","pow"),a=Ie(e,"exp","pow");t=te(Oa(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ve.runKernel(xL,i)}var Zv=He({pow_:fEe}),hEe={kernelName:xL,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(r,e){var t=te(e,3),n=t[0],a=t[1],i=t[2],o=n,s=a,u=Nn(o.shape,s.shape),c=function(){var f=At(s,"float32"),h=be(r,be(f,Zv(o,mn(f,Or(1))))),p=gn(o.shape,u);return p.length>0&&(h=Ar(h,p)),tt(h,o.shape)},l=function(){var f=Fh(o,0),h=Nu(f,lEe(o),Bt(o)),p=be(r,be(i,h)),d=gn(s.shape,u);return d.length>0&&(p=Ar(p,d)),tt(p,s.shape)};return{a:c,b:l}}},pEe={kernelName:b2e,inputsToSave:["x","alpha"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=Fh(n,0);return{x:function(){return Nu(i,r,be(r,a))},alpha:function(){var o=Nu(i,Bt(r),be(r,n)),s=gn(a.shape,r.shape);return s.length>0&&(o=Ar(o,s)),tt(o,a.shape)}}}};function dEe(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Gn=yr();Gn.registerFlag("DEBUG",function(){return!1},function(r){r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Gn.registerFlag("IS_BROWSER",function(){return dEe()});Gn.registerFlag("IS_NODE",function(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"});Gn.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)});Gn.registerFlag("IS_SAFARI",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)});Gn.registerFlag("PROD",function(){return!1});Gn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Gn.getBool("DEBUG")});Gn.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0});Gn.registerFlag("IS_TEST",function(){return!1});Gn.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",function(){return Gn.getBool("DEBUG")});Gn.registerFlag("WRAP_TO_IMAGEBITMAP",function(){return!1});Gn.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",function(){return!1});Gn.registerFlag("USE_SETTIMEOUTCUSTOM",function(){return!1});var Rh=function(){function r(e){if(this.shards=[],this.previousShardIndex=0,e!=null&&(e instanceof Array||(e=[e]),e=e.map(function(o){return ii(o)?o.buffer:o}),e.length!==0)){this.bufferUniformSize=e[0].byteLength;for(var t=0,n=0;n<e.length;n++){var a=e[n];n!==e.length-1&&a.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);var i=t+a.byteLength;this.shards.push({buffer:a,start:t,end:i}),t=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}}return r.join=function(e){return new r(e).slice()},r.prototype.slice=function(e,t){if(e===void 0&&(e=0),t===void 0&&(t=this.byteLength),this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);var n=this.findShardForByte(e);if(n===-1)throw new Error("Could not find start shard for byte ".concat(e));for(var a=t-e,i=new ArrayBuffer(a),o=new Uint8Array(i),s=0,u=n;u<this.shards.length;u++){var c=this.shards[u],l=e+s,f=l-c.start,h=s,p=Math.min(t,c.end),d=p-c.start,m=new Uint8Array(c.buffer,f,d-f);if(o.set(m,h),s+=m.length,t<c.end)break}return i},r.prototype.findShardForByte=function(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(a){return e<a.start?-1:e>=a.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;var n=vEe(this.shards,t);return n===-1?-1:(this.previousShardIndex=n,this.previousShardIndex)},r}();function vEe(r,e){for(var t=0,n=r.length;t<=n;){var a=Math.floor((n-t)/2)+t,i=e(r[a]);if(i===0)return a;i<0?n=a:t=a+1}return-1}var M1=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function fB(r){return M1?Buffer.byteLength(r,"utf8"):new Blob([r]).size}function mEe(r){if(M1)return Buffer.from(r).toString("base64");for(var e=new Uint8Array(r),t="",n=0,a=e.length;n<a;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function gEe(r){if(M1){var e=Buffer.from(r,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var t=atob(r),n=new Uint8Array(t.length),a=0;a<t.length;++a)n.set([t.charCodeAt(a)],a);return n.buffer}function dq(r,e){var t={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy,weightsManifest:e};return r.signature!=null&&(t.signature=r.signature),r.userDefinedMetadata!=null&&(t.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(t.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(t.initializerSignature=r.initializerSignature),r.trainingConfig!=null&&(t.trainingConfig=r.trainingConfig),t}function yEe(r,e,t){var n={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy};if(r.trainingConfig!=null&&(n.trainingConfig=r.trainingConfig),r.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");n.weightSpecs=e,n.weightData=t}return r.signature!=null&&(n.signature=r.signature),r.userDefinedMetadata!=null&&(n.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(n.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(n.initializerSignature=r.initializerSignature),n}function bEe(r,e){return Ce(this,void 0,void 0,function(){var t,n,a;return Ee(this,function(i){switch(i.label){case 0:return r.weightsManifest==null?[3,2]:[4,e(r.weightsManifest)];case 1:a=te.apply(void 0,[i.sent(),2]),t=a[0],n=a[1],i.label=2;case 2:return[2,yEe(r,t,n)]}})})}function wm(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:fB(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:fB(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:new Rh(r.weightData).byteLength}}function hB(r){var e,t,n=[];try{for(var a=fe(r),i=a.next();!i.done;i=a.next()){var o=i.value;n.push.apply(n,et([],te(o.weights),!1))}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}var Du=function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerSaveRouter=function(e){r.getInstance().saveRouters.push(e)},r.registerLoadRouter=function(e){r.getInstance().loadRouters.push(e)},r.getSaveHandlers=function(e){return r.getHandlers(e,"save")},r.getLoadHandlers=function(e,t){return r.getHandlers(e,"load",t)},r.getHandlers=function(e,t,n){var a=[],i=t==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters;return i.forEach(function(o){var s=o(e,n);s!==null&&a.push(s)}),a},r}(),wEe="tensorflowjs",xEe=1,wh="models_store",Wv="model_info_store";function kEe(){if(!yr().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=typeof window>"u"?self:window,e=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function SEe(r){var e=r.result;e.createObjectStore(wh,{keyPath:"modelPath"}),e.createObjectStore(Wv,{keyPath:"modelPath"})}var Qv=function(){function r(e){if(this.indexedDB=kEe(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return r.prototype.save=function(e){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},r.prototype.load=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},r.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(a,i){var o=n.indexedDB.open(wEe,xEe);o.onupgradeneeded=function(){return SEe(o)},o.onsuccess=function(){var s=o.result;if(t==null){var u=s.transaction(wh,"readonly"),c=u.objectStore(wh),l=c.get(n.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),i(new Error("Cannot find model with path '".concat(n.modelPath,"' ")+"in IndexedDB."));a(l.result.modelArtifacts)},l.onerror=function(v){return s.close(),i(l.error)},u.oncomplete=function(){return s.close()}}else{t.weightData=Rh.join(t.weightData);var f=wm(t),h=s.transaction(Wv,"readwrite"),p=h.objectStore(Wv),d;try{d=p.put({modelPath:n.modelPath,modelArtifactsInfo:f})}catch(v){return i(v)}var m;d.onsuccess=function(){m=s.transaction(wh,"readwrite");var v=m.objectStore(wh),g;try{g=v.put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:f})}catch(y){return i(y)}g.onsuccess=function(){return a({modelArtifactsInfo:f})},g.onerror=function(y){p=h.objectStore(Wv);var w=p.delete(n.modelPath);w.onsuccess=function(){return s.close(),i(g.error)},w.onerror=function(b){return s.close(),i(g.error)}}},d.onerror=function(v){return s.close(),i(d.error)},h.oncomplete=function(){m==null?s.close():m.oncomplete=function(){return s.close()}}}},o.onerror=function(s){return i(o.error)}})},r}();Qv.URL_SCHEME="indexeddb://";var vq=function(r){return yr().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Qv.URL_SCHEME)?NEe(r.slice(Qv.URL_SCHEME.length)):null};Du.registerSaveRouter(vq);Du.registerLoadRouter(vq);function NEe(r){return new Qv(r)}var hh="/",ph="tensorflowjs_models",TEe="info",EEe="model_topology",IEe="weight_specs",CEe="weight_data",AEe="model_metadata";function DEe(r){return{info:[ph,r,TEe].join(hh),topology:[ph,r,EEe].join(hh),weightSpecs:[ph,r,IEe].join(hh),weightData:[ph,r,CEe].join(hh),modelMetadata:[ph,r,AEe].join(hh)}}function _Ee(r){var e,t;try{for(var n=fe(Object.values(r)),a=n.next();!a.done;a=n.next()){var i=a.value;window.localStorage.removeItem(i)}}catch(o){e={error:o}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}}var em=function(){function r(e){if(!yr().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=DEe(this.modelPath)}return r.prototype.save=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o;return Ee(this,function(s){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),a=wm(e),i=Rh.join(e.weightData);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,mEe(i)),o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),[2,{modelArtifactsInfo:a}]}catch{throw _Ee(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."))}return[2]})})},r.prototype.load=function(){return Ce(this,void 0,void 0,function(){var e,t,n,a,i,o,s;return Ee(this,function(u){if(e=JSON.parse(this.LS.getItem(this.keys.info)),e==null)throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},n=JSON.parse(this.LS.getItem(this.keys.topology)),n==null)throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");if(t.modelTopology=n,a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)),a==null)throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");if(t.weightSpecs=a,i=this.LS.getItem(this.keys.modelMetadata),i!=null&&(o=JSON.parse(i),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,o.signature!=null&&(t.signature=o.signature),o.userDefinedMetadata!=null&&(t.userDefinedMetadata=o.userDefinedMetadata),o.modelInitializer!=null&&(t.modelInitializer=o.modelInitializer),o.initializerSignature!=null&&(t.initializerSignature=o.initializerSignature),o.trainingConfig!=null&&(t.trainingConfig=o.trainingConfig)),s=this.LS.getItem(this.keys.weightData),s==null)throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));return t.weightData=gEe(s),[2,t]})})},r}();em.URL_SCHEME="localstorage://";var mq=function(r){return yr().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(em.URL_SCHEME)?FEe(r.slice(em.URL_SCHEME.length)):null};Du.registerSaveRouter(mq);Du.registerLoadRouter(mq);function FEe(r){return new em(r)}var REe="model",OEe=".json",PEe=".weights.bin";function pB(r){return new Promise(function(e){return setTimeout(e)}).then(r)}var tm=function(){function r(e){if(!yr().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(r.URL_SCHEME)&&(e=e.slice(r.URL_SCHEME.length)),(e==null||e.length===0)&&(e=REe),this.modelJsonFileName=e+OEe,this.weightDataFileName=e+PEe}return r.prototype.save=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=Rh.join(e.weightData),n=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return a=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i=dq(e,a),o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),s=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor,s.download=this.modelJsonFileName,s.href=o,[4,pB(function(){return s.dispatchEvent(new MouseEvent("click"))})];case 2:return c.sent(),e.weightData==null?[3,4]:(u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor,u.download=this.weightDataFileName,u.href=n,[4,pB(function(){return u.dispatchEvent(new MouseEvent("click"))})]);case 3:c.sent(),c.label=4;case 4:return[2,{modelArtifactsInfo:wm(e)}]}})})},r}();tm.URL_SCHEME="downloads://";var MEe=function(r){return yr().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(tm.URL_SCHEME)?BEe(r.slice(tm.URL_SCHEME.length)):null};Du.registerSaveRouter(MEe);function BEe(r){return r===void 0&&(r="model"),new tm(r)}function dB(r,e,t,n){o(r),t=t??0,n=n??1,s(t,n);var a=0,i=function(u){return u.then(function(c){var l=t+ ++a/r.length*(n-t);return e(l),c}),u};function o(u){Ne(u!=null&&Array.isArray(u)&&u.length>0,function(){return"promises must be a none empty array"})}function s(u,c){Ne(u>=0&&u<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(u)}),Ne(c>=0&&c<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(c)}),Ne(c>=u,function(){return"startFraction must be no more than endFraction, but "+"got startFraction ".concat(u," and endFraction ")+"".concat(c)})}return Promise.all(r.map(i))}function LEe(r,e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h;return Ee(this,function(p){switch(p.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?yr().platform.fetch:e.fetchFunc,n=r.map(function(d){return t(d,e.requestInit,{isBinary:!0})}),a=0,i=.5,e.onProgress!=null?[3,2]:[4,Promise.all(n)];case 1:return s=p.sent(),[3,4];case 2:return[4,dB(n,e.onProgress,a,i)];case 3:s=p.sent(),p.label=4;case 4:return o=s,u=o.map(function(d){return d.arrayBuffer()}),c=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(u)];case 5:return h=p.sent(),[3,8];case 6:return[4,dB(u,e.onProgress,c,l)];case 7:h=p.sent(),p.label=8;case 8:return f=h,[2,f]}})})}function qEe(r,e){var t=this,n,a=e.fetchFunc==null?yr().platform.fetch:e.fetchFunc,i=0,o;return(n=e.onProgress)===null||n===void 0||n.call(e,0),new ReadableStream({pull:function(s){return Ce(t,void 0,void 0,function(){var u,c,l,f,h;return Ee(this,function(p){switch(p.label){case 0:return i<r.length?o?[3,2]:[4,a(r[i],e.requestInit,{isBinary:!0})]:[3,4];case 1:c=p.sent().body,o=c.getReader(),p.label=2;case 2:return[4,o.read()];case 3:return l=p.sent(),f=l.done,h=l.value,f?(i++,o=void 0,(u=e.onProgress)===null||u===void 0||u.call(e,i/r.length),[3,0]):(s.enqueue(h),[2]);case 4:return s.close(),[2]}})})}})}var zEe="application/octet-stream",$Ee="application/json",B1=function(){function r(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(Ne(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=yr().platform.fetch,Ne(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&Ne(e.length===2,function(){return"URL paths for http must have a length of 2, "+"(actual length is ".concat(e.length,").")}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}return r.prototype.save=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o;return Ee(this,function(s){switch(s.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit),t.body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=dq(e,n),t.body.append("model.json",new Blob([JSON.stringify(a)],{type:$Ee}),"model.json"),e.weightData!=null&&(i=Rh.join(e.weightData),t.body.append("model.weights.bin",new Blob([i],{type:zEe}),"model.weights.bin")),[4,this.fetch(this.path,t)];case 1:if(o=s.sent(),o.ok)return[2,{modelArtifactsInfo:wm(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(o.status,"."))}})})},r.prototype.loadModelJSON=function(){return Ce(this,void 0,void 0,function(){var e,t,n,a,i;return Ee(this,function(o){switch(o.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(e=o.sent(),!e.ok)throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(e.status,". Please verify this URL points to ")+"the model JSON of the model to load.");o.label=2;case 2:return o.trys.push([2,4,,5]),[4,e.json()];case 3:return t=o.sent(),[3,5];case 4:throw o.sent(),n="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(a=t.modelTopology,i=t.weightsManifest,a==null&&i==null)throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");return[2,t]}})})},r.prototype.load=function(){return Ce(this,void 0,void 0,function(){var e,t=this;return Ee(this,function(n){switch(n.label){case 0:return this.loadOptions.streamWeights?[2,this.loadStream()]:[4,this.loadModelJSON()];case 1:return e=n.sent(),[2,bEe(e,function(a){return t.loadWeights(a)})]}})})},r.prototype.loadStream=function(){return Ce(this,void 0,void 0,function(){var e,t,n,a,i=this;return Ee(this,function(o){switch(o.label){case 0:return[4,this.loadModelJSON()];case 1:return e=o.sent(),[4,this.getWeightUrls(e.weightsManifest)];case 2:return t=o.sent(),n=hB(e.weightsManifest),a=function(){return qEe(t,i.loadOptions)},[2,Object.assign(Object.assign({},e),{weightSpecs:n,getWeightStream:a})]}})})},r.prototype.getWeightUrls=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S;return Ee(this,function(T){switch(T.label){case 0:t=Array.isArray(this.path)?this.path[1]:this.path,n=te(WEe(t),2),a=n[0],i=n[1],o=this.weightPathPrefix||a,s=[],u=[];try{for(c=fe(e),l=c.next();!l.done;l=c.next()){f=l.value;try{for(h=(x=void 0,fe(f.paths)),p=h.next();!p.done;p=h.next())d=p.value,this.weightUrlConverter!=null?u.push(this.weightUrlConverter(d)):s.push(o+d+i)}catch(E){x={error:E}}finally{try{p&&!p.done&&(S=h.return)&&S.call(h)}finally{if(x)throw x.error}}}}catch(E){w={error:E}}finally{try{l&&!l.done&&(b=c.return)&&b.call(c)}finally{if(w)throw w.error}}return this.weightUrlConverter?(v=(m=s.push).apply,g=[s],y=[[]],[4,Promise.all(u)]):[3,2];case 1:v.apply(m,g.concat([et.apply(void 0,y.concat([te.apply(void 0,[T.sent()]),!1]))])),T.label=2;case 2:return[2,s]}})})},r.prototype.loadWeights=function(e){return Ce(this,void 0,void 0,function(){var t,n,a;return Ee(this,function(i){switch(i.label){case 0:return[4,this.getWeightUrls(e)];case 1:return t=i.sent(),n=hB(e),[4,LEe(t,this.loadOptions)];case 2:return a=i.sent(),[2,[n,a]]}})})},r}();B1.URL_SCHEME_REGEX=/^https?:\/\//;function WEe(r){var e=r.lastIndexOf("/"),t=r.lastIndexOf("?"),n=r.substring(0,e),a=t>e?r.substring(t):"";return[n+"/",a]}function vB(r){return r.match(B1.URL_SCHEME_REGEX)!=null}var gq=function(r,e){if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;var t=!0;return Array.isArray(r)?t=r.every(function(n){return vB(n)}):t=vB(r),t?UEe(r,e):null};Du.registerSaveRouter(gq);Du.registerLoadRouter(gq);function UEe(r,e){return new B1(r,e)}function VEe(r,e,t){var n=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(t.shape)+", indices.shape: ".concat(e.shape,", shape: ").concat(r)+", sliceDim: ".concat(n,", and batchDim: ").concat(a,".");if(t.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(r.length<n+(t.rank-a))throw new Error(i+" Output shape length < ".concat(n+(t.rank-a)));if(t.rank!==a+r.length-n)throw new Error(i+" update.rank != ".concat(a+r.length-n));for(var o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(t.shape[o],") != indices.shape[").concat(o,"] (").concat(e.shape[o],")."));for(var o=0;o<t.rank-a;++o)if(t.shape[o+a]!==r[o+n])throw new Error(i+" updates.shape[".concat(o+a,"] (").concat(t.shape[o+a],") != shape[").concat(o+a,"] (").concat(r[o+a],")"))}function GEe(r,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(r.rank,"."));if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(e.dtype));if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(t));if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: ".concat(e.shape));if(r.size===0)throw new Error("Updates specified for empty output. updates shape: ".concat(r.shape))}VEe(t,e,r)}function HEe(r,e,t){var n,a=r.shape.length;typeof e=="number"?n=et([e],te(new Array(a-1).fill(0)),!1):e.length<a?n=e.concat(new Array(a-e.length).fill(0)):n=e.slice(),n.forEach(function(o){Ne(o!==-1,function(){return"slice() does not support negative begin indexing."})});var i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=et([t],te(new Array(a-1).fill(-1)),!1):t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map(function(o,s){return o>=0?o:(Ne(o===-1,function(){return"Negative size values should be exactly -1 but got "+"".concat(o," for the slice() size at index ").concat(s,".")}),r.shape[s]-n[s])}),[n,i]}var jEe=function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(e,t){return new e(t)},r}();function KEe(r){var e=Ie(r,"x","abs");if(e.dtype==="complex64"){var t={x:e};return ve.runKernel(tL,t)}else{var t={x:e};return ve.runKernel(ZB,t)}}var XEe=He({abs_:KEe});function YEe(r,e){e===void 0&&(e=0),Ne(r.length>=1,function(){return"Pass at least one tensor to concat"});var t=aq(r,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `.concat(i.dtype,". "))}),t.length===1)return cq(t[0]);var n=t,a={axis:e};return ve.runKernel(rL,n,a)}var JEe=He({concat_:YEe});function ZEe(r){var e=Ie(r,"x","sigmoid","float32"),t={x:e};return ve.runKernel(AL,t)}var QEe=He({sigmoid_:ZEe});function eIe(r,e,t){var n=Ie(r,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});Ne(n.rank>=1+e.length,function(){return"input rank is ".concat(n.rank," but should be > than blockShape.length ").concat(e.length)}),Ne(t.length===e.length,function(){return"crops.length is ".concat(t.length," but should be equal to blockShape.length  ").concat(e.length)}),Ne(n.shape[0]%a===0,function(){return"input tensor batch is ".concat(n.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(e.join(" * ")," === ").concat(a)});var i={x:n},o={blockShape:e,crops:t};return ve.runKernel(eL,i,o)}var tIe=He({batchToSpaceND_:eIe});function rIe(r,e,t){_h(r),t=t||gm(e);var n={shape:r,value:e,dtype:t};return ve.runKernel(Gke,{},n)}function nIe(r){var e=Ie(r,"x","cos","float32"),t={x:e};return ve.runKernel(iL,t)}var yq=He({cos_:nIe});function aIe(r){var e=Ie(r,"x","cosh","float32"),t={x:e};return ve.runKernel(oL,t)}var iIe=He({cosh_:aIe});function oIe(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=Ie(r,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:n};return ve.runKernel(Rke,i,o)}var mB=He({cumprod_:oIe});function sIe(r,e){e===void 0&&(e=0);var t=Ie(r,"x","expandDims","string_or_numeric");Ne(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var n={input:t},a={dim:e};return ve.runKernel(lL,n,a)}var uIe=He({expandDims_:sIe});function cIe(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=0);var a=Ie(r,"x","gather"),i=Ie(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:n};return ve.runKernel(pL,o,s)}var lIe=He({gather_:cIe});function fIe(r,e){Ne(Yw(r),function(){return"The f passed in variableGrads(f) must be a function"}),Ne(e==null||Array.isArray(e)&&e.every(function(f){return f instanceof Yv}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t){e=[];for(var n in ve.registeredVariables)e.push(ve.registeredVariables[n])}var a=t?e.filter(function(f){return!f.trainable}):null,i=e.length;e=e.filter(function(f){return f.trainable}),Ne(e.length>0,function(){return"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(i," variables is ")+"trainable."});var o=!0,s=ve.gradients(r,e,null,o),u=s.value,c=s.grads;Ne(c.some(function(f){return f!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),Ne(u.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(u.rank," tensor")});var l={};return e.forEach(function(f,h){c[h]!=null&&(l[f.name]=c[h])}),a?.forEach(function(f){return l[f.name]=null}),{value:u,grads:l}}function hIe(r){var e=Ie(r,"x","logicalNot","bool"),t={x:e};return ve.runKernel(n2e,t)}var pIe=He({logicalNot_:hIe});function dIe(r,e){var t,n=Ie(r,"a","maximum"),a=Ie(e,"b","maximum");t=te(Oa(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=At(n,"int32"),a=At(a,"int32")),Nn(n.shape,a.shape);var i={a:n,b:a};return ve.runKernel(mL,i)}var bq=He({maximum_:dIe});function vIe(r,e,t){t===void 0&&(t=0);var n=Ie(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:n};return ve.runKernel(wL,i,a)}var mIe=He({pad_:vIe}),wq={exports:{}};(function(r){(function(e,t,n){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(Iu,r,!1)})(wq);var gIe=wq.exports,xq={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(Iu,r,!1)})(xq);var yIe=xq.exports,kq={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(Iu,r,!1)})(kq);var bIe=kq.exports,Sq={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,p;return h=l[f],h^=h>>>7,p=h^h<<24,h=l[f+1&7],p^=h^h>>>10,h=l[f+3&7],p^=h^h>>>3,h=l[f+4&7],p^=h^h<<7,h=l[f+7&7],h=h^h<<13,p^=h^h<<9,l[f]=p,u.i=f+1&7,p};function c(l,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8?p[7]=-1:p[h],l.x=p,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(Iu,r,!1)})(Sq);var wIe=Sq.exports,Nq={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,p,d;return u.w=l=l+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(l^l>>>16)|0};function c(l,f){var h,p,d,m,v,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,m=-32;m<y;++m)f&&(p^=f.charCodeAt((m+32)%f.length)),m===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(v=v+1640531527|0,h=g[m&127]^=p+v,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,m=4*128;m>0;--m)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;l.w=v,l.X=g,l.i=d}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(Iu,r,!1)})(Nq);var xIe=Nq.exports,Tq={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(Iu,r,!1)})(Tq);var kIe=Tq.exports,Eq={exports:{}},SIe={},NIe={__proto__:null,default:SIe},TIe=iSe(NIe);(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),c=n.pow(2,o),l=c*2,f=a-1,h;function p(b,x,S){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(v(x.entropy?[b,w(t)]:b??y(),3),T),C=new d(T),R=function(){for(var _=C.g(i),M=u,$=0;_<c;)_=(_+$)*a,M*=a,$=C.g(1);for(;_>=l;)_/=2,M/=2,$>>>=1;return(_+$)/M};return R.int32=function(){return C.g(4)|0},R.quick=function(){return C.g(4)/4294967296},R.double=R,g(w(C.S),t),(x.pass||S||function(_,M,$,z){return z&&(z.S&&m(z,C),_.state=function(){return m(C,{})}),$?(n[s]=_,M):_})(R,E,"global"in x?x.global:this==n,x.state)}function d(b){var x,S=b.length,T=this,E=0,C=T.i=T.j=0,R=T.S=[];for(S||(b=[S++]);E<a;)R[E]=E++;for(E=0;E<a;E++)R[E]=R[C=f&C+b[E%S]+(x=R[E])],R[C]=x;(T.g=function(_){for(var M,$=0,z=T.i,q=T.j,L=T.S;_--;)M=L[z=f&z+1],$=$*a+L[f&(L[z]=L[q=f&q+M])+(L[q]=M)];return T.i=z,T.j=q,$})(a)}function m(b,x){return x.i=b.i,x.j=b.j,x.S=b.S.slice(),x}function v(b,x){var S=[],T=typeof b,E;if(x&&T=="object")for(E in b)try{S.push(v(b[E],x-1))}catch{}return S.length?S:T=="string"?b:b+"\0"}function g(b,x){for(var S=b+"",T,E=0;E<S.length;)x[f&E]=f&(T^=x[f&E]*19)+S.charCodeAt(E++);return w(x)}function y(){try{var b;return h&&(b=h.randomBytes)?b=b(a):(b=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(b)),w(b)}catch{var x=e.navigator,S=x&&x.plugins;return[+new Date,e,S,e.screen,w(t)]}}function w(b){return String.fromCharCode.apply(0,b)}if(g(n.random(),t),r.exports){r.exports=p;try{h=TIe}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:Iu,[],Math)})(Eq);var EIe=Eq.exports,IIe=gIe,CIe=yIe,AIe=bIe,DIe=wIe,_Ie=xIe,FIe=kIe,nl=EIe;nl.alea=IIe;nl.xor128=CIe;nl.xorwow=AIe;nl.xorshift7=DIe;nl.xor4096=_Ie;nl.tychei=FIe;function RIe(r,e){var t=Ie(r,"x","reverse"),n={x:t},a={dims:e};return ve.runKernel(SL,n,a)}var OIe=He({reverse_:RIe});function PIe(r,e,t){var n=Ie(r,"tensor","tensorScatterupdate"),a=Ie(e,"indices","tensorScatterupdate","int32"),i=Ie(t,"updates","tensorScatterupdate");if(GEe(i,a,n.shape),n.dtype!==i.dtype)throw new Error("tensor and updates must have the same dtype, instead they are ".concat(n.dtype," and ").concat(i.dtype,"."));var o={tensor:n,indices:a,updates:i},s={};return ve.runKernel(D2e,o,s)}He({tensorScatterUpdate_:PIe});var gB;(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(gB||(gB={}));var _u=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.minimize=function(t,n,a){n===void 0&&(n=!1);var i=this.computeGradients(t,a),o=i.value,s=i.grads;if(a!=null){var u=a.map(function(c){return{name:c.name,tensor:s[c.name]}});this.applyGradients(u)}else this.applyGradients(s);return Fa(s),n?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!1,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,n){return fIe(t,n)},e.prototype.dispose=function(){this.iterations_!=null&&Fa(this.iterations_)},e.prototype.saveIterations=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Or(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(n){throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()))})})},e.prototype.extractIterations=function(t){return Ce(this,void 0,void 0,function(){var n;return Ee(this,function(a){switch(a.label){case 0:return n=this,[4,t[0].tensor.data()];case 1:return n.iterations_=a.sent()[0],[2,t.slice(1)]}})})},e}(jEe);Object.defineProperty(_u,Symbol.hasInstance,{value:function(r){return r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null}});(function(r){oe(e,r);function e(t,n,a){a===void 0&&(a=null);var i=r.call(this)||this;return i.learningRate=t,i.rho=n,i.epsilon=a,i.accumulatedGrads=[],i.accumulatedUpdates=[],a==null&&(i.epsilon=ve.backend.epsilon()),i}return Object.defineProperty(e,"className",{get:function(){return"Adadelta"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=ve.registeredVariables[i],u=!1;n.accumulatedGrads[o]==null&&(n.accumulatedGrads[o]={originalName:"".concat(i,"/accum_grad"),variable:Xr(function(){return Bt(s).variable(u)})}),n.accumulatedUpdates[o]==null&&(n.accumulatedUpdates[o]={originalName:"".concat(i,"/accum_var"),variable:Xr(function(){return Bt(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=n.accumulatedGrads[o].variable,f=n.accumulatedUpdates[o].variable;Xr(function(){var h=It(be(l,n.rho),be(Pr(c),1-n.rho)),p=be(Wt(Pi(It(f,n.epsilon)),Pi(It(l,n.epsilon))),c),d=It(be(f,n.rho),be(Pr(p),1-n.rho));l.assign(h),f.assign(d);var m=It(be(p,-n.learningRate),s);s.assign(m)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Fa(this.accumulatedGrads.map(function(t){return t.variable})),Fa(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){var t;return Ee(this,function(n){switch(n.label){case 0:return t=et(et([],te(this.accumulatedGrads),!1),te(this.accumulatedUpdates),!1),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var n,a;return Ee(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=t.length/2,a=!1,this.accumulatedGrads=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedUpdates=t.slice(n,n*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.rho,n.epsilon)},e})(_u);(function(r){oe(e,r);function e(t,n){n===void 0&&(n=.1);var a=r.call(this)||this;return a.learningRate=t,a.initialAccumulatorValue=n,a.accumulatedGrads=[],a}return Object.defineProperty(e,"className",{get:function(){return"Adagrad"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=ve.registeredVariables[i];if(n.accumulatedGrads[o]==null){var u=!1;n.accumulatedGrads[o]={originalName:"".concat(i,"/accumulator"),variable:Xr(function(){return rIe(s.shape,n.initialAccumulatorValue).variable(u)})}}var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=n.accumulatedGrads[o].variable;Xr(function(){var f=It(l,Pr(c));l.assign(f);var h=It(be(Wt(c,Pi(It(f,ve.backend.epsilon()))),-n.learningRate),s);s.assign(h)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&Fa(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var n;return Ee(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),n=!1,this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(n)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,n){return new t(n.learningRate,n.initialAccumulatorValue)},e})(_u);(function(r){oe(e,r);function e(t,n,a,i){i===void 0&&(i=null);var o=r.call(this)||this;return o.learningRate=t,o.beta1=n,o.beta2=a,o.epsilon=i,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],Xr(function(){o.accBeta1=Or(n).variable(),o.accBeta2=Or(a).variable()}),i==null&&(o.epsilon=ve.backend.epsilon()),o}return Object.defineProperty(e,"className",{get:function(){return"Adam"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Xr(function(){var i=mn(1,n.accBeta1),o=mn(1,n.accBeta2);a.forEach(function(s,u){var c=ve.registeredVariables[s],l=!1;n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:Xr(function(){return Bt(c).variable(l)})}),n.accumulatedSecondMoment[u]==null&&(n.accumulatedSecondMoment[u]={originalName:"".concat(s,"/v"),variable:Xr(function(){return Bt(c).variable(l)})});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=n.accumulatedFirstMoment[u].variable,p=n.accumulatedSecondMoment[u].variable,d=It(be(h,n.beta1),be(f,1-n.beta1)),m=It(be(p,n.beta2),be(Pr(f),1-n.beta2)),v=Wt(d,i),g=Wt(m,o);h.assign(d),p.assign(m);var y=It(be(Wt(v,It(Pi(g),n.epsilon)),-n.learningRate),c);c.assign(y)}}),n.accBeta1.assign(be(n.accBeta1,n.beta1)),n.accBeta2.assign(be(n.accBeta2,n.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Fa(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&Fa(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){var t;return Ee(this,function(n){switch(n.label){case 0:return t=et(et([],te(this.accumulatedFirstMoment),!1),te(this.accumulatedSecondMoment),!1),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var n,a,i=this;return Ee(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),Xr(function(){i.accBeta1.assign(Zv(i.beta1,i.iterations_+1)),i.accBeta2.assign(Zv(i.beta2,i.iterations_+1))}),n=t.length/2,a=!1,this.accumulatedFirstMoment=t.slice(0,n).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),this.accumulatedSecondMoment=t.slice(n,n*2).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon)},e})(_u);(function(r){oe(e,r);function e(t,n,a,i,o){i===void 0&&(i=null),o===void 0&&(o=0);var s=r.call(this)||this;return s.learningRate=t,s.beta1=n,s.beta2=a,s.epsilon=i,s.decay=o,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],Xr(function(){s.iteration=Or(0).variable(),s.accBeta1=Or(n).variable()}),i==null&&(s.epsilon=ve.backend.epsilon()),s}return Object.defineProperty(e,"className",{get:function(){return"Adamax"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Xr(function(){var i=mn(1,n.accBeta1),o=Wt(-n.learningRate,It(be(n.iteration,n.decay),1));a.forEach(function(s,u){var c=ve.registeredVariables[s],l=!1;n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:Bt(c).variable(l)}),n.accumulatedWeightedInfNorm[u]==null&&(n.accumulatedWeightedInfNorm[u]={originalName:"".concat(s,"/v"),variable:Bt(c).variable(l)});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=n.accumulatedFirstMoment[u].variable,p=n.accumulatedWeightedInfNorm[u].variable,d=It(be(h,n.beta1),be(f,1-n.beta1)),m=be(p,n.beta2),v=XEe(f),g=bq(m,v);h.assign(d),p.assign(g);var y=It(be(Wt(o,i),Wt(d,It(g,n.epsilon))),c);c.assign(y)}}),n.iteration.assign(It(n.iteration,1)),n.accBeta1.assign(be(n.accBeta1,n.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Fa(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&Fa(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(n){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)},e})(_u);var MIe=function(r){oe(e,r);function e(t){var n=r.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return Object.defineProperty(e,"className",{get:function(){return"SGD"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=ve.registeredVariables[i];Xr(function(){var c=It(be(n.c,s),u);u.assign(c)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=jNe(Or(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:if(t=n.sent(),t.length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,n){return new t(n.learningRate)},e}(_u);(function(r){oe(e,r);function e(t,n,a){a===void 0&&(a=!1);var i=r.call(this,t)||this;return i.learningRate=t,i.momentum=n,i.useNesterov=a,i.accumulations=[],i.m=Or(i.momentum),i}return Object.defineProperty(e,"className",{get:function(){return"Momentum"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=ve.registeredVariables[i];if(n.accumulations[o]==null){var u=!1;n.accumulations[o]={originalName:"".concat(i,"/momentum"),variable:Xr(function(){return Bt(s).variable(u)})}}var c=n.accumulations[o].variable,l=Array.isArray(t)?t[o].tensor:t[i];l!=null&&Xr(function(){var f,h=It(be(n.m,c),l);n.useNesterov?f=It(be(n.c,It(l,be(h,n.m))),s):f=It(be(n.c,h),s),c.assign(h),s.assign(f)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Fa(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var n;return Ee(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),n=!1,this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(n)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,n){return new t(n.learningRate,n.momentum,n.useNesterov)},e})(MIe);(function(r){oe(e,r);function e(t,n,a,i,o){n===void 0&&(n=.9),a===void 0&&(a=0),i===void 0&&(i=null),o===void 0&&(o=!1);var s=r.call(this)||this;if(s.learningRate=t,s.decay=n,s.momentum=a,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=o,i==null&&(s.epsilon=ve.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return Object.defineProperty(e,"className",{get:function(){return"RMSProp"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=ve.registeredVariables[i],u=!1;n.accumulatedMeanSquares[o]==null&&(n.accumulatedMeanSquares[o]={originalName:"".concat(i,"/rms"),variable:Xr(function(){return Bt(s).variable(u)})}),n.accumulatedMoments[o]==null&&(n.accumulatedMoments[o]={originalName:"".concat(i,"/momentum"),variable:Xr(function(){return Bt(s).variable(u)})}),n.accumulatedMeanGrads[o]==null&&n.centered&&(n.accumulatedMeanGrads[o]={originalName:"".concat(i,"/mg"),variable:Xr(function(){return Bt(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=n.accumulatedMeanSquares[o].variable,f=n.accumulatedMoments[o].variable;Xr(function(){var h=It(be(l,n.decay),be(Pr(c),1-n.decay));if(n.centered){var p=n.accumulatedMeanGrads[o].variable,d=It(be(p,n.decay),be(c,1-n.decay)),m=Wt(be(c,n.learningRate),Pi(mn(h,It(Pr(d),n.epsilon)))),v=It(be(f,n.momentum),m);l.assign(h),p.assign(d),f.assign(v);var g=mn(s,v);s.assign(g)}else{var y=It(be(l,n.decay),be(Pr(c),1-n.decay)),v=It(be(f,n.momentum),Wt(be(c,n.learningRate),Pi(It(y,n.epsilon))));l.assign(y),f.assign(v);var g=mn(s,v);s.assign(g)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Fa(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&Fa(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&Fa(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){var t;return Ee(this,function(n){switch(n.label){case 0:return t=et(et([],te(this.accumulatedMeanSquares),!1),te(this.accumulatedMoments),!1),this.centered&&t.push.apply(t,et([],te(this.accumulatedMeanGrads),!1)),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var n,a;return Ee(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=this.centered?t.length/3:t.length/2,a=!1,this.accumulatedMeanSquares=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedMoments=t.slice(n,n*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(n*2,n*3).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,n){return new t(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)},e})(_u);(function(){return typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:function(r){return r()}})();var yB;(function(r){r[r.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",r[r.VALUE_ROWIDS=1]="VALUE_ROWIDS",r[r.ROW_LENGTHS=2]="ROW_LENGTHS",r[r.ROW_SPLITS=3]="ROW_SPLITS",r[r.ROW_LIMITS=4]="ROW_LIMITS",r[r.ROW_STARTS=5]="ROW_STARTS"})(yB||(yB={}));var BIe=1.7580993408473768,LIe=1.0507009873554805;function qIe(r,e,t){var n=r.shape.slice();n[t]=1;var a=tt(e,n),i=mB(r,t,!0,!1),o=mB(r,t,!0,!0),s=be(i,o);return be(a,s)}function zIe(r,e,t){var n=r.shape.length,a=n-t.length,i=fq(t,n),o=r;i!=null&&(o=el(r,i));var s=o.shape.slice(),u=s.splice(n-t.length,t.length),c=u.reduce(function(p,d){return p*d},1);s.push(c);var l=o.reshape(s),f=qIe(l,e,a);if(f=f.reshape(o.shape),i!=null){var h=O1(i);f=el(f,h)}return f}var $Ie={kernelName:w2e,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.axis,o=[];return i==null?o=a.shape.map(function(s,u){return u}):typeof i=="number"?o=[i]:o=i,{x:function(){return zIe(a,r,o)}}}},WIe={kernelName:uL,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=Nn(n.shape,a.shape),o=function(){var u=Wt(r,At(a,"float32")),c=gn(n.shape,i);return c.length>0?tt(Ar(u,c),n.shape):u},s=function(){var u=be(r,At(n,"float32")),c=gn(a.shape,i);c.length>0&&(u=tt(Ar(u,c),a.shape));var l=Pr(a);return si(Wt(u,At(l,"float32")))};return{a:o,b:s}}},UIe={kernelName:k2e,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Wt(r,si(Pr(n)))}}}},VIe={kernelName:C2e,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0],a=be(R1(n,6),_1(n));return{x:function(){return be(r,At(a,"float32"))}}}},GIe={kernelName:S2e,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(r,At(_1(n),"float32"))}}}},HIe={kernelName:kL,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return tt(r,n.shape)}}}},jIe={kernelName:E2e,inputsToSave:["images"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i={dy:r,images:a},o=function(){return ve.runKernel(I2e,i,t)};return{images:o}}},KIe={kernelName:N2e,inputsToSave:["images"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i={dy:r,images:a},o=function(){return ve.runKernel(T2e,i,t)};return{images:o}}};var XIe={kernelName:SL,gradFunc:function(r,e,t){var n=t.dims,a=Eu(n,r.shape);return{x:function(){return OIe(r,a)}}}};var YIe={kernelName:A2e,gradFunc:function(r){return{x:function(){return Bt(r)}}}},JIe={kernelName:NL,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return si(Wt(r,be(Zv(n,1.5),2)))}}}},ZIe={kernelName:TL,inputsToSave:["condition"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{condition:function(){return At(Bt(n),"float32")},t:function(){return be(r,At(n,r.dtype))},e:function(){return be(r,At(pIe(n),r.dtype))}}}},QIe={kernelName:_2e,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){var a=Fh(n,Or(0)),i=Or(BIe),o=Or(LIe),s=be(r,o),u=be(be(r,i),ym(At(n,"float32")));return Nu(a,s,u)}}}},eCe={kernelName:AL,outputsToSave:[!0],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(r,be(n,mn(Or(1),n)))}}}};var tCe={kernelName:F2e,gradFunc:function(r){return{x:function(){return Bt(r)}}}},rCe={kernelName:IL,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(yq(At(n,"float32")),r)}}}},nCe={kernelName:CL,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(iIe(At(n,"float32")),r)}}}},aCe={kernelName:EL,inputsToSave:["x"],gradFunc:function(r,e,t){for(var n=te(e,1),a=n[0],i=t.begin,o=t.size,s=a.shape,u=te(HEe(a,i,o),2),c=u[0],l=u[1],f=[],h=0;h<r.rank;h++)f.push([c[h],s[h]-c[h]-l[h]]);return{x:function(){return mIe(r,f)}}}},iCe={kernelName:O2e,outputsToSave:[!0],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.dim,o=!0,s=be(r,a);return{logits:function(){return mn(s,be(Ar(s,[i],o),a))}}}},oCe={kernelName:R2e,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(r,QEe(n))}}}};var bB={kernelName:FL,gradFunc:function(r,e,t){var n=t.blockShape,a=t.paddings;return{x:function(){return tIe(r,n,a)}}}};var wB={kernelName:RL,gradFunc:function(r,e,t){var n=t.axis;return{x:function(){return JEe(r,n)}}}},sCe={kernelName:DL,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Wt(r,be(Pi(At(n,"float32")),2))}}}},uCe={kernelName:M2e,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(r,be(At(n,"float32"),2))}}}},cCe={kernelName:P2e,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=Or(2),o=function(){return be(r,be(i,mn(n,a)))},s=function(){return be(r,be(i,mn(a,n)))};return{a:o,b:s}}};var lCe={kernelName:LL,gradFunc:function(r){return{x:function(){return Bt(r)}}}},fCe={kernelName:OL,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=Nn(n.shape,a.shape),o=function(){var u=r,c=gn(n.shape,i);return c.length>0&&(u=Ar(u,c)),tt(u,n.shape)},s=function(){var u=r,c=gn(a.shape,i);return c.length>0&&(u=Ar(u,c)),tt(si(u),a.shape)};return{a:o,b:s}}},hCe={kernelName:_L,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=a.shape.slice(),o=t.axis,s=Eu(o,a.shape);s.forEach(function(l){i[l]=1});var u=tt(r,i),c=be(u,bm(a.shape,"float32"));return{x:function(){return c}}}},pCe={kernelName:B2e,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Wt(r,Pr(yq(n)))}}}},dCe={kernelName:L2e,outputsToSave:[!0],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(mn(Or(1),Pr(n)),r)}}}},vCe={kernelName:x1,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.reps,o=function(){var s=Bt(a);if(a.rank===1)for(var u=0;u<i[0];++u)s=It(s,Yc(r,[u*a.shape[0]],[a.shape[0]]));else if(a.rank===2)for(var u=0;u<i[0];++u)for(var c=0;c<i[1];++c)s=It(s,Yc(r,[u*a.shape[0],c*a.shape[1]],[a.shape[0],a.shape[1]]));else if(a.rank===3)for(var u=0;u<i[0];++u)for(var c=0;c<i[1];++c)for(var l=0;l<i[2];++l)s=It(s,Yc(r,[u*a.shape[0],c*a.shape[1],l*a.shape[2]],[a.shape[0],a.shape[1],a.shape[2]]));else if(a.rank===4)for(var u=0;u<i[0];++u)for(var c=0;c<i[1];++c)for(var l=0;l<i[2];++l)for(var f=0;f<i[3];++f)s=It(s,Yc(r,[u*a.shape[0],c*a.shape[1],l*a.shape[2],f*a.shape[3]],[a.shape[0],a.shape[1],a.shape[2],a.shape[3]]));else throw new Error("Gradient for tile operation is not implemented for rank-"+"".concat(a.rank," tensors yet."));return s};return{x:o}}};var mCe={kernelName:qv,gradFunc:function(r,e,t){var n=t,a=n.perm,i=O1(a);return{x:function(){return el(r,i)}}}};var gCe={kernelName:PL,gradFunc:function(r,e,t){var n=t,a=n.axis;return{value:function(){return hq(r,a)}}}},yCe={kernelName:ML,inputsToSave:["segmentIds"],gradFunc:function(r,e){var t=te(e,1),n=t[0],a=function(){return bCe(r,n)};return{x:a}}};function bCe(r,e){for(var t=bq(e,Bt(e)),n=lIe(r,t),a=F1(e,Or(0,"int32")),i=n.rank-a.rank,o=0;o<i;++o)a=uIe(a,o+1);a=uq(a,bm(n.shape,"bool"));var s=Bt(n);return Nu(a,n,s)}var wCe={kernelName:BL,gradFunc:function(r){return{x:function(){return Bt(r)}}}},Lw,xB,xCe=[iq,LSe,qSe,WSe,USe,GSe,HSe,jSe,XSe,YSe,JSe,ZSe,tNe,aNe,oNe,cNe,lNe,fNe,hNe,bNe,wNe,SNe,DNe,INe,PNe,LNe,$Ne,eTe,iTe,oTe,WIe,sTe,cTe,lTe,fTe,hTe,dTe,pTe,bTe,STe,NTe,TTe,ETe,ITe,CTe,DTe,_Te,FTe,RTe,MTe,cB,cB,$Te,VTe,jTe,KTe,XTe,YTe,ZTe,tEe,rEe,nEe,aEe,iEe,uEe,lB,lB,hEe,pEe,$Ie,UIe,VIe,GIe,HIe,jIe,KIe,XIe,YIe,JIe,ZIe,QIe,eCe,tCe,rCe,nCe,aCe,iCe,oCe,bB,bB,wB,wB,sCe,cCe,uCe,lCe,fCe,hCe,pCe,dCe,vCe,mCe,gCe,yCe,wCe];try{for(dh=fe(xCe),Hc=dh.next();!Hc.done;Hc=dh.next())kB=Hc.value,tSe(kB)}catch(r){Lw={error:r}}finally{try{Hc&&!Hc.done&&(xB=dh.return)&&xB.call(dh)}finally{if(Lw)throw Lw.error}}var kB,dh,Hc;function L1(r,e){return F.tidy(function(){return A.sqrt(A.sum(A.mul(r,r),e,!0))})}var Oh=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getConfig=function(){return{}},e}(F.serialization.Serializable),q1=function(r){oe(e,r);function e(t){var n=r.call(this)||this;return n.defaultMaxValue=2,n.defaultAxis=0,n.maxValue=t.maxValue!=null?t.maxValue:n.defaultMaxValue,n.axis=t.axis!=null?t.axis:n.defaultAxis,n}return e.prototype.apply=function(t){var n=this;return F.tidy(function(){var a=L1(t,n.axis),i=A.clipByValue(a,0,n.maxValue);return A.mul(t,A.div(i,A.add(Yr(),a)))})},e.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},e}(Oh);q1.className="MaxNorm";F.serialization.registerClass(q1);var z1=function(r){oe(e,r);function e(t){var n=r.call(this)||this;return n.defaultAxis=0,n.axis=t.axis!=null?t.axis:n.defaultAxis,n}return e.prototype.apply=function(t){var n=this;return F.tidy(function(){return A.div(t,A.add(Yr(),L1(t,n.axis)))})},e.prototype.getConfig=function(){return{axis:this.axis}},e}(Oh);z1.className="UnitNorm";F.serialization.registerClass(z1);var $1=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return A.relu(t)},e}(Oh);$1.className="NonNeg";F.serialization.registerClass($1);var W1=function(r){oe(e,r);function e(t){var n=r.call(this)||this;return n.defaultMinValue=0,n.defaultMaxValue=1,n.defaultRate=1,n.defaultAxis=0,n.minValue=t.minValue!=null?t.minValue:n.defaultMinValue,n.maxValue=t.maxValue!=null?t.maxValue:n.defaultMaxValue,n.rate=t.rate!=null?t.rate:n.defaultRate,n.axis=t.axis!=null?t.axis:n.defaultAxis,n}return e.prototype.apply=function(t){var n=this;return F.tidy(function(){var a=L1(t,n.axis),i=A.add(A.mul(n.rate,A.clipByValue(a,n.minValue,n.maxValue)),A.mul(1-n.rate,a));return A.mul(t,A.div(i,A.add(Yr(),a)))})},e.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},e}(Oh);W1.className="MinMaxNorm";F.serialization.registerClass(W1);var SB={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Jr(r){return s1(r)}function NB(r,e){return e===void 0&&(e={}),Ih(r,F.serialization.SerializationMap.getMap().classNameMap,e,"constraint")}function Zr(r){if(r==null)return null;if(typeof r=="string"){var e=r in SB?SB[r]:r,t={className:e,config:{}};return NB(t)}else return r instanceof Oh?r:NB(r)}function kCe(r){return new q1(r)}function SCe(r){return new z1(r)}function NCe(){return new $1}function TCe(r){return new W1(r)}var ECe={__proto__:null,maxNorm:kCe,minMaxNorm:TCe,nonNeg:NCe,unitNorm:SCe};function ICe(){return new l1}function CCe(){return new cm}function ACe(r){return new f1(r)}function DCe(r){return new h1(r)}function _Ce(r){return new p1(r)}function FCe(r){return new d1(r)}function RCe(r){return new v1(r)}function OCe(r){return new Vn(r)}function PCe(r){return new lm(r)}function MCe(r){return new fm(r)}function BCe(r){return new hm(r)}function LCe(r){return new pm(r)}function qCe(r){return new dm(r)}function zCe(r){return new vm(r)}function $Ce(r){return new m1(r)}var WCe={__proto__:null,constant:ACe,glorotNormal:MCe,glorotUniform:PCe,heNormal:BCe,heUniform:LCe,identity:RCe,leCunNormal:qCe,leCunUniform:zCe,ones:CCe,orthogonal:$Ce,randomNormal:_Ce,randomUniform:DCe,truncatedNormal:FCe,varianceScaling:OCe,zeros:ICe};function vs(r){return Ce(this,void 0,void 0,function(){var e,t,n,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:if(r==null)return[2];e=[],t=[],n=[];for(a in r)i=r[a],typeof i!="number"&&(o=i,e.push(o.data()),t.push(a),n.push(o));return e.length>0?[4,Promise.all(e)]:[3,2];case 1:for(s=c.sent(),u=0;u<s.length;++u)r[t[u]]=s[u][0];F.dispose(n),c.label=2;case 2:return[2]}})})}function Iq(r){if(r!=null)for(var e in r){var t=r[e];typeof t!="number"&&t.dispose()}}var TB;(function(r){r[r.SILENT=0]="SILENT",r[r.VERBOSE=1]="VERBOSE"})(TB||(TB={}));var UCe=125,tl=function(){function r(){this.validationData=null}return r.prototype.setParams=function(e){this.params=e},r.prototype.onEpochBegin=function(e,t){return Ce(this,void 0,void 0,function(){return Ee(this,function(n){return[2]})})},r.prototype.onEpochEnd=function(e,t){return Ce(this,void 0,void 0,function(){return Ee(this,function(n){return[2]})})},r.prototype.onBatchBegin=function(e,t){return Ce(this,void 0,void 0,function(){return Ee(this,function(n){return[2]})})},r.prototype.onBatchEnd=function(e,t){return Ce(this,void 0,void 0,function(){return Ee(this,function(n){return[2]})})},r.prototype.onTrainBegin=function(e){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){return[2]})})},r.prototype.onTrainEnd=function(e){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){return[2]})})},r.prototype.setModel=function(e){},r}(),Cq=function(){function r(e,t){t===void 0&&(t=10),e==null&&(e=[]),this.callbacks=e,this.queueLength=t}return r.prototype.append=function(e){this.callbacks.push(e)},r.prototype.setParams=function(e){var t,n;try{for(var a=fe(this.callbacks),i=a.next();!i.done;i=a.next()){var o=i.value;o.setParams(e)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},r.prototype.setModel=function(e){var t,n;try{for(var a=fe(this.callbacks),i=a.next();!i.done;i=a.next()){var o=i.value;o.setModel(e)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},r.prototype.onEpochBegin=function(e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),n=fe(this.callbacks),a=n.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onEpochBegin(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},r.prototype.onEpochEnd=function(e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),n=fe(this.callbacks),a=n.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onEpochEnd(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},r.prototype.onBatchBegin=function(e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),n=fe(this.callbacks),a=n.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onBatchBegin(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},r.prototype.onBatchEnd=function(e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),n=fe(this.callbacks),a=n.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onBatchEnd(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},r.prototype.onTrainBegin=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s;return Ee(this,function(u){switch(u.label){case 0:e==null&&(e={}),u.label=1;case 1:u.trys.push([1,6,7,8]),t=fe(this.callbacks),n=t.next(),u.label=2;case 2:return n.done?[3,5]:(a=n.value,[4,a.onTrainBegin(e)]);case 3:u.sent(),u.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return i=u.sent(),o={error:i},[3,8];case 7:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},r.prototype.onTrainEnd=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s;return Ee(this,function(u){switch(u.label){case 0:e==null&&(e={}),u.label=1;case 1:u.trys.push([1,6,7,8]),t=fe(this.callbacks),n=t.next(),u.label=2;case 2:return n.done?[3,5]:(a=n.value,[4,a.onTrainEnd(e)]);case 3:u.sent(),u.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return i=u.sent(),o={error:i},[3,8];case 7:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},r}(),VCe=function(r){oe(e,r);function e(){return r.call(this)||this}return e.prototype.onEpochBegin=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(n){return this.seen=0,this.totals={},[2]})})},e.prototype.onBatchEnd=function(t,n){return Ce(this,void 0,void 0,function(){var a,i,o,s,u=this;return Ee(this,function(c){n==null&&(n={}),a=n.size==null?0:n.size,this.seen+=a,i=function(l){var f=n[l];if(typeof f=="number")o.totals.hasOwnProperty(l)||(o.totals[l]=0),o.totals[l]=o.totals[l]+f*a;else{var h=void 0;l in o.totals?h=o.totals[l]:o.totals[l]=0;var p=F.tidy(function(){return F.add(u.totals[l],F.mul(f,a))});o.totals[l]=p,h?.dispose()}},o=this;for(s in n)i(s);return[2]})})},e.prototype.onEpochEnd=function(t,n){return Ce(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f=this;return Ee(this,function(h){if(n!=null){a=function(p){if(i.totals[p]==null)return"continue";typeof i.totals[p]=="number"?n[p]=i.totals[p]/i.seen:F.tidy(function(){var d=F.mul(F.div(1,f.seen),f.totals[p]);n[p]=d,f.totals[p].dispose(),F.keep(n[p])})},i=this;try{for(o=fe(this.params.metrics),s=o.next();!s.done;s=o.next())u=s.value,a(u)}catch(p){c={error:p}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}}return[2]})})},e}(tl),Aq=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.onTrainBegin=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(n){return this.epoch=[],this.history={},[2]})})},e.prototype.onEpochEnd=function(t,n){return Ce(this,void 0,void 0,function(){var a;return Ee(this,function(i){n==null&&(n={}),this.epoch.push(t);for(a in n)this.history[a]==null&&(this.history[a]=[]),this.history[a].push(n[a]);return[2]})})},e.prototype.syncData=function(){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f;return Ee(this,function(h){switch(h.label){case 0:t=[],n=[],a=[];for(i in this.history)for(o=this.history[i],s=0;s<o.length;++s)typeof o[s]!="number"&&(u=o[s],t.push(u.data()),n.push(i),a.push(s));return[4,Promise.all(t)];case 1:for(c=h.sent(),l=0;l<c.length;++l)f=this.history[n[l]][a[l]],f.dispose(),this.history[n[l]][a[l]]=c[l][0];return[2]}})})},e}(tl),Dq=function(r){oe(e,r);function e(t,n){var a=r.call(this)||this;if(a.currentEpoch=0,a.nowFunc=t.nowFunc,a.nextFrameFunc=t.nextFrameFunc||F.nextFrame,a.yieldEvery=n||"auto",a.yieldEvery==="auto"&&(a.yieldEvery=UCe),a.yieldEvery==="never"&&t.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return F.util.isNumber(a.yieldEvery)&&(a.maybeWait=Dxe(a.maybeWait.bind(a),a.yieldEvery,a.nowFunc)),a.trainBegin=t.onTrainBegin,a.trainEnd=t.onTrainEnd,a.epochBegin=t.onEpochBegin,a.epochEnd=t.onEpochEnd,a.batchBegin=t.onBatchBegin,a.batchEnd=t.onBatchEnd,a.yield=t.onYield,a}return e.prototype.maybeWait=function(t,n,a){return Ce(this,void 0,void 0,function(){var i;return Ee(this,function(o){switch(o.label){case 0:return i=[],this.yield==null?[3,2]:[4,vs(a)];case 1:o.sent(),i.push(this.yield(t,n,a)),o.label=2;case 2:return i.push(this.nextFrameFunc()),[4,Promise.all(i)];case 3:return o.sent(),[2]}})})},e.prototype.onEpochBegin=function(t,n){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){switch(a.label){case 0:return this.currentEpoch=t,this.epochBegin==null?[3,3]:[4,vs(n)];case 1:return a.sent(),[4,this.epochBegin(t,n)];case 2:a.sent(),a.label=3;case 3:return[2]}})})},e.prototype.onEpochEnd=function(t,n){return Ce(this,void 0,void 0,function(){var a;return Ee(this,function(i){switch(i.label){case 0:return a=[],this.epochEnd==null?[3,2]:[4,vs(n)];case 1:i.sent(),a.push(this.epochEnd(t,n)),i.label=2;case 2:return this.yieldEvery==="epoch"&&a.push(this.nextFrameFunc()),[4,Promise.all(a)];case 3:return i.sent(),[2]}})})},e.prototype.onBatchBegin=function(t,n){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){switch(a.label){case 0:return this.batchBegin==null?[3,3]:[4,vs(n)];case 1:return a.sent(),[4,this.batchBegin(t,n)];case 2:a.sent(),a.label=3;case 3:return[2]}})})},e.prototype.onBatchEnd=function(t,n){return Ce(this,void 0,void 0,function(){var a;return Ee(this,function(i){switch(i.label){case 0:return a=[],this.batchEnd==null?[3,2]:[4,vs(n)];case 1:i.sent(),a.push(this.batchEnd(t,n)),i.label=2;case 2:return this.yieldEvery==="batch"?a.push(this.nextFrameFunc()):F.util.isNumber(this.yieldEvery)&&a.push(this.maybeWait(this.currentEpoch,t,n)),[4,Promise.all(a)];case 3:return i.sent(),[2]}})})},e.prototype.onTrainBegin=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(n){switch(n.label){case 0:return this.trainBegin==null?[3,3]:[4,vs(t)];case 1:return n.sent(),[4,this.trainBegin(t)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.onTrainEnd=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(n){switch(n.label){case 0:return this.trainEnd==null?[3,3]:[4,vs(t)];case 1:return n.sent(),[4,this.trainEnd(t)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e}(tl);function _q(r,e){if(r==null&&(r={}),r instanceof tl)return[r];if(Array.isArray(r)&&r[0]instanceof tl)return r;var t=$t(r);return t.map(function(n){return new Dq(n,e)})}var U1=function(){function r(){}return r.registerCallbackConstructor=function(e,t){F.util.assert(e>=0&&Number.isInteger(e),function(){return"Verbosity level is expected to be an integer >= 0, "+"but got ".concat(e)}),r.checkForDuplicate(t),r.constructors[e]==null&&(r.constructors[e]=[]),r.constructors[e].push(t)},r.checkForDuplicate=function(e){for(var t in r.constructors){var n=r.constructors[+t];n.forEach(function(a){if(a===e)throw new J("Duplicate callback constructor.")})}},r.clear=function(){r.constructors={}},r.createCallbacks=function(e){var t=[];for(var n in r.constructors){var a=+n;e>=a&&t.push.apply(t,et([],te(r.constructors[a]),!1))}return t.map(function(i){return new i})},r}();U1.constructors={};function Fq(r,e,t,n,a,i,o,s,u){var c=new Aq,l=et([new VCe],te(U1.createCallbacks(e)),!1);r!=null&&l.push.apply(l,et([],te(r),!1)),l.push(c);var f=new Cq(l);return f.setParams({epochs:t,initialEpoch:n,samples:a,steps:i,batchSize:o,verbose:e,doValidation:s,metrics:u}),{callbackList:f,history:c}}function Di(r,e,t){return e===void 0&&(e={}),t===void 0&&(t=!1),Ih(r,F.serialization.SerializationMap.getMap().classNameMap,e,"layer",t)}function rm(r,e){return F.tidy(function(){r.dtype!=="float32"&&(r=A.cast(r,"float32"));var t=A.sum(Ah(r),e,!0),n=A.fill(t.shape,Yr()),a=A.sqrt(A.maximum(t,n));return A.div(r,a)})}function Fu(r,e){return F.tidy(function(){return A.mean(Ah(A.sub(e,r)),-1)})}function xm(r,e){return F.tidy(function(){return A.mean(A.abs(A.sub(e,r)),-1)})}function al(r,e){return F.tidy(function(){var t=A.sub(r,e),n=A.clipByValue(A.abs(r),Yr(),Number.MAX_VALUE),a=A.abs(A.div(t,n));return A.mul(100,A.mean(a,-1))})}function GCe(r,e){return F.tidy(function(){var t=A.clipByValue(e,Yr(),Number.MAX_VALUE),n=A.log(A.add(1,t)),a=A.clipByValue(r,Yr(),Number.MAX_VALUE),i=A.log(A.add(1,a));return A.mean(Ah(A.sub(n,i)),-1)})}function HCe(r,e){return F.tidy(function(){var t=A.maximum(0,A.sub(1,A.mul(r,e)));return A.mean(Ah(t),-1)})}function jCe(r,e){return F.tidy(function(){var t=A.maximum(0,A.sub(1,A.mul(r,e)));return A.mean(t,-1)})}function KCe(r,e){return F.tidy(function(){var t=A.sum(A.mul(r,e),-1),n=A.max(A.mul(A.sub(1,r),e),-1);return A.maximum(0,A.add(1,A.sub(n,t)))})}function XCe(r,e){return F.tidy(function(){var t=Math.log(2),n=A.sub(e,r),a=A.sub(A.add(n,A.softplus(A.mul(-2,n))),t);return A.mean(a,-1)})}function Nh(r,e,t){return t===void 0&&(t=!1),F.tidy(function(){if(t)e=A.softmax(e);else{var n=A.sum(e,e.shape.length-1,!0);e=A.div(e,n)}return e=A.clipByValue(e,Yr(),1-Yr()),A.neg(A.sum(A.mul(A.cast(r,"float32"),A.log(e)),e.shape.length-1))})}function nm(r,e,t){return t===void 0&&(t=!1),F.tidy(function(){var n=A.cast(A.floor(Wxe(r)),"int32");e=A.clipByValue(e,Yr(),1-Yr());var a=e.shape,i=A.reshape(A.oneHot(n,a[a.length-1]),a);return Nh(i,e,t)})}function YCe(r,e){if(!F.util.arraysEqual(r.shape,e.shape))throw new J("logits and labels must have the same shape, but got shapes "+"".concat(JSON.stringify(r.shape)," and ").concat(JSON.stringify(e.shape)));return F.tidy(function(){var t=A.relu(e),n=A.neg(A.abs(e));return A.add(A.sub(t,A.mul(e,r)),A.log1p(A.exp(n)))})}function km(r,e){return F.tidy(function(){var t;return t=A.clipByValue(e,Yr(),1-Yr()),t=A.log(A.div(t,A.sub(1,t))),A.mean(YCe(r,t),-1)})}function JCe(r,e){return F.tidy(function(){var t=A.clipByValue(r,Yr(),1),n=A.clipByValue(e,Yr(),1);return A.sum(A.mul(r,A.log(A.div(t,n))),-1)})}function ZCe(r,e){return F.tidy(function(){var t=A.log(A.add(Yr(),e));return A.mean(A.sub(e,A.mul(r,t)),-1)})}function V1(r,e){return F.tidy(function(){var t=rm(r,-1),n=rm(e,-1),a=A.mul(t,n);return A.neg(A.sum(a,-1))})}var am={meanSquaredError:Fu,meanAbsoluteError:xm,meanAbsolutePercentageError:al,meanSquaredLogarithmicError:GCe,squaredHinge:HCe,hinge:jCe,categoricalHinge:KCe,logcosh:XCe,categoricalCrossentropy:Nh,sparseCategoricalCrossentropy:nm,binaryCrossentropy:km,kullbackLeiblerDivergence:JCe,poisson:ZCe,cosineProximity:V1};function qw(r){if(typeof r=="string"){if(r in am)return am[r];var e="Unknown loss ".concat(r);throw r.toLowerCase().includes("softmaxcrossentropy")&&(e="Unknown loss ".concat(r,". ")+'Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new J(e)}else return r}function G1(r,e){return F.tidy(function(){var t=A.mul(.5,A.onesLike(e)),n=Qi(A.greater(e,t),r.dtype);return A.mean(A.equal(r,n),-1)})}function H1(r,e){return F.tidy(function(){return Qi(A.equal(A.argMax(r,-1),A.argMax(e,-1)),"float32")})}function Rq(r,e){return F.tidy(function(){return A.cast(A.sum(A.logicalAnd(A.equal(r,1),A.equal(e,1))),"float32")})}function QCe(r,e){return F.tidy(function(){return A.cast(A.sum(A.logicalAnd(A.equal(r,1),A.equal(e,0))),"float32")})}function eAe(r,e){return F.tidy(function(){return A.cast(A.sum(A.logicalAnd(A.equal(r,0),A.equal(e,1))),"float32")})}function Oq(r,e){return F.tidy(function(){var t=Rq(r,e),n=eAe(r,e),a=A.add(t,n);return A.cast(A.where(A.greater(a,0),A.div(t,a),0),"float32")})}function tAe(r,e){return F.tidy(function(){var t=Rq(r,e),n=QCe(r,e),a=A.add(t,n);return A.cast(A.where(A.greater(a,0),A.div(t,a),0),"float32")})}function Pq(r,e){return km(r,e)}function Mq(r,e){return r.rank===e.rank&&(r=A.squeeze(r,[r.rank-1])),e=A.argMax(e,-1),e.dtype!==r.dtype&&(e=A.cast(e,r.dtype)),A.cast(A.equal(r,e),"float32")}var rAe=Fu,nAe=Fu,aAe=xm,iAe=xm,oAe=al,sAe=al,j1=Nh,uAe=V1,Bq=nm,im={binaryAccuracy:G1,categoricalAccuracy:H1,precision:Oq,categoricalCrossentropy:j1,sparseCategoricalCrossentropy:Bq,mse:rAe,MSE:nAe,mae:aAe,MAE:iAe,mape:oAe,MAPE:sAe,cosine:uAe};function cAe(r){if(typeof r=="string"&&r in im)return im[r];if(typeof r!="string"&&r!=null)return r;throw new J("Unknown metric ".concat(r))}function Bv(r){var e,t,n,a;if(Yi(r!==null,"Unknown LossOrMetricFn ".concat(r)),typeof r=="string")return r;var i=void 0;try{for(var o=fe(Object.keys(am)),s=o.next();!s.done;s=o.next()){var u=s.value;if(am[u]===r){i=u;break}}}catch(f){e={error:f}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}if(i!==void 0)return i;try{for(var c=fe(Object.keys(im)),l=c.next();!l.done;l=c.next()){var u=l.value;if(im[u]===r){i=u;break}}}catch(f){n={error:f}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}return i!==void 0?i:r.name}function lAe(r){var e={Adagrad:function(){return F.train.adagrad(.01)},Adadelta:function(){return F.train.adadelta(1,.95,Yr())},Adam:function(){return F.train.adam(.001,.9,.999,Yr())},Adamax:function(){return F.train.adamax(.002,.9,.999,Yr(),0)},RMSProp:function(){return F.train.rmsprop(.001,.9,0,Yr())},SGD:function(){return F.train.sgd(.01)}};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,r in e)return e[r]();throw new J("Unknown Optimizer ".concat(r))}var EB=1*1024*1024;function IB(r,e,t){if(t===void 0&&(t=!1),r==null||typeof r!="object"||Object.getPrototypeOf(r)!==Object.prototype||!n1(r))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){var n=JSON.stringify(r);n.length>EB&&console.warn('User-defined metadata of model "'.concat(e,'" is too large in ')+"size (length=".concat(n.length," when serialized). It is not ")+"recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+"".concat(EB,"."))}}function n1(r){var e,t,n,a;if(r===null)return!0;if(typeof r=="object")if(Object.getPrototypeOf(r)===Object.prototype){var i=Object.keys(r);try{for(var o=fe(i),s=o.next();!s.done;s=o.next()){var u=s.value;if(typeof u!="string"||!n1(r[u]))return!1}}catch(p){e={error:p}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return!0}else if(Array.isArray(r)){try{for(var c=fe(r),l=c.next();!l.done;l=c.next()){var f=l.value;if(!n1(f))return!1}}catch(p){n={error:p}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}return!0}else return!1;else{var h=typeof r;return h==="string"||h==="number"||h==="boolean"}}function fAe(r,e,t,n){n===void 0&&(n=console.log);var a=pAe(r),i=["Layer (type)","Input Shape","Output shape","Param #"];a?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(function(h){return Math.floor(e*h)}));var o;if(!a){i.push("Receives inputs"),o=[];for(var s in r.nodesByDepth)o.push.apply(o,et([],te(r.nodesByDepth[s]),!1))}n("_".repeat(e)),om(i,t,n),n("=".repeat(e));for(var u=r.layers,c=0;c<u.length;++c)a?dAe(u[c],t,n):vAe(u[c],t,o,n),n((c===u.length-1?"=":"_").repeat(e));r.checkTrainableWeightsConsistency();var l=hAe(r),f=Vv(r.nonTrainableWeights);n("Total params: ".concat(l+f)),n("Trainable params: ".concat(l)),n("Non-trainable params: ".concat(f)),n("_".repeat(e))}function hAe(r){var e;return r.collectedTrainableWeights!=null?e=Vv(r.collectedTrainableWeights):e=Vv(r.trainableWeights),e}function pAe(r){var e,t,n,a,i,o,s=!0,u=[],c=[];for(var l in r.nodesByDepth)u.push(r.nodesByDepth[l]);try{for(var f=fe(u),h=f.next();!h.done;h=f.next()){var p=h.value;if(p.length>1||p.length===1&&p[0].inboundLayers.length>1){s=!1;break}c.push.apply(c,et([],te(p),!1))}}catch(x){e={error:x}}finally{try{h&&!h.done&&(t=f.return)&&t.call(f)}finally{if(e)throw e.error}}if(s)try{for(var d=fe(r.layers),m=d.next();!m.done;m=d.next()){var v=m.value,g=!1;try{for(var y=(i=void 0,fe(v.inboundNodes)),w=y.next();!w.done;w=y.next()){var b=w.value;if(c.indexOf(b)!==-1)if(g){s=!1;break}else g=!0}}catch(x){i={error:x}}finally{try{w&&!w.done&&(o=y.return)&&o.call(y)}finally{if(i)throw i.error}}if(!s)break}}catch(x){n={error:x}}finally{try{m&&!m.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}return s}function om(r,e,t){t===void 0&&(t=console.log);for(var n="",a=0;a<r.length;++a)a>0&&(n=n.slice(0,n.length-1)+" "),n+=r[a],n=n.slice(0,e[a]),n+=" ".repeat(e[a]-n.length);t(n)}function dAe(r,e,t){var n,a;try{a=r.inboundNodes.map(function(u){return JSON.stringify(u.inputShapes)}).join(",")}catch{a="multiple"}try{n=JSON.stringify(r.outputShape)}catch{n="multiple"}var i=r.name,o=r.getClassName(),s=["".concat(i," (").concat(o,")"),a,n,r.countParams().toString()];om(s,e,t)}function vAe(r,e,t,n){var a,i,o,s;try{s=r.inboundNodes.map(function(b){return JSON.stringify(b.inputShapes)}).join(",")}catch{s="multiple"}try{o=JSON.stringify(r.outputShape)}catch{o="multiple"}var u=[];try{for(var c=fe(r.inboundNodes),l=c.next();!l.done;l=c.next()){var f=l.value;if(!(t!=null&&t.length>0&&t.indexOf(f)===-1))for(var h=0;h<f.inboundLayers.length;++h){var p=f.inboundLayers[h].name,d=f.nodeIndices[h],m=f.tensorIndices[h];u.push("".concat(p,"[").concat(d,"][").concat(m,"]"))}}}catch(b){a={error:b}}finally{try{l&&!l.done&&(i=c.return)&&i.call(c)}finally{if(a)throw a.error}}var v=r.name,g=r.getClassName(),y=u.length===0?"":u[0],w=["".concat(v," (").concat(g,")"),s,o,r.countParams().toString(),y];om(w,e,n);for(var h=1;h<u.length;++h)om(["","","","",u[h]],e,n)}function Lq(r,e,t){return(r==="inboundNodes"||r==="outputLayers"||r==="inputLayers")&&e===0&&typeof t=="string"}function Th(r,e){var t,n;if(r===null)return null;if(typeof r=="string")return bu(r);if(typeof r=="number"||typeof r=="boolean")return r;if(r instanceof Array){for(var a=[],i=r.length,o=0;o<i;++o){var s=r[o];Lq(e,o,s)?a.push(s):a.push(Th(s,e))}return a}else{var u={};try{for(var c=fe(Object.keys(r)),l=c.next();!l.done;l=c.next()){var f=l.value,h=r[f];if(f==="name"&&typeof h=="string")u[f]=h;else{var p=bu(f);u[p]=Th(h,p)}}}catch(d){t={error:d}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}return u}}function a1(r,e){var t,n;if(r==null)return null;if(typeof r=="string")return Eo(r);if(typeof r=="number"||typeof r=="boolean")return r;if(r instanceof Array){for(var a=[],i=r.length,o=0;o<i;++o){var s=r[o];Lq(e,o,s)?a.push(s):a.push(a1(s,e))}return a}else{var u={};try{for(var c=fe(Object.keys(r)),l=c.next();!l.done;l=c.next()){var f=l.value,h=r[f],p=Eo(f);(f==="name"||f==="className")&&typeof h=="string"?u[p]=h:u[p]=a1(h,f)}}catch(d){t={error:d}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}return u}}var K1="4.19.0",mAe=function(r){var e=Object.keys(r);if(e.length===0)return!1;var t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))},gAe=function(r){oe(e,r);function e(t){var n,a,i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S,T,E,C,R,_=r.call(this,{})||this;if(_.containerNodes=new Set,_.name=t.name,_.name==null){var M=_.getClassName().toLowerCase();_.name=sm(M)}if(_.supportsMasking=!1,_.trainable_=!0,Array.isArray(t.inputs)?_.inputs=t.inputs.slice():_.inputs=[t.inputs],Array.isArray(t.outputs)?_.outputs=t.outputs.slice():_.outputs=[t.outputs],gs(_.inputs).length!==_.inputs.length)throw new J("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+"".concat(_.inputs.map(function(bt){return bt.name})));gs(_.outputs).length!==_.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+"".concat(_.outputs.map(function(bt){return bt.name}))),_.inputLayers=[],_.inputLayersNodeIndices=[],_.inputLayersTensorIndices=[],_.outputLayers=[],_.outputLayersNodeIndices=[],_.outputLayersTensorIndices=[],_.layers=[],_.internalContainerRefs=[];try{for(var $=fe(_.outputs),z=$.next();!z.done;z=$.next()){var q=z.value,L=q.sourceLayer,U=q.nodeIndex,Y=q.tensorIndex;_.outputLayers.push(L),_.outputLayersNodeIndices.push(U),_.outputLayersTensorIndices.push(Y)}}catch(bt){n={error:bt}}finally{try{z&&!z.done&&(a=$.return)&&a.call($)}finally{if(n)throw n.error}}try{for(var Z=fe(_.inputs),V=Z.next();!V.done;V=Z.next()){var q=V.value,L=q.sourceLayer,U=q.nodeIndex,Y=q.tensorIndex;Yi(U===0,"input layer has >1 nodes"),Yi(Y===0,"input layer has >1 tensors"),_.inputLayers.push(L),_.inputLayersNodeIndices.push(U),_.inputLayersTensorIndices.push(Y)}}catch(bt){i={error:bt}}finally{try{V&&!V.done&&(o=Z.return)&&o.call(Z)}finally{if(i)throw i.error}}_.inputNames=[],_.outputNames=[],_.feedInputShapes=[],_.feedInputNames=[],_.feedOutputNames=[];for(var X=0;X<_.inputLayers.length;X++){var L=_.inputLayers[X];if(!(L instanceof rl))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. "+"Received inputs: ".concat(t.inputs,". ")+"Input ".concat(X," (0-based) originates ")+"from layer type ".concat(L.getClassName(),"."));_.inputNames.push(L.name),_.feedInputShapes.push(L.batchInputShape),_.feedInputNames.push(L.name)}try{for(var ne=fe(_.outputLayers),re=ne.next();!re.done;re=ne.next()){var L=re.value;_.outputNames.push(L.name)}}catch(bt){s={error:bt}}finally{try{re&&!re.done&&(u=ne.return)&&u.call(ne)}finally{if(s)throw s.error}}_.internalInputShapes=_.inputs.map(function(bt){return bt.shape}),_.internalOutputShapes=_.outputs.map(function(bt){return bt.shape});var se={},le={},de={},ke={},he={},ye=[],xe=function(bt,Ua,xi,ea,Ys,oE){(ea==null||Ys==null||oE==null)&&(ea=bt.sourceLayer,Ys=bt.nodeIndex,oE=bt.tensorIndex);var Ia=ea.inboundNodes[Ys];if(xi.indexOf(Ia)!==-1)throw new Zi("The tensor ".concat(bt.name,' at layer "').concat(ea.name,'" ')+"is part of a cycle.");if(Ua.indexOf(Ia)===-1){_.containerNodes.add(e.nodeKey(ea,Ys)),ea.id in he||(he[ea.id]=Object.keys(he).length),xi.indexOf(Ia)===-1&&xi.push(Ia);for(var ate=Ia.inboundLayers.length,gc=0;gc<ate;gc++){var ite=Ia.inputTensors[gc],ote=Ia.inboundLayers[gc],ste=Ia.nodeIndices[gc],ute=Ia.tensorIndices[gc];xe(ite,Ua,xi,ote,ste,ute)}for(Ua.push(Ia);xi.indexOf(Ia)>=0;)xi.splice(xi.indexOf(Ia),1);ye.push(Ia)}},De=[],Ze=[];try{for(var gt=fe(_.outputs),st=gt.next();!st.done;st=gt.next()){var q=st.value;xe(q,De,Ze)}}catch(bt){c={error:bt}}finally{try{st&&!st.done&&(l=gt.return)&&l.call(gt)}finally{if(c)throw c.error}}var ot=ye.slice().reverse();try{for(var mt=fe(ot),lt=mt.next();!lt.done;lt=mt.next()){var Qe=lt.value;le[Qe.id]=Qe,Qe.id in se||(se[Qe.id]=0);var nt=se[Qe.id],rt=de[Qe.outboundLayer.id]==null?0:de[Qe.outboundLayer.id];nt=Math.max(nt,rt),de[Qe.outboundLayer.id]=nt,ke[Qe.outboundLayer.id]=Qe.outboundLayer,se[Qe.id]=nt;for(var X=0;X<Qe.inboundLayers.length;X++){var hr=Qe.inboundLayers[X],U=Qe.nodeIndices[X],Je=hr.inboundNodes[U],Ct=se[Je.id]==null?0:se[Je.id];se[Je.id]=Math.max(nt+1,Ct),le[Je.id]=Je}}}catch(bt){f={error:bt}}finally{try{lt&&!lt.done&&(h=mt.return)&&h.call(mt)}finally{if(f)throw f.error}}var Br={};for(var Cn in se){var nt=se[Cn];nt in Br||(Br[nt]=[]),Br[nt].push(le[Cn])}var Vr={};for(var Lr in de){var nt=de[Lr];nt in Vr||(Vr[nt]=[]),Vr[nt].push(ke[Lr])}var pr=Object.keys(Vr).map(function(bt){return parseInt(bt,10)}).sort(Ov);_.layers=[];try{for(var Zn=fe(pr),An=Zn.next();!An.done;An=Zn.next()){var nt=An.value,Qn=Vr[nt];Qn.sort(function(Ua,xi){var ea=he[Ua.id],Ys=he[xi.id];return ea<Ys?-1:ea>Ys?1:0});try{for(var Rr=(m=void 0,fe(Qn)),ho=Rr.next();!ho.done;ho=Rr.next()){var L=ho.value;L instanceof e&&_.internalContainerRefs.push(L),_.layers.push(L)}}catch(Ua){m={error:Ua}}finally{try{ho&&!ho.done&&(v=Rr.return)&&v.call(Rr)}finally{if(m)throw m.error}}}}catch(bt){p={error:bt}}finally{try{An&&!An.done&&(d=Zn.return)&&d.call(Zn)}finally{if(p)throw p.error}}_.layersByDepth=Vr,pr=Object.keys(Br).map(function(bt){return parseInt(bt,10)}).sort(Ov);var vc=_.inputs.slice(),ud=[];try{for(var po=fe(pr),Xs=po.next();!Xs.done;Xs=po.next()){var nt=Xs.value;try{for(var mc=(w=void 0,fe(Br[nt])),ff=mc.next();!ff.done;ff=mc.next()){var Qe=ff.value,L=Qe.outboundLayer;if(L!=null){try{for(var cd=(x=void 0,fe(Qe.inputTensors)),hf=cd.next();!hf.done;hf=cd.next()){var q=hf.value;if(vc.indexOf(q)===-1)throw new Zi("Graph disconnected: cannot obtain value for tensor ".concat(q)+' at layer "'.concat(L.name,'". ')+"The following previous layers were accessed without "+"issue: ".concat(ud))}}catch(ea){x={error:ea}}finally{try{hf&&!hf.done&&(S=cd.return)&&S.call(cd)}finally{if(x)throw x.error}}try{for(var ld=(T=void 0,fe(Qe.outputTensors)),pf=ld.next();!pf.done;pf=ld.next()){var q=pf.value;vc.push(q)}}catch(ea){T={error:ea}}finally{try{pf&&!pf.done&&(E=ld.return)&&E.call(ld)}finally{if(T)throw T.error}}ud.push(L.name)}}}catch(Ua){w={error:Ua}}finally{try{ff&&!ff.done&&(b=mc.return)&&b.call(mc)}finally{if(w)throw w.error}}}}catch(bt){g={error:bt}}finally{try{Xs&&!Xs.done&&(y=po.return)&&y.call(po)}finally{if(g)throw g.error}}_.nodesByDepth=Br;var i0=_.layers.map(function(bt){return bt.name}),rte=function(bt){var Ua=i0.filter(function(xi){return xi===bt}).length;if(Ua!==1)throw new Zi('The name "'.concat(bt,'" is used ').concat(Ua," times ")+"in the model. All layer names should be unique. Layer names: "+JSON.stringify(i0))};try{for(var fd=fe(i0),df=fd.next();!df.done;df=fd.next()){var nte=df.value;rte(nte)}}catch(bt){C={error:bt}}finally{try{df&&!df.done&&(R=fd.return)&&R.call(fd)}finally{if(C)throw C.error}}return _.outboundNodes=[],_.inboundNodes=[],new mm({outboundLayer:_,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:_.inputs,outputTensors:_.outputs,inputMasks:_.inputs.map(function(bt){return null}),outputMasks:_.outputs.map(function(bt){return null}),inputShapes:_.inputs.map(function(bt){return bt.shape}),outputShapes:_.outputs.map(function(bt){return bt.shape})}),_.built=!0,_._refCount=1,_}return e.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Container '".concat(this.name,"' is already disposed."))},e.prototype.dispose=function(){var t,n,a,i;this.assertNotDisposed();var o={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){var c=u.value;o.numDisposedVariables+=c.dispose().numDisposedVariables}}catch(p){t={error:p}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}try{for(var l=fe(this.internalContainerRefs),f=l.next();!f.done;f=l.next()){var h=f.value;o.numDisposedVariables+=h.dispose().numDisposedVariables}}catch(p){a={error:p}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}}return o.refCountAfterDispose=this._refCount,o},Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this.layers.forEach(function(n){n._trainableWeights.forEach(function(a){return a.trainable=t})}),this.trainable_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){var t,n;if(this._trainableWeights.length>0)throw new J("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var a=[];try{for(var i=fe(this.layers),o=i.next();!o.done;o=i.next()){var s=o.value;a=a.concat(s.trainableWeights)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){var t,n,a,i,o=[];try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){var c=u.value;o.push.apply(o,et([],te(c.nonTrainableWeights),!1))}}catch(p){t={error:p}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}if(!this.trainable){var l=[];try{for(var f=fe(this.layers),h=f.next();!h.done;h=f.next()){var c=h.value;l.push.apply(l,et([],te(c.trainableWeights),!1))}}catch(p){a={error:p}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}return l.concat(o)}return o},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!1,configurable:!0}),e.prototype.loadWeights=function(t,n){var a,i,o,s;n===void 0&&(n=!0);var u={},c=0,l=mAe(t);l&&this.parseWeights(t);try{for(var f=fe(this.layers),h=f.next();!h.done;h=f.next()){var p=h.value;try{for(var d=(o=void 0,fe(p.weights.entries())),m=d.next();!m.done;m=d.next()){var v=te(m.value,2),g=v[0],y=v[1],w=l?"".concat(y.name.split("/").slice(0,-1).join("/")+"/").concat(g):y.originalName;if(u[w]!=null)throw new J("Duplicate weight name: ".concat(w));u[w]=y,c++}}catch(R){o={error:R}}finally{try{m&&!m.done&&(s=d.return)&&s.call(d)}finally{if(o)throw o.error}}}}catch(R){a={error:R}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}var b=[];for(var x in t){var S=x;if(u[x]==null){var T=x.split("/"),E=T.slice(0,-2).concat([T[T.length-1]]);S=E.join("/")}if(u[S]!=null)b.push([u[S],t[x]]);else if(n)throw new J("Provided weight data has no target variable: ".concat(x));delete u[S]}if(n){var C=[];for(var x in u)C.push(x);if(C.length>0)throw new J("".concat(C.length," of ").concat(c," weights are not set: ")+"".concat(C))}g1(b)},e.prototype.parseWeights=function(t){var n=function(i){var o=i.split("/"),s=["vars","layer_checkpoint_dependencies"],u=o.map(function(c){return c.startsWith("_")?c.slice(1):c}).filter(function(c){return!s.includes(c)}).join("/");u!==i&&(t[u]=t[i],delete t[i])};for(var a in Object.keys(t))n(a)},e.prototype.updatedConfig=function(){var t=this.getConfig(),n={};return n.className=this.getClassName(),n.config=t,n.kerasVersion="tfjs-layers ".concat(K1),n.backend="TensorFlow.js",n},e.prototype.toJSON=function(t,n){n===void 0&&(n=!0);var a=a1(this.updatedConfig());return n?JSON.stringify(a):a},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){t=$t(t);for(var i=new Kc,o=0;o<a.inputs.length;++o)i.add(a.inputs[o],t[o]);return gh(a.outputs,i,n)})},e.prototype.computeMask=function(t,n){var a=this;return F.tidy(function(){t=$t(t);var i;return n==null?i=Su(null,t.length):i=$t(n),a.runInternalGraph(t,i)[1]})},e.prototype.computeOutputShape=function(t){var n,a,i,o,s=Uv(t);if(s.length!==this.inputLayers.length)throw new J("Invalid inputShape argument ".concat(t,": ")+"model has ".concat(this.inputLayers.length," tensor inputs."));for(var u={},c=0;c<s.length;c++){var l=this.inputLayers[c],f=s[c],h=l.name+"_0_0";u[h]=f}var p=Object.keys(this.nodesByDepth).map(function(U){return parseInt(U,10)}).sort(Ov);if(p.length>1)try{for(var d=fe(p),m=d.next();!m.done;m=d.next()){var v=m.value,g=this.nodesByDepth[v];try{for(var y=(i=void 0,fe(g)),w=y.next();!w.done;w=y.next()){var b=w.value,l=b.outboundLayer;if(this.inputLayers.map(function(Y){return Y.id}).indexOf(l.id)===-1){for(var x=[],S=0;S<b.inboundLayers.length;S++){var T=b.inboundLayers[S],E=b.nodeIndices[S],C=b.tensorIndices[S],h="".concat(T.name,"_").concat(E,"_").concat(C),R=u[h];x.push(R)}for(var _=l.computeOutputShape(Un(x)),M=Uv(_),$=l.inboundNodes.indexOf(b),S=0;S<M.length;S++){var h="".concat(l.name,"_").concat($,"_").concat(S);u[h]=M[S]}}}}catch(U){i={error:U}}finally{try{w&&!w.done&&(o=y.return)&&o.call(y)}finally{if(i)throw i.error}}}}catch(U){n={error:U}}finally{try{m&&!m.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}for(var z=[],q=[],c=0;c<this.outputLayers.length;c++){var l=this.outputLayers[c],$=this.outputLayersNodeIndices[c],C=this.outputLayersTensorIndices[c],h="".concat(l.name,"_").concat($,"_").concat(C);q.push(h)}for(var c=0;c<q.length;c++){var L=q[c];Yi(L in u),z.push(u[L])}return Un(z)},e.prototype.runInternalGraph=function(t,n){var a,i,o,s,u,c,l,f;n==null&&(n=Su(null,t.length));for(var h={},p=0;p<this.inputs.length;++p){var d=this.inputs[p],m=t[p],v=n[p];h[d.id]=[m,v]}var g=Object.keys(this.nodesByDepth).map(function(xe){return parseInt(xe,10)}).sort(Ov);try{for(var y=fe(g),w=y.next();!w.done;w=y.next()){var b=w.value,x=this.nodesByDepth[b];try{for(var S=(o=void 0,fe(x)),T=S.next();!T.done;T=S.next()){var E=T.value,C=E.outboundLayer,R=E.inputTensors,_=E.outputTensors,M=new Array;try{for(var $=(u=void 0,fe(R)),z=$.next();!z.done;z=$.next()){var d=z.value;d.id in h&&M.push(h[d.id])}}catch(xe){u={error:xe}}finally{try{z&&!z.done&&(c=$.return)&&c.call($)}finally{if(u)throw u.error}}if(M.length===R.length){var q={},L=void 0,U=void 0,Y=void 0,Z=void 0;if(E.callArgs!=null&&(q=E.callArgs),M.length===1){var V=te(M[0],2),X=V[0],ne=V[1];q.mask==null&&(q.mask=ne),Y=$t(C.call(X,q)),Z=$t(C.computeMask(X,ne)),L=[X],U=[ne]}else L=M.map(function(xe){return xe[0]}),U=M.map(function(xe){return xe[1]}),q.mask==null&&(q.mask=U),Y=$t(C.call(L,q)),Z=$t(C.computeMask(L,U));if(C.activityRegularizer)throw new wt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var p=0;p<_.length;++p){var d=_[p],m=Y[p],v=Z[p];h[d.id]=[m,v]}}}}catch(xe){o={error:xe}}finally{try{T&&!T.done&&(s=S.return)&&s.call(S)}finally{if(o)throw o.error}}}}catch(xe){a={error:xe}}finally{try{w&&!w.done&&(i=y.return)&&i.call(y)}finally{if(a)throw a.error}}var re=[],se=[],le=[];try{for(var de=fe(this.outputs),ke=de.next();!ke.done;ke=de.next()){var d=ke.value;Yi(d.id in h,"Could not compute output ".concat(d.name," : ").concat(d.id));var he=te(h[d.id],2),ye=he[0],v=he[1];le.push(ye.shape),re.push(ye),se.push(v)}}catch(xe){l={error:xe}}finally{try{ke&&!ke.done&&(f=de.return)&&f.call(de)}finally{if(l)throw l.error}}return[re,se,le]},e.prototype.buildNodeConversionMap=function(t){var n,a,i={},o;try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){var c=u.value;o=c instanceof e?1:0;for(var l=0;l<c.inboundNodes.length;l++){var f=e.nodeKey(c,l);this.containerNodes.has(f)&&(i[f]=o,o+=1)}}}catch(h){n={error:h}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}return i},e.prototype.getLayer=function(t,n){var a,i;if(n!=null)return this.findLayer(n);if(t==null)throw new J("Provide either a layer name or layer index");if(typeof t=="number")return this.findLayer(t);try{for(var o=fe(this.layers),s=o.next();!s.done;s=o.next()){var u=s.value;if(u.name===t)return u}}catch(c){a={error:c}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(a)throw a.error}}throw new J("No such layer: ".concat(t))},e.prototype.findLayer=function(t){if(this.layers.length<=t)throw new J("Was asked to retrieve layer at index ".concat(t,", but model only ")+"has ".concat(this.layers.length," layer(s)."));return this.layers[t]},e.prototype.calculateLosses=function(){var t=this;return F.tidy(function(){var n,a,i=[];try{for(var o=fe(t.layers),s=o.next();!s.done;s=o.next())for(var u=s.value,c=0;c<u.inboundNodes.length;++c){var l=e.nodeKey(u,c);t.containerNodes.has(l)&&i.push.apply(i,et([],te(u.calculateLosses()),!1))}}catch(f){n={error:f}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}return i})},e.prototype.getConfig=function(){var t,n,a={name:this.name},i=this.buildNodeConversionMap(this.layers),o=[];try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){for(var c=u.value,l=c.getClassName(),f=c.getConfig(),h=[],p=0;p<c.inboundNodes.length;p++){var d=c.inboundNodes[p],m=e.nodeKey(c,p),v={};if(this.containerNodes.has(m)){if(d.callArgs)try{JSON.stringify(d.callArgs),v=d.callArgs}catch{console.warn("Layer ".concat(c.name," was passed ")+"non-serializable keyword arguments: "+"".concat(d.callArgs,". They will not be included ")+"in the serialized model (and thus will be missing at deserialization time)."),v={}}if(d.inboundLayers.length>0){for(var g=[],y=0;y<d.inboundLayers.length;y++){var w=d.inboundLayers[y],b=d.nodeIndices[y],x=d.tensorIndices[y],S=e.nodeKey(w,b),T=i[S];T==null&&(T=0),g.push([w.name,T,x,v])}h.push(g)}}}var E={};E.name=c.name,E.className=l,E.config=f,E.inboundNodes=h,o.push(E)}}catch(_){t={error:_}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}a.layers=o;for(var C=[],y=0;y<this.inputLayers.length;y++){var c=this.inputLayers[y],b=this.inputLayersNodeIndices[y],m=e.nodeKey(c,b);if(!!this.containerNodes.has(m)){var T=i[m];T==null&&(T=0);var x=this.inputLayersTensorIndices[y];C.push([c.name,T,x])}}a.inputLayers=C;for(var R=[],y=0;y<this.outputLayers.length;y++){var c=this.outputLayers[y],b=this.outputLayersNodeIndices[y],m=e.nodeKey(c,b);if(!!this.containerNodes.has(m)){var T=i[m];T==null&&(T=0);var x=this.outputLayersTensorIndices[y];R.push([c.name,T,x])}}return a.outputLayers=R,a},e.fromConfig=function(t,n,a,i){var o,s,u,c,l,f,h,p,d,m;i===void 0&&(i=!1);var v={},g={};function y(ye,xe){ye.name in g?g[ye.name].push(xe):g[ye.name]=[xe]}function w(ye,xe){var De,Ze,gt=[],st;try{for(var ot=fe(xe),mt=ot.next();!mt.done;mt=ot.next()){var lt=mt.value,Qe=lt[0],nt=lt[1],rt=lt[2];if(st=lt[3]==null?{}:lt[3],!(Qe in v)){y(ye,xe);return}var hr=v[Qe];if(hr.inboundNodes.length<=nt){y(ye,xe);return}var Je=hr.inboundNodes[nt];gt.push(Je.outputTensors[rt])}}catch(Ct){De={error:Ct}}finally{try{mt&&!mt.done&&(Ze=ot.return)&&Ze.call(ot)}finally{if(De)throw De.error}}gt.length>0&&ye.apply(Un(gt),st)}function b(ye){var xe=ye.name,De=Di(ye,n.customObjects!=null?n.customObjects:{});De.setFastWeightInitDuringBuild(i),v[xe]=De;var Ze=ye.inboundNodes;Ze.forEach(function(gt){if(!(gt instanceof Array))throw new J("Corrupted configuration, expected array for nodeData: ".concat(gt));y(De,gt)})}var x=n.name,S=n.layers;try{for(var T=fe(S),E=T.next();!E.done;E=T.next()){var C=E.value;b(C)}}catch(ye){o={error:ye}}finally{try{E&&!E.done&&(s=T.return)&&s.call(T)}finally{if(o)throw o.error}}for(;!Axe(g);)try{for(var R=(u=void 0,fe(S)),_=R.next();!_.done;_=R.next()){var C=_.value,M=v[C.name];if(M.name in g){var $=g[M.name];delete g[M.name];try{for(var z=(l=void 0,fe($)),q=z.next();!q.done;q=z.next()){var L=q.value;w(M,L)}}catch(xe){l={error:xe}}finally{try{q&&!q.done&&(f=z.return)&&f.call(z)}finally{if(l)throw l.error}}}}}catch(ye){u={error:ye}}finally{try{_&&!_.done&&(c=R.return)&&c.call(R)}finally{if(u)throw u.error}}var U=[],Y=[],Z=n.inputLayers;try{for(var V=fe(Z),X=V.next();!X.done;X=V.next()){var C=X.value,ne=C[0],re=C[1],se=C[2];Yi(ne in v);var M=v[ne],le=M.inboundNodes[re].outputTensors;U.push(le[se])}}catch(ye){h={error:ye}}finally{try{X&&!X.done&&(p=V.return)&&p.call(V)}finally{if(h)throw h.error}}var de=n.outputLayers;try{for(var ke=fe(de),he=ke.next();!he.done;he=ke.next()){var C=he.value,ne=C[0],re=C[1],se=C[2];Yi(ne in v);var M=v[ne],le=M.inboundNodes[re].outputTensors;Y.push(le[se])}}catch(ye){d={error:ye}}finally{try{he&&!he.done&&(m=ke.return)&&m.call(ke)}finally{if(d)throw d.error}}return new t({inputs:U,outputs:Y,name:x})},Object.defineProperty(e.prototype,"stateful",{get:function(){var t,n;if(this._stateful)throw new J("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");try{for(var a=fe(this.layers),i=a.next();!i.done;i=a.next()){var o=i.value;if(o.stateful)return!0}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return!1},enumerable:!1,configurable:!0}),e.prototype.resetStates=function(){var t=this;F.tidy(function(){t.layers.forEach(function(n){n.stateful&&n.resetStates()})})},e}(xt);function yAe(r,e,t){var n=e.length;if(r==null||Array.isArray(r)&&r.length===0)return e.map(function(i){return null});if(n===1)return Array.isArray(r)&&r.length===1?r:typeof r=="object"&&e[0]in r?[r[e[0]]]:[r];if(Array.isArray(r)){if(r.length!==n)throw new Error("Provided ".concat(t," is an array of ").concat(r.length," ")+"element(s), but the model has ".concat(n," outputs. ")+"Make sure a set of weights is provided for each model output.");return r}else if(typeof r=="object"&&Object.keys(r).length>0&&typeof r[Object.keys(r)[0]]=="object"){var a=[];return e.forEach(function(i){i in r?a.push(r[i]):a.push(null)}),a}else throw new Error("The model has multiple (".concat(n,") outputs, ")+"so ".concat(t," must be either an array with ")+"".concat(n," elements or an object with ").concat(e," keys. ")+"Provided ".concat(t," not understood: ").concat(JSON.stringify(r)))}function qq(r,e){return yAe(r,e,"classWeight")}function zq(r,e,t,n){return Ce(this,void 0,void 0,function(){var a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:if(e!=null||n!=null)throw new Error("Support sampleWeight is not implemented yet");return t==null?[3,2]:(a=F.tidy(function(){if(r.shape.length===1)return F.clone(r);if(r.shape.length===2)if(r.shape[1]>1){var l=1;return F.argMax(r,l)}else{if(r.shape[1]===1)return F.reshape(r,[r.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(r.shape[1],") ")+"during handling of class weights. The size is expected to be >= 1.")}else throw new Error("Unexpected rank of target (y) tensor (".concat(r.rank,") during ")+"handling of class weights. The rank is expected to be 1 or 2.")}),s=(o=Array).from,[4,a.data()]);case 1:return i=s.apply(o,[c.sent()]),F.dispose(a),u=[],i.forEach(function(l){if(t[l]==null)throw new Error("classWeight must contain all classes in the training data. "+"The class ".concat(l," exists in the data but not in ")+"classWeight");u.push(t[l])}),[2,F.tensor1d(u,"float32")];case 2:return[2,null]}})})}function bAe(r,e){return F.mul(r,e)}var wAe=32;function $q(r,e){var t,n,a=e;t=a.xs,n=a.ys,A.util.assert(t!=null&&n!=null,function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+"".concat(e)});var i=CB("input",r.inputNames,t),o=CB("output",r.outputNames,n),s=i[0].shape[0];A.util.assert(i.length===r.inputs.length,function(){return"LayersModel has ".concat(r.inputs.length," inputs, but the dataset ")+"provides ".concat(i.length," inputs.  (Expected input keys: ")+"".concat(JSON.stringify(r.inputNames),")")}),A.util.assert(o.length===r.outputs.length,function(){return"LayersModel has ".concat(r.outputs.length," outputs, but the dataset ")+"provides ".concat(o.length," outputs.  (Expected output keys: ")+"".concat(JSON.stringify(r.outputNames),")")});for(var u=function(h){A.util.assert(i[h].shape[0]===s,function(){return"Batch size mismatch: input "+"".concat(r.inputNames[h]," has ").concat(i[h].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(r.inputNames[0],".")})},c=0;c<i.length;c++)u(c);for(var l=function(h){A.util.assert(o[h].shape[0]===s,function(){return"Batch size mismatch: output "+"".concat(r.outputNames[h]," has ").concat(o[h].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(r.inputNames[0],".")})},f=0;f<o.length;f++)l(f);return{xs:i,ys:o}}function CB(r,e,t){var n,a;if(t instanceof A.Tensor)return[t];if(Array.isArray(t))return A.util.assert(t.length===e.length,function(){return"Received an array of ".concat(t.length," Tensors, but expected ").concat(e.length," to match the ").concat(r," keys ").concat(e,".")}),t;var i=[];try{for(var o=fe(e),s=o.next();!s.done;s=o.next()){var u=s.value;if(t[u]==null)throw new J("The feature data generated by the dataset lacks the required "+"".concat(r," key '").concat(u,"'."));i.push(t[u])}}catch(c){n={error:c}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}return i}function xAe(r){if(r.length===3)throw new wt("Validation with sample weights is not implemented yet.");return{xs:r[0],ys:r[1]}}function kAe(r,e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S,T,E,C,R,_,V,M,$,z,q,V,L,U,Y,Z,V;return Ee(this,function(X){switch(X.label){case 0:if(n=t.batchesPerEpoch!=null,A.util.assert(r.optimizer!=null,function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."}),A.util.assert(t!=null,function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."}),A.util.assert(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),function(){return"For fitDataset(), config.epochs is expected to be a positive "+"integer, but got ".concat(t.epochs)}),A.util.assert(!n||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a "+"positive integer if specified, but got ".concat(t.batchesPerEpoch)}),A.util.assert(t.validationSplit==null,function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."}),r.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");r.isTraining=!0,X.label=1;case 1:return X.trys.push([1,,26,27]),a=t.validationData!=null,i=void 0,o=void 0,a&&(AB(t.validationData)?A.util.assert(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, "+"but got ".concat(t.validationBatches)}):(s=xAe(t.validationData),i=s.xs,o=s.ys)),u=r.makeTrainFunction(),c=r.getDedupedMetricsNames(),l=void 0,a?l=c.slice().concat(c.map(function(ne){return"val_"+ne})):l=c.slice(),f=_q(t.callbacks,t.yieldEvery),h=t.verbose==null?1:t.verbose,p=Fq(f,h,t.epochs,null,null,SAe(e,t),null,a,l),d=p.callbackList,m=p.history,d.setModel(r),r.history=m,[4,d.onTrainBegin()];case 2:return X.sent(),r.stopTraining_=!1,v=t.initialEpoch==null?0:t.initialEpoch,[4,e.iterator()];case 3:g=X.sent(),X.label=4;case 4:return v<t.epochs?(y={},[4,d.onEpochBegin(v)]):[3,23];case 5:return X.sent(),w=0,b=0,n?[3,7]:[4,e.iterator()];case 6:g=X.sent(),X.label=7;case 7:return!n||w<t.batchesPerEpoch?[4,g.next()]:[3,21];case 8:return x=X.sent(),n&&x.done?(console.warn("You provided `batchesPerEpoch` as "+"".concat(t.batchesPerEpoch,", ")+"but your dataset iterator ran out of data after "+"".concat(w," batches; ")+"interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+"".concat(t.batchesPerEpoch*t.epochs," batches). ")+"You may need to use the repeat() function when building your dataset."),[3,21]):x.value==null?[3,15]:(S=$q(r,x.value),T=S.xs,E=S.ys,C={},C.batch=b,C.size=T[0].shape[0],[4,d.onBatchBegin(b,C)]);case 9:if(X.sent(),R=[],t.classWeight==null)return[3,13];_=qq(t.classWeight,r.outputNames),V=0,X.label=10;case 10:return V<_.length?($=(M=R).push,[4,zq(E[V],null,_[V])]):[3,13];case 11:$.apply(M,[X.sent()]),X.label=12;case 12:return++V,[3,10];case 13:for(z=T.concat(E).concat(R),q=u(z),A.dispose(z),V=0;V<c.length;++V)L=c[V],U=q[V],C[L]=U,A.keep(U);return[4,d.onBatchEnd(b,C)];case 14:X.sent(),Iq(C),b++,w++,X.label=15;case 15:return(n?w>=t.batchesPerEpoch:x.done)?a?(Y=void 0,AB(t.validationData)?(Z=$t,[4,r.evaluateDataset(t.validationData,{batches:t.validationBatches})]):[3,17]):[3,19]:[3,20];case 16:return Y=Z.apply(void 0,[X.sent()]),[3,18];case 17:Y=$t(r.evaluate(i,o,{batchSize:t.validationBatchSize==null?wAe:t.validationBatchSize,verbose:0})),X.label=18;case 18:for(V=0;V<r.metricsNames.length;++V)y["val_".concat(r.metricsNames[V])]=Y[V];X.label=19;case 19:return[3,21];case 20:return r.stopTraining_?[3,21]:[3,7];case 21:return[4,d.onEpochEnd(v,y)];case 22:return X.sent(),v++,r.stopTraining_?[3,23]:[3,4];case 23:return[4,d.onTrainEnd()];case 24:return X.sent(),[4,r.history.syncData()];case 25:return X.sent(),[2,r.history];case 26:return r.isTraining=!1,[7];case 27:return[2]}})})}function SAe(r,e){var t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(r.size)&&(t=r.size),t}function AB(r){return typeof r.iterator=="function"}function NAe(r){return typeof r.next=="function"}function TAe(r,e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p;return Ee(this,function(d){switch(d.label){case 0:if(t=t||{},n=t.batches!=null,a=r.testFunction,i=[],t.verbose>0)throw new wt("Verbose mode is not implemented yet.");return A.util.assert(!n||t.batches>0&&Number.isInteger(t.batches),function(){return"Test loop expects `batches` to be a positive integer, but "+"received ".concat(JSON.stringify(t.batches))}),NAe(e)?(s=e,[3,3]):[3,1];case 1:return[4,e.iterator()];case 2:s=d.sent(),d.label=3;case 3:o=s,u=0,c=0,l=function(){var m;return Ee(this,function(v){switch(v.label){case 0:return[4,o.next()];case 1:return m=v.sent(),i=A.tidy(function(){if(m.value){var g=$q(r,m.value),y=g.xs,w=g.ys,b=y.concat(w),x=A.tidy(function(){return a(b)});if(A.dispose(b),c===0)for(var S=0;S<x.length;++S)i.push(F.scalar(0));for(var T=b[0].shape[0],E=function(C){var R=x[C],_=i[C];i[C]=A.tidy(function(){return A.add(i[C],A.mul(T,R))}),c>0&&A.dispose(_)},S=0;S<x.length;++S)E(S);A.dispose(x),u+=T,++c}return i}),m.done?(n&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` "+"batches (in this case, ".concat(t.batches," batches). ")+"You may need to use the repeat() function when building your dataset."),[2,"break"]):[2]}})},d.label=4;case 4:return!n||c<t.batches?[5,l()]:[3,6];case 5:return f=d.sent(),f==="break"?[3,6]:[3,4];case 6:for(h=0;h<i.length;++h)p=i[h],i[h]=A.div(i[h],u),A.dispose(p);return[2,Un(i)]}})})}function zw(r){A.util.assert(r>0&&Number.isInteger(r),function(){return"batchSize is required to be a positive integer, but got ".concat(r)})}function vh(r,e,t){return r==null?[null]:Array.isArray(r)?r.map(function(n){return ku(n,e,t-e)}):ku(r,e,t-e)}function i1(r,e){return A.tidy(function(){return r==null?null:Array.isArray(r)?r.map(function(t){return i1(t,e)}):jB(r,e.dtype==="int32"?e:A.cast(e,"int32"))})}function $w(r,e){for(var t=[],n=0,a=null;n<r;)a=n+e,a>=r&&(a=r),t.push([n,a]),n=a;return t}function Wq(r){var e=[];r instanceof F.Tensor&&(r=[r]);for(var t=0;t<r.length;++t){var n=r[t];if(n.rank===1)e.push(Ch(n,1));else{if(n.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(n)}}return e}function Ii(r,e){if(r!=null){var t=[];if(e instanceof F.Tensor)t.push(e.id);else if(Array.isArray(e))e.forEach(function(s){return t.push(s.id)});else if(e!=null)for(var n in e){var a=e[n];t.push(a.id)}var i=[];if(r instanceof F.Tensor)t.indexOf(r.id)===-1&&i.push(r);else if(Array.isArray(r))r.forEach(function(s){t.indexOf(s.id)===-1&&i.push(s)});else if(r!=null)for(var n in r){var o=r[n];t.indexOf(o.id)===-1&&i.push(o)}i.forEach(function(s){s.isDisposed||s.dispose()})}}function EAe(r){return r instanceof F.Tensor}function o1(r){return Array.isArray(r)}function DB(r){return!EAe(r)&&!o1(r)}function _B(r,e,t,n,a){var i,o;if(n===void 0&&(n=!0),a===void 0&&(a=""),e==null||e.length===0){if(r!=null){var s=!1;if(o1(r)&&r.length>0)s=!0;else if(DB(r)){for(var u in r)if(r.hasOwnProperty(u)){s=!0;break}}else s=!0;if(s)throw new J("Error when checking model ".concat(a," expected no data, ")+"but got ".concat(r))}return[]}if(r==null)return e.map(function(y){return null});var c;if(DB(r)){r=r,c=[];try{for(var l=fe(e),f=l.next();!f.done;f=l.next()){var h=f.value;if(r[h]==null)throw new J('No data provided for "'.concat(h,'". Need data for each key in: ')+"".concat(e));c.push(r[h])}}catch(y){i={error:y}}finally{try{f&&!f.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}}else if(o1(r)){if(r=r,r.length!==e.length)throw new J("Error when checking model ".concat(a,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"model expected. Expected to see ".concat(e.length," Tensor(s), but ")+"instead got the following list of Tensor(s): ".concat(r));c=r}else{if(r=r,e.length>1)throw new J("The model ".concat(a," expects ").concat(e.length," Tensor(s), ")+"but only received one Tensor. Found: Tensor with shape ".concat(r.shape));c=[r]}if(c=Wq(c),t!=null){for(var p=0;p<e.length;++p)if(t[p]!=null){var d=c[p];if(d.shape.length!==t[p].length)throw new J("Error when checking ".concat(a,": expected ").concat(e[p]," ")+"to have ".concat(t[p].length," dimension(s). but got array with ")+"shape ".concat(d.shape));for(var m=0;m<t[p].length;++m)if(!(m===0&&!n)){var v=d.shape[m],g=t[p][m];if(g!=null&&g>=0&&v!==g)throw new J("".concat(a," expected a batch of elements where each ")+"example has shape [".concat(t[p].slice(1,t[p].length),"] ")+"(i.e.,tensor shape [*,".concat(t[p].slice(1,t[p].length),"])")+" but the ".concat(a," received an input with ").concat(d.shape[0])+" examples, each with shape [".concat(d.shape.slice(1,d.shape.length),"]")+" (tensor shape [".concat(d.shape,"])"))}}}return c}function IAe(r,e,t){var n=gs(r.map(function(i){return i.shape[0]}));n.sort();var a=gs(e.map(function(i){return i.shape[0]}));if(a.sort(),n.length>1)throw new J("All input Tensors (x) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(r.map(function(i){return i.shape}))));if(a.length>1)throw new J("All target Tensors (y) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(e.map(function(i){return i.shape}))));if(n.length>0&&a.length>0&&!F.util.arraysEqual(n,a))throw new J("Input Tensors should have the same number of samples as target "+"Tensors. Found ".concat(n[0]," input sample(s) and ").concat(a[0]," target ")+"sample(s).")}function CAe(r,e,t){for(var n=[Fu,km,Nh],a=0;a<r.length;++a){var i=r[a],o=e[a],s=t[a];if(o!=null){if(o===Nh&&i.shape[i.shape.length-1]===1)throw new J("You are passing a target array of shape ".concat(i.shape," while using ")+"a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(n.indexOf(o)!==-1)for(var u=i.shape.slice(1),c=s.slice(1),l=0;l<u.length;++l){var f=u[l],h=c[l];if(h!=null&&f!==h)throw new J("A target Tensor with shape ".concat(i.shape," was passed for an ")+"output of shape ".concat(s,", while using a loss function that ")+"expects targets to have the same shape as the output.")}}}}function FB(r,e,t,n,a){n===void 0&&(n=!0),a===void 0&&(a="");var i;if(Array.isArray(r)){if(r.length!==e.length)throw new J("Error when checking model ".concat(a,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"the model expected. Expected to see ".concat(e.length," Tensor(s),")+" but instead got ".concat(r.length," Tensors(s)."));i=r}else{if(e.length>1)throw new J("The model expects ".concat(e.length," ").concat(a," Tensors, ")+"but only received one Tensor. Found: array with shape "+"".concat(JSON.stringify(r.shape),"."));i=[r]}if(t!=null){for(var o=0;o<e.length;++o)if(t[o]!=null){var s=i[o];if(s.shape.length!==t[o].length)throw new J("Error when checking ".concat(a,": expected ").concat(e[o]," ")+"to have ".concat(t[o].length," dimension(s), but got array with ")+"shape ".concat(JSON.stringify(s.shape)));for(var u=0;u<t[o].length;++u)if(!(u===0&&!n)){var c=s.shape[u],l=t[o][u];if(l!=null&&l!==c)throw new J("Error when checking ".concat(a,": expected ")+"".concat(e[o]," to have shape ").concat(JSON.stringify(t[o])," but ")+"got array with shape ".concat(JSON.stringify(s.shape),"."))}}}}function AAe(r,e){var t,n;if(r==null||Array.isArray(r)&&r.length===0)return e.map(function(l){return[]});var a;if(typeof r=="string"||typeof r=="function")a=[r];else if(Array.isArray(r)||typeof r=="object")a=r;else throw new TypeError("Type of metrics argument not understood. Expected an string,"+"function, Array, or Object, found: ".concat(r));if(Array.isArray(a))return e.map(function(l){return a});var i=[];try{for(var o=fe(e),s=o.next();!s.done;s=o.next()){var u=s.value,c=a.hasOwnProperty(u)?a[u]:[];Array.isArray(c)||(c=[c]),i.push(c)}}catch(l){t={error:l}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i}var DAe="layers-model",Io=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.isTraining=!1,n}return e.prototype.summary=function(t,n,a){if(a===void 0&&(a=console.log),!this.built)throw new J("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");fAe(this,t,n,a)},e.prototype.compile=function(t){var n,a,i=this;if(t.loss==null&&(t.loss=[]),this.loss=t.loss,typeof t.optimizer=="string")this.optimizer_=lAe(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof F.Optimizer))throw new J("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}var o=[];if(!Array.isArray(t.loss)&&typeof t.loss!="string"&&typeof t.loss!="function"){t.loss=t.loss;for(var s in t.loss)if(this.outputNames.indexOf(s)===-1)throw new J('Unknown entry in loss dictionary: "'.concat(s,'". ')+"Only expected the following keys: ".concat(this.outputNames));try{for(var u=fe(this.outputNames),c=u.next();!c.done;c=u.next()){var s=c.value;t.loss[s]==null&&console.warn('Output "'.concat(s,'" is missing from loss dictionary. We assume ')+"this was done on purpose, and we will not be expecting data "+"to be passed to ".concat(s," during training")),o.push(qw(t.loss[s]))}}catch(g){n={error:g}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}}else if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new J("When passing an Array as loss, it should have one entry per "+"model output. The model has ".concat(this.outputs.length," output(s), ")+"but you passed loss=".concat(t.loss,"."));var l=t.loss;o=l.map(function(g){return qw(g)})}else{var f=qw(t.loss);this.outputs.forEach(function(g){o.push(f)})}this.lossFunctions=o,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var h=0;h<this.outputs.length;++h){var p=this.internalOutputShapes[h],s=this.outputNames[h];this.feedOutputNames.push(s),this.feedOutputShapes.push(p),this.feedLossFns.push(this.lossFunctions[h])}var d=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],xu("loss",function(){for(var g=0;g<i.outputs.length;++g)if(d.indexOf(g)===-1){var y=i.lossFunctions[g];i.outputs.length>1&&(i.metricsTensors.push([y,g]),i.metricsNames.push(i.outputNames[g]+"_loss"))}});var m=AAe(t.metrics,this.outputNames),v=function(g,y,w){i.outputNames.length>1&&(y=i.outputNames[g]+"_"+y),i.metricsNames.push(y),i.metricsTensors.push([w,g])};xu("metric",function(){for(var g=function(w){if(d.indexOf(w)!==-1)return"continue";var b=m[w],x=function(S){var T,E,C="",R,_,M,$=function(U){if(typeof U=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(U)!==-1){var Y=i.internalOutputShapes[w];Y[Y.length-1]===1||i.lossFunctions[w]===km?["accuracy","acc"].indexOf(U)!==-1?_=G1:["crossentropy","ce"].indexOf(U)!==-1&&(_=Pq):i.lossFunctions[w]===nm?["accuracy","acc"].indexOf(U)!==-1?_=Mq:["crossentropy","ce"].indexOf(U)!==-1&&(_=Bq):["accuracy","acc"].indexOf(U)!==-1?_=H1:["crossentropy","ce"].indexOf(U)!==-1&&(_=j1);var Z=void 0;["accuracy","acc"].indexOf(U)!==-1?Z="acc":["crossentropy","ce"].indexOf(U)!==-1&&(Z="ce"),M=_,R=C+Z}else{var V=cAe(U);M=V,R=C+Bv(U)}var X;xu(R,function(){X=M}),v(w,R,X)};try{for(var z=(T=void 0,fe(S)),q=z.next();!q.done;q=z.next()){var L=q.value;$(L)}}catch(U){T={error:U}}finally{try{q&&!q.done&&(E=z.return)&&E.call(z)}finally{if(T)throw T.error}}};x(b)},y=0;y<i.outputs.length;++y)g(y)}),this.collectedTrainableWeights=this.trainableWeights},e.prototype.checkTrainableWeightsConsistency=function(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},e.prototype.evaluate=function(t,n,a){a===void 0&&(a={});var i=a.batchSize==null?32:a.batchSize;zw(i);var o=!0,s=this.standardizeUserDataXY(t,n,o,i);try{var u=s[0].concat(s[1]);this.makeTestFunction();var c=this.testFunction,l=this.testLoop(c,u,i,a.verbose,a.steps);return Un(l)}finally{Ii(s[0],t),Ii(s[1],n)}},e.prototype.evaluateDataset=function(t,n){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){return this.makeTestFunction(),[2,TAe(this,t,n)]})})},e.prototype.checkNumSamples=function(t,n,a,i){i===void 0&&(i="steps");var o;if(a!=null){if(o=null,n!=null)throw new J("If ".concat(i," is set, batchSize must be null or undefined.")+"Got batchSize = ".concat(n))}else if(t!=null)Array.isArray(t)?o=t[0].shape[0]:o=t.shape[0];else throw new J("Either the input data should have a defined shape, or "+"".concat(i," shoud be specified."));return o},e.prototype.execute=function(t,n){var a,i;if(Array.isArray(n)&&n.length===0)throw new J("`outputs` is an empty Array, which is not allowed.");var o=Array.isArray(n),s=o?n:[n],u=this.retrieveSymbolicTensors(s),c=new Kc;if(t instanceof F.Tensor&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new J("The number of inputs provided (".concat(t.length,") ")+"does not match the number of inputs of this model "+"(".concat(this.inputs.length,")."));for(var l=0;l<this.inputs.length;++l)c.add(this.inputs[l],t[l])}else try{for(var f=fe(this.inputs),h=f.next();!h.done;h=f.next()){var p=h.value,d=t[p.name];if(d==null)throw new J("No value is provided for the model's input ".concat(p.name));c.add(p,d)}}catch(v){a={error:v}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}var m=gh(u,c);return o?m:m[0]},e.prototype.retrieveSymbolicTensors=function(t){var n,a,i=Su(null,t.length),o=t.length;try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){for(var c=u.value,l=Array.isArray(c.output)?c.output:[c.output],f=l.map(function(m){return m.name}),h=0;h<t.length;++h){var p=f.indexOf(t[h]);if(p!==-1&&(i[h]=l[p],o--),o===0)break}if(o===0)break}}catch(m){n={error:m}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}if(o>0){var d=[];throw i.forEach(function(m,v){m==null&&d.push(t[v])}),new J("Cannot find SymbolicTensors for output name(s): "+"".concat(JSON.stringify(d)))}return i},e.prototype.predictLoop=function(t,n,a){var i=this;return n===void 0&&(n=32),a===void 0&&(a=!1),A.tidy(function(){var o=i.checkNumSamples(t);if(a)throw new wt("Verbose predictLoop() is not implemented yet.");for(var s=$w(o,n),u=i.outputs.map(function(f){return[]}),c=function(f){var h=A.tidy(function(){var p=s[f][0],d=s[f][1],m=vh(t,p,d),v=[];if(Array.isArray(m))for(var g=0;g<m.length;++g)v.push({key:i.inputs[g],value:m[g]});else v.push({key:i.inputs[0],value:m});var y=new Kc(v);return gh(i.outputs,y)});h.forEach(function(p,d){return u[d].push(p)})},l=0;l<s.length;++l)c(l);return Un(u.map(function(f){return A.concat(f,0)}))})},e.prototype.predict=function(t,n){n===void 0&&(n={});var a=Wq(t);FB(a,this.inputNames,this.feedInputShapes,!1);try{var i=n.batchSize==null?32:n.batchSize;return zw(i),this.predictLoop(a,i)}finally{Ii(a,t)}},e.prototype.predictOnBatch=function(t){FB(t,this.inputNames,this.feedInputShapes,!0);var n=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,n)},e.prototype.standardizeUserDataXY=function(t,n,a,i){if(this.optimizer_==null)throw new Zi("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var o=[],s=0;s<this.feedOutputShapes.length;++s){var u=this.feedOutputShapes[s],c=this.feedLossFns[s];c===nm?o.push(u.slice(0,u.length-1).concat([1])):o.push(u)}if(t=_B(t,this.feedInputNames,this.feedInputShapes,!1,"input"),n=_B(n,this.feedOutputNames,o,!1,"target"),IAe(t,n),CAe(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&i!=null&&i>0&&t[0].shape[0]%i!==0)throw new J("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+"".concat(i,". Found: ").concat(t[0].shape[0]," sample(s)."));return[t,n]},e.prototype.standardizeUserData=function(t,n,a,i,o,s){return o===void 0&&(o=!0),Ce(this,void 0,void 0,function(){var u,c,l,f,h,p,d,m;return Ee(this,function(v){switch(v.label){case 0:if(u=te(this.standardizeUserDataXY(t,n,o,s),2),c=u[0],l=u[1],a!=null)throw new Error("sample weight is not supported yet.");if(f=null,i==null)return[3,4];h=qq(i,this.outputNames),f=[],p=0,v.label=1;case 1:return p<h.length?(m=(d=f).push,[4,zq(l[p],null,h[p])]):[3,4];case 2:m.apply(d,[v.sent()]),v.label=3;case 3:return++p,[3,1];case 4:return[2,[c,l,f]]}})})},e.prototype.testLoop=function(t,n,a,i,o){var s=this;return i===void 0&&(i=0),A.tidy(function(){var u=s.checkNumSamples(n,a,o,"steps"),c=[];if(i>0)throw new wt("Verbose mode is not implemented yet.");if(o!=null)throw new wt("steps mode in testLoop() is not implemented yet");for(var l=$w(u,a),f=F.tensor1d(Fi(0,u)),h=0;h<l.length;++h){var p=l[h][0],d=l[h][1],m=ku(f,p,d-p),v=i1(n,m),g=t(v);if(h===0)for(var y=0;y<g.length;++y)c.push(F.scalar(0));for(var y=0;y<g.length;++y){var w=g[y];c[y]=A.add(c[y],A.mul(d-p,w))}}for(var y=0;y<c.length;++y)c[y]=A.div(c[y],u);return c})},e.prototype.getDedupedMetricsNames=function(){for(var t=this.metricsNames,n=[],a=0;a<t.length;++a){var i=t[a],o=i;if(B4(t,i)>1){var s=B4(t.slice(0,a),i);o+="_".concat(s)}n.push(o)}return n},e.prototype.makeTrainFunction=function(){var t=this;return function(n){var a=[],i=n.slice(0,t.inputs.length),o=n.slice(t.inputs.length,t.inputs.length+t.outputs.length),s=n.slice(t.inputs.length+t.outputs.length,t.inputs.length+t.outputs.length*2),u=[],c=function(){for(var p=[],d=0;d<t.inputs.length;++d)p.push({key:t.inputs[d],value:i[d]});for(var m=new Kc(p),v=gh(t.outputs,m,{training:!0}),g,d=0;d<t.lossFunctions.length;++d){var y=t.lossFunctions[d],w=y(o[d],v[d]);s[d]!=null&&(w=bAe(w,s[d]));var b=A.mean(w);a.push(b),d===0?g=w:g=A.add(g,w)}for(var d=0;d<t.metricsTensors.length;++d){var x=void 0;if(t.outputs.length>1&&d<t.outputs.length)x=a[d];else{var S=t.metricsTensors[d][0],T=t.metricsTensors[d][1];x=A.mean(S(o[T],v[T]))}A.keep(x),u.push(x)}return g=A.mean(g),t.calculateLosses().forEach(function(E){g=A.add(g,E)}),g},l=t.collectedTrainableWeights.map(function(p){return p.read()}),f=!0,h=t.optimizer_.minimize(c,f,l);return[h].concat(u)}},e.prototype.makeTestFunction=function(){var t=this;this.testFunction=function(n){return A.tidy(function(){for(var a=[],i,o=n.slice(0,t.inputs.length),s=n.slice(t.inputs.length,t.inputs.length+t.outputs.length),u=[],c=0;c<t.inputs.length;++c)u.push({key:t.inputs[c],value:o[c]});for(var l=new Kc(u),f=gh(t.outputs,l),c=0;c<t.lossFunctions.length;++c){var h=t.lossFunctions[c],p=A.mean(h(s[c],f[c]));c===0?i=p:i=A.add(i,p),a.push(i)}for(var c=0;c<t.metricsTensors.length;++c){var d=t.metricsTensors[c][0],m=t.metricsTensors[c][1],v=A.mean(d(s[m],f[m]));a.push(v)}return a})}},e.prototype.fit=function(t,n,a){return a===void 0&&(a={}),Ce(this,void 0,void 0,function(){var i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S,T,E,C,R,_,M,$;return Ee(this,function(z){switch(z.label){case 0:if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0,z.label=1;case 1:return z.trys.push([1,,7,8]),d=a.batchSize==null?32:a.batchSize,zw(d),m=!1,[4,this.standardizeUserData(t,n,a.sampleWeight,a.classWeight,m,d)];case 2:if(v=z.sent(),i=v[0],o=v[1],p=v[2],g=!1,y=void 0,!(a.validationData!=null&&a.validationData.length>0))return[3,4];if(g=!0,a.validationData.length===2)c=a.validationData[0],l=a.validationData[1];else throw a.validationData.length===3?new wt("validationData including sample weights is not supported yet."):new J("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+"".concat(a.validationData," is invalid."));return w=!0,[4,this.standardizeUserData(c,l,null,null,w,d)];case 3:return b=z.sent(),f=b[0],h=b[1],y=f.concat(h),[3,5];case 4:a.validationSplit!=null&&a.validationSplit>0&&a.validationSplit<1?(g=!0,x=Math.floor(i[0].shape[0]*(1-a.validationSplit)),S=i[0].shape[0],f=vh(i,x,S),s=i,i=vh(i,0,x),h=vh(o,x,S),u=o,o=vh(o,0,x),y=f.concat(h)):a.validationSteps!=null&&(g=!0),z.label=5;case 5:return T=i.concat(o).concat(p),this.checkTrainableWeightsConsistency(),E=this.makeTrainFunction(),C=this.getDedupedMetricsNames(),R=void 0,_=void 0,g?(this.makeTestFunction(),R=this.testFunction,_=C.slice().concat(C.map(function(q){return"val_"+q}))):(R=null,y=[],_=C.slice()),M=_q(a.callbacks,a.yieldEvery),[4,this.fitLoop(E,T,C,d,a.epochs,a.verbose,M,R,y,a.shuffle,_,a.initialEpoch,null,null)];case 6:return $=z.sent(),[2,$];case 7:return this.isTraining=!1,Ii(i,t),Ii(o,n),Ii(s,t),Ii(u,n),Ii(f,c),Ii(h,l),p!=null&&A.dispose(p),[7];case 8:return[2]}})})},e.prototype.fitLoop=function(t,n,a,i,o,s,u,c,l,f,h,p,d,m){return Ce(this,void 0,void 0,function(){var v,g,y,w,b,x,S,T,E,C,R=this;return Ee(this,function(_){switch(_.label){case 0:if(i==null&&(i=32),o==null&&(o=1),f==null&&(f=!0),p==null&&(p=0),v=!1,c!=null&&l!=null&&(v=!0),m!=null&&(v=!0,d==null))throw new J("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");return g=this.checkNumSamples(n,i,d,"steps_per_epoch"),g!=null&&(y=Fi(0,g)),s==null&&(s=1),w=Fq(u,s,o,p,g,d,i,v,h),b=w.callbackList,x=w.history,b.setModel(this),this.history=x,[4,b.onTrainBegin()];case 1:_.sent(),this.stopTraining_=!1,S=function(M){var $,z,q,L,U,Y;return Ee(this,function(Z){switch(Z.label){case 0:return[4,b.onEpochBegin(M)];case 1:if(Z.sent(),$={},d==null)return[3,2];throw new wt("stepsPerEpoch mode is not implemented yet.");case 2:if(f==="batch")throw new wt("batch shuffling is not implemneted yet");f&&F.util.shuffle(y),z=F.tensor1d(y),q=$w(g,i),L=function(V){var X;return Ee(this,function(ne){switch(ne.label){case 0:return X={},[4,b.onBatchBegin(V,X)];case 1:return ne.sent(),A.tidy(function(){var re=q[V][0],se=q[V][1],le=ku(z,re,se-re);X.batch=V,X.size=se-re;for(var de=i1(n,le),ke=t(de),he=0;he<a.length;++he){var ye=a[he],xe=ke[he];X[ye]=xe,A.keep(xe)}if(V===q.length-1&&v)for(var De=R.testLoop(c,l,i),he=0;he<a.length;++he){var ye=a[he],xe=De[he];A.keep(xe),$["val_"+ye]=xe}}),[4,b.onBatchEnd(V,X)];case 2:return ne.sent(),Iq(X),T.stopTraining_?[2,"break"]:[2]}})},U=0,Z.label=3;case 3:return U<q.length?[5,L(U)]:[3,6];case 4:if(Y=Z.sent(),Y==="break")return[3,6];Z.label=5;case 5:return++U,[3,3];case 6:z.dispose(),Z.label=7;case 7:return[4,b.onEpochEnd(M,$)];case 8:return Z.sent(),T.stopTraining_?[2,"break"]:[2]}})},T=this,E=p,_.label=2;case 2:return E<o?[5,S(E)]:[3,5];case 3:if(C=_.sent(),C==="break")return[3,5];_.label=4;case 4:return++E,[3,2];case 5:return[4,b.onTrainEnd()];case 6:return _.sent(),[4,this.history.syncData()];case 7:return _.sent(),[2,this.history]}})})},e.prototype.fitDataset=function(t,n){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){return[2,kAe(this,t,n)]})})},e.prototype.trainOnBatch=function(t,n){return Ce(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f,h,p,d,m,v;return Ee(this,function(g){switch(g.label){case 0:return[4,this.standardizeUserData(t,n)];case 1:a=g.sent(),i=a[0],o=a[1],s=this.makeTrainFunction(),u=s(i.concat(o)),c=[],g.label=2;case 2:g.trys.push([2,7,8,9]),l=fe(u),f=l.next(),g.label=3;case 3:return f.done?[3,6]:(h=f.value,[4,h.data()]);case 4:p=g.sent(),c.push(p[0]),g.label=5;case 5:return f=l.next(),[3,3];case 6:return[3,9];case 7:return d=g.sent(),m={error:d},[3,9];case 8:try{f&&!f.done&&(v=l.return)&&v.call(l)}finally{if(m)throw m.error}return[7];case 9:return A.dispose(u),Ii(a[0],t),Ii(a[1],n),[2,Un(c)]}})})},e.prototype.getNamedWeights=function(t){for(var n=[],a=t!=null&&t.trainableOnly,i=a?this.trainableWeights:this.weights,o=this.getWeights(a),s=0;s<i.length;++s)a&&!i[s].trainable||n.push({name:i[s].originalName,tensor:o[s]});return n},Object.defineProperty(e.prototype,"stopTraining",{get:function(){return this.stopTraining_},set:function(t){this.stopTraining_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"optimizer",{get:function(){return this.optimizer_},set:function(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){var t=r.prototype.dispose.call(this);if(t.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){var n=A.memory().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=n-A.memory().numTensors}return t},e.prototype.getLossIdentifiers=function(){var t,n,a,i,o;if(typeof this.loss=="string")o=Eo(this.loss);else if(Array.isArray(this.loss)){try{for(var s=fe(this.loss),u=s.next();!u.done;u=s.next()){var c=u.value;if(typeof c!="string")throw new Error("Serialization of non-string loss is not supported.")}}catch(m){t={error:m}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}o=this.loss.map(function(m){return Eo(m)})}else{var l=Object.keys(this.loss);o={};var f=this.loss;try{for(var h=fe(l),p=h.next();!p.done;p=h.next()){var d=p.value;if(typeof f[d]=="string")o[d]=Eo(f[d]);else throw new Error("Serialization of non-string loss is not supported.")}}catch(m){a={error:m}}finally{try{p&&!p.done&&(i=h.return)&&i.call(h)}finally{if(a)throw a.error}}}return o},e.prototype.getMetricIdentifiers=function(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Eo(Bv(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(function(a){return Eo(Bv(a))});var t={};for(var n in this.metrics)t[n]=Eo(Bv(this.metrics[n]));return t},e.prototype.getTrainingConfig=function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}},e.prototype.loadTrainingConfig=function(t){if(t.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(t.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(t.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");var n=Th(t.optimizer_config),a=Di(n),i;if(typeof t.loss=="string")i=bu(t.loss);else if(Array.isArray(t.loss))i=t.loss.map(function(u){return bu(u)});else if(t.loss!=null){i={};for(var o in t.loss)i[o]=bu(t.loss[o])}var s;if(Array.isArray(t.metrics))s=t.metrics.map(function(u){return bu(u)});else if(t.metrics!=null){s={};for(var o in t.metrics)s[o]=bu(t.metrics[o])}this.compile({loss:i,metrics:s,optimizer:a})},e.prototype.save=function(t,n){return Ce(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f,h,p,d,m,v,g,y;return Ee(this,function(w){switch(w.label){case 0:if(typeof t=="string"){if(a=F.io.getSaveHandlers(t),a.length===0)throw new J("Cannot find any save handlers for URL '".concat(t,"'"));if(a.length>1)throw new J("Found more than one (".concat(a.length,") save handlers for ")+"URL '".concat(t,"'"));t=a[0]}if(t.save==null)throw new J("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,F.io.encodeWeights(this.getNamedWeights(n))];case 1:return i=w.sent(),o=!1,s=null,u=this.toJSON(s,o),c={modelTopology:u,format:DAe,generatedBy:"TensorFlow.js tfjs-layers v".concat(K1),convertedBy:null},l=n==null?!1:n.includeOptimizer,l&&this.optimizer!=null?(c.trainingConfig=this.getTrainingConfig(),f="optimizer",v=(m=F.io).encodeWeights,[4,this.optimizer.getWeights()]):[3,4];case 2:return[4,v.apply(m,[w.sent(),f])];case 3:h=w.sent(),p=h.data,d=h.specs,(y=i.specs).push.apply(y,et([],te(d),!1)),i.data=F.io.concatenateArrayBuffers([i.data,p]),w.label=4;case 4:return this.userDefinedMetadata!=null&&(g=!0,IB(this.userDefinedMetadata,this.name,g),c.userDefinedMetadata=this.userDefinedMetadata),c.weightData=i.data,c.weightSpecs=i.specs,[2,t.save(c)]}})})},e.prototype.setUserDefinedMetadata=function(t){IB(t,this.name),this.userDefinedMetadata=t},e.prototype.getUserDefinedMetadata=function(){return this.userDefinedMetadata},e}(gAe);Io.className="Model";F.serialization.registerClass(Io);var Uq=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(Io);Uq.className="Functional";F.serialization.registerClass(Uq);function _Ae(r,e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f;return Ee(this,function(h){switch(h.label){case 0:return"modelTopology"in r||(r={modelTopology:r}),r=r,t=r.modelTopology,t.model_config!=null&&(t=t.model_config),n=Th(t),a=Di(n,e),r.weightsManifest==null?[3,2]:[4,F.io.loadWeights(r.weightsManifest,r.pathPrefix,a.weights.map(function(p){return p.originalName}))];case 1:i=h.sent(),o={};try{for(s=fe(a.weights),u=s.next();!u.done;u=s.next())c=u.value,o[c.originalName]=i[c.originalName]}catch(p){l={error:p}}finally{try{u&&!u.done&&(f=s.return)&&f.call(s)}finally{if(l)throw l.error}}a.loadWeights(o),F.dispose(i),h.label=2;case 2:return[2,a]}})})}function FAe(r,e){return Ce(this,void 0,void 0,function(){var t;return Ee(this,function(n){if(e==null&&(e={}),typeof r=="string"){if(t=F.io.getLoadHandlers(r,e),t.length===0)t.push(F.io.browserHTTPRequest(r,e));else if(t.length>1)throw new J("Found more than one (".concat(t.length,") load handlers for ")+"URL '".concat(r,"'"));r=t[0]}return[2,RAe(r,void 0,e)]})})}function RAe(r,e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f;return Ee(this,function(h){switch(h.label){case 0:if(t==null&&(t={}),r.load==null)throw new J("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,r.load()];case 1:if(n=h.sent(),a=n.modelTopology,a.model_config!=null&&(a=a.model_config),i=t.strict==null?!0:t.strict,o=n.weightData!=null&&n.weightSpecs!=null&&i,s=Di(Th(a),e,o),u=n.trainingConfig,u!=null&&s.loadTrainingConfig(u),n.userDefinedMetadata!=null&&s.setUserDefinedMetadata(n.userDefinedMetadata),n.weightData==null)return[3,4];if(n.weightSpecs==null)throw new J("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");return c=OAe(n.weightData,n.weightSpecs),l=c.modelWeights,f=c.optimizerWeights,s.loadWeights(l,i),s.optimizer!=null&&f.length>0?[4,s.optimizer.setWeights(f)]:[3,3];case 2:h.sent(),h.label=3;case 3:F.dispose(l),F.dispose(f.map(function(p){return p.tensor})),h.label=4;case 4:return[2,s]}})})}function OAe(r,e){var t=F.io.decodeWeights(r,e),n={},a=[];return e.forEach(function(i){i.group==="optimizer"?a.push({name:i.name,tensor:t[i.name]}):n[i.name]=t[i.name]}),{modelWeights:n,optimizerWeights:a}}var Sm=function(r){oe(e,r);function e(t){var n,a,i=r.call(this,{inputs:[],outputs:[]})||this;if(t=t||{},i.trainable=!0,i.built=!1,i.name=t.name!=null?t.name:sm("sequential_"),t.layers!=null)try{for(var o=fe(t.layers),s=o.next();!s.done;s=o.next()){var u=s.value;i.add(u)}}catch(c){n={error:c}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}return i}return e.prototype.checkShape=function(t){var n=t.inboundNodes[0].outputTensors[0].shape;if(n.some(function(a){return a<0}))throw new J("Negative dimension size caused by adding layer "+"".concat(t.name," with input shape [")+"".concat(t.inboundNodes[0].inputTensors[0].shape,"]"))},e.prototype.add=function(t){var n=t instanceof e||t instanceof Io,a;if(n){if(a=t,a.outputs.length!==1)throw new J("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(a.inputs.length!==1)throw new J("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new J("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var i=JB({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(i)}if(n)this.outputs=a.outputs,this.inputs=a.inputs;else{if(t.inboundNodes.length!==1)throw new J("A layer added to a Sequential model must not already be "+"connected somewhere else. LayersModel received layer ".concat(t.name," ")+"which has ".concat(t.inboundNodes.length," pre-existing inbound ")+"connections.");if(t.inboundNodes[0].outputTensors.length!==1)throw new J("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=YB(this.outputs[0])}this.inboundNodes=[],new mm({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Su(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(function(s){return s.shape}),outputShapes:this.outputs[0].shape})}else{var o=t.apply(this.outputs[0]);if(Array.isArray(o))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[o],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1},e.prototype.pop=function(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},e.prototype.call=function(t,n){return this.model==null&&this.build(),this.model.call(t,n)},e.prototype.build=function(t){if(Rt(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Io({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},e.prototype.countParams=function(){return this.built||this.build(),r.prototype.countParams.call(this)},e.prototype.summary=function(t,n,a){a===void 0&&(a=console.log),this.built||this.build(),r.prototype.summary.call(this,t,n,a)},e.prototype.setWeights=function(t){this.model==null&&this.build(),this.model.setWeights(t)},e.prototype.evaluate=function(t,n,a){if(a===void 0&&(a={}),!this.built)throw new Zi("The model needs to be compiled before being used.");return this.model.evaluate(t,n,a)},e.prototype.evaluateDataset=function(t,n){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){if(!this.built)throw new Zi("The model needs to be compiled before being used.");return[2,this.model.evaluateDataset(t,n)]})})},e.prototype.predict=function(t,n){return n===void 0&&(n={}),this.model==null&&this.build(),this.model.predict(t,n)},e.prototype.predictOnBatch=function(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)},e.prototype.compile=function(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},Object.defineProperty(e.prototype,"optimizer",{get:function(){return this.model==null?void 0:this.model.optimizer},set:function(t){this.model.optimizer=t},enumerable:!1,configurable:!0}),e.prototype.fit=function(t,n,a){return a===void 0&&(a={}),Ce(this,void 0,void 0,function(){return Ee(this,function(i){if(!this.built)throw new Zi("The model needs to be compiled before being used.");return[2,this.model.fit(t,n,a)]})})},e.prototype.fitDataset=function(t,n){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){if(!this.built)throw new Zi("The model needs to be compiled before being used.");return[2,this.model.fitDataset(t,n)]})})},e.prototype.trainOnBatch=function(t,n){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){return[2,this.model.trainOnBatch(t,n)]})})},e.fromConfig=function(t,n,a,i){var o,s;i===void 0&&(i=!1);var u,c={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new J("Legacy serialization format not supported yet.");u=n}else F.util.assert(n.layers!=null,function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."}),u=n.layers,delete n.layers,c=n;var l=new t(c);if(!(l instanceof e))throw new wt("Sequential.fromConfig called on non-Sequential input: ".concat(l));try{for(var f=fe(u),h=f.next();!h.done;h=f.next()){var p=h.value,d=void 0,m=Di(p,d,i);i&&m.setFastWeightInitDuringBuild(!0),l.add(m)}}catch(v){o={error:v}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}return l},Object.defineProperty(e.prototype,"stopTraining",{get:function(){if(this.model==null)throw new J("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(t){if(this.model==null)throw new J("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t},enumerable:!1,configurable:!0}),e.prototype.getConfig=function(){var t,n,a=[];try{for(var i=fe(this.layers),o=i.next();!o.done;o=i.next()){var s=o.value,u={};u.className=s.getClassName(),u.config=s.getConfig(),a.push(u)}}catch(c){t={error:c}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return{name:this.name,layers:a}},e}(Io);Sm.className="Sequential";F.serialization.registerClass(Sm);function PAe(r){return new Io(r)}function MAe(r){return new Sm(r)}function Vq(r){return JB(r)}function BAe(r,e){U1.registerCallbackConstructor(r,e)}var Tn=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getConfig=function(){return{}},e}(F.serialization.Serializable),Gq=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return n===void 0&&(n=1),Vxe(t,n)},e}(Tn);Gq.className="elu";F.serialization.registerClass(Gq);var Hq=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return A.selu(t)},e}(Tn);Hq.className="selu";F.serialization.registerClass(Hq);var jq=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return A.relu(t)},e}(Tn);jq.className="relu";F.serialization.registerClass(jq);var Kq=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return F.tidy(function(){return A.minimum(6,A.relu(t))})},e}(Tn);Kq.className="relu6";F.serialization.registerClass(Kq);var Xq=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return t},e}(Tn);Xq.className="linear";F.serialization.registerClass(Xq);var Yq=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return A.sigmoid(t)},e}(Tn);Yq.className="sigmoid";F.serialization.registerClass(Yq);var Jq=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return Hxe(t)},e}(Tn);Jq.className="hardSigmoid";F.serialization.registerClass(Jq);var Zq=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return A.softplus(t)},e}(Tn);Zq.className="softplus";F.serialization.registerClass(Zq);var Qq=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return Gxe(t)},e}(Tn);Qq.className="softsign";F.serialization.registerClass(Qq);var ez=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return A.tanh(t)},e}(Tn);ez.className="tanh";F.serialization.registerClass(ez);var X1=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return n===void 0&&(n=-1),A.softmax(t,n)},e}(Tn);X1.className="softmax";F.serialization.registerClass(X1);var tz=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return n===void 0&&(n=-1),A.logSoftmax(t,n)},e}(Tn);tz.className="logSoftmax";F.serialization.registerClass(tz);var rz=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return F.tidy(function(){return A.tidy(function(){var n=Math.sqrt(2),a=A.mul(.5,A.add(1,A.erf(A.div(t,n))));return A.mul(t,a)})})},e}(Tn);rz.className="gelu";F.serialization.registerClass(rz);var nz=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return F.tidy(function(){return A.mul(.5,A.mul(t,A.add(1,A.tanh(A.mul(A.sqrt(A.div(2,Math.PI)),A.add(t,A.mul(.044715,A.pow(t,3))))))))})},e}(Tn);nz.className="gelu_new";F.serialization.registerClass(nz);var az=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return F.tidy(function(){return A.mul(t,A.tanh(A.softplus(t)))})},e}(Tn);az.className="mish";F.serialization.registerClass(az);var iz=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return n===void 0&&(n=1),F.tidy(function(){return A.mul(A.sigmoid(A.mul(t,n)),t)})},e}(Tn);iz.className="swish";F.serialization.registerClass(iz);function ws(r){return r.getClassName()}function Ww(r,e){return e===void 0&&(e={}),Ih(r,F.serialization.SerializationMap.getMap().classNameMap,e,"activation")}function xs(r){if(r==null){var e={};return e.className="linear",e.config={},Ww(e)}if(typeof r=="string"){var e={};return e.className=r,e.config={},Ww(e)}else return r instanceof Tn?r:Ww(r)}function Y1(r){if(r!=null&&typeof r!="object")throw new Error("Argument to L1L2 regularizer's constructor is expected to be an "+"object, but received: ".concat(r))}var oz=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(F.serialization.Serializable),Ph=function(r){oe(e,r);function e(t){var n=r.call(this)||this;return Y1(t),n.l1=t==null||t.l1==null?.01:t.l1,n.l2=t==null||t.l2==null?.01:t.l2,n.hasL1=n.l1!==0,n.hasL2=n.l2!==0,n}return e.prototype.apply=function(t){var n=this;return F.tidy(function(){var a=F.zeros([1]);return n.hasL1&&(a=F.add(a,F.sum(A.mul(n.l1,F.abs(t))))),n.hasL2&&(a=F.add(a,F.sum(A.mul(n.l2,Ah(t))))),A.reshape(a,[])})},e.prototype.getConfig=function(){return{l1:this.l1,l2:this.l2}},e.fromConfig=function(t,n){return new t({l1:n.l1,l2:n.l2})},e}(oz);Ph.className="L1L2";F.serialization.registerClass(Ph);function LAe(r){return Y1(r),new Ph({l1:r!=null?r.l1:null,l2:0})}function qAe(r){return Y1(r),new Ph({l2:r!=null?r.l2:null,l1:0})}var RB={l1l2:"L1L2"};function Xt(r){return s1(r)}function OB(r,e){return e===void 0&&(e={}),Ih(r,F.serialization.SerializationMap.getMap().classNameMap,e,"regularizer")}function br(r){if(r==null)return null;if(typeof r=="string"){var e=r in RB?RB[r]:r,t={className:e,config:{}};return OB(t)}else return r instanceof oz?r:OB(r)}var J1=function(r){oe(e,r);function e(t){var n=r.call(this,t??{})||this;return n.supportsMasking=!0,t!=null&&(n.maxValue=t.maxValue),n}return e.prototype.call=function(t,n){t=ut(t);var a=F.relu(t);return this.maxValue!=null&&(a=F.clipByValue(a,0,this.maxValue)),a},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={maxValue:this.maxValue},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(xt);J1.className="ReLU";F.serialization.registerClass(J1);var Z1=function(r){oe(e,r);function e(t){var n=r.call(this,t??{})||this;return n.DEFAULT_ALPHA=.3,t==null&&(t={}),n.alpha=t.alpha==null?n.DEFAULT_ALPHA:t.alpha,n}return e.prototype.call=function(t,n){var a=ut(t);return F.leakyRelu(a,this.alpha)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={alpha:this.alpha},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(xt);Z1.className="LeakyReLU";F.serialization.registerClass(Z1);var Q1=function(r){oe(e,r);function e(t){var n=r.call(this,t??{})||this;if(n.DEFAULT_ALPHA_INITIALIZER="zeros",t==null&&(t={}),n.supportsMasking=!0,n.alphaInitializer=gr(t.alphaInitializer||n.DEFAULT_ALPHA_INITIALIZER),n.alphaRegularizer=br(t.alphaRegularizer),n.alphaConstraint=Zr(t.alphaConstraint),t.sharedAxes==null)n.sharedAxes=null;else if(Array.isArray(t.sharedAxes))n.sharedAxes=t.sharedAxes;else if(typeof t.sharedAxes=="number")n.sharedAxes=[t.sharedAxes];else throw new J("Expected sharedAxes to be a number or an array of numbers, "+"but got ".concat(t.sharedAxes));return n}return e.prototype.build=function(t){var n,a;t=Rt(t);var i=t.slice(1);if(this.sharedAxes!=null)try{for(var o=fe(this.sharedAxes),s=o.next();!s.done;s=o.next()){var u=s.value;i[u-1]=1}}catch(l){n={error:l}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}this.alpha=this.addWeight("alpha",i,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var c={};if(this.sharedAxes!=null)for(var u=1;u<t.length;++u)c[u]=t[u];this.inputSpec=[new Kr({ndim:t.length,axes:c})],this.built=!0},e.prototype.call=function(t,n){return t=ut(t),F.prelu(t,this.alpha.read())},e.prototype.getConfig=function(){var t={alphaInitializer:Cr(this.alphaInitializer),alphaRegularizer:Xt(this.alphaRegularizer),alphaConstraint:Jr(this.alphaConstraint),sharedAxes:this.sharedAxes},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(xt);Q1.className="PReLU";F.serialization.registerClass(Q1);var ex=function(r){oe(e,r);function e(t){var n=r.call(this,t??{})||this;if(n.DEFAULT_ALPHA=1,t==null&&(t={}),t.alpha!=null&&t.alpha!==n.DEFAULT_ALPHA)throw new wt("Non-default alpha value (".concat(t.alpha,") is not supported by the ")+"ELU layer yet.");return n.alpha=t.alpha==null?n.DEFAULT_ALPHA:t.alpha,n}return e.prototype.call=function(t,n){var a=ut(t);return F.elu(a)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={alpha:this.alpha},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(xt);ex.className="ELU";F.serialization.registerClass(ex);var tx=function(r){oe(e,r);function e(t){var n=r.call(this,t??{})||this;return n.DEFAULT_THETA=1,t==null&&(t={}),n.theta=t.theta==null?n.DEFAULT_THETA:t.theta,n}return e.prototype.call=function(t,n){var a=ut(t);return F.mul(a,F.cast(F.greater(a,this.theta),"float32"))},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={theta:this.theta},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(xt);tx.className="ThresholdedReLU";F.serialization.registerClass(tx);var rx=function(r){oe(e,r);function e(t){var n=r.call(this,t??{})||this;return n.DEFAULT_AXIS=1,t==null&&(t={}),n.softmax=new X1().apply,n.axis=t.axis==null?n.DEFAULT_AXIS:t.axis,n}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=ut(t),o=n.mask;if(o!=null){var s=F.mul(F.sub(F.ones(i.shape),F.cast(o,i.dtype)),F.scalar(-1e9));i=F.add(i,s)}return a.axis instanceof Array?a.axis.length>1?F.exp(F.sub(i,F.logSumExp(i,a.axis,!0))):a.softmax(i,a.axis[0]):a.softmax(i,a.axis)})},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={axis:this.axis},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(xt);rx.className="Softmax";F.serialization.registerClass(rx);function Jc(r,e,t){if(typeof r=="number")return Su(r,e);if(r.length!==e)throw new J("The ".concat(t," argument must be an integer or tuple of ").concat(e," integers.")+" Received: ".concat(r.length," elements."));for(var n=0;n<e;++n){var a=r[n];if(!zxe(a))throw new J("The ".concat(t," argument must be an integer or tuple of ").concat(e)+" integers. Received: ".concat(JSON.stringify(r)," including a")+" non-integer number ".concat(a))}return r}function _i(r,e,t,n,a){if(a===void 0&&(a=1),r==null)return r;var i=e+(e-1)*(a-1),o;return t==="same"?o=r:o=r-i+1,Math.floor((o+n-1)/n)}function Ji(r,e,t,n){if(r==null)return null;if(n==="valid")r=r*e+bs([t-e,0]);else if(n==="same")r=r*e;else throw new J("Unsupport padding mode: ".concat(n,"."));return r}function nx(r,e){return F.tidy(function(){return qr(e),e==="channelsFirst"?A.transpose(r,[0,2,3,1]):r})}function sz(r,e){return F.tidy(function(){return qr(e),e==="channelsFirst"?A.transpose(r,[0,2,3,4,1]):r})}function zAe(r,e,t,n,a,i,o){return n===void 0&&(n=1),a===void 0&&(a="valid"),o===void 0&&(o=1),F.tidy(function(){if(i==null&&(i=Ri()),qr(i),r.shape.length!==3)throw new J("The input of a conv1dWithBias operation should be 3, but is "+"".concat(r.shape.length," instead."));if(e.shape.length!==3)throw new J("The kernel for a conv1dWithBias operation should be 3, but is "+"".concat(e.shape.length," instead"));if(t!=null&&t.shape.length!==1)throw new J("The bias for a conv1dWithBias operation should be 1, but is "+"".concat(t.shape.length," instead"));if(i==="channelsFirst"&&(r=A.transpose(r,[0,2,1])),a==="causal")throw new wt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=A.conv1d(r,e,n,a==="same"?"same":"valid","NWC",o);return t!=null&&(s=Mi(s,t)),s})}function PB(r,e,t,n,a,i,o,s){return n===void 0&&(n=[1,1]),a===void 0&&(a="valid"),s===void 0&&(s=null),F.tidy(function(){if(i==null&&(i=Ri()),qr(i),r.rank!==3&&r.rank!==4)throw new J("conv2dWithBiasActivation expects input to be of rank 3 or 4, "+"but received ".concat(r.rank,"."));if(e.rank!==3&&e.rank!==4)throw new J("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, "+"but received ".concat(r.rank,"."));var u=nx(r,i);if(a==="causal")throw new wt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=A.fused.conv2d({x:u,filter:e,strides:n,pad:a==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:t,activation:s}),i==="channelsFirst"&&(u=A.transpose(u,[0,3,1,2])),u})}function $Ae(r,e,t,n,a,i,o){return n===void 0&&(n=[1,1,1]),a===void 0&&(a="valid"),F.tidy(function(){if(i==null&&(i=Ri()),qr(i),r.rank!==4&&r.rank!==5)throw new J("conv3dWithBias expects input to be of rank 4 or 5, but received "+"".concat(r.rank,"."));if(e.rank!==4&&e.rank!==5)throw new J("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+"".concat(r.rank,"."));var s=sz(r,i);if(a==="causal")throw new wt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=A.conv3d(s,e,n,a==="same"?"same":"valid","NDHWC",o),t!=null&&(s=Mi(s,t)),i==="channelsFirst"&&(s=A.transpose(s,[0,4,1,2,3])),s})}var uz=function(r){oe(e,r);function e(t,n){var a=r.call(this,n)||this;if(a.bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",e.verifyArgs(n),a.rank=t,sn(a.rank,"rank"),a.rank!==1&&a.rank!==2&&a.rank!==3)throw new wt("Convolution layer for rank other than 1, 2, or 3 (".concat(a.rank,") is ")+"not implemented yet.");if(a.kernelSize=Jc(n.kernelSize,t,"kernelSize"),a.strides=Jc(n.strides==null?1:n.strides,t,"strides"),a.padding=n.padding==null?"valid":n.padding,Ra(a.padding),a.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,qr(a.dataFormat),a.activation=xs(n.activation),a.useBias=n.useBias==null?!0:n.useBias,a.biasInitializer=gr(n.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=Zr(n.biasConstraint),a.biasRegularizer=br(n.biasRegularizer),a.activityRegularizer=br(n.activityRegularizer),a.dilationRate=Jc(n.dilationRate==null?1:n.dilationRate,t,"dilationRate"),a.rank===1&&Array.isArray(a.dilationRate)&&a.dilationRate.length!==1)throw new J("dilationRate must be a number or an array of a single number for 1D convolution, but received "+"".concat(JSON.stringify(a.dilationRate)));if(a.rank===2){if(typeof a.dilationRate=="number")a.dilationRate=[a.dilationRate,a.dilationRate];else if(a.dilationRate.length!==2)throw new J("dilationRate must be a number or array of two numbers for 2D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)))}else if(a.rank===3){if(typeof a.dilationRate=="number")a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(a.dilationRate.length!==3)throw new J("dilationRate must be a number or array of three numbers for 3D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)))}return a}return e.verifyArgs=function(t){if(Yi("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!u1(t.kernelSize,"number",1,3))throw new J("BaseConv expects config.kernelSize to be number or number[] with "+"length 1, 2, or 3, but received ".concat(JSON.stringify(t.kernelSize),"."))},e.prototype.getConfig=function(){var t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:ws(this.activation),useBias:this.useBias,biasInitializer:Cr(this.biasInitializer),biasRegularizer:Xt(this.biasRegularizer),activityRegularizer:Xt(this.activityRegularizer),biasConstraint:Jr(this.biasConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(xt),Nm=function(r){oe(e,r);function e(t,n){var a=r.call(this,t,n)||this;return a.kernel=null,e.verifyArgs(n),a.filters=n.filters,sn(a.filters,"filters"),a.kernelInitializer=gr(n.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=Zr(n.kernelConstraint),a.kernelRegularizer=br(n.kernelRegularizer),a}return e.prototype.build=function(t){var n;t=Rt(t);var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new J("The channel dimension of the input should be defined. "+"Found ".concat(t[a]));var i=t[a],o=this.kernelSize.concat([i,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(n={},n[a]=i,n)}],this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){t=ut(t);var i,o=a.bias==null?null:a.bias.read(),s=$B(a.activation.getClassName());if(s!=null&&a.rank===2)i=PB(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate,s);else{if(a.rank===1)i=zAe(t,a.kernel.read(),o,a.strides[0],a.padding,a.dataFormat,a.dilationRate[0]);else if(a.rank===2)i=PB(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate);else if(a.rank===3)i=$Ae(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate);else throw new wt("convolutions greater than 3D are not implemented yet.");a.activation!=null&&(i=a.activation.apply(i))}return i})},e.prototype.computeOutputShape=function(t){t=Rt(t);for(var n=[],a=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2),i=0;i<a.length;++i){var o=_i(a[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);n.push(o)}var s=[t[0]];return this.dataFormat==="channelsLast"?(s=s.concat(n),s.push(this.filters)):(s.push(this.filters),s=s.concat(n)),s},e.prototype.getConfig=function(){var t={filters:this.filters,kernelInitializer:Cr(this.kernelInitializer),kernelRegularizer:Xt(this.kernelRegularizer),kernelConstraint:Jr(this.kernelConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.verifyArgs=function(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new J("Convolution layer expected config.filters to be a 'number' > 0 "+"but got ".concat(JSON.stringify(t.filters)))},e}(uz),Tm=function(r){oe(e,r);function e(t){var n=r.call(this,2,t)||this;return e.verifyArgs(t),n}return e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!u1(t.kernelSize,"number",1,2))throw new J("Conv2D expects config.kernelSize to be number or number[] with "+"length 1 or 2, but received ".concat(JSON.stringify(t.kernelSize),"."))},e}(Nm);Tm.className="Conv2D";F.serialization.registerClass(Tm);var Em=function(r){oe(e,r);function e(t){var n=r.call(this,3,t)||this;return e.verifyArgs(t),n}return e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!(Array.isArray(t.kernelSize)&&(t.kernelSize.length===1||t.kernelSize.length===3)))throw new J("Conv3D expects config.kernelSize to be number or"+" [number, number, number], but received ".concat(JSON.stringify(t.kernelSize),"."))},e}(Nm);Em.className="Conv3D";F.serialization.registerClass(Em);var ax=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;if(n.inputSpec=[new Kr({ndim:4})],n.padding!=="same"&&n.padding!=="valid")throw new J("Conv2DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(n.padding));return n}return e.prototype.build=function(t){var n;if(t=Rt(t),t.length!==4)throw new J("Input should have rank 4; Received input shape: "+JSON.stringify(t));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new J("The channel dimension of the inputs should be defined. Found `None`.");var i=t[a],o=this.kernelSize.concat([this.filters,i]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Kr({ndim:4,axes:(n={},n[a]=i,n)})],this.built=!0},e.prototype.call=function(t,n){var a=this;return A.tidy(function(){var i=ut(t);if(i.shape.length!==4)throw new J("Conv2DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(i.shape.length));var o=i.shape,s=o[0],u,c;a.dataFormat==="channelsFirst"?(u=2,c=3):(u=1,c=2);var l=o[u],f=o[c],h=a.kernelSize[0],p=a.kernelSize[1],d=a.strides[0],m=a.strides[1],v=Ji(l,d,h,a.padding),g=Ji(f,m,p,a.padding),y=[s,v,g,a.filters];a.dataFormat!=="channelsLast"&&(i=A.transpose(i,[0,2,3,1]));var w=A.conv2dTranspose(i,a.kernel.read(),y,a.strides,a.padding);return a.dataFormat!=="channelsLast"&&(w=A.transpose(w,[0,3,1,2])),a.bias!=null&&(w=Mi(w,a.bias.read(),a.dataFormat)),a.activation!=null&&(w=a.activation.apply(w)),w})},e.prototype.computeOutputShape=function(t){t=Rt(t);var n=t.slice(),a,i,o;this.dataFormat==="channelsFirst"?(a=1,i=2,o=3):(a=3,i=1,o=2);var s=this.kernelSize[0],u=this.kernelSize[1],c=this.strides[0],l=this.strides[1];return n[a]=this.filters,n[i]=Ji(n[i],c,s,this.padding),n[o]=Ji(n[o],l,u,this.padding),n},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.dilationRate,t},e}(Tm);ax.className="Conv2DTranspose";F.serialization.registerClass(ax);var ix=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;if(n.inputSpec=[new Kr({ndim:5})],n.padding!=="same"&&n.padding!=="valid")throw new J("Conv3DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(n.padding));return n}return e.prototype.build=function(t){var n;if(t=Rt(t),t.length!==5)throw new J("Input should have rank 5; Received input shape: "+JSON.stringify(t));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new J("The channel dimension of the inputs should be defined. Found `None`.");var i=t[a],o=this.kernelSize.concat([this.filters,i]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Kr({ndim:5,axes:(n={},n[a]=i,n)})],this.built=!0},e.prototype.call=function(t,n){var a=this;return A.tidy(function(){var i=ut(t);if(i.shape.length!==5)throw new J("Conv3DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(i.shape.length));var o=i.shape,s=o[0],u,c,l;a.dataFormat==="channelsFirst"?(l=2,u=3,c=4):(l=1,u=2,c=3);var f=o[l],h=o[u],p=o[c],d=a.kernelSize[0],m=a.kernelSize[1],v=a.kernelSize[2],g=a.strides[0],y=a.strides[1],w=a.strides[2],b=Ji(f,g,d,a.padding),x=Ji(h,y,m,a.padding),S=Ji(p,w,v,a.padding),T=[s,b,x,S,a.filters];a.dataFormat!=="channelsLast"&&(i=A.transpose(i,[0,2,3,4,1]));var E=A.conv3dTranspose(i,a.kernel.read(),T,a.strides,a.padding);return a.dataFormat!=="channelsLast"&&(E=A.transpose(E,[0,4,1,2,3])),a.bias!==null&&(E=Mi(E,a.bias.read(),a.dataFormat)),a.activation!==null&&(E=a.activation.apply(E)),E})},e.prototype.computeOutputShape=function(t){t=Rt(t);var n=t.slice(),a,i,o,s;this.dataFormat==="channelsFirst"?(a=1,i=2,o=3,s=4):(a=4,i=1,o=2,s=3);var u=this.kernelSize[0],c=this.kernelSize[1],l=this.kernelSize[2],f=this.strides[0],h=this.strides[1],p=this.strides[2];return n[a]=this.filters,n[i]=Ji(n[i],f,u,this.padding),n[o]=Ji(n[o],h,c,this.padding),n[s]=Ji(n[s],p,l,this.padding),n},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.dilationRate,t},e}(Em);ix.className="Conv3DTranspose";F.serialization.registerClass(ix);var cz=function(r){oe(e,r);function e(t,n){var a=r.call(this,t,n)||this;if(a.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,n.filters==null)throw new J("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new J("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new J("SeparableConv".concat(a.rank,"D supports only padding modes: ")+"'same' and 'valid', but received ".concat(JSON.stringify(n.padding)));return a.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,a.depthwiseInitializer=gr(n.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=br(n.depthwiseRegularizer),a.depthwiseConstraint=Zr(n.depthwiseConstraint),a.pointwiseInitializer=gr(n.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=br(n.pointwiseRegularizer),a.pointwiseConstraint=Zr(n.pointwiseConstraint),a}return e.prototype.build=function(t){var n;if(t=Rt(t),t.length<this.rank+2)throw new J("Inputs to SeparableConv".concat(this.rank,"D should have rank ")+"".concat(this.rank+2,", but received input shape: ")+"".concat(JSON.stringify(t)));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null||t[a]<0)throw new J("The channel dimension of the inputs should be defined, "+"but found ".concat(JSON.stringify(t[a])));for(var i=t[a],o=this.kernelSize.concat([i,this.depthMultiplier]),s=[],u=0;u<this.rank;++u)s.push(1);s.push(i*this.depthMultiplier,this.filters);var c=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",o,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,c,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",s,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,c,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,c,this.biasConstraint):this.bias=null,this.inputSpec=[new Kr({ndim:this.rank+2,axes:(n={},n[a]=i,n)})],this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){t=ut(t);var i;if(a.rank===1)throw new wt("1D separable convolution is not implemented yet.");return a.rank===2&&(a.dataFormat==="channelsFirst"&&(t=A.transpose(t,[0,2,3,1])),i=A.separableConv2d(t,a.depthwiseKernel.read(),a.pointwiseKernel.read(),a.strides,a.padding,a.dilationRate,"NHWC")),a.useBias&&(i=Mi(i,a.bias.read(),a.dataFormat)),a.activation!=null&&(i=a.activation.apply(i)),a.dataFormat==="channelsFirst"&&(i=A.transpose(i,[0,3,1,2])),i})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=Cr(this.depthwiseInitializer),t.pointwiseInitializer=Cr(this.pointwiseInitializer),t.depthwiseRegularizer=Xt(this.depthwiseRegularizer),t.pointwiseRegularizer=Xt(this.pointwiseRegularizer),t.depthwiseConstraint=Jr(this.depthwiseConstraint),t.pointwiseConstraint=Jr(this.pointwiseConstraint),t},e}(Nm);cz.className="SeparableConv";var ox=function(r){oe(e,r);function e(t){return r.call(this,2,t)||this}return e}(cz);ox.className="SeparableConv2D";F.serialization.registerClass(ox);var sx=function(r){oe(e,r);function e(t){var n=r.call(this,1,t)||this;return e.verifyArgs(t),n.inputSpec=[{ndim:3}],n}return e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,delete t.dataFormat,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!u1(t.kernelSize,"number",1,1))throw new J("Conv1D expects config.kernelSize to be number or number[] with "+"length 1, but received ".concat(JSON.stringify(t.kernelSize),"."))},e}(Nm);sx.className="Conv1D";F.serialization.registerClass(sx);var ux=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return typeof t.cropping=="number"?n.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:typeof t.cropping[0]=="number"?n.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:n.cropping=t.cropping,n.dataFormat=t.dataFormat===void 0?"channelsLast":t.dataFormat,n.inputSpec=[{ndim:4}],n}return e.prototype.computeOutputShape=function(t){return this.dataFormat==="channelsFirst"?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){if(t=ut(t),a.dataFormat==="channelsLast"){var i=Mv(t,a.cropping[0][0],t.shape[1]-a.cropping[0][0]-a.cropping[0][1],2);return Mv(i,a.cropping[1][0],t.shape[2]-a.cropping[1][1]-a.cropping[1][0],3)}else{var i=Mv(t,a.cropping[0][0],t.shape[2]-a.cropping[0][0]-a.cropping[0][1],3);return Mv(i,a.cropping[1][0],t.shape[3]-a.cropping[1][1]-a.cropping[1][0],4)}})},e.prototype.getConfig=function(){var t={cropping:this.cropping,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(xt);ux.className="Cropping2D";F.serialization.registerClass(ux);var cx=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.DEFAULT_SIZE=[2,2],n.inputSpec=[{ndim:4}],n.size=t.size==null?n.DEFAULT_SIZE:t.size,n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,qr(n.dataFormat),n.interpolation=t.interpolation==null?"nearest":t.interpolation,Bxe(n.interpolation),n}return e.prototype.computeOutputShape=function(t){if(this.dataFormat==="channelsFirst"){var n=t[2]==null?null:this.size[0]*t[2],a=t[3]==null?null:this.size[1]*t[3];return[t[0],t[1],n,a]}else{var n=t[1]==null?null:this.size[0]*t[1],a=t[2]==null?null:this.size[1]*t[2];return[t[0],n,a,t[3]]}},e.prototype.call=function(t,n){var a=this;return A.tidy(function(){var i=ut(t),o=i.shape;if(a.dataFormat==="channelsFirst"){i=A.transpose(i,[0,2,3,1]);var s=a.size[0]*o[2],u=a.size[1]*o[3],c=a.interpolation==="nearest"?A.image.resizeNearestNeighbor(i,[s,u]):A.image.resizeBilinear(i,[s,u]);return A.transpose(c,[0,3,1,2])}else{var s=a.size[0]*o[1],u=a.size[1]*o[2];return a.interpolation==="nearest"?A.image.resizeNearestNeighbor(i,[s,u]):A.image.resizeBilinear(i,[s,u])}})},e.prototype.getConfig=function(){var t={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(xt);cx.className="UpSampling2D";F.serialization.registerClass(cx);function WAe(r,e,t,n,a,i){return t===void 0&&(t=[1,1]),n===void 0&&(n="valid"),F.tidy(function(){a==null&&(a=Ri()),qr(a);var o=nx(r,a);if(r.rank!==4)throw new J("Input for depthwiseConv2d is required to be 4-D, but is instead "+"".concat(r.rank,"-D"));if(e.rank!==4)throw new J("depthwiseKernel is required to be 4-D, but is instead "+"".concat(e.rank,"-D"));return o=A.depthwiseConv2d(o,e,t,n==="same"?"same":"valid","NHWC",i),a==="channelsFirst"&&(o=A.transpose(o,[0,3,1,2])),o})}var lx=function(r){oe(e,r);function e(t){var n=r.call(this,2,t)||this;return n.depthwiseKernel=null,n.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,n.depthwiseInitializer=gr(t.depthwiseInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.depthwiseConstraint=Zr(t.depthwiseConstraint),n.depthwiseRegularizer=br(t.depthwiseRegularizer),n}return e.prototype.build=function(t){if(t=Rt(t),t.length<4)throw new J("Inputs to DepthwiseConv2D should have rank 4. "+"Received input shape: ".concat(JSON.stringify(t),"."));var n=this.dataFormat==="channelsFirst"?1:3;if(t[n]==null||t[n]<0)throw new J("The channel dimension of the inputs to DepthwiseConv2D should "+"be defined, but is not (".concat(t[n],")."));var a=t[n],i=[this.kernelSize[0],this.kernelSize[1],a,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[a*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){t=ut(t);var i=WAe(t,a.depthwiseKernel.read(),a.strides,a.padding,a.dataFormat,null);return a.useBias&&(i=Mi(i,a.bias.read(),a.dataFormat)),a.activation!=null&&(i=a.activation.apply(i)),i})},e.prototype.computeOutputShape=function(t){t=Rt(t);var n=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,o=_i(n,this.kernelSize[0],this.padding,this.strides[0]),s=_i(a,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[t[0],i,o,s]:[t[0],o,s,i]},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=Cr(this.depthwiseInitializer),t.depthwiseRegularizer=Xt(this.depthwiseRegularizer),t.depthwiseConstraint=Jr(this.depthwiseRegularizer),t},e}(uz);lx.className="DepthwiseConv2D";F.serialization.registerClass(lx);function lz(r,e,t,n){if(Array.isArray(r)){if(e!=null||t!=null)throw new J("When inputs is an array, neither initialState or constants should be provided");n!=null&&(t=r.slice(r.length-n,r.length),r=r.slice(0,r.length-n)),r.length>1&&(e=r.slice(1,r.length)),r=r[0]}function a(i){return i==null||Array.isArray(i)?i:[i]}return e=a(e),t=a(t),{inputs:r,initialState:e,constants:t}}function fz(r,e,t,n,a,i,o,s){return n===void 0&&(n=!1),o===void 0&&(o=!1),s===void 0&&(s=!1),A.tidy(function(){var u=e.shape.length;if(u<3)throw new J("Input should be at least 3D, but is ".concat(u,"D."));var c=[1,0].concat(Fi(2,u));if(e=A.transpose(e,c),i!=null)throw new wt("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),a!=null&&(a=A.cast(A.cast(a,"bool"),"float32"),a.rank===u-1&&(a=A.expandDims(a,-1)),a=A.transpose(a,c)),n&&(e=A.reverse(e,0),a!=null&&(a=A.reverse(a,0)));var l=[],f,h=t,p=e.shape[0],d=A.unstack(e),m;a!=null&&(m=A.unstack(a));for(var v=function(b){var x=d[b],S=A.tidy(function(){return r(x,h)});if(a==null)f=S[0],h=S[1];else{var T=A.tidy(function(){var E=m[b],C=A.sub(A.onesLike(E),E),R=A.add(A.mul(S[0],E),A.mul(h[0],C)),_=h.map(function(M,$){return A.add(A.mul(S[1][$],E),A.mul(M,C))});return{output:R,newStates:_}});f=T.output,h=T.newStates}s&&l.push(f)},g=0;g<p;++g)v(g);var y;if(s){var w=1;y=A.stack(l,w)}return[f,y,h]})}var Co=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this,a;if(t.cell==null)throw new J("cell property is missing for the constructor of RNN.");if(Array.isArray(t.cell)?a=new Am({cells:t.cell}):a=t.cell,a.stateSize==null)throw new J("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return n.cell=a,n.returnSequences=t.returnSequences==null?!1:t.returnSequences,n.returnState=t.returnState==null?!1:t.returnState,n.goBackwards=t.goBackwards==null?!1:t.goBackwards,n._stateful=t.stateful==null?!1:t.stateful,n.unroll=t.unroll==null?!1:t.unroll,n.supportsMasking=!0,n.inputSpec=[new Kr({ndim:3})],n.stateSpec=null,n.states_=null,n.numConstants=null,n.keptStates=[],n}return e.prototype.getStates=function(){if(this.states_==null){var t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Fi(0,t).map(function(n){return null})}else return this.states_},e.prototype.setStates=function(t){this.states_=t},e.prototype.computeOutputShape=function(t){var n,a;jw(t)&&(t=t[0]),t=t;var i=this.cell.stateSize;Array.isArray(i)||(i=[i]);var o=i[0],s;if(this.returnSequences?s=[t[0],t[1],o]:s=[t[0],o],this.returnState){var u=[];try{for(var c=fe(i),l=c.next();!l.done;l=c.next()){var f=l.value;u.push([t[0],f])}}catch(h){n={error:h}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}return[s].concat(u)}else return s},e.prototype.computeMask=function(t,n){var a=this;return A.tidy(function(){Array.isArray(n)&&(n=n[0]);var i=a.returnSequences?n:null;if(a.returnState){var o=a.states.map(function(s){return null});return[i].concat(o)}else return i})},Object.defineProperty(e.prototype,"states",{get:function(){if(this.states_==null){for(var t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[],a=0;a<t;++a)n.push(null);return n}else return this.states_},set:function(t){this.states_=t},enumerable:!1,configurable:!0}),e.prototype.build=function(t){if(this.numConstants!=null)throw new wt("Constants support is not implemented in RNN yet.");jw(t)&&(t=t[0]),t=t;var n=this.stateful?t[0]:null,a=t.slice(2);this.inputSpec[0]=new Kr({shape:et([n,null],te(a),!1)});var i=[t[0]].concat(t.slice(2));this.cell.build(i);var o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!F.util.arraysEqual(this.stateSpec.map(function(s){return s.shape[s.shape.length-1]}),o))throw new J("An initialState was passed that is not compatible with "+"cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; ")+"However cell.stateSize is ".concat(this.cell.stateSize))}else this.stateSpec=o.map(function(s){return new Kr({shape:[null,s]})});this.stateful&&this.resetStates()},e.prototype.resetStates=function(t,n){var a=this;n===void 0&&(n=!1),F.tidy(function(){if(!a.stateful)throw new ms("Cannot call resetStates() on an RNN Layer that is not stateful.");var i=a.inputSpec[0].shape[0];if(i==null)throw new J("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(a.states_==null)Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(l){return A.zeros([i,l])}):a.states_=[A.zeros([i,a.cell.stateSize])];else if(t==null)A.dispose(a.states_),a.keptStates!=null&&(A.dispose(a.keptStates),a.keptStates=[]),Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(l){return A.zeros([i,l])}):a.states_[0]=A.zeros([i,a.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==a.states_.length)throw new J("Layer ".concat(a.name," expects ").concat(a.states_.length," state(s), ")+"but it received ".concat(t.length," state value(s). Input ")+"received: ".concat(t));n===!0?a.keptStates.push(a.states_.slice()):A.dispose(a.states_);for(var o=0;o<a.states_.length;++o){var s=t[o],u=Array.isArray(a.cell.stateSize)?a.cell.stateSize[o]:a.cell.stateSize,c=[i,u];if(!F.util.arraysEqual(s.shape,c))throw new J("State ".concat(o," is incompatible with layer ").concat(a.name,": ")+"expected shape=".concat(c,", received shape=").concat(s.shape));a.states_[o]=s}}a.states_=a.states_.map(function(l){return A.keep(l.clone())})})},e.prototype.apply=function(t,n){var a,i,o=n==null?null:n.initialState,s=n==null?null:n.constants;n==null&&(n={});var u=lz(t,o,s,this.numConstants);t=u.inputs,o=u.initialState,s=u.constants;var c=[],l=[];if(o!=null){n.initialState=o,c=c.concat(o),this.stateSpec=[];try{for(var f=fe(o),h=f.next();!h.done;h=f.next()){var p=h.value;this.stateSpec.push(new Kr({shape:p.shape}))}}catch(w){a={error:w}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}l=l.concat(this.stateSpec)}s!=null&&(n.constants=s,c=c.concat(s),this.numConstants=s.length);var d=c[0]instanceof Oi;if(d){var m=[t].concat(c),v=this.inputSpec.concat(l),g=this.inputSpec;this.inputSpec=v;var y=r.prototype.apply.call(this,m,n);return this.inputSpec=g,y}else return r.prototype.apply.call(this,t,n)},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;t=ut(t),s==null&&(a.stateful?s=a.states_:s=a.getInitialState(t));var u=Array.isArray(a.cell.stateSize)?a.cell.stateSize.length:1;if(s.length!==u)throw new J("RNN Layer has ".concat(u," state(s) but was passed ")+"".concat(s.length," initial state(s)."));a.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var c={training:o},l=function(v,g){var y=a.cell.call([v].concat(g),c);return[y[0],y.slice(1)]},f=fz(l,t,s,a.goBackwards,i,null,a.unroll,a.returnSequences),h=f[0],p=f[1],d=f[2];a.stateful&&a.resetStates(d,o);var m=a.returnSequences?p:h;return a.returnState?[m].concat(d):m})},e.prototype.getInitialState=function(t){var n=this;return F.tidy(function(){var a=A.zeros(t.shape);return a=A.sum(a,[1,2]),a=Ch(a),Array.isArray(n.cell.stateSize)?n.cell.stateSize.map(function(i){return i>1?Gw(a,[1,i]):a}):n.cell.stateSize>1?[Gw(a,[1,n.cell.stateSize])]:[a]})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!1,configurable:!0}),e.prototype.setFastWeightInitDuringBuild=function(t){r.prototype.setFastWeightInitDuringBuild.call(this,t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);var a=this.cell.getConfig();return this.getClassName()===e.className&&(n.cell={className:this.cell.getClassName(),config:a}),Object.assign(Object.assign(Object.assign({},a),t),n)},e.fromConfig=function(t,n,a){a===void 0&&(a={});var i=n.cell,o=Di(i,a);return new t(Object.assign(n,{cell:o}))},e}(xt);Co.className="RNN";F.serialization.registerClass(Co);var il=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(xt),Im=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,sn(n.units,"units"),n.activation=xs(t.activation==null?n.DEFAULT_ACTIVATION:t.activation),n.useBias=t.useBias==null?!0:t.useBias,n.kernelInitializer=gr(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=gr(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=gr(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=br(t.kernelRegularizer),n.recurrentRegularizer=br(t.recurrentRegularizer),n.biasRegularizer=br(t.biasRegularizer),n.kernelConstraint=Zr(t.kernelConstraint),n.recurrentConstraint=Zr(t.recurrentConstraint),n.biasConstraint=Zr(t.biasConstraint),n.dropout=Zc([1,bs([0,t.dropout==null?0:t.dropout])]),n.recurrentDropout=Zc([1,bs([0,t.recurrentDropout==null?0:t.recurrentDropout])]),n.dropoutFunc=t.dropoutFunc,n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return e.prototype.build=function(t){t=Rt(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){if(t=t,t.length!==2)throw new J("SimpleRNNCell expects 2 input Tensors, got ".concat(t.length,"."));var i=t[1];t=t[0];var o=n.training==null?!1:n.training;0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=ks({ones:function(){return A.onesLike(t)},rate:a.dropout,training:o,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=ks({ones:function(){return A.onesLike(i)},rate:a.recurrentDropout,training:o,dropoutFunc:a.dropoutFunc}));var s,u=a.dropoutMask,c=a.recurrentDropoutMask;u!=null?s=eo(A.mul(t,u),a.kernel.read()):s=eo(t,a.kernel.read()),a.bias!=null&&(s=Mi(s,a.bias.read())),c!=null&&(i=A.mul(i,c));var l=A.add(s,eo(i,a.recurrentKernel.read()));return a.activation!=null&&(l=a.activation.apply(l)),[l,l]})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={units:this.units,activation:ws(this.activation),useBias:this.useBias,kernelInitializer:Cr(this.kernelInitializer),recurrentInitializer:Cr(this.recurrentInitializer),biasInitializer:Cr(this.biasInitializer),kernelRegularizer:Xt(this.kernelRegularizer),recurrentRegularizer:Xt(this.recurrentRegularizer),biasRegularizer:Xt(this.biasRegularizer),activityRegularizer:Xt(this.activityRegularizer),kernelConstraint:Jr(this.kernelConstraint),recurrentConstraint:Jr(this.recurrentConstraint),biasConstraint:Jr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},t),n)},e}(il);Im.className="SimpleRNNCell";F.serialization.registerClass(Im);var fx=function(r){oe(e,r);function e(t){return t.cell=new Im(t),r.call(this,t)||this}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.cell.dropoutMask!=null&&(A.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(A.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,n){return new t(n)},e}(Co);fx.className="SimpleRNN";F.serialization.registerClass(fx);var Cm=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;if(n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new J("GRUCell does not support reset_after parameter set to true.");return n.units=t.units,sn(n.units,"units"),n.activation=xs(t.activation===void 0?n.DEFAULT_ACTIVATION:t.activation),n.recurrentActivation=xs(t.recurrentActivation===void 0?n.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),n.useBias=t.useBias==null?!0:t.useBias,n.kernelInitializer=gr(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=gr(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=gr(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=br(t.kernelRegularizer),n.recurrentRegularizer=br(t.recurrentRegularizer),n.biasRegularizer=br(t.biasRegularizer),n.kernelConstraint=Zr(t.kernelConstraint),n.recurrentConstraint=Zr(t.recurrentConstraint),n.biasConstraint=Zr(t.biasConstraint),n.dropout=Zc([1,bs([0,t.dropout==null?0:t.dropout])]),n.recurrentDropout=Zc([1,bs([0,t.recurrentDropout==null?0:t.recurrentDropout])]),n.dropoutFunc=t.dropoutFunc,n.implementation=t.implementation,n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return e.prototype.build=function(t){t=Rt(t);var n=t[t.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){if(t=t,t.length!==2)throw new J("GRUCell expects 2 input Tensors (inputs, h, c), got "+"".concat(t.length,"."));var i=n.training==null?!1:n.training,o=t[1];t=t[0],0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=ks({ones:function(){return A.onesLike(t)},rate:a.dropout,training:i,count:3,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=ks({ones:function(){return A.onesLike(o)},rate:a.recurrentDropout,training:i,count:3,dropoutFunc:a.dropoutFunc}));var s=a.dropoutMask,u=a.recurrentDropoutMask,c,l,f;0<a.dropout&&a.dropout<1&&(t=A.mul(t,s[0]));var h=eo(t,a.kernel.read());a.useBias&&(h=Mi(h,a.bias.read())),0<a.recurrentDropout&&a.recurrentDropout<1&&(o=A.mul(o,u[0]));var p=a.recurrentKernel.read(),d=te(A.split(p,[2*a.units,a.units],p.rank-1),2),m=d[0],v=d[1],g=eo(o,m),y=te(A.split(h,3,h.rank-1),3),w=y[0],b=y[1],x=y[2],S=te(A.split(g,2,g.rank-1),2),T=S[0],E=S[1];c=a.recurrentActivation.apply(A.add(w,T)),l=a.recurrentActivation.apply(A.add(b,E));var C=eo(A.mul(l,o),v);f=a.activation.apply(A.add(x,C));var R=A.add(A.mul(c,o),A.mul(A.add(1,A.neg(c)),f));return[R,R]})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={units:this.units,activation:ws(this.activation),recurrentActivation:ws(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Cr(this.kernelInitializer),recurrentInitializer:Cr(this.recurrentInitializer),biasInitializer:Cr(this.biasInitializer),kernelRegularizer:Xt(this.kernelRegularizer),recurrentRegularizer:Xt(this.recurrentRegularizer),biasRegularizer:Xt(this.biasRegularizer),activityRegularizer:Xt(this.activityRegularizer),kernelConstraint:Jr(this.kernelConstraint),recurrentConstraint:Jr(this.recurrentConstraint),biasConstraint:Jr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},t),n)},e}(il);Cm.className="GRUCell";F.serialization.registerClass(Cm);var hx=function(r){oe(e,r);function e(t){return t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Cm(t),r.call(this,t)||this}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.cell.dropoutMask!=null&&(A.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(A.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)},e}(Co);hx.className="GRU";F.serialization.registerClass(hx);var Mh=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,sn(n.units,"units"),n.activation=xs(t.activation===void 0?n.DEFAULT_ACTIVATION:t.activation),n.recurrentActivation=xs(t.recurrentActivation===void 0?n.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),n.useBias=t.useBias==null?!0:t.useBias,n.kernelInitializer=gr(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=gr(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=gr(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.unitForgetBias=t.unitForgetBias,n.kernelRegularizer=br(t.kernelRegularizer),n.recurrentRegularizer=br(t.recurrentRegularizer),n.biasRegularizer=br(t.biasRegularizer),n.kernelConstraint=Zr(t.kernelConstraint),n.recurrentConstraint=Zr(t.recurrentConstraint),n.biasConstraint=Zr(t.biasConstraint),n.dropout=Zc([1,bs([0,t.dropout==null?0:t.dropout])]),n.recurrentDropout=Zc([1,bs([0,t.recurrentDropout==null?0:t.recurrentDropout])]),n.dropoutFunc=t.dropoutFunc,n.implementation=t.implementation,n.stateSize=[n.units,n.units],n.dropoutMask=null,n.recurrentDropoutMask=null,n}return e.prototype.build=function(t){var n;t=Rt(t);var a=t[t.length-1];this.kernel=this.addWeight("kernel",[a,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);var i;if(this.useBias){if(this.unitForgetBias){var o=this.biasInitializer,s=this.units;i=new(n=function(u){oe(c,u);function c(){return u!==null&&u.apply(this,arguments)||this}return c.prototype.apply=function(l,f){var h=o.apply([s]),p=new cm().apply([s]),d=o.apply([s*2]);return q4(q4(h,p),d)},c}(oi),n.className="CustomInit",n)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=n.training==null?!1:n.training;if(t=t,t.length!==3)throw new J("LSTMCell expects 3 input Tensors (inputs, h, c), got "+"".concat(t.length,"."));var o=t[1],s=t[2];t=t[0],0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=ks({ones:function(){return A.onesLike(t)},rate:a.dropout,training:i,count:4,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=ks({ones:function(){return A.onesLike(o)},rate:a.recurrentDropout,training:i,count:4,dropoutFunc:a.dropoutFunc}));var u=a.dropoutMask,c=a.recurrentDropoutMask,l,f,h,p;0<a.dropout&&a.dropout<1&&(t=A.mul(t,u[0]));var d=eo(t,a.kernel.read());0<a.recurrentDropout&&a.recurrentDropout<1&&(o=A.mul(o,c[0])),d=A.add(d,eo(o,a.recurrentKernel.read())),a.useBias&&(d=Mi(d,a.bias.read()));var m=te(A.split(d,4,d.rank-1),4),v=m[0],g=m[1],y=m[2],w=m[3];l=a.recurrentActivation.apply(v),f=a.recurrentActivation.apply(g),h=A.add(A.mul(f,s),A.mul(l,a.activation.apply(y))),p=a.recurrentActivation.apply(w);var b=A.mul(p,a.activation.apply(h));return[b,b,h]})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={units:this.units,activation:ws(this.activation),recurrentActivation:ws(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Cr(this.kernelInitializer),recurrentInitializer:Cr(this.recurrentInitializer),biasInitializer:Cr(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Xt(this.kernelRegularizer),recurrentRegularizer:Xt(this.recurrentRegularizer),biasRegularizer:Xt(this.biasRegularizer),activityRegularizer:Xt(this.activityRegularizer),kernelConstraint:Jr(this.kernelConstraint),recurrentConstraint:Jr(this.recurrentConstraint),biasConstraint:Jr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},t),n)},e}(il);Mh.className="LSTMCell";F.serialization.registerClass(Mh);var px=function(r){oe(e,r);function e(t){return t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Mh(t),r.call(this,t)||this}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.cell.dropoutMask!=null&&(A.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(A.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)},e}(Co);px.className="LSTM";F.serialization.registerClass(px);var Am=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.cells=t.cells,n}return Object.defineProperty(e.prototype,"stateSize",{get:function(){var t,n,a=[];try{for(var i=fe(this.cells.slice().reverse()),o=i.next();!o.done;o=i.next()){var s=o.value;Array.isArray(s.stateSize)?a.push.apply(a,et([],te(s.stateSize),!1)):a.push(s.stateSize)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a},enumerable:!1,configurable:!0}),e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i,o,s,u;t=t;var c=t.slice(1),l=[];try{for(var f=fe(a.cells.slice().reverse()),h=f.next();!h.done;h=f.next()){var p=h.value;Array.isArray(p.stateSize)?l.push(c.splice(0,p.stateSize.length)):l.push(c.splice(0,1))}}catch(b){i={error:b}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}l.reverse();for(var d=[],m,v=0;v<a.cells.length;++v){var p=a.cells[v];c=l[v],v===0?m=[t[0]].concat(c):m=[m[0]].concat(c),m=p.call(m,n),d.push(m.slice(1))}c=[];try{for(var g=fe(d.slice().reverse()),y=g.next();!y.done;y=g.next()){var w=y.value;c.push.apply(c,et([],te(w),!1))}}catch(b){s={error:b}}finally{try{y&&!y.done&&(u=g.return)&&u.call(g)}finally{if(s)throw s.error}}return[m[0]].concat(c)})},e.prototype.build=function(t){jw(t)&&(t=t[0]),t=t;var n;this.cells.forEach(function(a,i){xu("RNNCell_".concat(i),function(){a.build(t),Array.isArray(a.stateSize)?n=a.stateSize[0]:n=a.stateSize,t=[t[0],n]})}),this.built=!0},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n=function(o){return{className:o.getClassName(),config:o.getConfig()}},a=this.cells.map(n),i={cells:a};return Object.assign(Object.assign({},t),i)},e.fromConfig=function(t,n,a){var i,o;a===void 0&&(a={});var s=[];try{for(var u=fe(n.cells),c=u.next();!c.done;c=u.next()){var l=c.value;s.push(Di(l,a))}}catch(f){i={error:f}}finally{try{c&&!c.done&&(o=u.return)&&o.call(u)}finally{if(i)throw i.error}}return new t({cells:s})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){var t,n;if(!this.trainable)return[];var a=[];try{for(var i=fe(this.cells),o=i.next();!o.done;o=i.next()){var s=o.value;a.push.apply(a,et([],te(s.trainableWeights),!1))}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){var t,n,a,i,o=[];try{for(var s=fe(this.cells),u=s.next();!u.done;u=s.next()){var c=u.value;o.push.apply(o,et([],te(c.nonTrainableWeights),!1))}}catch(p){t={error:p}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}if(!this.trainable){var l=[];try{for(var f=fe(this.cells),h=f.next();!h.done;h=f.next()){var c=h.value;l.push.apply(l,et([],te(c.trainableWeights),!1))}}catch(p){a={error:p}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}return l.concat(o)}return o},enumerable:!1,configurable:!0}),e.prototype.getWeights=function(){var t,n,a=[];try{for(var i=fe(this.cells),o=i.next();!o.done;o=i.next()){var s=o.value;a.push.apply(a,et([],te(s.weights),!1))}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return Kw(a)},e.prototype.setWeights=function(t){var n,a,i=[];try{for(var o=fe(this.cells),s=o.next();!s.done;s=o.next())for(var u=s.value,c=u.weights.length,l=t.splice(c),f=0;f<u.weights.length;++f)i.push([u.weights[f],l[f]])}catch(h){n={error:h}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}g1(i)},e}(il);Am.className="StackedRNNCells";F.serialization.registerClass(Am);function ks(r){var e=r.ones,t=r.rate,n=r.training,a=n===void 0?!1:n,i=r.count,o=i===void 0?1:i,s=r.dropoutFunc,u=function(){return s!=null?s(e(),t):KB(e(),t)},c=function(){return Dh(u,e,a)};if(!o||o<=1)return A.keep(c().clone());var l=Array(o).fill(void 0).map(c);return l.map(function(f){return A.keep(f.clone())})}var UAe=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(r);a<n.length;a++)e.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(r,n[a])&&(t[n[a]]=r[n[a]]);return t};(function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(il);var hz=function(r){oe(e,r);function e(t){var n=this;if(t.unroll)throw new wt("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new wt("It is not possible at the moment to stack convolutional cells.");return n=r.call(this,t)||this,n.inputSpec=[new Kr({ndim:5})],n}return e.prototype.call=function(t,n){var a=this;return A.tidy(function(){if(a.cell.dropoutMask!=null&&(A.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(A.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null),n&&n.constants)throw new J("ConvRNN2D cell does not support constants");var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.prototype.computeOutputShape=function(t){var n=this.computeSingleOutputShape(t);return this.returnSequences||(n=et([n[0]],te(n.slice(2)),!1)),this.returnState&&(n=et([n],te(Array(2).fill(et([t[0]],te(n.slice(-3)),!1))),!1)),n},e.prototype.getInitialState=function(t){var n=this;return A.tidy(function(){var a=n.cell.stateSize,i=t.shape,o=n.computeSingleOutputShape(i),s=et([o[0]],te(o.slice(2)),!1),u=A.zeros(s);return Array.isArray(a)?Array(a.length).fill(u):[u]})},e.prototype.resetStates=function(t,n){var a=this;n===void 0&&(n=!1),A.tidy(function(){if(!a.stateful)throw new ms("Cannot call resetStates() on an RNN Layer that is not stateful.");var i=a.inputSpec[0].shape,o=a.computeSingleOutputShape(i),s=et([o[0]],te(o.slice(2)),!1),u=i[0];if(u==null)throw new J("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(a.getStates()==null)Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(){return A.zeros(s)}):a.states_=[A.zeros(s)];else if(t==null)A.dispose(a.states_),a.keptStates!=null&&(A.dispose(a.keptStates),a.keptStates=[]),Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(){return A.zeros(s)}):a.states_[0]=A.zeros(s);else{if(Array.isArray(t)||(t=[t]),t.length!==a.states_.length)throw new J("Layer ".concat(a.name," expects ").concat(a.states_.length," state(s), ")+"but it received ".concat(t.length," state value(s). Input ")+"received: ".concat(t));n?a.keptStates.push(a.states_.slice()):A.dispose(a.states_);for(var c=0;c<a.states_.length;++c){var l=t[c],f=s;if(!F.util.arraysEqual(l.shape,f))throw new J("State ".concat(c," is incompatible with layer ").concat(a.name,": ")+"expected shape=".concat(f,", received shape=").concat(l.shape));a.states_[c]=l}}a.states_=a.states_.map(function(h){return A.keep(h.clone())})})},e.prototype.computeSingleOutputShape=function(t){var n=this.cell,a=n.dataFormat,i=n.filters,o=n.kernelSize,s=n.padding,u=n.strides,c=n.dilationRate,l=a==="channelsFirst",f=t[l?3:2],h=t[l?4:3],p=_i(f,o[0],s,u[0],c[0]),d=_i(h,o[1],s,u[1],c[1]),m=et(et([],te(t.slice(0,2)),!1),te(l?[i,p,d]:[p,d,i]),!1);return m},e}(Co);hz.className="ConvRNN2D";var Dm=function(r){oe(e,r);function e(t){var n=this,a=t.filters,i=t.kernelSize,o=t.strides,s=t.padding,u=t.dataFormat,c=t.dilationRate;return n=r.call(this,Object.assign(Object.assign({},t),{units:a}))||this,n.filters=a,sn(n.filters,"filters"),n.kernelSize=Jc(i,2,"kernelSize"),n.kernelSize.forEach(function(l){return sn(l,"kernelSize")}),n.strides=Jc(o||1,2,"strides"),n.strides.forEach(function(l){return sn(l,"strides")}),n.padding=s||"valid",Ra(n.padding),n.dataFormat=u||"channelsLast",qr(n.dataFormat),n.dilationRate=Jc(c||1,2,"dilationRate"),n.dilationRate.forEach(function(l){return sn(l,"dilationRate")}),n}return e.prototype.build=function(t){var n;t=Rt(t);var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new J("The channel dimension of the input should be defined. "+"Found ".concat(t[a]));var i=t[a],o=4,s=this.kernelSize.concat([i,this.filters*o]);this.kernel=this.addWeight("kernel",s,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var u=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",u,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var c=void 0;if(this.unitForgetBias){var l=this.biasInitializer,f=this.filters;c=new(n=function(h){oe(p,h);function p(){return h!==null&&h.apply(this,arguments)||this}return p.prototype.apply=function(d,m){var v=l.apply([f]),g=A.ones([f]),y=l.apply([f*2]);return c1([v,g,y])},p}(oi),n.className="CustomInit",n)}else c=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,c,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0},e.prototype.call=function(t,n){var a=this;return A.tidy(function(){if(t.length!==3)throw new J("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+"".concat(t.length,"."));var i=n.training||!1,o=t[0],s=t[1],u=t[2],c=4;0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=ks({ones:function(){return A.onesLike(o)},rate:a.dropout,training:i,count:c,dropoutFunc:a.dropoutFunc}));var l=a.dropoutMask,f=function(le,de,ke){return!de||!de[ke]?le:A.mul(de[ke],le)},h=f(o,l,0),p=f(o,l,1),d=f(o,l,2),m=f(o,l,3);0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=ks({ones:function(){return A.onesLike(s)},rate:a.recurrentDropout,training:i,count:c,dropoutFunc:a.dropoutFunc}));var v=a.recurrentDropoutMask,g=f(s,v,0),y=f(s,v,1),w=f(s,v,2),b=f(s,v,3),x=3,S=te(A.split(a.kernel.read(),c,x),4),T=S[0],E=S[1],C=S[2],R=S[3],_=te(a.useBias?A.split(a.bias.read(),c):[null,null,null,null],4),M=_[0],$=_[1],z=_[2],q=_[3];h=a.inputConv(h,T,M,a.padding),p=a.inputConv(p,E,$,a.padding),d=a.inputConv(d,C,z,a.padding),m=a.inputConv(m,R,q,a.padding);var L=te(A.split(a.recurrentKernel.read(),c,x),4),U=L[0],Y=L[1],Z=L[2],V=L[3];g=a.recurrentConv(g,U),y=a.recurrentConv(y,Y),w=a.recurrentConv(w,Z),b=a.recurrentConv(b,V);var X=a.recurrentActivation.apply(A.add(h,g)),ne=a.recurrentActivation.apply(A.add(p,y)),re=A.add(A.mul(ne,u),A.mul(X,a.activation.apply(A.add(d,w)))),se=A.mul(a.recurrentActivation.apply(A.add(m,b)),a.activation.apply(re));return[se,se,re]})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);t.units;var n=UAe(t,["units"]),a={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),a)},e.prototype.inputConv=function(t,n,a,i){var o=A.conv2d(t,n,this.strides,i||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return a?Mi(o,a,this.dataFormat):o},e.prototype.recurrentConv=function(t,n){var a=1;return A.conv2d(t,n,a,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")},e}(Mh);Dm.className="ConvLSTM2DCell";A.serialization.registerClass(Dm);var dx=function(r){oe(e,r);function e(t){var n=new Dm(t);return r.call(this,Object.assign(Object.assign({},t),{cell:n}))||this}return e.fromConfig=function(t,n){return new t(n)},e}(hz);dx.className="ConvLSTM2D";A.serialization.registerClass(dx);var _m=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.rate=Math.max(Math.min(t.rate,1),0),n.noiseShape=t.noiseShape,n.seed=t.seed,n.supportsMasking=!0,n}return e.prototype.getNoiseShape=function(t){if(this.noiseShape==null)return this.noiseShape;for(var n=t.shape,a=[],i=0;i<this.noiseShape.length;++i)a.push(this.noiseShape[i]==null?n[i]:this.noiseShape[i]);return a},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=ut(t);if(0<a.rate&&a.rate<1){var o=n.training==null?!1:n.training,s=a.getNoiseShape(i),u=Dh(function(){return KB(i,a.rate,s,a.seed)},function(){return i},o);return u}return t})},e.prototype.getConfig=function(){var t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.dispose=function(){return r.prototype.dispose.call(this)},e}(xt);_m.className="Dropout";F.serialization.registerClass(_m);var vx=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.inputSpec=[{ndim:3}],n}return e.prototype.getNoiseShape=function(t){var n=t.shape;return[n[0],1,n[2]]},e}(_m);vx.className="SpatialDropout1D";F.serialization.registerClass(vx);var mx=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;if(n.activation=null,n.useBias=!0,n.kernel=null,n.bias=null,n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_BIAS_INITIALIZER="zeros",t.batchInputShape==null&&t.inputShape==null&&t.inputDim!=null){var a=null;t.batchSize!=null&&(a=t.batchSize),n.batchInputShape=[a,t.inputDim]}return n.units=t.units,sn(n.units,"units"),n.activation=xs(t.activation),t.useBias!=null&&(n.useBias=t.useBias),n.kernelInitializer=gr(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.biasInitializer=gr(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelConstraint=Zr(t.kernelConstraint),n.biasConstraint=Zr(t.biasConstraint),n.kernelRegularizer=br(t.kernelRegularizer),n.biasRegularizer=br(t.biasRegularizer),n.activityRegularizer=br(t.activityRegularizer),n.supportsMasking=!0,n.inputSpec=[{minNDim:2}],n}return e.prototype.build=function(t){var n;t=Rt(t);var a=t[t.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[a,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(n={},n[-1]=a,n)}],this.built=!0},e.prototype.computeOutputShape=function(t){t=Rt(t);var n=t.slice();return n[n.length-1]=this.units,n},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=ut(t),o=$B(a.activation.getClassName()),s;return o!=null?s=eo(i,a.kernel.read(),o,a.bias?a.bias.read():null):(s=eo(i,a.kernel.read()),a.bias!=null&&(s=Mi(s,a.bias.read())),a.activation!=null&&(s=a.activation.apply(s))),s})},e.prototype.getConfig=function(){var t={units:this.units,activation:ws(this.activation),useBias:this.useBias,kernelInitializer:Cr(this.kernelInitializer),biasInitializer:Cr(this.biasInitializer),kernelRegularizer:Xt(this.kernelRegularizer),biasRegularizer:Xt(this.biasRegularizer),activityRegularizer:Xt(this.activityRegularizer),kernelConstraint:Jr(this.kernelConstraint),biasConstraint:Jr(this.biasConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(xt);mx.className="Dense";F.serialization.registerClass(mx);var gx=function(r){oe(e,r);function e(t){var n=this;return t=t||{},n=r.call(this,t)||this,n.inputSpec=[{minNDim:3}],n.dataFormat=t.dataFormat,n}return e.prototype.computeOutputShape=function(t){var n,a;t=Rt(t);try{for(var i=fe(t.slice(1)),o=i.next();!o.done;o=i.next()){var s=o.value;if(s==null)throw new J('The shape of the input to "Flatten" is not fully defined '+"(got ".concat(t.slice(1),"). Make sure to pass a complete ")+'"input_shape" or "batch_input_shape" argument to the first layer in your model.')}}catch(u){n={error:u}}finally{try{o&&!o.done&&(a=i.return)&&a.call(i)}finally{if(n)throw n.error}}return[t[0],ys(t,1)]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=ut(t);if(a.dataFormat==="channelsFirst"&&i.rank>1){for(var o=[0],s=2;s<i.rank;++s)o.push(s);o.push(1),i=F.transpose(i,o)}return Uxe(i)})},e.prototype.getConfig=function(){var t={};this.dataFormat!=null&&(t.dataFormat=this.dataFormat);var n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(xt);gx.className="Flatten";F.serialization.registerClass(gx);var yx=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.activation=xs(t.activation),n}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=ut(t);return a.activation.apply(i)})},e.prototype.getConfig=function(){var t={activation:ws(this.activation)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(xt);yx.className="Activation";F.serialization.registerClass(yx);var bx=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.n=t.n,n.inputSpec=[{ndim:2}],n}return e.prototype.computeOutputShape=function(t){return[t[0],this.n,t[1]]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){return t=ut(t),$xe(t,a.n)})},e.prototype.getConfig=function(){var t={n:this.n},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(xt);bx.className="RepeatVector";F.serialization.registerClass(bx);var wx=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;n.targetShape=t.targetShape;for(var a=0;a<n.targetShape.length;++a)n.isUnknown(n.targetShape[a])&&(n.targetShape[a]=null);return n}return e.prototype.isUnknown=function(t){return t<0||t==null},e.prototype.fixUnknownDimension=function(t,n){for(var a="Total size of new array must be unchanged.",i=n.slice(),o=1,s=null,u=0;u<i.length;++u){var c=i[u];if(this.isUnknown(c))if(s===null)s=u;else throw new J("Can only specifiy one unknown dimension.");else o*=c}var l=ys(t);if(s!==null){if(o===0||l%o!==0)throw new J(a);i[s]=l/o}else if(l!==o)throw new J(a);return i},e.prototype.computeOutputShape=function(t){for(var n=!1,a=0;a<t.length;++a)if(this.isUnknown(t[a])){n=!0;break}return n?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=ut(t),o=i.shape,s=o.slice(0,1).concat(a.fixUnknownDimension(o.slice(1),a.targetShape));return F.reshape(i,s)})},e.prototype.getConfig=function(){var t={targetShape:this.targetShape},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(xt);wx.className="Reshape";F.serialization.registerClass(wx);var xx=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;if(t.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+"".concat(t.dims," instead."));var a=Fi(1,t.dims.length+1);if(!F.util.arraysEqual(t.dims.slice().sort(),a))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");return n.dims=t.dims,n.dimsIncludingBatch=[0].concat(n.dims),n.inputSpec=[new Kr({ndim:n.dims.length+1})],n}return e.prototype.computeOutputShape=function(t){t=Rt(t);var n=t.slice();return this.dims.forEach(function(a,i){n[i+1]=t[a]}),n},e.prototype.call=function(t,n){return F.transpose(ut(t),this.dimsIncludingBatch)},e.prototype.getConfig=function(){var t={dims:this.dims},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(xt);xx.className="Permute";F.serialization.registerClass(xx);var kx=function(r){oe(e,r);function e(t){var n=r.call(this,t??{})||this;return n.supportsMasking=!0,t!=null?n.maskValue=t.maskValue==null?0:t.maskValue:n.maskValue=0,n}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={maskValue:this.maskValue};return Object.assign(n,t),n},e.prototype.computeMask=function(t,n){var a=ut(t),i=-1;return F.any(F.notEqual(a,this.maskValue),i)},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=ut(t),o=-1,s=!0,u=F.any(F.notEqual(i,a.maskValue),o,s),c=F.mul(i,F.cast(u,i.dtype));return c})},e}(xt);kx.className="Masking";F.serialization.registerClass(kx);var Sx=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;if(n.embeddings=null,n.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",t.batchInputShape==null&&t.inputShape==null){var a=null;t.batchSize!=null&&(a=t.batchSize),t.inputLength==null?n.batchInputShape=[a,null]:n.batchInputShape=[a].concat($t(t.inputLength))}return n.inputDim=t.inputDim,sn(n.inputDim,"inputDim"),n.outputDim=t.outputDim,sn(n.outputDim,"outputDim"),n.embeddingsInitializer=gr(t.embeddingsInitializer||n.DEFAULT_EMBEDDINGS_INITIALIZER),n.embeddingsRegularizer=br(t.embeddingsRegularizer),n.activityRegularizer=br(t.activityRegularizer),n.embeddingsConstraint=Zr(t.embeddingsConstraint),n.maskZero=t.maskZero,n.supportsMasking=t.maskZero,n.inputLength=t.inputLength,n}return e.prototype.build=function(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},e.prototype.warnOnIncompatibleInputShape=function(t){},e.prototype.computeMask=function(t,n){var a=this;return F.tidy(function(){return a.maskZero?(t=ut(t),F.notEqual(t,F.zerosLike(t))):null})},e.prototype.computeOutputShape=function(t){if(t=Rt(t),this.inputLength==null)return et(et([],te(t),!1),[this.outputDim],!1);var n=$t(this.inputLength);if(n.length!==t.length-1)throw new J('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(t));for(var a=0,i=0;i<n.length;++i){var o=n[i],s=t[i+1];if(o!=null&&s!=null&&o!==s)throw new J('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(t));o==null&&(n[a]=s),a++}return et(et([t[0]],te(n),!1),[this.outputDim],!1)},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=ut(t);i.dtype!=="int32"&&(i=Qi(i,"int32"));var o=jB(a.embeddings.read(),F.reshape(i,[i.size]));return F.reshape(o,Rt(a.computeOutputShape(i.shape)))})},e.prototype.getConfig=function(){var t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Cr(this.embeddingsInitializer),embeddingsRegularizer:Xt(this.embeddingsRegularizer),activityRegularizer:Xt(this.activityRegularizer),embeddingsConstraint:Jr(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(xt);Sx.className="Embedding";F.serialization.registerClass(Sx);var Ru=function(r){oe(e,r);function e(t){var n=r.call(this,t||{})||this;return n.supportsMasking=!0,n}return e.prototype.mergeFunction=function(t){throw new wt},e.prototype.computeElementwiseOpOutputShape=function(t,n){if(t==null||n==null)return null;if(t.length<n.length)return this.computeElementwiseOpOutputShape(n,t);if(n.length===0)return t;for(var a=t.slice(0,t.length-n.length),i=0;i<n.length;++i){var o=t[t.length-n.length+i],s=n[i];if(o==null||s==null||o<0||s<0)a.push(null);else if(o===1)a.push(s);else if(s===1)a.push(o);else{if(o!==s)throw new J("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(n));a.push(o)}}return a},e.prototype.build=function(t){var n,a;if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[Rt(t)]),t=t,t.length<2)throw new J("A merge layer should be called on an Array of at least 2 inputs."+" Got ".concat(t.length," input(s)."));var i=[];try{for(var o=fe(t),s=o.next();!s.done;s=o.next()){var u=s.value;u!=null&&u[0]!==null&&i.push(u[0])}}catch(h){n={error:h}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}if(i=gs(i),i.length>1)throw new J("Can not merge tensors with different batch sizes. "+"Got tensors with shapes: ".concat(JSON.stringify(t),"."));for(var c=t[0]==null?null:t[0].slice(1),l=1;l<t.length;++l){var u=t[l]==null?null:t[l].slice(1);c=this.computeElementwiseOpOutputShape(c,u)}var f=t.map(function(h){return h.length});t.indexOf(null)===-1&&gs(f).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i,o,s,u;if(t=t,a.reshapeRequired){var c=[],l=t.map(function($){return $.rank});if(l.indexOf(null)===-1){var f=bs(l);try{for(var h=fe(t),p=h.next();!p.done;p=h.next()){for(var d=p.value,m=d.rank,v=0;v<f-m;++v)d=Ch(d,1);c.push(d)}}catch($){i={error:$}}finally{try{p&&!p.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}return a.mergeFunction(c)}else{var g=!1;try{for(var y=fe(t),w=y.next();!w.done;w=y.next()){var d=w.value,m=d.rank;if(m==null){var b=d.shape,x=b[0],S=b.slice(1).concat([x]),T=A.reshape(d,[x].concat(ys(b.slice(1))));T=A.transpose(T,[1,0]),T=A.reshape(T,S),c.push(T),g=!0}else if(m>1){var E=Fi(1,m).concat([0]);c.push(A.transpose(d,E)),g=!0}else c.push(d)}}catch($){s={error:$}}finally{try{w&&!w.done&&(u=y.return)&&u.call(y)}finally{if(s)throw s.error}}var C=a.mergeFunction(c),R=C.rank;if(g){if(R==null){var _=C.shape,M=_.length,x=_[M-1],S=[x].concat(_.slice(0,_.length-1));C=A.reshape(A.transpose(A.reshape(C,[-1,x]),[1,0]),S)}else if(R>1){var E=[R-1].concat(Fi(0,R-1));C=A.transpose(C,E)}}return C}}else return a.mergeFunction(t)})},e.prototype.computeOutputShape=function(t){var n,a;t=t;var i;t[0]==null?i=null:i=t[0].slice(1);for(var o=1;o<t.length;++o){var s=t[o]==null?null:t[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}var u=[];try{for(var c=fe(t),l=c.next();!l.done;l=c.next()){var s=l.value;s!=null&&s[0]!==null&&u.push(s[0])}}catch(f){n={error:f}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}return u=gs(u),u.length===1?i=u.concat(i):i=[null].concat(i),i},e.prototype.computeMask=function(t,n){return A.tidy(function(){if(n==null)return null;if(!Array.isArray(n))throw new J("`mask` should be an Array");if(!Array.isArray(t))throw new J("`inputs` should be an Array");if(n.length!==t.length)throw new J("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths "+"(".concat(t.length," vs ").concat(n.length,")"));if(n.every(function(o){return o==null}))return null;n=n.map(function(o){return o==null?o:A.expandDims(o,0)});for(var a=n[0],i=1;i<n.length-1;++i)a=A.logicalAnd(a,n[i]);return a})},e}(xt),Nx=function(r){oe(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return F.tidy(function(){for(var n=t[0].clone(),a=1;a<t.length;++a)n=A.add(n,t[a]);return n})},e}(Ru);Nx.className="Add";F.serialization.registerClass(Nx);var Tx=function(r){oe(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return F.tidy(function(){for(var n=t[0].clone(),a=1;a<t.length;++a)n=A.mul(n,t[a]);return n})},e}(Ru);Tx.className="Multiply";F.serialization.registerClass(Tx);var Ex=function(r){oe(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return F.tidy(function(){for(var n=t[0].clone(),a=1;a<t.length;++a)n=A.add(n,t[a]);return A.mul(1/t.length,n)})},e}(Ru);Ex.className="Average";F.serialization.registerClass(Ex);var Ix=function(r){oe(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return F.tidy(function(){for(var n=t[0],a=1;a<t.length;++a)n=A.maximum(n,t[a]);return n})},e}(Ru);Ix.className="Maximum";F.serialization.registerClass(Ix);var Cx=function(r){oe(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return F.tidy(function(){for(var n=t[0],a=1;a<t.length;++a)n=A.minimum(n,t[a]);return n})},e}(Ru);Cx.className="Minimum";F.serialization.registerClass(Cx);var Ax=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.DEFAULT_AXIS=-1,t==null&&(t={}),n.axis=t.axis==null?n.DEFAULT_AXIS:t.axis,n.supportsMasking=!0,n.reshapeRequired=!1,n}return e.prototype.build=function(t){var n,a,i,o;if(!(Array.isArray(t)&&Array.isArray(t[0]))||t.length===1)throw new J("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;var s=!0;try{for(var u=fe(t),c=u.next();!c.done;c=u.next()){var l=c.value;if(l!=null){s=!1;break}}}catch(g){n={error:g}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}if(!s){for(var f=[],h=0;h<t.length;++h){var p=t[h].slice();p.splice(this.axis,1);var d=!1;try{for(var m=(i=void 0,fe(f)),v=m.next();!v.done;v=m.next()){var l=v.value;if(F.util.arraysEqual(l,p)){d=!0;break}}}catch(g){i={error:g}}finally{try{v&&!v.done&&(o=m.return)&&o.call(m)}finally{if(i)throw i.error}}d||f.push(p)}if(f.length>1)throw new J("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}},e.prototype.mergeFunction=function(t){var n=this;return F.tidy(function(){return c1(t,n.axis)})},e.prototype.computeOutputShape=function(t){var n,a;if(!(Array.isArray(t)&&Array.isArray(t[0])))throw new J("A `Concatenate` layer should be called on a list of inputs.");var i=t,o=i[0].slice(),s=this.axis<0?o.length+this.axis:this.axis;try{for(var u=fe(i.slice(1)),c=u.next();!c.done;c=u.next()){var l=c.value;if(o[s]==null||l[s]==null){o[s]=null;break}o[s]+=l[s]}}catch(f){n={error:f}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}return o},e.prototype.computeMask=function(t,n){var a=this;if(n==null)return null;if(!Array.isArray(n))throw new J("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new J("`inputs` should be an array for Concatenate");if(n.length!==t.length)throw new J("Mismatch in the length of mask (".concat(n.length,") ")+"and the legnth of inputs (".concat(t.length,")"));return A.tidy(function(){var i=!0;if(n.forEach(function(c){if(c!=null){i=!1;return}}),i)return null;for(var o=[],s=0;s<t.length;++s)n[s]==null?o.push(A.cast(A.onesLike(t[s]),"bool")):n[s].rank<t[s].rank?o.push(A.expandDims(n[s],-1)):o.push(n[s]);var u=A.concat(o,a.axis);return A.all(u,-1,!1)})},e.prototype.getConfig=function(){var t={axis:this.axis},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Ru);Ax.className="Concatenate";F.serialization.registerClass(Ax);function mh(r,e){for(;r<0;)r+=e;return r}function VAe(r,e,t){if(r.shape.length>3||e.shape.length>3)throw new wt("batchDot is not implemented for tensors of 4D or higher rank yet");if(A.util.assert(r.shape.length>=2,function(){return"batchDot requires the rank of x to be >= 2, "+"but got ".concat(r.shape.length)}),A.util.assert(r.shape.length>=2,function(){return"batchDot requires the rank of y to be >= 2, "+"but got ".concat(e.shape.length)}),typeof t=="number"&&(t=[t,t]),r.dtype==="complex64"||e.dtype==="complex64")throw new wt("batchDot is not implemented for complex64-type Tensors yet.");var n=r.shape.length,a=e.shape.length;t==null&&(t=[n-1,a-2]);var i=t;return A.tidy(function(){var o;if(n>a){o=n-a;for(var s=[],u=0;u<o;++u)s.push(1);e=A.reshape(e,e.shape.concat(s))}else if(a>n){o=a-n;for(var s=[],u=0;u<o;++u)s.push(1);r=A.reshape(r,r.shape.concat(s))}else o=0;var c;if(r.shape.length===2&&e.shape.length===2)i[0]===i[1]?c=A.sum(A.mul(r,e),i[0]):c=A.sum(A.mul(A.transpose(r,[1,0]),e),i[1]);else{var l=i[0]!==r.shape.length-1,f=i[1]===e.shape.length-1;c=A.matMul(r,e,l,f)}if(o>0){var h=void 0;n>a?h=n+a-3:h=n-1;for(var p=[],u=h;u<h+o;++u)p.push(u);c=A.squeeze(c,p)}return c.shape.length===1&&(c=A.expandDims(c,1)),c})}var Dx=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.axes=t.axes,n.normalize=t.normalize==null?!1:t.normalize,n.supportsMasking=!0,n.reshapeRequired=!1,n}return e.prototype.build=function(t){A.util.assert(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var n=t[0],a=t[1];if(n.length>3||a.length>3)throw new wt("Dot layer does not support tensors of 4D or higher rank yet.");var i=this.interpretAxes(n,a);if(n[i[0]]!==a[i[1]])throw new J("Dimension incompatibility: "+"".concat(n[i[0]]," !== ").concat(a[i[1]]))},e.prototype.mergeFunction=function(t){if(t.length!==2)throw new J("A `Dot` layer must be called on exactly 2 inputs, "+"but received ".concat(t.length," input(s)."));var n=t[0],a=t[1],i;return Array.isArray(this.axes)?i=this.axes.map(function(o,s){return mh(o,t[s].shape.length)}):i=[mh(this.axes,n.shape.length),mh(this.axes,a.shape.length)],this.normalize&&(n=rm(n,i[0]),a=rm(a,i[1])),VAe(n,a,i)},e.prototype.interpretAxes=function(t,n){var a;return Array.isArray(this.axes)?a=this.axes:a=[mh(this.axes,t.length),mh(this.axes,n.length)],a},e.prototype.computeOutputShape=function(t){A.util.assert(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var n=t[0].slice(),a=t[1].slice();if(n.length>3||a.length>3)throw new wt("Dot layer does not support tensors of 4D or higher rank yet.");var i=this.interpretAxes(n,a);n.splice(i[0],1),a.splice(i[1],1),a.splice(0,1);var o=n.concat(a);return o.length===1&&o.push(1),o},e.prototype.computeMask=function(t,n){return null},e.prototype.getConfig=function(){var t={axes:this.axes,normalize:this.normalize},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Ru);Dx.className="Dot";F.serialization.registerClass(Dx);var _x=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.stddev=t.stddev,n}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={stddev:this.stddev};return Object.assign(n,t),n},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=ut(t),o=function(){return F.add(um(i.shape,0,a.stddev),i)},s=Dh(o,function(){return i},n.training||!1);return s})},e}(xt);_x.className="GaussianNoise";F.serialization.registerClass(_x);var Fx=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.rate=t.rate,n}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={rate:this.rate};return Object.assign(n,t),n},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=ut(t);if(a.rate>0&&a.rate<1){var o=function(){var s=Math.sqrt(a.rate/(1-a.rate));return F.mul(i,um(i.shape,1,s))};return Dh(o,function(){return i},n.training||!1)}return i})},e}(xt);Fx.className="GaussianDropout";F.serialization.registerClass(Fx);var Rx=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.rate=t.rate,n.noiseShape=t.noiseShape,n}return e.prototype._getNoiseShape=function(t){return this.noiseShape||ut(t).shape},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={rate:this.rate};return Object.assign(n,t),n},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){if(a.rate<1&&a.rate>0){var i=a._getNoiseShape(t),o=function(){var s=ut(t),u=1.6732632423543772,c=1.0507009873554805,l=-u*c,f=F.greaterEqual(F.randomUniform(i),a.rate);f=Qi(f,"float32");var h=Math.pow((1-a.rate)*(1+a.rate*Math.pow(l,2)),-.5),p=-h*l*a.rate,d=F.add(F.mul(s,f),F.mul(F.add(f,-1),l));return F.add(F.mul(d,h),p)};return Dh(o,function(){return ut(t)},n.training||!1)}return t})},e}(xt);Rx.className="AlphaDropout";F.serialization.registerClass(Rx);function Eh(r,e,t,n,a,i){i===void 0&&(i=.001);var o;if(r.rank===2)o=A.batchNorm2d(r,e,t,n,a,i);else if(r.rank===3)o=A.batchNorm3d(r,e,t,n,a,i);else if(r.rank===4)o=A.batchNorm4d(r,e,t,n,a,i);else throw new wt("batchNormalization is not implemented for array of rank ".concat(r.rank," ")+"yet");return o}function GAe(r,e,t,n,a){return a===void 0&&(a=.001),F.tidy(function(){var i=A.moments(r,n),o=i.mean,s=i.variance,u=Eh(r,o,s,t,e,a);return[u,o,s]})}function HAe(r,e,t,n,a){return a===void 0&&(a=.001),F.tidy(function(){var i,o,s=A.moments(r,n),u=s.mean,c=s.variance,l=[];try{for(var f=fe(Fi(0,r.rank)),h=f.next();!h.done;h=f.next()){var p=h.value;n.indexOf(p)!==-1?l.push(1):l.push(r.shape[p])}}catch(w){i={error:w}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}var d=F.reshape(u,l),m=F.reshape(c,l),v=e==null?null:F.reshape(e,l),g=t==null?null:F.reshape(t,l),y=Eh(r,d,m,g,v,a);return[y,u,c]})}function jAe(r,e,t,n,a){return a===void 0&&(a=.001),F.util.arraysEqual(n.slice().sort(),Fi(0,r.rank-1))?GAe(r,e,t,n,a):HAe(r,e,t,n,a)}var Ox=function(r){oe(e,r);function e(t){var n=this;return t==null&&(t={}),n=r.call(this,t)||this,n.supportsMasking=!0,n.axis=t.axis==null?-1:t.axis,n.momentum=t.momentum==null?.99:t.momentum,n.epsilon=t.epsilon==null?.001:t.epsilon,n.center=t.center==null?!0:t.center,n.scale=t.scale==null?!0:t.scale,n.betaInitializer=gr(t.betaInitializer||"zeros"),n.gammaInitializer=gr(t.gammaInitializer||"ones"),n.movingMeanInitializer=gr(t.movingMeanInitializer||"zeros"),n.movingVarianceInitializer=gr(t.movingVarianceInitializer||"ones"),n.betaConstraint=Zr(t.betaConstraint),n.gammaConstraint=Zr(t.gammaConstraint),n.betaRegularizer=br(t.betaRegularizer),n.gammaRegularizer=br(t.gammaRegularizer),n}return e.prototype.build=function(t){var n;t=Rt(t);var a=this.axis>=0?this.axis:this.axis+t.length,i=t[a];if(i==null)throw new J("Axis ".concat(a," of input tensor should have a defined dimension but ")+"the layer received an input with shape "+"".concat(JSON.stringify(t),"."));this.inputSpec=[new Kr({ndim:t.length,axes:(n={},n[a]=i,n)})];var o=[i];this.scale&&(this.gamma=this.addWeight("gamma",o,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",o,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",o,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",o,null,this.movingVarianceInitializer,null,!1),this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=n.training==null?!1:n.training,o=ut(t),s=o.shape,u=s.length,c=Fi(0,u),l=a.axis>=0?a.axis:a.axis+u;c.splice(l,1);var f=Su(1,u);f[l]=s[l];var h=c.slice();h.sort();var p=!F.util.arraysEqual(h,Fi(0,u).slice(0,u-1)),d=function(){if(p){var x=F.reshape(a.movingMean.read(),f),S=F.reshape(a.movingVariance.read(),f),T=a.center?F.reshape(a.beta.read(),f):null,E=a.scale?F.reshape(a.gamma.read(),f):null;return Eh(o,x,S,T,E,a.epsilon)}else return Eh(o,a.movingMean.read(),a.movingVariance.read(),a.beta==null?null:a.beta.read(),a.gamma==null?null:a.gamma.read(),a.epsilon)};if(!i)return d();var m=te(jAe(o,a.gamma.read(),a.beta.read(),c,a.epsilon),3),v=m[0],g=m[1],y=m[2],w=function(x,S,T){A.tidy(function(){var E=1-T,C=x.read(),R=A.mul(A.sub(C,S),E);x.write(A.sub(C,R))})},b=function(){w(a.movingMean,g,a.momentum),w(a.movingVariance,y,a.momentum)};return b(),v})},e.prototype.getConfig=function(){var t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Cr(this.betaInitializer),gammaInitializer:Cr(this.gammaInitializer),movingMeanInitializer:Cr(this.movingMeanInitializer),movingVarianceInitializer:Cr(this.movingVarianceInitializer),betaRegularizer:Xt(this.betaRegularizer),gammaRegularizer:Xt(this.gammaRegularizer),betaConstraint:Jr(this.betaConstraint),gammaConstraint:Jr(this.gammaConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(xt);Ox.className="BatchNormalization";F.serialization.registerClass(Ox);var Px=function(r){oe(e,r);function e(t){var n,a,i=this;if(t==null&&(t={}),i=r.call(this,t)||this,i.axis=t.axis==null?-1:t.axis,typeof i.axis=="number"){if(!Number.isInteger(i.axis))throw new Error("Expected axis to be an integer, but received ".concat(i.axis))}else if(Array.isArray(i.axis))try{for(var o=fe(i.axis),s=o.next();!s.done;s=o.next()){var u=s.value;if(!Number.isInteger(u))throw new Error("Expected axis to be an array of integers, "+"but received ".concat(JSON.stringify(i.axis)))}}catch(c){n={error:c}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}else throw new Error("Expected axis to be an integer or an array of integers, "+"but received ".concat(JSON.stringify(i.axis)));return i.epsilon=t.epsilon==null?.001:t.epsilon,i.center=t.center==null?!0:t.center,i.scale=t.scale==null?!0:t.scale,i.betaInitializer=gr(t.betaInitializer||"zeros"),i.gammaInitializer=gr(t.gammaInitializer||"ones"),i.betaRegularizer=br(t.betaRegularizer),i.gammaRegularizer=br(t.gammaRegularizer),i.supportsMasking=!0,i}return e.prototype.build=function(t){var n,a;t=Rt(t);var i=t.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(var o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=i);try{for(var s=fe(this.axis),u=s.next();!u.done;u=s.next()){var c=u.value;if(c<0||c>=i)throw new Error("Invalid axis: ".concat(c))}}catch(h){n={error:h}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}if(this.axis.length!==gs(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));var l=this.axis.map(function(h){return t[h]}),f=!0;this.scale?this.gamma=this.addWeight("gamma",l,"float32",this.gammaInitializer,this.gammaRegularizer,f):this.gamma=null,this.center?this.beta=this.addWeight("beta",l,"float32",this.betaInitializer,this.betaRegularizer,f):this.beta=null,this.built=!0},e.prototype.call=function(t,n){var a=this,i=ut(t),o=i.shape,s=o.length;return F.tidy(function(){var u,c,l=!0,f=F.moments(i,a.axis,l),h=f.mean,p=f.variance,d=Su(1,s);try{for(var m=fe(a.axis),v=m.next();!v.done;v=m.next()){var g=v.value;d[g]=o[g]}}catch(E){u={error:E}}finally{try{v&&!v.done&&(c=m.return)&&c.call(m)}finally{if(u)throw u.error}}for(var y=function(E){return E!=null&&E.shape.length!==s?A.reshape(E,d):E},w=a.scale?y(a.gamma.read()):null,b=a.center?y(a.beta.read()):null,x=[],S=[],T=0;T<s;++T)a.axis.indexOf(T)!==-1?(x.push(o[T]),S.push(1)):(x.push(1),S.push(o[T]));return h=A.tile(h,x),p=A.tile(p,x),w!=null&&(w=A.tile(w,S)),b!=null&&(b=A.tile(b,S)),Eh(i,h,p,b,w,a.epsilon)})},e.prototype.getConfig=function(){var t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Cr(this.betaInitializer),gammaInitializer:Cr(this.gammaInitializer),betaRegularizer:Xt(this.betaRegularizer),gammaRegularizer:Xt(this.gammaRegularizer)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(xt);Px.className="LayerNormalization";F.serialization.registerClass(Px);function KAe(r,e,t){return F.tidy(function(){if(r.rank!==4)throw new J("temporalPadding expects input tensor to be 4-D, but received a "+"".concat(r.rank,"-D tensor."));if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new J("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=Ri()),t!=="channelsLast"&&t!=="channelsFirst")throw new J("Unknown data format: ".concat(t,". ")+"Supported data formats are 'channelsLast' and 'channelsFirst.");var n;return t==="channelsFirst"?n=[[0,0],[0,0],e[0],e[1]]:n=[[0,0],e[0],e[1],[0,0]],A.pad(r,n)})}var Mx=function(r){oe(e,r);function e(t){var n=this;if(t==null&&(t={}),n=r.call(this,t)||this,n.dataFormat=t.dataFormat==null?Ri():t.dataFormat,t.padding==null)n.padding=[[1,1],[1,1]];else if(typeof t.padding=="number")n.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,t.padding.length!==2)throw new J("ZeroPadding2D expects padding to be a length-2 array, but "+"received a length-".concat(t.padding.length," array."));var a=void 0,i=void 0;if(typeof t.padding[0]=="number")a=[t.padding[0],t.padding[0]],i=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,t.padding[0].length!==2)throw new J("ZeroPadding2D expects height padding to be a length-2 array, "+"but received a length-".concat(t.padding[0].length," array."));if(a=t.padding[0],t.padding[1].length!==2)throw new J("ZeroPadding2D expects width padding to be a length-2 array, "+"but received a length-".concat(t.padding[1].length," array."));i=t.padding[1]}n.padding=[a,i]}return n.inputSpec=[new Kr({ndim:4})],n}return e.prototype.computeOutputShape=function(t){t=Rt(t);var n,a;return this.dataFormat==="channelsFirst"?(t[2]!=null&&t[2]>=0?n=t[2]+this.padding[0][0]+this.padding[0][1]:n=null,t[3]!=null&&t[3]>=0?a=t[3]+this.padding[1][0]+this.padding[1][1]:a=null,[t[0],t[1],n,a]):(t[1]!=null&&t[1]>=0?n=t[1]+this.padding[0][0]+this.padding[0][1]:n=null,t[2]!=null&&t[2]>=0?a=t[2]+this.padding[1][0]+this.padding[1][1]:a=null,[t[0],n,a,t[3]])},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){return KAe(ut(t),a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={padding:this.padding,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(xt);Mx.className="ZeroPadding2D";F.serialization.registerClass(Mx);function Fm(r,e,t,n,a,i){return F.tidy(function(){qr(a),UB(i),Ra(n),t==null&&(t=[1,1]),n==null&&(n="valid"),a==null&&(a=Ri()),i==null&&(i="max"),r=nx(r,a);var o,s=n==="same"?"same":"valid";return i==="max"?o=A.maxPool(r,e,t,s):o=A.avgPool(r,e,t,s),a==="channelsFirst"&&(o=A.transpose(o,[0,3,1,2])),o})}function pz(r,e,t,n,a,i){return F.tidy(function(){qr(a),UB(i),Ra(n),t==null&&(t=[1,1,1]),n==null&&(n="valid"),a==null&&(a=Ri()),i==null&&(i="max"),r=sz(r,a);var o,s=n==="same"?"same":"valid";return i==="max"?o=A.maxPool3d(r,e,t,s):o=A.avgPool3d(r,e,t,s),a==="channelsFirst"&&(o=A.transpose(o,[0,4,1,2,3])),o})}var dz=function(r){oe(e,r);function e(t){var n=this;if(t.poolSize==null&&(t.poolSize=2),n=r.call(this,t)||this,typeof t.poolSize=="number")n.poolSize=[t.poolSize];else if(Array.isArray(t.poolSize)&&t.poolSize.length===1&&typeof t.poolSize[0]=="number")n.poolSize=t.poolSize;else throw new J("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(t.poolSize)));if(sn(n.poolSize,"poolSize"),t.strides==null)n.strides=n.poolSize;else if(typeof t.strides=="number")n.strides=[t.strides];else if(Array.isArray(t.strides)&&t.strides.length===1&&typeof t.strides[0]=="number")n.strides=t.strides;else throw new J("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(t.strides)));return sn(n.strides,"strides"),n.padding=t.padding==null?"valid":t.padding,Ra(n.padding),n.inputSpec=[new Kr({ndim:3})],n}return e.prototype.computeOutputShape=function(t){t=Rt(t);var n=_i(t[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],n,t[2]]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n),t=Ch(ut(t),2);var i=a.poolingFunction(ut(t),[a.poolSize[0],1],[a.strides[0],1],a.padding,"channelsLast");return A.squeeze(i,[2])})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(xt),Bx=function(r){oe(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return qr(o),Ra(i),Fm(t,n,a,i,o,"max")},e}(dz);Bx.className="MaxPooling1D";F.serialization.registerClass(Bx);var Lx=function(r){oe(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return qr(o),Ra(i),Fm(t,n,a,i,o,"avg")},e}(dz);Lx.className="AveragePooling1D";F.serialization.registerClass(Lx);var vz=function(r){oe(e,r);function e(t){var n=this;if(t.poolSize==null&&(t.poolSize=[2,2]),n=r.call(this,t)||this,n.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],t.strides==null)n.strides=n.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==2)throw new J("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+"".concat(t.strides.length,"."));n.strides=t.strides}else n.strides=[t.strides,t.strides];return sn(n.poolSize,"poolSize"),sn(n.strides,"strides"),n.padding=t.padding==null?"valid":t.padding,n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,qr(n.dataFormat),Ra(n.padding),n.inputSpec=[new Kr({ndim:4})],n}return e.prototype.computeOutputShape=function(t){t=Rt(t);var n=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2];return n=_i(n,this.poolSize[0],this.padding,this.strides[0]),a=_i(a,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,a]:[t[0],n,a,t[3]]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){return a.invokeCallHook(t,n),a.poolingFunction(ut(t),a.poolSize,a.strides,a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(xt),qx=function(r){oe(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return qr(o),Ra(i),Fm(t,n,a,i,o,"max")},e}(vz);qx.className="MaxPooling2D";F.serialization.registerClass(qx);var zx=function(r){oe(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return qr(o),Ra(i),Fm(t,n,a,i,o,"avg")},e}(vz);zx.className="AveragePooling2D";F.serialization.registerClass(zx);var mz=function(r){oe(e,r);function e(t){var n=this;if(t.poolSize==null&&(t.poolSize=[2,2,2]),n=r.call(this,t)||this,n.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],t.strides==null)n.strides=n.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==3)throw new J("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+"".concat(t.strides.length,"."));n.strides=t.strides}else n.strides=[t.strides,t.strides,t.strides];return sn(n.poolSize,"poolSize"),sn(n.strides,"strides"),n.padding=t.padding==null?"valid":t.padding,n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,qr(n.dataFormat),Ra(n.padding),n.inputSpec=[new Kr({ndim:5})],n}return e.prototype.computeOutputShape=function(t){t=Rt(t);var n=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[4]:t[3];return n=_i(n,this.poolSize[0],this.padding,this.strides[0]),a=_i(a,this.poolSize[1],this.padding,this.strides[1]),i=_i(i,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,a,i]:[t[0],n,a,i,t[4]]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){return a.invokeCallHook(t,n),a.poolingFunction(ut(t),a.poolSize,a.strides,a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(xt),$x=function(r){oe(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return qr(o),Ra(i),pz(t,n,a,i,o,"max")},e}(mz);$x.className="MaxPooling3D";F.serialization.registerClass($x);var Wx=function(r){oe(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return qr(o),Ra(i),pz(t,n,a,i,o,"avg")},e}(mz);Wx.className="AveragePooling3D";F.serialization.registerClass(Wx);var gz=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.inputSpec=[new Kr({ndim:3})],n}return e.prototype.computeOutputShape=function(t){return[t[0],t[2]]},e.prototype.call=function(t,n){throw new wt},e}(xt),Ux=function(r){oe(e,r);function e(t){return r.call(this,t||{})||this}return e.prototype.call=function(t,n){return F.tidy(function(){var a=ut(t);return A.mean(a,1)})},e}(gz);Ux.className="GlobalAveragePooling1D";F.serialization.registerClass(Ux);var Vx=function(r){oe(e,r);function e(t){return r.call(this,t||{})||this}return e.prototype.call=function(t,n){return F.tidy(function(){var a=ut(t);return A.max(a,1)})},e}(gz);Vx.className="GlobalMaxPooling1D";F.serialization.registerClass(Vx);var yz=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,qr(n.dataFormat),n.inputSpec=[new Kr({ndim:4})],n}return e.prototype.computeOutputShape=function(t){return t=t,this.dataFormat==="channelsLast"?[t[0],t[3]]:[t[0],t[1]]},e.prototype.call=function(t,n){throw new wt},e.prototype.getConfig=function(){var t={dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(xt),Gx=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=ut(t);return a.dataFormat==="channelsLast"?A.mean(i,[1,2]):A.mean(i,[2,3])})},e}(yz);Gx.className="GlobalAveragePooling2D";F.serialization.registerClass(Gx);var Hx=function(r){oe(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=ut(t);return a.dataFormat==="channelsLast"?A.max(i,[1,2]):A.max(i,[2,3])})},e}(yz);Hx.className="GlobalMaxPooling2D";F.serialization.registerClass(Hx);var bz=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.layer=t.layer,n}return e.prototype.build=function(t){this.built=!0},Object.defineProperty(e.prototype,"trainable",{get:function(){return this.layer!=null?this.layer.trainable:!1},set:function(t){this.layer!=null&&(this.layer.trainable=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!1,configurable:!0}),e.prototype.getWeights=function(){return this.layer.getWeights()},e.prototype.setWeights=function(t){this.layer.setWeights(t)},e.prototype.getConfig=function(){var t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.setFastWeightInitDuringBuild=function(t){r.prototype.setFastWeightInitDuringBuild.call(this,t),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(t)},e.fromConfig=function(t,n,a){a===void 0&&(a={});var i=n.layer,o=Di(i,a);delete n.layer;var s={layer:o};return Object.assign(s,n),new t(s)},e}(xt),jx=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n}return e.prototype.build=function(t){if(t=Rt(t),t.length<3)throw new J("TimeDistributed layer expects an input shape >= 3D, but received "+"input shape ".concat(JSON.stringify(t)));this.inputSpec=[{shape:t}];var n=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),r.prototype.build.call(this,t)},e.prototype.computeOutputShape=function(t){t=Rt(t);var n=[t[0]].concat(t.slice(2)),a=this.layer.computeOutputShape(n),i=t[1];return[a[0],i].concat(a.slice(1))},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){t=ut(t);var i=function(u,c){var l=ut(a.layer.call(u,n));return[l,[]]},o=fz(i,t,[],!1,null,null,!1,!0),s=o[1];return s})},e}(bz);jx.className="TimeDistributed";F.serialization.registerClass(jx);function XAe(r){Tu(Mxe,"BidirectionalMergeMode",r)}var YAe="concat",Kx=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this,a=t.layer.getConfig(),i={};i.className=t.layer.getClassName(),i.config=a,n.forwardLayer=Di(i),a.goBackwards=a.goBackwards!==!0;var o={};if(o.className=t.layer.getClassName(),o.config=a,n.backwardLayer=Di(o),n.forwardLayer.name="forward_"+n.forwardLayer.name,n.backwardLayer.name="backward_"+n.backwardLayer.name,n.mergeMode=t.mergeMode===void 0?YAe:t.mergeMode,XAe(n.mergeMode),t.weights)throw new wt("weights support is not implemented for Bidirectional layer yet.");return n._stateful=t.layer.stateful,n.returnSequences=t.layer.returnSequences,n.returnState=t.layer.returnState,n.supportsMasking=!0,n._trainable=!0,n.inputSpec=t.layer.inputSpec,n.numConstants=null,n}return Object.defineProperty(e.prototype,"trainable",{get:function(){return this._trainable},set:function(t){this._trainable=t,this.forwardLayer!=null&&(this.forwardLayer.trainable=t),this.backwardLayer!=null&&(this.backwardLayer.trainable=t)},enumerable:!1,configurable:!0}),e.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},e.prototype.setWeights=function(t){var n=t.length,a=Math.floor(n/2);this.forwardLayer.setWeights(t.slice(0,a)),this.backwardLayer.setWeights(t.slice(a))},e.prototype.computeOutputShape=function(t){var n=this.forwardLayer.computeOutputShape(t);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;var a,i,o;return this.returnState&&(o=n.slice(1)),a=n[0],a=a,this.mergeMode==="concat"?(a[a.length-1]*=2,i=[a]):this.mergeMode==null?i=[a,a.slice()]:i=[a],this.returnState?this.mergeMode==null?i.concat(o).concat(o.slice()):[a].concat(o).concat(o.slice()):Un(i)},e.prototype.apply=function(t,n){var a,i,o=n==null?null:n.initialState,s=n==null?null:n.constants;n==null&&(n={});var u=lz(t,o,s,this.numConstants);if(t=u.inputs,o=u.initialState,s=u.constants,Array.isArray(t)&&(o=t.slice(1),t=t[0]),(o==null||o.length===0)&&s==null)return r.prototype.apply.call(this,t,n);var c=[],l=[];if(o!=null){var f=o.length;if(f%2>0)throw new J("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=o,c.push.apply(c,et([],te(o),!1));var h=o.map(function(x){return new Kr({shape:x.shape})});this.forwardLayer.stateSpec=h.slice(0,f/2),this.backwardLayer.stateSpec=h.slice(f/2),l.push.apply(l,et([],te(h),!1))}if(s!=null)throw new wt("Support for constants in Bidirectional layers is not implemented yet.");var p=c[0]instanceof Oi;try{for(var d=fe(c),m=d.next();!m.done;m=d.next()){var v=m.value;if(v instanceof Oi!==p)throw new J("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}}catch(x){a={error:x}}finally{try{m&&!m.done&&(i=d.return)&&i.call(d)}finally{if(a)throw a.error}}if(p){var g=[t].concat(c),y=this.inputSpec.concat(l),w=this.inputSpec;this.inputSpec=y;var b=r.prototype.apply.call(this,g,n);return this.inputSpec=w,b}else return r.prototype.apply.call(this,t,n)},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=n.initialState,o,s;if(i==null)o=a.forwardLayer.call(t,n),s=a.backwardLayer.call(t,n);else{var u=i.slice(0,i.length/2),c=i.slice(i.length/2);o=a.forwardLayer.call(t,Object.assign(n,{initialState:u})),s=a.backwardLayer.call(t,Object.assign(n,{initialState:c}))}var l;a.returnState&&(Array.isArray(o)&&(l=o.slice(1).concat(s.slice(1))),o=o[0],s=s[0]),a.returnSequences&&(s=A.reverse(s,1));var f;return a.mergeMode==="concat"?f=c1([o,s]):a.mergeMode==="sum"?f=A.add(o,s):a.mergeMode==="ave"?f=A.mul(.5,A.add(o,s)):a.mergeMode==="mul"?f=A.mul(o,s):a.mergeMode==null&&(f=[o,s]),a.returnState?a.mergeMode==null?f.concat(l):[f].concat(l):f})},e.prototype.resetStates=function(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},e.prototype.build=function(t){var n=this;xu(this.forwardLayer.name,function(){n.forwardLayer.build(t)}),xu(this.backwardLayer.name,function(){n.backwardLayer.build(t)}),this.built=!0},e.prototype.computeMask=function(t,n){Array.isArray(n)&&(n=n[0]);var a;if(this.returnSequences?this.mergeMode==null?a=[n,n]:a=n:this.mergeMode==null?a=[null,null]:a=null,this.returnState){var i=this.forwardLayer.states,o=i.map(function(s){return null});return Array.isArray(a)?a.concat(o).concat(o):[a].concat(o).concat(o)}else return a},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!1,configurable:!0}),e.prototype.setFastWeightInitDuringBuild=function(t){r.prototype.setFastWeightInitDuringBuild.call(this,t),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(t),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(t)},e.prototype.getConfig=function(){var t={mergeMode:this.mergeMode},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.fromConfig=function(t,n){var a=Di(n.layer);if(delete n.layer,n.numConstants!=null)throw new wt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var i=n;return i.layer=a,new t(i)},e}(bz);Kx.className="Bidirectional";F.serialization.registerClass(Kx);var Xx=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.scale=t.scale,t.offset?n.offset=t.offset:n.offset=0,n}return e.prototype.getConfig=function(){var t={scale:this.scale,offset:this.offset},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){return t=ut(t),t.dtype!=="float32"&&(t=Qi(t,"float32")),F.add(F.mul(t,a.scale),a.offset)})},e}(xt);Xx.className="Rescaling";F.serialization.registerClass(Xx);var JAe=F.image.resizeBilinear,ZAe=F.image.cropAndResize,Yx=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.height=t.height,n.width=t.width,n}return e.prototype.centerCrop=function(t,n,a,i,o,s,u,c){return F.tidy(function(){var l,f=!1,h=n/s,p=a/u,d=(i+n)/s,m=(o+a)/u,v=[h,p,d,m],g=[];t.rank===3?(f=!0,l=F.stack([t])):l=t;for(var y=0;y<l.shape[0];y++)g.push(v);var w=F.tensor(g,[g.length,4]),b=F.range(0,g.length,1,"int32"),x=[i,o],S=ZAe(l,w,b,x,"nearest");return Qi(f?ut(F.unstack(S)):S,c)})},e.prototype.upsize=function(t,n,a,i){return F.tidy(function(){var o=JAe(t,[n,a]);return Qi(o,i)})},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=ut(t),o=i.dtype,s=i.shape,u=s[s.length-3],c=s[s.length-2],l=0;u!==a.height&&(l=Math.floor((u-a.height)/2));var f=0;return c!==a.width&&(f=Math.floor((c-a.width)/2),f===0&&(f=1)),l>=0&&f>=0?a.centerCrop(i,l,f,a.height,a.width,u,c,o):a.upsize(t,a.height,a.width,o)})},e.prototype.getConfig=function(){var t={height:this.height,width:this.width},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.computeOutputShape=function(t){t=Rt(t);var n=t.length-3,a=t.length-2;return t[n]=this.height,t[a]=this.width,t},e}(xt);Yx.className="CenterCrop";F.serialization.registerClass(Yx);function QAe(r,e,t,n){var a=ut(r);if(a.dtype!=="int32"&&(a=Qi(a,"int32")),e==="int")return a;var i=a.shape;if(a.rank===0&&(a=F.expandDims(a,-1)),e==="oneHot"&&a.shape[a.shape.length-1]!==1&&(a=F.expandDims(a,-1)),a.rank>2)throw new J("When outputMode is not int, maximum output rank is 2"+" Received outputMode ".concat(e," and input shape ").concat(i)+" which would result in output rank ".concat(a.rank,"."));var o=["multiHot","oneHot"].includes(e),s=a,u;if(typeof n<"u"&&e==="count"?u=F.denseBincount(s,n,t,o):u=F.denseBincount(s,[],t,o),e!=="tfIdf")return u;if(n)return F.mul(u,n);throw new J("When outputMode is 'tfIdf', weights must be provided.")}var Jx=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.numTokens=t.numTokens,t.outputMode?n.outputMode=t.outputMode:n.outputMode="multiHot",n}return e.prototype.getConfig=function(){var t={numTokens:this.numTokens,outputMode:this.outputMode},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.computeOutputShape=function(t){return t=Rt(t),t==null?[this.numTokens]:this.outputMode==="oneHot"&&t[t.length-1]!==1?(t.push(this.numTokens),t):(t[t.length-1]=this.numTokens,t)},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){t=ut(t),t.dtype!=="int32"&&(t=Qi(t,"int32"));var i;if(typeof n.countWeights<"u"){if(a.outputMode!=="count")throw new J(`countWeights is not used when outputMode !== count.
              Received countWeights=`.concat(n.countWeights));i=ut(n.countWeights)}var o=F.max(t),s=F.min(t),u=F.greater(a.numTokens,o).bufferSync().get(0),c=F.greaterEqual(s,0).bufferSync().get(0);if(!(u&&c))throw new J("Input values must be between 0 < values <="+" numTokens with numTokens=".concat(a.numTokens));return QAe(t,a.outputMode,a.numTokens,i)})},e}(xt);Jx.className="CategoryEncoding";F.serialization.registerClass(Jx);var eDe=["bilinear","nearest"],MB=new Set(eDe),Zx=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;if(n.height=t.height,n.width=t.width,t.interpolation)if(MB.has(t.interpolation))n.interpolation=t.interpolation;else throw new J("Invalid interpolation parameter: ".concat(t.interpolation," is not implemented"));else n.interpolation="bilinear";return n.cropToAspectRatio=Boolean(t.cropToAspectRatio),n}return e.prototype.computeOutputShape=function(t){t=Rt(t);var n=t[2];return[this.height,this.width,n]},e.prototype.getConfig=function(){var t={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=[a.height,a.width];if(a.interpolation==="bilinear")return F.image.resizeBilinear(t,i,!a.cropToAspectRatio);if(a.interpolation==="nearest")return F.image.resizeNearestNeighbor(t,i,!a.cropToAspectRatio);throw new Error("Interpolation is ".concat(a.interpolation," but only ").concat(et([],te(MB),!1)," are supported"))})},e}(xt);Zx.className="Resizing";F.serialization.registerClass(Zx);var wz=function(){function r(e){this.seed=e}return r.prototype.next=function(){if(this.seed!==void 0)return this.seed++},r}();wz.className="RandomSeed";var xz=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this;return n.randomGenerator=new wz(t.seed),n}return e.prototype.getConfig=function(){var t={seed:this.randomGenerator.seed},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(xt);xz.className="BaseRandomLayer";var tDe=["bilinear","nearest"],BB=new Set(tDe),Qx=function(r){oe(e,r);function e(t){var n=r.call(this,t)||this,a=t.factor,i=t.interpolation,o=i===void 0?"bilinear":i;if(n.factor=a,Array.isArray(n.factor)&&n.factor.length===2)n.widthLower=n.factor[0],n.widthUpper=n.factor[1];else if(!Array.isArray(n.factor)&&n.factor>0)n.widthLower=-n.factor,n.widthUpper=n.factor;else throw new J("Invalid factor: ".concat(n.factor,". Must be positive number or tuple of 2 numbers"));if(n.widthLower<-1||n.widthUpper<-1)throw new J("factor must have values larger than -1. Got: ".concat(n.factor));if(n.widthUpper<n.widthLower)throw new J(`factor cannot have upper bound less than lower bound.
        Got upper bound: `.concat(n.widthUpper,`.
        Got lower bound: `).concat(n.widthLower,`
      `));if(o)if(BB.has(o))n.interpolation=o;else throw new J("Invalid interpolation parameter: ".concat(o," is not implemented"));return n}return e.prototype.getConfig=function(){var t={factor:this.factor,interpolation:this.interpolation},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.computeOutputShape=function(t){t=Rt(t);var n=t[2];return[this.imgHeight,-1,n]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=ut(t);a.imgHeight=i.shape[i.shape.length-3];var o=i.shape[i.shape.length-2];a.widthFactor=F.randomUniform([1],1+a.widthLower,1+a.widthUpper,"float32",a.randomGenerator.next());var s=a.widthFactor.dataSync()[0]*o;s=Math.round(s);var u=[a.imgHeight,s];switch(a.interpolation){case"bilinear":return F.image.resizeBilinear(t,u);case"nearest":return F.image.resizeNearestNeighbor(t,u);default:throw new Error("Interpolation is ".concat(a.interpolation,`
          but only `).concat(et([],te(BB),!1)," are supported"))}})},e}(xz);Qx.className="RandomWidth";F.serialization.registerClass(Qx);function rDe(r){return new rl(r)}function nDe(r){return new ex(r)}function aDe(r){return new J1(r)}function iDe(r){return new Z1(r)}function oDe(r){return new Q1(r)}function sDe(r){return new rx(r)}function uDe(r){return new tx(r)}function cDe(r){return new sx(r)}function lDe(r){return new Tm(r)}function fDe(r){return new ax(r)}function hDe(r){return new Em(r)}function pDe(r){return new ix(r)}function dDe(r){return new ox(r)}function vDe(r){return new ux(r)}function mDe(r){return new cx(r)}function gDe(r){return new lx(r)}function yDe(r){return new yx(r)}function bDe(r){return new mx(r)}function wDe(r){return new _m(r)}function xDe(r){return new vx(r)}function kDe(r){return new gx(r)}function SDe(r){return new bx(r)}function NDe(r){return new wx(r)}function TDe(r){return new xx(r)}function EDe(r){return new Sx(r)}function IDe(r){return new Nx(r)}function CDe(r){return new Ex(r)}function ADe(r){return new Ax(r)}function DDe(r){return new Ix(r)}function _De(r){return new Cx(r)}function FDe(r){return new Tx(r)}function RDe(r){return new Dx(r)}function ODe(r){return new Ox(r)}function PDe(r){return new Px(r)}function MDe(r){return new Mx(r)}function ek(r){return new Lx(r)}function BDe(r){return ek(r)}function LDe(r){return ek(r)}function tk(r){return new zx(r)}function qDe(r){return tk(r)}function zDe(r){return tk(r)}function rk(r){return new Wx(r)}function $De(r){return rk(r)}function WDe(r){return rk(r)}function UDe(r){return new Ux(r)}function VDe(r){return new Gx(r)}function kz(r){return new Vx(r)}function Sz(r){return new Hx(r)}function Nz(r){return new Bx(r)}function Tz(r){return new qx(r)}function GDe(r){return new $x(r)}function HDe(r){return new hx(r)}function jDe(r){return new Cm(r)}function KDe(r){return new px(r)}function XDe(r){return new Mh(r)}function YDe(r){return new fx(r)}function JDe(r){return new Im(r)}function ZDe(r){return new dx(r)}function QDe(r){return new Dm(r)}function e_e(r){return new Co(r)}function t_e(r){return new Am(r)}function r_e(r){return new Kx(r)}function n_e(r){return new jx(r)}var a_e=kz,i_e=Sz,o_e=Nz,s_e=Tz;function u_e(r){return new _x(r)}function c_e(r){return new Fx(r)}function l_e(r){return new Rx(r)}function f_e(r){return new kx(r)}function h_e(r){return new Xx(r)}function p_e(r){return new Yx(r)}function d_e(r){return new Zx(r)}function v_e(r){return new Jx(r)}function m_e(r){return new Qx(r)}var g_e={__proto__:null,Layer:xt,RNN:Co,RNNCell:il,activation:yDe,add:IDe,alphaDropout:l_e,average:CDe,averagePooling1d:ek,averagePooling2d:tk,averagePooling3d:rk,avgPool1d:BDe,avgPool2d:qDe,avgPool3d:$De,avgPooling1d:LDe,avgPooling2d:zDe,avgPooling3d:WDe,batchNormalization:ODe,bidirectional:r_e,categoryEncoding:v_e,centerCrop:p_e,concatenate:ADe,conv1d:cDe,conv2d:lDe,conv2dTranspose:fDe,conv3d:hDe,conv3dTranspose:pDe,convLstm2d:ZDe,convLstm2dCell:QDe,cropping2D:vDe,dense:bDe,depthwiseConv2d:gDe,dot:RDe,dropout:wDe,elu:nDe,embedding:EDe,flatten:kDe,gaussianDropout:c_e,gaussianNoise:u_e,globalAveragePooling1d:UDe,globalAveragePooling2d:VDe,globalMaxPool1d:a_e,globalMaxPool2d:i_e,globalMaxPooling1d:kz,globalMaxPooling2d:Sz,gru:HDe,gruCell:jDe,input:Vq,inputLayer:rDe,layerNormalization:PDe,leakyReLU:iDe,lstm:KDe,lstmCell:XDe,masking:f_e,maxPool1d:o_e,maxPool2d:s_e,maxPooling1d:Nz,maxPooling2d:Tz,maxPooling3d:GDe,maximum:DDe,minimum:_De,multiply:FDe,permute:TDe,prelu:oDe,randomWidth:m_e,reLU:aDe,repeatVector:SDe,rescaling:h_e,reshape:NDe,resizing:d_e,rnn:e_e,separableConv2d:dDe,simpleRNN:YDe,simpleRNNCell:JDe,softmax:sDe,spatialDropout1d:xDe,stackedRNNCells:t_e,thresholdedReLU:uDe,timeDistributed:n_e,upSampling2d:mDe,zeroPadding2d:MDe};function y_e(r,e){return G1(r,e)}function b_e(r,e){return Pq(r,e)}function w_e(r,e){return Mq(r,e)}function x_e(r,e){return H1(r,e)}function k_e(r,e){return j1(r,e)}function S_e(r,e){return Oq(r,e)}function N_e(r,e){return tAe(r,e)}function T_e(r,e){return V1(r,e)}function E_e(r,e){return xm(r,e)}function I_e(r,e){return al(r,e)}function C_e(r,e){return al(r,e)}function A_e(r,e){return al(r,e)}function D_e(r,e){return Fu(r,e)}function __e(r,e){return Fu(r,e)}function F_e(r,e){return Fu(r,e)}var R_e={__proto__:null,MAPE:C_e,MSE:__e,binaryAccuracy:y_e,binaryCrossentropy:b_e,categoricalAccuracy:x_e,categoricalCrossentropy:k_e,cosineProximity:T_e,mape:A_e,meanAbsoluteError:E_e,meanAbsolutePercentageError:I_e,meanSquaredError:D_e,mse:F_e,precision:S_e,recall:N_e,sparseCategoricalAccuracy:w_e};var O_e={__proto__:null,modelFromJSON:_Ae};function P_e(r){return new Ph(r)}function M_e(r){return LAe(r)}function B_e(r){return qAe(r)}var L_e={__proto__:null,l1:M_e,l1l2:P_e,l2:B_e},Ez=function(r){oe(e,r);function e(){var t=r.apply(this,et([],te(arguments),!1))||this;return t.model=null,t}return e.prototype.setModel=function(t){if(!(t instanceof Io))throw new Error("model must be a LayersModel, not some other Container");this.model=t},e}(tl);function Lv(r,e){return r<e}function LB(r,e){return r>e}var Iz=function(r){oe(e,r);function e(t){var n=r.call(this)||this;if(t==null&&(t={}),t.restoreBestWeights)throw new wt("restoreBestWeights = True is not implemented in EarlyStopping yet.");return n.monitor=t.monitor||"val_loss",n.minDelta=Math.abs(t.minDelta||0),n.patience=t.patience||0,n.verbose=t.verbose||0,n.mode=t.mode||"auto",n.baseline=t.baseline,["auto","min","max"].indexOf(n.mode)===-1&&(console.warn("EarlyStopping mode '".concat(n.mode,"' is invalid. ")+"Falling back to mode 'auto'."),n.mode="auto"),n.mode==="min"?n.monitorFunc=Lv:n.mode==="max"||n.monitor.indexOf("acc")!==-1?n.monitorFunc=LB:n.monitorFunc=Lv,n.monitorFunc===Lv&&(n.minDelta*=-1),n}return e.prototype.onTrainBegin=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(n){return this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===Lv?1/0:-1/0,[2]})})},e.prototype.onEpochEnd=function(t,n){return Ce(this,void 0,void 0,function(){var a;return Ee(this,function(i){switch(i.label){case 0:return[4,vs(n)];case 1:return i.sent(),a=this.getMonitorValue(n),a==null?[2]:(this.monitorFunc(a-this.minDelta,this.best)?(this.best=a,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=t,this.model.stopTraining=!0)),[2])}})})},e.prototype.onTrainEnd=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(n){return this.stoppedEpoch>0&&this.verbose&&console.log("Epoch ".concat(this.stoppedEpoch,": early stopping.")),[2]})})},e.prototype.getMonitorValue=function(t){t==null&&(t={});var n=t[this.monitor];return n==null&&console.warn("Metric for EarlyStopping ".concat(this.monitor," is not available. ")+"Available metrics are: ".concat(Object.keys(t))),n},e}(Ez);function q_e(r){return new Iz(r)}var z_e={earlyStopping:q_e};wr.Callback=Ez;wr.CallbackList=Cq;wr.CustomCallback=Dq;wr.EarlyStopping=Iz;wr.History=Aq;wr.InputSpec=Kr;wr.LayerVariable=XB;wr.LayersModel=Io;wr.RNN=Co;wr.Sequential=Sm;wr.SymbolicTensor=Oi;wr.callbacks=z_e;wr.constraints=ECe;wr.initializers=WCe;wr.input=Vq;wr.layers=g_e;wr.loadLayersModel=FAe;wr.metrics=R_e;wr.model=PAe;wr.models=O_e;wr.registerCallbackConstructor=BAe;wr.regularizers=L_e;wr.sequential=MAe;wr.version_layers=K1});var SW=O(Uu=>{"use strict";var Be=mu();function $_e(r){var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}function W_e(r,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){if(n!=="default"&&!(n in r)){var a=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,a.get?a:{enumerable:!0,get:function(){return t[n]}})}})}),r}var Az=$_e(Be);var U_e=Be.env();U_e.registerFlag("KEEP_INTERMEDIATE_TENSORS",function(){return!1},function(r){r&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});var uk=function(r,e){return uk=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},uk(r,e)};function u$(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");uk(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function _t(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(f){o(f)}}function u(l){try{c(n.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((n=n.apply(r,e||[])).next())})}function Dt(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Qr(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function we(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function Lt(r,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}var da;(function(r){r[r.DT_INVALID=0]="DT_INVALID",r[r.DT_FLOAT=1]="DT_FLOAT",r[r.DT_DOUBLE=2]="DT_DOUBLE",r[r.DT_INT32=3]="DT_INT32",r[r.DT_UINT8=4]="DT_UINT8",r[r.DT_INT16=5]="DT_INT16",r[r.DT_INT8=6]="DT_INT8",r[r.DT_STRING=7]="DT_STRING",r[r.DT_COMPLEX64=8]="DT_COMPLEX64",r[r.DT_INT64=9]="DT_INT64",r[r.DT_BOOL=10]="DT_BOOL",r[r.DT_QINT8=11]="DT_QINT8",r[r.DT_QUINT8=12]="DT_QUINT8",r[r.DT_QINT32=13]="DT_QINT32",r[r.DT_BFLOAT16=14]="DT_BFLOAT16",r[r.DT_QINT16=15]="DT_QINT16",r[r.DT_QUINT16=16]="DT_QUINT16",r[r.DT_UINT16=17]="DT_UINT16",r[r.DT_COMPLEX128=18]="DT_COMPLEX128",r[r.DT_HALF=19]="DT_HALF",r[r.DT_RESOURCE=20]="DT_RESOURCE",r[r.DT_VARIANT=21]="DT_VARIANT",r[r.DT_UINT32=22]="DT_UINT32",r[r.DT_UINT64=23]="DT_UINT64",r[r.DT_FLOAT_REF=101]="DT_FLOAT_REF",r[r.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",r[r.DT_INT32_REF=103]="DT_INT32_REF",r[r.DT_UINT8_REF=104]="DT_UINT8_REF",r[r.DT_INT16_REF=105]="DT_INT16_REF",r[r.DT_INT8_REF=106]="DT_INT8_REF",r[r.DT_STRING_REF=107]="DT_STRING_REF",r[r.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",r[r.DT_INT64_REF=109]="DT_INT64_REF",r[r.DT_BOOL_REF=110]="DT_BOOL_REF",r[r.DT_QINT8_REF=111]="DT_QINT8_REF",r[r.DT_QUINT8_REF=112]="DT_QUINT8_REF",r[r.DT_QINT32_REF=113]="DT_QINT32_REF",r[r.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",r[r.DT_QINT16_REF=115]="DT_QINT16_REF",r[r.DT_QUINT16_REF=116]="DT_QUINT16_REF",r[r.DT_UINT16_REF=117]="DT_UINT16_REF",r[r.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",r[r.DT_HALF_REF=119]="DT_HALF_REF",r[r.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",r[r.DT_VARIANT_REF=121]="DT_VARIANT_REF",r[r.DT_UINT32_REF=122]="DT_UINT32_REF",r[r.DT_UINT64_REF=123]="DT_UINT64_REF"})(da||(da={}));var Dz;(function(r){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(r.CheckpointFormatVersion||(r.CheckpointFormatVersion={}))})(Dz||(Dz={}));var Ok={};function V_e(r,e){var t={tfOpName:r,category:"custom",inputs:[],attrs:[],customExecutor:e};Ok[r]=t}function c$(r){return Ok[r]}function G_e(r){delete Ok[r]}function I(r,e,t,n,a){var i=e.inputParams[r];if(i&&i.inputIndexStart!==void 0){var o=i.inputIndexStart,s=i.inputIndexEnd===0?void 0:i.inputIndexEnd===void 0?o+1:i.inputIndexEnd,u=o<0?e.inputNames.length+o:o;if(i.type==="tensor")return yn(e.inputNames[u],t,n,a);if(i.type==="tensors"){var c=e.inputs.slice(o,s),l=e.inputNames.slice(o,s).filter(function(d,m){var v;return((v=c[m])===null||v===void 0?void 0:v.op)!=="NoOp"});return l.map(function(d){return yn(d,t,n,a)})}var f=yn(e.inputNames[u],t,n,a),h=f.dataSync();return i.type==="number"?h[0]:Be.util.toNestedArray(f.shape,h)}var p=e.attrParams[r];return p&&p.value}function yn(r,e,t,n){var a=we(va(r,t),2),i=a[0],o=a[1];if(n!=null){var s=n.getHashTableHandleByName(i);if(s!=null)return s}var u=t.currentContextIds.find(function(c){return!!e[qm(i,c)]});return u!==void 0?e[qm(i,u)][o]:void 0}function _z(r,e,t){return e[qm(r,t.currentContextId)]}function Ao(r,e){var t=we(va(r,e),3),n=t[0],a=t[1],i=t[2];return[qm(n,e&&e.currentContextId),a,i]}function qm(r,e){return e?"".concat(r,"-").concat(e):r}function va(r,e){if(r==="")return["",0,void 0];var t=e!=null&&e.parseNodeNameCache!=null;if(t){var n=e.parseNodeNameCache.get(r);if(n!=null)return n}var a=r.split(":"),i;if(a.length===1)i=[r,0,void 0];else{var o=a[0],s=a.length===3?a[1]:void 0,u=Number(a[a.length-1]);i=[o,u,s]}return t&&e.parseNodeNameCache.set(r,i),i}function Pm(r,e,t){var n=I("pad",r,e,t);if(n==="explicit"){n=I("explicitPaddings",r,e,t);for(var a=[[0,0],[0,0],[0,0],[0,0]],i=0;i<4;i++)a[i][0]=n[i*2],a[i][1]=n[i*2+1];return a}return n}function Do(r){return r.kept?r:Be.clone(r)}var H_e=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],j_e={__proto__:null,json:H_e};var K_e=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],X_e={__proto__:null,json:K_e};var Y_e=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],J_e={__proto__:null,json:Y_e};var Z_e=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],Q_e={__proto__:null,json:Z_e};var e3e=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],t3e={__proto__:null,json:e3e};var r3e=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],n3e={__proto__:null,json:r3e};var a3e=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],i3e={__proto__:null,json:a3e};var o3e=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],s3e={__proto__:null,json:o3e};var u3e=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],c3e={__proto__:null,json:u3e};var l3e=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],f3e={__proto__:null,json:l3e};var h3e=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],p3e={__proto__:null,json:h3e};var d3e=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],v3e={__proto__:null,json:d3e};var m3e=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],g3e={__proto__:null,json:m3e};var y3e=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],b3e={__proto__:null,json:y3e};var w3e=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],x3e={__proto__:null,json:w3e};var k3e=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],S3e={__proto__:null,json:k3e};var N3e=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],T3e={__proto__:null,json:N3e};var E3e=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],I3e={__proto__:null,json:E3e};var C3e=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],A3e={__proto__:null,json:C3e},Fz=function(){function r(){var e=[j_e,X_e,J_e,Q_e,t3e,n3e,i3e,s3e,c3e,f3e,p3e,v3e,g3e,b3e,x3e,S3e,T3e,I3e,A3e],t=[].concat.apply([],Lt([],we(e.map(function(n){return n.json})),!1));this.opMappers=t.reduce(function(n,a){return n[a.tfOpName]=a,n},{})}return Object.defineProperty(r,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!1,configurable:!0}),r.prototype.transformGraph=function(e,t){var n=this;t===void 0&&(t={});var a=e.node,i=[],o=[],s=[],u=a.reduce(function(v,g){return v[g.name]=n.mapNode(g),g.op.startsWith("Placeholder")?i.push(v[g.name]):g.op==="Const"?o.push(v[g.name]):(g.input==null||g.input.length===0)&&s.push(v[g.name]),v},{}),c=[],l=[],f={},h={};t!=null&&(f=this.mapSignatureEntries(t.inputs),h=this.mapSignatureEntries(t.outputs));var p=Object.keys(u);p.forEach(function(v){var g=u[v];g.inputNames.forEach(function(y,w){var b=we(Ao(y),3),x=b[0],S=b[2],T=u[x];if(T.outputs!=null){var E=T.outputs.indexOf(S);if(E!==-1){var C="".concat(x,":").concat(E);g.inputNames[w]=C}}g.inputs.push(T),T.children.push(g)})}),Object.keys(h).length===0?p.forEach(function(v){var g=u[v];g.children.length===0&&l.push(g)}):Object.keys(h).forEach(function(v){var g=we(Ao(v),1),y=g[0],w=u[y];w!=null&&(w.signatureKey=h[v],l.push(w))}),Object.keys(f).length>0?Object.keys(f).forEach(function(v){var g=we(Ao(v),1),y=g[0],w=u[y];w&&(w.signatureKey=f[v],c.push(w))}):c=i;var d={};e.library!=null&&e.library.function!=null&&(d=e.library.function.reduce(function(v,g){return v[g.signature.name]=n.mapFunction(g),v},{}));var m={nodes:u,inputs:c,outputs:l,weights:o,placeholders:i,signature:t,functions:d};return s.length>0&&(m.initNodes=s),m},r.prototype.mapSignatureEntries=function(e){return Object.keys(e||{}).reduce(function(t,n){return t[e[n].name]=n,t},{})},r.prototype.mapNode=function(e){var t=c$(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});var n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(function(a){return a.startsWith("^")?a.slice(1):a}),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return t.inputs!=null&&(n.inputParams=t.inputs.reduce(function(a,i){return a[i.name]={type:i.type,inputIndexStart:i.start,inputIndexEnd:i.end},a},{})),t.attrs!=null&&(n.attrParams=t.attrs.reduce(function(a,i){var o=i.type,s=void 0;switch(i.type){case"string":s=ck(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=ck(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"string[]":s=mk(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=mk(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number":s=fk(e.attr,i.tfName,i.defaultValue||0),s===void 0&&!!i.tfDeprecatedName&&(s=fk(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number[]":s=vk(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=vk(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool":s=lk(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=lk(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool[]":s=yk(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=yk(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape":s=dk(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=dk(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape[]":s=gk(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=gk(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype":s=hk(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=hk(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype[]":s=pk(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=pk(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"func":s=Rz(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=Rz(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: ".concat(i.type," for op: ").concat(e.op))}return a[i.name]={value:s,type:o},a},{})),n},r.prototype.mapFunction=function(e){var t=this,n=e.nodeDef,a=[],i=[],o={};n!=null&&(o=n.reduce(function(h,p){return h[p.name]=t.mapNode(p),p.op==="Const"&&i.push(h[p.name]),h},{}));var s=[],u=[];e.signature.inputArg.forEach(function(h){var p=we(Ao(h.name),1),d=p[0],m={name:d,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:Pk(h.type),type:"dtype"}},children:[]};m.signatureKey=h.name,s.push(m),o[d]=m});var c=Object.keys(o);c.forEach(function(h){var p=o[h];p.inputNames.forEach(function(d,m){var v=we(Ao(d),3),g=v[0],y=v[2],w=o[g];if(w.outputs!=null){var b=w.outputs.indexOf(y);if(b!==-1){var x="".concat(g,":").concat(b);p.inputNames[m]=x}}p.inputs.push(w),w.children.push(p)})});var l=e.ret;e.signature.outputArg.forEach(function(h){var p=we(Ao(l[h.name]),2),d=p[0],m=p[1],v=o[d];v!=null&&(v.defaultOutput=m,u.push(v))});var f=this.mapArgsToSignature(e);return{nodes:o,inputs:s,outputs:u,weights:i,placeholders:a,signature:f}},r.prototype.mapArgsToSignature=function(e){var t=this;return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce(function(n,a){return n[a.name]=t.mapArgToTensorInfo(a),n},{}),outputs:e.signature.outputArg.reduce(function(n,a){return n[a.name]=t.mapArgToTensorInfo(a,e.ret),n},{})}},r.prototype.mapArgToTensorInfo=function(e,t){var n=e.name;return t!=null&&(n=t[n]),{name:n,dtype:e.type}},r}();function D3e(r){var e=Be.env().global;if(typeof e.atob<"u")return e.atob(r);if(typeof Buffer<"u")return new Buffer(r,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function l$(r,e){var t=Array.isArray(r)?String.fromCharCode.apply(null,r):D3e(r);return e?t:t.toLowerCase()}function ck(r,e,t,n){n===void 0&&(n=!1);var a=r[e];return a!=null?l$(a.s,n):t}function lk(r,e,t){var n=r[e];return n?n.b:t}function fk(r,e,t){var n=r[e]||{},a=n.i!=null?n.i:n.f!=null?n.f:t;return typeof a=="number"?a:parseInt(a,10)}function Pk(r){switch(typeof r=="string"&&(r=da[r]),r){case da.DT_FLOAT:case da.DT_HALF:return"float32";case da.DT_INT32:case da.DT_INT64:case da.DT_INT8:case da.DT_UINT8:return"int32";case da.DT_BOOL:return"bool";case da.DT_DOUBLE:return"float32";case da.DT_STRING:return"string";case da.DT_COMPLEX64:case da.DT_COMPLEX128:return"complex64";default:return null}}function Rz(r,e,t){var n=r[e];return n&&n.func?n.func.name:t}function hk(r,e,t){var n=r[e];return n&&n.type?Pk(n.type):t}function pk(r,e,t){var n=r[e];return n&&n.list&&n.list.type?n.list.type.map(function(a){return Pk(a)}):t}function f$(r){if(!r.unknownRank)return r.dim!=null?r.dim.map(function(e){return typeof e.size=="number"?e.size:parseInt(e.size,10)}):[]}function dk(r,e,t){var n=r[e];return n&&n.shape?f$(n.shape):t}function vk(r,e,t){var n=r[e];return n?((n.list.f&&n.list.f.length?n.list.f:n.list.i)||[]).map(function(a){return typeof a=="number"?a:parseInt(a,10)}):t}function mk(r,e,t,n){n===void 0&&(n=!1);var a=r[e];return a&&a.list&&a.list.s?a.list.s.map(function(i){return l$(i,n)}):t}function gk(r,e,t){var n=r[e];return n&&n.list&&n.list.shape?n.list.shape.map(function(a){return f$(a)}):t}function yk(r,e,t){var n=r[e];return n&&n.list&&n.list.b?n.list.b:t}var _3e=function(){function r(e,t,n){var a=this;this.node=e,this.tensorMap=t,this.context=n,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(function(i){return a.getInput(i)}),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce(function(i,o){return i[o]=a.getAttr(o),i},{}))}return r.prototype.getInput=function(e){return yn(e,this.tensorMap,this.context)},r.prototype.getAttr=function(e,t){var n=this.node.rawAttrs[e];if(n.tensor!=null)return yn(e,this.tensorMap,this.context);if(n.i!=null||n.f!=null)return fk(this.node.rawAttrs,e,t);if(n.s!=null)return ck(this.node.rawAttrs,e,t);if(n.b!=null)return lk(this.node.rawAttrs,e,t);if(n.shape!=null)return dk(this.node.rawAttrs,e,t);if(n.type!=null)return hk(this.node.rawAttrs,e,t);if(n.list!=null){if(n.list.i!=null||n.list.f!=null)return vk(this.node.rawAttrs,e,t);if(n.list.s!=null)return mk(this.node.rawAttrs,e,t);if(n.list.shape!=null)return gk(this.node.rawAttrs,e,t);if(n.list.b!=null)return yk(this.node.rawAttrs,e,t);if(n.list.type!=null)return pk(this.node.rawAttrs,e,t)}return t},r}();var F3e=1e-7,R3e=1e-4,O3e=function(){function r(){}return r.prototype.refCount=function(e){return pa("refCount")},r.prototype.incRef=function(e){return pa("incRef")},r.prototype.timerAvailable=function(){return!0},r.prototype.time=function(e){return pa("time")},r.prototype.read=function(e){return pa("read")},r.prototype.readSync=function(e){return pa("readSync")},r.prototype.readToGPU=function(e,t){return pa("readToGPU")},r.prototype.numDataIds=function(){return pa("numDataIds")},r.prototype.disposeData=function(e,t){return pa("disposeData")},r.prototype.write=function(e,t,n){return pa("write")},r.prototype.move=function(e,t,n,a,i){return pa("move")},r.prototype.createTensorFromGPUData=function(e,t,n){return pa("createTensorFromGPUData")},r.prototype.memory=function(){return pa("memory")},r.prototype.floatPrecision=function(){return pa("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?F3e:R3e},r.prototype.dispose=function(){return pa("dispose")},r}();function pa(r){throw new Error("'".concat(r,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function G(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function di(r,e,t){t===void 0&&(t=""),G(qu(r,e),function(){return t+" Shapes ".concat(r," and ").concat(e," must match")})}function vl(r){G(r!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function un(r){if(r.length===0)return 1;for(var e=r[0],t=1;t<r.length;t++)e*=r[t];return e}function P3e(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==null&&e[t]!==null&&r[t]!==e[t])return!1;return!0}function qu(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function Gh(r){return r%1===0}function Mm(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function Jm(r,e){var t=e.length;return r=r==null?e.map(function(n,a){return a}):[].concat(r),G(r.every(function(n){return n>=-t&&n<t}),function(){return"All values in axis param must be in range [-".concat(t,", ").concat(t,") but ")+"got axis ".concat(r)}),G(r.every(function(n){return Gh(n)}),function(){return"All values in axis param must be integers but "+"got axis ".concat(r)}),r.map(function(n){return n<0?t+n:n})}function M3e(r,e){for(var t=[],n=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:Jm(e,r).sort(),o=0,s=0;s<r.length;++s){if(i!=null){if(i[o]===s&&r[s]!==1)throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(r[s],"' is not 1"));(i[o]==null||i[o]>s)&&r[s]===1&&(t.push(r[s]),n.push(s)),i[o]<=s&&o++}r[s]!==1&&(t.push(r[s]),n.push(s))}return{newShape:t,keptDims:n}}function B3e(r,e){return h$(r,e)}function h$(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else if(r==="string")t=new Array(e);else throw new Error("Unknown data type ".concat(r));return t}function L3e(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type ".concat(e," being uploaded contains ").concat(n,"."))}}function q3e(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function bk(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype ".concat(r))}function z3e(r){if(r==null)return 0;var e=0;return r.forEach(function(t){return e+=t.length}),e}function Mk(r){return typeof r=="string"||r instanceof String}function $3e(r){return typeof r=="boolean"}function W3e(r){return typeof r=="number"}function Zm(r){return Array.isArray(r)?Zm(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":W3e(r)?"float32":Mk(r)?"string":$3e(r)?"bool":"float32"}function Oz(r){return!!(r&&r.constructor&&r.call&&r.apply)}function Bk(r){var e=r.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=r[e-1];for(var n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function p$(r,e,t,n){n===void 0&&(n=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(n?2:1),o=0;o<i;o++)a[o]=t[r+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(l,f){return l*f})*(n?2:1),o=0;o<i;o++)a[o]=p$(r+o*u,s,t,n);return a}function Pz(r,e,t){if(t===void 0&&(t=!1),r.length===0)return e[0];var n=r.reduce(function(a,i){return a*i})*(t?2:1);if(n===0)return[];if(n!==e.length)throw new Error("[".concat(r,"] does not match the input size ").concat(e.length).concat(t?" for a complex tensor":"","."));return p$(0,r,e,t)}function d$(r,e){for(var t=Lk(r,e),n=0;n<t.length;n++)t[n]=1;return t}function Lk(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error("Unknown data type ".concat(e))}function Pa(r){r.forEach(function(e){G(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(r,"].")})})}function qk(r){return r&&r.then&&typeof r.then=="function"}var Mz="tfjsflags",U3e=function(){function r(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=V3e,this.populateURLFlags()}return r.prototype.setPlatform=function(e,t){this.platform!=null&&(jn().getBool("IS_TEST")||jn().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t},r.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){var a=this.urlFlags[e];jn().getBool("IS_TEST")||jn().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(a,".")),this.set(e,a)}},r.prototype.getAsync=function(e){return _t(this,void 0,void 0,function(){var t,n;return Dt(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,n=e,[4,this.evaluateFlag(e)]);case 1:return t[n]=a.sent(),[2,this.flags[e]]}})})},r.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(qk(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},r.prototype.getNumber=function(e){return this.get(e)},r.prototype.getBool=function(e){return this.get(e)},r.prototype.getString=function(e){return this.get(e)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!1,configurable:!0}),r.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},r.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()},r.prototype.setFlags=function(e){this.flags=Object.assign({},e)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if(Mz in t){var n=t[Mz].split(",");n.forEach(function(a){var i=we(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=H3e(o,s)})}}},r}();function V3e(r){var e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];return G3e(e,n[0],n[1]),n.join("=")}),e}function G3e(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function H3e(r,e){var t=e.toLowerCase();return t==="true"||t==="false"?t==="true":"".concat(+t)===t?+t:e}function jn(){return v$}var v$=null;function j3e(r){v$=r}var nk;function m$(){if(nk==null){var r=void 0;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");nk=r}return nk}function K3e(){var r=m$();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function zk(r,e){var t=K3e();if(t.has(r))return t.get(r);var n=e();return t.set(r,n),t.get(r)}var X3e="Abs",Y3e="Acos",J3e="Acosh",g$="Add",Z3e="AddN",Q3e="All",eFe="Any",tFe="ArgMax",rFe="ArgMin",nFe="Asin",aFe="Asinh",iFe="Atan",oFe="Atanh",sFe="Atan2",uFe="AvgPool",cFe="AvgPool3D",lFe="BatchMatMul",fFe="BatchToSpaceND",hFe="Bincount",pFe="BitwiseAnd",dFe="BroadcastArgs",y$="Cast",vFe="Ceil",mFe="ClipByValue",gFe="Complex",yFe="ComplexAbs",bFe="Concat",wFe="Conv2D",xFe="Conv2DBackpropFilter",kFe="Conv2DBackpropInput",SFe="Conv3D",NFe="Conv3DBackpropInputV2",TFe="Cos",EFe="Cosh",IFe="Cumprod",CFe="Cumsum",AFe="CropAndResize",DFe="DenseBincount",_Fe="DepthToSpace",FFe="DepthwiseConv2dNative",RFe="DepthwiseConv2dNativeBackpropFilter",OFe="DepthwiseConv2dNativeBackpropInput",PFe="Diag",MFe="Dilation2D",BFe="RealDiv",LFe="Einsum",qFe="Elu",zFe="Erf",$Fe="Equal",WFe="Exp",UFe="ExpandDims",VFe="Expm1",GFe="FFT",HFe="Fill",jFe="FlipLeftRight",KFe="Floor",XFe="FloorDiv",YFe="FusedBatchNorm",JFe="GatherV2",ZFe="GatherNd",QFe="Greater",eRe="GreaterEqual",b$="Identity",tRe="IFFT",rRe="Imag",nRe="IsFinite",aRe="IsInf",iRe="IsNan",oRe="LeakyRelu",sRe="Less",uRe="LessEqual",cRe="LinSpace",lRe="Log",fRe="Log1p",hRe="LogicalAnd",pRe="LogicalNot",dRe="LogicalOr",vRe="LRN",mRe="Max",gRe="Maximum",yRe="MaxPool",bRe="MaxPool3D",wRe="MaxPoolWithArgmax",xRe="Mean",kRe="Min",SRe="Minimum",NRe="MirrorPad",TRe="Mod",ERe="Multinomial",IRe="Multiply",CRe="Neg",ARe="NotEqual",DRe="NonMaxSuppressionV3",_Re="NonMaxSuppressionV4",FRe="NonMaxSuppressionV5",RRe="OnesLike",ORe="OneHot",PRe="Pack",MRe="PadV2",BRe="Pow",LRe="Prelu",qRe="Prod",zRe="RaggedGather",$Re="RaggedRange",WRe="RaggedTensorToTensor",URe="Range",VRe="Real",GRe="Reciprocal",HRe="Relu",jRe="Reshape",KRe="ResizeNearestNeighbor",XRe="ResizeBilinear",YRe="Relu6",JRe="Reverse",ZRe="Round",QRe="Rsqrt",eOe="ScatterNd",tOe="TensorScatterUpdate",rOe="SearchSorted",nOe="Select",aOe="Selu",iOe="Slice",oOe="Sin",sOe="Sinh",uOe="Sign",cOe="Sigmoid",lOe="Softplus",fOe="Sqrt",hOe="Sum",pOe="SpaceToBatchND",dOe="SplitV",vOe="Softmax",mOe="SparseFillEmptyRows",gOe="SparseReshape",yOe="SparseSegmentMean",bOe="SparseSegmentSum",wOe="SparseToDense",xOe="SquaredDifference",kOe="StaticRegexReplace",SOe="StridedSlice",NOe="StringNGrams",TOe="StringSplit",EOe="StringToHashBucketFast",IOe="Sub",COe="Tan",AOe="Tanh",w$="Tile",DOe="TopK",_Oe="Transform",ak="Transpose",FOe="Unique",ROe="Unpack",OOe="UnsortedSegmentSum",POe="ZerosLike",MOe="Step",BOe="RotateWithOffset",Bz="_FusedMatMul",Lz="FusedConv2D",qz="FusedDepthwiseConv2D";function Bh(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];jn().getBool("IS_TEST")||jn().getBool("PROD")||console.warn.apply(console,Lt([],we(r),!1))}var x$=zk("kernelRegistry",function(){return new Map}),LOe=zk("gradRegistry",function(){return new Map});function zz(r,e){var t=qOe(r,e);return x$.get(t)}function $z(r){return LOe.get(r)}function Wz(r){for(var e=x$.entries(),t=[];;){var n=e.next(),a=n.done,i=n.value;if(a)break;var o=we(i,2),s=o[0],u=o[1],c=we(s.split("_"),1),l=c[0];l===r&&t.push(u)}return t}function qOe(r,e){return"".concat(e,"_").concat(r)}function zOe(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}var zu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function $Oe(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function WOe(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){if(this instanceof n){var a=[null];a.push.apply(a,arguments);var i=Function.bind.apply(e,a);return new i}return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var a=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,a.get?a:{enumerable:!0,get:function(){return r[n]}})}),t}var k$=cr,li=null;try{li=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function cr(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}cr.prototype.__isLong__;Object.defineProperty(cr.prototype,"__isLong__",{value:!0});function ba(r){return(r&&r.__isLong__)===!0}cr.isLong=ba;var Uz={},Vz={};function $u(r,e){var t,n,a;return e?(r>>>=0,(a=0<=r&&r<256)&&(n=Vz[r],n)?n:(t=lr(r,(r|0)<0?-1:0,!0),a&&(Vz[r]=t),t)):(r|=0,(a=-128<=r&&r<128)&&(n=Uz[r],n)?n:(t=lr(r,r<0?-1:0,!1),a&&(Uz[r]=t),t))}cr.fromInt=$u;function fi(r,e){if(isNaN(r))return e?Pu:hi;if(e){if(r<0)return Pu;if(r>=S$)return E$}else{if(r<=-Hz)return ga;if(r+1>=Hz)return T$}return r<0?fi(-r,e).neg():lr(r%hl|0,r/hl|0,e)}cr.fromNumber=fi;function lr(r,e,t){return new cr(r,e,t)}cr.fromBits=lr;var zm=Math.pow;function $k(r,e,t){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return hi;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return $k(r.substring(1),e,t).neg();for(var a=fi(zm(t,8)),i=hi,o=0;o<r.length;o+=8){var s=Math.min(8,r.length-o),u=parseInt(r.substring(o,o+s),t);if(s<8){var c=fi(zm(t,s));i=i.mul(c).add(fi(u))}else i=i.mul(a),i=i.add(fi(u))}return i.unsigned=e,i}cr.fromString=$k;function zi(r,e){return typeof r=="number"?fi(r,e):typeof r=="string"?$k(r,e):lr(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}cr.fromValue=zi;var Gz=1<<16,UOe=1<<24,hl=Gz*Gz,S$=hl*hl,Hz=S$/2,jz=$u(UOe),hi=$u(0);cr.ZERO=hi;var Pu=$u(0,!0);cr.UZERO=Pu;var sl=$u(1);cr.ONE=sl;var N$=$u(1,!0);cr.UONE=N$;var wk=$u(-1);cr.NEG_ONE=wk;var T$=lr(-1,2147483647,!1);cr.MAX_VALUE=T$;var E$=lr(-1,-1,!0);cr.MAX_UNSIGNED_VALUE=E$;var ga=lr(0,-2147483648,!1);cr.MIN_VALUE=ga;var Oe=cr.prototype;Oe.toInt=function(){return this.unsigned?this.low>>>0:this.low};Oe.toNumber=function(){return this.unsigned?(this.high>>>0)*hl+(this.low>>>0):this.high*hl+(this.low>>>0)};Oe.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ga)){var t=fi(e),n=this.div(t),a=n.mul(t).sub(this);return n.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=fi(zm(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};Oe.getHighBits=function(){return this.high};Oe.getHighBitsUnsigned=function(){return this.high>>>0};Oe.getLowBits=function(){return this.low};Oe.getLowBitsUnsigned=function(){return this.low>>>0};Oe.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ga)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};Oe.isZero=function(){return this.high===0&&this.low===0};Oe.eqz=Oe.isZero;Oe.isNegative=function(){return!this.unsigned&&this.high<0};Oe.isPositive=function(){return this.unsigned||this.high>=0};Oe.isOdd=function(){return(this.low&1)===1};Oe.isEven=function(){return(this.low&1)===0};Oe.equals=function(e){return ba(e)||(e=zi(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Oe.eq=Oe.equals;Oe.notEquals=function(e){return!this.eq(e)};Oe.neq=Oe.notEquals;Oe.ne=Oe.notEquals;Oe.lessThan=function(e){return this.comp(e)<0};Oe.lt=Oe.lessThan;Oe.lessThanOrEqual=function(e){return this.comp(e)<=0};Oe.lte=Oe.lessThanOrEqual;Oe.le=Oe.lessThanOrEqual;Oe.greaterThan=function(e){return this.comp(e)>0};Oe.gt=Oe.greaterThan;Oe.greaterThanOrEqual=function(e){return this.comp(e)>=0};Oe.gte=Oe.greaterThanOrEqual;Oe.ge=Oe.greaterThanOrEqual;Oe.compare=function(e){if(ba(e)||(e=zi(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Oe.comp=Oe.compare;Oe.negate=function(){return!this.unsigned&&this.eq(ga)?ga:this.not().add(sl)};Oe.neg=Oe.negate;Oe.add=function(e){ba(e)||(e=zi(e));var t=this.high>>>16,n=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,p=0;return p+=i+c,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=n+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,lr(h<<16|p,l<<16|f,this.unsigned)};Oe.subtract=function(e){return ba(e)||(e=zi(e)),this.add(e.neg())};Oe.sub=Oe.subtract;Oe.multiply=function(e){if(this.isZero())return hi;if(ba(e)||(e=zi(e)),li){var t=li.mul(this.low,this.high,e.low,e.high);return lr(t,li.get_high(),this.unsigned)}if(e.isZero())return hi;if(this.eq(ga))return e.isOdd()?ga:hi;if(e.eq(ga))return this.isOdd()?ga:hi;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(jz)&&e.lt(jz))return fi(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*l,p+=d>>>16,d&=65535,p+=i*l,h+=p>>>16,p&=65535,p+=o*c,h+=p>>>16,p&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=n*l+a*c+i*u+o*s,f&=65535,lr(p<<16|d,f<<16|h,this.unsigned)};Oe.mul=Oe.multiply;Oe.divide=function(e){if(ba(e)||(e=zi(e)),e.isZero())throw Error("division by zero");if(li){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?li.div_u:li.div_s)(this.low,this.high,e.low,e.high);return lr(t,li.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Pu:hi;var n,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Pu;if(e.gt(this.shru(1)))return N$;i=Pu}else{if(this.eq(ga)){if(e.eq(sl)||e.eq(wk))return ga;if(e.eq(ga))return sl;var o=this.shr(1);return n=o.div(e).shl(1),n.eq(hi)?e.isNegative()?sl:wk:(a=this.sub(e.mul(n)),i=n.add(a.div(e)),i)}else if(e.eq(ga))return this.unsigned?Pu:hi;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=hi}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:zm(2,s-48),c=fi(n),l=c.mul(e);l.isNegative()||l.gt(a);)n-=u,c=fi(n,this.unsigned),l=c.mul(e);c.isZero()&&(c=sl),i=i.add(c),a=a.sub(l)}return i};Oe.div=Oe.divide;Oe.modulo=function(e){if(ba(e)||(e=zi(e)),li){var t=(this.unsigned?li.rem_u:li.rem_s)(this.low,this.high,e.low,e.high);return lr(t,li.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Oe.mod=Oe.modulo;Oe.rem=Oe.modulo;Oe.not=function(){return lr(~this.low,~this.high,this.unsigned)};Oe.and=function(e){return ba(e)||(e=zi(e)),lr(this.low&e.low,this.high&e.high,this.unsigned)};Oe.or=function(e){return ba(e)||(e=zi(e)),lr(this.low|e.low,this.high|e.high,this.unsigned)};Oe.xor=function(e){return ba(e)||(e=zi(e)),lr(this.low^e.low,this.high^e.high,this.unsigned)};Oe.shiftLeft=function(e){return ba(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?lr(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):lr(0,this.low<<e-32,this.unsigned)};Oe.shl=Oe.shiftLeft;Oe.shiftRight=function(e){return ba(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?lr(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):lr(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Oe.shr=Oe.shiftRight;Oe.shiftRightUnsigned=function(e){if(ba(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var n=this.low;return lr(n>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?lr(t,0,this.unsigned):lr(t>>>e-32,0,this.unsigned)};Oe.shru=Oe.shiftRightUnsigned;Oe.shr_u=Oe.shiftRightUnsigned;Oe.toSigned=function(){return this.unsigned?lr(this.low,this.high,!1):this};Oe.toUnsigned=function(){return this.unsigned?this:lr(this.low,this.high,!0)};Oe.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Oe.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Oe.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};cr.fromBytes=function(e,t,n){return n?cr.fromBytesLE(e,t):cr.fromBytesBE(e,t)};cr.fromBytesLE=function(e,t){return new cr(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};cr.fromBytesBE=function(e,t){return new cr(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var I$=$Oe(k$),VOe=W_e({__proto__:null,default:I$},[k$]),GOe=I$||VOe;function Wk(r){return GOe.fromString(r,!0,16)}Wk("c3a5c85c97cb3127");Wk("b492b66fbe98f273");Wk("9ae16a3b2f90404f");function HOe(r,e){return r instanceof Float32Array&&e==="float32"||r instanceof Int32Array&&e==="int32"||r instanceof Uint8Array&&e==="bool"}function C$(r,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=Hh(r)),jn().getBool("DEBUG")&&L3e(r,e),HOe(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){for(var t=new Uint8Array(r.length),n=0;n<t.length;++n)Math.round(r[n])!==0&&(t[n]=1);return t}else throw new Error("Unknown data type ".concat(e))}function $m(){return jn().platform.now()}function jOe(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",jn().platform.encode(r,e)}function Kz(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",jn().platform.decode(r,e)}function qi(r){return jn().platform.isTypedArray!=null?jn().platform.isTypedArray(r):zOe(r)}function Hh(r,e,t){var n,a;if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),typeof r=="boolean"||typeof r=="number"||typeof r=="string"||qk(r)||r==null||qi(r)&&t)e.push(r);else if(Array.isArray(r)||qi(r))for(var i=0;i<r.length;++i)Hh(r[i],e,t);else{var o=-1;try{for(var s=Qr(Object.keys(r)),u=s.next();!u.done;u=s.next()){var c=u.value;/^([1-9]+[0-9]*|0)$/.test(c)&&(o=Math.max(o,Number(c)))}}catch(l){n={error:l}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}for(var i=0;i<=o;i++)Hh(r[i],e,t)}return e}var KOe=function(){function r(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new YOe)}return r.prototype.profileKernel=function(e,t,n){var a,i,o,s=function(){o=n()},u,c=$m();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var l=Qr(o),f=l.next();!f.done;f=l.next()){var h=f.value;h.dataSync()}}catch(v){a={error:v}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:$m()-c})}if(jn().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var p=function(v){var g=o[v];g.data().then(function(y){XOe(y,g.dtype,e)})},d=0;d<o.length;d++)p(d);var m={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(v){return v.kernelMs}),extraInfo:u.then(function(v){return v.getExtraProfileInfo!=null?v.getExtraProfileInfo():""})};return m},r.prototype.logKernelProfile=function(e){var t=this,n=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(c){t.logger.logKernelProfile(n,u,c[0],c[1],o,c[2])})})},r}();function XOe(r,e,t){if(e!=="float32")return!1;for(var n=0;n<r.length;n++){var a=r[n];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(t,"'")),!0}return!1}var YOe=function(){function r(){}return r.prototype.logKernelProfile=function(e,t,n,a,i,o){var s=typeof a=="number"?Mm("".concat(a,"ms"),9):a.error,u=Mm(e,25),c=t.rank,l=t.size,f=Mm(t.shape.toString(),14),h="";for(var p in i){var d=i[p];if(d!=null){var m=d.shape||t.shape,v=m.length;h+="".concat(p,": ").concat(v,"D ").concat(v>0?m:""," ")}}console.log("%c".concat(u,"	%c").concat(s,"	%c").concat(c,"D ").concat(f,"	%c").concat(l,"	%c").concat(h,"	%c").concat(o),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r}();function JOe(r,e,t){for(var n={},a={},i=0;i<e.length;i++)n[e[i].id]=!0;for(var i=0;i<r.length;i++){var o=r[i],s=o.inputs;for(var u in s){for(var c=s[u],l=!1,f=0;f<e.length;f++)if(n[c.id]){o.outputs.forEach(function(w){return n[w.id]=!0}),l=!0,a[o.id]=!0;break}if(l)break}}var h={};h[t.id]=!0;for(var p={},i=r.length-1;i>=0;i--)for(var o=r[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,p[o.id]=!0;break}for(var d=[],i=0;i<r.length;i++){var o=r[i];if(a[o.id]&&p[o.id]){var m={};for(var u in o.inputs){var v=o.inputs[u];n[v.id]&&(m[u]=v)}var g=Object.assign({},o);g.inputs=m,g.outputs=o.outputs,d.push(g)}}return d}function ZOe(r,e,t,n){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var p=r[h.id];p!=null?u.push(p):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(s.kernelName,"."));var c=s.gradient(u),l=function(h){if(!(h in c))throw new Error("Cannot backprop through input ".concat(h,". ")+"Available gradients found: ".concat(Object.keys(c),"."));var p=t(function(){return c[h]()});if(p.dtype!=="float32")throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"".concat(h," must have 'float32' dtype, but has '").concat(p.dtype,"'"));var d=s.inputs[h];if(!qu(p.shape,d.shape))throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"'".concat(h,"' has shape '").concat(p.shape,"', which does not match ")+"the shape of the input '".concat(d.shape,"'"));if(r[d.id]==null)r[d.id]=p;else{var m=r[d.id];r[d.id]=n(m,p),m.dispose()}};for(var f in s.inputs)l(f)},i=e.length-1;i>=0;i--)a(i)}var Xz=20,Lh=3,ik=7;function QOe(r,e,t,n){var a=Bk(e),i=ePe(r,e,t,a),o=e.length,s=Bm(r,e,t,a,i),u=["Tensor"];return n&&(u.push("  dtype: ".concat(t)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(e,"]")),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function ePe(r,e,t,n){var a=un(e),i=n[n.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?Wh(r):r;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,f=0;f<i;f++)o[f]=Math.max(o[f],$h(u[l+f],0,t).length);return o}function $h(r,e,t){var n;return Array.isArray(r)?n="".concat(parseFloat(r[0].toFixed(ik))," + ")+"".concat(parseFloat(r[1].toFixed(ik)),"j"):Mk(r)?n="'".concat(r,"'"):t==="bool"?n=A$(r):n=parseFloat(r.toFixed(ik)).toString(),Mm(n,e)}function A$(r){return r===0?"false":"true"}function Bm(r,e,t,n,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var c=Wh(r);return[$h(c[0],0,t)]}return t==="bool"?[A$(r[0])]:[r[0].toString()]}if(u===1){if(s>Xz){var l=Lh*o,f=Array.from(r.slice(0,l)),h=Array.from(r.slice((s-Lh)*o,s*o));return t==="complex64"&&(f=Wh(f),h=Wh(h)),["["+f.map(function(T,E){return $h(T,a[E],t)}).join(", ")+", ..., "+h.map(function(T,E){return $h(T,a[s-Lh+E],t)}).join(", ")+"]"]}var p=t==="complex64"?Wh(r):Array.from(r);return["["+p.map(function(T,E){return $h(T,a[E],t)}).join(", ")+"]"]}var d=e.slice(1),m=n.slice(1),v=n[0]*o,g=[];if(s>Xz){for(var y=0;y<Lh;y++){var w=y*v,b=w+v;g.push.apply(g,Lt([],we(Bm(r.slice(w,b),d,t,m,a,!1)),!1))}g.push("...");for(var y=s-Lh;y<s;y++){var w=y*v,b=w+v;g.push.apply(g,Lt([],we(Bm(r.slice(w,b),d,t,m,a,y===s-1)),!1))}}else for(var y=0;y<s;y++){var w=y*v,b=w+v;g.push.apply(g,Lt([],we(Bm(r.slice(w,b),d,t,m,a,y===s-1)),!1))}var x=u===2?",":"";g[0]="["+(s>0?g[0]+x:"");for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+x;for(var S=`,
`,y=2;y<u;y++)S+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":S),g}function Wh(r){for(var e=[],t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var xk=function(){function r(e,t,n){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=un(e),n!=null){var i=n.length;G(i===this.size,function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||h$(t,this.size),this.strides=Bk(e)}return r.prototype.set=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];n.length===0&&(n=[0]),G(n.length===this.rank,function(){return"The number of provided coordinates (".concat(n.length,") must ")+"match the rank (".concat(t.rank,")")});var i=this.locToIndex(n);this.values[i]=e},r.prototype.get=function(){for(var e,t,n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];n.length===0&&(n=[0]);var i=0;try{for(var o=Qr(n),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var c="Requested out of range element at ".concat(n,". ")+"  Buffer shape=".concat(this.shape);throw new Error(c)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var l=n[n.length-1],f=0;f<n.length-1;++f)l+=this.strides[f]*n[f];return this.values[l]},r.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},r.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),r.prototype.toTensor=function(){return Li().makeTensor(this.values,this.shape,this.dtype)},r}(),Li=null,qh=null;function tPe(r){Li=r}var ma=function(){function r(e,t,n,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=un(e),this.strides=Bk(e),this.dataId=n,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),r.prototype.buffer=function(){return _t(this,void 0,void 0,function(){var e;return Dt(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,qh.buffer(this.shape,this.dtype,e)]}})})},r.prototype.bufferSync=function(){return qh.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return _t(this,void 0,void 0,function(){var e;return Dt(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Pz(this.shape,e,this.dtype==="complex64")]}})})},r.prototype.arraySync=function(){return Pz(this.shape,this.dataSync(),this.dtype==="complex64")},r.prototype.data=function(){return _t(this,void 0,void 0,function(){var e,t;return Dt(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=Li().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(a){return Kz(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}})})},r.prototype.dataToGPU=function(e){return this.throwIfDisposed(),Li().readToGPU(this.dataId,e)},r.prototype.dataSync=function(){this.throwIfDisposed();var e=Li().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return Kz(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},r.prototype.bytes=function(){return _t(this,void 0,void 0,function(){var e;return Dt(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,Li().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Li().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!1,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.print=function(e){return e===void 0&&(e=!1),qh.print(this,e)},r.prototype.clone=function(){return this.throwIfDisposed(),qh.clone(this)},r.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return QOe(t,this.shape,this.dtype,e)},r.prototype.cast=function(e){return this.throwIfDisposed(),qh.cast(this,e)},r.prototype.variable=function(e,t,n){return e===void 0&&(e=!0),this.throwIfDisposed(),Li().makeVariable(this,e,t,n)},r}();Object.defineProperty(ma,Symbol.hasInstance,{value:function(r){return!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null}});function D$(){return zk("Tensor",function(){return ma})}D$();var kk=function(r){u$(e,r);function e(t,n,a,i){var o=r.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=n,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(t.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!qu(t.shape,this.shape))throw new Error("shape of the new value (".concat(t.shape,") and ")+"previous value (".concat(this.shape,") must match"));Li().disposeTensor(this),this.dataId=t.dataId,Li().incRef(this,null)},e.prototype.dispose=function(){Li().disposeVariable(this),this.isDisposedInternal=!0},e}(ma);Object.defineProperty(kk,Symbol.hasInstance,{value:function(r){return r instanceof ma&&r.assign!=null&&r.assign instanceof Function}});var Yz;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(Yz||(Yz={}));var Sk;(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(Sk||(Sk={}));var Nk;(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(Nk||(Nk={}));var Tk;(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(Tk||(Tk={}));var Ek;(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(Ek||(Ek={}));var rPe={float32:Tk,int32:Sk,bool:Nk,complex64:Ek};function nPe(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error("Can not upcast ".concat(r," with ").concat(e))}return rPe[r][e]}function _$(r){return r!=null&&typeof r=="object"&&"texture"in r&&r.texture instanceof WebGLTexture}function F$(r){return typeof GPUBuffer<"u"&&r!=null&&typeof r=="object"&&"buffer"in r&&r.buffer instanceof GPUBuffer}function Mr(r,e){if(r.dtype===e.dtype)return[r,e];var t=nPe(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function aPe(r,e){G(r.dtype===e.dtype,function(){return"The dtypes of the first(".concat(r.dtype,") and")+" second(".concat(e.dtype,") input must match")})}function R$(r){var e=[],t=new Set;return O$(r,e,t),e}function O$(r,e,t){if(r!=null){if(r instanceof ma){e.push(r);return}if(!!iPe(r)){var n=r;for(var a in n){var i=n[a];t.has(i)||(t.add(i),O$(i,e,t))}}}}function iPe(r){return Array.isArray(r)||typeof r=="object"}function ok(r){return r.kernelName!=null}var Jz=function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return r.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},r}(),Uk=function(){function r(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Jz}return r.prototype.ready=function(){return _t(this,void 0,void 0,function(){var e,t,n,a;return Dt(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(n)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,n=e.asyncInit;if(n)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!1,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},r.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},r.prototype.registerBackend=function(e,t,n){return n===void 0&&(n=1),e in this.registryFactory?(Bh("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},r.prototype.setBackend=function(e){return _t(this,void 0,void 0,function(){var t,n,a,i,o;return Dt(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '".concat(e,"' not found in registry"));return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,a=t.asyncInit,a?[4,n]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=n,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new KOe(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var e=this,t=Wz(this.backendName);t.forEach(function(n){n.setupFunc!=null&&n.setupFunc(e.backendInstance)})},r.prototype.disposeRegisteredKernels=function(e){var t=this,n=Wz(e);n.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},r.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(n==null)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var a=n.factory();if(a&&!(a instanceof O3e)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,Bh("Initialization of backend ".concat(e," failed")),Bh(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return Bh("Initialization of backend ".concat(e," failed")),Bh(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],a=this.initializeBackend(n),i=a.success,o=a.asyncInit;if(o||i)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),a=n.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(e,t){var n=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return n.startScope(a)},function(){return n.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},r.prototype.scopedRun=function(e,t,n){e();try{var a=n();return t(),a}catch(i){throw t(),i}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(e){var t=Q.runKernel(b$,{x:e}),n={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},c={dtype:s};return Q.runKernel(y$,u,c)}}},i=[];return this.addTapeNode(this.state.activeScope.name,n,[t],a,i,{}),t},r.prototype.runKernel=function(e,t,n){this.backendName==null&&this.backend;var a=zz(e,this.backendName)!=null;if(!a)throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(e,t,n){var a=this.backend.numDataIds(),i=0;n.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(s," data ids) after running '").concat(e,"'"))},r.prototype.runKernelFunc=function(e){var t=this,n,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var c,l=ok(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(ok(e)){var f=e.kernelName,h=e.inputs,p=e.attrs;this.backendName==null&&this.backend;var d=zz(f,this.backendName);G(d!=null,function(){return"Cannot find registered kernel '".concat(f,"' for backend '").concat(t.backendName,"'")}),u=function(){var x=t.backend.numDataIds();c=d.kernelFunc({inputs:h,attrs:p,backend:t.backend});var S=Array.isArray(c)?c:[c];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,x,S);var T=S.map(function(C){return C.rank!=null?C:t.makeTensorFromTensorInfo(C)});if(i){var E=t.getTensorsForGradient(f,h,T);a=t.saveTensorsForBackwardMode(E)}return T}}else{var m=e.forwardFunc,v=function(x){!i||(a=x.map(function(S){return t.keep(t.clone(S))}))};u=function(){var x=t.backend.numDataIds();c=t.tidy(function(){return m(t.backend,v)});var S=Array.isArray(c)?c:[c];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(l,x,S),S}}var g=e.inputs,y=e.attrs,w=ok(e)?null:e.backwardsFunc,b;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?n=u():(b=t.profiler.profileKernel(l,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(b),n=b.outputs)}),i&&this.addTapeNode(l,g,n,w,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(x){return g[x]!=null?g[x].shape:null}),outputShapes:n.map(function(x){return x.shape}),kernelTimeMs:b.timeMs,extraInfo:b.extraInfo}),Array.isArray(c)?n:n[0]},r.prototype.saveTensorsForBackwardMode=function(e){var t=this,n=e.map(function(a){return t.keep(t.clone(a))});return n},r.prototype.getTensorsForGradient=function(e,t,n){var a=$z(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(G(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(c){return t[c]})):s=i.map(function(c){return t[c]});var u=n.filter(function(c,l){return o[l]});return s.concat(u)}return[]},r.prototype.makeTensor=function(e,t,n,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",a=a||this.backend;var i=e;n==="string"&&Mk(e[0])&&(i=e.map(function(l){return jOe(l)}));var o=a.write(i,t,n),s=new ma(t,n,o,this.nextTensorId());if(this.trackTensor(s,a),n==="string"){var u=this.state.tensorInfo.get(o),c=z3e(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},r.prototype.makeTensorFromDataId=function(e,t,n,a){n=n||"float32";var i={dataId:e,shape:t,dtype:n};return this.makeTensorFromTensorInfo(i,a)},r.prototype.makeTensorFromTensorInfo=function(e,t){var n=e.dataId,a=e.shape,i=e.dtype,o=new ma(a,i,n,this.nextTensorId());return this.trackTensor(o,t),o},r.prototype.makeVariable=function(e,t,n,a){t===void 0&&(t=!0),n=n||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new kk(e,t,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name ".concat(i.name," was already registered"));return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},r.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*bk(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof kk||this.track(e)},r.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},r.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},r.prototype.disposeTensor=function(e){if(!!this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var n=e.size*bk(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},r.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},r.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},r.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},r.prototype.profile=function(e){return _t(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h;return Dt(this,function(p){switch(p.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=p.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,Lt([],we(this.state.activeProfile.kernels.map(function(d){return d.totalBytesSnapshot})),!1)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,p.label=2;case 2:p.trys.push([2,8,9,10]),i=Qr(this.state.activeProfile.kernels),o=i.next(),p.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=p.sent(),c=s,[4,s.extraInfo];case 5:c.extraInfo=p.sent(),p.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return l=p.sent(),f={error:l},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(e,t,n,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},c=$z(e);c!=null&&(a=c.gradFunc),a!=null&&(u.gradient=function(l){return l=l.map(function(f,h){if(f==null){var p=n[h],d=Lk(p.size,p.dtype);return s.makeTensor(d,p.shape,p.dtype)}return f}),a(l.length>1?l:l[0],i,o)}),this.state.activeTape.push(u)},r.prototype.keep=function(e){return e.kept=!0,e},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(e){for(var t=this,n=R$(e),a=new Set(n.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},r.prototype.gradients=function(e,t,n,a){var i=this;if(a===void 0&&(a=!1),G(t.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});G(o instanceof ma,function(){return"The result y returned by f() must be a tensor."});var s=JOe(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=n??oPe(o.shape),ZOe(u,s,function(l){return i.tidy(l)},uPe);var c=t.map(function(l){return u[l.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(l){var f,h;try{for(var p=Qr(l.saved),d=p.next();!d.done;d=p.next()){var m=d.value;m.dispose()}}catch(v){f={error:v}}finally{try{d&&!d.done&&(h=p.return)&&h.call(p)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:c}})},r.prototype.customGrad=function(e){var t=this;return G(Oz(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];G(n.every(function(c){return c instanceof ma}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};n.forEach(function(c,l){o[l]=c});var s=function(c,l){return i=e.apply(void 0,Lt([],we(Lt(Lt([],we(n),!1),[l],!1)),!1)),G(i.value instanceof ma,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),G(Oz(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(c,l){var f=i.gradFunc(c,l),h=Array.isArray(f)?f:[f];G(h.length===n.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),G(h.every(function(d){return d instanceof ma}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return h.forEach(function(d,m){p[m]=function(){return d}}),p};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},r.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},r.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},r.prototype.readToGPU=function(e,t){var n=this.state.tensorInfo.get(e);return n.backend.readToGPU(e,t)},r.prototype.time=function(e){return _t(this,void 0,void 0,function(){var t,n;return Dt(this,function(a){switch(a.label){case 0:return t=$m(),[4,this.backend.time(e)];case 1:return n=a.sent(),n.wallMs=$m()-t,[2,n]}})})},r.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!1,configurable:!0}),r.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Jz;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r}();Uk.nextTensorId=0;Uk.nextVariableId=0;function oPe(r){var e=d$(un(r),"float32");return Q.makeTensor(e,r,"float32")}function sPe(){var r=m$();if(r._tfengine==null){var e=new U3e(r);r._tfengine=new Uk(e)}return j3e(r._tfengine.ENV),tPe(function(){return r._tfengine}),r._tfengine}var Q=sPe();function uPe(r,e){var t={a:r,b:e};return Q.runKernel(g$,t)}function Is(r,e){var t=r;if(qi(r))return e==="string"?[]:[r.length];if(_$(r)){var n=r.channels||"RGBA";return[r.height,r.width*n.length]}else if(F$(r))return[r.buffer.size/(e==null?4:bk(e))];if(!Array.isArray(r))return[];for(var a=[];Array.isArray(t)||qi(t)&&e!=="string";)a.push(t.length),t=t[0];return Array.isArray(r)&&jn().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&P$(r,a,[]),a}function P$(r,e,t){if(t=t||[],!Array.isArray(r)&&!qi(r)){G(e.length===0,function(){return"Element arr[".concat(t.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(e[0]," elements")});return}G(e.length>0,function(){return"Element arr[".concat(t.join("]["),"] should be a primitive, ")+"but is an array of ".concat(r.length," elements")}),G(r.length===e[0],function(){return"Element arr[".concat(t.join("]["),"] should have ").concat(e[0]," ")+"elements, but has ".concat(r.length," elements")});for(var n=e.slice(1),a=0;a<r.length;++a)P$(r[a],n,t.concat(a))}function Zz(r,e,t,n){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==e||r==="numeric"&&e==="string")throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must ")+"be ".concat(r," tensor, but got ").concat(e," tensor"))}}function B(r,e,t,n){if(n===void 0&&(n="numeric"),r instanceof D$())return Zz(n,r.dtype,e,t),r;var a=Zm(r);if(a!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(a=n),Zz(n,a,e,t),r==null||!qi(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var i=r==null?"null":r.constructor.name;throw new Error("Argument '".concat(e,"' passed to '").concat(t,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=Is(r,a);!qi(r)&&!Array.isArray(r)&&(r=[r]);var s=!0,u=a!=="string"?C$(r,a):Hh(r,[],s);return Q.makeTensor(u,o,a)}function Wm(r,e,t,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument ".concat(e," passed to ").concat(t," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=r;return a.map(function(i,o){return B(i,"".concat(e,"[").concat(o,"]"),t,n)})}var M$="__op";function K(r){var e=Object.keys(r);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(e.length," keys."));var t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+M$;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];Q.startScope(t);try{var s=n.apply(void 0,Lt([],we(i),!1));return qk(s)&&console.error("Cannot return a Promise inside of tidy."),Q.endScope(s),s}catch(u){throw Q.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function cPe(r){var e=B(r,"x","abs");if(e.dtype==="complex64"){var t={x:e};return Q.runKernel(yFe,t)}else{var t={x:e};return Q.runKernel(X3e,t)}}var ui=K({abs_:cPe});function lPe(r){var e=B(r,"x","acos"),t={x:e};return Q.runKernel(Y3e,t)}var fPe=K({acos_:lPe});function hPe(r){var e=B(r,"x","acosh"),t={x:e};return Q.runKernel(J3e,t)}var pPe=K({acosh_:hPe});function dPe(r,e){var t,n=B(r,"a","add"),a=B(e,"b","add");t=we(Mr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(g$,i)}var cn=K({add_:dPe});function vPe(r){G(Array.isArray(r),function(){return"The argument passed to tf.addN() must be a list of tensors"}),G(r.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+"".concat(r.length)});var e=r.map(function(a,i){return B(a,"tensors".concat(i),"addN")}),t=e[0];e.forEach(function(a){if(a.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(a){if(!qu(a.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var n=e;return Q.runKernel(Z3e,n)}var mPe=K({addN_:vPe});function gPe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=B(r,"x","all","bool"),a={x:n},i={axis:e,keepDims:t};return Q.runKernel(Q3e,a,i)}var yPe=K({all_:gPe});function bPe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=B(r,"x","any","bool"),a={x:n},i={axis:e,keepDims:t};return Q.runKernel(eFe,a,i)}var wPe=K({any_:bPe});function xPe(r,e){e===void 0&&(e=0);var t=B(r,"x","argMax"),n={x:t},a={axis:e};return Q.runKernel(tFe,n,a)}var kPe=K({argMax_:xPe});function SPe(r,e){e===void 0&&(e=0);var t=B(r,"x","argMin"),n={x:t},a={axis:e};return Q.runKernel(rFe,n,a)}var NPe=K({argMin_:SPe});function TPe(r){var e=B(r,"x","asin"),t={x:e};return Q.runKernel(nFe,t)}var EPe=K({asin_:TPe});function IPe(r){var e=B(r,"x","asinh"),t={x:e};return Q.runKernel(aFe,t)}var CPe=K({asinh_:IPe});function APe(r){var e=B(r,"x","atan"),t={x:e};return Q.runKernel(iFe,t)}var DPe=K({atan_:APe});function _Pe(r,e){var t,n=B(r,"a","atan2"),a=B(e,"b","atan2");t=we(Mr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(sFe,i)}var FPe=K({atan2_:_Pe});function RPe(r){var e=B(r,"x","atanh"),t={x:e};return Q.runKernel(oFe,t)}var OPe=K({atanh_:RPe});function PPe(r,e){var t=B(r,"x","cast");if(!q3e(e))throw new Error("Failed to cast to unknown dtype ".concat(e));if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var n={x:t},a={dtype:e};return Q.runKernel(y$,n,a)}var en=K({cast_:PPe});function MPe(r,e,t,n,a,i,o){o===void 0&&(o="channelsLast");var s=we(jh(e),2),u=s[0],c=s[1],l;if(o==="channelsLast")l=[u,c,r[3],r[3]];else if(o==="channelsFirst")l=[u,c,r[1],r[1]];else throw new Error("Unknown dataFormat ".concat(o));return Vk(r,l,t,n,a,i,!1,o)}function Vk(r,e,t,n,a,i,o,s){var u,c;o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var l=we([-1,-1,-1,-1],4),f=l[0],h=l[1],p=l[2],d=l[3];if(s==="channelsLast")u=we(r,4),f=u[0],h=u[1],p=u[2],d=u[3];else if(s==="channelsFirst")c=we(r,4),f=c[0],d=c[1],h=c[2],p=c[3];else throw new Error("Unknown dataFormat ".concat(s));var m=we(e,4),v=m[0],g=m[1],y=m[3],w=we(jh(t),2),b=w[0],x=w[1],S=we(jh(n),2),T=S[0],E=S[1],C=Ik(v,T),R=Ik(g,E),_=qPe(a,h,p,b,x,C,R,i,s),M=_.padInfo,$=_.outHeight,z=_.outWidth,q=o?y*d:y,L;return s==="channelsFirst"?L=[f,q,$,z]:s==="channelsLast"&&(L=[f,$,z,q]),{batchSize:f,dataFormat:s,inHeight:h,inWidth:p,inChannels:d,outHeight:$,outWidth:z,outChannels:q,padInfo:M,strideHeight:b,strideWidth:x,filterHeight:v,filterWidth:g,effectiveFilterHeight:C,effectiveFilterWidth:R,dilationHeight:T,dilationWidth:E,inShape:r,outShape:L,filterShape:e}}function BPe(r,e,t,n,a){n==null&&(n=LPe(r,e,t));var i=r[0],o=r[1],s=Um((i-e+2*n)/t+1,a),u=Um((o-e+2*n)/t+1,a);return[s,u]}function LPe(r,e,t,n){n===void 0&&(n=1);var a=Ik(e,n);return Math.floor((r[0]*(t-1)-t+a)/2)}function jh(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function Ik(r,e){return e<=1?r:r+(r-1)*(e-1)}function qPe(r,e,t,n,a,i,o,s,u){var c,l,f;if(typeof r=="number"){var h=r===0?"VALID":"NUMBER";c={top:r,bottom:r,left:r,right:r,type:h};var p=BPe([e,t],i,n,r,s);l=p[0],f=p[1]}else if(r==="same"){l=Math.ceil(e/n),f=Math.ceil(t/a);var d=Math.max(0,(l-1)*n+i-e),m=Math.max(0,(f-1)*a+o-t),v=Math.floor(d/2),g=d-v,y=Math.floor(m/2),w=m-y;c={top:v,bottom:g,left:y,right:w,type:"SAME"}}else if(r==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-i+1)/n),f=Math.ceil((t-o+1)/a);else if(typeof r=="object"){var v=u==="channelsLast"?r[1][0]:r[2][0],g=u==="channelsLast"?r[1][1]:r[2][1],y=u==="channelsLast"?r[2][0]:r[3][0],w=u==="channelsLast"?r[2][1]:r[3][1],h=v===0&&g===0&&y===0&&w===0?"VALID":"EXPLICIT";c={top:v,bottom:g,left:y,right:w,type:h},l=Um((e-i+v+g)/n+1,s),f=Um((t-o+y+w)/a+1,s)}else throw Error("Unknown padding parameter: ".concat(r));return{padInfo:c,outHeight:l,outWidth:f}}function Um(r,e){if(!e)return Math.trunc(r);switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode ".concat(e))}}function Vm(r){var e=we(jh(r),3),t=e[0],n=e[1],a=e[2];return t===1&&n===1&&a===1}function Cs(r,e){return Vm(r)||Vm(e)}function pl(r){return jh(r).every(function(e){return e>0})}function $i(r,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,"."));if(typeof e=="number")G(Gh(e),function(){return"Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,".")});else if(typeof e=="object")e.forEach(function(n){n.forEach(function(a){G(Gh(a),function(){return"Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(a,".")})})});else throw Error("Error in ".concat(r,": Unknown padding parameter: ").concat(e))}}function zPe(r,e){var t=B(r,"x","reshape","string_or_numeric"),n={x:t},a={shape:e};return Q.runKernel(jRe,n,a)}var ge=K({reshape_:zPe});function $Pe(r,e,t,n,a){var i=B(r,"x","avgPool","float32"),o=1;G(Cs(t,o),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")});var s=i,u=!1;i.rank===3&&(u=!0,s=ge(i,[1,i.shape[0],i.shape[1],i.shape[2]])),G(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(s.rank,".")}),$i("avgPool",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=Q.runKernel(uFe,c,l);return f=en(f,i.dtype),u?ge(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var B$=K({avgPool_:$Pe});function WPe(r,e,t,n,a,i){i===void 0&&(i="NDHWC");var o=B(r,"x","avgPool3d","float32"),s=o,u=!1;o.rank===4&&(u=!0,s=ge(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),G(s.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),G(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),G(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,function(){return"Error in avgPool3d: Stride must be > 0, but got '".concat(t,"'")}),$i("avgPool3d",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=Q.runKernel(cFe,c,l);return f=en(f,s.dtype),u?ge(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var UPe=K({avgPool3d_:WPe});function VPe(r){var e=B(r,"x","clone","string_or_numeric"),t={x:e};return Q.runKernel(b$,t)}var ul=K({clone_:VPe});function GPe(r,e){e===void 0&&(e=0),G(r.length>=1,function(){return"Pass at least one tensor to concat"});var t=Wm(r,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `.concat(i.dtype,". "))}),t.length===1)return ul(t[0]);var n=t,a={axis:e};return Q.runKernel(bFe,n,a)}var ya=K({concat_:GPe});function HPe(r,e,t,n){var a;t===void 0&&(t=!1),n===void 0&&(n=!1);var i=B(r,"a","matMul"),o=B(e,"b","matMul");a=we(Mr(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:n};return Q.runKernel(lFe,s,u)}var Gt=K({matMul_:HPe});function jPe(r,e){var t,n=B(r,"a","mul"),a=B(e,"b","mul");t=we(Mr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(IRe,i)}var kt=K({mul_:jPe});function KPe(r){var e=B(r,"x","sigmoid","float32"),t={x:e};return Q.runKernel(cOe,t)}var cl=K({sigmoid_:KPe});function XPe(r,e,t){var n=B(r,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");var a={x:n},i={begin:e,size:t};return Q.runKernel(iOe,a,i)}var xr=K({slice_:XPe});function YPe(r){var e=B(r,"x","tanh","float32"),t={x:e};return Q.runKernel(AOe,t)}var Ck=K({tanh_:YPe});function JPe(r,e,t,n,a,i){var o=B(r,"forgetBias","basicLSTMCell"),s=B(e,"lstmKernel","basicLSTMCell"),u=B(t,"lstmBias","basicLSTMCell"),c=B(n,"data","basicLSTMCell"),l=B(a,"c","basicLSTMCell"),f=B(i,"h","basicLSTMCell"),h=ya([c,f],1),p=Gt(h,s),d=cn(p,u),m=d.shape[0],v=d.shape[1]/4,g=[m,v],y=xr(d,[0,0],g),w=xr(d,[0,v],g),b=xr(d,[0,v*2],g),x=xr(d,[0,v*3],g),S=cn(kt(cl(y),Ck(w)),kt(l,cl(cn(o,b)))),T=kt(Ck(S),cl(x));return[S,T]}var ZPe=K({basicLSTMCell_:JPe});function QPe(r,e,t){var n=B(r,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});G(n.rank>=1+e.length,function(){return"input rank is ".concat(n.rank," but should be > than blockShape.length ").concat(e.length)}),G(t.length===e.length,function(){return"crops.length is ".concat(t.length," but should be equal to blockShape.length  ").concat(e.length)}),G(n.shape[0]%a===0,function(){return"input tensor batch is ".concat(n.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(e.join(" * ")," === ").concat(a)});var i={x:n},o={blockShape:e,crops:t};return Q.runKernel(fFe,i,o)}var L$=K({batchToSpaceND_:QPe});function eMe(r){var e;return r.rank===0||r.rank===1?e=ge(r,[1,1,1,r.size]):r.rank===2?e=ge(r,[1,1,r.shape[0],r.shape[1]]):r.rank===3?e=ge(r,[1,r.shape[0],r.shape[1],r.shape[2]]):e=r,e}function tMe(r,e,t,n,a,i){i==null&&(i=.001);var o=B(r,"x","batchNorm"),s=B(e,"mean","batchNorm"),u=B(t,"variance","batchNorm"),c;a!=null&&(c=B(a,"scale","batchNorm"));var l;n!=null&&(l=B(n,"offset","batchNorm")),G(s.rank===u.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),G(l==null||s.rank===l.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),G(c==null||s.rank===c.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var f=eMe(o),h={x:f,scale:c,offset:l,mean:s,variance:u},p={varianceEpsilon:i},d=Q.runKernel(YFe,h,p);return ge(d,o.shape)}var Qm=K({batchNorm_:tMe});function rMe(r,e,t,n,a,i){var o=B(r,"x","batchNorm"),s=B(e,"mean","batchNorm"),u=B(t,"variance","batchNorm"),c;a!=null&&(c=B(a,"scale","batchNorm"));var l;return n!=null&&(l=B(n,"offset","batchNorm")),G(o.rank===2,function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(o.rank,".")}),G(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(s.rank,".")}),G(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&G(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&G(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(l.rank,".")}),Qm(o,s,u,l,c,i)}var nMe=K({batchNorm2d_:rMe});function aMe(r,e,t,n,a,i){var o=B(r,"x","batchNorm"),s=B(e,"mean","batchNorm"),u=B(t,"variance","batchNorm"),c;a!=null&&(c=B(a,"scale","batchNorm"));var l;return n!=null&&(l=B(n,"offset","batchNorm")),G(o.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(o.rank,".")}),G(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(s.rank,".")}),G(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&G(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&G(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(l.rank,".")}),Qm(o,s,u,l,c,i)}var iMe=K({batchNorm3d_:aMe});function oMe(r,e,t,n,a,i){var o=B(r,"x","batchNorm"),s=B(e,"mean","batchNorm"),u=B(t,"variance","batchNorm"),c;a!=null&&(c=B(a,"scale","batchNorm"));var l;return n!=null&&(l=B(n,"offset","batchNorm")),G(o.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(o.rank,".")}),G(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(s.rank,".")}),G(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&G(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&G(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(l.rank,".")}),Qm(o,s,u,l,c,i)}var sMe=K({batchNorm4d_:oMe});function uMe(r,e,t){var n=B(r,"x","bincount"),a=B(e,"weights","bincount");G(n.dtype==="int32",function(){return"Error in bincount: input "+"dtype must be int32, but got ".concat(n.dtype)}),G(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),G(a.size===n.size||a.size===0,function(){return"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(n.shape,", weights shape: ")+"".concat(a.shape,".")});var i={x:n,weights:a},o={size:t};return Q.runKernel(hFe,i,o)}var q$=K({bincount_:uMe});function cMe(r,e){var t=B(r,"x","bitwiseAnd"),n=B(e,"y","bitwiseAnd");if(!qu(t.shape,n.shape))throw new Error("BitwiseAnd: Tensors must have the same shape. x: ".concat(t.shape,", y: ").concat(n.shape));if(t.dtype!=="int32"||n.dtype!=="int32")throw new Error("BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ".concat(t.dtype," and type of y: ").concat(n.dtype));var a={a:t,b:n};return Q.runKernel(pFe,a)}var lMe=K({bitwiseAnd_:cMe});function fMe(r,e){var t=B(r,"s0","broadcastArgs","int32"),n=B(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error("broadcastArgs(): first input must be a vector (rank=1). "+"Has rank ".concat(t.rank));if(n.rank!==1)throw new Error("broadcastArgs(): second input must be a vector (rank=1). "+"Has rank ".concat(n.rank));var a={s0:t,s1:n};return Q.runKernel(dFe,a)}var hMe=K({broadcastArgs_:fMe});function pMe(r,e){var t=B(r,"broadcastTo","x"),n=t.shape;if(Pa(e),e.length<t.rank)throw new Error("broadcastTo(): shape.length=".concat(e.length," < input.rank=").concat(t.rank,"."));if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=ge(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): [".concat(n,"] cannot be broadcast to [").concat(e,"]."));var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return ul(t);var c={x:t},l={reps:o};return Q.runKernel(w$,c,l)}var Lm=K({broadcastTo_:pMe});function Ts(r,e,t){return e===void 0&&(e="float32"),e=e||"float32",Pa(r),new xk(r,e,t)}function dMe(r){var e=B(r,"x","ceil","float32"),t={x:e};return Q.runKernel(vFe,t)}var vMe=K({ceil_:dMe});function eg(r,e,t){Pa(r),t=t||Zm(e);var n={shape:r,value:e,dtype:t};return Q.runKernel(HFe,{},n)}function mMe(r,e,t){var n=B(r,"x","clipByValue");if(G(e<=t,function(){return"Error in clip: min (".concat(e,") must be ")+"less than or equal to max (".concat(t,").")}),e===t)return eg(n.shape,e,n.dtype);var a={x:n},i={clipValueMin:e,clipValueMax:t};return Q.runKernel(mFe,a,i)}var gMe=K({clipByValue_:mMe});function yMe(r,e){var t=B(r,"real","complex"),n=B(e,"imag","complex");di(t.shape,n.shape,"real and imag shapes, ".concat(t.shape," and ").concat(n.shape,", ")+"must match in call to tf.complex().");var a={real:t,imag:n};return Q.runKernel(gFe,a)}var Es=K({complex_:yMe});function bMe(r){return ya(r,0)}var wMe=K({concat1d_:bMe});function xMe(r,e){return ya(r,e)}var kMe=K({concat2d_:xMe});function SMe(r,e){return ya(r,e)}var NMe=K({concat3d_:SMe});function TMe(r,e){return ya(r,e)}var EMe=K({concat4d_:TMe});function IMe(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=B(r,"x","conv2d","float32"),u=B(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),G(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")}),G(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")}),$i("conv2d",n,o);var f=a==="NHWC"?c.shape[3]:c.shape[1];G(f===u.shape[2],function(){return"Error in conv2d: depth of input (".concat(f,") must match ")+"input depth for filter ".concat(u.shape[2],".")}),G(Cs(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),G(pl(i),function(){return"Error in conv2D: Dilated rates should be larger than 0."}),G(pl(t),function(){return"Error in conv2D: Strides should be larger than 0."});var h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=Q.runKernel(wFe,h,p);return l?ge(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var tg=K({conv2d_:IMe});function CMe(r,e,t,n,a,i,o){a===void 0&&(a="NWC"),i===void 0&&(i=1);var s=B(r,"x","conv1d"),u=B(e,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=ge(s,[1,s.shape[0],s.shape[1]])),G(c.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")}),G(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+"".concat(u.rank,".")}),$i("conv1d",n,o),G(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match ")+"input depth for filter ".concat(u.shape[1],".")}),G(Cs(t,i),function(){return"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(t," and dilation '").concat(i,"'")}),G(pl(i),function(){return"Error in conv1D: Dilated rates should be larger than 0."}),G(pl(t),function(){return"Error in conv1D: Stride should be larger than 0."}),G(a==="NWC",function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")});var f=ge(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=ge(c,[c.shape[0],1,c.shape[1],c.shape[2]]),p=[1,t],d=[1,i],m="NHWC",v=tg(h,f,p,n,m,d,o);return l?ge(v,[v.shape[2],v.shape[3]]):ge(v,[v.shape[0],v.shape[2],v.shape[3]])}var AMe=K({conv1d_:CMe});function DMe(r,e,t,n,a,i,o){i===void 0&&(i="NHWC"),G(r.length===e.rank,function(){return"Length of inShape "+"(".concat(r.length,") and rank of dy (").concat(e.rank,") must match")});var s=r,u=e,c=!1;e.rank===3&&(c=!0,u=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,r[0],r[1],r[2]]),G(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")}),G(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)}),G(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(t.rank)});var l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];G(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(t.shape[2],".")}),G(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output (".concat(f,") must ")+"match output depth for filter ".concat(t.shape[3],".")}),$i("conv2dDerInput",a,o);var h={dy:u,filter:t},p={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=Q.runKernel(kFe,h,p);return c?ge(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var z$=K({conv2DBackpropInput_:DMe});function _Me(r,e,t,n,a,i){var o=B(r,"x","conv2dTranspose"),s=B(e,"filter","conv2dTranspose");return z$(t,o,s,n,a,"NHWC",i)}var FMe=K({conv2dTranspose_:_Me});function RMe(r,e,t,n,a,i){a===void 0&&(a="NDHWC"),i===void 0&&(i=[1,1,1]);var o=B(r,"x","conv3d"),s=B(e,"filter","conv3d"),u=o,c=!1;o.rank===4&&(c=!0,u=ge(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),G(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")}),G(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+"".concat(s.rank,".")}),G(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match ")+"input depth for filter ".concat(s.shape[3],".")}),G(Cs(t,i),function(){return"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),G(a==="NDHWC",function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")}),G(pl(i),function(){return"Error in conv3D: Dilated rates should be larger than 0."}),G(pl(t),function(){return"Error in conv3D: Strides should be larger than 0."});var l={x:u,filter:s},f={strides:t,pad:n,dataFormat:a,dilations:i},h=Q.runKernel(SFe,l,f);return c?ge(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var OMe=K({conv3d_:RMe});function PMe(r,e,t,n,a){G(r.length===e.rank,function(){return"Length of inShape "+"(".concat(r.length,") and rank of dy (").concat(e.rank,") must match")});var i=r,o=e,s=!1;e.rank===4&&(s=!0,o=ge(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,r[0],r[1],r[2],r[3]]);var u=i[4],c=o.shape[4];G(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")}),G(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)}),G(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(t.rank)}),G(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(t.shape[3],".")}),G(c===t.shape[4],function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(t.shape[4],".")});var l={dy:o,filter:t},f={pad:a,strides:n,inputShape:i},h=Q.runKernel(NFe,l,f);return s?ge(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var MMe=K({conv3DBackpropInput_:PMe});function BMe(r,e,t,n,a){var i=B(r,"x","conv3dTranspose"),o=B(e,"filter","conv3dTranspose");return MMe(t,i,o,n,a)}var LMe=K({conv3dTranspose_:BMe});function qMe(r){var e=B(r,"x","cos","float32"),t={x:e};return Q.runKernel(TFe,t)}var zMe=K({cos_:qMe});function $Me(r){var e=B(r,"x","cosh","float32"),t={x:e};return Q.runKernel(EFe,t)}var WMe=K({cosh_:$Me});function UMe(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=B(r,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:n};return Q.runKernel(IFe,i,o)}var VMe=K({cumprod_:UMe});function GMe(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=B(r,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:n};return Q.runKernel(CFe,i,o)}var HMe=K({cumsum_:GMe});function jMe(r,e,t,n){n===void 0&&(n=!1);var a=B(r,"x","denseBincount"),i=B(e,"weights","denseBincount");G(a.dtype==="int32",function(){return"Error in denseBincount: input "+"dtype must be int32, but got ".concat(a.dtype)}),G(a.rank<=2,function(){return"Error in denseBincount: input must be at most rank 2, but got "+"rank ".concat(a.rank,".")}),G(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),G(i.size===a.size||i.size===0,function(){return"Error in denseBincount: weights must have the same shape as x or "+"0-length, but got x shape: ".concat(a.shape,", weights shape: ")+"".concat(i.shape,".")});var o={x:a,weights:i},s={size:t,binaryOutput:n};return Q.runKernel(DFe,o,s)}var KMe=K({denseBincount_:jMe});function XMe(r,e,t){t===void 0&&(t="NHWC");var n=B(r,"x","depthToSpace","float32"),a=t==="NHWC"?n.shape[1]:n.shape[2],i=t==="NHWC"?n.shape[2]:n.shape[3],o=t==="NHWC"?n.shape[3]:n.shape[1];G(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(e)}),G(a*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(a," and ").concat(e,`  for depthToSpace with input shape
    `).concat(n.shape)}),G(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(i," and ").concat(e,` for depthToSpace with input shape
        `).concat(n.shape)}),G(o%(e*e)===0,function(){return"Dimension size must be evenly divisible by ".concat(e*e," but is ").concat(o," for depthToSpace with input shape ").concat(n.shape)});var s={x:n},u={blockSize:e,dataFormat:t};return Q.runKernel(_Fe,s,u)}var YMe=K({depthToSpace_:XMe});function JMe(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=B(r,"x","depthwiseConv2d","float32"),u=B(e,"filter","depthwiseConv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),G(c.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(c.rank,".")}),G(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")});var f=a==="NHWC"?c.shape[3]:c.shape[1];G(f===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels "+"(".concat(f,") must match the inChannels dimension in ")+"filter ".concat(u.shape[2],".")}),$i("depthwiseConv2d",n,o);var h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=Q.runKernel(FFe,h,p);return l?ge(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Gk=K({depthwiseConv2d_:JMe});function ZMe(r){var e=B(r,"x","diag"),t={x:e};return Q.runKernel(PFe,t)}var QMe=K({diag_:ZMe});function e4e(r,e,t,n,a,i){a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC");var o=B(r,"x","dilation2d"),s=B(e,"filter","dilation2d");G(o.rank===3||o.rank===4,function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(o.rank,".")}),G(s.rank===3,function(){return"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(s.rank,".")}),G(i==="NHWC",function(){return"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(i)});var u=o,c=!1;o.rank===3&&(u=ge(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),G(u.shape[3]===s.shape[2],function(){return"Error in dilation2d:  input and filter must have the same depth: ".concat(u.shape[3]," vs ").concat(s.shape[2])});var l={x:u,filter:s},f={strides:t,pad:n,dilations:a},h=Q.runKernel(MFe,l,f);return c?ge(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var t4e=K({dilation2d_:e4e});function r4e(r,e){var t,n=B(r,"a","floorDiv"),a=B(e,"b","floorDiv");t=we(Mr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(XFe,i)}var $$=K({floorDiv_:r4e});function n4e(r,e){var t,n=B(r,"a","div"),a=B(e,"b","div");if(t=we(Mr(n,a),2),n=t[0],a=t[1],n.dtype==="int32"&&a.dtype==="int32")return $$(n,a);var i={a:n,b:a},o={};return Q.runKernel(BFe,i,o)}var Rn=K({div_:n4e});function a4e(r,e){for(var t=[],n=0;n<e.length;n++){var a=r[r.length-n-1],i=e.length-n-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function ln(r,e){for(var t=Math.max(r.length,e.length),n=new Array(t),a=0;a<t;a++){var i=r[r.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)n[t-a-1]=o;else if(o===1)n[t-a-1]=i;else if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(r," and ").concat(e,".");throw Error(s)}else n[t-a-1]=i}return n}function i4e(r,e){var t,n=B(r,"a","equal","string_or_numeric"),a=B(e,"b","equal","string_or_numeric");t=we(Mr(n,a),2),n=t[0],a=t[1],ln(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel($Fe,i)}var W$=K({equal_:i4e});function o4e(r,e,t){var n=B(e,"a","where"),a=B(t,"b","where"),i=B(r,"condition","where","bool"),o=ln(ln(i.shape,n.shape),a.shape),s=Lm(i,o),u=Lm(n,o),c=Lm(a,o),l={condition:s,t:u,e:c};return Q.runKernel(nOe,l)}var Ns=K({where_:o4e});function s4e(r){var e=B(r,"x","zerosLike"),t={x:e};return Q.runKernel(POe,t)}var Hk=K({zerosLike_:s4e});function u4e(r,e){var t,n=B(r,"a","div"),a=B(e,"b","div");t=we(Mr(n,a),2),n=t[0],a=t[1];var i=Rn(n,a),o=Hk(i),s=W$(a,o);return Ns(s,o,i)}var c4e=K({divNoNan_:u4e});function l4e(r,e){var t=B(r,"t1","dot"),n=B(e,"t2","dot");G((t.rank===1||t.rank===2)&&(n.rank===1||n.rank===2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(t.rank," and ").concat(n.rank,".")});var a=t.rank===1?t.size:t.shape[1],i=n.rank===1?n.size:n.shape[0];if(G(a===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+"".concat(a," and ").concat(i,".")}),t.rank===1&&n.rank===1){var o=ge(t,[1,-1]),s=ge(n,[-1,1]),u=Gt(o,s);return ge(u,[])}else if(t.rank===1&&n.rank===2){var o=ge(t,[1,-1]),s=ge(n,[n.shape[0],n.shape[1]]),u=Gt(o,s);return ge(u,[u.size])}else if(t.rank===2&&n.rank===1){var s=ge(n,[-1,1]),u=Gt(t,s);return ge(u,[u.size])}else{var s=ge(n,[n.shape[0],n.shape[1]]),u=Gt(t,s);return u}}var f4e=K({dot_:l4e});function h4e(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var n=e.map(function(i,o){return B(i,"tensors".concat(o),"einsum")}),a={equation:r};return Q.runKernel(LFe,n,a)}var ol=K({einsum_:h4e});function p4e(r){var e=B(r,"x","elu","float32"),t={x:e};return Q.runKernel(qFe,t)}var U$=K({elu_:p4e});function d4e(r,e){var t=B(r,"x","ensureShape","string_or_numeric");if(!P3e(t.shape,e))throw new Error("EnsureShape: Shape of tensor ".concat(t.shape," is not compatible with expected shape ").concat(e));return r}var v4e=K({ensureShape_:d4e});function m4e(r){var e=B(r,"x","erf");G(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=en(e,"float32"));var t={x:e};return Q.runKernel(zFe,t)}var g4e=K({erf_:m4e});function y4e(r,e,t){for(var n=r.length+e.length,a=[],i=0,o=0,s=0;s<n;s++)t.indexOf(s)===-1?a.push(r[i++]):a.push(e[o++]);return a}function rg(r,e){var t=e.map(function(n){return 1});return y4e(r,t,e)}function b4e(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=B(r,"x","max"),a={x:n},i={reductionIndices:e,keepDims:t};return Q.runKernel(mRe,a,i)}var ll=K({max_:b4e});function w4e(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=B(r,"x","min"),a={x:n},i={axis:e,keepDims:t};return Q.runKernel(kRe,a,i)}var Ak=K({min_:w4e});function x4e(r,e){var t,n=B(r,"base","pow"),a=B(e,"exp","pow");t=we(Mr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(BRe,i)}var jk=K({pow_:x4e});function As(r,e,t,n){if(n==null)n=Zm(r);else if(n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(F$(r)||_$(r)){if(n!=="float32"&&n!=="int32")throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(n,"."));return Q.backend.createTensorFromGPUData(r,e||t,n)}if(!qi(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Pa(e);var a=un(e),i=un(t);G(a===i,function(){return"Based on the provided shape, [".concat(e,"], the tensor should have ")+"".concat(a," values but has ").concat(i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==un(e.slice(o)):!0;G(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(t,") does not match the provided ")+"shape (".concat(e,"). ")})}}return!qi(r)&&!Array.isArray(r)&&(r=[r]),e=e||t,r=n!=="string"?C$(r,n):Hh(r,[],!0),Q.makeTensor(r,e,n)}function zr(r,e){if((qi(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&qi(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],n=[];return As(r,t,n,e)}function k4e(r){var e=B(r,"x","sqrt","float32"),t={x:e};return Q.runKernel(fOe,t)}var Dk=K({sqrt_:k4e});function S4e(r){var e=B(r,"x","square"),t={};return Q.runKernel("Square",{x:e},t)}var ng=K({square_:S4e});function N4e(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=B(r,"x","sum");n.dtype==="bool"&&(n=en(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return Q.runKernel(hOe,a,i)}var ur=K({sum_:N4e});function T4e(r,e,t,n){e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1),r=B(r,"x","norm");var a=V$(r,e,t),i=a.shape;if(n){var o=Jm(t,r.shape);i=rg(a.shape,o)}return ge(a,i)}function V$(r,e,t){if(t===void 0&&(t=null),r.rank===0)return ui(r);if(r.rank!==1&&t===null)return V$(ge(r,[-1]),e,t);if(r.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return ur(ui(r),t);if(e===1/0)return ll(ui(r),t);if(e===-1/0)return Ak(ui(r),t);if(e==="euclidean"||e===2)return Dk(ur(jk(ui(r),zr(2,"int32")),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}if(Array.isArray(t)&&t.length===2){if(e===1)return ll(ur(ui(r),t[0]),t[1]-1);if(e===1/0)return ll(ur(ui(r),t[1]),t[0]);if(e===-1/0)return Ak(ur(ui(r),t[1]),t[0]);if(e==="fro"||e==="euclidean")return Dk(ur(ng(r),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}throw new Error("Error in norm: invalid axis: ".concat(t))}var ag=K({norm_:T4e});function E4e(r,e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),ag(r,"euclidean",e,t)}var I4e=K({euclideanNorm_:E4e});function C4e(r){var e=B(r,"x","exp"),t={x:e};return Q.runKernel(WFe,t)}var Bu=K({exp_:C4e});function A4e(r,e){e===void 0&&(e=0);var t=B(r,"x","expandDims","string_or_numeric");G(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var n={input:t},a={dim:e};return Q.runKernel(UFe,n,a)}var Ss=K({expandDims_:A4e});function D4e(r){var e=B(r,"x","expm1"),t={x:e};return Q.runKernel(VFe,t)}var _4e=K({expm1_:D4e});function F4e(r,e){var t=B(r,"x","tile","string_or_numeric");G(t.rank===e.length,function(){return"Error in transpose: rank of input ".concat(t.rank," ")+"must match length of reps ".concat(e,".")});var n={x:t},a={reps:e};return Q.runKernel(w$,n,a)}var Uh=K({tile_:F4e});function R4e(r,e,t,n){n===void 0&&(n="float32"),e==null&&(e=r);for(var a=Ts([r,e],n),i=r<=e?r:e,o=0;o<i;++o)a.set(1,o,o);var s=ge(a.toTensor(),[r,e]);if(t==null)return s;if(t.length===1)return Uh(Ss(s,0),[t[0],1,1]);if(t.length===2)return Uh(Ss(Ss(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return Uh(Ss(Ss(Ss(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(t.length,"D."))}var G$=K({eye_:R4e});function O4e(r){var e=B(r,"x","floor","float32"),t={x:e};return Q.runKernel(KFe,t)}var H$=K({floor_:O4e});function P4e(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=0);var a=B(r,"x","gather"),i=B(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:n};return Q.runKernel(JFe,o,s)}var j$=K({gather_:P4e});function M4e(r,e){var t,n=B(r,"a","greater","string_or_numeric"),a=B(e,"b","greater","string_or_numeric");t=we(Mr(n,a),2),n=t[0],a=t[1],ln(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(QFe,i)}var ig=K({greater_:M4e});function B4e(r,e){var t,n=B(r,"a","greaterEqual","string_or_numeric"),a=B(e,"b","greaterEqual","string_or_numeric");t=we(Mr(n,a),2),n=t[0],a=t[1],ln(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(eRe,i)}var K$=K({greaterEqual_:B4e});function L4e(r){var e=B(r,"input","imag"),t={input:e};return Q.runKernel(rRe,t)}var og=K({imag_:L4e});function q4e(r){var e=B(r,"x","isFinite"),t={x:e};return Q.runKernel(nRe,t)}var z4e=K({isFinite_:q4e});function $4e(r){var e=B(r,"x","isInf"),t={x:e};return Q.runKernel(aRe,t)}var W4e=K({isInf_:$4e});function U4e(r){var e=B(r,"x","isNaN"),t={x:e};return Q.runKernel(iRe,t)}var V4e=K({isNaN_:U4e});function G4e(r,e){e===void 0&&(e=.2);var t=B(r,"x","leakyRelu"),n={x:t},a={alpha:e};return Q.runKernel(oRe,n,a)}var X$=K({leakyRelu_:G4e});function H4e(r,e){var t,n=B(r,"a","less","string_or_numeric"),a=B(e,"b","less","string_or_numeric");t=we(Mr(n,a),2),n=t[0],a=t[1],ln(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(sRe,i)}var _k=K({less_:H4e});function j4e(r,e){var t,n=B(r,"a","lessEqual","string_or_numeric"),a=B(e,"b","lessEqual","string_or_numeric");t=we(Mr(n,a),2),n=t[0],a=t[1],ln(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(uRe,i)}var Kk=K({lessEqual_:j4e});function K4e(r,e,t){if(t<=0)throw new Error("The number of values should be positive.");var n={start:r,stop:e,num:t};return Q.runKernel(cRe,{},n)}function X4e(r,e,t,n,a){e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),a===void 0&&(a=.5);var i=B(r,"x","localResponseNormalization");G(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `.concat(i.rank,".")}),G(Gh(e),function(){return"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(e,".")});var o=i,s=!1;i.rank===3&&(s=!0,o=ge(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:e,bias:t,alpha:n,beta:a},l=Q.runKernel(vRe,u,c);return s?ge(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var Y4e=K({localResponseNormalization_:X4e});function J4e(r){var e=B(r,"x","log","float32"),t={x:e};return Q.runKernel(lRe,t)}var Kh=K({log_:J4e});function Z4e(r){var e=B(r,"x","log1p"),t={x:e};return Q.runKernel(fRe,t)}var Y$=K({log1p_:Z4e});function _o(r){return Q.customGrad(r)}function Q4e(r){var e=B(r,"x","neg"),t={x:e};return Q.runKernel(CRe,t)}var ro=K({neg_:Q4e});function eBe(r){var e=B(r,"x","softplus"),t={x:e};return Q.runKernel(lOe,t)}var J$=K({softplus_:eBe});function tBe(r){var e=B(r,"x","logSigmoid"),t=_o(function(n){var a=ro(J$(ro(n))),i=function(o){var s=kt(o,cl(ro(n)));return s};return{value:a,gradFunc:i}});return t(e)}var rBe=K({logSigmoid_:tBe});function nBe(r,e){var t,n=B(r,"a","sub"),a=B(e,"b","sub");t=we(Mr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(IOe,i)}var Pt=K({sub_:nBe});function aBe(r,e){e===void 0&&(e=-1);var t=B(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and axis was ").concat(e));var n=_o(function(a,i){var o=!0,s=ll(a,e,!0),u=Pt(a,s),c=Pt(en(u,"float32"),Kh(ur(Bu(u),e,o)));i([c]);var l=function(f,h){var p=we(h,1),d=p[0],m=!0,v=Bu(d);return Pt(f,kt(ur(f,e,m),v))};return{value:c,gradFunc:l}});return n(t)}var iBe=K({logSoftmax_:aBe});function oBe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=B(r,"x","logSumExp"),a=Jm(e,n.shape),i=ll(n,a,!0),o=Pt(n,i),s=Bu(o),u=ur(s,a),c=Kh(u),l=cn(ge(i,c.shape),c);if(t){var f=rg(l.shape,a);return ge(l,f)}return l}var Z$=K({logSumExp_:oBe});function sBe(r,e){var t=B(r,"a","logicalAnd","bool"),n=B(e,"b","logicalAnd","bool");ln(t.shape,n.shape);var a={a:t,b:n};return Q.runKernel(hRe,a)}var Gm=K({logicalAnd_:sBe});function uBe(r){var e=B(r,"x","logicalNot","bool"),t={x:e};return Q.runKernel(pRe,t)}var Q$=K({logicalNot_:uBe});function cBe(r,e){var t=B(r,"a","logicalOr","bool"),n=B(e,"b","logicalOr","bool");ln(t.shape,n.shape);var a={a:t,b:n};return Q.runKernel(dRe,a)}var eW=K({logicalOr_:cBe});function lBe(r,e){var t=B(r,"a","logicalXor","bool"),n=B(e,"b","logicalXor","bool");return ln(t.shape,n.shape),Gm(eW(r,e),Q$(Gm(r,e)))}var fBe=K({logicalXor_:lBe});var Rm=2147483648;function hBe(r,e,t){t===void 0&&(t="left");var n=B(r,"sortedSequence","searchSorted"),a=B(e,"values","searchSorted"),i=n.shape[n.shape.length-1],o=a.shape[a.shape.length-1],s=ge(n,[-1,i]),u=ge(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(un(u.shape)>=Rm)throw new Error("values tensor size must less than ".concat(Rm));if(s.shape[1]>=Rm)throw new Error("trailing dim_size must less than ".concat(Rm," for int32 output type, was ").concat(s.shape[1]));var c={sortedSequence:s,values:u},l={side:t};return Q.runKernel(rOe,c,l)}var Xk=K({searchSorted_:hBe});function pBe(r,e){return Xk(r,e,"left")}function dBe(r,e,t,n,a){var i=B(r,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=ge(i,[1,i.shape[0],i.shape[1],i.shape[2]])),G(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(s.rank,".")}),G(Cs(t,o),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")}),$i("maxPool",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=Q.runKernel(yRe,c,l);return u?ge(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var tW=K({maxPool_:dBe});function vBe(r,e,t,n,a,i){e===void 0&&(e=[1,1,1]),i===void 0&&(i="NDHWC");var o=B(r,"x","maxPool3d"),s=o,u=!1;o.rank===4&&(u=!0,s=ge(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),G(s.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),G(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),$i("maxPool3d",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=Q.runKernel(bRe,c,l);return u?ge(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var mBe=K({maxPool3d_:vBe});function gBe(r,e,t,n,a){a===void 0&&(a=!1);var i=B(r,"x","maxPoolWithArgmax"),o={x:i},s={filterSize:e,strides:t,pad:n,includeBatchInIndex:a},u=Q.runKernel(wRe,o,s);return{result:u[0],indexes:u[1]}}var yBe=K({maxPoolWithArgmax_:gBe});function bBe(r,e){var t,n=B(r,"a","maximum"),a=B(e,"b","maximum");t=we(Mr(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=en(n,"int32"),a=en(a,"int32")),ln(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(gRe,i)}var wBe=K({maximum_:bBe});function xBe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=B(r,"x","mean"),a={x:n},i={axis:e,keepDims:t};return Q.runKernel(xRe,a,i)}var Hm=K({mean_:xBe});function dl(r,e){if(e===void 0&&(e="float32"),Pa(r),e==="complex64"){var t=dl(r,"float32"),n=dl(r,"float32");return Es(t,n)}var a=Lk(un(r),e);return Q.makeTensor(a,r,e)}function Mu(r,e){if(e===void 0&&(e="float32"),Pa(r),e==="complex64"){var t=Mu(r,"float32"),n=dl(r,"float32");return Es(t,n)}var a=d$(un(r),e);return Q.makeTensor(a,r,e)}function kBe(r,e,t){var n=t===void 0?{}:t,a=n.indexing,i=a===void 0?"xy":a;if(i!=="xy"&&i!=="ij")throw new TypeError("".concat(i," is not a valid third argument to meshgrid"));if(r===void 0)return[];var o=B(r,"x","meshgrid",r instanceof ma?r.dtype:"float32");if(e===void 0)return[o];var s=B(e,"y","meshgrid",e instanceof ma?e.dtype:"float32"),u=un(o.shape),c=un(s.shape);return i==="xy"?(o=ge(o,[1,-1]),s=ge(s,[-1,1]),[Gt(Mu([c,1],o.dtype),o),Gt(s,Mu([1,u],s.dtype))]):(o=ge(o,[-1,1]),s=ge(s,[1,-1]),[Gt(o,Mu([1,c],o.dtype)),Gt(Mu([u,1],s.dtype),s)])}function SBe(r,e){var t,n=B(r,"a","minimum"),a=B(e,"b","minimum");t=we(Mr(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=en(n,"int32"),a=en(a,"int32")),ln(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(SRe,i)}var jm=K({minimum_:SBe});function NBe(r,e,t){G(t==="reflect"||t==="symmetric",function(){return"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(t,".")});var n=B(r,"x","mirrorPad");if(n.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");G(e.length===n.rank,function(){return"Padding doesn't match input. Must be ".concat(n.rank,". ")+"Got ".concat(e.length,".")});for(var a=t==="reflect"?1:0,i=function(c){G(e[c].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),G(e[c][0]>=0&&e[c][0]<=n.shape[c]-a&&e[c][1]>=0&&e[c][1]<=n.shape[c]-a,function(){return"Padding in dimension ".concat(c," cannot be greater than or equal ")+"to ".concat(n.shape[c]-a," or less than 0 for input of ")+"shape ".concat(n.shape)})},o=0;o<n.rank;o++)i(o);var s={paddings:e,mode:t},u={x:n};return Q.runKernel(NRe,u,s)}var TBe=K({mirrorPad_:NBe});function EBe(r,e){var t,n=B(r,"a","mod"),a=B(e,"b","mod");t=we(Mr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(TRe,i)}var IBe=K({mod_:EBe});function CBe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1),r=B(r,"x","moments");var n=Jm(e,r.shape),a=Hm(r,n,t),i=a.shape;t||(i=rg(a.shape,n));var o=ng(Pt(en(r,"float32"),ge(a,i))),s=Hm(o,n,t);return{mean:a,variance:s}}var ABe=K({moments_:CBe});function DBe(r,e,t,n){for(var a=B(e,"data","multiRNNCell"),i=Wm(t,"c","multiRNNCell"),o=Wm(n,"h","multiRNNCell"),s=a,u=[],c=0;c<r.length;c++){var l=r[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}for(var f=[],h=[],c=0;c<u.length;c+=2)f.push(u[c]),h.push(u[c+1]);return[f,h]}var _Be=K({multiRNNCell_:DBe});function FBe(r,e,t,n){n===void 0&&(n=!1);var a=B(r,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+"".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));t=t||Math.random();var s=o===1?ge(a,[1,-1]):a,u={logits:s},c={numSamples:e,seed:t,normalized:n},l=Q.runKernel(ERe,u,c);return o===1?ge(l,[l.size]):l}var RBe=K({multinomial_:FBe});function OBe(r,e){var t,n=B(r,"a","notEqual","string_or_numeric"),a=B(e,"b","notEqual","string_or_numeric");t=we(Mr(n,a),2),n=t[0],a=t[1],ln(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(ARe,i)}var rW=K({notEqual_:OBe});function PBe(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n=0),a===void 0&&(a="int32"),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(e));var i=B(r,"indices","oneHot","int32"),o={indices:i},s={dtype:a,depth:e,onValue:t,offValue:n};return Q.runKernel(ORe,o,s)}var MBe=K({oneHot_:PBe});function BBe(r){var e=B(r,"x","onesLike"),t={x:e};return Q.runKernel(RRe,t)}var LBe=K({onesLike_:BBe});function qBe(r,e){var t=B(r,"v1","outerProduct"),n=B(e,"v2","outerProduct");G(t.rank===1&&n.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+"".concat(t.rank," and ").concat(n.rank,".")});var a=ge(t,[-1,1]),i=ge(n,[1,-1]);return Gt(a,i)}var zBe=K({outerProduct_:qBe});function $Be(r,e,t){t===void 0&&(t=0);var n=B(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:n};return Q.runKernel(MRe,i,a)}var Qh=K({pad_:$Be});function WBe(r,e,t){return t===void 0&&(t=0),G(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Qh(r,[e],t)}var UBe=K({pad1d_:WBe});function VBe(r,e,t){return t===void 0&&(t=0),G(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Qh(r,e,t)}var GBe=K({pad2d_:VBe});function HBe(r,e,t){return t===void 0&&(t=0),G(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Qh(r,e,t)}var jBe=K({pad3d_:HBe});function KBe(r,e,t){return t===void 0&&(t=0),G(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Qh(r,e,t)}var XBe=K({pad4d_:KBe});function YBe(r,e,t){var n=B(r,"x","spaceToBatchND");G(n.rank>=1+e.length,function(){return"input rank ".concat(n.rank," should be > than [blockShape] ").concat(e.length)}),G(t.length===e.length,function(){return"paddings.shape[0] ".concat(t.length," must be equal to [blockShape] ").concat(e.length)}),G(n.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions ".concat(n.shape.slice(1)," with paddings ").concat(t.toString()," must be divisible by blockShapes ").concat(e.toString())});var a={x:n},i={blockShape:e,paddings:t};return Q.runKernel(pOe,a,i)}var nW=K({spaceToBatchND_:YBe});function JBe(r,e,t,n,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),n===0&&(n="valid");var s=B(r,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),G(Cs(i,a),function(){return"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'")});var l=MPe(u.shape,e,i,a,n),f=[l.dilationHeight,l.dilationWidth],h;n==="same"?h=QBe([l.filterHeight,l.filterWidth],f):h=[[0,0],[0,0]];var p=f[0]===1&&f[1]===1,d=we(ZBe([l.inHeight,l.inWidth],f,h),2),m=d[0],v=d[1],g=p?n:"valid",y=p?u:nW(u,f,m),w=t==="avg"?function(){return B$(y,e,i,g,o)}:function(){return tW(y,e,i,g,o)},b=w(),x=p?b:L$(b,f,v);return c?ge(x,[x.shape[1],x.shape[2],x.shape[3]]):x}function ZBe(r,e,t){var n=t.map(function(l){return l[0]}),a=t.map(function(l){return l[1]}),i=r.concat(n,a),o=e.map(function(l,f){return(l-i[f]%l)%l}),s=a.map(function(l,f){return l+o[f]}),u=e.map(function(l,f){return[n[f],s[f]]}),c=e.map(function(l,f){return[0,o[f]]});return[u,c]}function QBe(r,e){var t=r.map(function(o,s){return o+(o-1)*(e[s]-1)}),n=t.map(function(o){return o-1}),a=n.map(function(o){return Math.floor(o/2)}),i=n.map(function(o,s){return o-a[s]});return n.map(function(o,s){return[a[s],i[s]]})}var eLe=K({pool_:JBe});function tLe(r,e){var t=B(r,"x","prelu"),n=B(e,"alpha","prelu"),a={x:t,alpha:n};return Q.runKernel(LRe,a)}var aW=K({prelu_:tLe});function rLe(r,e){e===void 0&&(e=!1),console.log(r.toString(e))}function nLe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=B(r,"x","prod");n.dtype==="bool"&&(n=en(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return Q.runKernel(qRe,a,i)}var aLe=K({prod_:nLe});function iLe(r,e,t,n){var a=r.map(function(l,f){return B(l,"tensors".concat(f),"raggedGather","int32")}),i=B(e,"paramsDenseValues","raggedGather"),o=B(t,"indices","raggedGather","int32"),s={paramsNestedSplits:a,paramsDenseValues:i,indices:o},u={outputRaggedRank:n},c=Q.runKernel(zRe,s,u);return{outputNestedSplits:c.slice(0,c.length-1),outputDenseValues:c[c.length-1]}}var oLe=K({raggedGather_:iLe});function sLe(r,e,t){var n=B(r,"starts","raggedRange"),a=B(e,"limits","raggedRange",n.dtype),i=B(t,"deltas","raggedRange",n.dtype),o={starts:n,limits:a,deltas:i},s=Q.runKernel($Re,o);return{rtNestedSplits:s[0],rtDenseValues:s[1]}}var uLe=K({raggedRange_:sLe});function cLe(r,e,t,n,a){var i=B(r,"shape","raggedTensorToTensor","int32"),o=B(e,"values","raggedTensorToTensor"),s=B(t,"defaultValue","raggedTensorToTensor",o.dtype),u=n.map(function(f,h){return B(f,"tensors".concat(h),"raggedTensorToTensor","int32")}),c={shape:i,values:o,defaultValue:s,rowPartitionTensors:u},l={rowPartitionTypes:a};return Q.runKernel(WRe,c,l)}var lLe=K({raggedTensorToTensor_:cLe});function fLe(r,e,t){Pa(r);var n=un(r),a=null;if(t==null||t==="float32")a=new Float32Array(n);else if(t==="int32")a=new Int32Array(n);else if(t==="bool")a=new Uint8Array(n);else throw new Error("Unknown data type ".concat(t));for(var i=0;i<n;i++)a[i]=e();return Q.makeTensor(a,r,t)}var hLe=K({rand_:fLe}),iW={exports:{}};(function(r){(function(e,t,n){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(zu,r,!1)})(iW);var pLe=iW.exports,oW={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(zu,r,!1)})(oW);var dLe=oW.exports,sW={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(zu,r,!1)})(sW);var vLe=sW.exports,uW={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,p;return h=l[f],h^=h>>>7,p=h^h<<24,h=l[f+1&7],p^=h^h>>>10,h=l[f+3&7],p^=h^h>>>3,h=l[f+4&7],p^=h^h<<7,h=l[f+7&7],h=h^h<<13,p^=h^h<<9,l[f]=p,u.i=f+1&7,p};function c(l,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8?p[7]=-1:p[h],l.x=p,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(zu,r,!1)})(uW);var mLe=uW.exports,cW={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,p,d;return u.w=l=l+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(l^l>>>16)|0};function c(l,f){var h,p,d,m,v,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,m=-32;m<y;++m)f&&(p^=f.charCodeAt((m+32)%f.length)),m===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(v=v+1640531527|0,h=g[m&127]^=p+v,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,m=4*128;m>0;--m)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;l.w=v,l.X=g,l.i=d}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(zu,r,!1)})(cW);var gLe=cW.exports,lW={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(zu,r,!1)})(lW);var yLe=lW.exports,fW={exports:{}},bLe={},wLe={__proto__:null,default:bLe},xLe=WOe(wLe);(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),c=n.pow(2,o),l=c*2,f=a-1,h;function p(b,x,S){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(v(x.entropy?[b,w(t)]:b??y(),3),T),C=new d(T),R=function(){for(var _=C.g(i),M=u,$=0;_<c;)_=(_+$)*a,M*=a,$=C.g(1);for(;_>=l;)_/=2,M/=2,$>>>=1;return(_+$)/M};return R.int32=function(){return C.g(4)|0},R.quick=function(){return C.g(4)/4294967296},R.double=R,g(w(C.S),t),(x.pass||S||function(_,M,$,z){return z&&(z.S&&m(z,C),_.state=function(){return m(C,{})}),$?(n[s]=_,M):_})(R,E,"global"in x?x.global:this==n,x.state)}function d(b){var x,S=b.length,T=this,E=0,C=T.i=T.j=0,R=T.S=[];for(S||(b=[S++]);E<a;)R[E]=E++;for(E=0;E<a;E++)R[E]=R[C=f&C+b[E%S]+(x=R[E])],R[C]=x;(T.g=function(_){for(var M,$=0,z=T.i,q=T.j,L=T.S;_--;)M=L[z=f&z+1],$=$*a+L[f&(L[z]=L[q=f&q+M])+(L[q]=M)];return T.i=z,T.j=q,$})(a)}function m(b,x){return x.i=b.i,x.j=b.j,x.S=b.S.slice(),x}function v(b,x){var S=[],T=typeof b,E;if(x&&T=="object")for(E in b)try{S.push(v(b[E],x-1))}catch{}return S.length?S:T=="string"?b:b+"\0"}function g(b,x){for(var S=b+"",T,E=0;E<S.length;)x[f&E]=f&(T^=x[f&E]*19)+S.charCodeAt(E++);return w(x)}function y(){try{var b;return h&&(b=h.randomBytes)?b=b(a):(b=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(b)),w(b)}catch{var x=e.navigator,S=x&&x.plugins;return[+new Date,e,S,e.screen,w(t)]}}function w(b){return String.fromCharCode.apply(0,b)}if(g(n.random(),t),r.exports){r.exports=p;try{h=xLe}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:zu,[],Math)})(fW);var kLe=fW.exports,SLe=pLe,NLe=dLe,TLe=vLe,ELe=mLe,ILe=gLe,CLe=yLe,Wu=kLe;Wu.alea=SLe;Wu.xor128=NLe;Wu.xorwow=TLe;Wu.xorshift7=ELe;Wu.xor4096=ILe;Wu.tychei=CLe;var Yk=Wu;var Jk=function(){function r(e,t,n,a,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);var o=i||Math.random();this.random=Yk.alea(o.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,a=!1;!a;){var i=void 0,o=void 0,s=void 0;do i=2*this.random()-1,o=2*this.random()-1,s=i*i+o*o;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*i*u,n=this.mean+this.stdDev*o*u,(!this.truncated||this.isValidTruncated(t))&&(a=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)},r.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},r.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},r}(),ALe=function(){function r(e,t,n,a){this.alpha=e,this.beta=1/t,this.dtype=n;var i=a||Math.random();this.randu=Yk.alea(i.toString()),this.randn=new Jk(0,1,n,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var e,t,n,a,i,o;;){do a=this.randn.nextValue(),o=1+this.c*a;while(o<=0);if(o*=o*o,e=a*a,t=1-.331*e*e,n=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<t||Math.log(i)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},r.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},r}(),DLe=function(){function r(e,t,n,a){e===void 0&&(e=0),t===void 0&&(t=1);var i=this;if(this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=n,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(e," - ").concat(t," <= 1 and dtype is not float"));this.random=Yk.alea(a)}return r.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r}();function _Le(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n="float32"),Pa(r),t==null&&(t=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error("Unsupported data type ".concat(n));for(var i=new ALe(e,t,n,a),o=Ts(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var FLe=K({randomGamma_:_Le});function RLe(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),Pa(r),n!=null&&n==="bool")throw new Error("Unsupported data type ".concat(n));for(var i=new Jk(e,t,n,!1,a),o=Ts(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var hW=K({randomNormal_:RLe});function OLe(r,e,t){if(e!=null&&e==="bool")throw new Error("Unsupported data type ".concat(e));return hW(r,0,1,e,t)}var PLe=K({randomStandardNormal_:OLe});function MLe(r,e,t,n,a){e===void 0&&(e=0),t===void 0&&(t=1),n===void 0&&(n="float32"),Pa(r);for(var i=Ts(r,n),o=new DLe(e,t,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}var Zk=K({randomUniform_:MLe});function BLe(r,e,t,n){return Zk(r,e,t,"int32",n)}var LLe=K({randomUniformInt_:BLe});function Xh(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t===0)throw new Error("Cannot have a step of zero");var a={start:r,stop:e,step:t,dtype:n};return Q.runKernel(URe,{},a)}function qLe(r){var e=B(r,"input","real"),t={input:e};return Q.runKernel(VRe,t)}var Yh=K({real_:qLe});function zLe(r){var e=B(r,"x","reciprocal"),t={x:e};return Q.runKernel(GRe,t)}var $Le=K({reciprocal_:zLe});function WLe(r){var e=B(r,"x","relu"),t={x:e};return Q.runKernel(HRe,t)}var sg=K({relu_:WLe});function ULe(r){var e=B(r,"x","relu6"),t={x:e};return Q.runKernel(YRe,t)}var pW=K({relu6_:ULe});function VLe(r,e){var t=B(r,"x","reverse"),n={x:t},a={dims:e};return Q.runKernel(JRe,n,a)}var Lu=K({reverse_:VLe});function GLe(r){var e=B(r,"x","reverse");return G(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(e.rank,".")}),Lu(e,0)}var HLe=K({reverse1d_:GLe});function jLe(r,e){var t=B(r,"x","reverse");return G(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(t.rank,".")}),Lu(t,e)}var KLe=K({reverse2d_:jLe});function XLe(r,e){var t=B(r,"x","reverse");return G(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(t.rank,".")}),Lu(t,e)}var YLe=K({reverse3d_:XLe});function JLe(r,e){var t=B(r,"x","reverse");return G(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(t.rank,".")}),Lu(t,e)}var ZLe=K({reverse4d_:JLe});function QLe(r){var e=B(r,"x","round"),t={x:e};return Q.runKernel(ZRe,t)}var dW=K({round_:QLe});function eqe(r){var e=B(r,"x","rsqrt","float32"),t={x:e};return Q.runKernel(QRe,t)}var tqe=K({rsqrt_:eqe});function rqe(r){var e=B(r,"x","selu"),t={x:e};return Q.runKernel(aOe,t)}var nqe=K({selu_:rqe});function aqe(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC");var s=B(r,"x","separableConv2d"),u=B(e,"depthwiseFilter","separableConv2d"),c=B(t,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(s.rank===3&&(f=!0,l=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");G(l.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(l.rank,".")}),G(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),G(c.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),G(c.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(c.shape[0],".")}),G(c.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(c.shape[1],".")});var h=u.shape[2],p=u.shape[3];G(c.shape[2]===h*p,function(){return"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(h*p,", ")+"but got ".concat(c.shape[2],".")});var d=Gk(l,u,n,a,o,i),m=1,v=tg(d,c,m,"valid",o);return f?ge(v,[v.shape[1],v.shape[2],v.shape[3]]):v}var iqe=K({separableConv2d_:aqe});function oqe(r,e){return _t(this,void 0,void 0,function(){var t,n,a,i,o,s,l,u,c,l,f;return Dt(this,function(h){switch(h.label){case 0:return t=B(r,"x","setdiff1d"),n=B(e,"y","setdiff1d"),G(t.dtype===n.dtype,function(){return"x and y should have the same dtype, but got x (".concat(t.dtype,") and y (").concat(n.dtype,").")}),G(t.rank===1,function(){return"x should be 1D tensor, but got x (".concat(t.shape,").")}),G(n.rank===1,function(){return"y should be 1D tensor, but got y (".concat(n.shape,").")}),[4,t.data()];case 1:return a=h.sent(),[4,n.data()];case 2:for(i=h.sent(),o=new Set(i),s=0,l=0;l<a.length;l++)o.has(a[l])||s++;for(u=new xk([s],t.dtype),c=new xk([s],"int32"),l=0,f=0;l<a.length;l++)o.has(a[l])||(u.values[f]=a[l],c.values[f]=l,f++);return[2,[u.toTensor(),c.toTensor()]]}})})}var sqe=oqe;function uqe(r){var e=B(r,"x","sign"),t={x:e};return Q.runKernel(uOe,t)}var cqe=K({sign_:uqe});function lqe(r){var e=B(r,"x","sin","float32"),t={x:e};return Q.runKernel(oOe,t)}var fqe=K({sin_:lqe});function hqe(r){var e=B(r,"x","sinh"),t={x:e};return Q.runKernel(sOe,t)}var pqe=K({sinh_:hqe});function dqe(r,e,t){var n=B(r,"x","slice1d");return G(n.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(n.rank," tensor")}),xr(n,[e],[t])}var vqe=K({slice1d_:dqe});function mqe(r,e,t){var n=B(r,"x","slice2d");return G(n.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(n.rank," tensor")}),xr(n,e,t)}var gqe=K({slice2d_:mqe});function yqe(r,e,t){var n=B(r,"x","slice3d");return G(n.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(n.rank," tensor")}),xr(n,e,t)}var bqe=K({slice3d_:yqe});function wqe(r,e,t){var n=B(r,"x","slice4d");return G(n.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(n.rank," tensor")}),xr(n,e,t)}var xqe=K({slice4d_:wqe});function kqe(r,e){e===void 0&&(e=-1);var t=B(r,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and dim was ").concat(e));var n={logits:t},a={dim:e};return Q.runKernel(vOe,n,a)}var Sqe=K({softmax_:kqe});function Nqe(r){G(r.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(r.dtype,".")});var e={input:r};return Q.runKernel(GFe,e)}var Qk=K({fft_:Nqe});function Tqe(r){G(r.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(r.dtype,".")});var e={input:r};return Q.runKernel(tRe,e)}var Km=K({ifft_:Tqe});function Eqe(r){var e=r.shape[r.shape.length-1],t=r.size/e,n;if(e<=2){var a=ge(r,[t,e]);n=Km(a)}else{var i=[t,2*(e-1)],o=ge(Yh(r),[t,e]),s=ge(og(r),[t,e]),u=Lu(xr(o,[0,1],[t,e-2]),1),c=kt(Lu(xr(s,[0,1],[t,e-2]),1),zr(-1)),l=ya([o,u],1),f=ya([s,c],1),a=ge(Es(l,f),[i[0],i[1]]);n=Km(a)}if(n=Yh(n),r.rank===3&&r.shape[0]!==0){var h=n,p=r.shape[0];n=ge(n,[p,n.shape[0]/p,n.shape[1]]),h.dispose()}return n}var vW=K({irfft_:Eqe});function Iqe(r,e,t){t===void 0&&(t=0);var n=B(r,"x","split"),a={x:n},i={numOrSizeSplits:e,axis:t};return Q.runKernel(dOe,a,i)}var Jh=K({split_:Iqe});function Cqe(r,e){G(r.dtype==="float32",function(){return"The dtype for rfft() must be real value but got ".concat(r.dtype)});var t=r.shape[r.shape.length-1],n=r.size/t,a;if(e!=null&&e<t){var i=r.shape.map(function(g){return 0}),o=r.shape.map(function(g){return g});o[r.shape.length-1]=e,a=xr(r,i,o),t=e}else if(e!=null&&e>t){var s=r.shape.map(function(g){return g});s[r.shape.length-1]=e-t,a=ya([r,dl(s)],r.shape.length-1),t=e}else a=r;var u=Hk(a),c=ge(Es(a,u),[n,t]),l=Qk(c),f=Math.floor(t/2)+1,h=Yh(l),p=og(l),d=Jh(h,[f,t-f],h.shape.length-1),m=Jh(p,[f,t-f],p.shape.length-1),v=a.shape.slice();return v[a.shape.length-1]=f,ge(Es(d[0],m[0]),v)}var e2=K({rfft_:Cqe});function Aqe(r,e){var t,n=B(r,"a","squaredDifference"),a=B(e,"b","squaredDifference");t=we(Mr(n,a),2),n=t[0],a=t[1],ln(n.shape,a.shape);var i={a:n,b:a},o={};return Q.runKernel(xOe,i,o)}var mW=K({squaredDifference_:Aqe});function Dqe(r,e){var t=B(r,"x","squeeze","string_or_numeric");return ge(t,M3e(t.shape,e).newShape)}var t2=K({squeeze_:Dqe});function _qe(r,e){e===void 0&&(e=0);var t=Wm(r,"tensors","stack","string_or_numeric");G(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&G(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var n=t,a={axis:e};return Q.runKernel(PRe,n,a)}var Zh=K({stack_:_qe});function Fqe(r,e){e===void 0&&(e=0);var t=B(r,"x","step"),n={x:t},a={alpha:e};return Q.runKernel(MOe,n,a)}var gW=K({step_:Fqe});function Rqe(r,e,t,n,a,i,o,s,u){a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),u===void 0&&(u=0);var c=B(r,"x","stridedSlice","string_or_numeric"),l={x:c},f={begin:e,end:t,strides:n,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return Q.runKernel(SOe,l,f)}var Oqe=K({stridedSlice_:Rqe});function Pqe(r){var e=B(r,"x","tan","float32"),t={x:e};return Q.runKernel(COe,t)}var Mqe=K({tan_:Pqe});function fl(r,e,t){var n=Is(r,t);return As(r,e,n,t)}function pi(r,e){vl(r);var t=Is(r,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");var n=null;return As(r,n,t,e)}function Vh(r,e,t){if(vl(r),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var n=Is(r,t);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return As(r,e,n,t)}function Bqe(r,e,t){if(vl(r),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var n=Is(r,t);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return As(r,e,n,t)}function Lqe(r,e,t){if(vl(r),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var n=Is(r,t);if(n.length!==4&&n.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return As(r,e,n,t)}function qqe(r,e,t){if(vl(r),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var n=Is(r,t);if(n.length!==5&&n.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return As(r,e,n,t)}function zqe(r,e,t){if(vl(r),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var n=Is(r,t);if(n.length!==6&&n.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||n,As(r,e,n,t)}function $qe(r,e,t){var n=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(t.shape)+", indices.shape: ".concat(e.shape,", shape: ").concat(r)+", sliceDim: ".concat(n,", and batchDim: ").concat(a,".");if(t.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(r.length<n+(t.rank-a))throw new Error(i+" Output shape length < ".concat(n+(t.rank-a)));if(t.rank!==a+r.length-n)throw new Error(i+" update.rank != ".concat(a+r.length-n));for(var o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(t.shape[o],") != indices.shape[").concat(o,"] (").concat(e.shape[o],")."));for(var o=0;o<t.rank-a;++o)if(t.shape[o+a]!==r[o+n])throw new Error(i+" updates.shape[".concat(o+a,"] (").concat(t.shape[o+a],") != shape[").concat(o+a,"] (").concat(r[o+a],")"))}function yW(r,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(r.rank,"."));if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(e.dtype));if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(t));if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: ".concat(e.shape));if(r.size===0)throw new Error("Updates specified for empty output. updates shape: ".concat(r.shape))}$qe(t,e,r)}function Wqe(r,e,t){var n=B(r,"tensor","tensorScatterupdate"),a=B(e,"indices","tensorScatterupdate","int32"),i=B(t,"updates","tensorScatterupdate");if(yW(i,a,n.shape),n.dtype!==i.dtype)throw new Error("tensor and updates must have the same dtype, instead they are ".concat(n.dtype," and ").concat(i.dtype,"."));var o={tensor:n,indices:a,updates:i},s={};return Q.runKernel(tOe,o,s)}var Uqe=K({tensorScatterUpdate_:Wqe});function Vqe(r,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var n=B(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=n.shape[n.shape.length-1];if(e<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(e));if(e>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") ")+"but got ".concat(e));var i={x:n},o={k:e,sorted:t},s=we(Q.runKernel(DOe,i,o),2),u=s[0],c=s[1];return{values:u,indices:c}}var Gqe=K({topk_:Vqe});function Hqe(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),Pa(r),n!=null&&n==="bool")throw new Error("Unsupported data type $ { dtype }");for(var i=new Jk(e,t,n,!0,a),o=Ts(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var jqe=K({truncatedNormal_:Hqe});function Kqe(r,e){e===void 0&&(e=0);var t=B(r,"x","unique","string_or_numeric");G(t.rank>0,function(){return"The input tensor must be at least 1D"});var n={x:t},a={axis:e},i=we(Q.runKernel(FOe,n,a),2),o=i[0],s=i[1];return{values:o,indices:s}}var Xqe=K({unique_:Kqe});function Yqe(r,e,t){var n=B(r,"x","unsortedSegmentSum"),a=B(e,"segmentIds","unsortedSegmentSum","int32");G(Gh(t),function(){return"numSegments must be of dtype int"});var i={x:n,segmentIds:a},o={numSegments:t};return Q.runKernel(OOe,i,o)}var Jqe=K({unsortedSegmentSum_:Yqe});function Zqe(r,e){e===void 0&&(e=0);var t=B(r,"x","unstack","string_or_numeric");G(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = ".concat(e," is not in [-").concat(t.shape.length,", ").concat(t.shape.length,")")});var n={value:t},a={axis:e};return Q.runKernel(ROe,n,a)}var r2=K({unstack_:Zqe});function Qqe(r,e){return Xk(r,e,"right")}function eze(r,e,t,n){return e===void 0&&(e=!0),Q.makeVariable(r,e,t,n)}function tze(r,e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(n);for(var a=Ts(r,"int32"),i=Ts([t.length,r.length],"int32"),n=0;n<t.length;n++){var o=a.indexToLoc(t[n]),s=n*r.length;i.values.set(o,s)}return i.toTensor()}function rze(r){return _t(this,void 0,void 0,function(){var e,t,n;return Dt(this,function(a){switch(a.label){case 0:return e=B(r,"condition","whereAsync","bool"),[4,e.data()];case 1:return t=a.sent(),n=tze(e.shape,t),r!==e&&e.dispose(),[2,n]}})})}var bW=rze;function nze(r,e,t){return _t(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p,d,m;return Dt(this,function(v){switch(v.label){case 0:for(n=B(r,"tensor","boolMask"),a=B(e,"mask","boolMask","bool"),i=t??0,o=a.rank,s=n.shape,G(o>0,function(){return"mask cannot be scalar"}),di(s.slice(i,i+o),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+o;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+o)),f=ge(n,l),h=ge(a,[-1]),[4,bW(h)];case 1:return p=v.sent(),d=t2(p,[1]),m=j$(f,d,i),r!==n&&n.dispose(),e!==a&&a.dispose(),d.dispose(),f.dispose(),h.dispose(),p.dispose(),[2,m]}})})}var aze=nze;function ize(r,e){return Q.tidy(r,e)}function oze(r){var e=R$(r);e.forEach(function(t){return t.dispose()})}function sze(){return Q.backendName}function uze(){return Q.backend}function cze(r,e,t){var n=B(r,"x","transpose");if(e==null&&(e=n.shape.map(function(o,s){return s}).reverse()),G(n.rank===e.length,function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of perm ".concat(e,".")}),e.forEach(function(o){G(o>=0&&o<n.rank,function(){return"All entries in 'perm' must be between 0 and ".concat(n.rank-1)+" but got ".concat(e)})}),n.rank<=1)return n.clone();var a={x:n},i={perm:e};return n.dtype==="complex64"?ize(function(){var o=Yh(n),s=og(n);return o=Q.runKernel(ak,{x:o},i),s=Q.runKernel(ak,{x:s},i),t&&(s=ro(s)),Es(o,s)}):Q.runKernel(ak,a,i)}var Fk=K({transpose_:cze});function lze(r,e,t,n,a){a===void 0&&(a=!0);var i=B(r,"v","movingAverage"),o=B(e,"x","movingAverage"),s=B(t,"decay","movingAverage");aPe(i,o),G(qu(i.shape,o.shape),function(){return"Shape mismatch in v and x"});var u=zr(1),c=Pt(u,s),l=kt(Pt(o,i),c);if(a){G(n!=null,function(){return"When using zeroDebias: true, step is required."});var f=B(n,"step","movingAverage");l=Rn(l,Pt(u,jk(s,f)))}return cn(i,l)}var fze=K({movingAverage_:lze});function hze(r,e,t){Pa(t);var n=B(r,"indices","scatterND","int32"),a=B(e,"updates","scatterND");yW(a,n,t);var i={indices:n,updates:a},o={shape:t};return Q.runKernel(eOe,i,o)}var pze=K({scatterND_:hze});function dze(r,e,t,n){if(r.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+" but the dtype was ".concat(r.dtype,"."));if(r.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+" but got shape ".concat(r.shape,"."));var a=r.rank>0?r.shape[0]:1,i=r.rank>1?r.shape[1]:1;if(t.length!==i)throw new Error("outputShape has incorrect number of elements:,"+" ".concat(t.length,", should be: ").concat(i,"."));var o=e.size;if(!(e.rank===0||e.rank===1&&o===a))throw new Error("sparseValues has incorrect shape "+"".concat(e.shape,", should be [] or [").concat(a,"]"));if(e.dtype!==n.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function vze(r,e,t,n){n===void 0&&(n=0),Pa(t);var a=B(r,"sparseIndices","sparseToDense","int32"),i=B(e,"sparseValues","sparseToDense","string_or_numeric"),o=B(n,"defaultValue","sparseToDense",i.dtype);dze(a,i,t,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:t};return Q.runKernel(wOe,s,u)}var mze=K({sparseToDense_:vze});function gze(r,e){var t=B(e,"indices","gatherND","int32"),n=B(r,"x","gatherND","string_or_numeric"),a={params:n,indices:t};return Q.runKernel(ZFe,a)}var yze=K({gatherND_:gze});function bze(r,e){if(e==null)return r.shape.slice();if(qu(r.shape,e))return e;if(r.shape.length===e.length){for(var t=[],n=0;n<r.shape.length;n++)e[n]==null&&r.shape[n]!=null?t.push(r.shape[n]):t.push(e[n]);return t}return e}function wze(r,e,t,n){var a=B(r,"x","dropout");if(G(a.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(a.dtype," tensor instead.")}),G(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got ".concat(e,".")}),e===0)return r instanceof ma?a.clone():a;var i=bze(a,t),o=1-e,s=Rn(H$(cn(Zk(i,0,1,"float32",n),o)),o);return kt(a,s)}var xze=K({dropout_:wze});function wW(r){return Math.floor(Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))))}function n2(r,e,t){for(var n=1-r%2,a=new Float32Array(r),i=0;i<r;++i){var o=2*Math.PI*i/(r+n-1);a[i]=e-t*Math.cos(o)}return pi(a,"float32")}function kze(r,e,t){return t===void 0&&(t=1),_t(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p,d,m,v,v;return Dt(this,function(g){switch(g.label){case 0:return n=B(r,"predictions","inTopK"),a=B(e,"targets","inTopK"),G(n.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, "+"but got ".concat(n.rank)}),G(n.rank-1===a.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+"".concat(n.rank," and targets rank ").concat(a.rank)}),di(n.shape.slice(0,n.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=n.shape[n.shape.length-1],G(t>0&&t<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last "+"dimension (".concat(i,"), but got ").concat(t)}),[4,n.data()];case 1:return o=g.sent(),[4,a.data()];case 2:for(s=g.sent(),u=we([o.length/i,i],2),c=u[0],l=u[1],f=B3e("bool",c),h=0;h<c;h++){for(p=h*l,d=o.subarray(p,p+l),m=[],v=0;v<d.length;v++)m.push({value:d[v],index:v});for(m.sort(function(y,w){return w.value-y.value}),f[h]=0,v=0;v<t;v++)if(m[v].index===s[h]){f[h]=1;break}}return r!==n&&n.dispose(),e!==a&&a.dispose(),[2,fl(f,a.shape,"bool")]}})})}var Sze=kze;function Nze(r,e,t,n,a,i,o){i===void 0&&(i="NHWC");var s=r;r.rank===3&&(s=ge(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]])),G(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")}),G(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")}),G(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(t,".")});var c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];G(c===t[2],function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(t[2],".")}),G(l===t[3],function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(t[3],").")}),$i("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return Q.runKernel(xFe,f,h)}var Tze=K({conv2DBackpropFilter_:Nze});function a2(r,e,t){if(t==null||t==="linear")return r;if(t==="relu")return kt(r,gW(e));throw new Error("Cannot compute gradient for fused activation ".concat(t,"."))}function i2(r,e){var t=e,n=a4e(r.shape,e.shape);return n.length>0&&(t=ur(t,n)),ge(t,r.shape)}function o2(r,e,t,n){if(e==="linear")return r;if(e==="relu")return sg(r);if(e==="elu")return U$(r);if(e==="relu6")return pW(r);if(e==="prelu")return aW(r,t);if(e==="leakyrelu")return X$(r,n);if(e==="sigmoid")return cl(r);throw new Error("Unknown fused activation ".concat(e,"."))}var s2=function(r,e){var t=r>0;return!t||e==="linear"};function Eze(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,c=u===void 0?[1,1]:u,l=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,m=r.leakyreluAlpha;if(p=p||"linear",s2(Q.state.gradientDepth,p)===!1){G(s==="NHWC",function(){return"Error in fused conv2d: got dataFormat of ".concat(s," but ")+"only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."});var v=tg(t,n,a,i,s,c,l);return f!=null&&(v=cn(v,f)),o2(v,p,d,m)}var g=B(t,"x","conv2d","float32"),y=B(n,"filter","conv2d","float32"),w=g,b=!1;g.rank===3&&(b=!0,w=ge(g,[1,g.shape[0],g.shape[1],g.shape[2]])),G(w.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(w.rank,".")}),G(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(y.rank,".")}),$i("fused conv2d",i,l);var x=s==="NHWC"?w.shape[3]:w.shape[1];G(y.shape[2]===x,function(){return"Error in conv2d: depth of input (".concat(x,") must match ")+"input depth for filter ".concat(y.shape[2],".")}),G(Cs(a,c),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(a," and dilations '").concat(c,"'")});var S=Vk(w.shape,y.shape,a,c,i,l),T;f!=null&&(T=B(f,"bias","fused conv2d"),e=we(Mr(T,g),1),T=e[0],s==="NHWC"?ln(S.outShape,T.shape):(G(T.shape.length<=1,function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+"rank-".concat(T.shape.length,".")}),G(T.shape.length===0||T.shape[0]===S.outChannels||T.shape[0]===1,function(){return"Error in fused conv2d: bias shape (".concat(T.shape,") is not ")+"compatible with the number of output channels "+"(".concat(S.outChannels,")")})));var E;if(d!=null){var C=d.shape;if(G(C.length<=1||C.length===3,function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+"rank-".concat(C.length,".")}),C.length===1)G(C[0]===1||C[0]===S.outChannels,function(){return"Error in fused conv2d: PReLU activation weights "+"(".concat(C,") is not compatible with the number of output ")+"channels (".concat(S.outChannels,").")});else if(C.length===3)try{ln(C,S.outShape)}catch{var R="Error in fused conv2d: PReLU activation weights (".concat(C,") ")+"is not compatible with the output shape of the conv2d "+"(".concat(S.outShape,").");throw Error(R)}E=B(d,"prelu weights","fused conv2d")}var _=function(L,U){G(s==="NHWC",function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(s," but only NHWC is currently supported.")});var Y=we(U,4),Z=Y[0],V=Y[1],X=Y[2],ne=Y[3],re=a2(L,X,p);G(Vm(c),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(c,"'")});var se=z$(V.shape,re,Z,a,i),le=Tze(V,re,Z.shape,a,i),de=[se,le];if(ne!=null){var ke=i2(ne,re);de.push(ke)}return de},M={x:w,filter:y,bias:T,preluActivationWeights:E},$={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:p,leakyreluAlpha:m};if(f==null){var z=_o(function(L,U,Y){var Z=Q.runKernel(Lz,M,$);return Y([U,L,Z]),b&&(Z=ge(Z,[Z.shape[1],Z.shape[2],Z.shape[3]])),{value:Z,gradFunc:_}});return z(w,y)}else{var q=_o(function(L,U,Y,Z){var V=Q.runKernel(Lz,M,$);return Z([U,L,V,Y]),b&&(V=ge(V,[V.shape[1],V.shape[2],V.shape[3]])),{value:V,gradFunc:_}});return q(w,y,T)}}var Ize=K({fusedConv2d_:Eze});function Cze(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=r;r.rank===3&&(s=ge(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={x:s,dy:u},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return Q.runKernel(RFe,c,l)}var Aze=K({depthwiseConv2dNativeBackpropFilter_:Cze});function Dze(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={dy:s,filter:t},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,inputShape:r},f=Q.runKernel(OFe,c,l);return u?ge(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var _ze=K({depthwiseConv2dNativeBackpropInput_:Dze});function Fze(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,c=u===void 0?[1,1]:u,l=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,m=r.leakyreluAlpha;if(s2(Q.state.gradientDepth,p)===!1){var v=Gk(t,n,a,i,s,c,l);return f!=null&&(v=cn(v,f)),o2(v,p,d,m)}var g=B(t,"x","depthwiseConv2d","float32"),y=B(n,"filter","depthwiseConv2d","float32"),w=g,b=!1;g.rank===3&&(b=!0,w=ge(g,[1,g.shape[0],g.shape[1],g.shape[2]])),G(w.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(w.rank,".")}),G(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+"but got rank ".concat(y.rank,".")}),G(w.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels "+"(".concat(w.shape[3],") must match the inChannels dimension in ")+"filter ".concat(y.shape[2],".")}),c==null&&(c=[1,1]),G(Cs(a,c),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+"be 1. Got strides ".concat(a," and dilations '").concat(c,"'")}),$i("fused depthwiseConv2d",i,l);var x=Vk(w.shape,y.shape,a,c,i,l,!0),S;f!=null&&(S=B(f,"bias","fused conv2d"),e=we(Mr(S,g),1),S=e[0],ln(x.outShape,S.shape));var T;d!=null&&(T=B(d,"prelu weights","fused depthwiseConv2d"));var E=function($,z){G(Vm(c),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(c,"'")});var q=we(z,4),L=q[0],U=q[1],Y=q[2],Z=q[3],V=a2($,Y,p),X=_ze(U.shape,V,L,a,i,c,l),ne=Aze(U,V,L.shape,a,i,c,l);if(Z!=null){var re=i2(S,V);return[X,ne,re]}return[X,ne]},C={x:w,filter:y,bias:S,preluActivationWeights:T},R={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:p,leakyreluAlpha:m};if(f==null){var _=_o(function($,z,q){var L=Q.runKernel(qz,C,R);return q([z,$,L]),b&&(L=ge(L,[L.shape[1],L.shape[2],L.shape[3]])),{value:L,gradFunc:E}});return _(w,y)}else{var M=_o(function($,z,q,L){var U=Q.runKernel(qz,C,R);return L([z,$,U,q]),b&&(U=ge(U,[U.shape[1],U.shape[2],U.shape[3]])),{value:U,gradFunc:E}});return M(w,y,S)}}var Rze=K({fusedDepthwiseConv2d_:Fze});function Oze(r){var e,t,n=r.a,a=r.b,i=r.transposeA,o=i===void 0?!1:i,s=r.transposeB,u=s===void 0?!1:s,c=r.bias,l=r.activation,f=l===void 0?"linear":l,h=r.preluActivationWeights,p=r.leakyreluAlpha,d=p===void 0?.2:p;if(s2(Q.state.gradientDepth,f)===!1){var m=Gt(n,a,o,u);return c!=null&&(m=cn(m,c)),o2(m,f,h,d)}var v=B(n,"a","fused matMul"),g=B(a,"b","fused matMul");e=we(Mr(v,g),2),v=e[0],g=e[1];var y=o?v.shape[v.rank-2]:v.shape[v.rank-1],w=u?g.shape[g.rank-1]:g.shape[g.rank-2],b=o?v.shape[v.rank-1]:v.shape[v.rank-2],x=u?g.shape[g.rank-2]:g.shape[g.rank-1],S=v.shape.slice(0,-2),T=g.shape.slice(0,-2),E=un(S),C=un(T);G(y===w,function(){return"Error in fused matMul: inner shapes (".concat(y,") and (")+"".concat(w,") of Tensors with shapes ").concat(v.shape," and ")+"".concat(g.shape," and transposeA=").concat(o)+" and transposeB=".concat(u," must match.")});var R=ln(v.shape.slice(0,-2),g.shape.slice(0,-2)),_=R.concat([b,x]),M=o?ge(v,[E,y,b]):ge(v,[E,b,y]),$=u?ge(g,[C,x,w]):ge(g,[C,w,x]),z;c!=null&&(z=B(c,"bias","fused matMul"),t=we(Mr(z,v),1),z=t[0],ln(_,z.shape));var q;h!=null&&(q=B(h,"prelu weights","fused matMul"));var L=function(X,ne){var re=we(ne,4),se=re[0],le=re[1],de=re[2],ke=re[3],he=a2(ge(X,de.shape),de,f),ye,xe;if(!o&&!u?(ye=Gt(he,le,!1,!0),xe=Gt(se,he,!0,!1)):!o&&u?(ye=Gt(he,le,!1,!1),xe=Gt(he,se,!0,!1)):o&&!u?(ye=Gt(le,he,!1,!0),xe=Gt(se,he,!1,!1)):(ye=Gt(le,he,!0,!0),xe=Gt(he,se,!0,!0)),c!=null){var De=i2(ke,he);return[ye,xe,De]}else return[ye,xe]},U={a:M,b:$,bias:z,preluActivationWeights:q},Y={transposeA:o,transposeB:u,activation:f,leakyreluAlpha:d};if(c==null){var Z=_o(function(X,ne,re){var se=Q.runKernel(Bz,U,Y);return re([X,ne,se]),{value:ge(se,_),gradFunc:L}});return Z(M,$)}else{var V=_o(function(X,ne,re,se){var le=Q.runKernel(Bz,U,Y);return se([X,ne,le,re]),{value:ge(le,_),gradFunc:L}});return V(M,$,z)}}var Pze=K({fusedMatMul_:Oze});var Mze={__proto__:null,conv2d:Ize,depthwiseConv2d:Rze,matMul:Pze};function Bze(r){return n2(r,.54,.46)}var Lze=K({hammingWindow_:Bze});function qze(r){return n2(r,.5,.5)}var xW=K({hannWindow_:qze});function zze(r,e,t,n,a){n===void 0&&(n=!1),a===void 0&&(a=0);for(var i=0,o=[];i+e<=r.size;)o.push(xr(r,i,e)),i+=t;if(n)for(;i<r.size;){var s=i+e-r.size,u=ya([xr(r,i,e-s),eg([s],a)]);o.push(u),i+=t}return o.length===0?Vh([],[0,e]):ge(ya(o),[o.length,e])}var kW=K({frame_:zze});function $ze(r,e,t,n,a){a===void 0&&(a=xW),n==null&&(n=wW(e));var i=kW(r,e,t),o=kt(i,a(e));return e2(o,n)}var Wze=K({stft_:$ze});function Uze(r,e,t,n,a,i){a===void 0&&(a="bilinear"),i===void 0&&(i=0);var o=B(r,"image","cropAndResize"),s=B(e,"boxes","cropAndResize","float32"),u=B(t,"boxInd","cropAndResize","int32"),c=s.shape[0];G(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),G(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] ")+"but had shape ".concat(s.shape,".")}),G(u.rank===1&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] ")+"but had shape ".concat(s.shape,".")}),G(n.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(n.length,".")}),G(n[0]>=1&&n[1]>=1,function(){return"cropSize must be atleast [1,1], but was ".concat(n)}),G(a==="bilinear"||a==="nearest",function(){return"method must be bilinear or nearest, but was ".concat(a)});var l={image:o,boxes:s,boxInd:u},f={method:a,extrapolationValue:i,cropSize:n},h=Q.runKernel(AFe,l,f);return h}var Vze=K({cropAndResize_:Uze});function Gze(r){var e=B(r,"image","flipLeftRight","float32");G(e.rank===4,function(){return"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(e.rank,".")});var t={image:e},n=Q.runKernel(jFe,t,{});return n}var Hze=K({flipLeftRight_:Gze});function jze(r){var e=B(r,"image","grayscaleToRGB"),t=e.rank-1,n=e.shape[t];G(e.rank>=2,function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(e.rank,".")}),G(n===1,function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(n,".")});var a=new Array(e.rank);return a.fill(1,0,t),a[t]=3,Uh(e,a)}var Kze=K({grayscaleToRGB_:jze});function Xze(r){var e=B(r,"image","RGBToGrayscale"),t=e.rank-1,n=e.shape[t];G(e.rank>=2,function(){return"Error in RGBToGrayscale: images must be at least rank 2, "+"but got rank ".concat(e.rank,".")}),G(n===3,function(){return"Error in RGBToGrayscale: last dimension of an RGB image "+"should be size 3, but got size ".concat(n,".")});var a=e.dtype,i=en(e,"float32"),o=pi([.2989,.587,.114]),s;switch(e.rank){case 2:s=ol("ij,j->i",i,o);break;case 3:s=ol("ijk,k->ij",i,o);break;case 4:s=ol("ijkl,l->ijk",i,o);break;case 5:s=ol("ijklm,m->ijkl",i,o);break;case 6:s=ol("ijklmn,n->ijklm",i,o);break;default:throw new Error("Not a valid tensor rank.")}return s=Ss(s,-1),en(s,a)}var Yze=K({rgbToGrayscale_:Xze});function Jze(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=.5);var a=B(r,"image","rotateWithOffset","float32");G(a.rank===4,function(){return"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,".")});var i={image:a},o={radians:e,fillValue:t,center:n},s=Q.runKernel(BOe,i,o);return s}var Zze=K({rotateWithOffset_:Jze});function ml(r,e,t,n,a,i){n==null&&(n=.5),a==null&&(a=Number.NEGATIVE_INFINITY),i==null&&(i=0);var o=r.shape[0];return t=Math.min(t,o),G(0<=n&&n<=1,function(){return"iouThreshold must be in [0, 1], but was '".concat(n,"'")}),G(r.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '".concat(r.rank,"'")}),G(r.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(r.shape[1])}),G(e.rank===1,function(){return"scores must be a 1D tensor"}),G(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(e.shape[0])}),G(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")}),{maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i}}function Qze(r,e,t,n,a){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var i=B(r,"boxes","nonMaxSuppression","float32"),o=B(e,"scores","nonMaxSuppression","float32"),s=ml(i,o,t,n,a);t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:n,scoreThreshold:a};return Q.runKernel(DRe,{boxes:i,scores:o},u)}var e$e=K({nonMaxSuppression_:Qze});function t$e(r,e,t){var n=r$e(r,e,t),a=n<0?-(n+1):n;r.splice(a,0,e)}function r$e(r,e,t){return a$e(r,e,t||n$e)}function n$e(r,e){return r>e?1:r<e?-1:0}function a$e(r,e,t){for(var n=0,a=r.length,i=0,o=!1;n<a;){i=n+(a-n>>>1);var s=t(e,r[i]);s>0?n=i+1:(a=i,o=!s)}return o?n:-n-1}function i$e(r,e,t,n,a){return u2(r,e,t,n,a,0)}function o$e(r,e,t,n,a,i){return u2(r,e,t,n,a,0,!1,i,!0)}function s$e(r,e,t,n,a,i){return u2(r,e,t,n,a,i,!0)}function u2(r,e,t,n,a,i,o,s,u){o===void 0&&(o=!1),s===void 0&&(s=!1),u===void 0&&(u=!1);for(var c=[],l=0;l<e.length;l++)e[l]>a&&c.push({score:e[l],boxIndex:l,suppressBeginIndex:0});c.sort(Qz);for(var f=i>0?-.5/i:0,h=[],p=[];h.length<t&&c.length>0;){var d=c.pop(),m=d.score,v=d.boxIndex,g=d.suppressBeginIndex;if(m<a)break;for(var y=!1,w=h.length-1;w>=g;--w){var b=u$e(r,v,h[w]);if(b>=n){y=!0;break}if(d.score=d.score*c$e(n,f,b),d.score<=a)break}d.suppressBeginIndex=h.length,y||(d.score===m?(h.push(v),p.push(d.score)):d.score>a&&t$e(c,d,Qz))}var x=h.length,S=t-x;s&&S>0&&(h.push.apply(h,Lt([],we(new Array(S).fill(0)),!1)),p.push.apply(p,Lt([],we(new Array(S).fill(0)),!1)));var T={selectedIndices:h};return o&&(T.selectedScores=p),u&&(T.validOutputs=x),T}function u$e(r,e,t){var n=r.subarray(e*4,e*4+4),a=r.subarray(t*4,t*4+4),i=Math.min(n[0],n[2]),o=Math.min(n[1],n[3]),s=Math.max(n[0],n[2]),u=Math.max(n[1],n[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),f=Math.max(a[0],a[2]),h=Math.max(a[1],a[3]),p=(s-i)*(u-o),d=(f-c)*(h-l);if(p<=0||d<=0)return 0;var m=Math.max(i,c),v=Math.max(o,l),g=Math.min(s,f),y=Math.min(u,h),w=Math.max(g-m,0)*Math.max(y-v,0);return w/(p+d-w)}function c$e(r,e,t){var n=Math.exp(e*t*t);return t<=r?n:0}function Qz(r,e){return r.score-e.score||r.score===e.score&&e.boxIndex-r.boxIndex}function l$e(r,e,t,n,a){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),_t(this,void 0,void 0,function(){var i,o,s,u,c,l,f;return Dt(this,function(h){switch(h.label){case 0:return i=B(r,"boxes","nonMaxSuppressionAsync"),o=B(e,"scores","nonMaxSuppressionAsync"),s=ml(i,o,t,n,a),t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold,[4,Promise.all([i.data(),o.data()])];case 1:return u=h.sent(),c=u[0],l=u[1],f=i$e(c,l,t,n,a).selectedIndices,i!==r&&i.dispose(),o!==e&&o.dispose(),[2,pi(f,"int32")]}})})}var f$e=l$e;function h$e(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var o=B(r,"boxes","nonMaxSuppression"),s=B(e,"scores","nonMaxSuppression"),u=ml(o,s,t,n,a,i);t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma;var c={boxes:o,scores:s},l={maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i},f=Q.runKernel(FRe,c,l);return{selectedIndices:f[0],selectedScores:f[1]}}var p$e=K({nonMaxSuppressionWithScore_:h$e});function d$e(r,e,t,n,a,i){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),_t(this,void 0,void 0,function(){var o,s,u,c,l,f,h,p,d;return Dt(this,function(m){switch(m.label){case 0:return o=B(r,"boxes","nonMaxSuppressionAsync"),s=B(e,"scores","nonMaxSuppressionAsync"),u=ml(o,s,t,n,a,i),t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return c=m.sent(),l=c[0],f=c[1],h=s$e(l,f,t,n,a,i),p=h.selectedIndices,d=h.selectedScores,o!==r&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:pi(p,"int32"),selectedScores:pi(d)}]}})})}var v$e=d$e;function m$e(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1);var o=B(r,"boxes","nonMaxSuppression"),s=B(e,"scores","nonMaxSuppression"),u=ml(o,s,t,n,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,h={boxes:o,scores:s},p={maxOutputSize:c,iouThreshold:l,scoreThreshold:f,padToMaxOutputSize:i},d=Q.runKernel(_Re,h,p);return{selectedIndices:d[0],validOutputs:d[1]}}var g$e=K({nonMaxSuppressionPadded_:m$e});function y$e(r,e,t,n,a,i){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1),_t(this,void 0,void 0,function(){var o,s,u,c,l,f,h,p,d,m,v,g;return Dt(this,function(y){switch(y.label){case 0:return o=B(r,"boxes","nonMaxSuppressionAsync"),s=B(e,"scores","nonMaxSuppressionAsync"),u=ml(o,s,t,n,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,[4,Promise.all([o.data(),s.data()])];case 1:return h=we.apply(void 0,[y.sent(),2]),p=h[0],d=h[1],m=o$e(p,d,c,l,f,i),v=m.selectedIndices,g=m.validOutputs,o!==r&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:pi(v,"int32"),validOutputs:zr(g,"int32")}]}})})}var b$e=y$e;function w$e(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=B(r,"images","resizeBilinear");G(a.rank===3||a.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),G(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(e,".")}),G(n===!1||t===!1,function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=ge(a,[1,a.shape[0],a.shape[1],a.shape[2]])),we(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},c=Q.runKernel(XRe,s,u);return o?ge(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var x$e=K({resizeBilinear_:w$e});function k$e(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=B(r,"images","resizeNearestNeighbor");G(a.rank===3||a.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),G(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(e,".")}),G(a.dtype==="float32"||a.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"}),G(n===!1||t===!1,function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=ge(a,[1,a.shape[0],a.shape[1],a.shape[2]])),we(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},c=Q.runKernel(KRe,s,u);return o?ge(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var S$e=K({resizeNearestNeighbor_:k$e});function N$e(r,e,t,n){var a;e===void 0&&(e="binary"),t===void 0&&(t=!1),n===void 0&&(n=.5);var i=B(r,"image","threshold"),o=.2989,s=.587,u=.114,c=i.shape[0]*i.shape[1],l=kt(pi([n]),255),f,h,p,d;if(G(i.rank===3,function(){return"Error in threshold: image must be rank 3,"+"but got rank ".concat(i.rank,".")}),G(i.shape[2]===3||i.shape[2]===1,function(){return"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(i.shape[2],".")}),G(i.dtype==="int32"||i.dtype==="float32",function(){return"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(i.dtype,".")}),G(e==="otsu"||e==="binary",function(){return"Method must be binary or otsu, but was ".concat(e)}),i.shape[2]===3){a=we(Jh(i,[1,1,1],-1),3),f=a[0],h=a[1],p=a[2];var m=kt(f,o),v=kt(h,s),g=kt(p,u);d=cn(cn(m,v),g)}else d=r;if(e==="otsu"){var y=q$(en(dW(d),"int32"),fl([]),256);l=T$e(y,c)}var w=t?Kk(d,l):ig(d,l),b=en(kt(w,255),"int32");return b}function T$e(r,e){for(var t=pi([-1]),n=pi([0]),a=pi([0]),i,o,s,u,c,l,f=0;f<r.size-1;f++){i=xr(r,0,f+1),o=xr(r,f+1),c=Rn(ur(i),e),l=Rn(ur(o),e);var h=ur(kt(i,Xh(0,i.size)));s=Rn(h,ur(i));var p=eg(o.shape,i.size),d=cn(Xh(0,o.size),p),m=kt(o,d);u=Rn(ur(m),ur(o));var v=Pt(s,u),g=Pt(s,u),y=kt(c,l);a=kt(kt(y,v),g);var w=ig(a,n);n=Ns(w,a,n),t=Ns(w,pi([f]),t)}return t}var E$e=K({threshold_:N$e});function I$e(r,e,t,n,a,i){t===void 0&&(t="nearest"),n===void 0&&(n="constant"),a===void 0&&(a=0);var o=B(r,"image","transform","float32"),s=B(e,"transforms","transform","float32");G(o.rank===4,function(){return"Error in transform: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),G(s.rank===2&&(s.shape[0]===o.shape[0]||s.shape[0]===1)&&s.shape[1]===8,function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"}),G(i==null||i.length===2,function(){return"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(i,".")});var u={image:o,transforms:s},c={interpolation:t,fillMode:n,fillValue:a,outputShape:i};return Q.runKernel(_Oe,u,c)}var C$e=K({transform_:I$e});function A$e(r,e,t){var n=B(r,"a","bandPart");G(n.rank>=2,function(){return"bandPart(): Rank must be at least 2, got ".concat(n.rank,".")});var a=n.shape,i=we(n.shape.slice(-2),2),o=i[0],s=i[1],u,c;typeof e=="number"?(G(e%1===0,function(){return"bandPart(): numLower must be an integer, got ".concat(e,".")}),G(e<=o,function(){return"bandPart(): numLower (".concat(e,")")+" must not be greater than the number of rows (".concat(o,").")}),u=B(e<0?o:e,"numLower","bandPart")):(G(e.dtype==="int32",function(){return"bandPart(): numLower's dtype must be an int32."}),u=Ns(_k(e,0),o,jm(e,o))),typeof t=="number"?(G(t%1===0,function(){return"bandPart(): numUpper must be an integer, got ".concat(t,".")}),G(t<=s,function(){return"bandPart(): numUpper (".concat(t,")")+" must not be greater than the number of columns (".concat(s,").")}),c=B(t<0?s:t,"numUpper","bandPart")):(G(t.dtype==="int32",function(){return"bandPart(): numUpper's dtype must be an int32."}),c=Ns(_k(t,0),s,jm(t,s)));var l=ge(Xh(0,o,1,"int32"),[-1,1]),f=Xh(0,s,1,"int32"),h=Pt(l,f),p=Gm(Kk(h,u),K$(h,ro(c))),d=dl([o,s],n.dtype);return ge(Zh(r2(ge(n,[-1,o,s])).map(function(m){return Ns(p,m,d)})),a)}var D$e=K({bandPart_:A$e});function _$e(r){var e;if(Array.isArray(r)){e=!1,G(r!=null&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=r[0].shape[0],n=function(u){G(r[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(r[u].shape[0]," vs. ").concat(t,")")})},a=1;a<r.length;++a)n(a)}else e=!0,r=Jh(r,r.shape[0],0).map(function(u){return t2(u,[0])});G(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors (".concat(r.length,") exceeds ")+"number of dimensions (".concat(r[0].shape[0],").")});for(var i=[],o=r,s=function(u){i.push(Q.tidy(function(){var c=o[u];if(u>0)for(var l=0;l<u;++l){var f=kt(ur(kt(i[l],c)),i[l]);c=Pt(c,f)}return Rn(c,ag(c,"euclidean"))}))},a=0;a<r.length;++a)s(a);return e?Zh(i,0):i}var F$e=K({gramSchmidt_:_$e});function R$e(r,e){if(e===void 0&&(e=!1),G(r.rank>=2,function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(r.rank)}),r.rank===2)return e$(r,e);var t=r.shape.slice(0,r.shape.length-2).reduce(function(u,c){return u*c}),n=r2(ge(r,[t,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),a=[],i=[];n.forEach(function(u){var c=we(e$(u,e),2),l=c[0],f=c[1];a.push(l),i.push(f)});var o=ge(Zh(a,0),r.shape),s=ge(Zh(i,0),r.shape);return[o,s]}function e$(r,e){return e===void 0&&(e=!1),Q.tidy(function(){G(r.shape.length===2,function(){return"qr2d() requires a 2D Tensor, but got a ".concat(r.shape.length,"D Tensor.")});for(var t=r.shape[0],n=r.shape[1],a=G$(t),i=ul(r),o=Vh([[1]],[1,1]),s=ul(o),u=t>=n?n:t,c=function(f){var h,p=i,d=s,m=a;h=we(Q.tidy(function(){var v=xr(i,[f,f],[t-f,1]),g=ag(v),y=xr(i,[f,f],[1,1]),w=Ns(ig(y,0),Vh([[-1]]),Vh([[1]])),b=Pt(y,kt(w,g)),x=Rn(v,b);x.shape[0]===1?s=ul(o):s=ya([o,xr(x,[1,0],[x.shape[0]-1,x.shape[1]])],0);var S=ro(Rn(Gt(w,b),g)),T=xr(i,[f,0],[t-f,n]),E=kt(S,s),C=Fk(s);if(f===0)i=Pt(T,Gt(E,Gt(C,T)));else{var R=Pt(T,Gt(E,Gt(C,T)));i=ya([xr(i,[0,0],[f,n]),R],0)}var _=Fk(E),M=xr(a,[0,f],[t,a.shape[1]-f]);if(f===0)a=Pt(M,Gt(Gt(M,s),_));else{var $=Pt(M,Gt(Gt(M,s),_));a=ya([xr(a,[0,0],[t,f]),$],1)}return[s,i,a]}),3),s=h[0],i=h[1],a=h[2],oze([p,d,m])},l=0;l<u;++l)c(l);return!e&&t>n&&(a=xr(a,[0,0],[t,n]),i=xr(i,[0,0],[n,n])),[a,i]})}var O$e=K({qr_:R$e});var Hn;(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Hn||(Hn={}));function P$e(r,e,t){t===void 0&&(t=Hn.SUM_BY_NONZERO_WEIGHTS);var n=B(r,"losses","computeWeightedLoss"),a=null;e!=null&&(a=B(e,"weights","computeWeightedLoss"));var i=a==null?n:kt(n,a);if(t===Hn.NONE)return i;if(t===Hn.SUM)return ur(i);if(t===Hn.MEAN){if(a==null)return Hm(i);var o=n.size/a.size,s=Rn(ur(i),ur(a));return o>1?Rn(s,zr(o)):s}if(t===Hn.SUM_BY_NONZERO_WEIGHTS){if(a==null)return Rn(ur(i),zr(n.size));var u=kt(a,Mu(n.shape)),c=en(ur(rW(u,zr(0))),"float32");return Rn(ur(i),c)}throw Error("Unknown reduction: ".concat(t))}var Fo=K({computeWeightedLoss_:P$e});function M$e(r,e,t,n){n===void 0&&(n=Hn.SUM_BY_NONZERO_WEIGHTS);var a=B(r,"labels","absoluteDifference"),i=B(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=B(t,"weights","absoluteDifference")),di(a.shape,i.shape,"Error in absoluteDifference: ");var s=ui(Pt(a,i));return Fo(s,o,n)}var B$e=K({absoluteDifference_:M$e});function L$e(r,e,t,n,a){a===void 0&&(a=Hn.SUM_BY_NONZERO_WEIGHTS);var i=B(r,"labels","cosineDistance"),o=B(e,"predictions","cosineDistance"),s=null;n!=null&&(s=B(n,"weights","cosineDistance")),di(i.shape,o.shape,"Error in cosineDistance: ");var u=zr(1),c=Pt(u,ur(kt(i,o),t,!0));return Fo(c,s,a)}var q$e=K({cosineDistance_:L$e});function z$e(r,e,t,n){n===void 0&&(n=Hn.SUM_BY_NONZERO_WEIGHTS);var a=B(r,"labels","hingeLoss"),i=B(e,"predictions","hingeLoss"),o=null;t!=null&&(o=B(t,"weights","hingeLoss")),di(a.shape,i.shape,"Error in hingeLoss: ");var s=zr(1);a=Pt(kt(zr(2),a),s);var u=sg(Pt(s,kt(a,i)));return Fo(u,o,n)}var $$e=K({hingeLoss_:z$e});function W$e(r,e,t,n,a){n===void 0&&(n=1),a===void 0&&(a=Hn.SUM_BY_NONZERO_WEIGHTS);var i=B(r,"labels","huberLoss"),o=B(e,"predictions","huberLoss"),s=null;t!=null&&(s=B(t,"weights","huberLoss")),di(i.shape,o.shape,"Error in huberLoss: ");var u=zr(n),c=ui(Pt(o,i)),l=jm(c,u),f=Pt(c,l),h=cn(kt(zr(.5),ng(l)),kt(u,f));return Fo(h,s,a)}var U$e=K({huberLoss_:W$e});function V$e(r,e,t,n,a){n===void 0&&(n=1e-7),a===void 0&&(a=Hn.SUM_BY_NONZERO_WEIGHTS);var i=B(r,"labels","logLoss"),o=B(e,"predictions","logLoss"),s=null;t!=null&&(s=B(t,"weights","logLoss")),di(i.shape,o.shape,"Error in logLoss: ");var u=zr(1),c=zr(n),l=ro(kt(i,Kh(cn(o,c)))),f=kt(Pt(u,i),Kh(cn(Pt(u,o),c))),h=Pt(l,f);return Fo(h,s,a)}var G$e=K({logLoss_:V$e});function H$e(r,e,t,n){n===void 0&&(n=Hn.SUM_BY_NONZERO_WEIGHTS);var a=B(r,"labels","meanSquaredError"),i=B(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=B(t,"weights","meanSquaredError")),di(a.shape,i.shape,"Error in meanSquaredError: ");var s=mW(a,i);return Fo(s,o,n)}var j$e=K({meanSquaredError_:H$e});function K$e(r,e){var t=B(r,"labels","sigmoidCrossEntropyWithLogits"),n=B(e,"logits","sigmoidCrossEntropyWithLogits");di(t.shape,n.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=sg(n),i=kt(n,t),o=Y$(Bu(ro(ui(n))));return cn(Pt(a,i),o)}function X$e(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=Hn.SUM_BY_NONZERO_WEIGHTS);var i=B(r,"multiClassLabels","sigmoidCrossEntropy"),o=B(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=B(t,"weights","sigmoidCrossEntropy")),di(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),n>0){var u=zr(n),c=zr(1),l=zr(.5);i=cn(kt(i,Pt(c,u)),kt(l,u))}var f=K$e(i,o);return Fo(f,s,a)}var Y$e=K({sigmoidCrossEntropy_:X$e});function J$e(r,e,t){if(t===void 0&&(t=-1),t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(e.rank," ")+"and dim was ".concat(t));var n=_o(function(a,i,o){var s=!0,u=Z$(i,[t],s),c=Pt(en(i,"float32"),u);o([a,c]);var l=ro(kt(c,a)),f=ur(l,[t]),h=function(p,d){var m=we(d,2),v=m[0],g=m[1],y=rg(p.shape,[t]);return[kt(ge(p,y),Pt(en(v,"float32"),Bu(g))),kt(ge(p,y),Pt(Bu(g),en(v,"float32")))]};return{value:f,gradFunc:h}});return n(r,e)}function Z$e(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=Hn.SUM_BY_NONZERO_WEIGHTS);var i=B(r,"onehotLabels","softmaxCrossEntropy"),o=B(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=B(t,"weights","softmaxCrossEntropy")),di(i.shape,o.shape,"Error in softmaxCrossEntropy: "),n>0){var u=zr(n),c=zr(1),l=zr(i.shape[1]);i=cn(kt(i,Pt(c,u)),Rn(u,l))}var f=J$e(i,o);return Fo(f,s,a)}var Q$e=K({softmaxCrossEntropy_:Z$e});function eWe(r,e,t,n){var a=B(r,"indices","sparseFillEmptyRows","int32"),i=B(e,"values","sparseFillEmptyRows"),o=B(t,"denseShape","sparseFillEmptyRows","int32"),s=B(n,"defaultValue","sparseFillEmptyRows",i.dtype);if(a.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        `.concat(a.shape));if(i.rank!==1)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(o.rank!==1)throw new Error("Dense shape should be Tensor1D but received shape ".concat(o.shape));if(s.rank!==0)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));var u={indices:a,values:i,denseShape:o,defaultValue:s},c=Q.runKernel(mOe,u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}var tWe=K({sparseFillEmptyRows_:eWe});function rWe(r,e,t){var n=B(r,"inputIndices","sparseReshape","int32"),a=B(e,"inputShape","sparseReshape","int32"),i=B(t,"newShape","sparseReshape","int32");if(n.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        `.concat(n.shape));if(a.rank!==1)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(i.rank!==1)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));var o={inputIndices:n,inputShape:a,newShape:i},s=Q.runKernel(gOe,o);return{outputIndices:s[0],outputShape:s[1]}}var nWe=K({sparseReshape_:rWe});function aWe(r,e,t){var n=B(r,"data","sparseSegmentMean"),a=B(e,"indices","sparseSegmentMean","int32"),i=B(t,"segmentIds","sparseSegmentMean","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          `.concat(i.shape));var o={data:n,indices:a,segmentIds:i};return Q.runKernel(yOe,o)}var iWe=K({sparseSegmentMean_:aWe});function oWe(r,e,t){var n=B(r,"data","sparseSegmentSum"),a=B(e,"indices","sparseSegmentSum","int32"),i=B(t,"segmentIds","sparseSegmentSum","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         `.concat(i.shape));var o={data:n,indices:a,segmentIds:i};return Q.runKernel(bOe,o)}var sWe=K({sparseSegmentSum_:oWe});function uWe(r,e,t,n,a,i,o,s){var u=B(r,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error("Data must be a vector, saw: ".concat(u.shape));var c=B(e,"dataSplits","stringNGrams");if(c.dtype!=="int32")throw new Error("Data splits must be of datatype int32");var l={separator:t,nGramWidths:n,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},f={data:u,dataSplits:c},h=Q.runKernel(NOe,f,l);return{nGrams:h[0],nGramsSplits:h[1]}}var cWe=K({stringNGrams_:uWe});function lWe(r,e,t){t===void 0&&(t=!0);var n=B(r,"input","stringSplit","string"),a=B(e,"delimiter","stringSplit","string");if(n.rank!==1)throw new Error("Input should be Tensor1D but received shape ".concat(n.shape));if(a.rank!==0)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));var i={skipEmpty:t},o={input:n,delimiter:a},s=Q.runKernel(TOe,o,i);return{indices:s[0],values:s[1],shape:s[2]}}var fWe=K({stringSplit_:lWe});function hWe(r,e){var t=B(r,"input","stringToHashBucketFast","string"),n={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");var a={input:t};return Q.runKernel(EOe,a,n)}var pWe=K({stringToHashBucketFast_:hWe});function dWe(r,e,t,n){n===void 0&&(n=!0);var a=B(r,"input","staticRegexReplace","string"),i={pattern:e,rewrite:t,replaceGlobal:n};return Q.runKernel(kOe,{x:a},i)}var vWe=K({staticRegexReplace_:dWe});var mWe={fft:Qk,ifft:Km,rfft:e2,irfft:vW},gWe={hammingWindow:Lze,hannWindow:xW,frame:kW,stft:Wze},yWe={flipLeftRight:Hze,grayscaleToRGB:Kze,resizeNearestNeighbor:S$e,resizeBilinear:x$e,rgbToGrayscale:Yze,rotateWithOffset:Zze,cropAndResize:Vze,nonMaxSuppression:e$e,nonMaxSuppressionAsync:f$e,nonMaxSuppressionWithScore:p$e,nonMaxSuppressionWithScoreAsync:v$e,nonMaxSuppressionPadded:g$e,nonMaxSuppressionPaddedAsync:b$e,threshold:E$e,transform:C$e},bWe={bandPart:D$e,gramSchmidt:F$e,qr:O$e},wWe={absoluteDifference:B$e,computeWeightedLoss:Fo,cosineDistance:q$e,hingeLoss:$$e,huberLoss:U$e,logLoss:G$e,meanSquaredError:j$e,sigmoidCrossEntropy:Y$e,softmaxCrossEntropy:Q$e},xWe={sparseFillEmptyRows:tWe,sparseReshape:nWe,sparseSegmentMean:iWe,sparseSegmentSum:sWe},kWe={stringNGrams:cWe,stringSplit:fWe,stringToHashBucketFast:pWe,staticRegexReplace:vWe};var bn={__proto__:null,OP_SCOPE_SUFFIX:M$,abs:ui,acos:fPe,acosh:pPe,add:cn,addN:mPe,all:yPe,any:wPe,argMax:kPe,argMin:NPe,asin:EPe,asinh:CPe,atan:DPe,atan2:FPe,atanh:OPe,avgPool:B$,avgPool3d:UPe,basicLSTMCell:ZPe,batchNorm:Qm,batchNorm2d:nMe,batchNorm3d:iMe,batchNorm4d:sMe,batchToSpaceND:L$,bincount:q$,bitwiseAnd:lMe,booleanMaskAsync:aze,broadcastArgs:hMe,broadcastTo:Lm,buffer:Ts,cast:en,ceil:vMe,clipByValue:gMe,clone:ul,complex:Es,concat:ya,concat1d:wMe,concat2d:kMe,concat3d:NMe,concat4d:EMe,conv1d:AMe,conv2d:tg,conv2dTranspose:FMe,conv3d:OMe,conv3dTranspose:LMe,cos:zMe,cosh:WMe,cosineWindow:n2,cumprod:VMe,cumsum:HMe,denseBincount:KMe,depthToSpace:YMe,depthwiseConv2d:Gk,diag:QMe,dilation2d:t4e,div:Rn,divNoNan:c4e,dot:f4e,dropout:xze,einsum:ol,elu:U$,enclosingPowerOfTwo:wW,ensureShape:v4e,equal:W$,erf:g4e,euclideanNorm:I4e,exp:Bu,expandDims:Ss,expm1:_4e,eye:G$,fft:Qk,fill:eg,floor:H$,floorDiv:$$,fused:Mze,gather:j$,gatherND:yze,greater:ig,greaterEqual:K$,ifft:Km,imag:og,image:yWe,inTopKAsync:Sze,irfft:vW,isFinite:z4e,isInf:W4e,isNaN:V4e,leakyRelu:X$,less:_k,lessEqual:Kk,linalg:bWe,linspace:K4e,localResponseNormalization:Y4e,log:Kh,log1p:Y$,logSigmoid:rBe,logSoftmax:iBe,logSumExp:Z$,logicalAnd:Gm,logicalNot:Q$,logicalOr:eW,logicalXor:fBe,losses:wWe,lowerBound:pBe,matMul:Gt,max:ll,maxPool:tW,maxPool3d:mBe,maxPoolWithArgmax:yBe,maximum:wBe,mean:Hm,meshgrid:kBe,min:Ak,minimum:jm,mirrorPad:TBe,mod:IBe,moments:ABe,movingAverage:fze,mul:kt,multiRNNCell:_Be,multinomial:RBe,neg:ro,norm:ag,notEqual:rW,oneHot:MBe,ones:Mu,onesLike:LBe,op:K,outerProduct:zBe,pad:Qh,pad1d:UBe,pad2d:GBe,pad3d:jBe,pad4d:XBe,pool:eLe,pow:jk,prelu:aW,print:rLe,prod:aLe,raggedGather:oLe,raggedRange:uLe,raggedTensorToTensor:lLe,rand:hLe,randomGamma:FLe,randomNormal:hW,randomStandardNormal:PLe,randomUniform:Zk,randomUniformInt:LLe,range:Xh,real:Yh,reciprocal:$Le,relu:sg,relu6:pW,reshape:ge,reverse:Lu,reverse1d:HLe,reverse2d:KLe,reverse3d:YLe,reverse4d:ZLe,rfft:e2,round:dW,rsqrt:tqe,scalar:zr,scatterND:pze,searchSorted:Xk,selu:nqe,separableConv2d:iqe,setdiff1dAsync:sqe,sigmoid:cl,sign:cqe,signal:gWe,sin:fqe,sinh:pqe,slice:xr,slice1d:vqe,slice2d:gqe,slice3d:bqe,slice4d:xqe,softmax:Sqe,softplus:J$,spaceToBatchND:nW,sparse:xWe,sparseToDense:mze,spectral:mWe,split:Jh,sqrt:Dk,square:ng,squaredDifference:mW,squeeze:t2,stack:Zh,step:gW,stridedSlice:Oqe,string:kWe,sub:Pt,sum:ur,tan:Mqe,tanh:Ck,tensor:fl,tensor1d:pi,tensor2d:Vh,tensor3d:Bqe,tensor4d:Lqe,tensor5d:qqe,tensor6d:zqe,tensorScatterUpdate:Uqe,tile:Uh,topk:Gqe,transpose:Fk,truncatedNormal:jqe,unique:Xqe,unsortedSegmentSum:Jqe,unstack:r2,upperBound:Qqe,variable:eze,where:Ns,whereAsync:bW,zeros:dl,zerosLike:Hk};var SWe=function(r,e,t,n){switch(n===void 0&&(n=bn),r.op){case"BiasAdd":case"AddV2":case"Add":return[n.add(I("a",r,e,t),I("b",r,e,t))];case"AddN":return[n.addN(I("tensors",r,e,t))];case"FloorMod":case"Mod":return[n.mod(I("a",r,e,t),I("b",r,e,t))];case"Mul":return[n.mul(I("a",r,e,t),I("b",r,e,t))];case"RealDiv":case"Div":return[n.div(I("a",r,e,t),I("b",r,e,t))];case"DivNoNan":return[n.divNoNan(I("a",r,e,t),I("b",r,e,t))];case"FloorDiv":return[n.floorDiv(I("a",r,e,t),I("b",r,e,t))];case"Sub":return[n.sub(I("a",r,e,t),I("b",r,e,t))];case"Minimum":return[n.minimum(I("a",r,e,t),I("b",r,e,t))];case"Maximum":return[n.maximum(I("a",r,e,t),I("b",r,e,t))];case"Pow":return[n.pow(I("a",r,e,t),I("b",r,e,t))];case"SquaredDifference":return[n.squaredDifference(I("a",r,e,t),I("b",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var NWe=function(r,e,t,n){switch(n===void 0&&(n=bn),r.op){case"Abs":case"ComplexAbs":return[n.abs(I("x",r,e,t))];case"Acos":return[n.acos(I("x",r,e,t))];case"Acosh":return[n.acosh(I("x",r,e,t))];case"Asin":return[n.asin(I("x",r,e,t))];case"Asinh":return[n.asinh(I("x",r,e,t))];case"Atan":return[n.atan(I("x",r,e,t))];case"Atan2":return[n.atan2(I("x",r,e,t),I("y",r,e,t))];case"Atanh":return[n.atanh(I("x",r,e,t))];case"Ceil":return[n.ceil(I("x",r,e,t))];case"Complex":return[n.complex(I("real",r,e,t),I("imag",r,e,t))];case"Cos":return[n.cos(I("x",r,e,t))];case"Cosh":return[n.cosh(I("x",r,e,t))];case"Elu":return[n.elu(I("x",r,e,t))];case"Erf":return[n.erf(I("x",r,e,t))];case"Exp":return[n.exp(I("x",r,e,t))];case"Expm1":return[n.expm1(I("x",r,e,t))];case"Floor":return[n.floor(I("x",r,e,t))];case"Log":return[n.log(I("x",r,e,t))];case"Log1p":return[n.log1p(I("x",r,e,t))];case"Imag":return[n.imag(I("x",r,e,t))];case"Neg":return[n.neg(I("x",r,e,t))];case"Reciprocal":return[n.reciprocal(I("x",r,e,t))];case"Real":return[n.real(I("x",r,e,t))];case"Relu":return[n.relu(I("x",r,e,t))];case"Round":return[n.round(I("x",r,e,t))];case"Selu":return[n.selu(I("x",r,e,t))];case"Sigmoid":return[n.sigmoid(I("x",r,e,t))];case"Sin":return[n.sin(I("x",r,e,t))];case"Sign":return[n.sign(I("x",r,e,t))];case"Sinh":return[n.sinh(I("x",r,e,t))];case"Softplus":return[n.softplus(I("x",r,e,t))];case"Sqrt":return[n.sqrt(I("x",r,e,t))];case"Square":return[n.square(I("x",r,e,t))];case"Tanh":return[n.tanh(I("x",r,e,t))];case"Tan":return[n.tan(I("x",r,e,t))];case"ClipByValue":return[n.clipByValue(I("x",r,e,t),I("clipValueMin",r,e,t),I("clipValueMax",r,e,t))];case"Relu6":return[n.relu6(I("x",r,e,t))];case"Rsqrt":return[n.rsqrt(yn(r.inputNames[0],e,t))];case"LeakyRelu":return[n.leakyRelu(I("x",r,e,t),I("alpha",r,e,t))];case"Prelu":return[n.prelu(I("x",r,e,t),I("alpha",r,e,t))];case"IsNan":return[n.isNaN(yn(r.inputNames[0],e,t))];case"IsInf":return[n.isInf(yn(r.inputNames[0],e,t))];case"IsFinite":return[n.isFinite(yn(r.inputNames[0],e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};function ci(r,e,t){if(t===void 0&&(t=""),!(typeof r=="number"||typeof e=="number")){Be.util.assert(r.length===e.length,function(){return t+" Shapes ".concat(r," and ").concat(e," must match")});for(var n=0;n<r.length;n++){var a=r[n],i=e[n];Be.util.assert(a<0||i<0||a===i,function(){return t+" Shapes ".concat(r," and ").concat(e," must match")})}}}function t$(r){return!(typeof r=="number"||r.some(function(e){return e<0}))}function zh(r,e,t){var n=Rk(r,t),a=!t$(n);if(a&&e.length===0)throw new Error("Tried to calculate elements of an empty list"+" with non-fully-defined elementShape: ".concat(n));if(a&&e.forEach(function(i){n=Rk(i.shape,n)}),!t$(n))throw new Error("Non-fully-defined elementShape: ".concat(n));return n}function Rk(r,e){if(typeof r=="number")return e;if(typeof e=="number")return r;if(r.length!==e.length)throw new Error("Incompatible ranks during merge: ".concat(r," vs. ").concat(e));for(var t=[],n=0;n<r.length;++n){var a=r[n],i=e[n];if(a>=0&&i>=0&&a!==i)throw new Error("Incompatible shape during merge: ".concat(r," vs. ").concat(e));t[n]=a>=0?a:i}return t}var TWe=function(){function r(e,t,n,a,i,o,s){this.name=e,this.dtype=t,this.maxSize=n,this.elementShape=a,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=Be.scalar(0),Be.keep(this.idTensor)}return Object.defineProperty(r.prototype,"id",{get:function(){return this.idTensor.id},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"closed",{get:function(){return this.closed_},enumerable:!1,configurable:!0}),r.prototype.clearAndClose=function(e){this.tensors.forEach(function(t){(e==null||!e.has(t.tensor.id))&&t.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()},r.prototype.size=function(){return this.tensors.length},r.prototype.read=function(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read ")+"(perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor},r.prototype.readMany=function(e){var t=this;return e.map(function(n){return t.read(n)})},r.prototype.write=function(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,`,
          because the value dtype is `).concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=t.shape),ci(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),n.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(n.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));n.tensor=t,Be.keep(t),n.written=!0,this.tensors[e]=n},r.prototype.writeMany=function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,")+"because the index size: ".concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach(function(a,i){return n.write(a,t[i])})},r.prototype.gather=function(e,t){if(!!t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(var n=0;n<this.size();n++)e.push(n)}if(e.length===0)return Be.tensor([],[0].concat(this.elementShape));var a=this.readMany(e);return ci(this.elementShape,a[0].shape,"TensorArray shape mismatch: "),Be.stack(a,0)},r.prototype.concat=function(e){if(!!e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(this.size()===0)return Be.tensor([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var a=this.readMany(t);return ci(this.elementShape,a[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(a[0].shape,")")),Be.concat(a,0)},r.prototype.scatter=function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));var n=Math.max.apply(Math,Lt([],we(e),!1));if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size (".concat(n,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,Be.unstack(t,0))},r.prototype.split=function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));var a=0,i=e.map(function(l){return a+=l,a});if(a!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        `.concat(a,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), ")+"and the TensorArray is not marked as dynamically resizeable");var o=a===0?0:t.size/a,s=[];Be.tidy(function(){t=Be.reshape(t,[1,a,o]);for(var l=0;l<e.length;++l){var f=l===0?0:i[l-1],h=[0,f,0],p=[1,e[l],o];s[l]=Be.reshape(Be.slice(t,h,p),n.elementShape)}return s});for(var u=[],c=0;c<e.length;c++)u[c]=c;this.writeMany(u,s)},r}(),ug=function(){function r(e,t,n,a){a===void 0&&(a=-1),this.tensors=e,this.elementShape=t,this.elementDtype=n,e?.forEach(function(i){if(n!==i.dtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(i.dtype));ci(t,i.shape,"TensorList shape mismatch: "),Be.keep(i)}),this.idTensor=Be.scalar(0),this.maxNumElements=a,Be.keep(this.idTensor)}return Object.defineProperty(r.prototype,"id",{get:function(){return this.idTensor.id},enumerable:!1,configurable:!0}),r.prototype.copy=function(){return new r(Lt([],we(this.tensors),!1),this.elementShape,this.elementDtype)},r.prototype.clearAndClose=function(e){this.tensors.forEach(function(t){(e==null||!e.has(t.id))&&t.dispose()}),this.tensors.length=0,this.idTensor.dispose()},r.prototype.size=function(){return this.tensors.length},r.prototype.stack=function(e,t,n){var a=this;if(n===void 0&&(n=-1),t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(n!==-1&&this.tensors.length!==n)throw new Error("Operation expected a list with ".concat(n," elements but got a list with ").concat(this.tensors.length," elements."));ci(e,this.elementShape,"TensorList shape mismatch: ");var i=zh(this.elementShape,this.tensors,e);return Be.tidy(function(){var o=a.tensors.map(function(s){return Be.reshape(s,i)});return Be.stack(o,0)})},r.prototype.popBack=function(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(this.size()===0)throw new Error("Trying to pop from an empty list.");var n=zh(this.elementShape,this.tensors,e),a=this.tensors.pop();return a.kept=!1,ci(a.shape,e,"TensorList shape mismatch: "),Be.reshape(a,n)},r.prototype.pushBack=function(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(this.elementDtype));if(ci(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Be.keep(e),this.tensors.push(e)},r.prototype.resize=function(e){if(e<0)throw new Error("TensorListResize expects size to be non-negative. Got: ".concat(e));if(this.maxNumElements!==-1&&e>this.maxNumElements)throw new Error("TensorListResize input size ".concat(e," is greater maxNumElement ").concat(this.maxNumElements,"."));var t=new r([],this.elementShape,this.elementDtype,this.maxNumElements);t.tensors.length=e;for(var n=0;n<Math.min(this.tensors.length,e);++n)t.tensors[n]=this.tensors[n];return t},r.prototype.getItem=function(e,t,n){if(n!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(this.elementDtype));if(e<0||e>this.tensors.length)throw new Error("Trying to access element ".concat(e," in a list with ").concat(this.tensors.length," elements."));if(this.tensors[e]==null)throw new Error("element at index ".concat(e," is null."));ci(this.tensors[e].shape,t,"TensorList shape mismatch: ");var a=zh(this.elementShape,this.tensors,t);return Be.reshape(this.tensors[e],a)},r.prototype.setItem=function(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t.dtype,", but list elements ").concat(this.elementDtype));if(e<0||this.maxNumElements!==-1&&e>=this.maxNumElements)throw new Error("Trying to set element ".concat(e," in a list with max ").concat(this.maxNumElements," elements."));ci(this.elementShape,t.shape,"TensorList shape mismatch: "),Be.keep(t),this.tensors[e]!=null&&(this.tensors[e].kept=!1),this.tensors[e]=t},r.prototype.gather=function(e,t,n){var a=this;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));ci(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());var i=zh(this.elementShape,this.tensors,n);return e.length===0?Be.tensor([],[0].concat(i)):Be.tidy(function(){var o=e.map(function(s){return Be.reshape(a.tensors[s],i)});return Be.stack(o,0)})},r.prototype.concat=function(e,t){var n=this;if(!!e&&e!==this.elementDtype)throw new Error("TensorList dtype is ".concat(this.elementDtype," but concat requested dtype ").concat(e));ci(this.elementShape,t,"TensorList shape mismatch: ");var a=zh(this.elementShape,this.tensors,t);return this.size()===0?Be.tensor([],[0].concat(a)):Be.tidy(function(){var i=n.tensors.map(function(o){return Be.reshape(o,a)});return Be.concat(i,0)})},r}();function EWe(r,e,t){var n=r.dtype;if(r.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: ".concat(r.shape));if(r.dtype!==t)throw new Error("Invalid data types; op elements ".concat(r.dtype,", but list elements ").concat(t));var a=r.shape.slice(1);ci(a,e,"TensorList shape mismatch: ");var i=Be.unstack(r);return new ug(i,e,n)}function IWe(r,e,t,n){return new ug([],r,e,n)}function CWe(r,e,t,n){if(e.length!==r.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(r.shape[0]));var a=Math.max.apply(Math,Lt([],we(e),!1));if(n!=null&&n!==-1&&a>=n)throw new Error("Max index must be < array size (".concat(a,"  vs. ").concat(n,")"));var i=new ug([],t,r.dtype,n),o=Be.unstack(r,0);return e.forEach(function(s,u){i.setItem(s,o[u])}),i}function AWe(r,e,t){var n=0,a=e.map(function(f){return n+=f,n});if(n!==r.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        `.concat(n,", and tensor's shape is: ").concat(r.shape));for(var i=r.shape.slice(1),o=Rk(i,t),s=n===0?0:r.size/n,u=Be.tidy(function(){var f=[];r=Be.reshape(r,[1,n,s]);for(var h=0;h<e.length;++h){var p=h===0?0:a[h-1],d=[0,p,0],m=[1,e[h],s];f[h]=Be.reshape(Be.slice(r,d,m),o)}return r.dispose(),f}),c=new ug([],t,r.dtype,e.length),l=0;l<u.length;l++)c.setItem(l,u[l]);return c}var DWe=function(r,e,t){return _t(void 0,void 0,void 0,function(){var n,a,i,o,c,h,s,u,c,l,f,h,p,d,m,m,y,v,y,g,y,y,y,Br,w,rt,b,x,S,T,E,C,se,lt,R,_,le,M,xe,De,$,z,q,de,ke,L,ot,U,mt,Y,nt,hr,Z,V,X,ne,re,Ct,se,lt,Je,Ct,le,rt,Qe,Je,de,ke,rt,Ze,Je,rt,st,he,Ze,ye,Je,xe,De,rt,st,Je,Ct,rt,st,Ze,Je,gt,rt,st,Je,ot,Je,mt,rt,Ct,lt,Je,Ct,rt,Qe,Je,nt,rt,hr,Je,Ct,Je,Ct,Br,Cn,Vr;return Dt(this,function(Lr){switch(Lr.label){case 0:switch(n=r.op,n){case"If":return[3,1];case"StatelessIf":return[3,1];case"While":return[3,3];case"StatelessWhile":return[3,3];case"LoopCond":return[3,9];case"Switch":return[3,10];case"Merge":return[3,12];case"Enter":return[3,13];case"Exit":return[3,14];case"NextIteration":return[3,15];case"TensorArrayV3":return[3,16];case"TensorArrayWriteV3":return[3,17];case"TensorArrayReadV3":return[3,18];case"TensorArrayGatherV3":return[3,19];case"TensorArrayScatterV3":return[3,20];case"TensorArrayConcatV3":return[3,21];case"TensorArraySplitV3":return[3,22];case"TensorArraySizeV3":return[3,23];case"TensorArrayCloseV3":return[3,24];case"TensorListSetItem":return[3,25];case"TensorListGetItem":return[3,26];case"TensorListScatterV2":return[3,27];case"TensorListScatter":return[3,27];case"TensorListReserve":return[3,28];case"EmptyTensorList":return[3,28];case"TensorListGather":return[3,29];case"TensorListStack":return[3,30];case"TensorListFromTensor":return[3,31];case"TensorListConcat":return[3,32];case"TensorListConcatV2":return[3,32];case"TensorListPushBack":return[3,33];case"TensorListPopBack":return[3,34];case"TensorListSplit":return[3,35];case"TensorListLength":return[3,36];case"TensorListResize":return[3,37]}return[3,38];case 1:return a=I("thenBranch",r,e,t),i=I("elseBranch",r,e,t),o=I("cond",r,e,t),c=I("args",r,e,t),[4,o.data()];case 2:return h=Lr.sent(),h[0]?[2,t.functionMap[a].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap)]:[2,t.functionMap[i].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap)];case 3:return s=I("body",r,e,t),u=I("cond",r,e,t),c=I("args",r,e,t),[4,t.functionMap[u].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap)];case 4:return l=Lr.sent(),f=c.map(function(pr){return pr.id}),[4,l[0].data()];case 5:h=Lr.sent(),l.forEach(function(pr){!pr.kept&&f.indexOf(pr.id)===-1&&pr.dispose()}),p=c,d=function(){var pr,Zn,An;return Dt(this,function(Qn){switch(Qn.label){case 0:return pr=p,[4,t.functionMap[s].executeFunctionAsync(p,t.tensorArrayMap,t.tensorListMap)];case 1:return p=Qn.sent(),Zn=p.map(function(Rr){return Rr.id}),pr.forEach(function(Rr){!Rr.kept&&f.indexOf(Rr.id)===-1&&Zn.indexOf(Rr.id)===-1&&Rr.dispose()}),[4,t.functionMap[u].executeFunctionAsync(p,t.tensorArrayMap,t.tensorListMap)];case 2:return An=Qn.sent(),[4,An[0].data()];case 3:return h=Qn.sent(),An.forEach(function(Rr){!Rr.kept&&f.indexOf(Rr.id)===-1&&Zn.indexOf(Rr.id)===-1&&Rr.dispose()}),[2]}})},Lr.label=6;case 6:return h[0]?[5,d()]:[3,8];case 7:return Lr.sent(),[3,6];case 8:return[2,p];case 9:return m=I("pred",r,e,t),[2,[Do(m)]];case 10:return m=I("pred",r,e,t),y=I("data",r,e,t),y.kept||(y=Do(y)),[4,m.data()];case 11:return[2,Lr.sent()[0]?[void 0,y]:[y,void 0]];case 12:return v=r.inputNames.find(function(pr){return yn(pr,e,t)!==void 0}),v?(y=yn(v,e,t),[2,[Do(y)]]):[2,void 0];case 13:return g=I("frameName",r,e,t),y=I("tensor",r,e,t),t.enterFrame(g),[2,[Do(y)]];case 14:return y=I("tensor",r,e,t),t.exitFrame(),[2,[Do(y)]];case 15:return y=I("tensor",r,e,t),t.nextIteration(),[2,[Do(y)]];case 16:return Br=I("size",r,e,t),w=I("dtype",r,e,t),rt=I("elementShape",r,e,t),b=I("dynamicSize",r,e,t),x=I("clearAfterRead",r,e,t),S=I("identicalElementShapes",r,e,t),T=I("name",r,e,t),E=new TWe(T,w,Br,rt,S,b,x),t.addTensorArray(E),[2,[E.idTensor,Be.scalar(1)]];case 17:return C=I("tensorArrayId",r,e,t),se=I("index",r,e,t),lt=I("tensor",r,e,t),R=t.getTensorArray(C.id),R.write(se,lt),[2,[R.idTensor]];case 18:return _=I("tensorArrayId",r,e,t),le=I("index",r,e,t),M=t.getTensorArray(_.id),[2,[M.read(le)]];case 19:return xe=I("tensorArrayId",r,e,t),De=I("indices",r,e,t),$=I("dtype",r,e,t),z=t.getTensorArray(xe.id),[2,[z.gather(De,$)]];case 20:return q=I("tensorArrayId",r,e,t),de=I("indices",r,e,t),ke=I("tensor",r,e,t),L=t.getTensorArray(q.id),L.scatter(de,ke),[2,[L.idTensor]];case 21:return ot=I("tensorArrayId",r,e,t),U=t.getTensorArray(ot.id),mt=I("dtype",r,e,t),[2,[U.concat(mt)]];case 22:return Y=I("tensorArrayId",r,e,t),nt=I("tensor",r,e,t),hr=I("lengths",r,e,t),Z=t.getTensorArray(Y.id),Z.split(hr,nt),[2,[Z.idTensor]];case 23:return V=I("tensorArrayId",r,e,t),X=t.getTensorArray(V.id),[2,[Be.scalar(X.size(),"int32")]];case 24:return ne=I("tensorArrayId",r,e,t),re=t.getTensorArray(ne.id),re.clearAndClose(),[2,[re.idTensor]];case 25:return Ct=I("tensorListId",r,e,t),se=I("index",r,e,t),lt=I("tensor",r,e,t),Je=t.getTensorList(Ct.id),Je.setItem(se,lt),[2,[Je.idTensor]];case 26:return Ct=I("tensorListId",r,e,t),le=I("index",r,e,t),rt=I("elementShape",r,e,t),Qe=I("elementDType",r,e,t),Je=t.getTensorList(Ct.id),[2,[Je.getItem(le,rt,Qe)]];case 27:return de=I("indices",r,e,t),ke=I("tensor",r,e,t),rt=I("elementShape",r,e,t),Ze=I("numElements",r,e,t),Je=CWe(ke,de,rt,Ze),t.addTensorList(Je),[2,[Je.idTensor]];case 28:return rt=I("elementShape",r,e,t),st=I("elementDType",r,e,t),he=void 0,r.op==="TensorListReserve"?he="numElements":he="maxNumElements",Ze=I(he,r,e,t),ye=r.op==="TensorListReserve"?-1:Ze,Je=IWe(rt,st,Ze,ye),t.addTensorList(Je),[2,[Je.idTensor]];case 29:return xe=I("tensorListId",r,e,t),De=I("indices",r,e,t),rt=I("elementShape",r,e,t),st=I("elementDType",r,e,t),Je=t.getTensorList(xe.id),[2,[Je.gather(De,st,rt)]];case 30:return Ct=I("tensorListId",r,e,t),rt=I("elementShape",r,e,t),st=I("elementDType",r,e,t),Ze=I("numElements",r,e,t),Je=t.getTensorList(Ct.id),[2,[Je.stack(rt,st,Ze)]];case 31:return gt=I("tensor",r,e,t),rt=I("elementShape",r,e,t),st=I("elementDType",r,e,t),Je=EWe(gt,rt,st),t.addTensorList(Je),[2,[Je.idTensor]];case 32:return ot=I("tensorListId",r,e,t),Je=t.getTensorList(ot.id),mt=I("dtype",r,e,t),rt=I("elementShape",r,e,t),[2,[Je.concat(mt,rt)]];case 33:return Ct=I("tensorListId",r,e,t),lt=I("tensor",r,e,t),Je=t.getTensorList(Ct.id),Je.pushBack(lt),[2,[Je.idTensor]];case 34:return Ct=I("tensorListId",r,e,t),rt=I("elementShape",r,e,t),Qe=I("elementDType",r,e,t),Je=t.getTensorList(Ct.id),[2,[Je.popBack(rt,Qe)]];case 35:return nt=I("tensor",r,e,t),rt=I("elementShape",r,e,t),hr=I("lengths",r,e,t),Je=AWe(nt,hr,rt),t.addTensorList(Je),[2,[Je.idTensor]];case 36:return Ct=I("tensorListId",r,e,t),Je=t.getTensorList(Ct.id),[2,[Be.scalar(Je.size(),"int32")]];case 37:return Ct=I("tensorListId",r,e,t),Br=I("size",r,e,t),Cn=t.getTensorList(Ct.id),Vr=Cn.resize(Br),t.addTensorList(Vr),[2,[Vr.idTensor]];case 38:throw TypeError("Node type ".concat(r.op," is not implemented"))}})})};function r$(r,e,t){var n=we(I("fusedOps",r,e,t),2),a=n[0],i=n[1],o=a==="biasadd",s=!o,u=i==="prelu",c=a==="fusedbatchnorm",l=I("numArgs",r,e,t);if(o){if(u&&l!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!u&&o&&l!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(c)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");var f=I("strides",r,e,t),h=Pm(r,e,t),p=I("dataFormat",r,e,t).toUpperCase(),d=I("dilations",r,e,t),m=we(I("args",r,e,t),2),v=m[0],g=m[1];s&&(g=v,v=void 0);var y=I("leakyreluAlpha",r,e,t);return{stride:f,pad:h,dataFormat:p,dilations:d,biasArg:v,preluArg:g,activationFunc:i,leakyreluAlpha:y}}var _We=function(r,e,t,n){switch(n===void 0&&(n=bn),r.op){case"Conv1D":{var a=I("stride",r,e,t),i=I("pad",r,e,t),o=I("dataFormat",r,e,t).toUpperCase(),s=I("dilation",r,e,t);return[n.conv1d(I("x",r,e,t),I("filter",r,e,t),a,i,o,s)]}case"Conv2D":{var a=I("strides",r,e,t),i=Pm(r,e,t),o=I("dataFormat",r,e,t).toUpperCase(),u=I("dilations",r,e,t);return[n.conv2d(I("x",r,e,t),I("filter",r,e,t),[a[1],a[2]],i,o,[u[1],u[2]])]}case"_FusedConv2D":{var c=r$(r,e,t),a=c.stride,i=c.pad,o=c.dataFormat,u=c.dilations,l=c.biasArg,f=c.preluArg,h=c.activationFunc,p=c.leakyreluAlpha;return[n.fused.conv2d({x:I("x",r,e,t),filter:I("filter",r,e,t),strides:[a[1],a[2]],pad:i,dataFormat:o,dilations:[u[1],u[2]],bias:l,activation:h,preluActivationWeights:f,leakyreluAlpha:p})]}case"FusedDepthwiseConv2dNative":{var d=r$(r,e,t),a=d.stride,i=d.pad,o=d.dataFormat,u=d.dilations,l=d.biasArg,f=d.preluArg,h=d.activationFunc,p=d.leakyreluAlpha;return[n.fused.depthwiseConv2d({x:I("x",r,e,t),filter:I("filter",r,e,t),strides:[a[1],a[2]],pad:i,dataFormat:o,dilations:[u[1],u[2]],bias:l,activation:h,preluActivationWeights:f,leakyreluAlpha:p})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{var m=I("outputShape",r,e,t),a=I("strides",r,e,t),i=Pm(r,e,t);return[n.conv2dTranspose(I("x",r,e,t),I("filter",r,e,t),m,[a[1],a[2]],i)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{var a=I("strides",r,e,t),i=Pm(r,e,t),u=I("dilations",r,e,t),o=I("dataFormat",r,e,t).toUpperCase();return[n.depthwiseConv2d(I("input",r,e,t),I("filter",r,e,t),[a[1],a[2]],i,o,[u[1],u[2]])]}case"Conv3D":{var a=I("strides",r,e,t),i=I("pad",r,e,t),o=I("dataFormat",r,e,t).toUpperCase(),u=I("dilations",r,e,t);return[n.conv3d(I("x",r,e,t),I("filter",r,e,t),[a[1],a[2],a[3]],i,o,[u[1],u[2],u[3]])]}case"AvgPool":{var a=I("strides",r,e,t),i=I("pad",r,e,t),v=I("kernelSize",r,e,t);return[n.avgPool(I("x",r,e,t),[v[1],v[2]],[a[1],a[2]],i)]}case"MaxPool":{var a=I("strides",r,e,t),i=I("pad",r,e,t),v=I("kernelSize",r,e,t);return[n.maxPool(I("x",r,e,t),[v[1],v[2]],[a[1],a[2]],i)]}case"MaxPoolWithArgmax":{var a=I("strides",r,e,t),i=I("pad",r,e,t),v=I("kernelSize",r,e,t),g=I("includeBatchInIndex",r,e,t),y=n.maxPoolWithArgmax(I("x",r,e,t),[v[1],v[2]],[a[1],a[2]],i,g),w=y.result,b=y.indexes;return[w,b]}case"AvgPool3D":{var a=I("strides",r,e,t),i=I("pad",r,e,t),v=I("kernelSize",r,e,t);return[n.avgPool3d(I("x",r,e,t),[v[1],v[2],v[3]],[a[1],a[2],a[3]],i)]}case"MaxPool3D":{var a=I("strides",r,e,t),i=I("pad",r,e,t),v=I("kernelSize",r,e,t);return[n.maxPool3d(I("x",r,e,t),[v[1],v[2],v[3]],[a[1],a[2],a[3]],i)]}case"Dilation2D":{var x=I("strides",r,e,t),i=I("pad",r,e,t),u=I("dilations",r,e,t),S=x[1],T=x[2],E=u[1],C=u[2];return[n.dilation2d(I("x",r,e,t),I("filter",r,e,t),[S,T],i,[E,C],"NHWC")]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var FWe=function(r,e,t,n){switch(n===void 0&&(n=bn),r.op){case"Fill":{var a=I("shape",r,e,t),i=I("dtype",r,e,t),o=I("value",r,e,t);return[n.fill(a,o,i)]}case"LinSpace":{var s=I("start",r,e,t),u=I("stop",r,e,t),c=I("num",r,e,t);return[n.linspace(s,u,c)]}case"Multinomial":{var l=I("logits",r,e,t),f=I("numSamples",r,e,t),h=I("seed",r,e,t);return[n.multinomial(l,f,h)]}case"OneHot":{var p=I("indices",r,e,t),d=I("depth",r,e,t),m=I("onValue",r,e,t),v=I("offValue",r,e,t),i=I("dtype",r,e,t);return[n.oneHot(p,d,m,v,i)]}case"Ones":return[n.ones(I("shape",r,e,t),I("dtype",r,e,t))];case"OnesLike":return[n.onesLike(I("x",r,e,t))];case"RandomStandardNormal":return[n.randomStandardNormal(I("shape",r,e,t),I("dtype",r,e,t),I("seed",r,e,t))];case"RandomUniform":return[n.randomUniform(I("shape",r,e,t),I("minval",r,e,t),I("maxval",r,e,t),I("dtype",r,e,t))];case"RandomUniformInt":return[n.randomUniformInt(I("shape",r,e,t),I("minval",r,e,t),I("maxval",r,e,t),I("seed",r,e,t))];case"Range":{var s=I("start",r,e,t),u=I("stop",r,e,t),g=I("step",r,e,t);return[n.range(s,u,g,I("dtype",r,e,t))]}case"TruncatedNormal":{var a=I("shape",r,e,t),y=I("mean",r,e,t),w=I("stdDev",r,e,t),h=I("seed",r,e,t);return[n.truncatedNormal(a,y,w,I("dtype",r,e,t),h)]}case"Zeros":return[n.zeros(I("shape",r,e,t),I("dtype",r,e,t))];case"ZerosLike":return[n.zerosLike(I("x",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};function sk(r,e,t){var n=I("boxes",r,e,t),a=I("scores",r,e,t),i=I("maxOutputSize",r,e,t),o=I("iouThreshold",r,e,t),s=I("scoreThreshold",r,e,t),u=I("softNmsSigma",r,e,t);return{boxes:n,scores:a,maxOutputSize:i,iouThreshold:o,scoreThreshold:s,softNmsSigma:u}}var RWe=function(r,e,t,n,a){return a===void 0&&(a=bn),_t(void 0,void 0,void 0,function(){var i,o,f,h,p,d,m,s,g,u,f,h,p,d,m,c,g,l,f,h,p,d,m,v,g;return Dt(this,function(y){switch(y.label){case 0:switch(i=r.op,i){case"NonMaxSuppressionV5":return[3,1];case"NonMaxSuppressionV4":return[3,3];case"NonMaxSuppressionV3":return[3,5];case"NonMaxSuppressionV2":return[3,5];case"Where":return[3,7];case"ListDiff":return[3,9]}return[3,10];case 1:return o=sk(r,e,t),f=o.boxes,h=o.scores,p=o.maxOutputSize,d=o.iouThreshold,m=o.scoreThreshold,s=o.softNmsSigma,[4,a.image.nonMaxSuppressionWithScoreAsync(f,h,p,d,m,s)];case 2:return g=y.sent(),[2,[g.selectedIndices,g.selectedScores]];case 3:return u=sk(r,e,t),f=u.boxes,h=u.scores,p=u.maxOutputSize,d=u.iouThreshold,m=u.scoreThreshold,c=I("padToMaxOutputSize",r,e,t),[4,a.image.nonMaxSuppressionPaddedAsync(f,h,p,d,m,c)];case 4:return g=y.sent(),[2,[g.selectedIndices,g.validOutputs]];case 5:return l=sk(r,e,t),f=l.boxes,h=l.scores,p=l.maxOutputSize,d=l.iouThreshold,m=l.scoreThreshold,[4,a.image.nonMaxSuppressionAsync(f,h,p,d,m)];case 6:return[2,[y.sent()]];case 7:return v=a.cast(I("condition",r,e,t),"bool"),[4,a.whereAsync(v)];case 8:return g=[y.sent()],v.dispose(),[2,g];case 9:return[2,a.setdiff1dAsync(I("x",r,e,t),I("y",r,e,t))];case 10:throw TypeError("Node type ".concat(r.op," is not implemented"))}})})};var OWe=function(r,e,t,n){switch(n===void 0&&(n=bn),r.op){case"LowerBound":{var a=I("sortedSequence",r,e,t),i=I("values",r,e,t);return[n.lowerBound(a,i)]}case"TopKV2":{var o=I("x",r,e,t),s=I("k",r,e,t),u=I("sorted",r,e,t),c=n.topk(o,s,u);return[c.values,c.indices]}case"UpperBound":{var a=I("sortedSequence",r,e,t),i=I("values",r,e,t);return[n.upperBound(a,i)]}case"Unique":{var o=I("x",r,e,t),c=n.unique(o);return[c.values,c.indices]}case"UniqueV2":{var o=I("x",r,e,t),l=I("axis",r,e,t),c=n.unique(o,l);return[c.values,c.indices]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var PWe=function(r,e,t,n){switch(n===void 0&&(n=bn),r.op){case"Const":return e[r.name];case"PlaceholderWithDefault":var a=I("default",r,e,t);return[yn(r.name,e,t)||a];case"Placeholder":return[yn(r.name,e,t)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{var i=I("x",r,e,t);return[Do(i)]}case"IdentityN":return I("x",r,e,t).map(function(h){return Do(h)});case"Snapshot":var o=I("x",r,e,t);return[Do(o)];case"Shape":return[n.tensor1d(I("x",r,e,t).shape,"int32")];case"ShapeN":return I("x",r,e,t).map(function(h){return n.tensor1d(h.shape)});case"Size":return[n.scalar(I("x",r,e,t).size,"int32")];case"Rank":return[n.scalar(I("x",r,e,t).rank,"int32")];case"NoOp":return[n.scalar(1)];case"Print":var s=I("x",r,e,t),u=I("data",r,e,t),c=I("message",r,e,t),l=I("summarize",r,e,t);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(c);for(var f=0;f<u.length;f++)console.log(Array.prototype.slice.call(u[f].dataSync()).slice(0,l));return[s];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}},MWe=function(){function r(e,t){this.keyDType=e,this.valueDType=t,this.handle=Be.scalar(0),this.tensorMap=new Map,Be.keep(this.handle)}return Object.defineProperty(r.prototype,"id",{get:function(){return this.handle.id},enumerable:!1,configurable:!0}),r.prototype.clearAndClose=function(){this.tensorMap.forEach(function(e){return e.dispose()}),this.tensorMap.clear(),this.handle.dispose()},r.prototype.size=function(){return this.tensorMap.size},r.prototype.tensorSize=function(){return zr(this.size(),"int32")},r.prototype.import=function(e,t){return _t(this,void 0,void 0,function(){var n,a=this;return Dt(this,function(i){switch(i.label){case 0:return this.checkKeyAndValueTensor(e,t),[4,e.data()];case 1:return n=i.sent(),this.tensorMap.forEach(function(o){return o.dispose()}),this.tensorMap.clear(),[2,Be.tidy(function(){var o=Be.unstack(t),s=n.length,u=o.length;Be.util.assert(s===u,function(){return"The number of elements doesn't match, keys has "+"".concat(s," elements, the values has ").concat(u," ")+"elements."});for(var c=0;c<s;c++){var l=n[c],f=o[c];Be.keep(f),a.tensorMap.set(l,f)}return a.handle})]}})})},r.prototype.find=function(e,t){return _t(this,void 0,void 0,function(){var n,a=this;return Dt(this,function(i){switch(i.label){case 0:return this.checkKeyAndValueTensor(e,t),[4,e.data()];case 1:return n=i.sent(),[2,Be.tidy(function(){for(var o=[],s=0;s<n.length;s++){var u=n[s],c=a.findWithDefault(u,t);o.push(c)}return Be.stack(o)})]}})})},r.prototype.findWithDefault=function(e,t){var n=this.tensorMap.get(e);return n??t},r.prototype.checkKeyAndValueTensor=function(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype ".concat(this.keyDType,", but got ")+"".concat(e.dtype));if(t.dtype!==this.valueDType)throw new Error("Expect value dtype ".concat(this.valueDType,", but got ")+"".concat(t.dtype))},r}(),BWe=function(r,e,t,n){return _t(void 0,void 0,void 0,function(){var a,i,o,s,h,f,c,u,h,f,c,l,h,f,h;return Dt(this,function(p){switch(p.label){case 0:switch(a=r.op,a){case"HashTable":return[3,1];case"HashTableV2":return[3,1];case"InitializeTable":return[3,2];case"InitializeTableV2":return[3,2];case"LookupTableImport":return[3,2];case"LookupTableImportV2":return[3,2];case"LookupTableFind":return[3,4];case"LookupTableFindV2":return[3,4];case"LookupTableSize":return[3,6];case"LookupTableSizeV2":return[3,6]}return[3,7];case 1:return i=n.getHashTableHandleByName(r.name),i!=null?[2,[i]]:(o=I("keyDType",r,e,t),s=I("valueDType",r,e,t),h=new MWe(o,s),n.addHashTable(r.name,h),[2,[h.handle]]);case 2:return f=I("tableHandle",r,e,t,n),c=I("keys",r,e,t),u=I("values",r,e,t),h=n.getHashTableById(f.id),[4,h.import(c,u)];case 3:return[2,[p.sent()]];case 4:return f=I("tableHandle",r,e,t,n),c=I("keys",r,e,t),l=I("defaultValue",r,e,t),h=n.getHashTableById(f.id),[4,h.find(c,l)];case 5:return[2,[p.sent()]];case 6:return f=I("tableHandle",r,e,t,n),h=n.getHashTableById(f.id),[2,[h.tensorSize()]];case 7:throw TypeError("Node type ".concat(r.op," is not implemented"))}})})};var LWe=function(r,e,t,n){switch(n===void 0&&(n=bn),r.op){case"ResizeBilinear":{var a=I("images",r,e,t),i=I("size",r,e,t),o=I("alignCorners",r,e,t),s=I("halfPixelCenters",r,e,t);return[n.image.resizeBilinear(a,[i[0],i[1]],o,s)]}case"ResizeNearestNeighbor":{var a=I("images",r,e,t),i=I("size",r,e,t),o=I("alignCorners",r,e,t),s=I("halfPixelCenters",r,e,t);return[n.image.resizeNearestNeighbor(a,[i[0],i[1]],o,s)]}case"CropAndResize":{var u=I("image",r,e,t),c=I("boxes",r,e,t),l=I("boxInd",r,e,t),f=I("cropSize",r,e,t),h=I("method",r,e,t),p=I("extrapolationValue",r,e,t);return[n.image.cropAndResize(u,c,l,f,h,p)]}case"ImageProjectiveTransformV3":{var a=I("images",r,e,t),d=I("transforms",r,e,t),m=I("outputShape",r,e,t),v=I("fillValue",r,e,t),g=I("interpolation",r,e,t),y=I("fillMode",r,e,t);return[n.image.transform(a,d,g.toLowerCase(),y.toLowerCase(),v,m)]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var qWe=function(r,e,t,n){switch(n===void 0&&(n=bn),r.op){case"Equal":return[n.equal(I("a",r,e,t),I("b",r,e,t))];case"NotEqual":return[n.notEqual(I("a",r,e,t),I("b",r,e,t))];case"Greater":return[n.greater(I("a",r,e,t),I("b",r,e,t))];case"GreaterEqual":return[n.greaterEqual(I("a",r,e,t),I("b",r,e,t))];case"Less":return[n.less(I("a",r,e,t),I("b",r,e,t))];case"LessEqual":return[n.lessEqual(I("a",r,e,t),I("b",r,e,t))];case"LogicalAnd":return[n.logicalAnd(I("a",r,e,t),I("b",r,e,t))];case"LogicalNot":return[n.logicalNot(I("a",r,e,t))];case"LogicalOr":return[n.logicalOr(I("a",r,e,t),I("b",r,e,t))];case"Select":case"SelectV2":return[n.where(I("condition",r,e,t),I("a",r,e,t),I("b",r,e,t))];case"BitwiseAnd":return[n.bitwiseAnd(I("a",r,e,t),I("b",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}},zWe=function(r,e,t,n){switch(n===void 0&&(n=bn),r.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[n.matMul(I("a",r,e,t),I("b",r,e,t),I("transposeA",r,e,t),I("transposeB",r,e,t))];case"Einsum":return[n.einsum.apply(n,Lt([I("equation",r,e,t)],we(I("tensors",r,e,t)),!1))];case"Transpose":return[n.transpose(I("x",r,e,t),I("perm",r,e,t))];case"_FusedMatMul":var a=we(I("fusedOps",r,e,t),2),i=a[0],o=a[1],s=i==="biasadd",u=o==="prelu",c=I("numArgs",r,e,t),l=I("leakyreluAlpha",r,e,t);if(s){if(u&&c!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!u&&c!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var f=we(I("args",r,e,t),2),h=f[0],p=f[1];return[n.fused.matMul({a:I("a",r,e,t),b:I("b",r,e,t),transposeA:I("transposeA",r,e,t),transposeB:I("transposeB",r,e,t),bias:h,activation:o,preluActivationWeights:p,leakyreluAlpha:l})];case"MatrixBandPart":return[n.linalg.bandPart(I("a",r,e,t),I("numLower",r,e,t),I("numUpper",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var $We=function(r,e,t,n){switch(n===void 0&&(n=bn),r.op){case"EuclideanNorm":return[n.euclideanNorm(I("x",r,e,t),I("axis",r,e,t),I("keepDims",r,e,t))];case"FusedBatchNorm":case"FusedBatchNormV2":return[n.batchNorm(I("x",r,e,t),I("mean",r,e,t),I("variance",r,e,t),I("offset",r,e,t),I("scale",r,e,t),I("epsilon",r,e,t))];case"FusedBatchNormV3":return[n.batchNorm(I("x",r,e,t),I("mean",r,e,t),I("variance",r,e,t),I("offset",r,e,t),I("scale",r,e,t),I("epsilon",r,e,t))];case"LRN":return[n.localResponseNormalization(I("x",r,e,t),I("radius",r,e,t),I("bias",r,e,t),I("alpha",r,e,t),I("beta",r,e,t))];case"Softmax":return[n.softmax(I("x",r,e,t))];case"LogSoftmax":return[n.logSoftmax(I("x",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var WWe=function(r,e,t,n){switch(n===void 0&&(n=bn),r.op){case"RaggedGather":{var a=n.raggedGather(I("paramsNestedSplits",r,e,t),I("paramsDenseValues",r,e,t),I("indices",r,e,t),I("outputRaggedRank",r,e,t)),i=a.outputNestedSplits,o=a.outputDenseValues;return i.concat(o)}case"RaggedRange":{var s=n.raggedRange(I("starts",r,e,t),I("limits",r,e,t),I("splits",r,e,t)),u=s.rtNestedSplits,c=s.rtDenseValues;return[u,c]}case"RaggedTensorToTensor":return[n.raggedTensorToTensor(I("shape",r,e,t),I("values",r,e,t),I("defaultValue",r,e,t),I("rowPartitionTensors",r,e,t),I("rowPartitionTypes",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var UWe=function(r,e,t,n){switch(n===void 0&&(n=bn),r.op){case"Max":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.max(I("x",r,e,t),a,i)]}case"Mean":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.mean(I("x",r,e,t),a,i)]}case"Min":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.min(I("x",r,e,t),a,i)]}case"Sum":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.sum(I("x",r,e,t),a,i)]}case"All":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.all(I("x",r,e,t),a,i)]}case"Any":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.any(I("x",r,e,t),a,i)]}case"ArgMax":{var a=I("axis",r,e,t);return[n.argMax(I("x",r,e,t),a)]}case"ArgMin":{var a=I("axis",r,e,t);return[n.argMin(I("x",r,e,t),a)]}case"Prod":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.prod(I("x",r,e,t),a,i)]}case"Cumprod":{var a=I("axis",r,e,t),o=I("exclusive",r,e,t),s=I("reverse",r,e,t);return[n.cumprod(I("x",r,e,t),a,o,s)]}case"Cumsum":{var a=I("axis",r,e,t),o=I("exclusive",r,e,t),s=I("reverse",r,e,t);return[n.cumsum(I("x",r,e,t),a,o,s)]}case"Bincount":var u=I("x",r,e,t),c=I("weights",r,e,t),l=I("size",r,e,t);return[n.bincount(u,c,l)];case"DenseBincount":{var f=I("x",r,e,t),h=I("weights",r,e,t),p=I("size",r,e,t),d=I("binaryOutput",r,e,t);return[n.denseBincount(f,h,p,d)]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var VWe=function(r,e,t,n){switch(n===void 0&&(n=bn),r.op){case"ConcatV2":case"Concat":{var a=I("n",r,e,t),i=I("axis",r,e,t),o=I("tensors",r,e,t);return o=o.slice(0,a),[n.concat(o,i)]}case"Gather":{var s=I("x",r,e,t),u=I("indices",r,e,t);return[n.gather(s,n.cast(u,"int32"),0)]}case"GatherV2":{var i=I("axis",r,e,t),c=I("batchDims",r,e,t),s=I("x",r,e,t),u=I("indices",r,e,t);return[n.gather(s,n.cast(u,"int32"),i,c)]}case"Reverse":{for(var l=I("dims",r,e,t),i=[],f=0;f<l.length;f++)l[f]&&i.push(f);var s=I("x",r,e,t);return[n.reverse(s,i)]}case"ReverseV2":{var i=I("axis",r,e,t),s=I("x",r,e,t);return[n.reverse(s,i)]}case"Slice":{var h=I("begin",r,e,t),p=I("size",r,e,t);return[n.slice(I("x",r,e,t),h,p)]}case"StridedSlice":{var h=I("begin",r,e,t),d=I("end",r,e,t),m=I("strides",r,e,t),v=I("beginMask",r,e,t),g=I("endMask",r,e,t),y=I("ellipsisMask",r,e,t),w=I("newAxisMask",r,e,t),b=I("shrinkAxisMask",r,e,t),x=I("x",r,e,t);return[n.stridedSlice(x,h,d,m,v,g,y,w,b)]}case"Pack":return Be.tidy(function(){var $=I("axis",r,e,t),z=I("tensors",r,e,t),q=z[0].shape,L=n.squeeze(z[0]).shape,U=z.map(function(Y){var Z=Be.util.arraysEqual(Y.shape,q);if(!Z&&!Be.util.arraysEqual(n.squeeze(Y).shape,L))throw new Error("the input tensors shape does not match");return Z?Y:n.reshape(Y,q)});return[n.stack(U,$)]});case"Unpack":{var i=I("axis",r,e,t),x=I("tensor",r,e,t);return n.unstack(x,i)}case"Tile":{var S=I("reps",r,e,t);return[n.tile(I("x",r,e,t),S)]}case"Split":case"SplitV":{var i=I("axis",r,e,t),T=I("numOrSizeSplits",r,e,t),x=I("x",r,e,t);return n.split(x,T,i)}case"ScatterNd":{var u=I("indices",r,e,t),E=I("values",r,e,t),C=I("shape",r,e,t);return[n.scatterND(u,E,C)]}case"GatherNd":{var R=I("x",r,e,t),u=I("indices",r,e,t);return[n.gatherND(R,u)]}case"SparseToDense":{var u=I("sparseIndices",r,e,t),C=I("outputShape",r,e,t),_=I("sparseValues",r,e,t),M=I("defaultValue",r,e,t);return[n.sparseToDense(u,_,C,_.dtype===M.dtype?M:n.cast(M,_.dtype))]}case"TensorScatterUpdate":{var u=I("indices",r,e,t),E=I("values",r,e,t),x=I("tensor",r,e,t);return[n.tensorScatterUpdate(x,u,E)]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var GWe=function(r,e,t,n){switch(n===void 0&&(n=bn),r.op){case"SparseFillEmptyRows":{var a=n.sparse.sparseFillEmptyRows(I("indices",r,e,t),I("values",r,e,t),I("denseShape",r,e,t),I("defaultValue",r,e,t)),i=a.outputIndices,o=a.outputValues,s=a.emptyRowIndicator,u=a.reverseIndexMap;return[i,o,s,u]}case"SparseReshape":{var c=n.sparse.sparseReshape(I("inputIndices",r,e,t),I("inputShape",r,e,t),I("newShape",r,e,t)),i=c.outputIndices,l=c.outputShape;return[i,l]}case"SparseSegmentMean":{var f=n.sparse.sparseSegmentMean(I("data",r,e,t),I("indices",r,e,t),I("segmentIds",r,e,t));return[f]}case"SparseSegmentSum":{var f=n.sparse.sparseSegmentSum(I("data",r,e,t),I("indices",r,e,t),I("segmentIds",r,e,t));return[f]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var HWe=function(r,e,t,n){switch(n===void 0&&(n=bn),r.op){case"FFT":return[n.fft(I("x",r,e,t))];case"IFFT":return[n.ifft(I("x",r,e,t))];case"RFFT":return[n.rfft(I("x",r,e,t))];case"IRFFT":return[n.irfft(I("x",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var jWe=function(r,e,t,n){switch(n===void 0&&(n=bn),r.op){case"StaticRegexReplace":return[n.string.staticRegexReplace(I("input",r,e,t),I("pattern",r,e,t),I("rewrite",r,e,t),I("replaceGlobal",r,e,t))];case"StringNGrams":{var a=n.string.stringNGrams(I("data",r,e,t),I("dataSplits",r,e,t),I("separator",r,e,t),I("nGramWidths",r,e,t),I("leftPad",r,e,t),I("rightPad",r,e,t),I("padWidth",r,e,t),I("preserveShortSequences",r,e,t)),i=a.nGrams,o=a.nGramsSplits;return[i,o]}case"StringSplit":{var s=n.string.stringSplit(I("input",r,e,t),I("delimiter",r,e,t),I("skipEmpty",r,e,t)),u=s.indices,c=s.values,l=s.shape;return[u,c,l]}case"StringToHashBucketFast":{var f=n.string.stringToHashBucketFast(I("input",r,e,t),I("numBuckets",r,e,t));return[f]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var KWe=function(r,e,t,n){switch(n===void 0&&(n=bn),r.op){case"Cast":return[n.cast(I("x",r,e,t),I("dtype",r,e,t))];case"ExpandDims":{var a=I("axis",r,e,t);return[n.expandDims(I("x",r,e,t),a)]}case"Squeeze":{var a=I("axis",r,e,t);return[n.squeeze(I("x",r,e,t),a)]}case"Reshape":return[n.reshape(I("x",r,e,t),I("shape",r,e,t))];case"EnsureShape":return[n.ensureShape(I("x",r,e,t),I("shape",r,e,t))];case"MirrorPad":return[n.mirrorPad(I("x",r,e,t),I("padding",r,e,t),I("mode",r,e,t))];case"PadV2":case"Pad":return[n.pad(I("x",r,e,t),I("padding",r,e,t),I("constantValue",r,e,t))];case"SpaceToBatchND":{var i=I("blockShape",r,e,t),o=I("paddings",r,e,t);return[n.spaceToBatchND(I("x",r,e,t),i,o)]}case"BatchToSpaceND":{var i=I("blockShape",r,e,t),s=I("crops",r,e,t);return[n.batchToSpaceND(I("x",r,e,t),i,s)]}case"DepthToSpace":{var u=I("blockSize",r,e,t),c=I("dataFormat",r,e,t).toUpperCase();return[n.depthToSpace(I("x",r,e,t),u,c)]}case"BroadcastTo":return[n.broadcastTo(I("x",r,e,t),I("shape",r,e,t))];case"BroadcastArgs":return[n.broadcastArgs(I("s0",r,e,t),I("s1",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};function n$(r,e,t,n,a){a===void 0&&(a=Az.tidy);var i=function(o,s,u){switch(o.category){case"arithmetic":return a(function(){return SWe(o,s,u)});case"basic_math":return a(function(){return NWe(o,s,u)});case"control":return DWe(o,s,u);case"convolution":return a(function(){return _We(o,s,u)});case"creation":return a(function(){return FWe(o,s,u)});case"dynamic":return RWe(o,s,u);case"evaluation":return a(function(){return OWe(o,s,u)});case"image":return a(function(){return LWe(o,s,u)});case"graph":return a(function(){return PWe(o,s,u)});case"logical":return a(function(){return qWe(o,s,u)});case"matrices":return a(function(){return zWe(o,s,u)});case"normalization":return a(function(){return $We(o,s,u)});case"ragged":return a(function(){return WWe(o,s,u)});case"reduction":return a(function(){return UWe(o,s,u)});case"slice_join":return a(function(){return VWe(o,s,u)});case"sparse":return a(function(){return GWe(o,s,u)});case"spectral":return a(function(){return HWe(o,s,u)});case"string":return a(function(){return jWe(o,s,u)});case"transformation":return a(function(){return KWe(o,s,u)});case"hash_table":return BWe(o,s,u,n);case"custom":var c=c$(o.op);if(c&&c.customExecutor)return c.customExecutor(new _3e(o,s,u));throw TypeError("Custom op ".concat(o.op," is not registered."));default:throw TypeError("Unknown op '".concat(o.op,"'. File an issue at ")+"https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(r,e,t);return Az.util.isPromise(i)?i.then(function(o){return[].concat(o)}):[].concat(i)}var a$=function(){function r(e,t,n,a,i){e===void 0&&(e={}),t===void 0&&(t={}),n===void 0&&(n={}),a===void 0&&(a={}),this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=n,this.functionMap=a,this.parseNodeNameCache=i,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return r.prototype.newFrame=function(e,t){return{id:e,frameName:t,iterationId:0}},Object.defineProperty(r.prototype,"currentContext",{get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!1,configurable:!0}),r.prototype.generateCurrentContextIds=function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e},r.prototype.contextIdforContexts=function(e){return e?e.map(function(t){return t.id===0&&t.iterationId===0?"":"".concat(t.frameName,"-").concat(t.iterationId)}).join("/"):""},r.prototype.enterFrame=function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},r.prototype.exitFrame=function(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")},r.prototype.nextIteration=function(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")},r.prototype.getWeight=function(e){return this.weightMap[e]},r.prototype.addTensorArray=function(e){this.tensorArrayMap[e.id]=e},r.prototype.getTensorArray=function(e){return this.tensorArrayMap[e]},r.prototype.addTensorList=function(e){this.tensorListMap[e.id]=e},r.prototype.getTensorList=function(e){return this.tensorListMap[e]},r.prototype.dispose=function(e){for(var t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(var t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)},r}();function i$(r,e,t,n){var a=new Set,i=[],o=null,s=null,u=new Set,c=new Set(Object.keys(r).map(function(p){return va(p)[0]}));n=n||[];for(var l=new Set(n.map(function(p){return va(p.name)[0]})),f=Lt([],we(e),!1);f.length>0;){var h=f.pop();if((Ou(h)||rUe(h)||nUe(h))&&o==null&&(o=h,s=o.children.map(function(p){return p.name}).filter(function(p){return a.has(p)})),a.add(h.name),t[h.name]==null&&!c.has(h.name)&&!l.has(h.name)){if(h.inputs.length===0){i.push(h.name);continue}h.inputs.forEach(function(p){u.has(p.name)||(u.add(p.name),f.push(p))})}}return{inputs:r,outputs:e,usedNodes:a,missingInputs:i,dynamicNode:o,syncInputs:s}}function XWe(r,e){var t,n,a,i,o,s,u=e.usedNodes,c=e.inputs,l=Object.keys(c).map(function(q){return va(q)[0]}).map(function(q){return r.nodes[q]}),f=r.initNodes||[],h=function(q){return u.has(typeof q=="string"?q:q.name)};function p(q){return Lt([],we(new Map(q.map(function(L){return[L.name,L]})).values()),!1)}var d=p(Lt(Lt(Lt([],we(l),!1),we(r.weights),!1),we(f),!1)).filter(h),m=p(Lt(Lt([],we(d),!1),we(Object.values(r.nodes)),!1)).filter(h),v=new Map(m.map(function(q){return[q.name,q]})),g={};try{for(var y=Qr(m),w=y.next();!w.done;w=y.next()){var b=w.value;g[b.name]=g[b.name]||0;try{for(var x=(a=void 0,Qr(b.children)),S=x.next();!S.done;S=x.next()){var T=S.value;h(T)||(g[T.name]=Number.POSITIVE_INFINITY),g[T.name]=(g[T.name]||0)+1}}catch(q){a={error:q}}finally{try{S&&!S.done&&(i=x.return)&&i.call(x)}finally{if(a)throw a.error}}}}catch(q){t={error:q}}finally{try{w&&!w.done&&(n=y.return)&&n.call(y)}finally{if(t)throw t.error}}for(var E=Object.entries(g).filter(function(q){var L=we(q,2),U=L[1];return U===0}).map(function(q){var L=we(q,1),U=L[0];return U}),C=Lt([],we(E),!1);E.length>0;){var R=E.pop(),b=v.get(R);try{for(var _=(o=void 0,Qr(b.children.filter(h))),M=_.next();!M.done;M=_.next()){var T=M.value;--g[T.name]===0&&(C.push(T.name),E.push(T.name))}}catch(L){o={error:L}}finally{try{M&&!M.done&&(s=_.return)&&s.call(_)}finally{if(o)throw o.error}}}var $=C.map(function(q){return v.get(q)}),z=YWe($,d);return JWe(z,d),z}function YWe(r,e){for(var t,n,a=new Map(r.map(function(p){return[p.name,p]})),i=e.map(function(p){return p.name}),o=new Set(i);i.length>0;){var s=i.pop(),u=a.get(s);try{for(var c=(t=void 0,Qr(u.children)),l=c.next();!l.done;l=c.next()){var f=l.value;!a.has(f.name)||o.has(f.name)||(o.add(f.name),i.push(f.name))}}catch(p){t={error:p}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}}var h=r.filter(function(p){return o.has(p.name)});return h}var Om=function(r){u$(e,r);function e(t){return r.call(this,"NodesExecutionOrderError: ".concat(t))||this}return e}(Error);function JWe(r,e){var t,n,a,i,o,s,u=new Map(r.map(function(S,T){return[S.name,T]})),c=new Set(e.map(function(S){return S.name})),l=function(S){return c.has(typeof S=="string"?S:S.name)},f=new Set(r.map(function(S){return S.name})),h=function(S){return f.has(typeof S=="string"?S:S.name)};try{for(var p=Qr(r),d=p.next();!d.done;d=p.next()){var m=d.value;try{for(var v=(a=void 0,Qr(m.children.filter(h))),g=v.next();!g.done;g=v.next()){var y=g.value;if(!u.has(y.name))throw new Om("Child ".concat(y.name," of node ").concat(m.name," is unreachable."));if(u.get(m.name)>u.get(y.name))throw new Om("Node ".concat(m.name," is scheduled to run after its child ").concat(y.name,"."))}}catch(S){a={error:S}}finally{try{g&&!g.done&&(i=v.return)&&i.call(v)}finally{if(a)throw a.error}}if(!l(m))try{for(var w=(o=void 0,Qr(m.inputs)),b=w.next();!b.done;b=w.next()){var x=b.value;if(!u.has(x.name))throw new Om("Input ".concat(x.name," of node ").concat(m.name," is unreachable."));if(u.get(x.name)>u.get(m.name))throw new Om("Node ".concat(m.name," is scheduled to run before its input ").concat(x.name,"."))}}catch(S){o={error:S}}finally{try{b&&!b.done&&(s=w.return)&&s.call(w)}finally{if(o)throw o.error}}}}catch(S){t={error:S}}finally{try{d&&!d.done&&(n=p.return)&&n.call(p)}finally{if(t)throw t.error}}}function ZWe(r){for(var e=new Map(r.map(function(f,h){return[f.name,h]})),t=Number.MAX_SAFE_INTEGER,n=r.map(function(f,h){return Ou(f)?t:h}),a=function(f){var h=n[e.get(f.name)];return h??-1},i=r.map(function(f,h){return f.children.map(a).reduce(function(p,d){return Math.max(p,d)},n[h])}),o=new Map,s=0;s<r.length;++s){var u=i[s];if(u!==t){var c=r[s],l=r[u];o.has(l.name)||o.set(l.name,[]),o.get(l.name).push(c)}}return o}var QWe=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),eUe=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),tUe=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function Ou(r){return QWe.has(r.op)}function rUe(r){return eUe.has(r.op)}function nUe(r){return tUe.has(r.op)}var o$=function(){function r(e,t){var n=this;this.graph=e,this.parent=t,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,e.functions!=null&&Object.keys(e.functions).forEach(function(a){n._functionExecutorMap[a]=new r(e.functions[a],n)})}return Object.defineProperty(r.prototype,"weightIds",{get:function(){return this.parent?this.parent.weightIds:this._weightIds},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"functionExecutorMap",{get:function(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"weightMap",{get:function(){return this.parent?this.parent.weightMap:this._weightMap},set:function(e){var t=Object.keys(e).map(function(n){return e[n].map(function(a){return a.id})});this._weightIds=[].concat.apply([],Lt([],we(t),!1)),this._weightMap=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"resourceManager",{set:function(e){this._resourceManager=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputs",{get:function(){return this._inputs.map(function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"outputs",{get:function(){return this._outputs.map(function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputNodes",{get:function(){return this._inputs.map(function(e){return e.signatureKey||e.name})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"outputNodes",{get:function(){return this._outputs.map(function(e){var t=e.signatureKey||e.name;return e.defaultOutput?"".concat(t,":").concat(e.defaultOutput):t})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"functions",{get:function(){var e=this;return Object.keys(this._functions).reduce(function(t,n){return t[n]=e._functions[n].signature,t},{})},enumerable:!1,configurable:!0}),r.prototype.getCompilationKey=function(e,t){var n=e.map(function(i){return i.name}).sort(),a=t.map(function(i){return i.name}).sort();return n.join(this.SEPARATOR)+"--"+a.join(this.SEPARATOR)},r.prototype.compile=function(e,t){var n=i$(e,t,this.weightMap,this._initNodes),a=n.missingInputs,i=n.dynamicNode,o=n.syncInputs;if(i!=null)throw new Error("This execution contains the node '".concat(i.name,"', which has ")+"the dynamic op '".concat(i.op,"'. Please use ")+"model.executeAsync() instead. Alternatively, to avoid the "+"dynamic ops, specify the inputs [".concat(o,"]"));if(a.length>0){var s=t.map(function(f){return f.name}),u=Object.keys(e);throw new Error("Cannot compute the outputs [".concat(s,"] from the provided inputs ")+"[".concat(u,"]. Missing the following inputs: [").concat(a,"]"))}var c=XWe(this.graph,n),l=ZWe(c);return{orderedNodes:c,nodeLiveUntilMap:l}},r.prototype.cloneAndKeepTensor=function(e){if(e==null)return null;var t=e.clone();return Be.keep(t),t},r.prototype.cloneTensorList=function(e){var t=this;if(!e)return null;var n=e.map(function(a){return t.cloneAndKeepTensor(a)});return n},r.prototype.cloneTensorMap=function(e){var t=this;return Object.fromEntries(Object.entries(e).map(function(n){var a=we(n,2),i=a[0],o=a[1];return[i,t.cloneTensorList(o)]}))},r.prototype.execute=function(e,t){var n=this;this.disposeIntermediateTensors(),e=this.mapInputs(e);var a=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var i=a.map(function(p){return n.graph.nodes[va(p)[0]]}),o=t.map(function(p){return va(p)[0]}),s=new Set(o),u=o.map(function(p){return n.graph.nodes[p]});u.length===0&&(u=this._outputs);var c=this.getCompilationKey(i,u),l=this.compiledMap.get(c);l==null&&(l=this.compile(e,u),this.compiledMap.set(c,l));try{this.keepIntermediateTensors=Be.env().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(p){this.keepIntermediateTensors=!1,console.warn(p.message)}var f={},h={};return Be.tidy(function(){var p,d,m=new a$(n.weightMap,f,h,n.functionExecutorMap,n.parseNodeNameCache),v=Object.assign({},n.weightMap);n.keepIntermediateTensors&&(n.clonedTensorsMap=n.cloneTensorMap(n.weightMap)),Object.keys(e).forEach(function(E){var C=we(va(E,m),2),R=C[0],_=C[1],M=[];M[_]=e[E],v[R]=M,n.keepIntermediateTensors&&(n.clonedTensorsMap[R]=n.cloneTensorList(M))});var g=n.getFrozenTensorIds(v),y=l.orderedNodes,w=l.nodeLiveUntilMap;try{for(var b=Qr(y),x=b.next();!x.done;x=b.next()){var S=x.value;if(!v[S.name]){var T=n$(S,v,m,n._resourceManager);if(Be.util.isPromise(T))throw new Error("The execution of the op '".concat(S.op,"' returned a promise. ")+"Please use model.executeAsync() instead.");v[S.name]=T,n.keepIntermediateTensors&&(n.clonedTensorsMap[S.name]=n.cloneTensorList(T)),n.checkTensorForDisposalWithNodeLiveUntilInfo(S,v,m,g,s,w.get(S.name))}}}catch(E){p={error:E}}finally{try{x&&!x.done&&(d=b.return)&&d.call(b)}finally{if(p)throw p.error}}return n.parent==null&&m.dispose(g),t.map(function(E){return yn(E,v,m)})})},r.prototype.getFrozenTensorIds=function(e){var t=[].concat.apply([],Object.keys(e).map(function(n){return e[n]}).map(function(n){return n.map(function(a){return a.id})}));return new Set(t)},r.prototype.checkTensorForDisposal=function(e,t,n,a,i,o,s){var u,c,l,f,h,p;if(!(Ou(t)||o.has(e))){try{for(var d=Qr(n[e]),m=d.next();!m.done;m=d.next()){var v=m.value;v!=null&&(s[v.id]=(s[v.id]||0)+t.children.length)}}catch(E){u={error:E}}finally{try{m&&!m.done&&(c=d.return)&&c.call(d)}finally{if(u)throw u.error}}try{for(var g=Qr(t.inputs),y=g.next();!y.done;y=g.next()){var w=y.value;if(!Ou(w)){var b=_z(w.name,n,a);if(b!=null)try{for(var x=(h=void 0,Qr(b)),S=x.next();!S.done;S=x.next()){var v=S.value;if(!(!v||v.kept||i.has(v.id))){var T=s[v.id];T===1?(v.dispose(),delete s[v.id]):T!=null&&s[v.id]--}}}catch(E){h={error:E}}finally{try{S&&!S.done&&(p=x.return)&&p.call(x)}finally{if(h)throw h.error}}}}}catch(E){l={error:E}}finally{try{y&&!y.done&&(f=g.return)&&f.call(g)}finally{if(l)throw l.error}}}},r.prototype.checkTensorForDisposalWithNodeLiveUntilInfo=function(e,t,n,a,i,o){var s,u,c,l;function f(w){return Ou(w)||i.has(w.name)}if(!(Ou(e)||o==null))try{for(var h=Qr(o),p=h.next();!p.done;p=h.next()){var d=p.value;if(!f(d)){var m=_z(d.name,t,n);try{for(var v=(c=void 0,Qr(m)),g=v.next();!g.done;g=v.next()){var y=g.value;!y||y.kept||a.has(y.id)||y.dispose()}}catch(w){c={error:w}}finally{try{g&&!g.done&&(l=v.return)&&l.call(v)}finally{if(c)throw c.error}}}}}catch(w){s={error:w}}finally{try{p&&!p.done&&(u=h.return)&&u.call(h)}finally{if(s)throw s.error}}},r.prototype.executeAsync=function(e,t){return _t(this,void 0,void 0,function(){return Dt(this,function(n){return[2,this._executeAsync(e,t)]})})},r.prototype.disposeIntermediateTensors=function(){!this.clonedTensorsMap||(Object.values(this.clonedTensorsMap).forEach(function(e){var t,n;try{for(var a=Qr(e),i=a.next();!i.done;i=a.next()){var o=i.value;o&&!o.isDisposed&&o.dispose()}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}}),this.clonedTensorsMap=null)},r.prototype.getIntermediateTensors=function(){return this.clonedTensorsMap},r.prototype._executeAsync=function(e,t,n,a,i){return n===void 0&&(n=!1),a===void 0&&(a={}),i===void 0&&(i={}),_t(this,void 0,void 0,function(){var o,s,u,c,l,f;return Dt(this,function(h){switch(h.label){case 0:this.disposeIntermediateTensors(),n||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t));try{this.keepIntermediateTensors=Be.env().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(p){this.keepIntermediateTensors=!1,console.warn(p.message)}return o=new a$(this.weightMap,a,i,this.functionExecutorMap,this.parseNodeNameCache),this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),[4,this.executeWithControlFlow(e,o,t,n)];case 1:return s=h.sent(),u=t.map(function(p){return yn(p,s,o)}),c=u.map(function(p){return p.id}),l=Object.keys(e).map(function(p){return e[p].id}),f=new Set(Lt(Lt(Lt([],we(c),!1),we(l),!1),we(this.weightIds),!1)),Object.values(s).forEach(function(p){p.forEach(function(d){d&&!d.isDisposed&&!f.has(d.id)&&d.dispose()})}),this.parent==null&&o.dispose(f),[2,u]}})})},r.prototype.executeFunctionAsync=function(e,t,n){return _t(this,void 0,void 0,function(){var a,i=this;return Dt(this,function(o){return a=e.reduce(function(s,u,c){return s[i.inputs[c].name]=u,s},{}),[2,this._executeAsync(a,this.outputNodes,!0,t,n)]})})},r.prototype.executeWithControlFlow=function(e,t,n,a){return _t(this,void 0,void 0,function(){var i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S,T=this;return Dt(this,function(E){switch(E.label){case 0:i=Object.keys(e),o=i.map(function(C){return T.graph.nodes[va(C)[0]]}),s=n.map(function(C){return va(C)[0]}),u=new Set(s),c=s.map(function(C){return T.graph.nodes[C]}),c.length===0&&(c=this._outputs),l=i$(e,c,this.weightMap,this._initNodes),f=l.usedNodes,h=l.missingInputs,p=l.dynamicNode,d=l.syncInputs,m=Lt(Lt(Lt([],we(o),!1),we(this.graph.weights),!1),we(this._initNodes||[]),!1).map(function(C){return{node:C,contexts:t.currentContext}}),v=Object.assign({},this.weightMap),Object.keys(e).forEach(function(C){var R=we(va(C),2),_=R[0],M=R[1],$=[];$[M]=e[C],v[_]=$}),g={},y=this.getFrozenTensorIds(v),w={},E.label=1;case 1:return m.length>0?(b=this.processStack(o,m,t,v,w,y,u,g,f),[4,Promise.all(b)]):[3,3];case 2:return E.sent(),[3,1];case 3:if(p==null&&!a&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),x=c.filter(function(C){return!Ou(C)&&!yn(C.name,v,t)}).map(function(C){return C.name}),x.length>0)throw S="",p!=null&&(S="Alternatively, to avoid the dynamic ops, use model.execute() "+"and specify the inputs [".concat(d,"]")),new Error("Cannot compute the outputs [".concat(x,"] from the provided ")+"inputs [".concat(i,"]. Consider providing the following inputs: ")+"[".concat(h,"]. ").concat(S));return[2,v]}})})},r.prototype.processStack=function(e,t,n,a,i,o,s,u,c){for(var l=this,f=[],h=function(){var d,m,v=t.pop();n.currentContext=v.contexts;var g="";if(v.node.op==="Enter"&&I("isConstant",v.node,a,n)&&(d=we(Ao(v.node.name,n),1),g=d[0]),a[v.node.name]==null){var y=n$(v.node,a,n,p._resourceManager);g||(m=we(Ao(v.node.name,n),1),g=m[0]);var w=n.currentContext;Be.util.isPromise(y)?f.push(y.then(function(b){return a[g]=b,l.keepIntermediateTensors&&(l.clonedTensorsMap[g]=l.cloneTensorList(b)),n.currentContext=w,l.checkTensorForDisposal(g,v.node,a,n,o,s,u),l.processChildNodes(v.node,t,n,a,i,c),b})):(a[g]=y,p.keepIntermediateTensors&&(p.clonedTensorsMap[g]=p.cloneTensorList(y)),p.checkTensorForDisposal(g,v.node,a,n,o,s,u),p.processChildNodes(v.node,t,n,a,i,c))}else p.processChildNodes(v.node,t,n,a,i,c)},p=this;t.length>0;)h();return f},r.prototype.processChildNodes=function(e,t,n,a,i,o){e.children.forEach(function(s){var u=we(Ao(s.name,n),1),c=u[0];i[c]||!o.has(s.name)||(s.op==="Merge"?s.inputNames.some(function(l){return!!yn(l,a,n)})&&(i[c]=!0,t.push({contexts:n.currentContext,node:s})):s.inputNames.every(function(l){return!!yn(l,a,n)})&&(i[c]=!0,t.push({contexts:n.currentContext,node:s})))})},r.prototype.dispose=function(){var e=this;Object.keys(this.weightMap).forEach(function(t){return e.weightMap[t].forEach(function(n){return n.dispose()})})},r.prototype.checkInputShapeAndType=function(e){var t=this;Object.keys(e).forEach(function(n){var a=e[n],i=we(va(n),1),o=i[0],s=t.graph.nodes[o];if(s.attrParams.shape&&s.attrParams.shape.value){var u=s.attrParams.shape.value,c=u.length===a.shape.length&&a.shape.every(function(l,f){return u[f]===-1||u[f]===l});Be.util.assert(c,function(){return"The shape of dict['".concat(s.name,"'] provided in ")+"model.execute(dict) must be [".concat(u,"], but was ")+"[".concat(a.shape,"]")})}s.attrParams.dtype&&s.attrParams.dtype.value&&Be.util.assert(a.dtype===s.attrParams.dtype.value,function(){return"The dtype of dict['".concat(s.name,"'] provided in ")+"model.execute(dict) must be "+"".concat(s.attrParams.dtype.value,", but was ").concat(a.dtype)})})},r.prototype.mapInputs=function(e){var t,n,a={};for(var i in e){var o=(n=(t=this._signature)===null||t===void 0?void 0:t.inputs)===null||n===void 0?void 0:n[i];o!=null?a[o.name]=e[i]:a[i]=e[i]}return a},r.prototype.checkInputs=function(e){var t=this,n=Object.keys(e).filter(function(a){var i=we(va(a),1),o=i[0];return t.graph.nodes[o]==null});if(n.length>0)throw new Error("The dict provided in model.execute(dict) has "+"keys: [".concat(n,"] that are not part of graph"))},r.prototype.mapOutputs=function(e){var t=this;return e.map(function(n){var a,i,o=(i=(a=t._signature)===null||a===void 0?void 0:a.outputs)===null||i===void 0?void 0:i[n];return o!=null?o.name:n},{})},r.prototype.checkOutputs=function(e){var t=this;e.forEach(function(n){var a=we(va(n),1),i=a[0];if(!t.graph.nodes[i])throw new Error("The output '".concat(n,"' is not found in the graph"))})},r}(),aUe=function(){function r(e,t){e===void 0&&(e={}),t===void 0&&(t={}),this.hashTableNameToHandle=e,this.hashTableMap=t}return r.prototype.addHashTable=function(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t},r.prototype.getHashTableHandleByName=function(e){return this.hashTableNameToHandle[e]},r.prototype.getHashTableById=function(e){return this.hashTableMap[e]},r.prototype.dispose=function(){for(var e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(var t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]},r}();var Xm={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},Ym=4;function iUe(r,e){return _t(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c;return Dt(this,function(l){switch(l.label){case 0:return t=un(r.shape),"quantization"in r?(a=r.quantization,n=Xm[a.dtype],[3,7]):[3,1];case 1:if(r.dtype!=="string")return[3,6];i=0,o=0,l.label=2;case 2:return o<t?(s=i,u=Ym,c=Uint32Array.bind,[4,e(i,i+Ym)]):[3,5];case 3:i=s+(u+new(c.apply(Uint32Array,[void 0,l.sent()]))()[0]),l.label=4;case 4:return o++,[3,2];case 5:return[2,i];case 6:n=Xm[r.dtype],l.label=7;case 7:return[2,t*n]}})})}function oUe(r,e){var t=r.name,n=r.dtype,a=r.shape,i=un(a),o,s=0;if("quantization"in r){var u=r.quantization;if(u.dtype==="uint8"||u.dtype==="uint16"){if(!("min"in u&&"scale"in u))throw new Error("Weight ".concat(r.name," with quantization ").concat(u.dtype," ")+"doesn't have corresponding metadata min and scale.")}else if(u.dtype==="float16"){if(n!=="float32")throw new Error("Weight ".concat(r.name," is quantized with ").concat(u.dtype," ")+"which only supports weights of type float32 not ".concat(n,"."))}else throw new Error("Weight ".concat(r.name," has unknown ")+"quantization dtype ".concat(u.dtype,". ")+"Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.");var c=Xm[u.dtype],l=u.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(n==="float32")if(u.dtype==="uint8"||u.dtype==="uint16"){o=new Float32Array(l.length);for(var f=0;f<l.length;f++){var h=l[f];o[f]=h*u.scale+u.min}}else if(u.dtype==="float16"){var p=fUe();o=p(l)}else throw new Error("Unsupported quantization type ".concat(u.dtype," ")+"for weight type float32.");else if(n==="int32"){if(u.dtype!=="uint8"&&u.dtype!=="uint16")throw new Error("Unsupported quantization type ".concat(u.dtype," ")+"for weight type int32.");o=new Int32Array(l.length);for(var f=0;f<l.length;f++){var h=l[f];o[f]=Math.round(h*u.scale+u.min)}}else throw new Error("Unsupported dtype in weight '".concat(t,"': ").concat(n));s+=i*c}else if(n==="string"){var d=un(r.shape);o=[];for(var f=0;f<d;f++){var m=new Uint32Array(e.slice(s,s+Ym))[0];s+=Ym;var v=new Uint8Array(e.slice(s,s+m));o.push(v),s+=m}}else{var g=Xm[n];if(n==="float32")o=new Float32Array(e);else if(n==="int32")o=new Int32Array(e);else if(n==="bool")o=new Uint8Array(e);else if(n==="complex64"){o=new Float32Array(e);for(var y=new Float32Array(o.length/2),w=new Float32Array(o.length/2),f=0;f<y.length;f++)y[f]=o[f*2],w[f]=o[f*2+1];var b=fl(y,a,"float32"),x=fl(w,a,"float32"),S=Es(b,x);return b.dispose(),x.dispose(),S}else throw new Error("Unsupported dtype in weight '".concat(t,"': ").concat(n));s+=i*g}return fl(o,a,n)}function s$(r,e,t){return _t(this,void 0,void 0,function(){var n,a,i,o,s,u;return Dt(this,function(c){switch(c.label){case 0:n=new Uint8Array(e),c.label=1;case 1:return n.byteLength<t?[4,r.read()]:[3,3];case 2:if(a=c.sent(),i=a.done,o=a.value,i&&o==null)throw s=t-n.byteLength,new Error("Reader is done but ".concat(s," bytes are still expected"));return u=new Uint8Array(n.length+o.byteLength),u.set(n,0),u.set(new Uint8Array(o),n.length),n=u,[3,1];case 3:return[2,n.buffer]}})})}function sUe(r,e){return _t(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h,p,d,m=this;return Dt(this,function(v){switch(v.label){case 0:t={},n=r.getReader(),a=new ArrayBuffer(0),v.label=1;case 1:v.trys.push([1,7,8,9]),i=Qr(e),o=i.next(),v.label=2;case 2:return o.done?[3,6]:(s=o.value,[4,iUe(s,function(g,y){return _t(m,void 0,void 0,function(){return Dt(this,function(w){switch(w.label){case 0:return[4,s$(n,a,y)];case 1:return a=w.sent(),[2,a.slice(g,y)]}})})})]);case 3:return u=v.sent(),[4,s$(n,a,u)];case 4:a=v.sent(),c=a.slice(0,u),a=a.slice(u),l=oUe(s,c),t[s.name]=l,sze()==="webgpu"&&(f=uze(),"uploadToGPU"in f&&un(l.shape)>=jn().get("WEBGPU_CPU_HANDOFF_SIZE_THRESHOLD")&&f.uploadToGPU(l.dataId)),v.label=5;case 5:return o=i.next(),[3,2];case 6:return[3,9];case 7:return h=v.sent(),p={error:h},[3,9];case 8:try{o&&!o.done&&(d=i.return)&&d.call(i)}finally{if(p)throw p.error}return[7];case 9:return[2,t]}})})}function uUe(){var r=function(n){for(var a=n<<13,i=0;(a&8388608)===0;)i-=8388608,a<<=1;return a&=-8388609,i+=947912704,a|i},e=new Uint32Array(2048);e[0]=0;for(var t=1;t<1024;t++)e[t]=r(t);for(var t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function cUe(){var r=new Uint32Array(64);r[0]=0,r[31]=1199570944,r[32]=2147483648,r[63]=3347054592;for(var e=1;e<31;e++)r[e]=e<<23;for(var e=33;e<63;e++)r[e]=2147483648+(e-32<<23);return r}function lUe(){for(var r=new Uint32Array(64),e=0;e<64;e++)r[e]=1024;return r[0]=r[32]=0,r}function fUe(){var r=uUe(),e=cUe(),t=lUe();return function(n){for(var a=new ArrayBuffer(4*n.length),i=new Uint32Array(a),o=0;o<n.length;o++){var s=n[o],u=r[t[s>>10]+(s&1023)]+e[s>>10];i[o]=u}return new Float32Array(a)}}var hUe="?tfjs-format=file",pUe="model.json",c2=function(){function r(e,t,n){t===void 0&&(t={}),n===void 0&&(n=Be.io),this.modelUrl=e,this.loadOptions=t,this.version="n/a",this.io=n,t==null&&(this.loadOptions={}),this.resourceManager=new aUe}return Object.defineProperty(r.prototype,"modelVersion",{get:function(){return this.version},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"metadata",{get:function(){return this.artifacts.userDefinedMetadata},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"modelSignature",{get:function(){return this.signature},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"modelStructuredOutputKeys",{get:function(){return this.structuredOutputKeys},enumerable:!1,configurable:!0}),r.prototype.findIOHandler=function(){var e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{var t=this.io.getLoadHandlers(e,this.loadOptions);if(t.length===0)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one (".concat(t.length,") load handlers for ")+"URL '".concat([e],"'"));this.handler=t[0]}},r.prototype.load=function(){var e=this;if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");var t=this.handler.load();return Be.util.isPromise(t)?t.then(function(n){return n.getWeightStream==null?e.loadSync(n):e.loadStreaming(n)}):this.loadSync(t)},r.prototype.loadSync=function(e){var t=this.io.decodeWeights(e.weightData,e.weightSpecs);return this.loadWithWeightMap(e,t)},r.prototype.loadStreaming=function(e){return _t(this,void 0,void 0,function(){var t;return Dt(this,function(n){switch(n.label){case 0:if(e.getWeightStream==null)throw new Error("Model artifacts missing streamWeights function");return[4,sUe(e.getWeightStream(),e.weightSpecs)];case 1:return t=n.sent(),[2,this.loadWithWeightMap(e,t)]}})})},r.prototype.loadWithWeightMap=function(e,t){this.artifacts=e;var n=this.artifacts.modelTopology,a=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){var i=this.artifacts.userDefinedMetadata;i.signature!=null&&(a=i.signature),i.structuredOutputKeys!=null&&(this.structuredOutputKeys=i.structuredOutputKeys)}if(this.signature=a,this.version="".concat(n.versions.producer,".").concat(n.versions.minConsumer),this.executor=new o$(Fz.Instance.transformGraph(n,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(t),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){var o=Fz.Instance.transformGraph(e.modelInitializer);this.initializer=new o$(o),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0},r.prototype.save=function(e,t){return _t(this,void 0,void 0,function(){var n;return Dt(this,function(a){if(typeof e=="string"){if(n=this.io.getSaveHandlers(e),n.length===0)throw new Error("Cannot find any save handlers for URL '".concat(e,"'"));if(n.length>1)throw new Error("Found more than one (".concat(n.length,") save handlers for ")+"URL '".concat(e,"'"));e=n[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[2,e.save(this.artifacts)]})})},r.prototype.addStructuredOutputNames=function(e){var t=this;if(this.structuredOutputKeys){var n=e instanceof Be.Tensor?[e]:e,a={};return n.forEach(function(i,o){return a[t.structuredOutputKeys[o]]=i}),a}return e},r.prototype.predict=function(e,t){var n=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(n)},r.prototype.predictAsync=function(e,t){return _t(this,void 0,void 0,function(){var n;return Dt(this,function(a){switch(a.label){case 0:return[4,this.executeAsync(e,this.outputNodes)];case 1:return n=a.sent(),[2,this.addStructuredOutputNames(n)]}})})},r.prototype.normalizeInputs=function(e){var t=this,n;if(!(e instanceof Be.Tensor)&&!Array.isArray(e)){var a=(n=this.signature)===null||n===void 0?void 0:n.inputs;if(a!=null)for(var i in a){var o=a[i];o.resourceId!=null&&(e[i]=this.resourceIdToCapturedInput[o.resourceId])}return e}e=Array.isArray(e)?e:[e];var s=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+s!==this.inputNodes.length)throw new Error("Input tensor count mismatch, the graph model has ".concat(this.inputNodes.length-s," non-resource placeholders, while there are ").concat(e.length," input tensors provided."));var u=0;return this.inputNodes.reduce(function(c,l){var f,h,p,d=(p=(h=(f=t.signature)===null||f===void 0?void 0:f.inputs)===null||h===void 0?void 0:h[l])===null||p===void 0?void 0:p.resourceId;return d!=null?c[l]=t.resourceIdToCapturedInput[d]:c[l]=e[u++],c},{})},r.prototype.normalizeOutputs=function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]},r.prototype.executeInitializerGraph=function(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))},r.prototype.executeInitializerGraphAsync=function(){return _t(this,void 0,void 0,function(){return Dt(this,function(e){return this.initializer==null?[2,[]]:this.initializerSignature==null?[2,this.initializer.executeAsync({},[])]:[2,this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))]})})},r.prototype.setResourceIdToCapturedInput=function(e){if(this.resourceIdToCapturedInput={},this.initializerSignature)for(var t=this.initializerSignature.outputs,n=Object.keys(t),a=0;a<n.length;a++){var i=n[a],o=t[i];this.resourceIdToCapturedInput[o.resourceId]=e[a]}},r.prototype.execute=function(e,t){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var n=this.executor.execute(e,t);return n.length>1?n:n[0]},r.prototype.executeAsync=function(e,t){return _t(this,void 0,void 0,function(){var n,a;return Dt(this,function(i){switch(i.label){case 0:return this.resourceIdToCapturedInput!=null?[3,2]:(n=this.setResourceIdToCapturedInput,[4,this.executeInitializerGraphAsync()]);case 1:n.apply(this,[i.sent()]),i.label=2;case 2:return e=this.normalizeInputs(e),t=this.normalizeOutputs(t),[4,this.executor.executeAsync(e,t)];case 3:return a=i.sent(),[2,a.length>1?a:a[0]]}})})},r.prototype.getIntermediateTensors=function(){return this.executor.getIntermediateTensors()},r.prototype.disposeIntermediateTensors=function(){this.executor.disposeIntermediateTensors()},r.prototype.convertTensorMapToTensorsMap=function(e){return Object.keys(e).reduce(function(t,n){return t[n]=[e[n]],t},{})},r.prototype.dispose=function(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&Be.dispose(this.resourceIdToCapturedInput)),this.resourceManager.dispose()},r}();function dUe(r,e,t){return e===void 0&&(e={}),t===void 0&&(t=Be.io),_t(this,void 0,void 0,function(){var n;return Dt(this,function(a){switch(a.label){case 0:if(r==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");return e==null&&(e={}),e.fromTFHub&&typeof r=="string"&&(r=mUe(r)),n=new c2(r,e,t),[4,n.load()];case 1:return a.sent(),[2,n]}})})}function vUe(r){if(r==null)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");var e;if(r instanceof Array){var t=we(r,2),n=t[0],a=t[1];if(!n)throw new Error("modelJSON must be the first element of the array");if(!a||!(a instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in n))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in n))throw new Error("Model JSON is missing 'weightsManifest'");var i=Be.io.getWeightSpecs(n.weightsManifest),o=Be.io.getModelArtifactsForJSONSync(n,i,a);e=Be.io.fromMemorySync(o)}else if("load"in r)e=r;else if("modelTopology"in r&&"weightSpecs"in r&&"weightData"in r)e=Be.io.fromMemorySync(r);else throw new Error("Unknown model format");var s=new c2(e);return s.load(),s}function mUe(r){return r.endsWith("/")||(r=r+"/"),"".concat(r).concat(pUe).concat(hUe)}var gUe="4.19.0";Uu.GraphModel=c2;Uu.deregisterOp=G_e;Uu.loadGraphModel=dUe;Uu.loadGraphModelSync=vUe;Uu.registerOp=V_e;Uu.version_converter=gUe});var l2=O(()=>{});var NW=O(()=>{});var ZW=O(xa=>{"use strict";var Dr=mu();function yUe(r){var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var kr=yUe(Dr),h2=function(r,e){return h2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},h2(r,e)};function qt(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");h2(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Le(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(f){o(f)}}function u(l){try{c(n.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((n=n.apply(r,e||[])).next())})}function qe(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Vu(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function bUe(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function wUe(r,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}var Gu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function xUe(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){if(this instanceof n){var a=[null];a.push.apply(a,arguments);var i=Function.bind.apply(e,a);return new i}return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var a=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,a.get?a:{enumerable:!0,get:function(){return r[n]}})}),t}var CW={exports:{}};(function(r){(function(e,t,n){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(Gu,r,!1)})(CW);var kUe=CW.exports,AW={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(Gu,r,!1)})(AW);var SUe=AW.exports,DW={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(Gu,r,!1)})(DW);var NUe=DW.exports,_W={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,p;return h=l[f],h^=h>>>7,p=h^h<<24,h=l[f+1&7],p^=h^h>>>10,h=l[f+3&7],p^=h^h>>>3,h=l[f+4&7],p^=h^h<<7,h=l[f+7&7],h=h^h<<13,p^=h^h<<9,l[f]=p,u.i=f+1&7,p};function c(l,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8?p[7]=-1:p[h],l.x=p,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(Gu,r,!1)})(_W);var TUe=_W.exports,FW={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,p,d;return u.w=l=l+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(l^l>>>16)|0};function c(l,f){var h,p,d,m,v,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,m=-32;m<y;++m)f&&(p^=f.charCodeAt((m+32)%f.length)),m===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(v=v+1640531527|0,h=g[m&127]^=p+v,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,m=4*128;m>0;--m)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;l.w=v,l.X=g,l.i=d}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(Gu,r,!1)})(FW);var EUe=FW.exports,RW={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(Gu,r,!1)})(RW);var IUe=RW.exports,OW={exports:{}},CUe={},AUe={__proto__:null,default:CUe},DUe=xUe(AUe);(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),c=n.pow(2,o),l=c*2,f=a-1,h;function p(b,x,S){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(v(x.entropy?[b,w(t)]:b??y(),3),T),C=new d(T),R=function(){for(var _=C.g(i),M=u,$=0;_<c;)_=(_+$)*a,M*=a,$=C.g(1);for(;_>=l;)_/=2,M/=2,$>>>=1;return(_+$)/M};return R.int32=function(){return C.g(4)|0},R.quick=function(){return C.g(4)/4294967296},R.double=R,g(w(C.S),t),(x.pass||S||function(_,M,$,z){return z&&(z.S&&m(z,C),_.state=function(){return m(C,{})}),$?(n[s]=_,M):_})(R,E,"global"in x?x.global:this==n,x.state)}function d(b){var x,S=b.length,T=this,E=0,C=T.i=T.j=0,R=T.S=[];for(S||(b=[S++]);E<a;)R[E]=E++;for(E=0;E<a;E++)R[E]=R[C=f&C+b[E%S]+(x=R[E])],R[C]=x;(T.g=function(_){for(var M,$=0,z=T.i,q=T.j,L=T.S;_--;)M=L[z=f&z+1],$=$*a+L[f&(L[z]=L[q=f&q+M])+(L[q]=M)];return T.i=z,T.j=q,$})(a)}function m(b,x){return x.i=b.i,x.j=b.j,x.S=b.S.slice(),x}function v(b,x){var S=[],T=typeof b,E;if(x&&T=="object")for(E in b)try{S.push(v(b[E],x-1))}catch{}return S.length?S:T=="string"?b:b+"\0"}function g(b,x){for(var S=b+"",T,E=0;E<S.length;)x[f&E]=f&(T^=x[f&E]*19)+S.charCodeAt(E++);return w(x)}function y(){try{var b;return h&&(b=h.randomBytes)?b=b(a):(b=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(b)),w(b)}catch{var x=e.navigator,S=x&&x.plugins;return[+new Date,e,S,e.screen,w(t)]}}function w(b){return String.fromCharCode.apply(0,b)}if(g(n.random(),t),r.exports){r.exports=p;try{h=DUe}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:Gu,[],Math)})(OW);var _Ue=OW.exports,FUe=kUe,RUe=SUe,OUe=NUe,PUe=TUe,MUe=EUe,BUe=IUe,Hu=_Ue;Hu.alea=FUe;Hu.xor128=RUe;Hu.xorwow=OUe;Hu.xorshift7=PUe;Hu.xor4096=MUe;Hu.tychei=BUe;var PW=Hu;function LUe(r,e){return fg(r,e)}function fg(r,e,t,n){if(t===void 0&&(t=new Map),n===void 0&&(n=new Set),r==null)return null;if(typeof Blob=="function"&&r instanceof Blob)return r.slice();if(n.has(r))throw new Error("Circular references are not supported.");if(t.has(r))return t.get(r);var a=e(r);if(a.recurse&&a.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse)if(gl(r)){var i=Array.isArray(r)?[]:{};n.add(r);for(var o in r){var s=r[o],u=fg(s,e,t,n);i[o]=u}return n.delete(r),r.__proto__&&(i.__proto__=r.__proto__),i}else throw new Error("Can't recurse into non-iterable type: ".concat(r));else return t.set(r,a.value),a.value}function qUe(r,e){return e===void 0&&(e=BW),MW(r,e)}function MW(r,e,t){t===void 0&&(t=new Set);var n=r[0];if(t.has(n))throw new Error("Circular references are not supported.");var a=e(r);if(a.recurse&&a.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse)if(gl(n)){var i=Array.isArray(n)?[]:{};t.add(n);var o=function(u){var c=r.map(function(f){return f[u]}),l=MW(c,e,t);i[u]=l};for(var s in n)o(s);return t.delete(n),i}else throw new Error("Can't recurse into non-iterable type: ".concat(n));else return a.value}function BW(r){return r===null?null:gl(r[0])?{value:null,recurse:!0}:{value:r,recurse:!1}}function LW(r,e){return Le(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f;return qe(this,function(h){switch(h.label){case 0:t=new Map,fg(r,e,t),h.label=1;case 1:h.trys.push([1,6,7,8]),n=Vu(Array.from(t.keys())),a=n.next(),h.label=2;case 2:return a.done?[3,5]:(i=a.value,o=t.get(i),kr.util.isPromise(o)?[4,o]:[3,4]);case 3:s=h.sent(),t.set(i,s),h.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return u=h.sent(),l={error:u},[3,8];case 7:try{a&&!a.done&&(f=n.return)&&f.call(n)}finally{if(l)throw l.error}return[7];case 8:return c=fg(r,e,t),[2,c]}})})}function gl(r){var e=!1;if(kr.env().get("IS_BROWSER"))e=r instanceof TextDecoder;else{var t=l2().StringDecoder;e=r instanceof t}return r!=null&&!ArrayBuffer.isView(r)&&(Array.isArray(r)||typeof r=="object"&&!(r instanceof kr.Tensor)&&!(r instanceof Promise)&&!e)}function zUe(r){return r==null||$Ue(r)||Array.isArray(r)||typeof r=="object"&&r instanceof kr.Tensor||kr.util.isTypedArray(r)}function $Ue(r){return r===null||typeof r!="object"&&typeof r!="function"}function WUe(r){return LUe(r,UUe)}function UUe(r){return r instanceof kr.Tensor?{value:r.clone(),recurse:!1}:gl(r)?{value:null,recurse:!0}:{value:r,recurse:!1}}var qW=function(){function r(e){if(this.capacity=e,this.begin=0,this.end=0,e==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}return r.prototype.wrap=function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity},r.prototype.get=function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]},r.prototype.set=function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t},r.prototype.length=function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e},r.prototype.isFull=function(){return this.length()===this.capacity},r.prototype.isEmpty=function(){return this.length()===0},r.prototype.push=function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)},r.prototype.pushAll=function(e){var t,n;try{for(var a=Vu(e),i=a.next();!i.done;i=a.next()){var o=i.value;this.push(o)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},r.prototype.pop=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e},r.prototype.unshift=function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)},r.prototype.shift=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e},r.prototype.shuffleExcise=function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n},r}(),zW=function(r){qt(e,r);function e(){return r.call(this,e.INITIAL_CAPACITY)||this}return e.prototype.isFull=function(){return!1},e.prototype.push=function(t){r.prototype.isFull.call(this)&&this.expand(),r.prototype.push.call(this,t)},e.prototype.unshift=function(t){r.prototype.isFull.call(this)&&this.expand(),r.prototype.unshift.call(this,t)},e.prototype.expand=function(){for(var t=this.capacity*2,n=new Array(t),a=this.length(),i=0;i<a;i++)n[i]=this.get(this.wrap(this.begin+i));this.data=n,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=a},e}(qW);zW.INITIAL_CAPACITY=32;function $W(r){return new HUe(r)}function p2(r){return new jUe(r)}function VUe(r,e){return new WW(r,e)}function GUe(r,e){return e===void 0&&(e=Ds.FAIL),new rVe(r,e)}var fn=function(){function r(){}return r.prototype.toArray=function(){return Le(this,void 0,void 0,function(){var e,t;return qe(this,function(n){switch(n.label){case 0:return e=[],[4,this.next()];case 1:t=n.sent(),n.label=2;case 2:return t.done?[3,4]:(e.push(t.value),[4,this.next()]);case 3:return t=n.sent(),[3,2];case 4:return[2,e]}})})},r.prototype.toArrayForTest=function(){return Le(this,void 0,void 0,function(){var e,t,n;return qe(this,function(a){switch(a.label){case 0:return e=this.prefetch(100),t=[],[4,e.next()];case 1:n=a.sent(),a.label=2;case 2:return n.done?[3,4]:(t.push(n.value),[4,e.next()]);case 3:return n=a.sent(),[3,2];case 4:return[2,t]}})})},r.prototype.resolveFully=function(){return Le(this,void 0,void 0,function(){var e;return qe(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:e=t.sent(),t.label=2;case 2:return e.done?[3,4]:[4,this.next()];case 3:return e=t.sent(),[3,2];case 4:return[2]}})})},r.prototype.resolveWhile=function(e){return Le(this,void 0,void 0,function(){var t,n;return qe(this,function(a){switch(a.label){case 0:return[4,this.next()];case 1:t=a.sent(),n=e(t.value),a.label=2;case 2:return!t.done&&n?[4,this.next()]:[3,4];case 3:return t=a.sent(),n=e(t.value),[3,2];case 4:return[2]}})})},r.prototype.handleErrors=function(e){return new eVe(this,e)},r.prototype.filter=function(e){return new ZUe(this,e)},r.prototype.map=function(e){return new QUe(this,e)},r.prototype.mapAsync=function(e){return new TW(this,e)},r.prototype.serialMapAsync=function(e){return new TW(this,e).serial()},r.prototype.flatmap=function(e){return new tVe(this,e)},r.prototype.forEachAsync=function(e){return Le(this,void 0,void 0,function(){return qe(this,function(t){return[2,this.map(e).resolveFully()]})})},r.prototype.serialForEach=function(e){return Le(this,void 0,void 0,function(){return qe(this,function(t){return[2,this.serialMapAsync(e).resolveWhile(function(n){return n===!0})]})})},r.prototype.rowMajorBatch=function(e,t){return t===void 0&&(t=!0),new JUe(this,e,t)},r.prototype.columnMajorBatch=function(e,t,n){t===void 0&&(t=!0),n===void 0&&(n=BW);var a=this.rowMajorBatch(e,t);return a.map(function(i){return qUe(i,n)})},r.prototype.concatenate=function(e,t){return new WW($W([this,e]),t)},r.prototype.take=function(e){return e<0||e==null?this:new YUe(this,e)},r.prototype.skip=function(e){return e<0||e==null?this:new XUe(this,e)},r.prototype.prefetch=function(e){return new UW(this,e)},r.prototype.shuffle=function(e,t){return new nVe(this,e,t)},r.prototype.serial=function(){return new KUe(this)},r}(),HUe=function(r){qt(e,r);function e(t){var n=r.call(this)||this;return n.items=t,n.trav=0,n}return e.prototype.summary=function(){return"Array of ".concat(this.items.length," items")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t;return qe(this,function(n){return this.trav>=this.items.length?[2,{value:null,done:!0}]:(t=this.items[this.trav],this.trav++,[2,{value:WUe(t),done:!1}])})})},e}(fn),jUe=function(r){qt(e,r);function e(t){var n=r.call(this)||this;return n.nextFn=t,n}return e.prototype.summary=function(){return"Function call"},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return qe(this,function(t){try{return[2,this.nextFn()]}catch(n){throw n.message="Error thrown while iterating through a dataset: ".concat(n.message),n}return[2]})})},e}(fn),KUe=function(r){qt(e,r);function e(t){var n=r.call(this)||this;return n.upstream=t,n.lastRead=Promise.resolve({value:null,done:!1}),n}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Serial")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return qe(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){return qe(this,function(t){return[2,this.upstream.next()]})})},e}(fn),XUe=function(r){qt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.maxCount=n,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Skip")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return qe(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t;return qe(this,function(n){switch(n.label){case 0:return this.count++<this.maxCount?[4,this.upstream.next()]:[3,2];case 1:return t=n.sent(),t.done?[2,t]:(kr.dispose(t.value),[3,0]);case 2:return[2,this.upstream.next()]}})})},e}(fn),YUe=function(r){qt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.maxCount=n,a.count=0,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Take")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return qe(this,function(t){return this.count++>=this.maxCount?[2,{value:null,done:!0}]:[2,this.upstream.next()]})})},e}(fn),JUe=function(r){qt(e,r);function e(t,n,a){a===void 0&&(a=!0);var i=r.call(this)||this;return i.upstream=t,i.batchSize=n,i.enableSmallLastBatch=a,i.lastRead=Promise.resolve({value:null,done:!1}),i}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> RowMajorBatch")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return qe(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t,n;return qe(this,function(a){switch(a.label){case 0:t=[],a.label=1;case 1:return t.length<this.batchSize?[4,this.upstream.next()]:[3,3];case 2:return n=a.sent(),n.done?this.enableSmallLastBatch&&t.length>0?[2,{value:t,done:!1}]:[2,{value:null,done:!0}]:(t.push(n.value),[3,1]);case 3:return[2,{value:t,done:!1}]}})})},e}(fn),ZUe=function(r){qt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.predicate=n,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Filter")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return qe(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t;return qe(this,function(n){switch(n.label){case 0:return[4,this.upstream.next()];case 1:return t=n.sent(),t.done||this.predicate(t.value)?[2,t]:(kr.dispose(t.value),[3,0]);case 2:return[2]}})})},e}(fn),QUe=function(r){qt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.transform=n,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Map")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l;return qe(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:if(t=f.sent(),t.done)return[2,{value:null,done:!0}];n=kr.tensor_util.getTensorsInContainer(t.value),a=this.transform(t.value),i=kr.tensor_util.getTensorsInContainer(a);try{for(o=Vu(n),s=o.next();!s.done;s=o.next())u=s.value,kr.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){c={error:h}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}return[2,{value:a,done:!1}]}})})},e}(fn),eVe=function(r){qt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.handler=n,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> handleErrors")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return qe(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t;return qe(this,function(n){switch(n.label){case 0:n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.upstream.next()];case 2:return[2,n.sent()];case 3:return t=n.sent(),this.handler(t)?[3,4]:[2,{value:null,done:!0}];case 4:return[3,0];case 5:return[2]}})})},e}(fn),TW=function(r){qt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.transform=n,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> AsyncMap")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l;return qe(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:return t=f.sent(),t.done?[2,{value:null,done:!0}]:(n=kr.tensor_util.getTensorsInContainer(t.value),[4,this.transform(t.value)]);case 2:a=f.sent(),i=kr.tensor_util.getTensorsInContainer(a);try{for(o=Vu(n),s=o.next();!s.done;s=o.next())u=s.value,kr.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){c={error:h}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}return[2,{value:a,done:!1}]}})})},e}(fn),d2=function(r){qt(e,r);function e(){var t=r.call(this)||this;return t.outputQueue=new zW,t.lastRead=Promise.resolve({value:null,done:!1}),t}return e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return qe(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){return qe(this,function(t){switch(t.label){case 0:return this.outputQueue.length()!==0?[3,2]:[4,this.pump()];case 1:return t.sent()?[3,0]:[2,{value:null,done:!0}];case 2:return[2,{value:this.outputQueue.shift(),done:!1}]}})})},e}(fn),tVe=function(r){qt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.transform=n,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Flatmap")},e.prototype.pump=function(){return Le(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l;return qe(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:if(t=f.sent(),t.done)return[2,!1];n=kr.tensor_util.getTensorsInContainer(t.value),a=this.transform(t.value),i=kr.tensor_util.getTensorsInContainer(a),this.outputQueue.pushAll(a);try{for(o=Vu(n),s=o.next();!s.done;s=o.next())u=s.value,kr.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){c={error:h}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}return[2,!0]}})})},e}(d2),WW=function(r){qt(e,r);function e(t,n){var a=r.call(this)||this;return a.baseErrorHandler=n,a.lastRead=null,a.iterator=null,a.moreIterators=t,a}return e.prototype.summary=function(){var t="TODO: fill in upstream of chained summaries";return"".concat(t," -> Chained")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return qe(this,function(t){return this.lastRead=this.readFromChain(this.lastRead),[2,this.lastRead]})})},e.prototype.readFromChain=function(t){return Le(this,void 0,void 0,function(){var n,a;return qe(this,function(i){switch(i.label){case 0:return[4,t];case 1:return i.sent(),this.iterator!=null?[3,3]:[4,this.moreIterators.next()];case 2:if(n=i.sent(),n.done)return[2,{value:null,done:!0}];this.iterator=n.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler)),i.label=3;case 3:return[4,this.iterator.next()];case 4:return a=i.sent(),a.done?(this.iterator=null,[2,this.readFromChain(t)]):[2,a]}})})},e}(fn),Ds;(function(r){r[r.FAIL=0]="FAIL",r[r.SHORTEST=1]="SHORTEST",r[r.LONGEST=2]="LONGEST"})(Ds||(Ds={}));var rVe=function(r){qt(e,r);function e(t,n){n===void 0&&(n=Ds.FAIL);var a=r.call(this)||this;return a.iterators=t,a.mismatchMode=n,a.count=0,a.currentPromise=null,a}return e.prototype.summary=function(){var t="TODO: fill in upstream of zip summaries";return"{".concat(t,"} -> Zip")},e.prototype.nextState=function(t){return Le(this,void 0,void 0,function(){function n(s){if(s instanceof fn){var u=s.next();return{value:u.then(function(c){return a++,c.done&&i++,c.value}),recurse:!1}}else return{value:null,recurse:!0}}var a,i,o;return qe(this,function(s){switch(s.label){case 0:return[4,t];case 1:return s.sent(),a=0,i=0,[4,LW(this.iterators,n)];case 2:if(o=s.sent(),a===i)return[2,{value:null,done:!0}];if(i>0)switch(this.mismatchMode){case Ds.FAIL:throw new Error("Zipped streams should have the same length. "+"Mismatched at element ".concat(this.count,"."));case Ds.SHORTEST:return[2,{value:null,done:!0}];case Ds.LONGEST:}return this.count++,[2,{value:o,done:!1}]}})})},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return qe(this,function(t){return this.currentPromise=this.nextState(this.currentPromise),[2,this.currentPromise]})})},e}(fn),UW=function(r){qt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.bufferSize=n,a.buffer=new qW(n),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Prefetch")},e.prototype.refill=function(){for(;!this.buffer.isFull();){var t=this.upstream.next();this.buffer.push(t)}},e.prototype.next=function(){return this.refill(),this.buffer.shift()},e}(fn),nVe=function(r){qt(e,r);function e(t,n,a){var i=r.call(this,t,n)||this;return i.upstream=t,i.windowSize=n,i.upstreamExhausted=!1,i.random=PW.alea(a||kr.util.now().toString()),i.lastRead=Promise.resolve({value:null,done:!1}),i}return e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return qe(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.randomInt=function(t){return Math.floor(this.random()*t)},e.prototype.chooseIndex=function(){return this.randomInt(this.buffer.length())},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t,n;return qe(this,function(a){switch(a.label){case 0:this.upstreamExhausted||this.refill(),a.label=1;case 1:return this.buffer.isEmpty()?[3,3]:(t=this.chooseIndex(),[4,this.buffer.shuffleExcise(t)]);case 2:if(n=a.sent(),n.done)this.upstreamExhausted=!0;else return this.refill(),[2,n];return[3,1];case 3:return[2,{value:null,done:!0}]}})})},e}(UW),yl=function(){function r(){this.size=null}return r.prototype.batch=function(e,t){var n=this;t===void 0&&(t=!0);var a=this;kr.util.assert(e>0,function(){return`batchSize needs to be positive, but it is
      `.concat(e)});var i;return this.size===1/0||this.size==null?i=this.size:t?i=Math.ceil(this.size/e):i=Math.floor(this.size/e),wa(function(){return Le(n,void 0,void 0,function(){return qe(this,function(o){switch(o.label){case 0:return[4,a.iterator()];case 1:return[2,o.sent().columnMajorBatch(e,t,oVe)]}})})},i)},r.prototype.concatenate=function(e){var t=this,n=this,a;return this.size===1/0||e.size===1/0?a=1/0:this.size!=null&&e.size!=null?a=this.size+e.size:a=null,wa(function(){return Le(t,void 0,void 0,function(){var i,o;return qe(this,function(s){switch(s.label){case 0:return[4,n.iterator()];case 1:return o=(i=s.sent()).concatenate,[4,e.iterator()];case 2:return[2,o.apply(i,[s.sent()])]}})})},a)},r.prototype.filter=function(e){var t=this,n=this,a;return this.size===1/0?a=1/0:a=null,wa(function(){return Le(t,void 0,void 0,function(){return qe(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().filter(function(o){return kr.tidy(function(){return e(o)})})]}})})},a)},r.prototype.forEachAsync=function(e){return Le(this,void 0,void 0,function(){return qe(this,function(t){switch(t.label){case 0:return[4,this.iterator()];case 1:return[2,t.sent().forEachAsync(e)]}})})},r.prototype.map=function(e){var t=this,n=this;return wa(function(){return Le(t,void 0,void 0,function(){return qe(this,function(a){switch(a.label){case 0:return[4,n.iterator()];case 1:return[2,a.sent().map(function(i){return kr.tidy(function(){return e(i)})})]}})})},this.size)},r.prototype.mapAsync=function(e){var t=this,n=this;return wa(function(){return Le(t,void 0,void 0,function(){return qe(this,function(a){switch(a.label){case 0:return[4,n.iterator()];case 1:return[2,a.sent().mapAsync(e)]}})})},this.size)},r.prototype.prefetch=function(e){var t=this;if(e==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var n=this;return wa(function(){return Le(t,void 0,void 0,function(){return qe(this,function(a){switch(a.label){case 0:return[4,n.iterator()];case 1:return[2,a.sent().prefetch(e)]}})})},this.size)},r.prototype.repeat=function(e){var t=this,n=this,a;return this.size!=null&&e>0?a=this.size*e:e===0?a=0:this.size!=null&&(e===void 0||e<0)?a=1/0:a=null,wa(function(){return Le(t,void 0,void 0,function(){var i,o=this;return qe(this,function(s){return i=p2(function(){return Le(o,void 0,void 0,function(){var u;return qe(this,function(c){switch(c.label){case 0:return u={},[4,n.iterator()];case 1:return[2,(u.value=c.sent(),u.done=!1,u)]}})})}),[2,VUe(i.take(e))]})})},a)},r.prototype.skip=function(e){var t=this,n=this,a;return this.size!=null&&e>=0&&this.size>=e?a=this.size-e:this.size!=null&&(this.size<e||e===void 0||e<0)?a=0:a=null,wa(function(){return Le(t,void 0,void 0,function(){return qe(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().skip(e)]}})})},a)},r.prototype.shuffle=function(e,t,n){var a=this;if(n===void 0&&(n=!0),e==null||e<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting "+"bufferSize to the dataset size (".concat(this.size," elements)"));var i=this,o=PW.alea(t||kr.util.now().toString());return wa(function(){return Le(a,void 0,void 0,function(){var s;return qe(this,function(u){switch(u.label){case 0:return s=o.int32(),n&&(s+=o.int32()),[4,i.iterator()];case 1:return[2,u.sent().shuffle(e,s.toString())]}})})},this.size)},r.prototype.take=function(e){var t=this,n=this,a;return this.size!=null&&this.size>e?a=e:this.size!=null&&this.size<=e?a=this.size:a=null,wa(function(){return Le(t,void 0,void 0,function(){return qe(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().take(e)]}})})},a)},r.prototype.toArray=function(){return Le(this,void 0,void 0,function(){return qe(this,function(e){switch(e.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,e.sent().toArray()]}})})},r.prototype.toArrayForTest=function(){return Le(this,void 0,void 0,function(){return qe(this,function(e){switch(e.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,e.sent().toArrayForTest()]}})})},r}();yl.MAX_BUFFER_SIZE=1e4;function wa(r,e){return e===void 0&&(e=null),new(function(t){qt(n,t);function n(){var a=t.apply(this,wUe([],bUe(arguments),!1))||this;return a.size=e,a}return n.prototype.iterator=function(){return Le(this,void 0,void 0,function(){return qe(this,function(a){return[2,r()]})})},n}(yl))}function aVe(r){var e=this;return wa(function(){return Le(e,void 0,void 0,function(){return qe(this,function(t){return[2,$W(r)]})})},r.length)}function iVe(r){var e=this;if(!gl(r))throw new Error("The argument to zip() must be an object or array.");var t;if(Array.isArray(r))for(var n=0;n<r.length;n++)t=t==null?r[n].size:Math.min(t,r[n].size);else if(r instanceof Object)for(var a in r)t=t==null?r[a].size:Math.min(t,r[a].size);return wa(function(){return Le(e,void 0,void 0,function(){var i;return qe(this,function(o){switch(o.label){case 0:return[4,LW(r,function(s){if(s instanceof yl)return{value:s.iterator(),recurse:!1};if(gl(s))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")})];case 1:return i=o.sent(),[2,GUe(i,Ds.SHORTEST)]}})})},t)}function oVe(r){if(r===null)return null;var e=r[0];if(zUe(e)){var t=sVe(r);return{value:t,recurse:!1}}return{value:null,recurse:!0}}function sVe(r){if(r.length===0)throw new Error("Can't make a batch of zero elements.");return r[0]instanceof kr.Tensor?kr.stack(r):kr.tensor(r)}var VW=function(r){qt(e,r);function e(t){var n=r.call(this)||this;return n.input=t,n}return e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){var t,n,a;return qe(this,function(i){switch(i.label){case 0:return[4,this.input.iterator()];case 1:return t=i.sent(),n=t.decodeUTF8(),a=n.split(`
`).map(function(o){return o.endsWith("\r")&&(o=o.slice(0,-1)),o}),[2,a]}})})},e}(yl),cg='"',ep=Symbol("out"),EW=Symbol("field"),lg=Symbol("quote"),f2=Symbol("quoteafterquote"),IW=Symbol("quoteinquote"),GW=function(r){qt(e,r);function e(t,n){var a=r.call(this)||this;return a.input=t,a.hasHeader=!0,a.fullColumnNames=null,a.columnNamesValidated=!1,a.columnConfigs=null,a.configuredColumnsOnly=!1,a.delimiter=",",a.delimWhitespace=!1,a.base=new VW(t),n||(n={}),a.hasHeader=n.hasHeader!==!1,a.fullColumnNames=n.columnNames,a.columnConfigs=n.columnConfigs,a.configuredColumnsOnly=n.configuredColumnsOnly,n.delimWhitespace?(Dr.util.assert(n.delimiter==null,function(){return"Delimiter should not be provided when delimWhitespace is true."}),a.delimWhitespace=!0,a.delimiter=" "):a.delimiter=n.delimiter?n.delimiter:",",a}return e.prototype.columnNames=function(){return Le(this,void 0,void 0,function(){return qe(this,function(t){switch(t.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:t.sent(),t.label=2;case 2:return[2,this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames]}})})},e.prototype.setColumnNames=function(){return Le(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f=this;return qe(this,function(h){switch(h.label){case 0:return[4,this.maybeReadHeaderLine()];case 1:if(t=h.sent(),!this.fullColumnNames&&!t)throw new Error("Column names must be provided if there is no header line.");if(this.fullColumnNames&&t&&Dr.util.assert(t.length===this.fullColumnNames.length,function(){return"The length of provided columnNames ("+f.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+")."}),this.fullColumnNames||(this.fullColumnNames=t),n=this.fullColumnNames.reduce(function(p,d){return p[d]=p[d]+1||1,p},{}),a=Object.keys(n).filter(function(p){return n[p]>1}),Dr.util.assert(a.length===0,function(){return"Duplicate column names found: "+a.toString()}),this.columnConfigs)try{for(i=Vu(Object.keys(this.columnConfigs)),o=i.next();!o.done;o=i.next())if(s=o.value,u=this.fullColumnNames.indexOf(s),u===-1)throw new Error('The key "'+s+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}catch(p){c={error:p}}finally{try{o&&!o.done&&(l=i.return)&&l.call(i)}finally{if(c)throw c.error}}return this.columnNamesValidated=!0,[2]}})})},e.prototype.maybeReadHeaderLine=function(){return Le(this,void 0,void 0,function(){var t,n,a,i;return qe(this,function(o){switch(o.label){case 0:return this.hasHeader?[4,this.base.iterator()]:[3,3];case 1:return t=o.sent(),[4,t.next()];case 2:if(n=o.sent(),n.done)throw new Error("No data was found for CSV parsing.");return a=n.value,i=this.parseRow(a,!1),[2,i];case 3:return[2,null]}})})},e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){var t,n=this;return qe(this,function(a){switch(a.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:a.sent(),a.label=2;case 2:return[4,this.base.iterator()];case 3:return t=a.sent(),this.hasHeader&&(t=t.skip(1)),[2,t.map(function(i){return n.makeDataElement(i)})]}})})},e.prototype.makeDataElement=function(t){for(var n=this.parseRow(t),a={},i={},o=0;o<this.fullColumnNames.length;o++){var s=this.fullColumnNames[o],u=this.columnConfigs?this.columnConfigs[s]:null;if(!(this.configuredColumnsOnly&&!u)){var c=n[o],l=null;if(c==="")if(u&&u.default!==void 0)l=u.default;else{if(u&&(u.required||u.isLabel))throw new Error("Required column ".concat(s," is empty in this line: ").concat(t));l=void 0}else{var f=Number(c);if(isNaN(f))u&&u.dtype==="bool"?l=this.getBoolean(c):l=c;else if(!u||!u.dtype)l=f;else switch(u.dtype){case"float32":l=f;break;case"int32":l=Math.floor(f);break;case"bool":l=this.getBoolean(c);break;default:l=f}}u&&u.isLabel?i[s]=l:a[s]=l}}return Object.keys(i).length===0?a:{xs:a,ys:i}},e.prototype.getBoolean=function(t){return t==="1"||t.toLowerCase()==="true"?1:0},e.prototype.parseRow=function(t,n){n===void 0&&(n=!0);for(var a=[],i=0,o=t.length,s=ep,u=0;u<o;u++)switch(s){case ep:switch(t.charAt(u)){case cg:i=u+1,s=lg;break;case this.delimiter:if(i=u+1,this.delimiter===" "&&this.delimWhitespace)break;a.push(""),s=ep;break;default:s=EW,i=u;break}break;case EW:switch(t.charAt(u)){case this.delimiter:a.push(t.substring(i,u)),s=ep,i=u+1;break}break;case lg:switch(t.charAt(u)){case cg:s=f2;break}break;case f2:switch(t.charAt(u)){case this.delimiter:a.push(t.substring(i,u-1)),s=ep,i=u+1;break;case cg:s=lg;break;default:s=IW;break}break;case IW:switch(t.charAt(u)){case cg:s=lg;break}break}if(s===f2?a.push(t.substring(i,o-1)):a.push(t.substring(i)),n&&a.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have ".concat(this.fullColumnNames.length," elements in a row, but got ").concat(a));return a},e}(yl),uVe=function(r){qt(e,r);function e(t){var n=r.call(this)||this;n.microphoneConfig=t,n.isClosed=!1,n.fftSize=t.fftSize||1024;var a=Math.log2(n.fftSize);if(n.fftSize<0||a<4||a>14||!Number.isInteger(a))throw new Error("Invalid fftSize: it must be a power of 2 between "+"2 to 4 and 2 to 14, but got ".concat(n.fftSize));if(n.numFrames=t.numFramesPerSpectrogram||43,n.sampleRateHz=t.sampleRateHz,n.columnTruncateLength=t.columnTruncateLength||n.fftSize,n.audioTrackConstraints=t.audioTrackConstraints,n.smoothingTimeConstant=t.smoothingTimeConstant||0,n.includeSpectrogram=t.includeSpectrogram!==!1,n.includeWaveform=t.includeWaveform===!0,!n.includeSpectrogram&&!n.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return n}return e.prototype.summary=function(){return"microphone"},e.create=function(t){return t===void 0&&(t={}),Le(this,void 0,void 0,function(){var n;return qe(this,function(a){switch(a.label){case 0:if(!Dr.env().get("IS_BROWSER"))throw new Error("microphone API is only supported in browser environment.");return n=new e(t),[4,n.start()];case 1:return a.sent(),[2,n]}})})},e.prototype.start=function(){return Le(this,void 0,void 0,function(){var t,n,a,i;return qe(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),t=this,[4,navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null?!0:this.audioTrackConstraints,video:!1})];case 1:return t.stream=o.sent(),[3,3];case 2:throw n=o.sent(),new Error("Error thrown while initializing video stream: ".concat(n.message));case 3:if(!this.stream)throw new Error("Could not obtain audio from microphone.");if(a=window.AudioContext||window.webkitAudioContext,this.audioContext=new a,!this.sampleRateHz)this.sampleRateHz=this.audioContext.sampleRate;else if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error("Mismatch in sampling rate: "+"Expected: ".concat(this.sampleRateHz,"; ")+"Actual: ".concat(this.audioContext.sampleRate));return i=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.fftSize*2,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,i.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize),[2]}})})},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,n,a,i,o;return qe(this,function(s){switch(s.label){case 0:return this.isClosed?[2,{value:null,done:!0}]:[4,this.getAudioData()];case 1:return a=s.sent(),this.includeSpectrogram&&(i=this.flattenQueue(a.freqDataQueue),t=this.getTensorFromAudioDataArray(i,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(o=this.flattenQueue(a.timeDataQueue),n=this.getTensorFromAudioDataArray(o,[this.numFrames*this.fftSize,1])),[2,{value:{spectrogram:t,waveform:n},done:!1}]}})})},e.prototype.capture=function(){return Le(this,void 0,void 0,function(){return qe(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:return[2,t.sent().value]}})})},e.prototype.getAudioData=function(){return Le(this,void 0,void 0,function(){var t,n,a,i=this;return qe(this,function(o){return t=[],n=[],a=0,[2,new Promise(function(s){var u=setInterval(function(){i.includeSpectrogram&&(i.analyser.getFloatFrequencyData(i.freqData),i.freqData[0]===-1/0&&s({freqDataQueue:t,timeDataQueue:n}),t.push(i.freqData.slice(0,i.columnTruncateLength))),i.includeWaveform&&(i.analyser.getFloatTimeDomainData(i.timeData),n.push(i.timeData.slice())),++a===i.numFrames&&(clearInterval(u),s({freqDataQueue:t,timeDataQueue:n}))},i.fftSize/i.sampleRateHz*1e3)})]})})},e.prototype.stop=function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())},e.prototype.toArray=function(){throw new Error("Can not convert infinite audio stream to array.")},e.prototype.getSampleRate=function(){return this.sampleRateHz},e.prototype.flattenQueue=function(t){var n=t[0].length,a=new Float32Array(t.length*n);return t.forEach(function(i,o){return a.set(i,o*n)}),a},e.prototype.getTensorFromAudioDataArray=function(t,n){var a=new Float32Array(Dr.util.sizeFromShape(n));return a.set(t,a.length-t.length),Dr.tensor(a,n)},e}(fn),cVe=function(r){qt(e,r);function e(t,n){var a=r.call(this)||this;if(a.webcamVideoElement=t,a.webcamConfig=n,a.isClosed=!0,a.resize=!1,a.needToResize())if(a.resize=!0,a.cropSize=[a.webcamConfig.resizeHeight,a.webcamConfig.resizeWidth],a.cropBoxInd=Dr.tensor1d([0],"int32"),a.webcamConfig.centerCrop){var i=a.webcamConfig.resizeWidth*1/a.webcamVideoElement.width,o=a.webcamConfig.resizeHeight*1/a.webcamVideoElement.height,s=(1-i)/2,u=(1-o)/2,c=s+i,l=o+u;a.cropBox=Dr.tensor2d([u,s,l,c],[1,4])}else a.cropBox=Dr.tensor2d([0,0,1,1],[1,4]);return a}return e.prototype.summary=function(){return"webcam"},e.create=function(t,n){return n===void 0&&(n={}),Le(this,void 0,void 0,function(){var a;return qe(this,function(i){switch(i.label){case 0:if(!Dr.env().get("IS_BROWSER"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!t){if(t=document.createElement("video"),!n.resizeWidth||!n.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");t.width=n.resizeWidth,t.height=n.resizeHeight}return a=new e(t,n),[4,a.start()];case 1:return i.sent(),[2,a]}})})},e.prototype.start=function(){return Le(this,void 0,void 0,function(){var t,n,a=this;return qe(this,function(i){switch(i.label){case 0:this.webcamConfig.facingMode&&Dr.util.assert(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",function(){return"Invalid webcam facing mode: ".concat(a.webcamConfig.facingMode,". ")+"Please provide 'user' or 'environment'"}),i.label=1;case 1:return i.trys.push([1,3,,4]),t=this,[4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})];case 2:return t.stream=i.sent(),[3,4];case 3:throw n=i.sent(),n.message="Error thrown while initializing video stream: ".concat(n.message),n;case 4:if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(o){console.log(o),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,[2,new Promise(function(o){a.webcamVideoElement.onloadedmetadata=function(){o()}})]}})})},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t;return qe(this,function(n){if(this.isClosed)return[2,{value:null,done:!0}];try{t=Dr.browser.fromPixels(this.webcamVideoElement)}catch(a){throw new Error("Error thrown converting video to pixels: ".concat(JSON.stringify(a)))}if(this.resize)try{return[2,{value:this.cropAndResizeFrame(t),done:!1}]}catch(a){throw new Error("Error thrown cropping the video: ".concat(a.message))}finally{t.dispose()}else return[2,{value:t,done:!1}];return[2]})})},e.prototype.needToResize=function(){return!!(this.webcamConfig.resizeWidth&&this.webcamConfig.resizeHeight&&(this.webcamVideoElement.width!==this.webcamConfig.resizeWidth||this.webcamVideoElement.height!==this.webcamConfig.resizeHeight))},e.prototype.cropAndResizeFrame=function(t){var n=this;return Dr.tidy(function(){var a=Dr.expandDims(Dr.cast(t,"float32"),0),i;i=Dr.image.cropAndResize(a,n.cropBox,n.cropBoxInd,n.cropSize,"bilinear");var o=i.shape;return Dr.reshape(i,o.slice(1))})},e.prototype.capture=function(){return Le(this,void 0,void 0,function(){return qe(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:return[2,t.sent().value]}})})},e.prototype.stop=function(){var t=this.stream.getTracks();t.forEach(function(n){return n.stop()});try{this.webcamVideoElement.srcObject=null}catch(n){console.log(n),this.webcamVideoElement.src=null}this.isClosed=!0},e.prototype.toArray=function(){throw new Error("Can not convert infinite video stream to array.")},e}(fn);var HW=function(){function r(){}return r}(),jW=function(r){qt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.split=function(t){return new lVe(this,t)},e}(fn),lVe=function(r){qt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.impl=new fVe(t,n),a}return e.prototype.summary=function(){return this.impl.summary()},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return qe(this,function(t){return[2,this.impl.next()]})})},e}(jW),fVe=function(r){qt(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.separator=n,a.carryover="",a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Split('").concat(this.separator,"')")},e.prototype.pump=function(){return Le(this,void 0,void 0,function(){var t,n,a,i,o,s,u;return qe(this,function(c){switch(c.label){case 0:return[4,this.upstream.next()];case 1:if(t=c.sent(),t.done)return this.carryover===""?[2,!1]:(this.outputQueue.push(this.carryover),this.carryover="",[2,!0]);n=t.value.split(this.separator),n[0]=this.carryover+n[0];try{for(a=Vu(n.slice(0,-1)),i=a.next();!i.done;i=a.next())o=i.value,this.outputQueue.push(o)}catch(l){s={error:l}}finally{try{i&&!i.done&&(u=a.return)&&u.call(a)}finally{if(s)throw s.error}}return this.carryover=n[n.length-1],[2,!0]}})})},e}(d2),hVe=function(r){qt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.decodeUTF8=function(){return new pVe(this)},e}(fn),pVe=function(r){qt(e,r);function e(t){var n=r.call(this)||this;return n.upstream=t,n.impl=new dVe(t),n}return e.prototype.summary=function(){return this.impl.summary()},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return qe(this,function(t){return[2,this.impl.next()]})})},e}(jW),dVe=function(r){qt(e,r);function e(t){var n=r.call(this)||this;if(n.upstream=t,Dr.env().get("IS_BROWSER"))n.decoder=new TextDecoder("utf-8");else{var a=l2().StringDecoder;n.decoder=new a("utf8")}return n}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Utf8")},e.prototype.pump=function(){return Le(this,void 0,void 0,function(){var t,n,a;return qe(this,function(i){switch(i.label){case 0:return[4,this.upstream.next()];case 1:return t=i.sent(),t.done?[2,!1]:(n=t.value,Dr.env().get("IS_BROWSER")?a=this.decoder.decode(n,{stream:!0}):a=this.decoder.write(Buffer.from(n.buffer)),this.outputQueue.push(a),[2,!0])}})})},e}(d2),KW=function(r){qt(e,r);function e(t,n){n===void 0&&(n={});var a=r.call(this)||this;return a.file=t,a.options=n,Dr.util.assert(t instanceof Uint8Array||(Dr.env().get("IS_BROWSER")?t instanceof File||t instanceof Blob:!1),function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."}),a.offset=n.offset||0,a.chunkSize=n.chunkSize||1024*1024,a}return e.prototype.summary=function(){return"FileChunks ".concat(this.file)},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,n,a=this;return qe(this,function(i){switch(i.label){case 0:return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?[2,{value:null,done:!0}]:(t=new Promise(function(o,s){var u=a.offset+a.chunkSize;if(a.file instanceof Uint8Array)o(new Uint8Array(a.file.slice(a.offset,u)));else{var c=new FileReader;c.onload=function(f){var h=c.result;if(h instanceof ArrayBuffer&&(h=new Uint8Array(h)),!(h instanceof Uint8Array))return s(new TypeError("FileReader returned unknown type."));o(h)},c.onabort=function(f){return s(new Error("Aborted"))},c.onerror=function(f){return s(new Error(f.type))};var l=a.file.slice(a.offset,u);c.readAsArrayBuffer(l)}a.offset=u}),n={},[4,t]);case 1:return[2,(n.value=i.sent(),n.done=!1,n)]}})})},e}(hVe);function vVe(r,e,t){return e===void 0&&(e={}),Le(this,void 0,void 0,function(){var n,a,i,o,s;return qe(this,function(u){switch(u.label){case 0:return typeof r=="string"?n=r:(n=r.url,a=mVe(r)),[4,(t||Dr.util.fetch)(n,a)];case 1:return i=u.sent(),i.ok?(s=Uint8Array.bind,[4,i.arrayBuffer()]):[3,3];case 2:return o=new(s.apply(Uint8Array,[void 0,u.sent()])),[2,new KW(o,e)];case 3:throw new Error(i.statusText)}})})}var mVe=function(r){var e={method:r.method,headers:r.headers,body:r.body,mode:r.mode,credentials:r.credentials,cache:r.cache,redirect:r.redirect,referrer:r.referrer,integrity:r.integrity};return e};function XW(r){return typeof r=="string"&&r.slice(0,7)==="file://"}var YW=function(r){qt(e,r);function e(t,n){n===void 0&&(n={});var a=r.call(this)||this;return a.input=t,a.options=n,a}return e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){var t;return qe(this,function(n){return XW(this.input)&&Dr.env().get("IS_NODE")&&(t=NW(),this.input=t.readFileSync(this.input.slice(7))),[2,new KW(this.input,this.options)]})})},e}(HW),JW=function(r){qt(e,r);function e(t,n){n===void 0&&(n={});var a=r.call(this)||this;return a.url=t,a.fileOptions=n,a}return e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){return qe(this,function(t){return XW(this.url)?[2,new YW(this.url,this.fileOptions).iterator()]:[2,vVe(this.url,this.fileOptions)]})})},e}(HW);function gVe(r,e){return e===void 0&&(e={}),new GW(new JW(r),e)}function yVe(r){var e=this,t=p2(r);return wa(function(){return Le(e,void 0,void 0,function(){return qe(this,function(n){return[2,t]})})})}function bVe(r){var e=this;return wa(function(){return Le(e,void 0,void 0,function(){var t;return qe(this,function(n){switch(n.label){case 0:return[4,r()];case 1:return t=n.sent(),[2,p2(function(){return t.next()})]}})})})}function wVe(r,e){return Le(this,void 0,void 0,function(){return qe(this,function(t){return[2,cVe.create(r,e)]})})}function xVe(r){return Le(this,void 0,void 0,function(){return qe(this,function(e){return[2,uVe.create(r)]})})}var kVe="4.19.0";xa.CSVDataset=GW;xa.Dataset=yl;xa.FileDataSource=YW;xa.TextLineDataset=VW;xa.URLDataSource=JW;xa.array=aVe;xa.csv=gVe;xa.func=yVe;xa.generator=bVe;xa.microphone=xVe;xa.version_data=kVe;xa.webcam=wVe;xa.zip=iVe});var eU=O((QW,v2)=>{(function(r,e,t){function n(s){var u=this,c=o();u.next=function(){var l=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=l-(u.c=l|0)},u.c=1,u.s0=c(" "),u.s1=c(" "),u.s2=c(" "),u.s0-=c(s),u.s0<0&&(u.s0+=1),u.s1-=c(s),u.s1<0&&(u.s1+=1),u.s2-=c(s),u.s2<0&&(u.s2+=1),c=null}function a(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function i(s,u){var c=new n(s),l=u&&u.state,f=c.next;return f.int32=function(){return c.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,l&&(typeof l=="object"&&a(l,c),f.state=function(){return a(c,{})}),f}function o(){var s=4022871197,u=function(c){c=String(c);for(var l=0;l<c.length;l++){s+=c.charCodeAt(l);var f=.02519603282416938*s;s=f>>>0,f-=s,f*=s,s=f>>>0,f-=s,s+=f*4294967296}return(s>>>0)*23283064365386963e-26};return u}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.alea=i})(QW,typeof v2=="object"&&v2,typeof define=="function"&&define)});var rU=O((tU,m2)=>{(function(r,e,t){function n(o){var s=this,u="";s.x=0,s.y=0,s.z=0,s.w=0,s.next=function(){var l=s.x^s.x<<11;return s.x=s.y,s.y=s.z,s.z=s.w,s.w^=s.w>>>19^l^l>>>8},o===(o|0)?s.x=o:u+=o;for(var c=0;c<u.length+64;c++)s.x^=u.charCodeAt(c)|0,s.next()}function a(o,s){return s.x=o.x,s.y=o.y,s.z=o.z,s.w=o.w,s}function i(o,s){var u=new n(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},l.int32=u.next,l.quick=l,c&&(typeof c=="object"&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xor128=i})(tU,typeof m2=="object"&&m2,typeof define=="function"&&define)});var aU=O((nU,g2)=>{(function(r,e,t){function n(o){var s=this,u="";s.next=function(){var l=s.x^s.x>>>2;return s.x=s.y,s.y=s.z,s.z=s.w,s.w=s.v,(s.d=s.d+362437|0)+(s.v=s.v^s.v<<4^(l^l<<1))|0},s.x=0,s.y=0,s.z=0,s.w=0,s.v=0,o===(o|0)?s.x=o:u+=o;for(var c=0;c<u.length+64;c++)s.x^=u.charCodeAt(c)|0,c==u.length&&(s.d=s.x<<10^s.x>>>4),s.next()}function a(o,s){return s.x=o.x,s.y=o.y,s.z=o.z,s.w=o.w,s.v=o.v,s.d=o.d,s}function i(o,s){var u=new n(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},l.int32=u.next,l.quick=l,c&&(typeof c=="object"&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xorwow=i})(nU,typeof g2=="object"&&g2,typeof define=="function"&&define)});var oU=O((iU,y2)=>{(function(r,e,t){function n(o){var s=this;s.next=function(){var c=s.x,l=s.i,f,h,p;return f=c[l],f^=f>>>7,h=f^f<<24,f=c[l+1&7],h^=f^f>>>10,f=c[l+3&7],h^=f^f>>>3,f=c[l+4&7],h^=f^f<<7,f=c[l+7&7],f=f^f<<13,h^=f^f<<9,c[l]=h,s.i=l+1&7,h};function u(c,l){var f,h,p=[];if(l===(l|0))h=p[0]=l;else for(l=""+l,f=0;f<l.length;++f)p[f&7]=p[f&7]<<15^l.charCodeAt(f)+p[f+1&7]<<13;for(;p.length<8;)p.push(0);for(f=0;f<8&&p[f]===0;++f);for(f==8?h=p[7]=-1:h=p[f],c.x=p,c.i=0,f=256;f>0;--f)c.next()}u(s,o)}function a(o,s){return s.x=o.x.slice(),s.i=o.i,s}function i(o,s){o==null&&(o=+new Date);var u=new n(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},l.int32=u.next,l.quick=l,c&&(c.x&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xorshift7=i})(iU,typeof y2=="object"&&y2,typeof define=="function"&&define)});var uU=O((sU,b2)=>{(function(r,e,t){function n(o){var s=this;s.next=function(){var c=s.w,l=s.X,f=s.i,h,p;return s.w=c=c+1640531527|0,p=l[f+34&127],h=l[f=f+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,p=l[f]=p^h,s.i=f,p+(c^c>>>16)|0};function u(c,l){var f,h,p,d,m,v=[],g=128;for(l===(l|0)?(h=l,l=null):(l=l+"\0",h=0,g=Math.max(g,l.length)),p=0,d=-32;d<g;++d)l&&(h^=l.charCodeAt((d+32)%l.length)),d===0&&(m=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,d>=0&&(m=m+1640531527|0,f=v[d&127]^=h+m,p=f==0?p+1:0);for(p>=128&&(v[(l&&l.length||0)&127]=-1),p=127,d=4*128;d>0;--d)h=v[p+34&127],f=v[p=p+1&127],h^=h<<13,f^=f<<17,h^=h>>>15,f^=f>>>12,v[p]=h^f;c.w=m,c.X=v,c.i=p}u(s,o)}function a(o,s){return s.i=o.i,s.w=o.w,s.X=o.X.slice(),s}function i(o,s){o==null&&(o=+new Date);var u=new n(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},l.int32=u.next,l.quick=l,c&&(c.X&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xor4096=i})(sU,typeof b2=="object"&&b2,typeof define=="function"&&define)});var lU=O((cU,w2)=>{(function(r,e,t){function n(o){var s=this,u="";s.next=function(){var l=s.b,f=s.c,h=s.d,p=s.a;return l=l<<25^l>>>7^f,f=f-h|0,h=h<<24^h>>>8^p,p=p-l|0,s.b=l=l<<20^l>>>12^f,s.c=f=f-h|0,s.d=h<<16^f>>>16^p,s.a=p-l|0},s.a=0,s.b=0,s.c=-1640531527,s.d=1367130551,o===Math.floor(o)?(s.a=o/4294967296|0,s.b=o|0):u+=o;for(var c=0;c<u.length+20;c++)s.b^=u.charCodeAt(c)|0,s.next()}function a(o,s){return s.a=o.a,s.b=o.b,s.c=o.c,s.d=o.d,s}function i(o,s){var u=new n(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},l.int32=u.next,l.quick=l,c&&(typeof c=="object"&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.tychei=i})(cU,typeof w2=="object"&&w2,typeof define=="function"&&define)});var hU=O((fU,hg)=>{(function(r,e,t){var n=256,a=6,i=52,o="random",s=t.pow(n,a),u=t.pow(2,i),c=u*2,l=n-1,f;function h(w,b,x){var S=[];b=b==!0?{entropy:!0}:b||{};var T=v(m(b.entropy?[w,y(e)]:w??g(),3),S),E=new p(S),C=function(){for(var R=E.g(a),_=s,M=0;R<u;)R=(R+M)*n,_*=n,M=E.g(1);for(;R>=c;)R/=2,_/=2,M>>>=1;return(R+M)/_};return C.int32=function(){return E.g(4)|0},C.quick=function(){return E.g(4)/4294967296},C.double=C,v(y(E.S),e),(b.pass||x||function(R,_,M,$){return $&&($.S&&d($,E),R.state=function(){return d(E,{})}),M?(t[o]=R,_):R})(C,T,"global"in b?b.global:this==t,b.state)}function p(w){var b,x=w.length,S=this,T=0,E=S.i=S.j=0,C=S.S=[];for(x||(w=[x++]);T<n;)C[T]=T++;for(T=0;T<n;T++)C[T]=C[E=l&E+w[T%x]+(b=C[T])],C[E]=b;(S.g=function(R){for(var _,M=0,$=S.i,z=S.j,q=S.S;R--;)_=q[$=l&$+1],M=M*n+q[l&(q[$]=q[z=l&z+_])+(q[z]=_)];return S.i=$,S.j=z,M})(n)}function d(w,b){return b.i=w.i,b.j=w.j,b.S=w.S.slice(),b}function m(w,b){var x=[],S=typeof w,T;if(b&&S=="object")for(T in w)try{x.push(m(w[T],b-1))}catch{}return x.length?x:S=="string"?w:w+"\0"}function v(w,b){for(var x=w+"",S,T=0;T<x.length;)b[l&T]=l&(S^=b[l&T]*19)+x.charCodeAt(T++);return y(b)}function g(){try{var w;return f&&(w=f.randomBytes)?w=w(n):(w=new Uint8Array(n),(r.crypto||r.msCrypto).getRandomValues(w)),y(w)}catch{var b=r.navigator,x=b&&b.plugins;return[+new Date,r,x,r.screen,y(e)]}}function y(w){return String.fromCharCode.apply(0,w)}if(v(t.random(),e),typeof hg=="object"&&hg.exports){hg.exports=h;try{f=Yd()}catch{}}else typeof define=="function"&&define.amd?define(function(){return h}):t["seed"+o]=h})(typeof self<"u"?self:fU,[],Math)});var dU=O((OEt,pU)=>{var SVe=eU(),NVe=rU(),TVe=aU(),EVe=oU(),IVe=uU(),CVe=lU(),ju=hU();ju.alea=SVe;ju.xor128=NVe;ju.xorwow=TVe;ju.xorshift7=EVe;ju.xor4096=IVe;ju.tychei=CVe;pU.exports=ju});var PV=O(yg=>{"use strict";var N=mu(),AVe=dU();function DVe(r){var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var _Ve=DVe(AVe),k2=function(r,e){return k2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},k2(r,e)};function FVe(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");k2(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function vU(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(f){o(f)}}function u(l){try{c(n.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((n=n.apply(r,e||[])).next())})}function mU(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function wl(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ge(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function Ma(r,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}function je(r,e){Array.isArray(r)||(r=[r]),r.forEach(function(t){t!=null&&N.util.assert(t.dtype!=="complex64",function(){return"".concat(e," does not support complex64 tensors in the CPU backend.")})})}var RVe=N.kernel_impls.whereImpl,T2=function(r){FVe(e,r);function e(){var t=r.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new N.DataStorage(t,N.engine()),t}return e.prototype.nextDataId=function(){return e.nextDataId++},e.prototype.write=function(t,n,a){this.firstUse&&(this.firstUse=!1,N.env().get("IS_NODE")&&N.backend_util.warn(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));var i={id:this.nextDataId()};return this.data.set(i,{values:t,dtype:a,refCount:1}),i},e.prototype.makeTensorInfo=function(t,n,a){var i;if(n==="string"&&a!=null&&a.length>0&&N.util.isString(a[0])){var o=a.map(function(s){return N.util.encodeString(s)});i=this.write(o,t,n)}else i=this.write(a,t,n);return{dataId:i,shape:t,dtype:n}},e.prototype.refCount=function(t){if(this.data.has(t)){var n=this.data.get(t);return n.refCount}return 0},e.prototype.incRef=function(t){var n=this.data.get(t);n.refCount++},e.prototype.decRef=function(t){if(this.data.has(t)){var n=this.data.get(t);n.refCount--}},e.prototype.move=function(t,n,a,i,o){this.data.set(t,{values:n,dtype:i,refCount:o})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return vU(this,void 0,void 0,function(){return mU(this,function(n){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var n=this.data.get(t),a=n.dtype,i=n.complexTensorInfos;if(a==="complex64"){var o=this.readSync(i.real.dataId),s=this.readSync(i.imag.dataId);return N.backend_util.mergeRealAndImagArrays(o,s)}return N.util.convertBackendValuesAndArrayBuffer(this.data.get(t).values,a)},e.prototype.bufferSync=function(t){var n=this.readSync(t.dataId);if(t.dtype==="string")try{var a=n.map(function(i){return N.util.decodeString(i)});return N.buffer(t.shape,t.dtype,a)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return N.buffer(t.shape,t.dtype,n)},e.prototype.makeOutput=function(t,n,a){return N.engine().makeTensorFromTensorInfo(this.makeTensorInfo(n,a,t),this)},e.prototype.disposeData=function(t,n){if(n===void 0&&(n=!1),this.data.has(t)){if(this.data.get(t).refCount--,!n&&this.data.get(t).refCount>0)return!1;var a=this.data.get(t).complexTensorInfos;a!=null&&(this.disposeData(a.real.dataId,!0),this.disposeData(a.imag.dataId,!0)),this.data.delete(t)}return!0},e.prototype.disposeIntermediateTensorInfo=function(t){this.disposeData(t.dataId)},e.prototype.time=function(t){return vU(this,void 0,void 0,function(){var n,a;return mU(this,function(i){return n=N.util.now(),t(),a=N.util.now()-n,[2,{kernelMs:a}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.where=function(t){je([t],"where");var n=this.readSync(t.dataId);return RVe(t.shape,n)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return r.prototype.epsilon.call(this)},e}(N.KernelBackend);T2.nextDataId=0;function TU(r){for(var e=new Float32Array(r.length),t=0;t<r.length;++t)e[t]=Math.abs(r[t]);return e}var OVe=function(r){var e=r.inputs.x,t=r.backend;je(e,"abs");var n=new Float32Array(N.util.sizeFromShape(e.shape)),a=t.data.get(e.dataId).values;return n=TU(a),t.makeOutput(n,e.shape,e.dtype)},PVe={kernelName:N.Abs,backendName:"cpu",kernelFunc:OVe};function $r(r){return function(e,t,n,a,i){var o=N.backend_util.assertAndGetBroadcastShape(e,t),s=o.length,u=N.util.computeStrides(o),c=N.util.sizeFromShape(o),l=N.util.getTypedArrayFromDType(i,c),f=e.length,h=t.length,p=N.util.computeStrides(e),d=N.util.computeStrides(t),m=N.backend_util.getBroadcastDims(e,o),v=N.backend_util.getBroadcastDims(t,o);if(m.length+v.length===0)for(var g=0;g<l.length;++g)l[g]=r(n[g%n.length],a[g%a.length]);else for(var y=function(w){var b=N.util.indexToLoc(w,s,u),x=b.slice(-f);m.forEach(function(C){return x[C]=0});var S=N.util.locToIndex(x,f,p),T=b.slice(-h);v.forEach(function(C){return T[C]=0});var E=N.util.locToIndex(T,h,d);l[w]=r(n[S],a[E])},g=0;g<l.length;++g)y(g);return[l,o]}}function ka(r){var e=r.inputs,t=r.backend,n=e.real,a=e.imag,i=t.data.get(n.dataId).values,o=t.data.get(a.dataId).values,s=t.makeTensorInfo(n.shape,"complex64"),u=t.data.get(s.dataId);return u.complexTensorInfos={real:t.makeTensorInfo(n.shape,"float32",i),imag:t.makeTensorInfo(a.shape,"float32",o)},s}var MVe={kernelName:N.Complex,backendName:"cpu",kernelFunc:ka};function pg(r,e,t){if(t===void 0&&(t="float32"),t==="complex64"){var n=pg(r,e,"float32"),a=pg(r,e,"float32");return ka({inputs:{real:n,imag:a},backend:r})}var i=N.util.makeZerosTypedArray(N.util.sizeFromShape(e),t);return r.makeTensorInfo(e,t,i)}function no(r){var e=r.inputs,t=r.backend,n=e.x;return t.incRef(n.dataId),{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}var BVe={kernelName:N.Identity,backendName:"cpu",kernelFunc:no};function Xu(r){var e=r.inputs,t=r.backend,n=e.input,a=t.data.get(n.dataId).complexTensorInfos.real,i=t.data.get(a.dataId).values;return t.makeTensorInfo(a.shape,a.dtype,i)}var LVe={kernelName:N.Real,backendName:"cpu",kernelFunc:Xu};function EU(r,e,t,n){if(n==="int32"){var a=Int32Array.from(r);return[e,"int32",a]}if(n==="bool"){var i=N.util.toTypedArray([0],t),o=Ge($r(function(c,l){return c!==l?1:0})(e,[],r,i,"bool"),2),s=o[0],u=o[1];return[u,"bool",s]}throw new Error("Error in Cast: failed to cast ".concat(t," to ").concat(n))}function _s(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.dtype;if(i==="complex64"){if(a.dtype==="complex64")return no({inputs:{x:a},backend:t});var o=pg(t,a.shape,a.dtype),s=_s({inputs:{x:a},backend:t,attrs:{dtype:"float32"}}),u=ka({inputs:{real:s,imag:o},backend:t});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}if(a.dtype==="complex64"){var c=Xu({inputs:{input:a},backend:t}),u=_s({inputs:{x:c},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(c),u}if(!N.util.hasEncodingLoss(a.dtype,i)){var u=no({inputs:{x:a},backend:t});return{dataId:u.dataId,shape:u.shape,dtype:i}}var l=t.data.get(a.dataId).values,f=Ge(EU(l,a.shape,a.dtype,i),3),h=f[0],p=f[1],d=f[2];return t.makeTensorInfo(h,p,d)}var qVe={kernelName:N.Cast,backendName:"cpu",kernelFunc:_s};function tn(r,e,t,n){return t==null?function(a){var i=a.inputs,o=a.backend,s=i.a,u=i.b,c=o;je([s,u],r);var l=c.data.get(s.dataId).values,f=c.data.get(u.dataId).values,h=s.dtype==="string"?N.backend_util.fromUint8ToStringArray(l):l,p=s.dtype==="string"?N.backend_util.fromUint8ToStringArray(f):f,d=n||s.dtype,m=Ge(e(s.shape,u.shape,h,p,d),2),v=m[0],g=m[1];return c.makeTensorInfo(g,d,v)}:function(a){var i=a.inputs,o=a.backend,s=i.a,u=i.b,c=o;if(s.dtype==="complex64"||u.dtype==="complex64"){var l=_s({inputs:{x:s},backend:c,attrs:{dtype:"complex64"}}),f=c.data.get(l.dataId),h=f.complexTensorInfos.real,p=f.complexTensorInfos.imag,d=c.data.get(h.dataId).values,m=c.data.get(p.dataId).values,v=_s({inputs:{x:u},backend:c,attrs:{dtype:"complex64"}}),g=c.data.get(v.dataId),y=g.complexTensorInfos.real,w=g.complexTensorInfos.imag,b=c.data.get(y.dataId).values,x=c.data.get(w.dataId).values,S=Ge(t(s.shape,u.shape,d,m,b,x),3),T=S[0],E=S[1],C=S[2],R=c.makeTensorInfo(C,"float32",T),_=c.makeTensorInfo(C,"float32",E),M=ka({inputs:{real:R,imag:_},backend:c});return c.disposeIntermediateTensorInfo(l),c.disposeIntermediateTensorInfo(v),c.disposeIntermediateTensorInfo(R),c.disposeIntermediateTensorInfo(_),M}else{var $=c.data.get(s.dataId).values,z=c.data.get(u.dataId).values,q=n||s.dtype,L=Ge(e(s.shape,u.shape,$,z,q),2),U=L[0],C=L[1];return c.makeTensorInfo(C,q,U)}}}function E2(r){return function(e,t,n,a,i,o){var s=N.backend_util.assertAndGetBroadcastShape(e,t),u=N.util.sizeFromShape(s),c=s.length,l=N.util.computeStrides(s),f=N.util.getTypedArrayFromDType("float32",u),h=N.util.getTypedArrayFromDType("float32",u),p=N.backend_util.getBroadcastDims(e,s),d=N.backend_util.getBroadcastDims(t,s),m=N.backend_util.mergeRealAndImagArrays(n,a),v=N.backend_util.mergeRealAndImagArrays(i,o),g=e.length,y=N.util.computeStrides(e),w=t.length,b=N.util.computeStrides(t);if(p.length+d.length===0)for(var x=0;x<f.length;x++){var S=x%m.length,T=x%v.length,E=r(m[S*2],m[S*2+1],v[T*2],v[T*2+1]);f[x]=E.real,h[x]=E.imag}else for(var C=function(R){var _=N.util.indexToLoc(R,c,l),M=_.slice(-g);p.forEach(function(U){return M[U]=0});var $=N.util.locToIndex(M,g,y),z=_.slice(-w);d.forEach(function(U){return z[U]=0});var q=N.util.locToIndex(z,w,b),L=r(m[$*2],m[$*2+1],v[q*2],v[q*2+1]);f[R]=L.real,h[R]=L.imag},x=0;x<f.length;x++)C(x);return[f,h,s]}}var IU=$r(function(r,e){return r+e}),zVe=E2(function(r,e,t,n){return{real:r+t,imag:e+n}}),xl=tn(N.Add,IU,zVe),$Ve={kernelName:N.Add,backendName:"cpu",kernelFunc:xl};function I2(r,e,t,n,a){for(var i=N.util.sizeFromShape(n),o=N.util.makeZerosTypedArray(a,t),s=0;s<r.length;s++){var u=r[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(i>0?o[u]+=e[s]:o[u]+=1)}return o}function CU(r,e,t,n){n===void 0&&(n=!1);for(var a=r.shape[0],i=r.shape[1],o=N.buffer([a,t],e.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=r.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=t||(n?o.set(1,s,c):e.size>0?o.set(o.get(s,c)+e.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o}var AU=$r(function(r,e){return r&e}),WVe=tn(N.BitwiseAnd,AU),UVe={kernelName:N.BitwiseAnd,backendName:"cpu",kernelFunc:WVe};function ao(r){return function(e,t,n){for(var a=N.util.getArrayFromDType(t,e.length),i=0;i<e.length;++i)a[i]=r(e[i],n);return a}}function Ut(r,e,t){var n=ao(e);return Fs(r,n,t)}function Fs(r,e,t){return function(n){var a=n.inputs,i=n.attrs,o=n.backend,s=a.x;je(s,r);var u=o,c=u.data.get(s.dataId).values,l;if(s.dtype==="string"){if(!Array.isArray(c))throw new Error("String tensor's value was not an instance of Array");l=N.backend_util.fromUint8ToStringArray(c)}else l=c;var f=t||s.dtype,h=e(l,f,i);return u.makeTensorInfo(s.shape,f,h)}}var DU=ao(function(r){return Math.ceil(r)}),VVe=Fs(N.Ceil,DU),GVe={kernelName:N.Ceil,backendName:"cpu",kernelFunc:VVe};function _U(r,e,t,n){var a=N.util.getArrayFromDType(t,N.util.sizeFromShape(e));if(n&&t!=="string"){var i=0;r.forEach(function(s){var u=N.util.sizeFromShape(s.shape);a.set(s.vals,i),i+=u})}else{var o=0;r.forEach(function(s){for(var u=t==="string"?N.backend_util.fromUint8ToStringArray(s.vals):s.vals,c=0,l=0;l<s.shape[0];++l)for(var f=l*e[1]+o,h=0;h<s.shape[1];++h)a[f+h]=u[c++];o+=s.shape[1]})}return a}var FU=$r(function(r,e){return r===e?1:0}),RU=tn(N.Equal,FU,null,"bool"),HVe={kernelName:N.Equal,backendName:"cpu",kernelFunc:RU};var OU=ao(function(r){return Math.exp(r)}),PU=Fs(N.Exp,OU,"float32"),jVe={kernelName:N.Exp,backendName:"cpu",kernelFunc:PU};var MU=ao(function(r){return Math.expm1(r)}),KVe=Fs(N.Expm1,MU),XVe={kernelName:N.Expm1,backendName:"cpu",kernelFunc:KVe};var BU=ao(function(r){return Math.floor(r)}),YVe=Fs(N.Floor,BU),JVe={kernelName:N.Floor,backendName:"cpu",kernelFunc:YVe};var LU=$r(function(r,e){return Math.floor(r/e)}),ZVe=tn(N.FloorDiv,LU,null,"int32"),QVe={kernelName:N.FloorDiv,backendName:"cpu",kernelFunc:ZVe};function qU(r,e,t,n,a,i,o,s,u){for(var c=N.buffer([n,i],t),l=0;l<n;l++){for(var f=[],h=0,p=0;p<a;p++){var d=r[l*a+p];h+=d*o[p],f.push(d)}if(h<0||h>=u/i)throw new Error("Invalid indices: ".concat(f," does not index into ").concat(s));for(var m=0;m<i;m++)c.values[l*i+m]=e.get.apply(e,Ma([],Ge(e.indexToLoc(h*i+m)),!1))}return c}function zU(r,e,t){for(var n=N.buffer(t,r.dtype),a=0;a<n.size;++a){var i=n.indexToLoc(a),o=i.slice(),s=o[0],u=o[2],c=e.locToIndex([s,u]);o[2]=e.values[c];var l=r.locToIndex(o);0<=l&&l<r.values.length&&(n.values[a]=r.values[l])}return n}var $U=$r(function(r,e){return r>e?1:0}),eGe=tn(N.Greater,$U,null,"bool"),tGe={kernelName:N.Greater,backendName:"cpu",kernelFunc:eGe};var WU=$r(function(r,e){return r>=e?1:0}),rGe=tn(N.GreaterEqual,WU,null,"bool"),nGe={kernelName:N.GreaterEqual,backendName:"cpu",kernelFunc:rGe};var UU=$r(function(r,e){return r<e?1:0}),aGe=tn(N.Less,UU,null,"bool"),iGe={kernelName:N.Less,backendName:"cpu",kernelFunc:aGe};var VU=$r(function(r,e){return r<=e?1:0}),oGe=tn(N.LessEqual,VU,null,"bool"),sGe={kernelName:N.LessEqual,backendName:"cpu",kernelFunc:oGe};function GU(r,e,t){var n=(e-r)/(t-1),a=N.util.makeZerosTypedArray(t,"float32");a[0]=r;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return a}var HU=ao(function(r){return Math.log(r)}),uGe=Fs(N.Log,HU),cGe={kernelName:N.Log,backendName:"cpu",kernelFunc:uGe};function jU(r,e,t,n){for(var a=N.util.getTypedArrayFromDType(n,N.util.sizeFromShape(t)),i=0;i<a.length;++i){for(var o=i*e,s=r[o],u=0;u<e;++u){var c=r[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a}var KU=$r(function(r,e){return Math.max(r,e)}),lGe=tn(N.Maximum,KU),fGe={kernelName:N.Maximum,backendName:"cpu",kernelFunc:lGe};var XU=$r(function(r,e){return Math.min(r,e)}),hGe=tn(N.Minimum,XU),pGe={kernelName:N.Minimum,backendName:"cpu",kernelFunc:hGe};var C2=$r(function(r,e){return r*e}),dGe=E2(function(r,e,t,n){return{real:r*t-e*n,imag:r*n+e*t}}),gg=tn(N.Multiply,C2,dGe),vGe={kernelName:N.Multiply,backendName:"cpu",kernelFunc:gg};function YU(r,e,t){var n=N.util.createScalarValue(-1,t);return C2([],e,n,r,t)}function mGe(r){var e=r.inputs,t=r.backend,n=e.x;je(n,"neg");var a=t.data.get(n.dataId).values,i=Ge(YU(a,n.shape,n.dtype),2),o=i[0],s=i[1];return t.makeTensorInfo(s,n.dtype,o)}var gGe={kernelName:N.Neg,backendName:"cpu",kernelFunc:mGe};var JU=$r(function(r,e){return r!==e?1:0}),yGe=tn(N.NotEqual,JU,null,"bool"),bGe={kernelName:N.NotEqual,backendName:"cpu",kernelFunc:yGe};function A2(r,e,t,n,a){for(var i=e.length,o=N.util.sizeFromShape(e),s=N.util.computeStrides(e),u=N.util.computeStrides(a),c=N.util.getTypedArrayFromDType(t,N.util.sizeFromShape(a)),l=0;l<o;++l){for(var f=N.util.indexToLoc(l,i,s),h=new Array(f.length),p=0;p<h.length;p++)h[p]=f[n[p]];var d=N.util.locToIndex(h,i,u);c[d]=r[l]}return c}function Kn(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.x,i=t.perm;je(a,"transpose");for(var o=a.shape.length,s=new Array(o),u=0;u<s.length;u++)s[u]=a.shape[i[u]];var c=n.data.get(a.dataId).values,l=A2(c,a.shape,a.dtype,i,s),f=n.write(l,s,a.dtype);return{dataId:f,shape:s,dtype:a.dtype}}var wGe={kernelName:N.Transpose,backendName:"cpu",kernelFunc:Kn};function ZU(r,e,t,n){for(var a=Ge(N.backend_util.computeOutAndReduceShapes(r,n),2),i=a[0],o=a[1],s=N.upcastType(e,"int32"),u=N.util.makeZerosTypedArray(N.util.sizeFromShape(i),s),c=N.util.sizeFromShape(o),l=0;l<u.length;++l){for(var f=l*c,h=1,p=0;p<c;++p)h*=t[f+p];u[l]=h}return{outVals:u,outShape:i,outDtype:s}}function xGe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;je(a,"prod");var s=a.shape.length,u=N.util.parseAxisParam(i,a.shape),c=N.backend_util.getAxesPermutation(u,s),l=u,f=a,h=[];c!=null&&(f=Kn({inputs:{x:a},backend:t,attrs:{perm:c}}),h.push(f),l=N.backend_util.getInnerMostAxes(l.length,s));var p=t.data.get(f.dataId).values,d=ZU(f.shape,f.dtype,p,l),m=d.outVals,v=d.outShape,g=d.outDtype,y=v;return o&&(y=N.backend_util.expandShapeToKeepDim(v,u)),h.forEach(function(w){return t.disposeIntermediateTensorInfo(w)}),t.makeTensorInfo(y,g,m)}var kGe={kernelName:N.Prod,backendName:"cpu",kernelFunc:xGe};function SGe(r,e,t){r.forEach(function(n,a){if(n<0||n>=t){var i=N.util.indexToLoc(a,e.length,N.util.computeStrides(e)).join(",");throw new Error("indices[".concat(i,"] = ").concat(n," is not in [0, ").concat(t,")"))}})}function NGe(r,e){for(var t=0;t<r.length;++t){var n=r[t],a=t===r.length-1?e:r[t+1].length;if(n.length===0)throw new Error("Ragged splits may not be empty");if(n[0]<0)throw new Error("Ragged splits must be non-negative");if(n[n.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<n.length;++i)if(n[i-1]>n[i])throw new Error("Ragged splits must be sorted in ascending order")}}function TGe(r,e,t,n){var a=[],i=0,o=e.length-1+t.length,s=new Array(o).fill(null).map(function(){return[0]});NGe(t,n);for(var u=1,c=0;c<e.length-1;++c){u*=e[c];for(var l=e[c+1],f=1;f<u+1;++f)s[c].push(f*l)}for(var f=0;f<r.length;++f){for(var h=r[f],p=r[f]+1,c=0;c<t.length;++c){var d=t[c],m=c+e.length-1;if(m>=0)for(var v=s[m],g=v[v.length-1]-d[h],y=h;y<p;++y)s[m].push(d[y+1]+g);h=d[h],p=d[p]}p!==h&&(a.push([h,p]),i+=p-h)}return{outSplits:s,valueSlices:a,numValues:i}}function EGe(r){for(var e=[],t=function(a){var i=r[a].length,o=N.util.getArrayFromDType("int32",i);e.push(o),r[a].forEach(function(s,u){return o[u]=s})},n=0;n<r.length;++n)t(n);return e}function gU(r,e){for(var t=r.slice(0,e);t.length<e;)t.push(1);for(var n=e;n<r.length;n++)t[e-1]*=r[n];return t}function IGe(r,e,t,n,a,i){var o,s,u=gU(e,2)[1],c=gU(i,2)[1],l=0;try{for(var f=wl(t),h=f.next();!h.done;h=f.next())for(var p=h.value,d=p[0];d<p[1];++d){for(var m=0;m<n;++m)a[l*c+m]=r[d*u+m];++l}}catch(v){o={error:v}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}}function CGe(r,e,t,n,a){var i=e.slice();i[0]=a;var o=N.util.getArrayFromDType(t,N.util.sizeFromShape(i)),s=r.length,u=s===0?0:s/e[0];return IGe(r,e,n,u,o,i),[o,i]}function QU(r,e,t,n,a,i,o,s){if(r.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");var u=e[0][0]-1;if(SGe(i,o,u),n.length===0)throw new Error("params.rank must be nonzero");var c=n[0],l=TGe(i,o,r,c),f=l.outSplits,h=l.valueSlices,p=l.numValues,d=EGe(f),m=CGe(t,n,a,h,p);return[d,m[0],m[1]]}var yU=2147483647;function eV(r,e,t,n,a,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");var s=e.length===0,u=a.length===0,c=o.length===0,l=[];s||l.push(e[0]),u||l.push(a[0]),c||l.push(o[0]);for(var f=1;f<l.length;++f)if(l[f]!==l[f-1])throw new Error("starts, limits, and deltas must have the same shape");var h=l.length===0?1:l[0],p=N.util.getArrayFromDType("int32",h+1);p[0]=0;for(var d=0;d<h;++d){var m=s?r[0]:r[d],v=u?n[0]:n[d],g=c?i[0]:i[d];if(g===0)throw new Error("Requires delta != 0");var y=void 0;if(g>0&&v<m||g<0&&v>m)y=0;else if(y=Math.ceil(Math.abs((v-m)/g)),y>yU)throw new Error("Requires ((limit - start) / delta) <= ".concat(yU));p[d+1]=p[d]+y}for(var w=p[h],b=N.util.getArrayFromDType(t,w),x=0,d=0;d<h;++d)for(var S=p[d+1]-p[d],T=s?r[0]:r[d],g=c?i[0]:i[d],f=0;f<S;++f)b[x++]=T,T+=g;return[p,b]}var vi=N.backend_util.RowPartitionType,AGe=function(){function r(e,t,n,a,i,o,s,u,c,l){this.shape=e,this.shapeShape=t,this.values=n,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=N.backend_util.getRowPartitionTypesHelper(l),this.raggedRank=N.backend_util.getRaggedRank(this.rowPartitionTypes)}return r.prototype.getRowPartitionTypeByDimension=function(e){return this.rowPartitionTypes[0]===vi.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]},r.prototype.getRowPartitionTensor=function(e){return this.rowPartitionTypes[0]===vi.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]},r.prototype.getMaxWidth=function(e){var t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case vi.VALUE_ROWIDS:return r.getMaxWidthValueRowID(t);case vi.ROW_SPLITS:return r.getMaxWidthRowSplit(t);default:throw new Error("Cannot handle partition type ".concat(vi[this.getRowPartitionTypeByDimension(e-1)]))}},r.getMaxWidthRowSplit=function(e){var t=e.length;if(t===0||t===1)return 0;for(var n=0,a=0;a<t-1;++a){var i=e[a+1]-e[a];i>n&&(n=i)}return n},r.getMaxWidthValueRowID=function(e){var t=e.length;if(t===0)return 0;for(var n=0,a=e[0],i=0,o=1;o<t;++o){var s=e[o];s!==a&&(a=s,i=Math.max(o-n,i),n=o)}return Math.max(t-n,i)},r.prototype.tensorShapeFromTensor=function(e,t,n){if(n===void 0&&(n=!0),t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return wU(e,n)},r.prototype.calculateOutputSize=function(e){var t=this.valuesShape,n=this.defaultValueShape;N.backend_util.validateDefaultValueShape(n,t);var a=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=N.backend_util.combineRaggedTensorToTensorShapes(this.raggedRank,a,t),o=i;o[0]<0&&(o[0]=e);for(var s=1;s<=this.raggedRank;++s)o[s]<0&&(o[s]=this.getMaxWidth(s));return o},r.prototype.calculateFirstParentOutputIndex=function(e,t,n){for(var a=Math.min(e,n),i=[],o=0,s=0;s<a;++s,o+=t)i.push(o);for(var s=a;s<e;++s)i.push(-1);return N.util.assert(i.length===e,function(){return"Final length of result must be equal to firstDimension."}),i},r.prototype.calculateOutputIndexRowSplit=function(e,t,n,a){for(var i=e.length,o=[],s=0;s<i-1;++s){var u=e[s+1]-e[s],c=Math.min(a,u),l=t[s];l===-1&&(c=0);for(var f=0;f<c;++f)o.push(l),l+=n;for(var f=0;f<u-c;++f)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o},r.prototype.calculateOutputIndexValueRowID=function(e,t,n,a){var i=e.length,o=[];if(i===0)return[];var s=0,u=e[0];if(u>=t.length)throw new Error("Got currentValueRowId=".concat(u,", which is not less than ").concat(t.length));var c=t[u];o.push(c);for(var l=1;l<i;++l){var f=e[l];if(f===u)c>=0&&(++s,s<a?c+=n:c=-1);else{if(s=0,u=f,f>=t.length)throw new Error("Got nextValueRowId=".concat(f," which is not less than ").concat(t.length));c=t[f]}o.push(c)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o},r.prototype.calculateOutputIndex=function(e,t,n,a){var i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case vi.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,n,a);case vi.ROW_SPLITS:if(i.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(i.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(i,t,n,a);default:throw new Error("Unsupported partition type: ".concat(vi[o]))}},r.prototype.getFirstDimensionSize=function(){var e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case vi.FIRST_DIM_SIZE:return e[0];case vi.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case vi.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(vi[t]))}},r.prototype.compute=function(){var e=this.rowPartitionValues[0];if(e.length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var t=this.getFirstDimensionSize(),n=this.calculateOutputSize(t),a=new Array(this.raggedRank+1);a[a.length-1]=1;for(var i=a.length-2;i>=0;--i)a[i]=a[i+1]*n[i+1];var o=wU(n,!1),s=N.util.getArrayFromDType(this.valuesDType,N.util.sizeFromShape(o)),u=a[0]*n[0];if(u>0){for(var c=this.calculateFirstParentOutputIndex(t,a[0],n[0]),i=1;i<=this.raggedRank;++i){var l=this.calculateOutputIndex(i-1,c,a[i],n[i]);c=l}this.setOutput(this.raggedRank,c,s,o)}return[o,s]},r.prototype.setOutput=function(e,t,n,a){if(n.length!==0){var i=this.values,o=n,s=a.slice();s=s.slice(e+1);var u=N.util.sizeFromShape(s),c=t.length,l=this.defaultValue;if(l.length!==u&&l.length!==1){var f=this.defaultValueShape;N.tidy(function(){var x=N.reshape(l,f),S=N.broadcastTo(x,s);l=S.dataSync()})}for(var h=0,p=0,d=0,m=0;m<=c;++m){var v=m<c?t[m]:-1;if(v===d){++d;continue}if(p<d){var g=i.subarray(h*u),y=o.subarray(p*u),w=(d-p)*u;bU(y,g,w)}if(m>=c){var b=n.length;v=Math.floor(b/u)}if(v>d)if(this.defaultValue.length===1)o.subarray(d*u,v*u).fill(this.defaultValue[0]),d=v;else for(;v>d;){var y=o.slice(d*u);bU(y,l,u),++d}v<0?(h=m+1,p=d):(h=m,p=d,d=p+1)}}},r}();function bU(r,e,t){for(var n=0;n<t;n++)r[n]=e[n]}function wU(r,e){var t,n,a=[];try{for(var i=wl(r),o=i.next();!o.done;o=i.next()){var s=o.value;if(s<0){if(!e)throw new Error("Dimension ".concat(s," must be >= 0"));if(s<-1)throw new Error("Dimension ".concat(s," must be >= -1"));s=-1}a.push(s)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a}function tV(r,e,t,n,a,i,o,s,u,c){return new AGe(r,e,t,n,a,i,o,s,u,c).compute()}function rV(r,e,t,n){var a=r===e,i=r<e&&t<0,o=e<r&&t>1;if(a||i||o)return N.util.makeZerosTypedArray(0,n);var s=Math.abs(Math.ceil((e-r)/t)),u=N.util.makeZerosTypedArray(s,n);e<r&&t===1&&(t=-1),u[0]=r;for(var c=1;c<u.length;c++)u[c]=u[c-1]+t;return u}var nV=ao(function(r){return 1/Math.sqrt(r)}),DGe=Fs(N.Rsqrt,nV),_Ge={kernelName:N.Rsqrt,backendName:"cpu",kernelFunc:DGe};function Ku(r,e,t,n,a,i,o,s,u,c){var l=[n/a,a],f=r.values,h=e.values;if(n===0)return N.buffer(t,e.dtype);var p=u instanceof N.TensorBuffer?u:N.buffer(l,e.dtype);typeof u=="string"||typeof u=="number"?p.values.fill(u):typeof u=="boolean"&&p.values.fill(+u);for(var d=0;d<i;d++){for(var m=[],v=0,g=0;g<o;g++){var y=f[d*o+g];m.push(y),v+=y*s[g]}if(v<0||v>=n/a)throw new Error("Invalid indices: ".concat(m," does not index into ").concat(t));for(var w=0;w<a;w++)c?p.values[v*a+w]+=h[d*a+w]:p.values[v*a+w]=e.rank===0?h[0]:h[d*a+w]}return p}var FGe=ao(function(r){return 1/(1+Math.exp(-r))}),aV=Ut(N.Sigmoid,function(r){return 1/(1+Math.exp(-r))}),RGe={kernelName:N.Sigmoid,backendName:"cpu",kernelFunc:aV};function iV(r,e,t,n,a){var i=N.slice_util.isSliceContinous(n,e,t),o=N.util.sizeFromShape(t),s=N.util.computeStrides(n);if(i){var u=N.slice_util.computeFlatOffset(e,s);return a==="string"?r.slice(u,u+o):r.subarray(u,u+o)}for(var c=a==="string"?N.backend_util.fromUint8ToStringArray(r):r,l=N.buffer(n,a,c),f=N.buffer(t,a),h=0;h<f.size;++h){var p=f.indexToLoc(h),d=p.map(function(m,v){return m+e[v]});f.set.apply(f,Ma([l.get.apply(l,Ma([],Ge(d),!1))],Ge(p),!1))}return a==="string"?N.backend_util.fromStringArrayToUint8(f.values):f.values}function Yu(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.begin,o=n.size;je(a,"slice");var s=Ge(N.slice_util.parseSliceParams(a,i,o),2),u=s[0],c=s[1];N.slice_util.assertParamsValid(a,u,c);var l=t.data.get(a.dataId).values,f=iV(l,u,c,a.shape,a.dtype);return t.makeTensorInfo(c,a.dtype,f)}var OGe={kernelName:N.Slice,backendName:"cpu",kernelFunc:Yu};function oV(r,e,t,n,a,i,o){var s=e[0],u=i[0],c=new Array(u),l=new Array(s),f=e[1];if(u===0){if(s!==0)throw new Error(N.backend_util.getSparseFillEmptyRowsIndicesDenseShapeMismatch(s));var h=N.util.getArrayFromDType(t,0),p=N.util.getArrayFromDType(a,0);return[h,[0,f],p,c,l]}for(var d=!0,m=0,v=new Array(u).fill(0),g=0;g<s;++g){var y=r[g*f];if(y<0)throw new Error(N.backend_util.getSparseFillEmptyRowsNegativeIndexErrorMessage(g,y));if(y>=u)throw new Error(N.backend_util.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(g,y,u));++v[y],d=d&&y>=m,m=y}for(var w=!0,y=0;y<u;++y){var b=v[y]===0;c[y]=b,w=w&&!b,v[y]=Math.max(v[y],1),y>0&&(v[y]+=v[y-1])}if(w&&d){for(var h=r,p=n,g=0;g<s;++g)l[g]=g;return[h,[s,f],p,c,l]}else{for(var x=v[u-1],h=N.util.getArrayFromDType(t,x*f),p=N.util.getArrayFromDType(a,x),S=new Array(u).fill(0),g=0;g<s;++g){var y=r[g*f],T=S[y],E=(y===0?0:v[y-1])+T;S[y]++;for(var C=0;C<f;++C)h[E*f+C]=r[g*f+C];p[E]=n[g],l[g]=E}for(var y=0;y<u;++y){var R=S[y];if(R===0){var _=y===0?0:v[y-1];h[_*f+0]=y;for(var M=1;M<f;++M)h[_*f+M]=0;p[_]=o}}return[h,[x,f],p,c,l]}}function sV(r,e,t,n,a){for(var i=N.util.sizeFromShape(n),o=e[0],s=a.length,u=[],c=1,l=-1,f=0;f<s;++f){var h=a[f];if(h===-1){if(l!==-1)throw new Error(N.backend_util.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(l,f));l=f,u.push(1)}else{if(h<0)throw new Error(N.backend_util.getSparseReshapeNegativeOutputDimErrorMessage(f,h));c*=h,u.push(h)}}if(l!==-1){if(c<=0)throw new Error(N.backend_util.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());var p=Math.trunc(i/c);if(c*p!==i)throw new Error(N.backend_util.getSparseReshapeInputOutputMultipleErrorMessage(n,u));u[l]=p}var d=N.util.sizeFromShape(u);if(d!==i)throw new Error(N.backend_util.getSparseReshapeInputOutputMismatchErrorMessage(n,u));var m=n.length,v=[];if(m>0){v[m-1]=1;for(var f=m-2;f>=0;--f)v[f]=v[f+1]*n[f+1]}var g=[];if(s>0){g[s-1]=1;for(var f=s-2;f>=0;--f)g[f]=g[f+1]*u[f+1]}for(var y=N.util.getArrayFromDType(t,o*s),w=0;w<o;++w){for(var b=0,x=0;x<m;++x)b+=r[w*m+x]*v[x];for(var x=0;x<s;++x)y[w*s+x]=Math.trunc(b/g[x]),b%=g[x]}return[y,[o,s],u]}function D2(r,e,t,n,a,i,o){i===void 0&&(i=!1),o===void 0&&(o=0);var s=n.length,u=[e[0],r.length/e[0]],c=u[1],l=s>0?a[s-1]+1:0,f=l;if(f<0)throw new Error(N.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var h=e.slice();h[0]=f;var p=h.reduce(function(T,E){return T*E},1),d=N.util.getArrayFromDType(t,p);if(s===0)return f>0&&d.fill(o),[d,h];if(f<=0)throw new Error(N.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());for(var m=0,v=1,g=0,y=a[m];;){var w=0;if(v<s){if(w=a[v],y===w){++v;continue}if(y>=w)throw new Error(N.backend_util.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=f)throw new Error(N.backend_util.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,f));y>g&&d.fill(o,g*c,y*c);for(var b=m;b<v;++b){var x=n[b];if(x<0||x>=u[0])throw new Error(N.backend_util.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(b,n[b],u[0]));for(var S=0;S<c;S++)d[y*c+S]+=r[x*c+S]}if(i)for(var S=0;S<c;S++)d[y*c+S]/=v-m;if(m=v,++v,g=y+1,y=w,v>s)break}return g<f&&d.fill(o,g*c,f*c),[d,h]}var PGe=ao(function(r){return Math.sqrt(r)}),MGe=Ut(N.Sqrt,function(r){return Math.sqrt(r)}),BGe={kernelName:N.Sqrt,backendName:"cpu",kernelFunc:MGe};var uV=$r(function(r,e){var t=r-e;return t*t}),LGe=tn(N.SquaredDifference,uV),qGe={kernelName:N.SquaredDifference,backendName:"cpu",kernelFunc:LGe};var cV=ao(function(r,e){var t=e.pattern,n=e.replaceGlobal,a=e.rewrite;return r.replace(new RegExp(t,n?"g":""),a)}),zGe=Fs(N.StaticRegexReplace,cV),$Ge={kernelName:N.StaticRegexReplace,backendName:"cpu",kernelFunc:zGe};function lV(r,e,t,n){for(var a=N.buffer(r,e.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*t[u]+n[u];a.set.apply(a,Ma([e.get.apply(e,Ma([],Ge(s),!1))],Ge(o),!1))}return a}var WGe=function(){function r(e,t,n,a,i,o){this.separator=N.util.encodeString(e),this.nGramWidths=t,this.leftPad=N.util.encodeString(n),this.rightPad=N.util.encodeString(a),this.padWidth=i,this.preserveShort=o}return r.prototype.getPadWidth=function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)},r.prototype.getNumNGrams=function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)},r.prototype.createNGrams=function(e,t,n,a,i,o){for(var s=function(l){var f=u.getPadWidth(o),h=Math.max(0,f-l),p=Math.max(0,f-(i-(l+1))),d=o-(h+p),m=t+(h>0?0:l-f),v=0;v+=h*u.leftPad.length;for(var g=0;g<d;++g)v+=e[m+g].length;v+=p*u.rightPad.length;var y=h+p+d-1;v+=y*u.separator.length,n[a+l]=new Uint8Array(v);for(var w=n[a+l],b=0,x=function(S){return S.forEach(function(T){return w[b++]=T})},g=0;g<h;++g)x(u.leftPad),x(u.separator);for(var g=0;g<d-1;++g)x(e[m+g]),x(u.separator);if(d>0){x(e[m+d-1]);for(var g=0;g<p;++g)x(u.separator),x(u.rightPad)}else{for(var g=0;g<p-1;++g)x(u.rightPad),x(u.separator);x(u.rightPad)}},u=this,c=0;c<i;++c)s(c)},r.prototype.compute=function(e,t){var n=this,a=e.length,i=t.length;if(i>0){var o=t[0];if(o!==0)throw new Error("First split value must be 0, got ".concat(o));for(var s=1;s<i;++s){var u=t[s]>=o;if(u=u&&t[s]<=a,!u)throw new Error("Invalid split value ".concat(t[s],", must be in [").concat(o,", ").concat(a,"]"));o=t[s]}if(o!==a)throw new Error("Last split value must be data size. Expected ".concat(a,", got ").concat(o))}var c=i-1,l=N.util.getArrayFromDType("int32",i);if(a===0||i===0){for(var f=new Array(a),s=0;s<=c;++s)l[s]=0;return[f,l]}l[0]=0;for(var h=function(g){var y=t[g]-t[g-1],w=0;p.nGramWidths.forEach(function(b){w+=n.getNumNGrams(y,b)}),p.preserveShort&&y>0&&w===0&&(w=1),l[g]=l[g-1]+w},p=this,s=1;s<=c;++s)h(s);for(var d=new Array(l[c]),m=function(g){var y=t[g],w=l[g];if(v.nGramWidths.forEach(function(T){var E=t[g+1]-t[g],C=n.getNumNGrams(E,T);n.createNGrams(e,y,d,w,C,T),w+=C}),v.preserveShort&&w===l[g]){var b=t[g+1]-t[g];if(b===0)return"continue";var x=b+2*v.padWidth,S=1;v.createNGrams(e,y,d,w,S,x)}},v=this,s=0;s<c;++s)m(s);return[d,l]},r}();function fV(r,e,t,n,a,i,o,s){return new WGe(t,n,a,i,o,s).compute(r,e)}function UGe(r,e,t,n){if(!!r.length){if(e.length===0){for(var a=0;a<r.length;++a)n.push(r.subarray(a,a+1));return}if(e.length===1){for(var i=e[0],o=r.indexOf(i);o!==-1;){var s=r.subarray(0,o);(!t||s.length!==0)&&n.push(s),r=r.subarray(o+1),o=r.indexOf(i)}(!t||r.length!==0)&&n.push(r);return}for(var u=0,a=0;a<r.length+1;a++)if(a===r.length||e.indexOf(r[a])!==-1){var s=r.subarray(u,a);(!t||s.length!==0)&&n.push(s),u=a+1}}}function hV(r,e,t){for(var n=r.length,a=[],i=0,o=0,s=new Array(n),u=0;u<n;++u){var c=a.length;UGe(r[u],e,t,a);var l=a.length-c;s[u]=l,i+=l,o=Math.max(o,l)}for(var f=N.util.getArrayFromDType("int32",i*2),h=new Array(i),p=[n,o],d=0,u=0;u<n;++u)for(var m=0;m<s[u];++m)f[d*2]=u,f[d*2+1]=m,h[d]=a[d],++d;return[f,h,p]}function pV(r,e){for(var t=N.util.getArrayFromDType("int32",r.length),n=0;n<r.length;++n)t[n]=N.util.fingerPrint64(r[n]).modulo(e).getLowBitsUnsigned();return t}var dV=$r(function(r,e){return r-e}),VGe=E2(function(r,e,t,n){return{real:r-t,imag:e-n}}),_2=tn(N.Sub,dV,VGe),GGe={kernelName:N.Sub,backendName:"cpu",kernelFunc:_2};function vV(r,e){for(var t=new Array(r.rank),n=0;n<t.length;n++)t[n]=r.shape[n]*e[n];for(var a=N.buffer(t,r.dtype),n=0;n<a.values.length;++n){for(var i=a.indexToLoc(n),o=new Array(r.rank),s=0;s<o.length;s++)o[s]=i[s]%r.shape[s];var u=r.locToIndex(o);a.values[n]=r.values[u]}return a}var rp=function(r,e){var t=e.value-r.value;return t===0?r.index-e.index:t};function mV(r,e,t,n){for(t===void 0&&(t=0),n===void 0&&(n=r.length-1);n>t;){if(n-t>600){var a=n-t+1,i=e-t+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2),c=Math.max(t,Math.floor(e-i*s/a+u)),l=Math.min(n,Math.floor(e+(a-i)*s/a+u));mV(r,e,c,l)}var f=r[e],h=t,p=n;for(N.util.swap(r,t,e),rp(r[n],f)>0&&N.util.swap(r,t,n);h<p;){for(N.util.swap(r,h,p),h++,p--;rp(r[h],f)<0;)h=h+1;for(;rp(r[p],f)>0;)p=p-1}rp(r[t],f)===0?N.util.swap(r,t,p):(p=p+1,N.util.swap(r,p,n)),p<=e&&(t=p+1),e<=p&&(n=p-1)}}function gV(r,e,t,n,a){for(var i=e[e.length-1],o=Ge([r.length/i,i],2),s=o[0],u=o[1],c=N.util.getTypedArrayFromDType(t,s*n),l=N.util.getTypedArrayFromDType("int32",s*n),f=function(d){var m=d*u,v=r.subarray(m,m+u),g=new Array(v.length);v.forEach(function(S,T){return g[T]={value:S,index:T}}),n<g.length&&(mV(g,n),g=g.slice(0,n)),a&&g.sort(rp);for(var y=d*n,w=c.subarray(y,y+n),b=l.subarray(y,y+n),x=0;x<n;x++)w[x]=g[x].value,b[x]=g[x].index},h=0;h<s;h++)f(h);var p=e.slice();return p[p.length-1]=n,[N.buffer(p,t,c),N.buffer(p,"int32",l)]}function yV(r,e,t,n){for(var a=N.util.parseAxisParam(e,t)[0],i=[1,t[0],1],o=0;o<a;o++)i[0]*=t[o];i[1]=t[a];for(var o=a+1;o<t.length;o++)i[2]*=t[o];for(var s=new Map,u=new Int32Array(t[a]),c=new N.TensorBuffer(i,n,r),l=[],f=i[0]===1&&i[2]===1,o=0;o<t[a];o++){var h=void 0;if(f)h=r[o].toString();else{for(var p=[],d=0;d<i[0];d++)for(var m=0;m<i[2];m++)p.push(c.get(d,o,m));h=p.join(",")}var v=s.get(h);if(v!=null)u[o]=v;else{var g=s.size;s.set(h,g),u[o]=g,l.push(o)}}var y=i.slice();y[1]=s.size;var w=new N.TensorBuffer(y,n);l.forEach(function(x,S){for(var T=0;T<i[0];T++)for(var E=0;E<i[2];E++)w.set(c.get(T,x,E),T,S,E)});var b=t.slice();return b[a]=y[1],{outputValues:w.values,outputShape:b,indices:u}}var HGe={__proto__:null,addImpl:IU,bincountImpl:I2,bincountReduceImpl:CU,bitwiseAndImpl:AU,castImpl:EU,ceilImpl:DU,concatImpl:_U,equalImpl:FU,expImpl:OU,expm1Impl:MU,floorDivImpl:LU,floorImpl:BU,gatherNdImpl:qU,gatherV2Impl:zU,greaterEqualImpl:WU,greaterImpl:$U,lessEqualImpl:VU,lessImpl:UU,linSpaceImpl:GU,logImpl:HU,maxImpl:jU,maximumImpl:KU,minimumImpl:XU,multiplyImpl:C2,negImpl:YU,notEqualImpl:JU,prodImpl:ZU,raggedGatherImpl:QU,raggedRangeImpl:eV,raggedTensorToTensorImpl:tV,rangeImpl:rV,rsqrtImpl:nV,scatterImpl:Ku,sigmoidImpl:FGe,simpleAbsImpl:TU,sliceImpl:iV,sparseFillEmptyRowsImpl:oV,sparseReshapeImpl:sV,sparseSegmentReductionImpl:D2,sqrtImpl:PGe,squaredDifferenceImpl:uV,staticRegexReplaceImpl:cV,stridedSliceImpl:lV,stringNGramsImpl:fV,stringSplitImpl:hV,stringToHashBucketFastImpl:pV,subImpl:dV,tileImpl:vV,topKImpl:gV,transposeImpl:A2,uniqueImpl:yV};var jGe="4.19.0";N.registerBackend("cpu",function(){return new T2},1);var bV=Ut(N.Elu,function(r){return r>=0?r:Math.exp(r)-1}),KGe={kernelName:N.Elu,backendName:"cpu",kernelFunc:bV};function wV(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.alpha;je([a],"leakyRelu");for(var o=N.util.sizeFromShape(a.shape),s=t.data.get(a.dataId).values,u=N.util.getTypedArrayFromDType("float32",o),c=0;c<s.length;c++)u[c]=s[c]<0?i*s[c]:s[c];return t.makeTensorInfo(a.shape,"float32",u)}var XGe={kernelName:N.LeakyRelu,backendName:"cpu",kernelFunc:wV},YGe=$r(function(r,e){return r<0?e*r:r});function xV(r){var e=r.inputs,t=r.backend,n=e.x,a=e.alpha;je([n,a],"prelu");var i=t.data.get(n.dataId).values,o=t.data.get(a.dataId).values,s=Ge(YGe(n.shape,a.shape,i,o,"float32"),2),u=s[0],c=s[1];return t.makeTensorInfo(c,"float32",u)}var JGe={kernelName:N.Prelu,backendName:"cpu",kernelFunc:xV};var kV=Ut(N.Relu,function(r){return Math.max(0,r)}),ZGe={kernelName:N.Relu,backendName:"cpu",kernelFunc:kV};var SV=Ut(N.Relu6,function(r){return Math.min(Math.max(0,r),6)}),QGe={kernelName:N.Relu6,backendName:"cpu",kernelFunc:SV};function dg(r,e,t,n,a){if(t==="linear")return no({inputs:{x:e},backend:r});if(t==="relu")return kV({inputs:{x:e},backend:r});if(t==="elu")return bV({inputs:{x:e},backend:r});if(t==="relu6")return SV({inputs:{x:e},backend:r});if(t==="prelu")return xV({inputs:{x:e,alpha:n},backend:r});if(t==="leakyrelu")return wV({inputs:{x:e},backend:r,attrs:{alpha:a}});if(t==="sigmoid")return aV({inputs:{x:e},backend:r});throw new Error("Activation ".concat(t," has not been implemented for the CPU backend."))}function Zt(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.shape,o=N.util.sizeFromShape(a.shape),s=N.util.inferFromImplicitShape(i,o),u=N.util.sizeFromShape(s);N.util.assert(o===u,function(){return"The new shape (".concat(s,") has ").concat(u," elements and the old ")+"shape (".concat(a.shape,") has ").concat(o," elements. The new shape and old ")+"shape must have the same number of elements."}),t.incRef(a.dataId);var c=t.data.get(a.dataId);if(c.complexTensorInfos!=null){var l=c.complexTensorInfos.real,f=c.complexTensorInfos.imag;l.shape=s,f.shape=s}return{dataId:a.dataId,shape:s,dtype:a.dtype}}var e6e={kernelName:N.Reshape,backendName:"cpu",kernelFunc:Zt};function NV(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.a,i=e.b,o=n.transposeA,s=n.transposeB;je([a,i],"matMul");var u=a.shape.length,c=i.shape.length,l=o?a.shape[u-2]:a.shape[u-1],f=s?i.shape[c-1]:i.shape[c-2],h=o?a.shape[u-1]:a.shape[u-2],p=s?i.shape[c-2]:i.shape[c-1],d=a.shape.slice(0,-2),m=i.shape.slice(0,-2),v=N.util.sizeFromShape(d),g=N.util.sizeFromShape(m),y=N.broadcast_util.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)),w=y.concat([h,p]);N.util.assert(l===f,function(){return"Error in matMul: inner shapes (".concat(l,") and (")+"".concat(f,") of Tensors with shapes ").concat(a.shape," and ")+"".concat(i.shape," and transposeA=").concat(o)+" and transposeB=".concat(s," must match.")});for(var b=o?[v,l,h]:[v,h,l],x=s?[g,p,f]:[g,f,p],S=Zt({inputs:{x:a},backend:t,attrs:{shape:b}}),T=Zt({inputs:{x:i},backend:t,attrs:{shape:x}}),E=o?S.shape[1]:S.shape[2],C=o?S.shape[2]:S.shape[1],R=s?T.shape[1]:T.shape[2],_=Math.max(v,g),M=t.data.get(S.dataId).values,$=t.data.get(T.dataId).values,z=N.util.computeStrides(S.shape),q=N.util.computeStrides(T.shape),L=Ge(o?[z[0],1,z[1]]:[z[0],z[1],1],3),U=L[0],Y=L[1],Z=L[2],V=Ge(s?[1,q[1],q[0]]:[q[1],1,q[0]],3),X=V[0],ne=V[1],re=V[2],se=C*R,le=N.buffer([_,C,R],S.dtype),de=le.values,ke=t.blockSize,he=0;he<_;he++)for(var ye=he%v,xe=he%g,De=0;De<C;De+=ke)for(var Ze=Math.min(De+ke,C),gt=0;gt<R;gt+=ke)for(var st=Math.min(gt+ke,R),ot=0;ot<E;ot+=ke)for(var mt=Math.min(ot+ke,E),lt=De;lt<Ze;lt++)for(var Qe=gt;Qe<st;Qe++){for(var nt=0,rt=ot;rt<mt;rt++){var hr=M[ye*U+lt*Y+rt*Z],Je=$[rt*X+Qe*ne+xe*re];nt+=hr*Je}de[he*se+(lt*R+Qe)]+=nt}return t.disposeIntermediateTensorInfo(S),t.disposeIntermediateTensorInfo(T),t.makeTensorInfo(w,le.dtype,le.values)}var t6e={kernelName:N.BatchMatMul,backendName:"cpu",kernelFunc:NV};function r6e(r){var e,t,n=r.inputs,a=r.backend,i=r.attrs,o=n.a,s=n.b,u=n.bias,c=n.preluActivationWeights,l=i.transposeA,f=i.transposeB,h=i.activation,p=i.leakyreluAlpha,d,m,v,g=[],y=NV({inputs:{a:o,b:s},attrs:{transposeA:l,transposeB:f},backend:a});d=y,u&&(m=xl({inputs:{a:d,b:u},backend:a}),g.push(d),d=m),h&&(v=dg(a,d,h,c,p),g.push(d),d=v);try{for(var w=wl(g),b=w.next();!b.done;b=w.next()){var x=b.value;a.disposeIntermediateTensorInfo(x)}}catch(S){e={error:S}}finally{try{b&&!b.done&&(t=w.return)&&t.call(w)}finally{if(e)throw e.error}}return d}var n6e={kernelName:N._FusedMatMul,backendName:"cpu",kernelFunc:r6e};var a6e=Ut(N.Acos,function(r){return Math.acos(r)}),i6e={kernelName:N.Acos,backendName:"cpu",kernelFunc:a6e};var o6e=Ut(N.Acosh,function(r){return Math.acosh(r)}),s6e={kernelName:N.Acosh,backendName:"cpu",kernelFunc:o6e};function u6e(r){var e=r.inputs,t=r.backend,n=e;je(e,"addN");for(var a=n.map(function(l){return t.data.get(l.dataId).values}),i=N.buffer(n[0].shape,n[0].dtype),o=i.values,s=0;s<n.length;s++)for(var u=a[s],c=0;c<o.length;c++)o[c]+=u[c];return t.makeTensorInfo(i.shape,i.dtype,i.values)}var c6e={kernelName:N.AddN,backendName:"cpu",kernelFunc:u6e};function l6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;je(a,"all");var s=N.util.parseAxisParam(i,a.shape),u=s,c=N.backend_util.getAxesPermutation(u,a.shape.length),l=a;c!=null&&(l=Kn({inputs:{x:a},backend:t,attrs:{perm:c}}),u=N.backend_util.getInnerMostAxes(u.length,a.shape.length)),N.backend_util.assertAxesAreInnerMostDims("all",u,l.shape.length);for(var f=Ge(N.backend_util.computeOutAndReduceShapes(l.shape,u),2),h=f[0],p=f[1],d=N.util.sizeFromShape(p),m=N.util.makeZerosTypedArray(N.util.sizeFromShape(h),l.dtype),v=t.data.get(l.dataId).values,g=0;g<m.length;++g){for(var y=g*d,w=v[y],b=0;b<d;++b){var x=v[y+b];w=w&&x}m[g]=w}c!=null&&t.disposeIntermediateTensorInfo(l);var S=t.makeTensorInfo(h,l.dtype,m);if(o){var T=N.backend_util.expandShapeToKeepDim(h,s),E=Zt({inputs:{x:S},backend:t,attrs:{shape:T}});return t.disposeIntermediateTensorInfo(S),E}return S}var f6e={kernelName:N.All,backendName:"cpu",kernelFunc:l6e};function h6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;je(a,"any");var s=N.util.parseAxisParam(i,a.shape),u=s,c=N.backend_util.getAxesPermutation(u,a.shape.length),l=a;c!=null&&(l=Kn({inputs:{x:a},backend:t,attrs:{perm:c}}),u=N.backend_util.getInnerMostAxes(u.length,a.shape.length)),N.backend_util.assertAxesAreInnerMostDims("any",u,l.shape.length);for(var f=Ge(N.backend_util.computeOutAndReduceShapes(l.shape,u),2),h=f[0],p=f[1],d=N.util.sizeFromShape(p),m=N.util.makeZerosTypedArray(N.util.sizeFromShape(h),l.dtype),v=t.data.get(l.dataId).values,g=0;g<m.length;++g){for(var y=g*d,w=v[y],b=0;b<d;++b){var x=v[y+b];w=w||x}m[g]=w}c!=null&&t.disposeIntermediateTensorInfo(l);var S=t.makeTensorInfo(h,l.dtype,m);if(o){var T=N.backend_util.expandShapeToKeepDim(h,s),E=Zt({inputs:{x:S},backend:t,attrs:{shape:T}});return t.disposeIntermediateTensorInfo(S),E}return S}var p6e={kernelName:N.Any,backendName:"cpu",kernelFunc:h6e};function d6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis;je(a,"argMax");var o=N.util.parseAxisParam(i,a.shape),s=N.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=Kn({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=N.backend_util.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],N.backend_util.assertAxesAreInnerMostDims("argMax",o,u.shape.length);for(var l=Ge(N.backend_util.computeOutAndReduceShapes(u.shape,o),2),f=l[0],h=l[1],p=N.util.sizeFromShape(f),d=N.util.makeZerosTypedArray(p,"int32"),m=N.util.sizeFromShape(h),v=t.data.get(u.dataId).values,g=0;g<d.length;++g){for(var y=g*m,w=v[y],b=0,x=0;x<m;++x){var S=v[y+x];S>w&&(w=S,b=x)}d[g]=b}return c.forEach(function(T){return t.disposeIntermediateTensorInfo(T)}),t.makeTensorInfo(f,"int32",d)}var v6e={kernelName:N.ArgMax,backendName:"cpu",kernelFunc:d6e};function m6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis;je(a,"argMin");var o=N.util.parseAxisParam(i,a.shape),s=N.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=Kn({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=N.backend_util.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],N.backend_util.assertAxesAreInnerMostDims("argMin",o,u.shape.length);for(var l=Ge(N.backend_util.computeOutAndReduceShapes(u.shape,o),2),f=l[0],h=l[1],p=N.util.sizeFromShape(f),d=N.util.makeZerosTypedArray(p,"int32"),m=N.util.sizeFromShape(h),v=t.data.get(u.dataId).values,g=0;g<d.length;++g){for(var y=g*m,w=v[y],b=0,x=0;x<m;++x){var S=v[y+x];S<w&&(w=S,b=x)}d[g]=b}return c.forEach(function(T){return t.disposeIntermediateTensorInfo(T)}),t.makeTensorInfo(f,"int32",d)}var g6e={kernelName:N.ArgMin,backendName:"cpu",kernelFunc:m6e};var y6e=Ut(N.Asin,function(r){return Math.asin(r)}),b6e={kernelName:N.Asin,backendName:"cpu",kernelFunc:y6e};var w6e=Ut(N.Asinh,function(r){return Math.asinh(r)}),x6e={kernelName:N.Asinh,backendName:"cpu",kernelFunc:w6e};var k6e=Ut(N.Atan,function(r){return Math.atan(r)}),S6e={kernelName:N.Atan,backendName:"cpu",kernelFunc:k6e};var N6e=$r(function(r,e){return Math.atan2(r,e)}),T6e=tn(N.Atan2,N6e),E6e={kernelName:N.Atan2,backendName:"cpu",kernelFunc:T6e};var I6e=Ut(N.Atanh,function(r){return Math.atanh(r)}),C6e={kernelName:N.Atanh,backendName:"cpu",kernelFunc:I6e};function F2(r,e,t,n,a,i){for(var o=a.strideHeight,s=a.strideWidth,u=a.dilationHeight,c=a.dilationWidth,l=a.effectiveFilterHeight,f=a.effectiveFilterWidth,h=a.padInfo.top,p=a.padInfo.left,d=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=N.buffer(a.outShape,t),v=m.values,g=a.outShape[1]*a.outShape[2]*a.outShape[3],y=a.outShape[2]*a.outShape[3],w=a.outShape[3],b=0;b<a.batchSize;++b)for(var x=b*g,S=b*n[0],T=0;T<a.inChannels;++T)for(var E=0;E<a.outHeight;++E)for(var C=E*o-h,R=Math.max(0,C),_=Math.min(a.inHeight,l+C),M=x+E*y,$=0;$<a.outWidth;++$){for(var z=$*s-p,q=Math.max(0,z),L=Math.min(a.inWidth,f+z),U=d,Y=0,Z=0,V=R;V<_;V+=u){for(var X=S+V*n[1],ne=q;ne<L;ne+=c){var re=X+ne*n[2],se=r[re+T];i==="max"&&se>U?U=se:i==="avg"&&(Y+=se,Z++)}if(isNaN(U))break}var le=M+$*w+T;v[le]=i==="avg"?Y/Z:U}return m}function TV(r,e,t,n,a,i){a===void 0&&(a=!1),i===void 0&&(i=!1);for(var o=N.buffer(n.outShape,"int32"),s=n.strideHeight,u=n.strideWidth,c=n.dilationHeight,l=n.dilationWidth,f=n.effectiveFilterHeight,h=n.effectiveFilterWidth,p=n.padInfo.top,d=n.padInfo.left,m=N.buffer(e,t,r),v=0;v<n.batchSize;++v)for(var g=0;g<n.inChannels;++g)for(var y=0;y<n.outHeight;++y){for(var w=y*s-p,b=w;b<0;)b+=c;for(var x=Math.min(n.inHeight,f+w),S=0;S<n.outWidth;++S){for(var T=S*u-d,E=T;E<0;)E+=l;for(var C=Math.min(n.inWidth,h+T),R=Number.NEGATIVE_INFINITY,_=-1,M=b;M<x;M+=c)for(var $=M-w,z=E;z<C;z+=l){var q=z-T,L=m.get(v,M,z,g);L>R&&(R=L,a?_=i?((v*n.inHeight+M)*n.inWidth+z)*n.inChannels+g:(M*n.inWidth+z)*n.inChannels+g:_=$*h+q)}o.set(_,v,y,S,g)}}return o}function EV(r,e,t,n,a,i){for(var o=a.strideDepth,s=a.strideHeight,u=a.strideWidth,c=a.dilationDepth,l=a.dilationHeight,f=a.dilationWidth,h=a.effectiveFilterDepth,p=a.effectiveFilterHeight,d=a.effectiveFilterWidth,m=a.padInfo.front,v=a.padInfo.top,g=a.padInfo.left,y=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=N.buffer(a.outShape,t),b=w.values,x=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],S=a.outShape[2]*a.outShape[3]*a.outShape[4],T=a.outShape[3]*a.outShape[4],E=a.outShape[4],C=0;C<a.batchSize;++C)for(var R=C*x,_=C*n[0],M=0;M<a.inChannels;++M)for(var $=0;$<a.outDepth;++$){for(var z=$*o-m,q=z;q<0;)q+=c;for(var L=Math.min(a.inDepth,h+z),U=R+$*S,Y=0;Y<a.outHeight;++Y){for(var Z=Y*s-v,V=Z;V<0;)V+=l;for(var X=Math.min(a.inHeight,p+Z),ne=U+Y*T,re=0;re<a.outWidth;++re){for(var se=re*u-g,le=se;le<0;)le+=f;for(var de=Math.min(a.inWidth,d+se),ke=ne+re*E,he=y,ye=0,xe=0,De=q;De<L;De+=c){for(var Ze=_+De*n[1],gt=V;gt<X;gt+=l){for(var st=Ze+gt*n[2],ot=le;ot<de;ot+=f){var mt=st+ot*n[3],lt=r[mt+M];if(i==="max"&&lt>he?he=lt:i==="avg"&&(ye+=lt,xe++),isNaN(he))break}if(isNaN(he))break}if(isNaN(he))break}var Qe=ke+M;b[Qe]=i==="avg"?ye/Math.max(xe,1):he}}}return w}function A6e(r,e){for(var t=N.buffer(e.outShape,"int32"),n=e.strideDepth,a=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,s=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterDepth,l=e.effectiveFilterHeight,f=e.effectiveFilterWidth,h=e.padInfo.front,p=e.padInfo.top,d=e.padInfo.left,m=0;m<e.batchSize;++m)for(var v=0;v<e.inChannels;++v)for(var g=0;g<e.outDepth;++g){for(var y=g*n-h,w=y;w<0;)w+=o;for(var b=Math.min(e.inDepth,c+y),x=0;x<e.outHeight;++x){for(var S=x*a-p,T=S;T<0;)T+=s;for(var E=Math.min(e.inHeight,l+S),C=0;C<e.outWidth;++C){for(var R=C*i-d,_=R;_<0;)_+=u;for(var M=Math.min(e.inWidth,f+R),$=Number.NEGATIVE_INFINITY,z=-1,q=w;q<b;q+=o)for(var L=q-y,U=T;U<E;U+=s)for(var Y=U-S,Z=_;Z<M;Z+=u){var V=Z-R,X=r.get(m,q,U,Z,v);X>=$&&($=X,z=L*l*f+Y*l+V)}t.set(z,m,g,x,C,v)}}}return t}function D6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;je(a,"avgPool");var i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=1;N.util.assert(N.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=N.backend_util.computePool2DInfo(a.shape,i,o,c,s,u),f;if(l.filterWidth===1&&l.filterHeight===1&&N.util.arraysEqual(l.inShape,l.outShape))f=no({inputs:{x:a},backend:t});else{var h=t.data.get(a.dataId).values,p=N.util.computeStrides(a.shape),d=F2(h,a.shape,a.dtype,p,l,"avg");f=t.makeTensorInfo(l.outShape,a.dtype,d.values)}return f}var _6e={kernelName:N.AvgPool,backendName:"cpu",kernelFunc:D6e};function F6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=n.dataFormat;je(a,"avgPool3d");var l=N.backend_util.computePool3DInfo(a.shape,i,o,1,s,u,c),f=t.data.get(a.dataId).values,h=EV(f,a.shape,a.dtype,N.util.computeStrides(a.shape),l,"avg");return t.makeTensorInfo(h.shape,"float32",h.values)}var R6e={kernelName:N.AvgPool3D,backendName:"cpu",kernelFunc:F6e};function O6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode;je([a,i],"avgPool3DGrad");for(var l=N.backend_util.computePool3DInfo(i.shape,o,s,1,u,c),f=l.strideDepth,h=l.strideHeight,p=l.strideWidth,d=l.filterDepth,m=l.filterHeight,v=l.filterWidth,g=l.dilationDepth,y=l.dilationHeight,w=l.dilationWidth,b=l.effectiveFilterDepth,x=l.effectiveFilterHeight,S=l.effectiveFilterWidth,T=b-1-l.padInfo.front,E=S-1-l.padInfo.left,C=x-1-l.padInfo.top,R=N.buffer(i.shape,"float32"),_=1/(d*m*v),M=t.bufferSync(a),$=0;$<l.batchSize;++$)for(var z=0;z<l.inChannels;++z)for(var q=0;q<l.inDepth;++q)for(var L=0;L<l.inHeight;++L)for(var U=0;U<l.inWidth;++U){for(var Y=q-T,Z=L-C,V=U-E,X=0,ne=0;ne<b;ne+=g){var re=(Y+ne)/f;if(!(re<0||re>=l.outDepth||Math.floor(re)!==re))for(var se=0;se<x;se+=y){var le=(Z+se)/h;if(!(le<0||le>=l.outHeight||Math.floor(le)!==le))for(var de=0;de<S;de+=w){var ke=(V+de)/p;if(!(ke<0||ke>=l.outWidth||Math.floor(ke)!==ke)){var he=M.get($,re,le,ke,z);X+=he}}}}R.set(X*_,$,q,L,U,z)}return t.makeTensorInfo(R.shape,R.dtype,R.values)}var P6e={kernelName:N.AvgPool3DGrad,backendName:"cpu",kernelFunc:O6e};function M6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=i;je([a,i],"avgPoolGrad");for(var s=n.filterSize,u=n.strides,c=n.pad,l=N.backend_util.computePool2DInfo(o.shape,s,u,1,c),f=l.strideHeight,h=l.strideWidth,p=l.filterHeight,d=l.filterWidth,m=l.dilationHeight,v=l.dilationWidth,g=l.effectiveFilterHeight,y=l.effectiveFilterWidth,w=y-1-l.padInfo.left,b=g-1-l.padInfo.top,x=N.buffer(o.shape,"float32"),S=1/(p*d),T=t.data.get(a.dataId).values,E=N.buffer(a.shape,"float32",T),C=0;C<l.batchSize;++C)for(var R=0;R<l.inChannels;++R)for(var _=0;_<l.inHeight;++_)for(var M=0;M<l.inWidth;++M){for(var $=_-b,z=M-w,q=0,L=0;L<g;L+=m){var U=($+L)/f;if(!(U<0||U>=l.outHeight||Math.floor(U)!==U))for(var Y=0;Y<y;Y+=v){var Z=(z+Y)/h;if(!(Z<0||Z>=l.outWidth||Math.floor(Z)!==Z)){var V=E.get(C,U,Z,R);q+=V}}}x.set(q*S,C,_,M,R)}return t.makeTensorInfo(x.shape,x.dtype,x.values)}var B6e={kernelName:N.AvgPoolGrad,backendName:"cpu",kernelFunc:M6e};function L6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.scale,o=e.offset,s=e.mean,u=e.variance;N.util.assert(s.shape.length===u.shape.length,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),N.util.assert(o==null||s.shape.length===o.shape.length,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),N.util.assert(i==null||s.shape.length===i.shape.length,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),je([a,s,u,i,o],"batchNorm");var c=n.varianceEpsilon;c==null&&(c=.001);for(var l=t.data.get(a.dataId).values,f=t.data.get(s.dataId).values,h=t.data.get(u.dataId).values,p=i?t.data.get(i.dataId).values:new Float32Array([1]),d=o?t.data.get(o.dataId).values:new Float32Array([0]),m=new Float32Array(l.length),v=d.length,g=p.length,y=h.length,w=f.length,b=0,x=0,S=0,T=0,E=0;E<l.length;++E)m[E]=d[b++]+(l[E]-f[x++])*p[S++]/Math.sqrt(h[T++]+c),b>=v&&(b=0),x>=w&&(x=0),S>=g&&(S=0),T>=y&&(T=0);return t.makeTensorInfo(a.shape,a.dtype,m)}var q6e={kernelName:N.FusedBatchNorm,backendName:"cpu",kernelFunc:L6e};function z6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockShape,o=n.crops;je([a],"batchToSpaceND");var s=i.reduce(function(g,y){return g*y}),u=N.backend_util.getReshaped(a.shape,i,s),c=N.backend_util.getPermuted(u.length,i.length),l=N.backend_util.getReshapedPermuted(a.shape,i,s),f=N.backend_util.getSliceBeginCoords(o,i.length),h=N.backend_util.getSliceSize(l,o,i.length),p=Zt({inputs:{x:a},backend:t,attrs:{shape:u}}),d=Kn({inputs:{x:p},backend:t,attrs:{perm:c}}),m=Zt({inputs:{x:d},backend:t,attrs:{shape:l}}),v=Yu({inputs:{x:m},backend:t,attrs:{begin:f,size:h}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(m),v}var $6e={kernelName:N.BatchToSpaceND,backendName:"cpu",kernelFunc:z6e};function W6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.weights,o=n.size,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=I2(s,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,c)}var U6e={kernelName:N.Bincount,backendName:"cpu",kernelFunc:W6e};function V6e(r){var e=r.inputs,t=r.backend,n=e.s0,a=e.s1,i=t.data.get(n.dataId).values,o=t.data.get(a.dataId).values,s=N.backend_util.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return t.makeTensorInfo([s.length],"int32",Int32Array.from(s))}var G6e={kernelName:N.BroadcastArgs,backendName:"cpu",kernelFunc:V6e};var H6e=Ut(N.ClipByValue,function(r,e){var t=e;return r>t.clipValueMax?t.clipValueMax:r<t.clipValueMin?t.clipValueMin:r}),j6e={kernelName:N.ClipByValue,backendName:"cpu",kernelFunc:H6e};var K6e=function(r){for(var e=r.inputs.x,t=r.backend,n=new Float32Array(N.util.sizeFromShape(e.shape)),a=t.data.get(e.dataId),i=a.complexTensorInfos.real,o=a.complexTensorInfos.imag,s=t.data.get(i.dataId).values,u=t.data.get(o.dataId).values,c=0;c<s.length;c++){var l=s[c],f=u[c];n[c]=Math.hypot(l,f)}return t.makeOutput(n,e.shape,"float32")},X6e={kernelName:N.ComplexAbs,backendName:"cpu",kernelFunc:K6e};function kl(r){var e=r.inputs,t=r.backend,n=e.input,a=t.data.get(n.dataId).complexTensorInfos.imag,i=t.data.get(a.dataId).values;return t.makeTensorInfo(a.shape,a.dtype,i)}var Y6e={kernelName:N.Imag,backendName:"cpu",kernelFunc:kl};function Sl(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.axis,i=N.util.parseAxisParam(a,e[0].shape)[0],o=e.map(function(b){return b.shape});N.backend_util.assertParamsConsistent(o,i);var s=N.backend_util.computeOutShape(e.map(function(b){return b.shape}),i);if(N.util.sizeFromShape(s)===0)return t.makeTensorInfo(s,e[0].dtype,[]);var u=e.filter(function(b){return N.util.sizeFromShape(b.shape)>0});if(u.length===1)return no({inputs:{x:u[0]},backend:t});if(u[0].dtype==="complex64"){var c=u.map(function(b){return Xu({inputs:{input:b},backend:t})}),l=u.map(function(b){return kl({inputs:{input:b},backend:t})}),f=Sl({inputs:c,backend:t,attrs:{axis:i}}),h=Sl({inputs:l,backend:t,attrs:{axis:i}}),p=ka({inputs:{real:f,imag:h},backend:t});return c.forEach(function(b){return t.disposeIntermediateTensorInfo(b)}),l.forEach(function(b){return t.disposeIntermediateTensorInfo(b)}),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),p}var d=u.map(function(b){var x=N.util.sizeFromShape(b.shape.slice(i)),S=[-1,x];return Zt({inputs:{x:b},backend:t,attrs:{shape:S}})}),m=d.map(function(b){return{vals:t.data.get(b.dataId).values,shape:b.shape}});s=N.backend_util.computeOutShape(d.map(function(b){return b.shape}),1);var v=d[0].shape[0]===1,g=_U(m,s,e[0].dtype,v),y=N.backend_util.computeOutShape(u.map(function(b){return b.shape}),i),w=t.makeTensorInfo(y,e[0].dtype,g);return d.forEach(function(b){return t.disposeIntermediateTensorInfo(b)}),w}var J6e={kernelName:N.Concat,backendName:"cpu",kernelFunc:Sl};function IV(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dataFormat,c=n.dilations,l=n.dimRoundingMode;je([a,i],"conv2d");for(var f=N.backend_util.convertConv2DDataFormat(u),h=N.backend_util.computeConv2DInfo(a.shape,i.shape,o,c,s,l,!1,f),p=h.filterHeight,d=h.filterWidth,m=h.dilationHeight,v=h.dilationWidth,g=h.padInfo.left,y=h.padInfo.top,w=h.dataFormat==="channelsLast",b=new N.TensorBuffer(h.outShape,a.dtype),x=N.util.computeStrides(a.shape),S=N.util.computeStrides(i.shape),T=x[0],E=w?x[1]:x[2],C=w?x[2]:1,R=w?1:x[1],_=b.strides[0],M=w?b.strides[1]:b.strides[2],$=w?b.strides[2]:1,z=w?1:b.strides[1],q=t.data.get(a.dataId).values,L=t.data.get(i.dataId).values,U=b.values,Y=0;Y<h.batchSize;++Y)for(var Z=Y*T,V=Y*_,X=0;X<h.outHeight;++X)for(var ne=V+X*M,re=X*h.strideHeight-y,se=0;se<p;++se){var le=re+se*m;if(!(le<0||le>=h.inHeight))for(var de=se*S[0],ke=Z+le*E,he=0;he<h.outWidth;++he)for(var ye=ne+he*$,xe=he*h.strideWidth-g,De=0;De<d;++De){var Ze=xe+De*v;if(!(Ze<0||Ze>=h.inWidth))for(var gt=de+De*S[1],st=ke+Ze*C,ot=gt,mt=0;mt<h.inChannels;++mt){for(var lt=q[st+mt*R],Qe=0;Qe<h.outChannels;++Qe)U[ye+Qe*z]+=lt*L[ot+Qe];ot+=h.outChannels}}}return t.makeTensorInfo(b.shape,b.dtype,U)}var Z6e={kernelName:N.Conv2D,backendName:"cpu",kernelFunc:IV};function Q6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode,l=n.filterShape;je([a,i],"conv2dBackpropFilter");for(var f=N.backend_util.convertConv2DDataFormat(u),h=N.backend_util.computeConv2DInfo(a.shape,l,o,1,s,c,!1,f),p=h.strideHeight,d=h.strideWidth,m=h.filterHeight,v=h.filterWidth,g=h.dataFormat==="channelsLast",y=new N.TensorBuffer(h.filterShape,"float32"),w=h.padInfo.left,b=h.padInfo.top,x=t.data.get(a.dataId).values,S=t.data.get(i.dataId).values,T=new N.TensorBuffer(a.shape,a.dtype,x),E=new N.TensorBuffer(i.shape,i.dtype,S),C=0;C<m;++C)for(var R=Math.max(0,Math.ceil((b-C)/p)),_=Math.min(h.outHeight,(h.inHeight+b-C)/p),M=0;M<v;++M)for(var $=Math.max(0,Math.ceil((w-M)/d)),z=Math.min(h.outWidth,(h.inWidth+w-M)/d),q=0;q<h.inChannels;++q)for(var L=0;L<h.outChannels;++L){for(var U=0,Y=0;Y<h.batchSize;++Y)for(var Z=R;Z<_;++Z)for(var V=C+Z*p-b,X=$;X<z;++X){var ne=M+X*d-w;g?U+=T.get(Y,V,ne,q)*E.get(Y,Z,X,L):U+=T.get(Y,q,V,ne)*E.get(Y,L,Z,X)}y.set(U,C,M,q,L)}return t.makeTensorInfo(y.shape,y.dtype,y.values)}var eHe={kernelName:N.Conv2DBackpropFilter,backendName:"cpu",kernelFunc:Q6e};function tHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.inputShape,s=n.strides,u=n.pad,c=n.dataFormat,l=n.dimRoundingMode;je([a,i],"conv2dBackpropInput");var f=N.util.computeStrides(i.shape),h=N.util.computeStrides(a.shape),p=N.backend_util.convertConv2DDataFormat(c),d=N.backend_util.computeConv2DInfo(o,i.shape,s,1,u,l,!1,p),m=new N.TensorBuffer(d.inShape,"float32"),v=m.values,g=t.data.get(a.dataId).values,y=t.data.get(i.dataId).values,w=Ge(f,3),b=w[0],x=w[1],S=w[2],T=d.batchSize,E=d.filterHeight,C=d.filterWidth,R=d.inChannels,_=d.inHeight,M=d.inWidth,$=d.outChannels,z=d.outHeight,q=d.outWidth,L=d.strideHeight,U=d.strideWidth;p=d.dataFormat;for(var Y=E-1-d.padInfo.top,Z=C-1-d.padInfo.left,V=p==="channelsLast",X=m.strides[0],ne=V?m.strides[1]:m.strides[2],re=V?m.strides[2]:1,se=V?1:m.strides[1],le=h[0],de=V?h[1]:h[2],ke=V?h[2]:1,he=V?1:h[1],ye=0;ye<T;++ye)for(var xe=0;xe<R;++xe)for(var De=0;De<_;++De)for(var Ze=De-Y,gt=Math.max(0,Math.ceil(Ze/L)),st=Math.min(z,(E+Ze)/L),ot=0;ot<M;++ot){for(var mt=ot-Z,lt=Math.max(0,Math.ceil(mt/U)),Qe=Math.min(q,(C+mt)/U),nt=0,rt=gt;rt<st;++rt)for(var hr=rt*L-Ze,Je=lt;Je<Qe;++Je)for(var Ct=Je*U-mt,Br=le*ye+de*rt+ke*Je,Cn=b*(E-1-hr)+x*(C-1-Ct)+S*xe,Vr=0;Vr<$;++Vr){var Lr=g[Br+he*Vr],pr=y[Cn+Vr];nt+=Lr*pr}var Zn=X*ye+ne*De+re*ot+se*xe;v[Zn]=nt}return t.makeTensorInfo(m.shape,m.dtype,m.values)}var rHe={kernelName:N.Conv2DBackpropInput,backendName:"cpu",kernelFunc:tHe};function nHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations;je([a,i],"conv3d");for(var c=N.backend_util.computeConv3DInfo(a.shape,i.shape,o,u,s),l=c.filterDepth,f=c.filterHeight,h=c.filterWidth,p=c.dilationDepth,d=c.dilationHeight,m=c.dilationWidth,v=c.padInfo,g=v.front,y=v.left,w=v.top,b=new N.TensorBuffer(c.outShape,a.dtype),x=t.data.get(a.dataId).values,S=t.data.get(i.dataId).values,T=b.values,E=N.util.computeStrides(a.shape),C=N.util.computeStrides(i.shape),R=0;R<c.batchSize;++R)for(var _=R*E[0],M=R*b.strides[0],$=0;$<c.outDepth;++$)for(var z=M+$*b.strides[1],q=$*c.strideDepth-g,L=0;L<l;++L){var U=q+L*p;if(!(U<0||U>=c.inDepth))for(var Y=L*C[0],Z=_+U*E[1],V=0;V<c.outHeight;++V)for(var X=z+V*b.strides[2],ne=V*c.strideHeight-w,re=0;re<f;++re){var se=ne+re*d;if(!(se<0||se>=c.inHeight))for(var le=Y+re*C[1],de=Z+se*E[2],ke=0;ke<c.outWidth;++ke)for(var he=X+ke*c.outChannels,ye=ke*c.strideWidth-y,xe=0;xe<h;++xe){var De=ye+xe*m;if(!(De<0||De>=c.inWidth))for(var Ze=le+xe*C[2],gt=de+De*c.inChannels,st=Ze,ot=0;ot<c.inChannels;++ot){for(var mt=x[gt+ot],lt=0;lt<c.outChannels;++lt)T[he+lt]+=mt*S[st+lt];st+=c.outChannels}}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}var aHe={kernelName:N.Conv3D,backendName:"cpu",kernelFunc:nHe};function iHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.pad,u=n.filterShape;je([a,i],"conv3dBackpropFilterV2");for(var c=N.util.computeStrides(a.shape),l=N.util.computeStrides(i.shape),f=N.backend_util.computeConv3DInfo(a.shape,u,o,1,s),h=f.strideDepth,p=f.strideHeight,d=f.strideWidth,m=f.filterDepth,v=f.filterHeight,g=f.filterWidth,y=new N.TensorBuffer(f.filterShape,"float32"),w=y.values,b=Ge(y.strides,4),x=b[0],S=b[1],T=b[2],E=b[3],C=t.data.get(i.dataId).values,R=Ge(l,4),_=R[0],M=R[1],$=R[2],z=R[3],q=t.data.get(a.dataId).values,L=Ge(c,4),U=L[0],Y=L[1],Z=L[2],V=L[3],X=f.padInfo.front,ne=f.padInfo.left,re=f.padInfo.top,se=0;se<m;++se)for(var le=Math.max(0,Math.ceil((X-se)/h)),de=Math.min(f.outDepth,(f.inDepth+X-se)/h),ke=se*x,he=0;he<v;++he)for(var ye=Math.max(0,Math.ceil((re-he)/p)),xe=Math.min(f.outHeight,(f.inHeight+re-he)/p),De=he*S+ke,Ze=0;Ze<g;++Ze)for(var gt=Math.max(0,Math.ceil((ne-Ze)/d)),st=Math.min(f.outWidth,(f.inWidth+ne-Ze)/d),ot=Ze*T+De,mt=0;mt<f.inChannels;++mt)for(var lt=mt*E+ot,Qe=0;Qe<f.outChannels;++Qe){for(var nt=0,rt=0;rt<f.batchSize;++rt)for(var hr=rt*U,Je=rt*_,Ct=le;Ct<de;++Ct)for(var Br=se+Ct*h-X,Cn=Br*Y+hr,Vr=Ct*M+Je,Lr=ye;Lr<xe;++Lr)for(var pr=he+Lr*p-re,Zn=pr*Z+Cn,An=Lr*$+Vr,Qn=gt;Qn<st;++Qn){var Rr=Ze+Qn*d-ne,ho=Rr*V+Zn,vc=Qn*z+An;nt+=q[ho+mt]*C[vc+Qe]}w[lt+Qe]=nt}return t.makeTensorInfo(y.shape,y.dtype,y.values)}var oHe={kernelName:N.Conv3DBackpropFilterV2,backendName:"cpu",kernelFunc:iHe};function sHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.pad,s=n.strides,u=n.inputShape;je([a],"conv3dBackpropInputV2");for(var c=N.util.computeStrides(a.shape),l=N.util.computeStrides(i.shape),f=N.backend_util.computeConv3DInfo(u,i.shape,s,1,o),h=new N.TensorBuffer(f.inShape,"float32"),p=h.values,d=Ge(h.strides,4),m=d[0],v=d[1],g=d[2],y=d[3],w=t.data.get(a.dataId).values,b=Ge(c,4),x=b[0],S=b[1],T=b[2],E=b[3],C=t.data.get(i.dataId).values,R=Ge(l,4),_=R[0],M=R[1],$=R[2],z=R[3],q=f.batchSize,L=f.filterDepth,U=f.filterHeight,Y=f.filterWidth,Z=f.inChannels,V=f.inDepth,X=f.inHeight,ne=f.inWidth,re=f.outChannels,se=f.outDepth,le=f.outHeight,de=f.outWidth,ke=f.strideDepth,he=f.strideHeight,ye=f.strideWidth,xe=L-1-f.padInfo.front,De=U-1-f.padInfo.top,Ze=Y-1-f.padInfo.left,gt=0;gt<q;++gt)for(var st=0;st<Z;++st)for(var ot=0;ot<V;++ot)for(var mt=ot-xe,lt=Math.max(0,Math.ceil(mt/ke)),Qe=Math.min(se,(L+mt)/ke),nt=0;nt<X;++nt)for(var rt=nt-De,hr=Math.max(0,Math.ceil(rt/he)),Je=Math.min(le,(U+rt)/he),Ct=0;Ct<ne;++Ct){for(var Br=Ct-Ze,Cn=Math.max(0,Math.ceil(Br/ye)),Vr=Math.min(de,(Y+Br)/ye),Lr=0,pr=lt;pr<Qe;++pr)for(var Zn=pr*ke-mt,An=hr;An<Je;++An)for(var Qn=An*he-rt,Rr=Cn;Rr<Vr;++Rr)for(var ho=Rr*ye-Br,vc=x*gt+S*pr+T*An+E*Rr,ud=_*(L-1-Zn)+M*(U-1-Qn)+$*(Y-1-ho)+z*st,po=0;po<re;++po){var Xs=w[vc+po],mc=C[ud+po];Lr+=Xs*mc}p[m*gt+v*ot+g*nt+y*Ct+st]=Lr}return t.makeTensorInfo(h.shape,h.dtype,h.values)}var uHe={kernelName:N.Conv3DBackpropInputV2,backendName:"cpu",kernelFunc:sHe};var cHe=Ut(N.Cos,function(r){return Math.cos(r)}),lHe={kernelName:N.Cos,backendName:"cpu",kernelFunc:cHe};var fHe=Ut(N.Cosh,function(r){return Math.cosh(r)}),hHe={kernelName:N.Cosh,backendName:"cpu",kernelFunc:fHe};function pHe(r){for(var e=r.inputs,t=r.backend,n=r.attrs,a=e.image,i=e.boxes,o=e.boxInd,s=n.cropSize,u=n.method,c=n.extrapolationValue,l=Ge(a.shape,4),f=l[0],h=l[1],p=l[2],d=l[3],m=i.shape[0],v=Ge(s,2),g=v[0],y=v[1],w=N.buffer([m,g,y,d],"float32"),b=t.data.get(i.dataId).values,x=t.data.get(o.dataId).values,S=t.data.get(a.dataId).values,T=N.util.computeStrides(a.shape),E=N.util.computeStrides(w.shape),C=0;C<m;C++){var R=C*4,_=b[R],M=b[R+1],$=b[R+2],z=b[R+3],q=x[C];if(!(q>=f))for(var L=g>1?($-_)*(h-1)/(g-1):0,U=y>1?(z-M)*(p-1)/(y-1):0,Y=0;Y<g;Y++){var Z=g>1?_*(h-1)+Y*L:.5*(_+$)*(h-1);if(Z<0||Z>h-1){for(var V=0;V<y;V++)for(var X=0;X<d;X++){var ne=X+V*E[2]+Y*E[1]+C*E[0];w.values[ne]=c}continue}if(u==="bilinear")for(var re=Math.floor(Z),se=Math.ceil(Z),le=Z-re,V=0;V<y;V++){var de=y>1?M*(p-1)+V*U:.5*(M+z)*(p-1);if(de<0||de>p-1){for(var X=0;X<d;X++){var ne=X+V*E[2]+Y*E[1]+C*E[0];w.values[ne]=c}continue}for(var ke=Math.floor(de),he=Math.ceil(de),ye=de-ke,X=0;X<d;X++){var ne=X+ke*T[2]+re*T[1]+q*T[0],xe=S[ne];ne=X+he*T[2]+re*T[1]+q*T[0];var De=S[ne];ne=X+ke*T[2]+se*T[1]+q*T[0];var Ze=S[ne];ne=X+he*T[2]+se*T[1]+q*T[0];var gt=S[ne],st=xe+(De-xe)*ye,ot=Ze+(gt-Ze)*ye;ne=X+V*E[2]+Y*E[1]+C*E[0],w.values[ne]=st+(ot-st)*le}}else for(var V=0;V<y;++V){var de=y>1?M*(p-1)+V*U:.5*(M+z)*(p-1);if(de<0||de>p-1){for(var X=0;X<d;X++){var ne=X+V*E[2]+Y*E[1]+C*E[0];w.values[ne]=c}continue}for(var mt=Math.round(de),lt=Math.round(Z),X=0;X<d;X++){var Qe=X+mt*T[2]+lt*T[1]+q*T[0],nt=X+V*E[2]+Y*E[1]+C*E[0];w.values[nt]=S[Qe]}}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}var dHe={kernelName:N.CropAndResize,backendName:"cpu",kernelFunc:pHe};function vHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.exclusive,s=n.reverse;je(a,"cumprod");var u=N.backend_util.getAxesPermutation([i],a.shape.length),c=a;u!=null&&(c=Kn({inputs:{x:a},backend:t,attrs:{perm:u}}));var l=N.backend_util.getInnerMostAxes(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var f=N.upcastType(c.dtype,"int32"),h=N.util.makeOnesTypedArray(N.util.sizeFromShape(c.shape),f),p=t.data.get(c.dataId).values,d=c.shape[c.shape.length-1],m=s?function(T,E){return T+d-E-1}:function(T,E){return T+E},v=0;v<p.length;v+=d)for(var g=0;g<d;g++){var y=m(v,g);if(g===0)h[y]=o?1:p[y];else{var w=m(v,g-1);h[y]=o?p[w]*h[w]:p[y]*h[w]}}var b=t.makeTensorInfo(c.shape,f,h);if(u!=null){var x=N.backend_util.getUndoAxesPermutation(u),S=Kn({inputs:{x:b},backend:t,attrs:{perm:x}});return t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(c),S}return b}var mHe={kernelName:N.Cumprod,backendName:"cpu",kernelFunc:vHe};function gHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.exclusive,s=n.reverse;je(a,"cumsum");var u=N.backend_util.getAxesPermutation([i],a.shape.length),c=a;u!=null&&(c=Kn({inputs:{x:a},backend:t,attrs:{perm:u}}));var l=N.backend_util.getInnerMostAxes(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var f=N.upcastType(c.dtype,"int32"),h=N.util.makeZerosTypedArray(N.util.sizeFromShape(c.shape),f),p=t.data.get(c.dataId).values,d=c.shape[c.shape.length-1],m=s?function(T,E){return T+d-E-1}:function(T,E){return T+E},v=0;v<p.length;v+=d)for(var g=0;g<d;g++){var y=m(v,g);if(g===0)h[y]=o?0:p[y];else{var w=m(v,g-1);h[y]=o?p[w]+h[w]:p[y]+h[w]}}var b=t.makeTensorInfo(c.shape,f,h);if(u!=null){var x=N.backend_util.getUndoAxesPermutation(u),S=Kn({inputs:{x:b},backend:t,attrs:{perm:x}});return t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(c),S}return b}var yHe={kernelName:N.Cumsum,backendName:"cpu",kernelFunc:gHe};function bHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.weights,o=n.size,s=n.binaryOutput;if(a.shape.length===1){var u=t.data.get(a.dataId).values,c=t.data.get(i.dataId).values,l=I2(u,c,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,l)}else if(a.shape.length===2){var f=t.bufferSync(a),h=t.bufferSync(i),p=CU(f,h,o,s);return t.makeTensorInfo(p.shape,i.dtype,p.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}var wHe={kernelName:N.DenseBincount,backendName:"cpu",kernelFunc:bHe};function xHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockSize,o=n.dataFormat;N.util.assert(o==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(o)});for(var s=a.shape[0],u=a.shape[1],c=a.shape[2],l=a.shape[3],f=u*i,h=c*i,p=l/(i*i),d=t.data.get(a.dataId).values,m=new Float32Array(s*f*h*p),v=0,g=0;g<s;++g)for(var y=0;y<f;++y)for(var w=Math.floor(y/i),b=y%i,x=0;x<h;++x)for(var S=Math.floor(x/i),T=x%i,E=(b*i+T)*p,C=0;C<p;++C){var R=C+E,_=R+l*(S+c*(w+u*g));m[v++]=d[_]}return t.makeTensorInfo([s,f,h,p],a.dtype,m)}var kHe={kernelName:N.DepthToSpace,backendName:"cpu",kernelFunc:xHe};function CV(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,c=n.dimRoundingMode;je([a,i],"depthwiseConv2DNative");var l=N.util.computeStrides(a.shape),f=N.util.computeStrides(i.shape),h=u;h==null&&(h=[1,1]),N.util.assert(N.backend_util.eitherStridesOrDilationsAreOne(o,h),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(h,"'")});for(var p=N.backend_util.computeConv2DInfo(a.shape,i.shape,o,h,s,c,!0),d=p.filterHeight,m=p.filterWidth,v=p.dilationHeight,g=p.dilationWidth,y=p.padInfo,w=y.left,b=y.top,x=p.outChannels/p.inChannels,S=new N.TensorBuffer(p.outShape,a.dtype),T=t.data.get(a.dataId).values,E=t.data.get(i.dataId).values,C=S.values,R=0;R<p.batchSize;++R)for(var _=R*l[0],M=R*S.strides[0],$=0;$<p.outHeight;++$)for(var z=M+$*S.strides[1],q=$*p.strideHeight-b,L=0;L<d;++L){var U=q+L*v;if(!(U<0||U>=p.inHeight))for(var Y=L*f[0],Z=_+U*l[1],V=0;V<p.outWidth;++V)for(var X=z+V*S.strides[2],ne=V*p.strideWidth-w,re=0;re<m;++re){var se=ne+re*g;if(!(se<0||se>=p.inWidth))for(var le=Y+re*f[1],de=Z+se*p.inChannels,ke=X,he=le,ye=0;ye<p.inChannels;++ye){for(var xe=T[de+ye],De=0;De<x;++De)C[ke+De]+=xe*E[he+De];ke+=x,he+=x}}}return t.makeTensorInfo(S.shape,S.dtype,S.values)}var SHe={kernelName:N.DepthwiseConv2dNative,backendName:"cpu",kernelFunc:CV};function NHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.dilations,u=n.pad,c=n.dimRoundingMode,l=n.filterShape;je([a,i],"depthwiseConv2dNativeBackpropFilter");for(var f=N.backend_util.computeConv2DInfo(a.shape,l,o,s,u,c,!0),h=f.strideHeight,p=f.strideWidth,d=f.filterHeight,m=f.filterWidth,v=new N.TensorBuffer(f.filterShape,"float32"),g=f.padInfo.left,y=f.padInfo.top,w=f.outChannels/f.inChannels,b=t.data.get(a.dataId).values,x=new N.TensorBuffer(a.shape,a.dtype,b),S=t.data.get(i.dataId).values,T=new N.TensorBuffer(i.shape,i.dtype,S),E=0;E<d;++E)for(var C=Math.max(0,Math.ceil((y-E)/h)),R=Math.min(f.outHeight,(f.inHeight+y-E)/h),_=0;_<m;++_)for(var M=Math.max(0,Math.ceil((g-_)/p)),$=Math.min(f.outWidth,(f.inWidth+g-_)/p),z=0;z<f.outChannels;++z){for(var q=Math.trunc(z/w),L=z%w,U=0,Y=0;Y<f.batchSize;++Y)for(var Z=C;Z<R;++Z)for(var V=E+Z*h-y,X=M;X<$;++X){var ne=_+X*p-g;U+=x.get(Y,V,ne,q)*T.get(Y,Z,X,z)}v.set(U,E,_,q,L)}return t.makeTensorInfo(v.shape,v.dtype,v.values)}var THe={kernelName:N.DepthwiseConv2dNativeBackpropFilter,backendName:"cpu",kernelFunc:NHe};function EHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.strides,s=n.dilations,u=n.pad,c=n.dimRoundingMode,l=n.inputShape;je([a,i],"depthwiseConv2DNativeBackpropInput");for(var f=N.util.computeStrides(a.shape),h=N.util.computeStrides(i.shape),p=N.backend_util.computeConv2DInfo(l,i.shape,o,s,u,c,!0),d=new N.TensorBuffer(p.inShape,"float32"),m=d.values,v=Ge(d.strides,3),g=v[0],y=v[1],w=v[2],b=t.data.get(a.dataId).values,x=Ge(f,3),S=x[0],T=x[1],E=x[2],C=t.data.get(i.dataId).values,R=Ge(h,3),_=R[0],M=R[1],$=R[2],z=p.batchSize,q=p.filterHeight,L=p.filterWidth,U=p.inChannels,Y=p.inHeight,Z=p.inWidth,V=p.outChannels,X=p.outHeight,ne=p.outWidth,re=p.strideHeight,se=p.strideWidth,le=q-1-p.padInfo.top,de=L-1-p.padInfo.left,ke=V/U,he=0;he<z;++he)for(var ye=0;ye<U;++ye)for(var xe=0;xe<Y;++xe)for(var De=xe-le,Ze=Math.max(0,Math.ceil(De/re)),gt=Math.min(X,(q+De)/re),st=0;st<Z;++st){for(var ot=st-de,mt=Math.max(0,Math.ceil(ot/se)),lt=Math.min(ne,(L+ot)/se),Qe=0,nt=Ze;nt<gt;++nt)for(var rt=nt*re-De,hr=mt;hr<lt;++hr)for(var Je=hr*se-ot,Ct=S*he+T*nt+E*hr,Br=_*(q-1-rt)+M*(L-1-Je)+$*ye,Cn=0;Cn<ke;++Cn){var Vr=ye*ke+Cn,Lr=b[Ct+Vr],pr=C[Br+Cn];Qe+=Lr*pr}m[g*he+y*xe+w*st+ye]=Qe}return t.makeTensorInfo(d.shape,d.dtype,d.values)}var IHe={kernelName:N.DepthwiseConv2dNativeBackpropInput,backendName:"cpu",kernelFunc:EHe};function CHe(r){for(var e=r.inputs,t=r.backend,n=e.x,a=N.util.sizeFromShape(n.shape),i=t.data.get(n.dataId).values,o=N.buffer([a,a],n.dtype),s=o.values,u=0;u<i.length;u++)s[u*a+u]=i[u];var c=Ma(Ma([],Ge(n.shape),!1),Ge(n.shape),!1);return t.makeTensorInfo(c,o.dtype,o.values)}var AHe={kernelName:N.Diag,backendName:"cpu",kernelFunc:CHe};var DHe={kernelName:N.Dilation2D,backendName:"cpu",kernelFunc:function(r){for(var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,c=t,l=c.data.get(a.dataId).values,f=a.shape.length,h=c.data.get(i.dataId).values,p=i.shape.length,d=N.backend_util.computeDilation2DInfo(a.shape,i.shape,o,s,"NHWC",u),m=d.batchSize,v=d.inHeight,g=d.inWidth,y=d.inChannels,w=d.outHeight,b=d.outWidth,x=d.padInfo,S=d.strideHeight,T=d.strideWidth,E=d.filterHeight,C=d.filterWidth,R=d.dilationHeight,_=d.dilationWidth,M=d.outShape,$=N.util.sizeFromShape(M),z=M.length,q=N.util.getArrayFromDType(a.dtype,$),L=0;L<m;++L)for(var U=0;U<w;++U)for(var Y=U*S-x.top,Z=0;Z<b;++Z)for(var V=Z*T-x.left,X=0;X<y;++X){for(var ne=Number.MIN_SAFE_INTEGER,re=0;re<E;++re){var se=Y+re*R;if(se>=0&&se<v)for(var le=0;le<C;++le){var de=V+le*_;if(de>=0&&de<g){var ke=N.util.locToIndex([L,se,de,X],f,N.util.computeStrides(a.shape)),he=N.util.locToIndex([re,le,X],p,N.util.computeStrides(i.shape)),ye=l[ke]+h[he];ye>ne&&(ne=ye)}}}var xe=N.util.locToIndex([L,U,Z,X],z,N.util.computeStrides(M));q[xe]=ne}var De=c.write(N.util.toTypedArray(q,a.dtype),M,a.dtype);return{dataId:De,shape:M,dtype:a.dtype}}};var _He={kernelName:N.Dilation2DBackpropFilter,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.dy,s=n.strides,u=n.pad,c=n.dilations,l=t,f=N.util.toNestedArray(a.shape,l.data.get(a.dataId).values),h=N.util.toNestedArray(i.shape,l.data.get(i.dataId).values),p=N.backend_util.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),d=p.batchSize,m=p.inHeight,v=p.inWidth,g=p.inChannels,y=p.outHeight,w=p.outWidth,b=p.padInfo,x=p.strideHeight,S=p.strideWidth,T=p.filterHeight,E=p.filterWidth,C=p.dilationHeight,R=p.dilationWidth,_=p.outShape;N.util.assert(o.rank===_.length,function(){return"Error in ".concat(N.Dilation2DBackpropFilter,", dy ")+"must have the same rank as output ".concat(_.length,", but got ")+"".concat(o.rank)});for(var M=N.util.toNestedArray(_,l.data.get(o.dataId).values),$=N.util.makeZerosNestedTypedArray(i.shape,i.dtype),z=0;z<d;++z)for(var q=0;q<y;++q)for(var L=q*x-b.top,U=0;U<w;++U)for(var Y=U*S-b.left,Z=0;Z<g;++Z){for(var V=Number.MIN_SAFE_INTEGER,X=0,ne=0,re=0;re<T;++re){var se=L+re*C;if(se>=0&&se<m)for(var le=0;le<E;++le){var de=Y+le*R;if(de>=0&&de<v){var ke=f[z][se][de][Z]+h[re][le][Z];ke>V&&(V=ke,X=re,ne=le)}}}$[X][ne][Z]+=M[z][q][U][Z]}var he=l.write(N.util.toTypedArray($,a.dtype),i.shape,i.dtype);return{dataId:he,shape:i.shape,dtype:i.dtype}}};var FHe={kernelName:N.Dilation2DBackpropInput,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.dy,s=n.strides,u=n.pad,c=n.dilations,l=t,f=N.util.toNestedArray(a.shape,l.data.get(a.dataId).values),h=N.util.toNestedArray(i.shape,l.data.get(i.dataId).values),p=N.backend_util.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),d=p.batchSize,m=p.inHeight,v=p.inWidth,g=p.inChannels,y=p.outHeight,w=p.outWidth,b=p.padInfo,x=p.strideHeight,S=p.strideWidth,T=p.filterHeight,E=p.filterWidth,C=p.dilationHeight,R=p.dilationWidth,_=p.outShape;N.util.assert(o.rank===_.length,function(){return"Error in ".concat(N.Dilation2DBackpropInput,", dy ")+"must have the same rank as output ".concat(_.length,", but got ")+"".concat(o.rank)});for(var M=N.util.toNestedArray(_,l.data.get(o.dataId).values),$=N.util.makeZerosNestedTypedArray(a.shape,a.dtype),z=0;z<d;++z)for(var q=0;q<y;++q)for(var L=q*x-b.top,U=0;U<w;++U)for(var Y=U*S-b.left,Z=0;Z<g;++Z){for(var V=Number.MIN_SAFE_INTEGER,X=L<0?0:L,ne=Y<0?0:Y,re=0;re<T;++re){var se=L+re*C;if(se>=0&&se<m)for(var le=0;le<E;++le){var de=Y+le*R;if(de>=0&&de<v){var ke=f[z][se][de][Z]+h[re][le][Z];ke>V&&(V=ke,X=se,ne=de)}}}$[z][X][ne][Z]+=M[z][q][U][Z]}var he=l.write(N.util.toTypedArray($,a.dtype),a.shape,a.dtype);return{dataId:he,shape:a.shape,dtype:a.dtype}}};function RHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.image,i=n.canvas,o=n.options,s=o||{},u=s.contextOptions,c=s.imageOptions,l=c?.alpha||1,f=u?.contextType||"2d";if(f!=="2d")throw new Error("Context type ".concat(u.contextType," is not supported by the CPU backend."));var h=i.getContext(f,u?.contextAttributes||{});if(h==null)throw new Error("Could not get the context with ".concat(f," type."));for(var p=Ge(a.shape.slice(0,2),2),d=p[0],m=p[1],v=a.shape.length===2?1:a.shape[2],g=t.data.get(a.dataId).values,y=a.dtype==="float32"?255:1,w=new Uint8ClampedArray(m*d*4),b=0;b<d*m;++b){for(var x=[0,0,0,255*l],S=0;S<v;S++){var T=g[b*v+S];if(a.dtype==="float32"){if(T<0||T>1)throw new Error("Tensor values for a float32 Tensor must be in the "+"range [0 - 1] but encountered ".concat(T,"."))}else if(a.dtype==="int32"&&(T<0||T>255))throw new Error("Tensor values for a int32 Tensor must be in the "+"range [0 - 255] but encountered ".concat(T,"."));v===1?(x[0]=T*y,x[1]=T*y,x[2]=T*y):x[S]=T*y}var E=b*4;w[E+0]=Math.round(x[0]),w[E+1]=Math.round(x[1]),w[E+2]=Math.round(x[2]),w[E+3]=Math.round(x[3])}i.width=m,i.height=d;var C=new ImageData(w,m,d);return h.putImageData(C,0,0),a}var OHe={kernelName:N.Draw,backendName:"cpu",kernelFunc:RHe};function ap(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;je(a,"sum");var s;a.dtype==="bool"?s=_s({inputs:{x:a},backend:t,attrs:{dtype:"int32"}}):s=no({inputs:{x:a},backend:t});var u=s.shape.length,c=N.util.parseAxisParam(i,s.shape),l=N.backend_util.getAxesPermutation(c,u),f=c,h=s;l!=null&&(h=Kn({inputs:{x:s},backend:t,attrs:{perm:l}}),f=N.backend_util.getInnerMostAxes(f.length,u)),N.backend_util.assertAxesAreInnerMostDims("sum",f,h.shape.length);for(var p=Ge(N.backend_util.computeOutAndReduceShapes(h.shape,f),2),d=p[0],m=p[1],v=N.backend_util.upcastType(h.dtype,"int32"),g=pg(t,d,v),y=N.util.sizeFromShape(m),w=t.data.get(g.dataId).values,b=t.data.get(h.dataId).values,x=0;x<w.length;++x){for(var S=x*y,T=0,E=0;E<y;++E)T+=b[S+E];w[x]=T}if(o){var C=N.backend_util.expandShapeToKeepDim(g.shape,c),R=g;g=Zt({inputs:{x:g},backend:t,attrs:{shape:C}}),t.disposeIntermediateTensorInfo(R)}return t.disposeIntermediateTensorInfo(s),l!=null&&t.disposeIntermediateTensorInfo(h),g}var PHe={kernelName:N.Sum,backendName:"cpu",kernelFunc:ap};function MHe(r){var e,t,n,a,i=r.inputs,o=r.backend,s=r.attrs,u=s.equation,c=i,l=N.backend_util.decodeEinsumEquation(u,c.length),f=l.allDims,h=l.summedDims,p=l.idDims;N.backend_util.checkEinsumDimSizes(f.length,p,c);for(var d=N.backend_util.getEinsumComputePath(h,p),m=d.path,v=d.steps,g=v.length,y=null,w=f.length,b=[],x=0;x<g;++x){try{for(var S=(e=void 0,wl(v[x])),T=S.next();!T.done;T=S.next()){var E=T.value,C=N.backend_util.getEinsumPermutation(w,p[E]),R=C.permutationIndices,_=C.expandDims,M=void 0;N.backend_util.isIdentityPermutation(R)?M=c[E]:(M=Kn({inputs:{x:c[E]},backend:o,attrs:{perm:R}}),b.push(M));for(var $=M.shape.slice(),z=0;z<_.length;++z)$.splice(_[z],0,1);N.util.arraysEqual(M.shape,$)||(M=Zt({inputs:{x:M},backend:o,attrs:{shape:$}}),b.push(M)),y===null?y=M:(y=gg({inputs:{a:M,b:y},backend:o}),b.push(y))}}catch(Y){e={error:Y}}finally{try{T&&!T.done&&(t=S.return)&&t.call(S)}finally{if(e)throw e.error}}x<g-1&&(m[x]>=0&&(y=ap({inputs:{x:y},backend:o,attrs:{axis:m[x]-(f.length-w),keepDims:!1}}),b.push(y)),w--)}try{for(var q=wl(b),L=q.next();!L.done;L=q.next()){var U=L.value;U!==y&&o.disposeIntermediateTensorInfo(U)}}catch(Y){n={error:Y}}finally{try{L&&!L.done&&(a=q.return)&&a.call(q)}finally{if(n)throw n.error}}return y}var BHe={kernelName:N.Einsum,backendName:"cpu",kernelFunc:MHe};function LHe(r){var e=r.inputs,t=r.backend,n=e.dy,a=e.y;je([n,a],"eluGrad");for(var i=new Float32Array(N.util.sizeFromShape(a.shape)),o=t.data.get(a.dataId).values,s=t.data.get(n.dataId).values,u=0;u<o.length;++u){var c=o[u];c>=0?i[u]=s[u]:i[u]=s[u]*(c+1)}return t.makeTensorInfo(a.shape,"float32",i)}var qHe={kernelName:N.EluGrad,backendName:"cpu",kernelFunc:LHe};var zHe=N.backend_util.ERF_P,$He=N.backend_util.ERF_A1,WHe=N.backend_util.ERF_A2,UHe=N.backend_util.ERF_A3,VHe=N.backend_util.ERF_A4,GHe=N.backend_util.ERF_A5,HHe=Ut(N.Erf,function(r){var e=Math.sign(r),t=Math.abs(r),n=1/(1+zHe*t);return e*(1-((((GHe*n+VHe)*n+UHe)*n+WHe)*n+$He)*n*Math.exp(-t*t))}),jHe={kernelName:N.Erf,backendName:"cpu",kernelFunc:HHe};function vg(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.input,i=n.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(N.util.assert(-(o+1)<=i,function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")}),u=o+i+1),s.splice(u,0,1),Zt({inputs:{x:a},backend:t,attrs:{shape:s}})}var KHe={kernelName:N.ExpandDims,backendName:"cpu",kernelFunc:vg};var XHe=$r(function(r,e){return r/e}),R2=tn(N.RealDiv,XHe),S2={kernelName:N.RealDiv,backendName:"cpu",kernelFunc:R2};function AV(r,e,t){for(var n=r.shape,a=n[0],i=n[1],o=t.data.get(r.dataId),s=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,c=[a,i],l=N.util.sizeFromShape(c),f=N.util.getTypedArrayFromDType("float32",l),h=N.util.getTypedArrayFromDType("float32",l),p=0;p<a;p++){for(var d=Yu({inputs:{x:s},backend:t,attrs:{begin:[p,0],size:[1,i]}}),m=Yu({inputs:{x:u},backend:t,attrs:{begin:[p,0],size:[1,i]}}),v=ka({inputs:{real:d,imag:m},backend:t}),g=YHe(v,e,t),y=g.real,w=g.imag,b=N.backend_util.mergeRealAndImagArrays(y,w),x=0;x<i;x++){var S=N.backend_util.getComplexWithIndex(b,x);f[p*i+x]=S.real,h[p*i+x]=S.imag}t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(v)}var T=t.makeTensorInfo(c,"float32",f),E=t.makeTensorInfo(c,"float32",h),C=ka({inputs:{real:T,imag:E},backend:t});return t.disposeIntermediateTensorInfo(T),t.disposeIntermediateTensorInfo(E),C}function YHe(r,e,t){var n=N.util.sizeFromShape(r.shape),a=t.data.get(r.dataId),i=t.data.get(a.complexTensorInfos.real.dataId).values,o=t.data.get(a.complexTensorInfos.imag.dataId).values;if(JHe(n)){var s=N2(i,o,n,e,t),u=[r.shape[0],r.shape[1]];if(e){var c=t.makeTensorInfo(u,"float32",s.real),l=t.makeTensorInfo(u,"float32",s.imag),f=t.makeTensorInfo([],"float32",N.util.createScalarValue(n,"float32")),h=no({inputs:{x:f},backend:t}),p=S2.kernelFunc({inputs:{a:c,b:f},backend:t}),d=S2.kernelFunc({inputs:{a:l,b:h},backend:t}),m=t.data.get(p.dataId).values,v=t.data.get(d.dataId).values;return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),{real:m,imag:v}}return s}else{var g=N.backend_util.mergeRealAndImagArrays(i,o),y=ZHe(g,n,e);return N.backend_util.splitRealAndImagArrays(y)}}function JHe(r){return(r&r-1)===0}function N2(r,e,t,n,a){if(t===1)return{real:r,imag:e};var i=N.backend_util.mergeRealAndImagArrays(r,e),o=t/2,s=N.backend_util.complexWithEvenIndex(i),u=s.real,c=s.imag,l=[u.length],f=a.makeTensorInfo(l,"float32",u),h=a.makeTensorInfo(l,"float32",c),p=ka({inputs:{real:f,imag:h},backend:a}),d=N.backend_util.complexWithOddIndex(i),m=d.real,v=d.imag,g=[m.length],y=a.makeTensorInfo(g,"float32",m),w=a.makeTensorInfo(g,"float32",v),b=ka({inputs:{real:y,imag:w},backend:a}),x=N2(u,c,o,n,a),S=x.real,T=x.imag,E=[S.length],C=a.makeTensorInfo(E,"float32",S),R=a.makeTensorInfo(E,"float32",T),_=ka({inputs:{real:C,imag:R},backend:a}),M=N2(m,v,o,n,a),$=M.real,z=M.imag,q=[$.length],L=a.makeTensorInfo(q,"float32",$),U=a.makeTensorInfo(q,"float32",z),Y=ka({inputs:{real:L,imag:U},backend:a}),Z=N.backend_util.exponents(t,n),V=[Z.real.length],X=a.makeTensorInfo(V,"float32",Z.real),ne=a.makeTensorInfo(V,"float32",Z.imag),re=ka({inputs:{real:X,imag:ne},backend:a}),se=gg({inputs:{a:re,b:Y},backend:a}),le=xl({inputs:{a:_,b:se},backend:a}),de=_2({inputs:{a:_,b:se},backend:a}),ke=Xu({inputs:{input:le},backend:a}),he=Xu({inputs:{input:de},backend:a}),ye=kl({inputs:{input:le},backend:a}),xe=kl({inputs:{input:de},backend:a}),De=Sl({inputs:[ke,he],backend:a,attrs:{axis:0}}),Ze=Sl({inputs:[ye,xe],backend:a,attrs:{axis:0}}),gt=a.data.get(De.dataId).values,st=a.data.get(Ze.dataId).values;return a.disposeIntermediateTensorInfo(f),a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(y),a.disposeIntermediateTensorInfo(w),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(C),a.disposeIntermediateTensorInfo(R),a.disposeIntermediateTensorInfo(_),a.disposeIntermediateTensorInfo(L),a.disposeIntermediateTensorInfo(U),a.disposeIntermediateTensorInfo(Y),a.disposeIntermediateTensorInfo(X),a.disposeIntermediateTensorInfo(ne),a.disposeIntermediateTensorInfo(re),a.disposeIntermediateTensorInfo(se),a.disposeIntermediateTensorInfo(le),a.disposeIntermediateTensorInfo(de),a.disposeIntermediateTensorInfo(ke),a.disposeIntermediateTensorInfo(ye),a.disposeIntermediateTensorInfo(he),a.disposeIntermediateTensorInfo(xe),a.disposeIntermediateTensorInfo(De),a.disposeIntermediateTensorInfo(Ze),{real:gt,imag:st}}function ZHe(r,e,t){for(var n=new Float32Array(e*2),a=0;a<e;a++){for(var i=0,o=0,s=0;s<e;s++){var u=N.backend_util.exponent(a*s,e,t),c=N.backend_util.getComplexWithIndex(r,s);i+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}t&&(i/=e,o/=e),N.backend_util.assignToTypedArray(n,i,o,a)}return n}function QHe(r){var e=r.inputs,t=r.backend,n=e.input,a=N.util.sizeFromShape(n.shape),i=n.shape[n.shape.length-1],o=a/i,s=Zt({inputs:{x:n},backend:t,attrs:{shape:[o,i]}}),u=AV(s,!1,t),c=Zt({inputs:{x:u},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(u),c}var eje={kernelName:N.FFT,backendName:"cpu",kernelFunc:QHe};function O2(r){var e=r.backend,t=r.attrs,n=t.shape,a=t.value,i=t.dtype,o=i||N.util.inferDtype(a),s=N.util.getArrayFromDType(o,N.util.sizeFromShape(n));return rje(s,a,o),e.makeTensorInfo(n,o,s)}var tje={kernelName:N.Fill,backendName:"cpu",kernelFunc:O2};function rje(r,e,t){r.fill(e)}var nje={kernelName:N.FlipLeftRight,backendName:"cpu",kernelFunc:function(r){var e=r.inputs;r.attrs;for(var t=r.backend,n=e.image,a=t,i=N.util.getTypedArrayFromDType(n.dtype,N.util.sizeFromShape(n.shape)),o=Ge(n.shape,4),s=o[0],u=o[1],c=o[2],l=o[3],f=a.data.get(n.dataId).values,h=0;h<s;h++)for(var p=h*c*u*l,d=0;d<u;d++)for(var m=d*(c*l),v=0;v<c;v++)for(var g=v*l,y=0;y<l;y++){var w=Math.round(c-v-1),b=p+m+g+y,x=f[b];if(w>=0&&w<c){var S=w*l,T=p+m+S+y;x=f[T]}i[b]=x}var E=a.write(i,n.shape,n.dtype);return{dataId:E,shape:n.shape,dtype:n.dtype}}};function aje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=n.strides,c=n.pad,l=n.dataFormat,f=n.dilations,h=n.dimRoundingMode,p=n.activation,d=n.leakyreluAlpha,m=IV({inputs:{x:a,filter:i},backend:t,attrs:{strides:u,pad:c,dataFormat:l,dilations:f,dimRoundingMode:h}});if(o){var v=m;if(l==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){var g=Zt({inputs:{x:o},backend:t,attrs:{shape:[o.shape[0],1,1]}});m=xl({inputs:{a:m,b:g},backend:t}),t.disposeIntermediateTensorInfo(g)}else m=xl({inputs:{a:m,b:o},backend:t});t.disposeIntermediateTensorInfo(v)}if(p){var v=m;if(l==="NCHW"&&p==="prelu"&&s.shape.length===1&&s.shape[0]!==1){var y=Zt({inputs:{x:s},backend:t,attrs:{shape:[s.shape[0],1,1]}});m=dg(t,m,p,y,d),t.disposeIntermediateTensorInfo(y)}else m=dg(t,m,p,s,d);t.disposeIntermediateTensorInfo(v)}return m}var ije={kernelName:N.FusedConv2D,backendName:"cpu",kernelFunc:aje};function oje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=n.strides,c=n.pad,l=n.dataFormat,f=n.dilations,h=n.dimRoundingMode,p=n.activation,d=n.leakyreluAlpha,m=CV({inputs:{x:a,filter:i},backend:t,attrs:{strides:u,pad:c,dataFormat:l,dilations:f,dimRoundingMode:h}});if(o){var v=m;m=xl({inputs:{a:m,b:o},backend:t}),t.disposeIntermediateTensorInfo(v)}if(p){var v=m;m=dg(t,m,p,s,d),t.disposeIntermediateTensorInfo(v)}return m}var sje={kernelName:N.FusedDepthwiseConv2D,backendName:"cpu",kernelFunc:oje};function uje(r){var e=r.inputs,t=r.backend,n=e.params,a=e.indices,i=N.util.sizeFromShape(n.shape),o=a.shape,s=o[o.length-1],u=Ge(N.backend_util.prepareAndValidate(n,a),4),c=u[0],l=u[1],f=u[2],h=u[3];if(l===0)return t.makeTensorInfo(c,n.dtype,[]);var p=t.data.get(a.dataId).values,d=t.bufferSync(n),m=qU(p,d,n.dtype,l,s,f,h,n.shape,i);return t.makeTensorInfo(c,n.dtype,m.values)}var cje={kernelName:N.GatherNd,backendName:"cpu",kernelFunc:uje};function lje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.indices,o=n.axis,s=n.batchDims;je([a,i],"gatherV2");for(var u=N.util.parseAxisParam(o,a.shape)[0],c=t.data.get(i.dataId).values,l=a.shape[u],f=function(S){var T=c[S];N.util.assert(T<=l-1&&T>=0,function(){return"GatherV2: the index value ".concat(T," is not in [0, ").concat(l-1,"]")})},h=0;h<c.length;++h)f(h);var p=s;s==null&&(p=0);var d=N.util.sizeFromShape(i.shape),m=N.backend_util.segment_util.collectGatherOpShapeInfo(a,i,u,p),v=Zt({inputs:{x:a},backend:t,attrs:{shape:[m.batchSize,m.outerSize,m.dimSize,m.sliceSize]}}),g=Zt({inputs:{x:i},backend:t,attrs:{shape:[m.batchSize,d/m.batchSize]}}),y=[m.batchSize,m.outerSize,d/m.batchSize,m.sliceSize],w=t.bufferSync(g),b=t.bufferSync(v),x=zU(b,w,y);return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(g),t.makeTensorInfo(m.outputShape,x.dtype,x.values)}var fje={kernelName:N.GatherV2,backendName:"cpu",kernelFunc:lje};function hje(r){var e=r.inputs,t=r.backend,n=e.input,a=N.util.sizeFromShape(n.shape),i=n.shape[n.shape.length-1],o=a/i,s=Zt({inputs:{x:n},backend:t,attrs:{shape:[o,i]}}),u=AV(s,!0,t),c=Zt({inputs:{x:u},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(u),c}var pje={kernelName:N.IFFT,backendName:"cpu",kernelFunc:hje};var dje=Ut(N.IsFinite,function(r){return Number.isFinite(r)?1:0},"bool"),vje={kernelName:N.IsFinite,backendName:"cpu",kernelFunc:dje};var mje=Ut(N.IsInf,function(r){return Math.abs(r)===1/0?1:0},"bool"),gje={kernelName:N.IsInf,backendName:"cpu",kernelFunc:mje};var yje=Ut(N.IsNan,function(r){return Number.isNaN(r)?1:0},"bool"),bje={kernelName:N.IsNan,backendName:"cpu",kernelFunc:yje};function wje(r){var e=r.backend,t=r.attrs,n=t.start,a=t.stop,i=t.num,o=GU(n,a,i);return e.makeTensorInfo([o.length],"float32",o)}var xje={kernelName:N.LinSpace,backendName:"cpu",kernelFunc:wje};var kje=Ut(N.Log1p,function(r){return Math.log1p(r)}),Sje={kernelName:N.Log1p,backendName:"cpu",kernelFunc:kje};var Nje=$r(function(r,e){return r&&e}),Tje=tn(N.LogicalAnd,Nje,null,"bool"),Eje={kernelName:N.LogicalAnd,backendName:"cpu",kernelFunc:Tje};var Ije=Ut(N.LogicalNot,function(r){return r?0:1},"bool"),Cje={kernelName:N.LogicalNot,backendName:"cpu",kernelFunc:Ije};var Aje=$r(function(r,e){return r||e}),Dje=tn(N.LogicalOr,Aje,null,"bool"),_je={kernelName:N.LogicalOr,backendName:"cpu",kernelFunc:Dje};function Fje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.depthRadius,o=n.bias,s=n.alpha,u=n.beta;je(a,"LRN");var c=a.shape[3],l=c-1,f=t.data.get(a.dataId).values,h=N.util.sizeFromShape(a.shape),p=new Float32Array(h);function d(y){for(var w=y%c,b=y-w+Math.max(0,w-i),x=y-w+Math.min(w+i,l),S=0;b<=x;b++){var T=f[b];S+=T*T}return S}for(var m=0;m<h;m++){var v=d(m),g=f[m]*Math.pow(o+s*v,-u);p[m]=g}return t.makeTensorInfo(a.shape,a.dtype,p)}var Rje={kernelName:N.LRN,backendName:"cpu",kernelFunc:Fje};function Oje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.y,o=e.dy,s=n.depthRadius,u=n.bias,c=n.alpha,l=n.beta;je(o,"LRNGrad");for(var f=N.util.sizeFromShape(o.shape),h=o.shape[3],p=t.data.get(o.dataId).values,d=t.data.get(a.dataId).values,m=t.data.get(i.dataId).values,v=new Float32Array(f),g=f,y=0;y<g;y++){for(var w=y%h,b=y-w+Math.max(0,w-s),x=y-w+Math.min(h,w+s+1),S=0,T=b;T<x;T++)S+=Math.pow(d[T],2);S=c*S+u;for(var T=b;T<x;T++){var E=-2*c*l*d[T]*m[y]/S;y===T&&(E+=Math.pow(S,-l)),E*=p[y],v[T]+=E}}return t.makeTensorInfo(o.shape,a.dtype,v)}var Pje={kernelName:N.LRNGrad,backendName:"cpu",kernelFunc:Oje};function DV(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.reductionIndices,o=n.keepDims,s=t,u=a.shape,c=u.length,l=N.util.parseAxisParam(i,u),f=l,h=N.backend_util.getAxesPermutation(f,c),p=s.data.get(a.dataId).values;if(h!=null){for(var d=new Array(c),m=0;m<d.length;m++)d[m]=u[h[m]];p=A2(p,u,a.dtype,h,d),f=N.backend_util.getInnerMostAxes(f.length,c),u=d}je(a,"max"),N.backend_util.assertAxesAreInnerMostDims("max",f,c);var v=Ge(N.backend_util.computeOutAndReduceShapes(u,f),2),g=v[0],y=v[1],w=N.util.sizeFromShape(y),b=jU(p,w,g,a.dtype),x=s.write(b,g,a.dtype),S=g;if(o){var d=N.backend_util.expandShapeToKeepDim(g,l);S=d}return{dataId:x,shape:S,dtype:a.dtype}}var Mje={kernelName:N.Max,backendName:"cpu",kernelFunc:DV};function Bje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;je(a,"maxPool");var i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=1;N.util.assert(N.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=N.backend_util.computePool2DInfo(a.shape,i,o,c,s,u),f;if(l.filterWidth===1&&l.filterHeight===1&&N.util.arraysEqual(l.inShape,l.outShape))f=no({inputs:{x:a},backend:t});else{var h=t.data.get(a.dataId).values,p=N.util.computeStrides(a.shape),d=F2(h,a.shape,a.dtype,p,l,"max");f=t.makeTensorInfo(l.outShape,a.dtype,d.values)}return f}var Lje={kernelName:N.MaxPool,backendName:"cpu",kernelFunc:Bje};function qje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=n.dataFormat;je(a,"maxPool3d");var l=N.backend_util.computePool3DInfo(a.shape,i,o,1,s,u,c),f=t.data.get(a.dataId).values,h=EV(f,a.shape,a.dtype,N.util.computeStrides(a.shape),l,"max");return t.makeTensorInfo(h.shape,"float32",h.values)}var zje={kernelName:N.MaxPool3D,backendName:"cpu",kernelFunc:qje};function $je(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode;je([a,i],"maxPool3DGrad");for(var l=N.backend_util.computePool3DInfo(i.shape,o,s,1,u,c),f=t.bufferSync(i),h=A6e(f,l),p=l.strideDepth,d=l.strideHeight,m=l.strideWidth,v=l.dilationDepth,g=l.dilationHeight,y=l.dilationWidth,w=l.effectiveFilterDepth,b=l.effectiveFilterHeight,x=l.effectiveFilterWidth,S=w-1-l.padInfo.front,T=x-1-l.padInfo.left,E=b-1-l.padInfo.top,C=N.buffer(i.shape,"float32"),R=t.bufferSync(a),_=0;_<l.batchSize;++_)for(var M=0;M<l.inChannels;++M)for(var $=0;$<l.inDepth;++$)for(var z=0;z<l.inHeight;++z)for(var q=0;q<l.inWidth;++q){for(var L=$-S,U=z-E,Y=q-T,Z=0,V=0;V<w;V+=v){var X=(L+V)/p;if(!(X<0||X>=l.outDepth||Math.floor(X)!==X))for(var ne=0;ne<b;ne+=g){var re=(U+ne)/d;if(!(re<0||re>=l.outHeight||Math.floor(re)!==re))for(var se=0;se<x;se+=y){var le=(Y+se)/m;if(!(le<0||le>=l.outWidth||Math.floor(le)!==le)){var de=w*b*x-1-h.get(_,X,re,le,M),ke=V*b*x+ne*x+se,he=de===ke?1:0;if(he!==0){var ye=R.get(_,X,re,le,M);Z+=ye*he}}}}}C.set(Z,_,$,z,q,M)}return t.makeTensorInfo(C.shape,C.dtype,C.values)}var Wje={kernelName:N.MaxPool3DGrad,backendName:"cpu",kernelFunc:$je};function Uje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=e.output,s=i;je([i,o],"maxPoolGrad");for(var u=n.filterSize,c=n.strides,l=n.pad,f=n.dimRoundingMode,h=N.backend_util.computePool2DInfo(s.shape,u,c,1,l,f),p=t.data.get(s.dataId).values,d=N.buffer(h.outShape,s.dtype,TV(p,s.shape,s.dtype,h).values),m=h.strideHeight,v=h.strideWidth,g=h.dilationHeight,y=h.dilationWidth,w=h.effectiveFilterHeight,b=h.effectiveFilterWidth,x=b-1-h.padInfo.left,S=w-1-h.padInfo.top,T=N.buffer(s.shape,"float32"),E=t.data.get(a.dataId).values,C=N.buffer(a.shape,"float32",E),R=0;R<h.batchSize;++R)for(var _=0;_<h.inChannels;++_)for(var M=0;M<h.inHeight;++M)for(var $=0;$<h.inWidth;++$){for(var z=M-S,q=$-x,L=0,U=0;U<w;U+=g){var Y=(z+U)/m;if(!(Y<0||Y>=h.outHeight||Math.floor(Y)!==Y))for(var Z=0;Z<b;Z+=y){var V=(q+Z)/v;if(!(V<0||V>=h.outWidth||Math.floor(V)!==V)){var X=w*b-1-d.get(R,Y,V,_),ne=U*b+Z,re=X===ne?1:0;if(re!==0){var se=C.get(R,Y,V,_);L+=se*re}}}}T.set(L,R,M,$,_)}return t.makeTensorInfo(T.shape,T.dtype,T.values)}var Vje={kernelName:N.MaxPoolGrad,backendName:"cpu",kernelFunc:Uje};function Gje(r,e,t,n,a){var i=N.util.computeStrides(e),o=F2(r,e,t,i,a,"max"),s=TV(r,e,t,a,!0,n);return[o.values,s.values]}var Hje={kernelName:N.MaxPoolWithArgmax,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.x,i=t.filterSize,o=t.strides,s=t.pad,u=t.includeBatchInIndex,c=n;je(a,"MaxPoolWithArgmax");var l=c.data.get(a.dataId).values,f=N.backend_util.computePool2DInfo(a.shape,i,o,[1,1],s),h=Ge(Gje(l,a.shape,a.dtype,u,f),2),p=h[0],d=h[1],m=c.write(p,f.outShape,a.dtype),v=c.write(d,f.outShape,a.dtype);return[{dataId:m,shape:f.outShape,dtype:a.dtype},{dataId:v,shape:f.outShape,dtype:"int32"}]}};function jje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=N.util.parseAxisParam(i,a.shape),u=N.backend_util.computeOutAndReduceShapes(a.shape,s),c=u[1],l=N.util.sizeFromShape(c),f=[],h=t.makeTensorInfo([],"float32",new Float32Array([l]));f.push(h);var p=_s({inputs:{x:a},backend:t,attrs:{dtype:"float32"}});f.push(p);var d=R2({inputs:{a:p,b:h},backend:t});f.push(d);var m=ap({inputs:{x:d},backend:t,attrs:{axis:i,keepDims:o}});return f.forEach(function(v){return t.disposeIntermediateTensorInfo(v)}),m}var Kje={kernelName:N.Mean,backendName:"cpu",kernelFunc:jje};function Xje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;je(a,"min");var s=N.util.parseAxisParam(i,a.shape),u=s,c=N.backend_util.getAxesPermutation(u,a.shape.length),l=a;c!=null&&(l=Kn({inputs:{x:a},backend:t,attrs:{perm:c}}),u=N.backend_util.getInnerMostAxes(u.length,a.shape.length)),N.backend_util.assertAxesAreInnerMostDims("min",u,l.shape.length);for(var f=Ge(N.backend_util.computeOutAndReduceShapes(l.shape,u),2),h=f[0],p=f[1],d=N.util.sizeFromShape(p),m=N.util.makeZerosTypedArray(N.util.sizeFromShape(h),l.dtype),v=t.data.get(l.dataId).values,g=0;g<m.length;++g){for(var y=g*d,w=v[y],b=0;b<d;++b){var x=v[y+b];(Number.isNaN(x)||x<w)&&(w=x)}m[g]=w}c!=null&&t.disposeIntermediateTensorInfo(l);var S=t.makeTensorInfo(h,l.dtype,m);if(o){var T=N.backend_util.expandShapeToKeepDim(h,s),E=Zt({inputs:{x:S},backend:t,attrs:{shape:T}});return t.disposeIntermediateTensorInfo(S),E}return S}var Yje={kernelName:N.Min,backendName:"cpu",kernelFunc:Xje};function Jje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.paddings,o=n.mode;je(a,"mirrorPad");for(var s=i.map(function(T,E){return T[0]+a.shape[E]+T[1]}),u=i.map(function(T){return T[0]}),c=i.map(function(T,E){return T[0]+a.shape[E]}),l=o==="reflect"?0:1,f=t.data.get(a.dataId).values,h=a.shape.length,p=N.util.computeStrides(a.shape),d=N.util.sizeFromShape(s),m=s.length,v=N.util.computeStrides(s),g=N.util.getTypedArrayFromDType(a.dtype,d),y=0;y<d;y++){for(var w=N.util.indexToLoc(y,m,v),b=0;b<m;b++)w[b]<u[b]?w[b]=u[b]*2-w[b]-l:w[b]>=c[b]&&(w[b]=(c[b]-1)*2-w[b]+l);w=w.map(function(T,E){return T-u[E]});var x=N.util.locToIndex(w,h,p);g[y]=f[x]}var S=t.write(g,s,a.dtype);return{dataId:S,shape:s,dtype:a.dtype}}var Zje={kernelName:N.MirrorPad,backendName:"cpu",kernelFunc:Jje};var Qje=$r(function(r,e){var t=r%e;return r<0&&e<0||r>=0&&e>=0?t:(t+e)%e}),e5e=tn(N.Mod,Qje),t5e={kernelName:N.Mod,backendName:"cpu",kernelFunc:e5e};function _V(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.logits,i=n.dim,o=a.shape.length,s=i;if(s===-1&&(s=o-1),s!==o-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(o," and dim was ").concat(s));var u=N.util.parseAxisParam([s],a.shape),c=DV({inputs:{x:a},backend:t,attrs:{reductionIndices:u,keepDims:!1}}),l=N.backend_util.expandShapeToKeepDim(c.shape,u),f=Zt({inputs:{x:c},backend:t,attrs:{shape:l}}),h=_2({inputs:{a,b:f},backend:t}),p=PU({inputs:{x:h},backend:t}),d=ap({inputs:{x:p},backend:t,attrs:{axis:u,keepDims:!1}}),m=Zt({inputs:{x:d},backend:t,attrs:{shape:l}}),v=R2({inputs:{a:p,b:m},backend:t});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(m),v}var r5e={kernelName:N.Softmax,backendName:"cpu",kernelFunc:_V};function n5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.logits,i=n.numSamples,o=n.seed,s=n.normalized;je(a,"multinomial");for(var u=s?a:_V({inputs:{logits:a},backend:t,attrs:{dim:-1}}),c=u.shape[0],l=u.shape[1],f=t.data.get(u.dataId).values,h=[c,i],p=N.util.makeZerosTypedArray(N.util.sizeFromShape(h),"int32"),d=0;d<c;++d){var m=d*l,v=new Float32Array(l-1);v[0]=f[m];for(var g=1;g<v.length;++g)v[g]=v[g-1]+f[m+g];for(var y=_Ve.alea(o.toString()),w=d*i,b=0;b<i;++b){var x=y();p[w+b]=v.length;for(var g=0;g<v.length;g++)if(x<v[g]){p[w+b]=g;break}}}return s||t.disposeIntermediateTensorInfo(u),t.makeTensorInfo(h,"int32",p)}var a5e={kernelName:N.Multinomial,backendName:"cpu",kernelFunc:n5e};var i5e=N.kernel_impls.nonMaxSuppressionV3Impl;function o5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold;je(a,"NonMaxSuppression");var c=t.data.get(a.dataId).values,l=t.data.get(i.dataId).values,f=i5e(c,l,o,s,u).selectedIndices;return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}var s5e={kernelName:N.NonMaxSuppressionV3,backendName:"cpu",kernelFunc:o5e};var u5e=N.kernel_impls.nonMaxSuppressionV4Impl;function c5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,c=n.padToMaxOutputSize;je(a,"NonMaxSuppressionPadded");var l=t.data.get(a.dataId).values,f=t.data.get(i.dataId).values,h=u5e(l,f,o,s,u,c),p=h.selectedIndices,d=h.validOutputs;return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([d]))]}var l5e={kernelName:N.NonMaxSuppressionV4,backendName:"cpu",kernelFunc:c5e};var f5e=N.kernel_impls.nonMaxSuppressionV5Impl;function h5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,c=n.softNmsSigma;je(a,"NonMaxSuppressionWithScore");var l=t.data.get(a.dataId).values,f=t.data.get(i.dataId).values,h=o,p=s,d=u,m=c,v=f5e(l,f,h,p,d,m),g=v.selectedIndices,y=v.selectedScores;return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var p5e={kernelName:N.NonMaxSuppressionV5,backendName:"cpu",kernelFunc:h5e};function d5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.indices,i=n.dtype,o=n.depth,s=n.onValue,u=n.offValue;je(a,"oneHot");var c=N.util.sizeFromShape(a.shape),l=new Float32Array(c*o);l.fill(u);for(var f=t.data.get(a.dataId).values,h=0;h<c;++h)f[h]>=0&&f[h]<o&&(l[h*o+f[h]]=s);return t.makeTensorInfo(Ma(Ma([],Ge(a.shape),!1),[o],!1),i,l)}var v5e={kernelName:N.OneHot,backendName:"cpu",kernelFunc:d5e};function mg(r){var e=r.inputs,t=r.backend,n=e.x;if(n.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(n.dtype==="complex64"){var a=Xu({inputs:{input:n},backend:t}),i=mg({inputs:{x:a},backend:t}),o=kl({inputs:{input:n},backend:t}),s=mg({inputs:{x:o},backend:t}),u=ka({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return O2({backend:t,attrs:{shape:n.shape,value:0,dtype:n.dtype}})}var m5e={kernelName:N.ZerosLike,backendName:"cpu",kernelFunc:mg};function FV(r){var e=r.inputs,t=r.backend,n=e.x;if(n.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(n.dtype==="complex64"){var a=Xu({inputs:{input:n},backend:t}),i=FV({inputs:{x:a},backend:t}),o=kl({inputs:{input:n},backend:t}),s=mg({inputs:{x:o},backend:t}),u=ka({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return O2({backend:t,attrs:{shape:n.shape,value:1,dtype:n.dtype}})}var g5e={kernelName:N.OnesLike,backendName:"cpu",kernelFunc:FV};function RV(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.axis;if(e.length===1)return vg({inputs:{input:e[0]},backend:t,attrs:{dim:a}});var i=e[0].shape,o=e[0].dtype;e.forEach(function(l){N.util.assertShapesMatch(i,l.shape,"All tensors passed to stack must have matching shapes"),N.util.assert(o===l.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=[],u=e.map(function(l){var f=vg({inputs:{input:l},backend:t,attrs:{dim:a}});return s.push(f),f}),c=Sl({inputs:u,backend:t,attrs:{axis:a}});return s.forEach(function(l){return t.disposeIntermediateTensorInfo(l)}),c}var y5e={kernelName:N.Pack,backendName:"cpu",kernelFunc:RV};function b5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.paddings,o=n.constantValue;je(a,"pad");var s=i.map(function(S,T){return S[0]+a.shape[T]+S[1]}),u=i.map(function(S){return S[0]}),c=t.data.get(a.dataId).values,l=N.util.sizeFromShape(a.shape),f=a.shape.length,h=N.util.computeStrides(a.shape),p=N.util.sizeFromShape(s),d=s.length,m=N.util.computeStrides(s),v=N.util.getTypedArrayFromDType(a.dtype,p);o!==0&&v.fill(o);for(var g=0;g<l;g++){var y=N.util.indexToLoc(g,f,h),w=y.map(function(S,T){return S+u[T]}),b=N.util.locToIndex(w,d,m);v[b]=c[g]}var x=t.write(v,s,a.dtype);return{dataId:x,shape:s,dtype:a.dtype}}var OV={kernelName:N.PadV2,backendName:"cpu",kernelFunc:b5e};var w5e=$r(function(r,e){return Math.pow(r,e)}),x5e=tn(N.Pow,w5e),k5e={kernelName:N.Pow,backendName:"cpu",kernelFunc:x5e};function S5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.paramsNestedSplits,i=e.paramsDenseValues,o=e.indices;n.outputRaggedRank;var s=a.map(function(g){return t.data.get(g.dataId).values}),u=a.map(function(g){return g.shape}),c=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values,f=Ge(QU(s,u,c,i.shape,i.dtype,l,o.shape),3),h=f[0],p=f[1],d=f[2],m=h.map(function(g){return t.makeTensorInfo([g.length],"int32",g)}),v=t.makeTensorInfo(d,i.dtype,p);return m.concat([v])}var N5e={kernelName:N.RaggedGather,backendName:"cpu",kernelFunc:S5e};function T5e(r){var e=r.inputs,t=r.backend,n=e.starts,a=e.limits,i=e.deltas,o=t.data.get(n.dataId).values,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=Ge(eV(o,n.shape,n.dtype,s,a.shape,u,i.shape),2),l=c[0],f=c[1],h=t.makeTensorInfo([l.length],"int32",l),p=t.makeTensorInfo([f.length],n.dtype,f);return[h,p]}var E5e={kernelName:N.RaggedRange,backendName:"cpu",kernelFunc:T5e};function I5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.shape,i=e.values,o=e.defaultValue,s=e.rowPartitionTensors,u=n.rowPartitionTypes,c=t.data.get(a.dataId).values,l=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,h=s.map(function(g){return t.data.get(g.dataId).values}),p=s.map(function(g){return g.shape}),d=Ge(tV(c,a.shape,l,i.shape,i.dtype,f,o.shape,h,p,u),2),m=d[0],v=d[1];return t.makeTensorInfo(m,i.dtype,v)}var C5e={kernelName:N.RaggedTensorToTensor,backendName:"cpu",kernelFunc:I5e};function A5e(r){var e=r.backend,t=r.attrs,n=t.start,a=t.stop,i=t.dtype,o=t.step,s=rV(n,a,o,i);return e.makeTensorInfo([s.length],i,s)}var D5e={kernelName:N.Range,backendName:"cpu",kernelFunc:A5e};var _5e=Ut(N.Reciprocal,function(r){return 1/r}),F5e={kernelName:N.Reciprocal,backendName:"cpu",kernelFunc:_5e};function R5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=n.alignCorners,o=n.halfPixelCenters,s=n.size;je(a,"resizeBilinear");for(var u=N.util.computeStrides(a.shape),c=Ge(s,2),l=c[0],f=c[1],h=Ge(a.shape,4),p=h[0],d=h[1],m=h[2],v=h[3],g=t.data.get(a.dataId).values,y=new Float32Array(N.util.sizeFromShape([p,l,f,v])),w=[i&&l>1?d-1:d,i&&f>1?m-1:m],b=[i&&l>1?l-1:l,i&&f>1?f-1:f],x=0,S=w[0]/b[0],T=w[1]/b[1],E=0;E<p;E++)for(var C=0;C<l;C++){var R=void 0;o?R=S*(C+.5)-.5:R=S*C;for(var _=Math.max(0,Math.floor(R)),M=R-_,$=Math.min(d-1,Math.ceil(R)),z=E*u[0]+_*u[1],q=E*u[0]+$*u[1],L=0;L<f;L++){var U=void 0;o?U=T*(L+.5)-.5:U=T*L;for(var Y=Math.max(0,Math.floor(U)),Z=U-Y,V=Math.min(m-1,Math.ceil(U)),X=z+Y*u[2],ne=q+Y*u[2],re=z+V*u[2],se=q+V*u[2],le=0;le<v;le++){var de=g[X+le],ke=g[ne+le],he=g[re+le],ye=g[se+le],xe=de+(he-de)*Z,De=ke+(ye-ke)*Z,Ze=xe+(De-xe)*M;y[x++]=Ze}}}return t.makeTensorInfo([p,l,f,v],"float32",y)}var O5e={kernelName:N.ResizeBilinear,backendName:"cpu",kernelFunc:R5e};function P5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=e.dy,o=n.alignCorners;je([i,a],"resizeBilinearGrad");for(var s=N.util.computeStrides(a.shape),u=Ge(a.shape,4),c=u[0],l=u[1],f=u[2],h=u[3],p=Ge(i.shape,3),d=p[1],m=p[2],v=new Float32Array(c*l*f*h),g=[o&&d>1?l-1:l,o&&m>1?f-1:f],y=[o&&d>1?d-1:d,o&&m>1?m-1:m],w=g[0]/y[0],b=g[1]/y[1],x=t.data.get(i.dataId).values,S=0,T=0;T<c;T++)for(var E=T*s[0],C=0;C<d;C++)for(var R=C*w,_=Math.floor(R),M=Math.min(Math.ceil(R),l-1),$=E+_*s[1],z=E+M*s[1],q=R-_,L=1-q,U=0;U<m;U++)for(var Y=U*b,Z=Math.floor(Y),V=Math.min(Math.ceil(Y),f-1),X=Y-Z,ne=1-X,re=$+Z*s[2],se=$+V*s[2],le=z+Z*s[2],de=z+V*s[2],ke=L*ne,he=L*X,ye=q*ne,xe=q*X,De=0;De<h;De++){var Ze=x[S++];v[re+De]+=Ze*ke,v[se+De]+=Ze*he,v[le+De]+=Ze*ye,v[de+De]+=Ze*xe}return t.makeTensorInfo([c,f,l,h],"float32",v)}var M5e={kernelName:N.ResizeBilinearGrad,backendName:"cpu",kernelFunc:P5e};function B5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=n.alignCorners,o=n.halfPixelCenters,s=n.size;je(a,"resizeNearestNeighbor");for(var u=N.util.computeStrides(a.shape),c=Ge(s,2),l=c[0],f=c[1],h=Ge(a.shape,4),p=h[0],d=h[1],m=h[2],v=h[3],g=t.data.get(a.dataId).values,y=new Float32Array(p*l*f*v),w=[i&&l>1?d-1:d,i&&f>1?m-1:m],b=[i&&l>1?l-1:l,i&&f>1?f-1:f],x=w[0]/b[0],S=w[1]/b[1],T=0,E=0;E<p;E++)for(var C=E*u[0],R=0;R<l;R++){var _=o?x*(R+.5):x*R,M=Math.min(d-1,i?Math.round(_):Math.floor(_));o&&(M=Math.max(0,M));for(var $=C+M*u[1],z=0;z<f;z++){var q=o?S*(z+.5):S*z,L=Math.min(m-1,i?Math.round(q):Math.floor(q));o&&(L=Math.max(0,L));for(var U=$+L*u[2],Y=0;Y<v;Y++){var Z=g[U+Y];y[T++]=Z}}}return t.makeTensorInfo([p,l,f,v],a.dtype,y)}var L5e={kernelName:N.ResizeNearestNeighbor,backendName:"cpu",kernelFunc:B5e};function q5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=e.dy,o=n.alignCorners;je([i,a],"resizeNearestNeighborGrad");for(var s=N.util.computeStrides(a.shape),u=N.util.computeStrides(i.shape),c=Ge(a.shape,4),l=c[0],f=c[1],h=c[2],p=c[3],d=Ge(i.shape,3),m=d[1],v=d[2],g=new Float32Array(l*f*h*p),y=t.data.get(i.dataId).values,w=[o&&m>1?f-1:f,o&&v>1?h-1:h],b=[o&&m>1?m-1:m,o&&v>1?v-1:v],x=w[0]/b[0],S=w[1]/b[1],T=1/x,E=1/S,C=Math.ceil(T)*2+2,R=Math.ceil(E)*2+2,_=0;_<l;_++)for(var M=_*s[0],$=0;$<f;$++)for(var z=M+$*s[1],q=Math.floor($*T),L=Math.floor(q-C/2),U=0;U<h;U++)for(var Y=z+U*s[2],Z=Math.floor(U*E),V=Math.floor(Z-R/2),X=0;X<p;X++){for(var ne=0,re=0;re<C;re++){var se=re+L;if(!(se<0||se>=m)){var le=M+se*u[1],de=se*x,ke=Math.min(f-1,o?Math.round(de):Math.floor(de));if($===ke)for(var he=0;he<R;he++){var ye=he+V;if(!(ye<0||ye>=v)){var xe=le+ye*u[2],De=ye*S,Ze=Math.min(h-1,o?Math.round(De):Math.floor(De));U===Ze&&(ne+=y[xe+X])}}}}g[Y+X]=ne}return t.makeTensorInfo(a.shape,a.dtype,g)}var z5e={kernelName:N.ResizeNearestNeighborGrad,backendName:"cpu",kernelFunc:q5e};function $5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.dims;je(a,"reverse");var o=a.shape.length,s=N.util.parseAxisParam(i,a.shape);if(o===0)return no({inputs:{x:a},backend:t});for(var u=new N.TensorBuffer(a.shape,a.dtype),c=t.bufferSync(a),l=function(h){var p=u.indexToLoc(h),d=p.slice();s.forEach(function(m){return d[m]=a.shape[m]-1-d[m]}),u.set.apply(u,Ma([c.get.apply(c,Ma([],Ge(d),!1))],Ge(p),!1))},f=0;f<u.size;f++)l(f);return t.makeTensorInfo(u.shape,u.dtype,u.values)}var W5e={kernelName:N.Reverse,backendName:"cpu",kernelFunc:$5e},U5e={kernelName:N.RotateWithOffset,backendName:"cpu",kernelFunc:function(r){for(var e=r.inputs,t=r.attrs,n=r.backend,a=e.image,i=t.radians,o=t.fillValue,s=t.center,u=n,c=N.util.getTypedArrayFromDType(a.dtype,N.util.sizeFromShape(a.shape)),l=Ge(a.shape,4),f=l[0],h=l[1],p=l[2],d=l[3],m=Ge(N.backend_util.getImageCenter(s,h,p),2),v=m[0],g=m[1],y=255,w=Math.sin(i),b=Math.cos(i),x=u.data.get(a.dataId).values,S=0;S<f;S++)for(var T=S*p*h*d,E=0;E<h;E++)for(var C=E*(p*d),R=0;R<p;R++)for(var _=R*d,M=0;M<d;M++){var $=[f,E,R,M],z=$[2],q=$[1],L=(z-v)*b-(q-g)*w,U=(z-v)*w+(q-g)*b;L=Math.round(L+v),U=Math.round(U+g);var Y=o;if(typeof o!="number"&&(M===3?Y=y:Y=o[M]),L>=0&&L<p&&U>=0&&U<h){var Z=U*(p*d),V=L*d,X=T+Z+V+M;Y=x[X]}var ne=T+C+_+M;c[ne]=Y}var re=u.write(c,a.shape,a.dtype);return{dataId:re,shape:a.shape,dtype:a.dtype}}};var V5e=Ut(N.Round,function(r){var e=Math.floor(r);return r-e<.5?Math.floor(r):r-e>.5?Math.ceil(r):e%2===0?e:e+1}),G5e={kernelName:N.Round,backendName:"cpu",kernelFunc:V5e};function H5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.indices,i=e.updates,o=n.shape,s=N.backend_util.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,f=s.strides,h=s.outputSize,p=!0,d=t.bufferSync(a),m=t.bufferSync(i),v=Ku(d,m,o,h,l,c,u,f,0,p);return t.makeTensorInfo(o,v.dtype,v.values)}var j5e={kernelName:N.ScatterNd,backendName:"cpu",kernelFunc:H5e};function K5e(r,e){for(var t=0,n=r.length,a=0;t<n;)a=Math.floor((t+n)/2),r[a]<e?t=a+1:n=a;return n}function X5e(r,e){for(var t=0,n=r.length,a=0;t<n;)a=Math.floor((t+n)/2),r[a]<=e?t=a+1:n=a;return n}function Y5e(r,e,t,n,a,i){for(var o=N.util.getArrayFromDType("int32",t*a),s=0;s<t;++s)for(var u=r.slice(s*n,(s+1)*n),c=s*a,l=0;l<a;++l)o[c+l]=i==="left"?K5e(u,e[l+c]):X5e(u,e[l+c]);return o}function J5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.sortedSequence,i=e.values,o=n.side,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=Y5e(s,u,a.shape[0],a.shape[1],i.shape[1],o);return t.makeTensorInfo(i.shape,"int32",c)}var Z5e={kernelName:N.SearchSorted,backendName:"cpu",kernelFunc:J5e};function Q5e(r){var e=r.inputs,t=r.backend,n=e.condition,a=e.t,i=e.e;je([n,a,i],"select");for(var o=n.shape.length,s=t.data.get(n.dataId).values,u=t.data.get(a.dataId).values,c=t.data.get(i.dataId).values,l=N.upcastType(a.dtype,i.dtype),f=N.util.makeZerosTypedArray(N.util.sizeFromShape(a.shape),l),h=0,p=o===0||o>1||a.shape.length===1?1:N.util.sizeFromShape(a.shape.slice(1)),d=0;d<s.length;d++)for(var m=0;m<p;m++)s[d]===1?f[h++]=u[d]:f[h++]=c[d];return t.makeTensorInfo(a.shape,l,f)}var eKe={kernelName:N.Select,backendName:"cpu",kernelFunc:Q5e};var tKe=N.backend_util.SELU_SCALEALPHA,rKe=N.backend_util.SELU_SCALE,nKe=Ut(N.Selu,function(r){return r>=0?rKe*r:tKe*(Math.exp(r)-1)}),aKe={kernelName:N.Selu,backendName:"cpu",kernelFunc:nKe};var iKe=Ut(N.Sign,function(r){return r<0?-1:r>0?1:0}),oKe={kernelName:N.Sign,backendName:"cpu",kernelFunc:iKe};var sKe=Ut(N.Sin,function(r){return Math.sin(r)}),uKe={kernelName:N.Sin,backendName:"cpu",kernelFunc:sKe};var cKe=Ut(N.Sinh,function(r){return Math.sinh(r)}),lKe={kernelName:N.Sinh,backendName:"cpu",kernelFunc:cKe};var fKe=11920928955078125e-23,xU=Math.log(fKe)+2,hKe=Ut(N.Softplus,function(r){var e=r>-xU,t=r<xU,n=Math.exp(r),a;return t?a=n:e?a=r:a=Math.log(1+n),a}),pKe={kernelName:N.Softplus,backendName:"cpu",kernelFunc:hKe};function dKe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockShape,o=n.paddings;je([a],"spaceToBatchND");var s=N.util.sizeFromShape(i),u=[[0,0]];u.push.apply(u,Ma([],Ge(o),!1));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=OV.kernelFunc({inputs:{x:a},backend:t,attrs:{paddings:u,constantValue:0}}),f=N.backend_util.getReshaped(l.shape,i,s,!1),h=N.backend_util.getPermuted(f.length,i.length,!1),p=N.backend_util.getReshapedPermuted(l.shape,i,s,!1),d={x:l},m={shape:f},v=Zt({inputs:d,backend:t,attrs:m}),g={x:v},y={perm:h},w=Kn({inputs:g,backend:t,attrs:y}),b={x:w},x={shape:p},S=Zt({inputs:b,backend:t,attrs:x});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(w),S}var vKe={kernelName:N.SpaceToBatchND,backendName:"cpu",kernelFunc:dKe};function mKe(r){var e=r.inputs,t=r.backend,n=e.indices,a=e.values,i=e.denseShape,o=e.defaultValue;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        `.concat(i.shape));if(n.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        `.concat(n.shape));if(a.shape.length!==1)throw new Error(`Values must be a vector, saw:
        `.concat(a.shape));if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        `.concat(o.shape));var s=t.data.get(n.dataId).values,u=t.data.get(a.dataId).values,c=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values[0],f=Ge(oV(s,n.shape,n.dtype,u,a.dtype,c,l),5),h=f[0],p=f[1],d=f[2],m=f[3],v=f[4];return[t.makeTensorInfo(p,n.dtype,h),t.makeTensorInfo([p[0]],a.dtype,d),t.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(function(g){return Number(g)}))),t.makeTensorInfo([v.length],n.dtype,new Int32Array(v))]}var gKe={kernelName:N.SparseFillEmptyRows,backendName:"cpu",kernelFunc:mKe};function yKe(r){var e=r.inputs,t=r.backend,n=e.inputIndices,a=e.inputShape,i=e.newShape;if(n.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        `.concat(n.shape));if(a.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        `.concat(a.shape));if(i.shape.length!==1)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(t.data.get(a.dataId).values),s=t.data.get(n.dataId).values,u=Array.from(t.data.get(i.dataId).values),c=Ge(sV(s,n.shape,n.dtype,o,u),3),l=c[0],f=c[1],h=c[2];return[t.makeTensorInfo(f,n.dtype,l),t.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}var bKe={kernelName:N.SparseReshape,backendName:"cpu",kernelFunc:yKe};function wKe(r){var e=r.inputs,t=r.backend,n=e.data,a=e.indices,i=e.segmentIds;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          `.concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=t.data.get(n.dataId).values,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=Ge(D2(o,n.shape,n.dtype,s,u,!0),2),l=c[0],f=c[1];return t.makeTensorInfo(f,n.dtype,l)}var xKe={kernelName:N.SparseSegmentMean,backendName:"cpu",kernelFunc:wKe};function kKe(r){var e=r.inputs,t=r.backend,n=e.data,a=e.indices,i=e.segmentIds;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         `.concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=t.data.get(n.dataId).values,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=Ge(D2(o,n.shape,n.dtype,s,u),2),l=c[0],f=c[1];return t.makeTensorInfo(f,n.dtype,l)}var SKe={kernelName:N.SparseSegmentSum,backendName:"cpu",kernelFunc:kKe};function NKe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.sparseIndices,i=e.sparseValues,o=e.defaultValue,s=n.outputShape,u=N.backend_util.calculateShapes(i,a,s),c=u.sliceRank,l=u.numUpdates,f=u.sliceSize,h=u.strides,p=u.outputSize,d=!1,m=t.bufferSync(a),v;switch(i.dtype){case"bool":{var g=t.bufferSync(i),y=Boolean(t.data.get(o.dataId).values[0]);v=Ku(m,g,s,p,f,l,c,h,y,d);break}case"float32":{var g=t.bufferSync(i),y=t.data.get(o.dataId).values[0];v=Ku(m,g,s,p,f,l,c,h,y,d);break}case"int32":{var g=t.bufferSync(i),y=t.data.get(o.dataId).values[0];v=Ku(m,g,s,p,f,l,c,h,y,d);break}case"string":{var g=t.bufferSync(i),y=N.util.decodeString(t.data.get(o.dataId).values[0]);v=Ku(m,g,s,p,f,l,c,h,y,d);break}default:throw new Error("Unsupported type ".concat(i.dtype))}return t.makeTensorInfo(s,v.dtype,v.values)}var TKe={kernelName:N.SparseToDense,backendName:"cpu",kernelFunc:NKe};function EKe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.numOrSizeSplits,o=n.axis,s=N.util.parseAxisParam(o,a.shape)[0],u=N.backend_util.prepareSplitSize(a,i,s),c=new Array(a.shape.length).fill(0),l=a.shape.slice();return u.map(function(f){var h=Ma([],Ge(l),!1);h[s]=f;var p=Yu({inputs:{x:a},backend:t,attrs:{begin:c,size:h}});return c[s]+=f,p})}var IKe={kernelName:N.SplitV,backendName:"cpu",kernelFunc:EKe};var CKe={kernelName:N.Square,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e.x,a=t;je(n,"square");for(var i=a.data.get(n.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}var c=a.write(o,n.shape,n.dtype);return{dataId:c,shape:n.shape,dtype:n.dtype}}};var AKe=Ut(N.Step,function(r,e){var t=e;return isNaN(r)?NaN:r>0?1:t.alpha}),DKe={kernelName:N.Step,backendName:"cpu",kernelFunc:AKe};function _Ke(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.begin,o=n.end,s=n.strides,u=n.beginMask,c=n.endMask,l=n.ellipsisMask,f=n.newAxisMask,h=n.shrinkAxisMask;je(a,"stridedSlice");var p=N.slice_util.sliceInfo(a.shape,i,o,s,u,c,l,f,h),d=p.finalShapeSparse,m=p.finalShape,v=p.isIdentity,g=p.sliceDim0,y=p.isSimpleSlice,w=p.begin,b=p.end,x=p.strides,S;if(v)S=Zt({inputs:{x:a},backend:t,attrs:{shape:m}});else if(g||y){N.util.assert(a.shape.length>=1,function(){return"Input must have rank at least 1, got: ".concat(a.shape.length)});var T=N.slice_util.computeOutShape(w,b,x),E=Yu({inputs:{x:a},backend:t,attrs:{begin:w,size:T}});S=Zt({inputs:{x:E},backend:t,attrs:{shape:m}}),t.disposeIntermediateTensorInfo(E)}else{var C=t.bufferSync(a),R=lV(d,C,x,w);S=t.makeTensorInfo(m,R.dtype,R.values)}return S}var FKe={kernelName:N.StridedSlice,backendName:"cpu",kernelFunc:_Ke};function RKe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.separator,i=n.nGramWidths,o=n.leftPad,s=n.rightPad,u=n.padWidth,c=n.preserveShortSequences,l=e.data,f=e.dataSplits,h=t.data.get(l.dataId).values,p=t.data.get(f.dataId).values,d=Ge(fV(h,p,a,i,o,s,u,c),2),m=d[0],v=d[1];return[t.makeTensorInfo([m.length],"string",m),t.makeTensorInfo(f.shape,"int32",v)]}var OKe={kernelName:N.StringNGrams,backendName:"cpu",kernelFunc:RKe};function PKe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.skipEmpty,i=e.input,o=e.delimiter;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error("Input must be a vector, got shape: ".concat(i.shape));if(o.shape.length!==0)throw new Error("Delimiter must be a scalar, got shape: ".concat(o.shape));var s=t.data.get(i.dataId).values,u=t.data.get(o.dataId).values[0],c=Ge(hV(s,u,a),3),l=c[0],f=c[1],h=c[2],p=f.length;return[t.makeTensorInfo([p,2],"int32",l),t.makeTensorInfo([p],"string",f),t.makeTensorInfo([2],"int32",new Int32Array(h))]}var MKe={kernelName:N.StringSplit,backendName:"cpu",kernelFunc:PKe};function BKe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.numBuckets,i=e.input;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");var o=t.data.get(i.dataId).values,s=pV(o,a);return t.makeTensorInfo(i.shape,"int32",s)}var LKe={kernelName:N.StringToHashBucketFast,backendName:"cpu",kernelFunc:BKe};var qKe=Ut(N.Tan,function(r){return Math.tan(r)}),zKe={kernelName:N.Tan,backendName:"cpu",kernelFunc:qKe};var $Ke=Ut(N.Tanh,function(r){return Math.tanh(r)}),WKe={kernelName:N.Tanh,backendName:"cpu",kernelFunc:$Ke};function UKe(r){var e=r.inputs,t=r.backend,n=e.tensor,a=e.indices,i=e.updates,o=N.backend_util.calculateShapes(i,a,n.shape),s=o.sliceRank,u=o.numUpdates,c=o.sliceSize,l=o.strides,f=o.outputSize,h=!1,p=t.bufferSync(a),d=t.bufferSync(i),m=t.bufferSync(n),v=Ku(p,d,n.shape,f,c,u,s,l,m,h);return t.makeTensorInfo(n.shape,v.dtype,v.values)}var VKe={kernelName:N.TensorScatterUpdate,backendName:"cpu",kernelFunc:UKe};function GKe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.reps;je(a,"tile");var o=vV(t.bufferSync(a),i);return t.makeTensorInfo(o.shape,o.dtype,o.values)}var HKe={kernelName:N.Tile,backendName:"cpu",kernelFunc:GKe};function jKe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.k,o=n.sorted;je(a,"topk");var s=t.data.get(a.dataId).values,u=Ge(gV(s,a.shape,a.dtype,i,o),2),c=u[0],l=u[1];return[t.makeTensorInfo(c.shape,c.dtype,c.values),t.makeTensorInfo(l.shape,l.dtype,l.values)]}var KKe={kernelName:N.TopK,backendName:"cpu",kernelFunc:jKe};function XKe(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.image,i=e.transforms,o=t.interpolation,s=t.fillMode,u=t.fillValue,c=t.outputShape,l=Ge(a.shape,4),f=l[0],h=l[1],p=l[2],d=l[3],m=Ge(c??[h,p],2),v=m[0],g=m[1],y=[f,v,g,d],w=N.util.computeStrides(a.shape),b=w[0],x=w[1],S=w[2],T=N.util.computeStrides(y),E=T[0],C=T[1],R=T[2],_=N.util.getTypedArrayFromDType(a.dtype,N.util.sizeFromShape(y));_.fill(u);for(var M=n.data.get(a.dataId).values,$=n.data.get(i.dataId).values,z=0;z<f;++z){for(var q=i.shape[0]===1?$:$.subarray(z*8,z*8+8),L=0;L<v;++L)for(var U=0;U<g;++U)for(var Y=0;Y<d;++Y){var Z=void 0,V=q[6]*U+q[7]*L+1;if(V!==0){var X=(q[0]*U+q[1]*L+q[2])/V,ne=(q[3]*U+q[4]*L+q[5])/V,re=kU(X,p,s),se=kU(ne,h,s);switch(o){case"nearest":Z=t8e(M,h,p,b,x,S,z,se,re,Y,u);break;case"bilinear":Z=r8e(M,h,p,b,x,S,z,se,re,Y,u);break;default:throw new Error("Error in Transform: Expect 'nearest' or "+"'bilinear', but got ".concat(o))}var le=z*E+L*C+U*R+Y;_[le]=Z}}return n.makeTensorInfo(y,a.dtype,_)}var de=n.write(_,y,a.dtype);return{dataId:de,shape:a.shape,dtype:a.dtype}}var YKe={kernelName:N.Transform,backendName:"cpu",kernelFunc:XKe};function kU(r,e,t){switch(t){case"reflect":return JKe(r,e);case"wrap":return ZKe(r,e);case"nearest":return e8e(r,e);case"constant":default:return QKe(r)}}function JKe(r,e){var t=r;if(t<0)if(e<=1)t=0;else{var n=2*e;t<n&&(t=n*Math.trunc(-t/n)+t),t=t<-e?t+n:-t-1}else if(t>e-1)if(e<=1)t=0;else{var n=2*e;t-=n*Math.trunc(t/n),t>=e&&(t=n-t-1)}return N.util.clamp(0,t,e-1)}function ZKe(r,e){var t=r;if(t<0)if(e<=1)t=0;else{var n=e-1;t+=e*(Math.trunc(-t/n)+1)}else if(t>e-1)if(e<=1)t=0;else{var n=e-1;t-=e*Math.trunc(t/n)}return N.util.clamp(0,t,e-1)}function QKe(r,e){return r}function e8e(r,e){return N.util.clamp(0,r,e-1)}function np(r,e,t,n,a,i,o,s,u,c,l){var f=o*n+s*a+u*i+c;return 0<=s&&s<e&&0<=u&&u<t?r[f]:l}function t8e(r,e,t,n,a,i,o,s,u,c,l){var f=Math.round(s),h=Math.round(u);return np(r,e,t,n,a,i,o,f,h,c,l)}function r8e(r,e,t,n,a,i,o,s,u,c,l){var f=Math.floor(s),h=Math.floor(u),p=f+1,d=h+1,m=(d-u)*np(r,e,t,n,a,i,o,f,h,c,l)+(u-h)*np(r,e,t,n,a,i,o,f,d,c,l),v=(d-u)*np(r,e,t,n,a,i,o,p,h,c,l)+(u-h)*np(r,e,t,n,a,i,o,p,d,c,l);return(p-s)*m+(s-f)*v}function n8e(r){var e=r.inputs,t=r.attrs,n=r.backend,a=t.axis,i=e.x;je(i,"unique");var o=n.data.get(i.dataId).values,s=yV(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[n.makeTensorInfo(c,i.dtype,u),n.makeTensorInfo([l.length],"int32",l)]}var a8e={kernelName:N.Unique,backendName:"cpu",kernelFunc:n8e};function i8e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.value,i=n.axis;i<0&&(i+=a.shape.length);for(var o=a.shape.length,s=a.shape[i],u=new Array(o-1),c=0,l=0;l<o;l++)l!==i&&(u[c++]=a.shape[l]);var f=new Array(o).fill(0),h=a.shape.slice();h[i]=1;for(var p=new Array(s),l=0;l<p.length;l++){f[i]=l;var d=Yu({inputs:{x:a},backend:t,attrs:{begin:f,size:h}});p[l]=Zt({inputs:{x:d},backend:t,attrs:{shape:u}}),t.disposeIntermediateTensorInfo(d)}return p}var o8e={kernelName:N.Unpack,backendName:"cpu",kernelFunc:i8e};function s8e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.segmentIds,o=n.numSegments;je(a,"unsortedSegmentSum");for(var s=a.shape.length,u=i.shape.length,c=[],l=[],f=s-u,h=i,p=0;p<f;++p){var d=vg({inputs:{input:h},backend:t,attrs:{dim:p+1}});h=d,l.push(d)}for(var p=0;p<o;++p){var m=N.util.createScalarValue(p,"int32"),v=t.makeTensorInfo([],"int32",m),g=RU({inputs:{a:v,b:h},backend:t}),y=_s({inputs:{x:g},backend:t,attrs:{dtype:"float32"}}),w=gg({inputs:{a:y,b:a},backend:t}),b=ap({inputs:{x:w},backend:t,attrs:{axis:0,keepDims:!1}});c.push(b),l.push(v),l.push(g),l.push(y),l.push(w),l.push(b)}var x=RV({inputs:c,backend:t,attrs:{axis:0}});return l.forEach(function(S){return t.disposeIntermediateTensorInfo(S)}),x}var u8e={kernelName:N.UnsortedSegmentSum,backendName:"cpu",kernelFunc:s8e},x2,SU,c8e=[n6e,PVe,i6e,s6e,$Ve,c6e,f6e,p6e,v6e,g6e,b6e,x6e,S6e,E6e,C6e,_6e,R6e,P6e,B6e,t6e,q6e,$6e,U6e,UVe,G6e,qVe,GVe,j6e,MVe,X6e,J6e,Z6e,eHe,rHe,aHe,oHe,uHe,lHe,hHe,dHe,mHe,yHe,wHe,kHe,SHe,THe,IHe,AHe,DHe,_He,FHe,OHe,BHe,KGe,qHe,HVe,jHe,jVe,KHe,XVe,eje,tje,nje,JVe,QVe,ije,sje,cje,fje,tGe,nGe,BVe,pje,Y6e,vje,gje,bje,XGe,iGe,sGe,xje,cGe,Sje,Eje,Cje,_je,Rje,Pje,Mje,fGe,Lje,zje,Wje,Vje,Hje,Kje,Yje,pGe,Zje,t5e,a5e,vGe,gGe,s5e,l5e,p5e,bGe,v5e,g5e,y5e,OV,k5e,JGe,kGe,N5e,E5e,C5e,D5e,LVe,S2,F5e,ZGe,QGe,e6e,O5e,M5e,L5e,z5e,W5e,U5e,G5e,_Ge,j5e,Z5e,eKe,aKe,RGe,oKe,uKe,lKe,OGe,r5e,pKe,vKe,gKe,bKe,xKe,SKe,TKe,IKe,BGe,CKe,qGe,$Ge,DKe,FKe,OKe,MKe,LKe,GGe,PHe,zKe,WKe,VKe,HKe,KKe,YKe,wGe,a8e,o8e,u8e,m5e];try{for(tp=wl(c8e),bl=tp.next();!bl.done;bl=tp.next())NU=bl.value,N.registerKernel(NU)}catch(r){x2={error:r}}finally{try{bl&&!bl.done&&(SU=tp.return)&&SU.call(tp)}finally{if(x2)throw x2.error}}var NU,tp,bl;yg.MathBackendCPU=T2;yg.shared=HGe;yg.version_cpu=jGe});var $6=O(Po=>{"use strict";var k=mu();function l8e(r){var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var f8e=l8e(k),B2=function(r,e){return B2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},B2(r,e)};function h8e(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");B2(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function El(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(f){o(f)}}function u(l){try{c(n.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((n=n.apply(r,e||[])).next())})}function Il(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Pn(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Te(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function Sr(r,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}var Zu={},bg={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function hG(r,e){Zu[r]=e}function Wi(r,e){if(!(r in Zu)||e!=null){var t=d8e(r,e);if(t!==null)Zu[r]=t;else return console.log("Could not get context for WebGL version",r),null}var n=Zu[r];return n==null||n.isContextLost()?(delete Zu[r],Wi(r)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),Zu[r])}function p8e(r){if(!k.env().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&r===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function d8e(r,e){if(r!==1&&r!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=e??p8e(r);return t.addEventListener("webglcontextlost",function(n){n.preventDefault(),delete Zu[r]},!1),k.env().getBool("SOFTWARE_WEBGL_ENABLED")&&(bg.failIfMajorPerformanceCaveat=!1),r===1?t.getContext("webgl",bg)||t.getContext("experimental-webgl",bg):t.getContext("webgl2",bg)}var fp;(function(r){r[r.DENSE=0]="DENSE",r[r.SHARED_BATCH=1]="SHARED_BATCH"})(fp||(fp={}));var Ba;(function(r){r[r.RENDER=0]="RENDER",r[r.UPLOAD=1]="UPLOAD",r[r.PIXELS=2]="PIXELS",r[r.DOWNLOAD=3]="DOWNLOAD"})(Ba||(Ba={}));var wn;(function(r){r[r.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",r[r.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",r[r.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",r[r.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",r[r.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(wn||(wn={}));function mp(r,e){return[e,r]}function v8e(r,e){return r*e}function wg(r){var e=k.util.sizeFromShape(r),t=Math.ceil(e/4);return k.util.sizeToSquarishShape(t)}function Cl(r,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(r/2))]}function m8e(r,e){var t=Te(Cl(r,e),2),n=t[0],a=t[1];return n*a*4}function G2(r,e){var t=r,n,a,i,o,s,u,c,l,f,h;return k.env().getNumber("WEBGL_VERSION")===2?(n=t.R32F,a=t.R16F,i=t.RGBA16F,o=t.RGBA32F,s=t.RED,c=4,l=1,f=t.HALF_FLOAT,h=t.FLOAT,u=t.RGBA8):(n=r.RGBA,a=r.RGBA,i=r.RGBA,o=t.RGBA,s=r.RGBA,c=4,l=4,f=e!=null?e.HALF_FLOAT_OES:null,h=r.FLOAT,u=r.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:a,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:s,downloadTextureFormat:u,downloadUnpackNumChannels:c,defaultNumChannels:l,textureTypeHalfFloat:f,textureTypeFloat:h}}function Pe(r,e){var t=e();return k.env().getBool("DEBUG")&&g8e(r),t}function g8e(r){var e=r.getError();if(e!==r.NO_ERROR)throw new Error("WebGL Error: "+dG(r,e))}var y8e=596e-10,b8e=65504;function pG(r){return!!(k.env().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||r===0||y8e<Math.abs(r)&&Math.abs(r)<b8e)}function dG(r,e){switch(e){case r.NO_ERROR:return"NO_ERROR";case r.INVALID_ENUM:return"INVALID_ENUM";case r.INVALID_VALUE:return"INVALID_VALUE";case r.INVALID_OPERATION:return"INVALID_OPERATION";case r.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case r.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case r.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(e)}}function op(r,e){return Ro(r,function(){return r.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function vG(r,e){var t=Ro(r,function(){return r.createShader(r.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Pe(r,function(){return r.shaderSource(t,e)}),Pe(r,function(){return r.compileShader(t)}),r.getShaderParameter(t,r.COMPILE_STATUS)===!1)throw console.log(r.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function mG(r,e){var t=Ro(r,function(){return r.createShader(r.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Pe(r,function(){return r.shaderSource(t,e)}),Pe(r,function(){return r.compileShader(t)}),k.env().get("ENGINE_COMPILE_ONLY"))return t;if(r.getShaderParameter(t,r.COMPILE_STATUS)===!1)throw H2(e,r.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}var w8e=/ERROR: [0-9]+:([0-9]+):/g;function H2(r,e){var t=w8e.exec(e);if(t==null){console.log("Couldn't parse line number in error: ".concat(e)),console.log(r);return}for(var n=+t[1],a=r.split(`
`),i=a.length.toString().length+2,o=a.map(function(h,p){return k.util.rightPad((p+1).toString(),i)+h}),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var c=o.slice(0,n-1),l=o.slice(n-1,n),f=o.slice(n);console.log(c.join(`
`)),console.log(e.split(`
`)[0]),console.log("%c ".concat(k.util.rightPad(l[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join(`
`))}function gG(r){return Ro(r,function(){return r.createProgram()},"Unable to create WebGLProgram.")}function yG(r,e){if(Pe(r,function(){return r.linkProgram(e)}),!k.env().get("ENGINE_COMPILE_ONLY")&&r.getProgramParameter(e,r.LINK_STATUS)===!1)throw console.log(r.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Ng(r,e){if(Pe(r,function(){return r.validateProgram(e)}),r.getProgramParameter(e,r.VALIDATE_STATUS)===!1)throw console.log(r.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function bG(r,e){var t=Ro(r,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return Pe(r,function(){return r.bindBuffer(r.ARRAY_BUFFER,t)}),Pe(r,function(){return r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW)}),t}function wG(r,e){var t=Ro(r,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return Pe(r,function(){return r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t)}),Pe(r,function(){return r.bufferData(r.ELEMENT_ARRAY_BUFFER,e,r.STATIC_DRAW)}),t}function x8e(){return k.env().getNumber("WEBGL_VERSION")===2?1:4}function xG(r){return Ro(r,function(){return r.createTexture()},"Unable to create WebGLTexture.")}function kG(r,e){var t=k.env().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(r<=0||e<=0){var n="[".concat(r,"x").concat(e,"]");throw new Error("Requested texture size "+n+" is invalid.")}if(r>t||e>t){var n="[".concat(r,"x").concat(e,"]"),a="[".concat(t,"x").concat(t,"]");throw new Error("Requested texture size "+n+" greater than WebGL maximum on this browser / GPU "+a+".")}}function SG(r){return Ro(r,function(){return r.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function L2(r,e,t,n,a,i,o){var s=r.getAttribLocation(e,t);return s===-1?!1:(Pe(r,function(){return r.bindBuffer(r.ARRAY_BUFFER,n)}),Pe(r,function(){return r.vertexAttribPointer(s,a,r.FLOAT,!1,i,o)}),Pe(r,function(){return r.enableVertexAttribArray(s)}),!0)}function NG(r,e,t){AG(r,t),Pe(r,function(){return r.activeTexture(r.TEXTURE0+t)}),Pe(r,function(){return r.bindTexture(r.TEXTURE_2D,e)})}function k8e(r,e){AG(r,e),Pe(r,function(){return r.activeTexture(r.TEXTURE0+e)}),Pe(r,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function TG(r,e,t){return Ro(r,function(){return r.getUniformLocation(e,t)},'uniform "'+t+'" not present in program.')}function EG(r,e,t){return r.getUniformLocation(e,t)}function IG(r,e,t,n){Pe(r,function(){return NG(r,e,n)}),Pe(r,function(){return r.uniform1i(t,n)})}function S8e(r){Pe(r,function(){return r.bindFramebuffer(r.FRAMEBUFFER,null)}),Pe(r,function(){return r.viewport(0,0,r.canvas.width,r.canvas.height)}),Pe(r,function(){return r.scissor(0,0,r.canvas.width,r.canvas.height)})}function Tg(r,e,t){Pe(r,function(){return r.bindFramebuffer(r.FRAMEBUFFER,t)}),Pe(r,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0)})}function q2(r,e){Pe(r,function(){return r.bindFramebuffer(r.FRAMEBUFFER,e)}),Pe(r,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0)})}function sp(r){var e=r.checkFramebufferStatus(r.FRAMEBUFFER);if(e!==r.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+CG(r,e))}function CG(r,e){switch(e){case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case r.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(e)}}function Ro(r,e,t){var n=Pe(r,function(){return e()});if(n==null)throw new Error(t);return n}function AG(r,e){var t=r.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=e+r.TEXTURE0;if(n<r.TEXTURE0||n>t){var a="[gl.TEXTURE0, gl.TEXTURE".concat(t,"]");throw new Error("textureUnit must be in ".concat(a,"."))}}function Qu(r,e){return e===void 0&&(e=2),k.util.sizeFromShape(r.slice(0,r.length-e))}function ec(r){if(r.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[r.length>1?r[r.length-2]:1,r[r.length-1]]}function up(r){var e=[1,1,1],t=r.length===0||r.length===1&&r[0]===1;return t||(e=Sr([Qu(r)],Te(ec(r)),!1)),e}function DG(r,e){var t;e===void 0&&(e=!1);var n=k.env().getNumber("WEBGL_MAX_TEXTURE_SIZE"),a=k.env().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");if(a===1/0&&k.env().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(a=n/2),e&&(n=n*2,a=a*2,r=r.map(function(h,p){return p>=r.length-2?k.util.nearestLargerEven(r[p]):r[p]}),r.length===1&&(r=[2,r[0]])),r.length!==2){var i=k.util.squeezeShape(r);r=i.newShape}var o=k.util.sizeFromShape(r),s=null;r.length<=1&&o<=n?s=[1,o]:r.length===2&&r[0]<=n&&r[1]<=n?s=r:r.length===3&&r[0]*r[1]<=n&&r[2]<=n?s=[r[0]*r[1],r[2]]:r.length===3&&r[0]<=n&&r[1]*r[2]<=n?s=[r[0],r[1]*r[2]]:r.length===4&&r[0]*r[1]*r[2]<=n&&r[3]<=n?s=[r[0]*r[1]*r[2],r[3]]:r.length===4&&r[0]<=n&&r[1]*r[2]*r[3]<=n&&(s=[r[0],r[1]*r[2]*r[3]]);var u=s!=null&&Math.max.apply(Math,Sr([],Te(s),!1))>a&&Math.min.apply(Math,Sr([],Te(s),!1))<=(e?2:1)&&Math.min.apply(Math,Sr([],Te(s),!1))>0;if(s==null||u)if(e){var c=Qu(r),l=2,f=2;r.length&&(t=Te(ec(r),2),l=t[0],f=t[1]),o=c*(l/2)*(f/2),s=k.util.sizeToSquarishShape(o).map(function(h){return h*2})}else s=k.util.sizeToSquarishShape(o);return s}function xg(r){return r%2===0}function hp(r,e){if(r=r.slice(-2),e=e.slice(-2),k.util.arraysEqual(r,e)||!r.length||!e.length||r[0]===0||r[1]===0||e[0]===0||e[1]===0)return!0;if(r.length!==e.length){var t=r[r.length-1],n=e[e.length-1];if(t===n||xg(t)&&xg(n)&&(r[0]===1||e[0]===1))return!0}return r[1]===e[1]&&xg(r[0])&&xg(e[0])}var Eg,Ig;function _G(r){if(Eg==null){var e=Wi(r);Eg=e.getParameter(e.MAX_TEXTURE_SIZE)}return Eg}function N8e(){Eg=null}function T8e(){Ig=null}function FG(r){if(Ig==null){var e=Wi(r);Ig=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Ig)}function RG(r){if(r===0)return 0;var e,t=Wi(r);return La(t,"EXT_disjoint_timer_query_webgl2")&&r===2?e=2:La(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function La(r,e){var t=r.getExtension(e);return t!=null}function z2(r){try{var e=Wi(r);if(e!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function OG(r){if(r===0)return!1;var e=Wi(r);if(r===1){if(!La(e,"OES_texture_float"))return!1}else if(!La(e,"EXT_color_buffer_float"))return!1;var t=$2(e);return t}function PG(r){if(r===0)return!1;var e=Wi(r);if(r===1){if(!La(e,"OES_texture_float")||!La(e,"WEBGL_color_buffer_float"))return!1}else{if(La(e,"EXT_color_buffer_float"))return $2(e);var t="EXT_color_buffer_half_float";if(La(e,t)){var n=e.getExtension(t);return E8e(e,n)}return!1}var a=$2(e);return a}function $2(r){var e=G2(r),t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t);var n=1,a=1;r.texImage2D(r.TEXTURE_2D,0,e.internalFormatFloat,n,a,0,e.textureFormatFloat,e.textureTypeFloat,null);var i=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,i),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0);var o=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(t),r.deleteFramebuffer(i),o}function E8e(r,e){var t=G2(r,e),n=r.createTexture();r.bindTexture(r.TEXTURE_2D,n);var a=1,i=1;r.texImage2D(r.TEXTURE_2D,0,t.internalFormatHalfFloat,a,i,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);var o=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,o),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,n,0);var s=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(n),r.deleteFramebuffer(o),s}function MG(r){if(r!==2)return!1;var e=Wi(r),t=e.fenceSync!=null;return t}function Al(r,e){Array.isArray(r)||(r=[r]),r.forEach(function(t){t!=null&&k.util.assert(t.dtype!=="complex64",function(){return"".concat(e," does not support complex64 tensors ")+"in the WebGL backend."})})}var I8e={__proto__:null,assertNotComplex:Al,bindCanvasToFramebuffer:S8e,bindColorTextureToFramebuffer:Tg,bindTextureToProgramUniformSampler:IG,bindTextureUnit:NG,bindVertexBufferToProgramAttribute:L2,callAndCheck:Pe,canBeRepresented:pG,createFragmentShader:mG,createFramebuffer:SG,createProgram:gG,createStaticIndexBuffer:wG,createStaticVertexBuffer:bG,createTexture:xG,createVertexShader:vG,getBatchDim:Qu,getExtensionOrThrow:op,getFramebufferErrorMessage:CG,getMaxTexturesInShader:FG,getNumChannels:x8e,getProgramUniformLocation:EG,getProgramUniformLocationOrThrow:TG,getRowsCols:ec,getShapeAs3D:up,getTextureShapeFromLogicalShape:DG,getWebGLDisjointQueryTimerVersion:RG,getWebGLErrorMessage:dG,getWebGLMaxTextureSize:_G,hasExtension:La,isCapableOfRenderingToFloatTexture:OG,isDownloadFloatTextureEnabled:PG,isReshapeFree:hp,isWebGLFenceEnabled:MG,isWebGLVersionEnabled:z2,linkProgram:yG,logShaderSourceAndInfoLog:H2,resetMaxTextureSize:N8e,resetMaxTexturesInShader:T8e,unbindColorTextureFromFramebuffer:q2,unbindTextureUnit:k8e,validateFramebuffer:sp,validateProgram:Ng,validateTextureSize:kG};var Xe=k.env();Xe.registerFlag("HAS_WEBGL",function(){return Xe.getNumber("WEBGL_VERSION")>0});Xe.registerFlag("WEBGL_VERSION",function(){return z2(2)?2:z2(1)?1:0});Xe.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",function(){return!1});Xe.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return Xe.get("WEBGL_VERSION")===2});Xe.registerFlag("WEBGL_CPU_FORWARD",function(){return!0});Xe.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1});Xe.registerFlag("WEBGL_PACK",function(){return Xe.getBool("HAS_WEBGL")});Xe.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return Xe.getBool("WEBGL_PACK")});Xe.registerFlag("WEBGL_PACK_CLIP",function(){return Xe.getBool("WEBGL_PACK")});Xe.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return Xe.getBool("WEBGL_PACK")});Xe.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return Xe.getBool("WEBGL_PACK")});Xe.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return Xe.getBool("WEBGL_PACK")});Xe.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return Xe.getBool("WEBGL_PACK")});Xe.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return Xe.getBool("WEBGL_PACK")});Xe.registerFlag("WEBGL_PACK_REDUCE",function(){return Xe.getBool("WEBGL_PACK")});Xe.registerFlag("WEBGL_LAZILY_UNPACK",function(){return Xe.getBool("WEBGL_PACK")});Xe.registerFlag("WEBGL_CONV_IM2COL",function(){return Xe.getBool("WEBGL_PACK")});Xe.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",function(){return Xe.getBool("WEBGL_PACK")});Xe.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return _G(Xe.getNumber("WEBGL_VERSION"))});Xe.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return FG(Xe.getNumber("WEBGL_VERSION"))});Xe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var r=Xe.getNumber("WEBGL_VERSION");return r===0?0:RG(r)});Xe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return Xe.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!k.device_util.isMobile()});Xe.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return OG(Xe.getNumber("WEBGL_VERSION"))});Xe.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return Xe.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Xe.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")});Xe.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return PG(Xe.getNumber("WEBGL_VERSION"))});Xe.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return MG(Xe.getNumber("WEBGL_VERSION"))});Xe.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){var r=Xe.getBool("WEBGL_RENDER_FLOAT32_ENABLED");return r?4:0});Xe.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",function(){return-1},function(r){if(typeof r!="number")throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but "+"got ".concat(r,"."));if(r<0&&r!==-1)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never "+"delete) or at least 0, but got ".concat(r,"."))});Xe.registerFlag("WEBGL_FLUSH_THRESHOLD",function(){return k.device_util.isMobile()?1:-1},function(r){if(typeof r!="number")throw new Error("WEBGL_FLUSH_THRESHOLD must be a number but got "+"".concat(r,"."));if(r<0&&r!==-1)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never "+"manual flush) or at least 0, but got ".concat(r,"."))});Xe.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",function(){return 128});Xe.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",function(){return!1});Xe.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",function(){return 1e5});Xe.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",function(){return 128});Xe.registerFlag("WEBGL_EXP_CONV",function(){return!1});Xe.registerFlag("SOFTWARE_WEBGL_ENABLED",function(){return Xe.getBool("IS_TEST")});Xe.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",function(){return 1/0});Xe.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",function(){return!1});Xe.registerFlag("WEBGL2_ISNAN_CUSTOM",function(){return!1});Xe.registerFlag("ENGINE_COMPILE_ONLY",function(){return!1});function Bn(){var r,e,t,n,a,i,o,s,u,c;return k.env().getNumber("WEBGL_VERSION")===2?(r="#version 300 es",e="in",t="out",n="in",a="texture",i="outputColor",o="out vec4 outputColor;",s=k.env().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",u="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(r="",e="attribute",t="varying",n="varying",a="texture2D",i="gl_FragColor",o="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:r,attribute:e,varyingVs:t,varyingFs:n,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function rc(r,e,t){t===void 0&&(t="index");var n=k.util.computeStrides(e);return n.map(function(a,i){var o="int ".concat(r[i]," = ").concat(t," / ").concat(a),s=i===n.length-1?"int ".concat(r[i+1]," = ").concat(t," - ").concat(r[i]," * ").concat(a):"index -= ".concat(r[i]," * ").concat(a);return"".concat(o,"; ").concat(s,";")}).join("")}function Rg(r,e,t){t===void 0&&(t="index");var n=k.util.computeStrides(e);return n.map(function(a,i){var o="int ".concat(r[i]," = ").concat(t," / outShapeStrides[").concat(i,"]"),s=i===n.length-1?"int ".concat(r[i+1]," = ").concat(t," - ").concat(r[i]," * outShapeStrides[").concat(i,"]"):"index -= ".concat(r[i]," * outShapeStrides[").concat(i,"]");return"".concat(o,"; ").concat(s,";")}).join("")}function C8e(r,e){var t=r.length,n=r.map(function(o){return"".concat(e,"[").concat(o,"]")}),a=new Array(t-1);a[t-2]=n[t-1];for(var i=t-3;i>=0;--i)a[i]="(".concat(a[i+1]," * ").concat(n[i+1],")");return a}function A8e(r,e,t){t===void 0&&(t="index");var n=r.map(function(i,o){return o}),a=C8e(n,e);return a.map(function(i,o){var s="int ".concat(r[o]," = ").concat(t," / ").concat(a[o]),u=o===a.length-1?"int ".concat(r[o+1]," = ").concat(t," - ").concat(r[o]," * ").concat(a[o]):"index -= ".concat(r[o]," * ").concat(a[o]);return"".concat(s,"; ").concat(u,";")}).join("")}function j2(r){var e=k.util.computeStrides(r).map(function(t){return t.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `.concat(e[0]," + coords.y * ").concat(e[1],` + coords.z;
  }
`)}function K2(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}var BG=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`,LG=k.backend_util.getBroadcastDims;function D8e(r,e,t){var n=[];if(r.forEach(function(p){var d=k.util.sizeFromShape(p.shapeInfo.logicalShape);if(p.shapeInfo.isUniform?n.push("uniform float ".concat(p.name).concat(d>1?"[".concat(d,"]"):"",";")):(n.push("uniform sampler2D ".concat(p.name,";")),n.push("uniform int offset".concat(p.name,";"))),t.enableShapeUniforms){var m=X2(t.packedInputs,p.shapeInfo.logicalShape,p.shapeInfo.texShape).uniformShape;switch(m.length){case 1:n.push("uniform int ".concat(p.name,"Shape;"));break;case 2:n.push("uniform ivec2 ".concat(p.name,"Shape;"));break;case 3:n.push("uniform ivec3 ".concat(p.name,"Shape;"));break;case 4:n.push("uniform ivec4 ".concat(p.name,"Shape;"));break}n.push("uniform ivec2 ".concat(p.name,"TexShape;"))}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:n.push("uniform int outShape;");break;case 2:n.push("uniform ivec2 outShape;"),n.push("uniform int outShapeStrides;");break;case 3:n.push("uniform ivec3 outShape;"),n.push("uniform ivec2 outShapeStrides;");break;case 4:n.push("uniform ivec4 outShape;"),n.push("uniform ivec3 outShapeStrides;");break}n.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(function(p){n.push("uniform ".concat(p.type," ").concat(p.name).concat(p.arrayIndex?"[".concat(p.arrayIndex,"]"):"",";"))});var a=n.join(`
`),i=r.map(function(p){return _8e(p,e,t.packedInputs,t.enableShapeUniforms)}).join(`
`),o=e.texShape,s=Bn(),u=O8e(s),c,l,f=B8e(s);e.isPacked?(c=F8e(e.logicalShape,o,t.enableShapeUniforms),l=M8e(s)):(c=R8e(e.logicalShape,o,t.enableShapeUniforms),l=P8e(s)),t.packedInputs&&(f+=$8e);var h=[f,u,l,a,c,i,t.userCode].join(`
`);return h}function Dl(r,e){e===void 0&&(e=!1);var t=r.shapeInfo.logicalShape;switch(t.length){case 0:return Q8e(r,e);case 1:return t7e(r,e);case 2:return n7e(r,e);case 3:return i7e(r,e);case 4:return s7e(r,e);case 5:return u7e(r);case 6:return c7e(r);default:throw new Error("".concat(t.length,"-D input sampling")+" is not yet supported")}}function qG(r,e){var t=r.shapeInfo.logicalShape;switch(t.length){case 0:return Z8e(r);case 1:return e7e(r,e);case 2:return r7e(r,e);case 3:return a7e(r,e);default:return o7e(r,e)}}function _8e(r,e,t,n){t===void 0&&(t=!1);var a="";t?a+=qG(r,n):a+=Dl(r,n);var i=r.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(t?a+=l7e(r,e):a+=f7e(r,e)),a}function F8e(r,e,t){switch(r.length){case 0:return zG();case 1:return W8e(r,e,t);case 2:return Y8e(r,e,t);case 3:return V8e(r,e,t);default:return H8e(r,e,t)}}function R8e(r,e,t){switch(r.length){case 0:return zG();case 1:return U8e(r,e,t);case 2:return J8e(r,e,t);case 3:return G8e(r,e,t);case 4:return j8e(r,e,t);case 5:return K8e(r,e);case 6:return X8e(r,e);default:throw new Error("".concat(r.length,"-D output sampling is not yet supported"))}}function O8e(r){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `.concat(r.texture2D,`(textureSampler, uv).r;
    }
  `)}function P8e(r){return`
    void setOutput(float val) {
      `.concat(r.output,` = vec4(val, 0, 0, 0);
    }
  `)}function M8e(r){return`
    void setOutput(vec4 val) {
      `.concat(r.output,` = val;
    }
  `)}function B8e(r){var e="".concat(r.version,`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `).concat(r.varyingFs,` vec2 resultUV;
    `).concat(r.defineOutput,`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `).concat(r.defineSpecialNaN,`
    `).concat(r.defineSpecialInf,`
    `).concat(r.defineRound,`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `).concat(L8e,`
    `).concat(q8e,`
    `).concat(z8e,`
  `);return e}var L8e=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,q8e=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,z8e=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,$8e=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function zG(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function W8e(r,e,t){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return n[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `.concat(n[1],`.0);
      }
    `):n[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `.concat(n[0],`.0);
      }
    `):t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(n[0],", ").concat(n[1],`));
      return 2 * (resTexRC.x * `).concat(n[1],` + resTexRC.y);
    }
  `)}function U8e(r,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * `.concat(e[1],`.0);
      }
    `):e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * `.concat(e[0],`.0);
      }
    `):t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(e[0],", ").concat(e[1],`));
      return resTexRC.x * `).concat(e[1],` + resTexRC.y;
    }
  `)}function V8e(r,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],a=Math.ceil(r[2]/2),i=a*Math.ceil(r[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(n[0],", ").concat(n[1],`));
      int index = resTexRC.x * `).concat(n[1],` + resTexRC.y;

      int b = index / `).concat(i,`;
      index -= b * `).concat(i,`;

      int r = 2 * (index / `).concat(a,`);
      int c = imod(index, `).concat(a,`) * 2;

      return ivec3(b, r, c);
    }
  `)}function G8e(r,e,t){if(t){var n=Rg(["r","c","d"],r);return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    `.concat(n,`
    return ivec3(r, c, d);
  }
`)}var a=rc(["r","c","d"],r);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
      `).concat(a,`
      return ivec3(r, c, d);
    }
  `)}function H8e(r,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;for(var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],a=Math.ceil(r[r.length-1]/2),i=a*Math.ceil(r[r.length-2]/2),o=i,s="",u="b, r, c",c=2;c<r.length-1;c++)o*=r[r.length-c-1],s=`
      int b`.concat(c," = index / ").concat(o,`;
      index -= b`).concat(c," * ").concat(o,`;
    `)+s,u="b".concat(c,", ")+u;return`
    ivec`.concat(r.length,` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`).concat(n[0],", ").concat(n[1],`));
      int index = resTexRC.x * `).concat(n[1],` + resTexRC.y;

      `).concat(s,`

      int b = index / `).concat(i,`;
      index -= b * `).concat(i,`;

      int r = 2 * (index / `).concat(a,`);
      int c = imod(index, `).concat(a,`) * 2;

      return ivec`).concat(r.length,"(").concat(u,`);
    }
  `)}function j8e(r,e,t){if(t){var n=Rg(["r","c","d","d2"],r);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      `.concat(n,`
      return ivec4(r, c, d, d2);
    }
  `)}var a=rc(["r","c","d","d2"],r);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
      `).concat(a,`
      return ivec4(r, c, d, d2);
    }
  `)}function K8e(r,e){var t=rc(["r","c","d","d2","d3"],r);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`.concat(e[0],`,
                             `).concat(e[1],`));

      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;

      `).concat(t,`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `)}function X8e(r,e){var t=rc(["r","c","d","d2","d3","d4"],r);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;

      `).concat(t,`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `)}function Y8e(r,e,t){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(k.util.arraysEqual(r,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`.concat(n[0],", ").concat(n[1],`));
      }
    `);var a=Math.ceil(r[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(n[0],", ").concat(n[1],`));

      int index = resTexRC.x * `).concat(n[1],` + resTexRC.y;
      int r = 2 * (index / `).concat(a,`);
      int c = imod(index, `).concat(a,`) * 2;

      return ivec2(r, c);
    }
  `)}function J8e(r,e,t){return k.util.arraysEqual(r,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`.concat(e[0],", ").concat(e[1],`));
      }
    `):r[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`.concat(e[0],", ").concat(e[1],`));
        int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
        return ivec2(index, 0);
      }
    `):r[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`.concat(e[0],", ").concat(e[1],`));
        int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
        return ivec2(0, index);
      }
    `):t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
      int r = index / `).concat(r[1],`;
      int c = index - r * `).concat(r[1],`;
      return ivec2(r, c);
    }
  `)}function nc(r){return"offset".concat(r)}function Z8e(r){var e=r.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),n=Bn();return`
    vec4 `.concat(t,`() {
      return `).concat(n.texture2D,"(").concat(e,`, halfCR);
    }
  `)}function Q8e(r,e){var t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(r.shapeInfo.isUniform)return"float ".concat(n,"() {return ").concat(t,";}");var a=Te(r.shapeInfo.texShape,2),i=a[0],o=a[1];if(i===1&&o===1)return`
      float `.concat(n,`() {
        return sampleTexture(`).concat(t,`, halfCR);
      }
    `);var s=nc(t);if(e)return`
    float `.concat(n,`() {
      vec2 uv = uvFromFlat(`).concat(t,"TexShape[0], ").concat(t,"TexShape[1], ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `);var u=Te(r.shapeInfo.texShape,2),c=u[0],l=u[1];return`
    float `.concat(n,`() {
      vec2 uv = uvFromFlat(`).concat(c,", ").concat(l,", ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function e7e(r,e){var t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),a=r.shapeInfo.texShape,i=Bn();if(e)return`
    vec4 `.concat(n,`(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(t,"TexShape[0]) / 2.0), ceil(float(").concat(t,`TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return `).concat(i.texture2D,"(").concat(t,`, uv);
    }
  `);var o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return`
    vec4 `.concat(n,`(int index) {
      vec2 uv = packedUVfrom1D(
        `).concat(o[0],", ").concat(o[1],`, index);
      return `).concat(i.texture2D,"(").concat(t,`, uv);
    }
  `)}function t7e(r,e){var t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(r.shapeInfo.isUniform)return`
      float `.concat(n,`(int index) {
        `).concat(_l(r),`
      }
    `);var a=r.shapeInfo.texShape,i=a[0],o=a[1];if(o===1&&i===1)return`
      float `.concat(n,`(int index) {
        return sampleTexture(`).concat(t,`, halfCR);
      }
    `);var s=nc(t);return o===1?e?`
      float `.concat(n,`(int index) {
        vec2 uv = vec2(0.5, (float(index + `).concat(s,") + 0.5) / float(").concat(t,`TexShape[0]));
        return sampleTexture(`).concat(t,`, uv);
      }
    `):`
      float `.concat(n,`(int index) {
        vec2 uv = vec2(0.5, (float(index + `).concat(s,") + 0.5) / ").concat(i,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `):i===1?e?`
      float `.concat(n,`(int index) {
        vec2 uv = vec2((float(index + `).concat(s,") + 0.5) / float(").concat(t,`TexShape[1]), 0.5);
        return sampleTexture(`).concat(t,`, uv);
      }
    `):`
      float `.concat(n,`(int index) {
        vec2 uv = vec2((float(index + `).concat(s,") + 0.5) / ").concat(o,`.0, 0.5);
        return sampleTexture(`).concat(t,`, uv);
      }
    `):e?`
    float `.concat(n,`(int index) {
      vec2 uv = uvFromFlat(`).concat(t,"TexShape[0], ").concat(t,"TexShape[1], index + ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `):`
    float `.concat(n,`(int index) {
      vec2 uv = uvFromFlat(`).concat(i,", ").concat(o,", index + ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function r7e(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=r.shapeInfo.texShape,o=i[0],s=i[1],u=Bn();if(i!=null&&k.util.arraysEqual(t,i))return e?`
      vec4 `.concat(a,`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(n,"TexShape[1], ").concat(n,`TexShape[0]);

        return `).concat(u.texture2D,"(").concat(n,`, uv);
      }
    `):`
      vec4 `.concat(a,`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(s,".0, ").concat(o,`.0);

        return `).concat(u.texture2D,"(").concat(n,`, uv);
      }
    `);if(e)return`
    vec4 `.concat(a,`(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,`TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(`).concat(n,`Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return `).concat(u.texture2D,"(").concat(n,`, uv);
    }
  `);var c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],l=Math.ceil(t[1]/2);return`
    vec4 `.concat(a,`(int row, int col) {
      vec2 uv = packedUVfrom2D(`).concat(l,", ").concat(c[0],", ").concat(c[1],`, row, col);
      return `).concat(u.texture2D,"(").concat(n,`, uv);
    }
  `)}function n7e(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=r.shapeInfo.texShape;if(i!=null&&k.util.arraysEqual(t,i)){if(e)return`
      float `.concat(a,`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(n,"TexShape[1], ").concat(n,`TexShape[0]);
        return sampleTexture(`).concat(n,`, uv);
      }
    `);var o=i[0],s=i[1];return`
    float `.concat(a,`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(s,".0, ").concat(o,`.0);
      return sampleTexture(`).concat(n,`, uv);
    }
  `)}var u=k.util.squeezeShape(t),c=u.newShape,l=u.keptDims,f=c;if(f.length<t.length){var h=Fl(r,f),p=["row","col"];return`
      `.concat(Dl(h,e),`
      float `).concat(a,`(int row, int col) {
        return `).concat(a,"(").concat(Rl(p,l),`);
      }
    `)}if(r.shapeInfo.isUniform)return`
      float `.concat(a,`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`).concat(t[1],`, 1)));
        `).concat(_l(r),`
      }
    `);var d=i[0],m=i[1],v=nc(n);return m===1?e?`
      float `.concat(a,`(int row, int col) {
        float index = dot(vec3(row, col, `).concat(v,"), vec3(").concat(n,`Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(`).concat(n,`TexShape[0]));
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
    float `.concat(a,`(int row, int col) {
      float index = dot(vec3(row, col, `).concat(v,"), vec3(").concat(t[1],`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `).concat(d,`.0);
      return sampleTexture(`).concat(n,`, uv);
    }
  `):d===1?e?`
      float `.concat(a,`(int row, int col) {
        float index = dot(vec3(row, col, `).concat(v,"), vec3(").concat(n,`Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(`).concat(n,`TexShape[1]), 0.5);
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
    float `.concat(a,`(int row, int col) {
      float index = dot(vec3(row, col, `).concat(v,"), vec3(").concat(t[1],`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `).concat(m,`.0, 0.5);
      return sampleTexture(`).concat(n,`, uv);
    }
  `):e?`
      float `.concat(a,`(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `).concat(n,"Shape[1] + col + ").concat(v,`;
        vec2 uv = uvFromFlat(`).concat(n,"TexShape[0], ").concat(n,`TexShape[1], index);
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
  float `.concat(a,`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `).concat(t[1]," + col + ").concat(v,`;
    vec2 uv = uvFromFlat(`).concat(d,", ").concat(m,`, index);
    return sampleTexture(`).concat(n,`, uv);
  }
`)}function a7e(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=r.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(t[0]===1){var s=t.slice(1),u=[1,2],c=Fl(r,s),l=["b","row","col"];return`
        `.concat(qG(c,e),`
        vec4 `).concat(a,`(int b, int row, int col) {
          return `).concat(a,"(").concat(Rl(l,u),`);
        }
      `)}var f=Bn();if(e)return`
    vec4 `.concat(a,`(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,`TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(`).concat(n,`Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(`).concat(n,`Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return `).concat(f.texture2D,"(").concat(n,`, uv);
    }
  `);var h=o[0],p=o[1],d=Math.ceil(t[2]/2),m=d*Math.ceil(t[1]/2);return`
    vec4 `.concat(a,`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `).concat(h,", ").concat(p,", ").concat(m,", ").concat(d,`, b, row, col);
      return `).concat(f.texture2D,"(").concat(n,`, uv);
    }
  `)}function i7e(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[1]*t[2],o=t[2],s=k.util.squeezeShape(t),u=s.newShape,c=s.keptDims,l=u;if(l.length<t.length){var f=Fl(r,l),h=["row","col","depth"];return`
        `.concat(Dl(f,e),`
        float `).concat(a,`(int row, int col, int depth) {
          return `).concat(a,"(").concat(Rl(h,c),`);
        }
      `)}if(r.shapeInfo.isUniform)return`
      float `.concat(a,`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`).concat(i,", ").concat(o,`, 1)));
        `).concat(_l(r),`
      }
    `);var p=r.shapeInfo.texShape,d=p[0],m=p[1],v=r.shapeInfo.flatOffset;if(m===i&&v==null)return e?`
      float `.concat(a,`(int row, int col, int depth) {
        int stride1 = `).concat(n,`Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(n,"TexShape[1], ").concat(n,`TexShape[0]);
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
        float `.concat(a,`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`).concat(o,`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`).concat(m,".0, ").concat(d,`.0);
          return sampleTexture(`).concat(n,`, uv);
        }
      `);if(m===o&&v==null)return e?`
      float `.concat(a,`(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(`).concat(n,`Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`).concat(n,"TexShape[1], ").concat(n,`TexShape[0]);
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
    float `.concat(a,`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`).concat(t[1],`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`).concat(m,".0, ").concat(d,`.0);
      return sampleTexture(`).concat(n,`, uv);
    }
  `);var g=nc(n);return e?`
    float `.concat(a,`(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = `).concat(n,"Shape[1] * ").concat(n,`Shape[2];
      int stride1 = `).concat(n,`Shape[2];
      int index = row * stride0 + col * stride1 + depth + `).concat(g,`;
      vec2 uv = uvFromFlat(`).concat(n,"TexShape[0], ").concat(n,`TexShape[1], index);
      return sampleTexture(`).concat(n,`, uv);
    }
    `):`
      float `.concat(a,`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `).concat(i," + col * ").concat(o," + depth + ").concat(g,`;
        vec2 uv = uvFromFlat(`).concat(d,", ").concat(m,`, index);
        return sampleTexture(`).concat(n,`, uv);
      }
  `)}function o7e(r,e){var t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),a=Bn();if(e)return`
    vec4 `.concat(n,`(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(`).concat(t,`Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(`).concat(t,`Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= `).concat(t,`Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(t,"TexShape[0]) / 2.0), ceil(float(").concat(t,`TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return `).concat(a.texture2D,"(").concat(t,`, uv);
    }
  `);for(var i=r.shapeInfo.logicalShape,o=i.length,s=r.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=u[0],l=u[1],f=Math.ceil(i[o-1]/2),h=f*Math.ceil(i[o-2]/2),p="int b, int row, int col",d="b * ".concat(h," + (row / 2) * ").concat(f," + (col / 2)"),m=2;m<o-1;m++)p="int b".concat(m,", ")+p,h*=i[o-m-1],d="b".concat(m," * ").concat(h," + ")+d;return`
    vec4 `.concat(n,"(").concat(p,`) {
      int index = `).concat(d,`;
      int texR = index / `).concat(l,`;
      int texC = index - texR * `).concat(l,`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`).concat(l,", ").concat(c,`);
      return `).concat(a.texture2D,"(").concat(t,`, uv);
    }
  `)}function s7e(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[3],o=t[2]*i,s=t[1]*o,u=k.util.squeezeShape(t),c=u.newShape,l=u.keptDims;if(c.length<t.length){var f=Fl(r,c),h=["row","col","depth","depth2"];return`
      `.concat(Dl(f,e),`
      float `).concat(a,`(int row, int col, int depth, int depth2) {
        return `).concat(a,"(").concat(Rl(h,l),`);
      }
    `)}if(r.shapeInfo.isUniform)return`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`).concat(s,", ").concat(o,", ").concat(i,`, 1)));
        `).concat(_l(r),`
      }
    `);var p=r.shapeInfo.flatOffset,d=r.shapeInfo.texShape,m=d[0],v=d[1],g="int stride2 = ".concat(n,"Shape[3];"),y="int stride1 = ".concat(n,"Shape[2] * stride2;"),w="int stride0 = ".concat(n,"Shape[1] * stride1;");if(v===s&&p==null)return e?`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        `).concat(g,`
        `).concat(y,`
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(n,"TexShape[1], ").concat(n,`TexShape[0]);
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`).concat(o,", ").concat(i,`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(v,".0, ").concat(m,`.0);
        return sampleTexture(`).concat(n,`, uv);
      }
    `);if(v===i&&p==null)return e?`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`).concat(n,"Shape[1] * ").concat(n,"Shape[2], ").concat(n,`Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(n,"TexShape[1], ").concat(n,`TexShape[0]);
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`).concat(t[1]*t[2],", ").concat(t[2],`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(v,".0, ").concat(m,`.0);
        return sampleTexture(`).concat(n,`, uv);
      }
    `);var b=nc(n);return e?`
    float `.concat(a,`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      `).concat(g,`
      `).concat(y,`
      `).concat(w,`
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(`).concat(n,"TexShape[0], ").concat(n,"TexShape[1], index + ").concat(b,`);
      return sampleTexture(`).concat(n,`, uv);
    }
  `):`
    float `.concat(a,`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `).concat(s," + col * ").concat(o,` +
          depth * `).concat(i,` + depth2;
      vec2 uv = uvFromFlat(`).concat(m,", ").concat(v,", index + ").concat(b,`);
      return sampleTexture(`).concat(n,`, uv);
    }
  `)}function u7e(r){var e=r.shapeInfo.logicalShape,t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),a=e[4],i=e[3]*a,o=e[2]*i,s=e[1]*o,u=k.util.squeezeShape(e),c=u.newShape,l=u.keptDims;if(c.length<e.length){var f=Fl(r,c),h=["row","col","depth","depth2","depth3"];return`
      `.concat(Dl(f),`
      float `).concat(n,`(int row, int col, int depth, int depth2, int depth3) {
        return `).concat(n,"(").concat(Rl(h,l),`);
      }
    `)}if(r.shapeInfo.isUniform)return`
      float `.concat(n,`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`).concat(s,", ").concat(o,", ").concat(i,", ").concat(a,`)) +
          depth3;
        `).concat(_l(r),`
      }
    `);var p=r.shapeInfo.flatOffset,d=r.shapeInfo.texShape,m=d[0],v=d[1];if(v===s&&p==null)return`
      float `.concat(n,`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`).concat(o,", ").concat(i,", ").concat(a,`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(v,".0, ").concat(m,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);if(v===a&&p==null)return`
      float `.concat(n,`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`).concat(e[1]*e[2]*e[3],`,
               `).concat(e[2]*e[3],", ").concat(e[3],`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(v,".0, ").concat(m,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);var g=nc(t);return`
    float `.concat(n,`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `).concat(s," + col * ").concat(o," + depth * ").concat(i,` +
          depth2 * `).concat(a," + depth3 + ").concat(g,`;
      vec2 uv = uvFromFlat(`).concat(m,", ").concat(v,`, index);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function c7e(r){var e=r.shapeInfo.logicalShape,t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),a=k.util.squeezeShape(e),i=a.newShape,o=a.keptDims;if(i.length<e.length){var s=Fl(r,i),u=["row","col","depth","depth2","depth3","depth4"];return`
      `.concat(Dl(s),`
      float `).concat(n,`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `).concat(n,"(").concat(Rl(u,o),`);
      }
    `)}var c=e[5],l=e[4]*c,f=e[3]*l,h=e[2]*f,p=e[1]*h;if(r.shapeInfo.isUniform)return`
      float `.concat(n,`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`).concat(p,", ").concat(h,", ").concat(f,", ").concat(l,`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`).concat(c,`, 1)));
        `).concat(_l(r),`
      }
    `);var d=r.shapeInfo.flatOffset,m=r.shapeInfo.texShape,v=m[0],g=m[1];if(g===p&&d==null)return`
      float `.concat(n,`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`).concat(h,", ").concat(f,", ").concat(l,", ").concat(c,`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(g,".0, ").concat(v,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);if(g===c&&d==null)return`
      float `.concat(n,`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`).concat(e[1]*e[2]*e[3]*e[4],`,
               `).concat(e[2]*e[3]*e[4],`,
               `).concat(e[3]*e[4],`,
               `).concat(e[4],`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(g,".0, ").concat(v,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);var y=nc(t);return`
    float `.concat(n,`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `).concat(p," + col * ").concat(h," + depth * ").concat(f,` +
          depth2 * `).concat(l," + depth3 * ").concat(c," + depth4 + ").concat(y,`;
      vec2 uv = uvFromFlat(`).concat(v,", ").concat(g,`, index);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function _l(r){var e=r.name,t=k.util.sizeFromShape(r.shapeInfo.logicalShape);return t<2?"return ".concat(e,";"):`
    for (int i = 0; i < `.concat(t,`; i++) {
      if (i == index) {
        return `).concat(e,`[i];
      }
    }
  `)}function l7e(r,e){var t=r.name,n=t.charAt(0).toUpperCase()+t.slice(1),a="get"+n+"AtOutCoords",i=r.shapeInfo.logicalShape.length,o=e.logicalShape.length,s=LG(r.shapeInfo.logicalShape,e.logicalShape),u=Ht(o),c=o-i,l,f=["x","y","z","w","u","v"];i===0?l="":o<2&&s.length>=1?l="coords = 0;":l=s.map(function(b){return"coords.".concat(f[b+c]," = 0;")}).join(`
`);var h="";o<2&&i>0?h="coords":h=r.shapeInfo.logicalShape.map(function(b,x){return"coords.".concat(f[x+c])}).join(", ");var p="return outputValue;",d=k.util.sizeFromShape(r.shapeInfo.logicalShape),m=d===1,v=k.util.sizeFromShape(e.logicalShape),g=v===1;if(i===1&&!m&&!g)p=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(m&&!g)o===1?p=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:p=`
        return vec4(outputValue.x);
      `;else if(s.length){var y=i-2,w=i-1;s.indexOf(y)>-1&&s.indexOf(w)>-1?p="return vec4(outputValue.x);":s.indexOf(y)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":s.indexOf(w)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 `.concat(a,`() {
      `).concat(u,` coords = getOutputCoords();
      `).concat(l,`
      vec4 outputValue = get`).concat(n,"(").concat(h,`);
      `).concat(p,`
    }
  `)}function f7e(r,e){var t=r.name,n=t.charAt(0).toUpperCase()+t.slice(1),a="get"+n+"AtOutCoords",i=e.texShape,o=r.shapeInfo.texShape,s=r.shapeInfo.logicalShape.length,u=e.logicalShape.length;if(!r.shapeInfo.isUniform&&s===u&&r.shapeInfo.flatOffset==null&&k.util.arraysEqual(o,i))return`
      float `.concat(a,`() {
        return sampleTexture(`).concat(t,`, resultUV);
      }
    `);var c=Ht(u),l=LG(r.shapeInfo.logicalShape,e.logicalShape),f=u-s,h,p=["x","y","z","w","u","v"];s===0?h="":u<2&&l.length>=1?h="coords = 0;":h=l.map(function(m){return"coords.".concat(p[m+f]," = 0;")}).join(`
`);var d="";return u<2&&s>0?d="coords":d=r.shapeInfo.logicalShape.map(function(m,v){return"coords.".concat(p[v+f])}).join(", "),`
    float `.concat(a,`() {
      `).concat(c,` coords = getOutputCoords();
      `).concat(h,`
      return get`).concat(n,"(").concat(d,`);
    }
  `)}function Ht(r){if(r<=1)return"int";if(r===2)return"ivec2";if(r===3)return"ivec3";if(r===4)return"ivec4";if(r===5)return"ivec5";if(r===6)return"ivec6";throw Error("GPU for rank ".concat(r," is not yet supported"))}function X2(r,e,t){var n=k.util.squeezeShape(e),a=n.newShape,i=n.keptDims,o=e.length,s=r&&o===3&&e[0]===1,u=s?e.slice(1):a,c=!r&&o>1&&!k.util.arraysEqual(e,t)&&a.length<o||s,l=c?u:e;return{useSqueezeShape:c,uniformShape:l,keptDims:i}}function Fl(r,e){var t=JSON.parse(JSON.stringify(r));return t.shapeInfo.logicalShape=e,t}function Rl(r,e){return e.map(function(t){return r[t]}).join(", ")}function h7e(r,e,t,n){var a=t.map(function(l,f){var h={logicalShape:l.shape,texShape:l.isUniform?null:l.texData.texShape,isUniform:l.isUniform,isPacked:l.isUniform?!1:l.texData.isPacked,flatOffset:null};return l.texData!=null&&l.texData.slice!=null&&l.texData.slice.flatOffset>0&&(h.flatOffset=l.texData.slice.flatOffset),{name:e.variableNames[f],shapeInfo:h}}),i=a.map(function(l){return l.shapeInfo}),o={logicalShape:n.shape,texShape:n.texData.texShape,isUniform:!1,isPacked:n.texData.isPacked,flatOffset:null},s=D8e(a,o,e),u=mG(r.gl,s),c=r.createProgram(u);return k.env().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(r.buildVao(c),Object.assign({program:e,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o},$G(r,e,c)))}function $G(r,e,t){var n,a,i,o,s=[],u=[],c,l,f,h=null,p=null;p=r.getUniformLocation(t,"NAN",!1),k.env().getNumber("WEBGL_VERSION")===1&&(h=r.getUniformLocation(t,"INFINITY",!1));var d=!1;try{for(var m=Pn(e.variableNames),v=m.next();!v.done;v=m.next()){var g=v.value,y={name:g,uniform:r.getUniformLocation(t,g,d),offset:r.getUniformLocation(t,"offset".concat(g),d)};e.enableShapeUniforms&&(y.shape=r.getUniformLocation(t,"".concat(g,"Shape"),d),y.texShape=r.getUniformLocation(t,"".concat(g,"TexShape"),d)),s.push(y)}}catch(S){n={error:S}}finally{try{v&&!v.done&&(a=m.return)&&a.call(m)}finally{if(n)throw n.error}}if(e.enableShapeUniforms&&(c=r.getUniformLocation(t,"outShape",d),f=r.getUniformLocation(t,"outShapeStrides",d),l=r.getUniformLocation(t,"outTexShape",d)),e.customUniforms)try{for(var w=Pn(e.customUniforms),b=w.next();!b.done;b=w.next()){var x=b.value;u.push(r.getUniformLocation(t,x.name,d))}}catch(S){i={error:S}}finally{try{b&&!b.done&&(o=w.return)&&o.call(w)}finally{if(i)throw i.error}}return{variablesLocations:s,customUniformLocations:u,infLoc:h,nanLoc:p,outShapeLocation:c,outShapeStridesLocation:f,outTexShapeLocation:l}}function MV(r,e){if(r.length!==e.length)throw Error("Binary was compiled with ".concat(r.length," inputs, but ")+"was executed with ".concat(e.length," inputs"));r.forEach(function(t,n){var a=t.logicalShape,i=e[n],o=i.shape;if(!k.util.arraysEqual(a,o))throw Error("Binary was compiled with different shapes than "+"the current args. Shapes ".concat(a," and ").concat(o," must match"));if(!(t.isUniform&&i.isUniform)){var s=t.texShape,u=i.isUniform?null:i.texData.texShape;if(!k.util.arraysEqual(s,u))throw Error("Binary was compiled with different texture shapes than the"+" current args. Shape ".concat(s," and ").concat(u," must match"))}})}function p7e(r,e,t,n,a){e.program.enableShapeUniforms||(MV(e.inShapeInfos,t),MV([e.outShapeInfo],[n]));var i=n.texData.texture,o=n.texData.texShape;n.texData.isPacked?r.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):r.setOutputMatrixTexture(i.texture,o[0],o[1]),r.setProgram(e.webGLProgram),r.bindVertexArray(e.webGLProgram.vao),k.env().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&r.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&r.gl.uniform1f(e.nanLoc,NaN);for(var s=0;s<t.length;++s){var u=t[s],c=e.variablesLocations[s],l=c.uniform,f=c.offset,h=c.shape,p=c.texShape;if(h){var d=X2(e.program.packedInputs,u.shape,u.texData.texShape).uniformShape;switch(d.length){case 1:r.gl.uniform1iv(h,new Int32Array(d));break;case 2:r.gl.uniform2iv(h,new Int32Array(d));break;case 3:r.gl.uniform3iv(h,new Int32Array(d));break;case 4:r.gl.uniform4iv(h,new Int32Array(d));break}}if(p&&r.gl.uniform2i(p,u.texData.texShape[0],u.texData.texShape[1]),l!=null){if(u.isUniform){if(k.util.sizeFromShape(u.shape)<2)r.gl.uniform1f(l,u.uniformValues[0]);else{var m=u.uniformValues;m instanceof Float32Array||(m=new Float32Array(m)),r.gl.uniform1fv(l,m)}continue}u.texData.slice!=null&&f!=null&&r.gl.uniform1i(f,u.texData.slice.flatOffset),r.setInputMatrixTexture(u.texData.texture.texture,l,s)}}var v=e.outShapeLocation;if(v)switch(n.shape.length){case 1:r.gl.uniform1iv(v,new Int32Array(n.shape));break;case 2:r.gl.uniform2iv(v,new Int32Array(n.shape));break;case 3:r.gl.uniform3iv(v,new Int32Array(n.shape));break;case 4:r.gl.uniform4iv(v,new Int32Array(n.shape));break}if(e.outShapeStridesLocation){var g=k.util.computeStrides(n.shape);switch(n.shape.length){case 2:r.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(g));break;case 3:r.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(g));break;case 4:r.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(g));break}}if(e.outTexShapeLocation&&r.gl.uniform2i(e.outTexShapeLocation,n.texData.texShape[0],n.texData.texShape[1]),e.program.customUniforms&&a)for(var s=0;s<e.program.customUniforms.length;++s){var y=e.program.customUniforms[s],w=e.customUniformLocations[s],b=a[s];if(y.type==="float")r.gl.uniform1fv(w,b);else if(y.type==="vec2")r.gl.uniform2fv(w,b);else if(y.type==="vec3")r.gl.uniform3fv(w,b);else if(y.type==="vec4")r.gl.uniform4fv(w,b);else if(y.type==="int")r.gl.uniform1iv(w,b);else if(y.type==="ivec2")r.gl.uniform2iv(w,b);else if(y.type==="ivec3")r.gl.uniform3iv(w,b);else if(y.type==="ivec4")r.gl.uniform4iv(w,b);else throw Error("uniform type ".concat(y.type," is not supported yet."))}r.executeProgram()}function d7e(r,e,t){var n="";e.concat(t).forEach(function(o){var s=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(r.enableShapeUniforms&&!o.isUniform){var u=o.texData.texShape,c=X2(r.packedInputs,o.shape,u),l=c.useSqueezeShape,f=c.uniformShape,h=c.keptDims,p="",d="",m="";if(f.length===1&&r.packedInputs){var v=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];p="".concat(v[0]>1,"_").concat(v[1]>1)}else if(f.length===2&&!r.packedInputs)d="".concat(f[0]>1,"_").concat(f[1]>1);else if(f.length>2&&!r.packedInputs){var g=k.util.computeStrides(f);m="".concat(g[0]===u[1],"_").concat(g[g.length-1]===u[1])}var y=o.shape.length,w=f.length===2&&k.util.arraysEqual(o.shape,u),b=k.util.sizeFromShape(o.shape)===1,x=k.backend_util.getBroadcastDims(o.shape,t.shape),S=!r.packedInputs&&y===t.shape.length&&k.util.arraysEqual(u,t.texData.texShape),T=r.packedInputs||f.length>2?"":"".concat(u[0]>1,"_").concat(u[1]>1);n+="".concat(y,"_").concat(S,"_").concat(l?h:"","_").concat(f.length,"_").concat(b,"_").concat(x,"_").concat(w,"_").concat(p,"_").concat(d,"_").concat(m,"_").concat(T,"_").concat(s)}else{var E=o.isUniform?"uniform":o.texData.texShape;n+="".concat(o.shape,"_").concat(E,"_").concat(s)}});var a=r.userCode,i=r.constructor.name;return i+="_"+n+"_"+a+"".concat(k.env().getNumber("WEBGL_VERSION")),i}function En(r){return k.env().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&r<=4}var v7e=function(){function r(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=fp.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var t=Bn();this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `.concat(this.enableShapeUniforms?Rg(["r","c","d"],e):rc(["r","c","d"],e),`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `).concat(t.output,` = result;
      }
    `)}return r}();var m7e=function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=fp.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var t=Bn();this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `.concat(this.enableShapeUniforms?Rg(["r","c","d"],e):rc(["r","c","d"],e),`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `).concat(t.output,` = result;
      }
    `)}return r}();var g7e=function(){function r(e){this.variableNames=["A"],this.outTexUsage=Ba.DOWNLOAD;var t=Bn();this.outputShape=e,this.userCode=`
      `.concat(BG,`

      void main() {
        float x = getAAtOutCoords();
        `).concat(t.output,` = encode_float(x);
      }
    `)}return r}();var y7e=function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Ba.DOWNLOAD;var t=Bn();this.outputShape=e,this.userCode=`
      `.concat(BG,`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `).concat(t.output,` = encode_float(x);
      }
    `)}return r}();var b7e={R:0,G:1,B:2,A:3},BV=function(){function r(e,t,n){t===void 0&&(t=!1),n===void 0&&(n="RGBA"),this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];var a=Bn();this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length);var i="result";t&&(i="floor(result * 255. + 0.5)");for(var o="",s=0;s<n.length;s++){var u=n[s];o+=`
          if(offset == `.concat(s,`) {
            result = values[`).concat(b7e[u],`];
          }`)}this.userCode=`
      `.concat(this.enableShapeUniforms?K2():j2(e),`

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, `).concat(n.length,`);

        flatIndex = idiv(flatIndex, `).concat(n.length,`, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = `).concat(a.texture2D,`(A, uv);
          `).concat(o,`
        }
        `).concat(a.output," = vec4(").concat(i,`, 0., 0., 0.);
      }
    `)}return r}();var w7e=function(){function r(e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=Bn();this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length);var a="",i="result";t&&(i="floor(result * 255. + 0.5)");for(var o=0;o<=1;o++)for(var s=0;s<=1;s++){var u=o*2+s;a+=`
          localCoords = coords;
          if(localCoords[2] + `.concat(s," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(e[2]),`) {
          localCoords[2] += `).concat(s,`;
          if (localCoords[1] + `).concat(o," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(e[1]),`) {
            localCoords[1] += `).concat(o,`;

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = `).concat(n.texture2D,`(A, uv);

            if (offset == 0) {
              result[`).concat(u,`] = values[0];
            } else if (offset == 1) {
              result[`).concat(u,`] = values[1];
            } else if (offset == 2) {
              result[`).concat(u,`] = values[2];
            } else {
              result[`).concat(u,`] = values[3];
            }
          }
        }
        `)}this.userCode=`
        `.concat(this.enableShapeUniforms?K2():j2(e),`

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          `).concat(a,`

          `).concat(n.output," = ").concat(i,`;
        }
    `)}return r}();function WG(r){var e=Bn(),t="".concat(e.version,`
    precision highp float;
    `).concat(e.attribute,` vec3 clipSpacePos;
    `).concat(e.attribute,` vec2 uv;
    `).concat(e.varyingVs,` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`);return vG(r,t)}function UG(r){var e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return bG(r,e)}function VG(r){var e=new Uint16Array([0,1,2,2,1,3]);return wG(r,e)}function gp(r,e,t,n,a,i){kG(e,t);var o=xG(r),s=r.TEXTURE_2D;return Pe(r,function(){return r.bindTexture(s,o)}),Pe(r,function(){return r.texParameteri(s,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE)}),Pe(r,function(){return r.texParameteri(s,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)}),Pe(r,function(){return r.texParameteri(s,r.TEXTURE_MIN_FILTER,r.NEAREST)}),Pe(r,function(){return r.texParameteri(s,r.TEXTURE_MAG_FILTER,r.NEAREST)}),k.env().getNumber("WEBGL_VERSION")===1?Pe(r,function(){return r.texImage2D(s,0,n,e,t,0,a,i,null)}):Pe(r,function(){return r.texStorage2D(s,1,n,e,t)}),Pe(r,function(){return r.bindTexture(r.TEXTURE_2D,null)}),{texture:o,texShape:[t,e]}}function Y2(r){return r.internalFormatFloat}function GG(r,e,t,n){var a=Te(mp(e,t),2),i=a[0],o=a[1];return gp(r,i,o,Y2(n),n.textureFormatFloat,r.FLOAT)}function J2(r){return r.internalFormatHalfFloat}function HG(r,e,t,n){var a=Te(mp(e,t),2),i=a[0],o=a[1];return gp(r,i,o,J2(n),n.textureFormatFloat,n.textureTypeHalfFloat)}function Z2(r){return r.downloadTextureFormat}function jG(r,e,t,n){var a=Te(mp(e,t),2),i=a[0],o=a[1];return gp(r,i,o,Z2(n),r.RGBA,r.UNSIGNED_BYTE)}function Q2(r){return r.internalFormatPackedFloat}function KG(r,e,t,n){var a=Te(Cl(e,t),2),i=a[0],o=a[1];return gp(r,i,o,Q2(n),r.RGBA,r.FLOAT)}function eS(r){return r.internalFormatPackedHalfFloat}function XG(r,e,t,n){var a=Te(Cl(e,t),2),i=a[0],o=a[1];return gp(r,i,o,eS(n),r.RGBA,n.textureTypeHalfFloat)}function YG(r,e,t){var n=0,a=3*4,i=3*4+2*4;Pe(r,function(){return r.bindBuffer(r.ARRAY_BUFFER,t)});var o=L2(r,e,"clipSpacePos",t,3,i,n);return o&&L2(r,e,"uv",t,2,i,a)}function JG(r,e,t,n,a,i){Pe(r,function(){return r.bindTexture(r.TEXTURE_2D,e)});var o,s,u;a instanceof Uint8Array?(o=new Uint8Array(t*n*4),s=r.UNSIGNED_BYTE,u=r.RGBA):(o=new Float32Array(t*n*4),s=r.FLOAT,u=i.internalFormatPackedFloat),o.set(a),k.env().getNumber("WEBGL_VERSION")===2?Pe(r,function(){return r.texSubImage2D(r.TEXTURE_2D,0,0,0,t,n,r.RGBA,s,o)}):Pe(r,function(){return r.texImage2D(r.TEXTURE_2D,0,u,t,n,0,r.RGBA,s,o)}),Pe(r,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function ZG(r,e,t){Pe(r,function(){return r.bindTexture(r.TEXTURE_2D,e)}),t.data instanceof Uint8Array?k.env().getNumber("WEBGL_VERSION")===2?Pe(r,function(){return r.texSubImage2D(r.TEXTURE_2D,0,0,0,t.width,t.height,r.RGBA,r.UNSIGNED_BYTE,t.data)}):Pe(r,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t.width,t.height,0,r.RGBA,r.UNSIGNED_BYTE,t.data)}):k.env().getNumber("WEBGL_VERSION")===2?Pe(r,function(){return r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,t)}):Pe(r,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t)}),Pe(r,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function QG(r,e,t,n){var a=r.createBuffer();Pe(r,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,a)});var i=4,o=4,s=i*o*e*t;return Pe(r,function(){return r.bufferData(r.PIXEL_PACK_BUFFER,s,r.STREAM_READ)}),Pe(r,function(){return r.readPixels(0,0,t,e,r.RGBA,r.FLOAT,0)}),Pe(r,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,null)}),a}function e6(r,e,t){var n=r,a=new Float32Array(t);return n.bindBuffer(n.PIXEL_PACK_BUFFER,e),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,a),n.bindBuffer(n.PIXEL_PACK_BUFFER,null),a}function t6(r,e,t,n){var a=Te(mp(e,t),2),i=a[0],o=a[1],s=4,u=new Uint8Array(v8e(e*t,s));return Pe(r,function(){return r.readPixels(0,0,i,o,n.downloadTextureFormat,r.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function r6(r,e,t,n,a,i,o,s){var u=r,c=new Float32Array(m8e(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function n6(r,e,t){var n=new Float32Array(e*t*4);return Pe(r,function(){return r.readPixels(0,0,t,e,r.RGBA,r.FLOAT,n)}),n}var x7e={__proto__:null,bindVertexProgramAttributeStreams:YG,createBufferFromOutputTexture:QG,createFloat16MatrixTexture:HG,createFloat16PackedMatrixTexture:XG,createFloat32MatrixTexture:GG,createIndexBuffer:VG,createPackedMatrixTexture:KG,createUnsignedBytesMatrixTexture:jG,createVertexBuffer:UG,createVertexShader:WG,downloadByteEncodedFloatMatrixFromOutputTexture:t6,downloadFloat32MatrixFromBuffer:e6,downloadMatrixFromPackedOutputTexture:n6,downloadPackedMatrixFromBuffer:r6,getInternalFormatForFloat16MatrixTexture:J2,getInternalFormatForFloat16PackedMatrixTexture:eS,getInternalFormatForFloat32MatrixTexture:Y2,getInternalFormatForPackedMatrixTexture:Q2,getInternalFormatForUnsignedBytesMatrixTexture:Z2,uploadDenseMatrixToTexture:JG,uploadPixelDataToTexture:ZG},Cg=function(){function r(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];var t=k.env().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,hG(t,e)):this.gl=Wi(t),e=this.gl,k.env().getNumber("WEBGL_VERSION")===2){var n=e;this.createVertexArray=function(){return Pe(n,function(){return n.createVertexArray()})},this.bindVertexArray=function(c){return Pe(n,function(){return n.bindVertexArray(c)})},this.deleteVertexArray=function(c){return Pe(n,function(){return n.deleteVertexArray(c)})},this.getVertexArray=function(){return Pe(n,function(){return n.getParameter(n.VERTEX_ARRAY_BINDING)})}}else if(e!=null){var a=e.getExtension("OES_vertex_array_object");if(a==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=function(){return Pe(e,function(){return a.createVertexArrayOES()})},this.bindVertexArray=function(c){return Pe(e,function(){return a.bindVertexArrayOES(c)})},this.deleteVertexArray=function(c){return Pe(e,function(){return a.deleteVertexArrayOES(c)})},this.getVertexArray=function(){return Pe(e,function(){return e.getParameter(a.VERTEX_ARRAY_BINDING_OES)})}}var i="WEBGL_color_buffer_float",o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),k.env().getNumber("WEBGL_VERSION")===1){var s="OES_texture_float",u="OES_texture_half_float";if(this.textureFloatExtension=op(this.gl,s),La(this.gl,u))this.textureHalfFloatExtension=op(this.gl,u);else if(k.env().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(i),La(this.gl,o))this.colorBufferHalfFloatExtension=op(this.gl,o);else if(k.env().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(i="EXT_color_buffer_float",La(this.gl,i))this.colorBufferFloatExtension=this.gl.getExtension(i);else if(La(this.gl,o))this.colorBufferHalfFloatExtension=this.gl.getExtension(o);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=UG(this.gl),this.indexBuffer=VG(this.gl),this.framebuffer=SG(this.gl),this.textureConfig=G2(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(r.prototype,"debug",{get:function(){return k.env().getBool("DEBUG")},enumerable:!1,configurable:!0}),r.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Pe(t,function(){return t.finish()}),Pe(t,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Pe(t,function(){return t.deleteFramebuffer(e.framebuffer)}),Pe(t,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),Pe(t,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),Pe(t,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},r.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),GG(this.gl,e,t,this.textureConfig)},r.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),HG(this.gl,e,t,this.textureConfig)},r.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),jG(this.gl,e,t,this.textureConfig)},r.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),ZG(this.gl,e,t)},r.prototype.uploadDenseMatrixToTexture=function(e,t,n,a){this.throwIfDisposed(),JG(this.gl,e,t,n,a,this.textureConfig)},r.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),XG(this.gl,e,t,this.textureConfig)},r.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),KG(this.gl,e,t,this.textureConfig)},r.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(q2(this.gl,this.framebuffer),this.outputTexture=null),Pe(this.gl,function(){return t.gl.deleteTexture(e)})},r.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var a=this;return this.downloadMatrixDriver(e,function(){return t6(a.gl,t,n,a.textureConfig)})},r.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,a,i,o){return r6(this.gl,e,t,n,a,i,o,this.textureConfig)},r.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return e6(this.gl,e,t)},r.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var a=QG(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),a},r.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},r.prototype.createFence=function(e){var t=this,n,a;if(k.env().getBool("WEBGL_FENCE_API_ENABLED")){var i=e,o=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),a=function(){var s=i.clientWaitSync(o,0,0);return s===i.ALREADY_SIGNALED||s===i.CONDITION_SATISFIED},n=o}else k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),a=function(){return t.isQueryAvailable(n,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):a=function(){return!0};return{query:n,isFencePassed:a}},r.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var a=this;return this.downloadMatrixDriver(e,function(){return n6(a.gl,t,n)})},r.prototype.createProgram=function(e){var t=this;this.throwIfDisposed();var n=this.gl;this.vertexShader==null&&(this.vertexShader=WG(n));var a=gG(n);Pe(n,function(){return n.attachShader(a,t.vertexShader)}),Pe(n,function(){return n.attachShader(a,e)}),yG(n,a);var i=Object.assign(a,{vao:this.createVertexArray()});return this.debug&&Ng(n,i),i},r.prototype.buildVao=function(e){var t=this;this.setProgram(e),this.bindVertexArray(e.vao);var n=this.gl;Pe(n,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.indexBuffer)}),YG(n,e,this.vertexBuffer)},r.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Pe(this.gl,function(){return t.gl.deleteProgram(e)}),this.deleteVertexArray(e.vao))},r.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&Ng(this.gl,this.program),Pe(this.gl,function(){return t.gl.useProgram(e)})},r.prototype.getUniformLocation=function(e,t,n){return n===void 0&&(n=!0),this.throwIfDisposed(),n?TG(this.gl,e,t):EG(this.gl,e,t)},r.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),Pe(this.gl,function(){return n.gl.getAttribLocation(e,t)})},r.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},r.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),IG(this.gl,e,t,n)},r.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},r.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var a=Te(Cl(t,n),2),i=a[0],o=a[1];this.setOutputMatrixTextureDriver(e,i,o)},r.prototype.setOutputMatrixWriteRegion=function(e,t,n,a){this.setOutputMatrixWriteRegionDriver(n,e,a,t)},r.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,a){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},r.prototype.debugValidate=function(){this.program!=null&&Ng(this.gl,this.program),sp(this.gl)},r.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;if(this.debug){var t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Pe(e,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},r.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Pe(this.gl,function(){return e.gl.finish()})},r.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=op(this.gl,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},r.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},r.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},r.prototype.beginQuery=function(){if(k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var a=this.getQueryTimerExtensionWebGL1(),i=a.createQueryEXT();return a.beginQueryEXT(a.TIME_ELAPSED_EXT,i),i},r.prototype.endQuery=function(){if(k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2();e.endQuery(t.TIME_ELAPSED_EXT);return}var n=this.getQueryTimerExtensionWebGL1();n.endQueryEXT(n.TIME_ELAPSED_EXT)},r.prototype.waitForQueryAndGetTime=function(e){return El(this,void 0,void 0,function(){var t=this;return Il(this,function(n){switch(n.label){case 0:return[4,k.util.repeatedTry(function(){return t.disposed||t.isQueryAvailable(e,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(e,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},r.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var n=this.gl,a=n.getQueryParameter(e,n.QUERY_RESULT);return a/1e6}else{var i=this.getQueryTimerExtensionWebGL1(),a=i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT);return a/1e6}},r.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var n=this.gl,a=this.getQueryTimerExtensionWebGL2(),i=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{var a=this.getQueryTimerExtensionWebGL1(),i=a.getQueryObjectEXT(e,a.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),i&&!this.disjoint}},r.prototype.pollFence=function(e){var t=this;return new Promise(function(n){t.addItemToPoll(function(){return e.isFencePassed()},function(){return n()})})},r.prototype.pollItems=function(){for(var e=k7e(this.itemsToPoll.map(function(a){return a.isDoneFn})),t=0;t<=e;++t){var n=this.itemsToPoll[t].resolveFn;n()}this.itemsToPoll=this.itemsToPoll.slice(e+1)},r.prototype.addItemToPoll=function(e,t){var n=this;if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),!(this.itemsToPoll.length>1)){var a=void 0;"setTimeoutCustom"in k.env().platform&&(a=k.env().platform.setTimeoutCustom.bind(k.env().platform)),k.util.repeatedTry(function(){return n.pollItems(),n.itemsToPoll.length===0},function(){return 0},null,a)}},r.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),Tg(this.gl,e,this.framebuffer),this.debug&&sp(this.gl)},r.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(Tg(this.gl,this.outputTexture,this.framebuffer),this.debug&&sp(this.gl)):q2(this.gl,this.framebuffer)},r.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},r.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var a=this.gl;Tg(a,e,this.framebuffer),this.debug&&sp(a),this.outputTexture=e,Pe(a,function(){return a.viewport(0,0,t,n)}),Pe(a,function(){return a.scissor(0,0,t,n)})},r.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,a){var i=this;this.throwIfDisposed(),Pe(this.gl,function(){return i.gl.scissor(e,t,n,a)})},r.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},r.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},r}();function k7e(r){for(var e=0;e<r.length;++e){var t=r[e]();if(!t)break}return e-1}function S7e(r){for(var e=new Float32Array(r.length),t=0;t<r.length;++t)e[t]=Math.abs(r[t]);return e}function qa(r){return function(e,t,n,a,i){var o=k.backend_util.assertAndGetBroadcastShape(e,t),s=o.length,u=k.util.computeStrides(o),c=k.util.sizeFromShape(o),l=k.util.getTypedArrayFromDType(i,c),f=e.length,h=t.length,p=k.util.computeStrides(e),d=k.util.computeStrides(t),m=k.backend_util.getBroadcastDims(e,o),v=k.backend_util.getBroadcastDims(t,o);if(m.length+v.length===0)for(var g=0;g<l.length;++g)l[g]=r(n[g%n.length],a[g%a.length]);else for(var y=function(w){var b=k.util.indexToLoc(w,s,u),x=b.slice(-f);m.forEach(function(C){return x[C]=0});var S=k.util.locToIndex(x,f,p),T=b.slice(-h);v.forEach(function(C){return T[C]=0});var E=k.util.locToIndex(T,h,d);l[w]=r(n[S],a[E])},g=0;g<l.length;++g)y(g);return[l,o]}}function N7e(r,e,t,n){if(n==="int32"){var a=Int32Array.from(r);return[e,"int32",a]}if(n==="bool"){var i=k.util.toTypedArray([0],t),o=Te(qa(function(c,l){return c!==l?1:0})(e,[],r,i,"bool"),2),s=o[0],u=o[1];return[u,"bool",s]}throw new Error("Error in Cast: failed to cast ".concat(t," to ").concat(n))}var T7e=qa(function(r,e){return r+e});function E7e(r,e,t,n,a){for(var i=k.util.sizeFromShape(n),o=k.util.makeZerosTypedArray(a,t),s=0;s<r.length;s++){var u=r[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(i>0?o[u]+=e[s]:o[u]+=1)}return o}function I7e(r,e,t,n){n===void 0&&(n=!1);for(var a=r.shape[0],i=r.shape[1],o=k.buffer([a,t],e.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=r.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=t||(n?o.set(1,s,c):e.size>0?o.set(o.get(s,c)+e.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o}var C7e=qa(function(r,e){return r&e});function Oo(r){return function(e,t,n){for(var a=k.util.getArrayFromDType(t,e.length),i=0;i<e.length;++i)a[i]=r(e[i],n);return a}}var A7e=Oo(function(r){return Math.ceil(r)});function D7e(r,e,t,n){var a=k.util.getArrayFromDType(t,k.util.sizeFromShape(e));if(n&&t!=="string"){var i=0;r.forEach(function(s){var u=k.util.sizeFromShape(s.shape);a.set(s.vals,i),i+=u})}else{var o=0;r.forEach(function(s){for(var u=t==="string"?k.backend_util.fromUint8ToStringArray(s.vals):s.vals,c=0,l=0;l<s.shape[0];++l)for(var f=l*e[1]+o,h=0;h<s.shape[1];++h)a[f+h]=u[c++];o+=s.shape[1]})}return a}var _7e=qa(function(r,e){return r===e?1:0});var F7e=Oo(function(r){return Math.exp(r)});var R7e=Oo(function(r){return Math.expm1(r)});var O7e=Oo(function(r){return Math.floor(r)});function P7e(r,e,t,n,a,i,o,s,u){for(var c=k.buffer([n,i],t),l=0;l<n;l++){for(var f=[],h=0,p=0;p<a;p++){var d=r[l*a+p];h+=d*o[p],f.push(d)}if(h<0||h>=u/i)throw new Error("Invalid indices: ".concat(f," does not index into ").concat(s));for(var m=0;m<i;m++)c.values[l*i+m]=e.get.apply(e,Sr([],Te(e.indexToLoc(h*i+m)),!1))}return c}function M7e(r,e,t){for(var n=k.buffer(t,r.dtype),a=0;a<n.size;++a){var i=n.indexToLoc(a),o=i.slice(),s=o[0],u=o[2],c=e.locToIndex([s,u]);o[2]=e.values[c];var l=r.locToIndex(o);0<=l&&l<r.values.length&&(n.values[a]=r.values[l])}return n}var B7e=qa(function(r,e){return r>e?1:0});var L7e=qa(function(r,e){return r>=e?1:0});var q7e=qa(function(r,e){return r<e?1:0});var z7e=qa(function(r,e){return r<=e?1:0});function $7e(r,e,t){var n=(e-r)/(t-1),a=k.util.makeZerosTypedArray(t,"float32");a[0]=r;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return a}var W7e=Oo(function(r){return Math.log(r)});function U7e(r,e,t,n){for(var a=k.util.getTypedArrayFromDType(n,k.util.sizeFromShape(t)),i=0;i<a.length;++i){for(var o=i*e,s=r[o],u=0;u<e;++u){var c=r[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a}var V7e=qa(function(r,e){return Math.max(r,e)});var G7e=qa(function(r,e){return Math.min(r,e)});var a6=qa(function(r,e){return r*e});function H7e(r,e,t){var n=k.util.createScalarValue(-1,t);return a6([],e,n,r,t)}var j7e=qa(function(r,e){return r!==e?1:0});function K7e(r,e,t,n,a){for(var i=e.length,o=k.util.sizeFromShape(e),s=k.util.computeStrides(e),u=k.util.computeStrides(a),c=k.util.getTypedArrayFromDType(t,k.util.sizeFromShape(a)),l=0;l<o;++l){for(var f=k.util.indexToLoc(l,i,s),h=new Array(f.length),p=0;p<h.length;p++)h[p]=f[n[p]];var d=k.util.locToIndex(h,i,u);c[d]=r[l]}return c}function X7e(r,e,t,n){for(var a=Te(k.backend_util.computeOutAndReduceShapes(r,n),2),i=a[0],o=a[1],s=k.upcastType(e,"int32"),u=k.util.makeZerosTypedArray(k.util.sizeFromShape(i),s),c=k.util.sizeFromShape(o),l=0;l<u.length;++l){for(var f=l*c,h=1,p=0;p<c;++p)h*=t[f+p];u[l]=h}return{outVals:u,outShape:i,outDtype:s}}function Y7e(r,e,t){r.forEach(function(n,a){if(n<0||n>=t){var i=k.util.indexToLoc(a,e.length,k.util.computeStrides(e)).join(",");throw new Error("indices[".concat(i,"] = ").concat(n," is not in [0, ").concat(t,")"))}})}function J7e(r,e){for(var t=0;t<r.length;++t){var n=r[t],a=t===r.length-1?e:r[t+1].length;if(n.length===0)throw new Error("Ragged splits may not be empty");if(n[0]<0)throw new Error("Ragged splits must be non-negative");if(n[n.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<n.length;++i)if(n[i-1]>n[i])throw new Error("Ragged splits must be sorted in ascending order")}}function Z7e(r,e,t,n){var a=[],i=0,o=e.length-1+t.length,s=new Array(o).fill(null).map(function(){return[0]});J7e(t,n);for(var u=1,c=0;c<e.length-1;++c){u*=e[c];for(var l=e[c+1],f=1;f<u+1;++f)s[c].push(f*l)}for(var f=0;f<r.length;++f){for(var h=r[f],p=r[f]+1,c=0;c<t.length;++c){var d=t[c],m=c+e.length-1;if(m>=0)for(var v=s[m],g=v[v.length-1]-d[h],y=h;y<p;++y)s[m].push(d[y+1]+g);h=d[h],p=d[p]}p!==h&&(a.push([h,p]),i+=p-h)}return{outSplits:s,valueSlices:a,numValues:i}}function Q7e(r){for(var e=[],t=function(a){var i=r[a].length,o=k.util.getArrayFromDType("int32",i);e.push(o),r[a].forEach(function(s,u){return o[u]=s})},n=0;n<r.length;++n)t(n);return e}function LV(r,e){for(var t=r.slice(0,e);t.length<e;)t.push(1);for(var n=e;n<r.length;n++)t[e-1]*=r[n];return t}function eXe(r,e,t,n,a,i){var o,s,u=LV(e,2)[1],c=LV(i,2)[1],l=0;try{for(var f=Pn(t),h=f.next();!h.done;h=f.next())for(var p=h.value,d=p[0];d<p[1];++d){for(var m=0;m<n;++m)a[l*c+m]=r[d*u+m];++l}}catch(v){o={error:v}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}}function tXe(r,e,t,n,a){var i=e.slice();i[0]=a;var o=k.util.getArrayFromDType(t,k.util.sizeFromShape(i)),s=r.length,u=s===0?0:s/e[0];return eXe(r,e,n,u,o,i),[o,i]}function rXe(r,e,t,n,a,i,o,s){if(r.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");var u=e[0][0]-1;if(Y7e(i,o,u),n.length===0)throw new Error("params.rank must be nonzero");var c=n[0],l=Z7e(i,o,r,c),f=l.outSplits,h=l.valueSlices,p=l.numValues,d=Q7e(f),m=tXe(t,n,a,h,p);return[d,m[0],m[1]]}var qV=2147483647;function nXe(r,e,t,n,a,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");var s=e.length===0,u=a.length===0,c=o.length===0,l=[];s||l.push(e[0]),u||l.push(a[0]),c||l.push(o[0]);for(var f=1;f<l.length;++f)if(l[f]!==l[f-1])throw new Error("starts, limits, and deltas must have the same shape");var h=l.length===0?1:l[0],p=k.util.getArrayFromDType("int32",h+1);p[0]=0;for(var d=0;d<h;++d){var m=s?r[0]:r[d],v=u?n[0]:n[d],g=c?i[0]:i[d];if(g===0)throw new Error("Requires delta != 0");var y=void 0;if(g>0&&v<m||g<0&&v>m)y=0;else if(y=Math.ceil(Math.abs((v-m)/g)),y>qV)throw new Error("Requires ((limit - start) / delta) <= ".concat(qV));p[d+1]=p[d]+y}for(var w=p[h],b=k.util.getArrayFromDType(t,w),x=0,d=0;d<h;++d)for(var S=p[d+1]-p[d],T=s?r[0]:r[d],g=c?i[0]:i[d],f=0;f<S;++f)b[x++]=T,T+=g;return[p,b]}var mi=k.backend_util.RowPartitionType,aXe=function(){function r(e,t,n,a,i,o,s,u,c,l){this.shape=e,this.shapeShape=t,this.values=n,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=k.backend_util.getRowPartitionTypesHelper(l),this.raggedRank=k.backend_util.getRaggedRank(this.rowPartitionTypes)}return r.prototype.getRowPartitionTypeByDimension=function(e){return this.rowPartitionTypes[0]===mi.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]},r.prototype.getRowPartitionTensor=function(e){return this.rowPartitionTypes[0]===mi.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]},r.prototype.getMaxWidth=function(e){var t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case mi.VALUE_ROWIDS:return r.getMaxWidthValueRowID(t);case mi.ROW_SPLITS:return r.getMaxWidthRowSplit(t);default:throw new Error("Cannot handle partition type ".concat(mi[this.getRowPartitionTypeByDimension(e-1)]))}},r.getMaxWidthRowSplit=function(e){var t=e.length;if(t===0||t===1)return 0;for(var n=0,a=0;a<t-1;++a){var i=e[a+1]-e[a];i>n&&(n=i)}return n},r.getMaxWidthValueRowID=function(e){var t=e.length;if(t===0)return 0;for(var n=0,a=e[0],i=0,o=1;o<t;++o){var s=e[o];s!==a&&(a=s,i=Math.max(o-n,i),n=o)}return Math.max(t-n,i)},r.prototype.tensorShapeFromTensor=function(e,t,n){if(n===void 0&&(n=!0),t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return $V(e,n)},r.prototype.calculateOutputSize=function(e){var t=this.valuesShape,n=this.defaultValueShape;k.backend_util.validateDefaultValueShape(n,t);var a=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=k.backend_util.combineRaggedTensorToTensorShapes(this.raggedRank,a,t),o=i;o[0]<0&&(o[0]=e);for(var s=1;s<=this.raggedRank;++s)o[s]<0&&(o[s]=this.getMaxWidth(s));return o},r.prototype.calculateFirstParentOutputIndex=function(e,t,n){for(var a=Math.min(e,n),i=[],o=0,s=0;s<a;++s,o+=t)i.push(o);for(var s=a;s<e;++s)i.push(-1);return k.util.assert(i.length===e,function(){return"Final length of result must be equal to firstDimension."}),i},r.prototype.calculateOutputIndexRowSplit=function(e,t,n,a){for(var i=e.length,o=[],s=0;s<i-1;++s){var u=e[s+1]-e[s],c=Math.min(a,u),l=t[s];l===-1&&(c=0);for(var f=0;f<c;++f)o.push(l),l+=n;for(var f=0;f<u-c;++f)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o},r.prototype.calculateOutputIndexValueRowID=function(e,t,n,a){var i=e.length,o=[];if(i===0)return[];var s=0,u=e[0];if(u>=t.length)throw new Error("Got currentValueRowId=".concat(u,", which is not less than ").concat(t.length));var c=t[u];o.push(c);for(var l=1;l<i;++l){var f=e[l];if(f===u)c>=0&&(++s,s<a?c+=n:c=-1);else{if(s=0,u=f,f>=t.length)throw new Error("Got nextValueRowId=".concat(f," which is not less than ").concat(t.length));c=t[f]}o.push(c)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o},r.prototype.calculateOutputIndex=function(e,t,n,a){var i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case mi.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,n,a);case mi.ROW_SPLITS:if(i.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(i.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(i,t,n,a);default:throw new Error("Unsupported partition type: ".concat(mi[o]))}},r.prototype.getFirstDimensionSize=function(){var e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case mi.FIRST_DIM_SIZE:return e[0];case mi.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case mi.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(mi[t]))}},r.prototype.compute=function(){var e=this.rowPartitionValues[0];if(e.length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var t=this.getFirstDimensionSize(),n=this.calculateOutputSize(t),a=new Array(this.raggedRank+1);a[a.length-1]=1;for(var i=a.length-2;i>=0;--i)a[i]=a[i+1]*n[i+1];var o=$V(n,!1),s=k.util.getArrayFromDType(this.valuesDType,k.util.sizeFromShape(o)),u=a[0]*n[0];if(u>0){for(var c=this.calculateFirstParentOutputIndex(t,a[0],n[0]),i=1;i<=this.raggedRank;++i){var l=this.calculateOutputIndex(i-1,c,a[i],n[i]);c=l}this.setOutput(this.raggedRank,c,s,o)}return[o,s]},r.prototype.setOutput=function(e,t,n,a){if(n.length!==0){var i=this.values,o=n,s=a.slice();s=s.slice(e+1);var u=k.util.sizeFromShape(s),c=t.length,l=this.defaultValue;if(l.length!==u&&l.length!==1){var f=this.defaultValueShape;k.tidy(function(){var x=k.reshape(l,f),S=k.broadcastTo(x,s);l=S.dataSync()})}for(var h=0,p=0,d=0,m=0;m<=c;++m){var v=m<c?t[m]:-1;if(v===d){++d;continue}if(p<d){var g=i.subarray(h*u),y=o.subarray(p*u),w=(d-p)*u;zV(y,g,w)}if(m>=c){var b=n.length;v=Math.floor(b/u)}if(v>d)if(this.defaultValue.length===1)o.subarray(d*u,v*u).fill(this.defaultValue[0]),d=v;else for(;v>d;){var y=o.slice(d*u);zV(y,l,u),++d}v<0?(h=m+1,p=d):(h=m,p=d,d=p+1)}}},r}();function zV(r,e,t){for(var n=0;n<t;n++)r[n]=e[n]}function $V(r,e){var t,n,a=[];try{for(var i=Pn(r),o=i.next();!o.done;o=i.next()){var s=o.value;if(s<0){if(!e)throw new Error("Dimension ".concat(s," must be >= 0"));if(s<-1)throw new Error("Dimension ".concat(s," must be >= -1"));s=-1}a.push(s)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a}function iXe(r,e,t,n,a,i,o,s,u,c){return new aXe(r,e,t,n,a,i,o,s,u,c).compute()}function oXe(r,e,t,n){var a=r===e,i=r<e&&t<0,o=e<r&&t>1;if(a||i||o)return k.util.makeZerosTypedArray(0,n);var s=Math.abs(Math.ceil((e-r)/t)),u=k.util.makeZerosTypedArray(s,n);e<r&&t===1&&(t=-1),u[0]=r;for(var c=1;c<u.length;c++)u[c]=u[c-1]+t;return u}var sXe=Oo(function(r){return 1/Math.sqrt(r)});function uXe(r,e,t,n,a,i,o,s,u,c){var l=[n/a,a],f=r.values,h=e.values;if(n===0)return k.buffer(t,e.dtype);var p=u instanceof k.TensorBuffer?u:k.buffer(l,e.dtype);typeof u=="string"||typeof u=="number"?p.values.fill(u):typeof u=="boolean"&&p.values.fill(+u);for(var d=0;d<i;d++){for(var m=[],v=0,g=0;g<o;g++){var y=f[d*o+g];m.push(y),v+=y*s[g]}if(v<0||v>=n/a)throw new Error("Invalid indices: ".concat(m," does not index into ").concat(t));for(var w=0;w<a;w++)c?p.values[v*a+w]+=h[d*a+w]:p.values[v*a+w]=e.rank===0?h[0]:h[d*a+w]}return p}var cXe=Oo(function(r){return 1/(1+Math.exp(-r))});function lXe(r,e,t,n,a){var i=k.slice_util.isSliceContinous(n,e,t),o=k.util.sizeFromShape(t),s=k.util.computeStrides(n);if(i){var u=k.slice_util.computeFlatOffset(e,s);return a==="string"?r.slice(u,u+o):r.subarray(u,u+o)}for(var c=a==="string"?k.backend_util.fromUint8ToStringArray(r):r,l=k.buffer(n,a,c),f=k.buffer(t,a),h=0;h<f.size;++h){var p=f.indexToLoc(h),d=p.map(function(m,v){return m+e[v]});f.set.apply(f,Sr([l.get.apply(l,Sr([],Te(d),!1))],Te(p),!1))}return a==="string"?k.backend_util.fromStringArrayToUint8(f.values):f.values}function fXe(r,e,t,n,a,i,o){var s=e[0],u=i[0],c=new Array(u),l=new Array(s),f=e[1];if(u===0){if(s!==0)throw new Error(k.backend_util.getSparseFillEmptyRowsIndicesDenseShapeMismatch(s));var h=k.util.getArrayFromDType(t,0),p=k.util.getArrayFromDType(a,0);return[h,[0,f],p,c,l]}for(var d=!0,m=0,v=new Array(u).fill(0),g=0;g<s;++g){var y=r[g*f];if(y<0)throw new Error(k.backend_util.getSparseFillEmptyRowsNegativeIndexErrorMessage(g,y));if(y>=u)throw new Error(k.backend_util.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(g,y,u));++v[y],d=d&&y>=m,m=y}for(var w=!0,y=0;y<u;++y){var b=v[y]===0;c[y]=b,w=w&&!b,v[y]=Math.max(v[y],1),y>0&&(v[y]+=v[y-1])}if(w&&d){for(var h=r,p=n,g=0;g<s;++g)l[g]=g;return[h,[s,f],p,c,l]}else{for(var x=v[u-1],h=k.util.getArrayFromDType(t,x*f),p=k.util.getArrayFromDType(a,x),S=new Array(u).fill(0),g=0;g<s;++g){var y=r[g*f],T=S[y],E=(y===0?0:v[y-1])+T;S[y]++;for(var C=0;C<f;++C)h[E*f+C]=r[g*f+C];p[E]=n[g],l[g]=E}for(var y=0;y<u;++y){var R=S[y];if(R===0){var _=y===0?0:v[y-1];h[_*f+0]=y;for(var M=1;M<f;++M)h[_*f+M]=0;p[_]=o}}return[h,[x,f],p,c,l]}}function hXe(r,e,t,n,a){for(var i=k.util.sizeFromShape(n),o=e[0],s=a.length,u=[],c=1,l=-1,f=0;f<s;++f){var h=a[f];if(h===-1){if(l!==-1)throw new Error(k.backend_util.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(l,f));l=f,u.push(1)}else{if(h<0)throw new Error(k.backend_util.getSparseReshapeNegativeOutputDimErrorMessage(f,h));c*=h,u.push(h)}}if(l!==-1){if(c<=0)throw new Error(k.backend_util.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());var p=Math.trunc(i/c);if(c*p!==i)throw new Error(k.backend_util.getSparseReshapeInputOutputMultipleErrorMessage(n,u));u[l]=p}var d=k.util.sizeFromShape(u);if(d!==i)throw new Error(k.backend_util.getSparseReshapeInputOutputMismatchErrorMessage(n,u));var m=n.length,v=[];if(m>0){v[m-1]=1;for(var f=m-2;f>=0;--f)v[f]=v[f+1]*n[f+1]}var g=[];if(s>0){g[s-1]=1;for(var f=s-2;f>=0;--f)g[f]=g[f+1]*u[f+1]}for(var y=k.util.getArrayFromDType(t,o*s),w=0;w<o;++w){for(var b=0,x=0;x<m;++x)b+=r[w*m+x]*v[x];for(var x=0;x<s;++x)y[w*s+x]=Math.trunc(b/g[x]),b%=g[x]}return[y,[o,s],u]}function pXe(r,e,t,n,a,i,o){i===void 0&&(i=!1),o===void 0&&(o=0);var s=n.length,u=[e[0],r.length/e[0]],c=u[1],l=s>0?a[s-1]+1:0,f=l;if(f<0)throw new Error(k.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var h=e.slice();h[0]=f;var p=h.reduce(function(T,E){return T*E},1),d=k.util.getArrayFromDType(t,p);if(s===0)return f>0&&d.fill(o),[d,h];if(f<=0)throw new Error(k.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());for(var m=0,v=1,g=0,y=a[m];;){var w=0;if(v<s){if(w=a[v],y===w){++v;continue}if(y>=w)throw new Error(k.backend_util.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=f)throw new Error(k.backend_util.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,f));y>g&&d.fill(o,g*c,y*c);for(var b=m;b<v;++b){var x=n[b];if(x<0||x>=u[0])throw new Error(k.backend_util.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(b,n[b],u[0]));for(var S=0;S<c;S++)d[y*c+S]+=r[x*c+S]}if(i)for(var S=0;S<c;S++)d[y*c+S]/=v-m;if(m=v,++v,g=y+1,y=w,v>s)break}return g<f&&d.fill(o,g*c,f*c),[d,h]}var dXe=Oo(function(r){return Math.sqrt(r)});var vXe=Oo(function(r,e){var t=e.pattern,n=e.replaceGlobal,a=e.rewrite;return r.replace(new RegExp(t,n?"g":""),a)});function mXe(r,e,t,n){for(var a=k.buffer(r,e.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*t[u]+n[u];a.set.apply(a,Sr([e.get.apply(e,Sr([],Te(s),!1))],Te(o),!1))}return a}var gXe=function(){function r(e,t,n,a,i,o){this.separator=k.util.encodeString(e),this.nGramWidths=t,this.leftPad=k.util.encodeString(n),this.rightPad=k.util.encodeString(a),this.padWidth=i,this.preserveShort=o}return r.prototype.getPadWidth=function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)},r.prototype.getNumNGrams=function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)},r.prototype.createNGrams=function(e,t,n,a,i,o){for(var s=function(l){var f=u.getPadWidth(o),h=Math.max(0,f-l),p=Math.max(0,f-(i-(l+1))),d=o-(h+p),m=t+(h>0?0:l-f),v=0;v+=h*u.leftPad.length;for(var g=0;g<d;++g)v+=e[m+g].length;v+=p*u.rightPad.length;var y=h+p+d-1;v+=y*u.separator.length,n[a+l]=new Uint8Array(v);for(var w=n[a+l],b=0,x=function(S){return S.forEach(function(T){return w[b++]=T})},g=0;g<h;++g)x(u.leftPad),x(u.separator);for(var g=0;g<d-1;++g)x(e[m+g]),x(u.separator);if(d>0){x(e[m+d-1]);for(var g=0;g<p;++g)x(u.separator),x(u.rightPad)}else{for(var g=0;g<p-1;++g)x(u.rightPad),x(u.separator);x(u.rightPad)}},u=this,c=0;c<i;++c)s(c)},r.prototype.compute=function(e,t){var n=this,a=e.length,i=t.length;if(i>0){var o=t[0];if(o!==0)throw new Error("First split value must be 0, got ".concat(o));for(var s=1;s<i;++s){var u=t[s]>=o;if(u=u&&t[s]<=a,!u)throw new Error("Invalid split value ".concat(t[s],", must be in [").concat(o,", ").concat(a,"]"));o=t[s]}if(o!==a)throw new Error("Last split value must be data size. Expected ".concat(a,", got ").concat(o))}var c=i-1,l=k.util.getArrayFromDType("int32",i);if(a===0||i===0){for(var f=new Array(a),s=0;s<=c;++s)l[s]=0;return[f,l]}l[0]=0;for(var h=function(g){var y=t[g]-t[g-1],w=0;p.nGramWidths.forEach(function(b){w+=n.getNumNGrams(y,b)}),p.preserveShort&&y>0&&w===0&&(w=1),l[g]=l[g-1]+w},p=this,s=1;s<=c;++s)h(s);for(var d=new Array(l[c]),m=function(g){var y=t[g],w=l[g];if(v.nGramWidths.forEach(function(T){var E=t[g+1]-t[g],C=n.getNumNGrams(E,T);n.createNGrams(e,y,d,w,C,T),w+=C}),v.preserveShort&&w===l[g]){var b=t[g+1]-t[g];if(b===0)return"continue";var x=b+2*v.padWidth,S=1;v.createNGrams(e,y,d,w,S,x)}},v=this,s=0;s<c;++s)m(s);return[d,l]},r}();function yXe(r,e,t,n,a,i,o,s){return new gXe(t,n,a,i,o,s).compute(r,e)}function bXe(r,e,t,n){if(!!r.length){if(e.length===0){for(var a=0;a<r.length;++a)n.push(r.subarray(a,a+1));return}if(e.length===1){for(var i=e[0],o=r.indexOf(i);o!==-1;){var s=r.subarray(0,o);(!t||s.length!==0)&&n.push(s),r=r.subarray(o+1),o=r.indexOf(i)}(!t||r.length!==0)&&n.push(r);return}for(var u=0,a=0;a<r.length+1;a++)if(a===r.length||e.indexOf(r[a])!==-1){var s=r.subarray(u,a);(!t||s.length!==0)&&n.push(s),u=a+1}}}function wXe(r,e,t){for(var n=r.length,a=[],i=0,o=0,s=new Array(n),u=0;u<n;++u){var c=a.length;bXe(r[u],e,t,a);var l=a.length-c;s[u]=l,i+=l,o=Math.max(o,l)}for(var f=k.util.getArrayFromDType("int32",i*2),h=new Array(i),p=[n,o],d=0,u=0;u<n;++u)for(var m=0;m<s[u];++m)f[d*2]=u,f[d*2+1]=m,h[d]=a[d],++d;return[f,h,p]}function xXe(r,e){for(var t=k.util.getArrayFromDType("int32",r.length),n=0;n<r.length;++n)t[n]=k.util.fingerPrint64(r[n]).modulo(e).getLowBitsUnsigned();return t}var kXe=qa(function(r,e){return r-e});function SXe(r,e){for(var t=new Array(r.rank),n=0;n<t.length;n++)t[n]=r.shape[n]*e[n];for(var a=k.buffer(t,r.dtype),n=0;n<a.values.length;++n){for(var i=a.indexToLoc(n),o=new Array(r.rank),s=0;s<o.length;s++)o[s]=i[s]%r.shape[s];var u=r.locToIndex(o);a.values[n]=r.values[u]}return a}var cp=function(r,e){var t=e.value-r.value;return t===0?r.index-e.index:t};function i6(r,e,t,n){for(t===void 0&&(t=0),n===void 0&&(n=r.length-1);n>t;){if(n-t>600){var a=n-t+1,i=e-t+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2),c=Math.max(t,Math.floor(e-i*s/a+u)),l=Math.min(n,Math.floor(e+(a-i)*s/a+u));i6(r,e,c,l)}var f=r[e],h=t,p=n;for(k.util.swap(r,t,e),cp(r[n],f)>0&&k.util.swap(r,t,n);h<p;){for(k.util.swap(r,h,p),h++,p--;cp(r[h],f)<0;)h=h+1;for(;cp(r[p],f)>0;)p=p-1}cp(r[t],f)===0?k.util.swap(r,t,p):(p=p+1,k.util.swap(r,p,n)),p<=e&&(t=p+1),e<=p&&(n=p-1)}}function NXe(r,e,t,n,a){for(var i=e[e.length-1],o=Te([r.length/i,i],2),s=o[0],u=o[1],c=k.util.getTypedArrayFromDType(t,s*n),l=k.util.getTypedArrayFromDType("int32",s*n),f=function(d){var m=d*u,v=r.subarray(m,m+u),g=new Array(v.length);v.forEach(function(S,T){return g[T]={value:S,index:T}}),n<g.length&&(i6(g,n),g=g.slice(0,n)),a&&g.sort(cp);for(var y=d*n,w=c.subarray(y,y+n),b=l.subarray(y,y+n),x=0;x<n;x++)w[x]=g[x].value,b[x]=g[x].index},h=0;h<s;h++)f(h);var p=e.slice();return p[p.length-1]=n,[k.buffer(p,t,c),k.buffer(p,"int32",l)]}function TXe(r,e,t,n){for(var a=k.util.parseAxisParam(e,t)[0],i=[1,t[0],1],o=0;o<a;o++)i[0]*=t[o];i[1]=t[a];for(var o=a+1;o<t.length;o++)i[2]*=t[o];for(var s=new Map,u=new Int32Array(t[a]),c=new k.TensorBuffer(i,n,r),l=[],f=i[0]===1&&i[2]===1,o=0;o<t[a];o++){var h=void 0;if(f)h=r[o].toString();else{for(var p=[],d=0;d<i[0];d++)for(var m=0;m<i[2];m++)p.push(c.get(d,o,m));h=p.join(",")}var v=s.get(h);if(v!=null)u[o]=v;else{var g=s.size;s.set(h,g),u[o]=g,l.push(o)}}var y=i.slice();y[1]=s.size;var w=new k.TensorBuffer(y,n);l.forEach(function(x,S){for(var T=0;T<i[0];T++)for(var E=0;E<i[2];E++)w.set(c.get(T,x,E),T,S,E)});var b=t.slice();return b[a]=y[1],{outputValues:w.values,outputShape:b,indices:u}}var EXe=T7e,o6=E7e,IXe=I7e,CXe=C7e,AXe=N7e,DXe=A7e,_Xe=D7e,FXe=_7e,RXe=F7e,OXe=R7e,PXe=O7e,MXe=P7e,BXe=M7e,LXe=B7e,qXe=L7e,zXe=q7e,$Xe=z7e,WXe=$7e,UXe=W7e,VXe=U7e,GXe=V7e,HXe=G7e,jXe=a6,KXe=H7e,XXe=j7e,YXe=X7e,JXe=rXe,ZXe=nXe,QXe=iXe,e9e=oXe,t9e=sXe,r9e=uXe,n9e=cXe,s6=S7e,a9e=lXe,i9e=fXe,o9e=hXe,u6=pXe,s9e=dXe,u9e=vXe,c9e=mXe,l9e=yXe,f9e=wXe,h9e=xXe,p9e=kXe,d9e=SXe,v9e=NXe,tS=K7e,m9e=TXe;function c6(r,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return"".concat(r,".").concat(t)})}function On(r,e){return e===1?[r]:c6(r,e)}function g9e(r,e){if(r===1)return"rc";for(var t="",n=0;n<r;n++)t+=e[n],n<r-1&&(t+=",");return t}var y9e=function(){function r(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=En(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=On("rc",this.rank),n=Ht(this.rank),a=this.getOutOfBoundsCondition(t),i=this.getSetup(t),o=this.getOutput(t);this.userCode=`
        void main() {
          `.concat(n,` rc = getOutputCoords();

          if(`).concat(a,`) {
            setOutput(vec4(0));
          } else {
            `).concat(i,`

            setOutput(vec4(`).concat(o,`));
          }
        }
      `)}}return r.prototype.getSourceCoordsArr=function(e){for(var t=[],n=0;n<=1;n++)for(var a=0;a<=1;a++){for(var i="".concat(n===0?"r":"rp1",", ").concat(a===0?"c":"cp1"),o=2;o<this.rank;o++)i="".concat(e[e.length-1-o],",")+i;t.push(i)}return t},r.prototype.getOutOfBoundsCondition=function(e){if(this.rank===1)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);for(var t="",n=this.rank-2;n<this.rank;n++)t+="".concat(e[n]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(n,"]"):this.outputShape[n]),n<this.rank-1&&(t+="||");return t},r.prototype.getSetup=function(e){if(this.rank===1)return"";var t=e.slice(-2),n=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],a=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return`
      int r = `.concat(t[0],`;
      int c = `).concat(t[1],`;
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= `).concat(n,`;
      bool rEdge = rp1 >= `).concat(a,`;
    `)},r.prototype.getOutput=function(e){var t=this.getSourceCoordsArr(e);if(this.rank===1){var n=this.enableShapeUniforms?"outShape":this.outputShape[0];return"getA(rc), (rc + 1 >= ".concat(n," ? 0. : getA(rc + 1)), 0, 0")}return"getA(".concat(t[0],`),
            cEdge ? 0. : getA(`).concat(t[1],`),
            rEdge ? 0. : getA(`).concat(t[2],`),
            rEdge || cEdge ? 0. : getA(`).concat(t[3],")")},r}();var l6=function(){function r(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length);for(var n="",a=0;a<4;a++){var i="thisRC = rc;";a%2===1&&(i+="thisRC.z += 1;"),a>1&&(i+="thisRC.y += 1;"),n+=`
        `.concat(i,`
        `).concat(a>0?"if(thisRC.y < rows && thisRC.z < cols){":"",`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`).concat(a,`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `).concat(a>0?"}":"",`
      `)}this.userCode=`
      `.concat(b9e(t,this.enableShapeUniforms),`
      `).concat(this.enableShapeUniforms?K2():j2(e),`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `).concat(this.enableShapeUniforms?"outShape[1]":e[1],`;
        int cols = `).concat(this.enableShapeUniforms?"outShape[2]":e[2],`;

        `).concat(n,`

        setOutput(result);
      }
    `)}return r}();function b9e(r,e){var t=e?A8e(["r","c","d"],"inputShape"):rc(["r","c","d"],r);return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `.concat(t,`
      return ivec3(r, c, d);
    }
  `)}var w9e=function(){function r(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}return r.prototype.acquireTexture=function(e,t,n){var a=UV(t,n),i=VV(e,a,n);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);var o=WV(e,a,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[i].pop();return this.usedTextures[i].push(s),s}var u;return a===wn.PACKED_2X2_FLOAT32?u=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):a===wn.PACKED_2X2_FLOAT16?u=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):a===wn.UNPACKED_FLOAT32?u=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):a===wn.UNPACKED_FLOAT16?u=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):a===wn.PACKED_4X1_UNSIGNED_BYTE&&(u=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(u),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),u},r.prototype.releaseTexture=function(e,t,n,a){if(this.freeTextures!=null){var i=UV(n,a),o=VV(t,i,a);o in this.freeTextures||(this.freeTextures[o]=[]);var s=WV(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,a),u=k.env().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");u!==-1&&this._numBytesAllocated>u?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=s):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=s),this.numUsedTextures--;var c=this.usedTextures[o],l=c&&c.indexOf(e);if(l==null||l<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c[l]=c[c.length-1],c.pop(),this.log()}},r.prototype.log=function(){if(!!this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}},Object.defineProperty(r.prototype,"numBytesAllocated",{get:function(){return this._numBytesAllocated},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"numBytesFree",{get:function(){return this._numBytesFree},enumerable:!1,configurable:!0}),r.prototype.getNumUsedTextures=function(){return this.numUsedTextures},r.prototype.getNumFreeTextures=function(){return this.numFreeTextures},r.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(n){e.gpgpu.deleteMatrixTexture(n.texture)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(a){e.gpgpu.deleteMatrixTexture(a.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}},r}();function x9e(r,e){var t=r;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===r.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error("Unknown internal format ".concat(e))}function WV(r,e,t,n,a){var i=k9e(e,n),o;if(a){var s=Te(Cl(r[0],r[1]),2),u=s[0],c=s[1];o=u*c}else{var l=Te(mp(r[0],r[1]),2),f=l[0],h=l[1];o=f*h}var p=x9e(t,i);return o*p}function k9e(r,e){switch(r){case wn.PACKED_2X2_FLOAT32:return Q2(e);case wn.PACKED_2X2_FLOAT16:return eS(e);case wn.UNPACKED_FLOAT32:return Y2(e);case wn.UNPACKED_FLOAT16:return J2(e);case wn.PACKED_4X1_UNSIGNED_BYTE:return Z2(e);default:throw new Error("Unknown physical texture type ".concat(r))}}function S9e(r){return k.env().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?r?wn.PACKED_2X2_FLOAT32:wn.UNPACKED_FLOAT32:r?wn.PACKED_2X2_FLOAT16:wn.UNPACKED_FLOAT16}function UV(r,e){if(r===Ba.UPLOAD)return wn.PACKED_2X2_FLOAT32;if(r===Ba.RENDER||r==null)return S9e(e);if(r===Ba.DOWNLOAD||r===Ba.PIXELS)return wn.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(r))}function VV(r,e,t){return"".concat(r[0],"_").concat(r[1],"_").concat(e,"_").concat(t)}var io=function(){function r(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        `.concat(t,`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `)}return r}(),gi="if (isnan(x)) return x;",N9e="return x;",GV="return abs(x);",T9e="return (x >= 0.0) ? x : (exp(x) - 1.0);",E9e=gi+`
  return (x < 0.0) ? 0.0 : x;
`,I9e=gi+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Rs="return x;",C9e="return 1.0 / (1.0 + exp(-1.0 * x));";var A9e="return x;",D9e=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,_9e=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,F9e=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,R9e="return 1.0 / (1.0 + exp(-1.0 * x));",Os=function(){function r(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `.concat(t,`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `)}return r}();var O9e=function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length);var t=e.length,n=On("rc",t),a=Ht(t),i=g9e(t,n),o=n.slice(-2),s=t<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode=`
      void main() {
        `.concat(a,` rc = getOutputCoords();
        vec4 packedInput = getA(`).concat(i,`);

        setOutput(getChannel(packedInput, `).concat(s,`));
      }
    `)}return r}(),P9e=k.kernel_impls.whereImpl,M9e=1e-7,B9e=1e-4,kg={};function L9e(r){return r in kg||(kg[r]={}),kg[r]}var q9e=k.env().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),z9e=600;function $9e(){return k.env().global.screen==null?1024:k.env().global.screen.height*k.env().global.screen.width*window.devicePixelRatio*z9e/1024/1024}var rS=function(r){h8e(e,r);function e(t){var n=r.call(this)||this;if(n.pendingRead=new WeakMap,n.pendingDisposal=new WeakSet,n.dataRefCount=new WeakMap,n.numBytesInGPU=0,n.uploadWaitMs=0,n.downloadWaitMs=0,n.lastGlFlushTime=0,n.warnedAboutMemory=!1,n.pendingDeletes=0,n.disposed=!1,!k.env().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");var a;if(t!=null){if(t instanceof Cg)a=t;else{var i=Wi(k.env().getNumber("WEBGL_VERSION"),t);a=new Cg(i)}n.binaryCache={},n.gpgpuCreatedLocally=!1}else{var i=Wi(k.env().getNumber("WEBGL_VERSION"));a=new Cg(i),n.binaryCache=L9e(k.env().getNumber("WEBGL_VERSION")),n.gpgpuCreatedLocally=!0}return n.gpgpu=a,n.canvas=n.gpgpu.gl.canvas,n.textureManager=new w9e(n.gpgpu),n.numMBBeforeWarning=$9e(),n.texData=new k.DataStorage(n,k.engine()),n}return e.prototype.nextDataId=function(){return e.nextDataId++},e.prototype.numDataIds=function(){return this.texData.numDataIds()-this.pendingDeletes},e.prototype.writeTexture=function(t,n,a,i,o,s){var u=this.makeTensorInfo(n,a),c=this.texData.get(u.dataId);c.isPacked=!1,c.texture={texture:t,texShape:[i,o]},c.texShape=[i,o];var l=up(n),f=new BV(l,!1,s),h=this.runWebGLProgram(f,[u],a,[[i,o]]);return h.shape=n,c.texture=null,this.disposeIntermediateTensorInfo(u),h.dataId},e.prototype.write=function(t,n,a){if((k.env().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||k.env().getBool("DEBUG"))&&this.checkNumericalProblems(t),a==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var i={id:this.nextDataId()};return this.texData.set(i,{shape:n,dtype:a,values:t,usage:Ba.UPLOAD,refCount:1}),i},e.prototype.refCount=function(t){if(this.texData.has(t)){var n=this.texData.get(t);return n.refCount}return 0},e.prototype.incRef=function(t){var n=this.texData.get(t);n.refCount++},e.prototype.decRef=function(t){if(this.texData.has(t)){var n=this.texData.get(t);n.refCount--}},e.prototype.move=function(t,n,a,i,o){if(k.env().getBool("DEBUG")&&this.checkNumericalProblems(n),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:a,dtype:i,values:n,usage:Ba.UPLOAD,refCount:o})},e.prototype.disposeIntermediateTensorInfo=function(t){this.disposeData(t.dataId)},e.prototype.readSync=function(t){var n=this.texData.get(t),a=n.values,i=n.dtype,o=n.complexTensorInfos,s=n.slice,u=n.shape,c=n.isPacked;if(s!=null){var l=void 0;c?l=new Os(u,Rs):l=new io(u,Rs);var f=this.runWebGLProgram(l,[{dataId:t,shape:u,dtype:i}],i),h=this.readSync(f.dataId);return this.disposeIntermediateTensorInfo(f),h}if(a!=null)return this.convertAndCacheOnCPU(t);if(i==="string")return a;var p=this.activeTimers!=null,d;p&&(d=k.util.now());var m;if(i==="complex64"){var v=this.readSync(o.real.dataId),g=this.readSync(o.imag.dataId);m=k.backend_util.mergeRealAndImagArrays(v,g)}else m=this.getValuesFromTexture(t);return p&&(this.downloadWaitMs+=k.util.now()-d),this.convertAndCacheOnCPU(t,m)},e.prototype.read=function(t){return El(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S,T,E,C;return Il(this,function(R){switch(R.label){case 0:if(this.pendingRead.has(t))return n=this.pendingRead.get(t),[2,new Promise(function(_){return n.push(_)})];if(a=this.texData.get(t),i=a.values,o=a.shape,s=a.slice,u=a.dtype,c=a.complexTensorInfos,l=a.isPacked,s!=null)return f=void 0,l?f=new Os(o,Rs):f=new io(o,Rs),h=this.runWebGLProgram(f,[{dataId:t,shape:o,dtype:u}],u),p=this.read(h.dataId),this.disposeIntermediateTensorInfo(h),[2,p];if(i!=null)return[2,this.convertAndCacheOnCPU(t)];if(k.env().getBool("DEBUG")&&!k.env().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&k.env().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return d=null,u!=="complex64"&&k.env().get("WEBGL_BUFFER_SUPPORTED")&&(m=this.decode(t),v=this.texData.get(m.dataId),d=(C=this.gpgpu).createBufferFromTexture.apply(C,Sr([v.texture.texture],Te(wg(o)),!1))),this.pendingRead.set(t,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:R.sent(),R.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([this.read(c.real.dataId),this.read(c.imag.dataId)])];case 3:return y=R.sent(),w=y[0],b=y[1],g=k.backend_util.mergeRealAndImagArrays(w,b),[3,5];case 4:d==null?g=this.getValuesFromTexture(t):(x=k.util.sizeFromShape(o),g=this.gpgpu.downloadFloat32MatrixFromBuffer(d,x)),R.label=5;case 5:return m!=null&&this.disposeIntermediateTensorInfo(m),d!=null&&(S=this.gpgpu.gl,Pe(S,function(){return S.deleteBuffer(d)})),T=this.convertAndCacheOnCPU(t,g),E=this.pendingRead.get(t),this.pendingRead.delete(t),E.forEach(function(_){return _(T)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&k.engine().removeDataId(t,this),this.pendingDeletes--),[2,T]}})})},e.prototype.readToGPU=function(t,n){n===void 0&&(n={});var a=this.texData.get(t),i=a.values,o=a.shape,s=a.slice,u=a.dtype,c=a.isPacked,l=a.texture;if(u==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(s!=null){var f=void 0;c?f=new Os(o,Rs):f=new io(o,Rs);var h=this.runWebGLProgram(f,[{dataId:t,shape:o,dtype:u}],u),p=this.readToGPU(h,n);return this.disposeIntermediateTensorInfo(h),p}if(l==null)throw i!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");var d=this.decode(t,n.customTexShape),m=k.engine().makeTensorFromTensorInfo(d),v=this.texData.get(d.dataId);return Object.assign({tensorRef:m},v.texture)},e.prototype.bufferSync=function(t){var n=this.readSync(t.dataId);if(t.dtype==="string")try{var a=n.map(function(i){return k.util.decodeString(i)});return k.buffer(t.shape,t.dtype,a)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return k.buffer(t.shape,t.dtype,n)},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var n=0;n<t.length;n++){var a=t[n];if(!pG(a))throw k.env().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value ".concat(a," cannot be represented with your ")+"current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value ".concat(a," cannot be represented on this device."))}},e.prototype.getValuesFromTexture=function(t){var n,a=this.texData.get(t),i=a.shape,o=a.dtype,s=a.isPacked,u=k.util.sizeFromShape(i);if(k.env().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var c=this.decode(t),l=this.texData.get(c.dataId),f=(n=this.gpgpu).downloadMatrixFromPackedTexture.apply(n,Sr([l.texture.texture],Te(wg(i)),!1)).subarray(0,u);return this.disposeIntermediateTensorInfo(c),f}var h=k.env().getBool("WEBGL_PACK")&&s===!0,p=h?up(i):i,d=h?new y7e(p):new g7e(p),m=this.runWebGLProgram(d,[{shape:p,dtype:o,dataId:t}],"float32"),v=this.texData.get(m.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(v.texture.texture,v.texShape[0],v.texShape[1]).subarray(0,u);return this.disposeIntermediateTensorInfo(m),g},e.prototype.timerAvailable=function(){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0},e.prototype.time=function(t){var n=this,a=this.activeTimers,i=[],o=!1;this.programTimersStack==null?(this.programTimersStack=i,o=!0):this.activeTimers.push(i),this.activeTimers=i,t();var s=k.util.flatten(this.activeTimers.map(function(l){return l.query})).filter(function(l){return l!=null}),u=k.util.flatten(this.activeTimers.map(function(l){return l.name})).filter(function(l){return l!=null});this.activeTimers=a,o&&(this.programTimersStack=null);var c={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return function(){return El(n,void 0,void 0,function(){var l;return Il(this,function(f){switch(f.label){case 0:return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(s)]:[3,2];case 1:return l=f.sent(),c.kernelMs=k.util.sum(l),c.getExtraProfileInfo=function(){return l.map(function(h,p){return{name:u[p],ms:h}}).map(function(h){return"".concat(h.name,": ").concat(h.ms)}).join(", ")},[3,3];case 2:c.kernelMs={error:"WebGL query timers are not supported in this environment."},f.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,c]}})})}()},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}},e.prototype.startTimer=function(){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:k.util.now(),endMs:null}},e.prototype.endTimer=function(t){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=k.util.now(),t)},e.prototype.getQueryTime=function(t){return El(this,void 0,void 0,function(){var n;return Il(this,function(a){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:(n=t,[2,n.endMs-n.startMs])})})},e.prototype.disposeData=function(t,n){if(n===void 0&&(n=!1),this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(n?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!n&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);var a=this.texData.get(t).complexTensorInfos;return a!=null&&(this.disposeData(a.real.dataId,n),this.disposeData(a.imag.dataId,n)),this.texData.delete(t),!0},e.prototype.releaseGPUData=function(t){var n=this.texData.get(t),a=n.texture,i=n.dtype,o=n.texShape,s=n.usage,u=n.isPacked,c=n.slice,l=c&&c.origDataId||t,f=this.dataRefCount.get(l);f>1?this.dataRefCount.set(l,f-1):(this.dataRefCount.delete(l),a!=null&&(this.numBytesInGPU-=this.computeBytes(o,i),this.textureManager.releaseTexture(a,o,s,u)));var h=this.texData.get(t);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.shouldExecuteOnCPU=function(t,n){var a=this;return n===void 0&&(n=q9e),k.env().getBool("WEBGL_CPU_FORWARD")&&t.every(function(i){return a.texData.get(i.dataId).texture==null&&k.util.sizeFromShape(i.shape)<n})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.where=function(t){k.backend_util.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var n=t.dataSync();return P9e(t.shape,n)},e.prototype.packedUnaryOp=function(t,n,a){var i=new Os(t.shape,n),o=this.compileAndRun(i,[t],a);return k.engine().makeTensorFromTensorInfo(o)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t])&&t.dtype!=="complex64"){var n=s6(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,n)}if(k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,GV,t.dtype);var a=new io(t.shape,GV),i=this.compileAndRun(a,[t]);return k.engine().makeTensorFromTensorInfo(i)},e.prototype.makeTensorInfo=function(t,n,a){var i;if(n==="string"&&a!=null&&a.length>0&&k.util.isString(a[0])){var o=a.map(function(s){return k.util.encodeString(s)});i=this.write(o,t,n)}else i=this.write(a,t,n);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:n}},e.prototype.makeOutput=function(t,n,a){return k.engine().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,a),this)},e.prototype.unpackTensor=function(t){var n=new O9e(t.shape);return this.runWebGLProgram(n,[t],t.dtype)},e.prototype.packTensor=function(t){var n=new y9e(t.shape),a=!0;return this.runWebGLProgram(n,[t],t.dtype,null,a)},e.prototype.packedReshape=function(t,n){var a=Sr([Qu(t.shape)],Te(ec(t.shape)),!1),i={dtype:t.dtype,shape:a,dataId:t.dataId},o=Sr([Qu(n)],Te(ec(n)),!1),s=new l6(o,a),u=!0,c=[a],l=this.runWebGLProgram(s,[i],t.dtype,c,u);return{dataId:l.dataId,shape:n,dtype:l.dtype}},e.prototype.decode=function(t,n){var a=this.texData.get(t),i=a.isPacked,o=a.shape,s=a.dtype;if(n!=null){var u=k.util.sizeFromShape(o),c=n[0]*n[1]*4;k.util.assert(u<=c,function(){return"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."})}var l=up(o),f;i?f=new m7e(l):f=new v7e(l);var h=!0,p=[n??wg(l)],d=this.runWebGLProgram(f,[{shape:l,dtype:s,dataId:t}],s,p,h,n);return{dtype:s,shape:o,dataId:d.dataId}},e.prototype.runWebGLProgram=function(t,n,a,i,o,s){var u=this;o===void 0&&(o=!1);var c=this.makeTensorInfo(t.outputShape,a),l=this.texData.get(c.dataId);if(t.packedOutput&&(l.isPacked=!0),t.outPackingScheme===fp.DENSE){var f=s??wg(t.outputShape);l.texShape=f.map(function(S){return S*2})}if(t.outTexUsage!=null&&(l.usage=t.outTexUsage),k.util.sizeFromShape(c.shape)===0)return l.values=k.util.getTypedArrayFromDType(c.dtype,0),c;var h=[],p=n.map(function(S){if(S.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var T=u.texData.get(S.dataId);if(T.texture==null){if(!t.packedInputs&&k.util.sizeFromShape(S.shape)<=k.env().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:S.shape,texData:null,isUniform:!0,uniformValues:T.values};t.packedInputs&&(T.isPacked=!0,T.shape=S.shape)}if(u.uploadToGPU(S.dataId),!!T.isPacked!=!!t.packedInputs)S=T.isPacked?u.unpackTensor(S):u.packTensor(S),h.push(S),T=u.texData.get(S.dataId);else if(T.isPacked&&!hp(T.shape,S.shape)){var E=S,C=S.shape;S.shape=T.shape,S=u.packedReshape(S,C),h.push(S),T=u.texData.get(S.dataId),E.shape=C}return{shape:S.shape,texData:T,isUniform:!1}});this.uploadToGPU(c.dataId);var d={shape:c.shape,texData:l,isUniform:!1},m=d7e(t,p,d),v=this.getAndSaveBinary(m,function(){return h7e(u.gpgpu,t,p,d)}),g=this.activeTimers!=null,y;g&&(y=this.startTimer()),k.env().get("ENGINE_COMPILE_ONLY")||p7e(this.gpgpu,v,p,d,i),h.forEach(function(S){return u.disposeIntermediateTensorInfo(S)}),g&&(y=this.endTimer(y),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(y)}));var w=k.env().getNumber("WEBGL_FLUSH_THRESHOLD");if(w>0){var b=k.util.now();b-this.lastGlFlushTime>w&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=b)}if(!k.env().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&o===!1){var x=this.unpackTensor(c);return this.disposeIntermediateTensorInfo(c),x}return c},e.prototype.compileAndRun=function(t,n,a,i,o){o===void 0&&(o=!1),a=a||n[0].dtype;var s=this.runWebGLProgram(t,n,a,i,o);return s},e.prototype.getAndSaveBinary=function(t,n){return t in this.binaryCache||(this.binaryCache[t]=n()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;if(!this.disposed){if(!k.env().getBool("IS_TEST")){var n=Object.keys(this.binaryCache);n.forEach(function(a){t.gpgpu.deleteProgram(t.binaryCache[a].webGLProgram),delete t.binaryCache[a]})}this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=k.tidy(function(){if(!k.env().get("WEBGL_RENDER_FLOAT32_ENABLED")){var n=k.env().getBool("DEBUG");k.env().set("DEBUG",!1);var a=t.abs(k.scalar(1e-8)).dataSync()[0];if(k.env().set("DEBUG",n),a>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?M9e:B9e},e.prototype.uploadToGPU=function(t){var n,a=this.texData.get(t),i=a.shape,o=a.dtype,s=a.values,u=a.texture,c=a.usage,l=a.isPacked;if(u==null){var f=this.activeTimers!=null,h;f&&(h=k.util.now());var p=a.texShape;if(p==null&&(p=DG(i,l),a.texShape=p),s!=null){var d=up(i),m=void 0,v=p[1],g=p[0],y=s instanceof Uint8Array||s instanceof Uint8ClampedArray;(l||!y)&&(n=Te(Cl(p[0],p[1]),2),v=n[0],g=n[1]),l?m=new w7e(d,y):m=new BV(d,y);var w=y?[g,v]:p,b=this.makeTensorInfo(w,o),x=this.texData.get(b.dataId);y?x.usage=Ba.PIXELS:x.usage=Ba.UPLOAD,x.texShape=w,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),v,g,s);var S=[[g,v]],T=!0,E=this.runWebGLProgram(m,[b],o,S,T),C=this.texData.get(E.dataId);a.texShape=C.texShape,a.isPacked=C.isPacked,a.usage=C.usage,k.env().get("ENGINE_COMPILE_ONLY")?this.disposeData(E.dataId):(a.texture=C.texture,a.values=null,this.texData.delete(E.dataId)),this.disposeIntermediateTensorInfo(b),f&&(this.uploadWaitMs+=k.util.now()-h)}else{var R=this.acquireTexture(p,c,o,l);a.texture=R}}},e.prototype.convertAndCacheOnCPU=function(t,n){var a=this.texData.get(t),i=a.dtype;return n!=null&&(a.values=W9e(n,i)),a.values},e.prototype.acquireTexture=function(t,n,a,i){if(this.numBytesInGPU+=this.computeBytes(t,a),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(o," MB, ")+"most likely due to a memory leak")}return this.textureManager.acquireTexture(t,n,i)},e.prototype.computeBytes=function(t,n){return t[0]*t[1]*k.util.bytesPerElement(n)},e.prototype.checkCompileCompletion=function(){var t,n;try{for(var a=Pn(Object.entries(this.binaryCache)),i=a.next();!i.done;i=a.next()){var o=Te(i.value,2),s=o[1];this.checkCompletion_(s)}}catch(u){t={error:u}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},e.prototype.checkCompileCompletionAsync=function(){return El(this,void 0,void 0,function(){var t,n,a,i,l,o,s,u,c,l,f,h,p,d,m=this;return Il(this,function(v){if(t=[],this.gpgpu.parallelCompilationExtension){try{for(n=Pn(Object.entries(this.binaryCache)),a=n.next();!a.done;a=n.next())i=Te(a.value,2),l=i[1],t.push(this.checkCompletionAsync_(l))}catch(g){f={error:g}}finally{try{a&&!a.done&&(h=n.return)&&h.call(n)}finally{if(f)throw f.error}}return[2,Promise.all(t)]}else{o=function(g){var y=new Promise(function(w){try{m.checkCompletion_(g),w(!0)}catch(b){throw b}});t.push(y)};try{for(s=Pn(Object.entries(this.binaryCache)),u=s.next();!u.done;u=s.next())c=Te(u.value,2),l=c[1],o(l)}catch(g){p={error:g}}finally{try{u&&!u.done&&(d=s.return)&&d.call(s)}finally{if(p)throw p.error}}return[2,Promise.all(t)]}})})},e.prototype.checkCompletionAsync_=function(t){return El(this,void 0,void 0,function(){return Il(this,function(n){switch(n.label){case 0:return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?[2,this.checkCompletion_(t)]:[3,1];case 1:return[4,k.nextFrame()];case 2:return n.sent(),[2,this.checkCompletionAsync_(t)]}})})},e.prototype.checkCompletion_=function(t){if(this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(H2(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0},e.prototype.getUniformLocations=function(){var t,n;try{for(var a=Pn(Object.values(this.binaryCache)),i=a.next();!i.done;i=a.next()){var o=i.value;this.gpgpu.buildVao(o.webGLProgram);var s=$G(this.gpgpu,o.program,o.webGLProgram),u=s.variablesLocations,c=s.customUniformLocations,l=s.infLoc,f=s.nanLoc,h=s.outShapeLocation,p=s.outShapeStridesLocation,d=s.outTexShapeLocation;o.variablesLocations=u,o.customUniformLocations=c,o.infLoc=l,o.nanLoc=f,o.outShapeLocation=h,o.outShapeStridesLocation=p,o.outTexShapeLocation=d}}catch(m){t={error:m}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},e.prototype.createTensorFromGPUData=function(t,n,a){t.channels=t.channels||"RGBA";var i=t.texture,o=t.height,s=t.width,u=t.channels,c=k.engine().backend;if(!c.gpgpu.gl.isTexture(i))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");var l=c.writeTexture(i,n,a,o,s,u);return k.engine().makeTensorFromDataId(l,n,a,c)},e}(k.KernelBackend);rS.nextDataId=0;function W9e(r,e){if(e==="float32"||e==="complex64")return r;if(e==="int32"||e==="bool"){for(var t=e==="int32"?new Int32Array(r.length):new Uint8Array(r.length),n=0;n<t.length;++n)t[n]=Math.round(r[n]);return t}else throw new Error("Unknown dtype ".concat(e))}var U9e="4.19.0";function f6(){k.env().set("WEBGL_FORCE_F16_TEXTURES",!0)}k.device_util.isBrowser()&&k.registerBackend("webgl",function(){return new rS},2);var V9e={forceHalfFloat:f6};var nS=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`,tc=function(){function r(e,t,n){this.variableNames=["A","B"],this.outputShape=k.backend_util.assertAndGetBroadcastShape(t,n),this.enableShapeUniforms=En(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        `.concat(e,`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `)}return r}();var ac=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`,Ol=function(){function r(e,t,n,a){a===void 0&&(a=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=k.backend_util.assertAndGetBroadcastShape(t,n);var i=this.outputShape.length;this.enableShapeUniforms=En(i);var o="";if(a)if(i===0||k.util.sizeFromShape(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else{var s=Ht(i);if(o=`
          `.concat(s,` coords = getOutputCoords();
        `),i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= `.concat(this.outputShape[0],` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `);else{var u=On("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (`.concat(u[i-2]," + 1) >= outShape[").concat(i,` - 2];
            bool nextColOutOfBounds =
              (`).concat(u[i-1]," + 1) >= outShape[").concat(i,` - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `):o+=`
            bool nextRowOutOfBounds =
              (`.concat(u[i-2]," + 1) >= ").concat(this.outputShape[i-2],`;
            bool nextColOutOfBounds =
              (`).concat(u[i-1]," + 1) >= ").concat(this.outputShape[i-1],`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `)}}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `.concat(e,`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `).concat(o,`

        setOutput(result);
      }
    `)}return r}();function Sa(r){var e=r.inputs,t=r.backend,n=e.x;return t.incRef(n.dataId),{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}var G9e={kernelName:k.Identity,backendName:"webgl",kernelFunc:Sa};function Ps(r){var e=r.inputs,t=r.backend,n=e.real,a=e.imag,i=t.makeTensorInfo(n.shape,"complex64"),o=t.texData.get(i.dataId),s=Sa({inputs:{x:n},backend:t}),u=Sa({inputs:{x:a},backend:t});return o.complexTensorInfos={real:s,imag:u},i}var H9e={kernelName:k.Complex,backendName:"webgl",kernelFunc:Ps};var h6="return (a < 0.) ? b * a : a;",p6=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function j9e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.alpha,o=t.makeTensorInfo([],"float32",k.util.createScalarValue(i,"float32")),s=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ol(p6,a.shape,o.shape):new tc(h6,a.shape,o.shape),u=t.runWebGLProgram(s,[a,o],"float32");return t.disposeIntermediateTensorInfo(o),u}var K9e={kernelName:k.LeakyRelu,backendName:"webgl",kernelFunc:j9e};var d6="return (a < 0.) ? b * a : a;",v6=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function X9e(r){var e=r.inputs,t=r.backend,n=e.x,a=e.alpha,i=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ol(v6,n.shape,a.shape):new tc(d6,n.shape,a.shape);return t.runWebGLProgram(i,[n,a],"float32")}var Y9e={kernelName:k.Prelu,backendName:"webgl",kernelFunc:X9e},Pl="if (isnan(x)) return x;";function Ft(r){var e=r.opSnippet,t=r.packedOpSnippet,n=r.cpuKernelImpl,a=r.dtype;return function(i){var o=i.inputs,s=i.backend,u=o.x,c=s,l=a||u.dtype;if(c.shouldExecuteOnCPU([u])&&n!=null){var f=c.texData.get(u.dataId),h=n(f.values,l);return c.makeTensorInfo(u.shape,l,h)}var p=k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null,d;return p?d=new Os(u.shape,t):d=new io(u.shape,e),c.runWebGLProgram(d,[u],l)}}function xn(r){var e=r.opSnippet,t=r.packedOpSnippet,n=r.checkOutOfBounds,a=n===void 0?!1:n,i=r.supportsComplex,o=i===void 0?!1:i,s=r.cpuKernelImpl,u=r.dtype;return function(c){var l=c.inputs,f=c.backend,h=l.a,p=l.b,d=f;if(o&&h.dtype==="complex64"){var m=d.texData.get(h.dataId),v=d.texData.get(p.dataId),g=Te([[m.complexTensorInfos.real,v.complexTensorInfos.real],[m.complexTensorInfos.imag,v.complexTensorInfos.imag]].map(function(U){var Y=Te(U,2),Z=Y[0],V=Y[1],X={dataId:Z.dataId,dtype:Z.dtype,shape:h.shape},ne={dataId:V.dataId,dtype:V.dtype,shape:p.shape},re=new tc(e,h.shape,p.shape);return d.runWebGLProgram(re,[X,ne],k.upcastType(Z.dtype,V.dtype))}),2),y=g[0],w=g[1],b=Ps({inputs:{real:y,imag:w},backend:d});return d.disposeIntermediateTensorInfo(y),d.disposeIntermediateTensorInfo(w),b}var x=u||k.upcastType(h.dtype,p.dtype);if((h.dtype==="string"||p.dtype==="string"||d.shouldExecuteOnCPU([h,p]))&&s!=null){var S=d.texData.get(h.dataId).values,T=d.texData.get(p.dataId).values,E=h.dtype==="string"?k.backend_util.fromUint8ToStringArray(S):S,C=h.dtype==="string"?k.backend_util.fromUint8ToStringArray(T):T,R=Te(s(h.shape,p.shape,E,C,x),2),_=R[0],M=R[1],$=d.makeTensorInfo(M,x),z=d.texData.get($.dataId);return z.values=_,$}var q=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null,L;return q?L=new Ol(t,h.shape,p.shape,a):L=new tc(e,h.shape,p.shape),d.runWebGLProgram(L,[h,p],x)}}function pp(r,e){if(e===void 0&&(e=!1),r==="linear")return e?A9e:N9e;if(r==="relu")return e?_9e:E9e;if(r==="elu")return e?D9e:T9e;if(r==="relu6")return e?F9e:I9e;if(r==="prelu")return e?v6:d6;if(r==="leakyrelu")return e?p6:h6;if(r==="sigmoid")return e?R9e:C9e;throw new Error("Activation ".concat(r," has not been implemented for the WebGL backend."))}var m6=function(){function r(e,t,n,a,i,o,s,u,c){a===void 0&&(a=!1),i===void 0&&(i=!1),o===void 0&&(o=!1),s===void 0&&(s=null),u===void 0&&(u=!1),c===void 0&&(c=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=En(this.outputShape.length);var l=a?e[1]:e[2],f=Math.ceil(l/2),h=a?"i * 2, rc.y":"rc.y, i * 2",p=i?"rc.z, i * 2":"i * 2, rc.z",d=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],v="",g="";s&&(u?v=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `.concat(s,`
        }`):c?v=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          `.concat(s,`
        }`):v=`vec4 activation(vec4 x) {
          `.concat(s,`
        }`),g="result = activation(result);");var y=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");var w="rc.x",b="rc.x";e[0]<t[0]?w="imod(rc.x, ".concat(e[0],")"):t[0]<e[0]&&(b="imod(rc.x, ".concat(t[0],")")),this.userCode=`
      `.concat(v,`
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = `).concat(f,`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = `).concat(w,`;
        int batchB = `).concat(b,`;
        for (int i = 0; i < `).concat(f,`; i++) {
          vec4 a = getMatrixA(batchA, `).concat(h,`);
          vec4 b = getMatrixB(batchB, `).concat(p,`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`).concat(d[0]," * ").concat(m[0],`);
          result += (`).concat(d[1]," * ").concat(m[1],`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `).concat(y,`

        `).concat(g,`

        setOutput(result);
      }
    `)}return r}();var HV={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},jV=function(){function r(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=k.backend_util.assertAndGetBroadcastShape(t,n),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `.concat(e,`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `)}return r}(),KV="return a * b;";function aS(r){var e=r.inputs,t=r.backend,n=e.a,a=e.b,i=k.backend_util.upcastType(n.dtype,a.dtype);if(n.dtype==="complex64"){var o=t.texData.get(n.dataId),s=t.texData.get(a.dataId),u=new jV(HV.REAL,n.shape,a.shape),c=new jV(HV.IMAG,n.shape,a.shape),l=[{dataId:o.complexTensorInfos.real.dataId,dtype:o.complexTensorInfos.real.dtype,shape:n.shape},{dataId:o.complexTensorInfos.imag.dataId,dtype:o.complexTensorInfos.imag.dtype,shape:n.shape},{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:a.shape},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:a.shape}],f=t.runWebGLProgram(u,l,"float32"),h=t.runWebGLProgram(c,l,"float32"),p=Ps({inputs:{real:f,imag:h},backend:t});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),p}if(t.shouldExecuteOnCPU([n,a])){var o=t.texData.get(n.dataId),s=t.texData.get(a.dataId),d=Te(jXe(n.shape,a.shape,o.values,s.values,i),2),m=d[0],v=d[1],g=t.makeTensorInfo(v,i),y=t.texData.get(g.dataId);return y.values=m,g}var w;return k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?w=new Ol(KV,n.shape,a.shape):w=new tc(KV,n.shape,a.shape),t.runWebGLProgram(w,[n,a],i)}var J9e={kernelName:k.Multiply,backendName:"webgl",kernelFunc:aS};function Z9e(r,e,t){var n=Sr([Qu(r.shape)],Te(ec(r.shape)),!1),a={dtype:r.dtype,shape:n,dataId:r.dataId},i=Sr([Qu(e)],Te(ec(e)),!1),o=new l6(i,n),s=!0,u=[n],c=t.runWebGLProgram(o,[a],r.dtype,u,s);return{dataId:c.dataId,shape:e,dtype:c.dtype}}function Ae(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.shape,o=t,s=k.util.sizeFromShape(a.shape),u=k.util.inferFromImplicitShape(i,s),c=k.util.sizeFromShape(u);k.util.assert(s===c,function(){return"The new shape (".concat(u,") has ").concat(c," elements and the old ")+"shape (".concat(a.shape,") has ").concat(s," elements. The new shape and old ")+"shape must have the same number of elements."});var l=o.texData.get(a.dataId);return l.isPacked&&!hp(a.shape,u)&&!(l.texture!==null&&hp(l.shape,u))?Z9e(a,u,o):(o.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype})}var Q9e={kernelName:k.Reshape,backendName:"webgl",kernelFunc:Ae};var XV=function(){function r(e,t){this.variableNames=["x"];var n=e.windowSize,a=e.batchSize,i=e.inSize,o=e.outSize;this.outputShape=[a,o];var s=Math.floor(n/4)*4,u=n%4,c="sumValue += dot(values, ones);";if(t!=null){var l=1/t;c="sumValue += dot(values * ".concat(k.util.isInt(l)?l.toPrecision(2):l,", ones);")}var f="";i%n>0&&(f=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return 0.0;
        }
      `)),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `.concat(f,`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `).concat(n,`;

        float sumValue = 0.0;

        for (int i = 0; i < `).concat(s,`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `).concat(c,`
        }

        int inIdx = inOffset + `).concat(s,`;
        if (`).concat(u===1,`) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          `).concat(c,`
        } else if (`).concat(u===2,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          `).concat(c,`
        } else if (`).concat(u===3,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          `).concat(c,`
        }
        setOutput(sumValue);
      }
    `)}return r}();var eYe=function(){function r(e,t){this.variableNames=["x"];var n=e.windowSize,a=e.batchSize,i=e.inSize,o=e.outSize;this.outputShape=[a,o];var s="0.0",u="";t==="prod"?s="1.0":t==="min"?(s="1.0 / 1e-20",u="min"):t==="max"&&(s="-1.0 / 1e-20",u="max");var c="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="sum"?c="sumValue":t==="prod"?c="prodValue":t==="all"?c="allValue":t==="any"&&(c="anyValue");var l=Math.floor(n/4)*4,f=n%4,h=`
      if (`.concat(t==="sum",`) {
        sumValue += dot(values, ones);
      } else if (`).concat(t==="prod",`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `).concat(u,`(values, minMaxValue);
        if (`).concat(t==="min"," || ").concat(t==="max",`) {
          minMaxValue = `).concat(u,`(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `),p="vec4";t==="all"?(s="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,p="bvec4"):t==="any"&&(s="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,p="bvec4");var d="";i%n>0&&(d=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return initializationValue;
        }
      `)),this.userCode=`
      const float initializationValue = `.concat(s,`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `).concat(d,`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `).concat(n,`;

        vec4 minMaxValue = vec4(`).concat(s,`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `).concat(l,`; i += 4) {
          int inIdx = inOffset + i;
          `).concat(p," values = ").concat(p,`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `).concat(h,`
        }

        int inIdx = inOffset + `).concat(l,`;
        if (`).concat(f===1,`) {
          `).concat(p," values = ").concat(p,`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `).concat(h,`
        } else if (`).concat(f===2,`) {
          `).concat(p," values = ").concat(p,`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `).concat(h,`
        } else if (`).concat(f===3,`) {
          `).concat(p," values = ").concat(p,`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `).concat(h,`
        }
        setOutput(`).concat(c,`);
      }
    `)}return r}();function tYe(r){for(var e=[];e.length===0||e[e.length-1].outSize!==1;){var t=e.length?e[e.length-1].outSize:r[1],n=k.backend_util.computeOptimalWindowSize(t);e.push({inSize:t,windowSize:n,outSize:Math.ceil(t/n)})}return e}function ic(r,e,t,n){for(var a=tYe(r.shape),i=r,o=0;o<a.length;o++){var s=a[o],u=s.inSize,c=s.windowSize,l=s.outSize,f=void 0,h=void 0;t==="mean"?f=o===0?new XV({windowSize:c,inSize:u,batchSize:r.shape[0],outSize:l},u):new XV({windowSize:c,inSize:u,batchSize:r.shape[0],outSize:l}):f=new eYe({windowSize:c,inSize:u,batchSize:r.shape[0],outSize:l},t),h=i,i=n.runWebGLProgram(f,[i],e),h.dataId!==r.dataId&&n.disposeIntermediateTensorInfo(h)}return i}var rYe=function(){function r(e,t){this.variableNames=["A"];for(var n=new Array(e.length),a=0;a<n.length;a++)n[a]=e[t[a]];this.outputShape=n,this.rank=n.length;var i=Ht(this.rank),o=nYe(t);this.userCode=`
    void main() {
      `.concat(i,` resRC = getOutputCoords();
      setOutput(getA(`).concat(o,`));
    }
    `)}return r}();function nYe(r){var e=r.length;if(e>6)throw Error("Transpose for rank ".concat(e," is not yet supported"));for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],n=new Array(e),a=0;a<r.length;a++)n[r[a]]=t[a];return n.join()}var aYe=function(){function r(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),a=0;a<n.length;a++)n[a]=e[t[a]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=Ht(this.rank),o=c6("rc",this.rank),s=new Array(this.rank),a=0;a<t.length;a++)s[t[a]]=o[a];var u="vec2(".concat(s.slice(-2).join(),")"),c="++".concat(o[this.rank-1]," < ").concat(n[this.rank-1]),l="getChannel(getA(".concat(s.join(),"), ").concat(u,")");this.userCode=`
    void main() {
      `.concat(i,` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `).concat(l,`;
      if(`).concat(c,`) {
        result[1] = `).concat(l,`;
      }
      --`).concat(o[this.rank-1],`;
      if(++`).concat(o[this.rank-2]," < ").concat(n[this.rank-2],`) {
        result[2] = `).concat(l,`;
        if(`).concat(c,`) {
          result[3] = `).concat(l,`;
        }
      }
      setOutput(result);
    }
    `)}return r}();function Og(r,e,t){var n=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new aYe(r.shape,e):new rYe(r.shape,e);return t.runWebGLProgram(n,[r],r.dtype)}function iYe(r,e,t,n){var a=e,i=r.shape.length,o=k.util.parseAxisParam(a,r.shape),s=o,u=k.backend_util.getAxesPermutation(s,i),c=u!=null,l=r;c&&(l=Og(r,u,n),s=k.backend_util.getInnerMostAxes(s.length,i)),k.backend_util.assertAxesAreInnerMostDims("sum",s,i);var f=Te(k.backend_util.computeOutAndReduceShapes(l.shape,s),2),h=f[0],p=f[1],d=h;t&&(d=k.backend_util.expandShapeToKeepDim(h,o));var m=k.util.sizeFromShape(p),v=k.util.sizeFromShape(r.shape),g=v/m,y=Ae({inputs:{x:l},attrs:{shape:[g,m]},backend:n}),w=k.sumOutType(r.dtype),b=ic(y,w,"sum",n),x=Ae({inputs:{x:b},attrs:{shape:d},backend:n});return n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),c&&n.disposeIntermediateTensorInfo(l),x}function Pg(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;return iYe(a,i,o,t)}var oYe={kernelName:k.Sum,backendName:"webgl",kernelFunc:Pg};function Mn(r){for(var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.perm,o=t,s=a.shape.length,u=new Array(s),c=0;c<u.length;c++)u[c]=a.shape[i[c]];var l;if(o.shouldExecuteOnCPU([a])){var f=o.texData.get(a.dataId),h=f.values,p=tS(h,a.shape,a.dtype,i,u);l=o.makeTensorInfo(u,a.dtype);var d=o.texData.get(l.dataId);d.values=p}else l=Og(a,i,o);return l}var sYe={kernelName:k.Transpose,backendName:"webgl",kernelFunc:Mn},g6=1e3;function Dg(r){var e,t,n=r.a,a=r.b,i=r.transposeA,o=r.transposeB,s=r.backend,u=r.bias,c=u===void 0?null:u,l=r.preluActivationWeights,f=l===void 0?null:l,h=r.leakyreluAlpha,p=h===void 0?0:h,d=r.activation,m=d===void 0?null:d,v=n.shape.length,g=a.shape.length,y=i?n.shape[v-2]:n.shape[v-1],w=o?a.shape[g-1]:a.shape[g-2],b=i?n.shape[v-1]:n.shape[v-2],x=o?a.shape[g-2]:a.shape[g-1],S=n.shape.slice(0,-2),T=a.shape.slice(0,-2),E=k.util.sizeFromShape(S),C=k.util.sizeFromShape(T),R=k.broadcast_util.assertAndGetBroadcastShape(n.shape.slice(0,-2),a.shape.slice(0,-2)),_=R.concat([b,x]);k.util.assert(y===w,function(){return"Error in matMul: inner shapes (".concat(y,") and (")+"".concat(w,") of Tensors with shapes ").concat(n.shape," and ")+"".concat(a.shape," and transposeA=").concat(i)+" and transposeB=".concat(o," must match.")});var M=i?[E,y,b]:[E,b,y],$=o?[C,x,w]:[C,w,x],z=Ae({inputs:{x:n},backend:s,attrs:{shape:M}}),q=Ae({inputs:{x:a},backend:s,attrs:{shape:$}}),L=[z,q],U=Math.max(E,C),Y=i?z.shape[1]:z.shape[2],Z=c!=null,V=f!=null,X=m==="leakyrelu",ne=m!=null?pp(m,!0):null,re=Z||V||X||ne!=null,se;if((b===1||x===1)&&Y>g6&&re===!1){var le=z,de=q;i&&(le=Mn({inputs:{x:z},backend:s,attrs:{perm:[0,2,1]}}),L.push(le)),o&&(de=Mn({inputs:{x:q},backend:s,attrs:{perm:[0,2,1]}}),L.push(de));var ke=x!==1,he=x===1,ye=le;ke&&(ye=Ae({inputs:{x:le},backend:s,attrs:{shape:[U,Y,1]}}),L.push(ye));var xe=x===1?2:1,De=de;he&&(De=Ae({inputs:{x:de},backend:s,attrs:{shape:[U,1,Y]}}),L.push(De));var Ze=aS({inputs:{a:ye,b:De},backend:s});se=Pg({inputs:{x:Ze},backend:s,attrs:{axis:xe,keepDims:!0}}),L.push(Ze)}else{var gt=k.upcastType(n.dtype,a.dtype),st=new m6(M,$,[U,b,x],i,o,Z,ne,V,X),ot=[z,q];if(c!=null&&ot.push(c),V&&ot.push(f),X){var mt=s.makeTensorInfo([],"float32",k.util.createScalarValue(p,"float32"));ot.push(mt),L.push(mt)}se=s.runWebGLProgram(st,ot,gt)}var lt=Ae({inputs:{x:se},backend:s,attrs:{shape:_}});L.push(se);try{for(var Qe=Pn(L),nt=Qe.next();!nt.done;nt=Qe.next()){var rt=nt.value;s.disposeIntermediateTensorInfo(rt)}}catch(hr){e={error:hr}}finally{try{nt&&!nt.done&&(t=Qe.return)&&t.call(Qe)}finally{if(e)throw e.error}}return lt}function uYe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.a,i=e.b,o=e.bias,s=e.preluActivationWeights,u=n.transposeA,c=n.transposeB,l=n.activation,f=n.leakyreluAlpha;return Dg({a,b:i,transposeA:u,transposeB:c,backend:t,bias:o,preluActivationWeights:s,leakyreluAlpha:f,activation:l})}var cYe={kernelName:k._FusedMatMul,backendName:"webgl",kernelFunc:uYe};var YV="return abs(x);";function lYe(r){var e=r.inputs,t=r.backend,n=e.x;if(t.shouldExecuteOnCPU([n])&&n.dtype!=="complex64"){var a=t.texData.get(n.dataId),i=s6(a.values);return t.makeTensorInfo(n.shape,n.dtype,i)}var o;return k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new Os(n.shape,YV):o=new io(n.shape,YV),t.runWebGLProgram(o,[n],n.dtype)}var fYe={kernelName:k.Abs,backendName:"webgl",kernelFunc:lYe};var hYe=gi+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,pYe=Ft({opSnippet:hYe}),dYe={kernelName:k.Acos,backendName:"webgl",kernelFunc:pYe};var vYe=gi+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,mYe=Ft({opSnippet:vYe}),gYe={kernelName:k.Acosh,backendName:"webgl",kernelFunc:mYe};var JV="return a + b;",yYe=xn({opSnippet:JV,packedOpSnippet:JV,supportsComplex:!0,cpuKernelImpl:EXe}),bYe={kernelName:k.Add,backendName:"webgl",kernelFunc:yYe};var wYe=function(){function r(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(function(i,o){return"T".concat(o)});var n=[];this.variableNames.forEach(function(i){n.push("float v".concat(i," = get").concat(i,"AtOutCoords();"))});var a=this.variableNames.map(function(i){return"v".concat(i)}).join(" + ");this.userCode=`
      void main() {
        `.concat(n.join(`
        `),`

        float result = `).concat(a,`;
        setOutput(result);
      }
    `)}return r}();var xYe=function(){function r(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(function(i,o){return"T".concat(o)});var n=[];this.variableNames.forEach(function(i){n.push("vec4 v".concat(i," = get").concat(i,"AtOutCoords();"))});var a=this.variableNames.map(function(i){return"v".concat(i)}).join(" + ");this.userCode=`
      void main() {
        `.concat(n.join(`
        `),`

        vec4 result = `).concat(a,`;
        setOutput(result);
      }
    `)}return r}();function Ag(r){var e=r.inputs,t=r.backend,n=e;if(n.length===1)return Sa({inputs:{x:n[0]},backend:t});if(n.length>k.env().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(n.length/2),i=Ag({inputs:n.slice(0,a),backend:t}),o=Ag({inputs:n.slice(a),backend:t});return Ag({inputs:[i,o],backend:t})}var s=n.map(function(f){return f.dtype}).reduce(function(f,h){return k.upcastType(f,h)}),u=n.map(function(f){return f.shape}),c=k.env().getBool("WEBGL_PACK"),l=c?new xYe(n[0].shape,u):new wYe(n[0].shape,u);return t.runWebGLProgram(l,n,s)}var kYe={kernelName:k.AddN,backendName:"webgl",kernelFunc:Ag};function SYe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=a;l!=null&&(f=Mn({inputs:{x:a},backend:t,attrs:{perm:l}}),c=k.backend_util.getInnerMostAxes(c.length,s)),k.backend_util.assertAxesAreInnerMostDims("all",c,s);var h=Te(k.backend_util.computeOutAndReduceShapes(f.shape,c),2),p=h[0],d=h[1],m=k.util.sizeFromShape(d),v=Ae({inputs:{x:f},backend:t,attrs:{shape:[-1,m]}}),g=ic(v,v.dtype,"all",t),y;if(o){var w=k.backend_util.expandShapeToKeepDim(p,u);y=Ae({inputs:{x:g},backend:t,attrs:{shape:w}})}else y=Ae({inputs:{x:g},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(g),l!=null&&t.disposeIntermediateTensorInfo(f),y}var NYe={kernelName:k.All,backendName:"webgl",kernelFunc:SYe};function TYe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=a;l!=null&&(f=Mn({inputs:{x:a},backend:t,attrs:{perm:l}}),c=k.backend_util.getInnerMostAxes(c.length,s)),k.backend_util.assertAxesAreInnerMostDims("any",c,s);var h=Te(k.backend_util.computeOutAndReduceShapes(f.shape,c),2),p=h[0],d=h[1],m=k.util.sizeFromShape(d),v=Ae({inputs:{x:f},backend:t,attrs:{shape:[-1,m]}}),g=ic(v,v.dtype,"any",t),y;if(o){var w=k.backend_util.expandShapeToKeepDim(p,u);y=Ae({inputs:{x:g},backend:t,attrs:{shape:w}})}else y=Ae({inputs:{x:g},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(g),l!=null&&t.disposeIntermediateTensorInfo(f),y}var EYe={kernelName:k.Any,backendName:"webgl",kernelFunc:TYe};var IYe=function(){function r(e,t,n){this.variableNames=["A"];var a=e.windowSize,i=e.batchSize,o=e.outSize;n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s=t==="max"?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `.concat(a,`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `).concat(a,`; i++) {
          int inIdx = `).concat(u,`;
          float candidate = getA(batch, inIdx);
          if (candidate `).concat(s,` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `)}return r}();var CYe=function(){function r(e,t,n,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,k.util.assert(e.length>2,function(){return"Packed arg".concat(n.charAt(0).toUpperCase()+n.slice(1)," supports only inputs with rank above 2.")});var i=e[e.length-1],o=Math.ceil(i/t);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),a||this.variableNames.push("bestIndicesA");var s=this.outputShape,u=s.length,c=Ht(u),l=On("coords",u),f,h;if(o===1){h=u+1;var p=Ht(h);f=`
        `.concat(p," sourceLocR = ").concat(p,"(").concat(l.join(),`, 0);
        ++`).concat(l[u-1],`;
        `).concat(p," sourceLocG = ").concat(p,"(").concat(l.join(),`, 0);
        ++`).concat(l[u-2],`;
        `).concat(p," sourceLocA = ").concat(p,"(").concat(l.join(),`, 0);
        --`).concat(l[u-1],`;
        `).concat(p," sourceLocB = ").concat(p,"(").concat(l.join(),`, 0);
        --`).concat(l[u-2],";")}else h=u,f=`
        `.concat(c,` sourceLocR = coords;
        ++`).concat(l[u-1],`;
        `).concat(c,` sourceLocG = coords;
        ++`).concat(l[u-2],`;
        `).concat(c,` sourceLocA = coords;
        --`).concat(l[u-1],`;
        `).concat(c,` sourceLocB = coords;
        --`).concat(l[u-2],";");var d=["x","y","z","w","u","v"].slice(0,h),m="."+d[h-1],v=d.map(function(C){return"int "+C}),g=On("sourceLocR",h-1).concat("inIdx.r"),y=On("sourceLocG",h-1).concat("inIdx.g"),w=On("sourceLocB",h-1).concat("inIdx.b"),b=On("sourceLocA",h-1).concat("inIdx.a"),x=n==="max"?"greaterThan":"lessThan",S=a?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`.concat(g.join(),`),
                             getBestIndicesAChannel(`).concat(y.join(),`),
                             getBestIndicesAChannel(`).concat(w.join(),`),
                             getBestIndicesAChannel(`).concat(b.join(),")));"),T=`vec4(
            getAChannel(`.concat(g.join(),`),
            hasNextCol ? getAChannel(`).concat(y.join(),`) : 0.,
            hasNextRow ? getAChannel(`).concat(w.join(),`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`).concat(b.join(),") : 0.)"),E=a?"":`
      float getBestIndicesAChannel(`.concat(v.join(),`) {
        return getChannel(getBestIndicesA(`).concat(d.join(),`),
                                          vec2(`).concat(d.slice(-2).join(),`));
      }`);this.userCode=`
      float getAChannel(`.concat(v.join(),`) {
        return getChannel(getA(`).concat(d.join(),`),
                               vec2(`).concat(d.slice(-2).join(),`));
      }
      `).concat(E,`
      void main() {
        `).concat(c,` coords = getOutputCoords();
        bool hasNextCol = `).concat(l[u-1]," < ").concat(s[u-1]-1,`;
        bool hasNextRow = `).concat(l[u-2]," < ").concat(s[u-2]-1,`;
        `).concat(f,`
        ivec4 srcIdx = ivec4(sourceLocR`).concat(m,", sourceLocG").concat(m,`,
          sourceLocB`).concat(m,", sourceLocA").concat(m,") * ").concat(t,`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `).concat(T,`;

        for (int i = 0; i < `).concat(t,`; i++) {
          inIdx = srcIdx;
          `).concat(S,`
          vec4 candidate = `).concat(T,`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`).concat(x,`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `)}return r}();function y6(r,e,t,n){n===void 0&&(n=null);var a=e.shape[0],i=e.shape[1];n!=null&&(a=n.shape[0],i=n.shape[1]);var o=k.backend_util.computeOptimalWindowSize(i),s={windowSize:o,inSize:i,batchSize:a,outSize:Math.ceil(i/o)},u=new IYe(s,t,n==null),c=[e];n!=null&&c.push(n);var l=r.runWebGLProgram(u,c,"int32");if(l.shape[1]===1)return l;var f=y6(r,e,t,l);return r.disposeIntermediateTensorInfo(l),f}function b6(r,e,t,n){n===void 0&&(n=null);var a=n!=null?n.shape:e.shape,i=a[a.length-1],o=k.backend_util.computeOptimalWindowSize(i),s=new CYe(a,o,t,n==null),u=n==null?[e]:[e,n],c=r.runWebGLProgram(s,u,"int32");if(c.shape.length===e.shape.length){var l=b6(r,e,t,c);return r.disposeIntermediateTensorInfo(c),l}return c}function w6(r,e,t,n){var a=[t];if(k.backend_util.assertAxesAreInnerMostDims("arg"+n.charAt(0).toUpperCase()+n.slice(1),a,e.shape.length),!k.env().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){var i=[],o=r.texData.get(e.dataId),s=o!==null&&o.isPacked,u=e;s&&(u=r.unpackTensor(e),i.push(u));var c=Te(k.backend_util.computeOutAndReduceShapes(u.shape,a),2),l=c[0],f=c[1],h=k.util.sizeFromShape(f),p=Ae({inputs:{x:u},backend:r,attrs:{shape:[-1,h]}});i.push(p);var d=y6(r,p,n);i.push(d);var m=Ae({inputs:{x:d},backend:r,attrs:{shape:l}});return i.forEach(function(v){return r.disposeIntermediateTensorInfo(v)}),m}return b6(r,e,n)}function AYe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=k.util.parseAxisParam(i,a.shape),s=k.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=Mn({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=k.backend_util.getInnerMostAxes(o.length,u.shape.length)),k.backend_util.assertAxesAreInnerMostDims("argMax",[o[0]],u.shape.length);var l=w6(t,u,o[0],"max");return c.forEach(function(f){return t.disposeIntermediateTensorInfo(f)}),l}var DYe={kernelName:k.ArgMax,backendName:"webgl",kernelFunc:AYe};function _Ye(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=k.util.parseAxisParam(i,a.shape),s=k.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=Mn({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=k.backend_util.getInnerMostAxes(o.length,u.shape.length)),k.backend_util.assertAxesAreInnerMostDims("argMin",[o[0]],u.shape.length);var l=w6(t,u,o[0],"min");return c.forEach(function(f){return t.disposeIntermediateTensorInfo(f)}),l}var FYe={kernelName:k.ArgMin,backendName:"webgl",kernelFunc:_Ye};var RYe=gi+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,OYe=Ft({opSnippet:RYe}),PYe={kernelName:k.Asin,backendName:"webgl",kernelFunc:OYe};var MYe=gi+"return log(x + sqrt(x * x + 1.0));",BYe=Ft({opSnippet:MYe}),LYe={kernelName:k.Asinh,backendName:"webgl",kernelFunc:BYe};var qYe=gi+`
  return atan(x);
`,zYe=Ft({opSnippet:qYe}),$Ye={kernelName:k.Atan,backendName:"webgl",kernelFunc:zYe};var WYe=nS+`
  return atan(a, b);
`,UYe=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ac+`
  return result;
`,VYe=xn({opSnippet:WYe,packedOpSnippet:UYe}),GYe={kernelName:k.Atan2,backendName:"webgl",kernelFunc:VYe};var HYe=gi+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,jYe=Ft({opSnippet:HYe}),KYe={kernelName:k.Atanh,backendName:"webgl",kernelFunc:jYe};var dp=function(){function r(e,t,n,a,i){if(a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var o=e.filterWidth,s=e.strideHeight,u=e.strideWidth,c=e.dilationHeight,l=e.dilationWidth,f=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=e.padInfo.top,d=e.padInfo.left;this.outputShape=e.outShape;var m=t==="avg",v="((batch  * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + d"),g="(xR * ".concat(e.inWidth," + xC) * ").concat(e.inChannels," + d"),y="0.0";if(m||(y="-1.0 / 1e-20"),n){var w=">=";this.userCode=`
        const ivec2 strides = ivec2(`.concat(s,", ").concat(u,`);
        const ivec2 pads = ivec2(`).concat(p,", ").concat(d,`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `).concat(f,`;
              wR += `).concat(c,`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int wC = 0; wC < `).concat(h,`;
                wC += `).concat(l,`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value `).concat(w,` currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = `).concat(a?i?v:g:"wR * ".concat(h," + wC"),`;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `);return}var b="max",x="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(x="avgValue / max(count, 1.0)");var S=Math.floor(o/4)*4,T=o%4,E=`
      if (`.concat(m,`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = `).concat(b,`(values, minMaxValue);
      }
    `);this.userCode=`
      const ivec2 strides = ivec2(`.concat(s,", ").concat(u,`);
      const ivec2 pads = ivec2(`).concat(p,", ").concat(d,`);
      const float initializationValue = `).concat(y,`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `).concat(e.inWidth,`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`).concat(y,`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `).concat(f,`;
            wR += `).concat(c,`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `).concat(e.inHeight,`) {
            continue;
          }

          for (int wC = 0; wC < `).concat(S,`; wC += 4) {
            int xC = xCCorner + wC * `).concat(l,`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `).concat(l,`, d),
              getValue(batch, xR, xC + 2 * `).concat(l,`, d),
              getValue(batch, xR, xC + 3 * `).concat(l,`, d)
            );

            `).concat(E,`
          }

          int xC = xCCorner + `).concat(S,`;
          if (`).concat(T===1,`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `).concat(E,`
          } else if (`).concat(T===2,`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `).concat(l,`, d),
              initializationValue,
              initializationValue
            );

            `).concat(E,`
          } else if (`).concat(T===3,`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `).concat(l,`, d),
              getValue(batch, xR, xC + 2 * `).concat(l,`, d),
              initializationValue
            );

            `).concat(E,`
          }
        }
        setOutput(`).concat(x,`);
      }
    `)}return r}(),iS=function(){function r(e,t,n,a,i){if(a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var o=e.filterWidth,s=e.strideDepth,u=e.strideHeight,c=e.strideWidth,l=e.dilationDepth,f=e.dilationHeight,h=e.dilationWidth,p=e.effectiveFilterDepth,d=e.effectiveFilterHeight,m=e.effectiveFilterWidth,v=e.padInfo.front,g=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;var w=t==="avg",b="0.0";if(w||(b="-1.0 / 1e-20"),n){var x=">=";this.userCode=`
        const ivec3 strides =
            ivec3(`.concat(s,", ").concat(u,", ").concat(c,`);
        const ivec3 pads = ivec3(`).concat(v,", ").concat(g,", ").concat(y,`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `).concat(p,`;
              wD += `).concat(l,`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `).concat(e.inDepth,`) {
              continue;
            }

            for (int wR = 0; wR < `).concat(d,`;
                wR += `).concat(f,`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `).concat(e.inHeight,`) {
                continue;
              }

              for (int wC = 0; wC < `).concat(m,`;
                  wC += `).concat(h,`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value `).concat(x,` currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = `).concat(a?i?"(((batch * ".concat(e.inDepth," + xD) * ").concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"((xD * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"wD * ".concat(d," * ").concat(m,` +
                      wR * `).concat(m," + wC"),`;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `);return}var S="max",T="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(T="avgValue / max(count, 1.0)");var E=Math.floor(o/4)*4,C=o%4,R=`
      if (`.concat(w,`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = `).concat(S,`(values, minMaxValue);
      }
    `);this.userCode=`
      const ivec3 strides =
        ivec3(`.concat(s,", ").concat(u,", ").concat(c,`);
      const ivec3 pads = ivec3(`).concat(v,", ").concat(g,", ").concat(y,`);
      const float initializationValue = `).concat(b,`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `).concat(e.inWidth,`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`).concat(b,`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `).concat(p,`;
            wD += `).concat(l,`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `).concat(e.inDepth,`) {
            continue;
          }

          for (int wR = 0; wR < `).concat(d,`;
            wR += `).concat(f,`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int wC = 0; wC < `).concat(E,`; wC += 4) {
              int xC = xCCorner + wC * `).concat(h,`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `).concat(h,`, ch),
                getValue(batch, xD, xR, xC + 2 * `).concat(h,`, ch),
                getValue(batch, xD, xR, xC + 3 * `).concat(h,`, ch)
              );

              `).concat(R,`
            }

            int xC = xCCorner + `).concat(E,`;
            if (`).concat(C===1,`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `).concat(R,`
            } else if (`).concat(C===2,`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `).concat(h,`, ch),
                initializationValue,
                initializationValue
              );

              `).concat(R,`
            } else if (`).concat(C===3,`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `).concat(h,`, ch),
                getValue(batch, xD, xR, xC + 2 * `).concat(h,`, ch),
                initializationValue
              );

              `).concat(R,`
            }
          }
        }
        setOutput(`).concat(T,`);
      }
    `)}return r}();function XYe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;Al(a,"avgPool");var i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=1;k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=k.backend_util.computePool2DInfo(a.shape,i,o,c,s,u);if(l.filterWidth===1&&l.filterHeight===1&&k.util.arraysEqual(l.inShape,l.outShape))return Sa({inputs:{x:a},backend:t});var f=new dp(l,"avg",!1);return t.runWebGLProgram(f,[a],"float32")}var YYe={kernelName:k.AvgPool,backendName:"webgl",kernelFunc:XYe};function JYe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=n.dataFormat,l=[1,1,1],f=k.backend_util.computePool3DInfo(a.shape,i,o,l,s,u,c),h=new iS(f,"avg",!1);return t.runWebGLProgram(h,[a],"float32")}var ZYe={kernelName:k.AvgPool3D,backendName:"webgl",kernelFunc:JYe};var QYe=function(){function r(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=u-1-e.padInfo.top,f=c-1-e.padInfo.left,h=1/(t*n);this.userCode=`
      const ivec2 pads = ivec2(`.concat(l,", ").concat(f,`);
      const float avgMultiplier = float(`).concat(h,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(u,`;
            wR += `).concat(o,`) {
          float dyR = float(dyRCorner + wR) / `).concat(a,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `).concat(c,`;
            wC+= `).concat(s,`) {
            float dyC = float(dyCCorner + wC) / `).concat(i,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `)}return r}(),eJe=function(){function r(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,a=e.filterWidth,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=e.dilationDepth,c=e.dilationHeight,l=e.dilationWidth,f=e.effectiveFilterDepth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,d=f-1-e.padInfo.front,m=h-1-e.padInfo.top,v=p-1-e.padInfo.left,g=1/(t*n*a);this.userCode=`
      const ivec3 pads = ivec3(`.concat(d,", ").concat(m,", ").concat(v,`);
      const float avgMultiplier = float(`).concat(g,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `).concat(f,`;
            wD += `).concat(u,`) {
          float dyD = float(dyDCorner + wD) / `).concat(i,`.0;

          if (dyD < 0.0 || dyD >= `).concat(e.outDepth,`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `).concat(h,`;
              wR += `).concat(c,`) {
            float dyR = float(dyRCorner + wR) / `).concat(o,`.0;

            if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `).concat(p,`;
                wC += `).concat(l,`) {
              float dyC = float(dyCCorner + wC) / `).concat(s,`.0;

              if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}();function tJe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=i,s=n.filterSize,u=n.strides,c=n.pad,l=n.dimRoundingMode,f=[1,1,1],h=k.backend_util.computePool3DInfo(o.shape,s,u,f,c,l),p=new eJe(h);return t.runWebGLProgram(p,[a],o.dtype)}var rJe={kernelName:k.AvgPool3DGrad,backendName:"webgl",kernelFunc:tJe};function nJe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=i;Al([a,i],"avgPoolGrad");var s=n.filterSize,u=n.strides,c=n.pad,l=k.backend_util.computePool2DInfo(o.shape,s,u,1,c),f=new QYe(l);return t.runWebGLProgram(f,[a],o.dtype)}var aJe={kernelName:k.AvgPoolGrad,backendName:"webgl",kernelFunc:nJe};function iJe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.a,i=e.b,o=n.transposeA,s=n.transposeB;return Dg({a,b:i,transposeA:o,transposeB:s,backend:t})}var oJe={kernelName:k.BatchMatMul,backendName:"webgl",kernelFunc:iJe};var sJe=function(){function r(e,t,n,a,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],k.backend_util.assertAndGetBroadcastShape(e,t),k.backend_util.assertAndGetBroadcastShape(e,n);var s="0.0";a!=null&&(k.backend_util.assertAndGetBroadcastShape(e,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";i!=null&&(k.backend_util.assertAndGetBroadcastShape(e,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `.concat(s,`;
        float scale = `).concat(u,`;
        float inv = scale * inversesqrt(variance + float(`).concat(o,`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `)}return r}();var uJe=function(){function r(e,t,n,a,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],k.backend_util.assertAndGetBroadcastShape(e,t),k.backend_util.assertAndGetBroadcastShape(e,n);var s="vec4(0.0)";a!=null&&(k.backend_util.assertAndGetBroadcastShape(e,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";i!=null&&(k.backend_util.assertAndGetBroadcastShape(e,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = `.concat(s,`;
        vec4 scale = `).concat(u,`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`).concat(o,`));

        setOutput((x - mean) * inv + offset);
      }
    `)}return r}();var cJe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.mean,o=e.variance,s=e.offset,u=e.scale;k.util.assert(i.shape.length===o.shape.length,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),k.util.assert(s==null||i.shape.length===s.shape.length,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),k.util.assert(u==null||i.shape.length===u.shape.length,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var c=n.varianceEpsilon;c==null&&(c=.001);var l=[a,i,o],f=null;s!=null&&(f=s.shape,l.push(s));var h=null;u!=null&&(h=u.shape,l.push(u));var p=k.env().getBool("WEBGL_PACK_NORMALIZATION")?new uJe(a.shape,i.shape,o.shape,f,h,c):new sJe(a.shape,i.shape,o.shape,f,h,c),d=t.runWebGLProgram(p,l,l[0].dtype);return d},lJe={kernelName:k.FusedBatchNorm,backendName:"webgl",kernelFunc:cJe};var fJe=function(){function r(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t=Ht(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var n=hJe(this.rank),a,i=e.map(function(o,s){return"sourceLoc.".concat(W2[s]," = start[").concat(s,"] + coords.").concat(W2[s],";")});a=`
        `.concat(t,` sourceLoc;
        `).concat(t,` coords = getOutputCoords();
        `).concat(i.join(`
`),`
      `),this.userCode=`
      void main() {
        `.concat(a,`
        setOutput(getSource(`).concat(n,`));
      }
    `)}return r}(),W2=["x","y","z","w","u","v"];function hJe(r){if(r===1)return"sourceLoc";if(r<=6)return W2.slice(0,r).map(function(e){return"sourceLoc."+e}).join(",");throw Error("Slicing for rank ".concat(r," is not yet supported"))}var pJe=function(){function r(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var t=Ht(this.rank),n=On("coords",this.rank),a=On("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s=`
      result.x = `.concat(o,`;
      if (++`).concat(n[this.rank-1]," < ").concat(e[this.rank-1],`) {
        ++`).concat(a[this.rank-1],`;
        result.y = `).concat(o,`;
        --`).concat(a[this.rank-1],`;
      }
    `),u=this.rank===1?"":`
      --`.concat(n[this.rank-1],`;
      if (++`).concat(n[this.rank-2]," < ").concat(e[this.rank-2],`) {
        ++`).concat(a[this.rank-2],`;
        result.z = `).concat(o,`;
        if (++`).concat(n[this.rank-1]," < ").concat(e[this.rank-1],`) {
          ++`).concat(a[this.rank-1],`;
          result.w = `).concat(o,`;
        }
      }
    `),c=this.rank<=4?`sourceLoc = coords +
            `.concat(t,"(").concat(e.map(function(l,f){return"start[".concat(f,"]")}).join(),");"):e.map(function(l,f){return"".concat(a[f]," = ").concat(n[f]," + start[").concat(f,"];")}).join(`
`);this.userCode=`
      void main() {
        `.concat(t,` coords = getOutputCoords();
        `).concat(t,` sourceLoc;
        `).concat(c,`
        vec4 result = vec4(0.);
        `).concat(s,`
        `).concat(u,`
        setOutput(result);
      }
    `)}return r}();function dJe(r,e,t,n){var a=n.texData.get(r.dataId),i=n.makeTensorInfo(t,r.dtype),o=n.texData.get(i.dataId);Object.assign(o,a),o.refCount=1,o.shape=t,o.dtype=r.dtype;var s=k.slice_util.computeFlatOffset(e,k.util.computeStrides(r.shape));a.slice&&(s+=a.slice.flatOffset),o.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||r.dataId};var u=n.dataRefCount.get(o.slice.origDataId)||1;return n.dataRefCount.set(o.slice.origDataId,u+1),i}function Ml(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.begin,o=n.size,s=Te(k.slice_util.parseSliceParams(a,i,o),2),u=s[0],c=s[1];if(k.slice_util.assertParamsValid(a,u,c),k.util.sizeFromShape(c)===0)return t.makeTensorInfo(c,a.dtype,[]);if(t.shouldExecuteOnCPU([a])||a.dtype==="string"){var l=t.texData.get(a.dataId),f=a9e(l.values,u,c,a.shape,a.dtype);return t.makeTensorInfo(c,a.dtype,f)}var h=t.texData.get(a.dataId).isPacked,p=k.slice_util.isSliceContinous(a.shape,u,c);if(h||!p){var d=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new pJe(c):new fJe(c),m=[u];return t.runWebGLProgram(d,[a],a.dtype,m)}return t.uploadToGPU(a.dataId),dJe(a,u,c,t)}var vJe={kernelName:k.Slice,backendName:"webgl",kernelFunc:Ml};var mJe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockShape,o=n.crops;k.util.assert(a.shape.length<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var s=i.reduce(function(y,w){return y*w}),u=k.backend_util.getReshaped(a.shape,i,s),c=k.backend_util.getPermuted(u.length,i.length),l=k.backend_util.getReshapedPermuted(a.shape,i,s),f=k.backend_util.getSliceBeginCoords(o,i.length),h=k.backend_util.getSliceSize(l,o,i.length),p=[],d=Ae({inputs:{x:a},backend:t,attrs:{shape:u}}),m=Mn({inputs:{x:d},backend:t,attrs:{perm:c}}),v=Ae({inputs:{x:m},backend:t,attrs:{shape:l}}),g=Ml({inputs:{x:v},backend:t,attrs:{begin:f,size:h}});return p.push(d),p.push(m),p.push(v),p.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),g},gJe={kernelName:k.BatchToSpaceND,backendName:"webgl",kernelFunc:mJe};function yJe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.weights,o=n.size,s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=o6(s,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,c)}var bJe={kernelName:k.Bincount,backendName:"webgl",kernelFunc:yJe},wJe=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,xJe=`
  return float(int(a.r) & int(b.r));
`;function kJe(r){var e=r.inputs,t=r.backend,n=e.a,a=e.b,i=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=k.env().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([n,a])||o===1){var s=t.texData.get(n.dataId).values,u=t.texData.get(a.dataId).values,c=Te(CXe(n.shape,a.shape,s,u,n.dtype),2),l=c[0],f=c[1],h=t.makeTensorInfo(f,n.dtype),p=t.texData.get(h.dataId);return p.values=l,h}var d;return i?d=new Ol(wJe,n.shape,a.shape,!1):d=new tc(xJe,n.shape,a.shape),t.runWebGLProgram(d,[n,a],n.dtype)}var SJe={kernelName:k.BitwiseAnd,backendName:"webgl",kernelFunc:kJe};function NJe(r){var e=r.inputs,t=r.backend,n=e.s0,a=e.s1,i=t.readSync(n.dataId),o=t.readSync(a.dataId),s=k.backend_util.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return t.makeTensorInfo([s.length],"int32",Int32Array.from(s))}var TJe={kernelName:k.BroadcastArgs,backendName:"webgl",kernelFunc:NJe};var EJe="return float(a != b);",x6=xn({opSnippet:EJe,cpuKernelImpl:XXe,dtype:"bool"}),IJe={kernelName:k.NotEqual,backendName:"webgl",kernelFunc:x6};function yp(r){var e=r.inputs,t=r.backend,n=e.input,a=t.texData.get(n.dataId);return Sa({inputs:{x:a.complexTensorInfos.real},backend:t})}var CJe={kernelName:k.Real,backendName:"webgl",kernelFunc:yp};var AJe="return float(int(x));";function DJe(r,e){var t=new io(r.shape,AJe),n=e.runWebGLProgram(t,[r],"int32");return{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}function U2(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.dtype;if(i==="complex64"){if(a.dtype==="complex64")return Sa({inputs:{x:a},backend:t});var o=f8e.zeros(a.shape),s=U2({inputs:{x:a},backend:t,attrs:{dtype:"float32"}}),u=Ps({inputs:{real:s,imag:o},backend:t});return o.dispose(),t.disposeIntermediateTensorInfo(s),u}if(a.dtype==="complex64"){var c=yp({inputs:{input:a},backend:t}),u=U2({inputs:{x:c},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(c),u}if(!k.util.hasEncodingLoss(a.dtype,i)){var u=Sa({inputs:{x:a},backend:t});return{dataId:u.dataId,shape:u.shape,dtype:i}}if(t.shouldExecuteOnCPU([a])){var l=t.texData.get(a.dataId).values,f=Te(AXe(l,a.shape,a.dtype,i),3),h=f[0],p=f[1],d=f[2];return t.makeTensorInfo(h,p,d)}if(i==="int32")return DJe(a,t);if(i==="bool"){var m=t.makeTensorInfo([],"bool",k.util.getTypedArrayFromDType("bool",1)),v={a,b:m},u=x6({inputs:v,backend:t});return t.disposeIntermediateTensorInfo(m),u}throw new Error("Error in Cast: failed to cast ".concat(a.dtype," to ").concat(i))}var _Je={kernelName:k.Cast,backendName:"webgl",kernelFunc:U2};var ZV="return ceil(x);",FJe=Ft({opSnippet:ZV,packedOpSnippet:ZV,cpuKernelImpl:DXe}),RJe={kernelName:k.Ceil,backendName:"webgl",kernelFunc:FJe};var OJe=function(){function r(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return r}();var PJe=function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return r}();function MJe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.clipValueMin,o=n.clipValueMax,s;k.env().getBool("WEBGL_PACK_CLIP")?s=new PJe(a.shape):s=new OJe(a.shape);var u=[[i],[o]];return t.runWebGLProgram(s,[a],a.dtype,u)}var BJe={kernelName:k.ClipByValue,backendName:"webgl",kernelFunc:MJe};var LJe=function(){function r(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}return r}();function QV(r,e){return{dataId:e.dataId,dtype:e.dtype,shape:r.shape}}function qJe(r){var e=r.inputs,t=r.backend,n=e.x,a=t.texData.get(n.dataId),i=new LJe(n.shape),o=[QV(n,a.complexTensorInfos.real),QV(n,a.complexTensorInfos.imag)];return t.runWebGLProgram(i,o,o[0].dtype)}var zJe={kernelName:k.ComplexAbs,backendName:"webgl",kernelFunc:qJe};var $Je=function(){function r(e){this.outputShape=[],this.outputShape=k.backend_util.computeOutShape(e,1),this.variableNames=e.map(function(u,c){return"T".concat(c)});var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];for(var a=["if (yC < ".concat(t[0],") setOutput(getT0(yR, yC));")],n=1;n<t.length;n++){var i=t[n-1];a.push("else if (yC < ".concat(t[n],") ")+"setOutput(getT".concat(n,"(yR, yC-").concat(i,"));"))}var o=t.length,s=t[t.length-1];a.push("else setOutput(getT".concat(o,"(yR, yC-").concat(s,"));")),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `.concat(a.join(`
        `),`
      }
    `)}return r}();var WJe=function(){function r(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=k.backend_util.computeOutShape(e,t);var n=this.outputShape,a=n.length,i=Ht(a),o=On("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=e.map(function(g,y){return"T".concat(y)});var u=new Array(e.length-1);u[0]=e[0][t];for(var c=1;c<u.length;c++)u[c]=u[c-1]+e[c][t];for(var l=s[t],f=s.slice(-2),h=s.join(),p="if (".concat(l," < ").concat(u[0],`) {
        return getChannel(
            getT0(`).concat(h,"), vec2(").concat(f.join(),`));
        }`),c=1;c<u.length;c++){var d=u[c-1];p+=`
        if (`.concat(l," < ").concat(u[c],"  && ").concat(l," >= ").concat(u[c-1],`) {
          return getChannel(
            getT`).concat(c,"(").concat(Sg(s,l,d),`),
            vec2(`).concat(Sg(f,l,d),`));
        }`)}var m=u.length,v=u[u.length-1];p+=`
        return getChannel(
          getT`.concat(m,"(").concat(Sg(s,l,v),`),
          vec2(`).concat(Sg(f,l,v),"));"),this.userCode=`
      float getValue(`.concat(s.map(function(g){return"int "+g}),`) {
        `).concat(p,`
      }

      void main() {
        `).concat(i,` coords = getOutputCoords();
        vec4 result = vec4(getValue(`).concat(o,`), 0., 0., 0.);

        `).concat(o[a-1]," = ").concat(o[a-1],` + 1;
        if (`).concat(o[a-1]," < ").concat(n[a-1],`) {
          result.g = getValue(`).concat(o,`);
        }

        `).concat(o[a-2]," = ").concat(o[a-2],` + 1;
        if (`).concat(o[a-2]," < ").concat(n[a-2],`) {
          result.a = getValue(`).concat(o,`);
        }

        `).concat(o[a-1]," = ").concat(o[a-1],` - 1;
        if (`).concat(o[a-2]," < ").concat(n[a-2],` &&
            `).concat(o[a-1]," < ").concat(n[a-1],`) {
          result.b = getValue(`).concat(o,`);
        }
        setOutput(result);
      }
    `)}return r}();function Sg(r,e,t){var n=r.indexOf(e),a=r.map(function(i,o){return o===n?"".concat(i," - ").concat(t):i});return a.join()}function Mg(r){var e=r.inputs,t=r.backend,n=e.input,a=t.texData.get(n.dataId);return Sa({inputs:{x:a.complexTensorInfos.imag},backend:t})}var UJe={kernelName:k.Imag,backendName:"webgl",kernelFunc:Mg};function lp(r,e,t){var n,a,i=r[0].dtype;if(i==="complex64"){var o=r.map(function(V){return yp({inputs:{input:V},backend:t})}),s=r.map(function(V){return Mg({inputs:{input:V},backend:t})}),u=lp(o,e,t),c=lp(s,e,t),l=Ps({inputs:{real:u,imag:c},backend:t});return o.forEach(function(V){return t.disposeIntermediateTensorInfo(V)}),s.forEach(function(V){return t.disposeIntermediateTensorInfo(V)}),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(c),l}var f=t.shouldExecuteOnCPU(r);if(i==="string"&&(f=!0),f){var h=r.map(function(V){var X=k.util.sizeFromShape(V.shape.slice(e)),ne=[-1,X];return Ae({inputs:{x:V},backend:t,attrs:{shape:ne}})}),p=h.map(function(V){return{vals:t.readSync(V.dataId),shape:V.shape}}),d=k.backend_util.computeOutShape(h.map(function(V){return V.shape}),1),m=h[0].shape[0]===1,v=_Xe(p,d,i,m),g=k.backend_util.computeOutShape(r.map(function(V){return V.shape}),e),y=t.makeTensorInfo(g,i,v);return h.forEach(function(V){return t.disposeIntermediateTensorInfo(V)}),y}var w=r.filter(function(V){return k.util.sizeFromShape(V.shape)>0}),b=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&w[0].shape.length>1;if(w.length===1){var x=b?new io(r[0].shape,Rs):new Os(r[0].shape,Rs);return t.runWebGLProgram(x,r,i)}var S=k.env().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(w.length>S){for(var T=[],E=0;E<w.length;E+=S){var C=w.slice(E,E+S);T.push(lp(C,e,t))}var R=lp(T,e,t);try{for(var _=Pn(T),M=_.next();!M.done;M=_.next()){var E=M.value;t.disposeIntermediateTensorInfo(E)}}catch(V){n={error:V}}finally{try{M&&!M.done&&(a=_.return)&&a.call(_)}finally{if(n)throw n.error}}return R}if(b){var $=new WJe(w.map(function(V){return V.shape}),e);return t.runWebGLProgram($,w,i)}var z=VJe(w,e,t),q=z.tensors2D,L=z.outShape,U=new $Je(q.map(function(V){return V.shape})),Y=t.runWebGLProgram(U,q,i);q.forEach(function(V){return t.disposeIntermediateTensorInfo(V)});var Z=Ae({inputs:{x:Y},attrs:{shape:L},backend:t});return t.disposeIntermediateTensorInfo(Y),Z}function VJe(r,e,t){var n=k.backend_util.computeOutShape(r.map(function(i){return i.shape}),e),a=r.map(function(i){return Ae({inputs:{x:i},attrs:{shape:[-1,k.util.sizeFromShape(i.shape.slice(e))]},backend:t})});return{tensors2D:a,outShape:n}}function k6(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.axis,i=k.util.parseAxisParam(a,e[0].shape)[0],o=e.map(function(c){return c.shape});k.backend_util.assertParamsConsistent(o,i);var s=k.backend_util.computeOutShape(e.map(function(c){return c.shape}),i);if(k.util.sizeFromShape(s)===0)return t.makeTensorInfo(s,e[0].dtype,[]);var u=e.filter(function(c){return k.util.sizeFromShape(c.shape)>0});return u.length===1?Sa({inputs:{x:u[0]},backend:t}):lp(u,i,t)}var GJe={kernelName:k.Concat,backendName:"webgl",kernelFunc:k6};var S6=function(){function r(e,t,n,a,i){t===void 0&&(t=!1),n===void 0&&(n=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,f=e.dilationWidth,h=e.filterHeight,p=e.filterWidth,d=Math.floor(e.inChannels/4)*4,m=e.inChannels%4,v=e.dataFormat==="channelsLast",g=v?1:2,y=v?2:3,w=v?3:1,b="",x="";n&&(a?b=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `.concat(n,`
        }`):i?b=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          `.concat(n,`
        }`):b=`
          float activation(float x) {
            `.concat(n,`
          }
        `),x="result = activation(result);");var S=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `.concat(b,`

      const ivec2 strides = ivec2(`).concat(u,", ").concat(c,`);
      const ivec2 pads = ivec2(`).concat(o,", ").concat(s,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`).concat(w,`];

        ivec2 xRCCorner =
            ivec2(coords[`).concat(g,"], coords[").concat(y,`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(h,`; wR++) {
          int xR = xRCorner + wR * `).concat(l,`;

          if (xR < 0 || xR >= `).concat(e.inHeight,`) {
            continue;
          }

          for (int wC = 0; wC < `).concat(p,`; wC++) {
            int xC = xCCorner + wC * `).concat(f,`;

            if (xC < 0 || xC >= `).concat(e.inWidth,`) {
              continue;
            }

            for (int d1 = 0; d1 < `).concat(d,`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`).concat(v,`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`).concat(m===1,`) {

              if (`).concat(v,`) {
                dotProd +=
                    getX(batch, xR, xC, `).concat(d,`) *
                    getW(wR, wC, `).concat(d,`, d2);
              } else {
                dotProd +=
                    getX(batch, `).concat(d,`, xR, xC) *
                    getW(wR, wC, `).concat(d,`, d2);
              }

            } else if (`).concat(m===2,`) {
              vec2 wValues = vec2(
                getW(wR, wC, `).concat(d,`, d2),
                getW(wR, wC, `).concat(d,` + 1, d2)
              );

              if (`).concat(v,`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `).concat(d,`),
                  getX(batch, xR, xC, `).concat(d,` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `).concat(d,`, xR, xC),
                  getX(batch, `).concat(d,` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`).concat(m===3,`) {
              vec3 wValues = vec3(
                getW(wR, wC, `).concat(d,`, d2),
                getW(wR, wC, `).concat(d,` + 1, d2),
                getW(wR, wC, `).concat(d,` + 2, d2)
              );

              if (`).concat(v,`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `).concat(d,`),
                  getX(batch, xR, xC, `).concat(d,` + 1),
                  getX(batch, xR, xC, `).concat(d,` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `).concat(d,`, xR, xC),
                  getX(batch, `).concat(d,` + 1, xR, xC),
                  getX(batch, `).concat(d,` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `).concat(S,`
        `).concat(x,`
        setOutput(result);
      }
    `)}return r}(),HJe=function(){function r(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,a=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=e.dilationDepth,c=e.dilationHeight,l=e.dilationWidth,f=e.filterDepth,h=e.filterHeight,p=e.filterWidth,d=Math.floor(e.inChannels/4)*4,m=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`.concat(i,", ").concat(o,", ").concat(s,`);
      const ivec3 pads = ivec3(`).concat(t,", ").concat(n,", ").concat(a,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `).concat(f,`; wF++) {
          int xF = xFCorner + wF * `).concat(u,`;

          if (xF < 0 || xF >= `).concat(e.inDepth,`) {
            continue;
          }

          for (int wR = 0; wR < `).concat(h,`; wR++) {
            int xR = xRCorner + wR * `).concat(c,`;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int wC = 0; wC < `).concat(p,`; wC++) {
              int xC = xCCorner + wC * `).concat(l,`;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              for (int d1 = 0; d1 < `).concat(d,`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`).concat(m===1,`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `).concat(d,`) *
                  getW(wF, wR, wC, `).concat(d,`, d2);
              } else if (`).concat(m===2,`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `).concat(d,`),
                  getX(batch, xF, xR, xC, `).concat(d,` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `).concat(d,`, d2),
                  getW(wF, wR, wC, `).concat(d,` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`).concat(m===3,`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `).concat(d,`),
                  getX(batch, xF, xR, xC, `).concat(d,` + 1),
                  getX(batch, xF, xR, xC, `).concat(d,` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `).concat(d,`, d2),
                  getW(wF, wR, wC, `).concat(d,` + 1, d2),
                  getW(wF, wR, wC, `).concat(d,` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}();var N6=function(){function r(e,t,n,a,i){t===void 0&&(t=!1),n===void 0&&(n=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=En(this.outputShape.length);for(var o=e.padInfo.left,s=e.strideWidth,u=e.dilationWidth,c=e.filterHeight,l=e.filterWidth,f=l,h=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`,p=0;p<l;p++)h+=`
           vec4 xTexelC`.concat(p*2,`;
           int xTexelC`).concat(p*2,`Ready;
           vec4 xTexelC`).concat(p*2+1,`;
           int xTexelC`).concat(p*2+1,`Ready;
           vec4 xC`).concat(p,";");h+=`
     for (int r = 0; r < `.concat(c,`; r++) {
      for (int d1 = 0; d1 < `).concat(e.inChannels,`; d1 += 2) {
       `);for(var p=0;p<l;p++)h+=`
           xTexelC`.concat(p*2,` = vec4(0.0);
           xTexelC`).concat(p*2,`Ready = 0;
           xTexelC`).concat(p*2+1,` = vec4(0.0);
           xTexelC`).concat(p*2+1,`Ready = 0;
           xC`).concat(p," = vec4(0.0);");h+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(var d=0;d<(f+1)/2;d++){var m=d*2;if(h+=`
           xC = xCCorner + `.concat(m*u,`;
           `),s===1){if(m<l&&(o%2===1?(h+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                   xTexelC`).concat(m,` = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`).concat(m,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(m,`Ready = 1;
                 }
               `),u===1&&m>0?h+=`
                 xC`.concat(m," = vec4(xTexelC").concat(m-2,".zw, xTexelC").concat(m,`.xy);
                 `):h+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC`.concat(m," = vec4(previous.zw, xTexelC").concat(m,`.xy);
                   } else {
                     xC`).concat(m," = vec4(0.0, 0.0, xTexelC").concat(m,`.xy);
                   }
                   `)):h+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                   xTexelC`).concat(m,` = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC`).concat(m,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(m,`Ready = 1;
                 }

                 xC`).concat(m," = xTexelC").concat(m,`;
                 `),m+1<l)){var v=o%2===0?k.util.nearestLargerEven(u):u;u%2===0&&o%2===1||u%2!==0&&o%2!==1?(h+=`
                   xCOffset = xC + imod(pads[1], 2) + `.concat(v,`;

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                     xTexelC`).concat(m+1,` = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC`).concat(m+1,`.zw = vec2(0.0);
                     }
                     xTexelC`).concat(m+1,`Ready = 1;
                   }
                   `),u>1?h+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC`.concat(m+1," = vec4(previous.zw, xTexelC").concat(m+1,`.xy);
                     } else {
                      xC`).concat(m+1," = vec4(0.0, 0.0, xTexelC").concat(m+1,`.xy);
                     }
                     `):h+=`
                     xC`.concat(m+1," = vec4(xTexelC").concat(m,".zw, xTexelC").concat(m+1,`.xy);
                     `)):v===1?h+=`
                     xC`.concat(m+1," = xTexelC").concat(m,`;
                     `):h+=`
                     xCOffset = xC + `.concat(v,`;

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                       xTexelC`).concat(m+1,` = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC`).concat(m+1,`.zw = vec2(0.0);
                       }
                       xTexelC`).concat(m+1,`Ready = 1;
                     }

                     xC`).concat(m+1," = xTexelC").concat(m+1,`;
                     `)}}else m<l&&(o%2===1?(h+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                   xTexelC`).concat(m,` = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`).concat(m,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(m,`Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                   xTexelC`).concat(m+1,` = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC`).concat(m+1,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(m+1,`Ready = 1;
                 }

                 xC`).concat(m," = vec4(xTexelC").concat(m,".zw, xTexelC").concat(m+1,`.zw);
               `),m+1<l&&(h+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC`.concat(m+1," = vec4(xTexelC").concat(m+1,`.xy, final.xy);
                 `))):(h+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                   xTexelC`).concat(m,` = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC`).concat(m,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(m,`Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                   xTexelC`).concat(m+1,` = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`).concat(m+1,`.zw = vec2(0.);
                   }
                   xTexelC`).concat(m+1,`Ready = 1;
                 }

                 xC`).concat(m,` = vec4(
                   xTexelC`).concat(m,".xy, xTexelC").concat(m+1,`.xy);
               `),m+1<l&&(h+=`
                   xC`.concat(m+1," = vec4(xTexelC").concat(m,".zw, xTexelC").concat(m+1,`.zw);
                 `))));m<l&&(h+=`
             wTexel = getW(r, `.concat(m,`, d1, d2);
             dotProd += xC`).concat(m,`.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < `).concat(e.inChannels,`) {
               dotProd += xC`).concat(m,`.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `),m+1<l&&(h+=`
               wTexel = getW(r, `.concat(m+1,`, d1, d2);
               dotProd += xC`).concat(m+1,`.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < `).concat(e.inChannels,`) {
                 dotProd += xC`).concat(m+1,`.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `)))}h+=`
     }
   `,h+=`
     }
   `,h+=`
     }
   `;var g="",y="";n&&(a?g=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           `.concat(n,`
         }`):i?g=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           `.concat(n,`
         }`):g=`vec4 activation(vec4 x) {
           `.concat(n,`
         }`),y="result = activation(result);");var w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       `.concat(g,`

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         `).concat(h,`

         vec4 result = dotProd - vec4(0.000000000000001);
         `).concat(w,`
         `).concat(y,`
         setOutput(result);
       }
     `)}return r}();var jJe=function(){function r(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=En(this.outputShape.length);for(var n=t.dataFormat,a=Bn(),i=n==="channelsLast",o=i?1:2,s=i?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < ".concat(e[2]," && pos < ").concat(e[1],") {"),c="",l=0;l<=1;l++)for(var f=0;f<=1;f++)c+=`
          blockIndex = rc.z + `.concat(f,`;
          pos = rc.y + `).concat(l,`;

          `).concat(u,`
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[`).concat(o,`] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[`).concat(s,`] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (`).concat(i,`) {
                  innerDims = vec2(d1, ch);
                  result[`).concat(l*2+f,`] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`).concat(l*2+f,`] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `);this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `.concat(c,`

        `).concat(a.output,` = result;
      }
    `)}return r}();function _g(r,e){var t=r.length;return t>=3?e?Sr(Sr([],Te(r.slice(0,-3)),!1),[r[t-3]*r[t-2],r[t-1]],!1):Sr(Sr([],Te(r.slice(0,-3)),!1),[r[t-3],r[t-2]*r[t-1]],!1):!e&&t===1&&r[0]>1?[r[0],1]:null}function T6(r){var e,t,n=r.x,a=r.filter,i=r.convInfo,o=r.backend,s=r.bias,u=s===void 0?null:s,c=r.preluActivationWeights,l=c===void 0?null:c,f=r.leakyreluAlpha,h=f===void 0?0:f,p=r.activation,d=p===void 0?null:p,m=n.shape,v=o.texData.get(n.dataId),g=i.inChannels,y=m[0]*m[1]*m[2],w=i.outChannels,b=i.dataFormat==="channelsLast",x=!1,S=!1,T,E=[];if(l!=null){var C=_g(l.shape,b);C!=null&&(l=Ae({inputs:{x:l},backend:o,attrs:{shape:C}}),E.push(l))}if(u!=null){var C=_g(u.shape,b);C!=null&&(u=Ae({inputs:{x:u},backend:o,attrs:{shape:C}}),E.push(u))}var R=(y===1||w===1)&&g>g6,_=!R&&v.isPacked&&b&&v.texture!=null&&m[2]%2!==0&&k.util.arraysEqual(v.shape.slice(-3),m.slice(-3));if(_){var C=m[0]*m[1]*(m[2]+1),M={dataId:n.dataId,shape:[1,C,i.inChannels],dtype:n.dtype},$=v.shape;v.shape=v.shape.slice(),v.shape[v.shape.length-2]++,k.util.assert(hp(v.shape,M.shape),function(){return"packed reshape ".concat(v.shape," to ").concat(M.shape," isn't free")});var z=Ae({inputs:{x:a},backend:o,attrs:{shape:[1,i.inChannels,i.outChannels]}});E.push(z);var q=Dg({a:M,b:z,backend:o,transposeA:x,transposeB:S,bias:u,activation:d,preluActivationWeights:l,leakyreluAlpha:h}),L=o.texData.get(q.dataId);k.util.assert(L.isPacked,function(){return"batchMatMul result is expected to be packed"}),v.shape=$,L.shape=i.outShape,T=Sa({inputs:{x:q},backend:o}),T.shape=i.outShape,E.push(q)}else{var U=i.outHeight*i.outWidth,Y=Ae({inputs:{x:n},backend:o,attrs:{shape:b?[i.batchSize,U,i.inChannels]:[i.batchSize,i.inChannels,U]}}),z=Ae({inputs:{x:a},backend:o,attrs:{shape:[1,i.inChannels,i.outChannels]}}),Z=Dg({a:b?Y:z,b:b?z:Y,transposeA:!b,transposeB:S,backend:o,bias:u,activation:d,preluActivationWeights:l,leakyreluAlpha:h});T=Ae({inputs:{x:Z},backend:o,attrs:{shape:i.outShape}}),E.push(Y),E.push(z),E.push(Z)}try{for(var V=Pn(E),X=V.next();!X.done;X=V.next()){var ne=X.value;o.disposeIntermediateTensorInfo(ne)}}catch(re){e={error:re}}finally{try{X&&!X.done&&(t=V.return)&&t.call(V)}finally{if(e)throw e.error}}return T}function E6(r){var e,t,n=r.x,a=r.filter,i=r.convInfo,o=r.backend,s=r.bias,u=s===void 0?null:s,c=r.preluActivationWeights,l=c===void 0?null:c,f=r.leakyreluAlpha,h=f===void 0?0:f,p=r.activation,d=p===void 0?null:p,m=i.filterWidth,v=i.filterHeight,g=i.inChannels,y=i.outWidth,w=i.outHeight,b=i.dataFormat,x=b==="channelsLast",S=m*v*g,T=w*y,E=[i.batchSize,S,T],C=!0,R=!1,_=[];if(l!=null){var M=_g(l.shape,x);M!=null&&(l=Ae({inputs:{x:l},backend:o,attrs:{shape:M}}),_.push(l))}if(u!=null){var M=_g(u.shape,x);M!=null&&(u=Ae({inputs:{x:u},backend:o,attrs:{shape:M}}),_.push(u))}var $=Ae({inputs:{x:a},backend:o,attrs:{shape:[1,S,k.util.sizeFromShape(a.shape)/S]}});_.push($);var z=new jJe(E,i),q=[n.shape,[i.padInfo.top,i.padInfo.left],[i.strideHeight,i.strideWidth],[i.dilationHeight,i.dilationWidth],[i.inChannels],[i.filterWidth*i.inChannels],[i.outWidth]],L=o.runWebGLProgram(z,[n],"float32",q),U=Ae({inputs:{x:L},backend:o,attrs:{shape:E}});_.push(L),_.push(U);var Y=u!=null,Z=l!=null,V=d==="leakyrelu",X=d?pp(d,!0):null,ne=new m6(x?U.shape:$.shape,x?$.shape:U.shape,x?[i.batchSize,T,i.outChannels]:[i.batchSize,i.outChannels,T],C,R,Y,X,Z,V),re=x?[U,$]:[$,U];if(u&&re.push(u),Z&&re.push(l),V){var se=o.makeTensorInfo([],"float32",k.util.createScalarValue(h,"float32"));re.push(se),_.push(se)}var le=o.runWebGLProgram(ne,re,"float32"),de=Ae({inputs:{x:le},backend:o,attrs:{shape:i.outShape}});_.push(le);try{for(var ke=Pn(_),he=ke.next();!he.done;he=ke.next()){var ye=he.value;o.disposeIntermediateTensorInfo(ye)}}catch(xe){e={error:xe}}finally{try{he&&!he.done&&(t=ke.return)&&t.call(ke)}finally{if(e)throw e.error}}return de}function KJe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dataFormat,c=n.dilations,l=n.dimRoundingMode,f=k.backend_util.convertConv2DDataFormat(u),h=k.backend_util.computeConv2DInfo(a.shape,i.shape,o,c,s,l,!1,f),p;if(h.filterHeight===1&&h.filterWidth===1&&h.dilationHeight===1&&h.dilationWidth===1&&h.strideHeight===1&&h.strideWidth===1&&(h.padInfo.type==="SAME"||h.padInfo.type==="VALID"))p=T6({x:a,filter:i,convInfo:h,backend:t});else if(h.strideWidth<=2&&f==="channelsLast"&&k.env().getBool("WEBGL_EXP_CONV")){var d=new N6(h),m=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];p=t.runWebGLProgram(d,[a,i],"float32",m)}else if(k.env().getBool("WEBGL_CONV_IM2COL"))p=E6({x:a,filter:i,convInfo:h,backend:t});else{var d=new S6(h);p=t.runWebGLProgram(d,[a,i],"float32")}var v=Ae({inputs:{x:p},backend:t,attrs:{shape:h.outShape}});return t.disposeIntermediateTensorInfo(p),v}var XJe={kernelName:k.Conv2D,backendName:"webgl",kernelFunc:KJe};var YJe=function(){function r(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,a=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `.concat(e.batchSize,`; b++) {
          for (int yR = 0; yR < `).concat(e.outHeight,`; yR++) {
            int xR = wR + yR * `).concat(t," - ").concat(a,`;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int yC = 0; yC < `).concat(e.outWidth,`; yC++) {
              int xC = wC + yC * `).concat(n," - ").concat(i,`;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              `).concat(o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`,`
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}(),JJe=function(){function r(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",s=t-1-e.padInfo.top,u=n-1-e.padInfo.left,c=o?1:2,l=o?2:3,f=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(`.concat(s,", ").concat(u,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`).concat(f,`];

        ivec2 dyCorner = ivec2(coords[`).concat(c,"], coords[").concat(l,`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(t,`; wR++) {
          float dyR = float(dyRCorner + wR) / `).concat(a,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `).concat(t,` - 1 - wR;

          for (int wC = 0; wC < `).concat(n,`; wC++) {
            float dyC = float(dyCCorner + wC) / `).concat(i,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `).concat(n,` - 1 - wC;

            for (int d2 = 0; d2 < `).concat(e.outChannels,`; d2++) {

              if (`).concat(o,`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}(),ZJe=function(){function r(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,a=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,s=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `.concat(e.batchSize,`; b++) {
          for (int yF = 0; yF < `).concat(e.outDepth,`; yF++) {
            int xF = wF + yF * `).concat(t," - ").concat(i,`;

            if (xF < 0 || xF >= `).concat(e.inDepth,`) {
              continue;
            }

            for (int yR = 0; yR < `).concat(e.outHeight,`; yR++) {
              int xR = wR + yR * `).concat(n," - ").concat(o,`;

              if (xR < 0 || xR >= `).concat(e.inHeight,`) {
                continue;
              }

              for (int yC = 0; yC < `).concat(e.outWidth,`; yC++) {
                int xC = wC + yC * `).concat(a," - ").concat(s,`;

                if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}(),QJe=function(){function r(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,a=e.filterWidth,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=t-1-e.padInfo.front,c=n-1-e.padInfo.top,l=a-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`.concat(u,", ").concat(c,", ").concat(l,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `).concat(t,`; wF++) {
          float dyF = float(dyFCorner + wF) / `).concat(i,`.0;

          if (dyF < 0.0 || dyF >= `).concat(e.outDepth,`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `).concat(t,` - 1 - wF;

          for (int wR = 0; wR < `).concat(n,`; wR++) {
            float dyR = float(dyRCorner + wR) / `).concat(o,`.0;

            if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `).concat(n,` - 1 - wR;

            for (int wC = 0; wC < `).concat(a,`; wC++) {
              float dyC = float(dyCCorner + wC) / `).concat(s,`.0;

              if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `).concat(a,` - 1 - wC;

              for (int d2 = 0; d2 < `).concat(e.outChannels,`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}();function eZe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode,l=n.filterShape,f=k.backend_util.convertConv2DDataFormat(u),h=k.backend_util.computeConv2DInfo(a.shape,l,o,1,s,c,!1,f),p=new YJe(h);return t.runWebGLProgram(p,[a,i],"float32")}var tZe={kernelName:k.Conv2DBackpropFilter,backendName:"webgl",kernelFunc:eZe};var rZe=function(){function r(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=En(this.outputShape.length);var t=e.filterHeight,n=e.filterWidth,a=t-1-e.padInfo.top,i=n-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(`.concat(a,", ").concat(i,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < `).concat(t,`; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = `).concat(t,` - 1 - wR;

          for (int wC = 0; wC < `).concat(n,`; wC++) {
            int wCPerm = `).concat(n,` - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < `).concat(e.outWidth,`.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < `).concat(e.outWidth,`.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < `).concat(e.outChannels,`; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < `).concat(e.outChannels,`; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < `).concat(e.outChannels,`; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `)}return r}();function nZe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.inputShape,s=n.strides,u=n.pad,c=n.dataFormat,l=n.dimRoundingMode,f=k.backend_util.convertConv2DDataFormat(c),h=k.backend_util.computeConv2DInfo(o,i.shape,s,1,u,l,!1,f);if(k.env().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&f==="channelsLast"){var p=[[h.strideHeight,h.strideWidth]],d=new rZe(h);return t.runWebGLProgram(d,[a,i],"float32",p)}else{var d=new JJe(h);return t.runWebGLProgram(d,[a,i],"float32")}}var aZe={kernelName:k.Conv2DBackpropInput,backendName:"webgl",kernelFunc:nZe};function iZe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,c=k.backend_util.computeConv3DInfo(a.shape,i.shape,o,u,s),l=new HJe(c);return t.runWebGLProgram(l,[a,i],"float32")}var oZe={kernelName:k.Conv3D,backendName:"webgl",kernelFunc:iZe};function sZe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.pad,u=n.filterShape,c=k.backend_util.computeConv3DInfo(a.shape,u,o,1,s),l=new ZJe(c);return t.runWebGLProgram(l,[a,i],"float32")}var uZe={kernelName:k.Conv3DBackpropFilterV2,backendName:"webgl",kernelFunc:sZe};function cZe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.pad,s=n.strides,u=n.inputShape,c=k.backend_util.computeConv3DInfo(u,i.shape,s,1,o),l=new QJe(c);return t.runWebGLProgram(l,[a,i],"float32")}var lZe={kernelName:k.Conv3DBackpropInputV2,backendName:"webgl",kernelFunc:cZe};var fZe=Pl+`
  return cos(x);
`,hZe=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  `.concat(ac,`
  return result;
`),pZe=Ft({opSnippet:fZe,packedOpSnippet:hZe}),dZe={kernelName:k.Cos,backendName:"webgl",kernelFunc:pZe};var vZe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,mZe=Ft({opSnippet:vZe}),gZe={kernelName:k.Cosh,backendName:"webgl",kernelFunc:mZe};var yZe=function(){function r(e,t,n,a,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3],f=Te(t,1),h=f[0],p=Te(n,2),d=p[0],m=p[1];this.outputShape=[h,d,m,l];var v=a==="bilinear"?1:0,g=Te(["".concat(u-1,".0"),"".concat(c-1,".0")],2),y=g[0],w=g[1],b=Te(d>1?["".concat((u-1)/(d-1)),"(y2-y1) * height_ratio","y1*".concat(y," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(y)],3),x=b[0],S=b[1],T=b[2],E=Te(m>1?["".concat((c-1)/(m-1)),"(x2-x1) * width_ratio","x1*".concat(w," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(w)],3),C=E[0],R=E[1],_=E[2];this.userCode=`
      const float height_ratio = float(`.concat(x,`);
      const float width_ratio = float(`).concat(C,`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `).concat(s,`) {
          return;
        }

        float height_scale = `).concat(S,`;
        float width_scale = `).concat(R,`;

        float in_y = `).concat(T,`;
        if( in_y < 0.0 || in_y > `).concat(y,` ) {
          setOutput(float(`).concat(i,`));
          return;
        }
        float in_x = `).concat(_,`;
        if( in_x < 0.0 || in_x > `).concat(w,` ) {
          setOutput(float(`).concat(i,`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`).concat(v,` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `)}return r}();var bZe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.image,i=e.boxes,o=e.boxInd,s=n.cropSize,u=n.method,c=n.extrapolationValue,l=new yZe(a.shape,i.shape,s,u,c);return t.runWebGLProgram(l,[a,i,o],"float32")},wZe={kernelName:k.CropAndResize,backendName:"webgl",kernelFunc:bZe},vp;(function(r){r.Prod="*",r.Sum="+"})(vp||(vp={}));var eG=function(){function r(e,t,n,a){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];var i=this.outputShape.length,o=this.op===vp.Prod?"1.0":"0.0",s=n?o:"getX(".concat(tG(i,"coords",this.op),")"),u=this.outputShape[this.outputShape.length-1],c="",l="";n?(c=a?"end != ".concat(u-1):"end != 0",l=a?"end + 1":"end - 1"):(c=a?"end + pow2 < ".concat(u):"end >= pow2",l=a?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        `.concat(Ht(i),` coords = getOutputCoords();
        int end = `).concat(rG(i,"coords",this.op),`;
        float val = `).concat(s,`;
        int pow2 = int(pow(2.0, index));
        if (`).concat(c,`) {
          int idx = `).concat(l,`;
          `).concat(rG(i,"coords",this.op),` = idx;
          val `).concat(this.op,"= getX(").concat(tG(i,"coords",this.op),`);
        }
        setOutput(val);
      }
    `)}return r}();function tG(r,e,t){if(r===1)return"".concat(e);if(r===2)return"".concat(e,".x, ").concat(e,".y");if(r===3)return"".concat(e,".x, ").concat(e,".y, ").concat(e,".z");if(r===4)return"".concat(e,".x, ").concat(e,".y, ").concat(e,".z, ").concat(e,".w");throw new Error("Cumulative ".concat(t," for rank ").concat(r," is not yet supported"))}function rG(r,e,t){if(r===1)return"".concat(e);if(r===2)return"".concat(e,".y");if(r===3)return"".concat(e,".z");if(r===4)return"".concat(e,".w");throw new Error("Cumulative ".concat(t," for rank ").concat(r," is not yet supported"))}function I6(r,e,t,n,a,i){var o=e.shape.length,s=k.backend_util.getAxesPermutation([n],o),u=e;s!=null&&(u=Mn({inputs:{x:e},backend:t,attrs:{perm:s}}));var c=k.backend_util.getInnerMostAxes(1,o)[0];if(c!==o-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(e.shape.length-1," ")+"but got axis=".concat(n));for(var l=u.shape[c],f=Sa({inputs:{x:u},backend:t}),h=0;h<=Math.ceil(Math.log2(l))-1;h++){var p=new eG(r,u.shape,!1,i),d=[[h]],m=f;f=t.runWebGLProgram(p,[f],f.dtype,d),t.disposeIntermediateTensorInfo(m)}if(a){var p=new eG(r,u.shape,a,i),m=f;f=t.runWebGLProgram(p,[f],f.dtype),t.disposeIntermediateTensorInfo(m)}if(s!=null){var v=k.backend_util.getUndoAxesPermutation(s),g=Mn({inputs:{x:f},backend:t,attrs:{perm:v}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(u),g}return f}function xZe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.exclusive,s=n.reverse;return I6(vp.Prod,a,t,i,o,s)}var kZe={kernelName:k.Cumprod,backendName:"webgl",kernelFunc:xZe};function SZe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.exclusive,s=n.reverse;return I6(vp.Sum,a,t,i,o,s)}var NZe={kernelName:k.Cumsum,backendName:"webgl",kernelFunc:SZe};function TZe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.weights,o=n.size,s=n.binaryOutput;if(a.shape.length===1){var u=t.readSync(a.dataId),c=t.readSync(i.dataId),l=o6(u,c,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,l)}else if(a.shape.length===2){var f=t.bufferSync(a),h=t.bufferSync(i),p=IXe(f,h,o,s);return t.makeTensorInfo(p.shape,i.dtype,p.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}var EZe={kernelName:k.DenseBincount,backendName:"webgl",kernelFunc:TZe};var IZe=function(){function r(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `.concat(this.getHeightCoordString(),`;
      int w = `).concat(this.getWidthCoordString(),`;
      int d = `).concat(this.getDepthCoordString(),`;

      int in_h = h / `).concat(t,`;
      int offset_h = imod(h, `).concat(t,`);
      int in_w = w / `).concat(t,`;
      int offset_w = imod(w, `).concat(t,`);
      int offset_d = (offset_h * `).concat(t,` + offset_w) *
        `).concat(this.getOutputDepthSize(),`;
      int in_d = d + offset_d;

      float result = `).concat(this.getInputSamplingString(),`;
      setOutput(result);
    }
  `)}return r.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},r.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},r.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},r.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},r.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},r}();function CZe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockSize,o=n.dataFormat,s=a.shape[0],u=o==="NHWC"?a.shape[1]:a.shape[2],c=o==="NHWC"?a.shape[2]:a.shape[3],l=o==="NHWC"?a.shape[3]:a.shape[1],f=u*i,h=c*i,p=l/(i*i),d=o==="NHWC"?[s,f,h,p]:[s,p,f,h],m=new IZe(d,i,o);return t.runWebGLProgram(m,[a],a.dtype)}var AZe={kernelName:k.DepthToSpace,backendName:"webgl",kernelFunc:CZe};var C6=function(){function r(e,t,n,a,i){t===void 0&&(t=!1),n===void 0&&(n=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=En(this.outputShape.length);var o=e.filterHeight,s=e.filterWidth,u=e.outChannels/e.inChannels,c="",l="";n&&(a?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `.concat(n,`
        }`):i?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          `.concat(n,`
        }`):c=`
          float activation(float x) {
            `.concat(n,`
          }
        `),l="result = activation(result);");var f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `.concat(c,`

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `).concat(u,`;
        int q = d2 - d1 * `).concat(u,`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `).concat(o,`; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < `).concat(s,`; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `).concat(f,`
        `).concat(l,`
        setOutput(result);
      }
    `)}return r}();var A6=function(){function r(e,t,n,a,i){t===void 0&&(t=!1),n===void 0&&(n=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=En(this.outputShape.length);for(var o=e.outChannels/e.inChannels,s=e.padInfo.left,u=e.strideWidth,c=e.dilationWidth,l=e.filterHeight,f=e.filterWidth,h=f,p=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`,d=0;d<f;d++)p+=`
          vec4 xTexelC`.concat(d*2,`;
          int xTexelC`).concat(d*2,`Ready;
          vec4 xTexelC`).concat(d*2+1,`;
          int xTexelC`).concat(d*2+1,`Ready;
          vec4 xC`).concat(d,";");p+=`
    for (int r = 0; r < `.concat(l,`; r++) {
      `);for(var d=0;d<f;d++)p+=`
          xTexelC`.concat(d*2,` = vec4(0.0);
          xTexelC`).concat(d*2,`Ready = 0;
          xTexelC`).concat(d*2+1,` = vec4(0.0);
          xTexelC`).concat(d*2+1,`Ready = 0;
          xC`).concat(d," = vec4(0.0);");p+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(var m=0;m<(h+1)/2;m++){var v=m*2;if(p+=`
          xC = xCCorner + `.concat(v*c,`;
          `),u===1){if(v<f&&(s%2===1?(p+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                  xTexelC`).concat(v,` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`).concat(v,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(v,`Ready = 1;
                }
              `),c===1&&v>0?p+=`
                xC`.concat(v," = vec4(xTexelC").concat(v-2,".zw, xTexelC").concat(v,`.xy);
                `):p+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC`.concat(v," = vec4(previous.zw, xTexelC").concat(v,`.xy);
                  } else {
                    xC`).concat(v," = vec4(0.0, 0.0, xTexelC").concat(v,`.xy);
                  }
                  `)):p+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                  xTexelC`).concat(v,` = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC`).concat(v,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(v,`Ready = 1;
                }

                xC`).concat(v," = xTexelC").concat(v,`;
                `),v+1<f)){var g=s%2===0?k.util.nearestLargerEven(c):c;c%2===0&&s%2===1||c%2!==0&&s%2!==1?(p+=`
                  xCOffset = xC + imod(pads[1], 2) + `.concat(g,`;

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                    xTexelC`).concat(v+1,` = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC`).concat(v+1,`.zw = vec2(0.0);
                    }
                    xTexelC`).concat(v+1,`Ready = 1;
                  }
                  `),c>1?p+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC`.concat(v+1," = vec4(previous.zw, xTexelC").concat(v+1,`.xy);
                    } else {
                     xC`).concat(v+1," = vec4(0.0, 0.0, xTexelC").concat(v+1,`.xy);
                    }
                    `):p+=`
                    xC`.concat(v+1," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,`.xy);
                    `)):g===1?p+=`
                    xC`.concat(v+1," = xTexelC").concat(v,`;
                    `):p+=`
                    xCOffset = xC + `.concat(g,`;

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                      xTexelC`).concat(v+1,` = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC`).concat(v+1,`.zw = vec2(0.0);
                      }
                      xTexelC`).concat(v+1,`Ready = 1;
                    }

                    xC`).concat(v+1," = xTexelC").concat(v+1,`;
                    `)}}else v<f&&(s%2===1?(p+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                  xTexelC`).concat(v,` = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`).concat(v,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(v,`Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                  xTexelC`).concat(v+1,` = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC`).concat(v+1,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(v+1,`Ready = 1;
                }

                xC`).concat(v," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,`.zw);
              `),v+1<f&&(p+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC`.concat(v+1," = vec4(xTexelC").concat(v+1,`.xy, final.xy);
                `))):(p+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                  xTexelC`).concat(v,` = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC`).concat(v,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(v,`Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                  xTexelC`).concat(v+1,` = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`).concat(v+1,`.zw = vec2(0.);
                  }
                  xTexelC`).concat(v+1,`Ready = 1;
                }

                xC`).concat(v,` = vec4(
                  xTexelC`).concat(v,".xy, xTexelC").concat(v+1,`.xy);
              `),v+1<f&&(p+=`
                  xC`.concat(v+1," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,`.zw);
                `))));v<f&&(p+=`
            wTexel = getW(r, `.concat(v,`, d1, q);
            dotProd += xC`).concat(v,` * vec4(wTexel.xz, wTexel.xz);
          `),v+1<f&&(p+=`
              wTexel = getW(r, `.concat(v+1,`, d1, q);
              dotProd += xC`).concat(v+1,` * vec4(wTexel.xz, wTexel.xz);
            `)))}p+=`
    }
  `,p+=`
      }
    `;var y="",w="";n&&(a?y=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `.concat(n,`
        }`):i?y=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          `.concat(n,`
        }`):y=`vec4 activation(vec4 x) {
          `.concat(n,`
        }`),w="result = activation(result);");var b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `.concat(y,`

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `).concat(o,`;
        int q = d2 - d1 * `).concat(o,`;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        `).concat(p,`

        vec4 result = dotProd - vec4(0.000000000000001);
        `).concat(b,`
        `).concat(w,`
        setOutput(result);
      }
    `)}return r}();function DZe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,c=n.dimRoundingMode,l=u;l==null&&(l=[1,1]),k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,l),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(l,"'")});var f=k.backend_util.computeConv2DInfo(a.shape,i.shape,o,l,s,c,!0),h;k.env().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?h=new A6(f):h=new C6(f);var p=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return t.runWebGLProgram(h,[a,i],"float32",p)}var _Ze={kernelName:k.DepthwiseConv2dNative,backendName:"webgl",kernelFunc:DZe};var FZe=function(){function r(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,a=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `.concat(o,` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `).concat(e.batchSize,`; b++) {
          for (int yR = 0; yR < `).concat(e.outHeight,`; yR++) {
            int xR = wR + yR * `).concat(t," - ").concat(a,`;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int yC = 0; yC < `).concat(e.outWidth,`; yC++) {
              int xC = wC + yC * `).concat(n," - ").concat(i,`;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}(),RZe=function(){function r(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,s=n-1-e.padInfo.left,u=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`.concat(o,", ").concat(s,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `).concat(t,`; wR++) {
          float dyR = float(dyRCorner + wR) / `).concat(a,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `).concat(t,` - 1 - wR;

          for (int wC = 0; wC < `).concat(n,`; wC++) {
            float dyC = float(dyCCorner + wC) / `).concat(i,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `).concat(n,` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `).concat(u,`; dm++) {
              int d2 = d1 * `).concat(u,` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}();function OZe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.dilations,u=n.pad,c=n.dimRoundingMode,l=n.filterShape,f=k.backend_util.computeConv2DInfo(a.shape,l,o,s,u,c,!0),h=new FZe(f);return t.runWebGLProgram(h,[a,i],"float32")}var PZe={kernelName:k.DepthwiseConv2dNativeBackpropFilter,backendName:"webgl",kernelFunc:OZe};function MZe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.strides,s=n.dilations,u=n.pad,c=n.dimRoundingMode,l=n.inputShape,f=k.backend_util.computeConv2DInfo(l,i.shape,o,s,u,c,!0),h=new RZe(f);return t.runWebGLProgram(h,[a,i],"float32")}var BZe={kernelName:k.DepthwiseConv2dNativeBackpropInput,backendName:"webgl",kernelFunc:MZe};var LZe=function(){function r(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}return r}();function qZe(r){var e=r.inputs,t=r.backend,n=e.x,a=Sr(Sr([],Te(n.shape),!1),Te(n.shape),!1),i=k.util.sizeFromShape(n.shape),o=Ae({inputs:{x:n},backend:t,attrs:{shape:[i]}}),s=new LZe(i),u=t.runWebGLProgram(s,[o],o.dtype),c=Ae({inputs:{x:u},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(u),c}var zZe={kernelName:k.Diag,backendName:"webgl",kernelFunc:qZe};var $Ze=function(){function r(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.inHeight,n=e.inWidth,a=e.padInfo,i=e.strideHeight,o=e.strideWidth,s=e.filterHeight,u=e.filterWidth,c=e.dilationHeight,l=e.dilationWidth,f=a.top,h=a.left;this.userCode=`
      const ivec2 strides = ivec2(`.concat(i,", ").concat(o,`);
      const ivec2 pads = ivec2(`).concat(f,", ").concat(h,`);
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < `).concat(s,`; h++) {
          int hIn = hBeg + h * `).concat(c,`;

          if (hIn >= 0 && hIn < `).concat(t,`) {
            for (int w = 0; w < `).concat(u,`; w++) {
              int wIn = wBeg + w * `).concat(l,`;

              if (wIn >= 0 && wIn < `).concat(n,`) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `)}return r}();function WZe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,c=k.backend_util.computeDilation2DInfo(a.shape,i.shape,o,s,"NHWC",u),l,f=new $Ze(c);l=t.runWebGLProgram(f,[a,i],"float32");var h=Ae({inputs:{x:l},backend:t,attrs:{shape:c.outShape}});return t.disposeIntermediateTensorInfo(l),h}var UZe={kernelName:k.Dilation2D,backendName:"webgl",kernelFunc:WZe};function VZe(r){var e,t,n,a,i=r.inputs,o=r.backend,s=r.attrs,u=s.equation,c=i,l=k.backend_util.decodeEinsumEquation(u,c.length),f=l.allDims,h=l.summedDims,p=l.idDims;k.backend_util.checkEinsumDimSizes(f.length,p,c);for(var d=k.backend_util.getEinsumComputePath(h,p),m=d.path,v=d.steps,g=v.length,y=null,w=f.length,b=[],x=0;x<g;++x){try{for(var S=(e=void 0,Pn(v[x])),T=S.next();!T.done;T=S.next()){var E=T.value,C=k.backend_util.getEinsumPermutation(w,p[E]),R=C.permutationIndices,_=C.expandDims,M=void 0;k.backend_util.isIdentityPermutation(R)?M=c[E]:(M=Mn({inputs:{x:c[E]},backend:o,attrs:{perm:R}}),b.push(M));for(var $=M.shape.slice(),z=0;z<_.length;++z)$.splice(_[z],0,1);k.util.arraysEqual(M.shape,$)||(M=Ae({inputs:{x:M},backend:o,attrs:{shape:$}}),b.push(M)),y===null?y=M:(y=aS({inputs:{a:M,b:y},backend:o}),b.push(y))}}catch(Y){e={error:Y}}finally{try{T&&!T.done&&(t=S.return)&&t.call(S)}finally{if(e)throw e.error}}x<g-1&&(m[x]>=0&&(y=Pg({inputs:{x:y},backend:o,attrs:{axis:m[x]-(f.length-w),keepDims:!1}}),b.push(y)),w--)}try{for(var q=Pn(b),L=q.next();!L.done;L=q.next()){var U=L.value;U!==y&&o.disposeIntermediateTensorInfo(U)}}catch(Y){n={error:Y}}finally{try{L&&!L.done&&(a=q.return)&&a.call(q)}finally{if(n)throw n.error}}return y}var GZe={kernelName:k.Einsum,backendName:"webgl",kernelFunc:VZe};var HZe="return (x >= 0.0) ? x : (exp(x) - 1.0);",jZe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,KZe=Ft({opSnippet:HZe,packedOpSnippet:jZe}),XZe={kernelName:k.Elu,backendName:"webgl",kernelFunc:KZe};var YZe="return (b >= 0.0) ? a : a * (b + 1.0);",JZe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,ZZe=function(r){var e=r.inputs,t=r.backend,n=e.dy,a=e.y,i=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ol(JZe,n.shape,a.shape):new tc(YZe,n.shape,a.shape);return t.runWebGLProgram(i,[n,a],n.dtype)},QZe={kernelName:k.EluGrad,backendName:"webgl",kernelFunc:ZZe};var eQe=`
  return vec4(equal(a, b));
`,tQe="return float(a == b);",rQe=xn({opSnippet:tQe,packedOpSnippet:eQe,dtype:"bool",cpuKernelImpl:FXe}),nQe={kernelName:k.Equal,backendName:"webgl",kernelFunc:rQe};var aQe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = `.concat(k.backend_util.ERF_P,`;
  float a1 = `).concat(k.backend_util.ERF_A1,`;
  float a2 = `).concat(k.backend_util.ERF_A2,`;
  float a3 = `).concat(k.backend_util.ERF_A3,`;
  float a4 = `).concat(k.backend_util.ERF_A4,`;
  float a5 = `).concat(k.backend_util.ERF_A5,`;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`),iQe=Ft({opSnippet:aQe}),oQe={kernelName:k.Erf,backendName:"webgl",kernelFunc:iQe};var sQe=Pl+`
  return exp(x);
`,uQe=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,D6=Ft({opSnippet:sQe,packedOpSnippet:uQe,cpuKernelImpl:RXe,dtype:"float32"}),cQe={kernelName:k.Exp,backendName:"webgl",kernelFunc:D6};function V2(r){var e=r.inputs,t=r.attrs,n=r.backend,a=t.dim,i=e.input,o=i.shape.length,s=i.shape.slice(),u=a;return a<0&&(k.util.assert(-(o+1)<=a,function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")}),u=o+a+1),s.splice(u,0,1),Ae({inputs:{x:i},backend:n,attrs:{shape:s}})}var lQe={kernelName:k.ExpandDims,backendName:"webgl",kernelFunc:V2};var nG="return exp(x) - 1.0;",fQe=Ft({opSnippet:nG,packedOpSnippet:nG,cpuKernelImpl:OXe}),hQe={kernelName:k.Expm1,backendName:"webgl",kernelFunc:fQe};var aG=function(){function r(e,t,n){this.variableNames=["real","imag"];var a=t[1];this.outputShape=t;var i=n?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),o=n?"".concat(a,".0"):"1.0",s;if(e==="real")s="return real * expR - imag * expI;";else if(e==="imag")s="return real * expI + imag * expR;";else throw new Error('FFT component must be either "real" or "imag", got '.concat(e,"."));this.userCode=`
      const float exponentMultiplier = `.concat(i,`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `).concat(s,`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`).concat(a,`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `).concat(a,`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `).concat(o,`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `)}return r}();function _6(r,e,t){var n=t.texData.get(r.dataId),a=k.util.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],o=a/i,s=Ae({inputs:{x:r},backend:t,attrs:{shape:[o,i]}}),u=s.shape,c=new aG("real",u,e),l=new aG("imag",u,e),f=[{dataId:n.complexTensorInfos.real.dataId,dtype:n.complexTensorInfos.real.dtype,shape:u},{dataId:n.complexTensorInfos.imag.dataId,dtype:n.complexTensorInfos.imag.dtype,shape:u}],h=t.runWebGLProgram(c,f,"float32"),p=t.runWebGLProgram(l,f,"float32"),d=Ps({inputs:{real:h,imag:p},backend:t});t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p);var m=Ae({inputs:{x:d},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(d),m}function pQe(r){var e=r.inputs,t=r.backend,n=e.input;return _6(n,!1,t)}var dQe={kernelName:k.FFT,backendName:"webgl",kernelFunc:pQe};var vQe=function(){function r(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return r}();function bp(r){var e=r.backend,t=r.attrs,n=t.shape,a=t.value,i=t.dtype;if(i=i||k.util.inferDtype(a),i==="string"){var o=k.util.getArrayFromDType(i,k.util.sizeFromShape(n));return o.fill(a),e.makeTensorInfo(n,i,o)}else{var s=new vQe(n,a),u=[[a]];return e.runWebGLProgram(s,[],i,u)}}var mQe={kernelName:k.Fill,backendName:"webgl",kernelFunc:bp};var gQe=function(){function r(e){this.variableNames=["Image"],this.outputShape=[];var t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = `.concat(t,` - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < `).concat(t,`) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `)}return r}();var yQe={kernelName:k.FlipLeftRight,backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e.image,a=t,i=new gQe(n.shape),o=a.runWebGLProgram(i,[n],n.dtype);return o}};var iG="return floor(x);",bQe=Ft({opSnippet:iG,packedOpSnippet:iG,cpuKernelImpl:PXe}),wQe={kernelName:k.Floor,backendName:"webgl",kernelFunc:bQe};var xQe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,kQe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,SQe=xn({opSnippet:xQe,packedOpSnippet:kQe,dtype:"int32"}),NQe={kernelName:k.FloorDiv,backendName:"webgl",kernelFunc:SQe},TQe=function(){function r(e){this.variableNames=["A"];var t=Bn(),n=Te(e,2),a=n[0],i=n[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`.concat(i,".0, ").concat(a,`.0);

        vec4 values = `).concat(t.texture2D,`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `)}return r}(),EQe=function(){function r(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=Bn(),n=Te(e,2),a=n[0],i=n[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`.concat(i,".0, ").concat(a,`.0);
            vec4 values = `).concat(t.texture2D,`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `).concat(t.output,` = result;
      }
    `)}return r}(),IQe={kernelName:k.FromPixels,backendName:"webgl",kernelFunc:CQe},Nl,P2=k.env().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function CQe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.pixels,i=n.numChannels,o=typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement,u=Te(o?[a.videoWidth,a.videoHeight]:[a.width,a.height],2),c=u[0],l=u[1],f=[l,c],h=[l,c,i];if(s||o){var p=k.env().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Nl==null||p!==P2)&&(P2=p,Nl=document.createElement("canvas").getContext("2d",{willReadFrequently:P2})),Nl.canvas.width=c,Nl.canvas.height=l,Nl.drawImage(a,0,0,c,l),a=Nl.canvas}var d=t.makeTensorInfo(f,"int32");t.texData.get(d.dataId).usage=Ba.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(d.dataId),a);var m=k.env().getBool("WEBGL_PACK")?new EQe(h):new TQe(h),v=t.runWebGLProgram(m,[d],"int32");return t.disposeData(d.dataId),v}function AQe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=n.strides,c=n.pad,l=n.dataFormat,f=n.dilations,h=n.dimRoundingMode,p=n.activation,d=n.leakyreluAlpha,m=k.backend_util.convertConv2DDataFormat(l),v=k.backend_util.computeConv2DInfo(a.shape,i.shape,u,f,c,h,!1,m),g,y=[],w=o!=null,b=s!=null,x=p==="leakyrelu",S=function(){var $=[a,i],z=function(L,U){if(U==="NCHW"&&L.shape.length===1&&L.shape[0]!==1){var Y=Ae({inputs:{x:L},backend:t,attrs:{shape:[L.shape[0],1,1]}});return y.push(Y),Y}return L};if(w&&$.push(z(o,l)),b&&$.push(z(s,l)),x){var q=t.makeTensorInfo([],"float32",k.util.createScalarValue(d,"float32"));$.push(q),y.push(q)}return $};if(v.filterHeight===1&&v.filterWidth===1&&v.dilationHeight===1&&v.dilationWidth===1&&v.strideHeight===1&&v.strideWidth===1&&(v.padInfo.type==="SAME"||v.padInfo.type==="VALID"))g=T6({x:a,filter:i,convInfo:v,backend:t,bias:o,activation:p,preluActivationWeights:s,leakyreluAlpha:d});else if(v.strideWidth<=2&&m==="channelsLast"&&k.env().getBool("WEBGL_EXP_CONV")){var T=p?pp(p,!0):null,E=new N6(v,w,T,b,x),C=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],R=S();g=t.runWebGLProgram(E,R,"float32",C)}else if(k.env().getBool("WEBGL_CONV_IM2COL"))g=E6({x:a,filter:i,convInfo:v,backend:t,bias:o,activation:p,preluActivationWeights:s,leakyreluAlpha:d});else{var T=p?pp(p,!1):null,E=new S6(v,w,T,b,x),_=S();g=t.runWebGLProgram(E,_,"float32")}var M=Ae({inputs:{x:g},backend:t,attrs:{shape:v.outShape}});return y.push(g),y.forEach(function($){return t.disposeIntermediateTensorInfo($)}),M}var DQe={kernelName:k.FusedConv2D,backendName:"webgl",kernelFunc:AQe};function _Qe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=n.strides,c=n.pad,l=n.dilations,f=n.dimRoundingMode,h=n.activation,p=n.leakyreluAlpha,d=[],m=l;m==null&&(m=[1,1]),k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(u,m),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(u," and dilations '").concat(m,"'")});var v=k.backend_util.computeConv2DInfo(a.shape,i.shape,u,m,c,f,!0),g=k.env().getBool("WEBGL_PACK_DEPTHWISECONV")&&v.strideWidth<=2&&v.outChannels/v.inChannels===1,y=h?pp(h,g):null,w=[a,i],b=o!=null,x=s!=null,S=h==="leakyrelu";if(b&&w.push(o),x&&w.push(s),S){var T=t.makeTensorInfo([],"float32",k.util.createScalarValue(p,"float32"));w.push(T),d.push(T)}var E;g?E=new A6(v,b,y,x,S):E=new C6(v,b,y,x,S);var C=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],R=t.runWebGLProgram(E,w,"float32",C);return d.forEach(function(_){return t.disposeIntermediateTensorInfo(_)}),R}var FQe={kernelName:k.FusedDepthwiseConv2D,backendName:"webgl",kernelFunc:_Qe},RQe=function(){function r(e,t,n,a){this.sliceDim=e,this.strides=t,this.paramsShape=a,this.variableNames=["x","indices"],this.outputShape=n;for(var i=Ht(n.length),o=`
    int index;`,s=0;s<this.sliceDim;s++)o+=`
          index = round(getIndices(coords[0], `.concat(s,`));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= `).concat(this.paramsShape[s],`;
          flattenIndex += index * `).concat(this.strides[s],";");this.userCode=`
         void main() {
          `.concat(i,` coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          `).concat(o,`

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `)}return r}();function OQe(r){var e=r.inputs,t=r.backend,n=e.params,a=e.indices,i=a.shape,o=i[i.length-1],s=k.util.sizeFromShape(n.shape),u=Te(k.backend_util.prepareAndValidate(n,a),4),c=u[0],l=u[1],f=u[2],h=u[3],p=Ae({inputs:{x:a},backend:t,attrs:{shape:[l,o]}}),d=Ae({inputs:{x:n},backend:t,attrs:{shape:[k.util.sizeFromShape(n.shape)/f,f]}});if(t.shouldExecuteOnCPU([n,a])||n.dtype==="string"){var m=t.readSync(a.dataId),v=t.bufferSync(n),g=MXe(m,v,n.dtype,l,o,f,h,n.shape,s);return t.makeTensorInfo(c,n.dtype,g.values)}var y=new RQe(o,h,[l,f],n.shape),w=t.runWebGLProgram(y,[d,p],d.dtype),b=Ae({inputs:{x:w},backend:t,attrs:{shape:c}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(w),b}var PQe={kernelName:k.GatherNd,backendName:"webgl",kernelFunc:OQe};var MQe=function(){function r(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;var n=Ht(this.rank),a=BQe(e);this.userCode=`
      void main() {
        `.concat(n,` resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < `).concat(e[2],`) ? 1.0 : 0.0;
        setOutput(inBounds * getA(`).concat(a,`));
      }
    `)}return r}();function BQe(r,e){for(var t=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[],a=0;a<r.length;a++)a===2?n.push("index"):n.push("".concat(t[a]));return n.join()}function F6(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.indices,o=n.axis,s=n.batchDims,u=k.util.parseAxisParam(o,a.shape)[0];if(k.env().get("DEBUG"))for(var c=t.readSync(i.dataId),l=a.shape[u],f=function(C){var R=c[C];k.util.assert(R<=l-1&&R>=0,function(){return"GatherV2: the index value ".concat(R," is not in [0, ").concat(l-1,"]")})},h=0;h<c.length;++h)f(h);var p=k.backend_util.segment_util.collectGatherOpShapeInfo(a,i,u,s),d=k.util.sizeFromShape(i.shape),m=[],v=Ae({inputs:{x:a},backend:t,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),g=Ae({inputs:{x:i},backend:t,attrs:{shape:[p.batchSize,d/p.batchSize]}});m.push(v),m.push(g);var y=[p.batchSize,p.outerSize,d/p.batchSize,p.sliceSize];if(t.shouldExecuteOnCPU([a,i])||a.dtype==="string"){var w=t.bufferSync(g),b=t.bufferSync(v),x=BXe(b,w,y);return m.forEach(function(C){return t.disposeIntermediateTensorInfo(C)}),t.makeTensorInfo(p.outputShape,x.dtype,x.values)}var S=new MQe(v.shape,y),T=t.runWebGLProgram(S,[v,g],v.dtype);m.push(T);var E=Ae({inputs:{x:T},backend:t,attrs:{shape:p.outputShape}});return m.forEach(function(C){return t.disposeIntermediateTensorInfo(C)}),E}var LQe={kernelName:k.GatherV2,backendName:"webgl",kernelFunc:F6};var qQe="return float(a > b);",zQe=`
  return vec4(greaterThan(a, b));
`,$Qe=xn({opSnippet:qQe,packedOpSnippet:zQe,cpuKernelImpl:LXe,dtype:"bool"}),WQe={kernelName:k.Greater,backendName:"webgl",kernelFunc:$Qe};var UQe="return float(a >= b);",VQe=`
  return vec4(greaterThanEqual(a, b));
`,GQe=xn({opSnippet:UQe,packedOpSnippet:VQe,dtype:"bool",cpuKernelImpl:qXe}),HQe={kernelName:k.GreaterEqual,backendName:"webgl",kernelFunc:GQe};function jQe(r){var e=r.inputs,t=r.backend,n=e.input;return _6(n,!0,t)}var KQe={kernelName:k.IFFT,backendName:"webgl",kernelFunc:jQe};var XQe="return float(!isnan(x) && !isinf(x));",YQe=Ft({opSnippet:XQe,dtype:"bool"}),JQe={kernelName:k.IsFinite,backendName:"webgl",kernelFunc:YQe};var ZQe="return float(isinf(x));",QQe=Ft({opSnippet:ZQe,dtype:"bool"}),eet={kernelName:k.IsInf,backendName:"webgl",kernelFunc:QQe};var tet="return float(isnan(x));",ret=Ft({opSnippet:tet,dtype:"bool"}),net={kernelName:k.IsNan,backendName:"webgl",kernelFunc:ret};var aet="return float(a < b);",iet=`
  return vec4(lessThan(a, b));
`,oet=xn({opSnippet:aet,packedOpSnippet:iet,cpuKernelImpl:zXe,dtype:"bool"}),set={kernelName:k.Less,backendName:"webgl",kernelFunc:oet};var uet="return float(a <= b);",cet=`
  return vec4(lessThanEqual(a, b));
`,fet=xn({opSnippet:uet,packedOpSnippet:cet,cpuKernelImpl:$Xe,dtype:"bool"}),het={kernelName:k.LessEqual,backendName:"webgl",kernelFunc:fet};function pet(r){var e=r.backend,t=r.attrs,n=t.start,a=t.stop,i=t.num,o=WXe(n,a,i);return e.makeTensorInfo([o.length],"float32",o)}var det={kernelName:k.LinSpace,backendName:"webgl",kernelFunc:pet};var vet=Pl+`
  return x < 0.0 ? 0./0. : log(x);
`,met=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,get=Ft({opSnippet:vet,packedOpSnippet:met,cpuKernelImpl:UXe}),yet={kernelName:k.Log,backendName:"webgl",kernelFunc:get};var bet=Pl+`
  return log(1.0 + x);
`,wet=Ft({opSnippet:bet}),xet={kernelName:k.Log1p,backendName:"webgl",kernelFunc:wet};var ket="return float(a >= 1.0 && b >= 1.0);",Net=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,Tet=xn({opSnippet:ket,packedOpSnippet:Net,dtype:"bool"}),Eet={kernelName:k.LogicalAnd,backendName:"webgl",kernelFunc:Tet};var Iet="return float(!(x >= 1.0));",Cet=Ft({opSnippet:Iet}),Aet={kernelName:k.LogicalNot,backendName:"webgl",kernelFunc:Cet};var Det="return float(a >= 1.0 || b >= 1.0);",_et=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,Fet=xn({opSnippet:Det,packedOpSnippet:_et,dtype:"bool"}),Ret={kernelName:k.LogicalOr,backendName:"webgl",kernelFunc:Fet};var Oet=function(){function r(e,t,n,a,i){this.variableNames=["x"],this.outputShape=[];var o=t,s=e[3]-1;this.outputShape=e;var u,c="float(".concat(n,") + float(").concat(a,") * sum");i===.5?u="inversesqrt(".concat(c,")"):i===1?u="1.0/(".concat(c,")"):u="exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`.concat(o,"; j <= ").concat(o,`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `).concat(s,`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `).concat(u,`;
        setOutput(val);
      }
    `)}return r}();var Pet=function(){function r(e,t,n,a,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o=t,s=e[3]-1;this.outputShape=e;var u,c="float(".concat(n,") + float(").concat(a,") * sum");i===.5?u="inversesqrt(".concat(c,")"):i===1?u="1.0/(".concat(c,")"):u="exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `.concat(this.outputShape[3],`;
        bool hasNextRow = c < `).concat(this.outputShape[2],`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `).concat(o,`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `).concat(o,"; j <= ").concat(o,`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`).concat(s,`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `).concat(u,`;
        setOutput(result);
      }
    `)}return r}();var Met=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.depthRadius,o=n.bias,s=n.alpha,u=n.beta,c=k.env().getBool("WEBGL_PACK_NORMALIZATION")?new Pet(a.shape,i,o,s,u):new Oet(a.shape,i,o,s,u);return t.runWebGLProgram(c,[a],a.dtype)},Bet={kernelName:k.LRN,backendName:"webgl",kernelFunc:Met};var Let=function(){function r(e,t,n,a,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=a,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `.concat(this.depth,`; ++d) {
          int depthBegin = int(max(0.0, float(d - `).concat(t,`)));
          int depthEnd = int(min(float(`).concat(this.depth,`),
              float(d + `).concat(t,` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `).concat(this.depth,`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`).concat(a,") * norm + float(").concat(n,`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`).concat(a,`)
                * float(`).concat(i,`)
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `).concat(i,`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `)}return r}();var qet=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.y,o=e.dy,s=n.depthRadius,u=n.bias,c=n.alpha,l=n.beta,f=new Let(a.shape,s,u,c,l);return t.runWebGLProgram(f,[a,i,o],a.dtype)},zet={kernelName:k.LRNGrad,backendName:"webgl",kernelFunc:qet};function $et(r,e,t,n){var a=k.util.sizeFromShape(e),i=k.util.sizeFromShape(r.shape),o=i/a,s=Ae({inputs:{x:r},attrs:{shape:[o,a]},backend:n}),u=ic(s,r.dtype,"max",n),c=Ae({inputs:{x:u},attrs:{shape:t},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),c}function R6(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.reductionIndices,o=n.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=l!=null,h=t.shouldExecuteOnCPU([a]),p=a;if(f){if(h){for(var d=t.texData.get(p.dataId),m=d.values,v=new Array(s),g=0;g<v.length;g++)v[g]=a.shape[l[g]];var y=tS(m,a.shape,a.dtype,l,v);p=t.makeTensorInfo(v,a.dtype);var w=t.texData.get(p.dataId);w.values=y}else p=Og(a,l,t);c=k.backend_util.getInnerMostAxes(c.length,s)}k.backend_util.assertAxesAreInnerMostDims("max",c,s);var b=Te(k.backend_util.computeOutAndReduceShapes(p.shape,c),2),x=b[0],S=b[1],T=x;o&&(T=k.backend_util.expandShapeToKeepDim(x,u));var E;if(h){var d=t.texData.get(p.dataId),m=d.values,C=VXe(m,k.util.sizeFromShape(S),T,a.dtype);E=t.makeTensorInfo(T,a.dtype);var R=t.texData.get(E.dataId);R.values=C}else E=$et(p,S,T,t);return f&&t.disposeIntermediateTensorInfo(p),E}var Wet={kernelName:k.Max,backendName:"webgl",kernelFunc:R6};var Uet=nS+`
  return max(a, b);
`,Vet=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ac+`
  return result;
`,Get=xn({opSnippet:Uet,packedOpSnippet:Vet,cpuKernelImpl:GXe}),Het={kernelName:k.Maximum,backendName:"webgl",kernelFunc:Get};function jet(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;Al(a,"maxPool");var i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=1;k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=k.backend_util.computePool2DInfo(a.shape,i,o,c,s,u);if(l.filterWidth===1&&l.filterHeight===1&&k.util.arraysEqual(l.inShape,l.outShape))return Sa({inputs:{x:a},backend:t});var f=new dp(l,"max",!1);return t.runWebGLProgram(f,[a],a.dtype)}var Ket={kernelName:k.MaxPool,backendName:"webgl",kernelFunc:jet};function Xet(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode,l=[1,1,1],f=k.backend_util.computePool3DInfo(a.shape,i,o,l,s,c,u),h=new iS(f,"max",!1);return t.runWebGLProgram(h,[a],a.dtype)}var Yet={kernelName:k.MaxPool3D,backendName:"webgl",kernelFunc:Xet};var Jet=function(){function r(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,a=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,s=i-1-e.padInfo.top,u=o-1-e.padInfo.left,c=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(`.concat(s,", ").concat(u,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(i,`;
          wR += `).concat(a,`) {
          float dyR = float(dyRCorner + wR) / `).concat(t,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `).concat(o,`; wC++) {
            float dyC = float(dyCCorner + wC) / `).concat(n,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `).concat(c,` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `).concat(o,` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `)}return r}(),Zet=function(){function r(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,a=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterDepth,c=e.effectiveFilterHeight,l=e.effectiveFilterWidth,f=u-1-e.padInfo.front,h=c-1-e.padInfo.top,p=l-1-e.padInfo.left,d=u*c*l-1;this.userCode=`
      const ivec3 pads = ivec3(`.concat(f,", ").concat(h,", ").concat(p,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `).concat(u,`;
           wD += `).concat(i,`) {
          float dyD = float(dyDCorner + wD) / `).concat(t,`.0;

          if (dyD < 0.0 || dyD >= `).concat(e.outDepth,`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `).concat(c,`;
              wR += `).concat(o,`) {
            float dyR = float(dyRCorner + wR) / `).concat(n,`.0;

            if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `).concat(l,`;
                wC += `).concat(s,`) {
              float dyC = float(dyCCorner + wC) / `).concat(a,`.0;

              if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `).concat(d,` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `).concat(c," * ").concat(l,` +
                  wR * `).concat(l,` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}();function Qet(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=i,s=n.filterSize,u=n.strides,c=n.pad,l=n.dimRoundingMode,f=[1,1,1],h=k.backend_util.computePool3DInfo(o.shape,s,u,f,c,l),p=new iS(h,"max",!0),d=t.runWebGLProgram(p,[o],o.dtype),m=new Zet(h),v=t.runWebGLProgram(m,[a,d],o.dtype);return t.disposeIntermediateTensorInfo(d),v}var ett={kernelName:k.MaxPool3DGrad,backendName:"webgl",kernelFunc:Qet};function ttt(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=e.output,s=i;Al([i,o],"maxPoolGrad");var u=n.filterSize,c=n.strides,l=n.pad,f=n.dimRoundingMode,h=k.backend_util.computePool2DInfo(s.shape,u,c,1,l,f),p=!0,d=new dp(h,"max",p),m=t.runWebGLProgram(d,[s],s.dtype),v=new Jet(h),g=t.runWebGLProgram(v,[a,m],s.dtype);return t.disposeIntermediateTensorInfo(m),g}var rtt={kernelName:k.MaxPoolGrad,backendName:"webgl",kernelFunc:ttt};function ntt(r,e,t,n){var a=new dp(t,"max",!1),i=n.runWebGLProgram(a,[r],"float32");a=new dp(t,"max",!0,!0,e);var o=n.runWebGLProgram(a,[r],"float32");return[i,o]}var att={kernelName:k.MaxPoolWithArgmax,backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.x,i=t.filterSize,o=t.strides,s=t.pad,u=t.includeBatchInIndex,c=n;k.util.assert(a.shape.length===4,function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,".")});var l=[1,1];k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,l),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(l,"'")});var f=k.backend_util.computePool2DInfo(a.shape,i,o,l,s),h=Te(ntt(a,u,f,c),2),p=h[0],d=h[1];return[p,d]}};function itt(r,e,t,n){var a=k.util.sizeFromShape(e),i=k.util.sizeFromShape(r.shape),o=i/a,s=Ae({inputs:{x:r},attrs:{shape:[o,a]},backend:n}),u=ic(s,"float32","mean",n),c=Ae({inputs:{x:u},attrs:{shape:t},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),c}var ott={kernelName:k.Mean,backendName:"webgl",kernelFunc:function(r){var e,t,n=r.inputs,a=r.attrs,i=r.backend,o=n.x,s=a.keepDims,u=a.axis,c=i,l=o.shape.length,f=k.util.parseAxisParam(u,o.shape),h=f,p=k.backend_util.getAxesPermutation(h,l),d=p!=null,m=c.shouldExecuteOnCPU([o]),v=[],g=o;if(d){if(m){for(var y=c.texData.get(g.dataId),w=y.values,b=new Array(l),x=0;x<b.length;x++)b[x]=o.shape[p[x]];var S=tS(w,o.shape,o.dtype,p,b);g=c.makeTensorInfo(b,o.dtype);var T=c.texData.get(g.dataId);T.values=S}else g=Og(o,p,c);v.push(g),h=k.backend_util.getInnerMostAxes(h.length,l)}k.backend_util.assertAxesAreInnerMostDims("sum",h,l);var E=Te(k.backend_util.computeOutAndReduceShapes(g.shape,h),2),C=E[0],R=E[1],_=C;s&&(_=k.backend_util.expandShapeToKeepDim(C,f));var M=itt(g,R,_,c);try{for(var $=Pn(v),z=$.next();!z.done;z=$.next()){var x=z.value;c.disposeIntermediateTensorInfo(x)}}catch(q){e={error:q}}finally{try{z&&!z.done&&(t=$.return)&&t.call($)}finally{if(e)throw e.error}}return M}};function stt(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=a;l!=null&&(f=Mn({inputs:{x:a},backend:t,attrs:{perm:l}}),c=k.backend_util.getInnerMostAxes(c.length,a.shape.length)),k.backend_util.assertAxesAreInnerMostDims("min",c,s);var h=Te(k.backend_util.computeOutAndReduceShapes(f.shape,c),2),p=h[0],d=h[1],m=k.util.sizeFromShape(d),v=Ae({inputs:{x:f},backend:t,attrs:{shape:[-1,m]}}),g=ic(v,v.dtype,"min",t),y;if(o){var w=k.backend_util.expandShapeToKeepDim(p,u);y=Ae({inputs:{x:g},backend:t,attrs:{shape:w}})}else y=Ae({inputs:{x:g},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(g),l!=null&&t.disposeIntermediateTensorInfo(f),y}var utt={kernelName:k.Min,backendName:"webgl",kernelFunc:stt};var ctt=nS+`
  return min(a, b);
`,ltt=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ac+`
  return result;
`,ftt=xn({opSnippet:ctt,packedOpSnippet:ltt,cpuKernelImpl:HXe}),htt={kernelName:k.Minimum,backendName:"webgl",kernelFunc:ftt};var ptt=function(){function r(e,t,n){this.variableNames=["x"],this.outputShape=t.map(function(l,f){return l[0]+e[f]+l[1]});var a=e.length,i=Ht(a),o=t.map(function(l){return l[0]}).join(","),s=t.map(function(l,f){return l[0]+e[f]}).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),c=n==="reflect"?0:1;if(a===1){this.userCode=`
        int start = `.concat(o,`;
        int end = `).concat(s,`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - `).concat(c,`;
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + `).concat(c,`;
          }
          setOutput(getX(outC - start));
        }
      `);return}this.userCode=`
      `.concat(i," start = ").concat(i,"(").concat(o,`);
      `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outC = getOutputCoords();
        for (int i = 0; i < `).concat(a,`; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - `).concat(c,`;
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + `).concat(c,`;
          }
        }
        `).concat(i,` coords = outC - start;
        setOutput(getX(`).concat(u,`));
      }
    `)}return r}();var dtt=function(){function r(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(m,v){return m[0]+e[v]+m[1]});var a=e.length,i=Ht(a),o=t.map(function(m){return m[0]}).join(","),s=t.map(function(m,v){return m[0]+e[v]}).join(","),u=On("rc",a),c=On("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),f=a===1?"source":"vec2(".concat(c.slice(-2).join(),")"),h=n==="reflect"?0:1,p="";if(a===1){var d=`
        `.concat(i,` source = rc;
        if (source < start) {
          source = start * 2 - source - `).concat(h,`;
        } else if (source >= end) {
          source = (end - 1) * 2 - source + `).concat(h,`;
        }
        source -= start;
      `);p=`
        `.concat(i,` rc = outputLoc;
        `).concat(d,`
        result[0] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        `).concat(u[a-1],` += 1;
        if(`).concat(l,`) {
          `).concat(d,`
          result[1] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        }
      `)}else{var d=`
        `.concat(i,` source = rc;
        `).concat(i," lt = ").concat(i,`(lessThan(source, start));
        `).concat(i," gte = ").concat(i,`(greaterThanEqual(source, end));
        `).concat(i,` orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - `).concat(h,`) +
                gte * ((end - 1) * 2 - source + `).concat(h,`);
        source -= start;
      `);p=`
        `.concat(i,` rc = outputLoc;
        `).concat(d,`
        result[0] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        `).concat(u[a-1],` += 1;
        if(`).concat(l,`) {
          `).concat(d,`
          result[1] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        }
        rc = outputLoc;
        `).concat(u[a-2],` += 1;
        if(`).concat(u[a-2]," < ").concat(this.outputShape[a-2],`) {
          `).concat(d,`
          result[2] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
          `).concat(u[a-1],` += 1;
          if(`).concat(l,`) {
            `).concat(d,`
            result[3] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
          }
        }
      `)}this.userCode=`
      const `.concat(i," start = ").concat(i,"(").concat(o,`);
      const `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `).concat(p,`
        setOutput(result);
      }
    `)}return r}();var vtt=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.paddings,o=n.mode,s=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new dtt(a.shape,i,o):new ptt(a.shape,i,o),u=t.runWebGLProgram(s,[a],a.dtype);return u},mtt={kernelName:k.MirrorPad,backendName:"webgl",kernelFunc:vtt};var gtt=`if (b == 0.0) return NAN;
  return mod(a, b);`,ytt=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+ac+`
  return result;
`,btt=xn({opSnippet:gtt,packedOpSnippet:ytt}),wtt={kernelName:k.Mod,backendName:"webgl",kernelFunc:btt};var xtt=function(){function r(e,t,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `.concat(t-1,`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`).concat(t-1,`));
      }
    `)}return r}();var ktt=`
if (a == b) {
  return 1.0;
};
return a / b;`,Stt=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,O6=xn({opSnippet:ktt,packedOpSnippet:Stt,checkOutOfBounds:!0}),Ntt={kernelName:k.RealDiv,backendName:"webgl",kernelFunc:O6};var oG="return a - b;",P6=xn({opSnippet:oG,packedOpSnippet:oG,supportsComplex:!0,cpuKernelImpl:p9e}),Ttt={kernelName:k.Sub,backendName:"webgl",kernelFunc:P6};function M6(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.logits,i=n.dim,o=k.util.parseAxisParam([i],a.shape),s=R6({inputs:{x:a},backend:t,attrs:{reductionIndices:o,keepDims:!1}}),u=k.backend_util.expandShapeToKeepDim(s.shape,o),c=Ae({inputs:{x:s},backend:t,attrs:{shape:u}}),l=P6({inputs:{a,b:c},backend:t}),f=D6({inputs:{x:l},backend:t}),h=Pg({inputs:{x:f},backend:t,attrs:{axis:o,keepDims:!1}}),p=Ae({inputs:{x:h},backend:t,attrs:{shape:u}}),d=O6({inputs:{a:f,b:p},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),d}var Ett={kernelName:k.Softmax,backendName:"webgl",kernelFunc:M6};function Itt(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.logits,i=n.numSamples,o=n.seed,s=n.normalized,u=s?a:M6({inputs:{logits:a},backend:t,attrs:{dim:a.shape.length-1}}),c=u.shape[0],l=u.shape[1],f=new xtt(c,l,i),h=[[o]],p=t.runWebGLProgram(f,[u],"int32",h);return s||t.disposeIntermediateTensorInfo(u),p}var Ctt={kernelName:k.Multinomial,backendName:"webgl",kernelFunc:Itt},Att=gi+`
  return -x;
`,Dtt=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function _tt(r){var e=r.inputs,t=r.backend,n=e.x;if(t.shouldExecuteOnCPU([n])){var a=t.texData.get(n.dataId),i=Te(KXe(a.values,n.shape,n.dtype),2),o=i[0],s=i[1];return t.makeTensorInfo(s,n.dtype,o)}var u;return k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")?u=new Os(n.shape,Dtt):u=new io(n.shape,Att),t.runWebGLProgram(u,[n],n.dtype)}var Ftt={kernelName:k.Neg,backendName:"webgl",kernelFunc:_tt};var Rtt=k.kernel_impls.nonMaxSuppressionV3Impl;function Ott(r){k.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,c=t.readSync(a.dataId),l=t.readSync(i.dataId),f=Rtt(c,l,o,s,u).selectedIndices;return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}var Ptt={kernelName:k.NonMaxSuppressionV3,backendName:"webgl",kernelFunc:Ott};var Mtt=k.kernel_impls.nonMaxSuppressionV4Impl;function Btt(r){k.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,c=n.padToMaxOutputSize,l=t.readSync(a.dataId),f=t.readSync(i.dataId),h=Mtt(l,f,o,s,u,c),p=h.selectedIndices,d=h.validOutputs;return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([d]))]}var Ltt={kernelName:k.NonMaxSuppressionV4,backendName:"webgl",kernelFunc:Btt};var qtt=k.kernel_impls.nonMaxSuppressionV5Impl;function ztt(r){k.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,c=n.softNmsSigma,l=t.readSync(a.dataId),f=t.readSync(i.dataId),h=o,p=s,d=u,m=c,v=qtt(l,f,h,p,d,m),g=v.selectedIndices,y=v.selectedScores;return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var $tt={kernelName:k.NonMaxSuppressionV5,backendName:"webgl",kernelFunc:ztt};var Wtt=function(){function r(e,t,n,a){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`.concat(a,"), float(").concat(n,`),
                      float(index == coords.y)));
      }
    `)}return r}(),Utt=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.indices,i=n.dtype,o=n.depth,s=n.onValue,u=n.offValue,c=k.util.sizeFromShape(a.shape),l=new Wtt(c,o,s,u),f=Ae({inputs:{x:a},backend:t,attrs:{shape:[c]}}),h=t.runWebGLProgram(l,[f],i);t.disposeIntermediateTensorInfo(f);var p=Sr(Sr([],Te(a.shape),!1),[o],!1),d=Ae({inputs:{x:h},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(h),d},Vtt={kernelName:k.OneHot,backendName:"webgl",kernelFunc:Utt};function Fg(r){var e=r.inputs,t=r.backend,n=e.x;if(n.dtype==="complex64"){var a=yp({inputs:{input:n},backend:t}),i=Fg({inputs:{x:a},backend:t}),o=Mg({inputs:{input:n},backend:t}),s=Fg({inputs:{x:o},backend:t}),u=Ps({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return bp({attrs:{shape:n.shape,dtype:n.dtype,value:n.dtype==="string"?"":0},backend:t})}var Gtt={kernelName:k.ZerosLike,backendName:"webgl",kernelFunc:Fg};function B6(r){var e=r.inputs,t=r.backend,n=e.x;if(n.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(n.dtype==="complex64"){var a=yp({inputs:{input:n},backend:t}),i=B6({inputs:{x:a},backend:t}),o=Mg({inputs:{input:n},backend:t}),s=Fg({inputs:{x:o},backend:t}),u=Ps({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return bp({attrs:{shape:n.shape,dtype:n.dtype,value:1},backend:t})}var Htt={kernelName:k.OnesLike,backendName:"webgl",kernelFunc:B6};function jtt(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.axis;if(e.length===1)return V2({inputs:{input:e[0]},backend:t,attrs:{dim:a}});var i=e[0].shape,o=e[0].dtype;e.forEach(function(l){k.util.assertShapesMatch(i,l.shape,"All tensors passed to stack must have matching shapes"),k.util.assert(o===l.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=[],u=e.map(function(l){var f=V2({inputs:{input:l},backend:t,attrs:{dim:a}});return s.push(f),f}),c=k6({inputs:u,backend:t,attrs:{axis:a}});return s.forEach(function(l){return t.disposeIntermediateTensorInfo(l)}),c}var Ktt={kernelName:k.Pack,backendName:"webgl",kernelFunc:jtt};var Xtt=function(){function r(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(function(c,l){return c[0]+e[l]+c[1]});var a=e.length,i=Ht(a),o=t.map(function(c){return c[0]}).join(","),s=t.map(function(c,l){return c[0]+e[l]}).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);if(a===1){this.userCode=`
        int start = `.concat(o,`;
        int end = `).concat(s,`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `);return}this.userCode=`
      `.concat(i," start = ").concat(i,"(").concat(o,`);
      `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          `).concat(i,` coords = outC - start;
          setOutput(getX(`).concat(u,`));
        }
      }
    `)}return r}();var Ytt=function(){function r(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(function(g,y){return g[0]+e[y]+g[1]});for(var a=e.length,i=Ht(a),o=t.map(function(g){return g[0]}).join(","),s=t.map(function(g,y){return g[0]+e[y]}).join(","),u=On("rc",a),c=On("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),f=a===1?"source":"vec2(".concat(c.slice(-2).join(),")"),h=["".concat(i," rc = outputLoc;"),"".concat(u[a-1],` += 1;
       if(`).concat(l,`) {
      `),a===1?"":`}
       rc = outputLoc;
       `.concat(u[a-2],` += 1;
       if(`).concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),a===1?"":"  ".concat(u[a-1],` += 1;
         if(`).concat(l,") {")],p=a===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",d="",m=0,v=a===1?2:4;m<v;m++)d+=`
        `.concat(h[m],`
        if (`).concat(p,`) {
          result[`).concat(m,`] = float(value);
        } else {
          `).concat(i,` source = rc - start;
          result[`).concat(m,"] = getChannel(getX(").concat(c.join(),"), ").concat(f,`);
        }
      `);d+=a===1?"} ":"}}",this.userCode=`
      const `.concat(i," start = ").concat(i,"(").concat(o,`);
      const `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `).concat(d,`
        setOutput(result);
      }
    `)}return r}();var L6=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.paddings,o=n.constantValue;if(k.util.sizeFromShape(a.shape)===0){var s=i.map(function(l,f){return l[0]+a.shape[f]+l[1]});return bp({backend:t,attrs:{shape:s,value:o,dtype:a.dtype}})}var u=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ytt(a.shape,i,o):new Xtt(a.shape,i,o),c=[[o]];return t.runWebGLProgram(u,[a],a.dtype,c)},Jtt={kernelName:k.PadV2,backendName:"webgl",kernelFunc:L6};var Ztt=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,Qtt=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+ac+`
  return result;
`,ert=xn({opSnippet:Ztt,packedOpSnippet:Qtt}),trt={kernelName:k.Pow,backendName:"webgl",kernelFunc:ert};function rrt(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=a.shape.length,u=[],c=k.util.parseAxisParam(i,a.shape),l=c,f=k.backend_util.getAxesPermutation(l,s),h=a;f!=null&&(h=Mn({inputs:{x:a},backend:t,attrs:{perm:f}}),l=k.backend_util.getInnerMostAxes(l.length,s),u.push(h)),k.backend_util.assertAxesAreInnerMostDims("prod",l,s);var p;if(t.shouldExecuteOnCPU([h])){var d=t.texData.get(h.dataId).values,m=YXe(h.shape,h.dtype,d,l),v=m.outVals,g=m.outShape,y=m.outDtype;p=t.makeTensorInfo(g,y,v)}else{var w=Te(k.backend_util.computeOutAndReduceShapes(h.shape,l),2),g=w[0],b=w[1],x=k.util.sizeFromShape(b),S=Ae({inputs:{x:h},backend:t,attrs:{shape:[-1,x]}}),T=k.sumOutType(a.dtype),E=ic(S,T,"prod",t);p=Ae({inputs:{x:E},backend:t,attrs:{shape:g}}),u.push(S),u.push(E)}if(o){u.push(p);var C=k.backend_util.expandShapeToKeepDim(p.shape,c);p=Ae({inputs:{x:p},backend:t,attrs:{shape:C}})}return u.forEach(function(R){return t.disposeIntermediateTensorInfo(R)}),p}var nrt={kernelName:k.Prod,backendName:"webgl",kernelFunc:rrt};function art(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.paramsNestedSplits,i=e.paramsDenseValues,o=e.indices;n.outputRaggedRank;var s=a.map(function(g){return t.readSync(g.dataId)}),u=a.map(function(g){return g.shape}),c=t.readSync(i.dataId),l=t.readSync(o.dataId),f=Te(JXe(s,u,c,i.shape,i.dtype,l,o.shape),3),h=f[0],p=f[1],d=f[2],m=h.map(function(g){return t.makeTensorInfo([g.length],"int32",g)}),v=t.makeTensorInfo(d,i.dtype,p);return m.concat([v])}var irt={kernelName:k.RaggedGather,backendName:"webgl",kernelFunc:art};function ort(r){var e=r.inputs,t=r.backend,n=e.starts,a=e.limits,i=e.deltas,o=t.readSync(n.dataId),s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=Te(ZXe(o,n.shape,n.dtype,s,a.shape,u,i.shape),2),l=c[0],f=c[1],h=t.makeTensorInfo([l.length],"int32",l),p=t.makeTensorInfo([f.length],n.dtype,f);return[h,p]}var srt={kernelName:k.RaggedRange,backendName:"webgl",kernelFunc:ort};function urt(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.shape,i=e.values,o=e.defaultValue,s=e.rowPartitionTensors,u=n.rowPartitionTypes,c=t.readSync(a.dataId),l=t.readSync(i.dataId),f=t.readSync(o.dataId),h=s.map(function(g){return t.readSync(g.dataId)}),p=s.map(function(g){return g.shape}),d=Te(QXe(c,a.shape,l,i.shape,i.dtype,f,o.shape,h,p,u),2),m=d[0],v=d[1];return t.makeTensorInfo(m,i.dtype,v)}var crt={kernelName:k.RaggedTensorToTensor,backendName:"webgl",kernelFunc:urt};var q6=function(r){var e=r.backend,t=r.attrs,n=t.start,a=t.stop,i=t.step,o=t.dtype,s=e9e(n,a,i,o);return e.makeTensorInfo([s.length],o,s)},lrt={kernelName:k.Range,backendName:"webgl",kernelFunc:q6};var frt="return 1.0 / x;",hrt=Ft({opSnippet:frt}),prt={kernelName:k.Reciprocal,backendName:"webgl",kernelFunc:hrt};var drt=gi+`
  return (x < 0.0) ? 0.0 : x;
`,vrt=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,mrt=Ft({opSnippet:drt,packedOpSnippet:vrt}),grt={kernelName:k.Relu,backendName:"webgl",kernelFunc:mrt};var yrt=gi+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,brt=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,wrt=Ft({opSnippet:yrt,packedOpSnippet:brt}),xrt={kernelName:k.Relu6,backendName:"webgl",kernelFunc:wrt};var krt=function(){function r(e,t,n,a,i){this.variableNames=["A"],this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,n,l];var f=[a&&t>1?u-1:u,a&&n>1?c-1:c],h=[a&&t>1?t-1:t,a&&n>1?n-1:n],p;i?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`);
      const vec2 inputShapeRC = vec2(`).concat(u,".0, ").concat(c,`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = `).concat(p,`;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `)}return r}();var Srt=function(){function r(e,t,n,a,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,n,l];var f=[a&&t>1?u-1:u,a&&n>1?c-1:c],h=[a&&t>1?t-1:t,a&&n>1?n-1:n],p;i?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`,
          `).concat(f[1]/h[1],`);
      const vec3 inputShapeRC = vec3(`).concat(u,".0, ").concat(c,`.0,
                                     `).concat(c,`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = `).concat(p,`;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `).concat(l-1,`;
        bool hasNextRow = coords.z < `).concat(n-1,`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `)}return r}();function Nrt(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=n.alignCorners,o=n.halfPixelCenters,s=n.size,u=Te(s,2),c=u[0],l=u[1],f=k.env().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Srt(a.shape,c,l,i,o):new krt(a.shape,c,l,i,o);return t.runWebGLProgram(f,[a],"float32")}var Trt={kernelName:k.ResizeBilinear,backendName:"webgl",kernelFunc:Nrt};var Ert=function(){function r(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;var a=Te(t,3),i=a[1],o=a[2],s=Te(e,3),u=s[1],c=s[2],l=[n&&u>1?i-1:i,n&&c>1?o-1:o],f=[n&&u>1?u-1:u,n&&c>1?c-1:c],h=l[0]/f[0],p=l[1]/f[1],d=1/h,m=1/p,v=Math.ceil(d)*2+2,g=Math.ceil(m)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`.concat(h,`);
        const float widthScale = float(`).concat(p,`);

        const float invHeightScale = float(`).concat(d,`);
        const float invWidthScale = float(`).concat(m,`);

        const int winHeight = int(`).concat(v,`);
        const int winWidth = int(`).concat(g,`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `).concat(u,`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `).concat(c,`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `).concat(i-1,`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `).concat(o-1,`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `)}return r}();function Irt(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=e.dy,o=n.alignCorners,s=new Ert(i.shape,a.shape,o);return t.runWebGLProgram(s,[i],i.dtype)}var Crt={kernelName:k.ResizeBilinearGrad,backendName:"webgl",kernelFunc:Irt};var Art=function(){function r(e,t,n,a,i){this.variableNames=["A"],this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,n,l];var f=[a&&t>1?u-1:u,a&&n>1?c-1:c],h=[a&&t>1?t-1:t,a&&n>1?n-1:n],p=a?"0.5":"0.0",d;i?d="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`);
      const vec2 inputShapeRC = vec2(`).concat(u,".0, ").concat(c,`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = `).concat(d,`;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `).concat(p,`)));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `)}return r}();var Drt=function(){function r(e,t,n,a,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,n,l];var f=[a&&t>1?u-1:u,a&&n>1?c-1:c],h=[a&&t>1?t-1:t,a&&n>1?n-1:n],p=a?"0.5":"0.0",d;i?d="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`,
          `).concat(f[1]/h[1],`);
      const vec3 inputShapeRC = vec3(`).concat(u,".0, ").concat(c,`.0,
                                     `).concat(c,`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = `).concat(d,`;

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `).concat(p,`)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `).concat(l-1,`;
        bool hasNextRow = coords.z < `).concat(n-1,`;

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `)}return r}();function _rt(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=n.alignCorners,o=n.halfPixelCenters,s=n.size,u=Te(s,2),c=u[0],l=u[1],f=k.env().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Drt(a.shape,c,l,i,o):new Art(a.shape,c,l,i,o);return t.runWebGLProgram(f,[a],a.dtype)}var Frt={kernelName:k.ResizeNearestNeighbor,backendName:"webgl",kernelFunc:_rt};var Rrt=function(){function r(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;var a=Te(t,3),i=a[1],o=a[2],s=Te(e,3),u=s[1],c=s[2],l=[n&&u>1?i-1:i,n&&c>1?o-1:o],f=[n&&u>1?u-1:u,n&&c>1?c-1:c],h=l[0]/f[0],p=l[1]/f[1],d=1/h,m=1/p,v=Math.ceil(d)*2+2,g=Math.ceil(m)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`.concat(h,`);
        const float widthScale = float(`).concat(p,`);

        const float invHeightScale = float(`).concat(d,`);
        const float invWidthScale = float(`).concat(m,`);

        const int winHeight = int(`).concat(v,`);
        const int winWidth = int(`).concat(g,`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `).concat(u,`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `).concat(c,`) {
              continue;
            }

            float sourceFracRow =
              float(`).concat(l[0],`) *
                (float(dyR) / float(`).concat(f[0],`));

            float sourceFracCol =
                float(`).concat(l[1],`) *
                  (float(dyC) / float(`).concat(f[1],`));

            int sourceNearestRow = int(min(
                float(int(`).concat(i,`) - 1),
                `).concat(n,` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`).concat(o,`) - 1),
                `).concat(n,` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `)}return r}();function Ort(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=e.dy,o=n.alignCorners,s=new Rrt(i.shape,a.shape,o);return t.runWebGLProgram(s,[i],i.dtype)}var Prt={kernelName:k.ResizeNearestNeighborGrad,backendName:"webgl",kernelFunc:Ort};var Mrt=function(){function r(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-".concat(n," tensor is not yet supported"));if(this.outputShape=e,n===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`.concat(e[0],` - coord - 1));
        }
      `);return}var a=function(s){return t.indexOf(s)!==-1&&e[s]!==1?"".concat(e[s]," - coords[").concat(s,"] - 1"):"coords[".concat(s,"]")},i=e.map(function(s,u){return a(u)}).join(","),o=Ht(n);this.userCode=`
      void main() {
        `.concat(o,` coords = getOutputCoords();
        setOutput(getX(`).concat(i,`));
      }
    `)}return r}();var Brt=function(){function r(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-".concat(n," tensor is not yet supported"));this.outputShape=e;var a=On("rc",n),i="".concat(a[n-1]," + 1 < ").concat(this.outputShape[n-1]),o="".concat(a[n-2]," + 1 < ").concat(this.outputShape[n-2]),s=Ht(n);n===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`.concat(e[0],` - rc - 1),
            `).concat(e[0],` - rc - 1);
          if(`).concat(i,`){
              result.g = getChannel(getX(`).concat(e[0],` - (rc  + 1) - 1),
                `).concat(e[0],` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `):this.userCode=`
        void main() {
          `.concat(s,` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `).concat(u(a.slice()),`;
          if(`).concat(i,`){
            result.g = `).concat(c(a.slice()),`;
          }
          if(`).concat(o,`) {
            result.b = `).concat(l(a.slice()),`;
            if(`).concat(i,`) {
              result.a = `).concat(f(a.slice()),`;
            }
          }
          setOutput(result);
        }
    `);function u(d){return h(d)}function c(d){return d[n-1]="("+d[n-1]+" + 1)",h(d)}function l(d){return d[n-2]="("+d[n-2]+" + 1)",h(d)}function f(d){return d[n-1]="("+d[n-1]+" + 1)",d[n-2]="("+d[n-2]+" + 1)",h(d)}function h(d){var m=e.map(function(y,w){return p(w,d)}),v=m.join(","),g=m.slice(-2).join(",");return"getChannel(getX(".concat(v,"), vec2(").concat(g,"))")}function p(d,m){return t.indexOf(d)!==-1&&e[d]!==1?"".concat(e[d]," - ").concat(m[d]," - 1"):"".concat(m[d])}}return r}();function Lrt(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.dims,o=a.shape.length,s=k.util.parseAxisParam(i,a.shape);if(o===0)return Sa({inputs:{x:a},backend:t});var u=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Brt(a.shape,s):new Mrt(a.shape,s);return t.runWebGLProgram(u,[a],a.dtype)}var qrt={kernelName:k.Reverse,backendName:"webgl",kernelFunc:Lrt};var zrt=function(){function r(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];var n=e[1],a=e[2];this.outputShape=e;var i="";typeof t=="number"?i="float outputValue = ".concat(t.toFixed(2),";"):i=`
        vec3 fill = vec3(`.concat(t.join(","),`);
        float outputValue = fill[coords[3]];`),this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          `.concat(i,`
          if(coordX >= 0 && coordX < `).concat(a," && coordY >= 0 && coordY < ").concat(n,`) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `)}return r}(),$rt={kernelName:k.RotateWithOffset,backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.image,i=t.radians,o=t.fillValue,s=t.center,u=n,c=new zrt(a.shape,o),l=Te(k.backend_util.getImageCenter(s,a.shape[1],a.shape[2]),2),f=l[0],h=l[1],p=[[f,h,Math.sin(i),Math.cos(i)]],d=u.runWebGLProgram(c,[a],a.dtype,p);return d}};var Wrt=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,Urt=Ft({opSnippet:Wrt}),Vrt={kernelName:k.Round,backendName:"webgl",kernelFunc:Urt};var Grt="return inversesqrt(x);",Hrt=Ft({opSnippet:Grt,cpuKernelImpl:t9e}),jrt={kernelName:k.Rsqrt,backendName:"webgl",kernelFunc:Hrt};var oS=function(){function r(e,t,n,a,i,o,s,u){u===void 0&&(u=!1),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var c=Ht(i.length),l=Ht(o.length),f="";n===1?f="i":n===2&&(f="i, j");var h="getIndices(".concat(f,")"),p="";a===1?p="i":a===2&&(p="i, coords[1]");var d="getUpdates(".concat(p,")"),m="";u&&(m="coords[0], coords[1]");var v="getDefaultValue(".concat(m,")"),g=t>1?"strides[j]":"strides";this.userCode=`
        `.concat(c," strides = ").concat(c,"(").concat(i,`);

        void main() {
          `).concat(l,` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `).concat(e,`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `).concat(t,`; j++) {
              int index = round(`).concat(h,`);
              flattenedIndex += index * `).concat(g,`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `).concat(d,`;
              found = true;
            }
          }
          setOutput(mix(`).concat(v,`, sum, float(found)));
        }
      `)}return r}();var Krt=function(){function r(e,t,n,a,i,o,s,u){u===void 0&&(u=!1),this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;var c=Ht(i.length),l=Ht(o.length),f="";n===1?f="i":n===2&&(f="i, j");var h="getIndices(".concat(f,")"),p="";a===1?p="i":a===2&&(p="i, coords[1]");var d="getUpdates(".concat(p,")"),m="";u&&(m="coords[0], coords[1]");var v="getDefaultValue(".concat(m,")"),g=t>1?"strides[j]":"strides",y=t>1?"strides[j + 1]":"strides";this.userCode=`
        `.concat(c," strides = ").concat(c,"(").concat(i,`);

        void main() {
          `).concat(l,` coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < `).concat(e,`; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < `).concat(t,`; j+=2) {
              ivec4 index = round(`).concat(h,`);
              flattenedIndex += index.xz * `).concat(g,`;
              if (j + 1 < `).concat(t,`) {
                flattenedIndex += index.yw * `).concat(y,`;
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = `).concat(d,`;
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(`).concat(v,`, sum, found));
        }
      `)}return r}();function Xrt(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.indices,i=e.updates,o=n.shape,s=k.backend_util.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,f=s.strides,h=s.outputSize,p=[h/l,l];if(h===0)return t.makeTensorInfo(o,a.dtype);var d=Ae({inputs:{x:a},backend:t,attrs:{shape:[c,u]}}),m=Ae({inputs:{x:i},backend:t,attrs:{shape:[c,l]}}),v=t.makeTensorInfo([],"float32",new Float32Array([0])),g;k.env().getBool("WEBGL_PACK")?g=new Krt(c,u,d.shape.length,m.shape.length,f,p):g=new oS(c,u,d.shape.length,m.shape.length,f,p);var y=t.runWebGLProgram(g,[m,d,v],m.dtype),w=Ae({inputs:{x:y},backend:t,attrs:{shape:o}});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(v),w}var Yrt={kernelName:k.ScatterNd,backendName:"webgl",kernelFunc:Xrt};var Jrt=function(){function r(e,t,n,a){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,n];var i="while (left < right) {",o="for (int i = 0; i < ".concat(Math.ceil(Math.log2(t+1)),"; ++i) { if (left >= right) break;"),s=k.env().getNumber("WEBGL_VERSION")===2?i:o,u=a==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         `.concat(s,`
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) `).concat(u,` value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `)}return r}();function Zrt(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.sortedSequence,i=e.values,o=n.side,s=new Jrt(a.shape[0],a.shape[1],i.shape[1],o),u=[[a.shape[1]]];return t.runWebGLProgram(s,[a,i],"int32",u)}var Qrt={kernelName:k.SearchSorted,backendName:"webgl",kernelFunc:Zrt};var ent=function(){function r(e,t,n){this.variableNames=["c","a","b"],this.outputShape=t;var a,i;if(n>4)throw Error("Where for rank ".concat(n," is not yet supported"));if(n===1)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<t.length;c++)u.push("".concat(o[c])),c<e&&s.push("".concat(o[c]));a=s.join(),i=u.join()}var l=Ht(n);this.userCode=`
      void main() {
        `.concat(l,` resRC = getOutputCoords();
        float cVal = getC(`).concat(a,`);
        if (cVal >= 1.0) {
          setOutput(getA(`).concat(i,`));
        } else {
          setOutput(getB(`).concat(i,`));
        }
      }
    `)}return r}();function tnt(r){var e=r.inputs,t=r.backend,n=e.condition,a=e.t,i=e.e,o=new ent(n.shape.length,a.shape,a.shape.length);return t.runWebGLProgram(o,[n,a,i],k.upcastType(a.dtype,i.dtype))}var rnt={kernelName:k.Select,backendName:"webgl",kernelFunc:tnt};var nnt=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `.concat(k.backend_util.SELU_SCALEALPHA,`;
  float scale = `).concat(k.backend_util.SELU_SCALE,`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`),ant=Ft({opSnippet:nnt}),int={kernelName:k.Selu,backendName:"webgl",kernelFunc:ant};var ont=Pl+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,snt=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,unt=Ft({opSnippet:ont,packedOpSnippet:snt,cpuKernelImpl:n9e}),cnt={kernelName:k.Sigmoid,backendName:"webgl",kernelFunc:unt};var lnt=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,fnt=Ft({opSnippet:lnt}),hnt={kernelName:k.Sign,backendName:"webgl",kernelFunc:fnt};var pnt=Pl+`
  return sin(x);
`,dnt=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  `.concat(ac,`
  return result;
`),vnt=Ft({opSnippet:pnt,packedOpSnippet:dnt}),mnt={kernelName:k.Sin,backendName:"webgl",kernelFunc:vnt};var gnt=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,ynt=Ft({opSnippet:gnt}),bnt={kernelName:k.Sinh,backendName:"webgl",kernelFunc:ynt};var wnt=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,xnt=Ft({opSnippet:wnt}),knt={kernelName:k.Softplus,backendName:"webgl",kernelFunc:xnt},Snt=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockShape,o=n.paddings;k.util.assert(a.shape.length<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var s=i.reduce(function(y,w){return y*w}),u=[[0,0]];u.push.apply(u,Sr([],Te(o),!1));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=[],f=L6({inputs:{x:a},backend:t,attrs:{paddings:u,constantValue:0}}),h=k.backend_util.getReshaped(f.shape,i,s,!1),p=k.backend_util.getPermuted(h.length,i.length,!1),d=k.backend_util.getReshapedPermuted(f.shape,i,s,!1),m=Ae({inputs:{x:f},backend:t,attrs:{shape:h}}),v=Mn({inputs:{x:m},backend:t,attrs:{perm:p}}),g=Ae({inputs:{x:v},backend:t,attrs:{shape:d}});return l.push(f),l.push(m),l.push(v),l.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),g},Nnt={kernelName:k.SpaceToBatchND,backendName:"webgl",kernelFunc:Snt};function Tnt(r){var e=r.inputs,t=r.backend,n=e.indices,a=e.values,i=e.denseShape,o=e.defaultValue;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         `.concat(i.shape));if(n.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         `.concat(n.shape));if(a.shape.length!==1)throw new Error(`Values must be a vector, saw:
         `.concat(a.shape));if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        `.concat(o.shape));var s=t.readSync(n.dataId),u=t.readSync(a.dataId),c=t.readSync(i.dataId),l=t.readSync(o.dataId)[0],f=Te(i9e(s,n.shape,n.dtype,u,a.dtype,c,l),5),h=f[0],p=f[1],d=f[2],m=f[3],v=f[4];return[t.makeTensorInfo(p,n.dtype,h),t.makeTensorInfo([p[0]],a.dtype,d),t.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(function(g){return Number(g)}))),t.makeTensorInfo([v.length],n.dtype,new Int32Array(v))]}var Ent={kernelName:k.SparseFillEmptyRows,backendName:"webgl",kernelFunc:Tnt};function Int(r){var e=r.inputs,t=r.backend,n=e.inputIndices,a=e.inputShape,i=e.newShape;if(n.shape.length!==2)throw new Error("Input indices should be a matrix but received shape ".concat(n.shape));if(a.shape.length!==1)throw new Error("Input shape should be a vector but received shape ".concat(a.shape));if(i.shape.length!==1)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(t.readSync(a.dataId)),s=t.readSync(n.dataId),u=Array.from(t.readSync(i.dataId)),c=Te(o9e(s,n.shape,n.dtype,o,u),3),l=c[0],f=c[1],h=c[2];return[t.makeTensorInfo(f,n.dtype,l),t.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}var Cnt={kernelName:k.SparseReshape,backendName:"webgl",kernelFunc:Int};function Ant(r){var e=r.inputs,t=r.backend,n=e.data,a=e.indices,i=e.segmentIds;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              `.concat(i.shape));var o=t.readSync(n.dataId),s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=Te(u6(o,n.shape,n.dtype,s,u,!0),2),l=c[0],f=c[1];return t.makeTensorInfo(f,n.dtype,l)}var Dnt={kernelName:k.SparseSegmentMean,backendName:"webgl",kernelFunc:Ant};function _nt(r){var e=r.inputs,t=r.backend,n=e.data,a=e.indices,i=e.segmentIds;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             `.concat(i.shape));var o=t.readSync(n.dataId),s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=Te(u6(o,n.shape,n.dtype,s,u),2),l=c[0],f=c[1];return t.makeTensorInfo(f,n.dtype,l)}var Fnt={kernelName:k.SparseSegmentSum,backendName:"webgl",kernelFunc:_nt};function Rnt(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.sparseIndices,i=e.sparseValues,o=e.defaultValue,s=n.outputShape,u=k.backend_util.calculateShapes(i,a,s),c=u.sliceRank,l=u.numUpdates,f=u.sliceSize,h=u.strides,p=u.outputSize,d=!1;if(i.dtype==="string"){var m=t.bufferSync(a),v=t.bufferSync(i),g=k.util.decodeString(t.readSync(o.dataId)[0]),y=r9e(m,v,s,p,f,l,c,h,g,d);return t.makeTensorInfo(s,y.dtype,y.values)}var w=new oS(l,c,a.shape.length,i.shape.length,h,[p,1],d),b=t.runWebGLProgram(w,[i,a,o],i.dtype),x=Ae({inputs:{x:b},backend:t,attrs:{shape:s}});return t.disposeIntermediateTensorInfo(b),x}var Ont={kernelName:k.SparseToDense,backendName:"webgl",kernelFunc:Rnt};function Pnt(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.numOrSizeSplits,o=n.axis,s=k.util.parseAxisParam(o,a.shape)[0],u=k.backend_util.prepareSplitSize(a,i,s),c=a.shape.length,l=new Array(c).fill(0),f=a.shape.slice();return u.map(function(h){var p=Sr([],Te(f),!1);p[s]=h;var d=Ml({inputs:{x:a},backend:t,attrs:{begin:l,size:p}});return l[s]+=h,d})}var Mnt={kernelName:k.SplitV,backendName:"webgl",kernelFunc:Pnt};var sG="return sqrt(x);",Bnt=Ft({opSnippet:sG,packedOpSnippet:sG,cpuKernelImpl:s9e}),Lnt={kernelName:k.Sqrt,backendName:"webgl",kernelFunc:Bnt};var qnt="return x * x;",znt=Ft({opSnippet:qnt}),$nt={kernelName:k.Square,backendName:"webgl",kernelFunc:znt};var uG="return (a - b) * (a - b);",Wnt=xn({opSnippet:uG,packedOpSnippet:uG}),Unt={kernelName:k.SquaredDifference,backendName:"webgl",kernelFunc:Wnt};function Vnt(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;if(a.dtype!=="string")throw new Error("Input must be of datatype string");var i=t.readSync(a.dataId),o=k.backend_util.fromUint8ToStringArray(i),s=u9e(o,"string",n);return t.makeTensorInfo(a.shape,"string",s)}var Gnt={kernelName:k.StaticRegexReplace,backendName:"webgl",kernelFunc:Vnt};function Hnt(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.x,i=gi+`
    return x > 0.0 ? 1.0 : float(`.concat(t.alpha,`);
  `),o=new io(a.shape,i);return n.runWebGLProgram(o,[a],a.dtype)}var jnt={kernelName:k.Step,backendName:"webgl",kernelFunc:Hnt};var Knt=function(){function r(e,t,n){this.variableNames=["x"],this.outputShape=n;var a=n.length,i=Ht(n.length),o=Ht(n.length),s="";if(a===1)s="coords * strides + begin";else{var u=0;s=n.map(function(c,l){return u++,n.length===1?"coords * strides[".concat(l,"] + begin[").concat(l,"]"):"coords[".concat(u-1,"] * strides[").concat(l,"] + begin[").concat(l,"]")}).join(",")}this.userCode=`
      `.concat(i," begin = ").concat(i,"(").concat(e,`);
      `).concat(i," strides = ").concat(i,"(").concat(t,`);

      void main() {
        `).concat(o,` coords = getOutputCoords();
        setOutput(getX(`).concat(s,`));
      }
    `)}return r}();function Xnt(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.begin,o=n.end,s=n.strides,u=n.beginMask,c=n.endMask,l=n.ellipsisMask,f=n.newAxisMask,h=n.shrinkAxisMask,p=k.slice_util.sliceInfo(a.shape,i,o,s,u,c,l,f,h),d=p.finalShapeSparse,m=p.finalShape,v=p.isIdentity,g=p.sliceDim0,y=p.isSimpleSlice,w=p.begin,b=p.end,x=p.strides,S;if(v)S=Ae({inputs:{x:a},backend:t,attrs:{shape:m}});else if(g||y){k.util.assert(a.shape.length>=1,function(){return"Input must have rank at least 1, got: ".concat(a.shape.length)});var T=k.slice_util.computeOutShape(w,b,x),E=Ml({inputs:{x:a},backend:t,attrs:{begin:w,size:T}});S=Ae({inputs:{x:E},backend:t,attrs:{shape:m}}),t.disposeIntermediateTensorInfo(E)}else{var C=t.shouldExecuteOnCPU([a]);if(C){var R=t.readSync(a.dataId),_=k.buffer(a.shape,a.dtype,R),M=c9e(d,_,x,w);S=t.makeTensorInfo(m,a.dtype,M.values)}else{var $=new Knt(w,x,d);S=t.runWebGLProgram($,[a],a.dtype)}}var z=Ae({inputs:{x:S},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(S),z}var Ynt={kernelName:k.StridedSlice,backendName:"webgl",kernelFunc:Xnt};function Jnt(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.separator,i=n.nGramWidths,o=n.leftPad,s=n.rightPad,u=n.padWidth,c=n.preserveShortSequences,l=e.data,f=e.dataSplits,h=t.readSync(l.dataId),p=t.readSync(f.dataId),d=Te(l9e(h,p,a,i,o,s,u,c),2),m=d[0],v=d[1];return[t.makeTensorInfo([m.length],"string",m),t.makeTensorInfo(f.shape,"int32",v)]}var Znt={kernelName:k.StringNGrams,backendName:"webgl",kernelFunc:Jnt};function Qnt(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.skipEmpty,i=e.input,o=e.delimiter;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error("Input must be a vector, got shape: ".concat(i.shape));if(o.shape.length!==0)throw new Error("Delimiter must be a scalar, got shape: ".concat(o.shape));var s=t.readSync(i.dataId),u=t.readSync(o.dataId)[0],c=Te(f9e(s,u,a),3),l=c[0],f=c[1],h=c[2],p=f.length;return[t.makeTensorInfo([p,2],"int32",l),t.makeTensorInfo([p],"string",f),t.makeTensorInfo([2],"int32",new Int32Array(h))]}var eat={kernelName:k.StringSplit,backendName:"webgl",kernelFunc:Qnt};function tat(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.numBuckets,i=e.input;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");var o=t.readSync(i.dataId),s=h9e(o,a);return t.makeTensorInfo(i.shape,"int32",s)}var rat={kernelName:k.StringToHashBucketFast,backendName:"webgl",kernelFunc:tat};var nat="return tan(x);",aat=Ft({opSnippet:nat}),iat={kernelName:k.Tan,backendName:"webgl",kernelFunc:aat};var oat=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,sat=Ft({opSnippet:oat}),uat={kernelName:k.Tanh,backendName:"webgl",kernelFunc:sat};function cat(r){var e=r.inputs,t=r.backend;r.attrs;var n=e.tensor,a=e.indices,i=e.updates,o=k.backend_util.calculateShapes(i,a,n.shape),s=o.sliceRank,u=o.numUpdates,c=o.sliceSize,l=o.strides,f=o.outputSize,h=[f/c,c];if(f===0)return t.makeTensorInfo(n.shape,a.dtype);var p=Ae({inputs:{x:a},backend:t,attrs:{shape:[u,s]}}),d=Ae({inputs:{x:i},backend:t,attrs:{shape:[u,c]}}),m=Ae({inputs:{x:n},backend:t,attrs:{shape:h}}),v=new oS(u,s,p.shape.length,d.shape.length,l,h,!1,!0),g=t.runWebGLProgram(v,[d,p,m],m.dtype),y=Ae({inputs:{x:g},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),y}var lat={kernelName:k.TensorScatterUpdate,backendName:"webgl",kernelFunc:cat};var fat=function(){function r(e,t){this.variableNames=["A"];for(var n=new Array(e.length),a=0;a<n.length;a++)n[a]=e[a]*t[a];this.outputShape=n,this.rank=n.length;var i=Ht(this.rank),o=hat(e);this.userCode=`
      void main() {
        `.concat(i,` resRC = getOutputCoords();
        setOutput(getA(`).concat(o,`));
      }
    `)}return r}();function hat(r){var e=r.length;if(e>5)throw Error("Tile for rank ".concat(e," is not yet supported"));if(e===1)return"imod(resRC, ".concat(r[0],")");for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],n=[],a=0;a<r.length;a++)n.push("imod(".concat(t[a],", ").concat(r[a],")"));return n.join()}function z6(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.reps;if(a.dtype==="string"||a.shape.length>5){var o=t.readSync(a.dataId),s=a.dtype==="string"?o.map(function(h){return k.util.decodeString(h)}):o,u=k.buffer(a.shape,a.dtype,s),c=d9e(u,i);return t.makeTensorInfo(c.shape,c.dtype,c.values)}var l=new fat(a.shape,i),f=t.runWebGLProgram(l,[a],a.dtype);return f}var pat={kernelName:k.Tile,backendName:"webgl",kernelFunc:z6},dat=function(){function r(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}return r}(),vat=function(){function r(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}return r}();function Ju(r,e){e!==null&&r.disposeIntermediateTensorInfo(e)}function cG(r){for(var e=1;e<r;)e*=2;return e}function mat(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.k,o=n.sorted,s=k.env().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=k.env().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=a.shape,l=c[c.length-1];if(t.shouldExecuteOnCPU([a])||l<s||i>u){var f=t.readSync(a.dataId),h=Te(v9e(f,c,a.dtype,i,o),2),p=h[0],d=h[1];return[t.makeTensorInfo(p.shape,p.dtype,p.values),t.makeTensorInfo(d.shape,d.dtype,d.values)]}if(i===0)return c[c.length-1]=0,[t.makeTensorInfo(c,a.dtype,[]),t.makeTensorInfo(c,"int32",[])];if(l===1)return[a,bp({attrs:{shape:c,dtype:"int32",value:0},backend:t})];var m=t.texData.get(a.dataId),v=m!==null&&m.isPacked,g=v?t.unpackTensor(a):a,y=k.util.sizeFromShape(c),w=y/l,b=Ae({inputs:{x:g},attrs:{shape:[w,l]},backend:t});v&&Ju(t,g);for(var x=cG(i),S=cG(l),T=null,E=function(){return T===null?[b,b]:[b,T]},C=function(re,se,le){var de=E(),ke=new dat(le),he=T===null?1:0,ye=[[l],[he],[Number.NEGATIVE_INFINITY],[re],[se]],xe=T;T=t.runWebGLProgram(ke,de,"int32",ye),Ju(t,xe)},R=1;R<x;R*=2)for(var _=R*2,M=R;M>=1;M/=2)C(_,M,[w,S]);for(var $=S;$>x;$/=2){var z=E(),q=new vat([w,$/2]),L=T===null?1:0,U=[[l],[L],[x]],Y=T;T=t.runWebGLProgram(q,z,"int32",U),Ju(t,Y);for(var R=x/2,_=R*2,M=R;M>=1;M/=2)C(_,M,T.shape)}var Z=T;T=Ml({inputs:{x:T},backend:t,attrs:{begin:0,size:[w,i]}}),Ju(t,Z);var V=F6({inputs:{x:b,indices:T},backend:t,attrs:{axis:1,batchDims:1}});Ju(t,b);var X=c.slice(0,-1);X.push(i),Z=T,T=Ae({inputs:{x:T},attrs:{shape:X},backend:t}),Ju(t,Z);var ne=V;return V=Ae({inputs:{x:V},attrs:{shape:X},backend:t}),Ju(t,ne),[V,T]}var gat={kernelName:k.TopK,backendName:"webgl",kernelFunc:mat};var yat=function(){function r(e,t,n,a,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;var s=n==="nearest"?1:2,u;switch(a){case"constant":u=1;break;case"reflect":u=2;break;case"wrap":u=3;break;case"nearest":u=4;break;default:u=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(`.concat(u,` == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (`).concat(u,` == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (`).concat(u,` == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < `).concat(e," && 0 <= coordX && coordX < ").concat(t,`) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(`).concat(i,`);
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(`).concat(i,`);
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(`).concat(t,`));
                float mapY = mapCoord(inY, float(`).concat(e,`));

                if (`).concat(s,` == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `)}return r}();function bat(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.image,i=e.transforms,o=n.interpolation,s=n.fillMode,u=n.fillValue,c=n.outputShape,l=Te(a.shape,4),f=l[0],h=l[1],p=l[2],d=l[3],m=Te(c??[h,p],2),v=m[0],g=m[1],y=[f,v,g,d],w=new yat(h,p,o,s,u,y);return t.runWebGLProgram(w,[a,i],"float32")}var wat={kernelName:k.Transform,backendName:"webgl",kernelFunc:bat};function xat(r){var e=r.inputs,t=r.attrs,n=r.backend,a=t.axis,i=e.x;Al(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=n.readSync(i.dataId),s=m9e(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[n.makeTensorInfo(c,i.dtype,u),n.makeTensorInfo([l.length],"int32",l)]}var kat={kernelName:k.Unique,backendName:"webgl",kernelFunc:xat};function Sat(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.value,i=n.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],c=new Array(s-1),l=0,f=0;f<s;f++)f!==i&&(c[l++]=o.shape[f]);var h=[],p=new Array(s).fill(0),d=o.shape.slice();d[i]=1;for(var m=new Array(u),f=0;f<m.length;f++){p[i]=f;var v=Ml({inputs:{x:o},backend:t,attrs:{begin:p,size:d}}),g=Ae({inputs:{x:v},backend:t,attrs:{shape:c}});m[f]=g,h.push(v)}return h.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),m}var Nat={kernelName:k.Unpack,backendName:"webgl",kernelFunc:Sat};var Tat=function(){function r(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,a=e.batchSize,i=e.inSize,o=e.numSegments,s=o*Math.ceil(i/n);this.outputShape=[a,s];var u="0.0",c="sumValue",l=Math.floor(n/4)*4,f=n%4,h=`
        sumValue += dot(values, segFilter);
    `,p="";i%n>0&&(p=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return initializationValue;
        }
      `));var d="";i%n>0&&(d=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return -1.0;
        }
      `)),this.userCode=`
      const float initializationValue = `.concat(u,`;

      float getValue(int batch, int inIdx) {
        `).concat(p,`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `).concat(d,`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `).concat(o,")) * float(").concat(n,`));
        int currentSeg = int(mod(float(outIdx), float(`).concat(o,`)));

        float sumValue = 0.0;

        for (int i = 0; i < `).concat(l,`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `).concat(h,`
        }

        int inIdx = inOffset + `).concat(l,`;
        if (`).concat(f===1,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `).concat(h,`
        } else if (`).concat(f===2,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `).concat(h,`
        } else if (`).concat(f===3,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `).concat(h,`
        }
        setOutput(`).concat(c,`);
      }
    `)}return r}();function Eat(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.segmentIds,o=n.numSegments,s=a.shape.length,u=[],c=0,l=k.backend_util.getAxesPermutation([c],s),f=a;l!=null&&(f=Mn({inputs:{x:a},backend:t,attrs:{perm:l}}),u.push(f),c=k.backend_util.getInnerMostAxes(1,s)[0]);var h=k.backend_util.segment_util.computeOutShape(f.shape,c,o),p=k.util.sizeFromShape([f.shape[c]]),d=Ae({inputs:{x:f},backend:t,attrs:{shape:[-1,p]}});u.push(d);var m=k.sumOutType(a.dtype),v=function(x,S,T,E,C){var R=x.shape[0],_=x.shape[1],M=k.backend_util.segment_util.segOpComputeOptimalWindowSize(_,C),$={windowSize:M,inSize:_,batchSize:R,numSegments:C},z=new Tat($,S),q=t.compileAndRun(z,[x,T],E);if(u.push(q),q.shape[1]===C)return q;var L=q6({backend:t,attrs:{start:0,stop:C,step:1,dtype:"float32"}}),U=z6({inputs:{x:L},backend:t,attrs:{reps:[_/M]}});u.push(L),u.push(U);var Y=v(q,S,U,E,C);return Y},g=v(d,"unsortedSegmentSum",i,m,o),y=Ae({inputs:{x:g},backend:t,attrs:{shape:h}}),w=y;if(l!=null){u.push(y);var b=k.backend_util.getUndoAxesPermutation(l);w=Mn({inputs:{x:w},backend:t,attrs:{perm:b}})}return u.forEach(function(x){return t.disposeIntermediateTensorInfo(x)}),w}var Iat={kernelName:k.UnsortedSegmentSum,backendName:"webgl",kernelFunc:Eat},M2,lG,Cat=[cYe,fYe,dYe,gYe,bYe,kYe,NYe,EYe,DYe,FYe,PYe,LYe,$Ye,GYe,KYe,YYe,ZYe,rJe,aJe,oJe,lJe,gJe,bJe,SJe,TJe,_Je,RJe,BJe,H9e,zJe,GJe,XJe,tZe,aZe,oZe,uZe,lZe,dZe,gZe,wZe,kZe,NZe,EZe,AZe,_Ze,PZe,BZe,zZe,UZe,GZe,XZe,QZe,nQe,oQe,cQe,lQe,hQe,dQe,mQe,yQe,wQe,NQe,IQe,DQe,FQe,PQe,LQe,WQe,HQe,G9e,KQe,UJe,JQe,eet,net,K9e,set,het,det,yet,xet,Eet,Aet,Ret,Bet,zet,Wet,Het,Ket,Yet,ett,rtt,att,ott,utt,htt,mtt,wtt,Ctt,J9e,Ftt,Ptt,Ltt,$tt,IJe,Vtt,Htt,Ktt,Jtt,trt,Y9e,nrt,irt,srt,crt,lrt,CJe,Ntt,prt,grt,xrt,Q9e,Trt,Crt,Frt,Prt,qrt,$rt,Vrt,jrt,Yrt,Qrt,rnt,int,cnt,hnt,mnt,bnt,vJe,Ett,knt,Nnt,Ent,Cnt,Dnt,Fnt,Ont,Mnt,Lnt,$nt,Unt,Gnt,jnt,Ynt,Znt,eat,rat,Ttt,oYe,iat,uat,lat,pat,gat,wat,sYe,kat,Nat,Iat,Gtt];try{for(ip=Pn(Cat),Tl=ip.next();!Tl.done;Tl=ip.next())fG=Tl.value,k.registerKernel(fG)}catch(r){M2={error:r}}finally{try{Tl&&!Tl.done&&(lG=ip.return)&&lG.call(ip)}finally{if(M2)throw M2.error}}var fG,ip,Tl;Po.GPGPUContext=Cg;Po.MathBackendWebGL=rS;Po.forceHalfFloat=f6;Po.gpgpu_util=x7e;Po.setWebGLContext=hG;Po.version_webgl=U9e;Po.webgl=V9e;Po.webgl_util=I8e});var Mp=O($a=>{"use strict";var lS=mu(),Aat=M4(),fS=Cz(),hS=SW(),hH=ZW(),pS=PV(),dS=$6();function pH(r){var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var W6=pH(Aat),Dat=pH(hH),dH="Abs",vH="Acos",mH="Acosh",FS="Add",_at="AddN",Fat="All",Rat="Any",gH="ArgMax",yH="ArgMin",bH="Asin",wH="Asinh",xH="Atan",kH="Atanh",SH="Atan2",NH="AvgPool",Oat="AvgPoolGrad",Pat="AvgPool3D",Mat="AvgPool3DGrad",TH="BatchMatMul",EH="BatchToSpaceND",Bat="BroadcastTo",RS="Cast",IH="Ceil",CH="ClipByValue",Lat="Complex",AH="ComplexAbs",DH="Concat",_H="Conv2D",qat="Conv2DBackpropFilter",FH="Conv2DBackpropInput",zat="Conv3D",$at="Conv3DBackpropFilterV2",Wat="Conv3DBackpropInputV2",RH="Cos",OH="Cosh",Uat="Cumprod",PH="Cumsum",Vat="DepthToSpace",MH="DepthwiseConv2dNative",Gat="DepthwiseConv2dNativeBackpropFilter",Hat="DepthwiseConv2dNativeBackpropInput",BH="Dilation2D",jat="Dilation2DBackpropInput",Kat="Dilation2DBackpropFilter",LH="RealDiv",qH="Elu",Xat="EluGrad",zH="Erf",Yat="Equal",$H="Exp",WH="ExpandDims",UH="Expm1",Jat="FFT",Zat="Fill",VH="Floor",GH="FloorDiv",HH="FusedBatchNorm",jH="GatherV2",Qat="Greater",KH="GreaterEqual",OS="Identity",eit="IFFT",tit="Imag",XH="IsFinite",YH="IsInf",JH="IsNan",ZH="LeakyRelu",rit="Less",nit="LessEqual",QH="Log",ej="Log1p",ait="LogicalAnd",iit="LogicalNot",oit="LogicalOr",sit="LogSoftmax",tj="LRN",uit="LRNGrad",rj="Max",nj="Maximum",aj="MaxPool",cit="MaxPoolGrad",lit="MaxPool3D",fit="MaxPool3DGrad",ij="Mean",oj="Min",sj="Minimum",uj="MirrorPad",cj="Mod",lj="Multiply",fj="Neg",hit="NotEqual",hj="OnesLike",pj="OneHot",dj="Pack",vj="PadV2",mj="Pow",gj="Prelu",yj="Prod",pit="Real",bj="Reciprocal",wj="Relu",xj="Reshape",kj="ResizeNearestNeighbor",dit="ResizeNearestNeighborGrad",Sj="ResizeBilinear",vit="ResizeBilinearGrad",Nj="Relu6",Tj="Reverse",Ej="Round",Ij="Rsqrt",mit="TensorScatterUpdate",Cj="Select",Aj="Selu",Dj="Slice",_j="Sin",Fj="Sinh",Rj="Sign",Oj="Sigmoid",Pj="Softplus",Mj="Sqrt",Bj="Sum",Lj="SpaceToBatchND",qj="SplitV",zj="Softmax",$j="SquaredDifference",git="Square",yit="StridedSlice",Wj="Sub",Uj="Tan",Vj="Tanh",PS="Tile",bit="TopK",Bg="Transpose",wit="Unique",Gj="Unpack",Hj="UnsortedSegmentSum",jj="ZerosLike",Kj="Step";var xit=1e-7,kit=1e-4,vS=class{refCount(e){return Na("refCount")}incRef(e){return Na("incRef")}timerAvailable(){return!0}time(e){return Na("time")}read(e){return Na("read")}readSync(e){return Na("readSync")}readToGPU(e,t){return Na("readToGPU")}numDataIds(){return Na("numDataIds")}disposeData(e,t){return Na("disposeData")}write(e,t,n){return Na("write")}move(e,t,n,a,i){return Na("move")}createTensorFromGPUData(e,t,n){return Na("createTensorFromGPUData")}memory(){return Na("memory")}floatPrecision(){return Na("floatPrecision")}epsilon(){return this.floatPrecision()===32?xit:kit}dispose(){return Na("dispose")}};function Na(r){throw new Error(`'${r}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function ie(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function Sit(r,e,t=""){ie(MS(r,e),()=>t+` Shapes ${r} and ${e} must match`)}function Bo(r){if(r.length===0)return 1;let e=r[0];for(let t=1;t<r.length;t++)e*=r[t];return e}function MS(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function Ip(r){return r%1===0}function Lg(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function uo(r,e){let t=e.length;return r=r==null?e.map((n,a)=>a):[].concat(r),ie(r.every(n=>n>=-t&&n<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${r}`),ie(r.every(n=>Ip(n)),()=>`All values in axis param must be integers but got axis ${r}`),r.map(n=>n<0?t+n:n)}function Nit(r,e){let t=[],n=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:uo(e,r).sort(),o=0;for(let s=0;s<r.length;++s){if(i!=null){if(i[o]===s&&r[s]!==1)throw new Error(`Can't squeeze axis ${s} since its dim '${r[s]}' is not 1`);(i[o]==null||i[o]>s)&&r[s]===1&&(t.push(r[s]),n.push(s)),i[o]<=s&&o++}r[s]!==1&&(t.push(r[s]),n.push(s))}return{newShape:t,keptDims:n}}function Tit(r,e){for(let t=0;t<r.length;t++){let n=r[t];if(isNaN(n)||!isFinite(n))throw Error(`A tensor of type ${e} being uploaded contains ${n}.`)}}function Eit(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function mS(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error(`Unknown dtype ${r}`)}function Iit(r){if(r==null)return 0;let e=0;return r.forEach(t=>e+=t.length),e}function BS(r){return typeof r=="string"||r instanceof String}function Cit(r){return typeof r=="boolean"}function Ait(r){return typeof r=="number"}function Yg(r){return Array.isArray(r)?Yg(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":Ait(r)?"float32":BS(r)?"string":Cit(r)?"bool":"float32"}function gS(r){return!!(r&&r.constructor&&r.call&&r.apply)}function Xj(r){let e=r.length;if(e<2)return[];let t=new Array(e-1);t[e-2]=r[e-1];for(let n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function Yj(r,e,t,n=!1){let a=new Array;if(e.length===1){let i=e[0]*(n?2:1);for(let o=0;o<i;o++)a[o]=t[r+o]}else{let i=e[0],o=e.slice(1),s=o.reduce((u,c)=>u*c)*(n?2:1);for(let u=0;u<i;u++)a[u]=Yj(r+u*s,o,t,n)}return a}function U6(r,e,t=!1){if(r.length===0)return e[0];let n=r.reduce((a,i)=>a*i)*(t?2:1);if(n===0)return[];if(n!==e.length)throw new Error(`[${r}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return Yj(0,r,e,t)}function Jj(r,e){let t=LS(r,e);for(let n=0;n<t.length;n++)t[n]=1;return t}function LS(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error(`Unknown data type ${e}`)}function Pp(r){r.forEach(e=>{ie(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${r}].`)})}function qS(r){return r&&r.then&&typeof r.then=="function"}var V6="tfjsflags",yS=class{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Dit,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(fr().getBool("IS_TEST")||fr().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){let a=this.urlFlags[e];fr().getBool("IS_TEST")||fr().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${a}.`),this.set(e,a)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];let t=this.evaluateFlag(e);if(qS(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;let e=this.getQueryParams(this.global.location.search);V6 in e&&e[V6].split(",").forEach(n=>{let[a,i]=n.split(":");this.urlFlags[a]=Fit(a,i)})}};function Dit(r){let e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...n)=>(_it(e,n[0],n[1]),n.join("="))),e}function _it(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Fit(r,e){let t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function fr(){return Zj}var Zj=null;function Rit(r){Zj=r}var sS;function Qj(){if(sS==null){let r;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");sS=r}return sS}function Oit(){let r=Qj();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function zS(r,e){let t=Oit();if(t.has(r))return t.get(r);{let n=e();return t.set(r,n),t.get(r)}}function Bl(...r){fr().getBool("IS_TEST")||fr().getBool("PROD")||console.warn(...r)}var e5=zS("kernelRegistry",()=>new Map),bS=zS("gradRegistry",()=>new Map);function G6(r,e){let t=Mit(r,e);return e5.get(t)}function H6(r){return bS.get(r)}function j6(r){let e=e5.entries(),t=[];for(;;){let{done:n,value:a}=e.next();if(n)break;let[i,o]=a,[s]=i.split("_");s===r&&t.push(o)}return t}function Pit(r){let{kernelName:e}=r;bS.has(e)&&fr().getBool("DEBUG")&&Bl(`Overriding the gradient for '${e}'`),bS.set(e,r)}function Mit(r,e){return`${e}_${r}`}function Bit(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}var Lit=W6.default||W6;function $S(r){return Lit.fromString(r,!0,16)}var BEt=$S("c3a5c85c97cb3127"),LEt=$S("b492b66fbe98f273"),qEt=$S("9ae16a3b2f90404f");function qit(r,e){return r instanceof Float32Array&&e==="float32"||r instanceof Int32Array&&e==="int32"||r instanceof Uint8Array&&e==="bool"}function t5(r,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=Cp(r)),fr().getBool("DEBUG")&&Tit(r,e),qit(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){let t=new Uint8Array(r.length);for(let n=0;n<t.length;++n)Math.round(r[n])!==0&&(t[n]=1);return t}else throw new Error(`Unknown data type ${e}`)}function Wg(){return fr().platform.now()}function zit(r,e="utf-8"){return e=e||"utf-8",fr().platform.encode(r,e)}function K6(r,e="utf-8"){return e=e||"utf-8",fr().platform.decode(r,e)}function bi(r){return fr().platform.isTypedArray!=null?fr().platform.isTypedArray(r):Bit(r)}function Cp(r,e=[],t=!1){if(e==null&&(e=[]),typeof r=="boolean"||typeof r=="number"||typeof r=="string"||qS(r)||r==null||bi(r)&&t)e.push(r);else if(Array.isArray(r)||bi(r))for(let n=0;n<r.length;++n)Cp(r[n],e,t);else{let n=-1;for(let a of Object.keys(r))/^([1-9]+[0-9]*|0)$/.test(a)&&(n=Math.max(n,Number(a)));for(let a=0;a<=n;a++)Cp(r[a],e,t)}return e}var wS=class{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new xS)}profileKernel(e,t,n){let a,i=()=>{a=n()},o,s=Wg();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(let c of a)c.dataSync();o=Promise.resolve({kernelMs:Wg()-s})}if(fr().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<a.length;c++){let l=a[c];l.data().then(f=>{$it(f,l.dtype,e)})}return{kernelName:e,outputs:a,inputs:t,timeMs:o.then(c=>c.kernelMs),extraInfo:o.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){let{kernelName:t,outputs:n,timeMs:a,inputs:i,extraInfo:o}=e;n.forEach(s=>{Promise.all([s.data(),a,o]).then(u=>{this.logger.logKernelProfile(t,s,u[0],u[1],i,u[2])})})}};function $it(r,e,t){if(e!=="float32")return!1;for(let n=0;n<r.length;n++){let a=r[n];if(isNaN(a)||!isFinite(a))return console.warn(`Found ${a} in the result of '${t}'`),!0}return!1}var xS=class{logKernelProfile(e,t,n,a,i,o){let s=typeof a=="number"?Lg(`${a}ms`,9):a.error,u=Lg(e,25),c=t.rank,l=t.size,f=Lg(t.shape.toString(),14),h="";for(let p in i){let d=i[p];if(d!=null){let m=d.shape||t.shape,v=m.length;h+=`${p}: ${v}D ${v>0?m:""} `}}console.log(`%c${u}	%c${s}	%c${c}D ${f}	%c${l}	%c${h}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};function Wit(r,e,t){let n={},a={};for(let u=0;u<e.length;u++)n[e[u].id]=!0;for(let u=0;u<r.length;u++){let c=r[u],l=c.inputs;for(let f in l){let h=l[f],p=!1;for(let d=0;d<e.length;d++)if(n[h.id]){c.outputs.forEach(m=>n[m.id]=!0),p=!0,a[c.id]=!0;break}if(p)break}}let i={};i[t.id]=!0;let o={};for(let u=r.length-1;u>=0;u--){let c=r[u],l=c.inputs;for(let f=0;f<c.outputs.length;f++)if(i[c.outputs[f].id]){for(let h in l)i[l[h].id]=!0,o[c.id]=!0;break}}let s=[];for(let u=0;u<r.length;u++){let c=r[u];if(a[c.id]&&o[c.id]){let l={};for(let h in c.inputs){let p=c.inputs[h];n[p.id]&&(l[h]=p)}let f=Object.assign({},c);f.inputs=l,f.outputs=c.outputs,s.push(f)}}return s}function Uit(r,e,t,n){for(let a=e.length-1;a>=0;a--){let i=e[a],o=[];if(i.outputs.forEach(u=>{let c=r[u.id];c!=null?o.push(c):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);let s=i.gradient(o);for(let u in i.inputs){if(!(u in s))throw new Error(`Cannot backprop through input ${u}. Available gradients found: ${Object.keys(s)}.`);let c=t(()=>s[u]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${u} must have 'float32' dtype, but has '${c.dtype}'`);let l=i.inputs[u];if(!MS(c.shape,l.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${u}' has shape '${c.shape}', which does not match the shape of the input '${l.shape}'`);if(r[l.id]==null)r[l.id]=c;else{let f=r[l.id];r[l.id]=n(f,c),f.dispose()}}}}var X6=20,wp=3,uS=7;function Vit(r,e,t,n){let a=Xj(e),i=Git(r,e,t,a),o=e.length,s=qg(r,e,t,a,i),u=["Tensor"];return n&&(u.push(`  dtype: ${t}`),u.push(`  rank: ${o}`),u.push(`  shape: [${e}]`),u.push("  values:")),u.push(s.map(c=>"    "+c).join(`
`)),u.join(`
`)}function Git(r,e,t,n){let a=Bo(e),i=n[n.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?Tp(r):r;if(s>1)for(let c=0;c<a/i;c++){let l=c*i;for(let f=0;f<i;f++)o[f]=Math.max(o[f],Np(u[l+f],0,t).length)}return o}function Np(r,e,t){let n;return Array.isArray(r)?n=`${parseFloat(r[0].toFixed(uS))} + ${parseFloat(r[1].toFixed(uS))}j`:BS(r)?n=`'${r}'`:t==="bool"?n=r5(r):n=parseFloat(r.toFixed(uS)).toString(),Lg(n,e)}function r5(r){return r===0?"false":"true"}function qg(r,e,t,n,a,i=!0){let o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){let m=Tp(r);return[Np(m[0],0,t)]}return t==="bool"?[r5(r[0])]:[r[0].toString()]}if(u===1){if(s>X6){let v=wp*o,g=Array.from(r.slice(0,v)),y=Array.from(r.slice((s-wp)*o,s*o));return t==="complex64"&&(g=Tp(g),y=Tp(y)),["["+g.map((w,b)=>Np(w,a[b],t)).join(", ")+", ..., "+y.map((w,b)=>Np(w,a[s-wp+b],t)).join(", ")+"]"]}return["["+(t==="complex64"?Tp(r):Array.from(r)).map((v,g)=>Np(v,a[g],t)).join(", ")+"]"]}let c=e.slice(1),l=n.slice(1),f=n[0]*o,h=[];if(s>X6){for(let m=0;m<wp;m++){let v=m*f,g=v+f;h.push(...qg(r.slice(v,g),c,t,l,a,!1))}h.push("...");for(let m=s-wp;m<s;m++){let v=m*f,g=v+f;h.push(...qg(r.slice(v,g),c,t,l,a,m===s-1))}}else for(let m=0;m<s;m++){let v=m*f,g=v+f;h.push(...qg(r.slice(v,g),c,t,l,a,m===s-1))}let p=u===2?",":"";h[0]="["+(s>0?h[0]+p:"");for(let m=1;m<h.length-1;m++)h[m]=" "+h[m]+p;let d=`,
`;for(let m=2;m<u;m++)d+=`
`;return h[h.length-1]=" "+h[h.length-1]+"]"+(i?"":d),h}function Tp(r){let e=[];for(let t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var oo=null,xp=null,Hit=null;function jit(r){oo=r}function Kit(r){Hit=r}var Xn=class{constructor(e,t,n,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Bo(e),this.strides=Xj(e),this.dataId=n,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){let e=await this.data();return xp.buffer(this.shape,this.dtype,e)}bufferSync(){return xp.buffer(this.shape,this.dtype,this.dataSync())}async array(){let e=await this.data();return U6(this.shape,e,this.dtype==="complex64")}arraySync(){return U6(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();let e=oo().read(this.dataId);if(this.dtype==="string"){let t=await e;try{return t.map(n=>K6(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),oo().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();let e=oo().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>K6(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();let e=await oo().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),oo().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return xp.print(this,e)}clone(){return this.throwIfDisposed(),xp.clone(this)}toString(e=!1){let t=this.dataSync();return Vit(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),xp.cast(this,e)}variable(e=!0,t,n){return this.throwIfDisposed(),oo().makeVariable(this,e,t,n)}};Object.defineProperty(Xn,Symbol.hasInstance,{value:r=>!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null});function ce(){return zS("Tensor",()=>Xn)}ce();var ql=class extends Xn{constructor(e,t,n,a){super(e.shape,e.dtype,e.dataId,a),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!MS(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);oo().disposeTensor(this),this.dataId=e.dataId,oo().incRef(this,null)}dispose(){oo().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(ql,Symbol.hasInstance,{value:r=>r instanceof Xn&&r.assign!=null&&r.assign instanceof Function});var Y6;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(Y6||(Y6={}));var kS;(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(kS||(kS={}));var SS;(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(SS||(SS={}));var NS;(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(NS||(NS={}));var TS;(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(TS||(TS={}));var Xit={float32:NS,int32:kS,bool:SS,complex64:TS};function Yit(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${r} with ${e}`)}return Xit[r][e]}function n5(r){return r!=null&&typeof r=="object"&&"texture"in r&&r.texture instanceof WebGLTexture}function a5(r){return typeof GPUBuffer<"u"&&r!=null&&typeof r=="object"&&"buffer"in r&&r.buffer instanceof GPUBuffer}function pn(r,e){if(r.dtype===e.dtype)return[r,e];let t=Yit(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function i5(r){let e=[];return o5(r,e,new Set),e}function o5(r,e,t){if(r==null)return;if(r instanceof Xn){e.push(r);return}if(!Jit(r))return;let n=r;for(let a in n){let i=n[a];t.has(i)||(t.add(i),o5(i,e,t))}}function Jit(r){return Array.isArray(r)||typeof r=="object"}function cS(r){return r.kernelName!=null}var Ug=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(let e in this.registeredVariables)this.registeredVariables[e].dispose()}},Ms=class{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Ug}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;let e=this.getSortedBackends();for(let t=0;t<e.length;t++){let n=e[t];if(await this.initializeBackend(n).success){await this.setBackend(n);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){let{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){let{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,n=1){return e in this.registryFactory?(Bl(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;let{success:t,asyncInit:n}=this.initializeBackend(e);if(!(n?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new wS(this.backendInstance),!0}setupRegisteredKernels(){j6(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){j6(e).forEach(n=>{n.disposeFunc!=null&&n.disposeFunc(this.registry[e])})}initializeBackend(e){let t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{let n=t.factory();if(n&&!(n instanceof vS)&&typeof n.then=="function"){let a=++this.pendingBackendInitId,i=n.then(o=>a<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(a<this.pendingBackendInitId||(this.pendingBackendInit=null,Bl(`Initialization of backend ${e} failed`),Bl(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=n,{success:!0,asyncInit:!1}}catch(n){return Bl(`Initialization of backend ${e} failed`),Bl(n.stack||n.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){let e=this.getSortedBackends();for(let t=0;t<e.length;t++){let n=e[t],{success:a,asyncInit:i}=this.initializeBackend(n);if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){let n=this.state.tensorInfo.get(t),a=n.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let n=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");n=e}let a;return this.scopedRun(()=>this.startScope(n),()=>this.endScope(a),()=>(a=t(),a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),a))}scopedRun(e,t,n){e();try{let a=n();return t(),a}catch(a){throw t(),a}}nextTensorId(){return Ms.nextTensorId++}nextVariableId(){return Ms.nextVariableId++}clone(e){let t=ae.runKernel(OS,{x:e}),n={x:e},a=o=>({x:()=>{let s="float32",u={x:o},c={dtype:s};return ae.runKernel(RS,u,c)}}),i=[];return this.addTapeNode(this.state.activeScope.name,n,[t],a,i,{}),t}runKernel(e,t,n){if(this.backendName==null&&this.backend,!(G6(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,n){let a=this.backend.numDataIds(),i=0;n.forEach(u=>{i+=u.dtype==="complex64"?3:1});let o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${s} data ids) after running '${e}'`)}runKernelFunc(e){let t,n=[],a=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let s;this.backendName==null&&this.backend;let u,c=cS(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(cS(e)){let{kernelName:d,inputs:m,attrs:v}=e;this.backendName==null&&this.backend;let g=G6(d,this.backendName);ie(g!=null,()=>`Cannot find registered kernel '${d}' for backend '${this.backendName}'`),s=()=>{let y=this.backend.numDataIds();u=g.kernelFunc({inputs:m,attrs:v,backend:this.backend});let w=Array.isArray(u)?u:[u];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(d,y,w);let b=w.map(x=>x.rank!=null?x:this.makeTensorFromTensorInfo(x));if(a){let x=this.getTensorsForGradient(d,m,b);n=this.saveTensorsForBackwardMode(x)}return b}}else{let{forwardFunc:d}=e,m=v=>{!a||(n=v.map(g=>this.keep(this.clone(g))))};s=()=>{let v=this.backend.numDataIds();u=this.tidy(()=>d(this.backend,m));let g=Array.isArray(u)?u:[u];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,v,g),g}}let{inputs:l,attrs:f}=e,h=cS(e)?null:e.backwardsFunc,p;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=s():(p=this.profiler.profileKernel(c,l,()=>s()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),t=p.outputs)}),a&&this.addTapeNode(c,l,t,h,n,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(l).map(d=>l[d]!=null?l[d].shape:null),outputShapes:t.map(d=>d.shape),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(u)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(n=>this.keep(this.clone(n)))}getTensorsForGradient(e,t,n){let a=H6(e);if(a!=null){let i=a.inputsToSave||[],o=a.outputsToSave||[],s;a.saveAllInputs?(ie(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),s=Object.keys(t).map(c=>t[c])):s=i.map(c=>t[c]);let u=n.filter((c,l)=>o[l]);return s.concat(u)}return[]}makeTensor(e,t,n,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",a=a||this.backend;let i=e;n==="string"&&BS(e[0])&&(i=e.map(u=>zit(u)));let o=a.write(i,t,n),s=new Xn(t,n,o,this.nextTensorId());if(this.trackTensor(s,a),n==="string"){let u=this.state.tensorInfo.get(o),c=Iit(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s}makeTensorFromDataId(e,t,n,a){n=n||"float32";let i={dataId:e,shape:t,dtype:n};return this.makeTensorFromTensorInfo(i,a)}makeTensorFromTensorInfo(e,t){let{dataId:n,shape:a,dtype:i}=e,o=new Xn(a,i,n,this.nextTensorId());return this.trackTensor(o,t),o}makeVariable(e,t=!0,n,a){n=n||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));let i=new ql(e,t,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*mS(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof ql||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;let t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){let n=e.size*mS(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(let e in this.state.registeredVariables){let t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){let e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;let t=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(a=>a.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n;for(let a of this.state.activeProfile.kernels)a.kernelTimeMs=await a.kernelTimeMs,a.extraInfo=await a.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,n,a,i,o){let s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},u=H6(e);u!=null&&(a=u.gradFunc),a!=null&&(s.gradient=c=>(c=c.map((l,f)=>{if(l==null){let h=n[f],p=LS(h.size,h.dtype);return this.makeTensor(p,h.shape,h.dtype)}return l}),a(c.length>1?c:c[0],i,o))),this.state.activeTape.push(s)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){let t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){let t=i5(e),n=new Set(t.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){let o=this.state.activeScope.track[i];!o.kept&&!n.has(o.id)&&o.dispose()}let a=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(i=>{!i.kept&&i.scopeId===a.id&&this.track(i)})}gradients(e,t,n,a=!1){if(ie(t.length>0,()=>"gradients() received an empty list of xs."),n!=null&&n.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);let i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));ie(i instanceof Xn,()=>"The result y returned by f() must be a tensor.");let o=Wit(this.state.activeTape,t,i);if(!a&&o.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let s={};s[i.id]=n??Zit(i.shape),Uit(s,o,c=>this.tidy(c),eot);let u=t.map(c=>s[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(let l of c.saved)l.dispose()}),this.state.activeTape=null),{value:i,grads:u}})}customGrad(e){return ie(gS(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{ie(t.every(s=>s instanceof Xn),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let n,a={};t.forEach((s,u)=>{a[u]=s});let i=(s,u)=>(n=e(...t,u),ie(n.value instanceof Xn,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),ie(gS(n.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),n.value),o=(s,u)=>{let c=n.gradFunc(s,u),l=Array.isArray(c)?c:[c];ie(l.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),ie(l.every(h=>h instanceof Xn),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let f={};return l.forEach((h,p)=>{f[p]=()=>h}),f};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:a})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){let t=Wg(),n=await this.backend.time(e);return n.wallMs=Wg()-t,n}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Ug;for(let e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}};Ms.nextTensorId=0;Ms.nextVariableId=0;function Zit(r){let e=Jj(Bo(r),"float32");return ae.makeTensor(e,r,"float32")}function Qit(){let r=Qj();if(r._tfengine==null){let e=new yS(r);r._tfengine=new Ms(e)}return Rit(r._tfengine.ENV),jit(()=>r._tfengine),r._tfengine}var ae=Qit();function eot(r,e){let t={a:r,b:e};return ae.runKernel(FS,t)}function tot(r,e){let t=r;if(bi(r))return e==="string"?[]:[r.length];if(n5(r)){let a=r.channels||"RGBA";return[r.height,r.width*a.length]}else if(a5(r))return[r.buffer.size/(e==null?4:mS(e))];if(!Array.isArray(r))return[];let n=[];for(;Array.isArray(t)||bi(t)&&e!=="string";)n.push(t.length),t=t[0];return Array.isArray(r)&&fr().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&s5(r,n,[]),n}function s5(r,e,t){if(t=t||[],!Array.isArray(r)&&!bi(r)){ie(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}ie(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${r.length} elements`),ie(r.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${r.length} elements`);let n=e.slice(1);for(let a=0;a<r.length;++a)s5(r[a],n,t.concat(a))}function J6(r,e,t,n){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==e||r==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${n}' must be ${r} tensor, but got ${e} tensor`)}}function ee(r,e,t,n="numeric"){if(r instanceof ce())return J6(n,r.dtype,e,t),r;let a=Yg(r);if(a!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(a=n),J6(n,a,e,t),r==null||!bi(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){let u=r==null?"null":r.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${u}'`)}let i=tot(r,a);!bi(r)&&!Array.isArray(r)&&(r=[r]);let s=a!=="string"?t5(r,a):Cp(r,[],!0);return ae.makeTensor(s,i,a)}function u5(r,e,t,n="numeric"){if(!Array.isArray(r))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return r.map((i,o)=>ee(i,`${e}[${o}]`,t,n))}var rot="__op";function ue(r){let e=Object.keys(r);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+rot;let a=(...i)=>{ae.startScope(t);try{let o=n(...i);return qS(o)&&console.error("Cannot return a Promise inside of tidy."),ae.endScope(o),o}catch(o){throw ae.endScope(null),o}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function not(r,e){let t=ee(r,"x","cast");if(!Eit(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");let n={x:t},a={dtype:e};return ae.runKernel(RS,n,a)}var ct=ue({cast_:not});function aot(r,e){let t=ee(r,"a","mul"),n=ee(e,"b","mul");[t,n]=pn(t,n);let a={a:t,b:n};return ae.runKernel(lj,a)}var ze=ue({mul_:aot});function iot(r,e=0){let n={x:ee(r,"x","step")},a={alpha:e};return ae.runKernel(Kj,n,a)}var Jg=ue({step_:iot});var c5={kernelName:dH,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ze(r,Jg(ct(t,"float32"),-1))}}};function oot(r,e){let t=ee(r,"a","floorDiv"),n=ee(e,"b","floorDiv");[t,n]=pn(t,n);let a={a:t,b:n};return ae.runKernel(GH,a)}var l5=ue({floorDiv_:oot});function sot(r,e){let t=ee(r,"a","div"),n=ee(e,"b","div");if([t,n]=pn(t,n),t.dtype==="int32"&&n.dtype==="int32")return l5(t,n);let a={a:t,b:n},i={};return ae.runKernel(LH,a,i)}var Wr=ue({div_:sot});function uot(r){let t={x:ee(r,"x","neg")};return ae.runKernel(fj,t)}var Ln=ue({neg_:uot});function cot(r,e,t,n){if(n==null)n=Yg(r);else if(n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(a5(r)||n5(r)){if(n!=="float32"&&n!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${n}.`);return ae.backend.createTensorFromGPUData(r,e||t,n)}if(!bi(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Pp(e);let a=Bo(e),i=Bo(t);ie(a===i,()=>`Based on the provided shape, [${e}], the tensor should have ${a} values but has ${i}`);for(let o=0;o<t.length;++o){let s=t[o],u=o===t.length-1?s!==Bo(e.slice(o)):!0;ie(t[o]===e[o]||!u,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!bi(r)&&!Array.isArray(r)&&(r=[r]),e=e||t,r=n!=="string"?t5(r,n):Cp(r,[],!0),ae.makeTensor(r,e,n)}function hn(r,e){if((bi(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&bi(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return cot(r,[],[],e)}function lot(r){let t={x:ee(r,"x","sqrt","float32")};return ae.runKernel(Mj,t)}var Bs=ue({sqrt_:lot});function fot(r){let e=ee(r,"x","square"),t={};return ae.runKernel("Square",{x:e},t)}var kn=ue({square_:fot});function hot(r,e){let t=ee(r,"a","sub"),n=ee(e,"b","sub");[t,n]=pn(t,n);let a={a:t,b:n};return ae.runKernel(Wj,a)}var In=ue({sub_:hot});var pot={kernelName:vH,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=kn(ct(t,"float32")),a=Bs(In(hn(1),n));return Ln(Wr(r,a))}}}};var dot={kernelName:mH,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=Bs(In(kn(ct(t,"float32")),1));return Wr(r,n)}}}};function Sn(r,e){let t=[];for(let n=0;n<e.length;n++){let a=r[r.length-n-1],i=e.length-n-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function Ur(r,e){let t=Math.max(r.length,e.length),n=new Array(t);for(let a=0;a<t;a++){let i=r[r.length-a-1];i==null&&(i=1);let o=e[e.length-a-1];if(o==null&&(o=1),i===1)n[t-a-1]=o;else if(o===1)n[t-a-1]=i;else if(i!==o){let s=`Operands could not be broadcast together with shapes ${r} and ${e}.`;throw Error(s)}else n[t-a-1]=i}return n}function vot(r,e){let n={x:ee(r,"x","reshape","string_or_numeric")},a={shape:e};return ae.runKernel(xj,n,a)}var pe=ue({reshape_:vot});function mot(r,e=null,t=!1){let n=ee(r,"x","sum");n.dtype==="bool"&&(n=ct(n,"int32"));let a={x:n},i={axis:e,keepDims:t};return ae.runKernel(Bj,a,i)}var Ot=ue({sum_:mot});var got={kernelName:FS,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Ur(t.shape,n.shape);return{a:()=>{let s=r,u=Sn(t.shape,a);return u.length>0&&(s=Ot(s,u)),pe(s,t.shape)},b:()=>{let s=r,u=Sn(n.shape,a);return u.length>0&&(s=Ot(s,u)),pe(s,n.shape)}}}};var yot={kernelName:_at,saveAllInputs:!0,gradFunc:(r,e)=>{let t={};return e.forEach((n,a)=>{t[a]=()=>r.clone()}),t}};function bot(r){let t={x:ee(r,"x","zerosLike")};return ae.runKernel(jj,t)}var _r=ue({zerosLike_:bot});var wot={kernelName:gH,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>_r(t)}}};var xot={kernelName:yH,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>_r(t)}}};var kot={kernelName:bH,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Wr(r,Bs(In(hn(1),kn(ct(t,"float32")))))}}};function Sot(r,e){let t=ee(r,"a","add"),n=ee(e,"b","add");[t,n]=pn(t,n);let a={a:t,b:n};return ae.runKernel(FS,a)}var yi=ue({add_:Sot});var Not={kernelName:wH,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=Bs(yi(hn(1),kn(ct(t,"float32"))));return Wr(r,n)}}}};var Tot={kernelName:SH,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Ur(t.shape,n.shape);return{a:()=>{let s=yi(kn(t),kn(n)),u=ze(r,Wr(n,s)),c=Sn(t.shape,a);return c.length>0&&(u=Ot(u,c)),pe(u,t.shape)},b:()=>{let s=yi(kn(t),kn(n)),u=Ln(ze(r,Wr(t,s))),c=Sn(n.shape,a);return c.length>0&&(u=Ot(u,c)),pe(u,n.shape)}}}};var Eot={kernelName:xH,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Wr(r,yi(kn(ct(t,"float32")),1))}}};var Iot={kernelName:kH,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Wr(r,In(hn(1),kn(ct(t,"float32"))))}}};function Cot(r,e,t,n,a,i,o="channelsLast"){let[s,u]=Ap(e),c;if(o==="channelsLast")c=[s,u,r[3],r[3]];else if(o==="channelsFirst")c=[s,u,r[1],r[1]];else throw new Error(`Unknown dataFormat ${o}`);return Aot(r,c,t,n,a,i,!1,o)}function Aot(r,e,t,n,a,i,o=!1,s="channelsLast"){let[u,c,l,f]=[-1,-1,-1,-1];if(s==="channelsLast")[u,c,l,f]=r;else if(s==="channelsFirst")[u,f,c,l]=r;else throw new Error(`Unknown dataFormat ${s}`);let[h,p,,d]=e,[m,v]=Ap(t),[g,y]=Ap(n),w=ES(h,g),b=ES(p,y),{padInfo:x,outHeight:S,outWidth:T}=Fot(a,c,l,m,v,w,b,i,s),E=o?d*f:d,C;return s==="channelsFirst"?C=[u,E,S,T]:s==="channelsLast"&&(C=[u,S,T,E]),{batchSize:u,dataFormat:s,inHeight:c,inWidth:l,inChannels:f,outHeight:S,outWidth:T,outChannels:E,padInfo:x,strideHeight:m,strideWidth:v,filterHeight:h,filterWidth:p,effectiveFilterHeight:w,effectiveFilterWidth:b,dilationHeight:g,dilationWidth:y,inShape:r,outShape:C,filterShape:e}}function Dot(r,e,t,n,a){n==null&&(n=_ot(r,e,t));let i=r[0],o=r[1],s=Vg((i-e+2*n)/t+1,a),u=Vg((o-e+2*n)/t+1,a);return[s,u]}function _ot(r,e,t,n=1){let a=ES(e,n);return Math.floor((r[0]*(t-1)-t+a)/2)}function Ap(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function ES(r,e){return e<=1?r:r+(r-1)*(e-1)}function Fot(r,e,t,n,a,i,o,s,u){let c,l,f;if(typeof r=="number"){c={top:r,bottom:r,left:r,right:r,type:r===0?"VALID":"NUMBER"};let p=Dot([e,t],i,n,r,s);l=p[0],f=p[1]}else if(r==="same"){l=Math.ceil(e/n),f=Math.ceil(t/a);let h=Math.max(0,(l-1)*n+i-e),p=Math.max(0,(f-1)*a+o-t),d=Math.floor(h/2),m=h-d,v=Math.floor(p/2),g=p-v;c={top:d,bottom:m,left:v,right:g,type:"SAME"}}else if(r==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-i+1)/n),f=Math.ceil((t-o+1)/a);else if(typeof r=="object"){let h=u==="channelsLast"?r[1][0]:r[2][0],p=u==="channelsLast"?r[1][1]:r[2][1],d=u==="channelsLast"?r[2][0]:r[3][0],m=u==="channelsLast"?r[2][1]:r[3][1];c={top:h,bottom:p,left:d,right:m,type:h===0&&p===0&&d===0&&m===0?"VALID":"EXPLICIT"},l=Vg((e-i+h+p)/n+1,s),f=Vg((t-o+d+m)/a+1,s)}else throw Error(`Unknown padding parameter: ${r}`);return{padInfo:c,outHeight:l,outWidth:f}}function Vg(r,e){if(!e)return Math.trunc(r);switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error(`Unknown roundingMode ${e}`)}}function Dp(r){let[e,t,n]=Ap(r);return e===1&&t===1&&n===1}function Ul(r,e){return Dp(r)||Dp(e)}function Gg(r){return Ap(r).every(e=>e>0)}function Ui(r,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${r}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")ie(Ip(e),()=>`Error in ${r}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(n=>{n.forEach(a=>{ie(Ip(a),()=>`Error in ${r}: pad must be an integer when using dimRoundingMode ${t} but got pad ${a}.`)})});else throw Error(`Error in ${r}: Unknown padding parameter: ${e}`)}}function Rot(r,e,t,n,a,i){let o=ee(r,"dy","avgPool3dGrad"),s=ee(e,"input","avgPool3dGrad"),u=o,c=s,l=!1;s.rank===4&&(l=!0,u=pe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=pe(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),ie(u.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),ie(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),Ui("avgPool3dGrad",a,i);let f={dy:u,input:c},h={filterSize:t,strides:n,pad:a,dimRoundingMode:i},p=ae.runKernel(Mat,f,h);return l?pe(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var Oot=ue({avgPool3dGrad_:Rot});var Pot={kernelName:Pat,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{filterSize:a,strides:i,pad:o,dimRoundingMode:s}=t;return{x:()=>Oot(r,n,a,i,o,s)}}};function Mot(r,e,t,n,a){let i=ee(r,"dy","avgPoolGrad"),o=ee(e,"input","avgPoolGrad");ie(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let s=o,u=i,c=!1;o.rank===3&&(c=!0,s=pe(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=pe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),ie(u.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${u.rank}.`),ie(s.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${s.rank}.`);let l={dy:u,input:s},f={filterSize:t,strides:n,pad:a},h=ae.runKernel(Oat,l,f);return c?pe(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var Bot=ue({avgPoolGrad_:Mot});var Lot={kernelName:NH,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{filterSize:a,strides:i,pad:o}=t;return{x:()=>Bot(r,n,a,i,o)}}};function qot(r,e,t=!1,n=!1){let a=ee(r,"a","matMul"),i=ee(e,"b","matMul");[a,i]=pn(a,i);let o={a,b:i},s={transposeA:t,transposeB:n};return ae.runKernel(TH,o,s)}var za=ue({matMul_:qot});var zot={kernelName:TH,inputsToSave:["a","b"],gradFunc:(r,e,t)=>{let[n,a]=e,{transposeA:i,transposeB:o}=t;return!i&&!o?{a:()=>za(r,a,!1,!0),b:()=>za(n,r,!0,!1)}:!i&&o?{a:()=>za(r,a,!1,!1),b:()=>za(r,n,!0,!1)}:i&&!o?{a:()=>za(a,r,!1,!0),b:()=>za(n,r,!1,!1)}:{a:()=>za(a,r,!0,!0),b:()=>za(r,n,!0,!0)}}};function $ot(r,e,t){let n=ee(r,"x","spaceToBatchND");ie(n.rank>=1+e.length,()=>`input rank ${n.rank} should be > than [blockShape] ${e.length}`),ie(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),ie(n.shape.reduce((o,s,u)=>u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o,!0),()=>`input spatial dimensions ${n.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);let a={x:n},i={blockShape:e,paddings:t};return ae.runKernel(Lj,a,i)}var WS=ue({spaceToBatchND_:$ot});var Wot={kernelName:EH,gradFunc:(r,e,t)=>{let{blockShape:n,crops:a}=t;return{x:()=>WS(r,n,a)}}};var Uot={kernelName:Bat,gradFunc:(r,e,t)=>{let n=t,a=n.inputShape,i=n.shape,o=Array.from(i);for(let u=a.length-1;u>=0;u--)if(a[u]===i[u])o[u]=1;else if(a[u]!==1)throw new Error(`broadcastTo(): [${a}] cannot be broadcast to [${i}].`);let s=[];for(let u=0;u<o.length;u++)o[u]>1&&s.push(u);return{x:()=>Ot(r,s,!0)}}};var Vot={kernelName:RS,gradFunc:r=>({x:()=>r.clone()})};var Got={kernelName:IH,gradFunc:r=>({x:()=>_r(r)})};function Hot(r,e){let t=ee(r,"a","greaterEqual","string_or_numeric"),n=ee(e,"b","greaterEqual","string_or_numeric");[t,n]=pn(t,n),Ur(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(KH,a)}var Zg=ue({greaterEqual_:Hot});function jot(r,e){let t=ee(r,"a","lessEqual","string_or_numeric"),n=ee(e,"b","lessEqual","string_or_numeric");[t,n]=pn(t,n),Ur(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(nit,a)}var Qg=ue({lessEqual_:jot});function Kot(r,e){let t=ee(r,"a","logicalAnd","bool"),n=ee(e,"b","logicalAnd","bool");Ur(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(ait,a)}var _p=ue({logicalAnd_:Kot});function Xot(r){let t={x:ee(r,"x","clone","string_or_numeric")};return ae.runKernel(OS,t)}var f5=ue({clone_:Xot});function Yot(r,e){let t=ee(r,"broadcastTo","x"),n=t.shape;if(Pp(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){let c=t.shape.slice();for(;c.length<e.length;)c.unshift(1);t=pe(t,c)}let a=t.shape,i=Array.from(e);for(let c=e.length-1;c>=0;c--)if(a[c]===e[c])i[c]=1;else if(t.shape[c]!==1)throw new Error(`broadcastTo(): [${n}] cannot be broadcast to [${e}].`);if(i.map((c,l)=>c>1?l:-1).filter(c=>c>=0).length===0)return f5(t);let s={x:t},u={reps:i};return ae.runKernel(PS,s,u)}var zg=ue({broadcastTo_:Yot});function Jot(r,e,t){let n=ee(e,"a","where"),a=ee(t,"b","where"),i=ee(r,"condition","where","bool"),o=Ur(Ur(i.shape,n.shape),a.shape),s=zg(i,o),u=zg(n,o),c=zg(a,o),l={condition:s,t:u,e:c};return ae.runKernel(Cj,l)}var Lo=ue({where_:Jot});var Zot={kernelName:CH,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{clipValueMin:a,clipValueMax:i}=t;return{x:()=>Lo(_p(Zg(n,a),Qg(n,i)),r,_r(r))}}};var Qot={kernelName:AH,inputsToSave:["x"],gradFunc:c5.gradFunc};function est(r,e,t=0){let a={x:ee(r,"x","split")},i={numOrSizeSplits:e,axis:t};return ae.runKernel(qj,a,i)}var Hg=ue({split_:est});var tst={kernelName:DH,saveAllInputs:!0,gradFunc:(r,e,t)=>{let n=e.map(u=>u.shape),{axis:a}=t,i=uo(a,e[0].shape)[0],o=n.map(u=>u[i]);return Hg(r,o,i).map(u=>()=>u)}};function rst(r,e,t,n,a,i="NHWC",o){let s=r;r.rank===3&&(s=pe(r,[1,r.shape[0],r.shape[1],r.shape[2]]));let u=e;u.rank===3&&(u=pe(e,[1,e.shape[0],e.shape[1],e.shape[2]])),ie(s.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${s.shape}.`),ie(u.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`),ie(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);let c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];ie(c===t[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${t[2]}.`),ie(l===t[3],()=>`Error in conv2dDerFilter: depth of dy (${l}) must match output depth for filter (${t[3]}).`),Ui("conv2dDerFilter",a,o);let f={x:s,dy:u},h={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return ae.runKernel(qat,f,h)}var h5=ue({conv2DBackpropFilter_:rst});function nst(r,e,t,n,a,i="NHWC",o){ie(r.length===e.rank,()=>`Length of inShape (${r.length}) and rank of dy (${e.rank}) must match`);let s=r,u=e,c=!1;e.rank===3&&(c=!0,u=pe(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,r[0],r[1],r[2]]),ie(s.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${s.length}.`),ie(u.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`),ie(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);let l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];ie(l===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[2]}.`),ie(f===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${t.shape[3]}.`),Ui("conv2dDerInput",a,o);let h={dy:u,filter:t},p={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=ae.runKernel(FH,h,p);return c?pe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var p5=ue({conv2DBackpropInput_:nst});var ast={kernelName:_H,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let[n,a]=e,{dilations:i,strides:o,pad:s,dataFormat:u}=t;return ie(Dp(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>p5(n.shape,r,a,o,s,u),filter:()=>h5(n,r,a.shape,o,s,u)}}};function ist(r,e,t,n,a="NHWC",i=[1,1],o){let s=ee(r,"x","conv2d","float32"),u=ee(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=pe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ie(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),ie(u.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`),Ui("conv2d",n,o);let f=a==="NHWC"?c.shape[3]:c.shape[1];ie(f===u.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${u.shape[2]}.`),ie(Ul(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),ie(Gg(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),ie(Gg(t),()=>"Error in conv2D: Strides should be larger than 0.");let h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=ae.runKernel(_H,h,p);return l?pe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var ey=ue({conv2d_:ist});var ost={kernelName:FH,inputsToSave:["dy","filter"],gradFunc:(r,e,t)=>{let[n,a]=e,{strides:i,pad:o,dataFormat:s,dimRoundingMode:u}=t;return{dy:()=>ey(r,a,i,o,s,1,u),filter:()=>h5(r,n,a.shape,i,o,s,u)}}};function sst(r,e,t,n,a){let i=r;r.rank===4&&(i=pe(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));let o=e;o.rank===4&&(o=pe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),ie(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),ie(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),ie(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),ie(i.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${t[3]}.`),ie(o.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${t[4]}).`);let s={x:i,dy:o},u={strides:n,pad:a,filterShape:t};return ae.runKernel($at,s,u)}var ust=ue({conv3DBackpropFilter_:sst});function cst(r,e,t,n,a){ie(r.length===e.rank,()=>`Length of inShape (${r.length}) and rank of dy (${e.rank}) must match`);let i=r,o=e,s=!1;e.rank===4&&(s=!0,o=pe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,r[0],r[1],r[2],r[3]]);let u=i[4],c=o.shape[4];ie(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),ie(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),ie(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),ie(u===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${t.shape[3]}.`),ie(c===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${t.shape[4]}.`);let l={dy:o,filter:t},f={pad:a,strides:n,inputShape:i},h=ae.runKernel(Wat,l,f);return s?pe(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var lst=ue({conv3DBackpropInput_:cst});var fst={kernelName:zat,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let{dilations:n,strides:a,pad:i}=t;ie(Dp(n),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${n}'`);let[o,s]=e;return{x:()=>lst(o.shape,r,s,a,i),filter:()=>ust(o,r,s.shape,a,i)}}};function hst(r){let t={x:ee(r,"x","sin","float32")};return ae.runKernel(_j,t)}var d5=ue({sin_:hst});var pst={kernelName:RH,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ze(Ln(d5(ct(t,"float32"))),r)}}};function dst(r){let t={x:ee(r,"x","sinh")};return ae.runKernel(Fj,t)}var v5=ue({sinh_:dst});var vst={kernelName:OH,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ze(v5(ct(t,"float32")),r)}}};function mst(r,e){for(let t=0;t<r.length;++t)if(r[r.length-t-1]!==e-1-t)return!1;return!0}function gst(r,e,t){let n=r.length+e.length,a=[],i=0,o=0;for(let s=0;s<n;s++)t.indexOf(s)===-1?a.push(r[i++]):a.push(e[o++]);return a}function yst(r,e){let t=[],n=r.length;for(let i=0;i<n;i++)e.indexOf(i)===-1&&t.push(r[i]);let a=e.map(i=>r[i]);return[t,a]}function jg(r,e){let t=e.map(n=>1);return gst(r,t,e)}function m5(r,e){if(mst(r,e))return null;let t=[];for(let n=0;n<e;++n)r.indexOf(n)===-1&&t.push(n);return r.forEach(n=>t.push(n)),t}function US(r){return r.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function bst(r,e=0,t=!1,n=!1){let i={x:ee(r,"x","cumsum")},o={axis:e,exclusive:t,reverse:n};return ae.runKernel(PH,i,o)}var g5=ue({cumsum_:bst});function wst(r){fr().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}Kit(wst);function xst(r,e){return ae.tidy(r,e)}function Z6(r){i5(r).forEach(t=>t.dispose())}function kst(r,e){let t=ee(r,"real","complex"),n=ee(e,"imag","complex");Sit(t.shape,n.shape,`real and imag shapes, ${t.shape} and ${n.shape}, must match in call to tf.complex().`);let a={real:t,imag:n};return ae.runKernel(Lat,a)}var zl=ue({complex_:kst});function Sst(r){let t={input:ee(r,"input","imag")};return ae.runKernel(tit,t)}var VS=ue({imag_:Sst});function Nst(r){let t={input:ee(r,"input","real")};return ae.runKernel(pit,t)}var Kg=ue({real_:Nst});function Tst(r,e,t){let n=ee(r,"x","transpose");if(e==null&&(e=n.shape.map((o,s)=>s).reverse()),ie(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of perm ${e}.`),e.forEach(o=>{ie(o>=0&&o<n.rank,()=>`All entries in 'perm' must be between 0 and ${n.rank-1} but got ${e}`)}),n.rank<=1)return n.clone();let a={x:n},i={perm:e};return n.dtype==="complex64"?xst(()=>{let o=Kg(n),s=VS(n);return o=ae.runKernel(Bg,{x:o},i),s=ae.runKernel(Bg,{x:s},i),t&&(s=Ln(s)),zl(o,s)}):ae.runKernel(Bg,a,i)}var oc=ue({transpose_:Tst});var Est={kernelName:PH,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{axis:a,exclusive:i,reverse:o}=t;return{x:()=>{let s=m5([a],n.rank),u=g5(r,a,i,!o);return s!=null&&(u=oc(u,s)),u}}}};function Ist(r,e,t,n,a,i=[1,1],o){let s=r;r.rank===3&&(s=pe(r,[1,r.shape[0],r.shape[1],r.shape[2]]));let u=e;u.rank===3&&(u=pe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let c={x:s,dy:u},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return ae.runKernel(Gat,c,l)}var Cst=ue({depthwiseConv2dNativeBackpropFilter_:Ist});function Ast(r,e,t,n,a,i=[1,1],o){let s=e,u=!1;e.rank===3&&(u=!0,s=pe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let c={dy:s,filter:t},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,inputShape:r},f=ae.runKernel(Hat,c,l);return u?pe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var Dst=ue({depthwiseConv2dNativeBackpropInput_:Ast});var _st={kernelName:MH,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let{dilations:n,strides:a,pad:i,dimRoundingMode:o}=t,s=n??[1,1];ie(Dp(s),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`);let[u,c]=e;return ie(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${u.rank}.`),ie(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),ie(u.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),ie(Ul(a,s),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${a} and dilations '${s}'.`),Ui("depthwiseConv2d",i,o),{x:()=>Dst(u.shape,r,c,a,i,s,o),filter:()=>Cst(u,r,c.shape,a,i,s,o)}}};var Fst={kernelName:BH,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let[n,a]=e,i={x:n,filter:a,dy:r},o={x:n,filter:a,dy:r};return{x:()=>ae.runKernel(jat,i,t),filter:()=>ae.runKernel(Kat,o,t)}}};var Rst={kernelName:qH,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e,n={dy:r,y:t};return{x:()=>ae.runKernel(Xat,n)}}};function Ost(r){let t={x:ee(r,"x","exp")};return ae.runKernel($H,t)}var Ls=ue({exp_:Ost});var Pst={kernelName:zH,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e,n=ze(Ls(Ln(kn(t))),2/Math.sqrt(Math.PI));return{x:()=>ze(r,n)}}};var Mst={kernelName:$H,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ze(r,t)}}};var Bst={kernelName:WH,inputsToSave:["input"],gradFunc:(r,e)=>{let[t]=e;return{input:()=>pe(r,t.shape)}}};var Lst={kernelName:UH,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ze(r,Ls(t))}}};var qst={kernelName:VH,gradFunc:r=>({x:()=>_r(r)})};var zst={kernelName:GH,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Ur(t.shape,n.shape);return{a:()=>{let s=Wr(r,ct(n,"float32")),u=Sn(t.shape,a);return u.length>0?pe(Ot(s,u),t.shape):s},b:()=>{let s=ze(r,ct(t,"float32")),u=Sn(n.shape,a);u.length>0&&(s=pe(Ot(s,u),n.shape));let c=kn(n);return Ln(Wr(s,ct(c,"float32")))}}}};function $st(r){let t={x:ee(r,"x","rsqrt","float32")};return ae.runKernel(Ij,t)}var y5=ue({rsqrt_:$st});function Wst(r,e){let t=ee(r,"x","tile","string_or_numeric");ie(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);let n={x:t},a={reps:e};return ae.runKernel(PS,n,a)}var b5=ue({tile_:Wst});var Ust={kernelName:HH,inputsToSave:["x","mean","variance","scale"],gradFunc:(r,e,t)=>{let{varianceEpsilon:n}=t,[a,i,o,s]=e,u=s??hn(1),c=Sn(i.shape,a.shape),l=[];if(i.rank===1){for(let b=0;b<a.shape.length-1;++b)l.push(a.shape[b]);l.push(1)}let f=In(a,i),h=ze(r,u),p=y5(yi(o,hn(n))),d=ze(ze(ze(p,p),p),hn(-.5));return{x:()=>i.rank===1?pe(ze(ze(r,b5(pe(p,[1,1,1,i.shape[0]]),l)),u),a.shape):pe(ze(ze(r,p),u),a.shape),mean:()=>{let b=ze(ze(p,hn(-1)),h);return i.rank===1&&(b=Ot(b,c)),pe(b,i.shape)},variance:()=>{let b=ze(ze(d,f),h);return i.rank===1&&(b=Ot(b,c)),pe(b,i.shape)},scale:()=>{let b=ze(f,p),x=ze(r,b);return i.rank===1&&(x=Ot(x,c)),pe(x,i.shape)},offset:()=>{let b=r;return i.rank===1&&(b=Ot(b,c)),pe(b,i.shape)}}}};function Vst(r,e=0){let t=u5(r,"tensors","stack","string_or_numeric");ie(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&ie(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");let n=t,a={axis:e};return ae.runKernel(dj,n,a)}var GS=ue({stack_:Vst});function Gst(r,e,t){let n=ee(r,"x","unsortedSegmentSum"),a=ee(e,"segmentIds","unsortedSegmentSum","int32");ie(Ip(t),()=>"numSegments must be of dtype int");let i={x:n,segmentIds:a},o={numSegments:t};return ae.runKernel(Hj,i,o)}var w5=ue({unsortedSegmentSum_:Gst});var Hst={kernelName:jH,inputsToSave:["x","indices"],gradFunc:(r,e,t)=>{let[n,a]=e,{axis:i,batchDims:o}=t,s=uo(i,n.shape)[0],u=(c,l,f)=>()=>{let h=c.shape,p=l.size,d=h.slice(0,s),m=d.length,v=h.slice(i,h.length).slice(1),g=v.length,y=Q6(0,m),w=Q6(m+1,m+1+g),b=eH([d,[p],v]),x=pe(f,b),S=pe(l,[p]),T=eH([[m],y,w]),E=oc(x,T),C=w5(E,S,c.shape[s]),R=US(T);return C=oc(C,R),C};if(o===1){let c=n.shape[0],l=n.split(c,0);return{x:()=>GS(l.map((p,d)=>u(p,a.slice(d,1),r.slice(d,1))())).reshape(n.shape),indices:()=>a}}else return{x:u(n,a,r),indices:()=>a}}};function Q6(r,e){let t=[];for(let n=r;n<e;++n)t.push(n);return t}function eH(r){let e=[];for(let t=0;t<r.length;++t)for(let n=0;n<r[t].length;++n)e.push(r[t][n]);return e}var jst={kernelName:KH,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e;return{a:()=>_r(t),b:()=>_r(n)}}};var Kst={kernelName:OS,gradFunc:r=>({x:()=>ct(r,"float32")})};var Xst={kernelName:XH,gradFunc:r=>({x:()=>_r(r)})};var Yst={kernelName:YH,gradFunc:r=>({x:()=>_r(r)})};var Jst={kernelName:JH,gradFunc:r=>({x:()=>_r(r)})};function Zst(r,e){let t=ee(r,"a","greater","string_or_numeric"),n=ee(e,"b","greater","string_or_numeric");[t,n]=pn(t,n),Ur(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(Qat,a)}var Vl=ue({greater_:Zst});var Qst={kernelName:ZH,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{alpha:a}=t,i=Vl(n,0);return{x:()=>Lo(i,r,ze(r,a))}}};var eut={kernelName:ej,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Wr(r,yi(t,1))}}};var tut={kernelName:QH,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Wr(r,ct(t,"float32"))}}};var rut={kernelName:sit,inputsToSave:[],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n]=e,{axis:a}=t;return{logits:()=>{let o=Ls(n);return In(r,ze(Ot(r,a,!0),o))}}}};function nut(r,e,t,n=5,a=1,i=1,o=.5){let s={x:r,y:e,dy:t},u={depthRadius:n,bias:a,alpha:i,beta:o};return ae.runKernel(uit,s,u)}var aut=ue({localResponseNormalizationBackprop_:nut});var iut={kernelName:tj,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n,a]=e,{depthRadius:i,bias:o,alpha:s,beta:u}=t;return{x:()=>aut(n,a,r,i,o,s,u)}}};function out(r,e){let t=ee(r,"a","equal","string_or_numeric"),n=ee(e,"b","equal","string_or_numeric");[t,n]=pn(t,n),Ur(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(Yat,a)}var HS=ue({equal_:out});function x5(r,e,t,n){return e.rank<t.rank&&(e=pe(e,jg(e.shape,n))),r.rank<t.rank&&(r=pe(r,jg(r.shape,n))),{x:()=>ze(r,ct(HS(t,e),r.dtype))}}var tH={kernelName:rj,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let n=t,{reductionIndices:a}=n,i=e[0],o=e[1],s=uo(a,i.shape),u=x5(r,o,i,s);return{x:()=>u.x()}}};function sut(r,e){let t=ee(r,"a","less","string_or_numeric"),n=ee(e,"b","less","string_or_numeric");[t,n]=pn(t,n),Ur(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(rit,a)}var k5=ue({less_:sut});var uut={kernelName:nj,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e;return{a:()=>ze(r,ct(Zg(t,n),"float32")),b:()=>ze(r,ct(k5(t,n),"float32"))}}};function cut(r,e,t,n,a,i,o){let s=ee(r,"dy","maxPool3dGrad"),u=ee(e,"input","maxPool3dGrad"),c=ee(t,"output","maxPool3dGrad"),l=s,f=u,h=c,p=!1;u.rank===4&&(p=!0,l=pe(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),f=pe(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=pe(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),ie(l.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),ie(f.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${f.rank}.`),ie(h.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${h.rank}.`),Ui("maxPool3dGrad",i,o);let d={dy:l,input:f,output:h},m={filterSize:n,strides:a,pad:i,dimRoundingMode:o},v=ae.runKernel(fit,d,m);return p?pe(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}var lut=ue({maxPool3dGrad_:cut});var fut={kernelName:lit,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n,a]=e,{filterSize:i,strides:o,pad:s,dimRoundingMode:u}=t;return{x:()=>lut(r,n,a,i,o,s,u)}}};function hut(r,e,t,n,a,i,o){let s=ee(r,"dy","maxPoolGrad"),u=ee(e,"input","maxPoolGrad"),c=ee(t,"output","maxPoolGrad");ie(u.rank===s.rank,()=>`Rank of input (${u.rank}) does not match rank of dy (${s.rank})`),ie(s.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${s.rank}.`),ie(u.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${u.rank}.`),Ui("maxPoolGrad",i,o);let l={dy:s,input:u,output:c},f={filterSize:n,strides:a,pad:i,dimRoundingMode:o};return ae.runKernel(cit,l,f)}var put=ue({maxPoolGrad_:hut});var dut={kernelName:aj,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n,a]=e,{filterSize:i,strides:o,pad:s}=t;return{x:()=>put(r,n,a,i,o,s)}}};function Fp(r,e="float32"){if(Pp(r),e==="complex64"){let n=Fp(r,"float32"),a=Fp(r,"float32");return zl(n,a)}let t=LS(Bo(r),e);return ae.makeTensor(t,r,e)}function ty(r,e="float32"){if(Pp(r),e==="complex64"){let n=ty(r,"float32"),a=Fp(r,"float32");return zl(n,a)}let t=Jj(Bo(r),e);return ae.makeTensor(t,r,e)}var vut={kernelName:ij,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{axis:a}=t,i=uo(a,n.shape),s=yst(n.shape,i)[1],u=Bo(s);return{x:()=>{let l=n.shape.slice();i.forEach(p=>{l[p]=1});let f=pe(r,l);return Wr(ze(f,ty(n.shape,"float32")),u)}}}};var mut={kernelName:oj,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let n=t,{axis:a}=n,[i,o]=e,s=uo(a,i.shape),u=x5(r,o,i,s);return{x:()=>u.x()}}};var gut={kernelName:sj,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e;return{a:()=>ze(r,ct(Qg(t,n),"float32")),b:()=>ze(r,ct(Vl(t,n),"float32"))}}};function yut(r,e,t){let n=ee(r,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");let a={x:n},i={begin:e,size:t};return ae.runKernel(Dj,a,i)}var so=ue({slice_:yut});var but={kernelName:uj,inputsToSave:["x"],gradFunc:(r,e,t)=>{let n=e[0],{paddings:a}=t,i=a.map(o=>o[0]);return{x:()=>so(r,i,n.shape)}}};function wut(r){let t={x:ee(r,"x","floor","float32")};return ae.runKernel(VH,t)}var S5=ue({floor_:wut});var xut={kernelName:cj,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Ur(t.shape,n.shape);return{a:()=>{let s=Sn(t.shape,a);return s.length>0?pe(Ot(r,s),t.shape):r},b:()=>{let s=ze(r,Ln(S5(Wr(t,n)))),u=Sn(n.shape,a);return u.length>0?pe(Ot(s,u),n.shape):s}}}};var kut={kernelName:lj,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Ur(t.shape,n.shape);return{a:()=>{let s=ze(r,ct(n,"float32")),u=Sn(t.shape,a);return u.length>0?pe(Ot(s,u),t.shape):s},b:()=>{let s=ze(r,ct(t,"float32")),u=Sn(n.shape,a);return u.length>0?pe(Ot(s,u),n.shape):s}}}};var Sut={kernelName:fj,gradFunc:r=>({x:()=>Ln(r)})};var Nut={kernelName:pj,inputsToSave:["indices"],gradFunc:(r,e)=>{let t=e[0];return{indices:()=>Fp(t.shape,"float32")}}};var Tut={kernelName:hj,gradFunc:r=>({x:()=>_r(r)})};function Eut(r,e=0){let t=ee(r,"x","unstack","string_or_numeric");ie(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);let n={value:t},a={axis:e};return ae.runKernel(Gj,n,a)}var N5=ue({unstack_:Eut});var Iut={kernelName:dj,saveAllInputs:!0,gradFunc:(r,e,t)=>{let{axis:n}=t;return N5(r,n).map(i=>()=>i)}};var rH={kernelName:vj,inputsToSave:["x"],gradFunc:(r,e,t)=>{let n=e[0],{paddings:a}=t,i=a.map(o=>o[0]);return{x:()=>so(r,i,n.shape)}}};function Cut(r){let t={x:ee(r,"x","log","float32")};return ae.runKernel(QH,t)}var ry=ue({log_:Cut});function Aut(r,e){let t=ee(r,"base","pow"),n=ee(e,"exp","pow");[t,n]=pn(t,n);let a={a:t,b:n};return ae.runKernel(mj,a)}var ny=ue({pow_:Aut});var Dut={kernelName:mj,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(r,e)=>{let[t,n,a]=e,i=t,o=n,s=Ur(i.shape,o.shape);return{a:()=>{let l=ct(o,"float32"),f=ze(r,ze(l,ny(i,In(l,hn(1))))),h=Sn(i.shape,s);return h.length>0&&(f=Ot(f,h)),pe(f,i.shape)},b:()=>{let l=Vl(i,0),f=Lo(l,ry(i),_r(i)),h=ze(r,ze(a,f)),p=Sn(o.shape,s);return p.length>0&&(h=Ot(h,p)),pe(h,o.shape)}}}};var _ut={kernelName:gj,inputsToSave:["x","alpha"],gradFunc:(r,e)=>{let[t,n]=e,a=Vl(t,0);return{x:()=>Lo(a,r,ze(r,n)),alpha:()=>{let i=Lo(a,_r(r),ze(r,t)),o=Sn(n.shape,r.shape);return o.length>0&&(i=Ot(i,o)),pe(i,n.shape)}}}};function Fut(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Yn=fr();Yn.registerFlag("DEBUG",()=>!1,r=>{r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Yn.registerFlag("IS_BROWSER",()=>Fut());Yn.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Yn.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Yn.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Yn.registerFlag("PROD",()=>!1);Yn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Yn.getBool("DEBUG"));Yn.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Yn.registerFlag("IS_TEST",()=>!1);Yn.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Yn.getBool("DEBUG"));Yn.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Yn.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Yn.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);var qo=class{static join(e){return new qo(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(n=>bi(n)?n.buffer:n),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let n=0;n<e.length;n++){let a=e[n];n!==e.length-1&&a.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);let i=t+a.byteLength;this.shards.push({buffer:a,start:t,end:i}),t=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);let n=this.findShardForByte(e);if(n===-1)throw new Error(`Could not find start shard for byte ${e}`);let a=t-e,i=new ArrayBuffer(a),o=new Uint8Array(i),s=0;for(let u=n;u<this.shards.length;u++){let c=this.shards[u],f=e+s-c.start,h=s,d=Math.min(t,c.end)-c.start,m=new Uint8Array(c.buffer,f,d-f);if(o.set(m,h),s+=m.length,t<c.end)break}return i}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(a){return e<a.start?-1:e>=a.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;let n=Rut(this.shards,t);return n===-1?-1:(this.previousShardIndex=n,this.previousShardIndex)}};function Rut(r,e){let t=0,n=r.length;for(;t<=n;){let a=Math.floor((n-t)/2)+t,i=e(r[a]);if(i===0)return a;i<0?n=a:t=a+1}return-1}var jS=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function nH(r){return jS?Buffer.byteLength(r,"utf8"):new Blob([r]).size}function Out(r){if(jS)return Buffer.from(r).toString("base64");let e=new Uint8Array(r),t="";for(let n=0,a=e.length;n<a;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function Put(r){if(jS){let n=Buffer.from(r,"base64");return n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}let e=atob(r),t=new Uint8Array(e.length);for(let n=0;n<e.length;++n)t.set([e.charCodeAt(n)],n);return t.buffer}function T5(r,e){let t={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy,weightsManifest:e};return r.signature!=null&&(t.signature=r.signature),r.userDefinedMetadata!=null&&(t.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(t.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(t.initializerSignature=r.initializerSignature),r.trainingConfig!=null&&(t.trainingConfig=r.trainingConfig),t}function Mut(r,e,t){let n={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy};if(r.trainingConfig!=null&&(n.trainingConfig=r.trainingConfig),r.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");n.weightSpecs=e,n.weightData=t}return r.signature!=null&&(n.signature=r.signature),r.userDefinedMetadata!=null&&(n.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(n.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(n.initializerSignature=r.initializerSignature),n}async function But(r,e){let t,n;return r.weightsManifest!=null&&([t,n]=await e(r.weightsManifest)),Mut(r,t,n)}function ay(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:nH(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:nH(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:new qo(r.weightData).byteLength}}function aH(r){let e=[];for(let t of r)e.push(...t.weights);return e}var rn=class{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return rn.instance==null&&(rn.instance=new rn),rn.instance}static registerSaveRouter(e){rn.getInstance().saveRouters.push(e)}static registerLoadRouter(e){rn.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return rn.getHandlers(e,"save")}static getLoadHandlers(e,t){return rn.getHandlers(e,"load",t)}static getHandlers(e,t,n){let a=[];return(t==="load"?rn.getInstance().loadRouters:rn.getInstance().saveRouters).forEach(o=>{let s=o(e,n);s!==null&&a.push(s)}),a}};var Lut="tensorflowjs",qut=1,Ep="models_store",$g="model_info_store";function zut(){if(!fr().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let r=typeof window>"u"?self:window,e=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function $ut(r){let e=r.result;e.createObjectStore(Ep,{keyPath:"modelPath"}),e.createObjectStore($g,{keyPath:"modelPath"})}var $l=class{constructor(e){if(this.indexedDB=zut(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((n,a)=>{let i=this.indexedDB.open(Lut,qut);i.onupgradeneeded=()=>$ut(i),i.onsuccess=()=>{let o=i.result;if(t==null){let s=o.transaction(Ep,"readonly"),c=s.objectStore(Ep).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return o.close(),a(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));n(c.result.modelArtifacts)},c.onerror=l=>(o.close(),a(c.error)),s.oncomplete=()=>o.close()}else{t.weightData=qo.join(t.weightData);let s=ay(t),u=o.transaction($g,"readwrite"),c=u.objectStore($g),l;try{l=c.put({modelPath:this.modelPath,modelArtifactsInfo:s})}catch(h){return a(h)}let f;l.onsuccess=()=>{f=o.transaction(Ep,"readwrite");let h=f.objectStore(Ep),p;try{p=h.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:s})}catch(d){return a(d)}p.onsuccess=()=>n({modelArtifactsInfo:s}),p.onerror=d=>{c=u.objectStore($g);let m=c.delete(this.modelPath);m.onsuccess=()=>(o.close(),a(p.error)),m.onerror=v=>(o.close(),a(p.error))}},l.onerror=h=>(o.close(),a(l.error)),u.oncomplete=()=>{f==null?o.close():f.oncomplete=()=>o.close()}}},i.onerror=o=>a(i.error)})}};$l.URL_SCHEME="indexeddb://";var E5=r=>fr().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith($l.URL_SCHEME)?Wut(r.slice($l.URL_SCHEME.length)):null;rn.registerSaveRouter(E5);rn.registerLoadRouter(E5);function Wut(r){return new $l(r)}var kp="/",Sp="tensorflowjs_models",Uut="info",Vut="model_topology",Gut="weight_specs",Hut="weight_data",jut="model_metadata";function Kut(r){return{info:[Sp,r,Uut].join(kp),topology:[Sp,r,Vut].join(kp),weightSpecs:[Sp,r,Gut].join(kp),weightData:[Sp,r,Hut].join(kp),modelMetadata:[Sp,r,jut].join(kp)}}function Xut(r){for(let e of Object.values(r))window.localStorage.removeItem(e)}var Wl=class{constructor(e){if(!fr().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Kut(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),a=ay(e),i=qo.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,Out(i));let o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:a}}catch{throw Xut(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${a.modelTopologyBytes}, weightSpecsBytes=${a.weightSpecsBytes}, weightDataBytes=${a.weightDataBytes}.`)}}}async load(){let e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let t={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(n==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=n;let a=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(a==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=a;let i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){let s=JSON.parse(i);t.format=s.format,t.generatedBy=s.generatedBy,t.convertedBy=s.convertedBy,s.signature!=null&&(t.signature=s.signature),s.userDefinedMetadata!=null&&(t.userDefinedMetadata=s.userDefinedMetadata),s.modelInitializer!=null&&(t.modelInitializer=s.modelInitializer),s.initializerSignature!=null&&(t.initializerSignature=s.initializerSignature),s.trainingConfig!=null&&(t.trainingConfig=s.trainingConfig)}let o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=Put(o),t}};Wl.URL_SCHEME="localstorage://";var I5=r=>fr().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Wl.URL_SCHEME)?Yut(r.slice(Wl.URL_SCHEME.length)):null;rn.registerSaveRouter(I5);rn.registerLoadRouter(I5);function Yut(r){return new Wl(r)}var Jut="model",Zut=".json",Qut=".weights.bin";function iH(r){return new Promise(e=>setTimeout(e)).then(r)}var zo=class{constructor(e){if(!fr().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(zo.URL_SCHEME)&&(e=e.slice(zo.URL_SCHEME.length)),(e==null||e.length===0)&&(e=Jut),this.modelJsonFileName=e+Zut,this.weightDataFileName=e+Qut}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");let t=qo.join(e.weightData),n=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let a=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i=T5(e,a),o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),s=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(s.download=this.modelJsonFileName,s.href=o,await iH(()=>s.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){let u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;u.download=this.weightDataFileName,u.href=n,await iH(()=>u.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:ay(e)}}}};zo.URL_SCHEME="downloads://";var ect=r=>fr().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(zo.URL_SCHEME)?tct(r.slice(zo.URL_SCHEME.length)):null;rn.registerSaveRouter(ect);function tct(r="model"){return new zo(r)}function oH(r,e,t,n){o(r),t=t??0,n=n??1,s(t,n);let a=0,i=u=>(u.then(c=>{let l=t+ ++a/r.length*(n-t);return e(l),c}),u);function o(u){ie(u!=null&&Array.isArray(u)&&u.length>0,()=>"promises must be a none empty array")}function s(u,c){ie(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${u}`),ie(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),ie(c>=u,()=>`startFraction must be no more than endFraction, but got startFraction ${u} and endFraction ${c}`)}return Promise.all(r.map(i))}async function rct(r,e){e==null&&(e={});let t=e.fetchFunc==null?fr().platform.fetch:e.fetchFunc,n=r.map(f=>t(f,e.requestInit,{isBinary:!0})),a=0,i=.5,s=(e.onProgress==null?await Promise.all(n):await oH(n,e.onProgress,a,i)).map(f=>f.arrayBuffer()),u=.5,c=1;return e.onProgress==null?await Promise.all(s):await oH(s,e.onProgress,u,c)}function nct(r,e){var t;let n=e.fetchFunc==null?fr().platform.fetch:e.fetchFunc,a=0,i;return(t=e.onProgress)===null||t===void 0||t.call(e,0),new ReadableStream({pull:async o=>{for(var s;a<r.length;){i||(i=(await n(r[a],e.requestInit,{isBinary:!0})).body.getReader());let{done:u,value:c}=await i.read();if(u){a++,i=void 0,(s=e.onProgress)===null||s===void 0||s.call(e,a/r.length);continue}o.enqueue(c);return}o.close()}})}var act="application/octet-stream",ict="application/json",Rp=class{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(ie(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=fr().platform.fetch,ie(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&ie(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;let n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=T5(e,n);if(t.body.append("model.json",new Blob([JSON.stringify(a)],{type:ict}),"model.json"),e.weightData!=null){let o=qo.join(e.weightData);t.body.append("model.weights.bin",new Blob([o],{type:act}),"model.weights.bin")}let i=await this.fetch(this.path,t);if(i.ok)return{modelArtifactsInfo:ay(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async loadModelJSON(){let e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}let n=t.modelTopology,a=t.weightsManifest;if(n==null&&a==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();let e=await this.loadModelJSON();return But(e,t=>this.loadWeights(t))}async loadStream(){let e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),n=aH(e.weightsManifest),a=()=>nct(t,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:n,getWeightStream:a})}async getWeightUrls(e){let t=Array.isArray(this.path)?this.path[1]:this.path,[n,a]=oct(t),i=this.weightPathPrefix||n,o=[],s=[];for(let u of e)for(let c of u.paths)this.weightUrlConverter!=null?s.push(this.weightUrlConverter(c)):o.push(i+c+a);return this.weightUrlConverter&&o.push(...await Promise.all(s)),o}async loadWeights(e){let t=await this.getWeightUrls(e),n=aH(e),a=await rct(t,this.loadOptions);return[n,a]}};Rp.URL_SCHEME_REGEX=/^https?:\/\//;function oct(r){let e=r.lastIndexOf("/"),t=r.lastIndexOf("?"),n=r.substring(0,e),a=t>e?r.substring(t):"";return[n+"/",a]}function sH(r){return r.match(Rp.URL_SCHEME_REGEX)!=null}var C5=(r,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(r)?t=r.every(n=>sH(n)):t=sH(r),t)return sct(r,e)}return null};rn.registerSaveRouter(C5);rn.registerLoadRouter(C5);function sct(r,e){return new Rp(r,e)}function uct(r,e,t=1,n=0,a="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);let o={indices:ee(r,"indices","oneHot","int32")},s={dtype:a,depth:e,onValue:t,offValue:n};return ae.runKernel(pj,o,s)}var cct=ue({oneHot_:uct});function lct(r,e,t){let n=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${r}, sliceDim: ${n}, and batchDim: ${a}.`;if(t.rank<a)throw new Error(i+` update.rank < ${a}. `);if(r.length<n+(t.rank-a))throw new Error(i+` Output shape length < ${n+(t.rank-a)}`);if(t.rank!==a+r.length-n)throw new Error(i+` update.rank != ${a+r.length-n}`);for(let o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+` updates.shape[${o}] (${t.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<t.rank-a;++o)if(t.shape[o+a]!==r[o+n])throw new Error(i+` updates.shape[${o+a}] (${t.shape[o+a]}) != shape[${o+a}] (${r[o+a]})`)}function fct(r,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(r.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${r.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(r.size===0)throw new Error(`Updates specified for empty output. updates shape: ${r.shape}`)}lct(t,e,r)}function hct(r,e,t){let n,a=r.shape.length;typeof e=="number"?n=[e,...new Array(a-1).fill(0)]:e.length<a?n=e.concat(new Array(a-e.length).fill(0)):n=e.slice(),n.forEach(o=>{ie(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=[t,...new Array(a-1).fill(-1)]:t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map((o,s)=>o>=0?o:(ie(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${s}.`),r.shape[s]-n[s])),[n,i]}var IS=class{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}};function pct(r){let e=ee(r,"x","abs");if(e.dtype==="complex64"){let t={x:e};return ae.runKernel(AH,t)}else{let t={x:e};return ae.runKernel(dH,t)}}var Mo=ue({abs_:pct});function dct(r){let t={x:ee(r,"x","acos")};return ae.runKernel(vH,t)}var vct=ue({acos_:dct});function mct(r){let t={x:ee(r,"x","acosh")};return ae.runKernel(mH,t)}var gct=ue({acosh_:mct});function yct(r,e=null,t=!1){let a={x:ee(r,"x","all","bool")},i={axis:e,keepDims:t};return ae.runKernel(Fat,a,i)}var bct=ue({all_:yct});function wct(r,e=null,t=!1){let a={x:ee(r,"x","any","bool")},i={axis:e,keepDims:t};return ae.runKernel(Rat,a,i)}var xct=ue({any_:wct});function kct(r,e=0){let n={x:ee(r,"x","argMax")},a={axis:e};return ae.runKernel(gH,n,a)}var Sct=ue({argMax_:kct});function Nct(r,e=0){let n={x:ee(r,"x","argMin")},a={axis:e};return ae.runKernel(yH,n,a)}var Tct=ue({argMin_:Nct});function Ect(r){let t={x:ee(r,"x","asin")};return ae.runKernel(bH,t)}var Ict=ue({asin_:Ect});function Cct(r){let t={x:ee(r,"x","asinh")};return ae.runKernel(wH,t)}var Act=ue({asinh_:Cct});function Dct(r){let t={x:ee(r,"x","atan")};return ae.runKernel(xH,t)}var _ct=ue({atan_:Dct});function Fct(r,e){let t=ee(r,"a","atan2"),n=ee(e,"b","atan2");[t,n]=pn(t,n);let a={a:t,b:n};return ae.runKernel(SH,a)}var Rct=ue({atan2_:Fct});function Oct(r){let t={x:ee(r,"x","atanh")};return ae.runKernel(kH,t)}var Pct=ue({atanh_:Oct});function Mct(r,e,t,n,a){let i=ee(r,"x","avgPool","float32"),o=1;ie(Ul(t,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);let s=i,u=!1;i.rank===3&&(u=!0,s=pe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),ie(s.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${s.rank}.`),Ui("avgPool",n,a);let c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=ae.runKernel(NH,c,l);return f=ct(f,i.dtype),u?pe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var A5=ue({avgPool_:Mct});function Bct(r,e=0){ie(r.length>=1,()=>"Pass at least one tensor to concat");let t=u5(r,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),t.length===1)return f5(t[0]);let n=t,a={axis:e};return ae.runKernel(DH,n,a)}var Op=ue({concat_:Bct});function Lct(r){let t={x:ee(r,"x","sigmoid","float32")};return ae.runKernel(Oj,t)}var KS=ue({sigmoid_:Lct});function qct(r){let t={x:ee(r,"x","tanh","float32")};return ae.runKernel(Vj,t)}var zct=ue({tanh_:qct});function $ct(r,e,t){let n=ee(r,"x","batchToSpaceND"),a=e.reduce((s,u)=>s*u);ie(n.rank>=1+e.length,()=>`input rank is ${n.rank} but should be > than blockShape.length ${e.length}`),ie(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),ie(n.shape[0]%a===0,()=>`input tensor batch is ${n.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${a}`);let i={x:n},o={blockShape:e,crops:t};return ae.runKernel(EH,i,o)}var XS=ue({batchToSpaceND_:$ct});function Wct(r){let e;return r.rank===0||r.rank===1?e=pe(r,[1,1,1,r.size]):r.rank===2?e=pe(r,[1,1,r.shape[0],r.shape[1]]):r.rank===3?e=pe(r,[1,r.shape[0],r.shape[1],r.shape[2]]):e=r,e}function Uct(r,e,t,n,a,i){i==null&&(i=.001);let o=ee(r,"x","batchNorm"),s=ee(e,"mean","batchNorm"),u=ee(t,"variance","batchNorm"),c;a!=null&&(c=ee(a,"scale","batchNorm"));let l;n!=null&&(l=ee(n,"offset","batchNorm")),ie(s.rank===u.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),ie(l==null||s.rank===l.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),ie(c==null||s.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let h={x:Wct(o),scale:c,offset:l,mean:s,variance:u},p={varianceEpsilon:i},d=ae.runKernel(HH,h,p);return pe(d,o.shape)}var Vct=ue({batchNorm_:Uct});function Gct(r){let t={x:ee(r,"x","ceil","float32")};return ae.runKernel(IH,t)}var Hct=ue({ceil_:Gct});function jct(r,e,t){Pp(r),t=t||Yg(e);let n={shape:r,value:e,dtype:t};return ae.runKernel(Zat,{},n)}function Kct(r,e,t){let n=ee(r,"x","clipByValue");if(ie(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return jct(n.shape,e,n.dtype);let a={x:n},i={clipValueMin:e,clipValueMax:t};return ae.runKernel(CH,a,i)}var Xct=ue({clipByValue_:Kct});function Yct(r,e,t,n,a="NWC",i=1,o){let s=ee(r,"x","conv1d"),u=ee(e,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=pe(s,[1,s.shape[0],s.shape[1]])),ie(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),ie(u.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`),Ui("conv1d",n,o),ie(c.shape[2]===u.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${u.shape[1]}.`),ie(Ul(t,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${i}'`),ie(Gg(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),ie(Gg(t),()=>"Error in conv1D: Stride should be larger than 0."),ie(a==="NWC",()=>`Error in conv1d: got dataFormat of ${a} but only NWC is currently supported.`);let f=pe(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=pe(c,[c.shape[0],1,c.shape[1],c.shape[2]]),v=ey(h,f,[1,t],n,"NHWC",[1,i],o);return l?pe(v,[v.shape[2],v.shape[3]]):pe(v,[v.shape[0],v.shape[2],v.shape[3]])}var Jct=ue({conv1d_:Yct});function Zct(r,e,t,n,a,i){let o=ee(r,"x","conv2dTranspose"),s=ee(e,"filter","conv2dTranspose");return p5(t,o,s,n,a,"NHWC",i)}var Qct=ue({conv2dTranspose_:Zct});function elt(r){let t={x:ee(r,"x","cos","float32")};return ae.runKernel(RH,t)}var YS=ue({cos_:elt});function tlt(r){let t={x:ee(r,"x","cosh","float32")};return ae.runKernel(OH,t)}var D5=ue({cosh_:tlt});function rlt(r,e=0,t=!1,n=!1){let i={x:ee(r,"x","cumprod")},o={axis:e,exclusive:t,reverse:n};return ae.runKernel(Uat,i,o)}var CS=ue({cumprod_:rlt});function nlt(r,e,t="NHWC"){let n=ee(r,"x","depthToSpace","float32"),a=t==="NHWC"?n.shape[1]:n.shape[2],i=t==="NHWC"?n.shape[2]:n.shape[3],o=t==="NHWC"?n.shape[3]:n.shape[1];ie(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),ie(a*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${a} and ${e}  for depthToSpace with input shape
    ${n.shape}`),ie(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${n.shape}`),ie(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${n.shape}`);let s={x:n},u={blockSize:e,dataFormat:t};return ae.runKernel(Vat,s,u)}var alt=ue({depthToSpace_:nlt});function ilt(r,e,t,n,a="NHWC",i=[1,1],o){let s=ee(r,"x","depthwiseConv2d","float32"),u=ee(e,"filter","depthwiseConv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=pe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ie(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),ie(u.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`);let f=a==="NHWC"?c.shape[3]:c.shape[1];ie(f===u.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${f}) must match the inChannels dimension in filter ${u.shape[2]}.`),Ui("depthwiseConv2d",n,o);let h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=ae.runKernel(MH,h,p);return l?pe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var _5=ue({depthwiseConv2d_:ilt});function olt(r,e,t,n,a=[1,1],i="NHWC"){let o=ee(r,"x","dilation2d"),s=ee(e,"filter","dilation2d");ie(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),ie(s.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${s.rank}.`),ie(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let u=o,c=!1;o.rank===3&&(u=pe(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),ie(u.shape[3]===s.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${u.shape[3]} vs ${s.shape[2]}`);let l={x:u,filter:s},f={strides:t,pad:n,dilations:a},h=ae.runKernel(BH,l,f);return c?pe(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var slt=ue({dilation2d_:olt});function ult(r,e){let t=ee(r,"a","div"),n=ee(e,"b","div");[t,n]=pn(t,n);let a=Wr(t,n),i=_r(a),o=HS(n,i);return Lo(o,i,a)}var clt=ue({divNoNan_:ult});function llt(r,e){let t=ee(r,"t1","dot"),n=ee(e,"t2","dot");ie((t.rank===1||t.rank===2)&&(n.rank===1||n.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${n.rank}.`);let a=t.rank===1?t.size:t.shape[1],i=n.rank===1?n.size:n.shape[0];if(ie(a===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${a} and ${i}.`),t.rank===1&&n.rank===1){let o=pe(t,[1,-1]),s=pe(n,[-1,1]),u=za(o,s);return pe(u,[])}else if(t.rank===1&&n.rank===2){let o=pe(t,[1,-1]),s=pe(n,[n.shape[0],n.shape[1]]),u=za(o,s);return pe(u,[u.size])}else if(t.rank===2&&n.rank===1){let o=pe(n,[-1,1]),s=za(t,o);return pe(s,[s.size])}else{let o=pe(n,[n.shape[0],n.shape[1]]);return za(t,o)}}var flt=ue({dot_:llt});function hlt(r){let t={x:ee(r,"x","elu","float32")};return ae.runKernel(qH,t)}var plt=ue({elu_:hlt});function dlt(r){let e=ee(r,"x","erf");ie(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=ct(e,"float32"));let t={x:e};return ae.runKernel(zH,t)}var vlt=ue({erf_:dlt});function mlt(r,e=null,t=!1){let a={x:ee(r,"x","max")},i={reductionIndices:e,keepDims:t};return ae.runKernel(rj,a,i)}var Ll=ue({max_:mlt});function glt(r,e=null,t=!1){let a={x:ee(r,"x","min")},i={axis:e,keepDims:t};return ae.runKernel(oj,a,i)}var AS=ue({min_:glt});function ylt(r,e="euclidean",t=null,n=!1){r=ee(r,"x","norm");let a=F5(r,e,t),i=a.shape;if(n){let o=uo(t,r.shape);i=jg(a.shape,o)}return pe(a,i)}function F5(r,e,t=null){if(r.rank===0)return Mo(r);if(r.rank!==1&&t===null)return F5(pe(r,[-1]),e,t);if(r.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Ot(Mo(r),t);if(e===1/0)return Ll(Mo(r),t);if(e===-1/0)return AS(Mo(r),t);if(e==="euclidean"||e===2)return Bs(Ot(ny(Mo(r),hn(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return Ll(Ot(Mo(r),t[0]),t[1]-1);if(e===1/0)return Ll(Ot(Mo(r),t[1]),t[0]);if(e===-1/0)return AS(Ot(Mo(r),t[1]),t[0]);if(e==="fro"||e==="euclidean")return Bs(Ot(kn(r),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}var R5=ue({norm_:ylt});function blt(r,e=null,t=!1){return R5(r,"euclidean",e,t)}var wlt=ue({euclideanNorm_:blt});function xlt(r,e=0){let t=ee(r,"x","expandDims","string_or_numeric");ie(e<=t.rank,()=>"Axis must be <= rank of the tensor");let n={input:t},a={dim:e};return ae.runKernel(WH,n,a)}var O5=ue({expandDims_:xlt});function klt(r){let t={x:ee(r,"x","expm1")};return ae.runKernel(UH,t)}var Slt=ue({expm1_:klt});function Nlt(r,e,t=0,n=0){let a=ee(r,"x","gather"),i=ee(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:n};return ae.runKernel(jH,o,s)}var P5=ue({gather_:Nlt});function Tlt(r){let t={x:ee(r,"x","isFinite")};return ae.runKernel(XH,t)}var Elt=ue({isFinite_:Tlt});function Ilt(r){let t={x:ee(r,"x","isInf")};return ae.runKernel(YH,t)}var Clt=ue({isInf_:Ilt});function Alt(r){let t={x:ee(r,"x","isNaN")};return ae.runKernel(JH,t)}var Dlt=ue({isNaN_:Alt});function _lt(r,e=.2){let n={x:ee(r,"x","leakyRelu")},a={alpha:e};return ae.runKernel(ZH,n,a)}var Flt=ue({leakyRelu_:_lt});function Rlt(r,e=5,t=1,n=1,a=.5){let i=ee(r,"x","localResponseNormalization");ie(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),ie(Ip(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,s=!1;i.rank===3&&(s=!0,o=pe(i,[1,i.shape[0],i.shape[1],i.shape[2]]));let u={x:o},c={depthRadius:e,bias:t,alpha:n,beta:a},l=ae.runKernel(tj,u,c);return s?pe(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var Olt=ue({localResponseNormalization_:Rlt});function Plt(r){let t={x:ee(r,"x","log1p")};return ae.runKernel(ej,t)}var Mlt=ue({log1p_:Plt});function Blt(r,e){ie(gS(r),()=>"The f passed in variableGrads(f) must be a function"),ie(e==null||Array.isArray(e)&&e.every(c=>c instanceof ql),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");let t=e!=null;if(!t){e=[];for(let c in ae.registeredVariables)e.push(ae.registeredVariables[c])}let n=t?e.filter(c=>!c.trainable):null,a=e.length;e=e.filter(c=>c.trainable),ie(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${a} variables is trainable.`);let i=!0,{value:o,grads:s}=ae.gradients(r,e,null,i);ie(s.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),ie(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);let u={};return e.forEach((c,l)=>{s[l]!=null&&(u[c.name]=s[l])}),n?.forEach(c=>u[c.name]=null),{value:o,grads:u}}function M5(r){return ae.customGrad(r)}function Llt(r){let t={x:ee(r,"x","softplus")};return ae.runKernel(Pj,t)}var B5=ue({softplus_:Llt});function qlt(r){let e=ee(r,"x","logSigmoid");return M5(n=>({value:Ln(B5(Ln(n))),gradFunc:o=>ze(o,KS(Ln(n)))}))(e)}var zlt=ue({logSigmoid_:qlt});function $lt(r,e=-1){let t=ee(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return M5((a,i)=>{let s=Ll(a,e,!0),u=In(a,s),c=In(ct(u,"float32"),ry(Ot(Ls(u),e,!0)));return i([c]),{value:c,gradFunc:(f,h)=>{let[p]=h,d=!0,m=Ls(p);return In(f,ze(Ot(f,e,d),m))}}})(t)}var Wlt=ue({logSoftmax_:$lt});function Ult(r,e=null,t=!1){let n=ee(r,"x","logSumExp"),a=uo(e,n.shape),i=Ll(n,a,!0),o=In(n,i),s=Ls(o),u=Ot(s,a),c=ry(u),l=yi(pe(i,c.shape),c);if(t){let f=jg(l.shape,a);return pe(l,f)}return l}var Vlt=ue({logSumExp_:Ult});function Glt(r){let t={x:ee(r,"x","logicalNot","bool")};return ae.runKernel(iit,t)}var JS=ue({logicalNot_:Glt});function Hlt(r,e){let t=ee(r,"a","logicalOr","bool"),n=ee(e,"b","logicalOr","bool");Ur(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(oit,a)}var L5=ue({logicalOr_:Hlt});function jlt(r,e){let t=ee(r,"a","logicalXor","bool"),n=ee(e,"b","logicalXor","bool");return Ur(t.shape,n.shape),_p(L5(r,e),JS(_p(r,e)))}var Klt=ue({logicalXor_:jlt});function Xlt(r,e,t,n,a){let i=ee(r,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=pe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),ie(s.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.rank}.`),ie(Ul(t,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),Ui("maxPool",n,a);let c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=ae.runKernel(aj,c,l);return u?pe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var q5=ue({maxPool_:Xlt});function Ylt(r,e){let t=ee(r,"a","maximum"),n=ee(e,"b","maximum");[t,n]=pn(t,n),t.dtype==="bool"&&(t=ct(t,"int32"),n=ct(n,"int32")),Ur(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(nj,a)}var z5=ue({maximum_:Ylt});function Jlt(r,e=null,t=!1){let a={x:ee(r,"x","mean")},i={axis:e,keepDims:t};return ae.runKernel(ij,a,i)}var Zlt=ue({mean_:Jlt});function Qlt(r,e){let t=ee(r,"a","minimum"),n=ee(e,"b","minimum");[t,n]=pn(t,n),t.dtype==="bool"&&(t=ct(t,"int32"),n=ct(n,"int32")),Ur(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(sj,a)}var eft=ue({minimum_:Qlt});function tft(r,e,t){ie(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);let n=ee(r,"x","mirrorPad");if(n.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");ie(e.length===n.rank,()=>`Padding doesn't match input. Must be ${n.rank}. Got ${e.length}.`);let a=t==="reflect"?1:0;for(let s=0;s<n.rank;s++)ie(e[s].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),ie(e[s][0]>=0&&e[s][0]<=n.shape[s]-a&&e[s][1]>=0&&e[s][1]<=n.shape[s]-a,()=>`Padding in dimension ${s} cannot be greater than or equal to ${n.shape[s]-a} or less than 0 for input of shape ${n.shape}`);let i={paddings:e,mode:t},o={x:n};return ae.runKernel(uj,o,i)}var rft=ue({mirrorPad_:tft});function nft(r,e){let t=ee(r,"a","mod"),n=ee(e,"b","mod");[t,n]=pn(t,n);let a={a:t,b:n};return ae.runKernel(cj,a)}var aft=ue({mod_:nft});function ift(r,e){let t=ee(r,"a","notEqual","string_or_numeric"),n=ee(e,"b","notEqual","string_or_numeric");[t,n]=pn(t,n),Ur(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(hit,a)}var oft=ue({notEqual_:ift});function sft(r){let t={x:ee(r,"x","onesLike")};return ae.runKernel(hj,t)}var uft=ue({onesLike_:sft});function cft(r,e,t=0){let n=ee(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let a={paddings:e,constantValue:t},i={x:n};return ae.runKernel(vj,i,a)}var $5=ue({pad_:cft});function lft(r,e,t,n,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),n===0&&(n="valid");let s=ee(r,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=pe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ie(Ul(i,a),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${a}'`);let l=Cot(u.shape,e,i,a,n),f=[l.dilationHeight,l.dilationWidth],h;n==="same"?h=hft([l.filterHeight,l.filterWidth],f):h=[[0,0],[0,0]];let p=f[0]===1&&f[1]===1,[d,m]=fft([l.inHeight,l.inWidth],f,h),v=p?n:"valid",g=p?u:WS(u,f,d),w=(t==="avg"?()=>A5(g,e,i,v,o):()=>q5(g,e,i,v,o))(),b=p?w:XS(w,f,m);return c?pe(b,[b.shape[1],b.shape[2],b.shape[3]]):b}function fft(r,e,t){let n=t.map(l=>l[0]),a=t.map(l=>l[1]),i=r.concat(n,a),o=e.map((l,f)=>(l-i[f]%l)%l),s=a.map((l,f)=>l+o[f]),u=e.map((l,f)=>[n[f],s[f]]),c=e.map((l,f)=>[0,o[f]]);return[u,c]}function hft(r,e){let n=r.map((o,s)=>o+(o-1)*(e[s]-1)).map(o=>o-1),a=n.map(o=>Math.floor(o/2)),i=n.map((o,s)=>o-a[s]);return n.map((o,s)=>[a[s],i[s]])}var pft=ue({pool_:lft});function dft(r,e){let t=ee(r,"x","prelu"),n=ee(e,"alpha","prelu"),a={x:t,alpha:n};return ae.runKernel(gj,a)}var vft=ue({prelu_:dft});function mft(r,e=null,t=!1){let n=ee(r,"x","prod");n.dtype==="bool"&&(n=ct(n,"int32"));let a={x:n},i={axis:e,keepDims:t};return ae.runKernel(yj,a,i)}var gft=ue({prod_:mft});var sc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ZS={exports:{}},zEt=ZS.exports;(function(r){(function(e,t,n){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(sc,r,!1)})(ZS);var yft=ZS.exports,QS={exports:{}},$Et=QS.exports;(function(r){(function(e,t,n){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(sc,r,!1)})(QS);var bft=QS.exports,eN={exports:{}},WEt=eN.exports;(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(sc,r,!1)})(eN);var wft=eN.exports,tN={exports:{}},UEt=tN.exports;(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,p,d;return h=l[f],h^=h>>>7,p=h^h<<24,h=l[f+1&7],p^=h^h>>>10,h=l[f+3&7],p^=h^h>>>3,h=l[f+4&7],p^=h^h<<7,h=l[f+7&7],h=h^h<<13,p^=h^h<<9,l[f]=p,u.i=f+1&7,p};function c(l,f){var h,p,d=[];if(f===(f|0))p=d[0]=f;else for(f=""+f,h=0;h<f.length;++h)d[h&7]=d[h&7]<<15^f.charCodeAt(h)+d[h+1&7]<<13;for(;d.length<8;)d.push(0);for(h=0;h<8&&d[h]===0;++h);for(h==8?p=d[7]=-1:p=d[h],l.x=d,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(sc,r,!1)})(tN);var xft=tN.exports,rN={exports:{}},VEt=rN.exports;(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,p,d;return u.w=l=l+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(l^l>>>16)|0};function c(l,f){var h,p,d,m,v,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,m=-32;m<y;++m)f&&(p^=f.charCodeAt((m+32)%f.length)),m===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(v=v+1640531527|0,h=g[m&127]^=p+v,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,m=4*128;m>0;--m)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;l.w=v,l.X=g,l.i=d}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(sc,r,!1)})(rN);var kft=rN.exports,nN={exports:{}},GEt=nN.exports;(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(sc,r,!1)})(nN);var Sft=nN.exports,aN={exports:{}},HEt=aN.exports;(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),c=n.pow(2,o),l=c*2,f=a-1,h;function p(b,x,S){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(v(x.entropy?[b,w(t)]:b??y(),3),T),C=new d(T),R=function(){for(var _=C.g(i),M=u,$=0;_<c;)_=(_+$)*a,M*=a,$=C.g(1);for(;_>=l;)_/=2,M/=2,$>>>=1;return(_+$)/M};return R.int32=function(){return C.g(4)|0},R.quick=function(){return C.g(4)/4294967296},R.double=R,g(w(C.S),t),(x.pass||S||function(_,M,$,z){return z&&(z.S&&m(z,C),_.state=function(){return m(C,{})}),$?(n[s]=_,M):_})(R,E,"global"in x?x.global:this==n,x.state)}function d(b){var x,S=b.length,T=this,E=0,C=T.i=T.j=0,R=T.S=[];for(S||(b=[S++]);E<a;)R[E]=E++;for(E=0;E<a;E++)R[E]=R[C=f&C+b[E%S]+(x=R[E])],R[C]=x;(T.g=function(_){for(var M,$=0,z=T.i,q=T.j,L=T.S;_--;)M=L[z=f&z+1],$=$*a+L[f&(L[z]=L[q=f&q+M])+(L[q]=M)];return T.i=z,T.j=q,$})(a)}function m(b,x){return x.i=b.i,x.j=b.j,x.S=b.S.slice(),x}function v(b,x){var S=[],T=typeof b,E;if(x&&T=="object")for(E in b)try{S.push(v(b[E],x-1))}catch{}return S.length?S:T=="string"?b:b+"\0"}function g(b,x){for(var S=b+"",T,E=0;E<S.length;)x[f&E]=f&(T^=x[f&E]*19)+S.charCodeAt(E++);return w(x)}function y(){try{var b;return h&&(b=h.randomBytes)?b=b(a):(b=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(b)),w(b)}catch{var x=e.navigator,S=x&&x.plugins;return[+new Date,e,S,e.screen,w(t)]}}function w(b){return String.fromCharCode.apply(0,b)}if(g(n.random(),t),r.exports){r.exports=p;try{h=Yd()}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:sc,[],Math)})(aN);var Nft=aN.exports,Tft=yft,Eft=bft,Ift=wft,Cft=xft,Aft=kft,Dft=Sft,Gl=Nft;Gl.alea=Tft;Gl.xor128=Eft;Gl.xorwow=Ift;Gl.xorshift7=Cft;Gl.xor4096=Aft;Gl.tychei=Dft;function _ft(r){let t={x:ee(r,"x","reciprocal")};return ae.runKernel(bj,t)}var Fft=ue({reciprocal_:_ft});function Rft(r){let t={x:ee(r,"x","relu")};return ae.runKernel(wj,t)}var Oft=ue({relu_:Rft});function Pft(r){let t={x:ee(r,"x","relu6")};return ae.runKernel(Nj,t)}var Mft=ue({relu6_:Pft});function Bft(r,e){let n={x:ee(r,"x","reverse")},a={dims:e};return ae.runKernel(Tj,n,a)}var Xg=ue({reverse_:Bft});function Lft(r){let t={x:ee(r,"x","round")};return ae.runKernel(Ej,t)}var qft=ue({round_:Lft});function zft(r){let t={x:ee(r,"x","selu")};return ae.runKernel(Aj,t)}var $ft=ue({selu_:zft});function Wft(r,e,t,n,a,i=[1,1],o="NHWC"){let s=ee(r,"x","separableConv2d"),u=ee(e,"depthwiseFilter","separableConv2d"),c=ee(t,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(s.rank===3&&(f=!0,l=pe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");ie(l.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${l.rank}.`),ie(u.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`),ie(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`),ie(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),ie(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);let h=u.shape[2],p=u.shape[3];ie(c.shape[2]===h*p,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*p}, but got ${c.shape[2]}.`);let d=_5(l,u,n,a,o,i),v=ey(d,c,1,"valid",o);return f?pe(v,[v.shape[1],v.shape[2],v.shape[3]]):v}var Uft=ue({separableConv2d_:Wft});function Vft(r){let t={x:ee(r,"x","sign")};return ae.runKernel(Rj,t)}var Gft=ue({sign_:Vft});function Hft(r,e=-1){let t=ee(r,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);let n={logits:t},a={dim:e};return ae.runKernel(zj,n,a)}var jft=ue({softmax_:Hft});function Kft(r){ie(r.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${r.dtype}.`);let e={input:r};return ae.runKernel(Jat,e)}var W5=ue({fft_:Kft});function Xft(r){ie(r.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${r.dtype}.`);let e={input:r};return ae.runKernel(eit,e)}var DS=ue({ifft_:Xft});function Yft(r){let e=r.shape[r.shape.length-1],t=r.size/e,n;if(e<=2){let a=pe(r,[t,e]);n=DS(a)}else{let a=[t,2*(e-1)],i=pe(Kg(r),[t,e]),o=pe(VS(r),[t,e]),s=Xg(so(i,[0,1],[t,e-2]),1),u=ze(Xg(so(o,[0,1],[t,e-2]),1),hn(-1)),c=Op([i,s],1),l=Op([o,u],1),f=pe(zl(c,l),[a[0],a[1]]);n=DS(f)}if(n=Kg(n),r.rank===3&&r.shape[0]!==0){let a=n,i=r.shape[0];n=pe(n,[i,n.shape[0]/i,n.shape[1]]),a.dispose()}return n}var Jft=ue({irfft_:Yft});function Zft(r,e){ie(r.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${r.dtype}`);let t=r.shape[r.shape.length-1],n=r.size/t,a;if(e!=null&&e<t){let d=r.shape.map(v=>0),m=r.shape.map(v=>v);m[r.shape.length-1]=e,a=so(r,d,m),t=e}else if(e!=null&&e>t){let d=r.shape.map(m=>m);d[r.shape.length-1]=e-t,a=Op([r,Fp(d)],r.shape.length-1),t=e}else a=r;let i=_r(a),o=pe(zl(a,i),[n,t]),s=W5(o),u=Math.floor(t/2)+1,c=Kg(s),l=VS(s),f=Hg(c,[u,t-u],c.shape.length-1),h=Hg(l,[u,t-u],l.shape.length-1),p=a.shape.slice();return p[a.shape.length-1]=u,pe(zl(f[0],h[0]),p)}var Qft=ue({rfft_:Zft});function eht(r,e){let t=ee(r,"a","squaredDifference"),n=ee(e,"b","squaredDifference");[t,n]=pn(t,n),Ur(t.shape,n.shape);let a={a:t,b:n},i={};return ae.runKernel($j,a,i)}var tht=ue({squaredDifference_:eht});function rht(r,e){let t=ee(r,"x","squeeze","string_or_numeric");return pe(t,Nit(t.shape,e).newShape)}var nht=ue({squeeze_:rht});function aht(r,e,t,n,a=0,i=0,o=0,s=0,u=0){let l={x:ee(r,"x","stridedSlice","string_or_numeric")},f={begin:e,end:t,strides:n,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return ae.runKernel(yit,l,f)}var iht=ue({stridedSlice_:aht});function oht(r){let t={x:ee(r,"x","tan","float32")};return ae.runKernel(Uj,t)}var sht=ue({tan_:oht});function uht(r,e,t){let n=ee(r,"tensor","tensorScatterupdate"),a=ee(e,"indices","tensorScatterupdate","int32"),i=ee(t,"updates","tensorScatterupdate");if(fct(i,a,n.shape),n.dtype!==i.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${n.dtype} and ${i.dtype}.`);let o={tensor:n,indices:a,updates:i},s={};return ae.runKernel(mit,o,s)}var jEt=ue({tensorScatterUpdate_:uht});function cht(r,e=1,t=!0){let n=ee(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");let a=n.shape[n.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>a)throw new Error(`'k' passed to topk() must be <= the last dimension (${a}) but got ${e}`);let i={x:n},o={k:e,sorted:t},[s,u]=ae.runKernel(bit,i,o);return{values:s,indices:u}}var lht=ue({topk_:cht});function fht(r,e=0){let t=ee(r,"x","unique","string_or_numeric");ie(t.rank>0,()=>"The input tensor must be at least 1D");let n={x:t},a={axis:e},[i,o]=ae.runKernel(wit,n,a);return{values:i,indices:o}}var hht=ue({unique_:fht});function pht(r,e,t=!1,n=!1){let a=ee(r,"images","resizeBilinear");ie(a.rank===3||a.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${a.rank}.`),ie(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),ie(n===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=a,o=!1;a.rank===3&&(o=!0,i=pe(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let[]=e,s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},c=ae.runKernel(Sj,s,u);return o?pe(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var dht=ue({resizeBilinear_:pht});function vht(r,e,t=!1,n=!1){let a=ee(r,"images","resizeNearestNeighbor");ie(a.rank===3||a.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${a.rank}.`),ie(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),ie(a.dtype==="float32"||a.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),ie(n===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=a,o=!1;a.rank===3&&(o=!0,i=pe(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let[]=e,s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},c=ae.runKernel(kj,s,u);return o?pe(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var mht=ue({resizeNearestNeighbor_:vht});var uH;(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(uH||(uH={}));var _S=class extends IS{minimize(e,t=!1,n){let{value:a,grads:i}=this.computeGradients(e,n);if(n!=null){let o=n.map(s=>({name:s.name,tensor:i[s.name]}));this.applyGradients(o)}else this.applyGradients(i);return Z6(i),t?a:(a.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return Blt(e,t)}dispose(){this.iterations_!=null&&Z6(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:hn(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}};Object.defineProperty(_S,Symbol.hasInstance,{value:r=>r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null});var KEt=(()=>typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:r=>r())();var cH;(function(r){r[r.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",r[r.VALUE_ROWIDS=1]="VALUE_ROWIDS",r[r.ROW_LENGTHS=2]="ROW_LENGTHS",r[r.ROW_SPLITS=3]="ROW_SPLITS",r[r.ROW_LIMITS=4]="ROW_LIMITS",r[r.ROW_STARTS=5]="ROW_STARTS"})(cH||(cH={}));var ght=1.7580993408473768,yht=1.0507009873554805;function bht(r,e,t){let n=r.shape.slice();n[t]=1;let a=pe(e,n),i=CS(r,t,!0,!1),o=CS(r,t,!0,!0),s=ze(i,o);return ze(a,s)}function wht(r,e,t){let n=r.shape.length,a=n-t.length,i=m5(t,n),o=r;i!=null&&(o=oc(r,i));let s=o.shape.slice(),c=s.splice(n-t.length,t.length).reduce((h,p)=>h*p,1);s.push(c);let l=o.reshape(s),f=bht(l,e,a);if(f=f.reshape(o.shape),i!=null){let h=US(i);f=oc(f,h)}return f}var xht={kernelName:yj,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{axis:a}=t,i=[];return a==null?i=n.shape.map((o,s)=>s):typeof a=="number"?i=[a]:i=a,{x:()=>wht(n,r,i)}}};var kht={kernelName:LH,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Ur(t.shape,n.shape);return{a:()=>{let s=Wr(r,ct(n,"float32")),u=Sn(t.shape,a);return u.length>0?pe(Ot(s,u),t.shape):s},b:()=>{let s=ze(r,ct(t,"float32")),u=Sn(n.shape,a);u.length>0&&(s=pe(Ot(s,u),n.shape));let c=kn(n);return Ln(Wr(s,ct(c,"float32")))}}}};var Sht={kernelName:bj,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Wr(r,Ln(kn(t)))}}};var Nht={kernelName:Nj,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e,n=ze(Qg(t,6),Jg(t));return{x:()=>ze(r,ct(n,"float32"))}}};var Tht={kernelName:wj,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ze(r,ct(Jg(t),"float32"))}}};var Eht={kernelName:xj,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>pe(r,t.shape)}}};var Iht={kernelName:Sj,inputsToSave:["images"],gradFunc:(r,e,t)=>{let[n]=e,a={dy:r,images:n};return{images:()=>ae.runKernel(vit,a,t)}}};var Cht={kernelName:kj,inputsToSave:["images"],gradFunc:(r,e,t)=>{let[n]=e,a={dy:r,images:n};return{images:()=>ae.runKernel(dit,a,t)}}};var Aht={kernelName:Tj,gradFunc:(r,e,t)=>{let{dims:n}=t,a=uo(n,r.shape);return{x:()=>Xg(r,a)}}};var Dht={kernelName:Ej,gradFunc:r=>({x:()=>_r(r)})};var _ht={kernelName:Ij,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Ln(Wr(r,ze(ny(t,1.5),2)))}}};var Fht={kernelName:Cj,inputsToSave:["condition"],gradFunc:(r,e)=>{let[t]=e;return{condition:()=>ct(_r(t),"float32"),t:()=>ze(r,ct(t,r.dtype)),e:()=>ze(r,ct(JS(t),r.dtype))}}};var Rht={kernelName:Aj,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=Vl(t,hn(0)),a=hn(ght),i=hn(yht),o=ze(r,i),s=ze(ze(r,a),Ls(ct(t,"float32")));return Lo(n,o,s)}}}};var Oht={kernelName:Oj,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ze(r,ze(t,In(hn(1),t)))}}};var Pht={kernelName:Rj,gradFunc:r=>({x:()=>_r(r)})};var Mht={kernelName:_j,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ze(YS(ct(t,"float32")),r)}}};var Bht={kernelName:Fj,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ze(D5(ct(t,"float32")),r)}}};var Lht={kernelName:Dj,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{begin:a,size:i}=t,o=n.shape,[s,u]=hct(n,a,i),c=[];for(let l=0;l<r.rank;l++)c.push([s[l],o[l]-s[l]-u[l]]);return{x:()=>$5(r,c)}}};var qht={kernelName:zj,outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n]=e,{dim:a}=t,i=!0,o=ze(r,n);return{logits:()=>In(o,ze(Ot(o,[a],i),n))}}};var zht={kernelName:Pj,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ze(r,KS(t))}}};var lH={kernelName:Lj,gradFunc:(r,e,t)=>{let{blockShape:n,paddings:a}=t;return{x:()=>XS(r,n,a)}}};var fH={kernelName:qj,gradFunc:(r,e,t)=>{let{axis:n}=t;return{x:()=>Op(r,n)}}};var $ht={kernelName:Mj,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Wr(r,ze(Bs(ct(t,"float32")),2))}}};var Wht={kernelName:git,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ze(r,ze(ct(t,"float32"),2))}}};var Uht={kernelName:$j,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=hn(2);return{a:()=>ze(r,ze(a,In(t,n))),b:()=>ze(r,ze(a,In(n,t)))}}};var Vht={kernelName:Kj,gradFunc:r=>({x:()=>_r(r)})};var Ght={kernelName:Wj,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Ur(t.shape,n.shape);return{a:()=>{let s=r,u=Sn(t.shape,a);return u.length>0&&(s=Ot(s,u)),pe(s,t.shape)},b:()=>{let s=r,u=Sn(n.shape,a);return u.length>0&&(s=Ot(s,u)),pe(Ln(s),n.shape)}}}};var Hht={kernelName:Bj,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,a=n.shape.slice(),{axis:i}=t;uo(i,n.shape).forEach(c=>{a[c]=1});let s=pe(r,a),u=ze(s,ty(n.shape,"float32"));return{x:()=>u}}};var jht={kernelName:Uj,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Wr(r,kn(YS(t)))}}};var Kht={kernelName:Vj,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e;return{x:()=>ze(In(hn(1),kn(t)),r)}}};var Xht={kernelName:PS,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{reps:a}=t;return{x:()=>{let o=_r(n);if(n.rank===1)for(let s=0;s<a[0];++s)o=yi(o,so(r,[s*n.shape[0]],[n.shape[0]]));else if(n.rank===2)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)o=yi(o,so(r,[s*n.shape[0],u*n.shape[1]],[n.shape[0],n.shape[1]]));else if(n.rank===3)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)for(let c=0;c<a[2];++c)o=yi(o,so(r,[s*n.shape[0],u*n.shape[1],c*n.shape[2]],[n.shape[0],n.shape[1],n.shape[2]]));else if(n.rank===4)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)for(let c=0;c<a[2];++c)for(let l=0;l<a[3];++l)o=yi(o,so(r,[s*n.shape[0],u*n.shape[1],c*n.shape[2],l*n.shape[3]],[n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${n.rank} tensors yet.`);return o}}}};var Yht={kernelName:Bg,gradFunc:(r,e,t)=>{let n=t,{perm:a}=n,i=US(a);return{x:()=>oc(r,i)}}};var Jht={kernelName:Gj,gradFunc:(r,e,t)=>{let n=t,{axis:a}=n;return{value:()=>GS(r,a)}}};var Zht={kernelName:Hj,inputsToSave:["segmentIds"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Qht(r,t)}}};function Qht(r,e){let t=z5(e,_r(e)),n=P5(r,t),a=Zg(e,hn(0,"int32")),i=n.rank-a.rank;for(let s=0;s<i;++s)a=O5(a,s+1);a=_p(a,ty(n.shape,"bool"));let o=_r(n);return Lo(a,n,o)}var ept={kernelName:jj,gradFunc:r=>({x:()=>_r(r)})};var tpt=[c5,pot,dot,got,yot,wot,xot,kot,Not,Tot,Eot,Iot,Pot,Lot,zot,Wot,Uot,Vot,Got,Zot,Qot,tst,ost,ast,fst,pst,vst,Est,_st,Fst,kht,Rst,Pst,Mst,Bst,Lst,zst,qst,Ust,Hst,jst,Kst,Xst,Yst,Jst,Qst,eut,tut,rut,iut,tH,tH,uut,fut,dut,vut,mut,gut,but,xut,kut,Sut,Nut,Tut,Iut,rH,rH,Dut,_ut,xht,Sht,Nht,Tht,Eht,Iht,Cht,Aht,Dht,_ht,Fht,Rht,Oht,Pht,Mht,Bht,Lht,qht,zht,lH,lH,fH,fH,$ht,Uht,Wht,Vht,Ght,Hht,jht,Kht,Xht,Yht,Jht,Zht,ept];for(let r of tpt)Pit(r);ce().prototype.abs=function(){return this.throwIfDisposed(),Mo(this)};ce().prototype.acos=function(){return this.throwIfDisposed(),vct(this)};ce().prototype.acosh=function(){return this.throwIfDisposed(),gct(this)};ce().prototype.add=function(r){return this.throwIfDisposed(),yi(this,r)};ce().prototype.all=function(r,e){return this.throwIfDisposed(),bct(this,r,e)};ce().prototype.any=function(r,e){return this.throwIfDisposed(),xct(this,r,e)};ce().prototype.argMax=function(r){return this.throwIfDisposed(),Sct(this,r)};ce().prototype.argMin=function(r){return this.throwIfDisposed(),Tct(this,r)};ce().prototype.asScalar=function(){return this.throwIfDisposed(),ie(this.size===1,()=>"The array must have only 1 element."),pe(this,[])};ce().prototype.asType=function(r){return this.throwIfDisposed(),ct(this,r)};ce().prototype.as1D=function(){return this.throwIfDisposed(),pe(this,[this.size])};ce().prototype.as2D=function(r,e){return this.throwIfDisposed(),pe(this,[r,e])};ce().prototype.as3D=function(r,e,t){return this.throwIfDisposed(),pe(this,[r,e,t])};ce().prototype.as4D=function(r,e,t,n){return this.throwIfDisposed(),pe(this,[r,e,t,n])};ce().prototype.as5D=function(r,e,t,n,a){return this.throwIfDisposed(),pe(this,[r,e,t,n,a])};ce().prototype.asin=function(){return this.throwIfDisposed(),Ict(this)};ce().prototype.asinh=function(){return this.throwIfDisposed(),Act(this)};ce().prototype.atan=function(){return this.throwIfDisposed(),_ct(this)};ce().prototype.atan2=function(r){return this.throwIfDisposed(),Rct(this,r)};ce().prototype.atanh=function(){return this.throwIfDisposed(),Pct(this)};ce().prototype.avgPool=function(r,e,t,n){return this.throwIfDisposed(),A5(this,r,e,t,n)};ce().prototype.batchToSpaceND=function(r,e){return this.throwIfDisposed(),XS(this,r,e)};ce().prototype.batchNorm=function(r,e,t,n,a){return this.throwIfDisposed(),Vct(this,r,e,t,n,a)};ce().prototype.broadcastTo=function(r){return this.throwIfDisposed(),zg(this,r)};ce().prototype.cast=function(r){return this.throwIfDisposed(),ct(this,r)};ce().prototype.ceil=function(){return this.throwIfDisposed(),Hct(this)};ce().prototype.clipByValue=function(r,e){return this.throwIfDisposed(),Xct(this,r,e)};ce().prototype.concat=function(r,e){return this.throwIfDisposed(),r instanceof Xn&&(r=[r]),Op([this,...r],e)};ce().prototype.conv1d=function(r,e,t,n,a,i){return this.throwIfDisposed(),Jct(this,r,e,t,n,a,i)};ce().prototype.conv2dTranspose=function(r,e,t,n,a){return this.throwIfDisposed(),Qct(this,r,e,t,n,a)};ce().prototype.conv2d=function(r,e,t,n,a,i){return this.throwIfDisposed(),ey(this,r,e,t,n,a,i)};ce().prototype.cos=function(){return this.throwIfDisposed(),YS(this)};ce().prototype.cosh=function(){return this.throwIfDisposed(),D5(this)};ce().prototype.cumprod=function(r,e,t){return this.throwIfDisposed(),CS(this,r,e,t)};ce().prototype.cumsum=function(r,e,t){return this.throwIfDisposed(),g5(this,r,e,t)};ce().prototype.depthToSpace=function(r,e){return this.throwIfDisposed(),alt(this,r,e)};ce().prototype.depthwiseConv2d=function(r,e,t,n,a,i){return this.throwIfDisposed(),_5(this,r,e,t,n,a,i)};ce().prototype.dilation2d=function(r,e,t,n,a){return this.throwIfDisposed(),slt(this,r,e,t,n,a)};ce().prototype.divNoNan=function(r){return this.throwIfDisposed(),clt(this,r)};ce().prototype.div=function(r){return this.throwIfDisposed(),Wr(this,r)};ce().prototype.dot=function(r){return this.throwIfDisposed(),flt(this,r)};ce().prototype.elu=function(){return this.throwIfDisposed(),plt(this)};ce().prototype.equal=function(r){return this.throwIfDisposed(),HS(this,r)};ce().prototype.erf=function(){return this.throwIfDisposed(),vlt(this)};ce().prototype.euclideanNorm=function(r,e){return this.throwIfDisposed(),wlt(this,r,e)};ce().prototype.exp=function(){return this.throwIfDisposed(),Ls(this)};ce().prototype.expandDims=function(r){return this.throwIfDisposed(),O5(this,r)};ce().prototype.expm1=function(){return this.throwIfDisposed(),Slt(this)};ce().prototype.fft=function(){return this.throwIfDisposed(),W5(this)};ce().prototype.flatten=function(){return this.throwIfDisposed(),pe(this,[this.size])};ce().prototype.floor=function(){return this.throwIfDisposed(),S5(this)};ce().prototype.floorDiv=function(r){return this.throwIfDisposed(),l5(this,r)};ce().prototype.gather=function(r,e,t){return this.throwIfDisposed(),P5(this,r,e,t)};ce().prototype.greaterEqual=function(r){return this.throwIfDisposed(),Zg(this,r)};ce().prototype.greater=function(r){return this.throwIfDisposed(),Vl(this,r)};ce().prototype.ifft=function(){return this.throwIfDisposed(),DS(this)};ce().prototype.irfft=function(){return this.throwIfDisposed(),Jft(this)};ce().prototype.isFinite=function(){return this.throwIfDisposed(),Elt(this)};ce().prototype.isInf=function(){return this.throwIfDisposed(),Clt(this)};ce().prototype.isNaN=function(){return this.throwIfDisposed(),Dlt(this)};ce().prototype.leakyRelu=function(r){return this.throwIfDisposed(),Flt(this,r)};ce().prototype.lessEqual=function(r){return this.throwIfDisposed(),Qg(this,r)};ce().prototype.less=function(r){return this.throwIfDisposed(),k5(this,r)};ce().prototype.localResponseNormalization=function(r,e,t,n){return this.throwIfDisposed(),Olt(this,r,e,t,n)};ce().prototype.logSigmoid=function(){return this.throwIfDisposed(),zlt(this)};ce().prototype.logSoftmax=function(r){return this.throwIfDisposed(),Wlt(this,r)};ce().prototype.logSumExp=function(r,e){return this.throwIfDisposed(),Vlt(this,r,e)};ce().prototype.log=function(){return this.throwIfDisposed(),ry(this)};ce().prototype.log1p=function(){return this.throwIfDisposed(),Mlt(this)};ce().prototype.logicalAnd=function(r){return this.throwIfDisposed(),_p(this,r)};ce().prototype.logicalNot=function(){return this.throwIfDisposed(),JS(this)};ce().prototype.logicalOr=function(r){return this.throwIfDisposed(),L5(this,r)};ce().prototype.logicalXor=function(r){return this.throwIfDisposed(),Klt(this,r)};ce().prototype.matMul=function(r,e,t){return this.throwIfDisposed(),za(this,r,e,t)};ce().prototype.maxPool=function(r,e,t,n){return this.throwIfDisposed(),q5(this,r,e,t,n)};ce().prototype.max=function(r,e){return this.throwIfDisposed(),Ll(this,r,e)};ce().prototype.maximum=function(r){return this.throwIfDisposed(),z5(this,r)};ce().prototype.mean=function(r,e){return this.throwIfDisposed(),Zlt(this,r,e)};ce().prototype.min=function(r,e){return this.throwIfDisposed(),AS(this,r,e)};ce().prototype.minimum=function(r){return this.throwIfDisposed(),eft(this,r)};ce().prototype.mirrorPad=function(r,e){return this.throwIfDisposed(),rft(this,r,e)};ce().prototype.mod=function(r){return this.throwIfDisposed(),aft(this,r)};ce().prototype.mul=function(r){return this.throwIfDisposed(),ze(this,r)};ce().prototype.neg=function(){return this.throwIfDisposed(),Ln(this)};ce().prototype.norm=function(r,e,t){return this.throwIfDisposed(),R5(this,r,e,t)};ce().prototype.notEqual=function(r){return this.throwIfDisposed(),oft(this,r)};ce().prototype.oneHot=function(r,e=1,t=0){return this.throwIfDisposed(),cct(this,r,e,t)};ce().prototype.onesLike=function(){return this.throwIfDisposed(),uft(this)};ce().prototype.pad=function(r,e){return this.throwIfDisposed(),$5(this,r,e)};ce().prototype.pool=function(r,e,t,n,a,i){return this.throwIfDisposed(),pft(this,r,e,t,n,a,i)};ce().prototype.pow=function(r){return this.throwIfDisposed(),ny(this,r)};ce().prototype.prelu=function(r){return this.throwIfDisposed(),vft(this,r)};ce().prototype.prod=function(r,e){return this.throwIfDisposed(),gft(this,r,e)};ce().prototype.reciprocal=function(){return this.throwIfDisposed(),Fft(this)};ce().prototype.relu=function(){return this.throwIfDisposed(),Oft(this)};ce().prototype.relu6=function(){return this.throwIfDisposed(),Mft(this)};ce().prototype.reshapeAs=function(r){return this.throwIfDisposed(),pe(this,r.shape)};ce().prototype.reshape=function(r){return this.throwIfDisposed(),pe(this,r)};ce().prototype.resizeBilinear=function(r,e,t){return this.throwIfDisposed(),dht(this,r,e,t)};ce().prototype.resizeNearestNeighbor=function(r,e,t){return this.throwIfDisposed(),mht(this,r,e,t)};ce().prototype.reverse=function(r){return this.throwIfDisposed(),Xg(this,r)};ce().prototype.rfft=function(){return this.throwIfDisposed(),Qft(this)};ce().prototype.round=function(){return this.throwIfDisposed(),qft(this)};ce().prototype.rsqrt=function(){return this.throwIfDisposed(),y5(this)};ce().prototype.selu=function(){return this.throwIfDisposed(),$ft(this)};ce().prototype.separableConv2d=function(r,e,t,n,a,i){return this.throwIfDisposed(),Uft(this,r,e,t,n,a,i)};ce().prototype.sigmoid=function(){return this.throwIfDisposed(),KS(this)};ce().prototype.sign=function(){return this.throwIfDisposed(),Gft(this)};ce().prototype.sin=function(){return this.throwIfDisposed(),d5(this)};ce().prototype.sinh=function(){return this.throwIfDisposed(),v5(this)};ce().prototype.slice=function(r,e){return this.throwIfDisposed(),so(this,r,e)};ce().prototype.softmax=function(r){return this.throwIfDisposed(),jft(this,r)};ce().prototype.softplus=function(){return this.throwIfDisposed(),B5(this)};ce().prototype.spaceToBatchND=function(r,e){return this.throwIfDisposed(),WS(this,r,e)};ce().prototype.split=function(r,e){return this.throwIfDisposed(),Hg(this,r,e)};ce().prototype.sqrt=function(){return this.throwIfDisposed(),Bs(this)};ce().prototype.square=function(){return this.throwIfDisposed(),kn(this)};ce().prototype.squaredDifference=function(r){return this.throwIfDisposed(),tht(this,r)};ce().prototype.squeeze=function(r){return this.throwIfDisposed(),nht(this,r)};ce().prototype.stack=function(r,e){this.throwIfDisposed();let t=r instanceof Xn?[this,r]:[this,...r];return GS(t,e)};ce().prototype.step=function(r){return this.throwIfDisposed(),Jg(this,r)};ce().prototype.stridedSlice=function(r,e,t,n,a,i,o,s){return this.throwIfDisposed(),iht(this,r,e,t,n,a,i,o,s)};ce().prototype.sub=function(r){return this.throwIfDisposed(),In(this,r)};ce().prototype.sum=function(r,e){return this.throwIfDisposed(),Ot(this,r,e)};ce().prototype.tan=function(){return this.throwIfDisposed(),sht(this)};ce().prototype.tanh=function(){return this.throwIfDisposed(),zct(this)};ce().prototype.tile=function(r){return this.throwIfDisposed(),b5(this,r)};ce().prototype.toBool=function(){return this.throwIfDisposed(),ct(this,"bool")};ce().prototype.toFloat=function(){return this.throwIfDisposed(),ct(this,"float32")};ce().prototype.toInt=function(){return this.throwIfDisposed(),ct(this,"int32")};ce().prototype.topk=function(r,e){return this.throwIfDisposed(),lht(this,r,e)};ce().prototype.transpose=function(r){return this.throwIfDisposed(),oc(this,r)};ce().prototype.unique=function(r){return this.throwIfDisposed(),hht(this,r)};ce().prototype.unsortedSegmentSum=function(r,e){return this.throwIfDisposed(),w5(this,r,e)};ce().prototype.unstack=function(r){return this.throwIfDisposed(),N5(this,r)};ce().prototype.where=function(r,e){return this.throwIfDisposed(),Lo(r,this,e)};ce().prototype.zerosLike=function(){return this.throwIfDisposed(),_r(this)};var rpt="4.19.0";var npt={"tfjs-core":lS.version_core,"tfjs-backend-cpu":pS.version_cpu,"tfjs-backend-webgl":dS.version_webgl,"tfjs-data":hH.version_data,"tfjs-layers":fS.version_layers,"tfjs-converter":hS.version_converter,tfjs:rpt};$a.data=Dat;$a.version=npt;Object.keys(lS).forEach(function(r){r!=="default"&&!$a.hasOwnProperty(r)&&Object.defineProperty($a,r,{enumerable:!0,get:function(){return lS[r]}})});Object.keys(fS).forEach(function(r){r!=="default"&&!$a.hasOwnProperty(r)&&Object.defineProperty($a,r,{enumerable:!0,get:function(){return fS[r]}})});Object.keys(hS).forEach(function(r){r!=="default"&&!$a.hasOwnProperty(r)&&Object.defineProperty($a,r,{enumerable:!0,get:function(){return hS[r]}})});Object.keys(pS).forEach(function(r){r!=="default"&&!$a.hasOwnProperty(r)&&Object.defineProperty($a,r,{enumerable:!0,get:function(){return pS[r]}})});Object.keys(dS).forEach(function(r){r!=="default"&&!$a.hasOwnProperty(r)&&Object.defineProperty($a,r,{enumerable:!0,get:function(){return dS[r]}})})});var Hl=O((YEt,V5)=>{var{argmin:apt,distance:ipt,isArray:opt,isDataFrame:U5,isNumber:spt,isSeries:upt,shape:cpt}=Mt(),iy=Mp(),lpt=new Function("try { return this === window } catch(e) { return false }");function fpt(r){return Bp(r)?r.shape.length===2:U5(r)?!0:opt(r)&&cpt(r).length===2}function Bp(r){return r instanceof iy.Tensor}function hpt(r){return spt(r)&&parseInt(r)===r&&r>=0}function ppt(r,e){return iy.tidy(()=>{Bp(r)&&(r=r.arraySync()),Bp(e)&&(e=e.arraySync());let t=[],n=e.slice();return r.forEach(a=>{let i=apt(n.map(o=>ipt(a,o)));t.push(n[i]),n.splice(i,1)}),t.concat(n)})}function dpt(r){return iy.tidy(()=>((U5(r)||upt(r))&&(r=r.values),Bp(r)||(r=iy.tensor(r)),r.div(r.abs())))}V5.exports={isBrowser:lpt,isMatrix:fpt,isTFTensor:Bp,isWholeNumber:hpt,orderCentroids:ppt,sign:dpt}});var sN=O((JEt,j5)=>{var{assert:iN,flatten:G5,isDataFrame:uc,isEqual:oN,isSeries:cc,isUndefined:vpt,shape:jl}=Mt(),{isTFTensor:lc,sign:mpt}=Hl(),co=Mp();function gpt(r,e){return lc(r)&&(r=r.arraySync()),(uc(r)||cc(r))&&(r=r.values),lc(e)&&(e=e.arraySync()),(uc(e)||cc(e))&&(e=e.values),iN(oN(jl(r),jl(e)),"`yPred` and `yTrue` must have the same shape!"),co.tidy(()=>co.tensor(r).sub(co.tensor(e)).pow(2).sum().arraySync())}function ypt(r,e){lc(r)&&(r=r.arraySync()),(uc(r)||cc(r))&&(r=r.values),lc(e)&&(e=e.arraySync()),(uc(e)||cc(e))&&(e=e.values),iN(oN(jl(r),jl(e)),"`yPred` and `yTrue` must have the same shape!");let t=G5(r),n=G5(e),a=0;return t.forEach((i,o)=>{i===n[o]&&a++}),a/t.length}function H5(r,e,t){return co.tidy(()=>{lc(r)&&(r=r.arraySync()),(uc(r)||cc(r))&&(r=r.values),lc(e)&&(e=e.arraySync()),(uc(e)||cc(e))&&(e=e.values),vpt(t)&&(t=r),lc(t)&&(t=t.arraySync()),(uc(t)||cc(t))&&(t=t.values),typeof t=="number"&&(t=[t]),iN(oN(jl(r),jl(e)),"`yTrue` and `yPred` must have the same shape!"),r=co.tensor(r),e=co.tensor(e),t=co.tensor(t);let n=r.sub(e).pow(2).sum(),a=r.sub(t.mean()).pow(2).sum();return co.scalar(1).sub(n.div(a)).arraySync()})}function bpt(r,e,t){return co.tidy(()=>{let n=co.scalar(H5(r,e,t));return mpt(n).mul(n.abs().sqrt()).arraySync()})}j5.exports={sse:gpt,accuracy:ypt,rSquared:H5,rScore:bpt}});var lo=O((ZEt,K5)=>{K5.exports={shouldIgnoreNaNValues:!0}});var Kl=O((QEt,Y5)=>{var{assert:wpt,flatten:xpt,isArray:kpt,isDataFrame:Spt,isNumber:Npt,isSeries:Tpt}=Mt();function X5(r){if(Spt(r)||Tpt(r))return X5(r.values);wpt(kpt(r),"The `containsOnlyNumbers` function only works on arrays, Series, and DataFrames!");let e=xpt(r);for(let t=0;t<e.length;t++)if(!Npt(e[t]))return!1;return!0}Y5.exports=X5});var cN=O((eIt,J5)=>{var{dropMissing:Ept,flatten:Ipt,isArray:Cpt,isDataFrame:Apt,isSeries:Dpt}=Mt();function uN(r){return typeof r=="number"?r===0||r===1:Apt(r)||Dpt(r)?uN(r.values):Cpt(r)?r.length===0?!1:Ept(Ipt(r)).every(t=>uN(t)):!1}J5.exports=uN});var sK=O((tIt,oK)=>{var{abs:Z5,apply:Q5,assert:eK,clamp:_pt,copy:Fpt,divide:Rpt,dropNaN:Opt,flatten:Ppt,isArray:Mpt,isDataFrame:Bpt,isNumber:tK,isSeries:Lpt,max:rK,median:nK,min:qpt,sort:zpt,subtract:aK}=Mt(),$pt=lo(),Wpt=Kl(),Upt=cN();function iK(r,e){if(Bpt(r)||Lpt(r)){let u=r.copy();return u._values=iK(u._values,e),u}if(eK(Mpt(r),"The `clipOutliers` function only works on arrays, Series, and DataFrames!"),e=e||5,eK(tK(e),"Any `maxScore` value passed into the `clipOutliers` function must be a number!"),!$pt.shouldIgnoreNaNValues&&!Wpt(r))return Q5(r,()=>NaN);let t=Ppt(r),n=Opt(t);if(Upt(n)||n.length===0)return r;let a=nK(n),i=nK(Z5(aK(n,a))),o=!1;if(i===0){let u=zpt(Fpt(n)),c=u.filter(p=>p<a),l=u.filter(p=>p>a),f=a,h=a;if(c.length>0&&(f=rK(c)),l.length>0&&(h=qpt(l)),i=(h-f)/2,i===0)return r;o=(a-f)/i>e||(h-a)/i>e}return rK(Rpt(Z5(aK(n,a)),i))>e||o?Q5(r,u=>tK(u)?_pt(u,a-e*i,a+e*i):u):r}oK.exports=iK});var fN=O((rIt,vK)=>{var{assert:uK,dropNaN:cK,isArray:lK,isSeries:fK,mean:hK,shape:pK,variance:dK}=Mt(),Vpt=lo();function lN(r,e){if(fK(r))return lN(r.values,e);if(fK(e))return lN(r,e.values);uK(lK(r)&&lK(e)&&pK(r).length===1&&pK(e).length===1,"The `cohensd` function only works on 1-dimensional arrays and Series!"),uK(r.length===e.length,"Two arrays or Series passed into the `cohensd` function must have the same length!"),Vpt.shouldIgnoreNaNValues&&(r=cK(r),e=cK(e));try{let t=hK(r),n=hK(e),a=Math.sqrt((dK(r)+dK(e))/2);return(t-n)/a}catch{return NaN}}vK.exports=lN});var bK=O((nIt,yK)=>{var{assert:mK,DataFrame:Gpt,isArray:Hpt,isSeries:jpt,shape:Kpt,zeros:Xpt}=Mt();function gK(r){if(jpt(r)){let n=new Gpt(gK(r.values));return n.index=r.index.slice(),n.columns=r.index.slice(),n}mK(Hpt(r),"The `diagonalize` function only works on 1-dimensional arrays and Series!");let e=Kpt(r);mK(e.length===1,"The `diagonalize` function only works on 1-dimensional arrays and Series!");let t=Xpt([e[0],e[0]]);return r.forEach((n,a)=>t[a][a]=n),t}yK.exports=gK});var vN=O((aIt,SK)=>{var{assert:hN,clamp:Ypt,correl:wK,DataFrame:oy,dropNaNPairwise:Jpt,isArray:xK,isDataFrame:sy,isJagged:kK,isUndefined:Zpt,ndarray:Qpt}=Mt(),edt=lo();function pN(r){let e="@jrc03c/js-data-science-helpers/get-correlation-matrix";return Object.defineProperty(r,e,{configurable:!1,enumerable:!1,writable:!1,value:Symbol.for(e)}),r}function dN(r,e){if(Zpt(e)&&(e=r),sy(r)){let n=new oy(dN(r.values,e));return n.index=r.columns.slice(),n.columns=sy(e)?e.columns.slice():new oy(e).columns.slice(),pN(n)}if(sy(e)){let n=new oy(dN(r,e.values));return n.index=sy(r)?r.columns.slice():new oy(r).columns.slice(),n.columns=e.columns.slice(),pN(n)}hN(xK(r)&&xK(e),"The `getCorrelationMatrix` function only works on 2-dimensional arrays and DataFrames!"),hN(!kK(r)&&!kK(e),"The `getCorrelationMatrix` function only works on non-jagged 2-dimensional arrays and DataFrames!"),hN(r.length===e.length,'The dimensions of the matrices you passed into the `getCorrelationMatrix` function aren\'t compatible! ([shape(a).join(", ")] vs. [shape(b).join(", ")]) The function expects that you\'ll be comparing the columns of two matrices where the columns are all of the same length, so please make sure that the matrices are oriented accordingly.');let t=Qpt([r[0].length,e[0].length]);for(let n=0;n<r[0].length;n++){let a=r.map(i=>i[n]);for(let i=0;i<e[0].length;i++){let o=e.map(s=>s[i]);edt.shouldIgnoreNaNValues?t[n][i]=wK(...Jpt(a,o)):t[n][i]=wK(a,o)}}return pN(Ypt(t,-1,1))}SK.exports=dN});var mN=O((iIt,NK)=>{function tdt(r){try{let e="@jrc03c/js-data-science-helpers/get-correlation-matrix";return r[e]===Symbol.for(e)}catch{return!1}}NK.exports=tdt});var CK=O((oIt,IK)=>{var{DataFrame:gN,isArray:rdt,isDataFrame:uy,isNumber:TK,MathError:ndt,sort:adt}=Mt(),EK=vN(),idt=mN();function odt(r,e,t){t=Object.values(arguments).find(i=>TK(i))||1-1e-5;let n=(()=>{let i=Object.values(arguments).filter(o=>rdt(o)||uy(o));if(i.length===1){let o=i[0];if(idt(o))return uy(o)?o:new gN(o);{let s=EK(o,null);return uy(s)?s:new gN(s)}}if(i.length===2){let o=EK(i[0],i[1]);return uy(o)?o:new gN(o)}throw new ndt("You must pass 1 or 2 2-dimensional arrays or DataFrames into the `getHighlyCorrelatedColumns` function!")})(),a={};return n.values.forEach((i,o)=>{i.forEach((s,u)=>{if(TK(s)&&s>t){let c=n.index[o],l=n.columns[u];a[c]||(a[c]=[]),a[c].indexOf(l)<0&&a[c].push(l),a[l]||(a[l]=[]),a[l].indexOf(c)<0&&a[l].push(c)}})}),Object.keys(a).forEach(i=>{a[i]=adt(a[i])}),a}IK.exports=odt});var yN=O((sIt,DK)=>{var{dropNaN:sdt,isArray:udt,isDataFrame:cdt,isNumber:ldt,isSeries:fdt,pow:hdt,sqrt:pdt,sum:ddt}=Mt(),vdt=lo();function AK(r){return cdt(r)||fdt(r)?AK(r.values):ldt(r)?Math.abs(r):udt(r)?(vdt.shouldIgnoreNaNValues&&(r=sdt(r)),pdt(ddt(hdt(r,2)))):NaN}DK.exports=AK});var bN=O((uIt,OK)=>{var{assert:_K,DataFrame:mdt,isArray:gdt,isSeries:ydt,isString:bdt,isUndefined:FK,set:wdt,shape:xdt,sort:kdt}=Mt();function RK(){if(arguments.length===1&&ydt(arguments[0])){let{name:a,values:i}=arguments[0],o=RK(a,i),s=new mdt(o);return s.index=arguments[0].index.slice(),s}let[r,e]=arguments;_K(bdt(r),"When passing two arguments into the `getOneHotEncodings` function, the first argument must be a string representing the name of the variable being encoded!"),_K(gdt(e)&&xdt(e).length===1,"When passing two arguments into the `getOneHotEncodings` function, the second argument must be a 1-dimensional array!");let t={};return kdt(wdt(e)).filter(a=>typeof a!="number"||a.toString()!=="NaN").filter(a=>!FK(a)).map(a=>r+"_"+a).slice(0,-1).forEach(a=>{t[a]=e.map(i=>a===r+"_"+i?1:typeof i=="number"&&i.toString()==="NaN"?NaN:FK(i)?NaN:0)}),t}OK.exports=RK});var MK=O((cIt,PK)=>{var{count:Sdt}=Mt();function Ndt(r){return Sdt(r).map(t=>(t.percentage=t.count/r.length,t))}PK.exports=Ndt});var BK=O((lIt,Tdt)=>{Tdt.exports=[.5,.49601,.49202,.48803,.48405,.48006,.47608,.4721,.46812,.46414,.46017,.4562,.45224,.44828,.44433,.44038,.4364,.43251,.42858,.42465,.42074,.41683,.41294,.40905,.40517,.40129,.39743,.39358,.38974,.38591,.38209,.37828,.37448,.3707,.36693,.36317,.35942,.35569,.35197,.34827,.34458,.3409,.33724,.3336,.32997,.32636,.32276,.31918,.31561,.31207,.30854,.30503,.30153,.29806,.2946,.29116,.28774,.28434,.28096,.2776,.27425,.27093,.26763,.26435,.26109,.25785,.25463,.25143,.24825,.2451,.24196,.23885,.23576,.2327,.22965,.22663,.22363,.22065,.2177,.21476,.21186,.20897,.20611,.20327,.20045,.19766,.19489,.19215,.18943,.18673,.18406,.18141,.17879,.17619,.17361,.17106,.16853,.16602,.16354,.16109,.15866,.15625,.15386,.15151,.14917,.14686,.14457,.14231,.14007,.13786,.13567,.1335,.13136,.12924,.12714,.12507,.12302,.121,.119,.11702,.11507,.11314,.11123,.10935,.10749,.10565,.10383,.10204,.10027,.09853,.0968,.0951,.09342,.09176,.09012,.08851,.08692,.08534,.08379,.08226,.08076,.07927,.0778,.07636,.07493,.07353,.07215,.07078,.06944,.06811,.06681,.06552,.06426,.06301,.06178,.06057,.05938,.05821,.05705,.05592,.0548,.0537,.05262,.05155,.0505,.04947,.04846,.04746,.04648,.04551,.04457,.04363,.04272,.04182,.04093,.04006,.0392,.03836,.03754,.03673,.03593,.03515,.03438,.03362,.03288,.03216,.03144,.03074,.03005,.02938,.02872,.02807,.02743,.0268,.02619,.02559,.025,.02442,.02385,.0233,.02275,.02222,.02169,.02118,.02068,.02018,.0197,.01923,.01876,.01831,.01786,.01743,.017,.01659,.01618,.01578,.01539,.015,.01463,.01426,.0139,.01355,.01321,.01287,.01255,.01222,.01191,.0116,.0113,.01101,.01072,.01044,.01017,.0099,.00964,.00939,.00914,.00889,.00866,.00842,.0082,.00798,.00776,.00755,.00734,.00714,.00695,.00676,.00657,.00639,.00621,.00604,.00587,.0057,.00554,.00539,.00523,.00508,.00494,.0048,.00466,.00453,.0044,.00427,.00415,.00402,.00391,.00379,.00368,.00357,.00347,.00336,.00326,.00317,.00307,.00298,.00289,.0028,.00272,.00264,.00256,.00248,.0024,.00233,.00226,.00219,.00212,.00205,.00199,.00193,.00187,.00181,.00175,.00169,.00164,.00159,.00154,.00149,.00144,.00139,.00135,.00131,.00126,.00122,.00118,.00114,.00111,.00107,.00104,.001,97e-5,94e-5,9e-4,87e-5,84e-5,82e-5,79e-5,76e-5,74e-5,71e-5,69e-5,66e-5,64e-5,62e-5,6e-4,58e-5,56e-5,54e-5,52e-5,5e-4,48e-5,47e-5,45e-5,43e-5,42e-5,4e-4,39e-5,38e-5,36e-5,35e-5,34e-5,32e-5,31e-5,3e-4,29e-5,28e-5,27e-5,26e-5,25e-5,24e-5,23e-5,22e-5,22e-5,21e-5,2e-4,19e-5,19e-5,18e-5,17e-5,17e-5,16e-5,15e-5,15e-5,14e-5,14e-5,13e-5,13e-5,12e-5,12e-5,11e-5,11e-5,1e-4,1e-4,1e-4,9e-5,9e-5,8e-5,8e-5,8e-5,8e-5,7e-5,7e-5,7e-5,6e-5,6e-5,6e-5,6e-5,5e-5,5e-5,5e-5,5e-5,5e-5,4e-5,4e-5,4e-5,4e-5,4e-5,4e-5,3e-5,3e-5,3e-5,3e-5,3e-5,3e-5,3e-5,3e-5,2e-5,2e-5,2e-5,2e-5]});var xN=O((fIt,HK)=>{var{abs:LK,assert:Edt,dropNaNPairwise:Idt,flatten:cy,isArray:qK,isDataFrame:zK,isEqual:Cdt,isSeries:$K,mean:WK,remap:Adt,round:Ddt,shape:UK,sqrt:_dt,std:VK}=Mt(),Fdt=lo(),GK=BK();function Rdt(r){return LK(r)>4.1?0:GK[Ddt(Adt(LK(r),0,4.1,0,GK.length))]}function wN(r,e){if(zK(r)||$K(r))return wN(r.values,e);if(zK(e)||$K(e))return wN(r,e.values);Edt(qK(r)&&qK(e)&&Cdt(UK(r),UK(e)),"You must pass two identically-shaped arrays, Series, or DataFrames into the `pValue` function!");let[t,n]=Fdt.shouldIgnoreNaNValues?Idt(cy(r),cy(e)):[cy(r),cy(e)];if(t.length===0||n.length===0)return NaN;let a=WK(t),i=WK(n),o=VK(t),s=VK(n),u=t.length,c=n.length,l=(a-i)/_dt(o*o/u+s*s/c);return 2*Rdt(l)}HK.exports=wN});var JK=O((hIt,YK)=>{var{assert:kN,clamp:Odt,DataFrame:ly,dropNaNPairwise:Pdt,isArray:jK,isDataFrame:fy,isJagged:KK,isUndefined:Mdt,ndarray:Bdt}=Mt(),Ldt=lo(),XK=xN();function SN(r){let e="@jrc03c/js-data-science-helpers/get-p-value-matrix";return Object.defineProperty(r,e,{configurable:!1,enumerable:!1,writable:!1,value:Symbol.for(e)}),r}function NN(r,e){if(Mdt(e)&&(e=r),fy(r)){let n=new ly(NN(r.values,e));return n.index=r.columns.slice(),n.columns=fy(e)?e.columns.slice():new ly(e).columns.slice(),SN(n)}if(fy(e)){let n=new ly(NN(r,e.values));return n.index=fy(r)?r.columns.slice():new ly(r).columns.slice(),n.columns=e.columns.slice(),SN(n)}kN(jK(r)&&jK(e),"The `getPValueMatrix` function only works on 2-dimensional arrays and DataFrames!"),kN(!KK(r)&&!KK(e),"The `getPValueMatrix` function only works on non-jagged 2-dimensional arrays and DataFrames!"),kN(r.length===e.length,'The dimensions of the matrices you passed into the `getPValueMatrix` function aren\'t compatible! ([shape(a).join(", ")] vs. [shape(b).join(", ")]) The function expects that you\'ll be comparing the columns of two matrices where the columns are all of the same length, so please make sure that the matrices are oriented accordingly.');let t=Bdt([r[0].length,e[0].length]);for(let n=0;n<r[0].length;n++){let a=r.map(i=>i[n]);for(let i=0;i<e[0].length;i++){let o=e.map(s=>s[i]);Ldt.shouldIgnoreNaNValues?t[n][i]=XK(...Pdt(a,o)):t[n][i]=XK(a,o)}}return SN(Odt(t,0,1))}YK.exports=NN});var r8=O((pIt,t8)=>{var{assert:hy,intersect:qdt,isDataFrame:ZK,isSeries:QK,isUndefined:e8}=Mt(),Xl=class{constructor(e){let t=this;hy(e8(e)||e===Xl.DROP_NAN_MODE||e===Xl.DROP_MISSING_MODE,"The `mode` value passed into the `IndexMatcher` constructor must be undefined or one of [IndexMatcher.DROP_NAN_MODE, IndexMatcher.DROP_MISSING_MODE]! (By default, the mode is `Indexer.DROP_MISSING_MODE`.)"),t.mode=e8(e)?Xl.DROP_MISSING_MODE:e,t.index=null}fit(){let e=this,t=[];return Object.values(arguments).forEach(n=>{hy(ZK(n)||QK(n),"The `IndexMatcher` only works on Series and DataFrames! To drop NaN values in a pair-wise fashion from regular arrays, use the `dropNaNPairwise` function from the @jrc03c/js-math-tools library."),e.mode===Xl.DROP_MISSING_MODE?t.push(n.dropMissing().index):t.push(n.dropNaN().index)}),e.index=qdt(...t),e}transform(){let e=this;hy(!!e.index,"The IndexMatcher hasn't been fitted yet! Please call the `fit` method before calling the `transform` method.");let t=Object.values(arguments).map(n=>(hy(ZK(n)||QK(n),"The `IndexMatcher` only works on Series and DataFrames! To drop NaN values in a pair-wise fashion from regular arrays, use the `dropNaNPairwise` function from the @jrc03c/js-math-tools library."),n.get(e.index,null)));return t.length===1?t[0]:t}fitAndTransform(){return this.fit(...arguments).transform(...arguments)}},Lp=Xl;o0(Lp,"DROP_NAN_MODE","DROP_NAN_MODE"),o0(Lp,"DROP_MISSING_MODE","DROP_MISSING_MODE");t8.exports=Lp});var EN=O((vIt,s8)=>{var{assert:TN,isArray:zdt,isBoolean:$dt,isDataFrame:n8,isSeries:a8,int:Wdt,isNumber:Udt,isUndefined:i8,range:o8,set:Vdt,shape:Gdt,shuffle:Hdt}=Mt();s8.exports=function(){let e=Array.from(arguments),t=e.find(p=>$dt(p)),n=i8(t)?!0:t,a=e.find(p=>Udt(p)),i=i8(a)?.1:a;TN(i>0&&i<1,"`testSize` must be a number between 0 and 1 (exclusive on both ends)!");let o=e.filter(p=>zdt(p)||n8(p)||a8(p));TN(o.length>0,"You must pass at least one dataset into the `trainTestSplit` function!");let s=o.map(p=>Gdt(p)[0]);TN(Vdt(s).length===1,`All datasets passed into the \`trainTestSplit\` function must be the same length at their shallowest dimension! The lengths of your datasets, though, are: ${s.join(", ")}`);let u=[],c=n?Hdt(o8(0,s[0])):o8(0,s[0]),l=Wdt((1-i)*c.length),f=c.slice(0,l),h=c.slice(l);return o.forEach(p=>{if(n8(p))u.push(p.get(f,null)),u.push(p.get(h,null));else if(a8(p))u.push(p.get(f)),u.push(p.get(h));else{let d=[],m=[];p.forEach((v,g)=>{f.indexOf(g)>-1?d.push(v):m.push(v)}),u.push(d),u.push(m)}}),u}});var dy=O((mIt,p8)=>{var{add:jdt,argmin:Kdt,assert:Xdt,flatten:u8,isArray:Ydt,isDataFrame:c8,isEqual:Jdt,int:Zdt,isNumber:Qdt,isSeries:l8,normal:IN,pow:evt,random:tvt,range:rvt,scale:nvt,shape:py,subtract:avt,sum:ivt}=Mt(),ovt=EN();function CN(r,e){(c8(r)||l8(r))&&(r=r.values),(c8(e)||l8(e))&&(e=e.values),Xdt(Jdt(py(r),py(e)),"`yPred` and `yTrue` must have the same shape!");let t=u8(r),n=u8(e),a=0;return t.forEach((i,o)=>{i===n[o]&&a++}),a/t.length}function svt(r){test(`tests that the \`${r.name}\` model works correctly`,()=>{let e=IN([5,10]).map(f=>f.map(h=>h*100+IN()*100)),t=[],n=rvt(0,500).map(()=>{let f=Zdt(tvt()*e.length),h=e[f];return t.push(f),jdt(h,nvt(5,IN(py(h))))}),[a,i,o,s]=ovt(n,t),u=new r({k:e.length});u.fit(a),u.centroids=f8(e,u.centroids);let c=u.predict(a),l=u.predict(i);expect(CN(o,c)).toBeGreaterThan(.95),expect(CN(s,l)).toBeGreaterThan(.95)})}function uvt(r){return Ydt(r)&&py(r).length===2}function cvt(r){return Qdt(r)&&parseInt(r)===r&&r>=0}function f8(r,e){return r.map(t=>e[Kdt(e.map(n=>h8(t,n)))])}function h8(r,e){return ivt(evt(avt(r,e),2))}p8.exports={accuracy:CN,createGenericTest:svt,isMatrix:uvt,isWholeNumber:cvt,orderCentroids:f8,sse:h8}});var _N=O((gIt,g8)=>{var{add:d8,argmin:lvt,assert:fc,copy:fvt,distance:v8,divide:hvt,isDataFrame:pvt,isFunction:dvt,isUndefined:vy,normal:vvt,random:mvt,range:gvt,scale:yvt,shuffle:bvt,zeros:m8}=Mt(),{isMatrix:wvt,isWholeNumber:AN,sse:xvt}=dy(),DN=class{constructor(e){fc(typeof e=="object","`config` must be an object! See the documentation for more information about the properties that the `config` object can contain."),fc(AN(e.k),"`k` must be a whole number!"),fc(AN(e.maxIterations)||vy(e.maxIterations),"`maxIterations` must be a whole number or undefined!"),fc(AN(e.maxRestarts)||vy(e.maxRestarts),"`maxRestarts` must be a whole number or undefined!"),fc(typeof e.tolerance=="number"||vy(e.tolerance),"`tolerance` must be a number or undefined!");let t=this;t.k=e.k,t.maxRestarts=e.maxRestarts||25,t.maxIterations=e.maxIterations||100,t.tolerance=e.tolerance||1e-4,t.centroids=null}initializeCentroids(e){let t=this;return bvt(e).slice(0,t.k)}getFitStepFunction(e,t){let n=this;fc(wvt(e),"`x` must be a matrix!"),pvt(e)&&(e=e.values),vy(t)||fc(dvt(t),"If defined, `progress` must be a function!");let a=n.initializeCentroids(e),i={currentRestart:0,currentIteration:0,currentCentroids:a,bestCentroids:a,bestScore:-1/0,isFinished:!1};return function(){let s=n.predict(e,i.currentCentroids),u=[],c=m8(n.k);e.forEach((f,h)=>{let p=s[h];u[p]||(u[p]=m8(f.length)),u[p]=d8(u[p],f),c[p]++});let l=gvt(0,n.k).map(f=>c[f]===0?d8(i.currentCentroids[parseInt(mvt()*i.currentCentroids.length)],yvt(.001,vvt(i.currentCentroids[0].length))):hvt(u[f],c[f]));if(v8(i.currentCentroids,l)<n.tolerance?i.currentIteration=n.maxIterations-1:i.currentCentroids=l,t&&t((i.currentRestart+i.currentIteration/n.maxIterations)/n.maxRestarts,n),i.currentIteration++,i.currentIteration>=n.maxIterations){let f=n.score(e,i.currentCentroids);if(f>i.bestScore&&(i.bestScore=f,i.bestCentroids=fvt(i.currentCentroids)),i.currentIteration=0,i.currentRestart++,i.currentRestart>=n.maxRestarts)i.isFinished=!0,n.centroids=i.bestCentroids,t&&t(1,n);else{let h=n.initializeCentroids(e);i.currentCentroids=h}}return i}}fit(e,t){let n=this,a=n.getFitStepFunction(e,t),i;for(;!i||!i.isFinished;)i=a();return n}predict(e,t){if(t=t||this.centroids,!t)throw new Error("No centroids were provided to the `predict` method, and the K-Means model hasn't been fitted yet. Please either pass centroids as a second parameter to the `predict` method or run the `fit` method first!");return e.map(a=>lvt(t.map(i=>v8(a,i))))}score(e,t){let n=this;if(t=t||n.centroids,!t)throw new Error("No centroids were provided to the `score` method, and the K-Means model hasn't been fitted yet. Please either pass centroids as a second parameter to the `score` method or run the `fit` method first!");let i=n.predict(e,t).map(o=>t[o]);return-xvt(e,i)}};g8.exports=DN});var RN=O((yIt,w8)=>{var{argmin:kvt,distance:y8,divide:Svt,max:Nvt,random:b8}=Mt(),Tvt=_N(),FN=class extends Tvt{initializeCentroids(e){let t=this,n=[e[parseInt(b8()*e.length)]];for(;n.length<t.k;){let a=e.map(o=>y8(o,n[kvt(n.map(s=>y8(o,s)))])),i=Svt(a,Nvt(a));n.push(e[i.findIndex(o=>b8()<o)])}return n}};w8.exports=FN});var S8=O((bIt,k8)=>{var{assert:$o,isArray:Evt,isDataFrame:Ivt,isEqual:Cvt,isFunction:Avt,isUndefined:Yl,range:Dvt,shape:x8}=Mt(),{isMatrix:_vt,isWholeNumber:ON}=dy(),Fvt=RN(),PN=class{constructor(e){Yl(e)&&(e={}),$o(typeof e=="object","`config` must be an object! See the documentation for more information about the properties that the `config` object can contain."),Yl(e.ks)&&(e.ks=Dvt(1,16)),$o(Evt(e.ks),"`ks` must be an array of whole numbers!"),e.ks.forEach(n=>{$o(ON(n),"`ks` must be an array of whole numbers!")}),$o(ON(e.maxIterations)||Yl(e.maxIterations),"`maxIterations` must be a whole number or undefined!"),$o(ON(e.maxRestarts)||Yl(e.maxRestarts),"`maxRestarts` must be a whole number or undefined!"),$o(typeof e.tolerance=="number"||Yl(e.tolerance),"`tolerance` must be a number or undefined!");let t=this;t.ks=e.ks,t.maxRestarts=e.maxRestarts||25,t.maxIterations=e.maxIterations||100,t.tolerance=e.tolerance||1e-4,t.scoreStopRatio=e.scoreStopRatio||.85,t.modelClass=e.modelClass||Fvt,t.fittedModel=null}getFitStepFunction(e,t){let n=this;$o(_vt(e),"`x` must be a matrix!"),Ivt(e)&&(e=e.values),Yl(t)||$o(Avt(t),"If defined, `progress` must be a function!");let a={isFinished:!1,lastScore:-1/0,currentIndex:0};return function(){let o=n.ks[a.currentIndex],s=new n.modelClass({k:o,maxRestarts:10,maxIterations:20});s.fit(e,c=>t?t((a.currentIndex+c)/(n.ks.length+1)):null);let u=s.score(e);return u/a.lastScore>n.scoreStopRatio?(a.isFinished=!0,a.currentIndex--):(a.lastScore=u,a.currentIndex+1>=n.ks.length?a.isFinished=!0:a.currentIndex++),a.isFinished&&(n.fittedModel=new n.modelClass({k:n.ks[a.currentIndex],maxRestarts:n.maxRestarts,maxIterations:n.maxIterations}),n.fittedModel.fit(e,c=>t?t((n.ks.length+c)/(n.ks.length+1)):null),t&&t(1)),a}}fit(e,t){let n=this,a=n.getFitStepFunction(e,t),i;for(;!i||!i.isFinished;)i=a();return n}predict(e,t){return this.fittedModel.predict(e,t)}score(e,t){return this.fittedModel.score(e,t)}get k(){return this.fittedModel.k}set k(e){throw new Error("You can't set the k-value manually! It has to be set automatically via the `fit` method.")}get centroids(){return this.fittedModel.centroids}set centroids(e){let t=this;$o(Cvt(x8(e),x8(t.fittedModel.centroids)),"When assigning a new value to the `centroids` property, the new centroids must have the same shape as the old centroids!"),t.fittedModel.centroids=e}};k8.exports=PN});var T8=O((wIt,N8)=>{N8.exports={KMeansMeta:S8(),KMeansNaive:_N(),KMeansPlusPlus:RN(),helpers:dy()}});var MN=O((xIt,_8)=>{var{apply:Rvt,assert:Ovt,dropNaN:E8,isArray:Pvt,isDataFrame:Mvt,isSeries:Bvt,mean:I8,std:C8}=Mt(),A8=lo();function D8(r){if(Mvt(r)||Bvt(r)){let n=r.copy();return n.values=D8(n.values),n}Ovt(Pvt(r),"The `normalize` function only works on arrays, Series, and DataFrames!");let e=(()=>A8.shouldIgnoreNaNValues?I8(E8(r)):I8(r))(),t=(()=>A8.shouldIgnoreNaNValues?C8(E8(r)):C8(r))();return t===0?r:Rvt(r,n=>(n-e)/t)}_8.exports=D8});var LN=O((kIt,M8)=>{var{assert:Jl,dot:F8,isArray:R8,isSeries:BN,scale:Lvt,Series:qvt,shape:O8}=Mt(),P8=Kl();function my(r,e){if(BN(r)){if(BN(e))return new qvt(my(r.values,e.values));{let t=r.copy();return t.values=my(r.values,e),t}}if(BN(e)){let t=e.copy();return t.values=my(r,e.values),t}return Jl(R8(r),"`project` only works on vectors!"),Jl(R8(e),"`project` only works on vectors!"),Jl(P8(r),"`project` only works on vectors of numbers!"),Jl(P8(e),"`project` only works on vectors of numbers!"),Jl(O8(r).length===1,"`project` only works on vectors!"),Jl(O8(e).length===1,"`project` only works on vectors!"),Lvt(F8(e,r)/F8(e,e),e)}M8.exports=my});var $8=O((SIt,z8)=>{var{assert:B8,copy:zvt,DataFrame:$vt,divide:Wvt,isArray:Uvt,isDataFrame:Vvt,isJagged:Gvt,shape:Hvt,subtract:jvt,transpose:L8}=Mt(),Kvt=Kl(),Xvt=yN(),Yvt=LN();function q8(r){if(Vvt(r)){let a=new $vt(q8(r.values));return a.index=r.index.slice(),a.columns=r.columns.slice(),a}B8(Uvt(r)&&!Gvt(r)&&Hvt(r).length===2,"`orthonormalize` only works on matrices!"),B8(Kvt(r),"`orthonormalize` only works on matrices of numbers!");let e=L8(r),t=[];e.forEach(a=>{let i=zvt(a);t.forEach(o=>{i=jvt(i,Yvt(i,o))}),t.push(i)});let n=t.map(a=>Wvt(a,Xvt(a)));return L8(n)}z8.exports=q8});var qN=O((NIt,W8)=>{function Jvt(r){if(typeof r!="string")throw new Error("`text` must be a string!");r=r.trim();let e="",t=!1;for(let n=0;n<r.length;n++){let a=r[n];a.match(/[A-Za-z0-9]/g)?(e.length===0?e+=a.toLowerCase():t?e+=a.toUpperCase():e+=a,t=!1):!a.includes("'")&&!a.includes("\u2019")&&!a.includes("\u275C")&&(t=!0)}return e}W8.exports=Jvt});var V8=O((TIt,U8)=>{function Zvt(r,e){return e=e||"",r.split(`
`).map(t=>t.trim().length>0?e+t:t).join(`
`)}U8.exports=Zvt});var H8=O((EIt,G8)=>{G8.exports="!\"#%&'()*+,-./:;<=>?@[]^_`{|}~\xA0\xA1\xA4\xA7\xA9\xAA\xAB\xAE\xB0\xB1\xB6\xB7\xBA\xBB\xBF\xD7\xF7\u0254\u0300\u0301\u0302\u0303\u037E\u0387\u055A\u055B\u055C\u055D\u055E\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A\u066B\u066C\u066D\u06D4\u0700\u0701\u0702\u0703\u0704\u0705\u0706\u0707\u0708\u0709\u070A\u070B\u070C\u070D\u07F7\u07F8\u07F9\u0830\u0831\u0832\u0833\u0834\u0835\u0836\u0837\u0838\u0839\u083A\u083B\u083C\u083D\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04\u0F05\u0F06\u0F07\u0F08\u0F09\u0F0A\u0F0B\u0F0C\u0F0D\u0F0E\u0F0F\u0F10\u0F11\u0F12\u0F14\u0F3A\u0F3B\u0F3C\u0F3D\u0F85\u0FD0\u0FD1\u0FD2\u0FD3\u0FD4\u0FD9\u0FDA\u104A\u104B\u104C\u104D\u104E\u104F\u10FB\u1360\u1361\u1362\u1363\u1364\u1365\u1366\u1367\u1368\u1400\u166E\u169B\u169C\u16EB\u16EC\u16ED\u1735\u1736\u17D4\u17D5\u17D6\u17D8\u17D9\u17DA\u1800\u1801\u1802\u1803\u1804\u1805\u1806\u1807\u1808\u1809\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0\u1AA1\u1AA2\u1AA3\u1AA4\u1AA5\u1AA6\u1AA8\u1AA9\u1AAA\u1AAB\u1AAC\u1AAD\u1B5A\u1B5B\u1B5C\u1B5D\u1B5E\u1B5F\u1B60\u1BFC\u1BFD\u1BFE\u1BFF\u1C3B\u1C3C\u1C3D\u1C3E\u1C3F\u1C7E\u1C7F\u1CC0\u1CC1\u1CC2\u1CC3\u1CC4\u1CC5\u1CC6\u1CC7\u1CD3\u2010\u2011\u2012\u2013\u2014\u2015\u2016\u2017\u2018\u2019\u201A\u201B\u201C\u201D\u201E\u201F\u2020\u2021\u2022\u2023\u2024\u2025\u2026\u2027\u2030\u2031\u2032\u2033\u2034\u2035\u2036\u2037\u2038\u2039\u203A\u203B\u203C\u203D\u203E\u203F\u2040\u2041\u2042\u2043\u2045\u2046\u2047\u2048\u2049\u204A\u204B\u204C\u204D\u204E\u204F\u2050\u2051\u2052\u2053\u2054\u2055\u2056\u2057\u2058\u2059\u205A\u205B\u205C\u205D\u205E\u207D\u207E\u208D\u208E\u2116\u2117\u2120\u2122\u212E\u2212\u2234\u2235\u2248\u2300\u2308\u2309\u230A\u230B\u2311\u2329\u232A\u2380\u25CA\u25CC\u261E\u2640\u2642\u26A5\u2766\u2767\u2768\u2769\u276A\u276B\u276C\u276D\u276E\u276F\u2770\u2771\u2772\u2773\u2774\u2775\u27C5\u27C6\u27E6\u27E7\u27E8\u27E9\u27EA\u27EB\u27EC\u27ED\u27EE\u27EF\u2983\u2984\u2985\u2986\u2987\u2988\u2989\u298A\u298B\u298C\u298D\u298E\u298F\u2990\u2991\u2992\u2993\u2994\u2995\u2996\u2997\u2998\u29D8\u29D9\u29DA\u29DB\u29FC\u29FD\u2CF9\u2CFA\u2CFB\u2CFC\u2CFE\u2CFF\u2D70\u2E00\u2E01\u2E02\u2E03\u2E04\u2E05\u2E06\u2E07\u2E08\u2E09\u2E0A\u2E0B\u2E0C\u2E0D\u2E0E\u2E0F\u2E10\u2E11\u2E12\u2E13\u2E14\u2E15\u2E16\u2E17\u2E18\u2E19\u2E1A\u2E1B\u2E1C\u2E1D\u2E1E\u2E1F\u2E20\u2E21\u2E22\u2E23\u2E24\u2E25\u2E26\u2E27\u2E28\u2E29\u2E2A\u2E2B\u2E2C\u2E2D\u2E2E\u2E30\u2E31\u2E32\u2E33\u2E34\u2E35\u2E36\u2E37\u2E38\u2E39\u2E3A\u2E3B\u2E3C\u2E3D\u2E3E\u2E3F\u2E40\u2E41\u2E42\u2E43\u2E44\u2E45\u2E46\u2E47\u2E48\u2E49\u2E4A\u2E4B\u2E4C\u2E4D\u2E4E\u2E4F\u2E52\u3001\u3002\u3003\u3008\u3009\u300A\u300B\u300C\u300D\u300E\u300F\u3010\u3011\u3014\u3015\u3016\u3017\u3018\u3019\u301A\u301B\u301C\u301D\u301E\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D\uA60E\uA60F\uA673\uA67E\uA6F2\uA6F3\uA6F4\uA6F5\uA6F6\uA6F7\uA874\uA875\uA876\uA877\uA8CE\uA8CF\uA8F8\uA8F9\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1\uA9C2\uA9C3\uA9C4\uA9C5\uA9C6\uA9C7\uA9C8\uA9C9\uA9CA\uA9CB\uA9CC\uA9CD\uA9DE\uA9DF\uAA5C\uAA5D\uAA5E\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uD800\uD801\uD802\uD803\uD804\uD805\uD806\uD807\uD809\uD81A\uD81B\uD82F\uD836\uD83A\u{1F03B}\uDC41\uDC42\uDC43\uDC44\uDC45\uDC47\uDC48\uDC49\uDC4A\uDC4B\uDC4C\uDC4D\uDC4E\uDC4F\uDC57\uDC5A\uDC5B\uDC5D\uDC70\uDC71\uDC72\uDC73\uDC74\uDC9F\uDCBB\uDCBC\uDCBE\uDCBF\uDCC0\uDCC1\uDCC6\uDD00\uDD01\uDD02\uDD1F\uDD2F\uDD3F\uDD40\uDD41\uDD42\uDD43\uDD44\uDD45\uDD46\uDD5E\uDD5F\uDD6F\uDD74\uDD75\uDDC1\uDDC2\uDDC3\uDDC4\uDDC5\uDDC6\uDDC7\uDDC8\uDDC9\uDDCA\uDDCB\uDDCC\uDDCD\uDDCE\uDDCF\uDDD0\uDDD1\uDDD2\uDDD3\uDDD4\uDDD5\uDDD6\uDDD7\uDDDB\uDDDD\uDDDE\uDDDF\uDDE2\uDE38\uDE39\uDE3A\uDE3B\uDE3C\uDE3D\uDE3F\uDE40\uDE41\uDE42\uDE43\uDE44\uDE45\uDE46\uDE50\uDE51\uDE52\uDE53\uDE54\uDE55\uDE56\uDE57\uDE58\uDE60\uDE61\uDE62\uDE63\uDE64\uDE65\uDE66\uDE67\uDE68\uDE69\uDE6A\uDE6B\uDE6C\uDE6E\uDE6F\uDE7F\uDE87\uDE88\uDE89\uDE8A\uDE8B\uDE97\uDE98\uDE99\uDE9A\uDE9B\uDE9C\uDE9E\uDE9F\uDEA0\uDEA1\uDEA2\uDEA9\uDEAD\uDEF0\uDEF1\uDEF2\uDEF3\uDEF4\uDEF5\uDEF6\uDEF7\uDEF8\uDF37\uDF38\uDF39\uDF3A\uDF3B\uDF3C\uDF3D\uDF3E\uDF3F\uDF44\uDF55\uDF56\uDF57\uDF58\uDF59\uDF99\uDF9A\uDF9B\uDF9C\uDF9F\uDFD0\uDFE2\uDFFF\uFD3F\uFE10\uFE11\uFE12\uFE13\uFE14\uFE15\uFE16\uFE17\uFE18\uFE19\uFE30\uFE31\uFE32\uFE33\uFE34\uFE35\uFE36\uFE37\uFE38\uFE39\uFE3A\uFE3B\uFE3C\uFE3D\uFE3E\uFE3F\uFE40\uFE41\uFE42\uFE43\uFE44\uFE45\uFE46\uFE47\uFE48\uFE49\uFE4A\uFE4B\uFE4C\uFE4D\uFE4E\uFE4F\uFE50\uFE51\uFE52\uFE54\uFE55\uFE56\uFE57\uFE58\uFE59\uFE5A\uFE5B\uFE5C\uFE5D\uFE5E\uFE5F\uFE60\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01\uFF02\uFF03\uFF05\uFF06\uFF07\uFF08\uFF09\uFF0A\uFF0C\uFF0D\uFF0E\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B\uFF3C\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F\uFF60\uFF61\uFF62\uFF63\uFF64\uFF65"});var K8=O((IIt,j8)=>{function Qvt(r,e,t){if(typeof r!="string")throw new Error("`text` must be a string!");if(typeof e!="string")throw new Error("`a` must be a string!");if(typeof t!="string")throw new Error("`b` must be a string!");return r.split(e).join(t)}j8.exports=Qvt});var zN=O((CIt,J8)=>{var emt=H8(),tmt=K8(),X8="  ",Y8=" ";function rmt(r){if(typeof r!="string")throw new Error("`text` must be a string!");let e="";for(let t=0;t<r.length;t++){let n=r[t].toLowerCase();emt.includes(n)?e+=Y8:e+=n}for(;e.includes(X8);)e=tmt(e,X8,Y8);return e.trim()}J8.exports=rmt});var Q8=O((AIt,Z8)=>{var nmt=zN();function amt(r){if(typeof r!="string")throw new Error("`text` must be a string!");let e=nmt(r).split(" ");return e.length===0?"":e.length===1?e[0]:e.join("-")}Z8.exports=amt});var Zl=O((DIt,e7)=>{var imt=new Function(`
  try {
    return this === window
  } catch(e) {}

  try {
    return typeof importScripts !== "undefined"
  } catch(e) {}

  return false
`),$N=class extends Error{constructor(e){imt()?super(e):super(`

\x1B[31m`+e+`
\x1B[0m`)}};e7.exports=$N});var We=O((_It,t7)=>{var omt=Zl();t7.exports=function(r,e){if(!r)throw new omt(e)}});var Nt=O((FIt,r7)=>{function smt(r){return r===null||typeof r>"u"}r7.exports=smt});var a7=O((RIt,n7)=>{n7.exports=[Array,ArrayBuffer,BigInt64Array,BigUint64Array,Float32Array,Float64Array,Int16Array,Int32Array,Int8Array,Uint16Array,Uint32Array,Uint8Array,Uint8ClampedArray]});var Ye=O((OIt,o7)=>{var umt=Nt(),i7=a7(),cmt=i7.map(r=>r.name);function lmt(r){try{return r instanceof Array?!0:umt(r.constructor)?!1:i7.indexOf(r.constructor)>-1||cmt.indexOf(r.constructor.name)>-1}catch{return!1}}o7.exports=lmt});var vt=O((PIt,s7)=>{function fmt(r){try{return!!r._symbol&&r._symbol===Symbol.for("@jrc03c/js-math-tools/dataframe")}catch{return!1}}s7.exports=fmt});var Jn=O((MIt,u7)=>{function hmt(r){return typeof r=="function"}u7.exports=hmt});var it=O((BIt,c7)=>{function pmt(r){return typeof r=="number"&&!isNaN(r)}c7.exports=pmt});var qs=O((LIt,l7)=>{var dmt=Ye(),vmt=Nt();function mmt(r){return typeof r=="object"&&!vmt(r)&&!dmt(r)}l7.exports=mmt});var pt=O((qIt,f7)=>{function gmt(r){try{return!!r._symbol&&r._symbol===Symbol.for("@jrc03c/js-math-tools/series")}catch{return!1}}f7.exports=gmt});var qp=O((zIt,d7)=>{var ymt=We(),h7=Ye(),bmt=vt(),wmt=Jn(),WN=it(),p7=qs(),xmt=pt();function UN(r,e){if(bmt(r)){let i=UN(r.values,e);return i.length>0&&WN(i[0])&&i[0]>=0&&i[0]<r.index.length&&(i[0]=r.index[i[0]]),i.length>1&&WN(i[1])&&i[1]>=0&&i[1]<r.columns.length&&(i[1]=r.columns[i[1]]),i}if(xmt(r)){let i=UN(r.values,e);return i.length>0&&WN(i[0])&&i[0]>=0&&i[0]<r.index.length&&(i[0]=r.index[i[0]]),i}if(ymt(p7(r)||h7(r),"You must pass (1) an object, array, Series, or DataFrame and (2) a function or value into the `indexOf` function!"),!wmt(e)){let i=e;e=o=>o===i}function t(i,o,s){if(s=s||[],s.indexOf(i)>-1)return null;if(p7(i)){s.push(i);let u=Object.keys(i).concat(Object.getOwnPropertySymbols(i));for(let c=0;c<u.length;c++){let l=u[c],f=i[l];if(o(f))return[l];let h=t(f,o,s);if(h&&h.length>0)return[l].concat(h)}}else if(h7(i)){s.push(i);for(let u=0;u<i.length;u++){let c=i[u];if(o(c))return[u];let l=t(c,o,s);if(l&&l.length>0)return[u].concat(l)}}else if(o(i))return[];return null}function n(i){try{return e(i)}catch{return!1}}let a=t(r,n);return a&&a.length>0?a:null}d7.exports=UN});var Wo=O(($It,y7)=>{var kmt=qp(),v7=Ye(),m7=vt(),g7=pt();function zp(r){function e(t){if(typeof t=="object"){if(t===null)return null;if(v7(t))return t instanceof Array?t.map(a=>zp(a)):t.slice();if(g7(t)){let a=t.copy();return a.values=zp(a.values),a}if(m7(t)){let a=t.copy();return a.values=zp(t.values),a}if(t instanceof Date)return new Date(t.getTime());t=VN(t);let n={};return Object.keys(t).concat(Object.getOwnPropertySymbols(t)).forEach(a=>{n[a]=zp(t[a])}),n}else return t}return e(VN(r))}function VN(r){function e(a,i,o){if(i=i||[],o=o||"",i.indexOf(a)>-1){let s=o.split("/").slice(o.startsWith("/")?1:0);if(s.some((c,l)=>{let f=s.slice(0,s.length-l-1),h=t;return f.forEach(p=>{h=h[p]}),h===a}))return`<reference to "${t===a?"/":"/"+kmt(t,a).join("/")}">`}return typeof a=="object"?a===null?null:(i.push(a),v7(a)?typeof a.constructor<"u"&&a.constructor.name!=="Array"?a.slice():a.map((s,u)=>e(s,i,o+"/"+u)):(Object.keys(a).concat(Object.getOwnPropertySymbols(a)).forEach(s=>{a[s]=e(a[s],i,o+"/"+s.toString())}),a)):a}let t=r,n=e(t);if(m7(r)){let a=r.copy();a._values=n.values,a._columns=n.columns,a._index=n.index,n=a}if(g7(r)){let a=r.copy();a.name=n.name,a._values=n.values,a._index=n.index,n=a}return n}y7.exports={copy:zp,decycle:VN}});var Fr=O((WIt,x7)=>{var Smt=We(),b7=Ye(),Nmt=vt(),Tmt=pt();function w7(r){if(Nmt(r)||Tmt(r))return w7(r.values);Smt(b7(r),"The `flatten` function only works on arrays, Series, and DataFrames!");function e(t){let n=[];return t.forEach(a=>{b7(a)?n=n.concat(e(a)):n.push(a)}),n}return e(r)}x7.exports=w7});var $p=O((UIt,k7)=>{function Emt(r){return r instanceof Date&&r.toString()!=="Invalid Date"}k7.exports=Emt});var Vi=O((VIt,T7)=>{var{decycle:S7}=Wo(),N7=Ye(),GN=$p();function Imt(r,e){function t(n,a){let i=typeof n;if(i!==typeof a)return!1;if(i==="undefined")return!0;if(i==="boolean"||i==="symbol")return n===a;if(i==="number"||i==="bigint")return n.toString()==="NaN"&&a.toString()==="NaN"?!0:n===a;if(i==="string"||i==="function")return n===a;if(i==="object"){if(n===null||a===null)return n===null&&a===null;{if(GN(n))return GN(a)?n.getTime()===a.getTime():!1;if(GN(a)||N7(n)!==N7(a))return!1;let s=Object.keys(n).concat(Object.getOwnPropertySymbols(n)),u=Object.keys(a).concat(Object.getOwnPropertySymbols(a));if(s.length!==u.length)return!1;for(let c=0;c<s.length;c++){let l=s[c];if(!t(n[l],a[l]))return!1}return!0}}}try{return t(r,e)}catch{return t(S7(r),S7(e))}}T7.exports=Imt});var Gi=O((GIt,A7)=>{var Cmt=We(),Amt=Fr(),Dmt=Ye(),E7=vt(),_mt=Jn(),I7=pt(),Fmt=Nt();function Wp(r){let e="abcdefg1234567890",t="";for(;t.length<r;)t+=e[parseInt(Math.random()*e.length)];return t}var Rmt=Wp(256),Omt=Wp(256),Pmt=Wp(256),Mmt=Wp(256),Bmt=Wp(256);function C7(r){if(E7(r)||I7(r))return C7(r.values);Cmt(Dmt(r),"The `set` function only works on arrays, Series, and DataFrames!");let e=[],t={};return Amt(r).forEach(n=>{let a=typeof n=="object"&&n===null?Rmt:Fmt(n)?Omt:_mt(n)?n.toString():typeof n=="symbol"?n.toString()+" - "+Bmt:n===1/0?Pmt:n===-1/0?Mmt:E7(n)?n.toJSONString():I7(n)?JSON.stringify(n.toObject()):JSON.stringify(n);t[a]||e.push(n),t[a]=!0}),e}A7.exports=C7});var Up=O((HIt,F7)=>{var Lmt=We(),HN=Fr(),D7=Ye(),qmt=vt(),_7=Vi(),zmt=Jn(),$mt=pt(),Wmt=Gi();function gy(r,e){if(qmt(r)||$mt(r))return arguments.length>1?gy(r.values,e):gy(r.values,r.values);if(Lmt(D7(r),"The first argument to the `count` function must be an array, Series, or DataFrame!"),zmt(e))return HN(r).filter(t=>e(t)).length;if(D7(e)){let t=HN(r);return Wmt(e).map(n=>({value:n,count:t.filter(a=>_7(a,n)).length}))}else return arguments.length>1?HN(r).filter(t=>_7(t,e)).length:gy(r,r)}F7.exports=gy});var Vp=O((jIt,O7)=>{var Umt=We(),R7=Ye(),Vmt=vt(),Gmt=pt();function jN(r){if(Vmt(r)||Gmt(r))return jN(r.values);Umt(R7(r),"The `isJagged` function only works on arrays, Series, and DataFrames!");let e=0,t=null;for(let n=0;n<r.length;n++)if(R7(r[n])){if(e++,jN(r[n]))return!0;if(t===null)t=r[n].length;else if(r[n].length!==t)return!0}return e>0&&e<r.length}O7.exports=jN});var yy=O((KIt,B7)=>{var Hmt=We(),P7=Ye(),jmt=vt(),Kmt=pt();function M7(r){if(jmt(r)||Kmt(r))return M7(r.values);Hmt(P7(r),"The `isNested` function only works on arrays, Series, and DataFrames!");for(let e=0;e<r.length;e++)if(P7(r[e]))return!0;return!1}B7.exports=M7});var zs=O((XIt,q7)=>{var hc=We(),Xmt=Ye(),Ymt=yy(),Jmt=it(),Zmt=Nt(),Ql="You must pass a natural number or a one-dimensional array of natural numbers into the `ndarray` function!";function L7(r){hc(!Zmt(r),Ql),Xmt(r)||(r=[r]),hc(!Ymt(r),Ql),hc(r.length>0,Ql);let e=r[0];if(hc(Jmt(e),Ql),hc(parseInt(e)===e,Ql),hc(e>=0,Ql),hc(e!==1/0,"We can't create an array containing an infinite number of values!"),r.length===1){let t=[];for(let n=0;n<e;n++)t.push(void 0);return t}else{let t=[];for(let n=0;n<e;n++)t.push(L7(r.slice(1)));return t}}q7.exports=L7});var Gp=O((YIt,z7)=>{var Qmt=We(),egt=Ye(),tgt=vt(),rgt=pt();function KN(r){if(tgt(r)||rgt(r)){let t=r.copy();return t.values=KN(t.values),t.index=KN(t.index),t}Qmt(egt(r),"The `reverse` function only works on arrays, Series, and DataFrames!");let e=[];for(let t=r.length-1;t>=0;t--)e.push(r[t]);return e}z7.exports=KN});var Wa=O((JIt,$7)=>{var XN=We(),YN=it(),JN=Nt(),ngt=Gp();function agt(r,e,t=1){XN(!JN(r)&&!JN(e)&&!JN(t),"You must pass two numbers and optionally a step value to the `range` function!"),XN(YN(r)&&YN(e)&&YN(t),"You must pass two numbers and optionally a step value to the `range` function!"),XN(t>0,"The step value must be greater than 0! (NOTE: The step value is a magnitude; it does not indicate direction.)");let n=!1;if(r>e){n=!0;let i=r;r=e+t,e=i+t}let a=[];for(let i=r;i<e;i+=t)a.push(i);return n&&(a=ngt(a)),a}$7.exports=agt});var Nr=O((ZIt,G7)=>{var igt=We(),W7=Ye(),ogt=vt(),sgt=Vi(),ugt=pt(),cgt=Nt();function U7(r){if(!W7(r))return;let e=[r.length],t=0,n=r.map(a=>{let i=U7(a);return cgt(i)?i:(t++,i.length===1?i[0]:i)});return t>0?t===r.length&&n.slice(0,-1).every((i,o)=>sgt(i,n[o+1]))?e.concat(n[0]):(e.push(n),e):e}function V7(r){return ogt(r)||ugt(r)?V7(r.values):(igt(W7(r),"The `shape` function only works on arrays, Series, and DataFrames!"),U7(r))}G7.exports=V7});var J7=O((QIt,Y7)=>{var H7=We(),lgt=Ye(),fgt=vt(),hgt=Vp(),pgt=pt(),dgt=Nt(),j7=Zl(),by=zs(),K7=Wa(),vgt=Gi(),mgt=Nr();function X7(r,e,t){if(dgt(t)&&(t=0),H7(t===0||t===1||t==="vertical"||t==="horizontal",'The only valid axis values for use when appending data to a DataFrame are 0, 1, "vertical", and "horizontal". Note that 0 == "horizontal" and 1 == "vertical".'),lgt(e)){H7(!hgt(e),"The array of data you're trying to append to this DataFrame is jagged!");let n=mgt(e);if(n.length===1)if(t===0){let a=r.copy();a._values.push(e);let i=Math.max(r.shape[1],n[0]);for(a._values.forEach(o=>{for(;o.length<i;)o.push(void 0)});a._index.length<a._values.length;)a._index.push("row"+a._index.length);for(;a._columns.length<i;)a._columns.push("col"+a._columns.length);return a}else{let a=Math.max(r.shape[0],n[0]),i=r.copy();for(K7(0,a).forEach(o=>{o>=i._values.length&&i._values.push(by(r.shape[1])),i._values[o].push(e[o])});i._index.length<i._values.length;)i._index.push("row"+i._index.length);for(;i._columns.length<i._values[0].length;)i._columns.push("col"+i._columns.length);return i}else if(n.length===2)if(t===0){let a=Math.max(...e.map(o=>o.length).concat([r.shape[1]])),i=r.copy();for(i._values=i._values.concat(e).map(o=>{for(;o.length<a;)o.push(void 0);return o});i._index.length<i._values.length;)i._index.push("row"+i._index.length);for(;i._columns.length<a;)i._columns.push("col"+i._columns.length);return i}else{let a=Math.max(...e.map(s=>s.length))+r.shape[1],i=Math.max(r.shape[0],n[0]),o=r.copy();for(K7(0,i).forEach(s=>{for(s>=o._values.length&&o._values.push(by(r.shape[1])),o._values[s]=o._values[s].concat(e[s]);o._values[s].length<a;)o._values[s].push(void 0)});o._index.length<o._values.length;)o._index.push("row"+o._index.length);for(;o._columns.length<a;)o._columns.push("col"+o._columns.length);return o}else throw new j7("Only 1- and 2-dimensional arrays can be appended to a DataFrame!")}else if(pgt(e)){let n=X7(r,e.values,t);return t===0?n.index[n.index.length-1]=n.index.indexOf(e.name)>-1?e.name+" (2)":e.name:n.columns[n.columns.length-1]=n.columns.indexOf(e.name)>-1?e.name+" (2)":e.name,n}else if(fgt(e))if(t===0){let n=r.copy(),a=vgt(n._columns.concat(e._columns)).length;for(n._values.forEach(i=>{for(;i.length<a;)i.push(void 0)}),e.apply(i=>{let o=i.copy(),s=[];n._columns.forEach(u=>{let c=o._index.indexOf(u);c>-1?(s.push(o._values[c]),o._values.splice(c,1),o._index.splice(c,1)):s.push(void 0)}),n._values.push(s.concat(o._values))},1),n._columns=n._columns.concat(e._columns.filter(i=>n._columns.indexOf(i)<0));n._index.length<n._values.length;){let i="row"+n._index.length;n._index.push(i+(r._index.indexOf(i)>-1?" (2)":""))}return n}else{let n=r.copy();return n._index.forEach((a,i)=>{let o=e._index.indexOf(a);o>-1?n._values[i]=n._values[i].concat(e._values[o]):n._values[i]=n._values[i].concat(by(e.shape[1]))}),e._index.forEach((a,i)=>{n._index.indexOf(a)<0&&(n._index.push(a),n._values.push(by(n._columns.length).concat(e._values[i])))}),n._columns=n._columns.concat(e._columns.map(a=>a+(n._columns.indexOf(a)>-1?" (2)":""))),n}else throw new j7("Only 1- or 2-dimensional arrays, Series, and DataFrames can be appended to a DataFrame!")}Y7.exports=X7});var rX=O((eCt,tX)=>{var Z7=We(),Q7=Ye(),ggt=Jn(),eX=Nt();function ygt(r,e,t,n,a){if(a=a||0,Z7(ggt(n),"The first parameter to the `apply` method must be a function."),Z7(a===0||a===1,"The second parameter to the `apply` method (the `axis`) must be 0 or 1."),a===0){let i={},o;if(t.columns.forEach((s,u)=>{let c=new e(t.values.map(f=>f[u]));c.name=s,c.index=t.index;let l=n(c,u,t);l instanceof e?i[s]=l.values:i[s]=l,eX(o)&&(o=l instanceof e||Q7(l))}),o){let s=new r(i);return s.index=t.index,s}else{let s=new e(t.columns.map(u=>i[u]));return s.index=t.columns,s}}else if(a===1){let i,o=t.values.map((s,u)=>{let c=new e(s);c.name=t.index[u],c.index=t.columns;let l=n(c,u,t);return eX(i)&&(i=l instanceof e||Q7(l)),l instanceof e?l.values:l});if(i){let s=new r(o);return s.index=t.index,s.columns=t.columns,s}else{let s=new e(o);return s.index=t.index,s}}}tX.exports=ygt});var Ta=O((tCt,nX)=>{function bgt(r){return typeof r=="string"}nX.exports=bgt});var oX=O((rCt,iX)=>{var aX=We(),wgt=Ye(),xgt=Vp(),kgt=qs(),Sgt=Ta(),Ngt=Nt(),Tgt=Zl(),Egt=Nr();function Igt(r,e,t,n,a){let i=s=>s instanceof r,o=s=>s instanceof e;if(Ngt(a)){if(i(n))return t.append(n,1);if(o(n))return t.append(n,1);if(kgt(n)){let s=Math.max(...Object.keys(n).concat(Object.getOwnPropertySymbols(n)).map(u=>n[u].length));return Object.keys(n).concat(Object.getOwnPropertySymbols(n)).forEach(u=>{for(;n[u].length<s;)n[u].push(void 0)}),t.append(new r(n),1)}else throw new Tgt("You must pass a DataFrame, Series, or object into the `assign` method!")}else{aX(Sgt(n),"If passing two arguments into the `assign` method, then the first argument must be a string name!"),aX(wgt(a)&&!xgt(a)&&Egt(a).length===1,"If passing two arguments into the `assign` method, then the second argument must be a 1-dimensional array!");let s=t.append(a,1);return s.columns[s.columns.length-1]=n,s}}iX.exports=Igt});var uX=O((nCt,sX)=>{var{copy:Cgt}=Wo();function Agt(r,e){if(e.isEmpty)return new r;let t=new r(Cgt(e.values));return t.columns=e.columns.slice(),t.index=e.index.slice(),t}sX.exports=Agt});var vX=O((aCt,dX)=>{var wy=We(),cX=Ye(),lX=it(),fX=Ta(),hX=Nt(),pX=Nr();function Dgt(r,e,t,n,a){hX(n)&&(n=[]),hX(a)&&(a=[]),(fX(n)||lX(n))&&(n=[n]),(fX(a)||lX(a))&&(a=[a]),wy(cX(n),"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings."),wy(cX(a),"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings."),wy(pX(n).length===1,"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings."),wy(pX(a).length===1,"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings.");let i,o;t.index.forEach((u,c)=>{n.indexOf(u)<0&&n.indexOf(c)<0&&(i||(i=[]),i.push(u))}),t.columns.forEach((u,c)=>{a.indexOf(u)<0&&a.indexOf(c)<0&&(o||(o=[]),o.push(u))});let s=t.get(i,o);if(s instanceof e){let u=new r;u=u.assign(s),t.index.indexOf(s.name)>-1&&(u=u.transpose()),s=u}return s}dX.exports=Dgt});var Hp=O((iCt,mX)=>{var _gt=it();function Fgt(r){return _gt(r)&&parseInt(r)===r}function Rgt(r){return Fgt(r)&&r>=0}mX.exports=Rgt});var yX=O((oCt,gX)=>{var ZN=We(),Ogt=Ta(),xy=Nt(),Pgt=Hp(),Mgt=Nr();function Bgt(r,e,t,n,a,i){n=n||0,ZN(n===0||n===1,"The first parameter of the `dropMissing` method (the `axis`) must be 0 or 1."),i=i||0,ZN(Pgt(i),"The third parameter of the `dropMissing` method (the `threshold`) should be a whole number (meaning that data should be dropped if it contains more than `threshold` null values)."),a=i>0?"none":a||"any",ZN(a==="any"||a==="all"||a==="none","The second parameter of the `dropMissing` method (the `condition` parameter, which indicates the condition under which data should be dropped) should be 'any' or 'all' (meaning that if 'any' of the data contains null values, then it should be dropped; or that if 'all' of the data contains null values, then it should be dropped).");function o(c){if(i>0){let l=0;for(let f=0;f<c.length;f++){let h=c[f];if(xy(h)&&l++,l>=i)return[]}}else if(a==="any")for(let l=0;l<c.length;l++){let f=c[l];if(xy(f))return[]}else if(a==="all"){for(let l=0;l<c.length;l++){let f=c[l];if(!xy(f))return c}return[]}return c}let s=t.copy(),u=Math.random().toString();if(n===0){s=s.assign(u,s.index);let c=s.values.map(o).filter(f=>f.length>0);if(Mgt(c).length<2)return new r;s.values=c;let l=s.get(null,u);if(xy(l))return new r;Ogt(l)&&(l=[l]),l instanceof e&&(l=l.values),s.index=l,s=s.drop(null,u)}else if(n===1){let c={};if(s.columns.forEach((f,h)=>{let p=s.values.map(m=>m[h]),d=o(p);d.length>0&&(c[f]=d)}),Object.keys(c).length+Object.getOwnPropertySymbols(c).length===0)return new r;let l=new r(c);return l.index=s.index,l}return s}gX.exports=Bgt});var QN=O((sCt,wX)=>{var Lgt=We(),qgt=Ye(),zgt=vt(),$gt=it(),Wgt=pt();function bX(r){if(zgt(r)||Wgt(r))return r.dropNaN(...Object.values(arguments).slice(1));Lgt(qgt(r),"The `dropNaN` function only works on arrays, Series, and DataFrames!");let e=[];return r.forEach(t=>{try{return e.push(bX(t))}catch{if($gt(t))return e.push(t)}}),e}wX.exports=bX});var kX=O((uCt,xX)=>{var eT=We(),Ugt=QN(),Vgt=Hp();function Ggt(r,e,t,n,a){t=t||0,eT(t===0||t===1,"The first parameter of the `dropNaN` method (the `axis`) must be 0 or 1."),a=a||0,eT(Vgt(a),"The third parameter of the `dropNaN` method (the `threshold`) should be a whole number (meaning that data should be dropped if it contains more than `threshold` NaN values)."),n=a>0?"none":n||"any",eT(n==="any"||n==="all"||n==="none","The second parameter of the `dropNaN` method (the `condition` parameter, which indicates the condition under which data should be dropped) should be 'any' or 'all' (meaning that if 'any' of the data contains NaN values, then it should be dropped; or that if 'all' of the data contains NaN values, then it should be dropped).");function i(s){let u=Ugt(s);return a>0?s.length-u.length<a:n==="any"?u.length===s.length:n==="all"?u.length>0:!0}let o=e.copy();if(t===0){let s=o.index.filter(u=>{let c=o.get(u,null).values;return i(c)});return s.length>0?o.get(s,null):new r}else if(t===1){let s=o.columns.filter(u=>{let c=o.get(null,u).values;return i(c)});return s.length>0?o.get(null,s):new r}return o}xX.exports=Ggt});var EX=O((cCt,TX)=>{var SX=We(),jp=Fr(),Hgt=Jn(),jgt=Nt();function NX(r){let e={};return jp(r).forEach((t,n)=>{e[t]=n}),e}function ef(r){return Object.keys(r).concat(Object.getOwnPropertySymbols(r)).sort((e,t)=>r[e]-r[t])}function Kgt(r,e,t,n,a){SX(Hgt(n),"The `filter` method takes a single parameter: a function that is used to filter the values."),jgt(a)&&(a=0),SX(a===0||a===1,"The `axis` parameter to the `filter` method must be 0 or 1.");let i=t.copy();if(i.isEmpty)return i;let o=NX(i.index),s=NX(i.columns);if(a===0){let u=i.values.filter((c,l)=>{let f=new e(c);f.name=t.index[l],f.index=t.columns;let h=n(f,l,t);return h||delete o[i.index[l]],h});if(jp(u).length===0)return new r;if(u.length===1){let c=new e(jp(u));return c.name=ef(o)[0],c.index=ef(s),c}i.values=u,i.index=ef(o)}else if(a===1){i=i.transpose();let u=i.values.filter((c,l)=>{let f=new e(c);f.name=t.columns[l],f.index=t.index;let h=n(f,l,t);return h||delete s[i.index[l]],h});if(jp(u).length===0)return new r;if(u.length===1){let c=new e(jp(u));return c.name=ef(s)[0],c.index=ef(o),c}i.values=u,i.index=ef(s),i=i.transpose()}return i}TX.exports=Kgt});var AX=O((lCt,CX)=>{var wi=We(),ky=it(),Sy=Ta(),IX=Nt(),Xgt=Gi();function Ygt(r,e,t){(Sy(e)||ky(e))&&(e=[e]),(Sy(t)||ky(t))&&(t=[t]);let n=Xgt((e||[]).concat(t||[]).map(a=>typeof a));return wi(n.length<=2,"Only whole numbers and/or strings are allowed in `get` arrays!"),n.length===1&&wi(n[0]==="string"||n[0]==="number","Only whole numbers and/or strings are allowed in `get` arrays!"),n.length===2&&(wi(n.indexOf("string")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!"),wi(n.indexOf("number")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!")),IX(e)||(e=e.map(a=>{if(Sy(a))return wi(r.index.indexOf(a)>-1,`Row "${a}" does not exist!`),a;if(ky(a))return wi(a>=0,`Index ${a} is out of bounds!`),wi(parseInt(a)===a,"Row numbers must be integers!"),wi(a<r.index.length,`Index ${a} is out of bounds!`),r.index[a]})),IX(t)||(t=t.map(a=>{if(Sy(a))return wi(r.columns.indexOf(a)>-1,`Column "${a}" does not exist!`),a;if(ky(a))return wi(a>=0,`Column ${a} is out of bounds!`),wi(parseInt(a)===a,"Column numbers must be integers!"),wi(a<r.columns.length,`Column ${a} is out of bounds!`),r.columns[a]})),r.getSubsetByNames(e,t)}CX.exports=Ygt});var $s=O((fCt,_X)=>{var DX=We(),Jgt=Ye(),Zgt=vt(),Qgt=Jn(),eyt=pt(),tyt=Nt();function ryt(r,e){try{return r<e?-1:r>e?1:0}catch{return r=typeof r=="object"&&r!==null?JSON.stringify(r):r.toString(),e=typeof e=="object"&&e!==null?JSON.stringify(e):e.toString(),r<e?-1:r>e?1:0}}function nyt(r,e){if(tyt(e)&&(e=ryt),Zgt(r)||eyt(r))return r.sort(...Object.values(arguments).slice(1));DX(Jgt(r),"The `sort` function only works on arrays, Series, and DataFrames!"),DX(Qgt(e),"The second parameter of the `sort` function must be a comparison function!");let t=r.slice();return t.sort(e),t}_X.exports=nyt});var PX=O((hCt,OX)=>{var FX=We(),RX=Ta(),ayt=Nt(),iyt=Gi(),oyt=$s();function syt(r){let e=r.toLowerCase(),t="";for(let a=0;a<e.length;a++){let i=e[a];i.match(/[a-z0-9]/g)?t+=i:t+=" "}let n=t.split(" ").filter(a=>a.length>0);return n[0]+n.slice(1).map(a=>a[0].toUpperCase()+a.substring(1)).join("")}function uyt(r,e,t){ayt(t)?t=e.columns:RX(t)&&(t=[t]);let n={};t.forEach(i=>{FX(RX(i),"You must pass either a string or a one-dimensional array of strings into the `getDummies` (AKA `oneHotEncode`) method!");let o=e.columns.indexOf(i);FX(o>-1,`The given DataFrame does not have a column called "${i}"!`);let s=e.values.map(c=>c[o]),u=oyt(iyt(s));s.forEach(c=>{u.forEach(l=>{let f=i+"_"+syt(l.toString());n[f]||(n[f]=[]),c===l?n[f].push(1):n[f].push(0)})})});let a=new r(n);return a.index=e.index,a}OX.exports=uyt});var UX=O((pCt,WX)=>{var Ws=We(),MX=Ye(),BX=it(),LX=Nt(),qX=Hp(),zX=Wa(),$X=Nr();function cyt(r,e,t){let n=r.shape;LX(e)&&(e=zX(0,n[0])),LX(t)&&(t=zX(0,n[1])),BX(e)&&(e=[e]),BX(t)&&(t=[t]),Ws(MX(e)&&MX(t),"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),Ws($X(e).length===1&&$X(t).length===1,"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),Ws(e.length>0,"The `rowIndices` array must contain at least one index."),Ws(t.length>0,"The `colIndices` array must contain at least one index."),e.forEach(o=>{Ws(qX(o),"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),Ws(o<r.index.length,`The row index ${o} is out of bounds.`)}),t.forEach(o=>{Ws(qX(o),"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),Ws(o<r.columns.length,`The column index ${o} is out of bounds.`)});let a=e.map(o=>r.index[o]),i=t.map(o=>r.columns[o]);return r.getSubsetByNames(a,i)}WX.exports=cyt});var KX=O((dCt,jX)=>{var Us=We(),tT=Fr(),VX=Ye(),Ny=Ta(),GX=Nt(),HX=Nr();function lyt(r,e,t,n,a){GX(n)&&(n=t.index),GX(a)&&(a=t.columns),Ny(n)&&(n=[n]),Ny(a)&&(a=[a]),Us(VX(n)&&VX(a),"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),Us(HX(n).length===1&&HX(a).length===1,"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),Us(n.length>0,"The `rows` array must contain at least one row name."),Us(a.length>0,"The `cols` array must contain at least one column name."),n.forEach(s=>{Us(Ny(s),"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),Us(t.index.indexOf(s)>-1,`The row name "${s}" does not exist in the list of rows.`)}),a.forEach(s=>{Us(Ny(s),"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),Us(t.columns.indexOf(s)>-1,`The column name "${s}" does not exist in the list of columns.`)});let i=n.map(s=>a.map(u=>t.values[t.index.indexOf(s)][t.columns.indexOf(u)]));if(n.length===1&&a.length===1)return tT(i)[0];if(n.length===1){let s=new e(tT(i));return s.name=n[0],s.index=a,s}if(a.length===1){let s=new e(tT(i));return s.name=a[0],s.index=n,s}let o=new r(i);return o.columns=a,o.index=n,o}jX.exports=lyt});var YX=O((vCt,XX)=>{var fyt=Ta(),Kp=Wa();function hyt(r,e,t){function n(h,p){return fyt(h)&&h.length>p?h.substring(0,p-3)+"...":h}if(t.isEmpty)return console.table({}),console.log("Shape:",[0,0],`
`),t;let a=typeof window>"u"?20:10,i=parseInt(a/2),o=typeof process>"u"?10:Math.floor(process.stdout.columns/24)-1,s=parseInt(o/2),u=a>t.index.length?null:Kp(0,i).concat(Kp(t.index.length-i,t.index.length)),c=o>t.columns.length?null:Kp(0,s).concat(Kp(t.columns.length-s,t.columns.length)),l=t.get(u,c);l instanceof e&&(t.shape[0]===1?(l=new r([l.values]),l.index=t.index,l.columns=new e(t.columns).get(c).values):t.shape[1]===1&&(l=new r([l.values]).transpose(),l.index=new e(t.index).get(u).values,l.columns=t.columns)),a<=t.index.length&&(l._index.splice(i,0,"..."),l._values.splice(i,0,Kp(0,l.columns.length).map(()=>"..."))),o<=t.columns.length&&(l._columns.splice(s,0,"..."),l._values=l._values.map(h=>(h.splice(s,0,"..."),h)));let f=28;return l instanceof e?(l.values=l.values.map(h=>n(h,f)),l.name=n(l.name,f),l.index=l.index.map(h=>n(h,f))):(l.values=l.values.map(h=>h.map(p=>n(p,f))),l.columns=l.columns.map(h=>n(h,f)),l.index=l.index.map(h=>n(h,f))),console.table(l.toObject()),console.log("Shape:",t.shape,`
`),t}XX.exports=hyt});var Ty=O((mCt,JX)=>{var pyt=We(),dyt=it();function vyt(r,e){pyt(dyt(r),"The `leftPad` function only works on numbers!");let t=r.toString();for(;t.length<e;)t="0"+t;return t}JX.exports=vyt});var QX=O((gCt,ZX)=>{var myt=Ty(),gyt=Wa();function yyt(r,e){let t=e?r:r.copy();return t.index=gyt(0,r.shape[0]).map(n=>"row"+myt(n,(t.index.length-1).toString().length)),t}ZX.exports=yyt});var Xp=O((yCt,t9)=>{var byt=We(),wyt=Fr(),xyt=Ye(),kyt=vt(),Syt=pt();function e9(r){if(kyt(r)||Syt(r))return e9(r.values);byt(xyt(r),"The `product` function only works on arrays, Series, and DataFrames!");try{return r.length===0?NaN:wyt(r).reduce((e,t)=>e*t,1)}catch{return NaN}}t9.exports=e9});var Ey=O((bCt,i9)=>{var Yp=We(),r9=Fr(),n9=Ye(),Nyt=vt(),a9=it(),Tyt=pt(),Eyt=Xp(),Iyt=Nr();function rT(r,e){if(Nyt(r)||Tyt(r))return rT(r.values,e);if(Yp(n9(r),"The first argument passed into the `reshape` function must be an array!"),a9(e)&&(e=[e]),Yp(n9(e),"The second argument passed into the `reshape` function must be a whole number or a one-dimensional array of whole numbers!"),Yp(Iyt(e).length===1,"The first argument passed into the `reshape` function must be a whole number or a one-dimensional array of whole numbers!"),e.forEach(i=>{Yp(a9(i)&&parseInt(i)===i&&i>0,"The first argument passed into the `reshape` function must be a whole number or a one-dimensional array of whole numbers!")}),e.length===0)return r9(r);let t=r9(r);if(e.length===1&&e[0]===t.length)return t;Yp(Eyt(e)===t.length,"The new shape doesn't match the number of values available in `x` (the first argument passed into the `reshape` function)!");let n=[],a=parseInt(t.length/e[0]);for(let i=0;i<e[0];i++){let o=t.slice(i*a,(i+1)*a);n.push(rT(o,e.slice(1)))}return n}i9.exports=rT});var tf=O((wCt,h9)=>{var{copy:u9}=Wo(),Cyt=We(),Ayt=Ye(),Dyt=it(),c9=Nt(),_yt=zs(),Fyt=Xp(),Ryt=Ey(),l9=Math.pow(2,64),Tr=[];f9(parseInt(Math.random()*l9));function Oyt(r,e){r=qn(r);function t(){r+=qn("0x9e3779b97f4a7c15");let a=u9(r);return a=(a^a>>BigInt(30))*qn("0xbf58476d1ce4e5b9"),a=(a^a>>BigInt(27))*qn("0x94d049bb133111eb"),a^a>>BigInt(31)}let n=[];for(let a=0;a<e;a++)n.push(t());return n}function qn(r){return BigInt.asUintN(64,BigInt(r))}function o9(r,e){return r=qn(r),e=BigInt(e),qn(qn(r<<e)|qn(r>>qn(BigInt(64)-e)))}function f9(r){if(c9(r))return u9(Tr);{Cyt(Dyt(r),"If passing a value into the `seed` function, then that value must be an integer!");let e=Oyt(parseInt(r),4);Tr[0]=e[0],Tr[1]=e[1],Tr[2]=e[2],Tr[3]=e[3]}}function s9(){let r=qn(o9(Tr[0]+Tr[3],23)+Tr[0]),e=qn(Tr[1]<<BigInt(17));return Tr[2]=qn(Tr[2]^Tr[0]),Tr[3]=qn(Tr[3]^Tr[1]),Tr[1]=qn(Tr[1]^Tr[2]),Tr[0]=qn(Tr[0]^Tr[3]),Tr[2]=qn(Tr[2]^e),Tr[3]=o9(Tr[3],45),parseInt(r)/l9}function Pyt(r){return c9(r)?s9():(Ayt(r)||(r=[r]),Ryt(_yt(Fyt(r)).map(s9),r))}h9.exports={random:Pyt,seed:f9}});var Iy=O((xCt,p9)=>{var{random:Myt}=tf(),Byt=We(),Lyt=Ye(),qyt=vt(),zyt=pt();function $yt(r){if(qyt(r)||zyt(r))return r.shuffle(...Object.values(arguments).slice(1));Byt(Lyt(r),"The `shuffle` function only works on arrays, Series, and DataFrames!");let e=[],t=r.slice();for(let n=0;n<r.length;n++){let a=parseInt(Myt()*t.length);e.push(t.splice(a,1)[0])}return e}p9.exports=$yt});var m9=O((kCt,v9)=>{var Wyt=We(),Uyt=Nt(),d9=Iy();function Vyt(r,e){return Uyt(e)&&(e=0),Wyt(e===0||e===1,"The `axis` parameter to the `shuffle` must be 0, 1, or undefined."),r.get(e===0?d9(r.index):null,e===1?d9(r.columns):null)}v9.exports=Vyt});var Cy=O((SCt,g9)=>{function Gyt(r){return typeof r=="boolean"}g9.exports=Gyt});var k9=O((NCt,x9)=>{var{random:Hyt}=tf(),Ea=We(),jyt=Fr(),y9=Ye(),nT=Cy(),w9=Jn(),Ay=it(),rf=Ta(),aT=Nt(),Kyt=Wa(),b9=Nr(),iT=$s();function Xyt(r,e,t){return w9(e)?Yyt(r,e,t):Jyt(r,e,t)}function Yyt(r,e,t){if(t=aT(t)?0:t,Ea(w9(e),"When sorting a DataFrame using a function, the first argument to the `sort` method must be a function!"),Ea(Ay(t),"When sorting a DataFrame using a function, the second argument to the `sort` method must be null, undefined, 0, or 1 to indicate the axis along which the data should be sorted! An axis of 0 means that the rows will be sorted relative to each other, whereas an axis of 1 means that the columns will be sorted relative to each other."),t===0){let n=iT(r.index,(a,i)=>e(r.get(a,null),r.get(i,null)));return r.get(n,null)}else{let n=iT(r.columns,(a,i)=>e(r.get(null,a),r.get(null,i)));return r.get(null,n)}}function Jyt(r,e,t){let n=r.copy(),a=Hyt().toString();return n=n.assign(a,n.index),aT(e)&&(e=[a],t=[!0]),(Ay(e)||rf(e))&&(e=[e],(nT(t)||rf(t))&&(t=[t])),Ea(y9(e),"The first parameter of the `sort` method must be (1) a string or index representing a column name or index, respectively; (2) a 1-dimensional array of strings and/or indices; or (3) null."),Ea(b9(e).length===1,"The first parameter of the `sort` method must be (1) a string or index representing a column name or index, respectively; (2) a 1-dimensional array of strings and/or indices; or (3) null."),aT(t)&&(t=Kyt(0,e.length).map(()=>!0)),Ea(y9(t),"The second parameter of the `sort` method must be (1) a string or boolean representing the sort direction ('ascending' / 'descending', or true / false); (2) a 1-dimensional array of strings and/or booleans; or (3) null."),Ea(b9(t).length===1,"The second parameter of the `sort` method must be (1) a string or boolean representing the sort direction ('ascending' / 'descending', or true / false); (2) a 1-dimensional array of strings and/or booleans; or (3) null."),Ea(e.length===t.length,"The arrays passed into the `sort` method must be equal in length."),e=e.map(i=>{if(Ea(rf(i)||Ay(i),"Column references can either be column names (as strings) or column indices (as whole numbers)."),rf(i)){let o=n.columns.indexOf(i);return Ea(o>-1,`The column "${i}" does not exist!`),o}if(Ay(i))return Ea(parseInt(i)===i,"Column indices must be whole numbers!"),Ea(i>=0,`The column index ${i} is out of bounds!`),Ea(i<n.columns.length,`The index ${i} is out of bounds!`),i}),t=t.map(i=>{if(Ea(rf(i)||nT(i),"Direction references can either be strings ('ascending' or 'descending') or booleans (true or false)."),rf(i)){let o=i.trim().toLowerCase();return Ea(o==="ascending"||o==="descending","Direction references can either be strings ('ascending' or 'descending') or booleans (true or false)."),o==="ascending"}if(nT(i))return i}),n.values=iT(n.values,(i,o)=>{let s=0;for(;i[e[s]]===o[e[s]]&&s<e.length;)s++;let u=t[s];if(i[e[s]]===o[e[s]])return 0;if(i[e[s]]<o[e[s]])return u?-1:1;if(i[e[s]]>o[e[s]])return u?1:-1}),n.index=jyt(n.get(null,a).values),n=n.dropColumns(a),n}x9.exports=Xyt});var oT=O((TCt,S9)=>{function Zyt(r,e){return JSON.stringify(r.toObject(e))}S9.exports=Zyt});var N9=O((ECt,uT)=>{var sT=Zl(),Qyt=oT();function e0t(r,e,t){let n=Qyt(r,t),a=!1,i=!1,o,s;try{let u=e;if(e.includes("/")){let l=e.split("/");u=l[l.length-1]}let c=document.createElement("a");c.href=`data:application/json;charset=utf-8,${encodeURIComponent(n)}`,c.download=u,c.dispatchEvent(new MouseEvent("click")),a=!0}catch(u){o=u}try{let u=hd("fs"),c=hd("path");u.writeFileSync(c.resolve(e),n,"utf8"),i=!0}catch(u){s=u}if(!a&&!i)throw typeof window<"u"?new sT(o):typeof uT<"u"?new sT(s):new sT("I don't know what's going wrong, but it doesn't seem like you're in Node or the browser, and we couldn't download and/or write the file to disk!");return r}uT.exports=e0t});var E9=O((ICt,T9)=>{var t0t=We(),r0t=Nt();function n0t(r,e){r0t(e)?e=0:t0t(e===0||e===1,"The axis parameter of the `toObject` method must be undefined, 0, or 1. An axis of 0 indicates that the returned object should be organized first by rows and then by columns. An axis of 1 indicates that the returned object should be organized first by columns and then by rows.");let t={};return e===0?r.index.forEach((n,a)=>{let i={};r.columns.forEach((o,s)=>{i[o]=r.values[a][s]}),t[n]=i}):r.columns.forEach((n,a)=>{let i={};r.index.forEach((o,s)=>{i[o]=r.values[s][a]}),t[n]=i}),t}T9.exports=n0t});var pc=O((CCt,A9)=>{var I9=We(),a0t=Ye(),i0t=vt(),o0t=pt(),s0t=zs(),C9=Gp(),u0t=Nr();function c0t(r){if(i0t(r)||o0t(r))return r.transpose();I9(a0t(r),"The `transpose` function only works on arrays, Series, and DataFrames!");let e=u0t(r);if(I9(e.length<=2,"I'm not smart enough to know how to transpose arrays that have more than 2 dimensions. Sorry for the inconvenience! Please only pass 1- or 2-dimensional arrays into the `transpose` function!"),e.length===1)return C9(r);if(e.length===2){let t=s0t(C9(e));for(let n=0;n<e[0];n++)for(let a=0;a<e[1];a++)t[a][n]=r[n][a];return t}}A9.exports=c0t});var R9=O((ACt,F9)=>{var D9=We(),l0t=Ye(),f0t=vt(),h0t=yy(),p0t=pt(),d0t=Nr();function _9(r,e,t){if(p0t(t))return new r(e.values.concat(t.values));if(l0t(t)){let n=d0t(t);D9(n.length===1&&!h0t(n),"Only vectors can be appended to Series!");let a=e.copy();return t.forEach((i,o)=>{a._values.push(i),a._index.push("item"+(e.values.length+o))}),a}return D9(!f0t(t),"DataFrames cannot be appended to Series!"),_9(e,[t])}F9.exports=_9});var P9=O((DCt,O9)=>{var v0t=We(),m0t=Jn();function g0t(r,e){v0t(m0t(e),"The parameter to the `apply` method must be a function.");let t=r.copy();return t._values=t._values.map((n,a)=>e(n,a)),t}O9.exports=g0t});var B9=O((_Ct,M9)=>{var y0t=Nt();function b0t(r){let e=r.copy(),t=[];return e._values=e.values.filter((n,a)=>y0t(n)?!1:(t.push(e.index[a]),!0)),e._index=t,e}M9.exports=b0t});var q9=O((FCt,L9)=>{var w0t=it();function x0t(r,e){let t=[],n=[];e.values.forEach((i,o)=>{w0t(i)&&(n.push(i),t.push(e.index[o]))});let a=new r(n);return a.name=e.name,a.index=t,a}L9.exports=x0t});var $9=O((RCt,z9)=>{var{copy:k0t}=Wo();function S0t(r,e,t){let n=e.copy(),a=k0t(n.index),i=[],o=n.values.filter((s,u)=>{let c=t(s,u,n.values);return c||i.push(n.index[u]),c});return i.forEach(s=>{a.splice(a.indexOf(s),1)}),o.length===0?(n=new r,n.name=e.name,n):(n.values=o,n.index=a,n)}z9.exports=S0t});var U9=O((OCt,W9)=>{var Vs=We(),N0t=it(),T0t=Ta(),E0t=Nt(),I0t=Gi();function C0t(r,e){(T0t(e)||N0t(e))&&(e=[e]);let t=I0t((e||[]).map(n=>typeof n));return Vs(t.length<=2,"Only whole numbers and/or strings are allowed in `get` arrays!"),t.length===1&&Vs(t[0]==="string"||t[0]==="number","Only whole numbers and/or strings are allowed in `get` arrays!"),t.length===2&&(Vs(t.indexOf("string")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!"),Vs(t.indexOf("number")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!")),E0t(e)||(e=e.map(n=>{if(typeof n=="string")return Vs(r.index.indexOf(n)>-1,`Index "${n}" does not exist!`),n;if(typeof n=="number")return Vs(n>=0,`Index ${n} is out of bounds!`),Vs(parseInt(n)===n,"Indices must be integers!"),Vs(n<r.index.length,`Index ${n} is out of bounds!`),r.index[n]})),r.getSubsetByNames(e)}W9.exports=C0t});var G9=O((PCt,V9)=>{var Jp=We(),A0t=Ye(),D0t=Nt(),_0t=Hp(),F0t=Wa(),R0t=Nr();function O0t(r,e){let t=r.shape;D0t(e)&&(e=F0t(0,t[0])),Jp(A0t(e),"The `indices` array must be 1-dimensional array of whole numbers."),Jp(R0t(e).length===1,"The `indices` array must be a 1-dimensional array of whole numbers."),Jp(e.length>0,"The `indices` array must contain at least one index."),e.forEach(a=>{Jp(_0t(a),"The `indices` array must be a 1-dimensional array of whole numbers."),Jp(a<r.index.length,`The row index ${a} is out of bounds.`)});let n=e.map(a=>r.index[a]);return r.getSubsetByNames(n)}V9.exports=O0t});var j9=O((MCt,H9)=>{var Zp=We(),P0t=Ye(),M0t=Ta(),B0t=Nt(),L0t=Nr();function q0t(r,e,t){B0t(t)&&(t=e.index),Zp(P0t(t),"The `indices` array must be a 1-dimensional array of strings."),Zp(L0t(t).length===1,"The `indices` array must be a 1-dimensional array of strings."),Zp(t.length>0,"The `indices` array must contain at least one index name."),t.forEach(i=>{Zp(M0t(i),"The `indices` array must contain only strings."),Zp(e.index.indexOf(i)>-1,`The name "${i}" does not exist in the index.`)});let n=t.map(i=>e.values[e.index.indexOf(i)]);if(n.length===1)return n[0];let a=new r(n);return a.index=t,a.name=e.name,a}H9.exports=q0t});var Y9=O((BCt,X9)=>{var{copy:z0t}=Wo(),K9=Wa();function $0t(r){let e=r.copy(),t=typeof window>"u"?20:10;if(e.index.length>t){e=e.get(K9(0,t/2).concat(K9(e.index.length-t/2,e.index.length)));let a=z0t(e.index);a.splice(parseInt(a.length/2),0,"..."),e.values.push("..."),e.index.push("..."),e=e.get(a)}let n={};return e.values.forEach((a,i)=>{let o={};o[e.name]=a,n[e.index[i]]=o}),console.table(n),console.log("Shape:",r.shape,`
`),r}X9.exports=$0t});var Z9=O((LCt,J9)=>{var W0t=Iy();function U0t(r){let e=r.copy();return e.get(W0t(e.index))}J9.exports=U0t});var eY=O((qCt,Q9)=>{var V0t=We(),G0t=Jn(),H0t=Nt(),j0t=$s(),K0t=pc();function X0t(r,e,t){t=t||((u,c)=>u<c?-1:1),V0t(H0t(t)||G0t(t),"You must pass undefined, null, or a comparison function as the second argument to the `sort` method!");let n=K0t([e.values,e.index]),a=j0t(n,(u,c)=>t(u[0],c[0])),i=[],o=[];a.forEach(u=>{i.push(u[0]),o.push(u[1])});let s=new r;return s._values=i,s._index=o,s.name=e.name,s}Q9.exports=X0t});var nY=O((zCt,rY)=>{var Y0t=$s(),tY=pc();function J0t(r,e){let t=tY([e.values,e.index]);t=tY(Y0t(t,(a,i)=>{if(a[1]===i[1])return 0;if(a[1]<i[1])return-1;if(a[1]>i[1])return 1}));let n=new r(t[0]);return n.index=t[1],n.name=e.name,n}rY.exports=J0t});var iY=O(($Ct,aY)=>{function Z0t(r){let e={};return e[r.name]={},r.index.forEach((t,n)=>{e[r.name][t]=r.values[n]}),e}aY.exports=Z0t});var lY=O((WCt,cY)=>{var{copy:Dy}=Wo(),Uo=We(),cT=Ye(),Q0t=Ta(),ebt=Nt(),oY=Ty(),sY=Wa(),_y=Gp(),tbt=R9(),rbt=P9(),nbt=B9(),abt=q9(),ibt=$9(),obt=U9(),sbt=G9(),ubt=j9(),cbt=Y9(),lbt=Z9(),fbt=eY(),hbt=nY(),pbt=iY(),Qp=Nr(),dbt=pc(),uY=Symbol.for("@jrc03c/js-math-tools/series");cY.exports=function(r){class e{static[Symbol.hasInstance](n){try{return!!n._symbol&&n._symbol===uY}catch{return!1}}constructor(n){let a=this;if(a.name="data",Object.defineProperty(a,"_symbol",{configurable:!1,enumerable:!1,writable:!1,value:uY}),Object.defineProperty(a,"_values",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(a,"values",{configurable:!0,enumerable:!0,get(){return a._values},set(i){Uo(cT(i),"The new values must be a 1-dimensional array!");let o=Qp(i);Uo(o.length===1,"The new array of values must be 1-dimensional!"),o[0]<a._index.length?a._index=a._index.slice(0,o[0]):o[0]>a._index.length&&(a._index=a._index.concat(sY(a._index.length,o[0]).map(s=>"item"+oY(s,(i.length-1).toString().length)))),a._values=i}}),Object.defineProperty(a,"_index",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(a,"index",{configurable:!0,enumerable:!0,get(){return a._index},set(i){Uo(cT(i),"The new index must be a 1-dimensional array of strings!"),Uo(i.length===a.shape[0],"The new index must be the same length as the old index!"),Uo(Qp(i).length===1,"The new index must be a 1-dimensional array of strings!"),i.forEach(o=>{Uo(Q0t(o),"All of the row names must be strings!")}),a._index=i}}),n){if(n instanceof e)a.name=n.name,a.values=Dy(n.values),a.index=Dy(n.index);else if(cT(n)){let i=Qp(n);Uo(i.length===1,"When passing an array into the constructor of a Series, the array must be 1-dimensional!"),a.values=n}else if(n instanceof Object){let i=Object.keys(n).concat(Object.getOwnPropertySymbols(n)).map(u=>u.toString());Uo(i.length===1,"When passing an object into the constructor of a Series, the object must have only 1 key-value pair, where the key is the name of the data and the value is the 1-dimensional array of values!");let o=i[0],s=n[o];Uo(Qp(s).length===1,"When passing an object into the constructor of a Series, the object must have only 1 key-value pair, where the key is the name of the data and the value is the 1-dimensional array of values!"),a.name=o,a.values=s.slice()}}}get shape(){return Qp(this.values)}get length(){return this.shape[0]}get isEmpty(){return this.values.filter(a=>!ebt(a)).length===0}clear(){let a=this.copy();return a.values.forEach((i,o)=>{a.values[o]=void 0}),a}get(n){return obt(this,n)}getSubsetByNames(n){return ubt(e,this,n)}getSubsetByIndices(n){return sbt(this,n)}loc(n){return this.getSubsetByNames(n)}iloc(n){return this.getSubsetByIndices(n)}reverse(){let n=this,a=new e(_y(n.values));return a.index=_y(n.index),a.name=n.name,a}resetIndex(){let n=this,a=n.copy();return a.index=sY(0,n.shape[0]).map(i=>"item"+oY(i,(a.index.length-1).toString().length)),a}copy(){let n=this,a=new e;return a._values=Dy(n.values),a._index=Dy(n.index),a.name=n.name,a}append(n){return tbt(e,this,n)}apply(n){return rbt(this,n)}concat(n){return this.append(n)}dropMissing(n,a){return nbt(this,n,a)}dropNaN(){return abt(e,this)}toObject(){return pbt(this)}print(){return cbt(this)}shuffle(){return lbt(this)}sort(n){return fbt(e,this,n)}sortByIndex(){return hbt(e,this)}filter(n){return ibt(e,this,n)}toDataFrame(){let n=this,a=new r(dbt([n.values]));return a.columns=[n.name],a.index=n.index,a}transpose(){let a=this.copy();return a.values=_y(a.values),a.index=_y(a.index),a}getDummies(){return this.toDataFrame().getDummies()}oneHotEncode(){return this.getDummies()}}return e}});var td=O((UCt,mY)=>{var{copy:lT}=Wo(),fo=We(),fY=Up(),vbt=J7(),mbt=rX(),gbt=oX(),ybt=uX(),bbt=vX(),wbt=yX(),xbt=kX(),kbt=EX(),Sbt=AX(),hY=PX(),Nbt=UX(),Tbt=KX(),Ebt=YX(),Ibt=QX(),Cbt=m9(),Abt=k9(),Dbt=N9(),_bt=oT(),Fbt=E9(),Rbt=Fr(),ed=Ye(),Obt=qs(),pY=Nt(),fT=Ty(),Pbt=zs(),hT=Wa(),nf=Nr(),dY=pc(),vY=Symbol.for("@jrc03c/js-math-tools/dataframe");function Fy(r){let e="abcdefghijklmnopqrstuvwxyz1234567890",t="";for(let n=0;n<r;n++)t+=e[parseInt(Math.random()*e.length)];return t}var dn=class{static[Symbol.hasInstance](e){try{return!!e._symbol&&e._symbol===vY}catch{return!1}}constructor(e){let t=this;if(Object.defineProperty(t,"_symbol",{configurable:!1,enumerable:!1,writable:!1,value:vY}),Object.defineProperty(t,"_values",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(t,"values",{configurable:!0,enumerable:!0,get(){return t._values.length===0||!pY(t._values[0])&&t._values[0].length===0?[[]]:t._values},set(n){fo(ed(n),"The new values must be a 2-dimensional array!");let a=nf(n);fo(a.length===2,"The new array of values must be 2-dimensional!"),a[0]<t._index.length?t._index=t._index.slice(0,a[0]):a[0]>t._index.length&&(t._index=t._index.concat(hT(t._index.length,a[0]).map(i=>"row"+fT(i,(a[0]-1).toString().length)))),a[1]<t._columns.length?t._columns=t._columns.slice(0,a[1]):a[1]>t._columns.length&&(t._columns=t._columns.concat(hT(t._columns.length,a[1]).map(i=>"col"+fT(i,(a[1]-1).toString().length)))),t._values=n}}),Object.defineProperty(t,"_columns",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(t,"columns",{configurable:!0,enumerable:!0,get(){return t._columns},set(n){fo(ed(n),"The new columns list must be a 1-dimensional array of strings!"),fo(t.isEmpty||n.length===t.shape[1],"The new columns list must be the same length as the old columns list!"),fo(nf(n).length===1,"The new columns list must be a 1-dimensional array of strings!"),n=n.map(i=>(typeof i!="string"&&(i=JSON.stringify(i)||i.toString()),i.trim().length===0?"untitled_"+Fy(8):i.trim()));let a=(()=>{let i=fY(n),o={};return i.forEach(s=>{o[s.value]=s.count}),o})();n=n.map(i=>a[i]>1?i+"_"+Fy(8):i),t._columns=n}}),Object.defineProperty(t,"_index",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(t,"index",{configurable:!0,enumerable:!0,get(){return t._index},set(n){fo(ed(n),"The new index must be a 1-dimensional array of strings!"),fo(t.isEmpty||n.length===t.shape[0],"The new index must be the same length as the old index!"),fo(nf(n).length===1,"The new index must be a 1-dimensional array of strings!"),n=n.map(i=>(typeof i!="string"&&(i=JSON.stringify(i)||i.toString()),i.trim().length===0?"untitled_"+Fy(8):i.trim()));let a=(()=>{let i=fY(n),o={};return i.forEach(s=>{o[s.value]=s.count}),o})();n=n.map(i=>a[i]>1?i+"_"+Fy(8):i),t._index=n}}),fo(pY(e)||Obt(e)||ed(e),"The `data` passed into the constructor of a DataFrame must be either (1) an object where the key-value pairs are (respectively) column names and 1-dimensional arrays of values, or (2) a 2-dimensional array of values."),e)if(e instanceof dn)t.values=lT(e.values),t.columns=lT(e.columns),t.index=lT(e.index);else if(ed(e)){let n=nf(e);fo(n.length===2,"The `data` array passed into the constructor of a DataFrame must be 2-dimensional!"),t.values=e}else{t._columns=Object.keys(e).concat(Object.getOwnPropertySymbols(e)).map(i=>i.toString());let n=[];t._columns.forEach(i=>{let o=e[i];n.push(o)}),t._values=dY(n);let a=nf(t.values);t._index=hT(0,a[0]).map(i=>"row"+fT(i,(a[0]-1).toString().length))}}get shape(){return nf(this.values)}get length(){return this.shape[0]}get width(){return this.shape[1]}get rows(){return this.index}set rows(e){let t=this;t.index=e}get isEmpty(){return Rbt(this.values).length===0}clear(){let e=this,t=new dn(Pbt(e.shape));return t.columns=e.columns.slice(),t.index=e.index.slice(),t}get(e,t){let n=this;if(arguments.length===0)return n;if(arguments.length===1)try{return n.get(null,e)}catch{return n.get(e,null)}return Sbt(n,e,t)}getSubsetByNames(e,t){return Tbt(dn,Gs,this,e,t)}getSubsetByIndices(e,t){return Nbt(this,e,t)}getDummies(e){return hY(dn,this,e)}oneHotEncode(e){return hY(dn,this,e)}transpose(){let e=this,t=new dn(dY(e.values));return t.columns=e.index.slice(),t.index=e.columns.slice(),t}get T(){return this.transpose()}resetIndex(e){return Ibt(this,e)}copy(){return ybt(dn,this)}assign(e,t){return gbt(dn,Gs,this,e,t)}apply(e,t){return mbt(dn,Gs,this,e,t)}dropMissing(e,t,n){return wbt(dn,Gs,this,e,t,n)}dropNaN(e,t,n){return xbt(dn,this,e,t,n)}drop(e,t){return bbt(dn,Gs,this,e,t)}dropColumns(e){return this.drop(null,e)}dropRows(e){return this.drop(e,null)}toObject(e){return Fbt(this,e)}toJSONString(e){return _bt(this,e)}saveAsJSON(e,t){return Dbt(this,e,t)}print(){return Ebt(dn,Gs,this)}sort(e,t){return Abt(this,e,t)}sortByIndex(){return this.sort()}filter(e,t){return kbt(dn,Gs,this,e,t)}shuffle(e){return Cbt(this,e)}append(e,t){return vbt(this,e,t)}concat(e,t){return this.append(e,t)}join(e,t){return this.append(e,t)}toString(){let e=this;return JSON.stringify(e)}},Gs=lY()(dn);mY.exports={DataFrame:dn,Series:Gs}});var af=O((VCt,yY)=>{var Mbt=We(),Bbt=Fr(),Lbt=Ye(),qbt=vt(),zbt=pt();function gY(r){if(qbt(r)||zbt(r))return gY(r.values);Mbt(Lbt(r),"The `max` function only works on arrays, Series, and DataFrames!");try{return Math.max(...Bbt(r))}catch{return NaN}}yY.exports=gY});var Yt=O((GCt,SY)=>{var{DataFrame:bY,Series:wY}=td(),xY=We(),rd=Ye(),pT=vt(),kY=Vi(),$bt=Jn(),dT=pt(),Wbt=af(),Ubt=Wa(),Ry=Nr();function Vbt(r){return rd(r)||dT(r)||pT(r)}function Gbt(r){return xY($bt(r),"You must pass a function into the `vectorize` function!"),function e(){let t,n,a=[],i=[],o=Object.keys(arguments).filter(s=>{let u=arguments[s];return rd(u)?!0:dT(u)?(t=!0,a.push(u),!0):pT(u)?(n=!0,i.push(u),!0):!1}).map(s=>arguments[s]);if(o.slice(0,-1).forEach((s,u)=>{xY(kY(rd(s)?Ry(s):s.shape,rd(o[u+1])?Ry(o[u+1]):o[u+1].shape),`When passing multiple arrays into the \`${r.name}\` function, all of the arrays must have the same shape!`)}),o.length>0){let s=Wbt(o.map(c=>c.length?c.length:c.values.length)),u=Ubt(0,s).map(c=>{let l=Object.keys(arguments).map(f=>{if(Vbt(arguments[f])){if(rd(arguments[f]))return arguments[f][c];if(dT(arguments[f]))return arguments[f].values[c];if(pT(arguments[f]))return arguments[f].values[c]}else return arguments[f]});return e(...l)});if(n)try{if(i.length===1&&kY(Ry(i[0]),Ry(u))){let c=new bY(u);return c.index=i[0].index.slice(),c.columns=i[0].columns.slice(),c}else return new bY(u)}catch{return u}if(t)try{if(a.length===1&&a[0].length===u.length){let c=new wY(u);return c.name=a[0].name,c.index=a[0].index.slice(),c}else return new wY(u)}catch{return u}return u}else return r(...arguments)}}SY.exports=Gbt});var Oy=O((HCt,NY)=>{var Hbt=it(),jbt=Yt();function Kbt(r){try{return Hbt(r)?Math.abs(r):NaN}catch{return NaN}}NY.exports=jbt(Kbt)});var Py=O((jCt,TY)=>{var Xbt=it(),Ybt=Yt();function Jbt(){try{let r=0,e=Object.values(arguments);for(let t=0;t<e.length;t++){if(!Xbt(e[t]))return NaN;r+=e[t]}return r}catch{return NaN}}TY.exports=Ybt(Jbt)});var nd=O((KCt,EY)=>{var Zbt=Yt();function Qbt(r,e){try{return e(r)}catch{return NaN}}EY.exports=Zbt(Qbt)});var CY=O((XCt,IY)=>{var ewt=it(),twt=Yt();function rwt(r){try{return ewt(r)?Math.acos(r):NaN}catch{return NaN}}IY.exports=twt(rwt)});var DY=O((YCt,AY)=>{var nwt=it(),awt=Yt();function iwt(r){try{return nwt(r)?Math.asin(r):NaN}catch{return NaN}}AY.exports=awt(iwt)});var FY=O((JCt,_Y)=>{var owt=it(),swt=Yt();function uwt(r){try{return owt(r)?Math.atan(r):NaN}catch{return NaN}}_Y.exports=swt(uwt)});var OY=O((ZCt,RY)=>{var cwt=We(),lwt=qp(),fwt=Ye(),hwt=vt(),pwt=pt(),dwt=af();function vT(r){if(hwt(r)){let e=vT(r.values);return[r.index[e[0]],r.columns[e[1]]]}if(pwt(r)){let e=vT(r.values);return[r.index[e]]}cwt(fwt(r),"The `argmax` function only works on arrays, Series, and DataFrames!");try{let e=lwt(r,dwt(r));return e?e.length===0?void 0:e.length===1?e[0]:e:void 0}catch{return}}RY.exports=vT});var My=O((QCt,MY)=>{var vwt=We(),mwt=Fr(),gwt=Ye(),ywt=vt(),bwt=pt();function PY(r){if(ywt(r)||bwt(r))return PY(r.values);vwt(gwt(r),"The `min` function only works on arrays, Series, and DataFrames!");try{return Math.min(...mwt(r))}catch{return NaN}}MY.exports=PY});var LY=O((eAt,BY)=>{var wwt=We(),xwt=qp(),kwt=Ye(),Swt=vt(),Nwt=pt(),Twt=My();function mT(r){if(Swt(r)){let e=mT(r.values);return[r.index[e[0]],r.columns[e[1]]]}if(Nwt(r)){let e=mT(r.values);return[r.index[e]]}wwt(kwt(r),"The `argmin` function only works on arrays, Series, and DataFrames!");try{let e=xwt(r,Twt(r));return e?e.length===0?void 0:e.length===1?e[0]:e:void 0}catch{return}}BY.exports=mT});var wT=O((tAt,$Y)=>{var qY=Ye(),gT=Cy(),Ewt=vt(),yT=$p(),Iwt=Vi(),zY=it(),Cwt=qs(),Awt=pt(),bT=Nt();function Vo(r,e){if(Ewt(r)||Awt(r))return r.apply(t=>Vo(t,e));if(qY(r))return r.map(t=>Vo(t,e));if(e==="null")return null;if(e==="number"){if(bT(r))return NaN;let t=Vo(r,"boolean");if(gT(t))return t?1:0;try{JSON.parse(r)}catch{let i=Vo(r,"date");if(yT(i))return i.getTime()}let n=parseFloat(r);return isNaN(n)?NaN:n}if(e==="boolean"){if(gT(r))return r;if(zY(r))return r===0?!1:r===1?!0:null;try{let t=(typeof r=="object"?r.toString()==="null"?"false":JSON.stringify(r):r.toString()).trim().toLowerCase();return t==="true"||t==="yes"||t==="y"?!0:t==="false"||t==="no"||t==="n"?!1:null}catch{return null}}if(e==="date"){if(yT(r))return r;if(bT(r))return null;let t=parseFloat(r);if(!isNaN(t)){let a=new Date(r);return yT(a)?a:null}let n=Date.parse(r);return isNaN(n)?null:new Date(n)}if(e==="object"){if(Cwt(r))return r;let t=Vo(r,"boolean");if(gT(t))return null;try{let a=Vo(r,"number");if(zY(a))return JSON.parse(r),null}catch{}let n=Vo(r,"date");if(n)return n;try{let a=JSON.parse(r);return qY(a)?a.map(i=>Vo(i,e)):a}catch{return null}}if(e==="string")return bT(r)?Iwt(r,void 0)?"undefined":"null":r instanceof Date?r.toJSON():(()=>typeof r=="object"?r===null?"null":JSON.stringify(r):r.toString())()}$Y.exports=Vo});var UY=O((rAt,WY)=>{var Dwt=it(),_wt=Yt();function Fwt(r){try{return Dwt(r)?Math.ceil(r):NaN}catch{return NaN}}WY.exports=_wt(Fwt)});var HY=O((nAt,GY)=>{var Rwt=Oy(),VY=it(),Owt=Nt(),Pwt=Yt();function Mwt(r,e){try{if(!VY(r))return NaN;if(Owt(e))e=1e-10;else if(!VY(e))return NaN;return Rwt(r)<e?0:r}catch{return NaN}}GY.exports=Pwt(Mwt)});var KY=O((aAt,jY)=>{var xT=it(),Bwt=Yt();function Lwt(r,e,t){try{return xT(r)?xT(e)?xT(t)?r<e?e:r>t?t:r:NaN:NaN:NaN}catch{return NaN}}jY.exports=Bwt(Lwt)});var YY=O((iAt,XY)=>{var kT=We(),qwt=Fr(),zwt=Ye(),$wt=vt(),Wwt=it(),Uwt=pt();function ST(r,e){if($wt(r)||Uwt(r))return ST(r.values,e);if(kT(zwt(r),"The `combinations` function only works on arrays, Series, and DataFrames!"),kT(Wwt(e),"`r` must be a whole number!"),r=qwt(r),e>r.length)return[r];if(e<=0)return[[]];if(kT(e===parseInt(e),"`r` must be a whole number!"),r.length<2)return r;let t=[];return r.forEach((n,a)=>{let i=r.slice(a+1);if(i.length<e-1)return;ST(i,e-1).forEach(s=>{t.push([n].concat(s))})}),t}XY.exports=ST});var By=O((oAt,ZY)=>{var Vwt=We(),Gwt=Fr(),Hwt=Ye(),jwt=vt(),Kwt=pt();function JY(r){if(jwt(r)||Kwt(r))return JY(r.values);Vwt(Hwt(r),"The `mean` function only works on arrays, Series, and DataFrames!");try{let e=Gwt(r),t=0;return e.forEach(n=>{t+=n}),t/e.length}catch{return NaN}}ZY.exports=JY});var TT=O((sAt,aJ)=>{var QY=We(),eJ=Ye(),Ly=it(),tJ=pt(),rJ=By(),nJ=Nr();function NT(r,e){if(tJ(r))return NT(r.values,e);if(tJ(e))return NT(r,e.values);QY(eJ(r)&&eJ(e)&&nJ(r).length===1&&nJ(e).length===1,"The `covariance` function only works on 1-dimensional arrays and Series!"),QY(r.length===e.length,"The two arrays or Series passed into the `covariance` function must have the same length!");try{let t=rJ(r),n=rJ(e);if(!Ly(t)||!Ly(n))return NaN;let a=Math.max(r.length,e.length),i=0;for(let o=0;o<a;o++){if(!Ly(r[o]))return NaN;if(!Ly(e[o]))return NaN;i+=(r[o]-t)*(e[o]-n)}return i/r.length}catch{return NaN}}aJ.exports=NT});var qy=O((uAt,iJ)=>{var Xwt=it(),Ywt=Yt();function Jwt(r){try{return Xwt(r)?Math.sqrt(r):NaN}catch{return NaN}}iJ.exports=Ywt(Jwt)});var ET=O((cAt,sJ)=>{var Zwt=We(),Qwt=Fr(),e1t=Ye(),t1t=vt(),r1t=it(),n1t=pt(),a1t=By();function oJ(r){if(t1t(r)||n1t(r))return oJ(r.values);Zwt(e1t(r),"The `variance` function only works on arrays, Series, and DataFrames!");try{let e=Qwt(r),t=a1t(e),n=0;for(let a=0;a<e.length;a++){if(!r1t(e[a]))return NaN;n+=(e[a]-t)*(e[a]-t)}return n/e.length}catch{return NaN}}sJ.exports=oJ});var zy=O((lAt,cJ)=>{var i1t=We(),o1t=Ye(),s1t=vt(),u1t=pt(),c1t=qy(),l1t=ET();function uJ(r){if(s1t(r)||u1t(r))return uJ(r.values);i1t(o1t(r),"The `std` function only works on arrays, Series, and DataFrames!");try{return c1t(l1t(r))}catch{return NaN}}cJ.exports=uJ});var mJ=O((fAt,vJ)=>{var lJ=We(),f1t=TT(),fJ=Ye(),hJ=pt(),pJ=Nr(),dJ=zy();function IT(r,e){if(hJ(r))return IT(r.values,e);if(hJ(e))return IT(r,e.values);lJ(fJ(r)&&fJ(e)&&pJ(r).length===1&&pJ(e).length===1,"The `correl` function only works on 1-dimensional arrays and Series!"),lJ(r.length===e.length,"The two arrays or Series passed into the `correl` function must have the same length!");try{return f1t(r,e)/(dJ(r)*dJ(e))}catch{return NaN}}vJ.exports=IT});var yJ=O((hAt,gJ)=>{var h1t=it(),p1t=Yt();function d1t(r){try{return h1t(r)?Math.cos(r):NaN}catch{return NaN}}gJ.exports=p1t(d1t)});var wJ=O((pAt,bJ)=>{bJ.exports=Object.freeze({boolean:"boolean",date:"date",null:"null",number:"number",object:"object",string:"string"})});var EJ=O((dAt,TJ)=>{var v1t=We(),xJ=Ye(),kJ=vt(),m1t=Vi(),SJ=pt(),NJ=Gi();function CT(r,e){if(kJ(r)||SJ(r))return CT(r.values,e);if(kJ(e)||SJ(e))return CT(r,e.values);v1t(xJ(r)&&xJ(e),"The `diff` function only works on arrays, Series, and DataFrames!");let t=NJ(r),n=NJ(e),a=[];return t.forEach(i=>{n.findIndex(o=>m1t(o,i))<0&&a.push(i)}),a}TJ.exports=CT});var $y=O((vAt,CJ)=>{var IJ=it(),g1t=Yt();function y1t(r,e){try{return IJ(r)?IJ(e)?Math.pow(r,e):NaN:NaN}catch{return NaN}}CJ.exports=g1t(y1t)});var AT=O((mAt,AJ)=>{var b1t=it(),w1t=Yt();function x1t(){try{let r=Object.values(arguments);if(r.length===0)return NaN;let e=1;for(let t=0;t<r.length;t++){if(!b1t(r[t]))return NaN;e*=r[t]}return e}catch{return NaN}}AJ.exports=w1t(x1t)});var of=O((gAt,DJ)=>{var k1t=AT();function S1t(){return k1t(...arguments)}DJ.exports=S1t});var DT=O((yAt,_J)=>{var N1t=Py(),T1t=of();function E1t(r,e){return N1t(r,T1t(e,-1))}_J.exports=E1t});var Wy=O((bAt,RJ)=>{var I1t=We(),C1t=Fr(),A1t=Ye(),D1t=vt(),_1t=pt();function FJ(r){if(D1t(r)||_1t(r))return FJ(r.values);I1t(A1t(r),"The `sum` function only works on arrays, Series, and DataFrames!");try{return r.length===0?NaN:C1t(r).reduce((e,t)=>e+t,0)}catch{return NaN}}RJ.exports=FJ});var zJ=O((wAt,qJ)=>{var F1t=Oy(),R1t=We(),OJ=Ye(),PJ=vt(),O1t=Vi(),MJ=it(),BJ=pt(),P1t=$y(),LJ=Nr(),M1t=qy(),B1t=DT(),L1t=Wy();function _T(r,e){if(MJ(r)&&MJ(e))return F1t(r-e);if(PJ(r)||BJ(r))return _T(r.values,e);if(PJ(e)||BJ(e))return _T(r,e.values);OJ(r)&&OJ(e)&&R1t(O1t(LJ(r),LJ(e)),"If passing two arrays, Series, or DataFrames into the `distance` function, then those objects must have the same shape!");try{return M1t(L1t(P1t(B1t(r,e),2)))}catch{return NaN}}qJ.exports=_T});var WJ=O((xAt,$J)=>{var q1t=$y(),z1t=of();function $1t(r,e){return z1t(r,q1t(e,-1))}$J.exports=$1t});var RT=O((kAt,KJ)=>{var{DataFrame:UJ,Series:VJ}=td(),Uy=We(),GJ=Fr(),HJ=Ye(),FT=vt(),W1t=it(),Vy=pt(),U1t=of(),Gy=Nr(),V1t=Wy(),jJ=pc();function Hs(r,e){if(FT(r)){let a=Hs(r.values,e);if(Gy(a).length===1){let i=new VJ(a);return i.name=Vy(e)?e.name:i.name,i.index=r.index.slice(),i}else{let i=new UJ(a);return i.index=r.index.slice(),FT(e)&&(i.columns=e.columns.slice()),i}}if(FT(e)){let a=Hs(r,e.values);if(Gy(a).length===1){let i=new VJ(a);return i.name=Vy(r)?r.name:i.name,i.index=e.columns.slice(),i}else{let i=new UJ(a);return i.columns=e.columns.slice(),i}}if(Vy(r))return Hs(r.values,e);if(Vy(e))return Hs(r,e.values);Uy(HJ(r)&&HJ(e),"The `dot` function only works on arrays, Series, and DataFrames!"),GJ(r).concat(GJ(e)).forEach(a=>{Uy(W1t(a),"One of the arrays you passed into the `dot` function contains non-numerical values!")});let t=Gy(r),n=Gy(e);if(Uy(t.length<=2&&n.length<=2,"I'm not smart enough to know how to get the dot-product of arrays that have more than 2 dimensions. Sorry for the inconvenience! Please only pass 1- or 2-dimensional arrays into the `dot` function!"),Uy(t[t.length-1]===n[0],`There's a dimension misalignment in the two arrays you passed into the \`dot\` function. (${t[t.length-1]} !== ${n[0]})`),t.length===1&&n.length===1)return V1t(U1t(r,e));if(t.length===1&&n.length===2)return jJ(e).map(a=>Hs(r,a));if(t.length===2&&n.length===1)return r.map(a=>Hs(a,e));if(t.length===2&&n.length===2){let a=jJ(e),i=[];for(let o=0;o<r.length;o++){let s=[];for(let u=0;u<a.length;u++)s.push(Hs(r[o],a[u]));i.push(s)}return i}}KJ.exports=Hs});var OT=O((SAt,YJ)=>{var G1t=We(),H1t=Ye(),j1t=vt(),K1t=pt(),X1t=Nt();function XJ(r){if(j1t(r)||K1t(r))return r.dropMissing(...Object.values(arguments).slice(1));G1t(H1t(r),"The `dropMissing` function only works on arrays, Series, and DataFrames!");let e=[];return r.forEach(t=>{try{return e.push(XJ(t))}catch{X1t(t)||e.push(t)}}),e}YJ.exports=XJ});var aZ=O((NAt,nZ)=>{var JJ=We(),ZJ=Ye(),QJ=vt(),Y1t=Vi(),eZ=pt(),tZ=Nt(),rZ=Nr();function Hy(r,e){if(QJ(r)||eZ(r))return Hy(r.values,e);if(QJ(e)||eZ(e))return Hy(r,e.values);JJ(ZJ(r)&&ZJ(e),"The `dropMissingPairwise` function only works on arrays, Series, and DataFrames!"),JJ(Y1t(rZ(r),rZ(e)),"The two arrays, Series, and/or DataFrames passed into the `dropMissingPairwise` function must have the same shape!");let t=[],n=[];for(let a=0;a<r.length;a++)try{let[i,o]=Hy(r[a],e[a]);t.push(i),n.push(o)}catch{!tZ(r[a])&&!tZ(e[a])&&(t.push(r[a]),n.push(e[a]))}return[t,n]}nZ.exports=Hy});var hZ=O((TAt,fZ)=>{var iZ=We(),oZ=Ye(),sZ=vt(),J1t=Vi(),uZ=it(),cZ=pt(),lZ=Nr();function jy(r,e){if(sZ(r)||cZ(r))return jy(r.values,e);if(sZ(e)||cZ(e))return jy(r,e.values);iZ(oZ(r)&&oZ(e),"The `dropNaNPairwise` only works on arrays, Series, and DataFrames!"),iZ(J1t(lZ(r),lZ(e)),"The two arrays, Series, and/or DataFrames passed into the `dropNaNPairwise` must have the same shape!");let t=[],n=[];for(let a=0;a<r.length;a++)try{let[i,o]=jy(r[a],e[a]);t.push(i),n.push(o)}catch{uZ(r[a])&&uZ(e[a])&&(t.push(r[a]),n.push(e[a]))}return[t,n]}fZ.exports=jy});var dZ=O((EAt,pZ)=>{var Z1t=OT();function Q1t(r){return Z1t(r)}pZ.exports=Q1t});var mZ=O((IAt,vZ)=>{var ext=it(),txt=Yt();function rxt(r){try{return ext(r)?Math.exp(r):NaN}catch{return NaN}}vZ.exports=txt(rxt)});var bZ=O((CAt,yZ)=>{var nxt=Yt();function gZ(r){try{return r!==parseInt(r)?NaN:r<=1?1:r*gZ(r-1)}catch{return NaN}}yZ.exports=nxt(gZ)});var SZ=O((AAt,kZ)=>{var axt=We(),ixt=Fr(),wZ=Ye(),oxt=vt(),sxt=Jn(),xZ=qs(),uxt=pt();function PT(r,e){if(oxt(r))return PT(ixt(r.values),e);if(uxt(r))return PT(r.values,e);if(axt(xZ(r)||wZ(r),"You must pass (1) an object, array, Series, or DataFrame and (2) a function or value into the `find` function!"),!sxt(e)){let a=e;e=i=>i===a}function t(a,i,o){if(o=o||[],o.indexOf(a)>-1)return null;if(xZ(a)){o.push(a);let s=Object.keys(a).concat(Object.getOwnPropertySymbols(a));for(let u=0;u<s.length;u++){let c=s[u],l=a[c];if(i(l))return l;let f=t(l,i,o);if(f)return f}}else if(wZ(a)){o.push(a);for(let s=0;s<a.length;s++){let u=a[s];if(i(u))return u;let c=t(u,i,o);if(c)return c}}else if(i(a))return a;return null}function n(a){try{return e(a)}catch{return!1}}return t(r,n)}kZ.exports=PT});var IZ=O((DAt,EZ)=>{var cxt=We(),lxt=Fr(),NZ=Ye(),fxt=vt(),hxt=Jn(),TZ=qs(),pxt=pt();function MT(r,e){if(fxt(r))return MT(lxt(r.values),e);if(pxt(r))return MT(r.values,e);if(cxt(TZ(r)||NZ(r),"You must pass (1) an object, array, Series, or DataFrame and (2) a function or value into the `findAll` function!"),!hxt(e)){let i=e;e=o=>o===i}function t(i,o,s){if(s=s||[],s.indexOf(i)>-1)return null;if(TZ(i)){s.push(i);let u=Object.keys(i).concat(Object.getOwnPropertySymbols(i)),c=[];for(let l=0;l<u.length;l++){let f=u[l],h=i[f],p=!1;o(h)&&(c.push(h),p=!0);let d=t(h,o,s);d&&d.length>0&&d.slice(p?1:0).forEach(m=>c.push(m))}return c}else if(NZ(i)){s.push(i);let u=[];for(let c=0;c<i.length;c++){let l=i[c],f=!1;o(l)&&(u.push(l),f=!0);let h=t(l,o,s);h&&h.length>0&&h.slice(f?1:0).forEach(p=>u.push(p))}return u}else if(o(i))return[i];return null}function n(i){try{return e(i)}catch{return!1}}let a=t(r,n);return a&&a.length>0?a:null}EZ.exports=MT});var AZ=O((_At,CZ)=>{var dxt=it(),vxt=Yt();function mxt(r){try{if(r==="Infinity")return 1/0;if(r==="-Infinity")return-1/0;let e=JSON.parse(r);return dxt(e)?e:NaN}catch{return NaN}}CZ.exports=vxt(mxt)});var _Z=O((FAt,DZ)=>{var gxt=it(),yxt=Yt();function bxt(r){try{return gxt(r)?Math.floor(r):NaN}catch{return NaN}}DZ.exports=yxt(bxt)});var BT=O((RAt,FZ)=>{var wxt=it(),xxt=Xp(),kxt=Ey();function Sxt(r){wxt(r)&&(r=[r]);let e=[],t=xxt(r);for(let n=0;n<t;n++)e.push(0);return kxt(e,r)}FZ.exports=Sxt});var OZ=O((OAt,RZ)=>{var Ky=We(),Nxt=it(),Txt=Nt(),Ext=BT();function Ixt(r){Ky(!Txt(r),"You must pass an integer greater than 0 (representing the size) into the `identity` function!"),Ky(Nxt(r),"You must pass an integer greater than 0 (representing the size) into the `identity` function!"),Ky(parseInt(r)===r,"You must pass an integer greater than 0 (representing the size) into the `identity` function!"),Ky(r>0,"You must pass an integer greater than 0 (representing the size) into the `identity` function!");let e=Ext([r,r]);for(let t=0;t<r;t++)e[t][t]=1;return e}RZ.exports=Ixt});var MZ=O((PAt,PZ)=>{PZ.exports=["true","false","yes","no"]});var LZ=O((MAt,BZ)=>{BZ.exports=["null","none","nan","na","n/a","","undefined"]});var UZ=O((BAt,WZ)=>{var Cxt=nd(),Axt=We(),Dxt=MZ(),_xt=wT(),Fxt=Up(),zZ=Fr(),LT=Ye(),Rxt=vt(),qZ=$p(),$Z=it(),Oxt=pt(),Pxt=Ta(),Mxt=LZ();function Xy(r){return r.type==="number"&&(typeof r.value<"u"?r.isInteger=parseInt(r.value)===r.value:r.isInteger=zZ(r.values).every(e=>$Z(e)?parseInt(e)===e:!0)),r}function Yy(r){if(Rxt(r)){let a=r.copy(),i=Yy(r.values);return a.values=i.values,Xy({type:i.type,values:a})}if(Oxt(r)){let a=r.copy(),i=Yy(r.values);return a.values=i.values,Xy({type:i.type,values:a})}if(!LT(r)){let a=Yy([r]);return a.value=a.values[0],delete a.values,Xy(a)}Axt(LT(r),"The `inferType` function only works on arrays, Series, and DataFrames!");let e=zZ(r).map(a=>{if(a===void 0)return"null";try{if(typeof a=="object"){let s=new Date(a.getTime());if(qZ(s))return"date"}}catch{}Pxt(a)||(a=JSON.stringify(a));let o=a.toLowerCase().trim();if(Mxt.indexOf(o)>-1)return"null";if(Dxt.indexOf(o)>-1)return"boolean";try{let s=JSON.parse(a);return $Z(s)?"number":typeof s=="object"?LT(s)?"string":"object":"string"}catch{let u=new Date(a);return qZ(u)?"date":"string"}}),n=Fxt(e).sort((a,i)=>i.count-a.count)[0].value;return Xy({type:n,values:Cxt(r,a=>_xt(a,n))})}WZ.exports=Yy});var GZ=O((LAt,VZ)=>{var Bxt=it(),Lxt=Yt();function qxt(r){try{let e=JSON.parse(r);return Bxt(e)?parseInt(e):NaN}catch{return NaN}}VZ.exports=Lxt(qxt)});var jZ=O((qAt,HZ)=>{var zxt=We(),$xt=Ye(),Wxt=vt(),Uxt=Vi(),Vxt=pt(),qT=Gi();function Gxt(){let r=Object.values(arguments).map(t=>Wxt(t)||Vxt(t)?qT(t.values):(zxt($xt(t),"The `intersect` function only works on arrays, Series, and DataFrames!"),qT(t)));return qT(r).filter(t=>r.every(n=>n.findIndex(a=>Uxt(a,t))>-1))}HZ.exports=Gxt});var JZ=O((zAt,YZ)=>{var KZ=Py(),js=We(),Hxt=RT(),jxt=Fr(),Kxt=Ye(),Xxt=vt(),zT=it(),XZ=of(),Yxt=Nr();function Jy(r){if(Xxt(r)){let t=r.copy();return t.values=Jy(t.values),t}js(Kxt(r),"The `inverse` function only works on square 2-dimensional arrays or DataFrames!"),jxt(r).forEach(t=>js(zT(t),"The array passed into the `inverse` function must contain only numbers!"));let e=Yxt(r);if(js(e.length===2,"The array passed into the `inverse` function must be exactly two-dimensional and square!"),js(e[0]===e[1],"The array passed into the `inverse` function must be exactly two-dimensional and square!"),js(e[0]>=0,"The array passed into the `inverse` function must be exactly two-dimensional and square!"),e[0]===0)return r;if(e[0]===1)return js(r[0][0]!==0,"This matrix cannot be inverted!"),1/r[0][0];if(e[0]===2){let t=r[0][0],n=r[0][1],a=r[1][0],i=r[1][1],o=t*i-n*a;js(o!==0,"This matrix cannot be inverted!");let s=[[i,-n],[-a,t]];return XZ(s,1/o)}else if(e[0]>1){let t=(n,a)=>zT(n)||zT(a)?XZ(n,a):Hxt(n,a);for(let n=1;n<e[0]-1;n++)try{let a=r.slice(0,n).map(m=>m.slice(0,n)),i=r.slice(0,n).map(m=>m.slice(n,e[0])),o=r.slice(n,e[0]).map(m=>m.slice(0,n)),s=r.slice(n,e[0]).map(m=>m.slice(n,e[0])),u=Jy(a),c=Jy(KZ(s,t(-1,t(t(o,u),i)))),l=KZ(u,t(t(t(t(u,i),c),o),u)),f=t(-1,t(t(u,i),c)),h=t(-1,t(t(c,o),u)),p=c;return l.map((m,v)=>m.concat(f[v])).concat(h.map((m,v)=>m.concat(p[v])))}catch{}js(!1,"This matrix cannot be inverted!")}}YZ.exports=Jy});var QZ=O(($At,ZZ)=>{var Jxt=new Function(`
    try {
      return this === window
    } catch(e) {}

    try {
      return !!importScripts
    } catch(e){}

    return false
  `);ZZ.exports=Jxt});var tQ=O((WAt,eQ)=>{var $T=it(),Zxt=Yt();function Qxt(r,e,t){try{return $T(r)?$T(e)?$T(t)?t*(e-r)+r:NaN:NaN:NaN}catch{return NaN}}eQ.exports=Zxt(Qxt)});var aQ=O((UAt,nQ)=>{var rQ=it(),ekt=Nt(),tkt=Yt();function rkt(r,e){try{return e=ekt(e)?Math.E:e,rQ(r)?rQ(e)?Math.log(r)/Math.log(e):NaN:NaN}catch{return NaN}}nQ.exports=tkt(rkt)});var sQ=O((VAt,oQ)=>{var nkt=We(),akt=Fr(),ikt=Ye(),okt=vt(),skt=pt(),ukt=$s();function iQ(r){if(okt(r)||skt(r))return iQ(r.values);nkt(ikt(r),"The `median` function only works on arrays, Series, and DataFrames!");try{let e=ukt(akt(r));return e.length===0?NaN:e.length%2===0?(e[e.length/2-1]+e[e.length/2])/2:e[parseInt(e.length/2)]}catch{return NaN}}oQ.exports=iQ});var lQ=O((GAt,cQ)=>{var uQ=it(),ckt=Yt();function lkt(r,e){try{return uQ(r)?uQ(e)?r%e:NaN:NaN}catch{return NaN}}cQ.exports=ckt(lkt)});var dQ=O((HAt,pQ)=>{var fkt=We(),hkt=Up(),pkt=Fr(),dkt=Ye(),vkt=vt(),mkt=pt(),gkt=Gi(),fQ=$s();function hQ(r){if(vkt(r)||mkt(r))return hQ(r.values);fkt(dkt(r),"The `mode` function only works on arrays, Series, and DataFrames!");try{if(r.length===0)return NaN;let e=pkt(r);if(e.length===0)return NaN;let t={},n=gkt(e);n.forEach(s=>{t[s]=hkt(e,s)});let a=fQ(n,(s,u)=>t[u]-t[s]),i=a[0];return fQ(a.filter(s=>t[s]===t[i]))}catch{return NaN}}pQ.exports=hQ});var yQ=O((jAt,gQ)=>{var{random:vQ}=tf(),ykt=nd(),bkt=Nt(),wkt=zs();function mQ(){let r=vQ(),e=vQ();return Math.sqrt(-2*Math.log(r))*Math.cos(2*Math.PI*e)}function xkt(r){return bkt(r)?mQ():ykt(wkt(r),mQ)}gQ.exports=xkt});var wQ=O((KAt,bQ)=>{var kkt=nd(),Skt=zs();function Nkt(r){return kkt(Skt(r),()=>1)}bQ.exports=Nkt});var kQ=O((XAt,xQ)=>{var WT=We(),Tkt=Fr(),Ekt=Ye(),Ikt=vt(),Ckt=it(),Akt=pt(),Dkt=Nt();function Zy(r,e){if(Ikt(r)||Akt(r))return Zy(r.values,e);if(WT(Ekt(r),"The `permutations` function only works on arrays, Series, and DataFrames!"),Dkt(e)&&(e=r.length),WT(Ckt(e),"`r` must be a whole number!"),r=Tkt(r),e>r.length)return Zy(r);if(e<=0)return[[]];if(WT(e===parseInt(e),"`r` must be a whole number!"),r.length<2)return r;let t=[];return r.forEach((n,a)=>{let i=r.slice(0,a),o=r.slice(a+1),s=i.concat(o);Zy(s,e-1).forEach(c=>{t.push([n].concat(c))})}),t}xQ.exports=Zy});var NQ=O((YAt,SQ)=>{var{DataFrame:_kt,Series:Fkt}=td(),Rkt=Ye(),Okt=vt(),Pkt=Vp(),Mkt=pt(),Bkt=Nr();function Lkt(){Object.keys(arguments).forEach(r=>{let e=arguments[r];if(Rkt(e))if(Pkt(e))console.log(e);else{let t=Bkt(e);t.length===1?new Fkt(e).print():t.length==2?new _kt(e).print():console.log(e)}else Okt(e)||Mkt(e)?e.print():console.log(e)})}SQ.exports=Lkt});var IQ=O((JAt,EQ)=>{var qkt=Ye(),zkt=it(),TQ=Nt(),$kt=af(),Wkt=My(),Ukt=Yt(),Vkt=Ukt(function(r,e,t,n,a){try{return[r,e,t,n,a].every(i=>zkt(i))?t-e===0?NaN:(a-n)*(r-e)/(t-e)+n:NaN}catch{return NaN}});function Gkt(r,e,t,n,a){return qkt(r)&&TQ(n)&&TQ(a)&&(n=e,a=t,e=Wkt(r),t=$kt(r)),Vkt(r,e,t,n,a)}EQ.exports=Gkt});var AQ=O((ZAt,CQ)=>{var Hkt=it(),jkt=Yt();function Kkt(r){try{return Hkt(r)?Math.round(r):NaN}catch{return NaN}}CQ.exports=jkt(Kkt)});var _Q=O((QAt,DQ)=>{var Xkt=it(),Ykt=Yt();function Jkt(r){try{return Xkt(r)?r<0?-1:r>0?1:0:NaN}catch{return NaN}}DQ.exports=Ykt(Jkt)});var RQ=O((eDt,FQ)=>{var Zkt=it(),Qkt=Yt();function e2t(r){try{return Zkt(r)?Math.sin(r):NaN}catch{return NaN}}FQ.exports=Qkt(e2t)});var PQ=O((tDt,OQ)=>{var t2t=zy();function r2t(r){return t2t(r)}OQ.exports=r2t});var BQ=O((rDt,MQ)=>{var n2t=it(),a2t=Yt();function i2t(r){try{return n2t(r)?Math.tan(r):NaN}catch{return NaN}}MQ.exports=a2t(i2t)});var Qy=O((nDt,zQ)=>{var LQ=We(),qQ=Jn();function o2t(r,e){LQ(qQ(r),"`fn` must be a function!");let t=new Date;return e?r(...e):r(),new Date-t}async function s2t(r,e){LQ(qQ(r),"`fn` must be a function!");let t=new Date;return e?await r(...e):await r(),new Date-t}zQ.exports={timeSync:o2t,timeAsync:s2t}});var WQ=O((aDt,$Q)=>{var u2t=Ye(),c2t=vt(),l2t=pt(),f2t=Gi();function h2t(){return f2t([...arguments].map(r=>u2t(r)?r:c2t(r)||l2t(r)?r.values:[r]))}$Q.exports=h2t});var VQ=O((iDt,UQ)=>{var p2t=We(),d2t=Ye(),v2t=vt(),m2t=pt(),g2t=Nt(),y2t=af(),b2t=Wa();function w2t(){let r=[],e=Object.values(arguments).map(t=>((v2t(t)||m2t(t))&&(t=t.values),p2t(d2t(t),"The `zip` function only works on arrays, Series, and DataFrames!"),t));return b2t(0,y2t(e.map(t=>t.length))).forEach(t=>{let n=[];e.forEach(a=>{let i=a[t];n.push(g2t(i)?void 0:i)}),r.push(n)}),r}UQ.exports=w2t});var e0=O((oDt,UT)=>{var{copy:x2t,decycle:k2t}=Wo(),{DataFrame:S2t,Series:N2t}=td(),sf={abs:Oy(),add:Py(),apply:nd(),arccos:CY(),arcsin:DY(),arctan:FY(),argmax:OY(),argmin:LY(),assert:We(),cast:wT(),ceil:UY(),chop:HY(),clamp:KY(),combinations:YY(),copy:x2t,correl:mJ(),cos:yJ(),count:Up(),covariance:TT(),DataFrame:S2t,dataTypes:wJ(),decycle:k2t,diff:EJ(),distance:zJ(),divide:WJ(),dot:RT(),dropMissing:OT(),dropMissingPairwise:aZ(),dropNaN:QN(),dropNaNPairwise:hZ(),dropUndefined:dZ(),exp:mZ(),factorial:bZ(),find:SZ(),findAll:IZ(),flatten:Fr(),float:AZ(),floor:_Z(),identity:OZ(),indexOf:qp(),inferType:UZ(),int:GZ(),intersect:jZ(),inverse:JZ(),isArray:Ye(),isBoolean:Cy(),isBrowser:QZ(),isDataFrame:vt(),isDate:$p(),isEqual:Vi(),isFunction:Jn(),isJagged:Vp(),isNested:yy(),isNumber:it(),isObject:qs(),isSeries:pt(),isString:Ta(),isUndefined:Nt(),lerp:tQ(),log:aQ(),MathError:Zl(),max:af(),mean:By(),median:sQ(),min:My(),mod:lQ(),mode:dQ(),multiply:AT(),ndarray:zs(),normal:yQ(),ones:wQ(),permutations:kQ(),pow:$y(),print:NQ(),product:Xp(),random:tf().random,range:Wa(),remap:IQ(),reshape:Ey(),reverse:Gp(),round:AQ(),scale:of(),seed:tf().seed,Series:N2t,set:Gi(),shape:Nr(),shuffle:Iy(),sign:_Q(),sin:RQ(),sort:$s(),sqrt:qy(),std:zy(),stdev:PQ(),subtract:DT(),sum:Wy(),tan:BQ(),time:Qy().timeSync,timeSync:Qy().timeSync,timeAsync:Qy().timeAsync,transpose:pc(),union:WQ(),variance:ET(),vectorize:Yt(),zeros:BT(),zip:VQ(),dump:function(){let r=typeof globalThis<"u"?globalThis:typeof global<"u"?global:typeof window<"u"?window:typeof self<"u"?self:void 0;if(!r)throw new sf.MathError("Cannot dump functions into global scope because none of `globalThis`, `global`, `window`, or `self` exist in the current context!");Object.keys(sf).forEach(e=>{try{Object.defineProperty(r,e,{configurable:!1,enumerable:!0,writable:!1,value:sf[e]})}catch{r[e]=sf[e]}})}};typeof UT<"u"&&(UT.exports=sf);typeof window<"u"&&(window.JSMathTools=sf)});var HQ=O((sDt,GQ)=>{var{isArray:T2t}=e0(),E2t=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:void 0;function I2t(r){let e=Symbol.for("@TypedArrayConstructor"),t="Symbol(@TypedArrayConstructor)",n=e in r?e:t in r?t:void 0;if(n){if(!("values"in r))throw new Error("The value passed into the `convertObjectToTypedArray` must have a 'values' property!");return r[n]==="ArrayBuffer"?new Uint8Array(r.values).buffer:new E2t[r[n]](r.values)}if(T2t(r)&&r.constructor.name==="Array")return r;throw new Error("The value passed into the `convertObjectToTypedArray` must be an object that can be converted into a typed array!")}GQ.exports=I2t});var XQ=O((uDt,KQ)=>{var C2t=HQ(),jQ={"@Infinity":1/0,"@NegativeInfinity":-1/0,"@NaN":NaN,"@undefined":void 0};function t0(r){function e(t){if(typeof t=="string"){if(t.match(/^'?"?Symbol\(.*?\)"?'?$/g))return t=t.replace(/^.*?Symbol\(/g,"").replace(/\).*?$/g,""),t in jQ?jQ[t]:Symbol.for(t);let n=t.trim();if(n.match(/^\/.*?\/(d|g|i|m|s|u|v|y)*?$/g))try{let a=n.replace(/^\//g,"").replace(/\/(d|g|i|m|s|u|v|y)*?$/g,""),i=n.match(/\/(d|g|i|m|s|u|v|y)*?$/g).at(-1).split("/").at(-1);return new RegExp(a,i)}catch{}try{let a=parseFloat(t);if(!isNaN(a)&&a.toString()===t)return a}catch{}try{let a=new Date(Date.parse(t));if(a.toString()!=="Invalid Date")return a}catch{}try{return JSON.parse(t,function(a,i){try{return t0(i)}catch{return i}})}catch{return t}}if(typeof t=="object"){if(t===null)return null;try{return C2t(t)}catch{return Object.keys(t).concat(Object.getOwnPropertySymbols(t)).forEach(a=>{try{try{a=t0(a)}catch{}t[a]=t0(t[a])}catch{}}),t}}return t}return e(r)}KQ.exports=t0});var JQ=O((cDt,YQ)=>{var A2t=qN();function D2t(r){let e=A2t(r);return e[0].toUpperCase()+e.slice(1)}YQ.exports=D2t});var QQ=O((lDt,ZQ)=>{var _2t=zN();function F2t(r){if(typeof r!="string")throw new Error("`text` must be a string!");let e=_2t(r).split(" ");return e.length===0?"":e.length===1?e[0]:e.join("_")}ZQ.exports=F2t});var tee=O((fDt,eee)=>{var{isArray:R2t,isDate:O2t}=e0();function VT(r){if(r instanceof ArrayBuffer||r instanceof BigInt64Array||r instanceof BigUint64Array||r instanceof Float32Array||r instanceof Float64Array||r instanceof Int16Array||r instanceof Int32Array||r instanceof Int8Array||r instanceof Uint16Array||r instanceof Uint32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray)return{[Symbol.for("@TypedArrayConstructor")]:r.constructor.name,values:r instanceof ArrayBuffer?Array.from(new Uint8Array(r)):Array.from(r)};if(R2t(r))return r.map(e=>{try{return VT(e)}catch{return e}});if(typeof r=="object"&r!==null){if(O2t(r))return new Date(r.getTime());let e={};return Object.keys(r).forEach(t=>{try{e[t]=VT(r[t])}catch{e[t]=r[t]}}),e}throw new Error("The value passed into the `convertTypedArrayToObject` function must be a typed array! Valid types include: ArrayBuffer, Float32Array, Float64Array, Int16Array, Int32Array, Int8Array, Uint16Array, Uint32Array, Uint8Array, and Uint8ClampedArray.")}eee.exports=VT});var nee=O((hDt,ree)=>{var{assert:P2t,decycle:M2t,isArray:B2t,isDate:L2t,isString:GT,isUndefined:q2t,range:z2t}=e0(),HT=tee();function Ks(r,e){return!r||e<=0?"":z2t(0,e).map(()=>r).join("")}function $2t(r,e){P2t(GT(e)||q2t(e),"The second parameter to the `stringify` function must be undefined or a string!");let t=e?`
`:"";function n(a,i,o){return o=o||0,typeof a=="number"||typeof a=="bigint"?a===1/0?'"Symbol(@Infinity)"':a===-1/0?'"Symbol(@NegativeInfinity)"':isNaN(a)?'"Symbol(@NaN)"':a.toString():typeof a=="string"?JSON.stringify(a):typeof a=="boolean"?a.toString():typeof a>"u"?'"Symbol(@undefined)"':typeof a=="symbol"||typeof a=="function"?JSON.stringify(a.toString()):a instanceof RegExp?a.toString():typeof a=="object"?a===null?"null":L2t(a)?JSON.stringify(a.toJSON()):B2t(a)?a.length===0?Ks(i,o-1)+"[]":a instanceof Array?Ks(i,o-1)+"["+t+a.map(s=>{let u=(()=>{try{return n(HT(s),i,o+1)}catch{return n(s,i,o+1)}})();return GT(u)&&(u=u.trim()),Ks(i,o+1)+u}).join(","+t)+t+Ks(i,o)+"]":n(HT(a),null,i):Object.keys(a).length+Object.getOwnPropertySymbols(a).length===0?Ks(i,o-1)+"{}":Ks(i,o-1)+"{"+t+Object.keys(a).concat(Object.getOwnPropertySymbols(a)).map(s=>{let u=(()=>{try{return n(HT(a[s]),i,o+1)}catch{return n(a[s],i,o+1)}})();return GT(u)&&(u=u.trim()),Ks(i,o+1)+n(s)+":"+(i?" ":"")+u}).join(","+t)+t+Ks(i,o)+"}":"undefined"}return n(M2t(r),e)}ree.exports=$2t});var iee=O((pDt,aee)=>{function W2t(r){let e=r.split(`
`),t=e.filter(a=>a.trim().length>0).map(a=>a.split("").findIndex(i=>!i.match(/\s/g))),n=Math.min(...t);return e.map(a=>a.substring(n)).join(`
`)}aee.exports=W2t});var see=O((dDt,oee)=>{function U2t(r,e){if(typeof r!="string")throw new Error("The first argument to the `wrap` function must be a string!");if((typeof e>"u"||e===null)&&(typeof process<"u"&&typeof process.stdout<"u"&&typeof process.stdout.columns=="number"?e=process.stdout.columns>80?80:process.stdout.columns:e=80),isNaN(e)||typeof e!="number")throw new Error("The second argument to the `wrap` function must be undefined, null, or an integer!");let t=[];return r.split(`
`).forEach(n=>{if(n.trim().length===0)return t.push("");let a=n.split(/[^\s]/g)[0],i=n.replace(a,"").split(" "),o=a;i.forEach(s=>{let u=o+(o.trim().length>0?" ":"")+s;u.length>e?(t.push(o),o=a+s):o=u}),o.length>0&&t.push(o)}),t.join(`
`)}oee.exports=U2t});var uee=O((vDt,jT)=>{var ad={camelify:qN(),indent:V8(),kebabify:Q8(),parse:XQ(),pascalify:JQ(),snakeify:QQ(),stringify:nee(),unindent:iee(),wrap:see(),dump(){Object.keys(ad).forEach(r=>{typeof global<"u"&&(global[r]=ad[r]),typeof window<"u"&&(window[r]=ad[r])})}};typeof jT<"u"&&(jT.exports=ad);typeof window<"u"&&(window.JSTextTools=ad)});var vee=O((mDt,dee)=>{var{assert:uf,correl:cee,count:V2t,DataFrame:lee,inferType:G2t,isArray:H2t,isDataFrame:j2t,isFunction:K2t,isJagged:X2t,isNumber:id,isUndefined:fee,shape:Y2t,sort:J2t,sum:Z2t}=Mt(),{stringify:Q2t}=uee(),eSt=bN(),hee=r=>id(r)&&(parseInt(r)===r||r===1/0);function pee(r,e){e=e||{};let t=id(e.maxUniqueValues)?e.maxUniqueValues:7,n=id(e.minNonMissingValues)?e.minNonMissingValues:15,a=id(e.maxCorrelationThreshold)?e.maxCorrelationThreshold:1-1e-5,i=e.progress||null;if(H2t(r))return uf(Y2t(r).length===2&&!X2t(r),"The `convertToNumerical` function only works on non-jagged 2-dimensional arrays and DataFrames!"),pee(new lee(r));uf(j2t(r),"You must pass a DataFrame into the `convertToNumerical` function!"),uf(hee(t),"`maxUniqueValues` must be a whole number!"),uf(hee(n),"`minNonMissingValues` must be a whole number!"),uf(id(a),"`maxCorrelationThreshold` must be a number!"),fee(i)||uf(K2t(i),"If defined, `progress` must be a function!");let o={};return r.apply((s,u)=>{i&&i(u/r.columns.length);let c=G2t(s.values);if(c.type==="boolean"&&(c.values=c.values.map(f=>f?1:0)),c.type==="date"&&(c.values=c.values.map(f=>{try{return f.getTime()}catch{return NaN}})),c.type==="null")return;c.type,c.type==="object"&&(c.values=c.values.map(f=>Q2t(f))),c.type;let l=c.values.filter(f=>!fee(f));if(!(c.values.length-l.length>n)){if(c.type!=="boolean"){let f=J2t(V2t(l),(p,d)=>d.count-p.count);if(Z2t(f.slice(0,t).map(p=>p.count))/l.length>=.9){if(f.length<2)return;let p=eSt(s.name,c.values);for(;Object.keys(p).length>0;){let d=Object.keys(p)[0],m=p[d];delete p[d];let v=Object.keys(o);for(let g=0;g<v.length;g++){let y=o[v[g]];if(cee(m,y)>a)return}o[d]=m}return}if(c.type==="object"||c.type==="string")return}if(c.type==="boolean"||c.type==="date"||c.type==="number"){let f=Object.keys(o);for(let h=0;h<f.length;h++){let p=o[f[h]];if(cee(c.values,p)>a)return}o[s.name]=c.values}}}),new lee(o)}dee.exports=pee});var Tee=O((gDt,Nee)=>{var{abs:tSt,add:rSt,assert:od,isArray:mee,isDataFrame:gee,isEqual:nSt,isSeries:yee,mean:aSt,pow:bee,scale:iSt,shape:wee,sign:oSt,sqrt:sSt,sum:xee}=Mt(),kee=Kl(),See=(r,e)=>rSt(r,iSt(e,-1));function KT(r,e){if(gee(r)||yee(r))return KT(r.values,e);if(gee(e)||yee(e))return KT(r,e.values);od(mee(r),"You must pass two same-shaped numerical arrays into the `rScore` function!"),od(mee(e),"You must pass two same-shaped numerical arrays into the `rScore` function!"),od(nSt(wee(r),wee(e)),"You must pass two same-shaped numerical arrays into the `rScore` function!"),od(kee(r),"You must pass two same-shaped numerical arrays into the `rScore` function!"),od(kee(e),"You must pass two same-shaped numerical arrays into the `rScore` function!");let t=xee(bee(See(r,e),2)),n=xee(bee(See(r,aSt(r)),2));if(n===0)return NaN;let a=1-t/n;return oSt(a)*sSt(tSt(a))}Nee.exports=KT});var Dee=O((yDt,Aee)=>{var{argmax:Eee,assert:sd,copy:uSt,DataFrame:cSt,dot:lSt,isArray:fSt,isDataFrame:hSt,isEqual:Iee,isJagged:pSt,isNumber:dSt,reverse:vSt,shape:mSt,transpose:gSt}=Mt();function Cee(r){if(fSt(r)){sd(mSt(r).length===2&&!pSt(r),"The `sortCorrelationMatrix` function only works on non-jagged 2-dimensional arrays and DataFrames!");let s=new cSt(r);return s.index=s.columns.slice(),Cee(s).values}sd(hSt(r),"You must pass a 2-dimensional array or DataFrame into the `sortCorrelationMatrix` function!");let e=r.copy(),t=[];e.values.forEach((s,u)=>{s.forEach((c,l)=>{dSt(c)?sd(c>=-1&&c<=1,"The correlation matrix passed into the `sortCorrelationMatrix` function must not contain values less than -1 or greater than 1!"):(t.push({row:e.index[u],col:e.columns[l],value:c}),e.values[u][l]=-1/0)})}),sd(Iee(e.values,gSt(e.values)),"The correlation matrix passed into the `sortCorrelationMatrix` function must be symmetrical!"),sd(Iee(e.index,e.columns),"The correlation matrix passed into the `sortCorrelationMatrix` function must be symmetrical! (In this case, although the values themselves are symmetrical, the row and column names differ.)");let n=uSt(e.index),a=[];for(;n.length>0;)if(a.length===0){let s=Eee(e.values.map(u=>lSt(u,u)));a.push(n[s]),n.splice(s,1)}else{let s=e.index.indexOf(a.at(-1)),u=Eee(n.map(l=>e.values[e.index.indexOf(l)][s])),c=n[u];a.push(c),n.splice(u,1)}let i=vSt(a),o=e.get(i,i);return t.forEach(s=>{let u=o.index.indexOf(s.row),c=o.columns.indexOf(s.col);o.values[u][c]=s.value,o.values[c][u]=s.value}),o}Aee.exports=Cee});var Fee=O((bDt,_ee)=>{var ySt=MN();function bSt(){return ySt(...arguments)}_ee.exports=bSt});var $ee=O((wDt,zee)=>{var{assert:r0,DataFrame:Ree,dropNaN:wSt,flatten:Oee,isArray:xSt,isDataFrame:XT,isSeries:YT,mean:Pee,range:kSt,Series:Mee,shape:Bee,stdev:Lee,transpose:qee}=Mt(),SSt=lo(),JT=class{constructor(){let e=this;e.means=[],e.stdevs=[],e.wasFittedOnAVector=!1,e.hasBeenFitted=!1}_getDataArrayAndShape(e){if(XT(e))return[e.values,e.shape];if(YT(e)){let n=qee([e.values]);return[n,Bee(n)]}r0(xSt(e),"`x` must be a 1- or 2-dimensional array, DataFrame, or Series!");let t=Bee(e);return r0(t.length<3,"`x` must be a 1- or 2-dimensional array, DataFrame, or Series!"),t.length===1&&(t.push(1),e=qee([e])),[e,t]}fit(e){let t=this,n=t._getDataArrayAndShape(e);e=n[0];let a=n[1];return t.wasFittedOnAVector=a.indexOf(1)>-1,t.means=[],t.stdevs=[],kSt(0,a[1]).forEach(i=>{let o=e.map(s=>s[i]);if(SSt.shouldIgnoreNaNValues){let s=wSt(o);t.means.push(Pee(s)),t.stdevs.push(Lee(s))}else t.means.push(Pee(o)),t.stdevs.push(Lee(o))}),t.hasBeenFitted=!0,t}transform(e){let t=this;if(!t.hasBeenFitted)throw new Error("This `StandardScaler` instance hasn't been trained on any data yet! Please use the `fit` method to train it before calling the `transform` method.");if(XT(e)){let o=new Ree(t.transform(e.values));return o.columns=e.columns,o.index=e.index,o}if(YT(e)){let o=new Mee(t.transform(e.values));return o.name=e.name,o.index=e.index,o}let n=t._getDataArrayAndShape(e);e=n[0];let a=n[1];r0(a[1]===t.means.length,"The data you passed into the `transform` function doesn't have the same number of columns as the data set on which this StandardScaler was fitted!");let i=e.map(o=>o.map((s,u)=>(s-t.means[u])/t.stdevs[u]));return t.wasFittedOnAVector?Oee(i):i}untransform(e){let t=this;if(!t.hasBeenFitted)throw new Error("This `StandardScaler` instance hasn't been trained on any data yet! Please use the `fit` method to train it before calling the `transform` method.");if(XT(e)){let o=new Ree(t.untransform(e.values));return o.columns=e.columns,o.index=e.index,o}if(YT(e)){let o=new Mee(t.untransform(e.values));return o.name=e.name,o.index=e.index,o}let n=t._getDataArrayAndShape(e);e=n[0];let a=n[1];r0(a[1]===t.means.length,"The data you passed into the `untransform` function doesn't have the same number of columns as the data set on which this StandardScaler was fitted!");let i=e.map(o=>o.map((s,u)=>s*t.stdevs[u]+t.means[u]));return t.wasFittedOnAVector?Oee(i):i}};zee.exports=JT});var ZT=O((xDt,Uee)=>{var{MathError:NSt}=Mt(),Wee={clipOutliers:sK(),cohensD:fN(),cohensd:fN(),common:lo(),containsOnlyNumbers:Kl(),diagonalize:bK(),getCorrelationMatrix:vN(),getHighlyCorrelatedColumns:CK(),getMagnitude:yN(),getOneHotEncodings:bN(),getPercentages:MK(),getPValueMatrix:JK(),IndexMatcher:r8(),isBinary:cN(),isCorrelationMatrix:mN(),KMeans:T8(),normalize:MN(),orthonormalize:$8(),convertToNumerical:vee(),project:LN(),pValue:xN(),rScore:Tee(),sortCorrelationMatrix:Dee(),standardize:Fee(),StandardScaler:$ee(),trainTestSplit:EN(),dump(){let r=this,e=typeof global<"u"?global:typeof window<"u"?window:null;if(!e)throw new NSt("Cannot dump functions into global scope because neither `global` nor `window` exist in the current context!");Object.keys(r).forEach(t=>{try{Object.defineProperty(e,t,{configurable:!1,enumerable:!0,writable:!1,value:r[t]})}catch{e[t]=r[t]}})}};try{window.JSDataScienceHelpers=Wee}catch{}try{Uee.exports=Wee}catch{}});var eE=O((kDt,jee)=>{var{add:TSt,assert:dc,isDataFrame:n0,isFunction:ESt,isUndefined:Vee,normal:ISt,random:CSt,scale:ASt,shape:Gee}=Mt(),{isMatrix:a0,isTFTensor:cf}=Hl(),{KMeansNaive:DSt}=ZT().KMeans,{sse:Hee}=sN(),Go=Mp(),QT=class extends DSt{initializeCentroids(e){return n0(e)&&(e=e.values),cf(e)&&(e=e.arraySync()),Go.tensor(super.initializeCentroids(e))}getFitStepFunction(e,t){let n=this;n0(e)&&(e=e.values),cf(e)&&(e=e.arraySync()),dc(a0(e),"`x` must be a matrix!"),Vee(t)||dc(ESt(t),"If defined, `progress` must be a function!");let a=[],i=c=>(a.push(c),c),o=i(Go.tensor(e)),s=i(n.initializeCentroids(e)),u={currentRestart:0,currentIteration:0,currentCentroids:s,bestCentroids:s,bestScore:-1/0,isFinished:!1};return function(){try{let l=n.predict(o,u.currentCentroids),f=u.currentCentroids.arraySync(),h=[];for(let d=0;d<n.k;d++){let m=[];if(l.forEach((v,g)=>{v===d&&m.push(g)}),m.length===0)h.push(TSt(f[parseInt(CSt()*f.length)],ASt(.01,ISt(e[0].length))));else{let v=i(o.gather(m));h.push(i(v.mean(0)))}}if(h=i(Go.stack(h)),Hee(u.currentCentroids,h)<n.tolerance&&(u.currentIteration=n.maxIterations-1),u.currentIteration++,u.currentIteration>=n.maxIterations){u.currentRestart++;let d=n.score(o,h);d>u.bestScore&&(u.bestScore=d,u.bestCentroids=i(h.clone())),u.currentIteration=0,u.currentRestart>=n.maxRestarts?u.isFinished=!0:u.currentCentroids=i(n.initializeCentroids(e))}else u.currentCentroids=i(h.clone());return u.isFinished?(n.centroids=u.bestCentroids.arraySync(),u={isFinished:!0},a.forEach(d=>{try{d.dispose()}catch{}}),t&&t(1,n)):t&&t((u.currentRestart+u.currentIteration/n.maxIterations)/n.maxRestarts,n),u}catch(l){throw a.forEach(f=>{try{f.dispose()}catch{}}),l}}}fit(e,t){let n=this,a=n.getFitStepFunction(e,t),i;for(;!i||!i.isFinished;)i=a();return n}predict(e,t){let n=this;return Go.tidy(()=>{cf(e)&&(e=e.arraySync()),n0(e)&&(e=e.values),dc(a0(e),"`x` must be a matrix!"),t=t||n.centroids,cf(t)||(t=Go.tensor(t)),dc(Gee(e)[1]===t.shape[1],"`x` and `centroids` must have the same number of columns!");let a=Go.tensor(e).expandDims(1),i=t.expandDims(0);return a.sub(i).pow(2).sum(2).argMin(1).arraySync()})}score(e,t){let n=this;return Go.tidy(()=>{cf(e)&&(e=e.arraySync()),n0(e)&&(e=e.values),dc(a0(e),"`x` must be a matrix!"),t=t||n.centroids,cf(t)||(t=Go.tensor(t)),dc(a0(t)||Vee(t),"`centroids` must be a matrix or undefined!"),dc(Gee(e)[1]===t.shape[1],"`x` and `centroids` must have the same number of columns!");let a=Go.tensor(e),i=n.predict(a,t),o=t.gather(i).arraySync();return-Hee(a,o)})}};jee.exports=QT});var nE=O((SDt,Xee)=>{var{assert:_St,int:Kee,random:tE}=Mt(),{isMatrix:FSt}=Hl(),lf=Mp(),RSt=eE(),rE=class extends RSt{initializeCentroids(e){_St(FSt(e),"`x` must be a matrix!");let t=this;return lf.tidy(()=>{let n=lf.tensor(e),a=[Kee(tE()*e.length)];for(;a.length<t.k;){let i=a.map(l=>e[l]),o=lf.tensor(t.predict(e,i),null,"int32"),s=lf.tidy(()=>lf.tensor(i).gather(o).sub(n).pow(2).sum(1)),u=s.div(s.max()).arraySync(),c=0;for(let l=0;l<1e4;l++){c=Kee(tE()*u.length);let f=u[c];if(tE()<f)break}a.push(c)}return lf.tensor(a.map(i=>e[i]))})}};Xee.exports=rE});var Zee=O((NDt,Jee)=>{var{assert:OSt,isEqual:PSt,shape:Yee}=Mt(),{KMeansMeta:MSt}=ZT().KMeans,{isTFTensor:BSt}=Hl(),LSt=nE(),aE=class extends MSt{constructor(e){super(e);let t=this;e=e||{},t.modelClass=e.modelClass||LSt}get centroids(){let e=this;return e.fittedModel?e.fittedModel.centroids:e._fitState.bestCentroids}set centroids(e){let t=this;BSt(e)&&(e=e.arraySync());let n=Yee(e);if(t.centroids){let a=t.centroids,i=Yee(a);OSt(PSt(n,i),`The new centroids must have the same shape as the old centroids! (expected: [${i.join(", ")}], received: [${n.join(", ")}])`)}t.fittedModel||(t.fittedModel=new t.modelClass({k:n[0],maxIterations:t.maxIterations,maxRestarts:t.maxRestarts,tolerance:t.tolerance})),t.fittedModel.centroids=e}};Jee.exports=aE});var ete=O((TDt,Qee)=>{Qee.exports={TFKMeansMeta:Zee(),TFKMeansNaive:eE(),TFKMeansPlusPlus:nE()}});var qSt=O((EDt,iE)=>{var tte={helpers:Hl(),metrics:sN(),models:ete()};typeof iE<"u"&&(iE.exports=tte);typeof window<"u"&&(window.TFKMeans=tte)});qSt();})();
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2024 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/** @license See the LICENSE file. */
