(()=>{var g5=Object.defineProperty;var y5=(n,e,t)=>e in n?g5(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var _2=(n=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(n,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):n)(function(n){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+n+'" is not supported')});var Y=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var Zm=(n,e,t)=>(y5(n,typeof e!="symbol"?e+"":e,t),t);var Du=Y((lrt,F2)=>{var b5=new Function(`
  try {
    return this === window
  } catch(e) {}

  try {
    return typeof importScripts !== "undefined"
  } catch(e) {}

  return false
`),Jm=class extends Error{constructor(e){b5()?super(e):super(`

\x1B[31m`+e+`
\x1B[0m`)}};F2.exports=Jm});var qe=Y((frt,R2)=>{var w5=Du();R2.exports=function(n,e){if(!n)throw new w5(e)}});var Ue=Y((hrt,O2)=>{function x5(n){try{return n instanceof Array||typeof n.constructor<"u"&&n.constructor.name==="Array"}catch{return!1}}O2.exports=x5});var lt=Y((drt,P2)=>{function k5(n){try{return!!n._symbol&&n._symbol===Symbol.for("@jrc03c/js-math-tools/dataframe")}catch{return!1}}P2.exports=k5});var Tr=Y((prt,M2)=>{function S5(n){return typeof n=="function"}M2.exports=S5});var nt=Y((vrt,B2)=>{function N5(n){return typeof n=="number"&&!isNaN(n)}B2.exports=N5});var yt=Y((mrt,L2)=>{function T5(n){return n===null||typeof n>"u"}L2.exports=T5});var mo=Y((grt,z2)=>{var E5=Ue(),I5=yt();function C5(n){return typeof n=="object"&&!I5(n)&&!E5(n)}z2.exports=C5});var ut=Y((yrt,$2)=>{function A5(n){try{return!!n._symbol&&n._symbol===Symbol.for("@jrc03c/js-math-tools/series")}catch{return!1}}$2.exports=A5});var wl=Y((brt,V2)=>{var D5=qe(),q2=Ue(),_5=lt(),F5=Tr(),Qm=nt(),W2=mo(),R5=ut();function eg(n,e){if(_5(n)){let i=eg(n.values,e);return i.length>0&&Qm(i[0])&&i[0]>=0&&i[0]<n.index.length&&(i[0]=n.index[i[0]]),i.length>1&&Qm(i[1])&&i[1]>=0&&i[1]<n.columns.length&&(i[1]=n.columns[i[1]]),i}if(R5(n)){let i=eg(n.values,e);return i.length>0&&Qm(i[0])&&i[0]>=0&&i[0]<n.index.length&&(i[0]=n.index[i[0]]),i}if(D5(W2(n)||q2(n),"You must pass (1) an object, array, Series, or DataFrame and (2) a function or value into the `indexOf` function!"),!F5(e)){let i=e;e=o=>o===i}function t(i,o,s){if(s=s||[],s.indexOf(i)>-1)return null;if(W2(i)){s.push(i);let u=Object.keys(i);for(let c=0;c<u.length;c++){let l=u[c],f=i[l];if(o(f))return[l];let h=t(f,o,s);if(h&&h.length>0)return[l].concat(h)}}else if(q2(i)){s.push(i);for(let u=0;u<i.length;u++){let c=i[u];if(o(c))return[u];let l=t(c,o,s);if(l&&l.length>0)return[u].concat(l)}}else if(o(i))return[];return null}function r(i){try{return e(i)}catch{return!1}}let a=t(n,r);return a&&a.length>0?a:null}V2.exports=eg});var Ni=Y((wrt,j2)=>{var O5=wl(),G2=Ue(),U2=lt(),H2=ut();function _u(n){try{return structuredClone(n)}catch{if(typeof n=="object"){if(n===null)return null;if(G2(n))return n.map(r=>_u(r));if(H2(n)){let r=n.copy();return r.values=_u(r.values),r}if(U2(n)){let r=n.copy();return r.values=_u(n.values),r}n=K2(n);let t={};return Object.keys(n).forEach(r=>{t[r]=_u(n[r])}),t}else return n}}function K2(n){function e(a,i,o){if(i=i||[],o=o||"",i.indexOf(a)>-1){let s=o.split("/").slice(o.startsWith("/")?1:0);if(s.some((c,l)=>{let f=s.slice(0,s.length-l-1),h=t;return f.forEach(d=>{h=h[d]}),h===a}))return`<reference to "${t===a?"/":"/"+O5(t,a).join("/")}">`}return typeof a=="object"?a===null?null:(i.push(a),G2(a)?a.map((s,u)=>e(s,i,o+"/"+u)):(Object.keys(a).forEach(s=>{a[s]=e(a[s],i,o+"/"+s)}),a)):a}let t=_u(n),r=e(t);if(U2(n)){let a=n.copy();a._values=r.values,a._columns=r.columns,a._index=r.index,r=a}if(H2(n)){let a=n.copy();a.name=r.name,a._values=r.values,a._index=r.index,r=a}return r}j2.exports={copy:_u,decycle:K2}});var pn=Y((xrt,Z2)=>{var{copy:P5}=Ni(),M5=qe(),X2=Ue(),B5=lt(),L5=ut();function Y2(n){if(B5(n)||L5(n))return Y2(n.values);M5(X2(n),"The `flatten` function only works on arrays, Series, and DataFrames!");function e(t){let r=[];return P5(t).forEach(a=>{X2(a)?r=r.concat(e(a)):r.push(a)}),r}return e(n)}Z2.exports=Y2});var Ja=Y((krt,Q2)=>{var{decycle:J2}=Ni();function z5(n,e){function t(r,a){let i=typeof r;if(i!==typeof a)return!1;if(i==="undefined")return!0;if(i==="boolean"||i==="symbol")return r===a;if(i==="number"||i==="bigint")return r.toString()==="NaN"&&a.toString()==="NaN"?!0:r===a;if(i==="string"||i==="function")return r===a;if(i==="object"){if(r===null||a===null)return r===null&&a===null;{let s=Object.keys(r),u=Object.keys(a);if(s.length!==u.length)return!1;for(let c=0;c<s.length;c++){let l=s[c];if(!t(r[l],a[l]))return!1}return!0}}}try{return n instanceof Date&&e instanceof Date?n.getTime()===e.getTime():t(n,e)}catch{return t(J2(n),J2(e))}}Q2.exports=z5});var Qa=Y((Srt,rS)=>{var $5=qe(),q5=pn(),W5=Ue(),eS=lt(),V5=Tr(),tS=ut(),G5=yt();function xl(n){let e="abcdefg1234567890",t="";for(;t.length<n;)t+=e[parseInt(Math.random()*e.length)];return t}var U5=xl(256),H5=xl(256),K5=xl(256),j5=xl(256),X5=xl(256);function nS(n){if(eS(n)||tS(n))return nS(n.values);$5(W5(n),"The `set` function only works on arrays, Series, and DataFrames!");let e=[],t={};return q5(n).forEach(r=>{let a=typeof r=="object"&&r===null?U5:G5(r)?H5:V5(r)?r.toString():typeof r=="symbol"?r.toString()+" - "+X5:r===1/0?K5:r===-1/0?j5:eS(r)?r.toJSONString():tS(r)?JSON.stringify(r.toObject()):JSON.stringify(r);t[a]||e.push(r),t[a]=!0}),e}rS.exports=nS});var kl=Y((Nrt,oS)=>{var Y5=qe(),tg=pn(),aS=Ue(),Z5=lt(),iS=Ja(),J5=Tr(),Q5=ut(),eK=Qa();function Zh(n,e){if(Z5(n)||Q5(n))return arguments.length>1?Zh(n.values,e):Zh(n.values,n.values);if(Y5(aS(n),"The first argument to the `count` function must be an array, Series, or DataFrame!"),J5(e))return tg(n).filter(t=>e(t)).length;if(aS(e)){let t=tg(n);return eK(e).map(r=>({value:r,count:t.filter(a=>iS(a,r)).length}))}else return arguments.length>1?tg(n).filter(t=>iS(t,e)).length:Zh(n,n)}oS.exports=Zh});var Sl=Y((Trt,uS)=>{var tK=qe(),sS=Ue(),nK=lt(),rK=ut();function ng(n){if(nK(n)||rK(n))return ng(n.values);tK(sS(n),"The `isJagged` function only works on arrays, Series, and DataFrames!");let e=0,t=null;for(let r=0;r<n.length;r++)if(sS(n[r])){if(e++,ng(n[r]))return!0;if(t===null)t=n[r].length;else if(n[r].length!==t)return!0}return e>0&&e<n.length}uS.exports=ng});var Jh=Y((Ert,fS)=>{var aK=qe(),cS=Ue(),iK=lt(),oK=ut();function lS(n){if(iK(n)||oK(n))return lS(n.values);aK(cS(n),"The `isNested` function only works on arrays, Series, and DataFrames!");for(let e=0;e<n.length;e++)if(cS(n[e]))return!0;return!1}fS.exports=lS});var go=Y((Irt,dS)=>{var us=qe(),sK=Ue(),uK=Jh(),cK=nt(),lK=yt(),Fu="You must pass a natural number or a one-dimensional array of natural numbers into the `ndarray` function!";function hS(n){us(!lK(n),Fu),sK(n)||(n=[n]),us(!uK(n),Fu),us(n.length>0,Fu);let e=n[0];if(us(cK(e),Fu),us(parseInt(e)===e,Fu),us(e>=0,Fu),us(e!==1/0,"We can't create an array containing an infinite number of values!"),n.length===1){let t=[];for(let r=0;r<e;r++)t.push(void 0);return t}else{let t=[];for(let r=0;r<e;r++)t.push(hS(n.slice(1)));return t}}dS.exports=hS});var Nl=Y((Crt,pS)=>{var fK=qe(),hK=Ue(),dK=lt(),pK=ut();function rg(n){if(dK(n)||pK(n)){let t=n.copy();return t.values=rg(t.values),t.index=rg(t.index),t}fK(hK(n),"The `reverse` function only works on arrays, Series, and DataFrames!");let e=[];for(let t=n.length-1;t>=0;t--)e.push(n[t]);return e}pS.exports=rg});var sa=Y((Art,vS)=>{var ag=qe(),ig=nt(),og=yt(),vK=Nl();function mK(n,e,t=1){ag(!og(n)&&!og(e)&&!og(t),"You must pass two numbers and optionally a step value to the `range` function!"),ag(ig(n)&&ig(e)&&ig(t),"You must pass two numbers and optionally a step value to the `range` function!"),ag(t>0,"The step value must be greater than 0! (NOTE: The step value is a magnitude; it does not indicate direction.)");let r=!1;if(n>e){r=!0;let i=n;n=e+t,e=i+t}let a=[];for(let i=n;i<e;i+=t)a.push(i);return r&&(a=vK(a)),a}vS.exports=mK});var on=Y((Drt,bS)=>{var gK=qe(),mS=Ue(),yK=lt(),bK=Ja(),wK=ut(),xK=yt();function gS(n){if(!mS(n))return;let e=[n.length],t=0,r=n.map(a=>{let i=gS(a);return xK(i)?i:(t++,i.length===1?i[0]:i)});return t>0?t===n.length&&r.slice(0,-1).every((i,o)=>bK(i,r[o+1]))?e.concat(r[0]):(e.push(r),e):e}function yS(n){return yK(n)||wK(n)?yS(n.values):(gK(mS(n),"The `shape` function only works on arrays, Series, and DataFrames!"),gS(n))}bS.exports=yS});var TS=Y((_rt,NS)=>{var wS=qe(),kK=Ue(),SK=lt(),NK=Sl(),TK=ut(),EK=yt(),xS=Du(),Qh=go(),kS=sa(),IK=Qa(),CK=on();function SS(n,e,t){if(EK(t)&&(t=0),wS(t===0||t===1||t==="vertical"||t==="horizontal",'The only valid axis values for use when appending data to a DataFrame are 0, 1, "vertical", and "horizontal". Note that 0 == "horizontal" and 1 == "vertical".'),kK(e)){wS(!NK(e),"The array of data you're trying to append to this DataFrame is jagged!");let r=CK(e);if(r.length===1)if(t===0){let a=n.copy();a._values.push(e);let i=Math.max(n.shape[1],r[0]);for(a._values.forEach(o=>{for(;o.length<i;)o.push(void 0)});a._index.length<a._values.length;)a._index.push("row"+a._index.length);for(;a._columns.length<i;)a._columns.push("col"+a._columns.length);return a}else{let a=Math.max(n.shape[0],r[0]),i=n.copy();for(kS(0,a).forEach(o=>{o>=i._values.length&&i._values.push(Qh(n.shape[1])),i._values[o].push(e[o])});i._index.length<i._values.length;)i._index.push("row"+i._index.length);for(;i._columns.length<i._values[0].length;)i._columns.push("col"+i._columns.length);return i}else if(r.length===2)if(t===0){let a=Math.max(...e.map(o=>o.length).concat([n.shape[1]])),i=n.copy();for(i._values=i._values.concat(e).map(o=>{for(;o.length<a;)o.push(void 0);return o});i._index.length<i._values.length;)i._index.push("row"+i._index.length);for(;i._columns.length<a;)i._columns.push("col"+i._columns.length);return i}else{let a=Math.max(...e.map(s=>s.length))+n.shape[1],i=Math.max(n.shape[0],r[0]),o=n.copy();for(kS(0,i).forEach(s=>{for(s>=o._values.length&&o._values.push(Qh(n.shape[1])),o._values[s]=o._values[s].concat(e[s]);o._values[s].length<a;)o._values[s].push(void 0)});o._index.length<o._values.length;)o._index.push("row"+o._index.length);for(;o._columns.length<a;)o._columns.push("col"+o._columns.length);return o}else throw new xS("Only 1- and 2-dimensional arrays can be appended to a DataFrame!")}else if(TK(e)){let r=SS(n,e.values,t);return t===0?r.index[r.index.length-1]=r.index.indexOf(e.name)>-1?e.name+" (2)":e.name:r.columns[r.columns.length-1]=r.columns.indexOf(e.name)>-1?e.name+" (2)":e.name,r}else if(SK(e))if(t===0){let r=n.copy(),a=IK(r._columns.concat(e._columns)).length;for(r._values.forEach(i=>{for(;i.length<a;)i.push(void 0)}),e.apply(i=>{let o=i.copy(),s=[];r._columns.forEach(u=>{let c=o._index.indexOf(u);c>-1?(s.push(o._values[c]),o._values.splice(c,1),o._index.splice(c,1)):s.push(void 0)}),r._values.push(s.concat(o._values))},1),r._columns=r._columns.concat(e._columns.filter(i=>r._columns.indexOf(i)<0));r._index.length<r._values.length;){let i="row"+r._index.length;r._index.push(i+(n._index.indexOf(i)>-1?" (2)":""))}return r}else{let r=n.copy();return r._index.forEach((a,i)=>{let o=e._index.indexOf(a);o>-1?r._values[i]=r._values[i].concat(e._values[o]):r._values[i]=r._values[i].concat(Qh(e.shape[1]))}),e._index.forEach((a,i)=>{r._index.indexOf(a)<0&&(r._index.push(a),r._values.push(Qh(r._columns.length).concat(e._values[i])))}),r._columns=r._columns.concat(e._columns.map(a=>a+(r._columns.indexOf(a)>-1?" (2)":""))),r}else throw new xS("Only 1- or 2-dimensional arrays, Series, and DataFrames can be appended to a DataFrame!")}NS.exports=SS});var DS=Y((Frt,AS)=>{var ES=qe(),IS=Ue(),AK=Tr(),CS=yt();function DK(n,e,t,r,a){if(a=a||0,ES(AK(r),"The first parameter to the `apply` method must be a function."),ES(a===0||a===1,"The second parameter to the `apply` method (the `axis`) must be 0 or 1."),a===0){let i={},o;if(t.columns.forEach((s,u)=>{let c=new e(t.values.map(f=>f[u]));c.name=s,c.index=t.index;let l=r(c,u,t);l instanceof e?i[s]=l.values:i[s]=l,CS(o)&&(o=l instanceof e||IS(l))}),o){let s=new n(i);return s.index=t.index,s}else{let s=new e(t.columns.map(u=>i[u]));return s.index=t.columns,s}}else if(a===1){let i,o=t.values.map((s,u)=>{let c=new e(s);c.name=t.index[u],c.index=t.columns;let l=r(c,u,t);return CS(i)&&(i=l instanceof e||IS(l)),l instanceof e?l.values:l});if(i){let s=new n(o);return s.index=t.index,s.columns=t.columns,s}else{let s=new e(o);return s.index=t.index,s}}}AS.exports=DK});var Lr=Y((Rrt,_S)=>{function _K(n){return typeof n=="string"}_S.exports=_K});var OS=Y((Ort,RS)=>{var FS=qe(),FK=Ue(),RK=Sl(),OK=mo(),PK=Lr(),MK=yt(),BK=Du(),LK=on();function zK(n,e,t,r,a){let i=s=>s instanceof n,o=s=>s instanceof e;if(MK(a)){if(i(r))return t.append(r,1);if(o(r))return t.append(r,1);if(OK(r)){let s=Math.max(...Object.keys(r).map(u=>r[u].length));return Object.keys(r).forEach(u=>{for(;r[u].length<s;)r[u].push(void 0)}),t.append(new n(r),1)}else throw new BK("You must pass a DataFrame, Series, or object into the `assign` method!")}else{FS(PK(r),"If passing two arguments into the `assign` method, then the first argument must be a string name!"),FS(FK(a)&&!RK(a)&&LK(a).length===1,"If passing two arguments into the `assign` method, then the second argument must be a 1-dimensional array!");let s=t.append(a,1);return s.columns[s.columns.length-1]=r,s}}RS.exports=zK});var MS=Y((Prt,PS)=>{var{copy:$K}=Ni();function qK(n,e){if(e.isEmpty)return new n;let t=new n($K(e.values));return t.columns=e.columns.slice(),t.index=e.index.slice(),t}PS.exports=qK});var VS=Y((Mrt,WS)=>{var ed=qe(),BS=Ue(),LS=nt(),zS=Lr(),$S=yt(),qS=on();function WK(n,e,t,r,a){$S(r)&&(r=[]),$S(a)&&(a=[]),(zS(r)||LS(r))&&(r=[r]),(zS(a)||LS(a))&&(a=[a]),ed(BS(r),"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings."),ed(BS(a),"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings."),ed(qS(r).length===1,"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings."),ed(qS(a).length===1,"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings.");let i,o;t.index.forEach((u,c)=>{r.indexOf(u)<0&&r.indexOf(c)<0&&(i||(i=[]),i.push(u))}),t.columns.forEach((u,c)=>{a.indexOf(u)<0&&a.indexOf(c)<0&&(o||(o=[]),o.push(u))});let s=t.get(i,o);if(s instanceof e){let u=new n;u=u.assign(s),t.index.indexOf(s.name)>-1&&(u=u.transpose()),s=u}return s}WS.exports=WK});var Tl=Y((Brt,GS)=>{var VK=nt();function GK(n){return VK(n)&&parseInt(n)===n}function UK(n){return GK(n)&&n>=0}GS.exports=UK});var HS=Y((Lrt,US)=>{var sg=qe(),HK=Lr(),td=yt(),KK=Tl(),jK=on();function XK(n,e,t,r,a,i){r=r||0,sg(r===0||r===1,"The first parameter of the `dropMissing` method (the `axis`) must be 0 or 1."),i=i||0,sg(KK(i),"The third parameter of the `dropMissing` method (the `threshold`) should be a whole number (meaning that data should be dropped if it contains more than `threshold` null values)."),a=i>0?"none":a||"any",sg(a==="any"||a==="all"||a==="none","The second parameter of the `dropMissing` method (the `condition` parameter, which indicates the condition under which data should be dropped) should be 'any' or 'all' (meaning that if 'any' of the data contains null values, then it should be dropped; or that if 'all' of the data contains null values, then it should be dropped).");function o(c){if(i>0){let l=0;for(let f=0;f<c.length;f++){let h=c[f];if(td(h)&&l++,l>=i)return[]}}else if(a==="any")for(let l=0;l<c.length;l++){let f=c[l];if(td(f))return[]}else if(a==="all"){for(let l=0;l<c.length;l++){let f=c[l];if(!td(f))return c}return[]}return c}let s=t.copy(),u=Math.random().toString();if(r===0){s=s.assign(u,s.index);let c=s.values.map(o).filter(f=>f.length>0);if(jK(c).length<2)return new n;s.values=c;let l=s.get(null,u);if(td(l))return new n;HK(l)&&(l=[l]),l instanceof e&&(l=l.values),s.index=l,s=s.drop(null,u)}else if(r===1){let c={};if(s.columns.forEach((f,h)=>{let d=s.values.map(v=>v[h]),p=o(d);p.length>0&&(c[f]=p)}),Object.keys(c).length===0)return new n;let l=new n(c);return l.index=s.index,l}return s}US.exports=XK});var ug=Y((zrt,jS)=>{var YK=qe(),ZK=Ue(),JK=lt(),QK=nt(),ej=ut();function KS(n){if(JK(n)||ej(n))return n.dropNaN(...Object.values(arguments).slice(1));YK(ZK(n),"The `dropNaN` function only works on arrays, Series, and DataFrames!");let e=[];return n.forEach(t=>{try{return e.push(KS(t))}catch{if(QK(t))return e.push(t)}}),e}jS.exports=KS});var YS=Y(($rt,XS)=>{var cg=qe(),tj=ug(),nj=Tl();function rj(n,e,t,r,a){t=t||0,cg(t===0||t===1,"The first parameter of the `dropNaN` method (the `axis`) must be 0 or 1."),a=a||0,cg(nj(a),"The third parameter of the `dropNaN` method (the `threshold`) should be a whole number (meaning that data should be dropped if it contains more than `threshold` NaN values)."),r=a>0?"none":r||"any",cg(r==="any"||r==="all"||r==="none","The second parameter of the `dropNaN` method (the `condition` parameter, which indicates the condition under which data should be dropped) should be 'any' or 'all' (meaning that if 'any' of the data contains NaN values, then it should be dropped; or that if 'all' of the data contains NaN values, then it should be dropped).");function i(s){let u=tj(s);return a>0?s.length-u.length<a:r==="any"?u.length===s.length:r==="all"?u.length>0:!0}let o=e.copy();if(t===0){let s=o.index.filter(u=>{let c=o.get(u,null).values;return i(c)});return s.length>0?o.get(s,null):new n}else if(t===1){let s=o.columns.filter(u=>{let c=o.get(null,u).values;return i(c)});return s.length>0?o.get(null,s):new n}return o}XS.exports=rj});var eN=Y((qrt,QS)=>{var ZS=qe(),El=pn(),aj=Tr(),ij=yt();function JS(n){let e={};return El(n).forEach((t,r)=>{e[t]=r}),e}function Ru(n){return Object.keys(n).sort((e,t)=>n[e]-n[t])}function oj(n,e,t,r,a){ZS(aj(r),"The `filter` method takes a single parameter: a function that is used to filter the values."),ij(a)&&(a=0),ZS(a===0||a===1,"The `axis` parameter to the `filter` method must be 0 or 1.");let i=t.copy();if(i.isEmpty)return i;let o=JS(i.index),s=JS(i.columns);if(a===0){let u=i.values.filter((c,l)=>{let f=new e(c);f.name=t.index[l],f.index=t.columns;let h=r(f,l,t);return h||delete o[i.index[l]],h});if(El(u).length===0)return new n;if(u.length===1){let c=new e(El(u));return c.name=Ru(o)[0],c.index=Ru(s),c}i.values=u,i.index=Ru(o)}else if(a===1){i=i.transpose();let u=i.values.filter((c,l)=>{let f=new e(c);f.name=t.columns[l],f.index=t.index;let h=r(f,l,t);return h||delete s[i.index[l]],h});if(El(u).length===0)return new n;if(u.length===1){let c=new e(El(u));return c.name=Ru(s)[0],c.index=Ru(o),c}i.values=u,i.index=Ru(s),i=i.transpose()}return i}QS.exports=oj});var rN=Y((Wrt,nN)=>{var Na=qe(),nd=nt(),rd=Lr(),tN=yt(),sj=Qa();function uj(n,e,t){(rd(e)||nd(e))&&(e=[e]),(rd(t)||nd(t))&&(t=[t]);let r=sj((e||[]).concat(t||[]).map(a=>typeof a));return Na(r.length<=2,"Only whole numbers and/or strings are allowed in `get` arrays!"),r.length===1&&Na(r[0]==="string"||r[0]==="number","Only whole numbers and/or strings are allowed in `get` arrays!"),r.length===2&&(Na(r.indexOf("string")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!"),Na(r.indexOf("number")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!")),tN(e)||(e=e.map(a=>{if(rd(a))return Na(n.index.indexOf(a)>-1,`Row "${a}" does not exist!`),a;if(nd(a))return Na(a>=0,`Index ${a} is out of bounds!`),Na(parseInt(a)===a,"Row numbers must be integers!"),Na(a<n.index.length,`Index ${a} is out of bounds!`),n.index[a]})),tN(t)||(t=t.map(a=>{if(rd(a))return Na(n.columns.indexOf(a)>-1,`Column "${a}" does not exist!`),a;if(nd(a))return Na(a>=0,`Column ${a} is out of bounds!`),Na(parseInt(a)===a,"Column numbers must be integers!"),Na(a<n.columns.length,`Column ${a} is out of bounds!`),n.columns[a]})),n.getSubsetByNames(e,t)}nN.exports=uj});var yo=Y((Vrt,iN)=>{var aN=qe(),cj=Ue(),lj=lt(),fj=Tr(),hj=ut(),dj=yt();function pj(n,e){try{return n<e?-1:n>e?1:0}catch{return n=typeof n=="object"&&n!==null?JSON.stringify(n):n.toString(),e=typeof e=="object"&&e!==null?JSON.stringify(e):e.toString(),n<e?-1:n>e?1:0}}function vj(n,e){if(dj(e)&&(e=pj),lj(n)||hj(n))return n.sort(...Object.values(arguments).slice(1));aN(cj(n),"The `sort` function only works on arrays, Series, and DataFrames!"),aN(fj(e),"The second parameter of the `sort` function must be a comparison function!");let t=n.slice();return t.sort(e),t}iN.exports=vj});var cN=Y((Grt,uN)=>{var oN=qe(),sN=Lr(),mj=yt(),gj=Qa(),yj=yo();function bj(n){let e=n.toLowerCase(),t="";for(let a=0;a<e.length;a++){let i=e[a];i.match(/[a-z0-9]/g)?t+=i:t+=" "}let r=t.split(" ").filter(a=>a.length>0);return r[0]+r.slice(1).map(a=>a[0].toUpperCase()+a.substring(1)).join("")}function wj(n,e,t){mj(t)?t=e.columns:sN(t)&&(t=[t]);let r={};t.forEach(i=>{oN(sN(i),"You must pass either a string or a one-dimensional array of strings into the `getDummies` (AKA `oneHotEncode`) method!");let o=e.columns.indexOf(i);oN(o>-1,`The given DataFrame does not have a column called "${i}"!`);let s=e.values.map(c=>c[o]),u=yj(gj(s));s.forEach(c=>{u.forEach(l=>{let f=i+"_"+bj(l.toString());r[f]||(r[f]=[]),c===l?r[f].push(1):r[f].push(0)})})});let a=new n(r);return a.index=e.index,a}uN.exports=wj});var gN=Y((Urt,mN)=>{var bo=qe(),lN=Ue(),fN=nt(),hN=yt(),dN=Tl(),pN=sa(),vN=on();function xj(n,e,t){let r=n.shape;hN(e)&&(e=pN(0,r[0])),hN(t)&&(t=pN(0,r[1])),fN(e)&&(e=[e]),fN(t)&&(t=[t]),bo(lN(e)&&lN(t),"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),bo(vN(e).length===1&&vN(t).length===1,"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),bo(e.length>0,"The `rowIndices` array must contain at least one index."),bo(t.length>0,"The `colIndices` array must contain at least one index."),e.forEach(o=>{bo(dN(o),"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),bo(o<n.index.length,`The row index ${o} is out of bounds.`)}),t.forEach(o=>{bo(dN(o),"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),bo(o<n.columns.length,`The column index ${o} is out of bounds.`)});let a=e.map(o=>n.index[o]),i=t.map(o=>n.columns[o]);return n.getSubsetByNames(a,i)}mN.exports=xj});var kN=Y((Hrt,xN)=>{var wo=qe(),lg=pn(),yN=Ue(),ad=Lr(),bN=yt(),wN=on();function kj(n,e,t,r,a){bN(r)&&(r=t.index),bN(a)&&(a=t.columns),ad(r)&&(r=[r]),ad(a)&&(a=[a]),wo(yN(r)&&yN(a),"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),wo(wN(r).length===1&&wN(a).length===1,"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),wo(r.length>0,"The `rows` array must contain at least one row name."),wo(a.length>0,"The `cols` array must contain at least one column name."),r.forEach(s=>{wo(ad(s),"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),wo(t.index.indexOf(s)>-1,`The row name "${s}" does not exist in the list of rows.`)}),a.forEach(s=>{wo(ad(s),"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),wo(t.columns.indexOf(s)>-1,`The column name "${s}" does not exist in the list of columns.`)});let i=r.map(s=>a.map(u=>t.values[t.index.indexOf(s)][t.columns.indexOf(u)]));if(r.length===1&&a.length===1)return lg(i)[0];if(r.length===1){let s=new e(lg(i));return s.name=r[0],s.index=a,s}if(a.length===1){let s=new e(lg(i));return s.name=a[0],s.index=r,s}let o=new n(i);return o.columns=a,o.index=r,o}xN.exports=kj});var NN=Y((Krt,SN)=>{var Sj=Lr(),Il=sa();function Nj(n,e,t){function r(h,d){return Sj(h)&&h.length>d?h.substring(0,d-3)+"...":h}if(t.isEmpty)return console.table({}),console.log("Shape:",[0,0],`
`),t;let a=typeof window>"u"?20:10,i=parseInt(a/2),o=typeof process>"u"?10:Math.floor(process.stdout.columns/24)-1,s=parseInt(o/2),u=a>t.index.length?null:Il(0,i).concat(Il(t.index.length-i,t.index.length)),c=o>t.columns.length?null:Il(0,s).concat(Il(t.columns.length-s,t.columns.length)),l=t.get(u,c);l instanceof e&&(t.shape[0]===1?(l=new n([l.values]),l.index=t.index,l.columns=new e(t.columns).get(c).values):t.shape[1]===1&&(l=new n([l.values]).transpose(),l.index=new e(t.index).get(u).values,l.columns=t.columns)),a<=t.index.length&&(l._index.splice(i,0,"..."),l._values.splice(i,0,Il(0,l.columns.length).map(()=>"..."))),o<=t.columns.length&&(l._columns.splice(s,0,"..."),l._values=l._values.map(h=>(h.splice(s,0,"..."),h)));let f=28;return l instanceof e?(l.values=l.values.map(h=>r(h,f)),l.name=r(l.name,f),l.index=l.index.map(h=>r(h,f))):(l.values=l.values.map(h=>h.map(d=>r(d,f))),l.columns=l.columns.map(h=>r(h,f)),l.index=l.index.map(h=>r(h,f))),console.table(l.toObject()),console.log("Shape:",t.shape,`
`),t}SN.exports=Nj});var id=Y((jrt,TN)=>{var Tj=qe(),Ej=nt();function Ij(n,e){Tj(Ej(n),"The `leftPad` function only works on numbers!");let t=n.toString();for(;t.length<e;)t="0"+t;return t}TN.exports=Ij});var IN=Y((Xrt,EN)=>{var Cj=id(),Aj=sa();function Dj(n,e){let t=e?n:n.copy();return t.index=Aj(0,n.shape[0]).map(r=>"row"+Cj(r,(t.index.length-1).toString().length)),t}EN.exports=Dj});var Cl=Y((Yrt,AN)=>{var _j=qe(),Fj=pn(),Rj=Ue(),Oj=lt(),Pj=ut();function CN(n){if(Oj(n)||Pj(n))return CN(n.values);_j(Rj(n),"The `product` function only works on arrays, Series, and DataFrames!");try{return n.length===0?NaN:Fj(n).reduce((e,t)=>e*t,1)}catch{return NaN}}AN.exports=CN});var od=Y((Zrt,RN)=>{var Al=qe(),DN=pn(),_N=Ue(),Mj=lt(),FN=nt(),Bj=ut(),Lj=Cl(),zj=on();function fg(n,e){if(Mj(n)||Bj(n))return fg(n.values,e);if(Al(_N(n),"The first argument passed into the `reshape` function must be an array!"),FN(e)&&(e=[e]),Al(_N(e),"The second argument passed into the `reshape` function must be a whole number or a one-dimensional array of whole numbers!"),Al(zj(e).length===1,"The first argument passed into the `reshape` function must be a whole number or a one-dimensional array of whole numbers!"),e.forEach(i=>{Al(FN(i)&&parseInt(i)===i&&i>0,"The first argument passed into the `reshape` function must be a whole number or a one-dimensional array of whole numbers!")}),e.length===0)return DN(n);let t=DN(n);if(e.length===1&&e[0]===t.length)return t;Al(Lj(e)===t.length,"The new shape doesn't match the number of values available in `x` (the first argument passed into the `reshape` function)!");let r=[],a=parseInt(t.length/e[0]);for(let i=0;i<e[0];i++){let o=t.slice(i*a,(i+1)*a);r.push(fg(o,e.slice(1)))}return r}RN.exports=fg});var Ou=Y((Jrt,$N)=>{var{copy:MN}=Ni(),$j=qe(),qj=Ue(),Wj=nt(),BN=yt(),Vj=go(),Gj=Cl(),Uj=od(),LN=Math.pow(2,64),sn=[];zN(parseInt(Math.random()*LN));function Hj(n,e){n=pr(n);function t(){n+=pr("0x9e3779b97f4a7c15");let a=MN(n);return a=(a^a>>30n)*pr("0xbf58476d1ce4e5b9"),a=(a^a>>27n)*pr("0x94d049bb133111eb"),a^a>>31n}let r=[];for(let a=0;a<e;a++)r.push(t());return r}function pr(n){return BigInt.asUintN(64,BigInt(n))}function ON(n,e){return n=pr(n),e=BigInt(e),pr(pr(n<<e)|pr(n>>pr(64n-e)))}function zN(n){if(BN(n))return MN(sn);{$j(Wj(n),"If passing a value into the `seed` function, then that value must be an integer!");let e=Hj(parseInt(n),4);sn[0]=e[0],sn[1]=e[1],sn[2]=e[2],sn[3]=e[3]}}function PN(){let n=pr(ON(sn[0]+sn[3],23)+sn[0]),e=pr(sn[1]<<17n);return sn[2]=pr(sn[2]^sn[0]),sn[3]=pr(sn[3]^sn[1]),sn[1]=pr(sn[1]^sn[2]),sn[0]=pr(sn[0]^sn[3]),sn[2]=pr(sn[2]^e),sn[3]=ON(sn[3],45),parseInt(n)/LN}function Kj(n){return BN(n)?PN():(qj(n)||(n=[n]),Uj(Vj(Gj(n)).map(PN),n))}$N.exports={random:Kj,seed:zN}});var sd=Y((Qrt,qN)=>{var{random:jj}=Ou(),Xj=qe(),Yj=Ue(),Zj=lt(),Jj=ut();function Qj(n){if(Zj(n)||Jj(n))return n.shuffle(...Object.values(arguments).slice(1));Xj(Yj(n),"The `shuffle` function only works on arrays, Series, and DataFrames!");let e=[],t=n.slice();for(let r=0;r<n.length;r++){let a=parseInt(jj()*t.length);e.push(t.splice(a,1)[0])}return e}qN.exports=Qj});var GN=Y((eat,VN)=>{var e8=qe(),t8=yt(),WN=sd();function n8(n,e){return t8(e)&&(e=0),e8(e===0||e===1,"The `axis` parameter to the `shuffle` must be 0, 1, or undefined."),n.get(e===0?WN(n.index):null,e===1?WN(n.columns):null)}VN.exports=n8});var ud=Y((tat,UN)=>{function r8(n){return typeof n=="boolean"}UN.exports=r8});var YN=Y((nat,XN)=>{var{random:a8}=Ou(),zr=qe(),i8=pn(),HN=Ue(),hg=ud(),jN=Tr(),cd=nt(),Pu=Lr(),dg=yt(),o8=sa(),KN=on(),pg=yo();function s8(n,e,t){return jN(e)?u8(n,e,t):c8(n,e,t)}function u8(n,e,t){if(t=dg(t)?0:t,zr(jN(e),"When sorting a DataFrame using a function, the first argument to the `sort` method must be a function!"),zr(cd(t),"When sorting a DataFrame using a function, the second argument to the `sort` method must be null, undefined, 0, or 1 to indicate the axis along which the data should be sorted! An axis of 0 means that the rows will be sorted relative to each other, whereas an axis of 1 means that the columns will be sorted relative to each other."),t===0){let r=pg(n.index,(a,i)=>e(n.get(a,null),n.get(i,null)));return n.get(r,null)}else{let r=pg(n.columns,(a,i)=>e(n.get(null,a),n.get(null,i)));return n.get(null,r)}}function c8(n,e,t){let r=n.copy(),a=a8().toString();return r=r.assign(a,r.index),dg(e)&&(e=[a],t=[!0]),(cd(e)||Pu(e))&&(e=[e],(hg(t)||Pu(t))&&(t=[t])),zr(HN(e),"The first parameter of the `sort` method must be (1) a string or index representing a column name or index, respectively; (2) a 1-dimensional array of strings and/or indices; or (3) null."),zr(KN(e).length===1,"The first parameter of the `sort` method must be (1) a string or index representing a column name or index, respectively; (2) a 1-dimensional array of strings and/or indices; or (3) null."),dg(t)&&(t=o8(0,e.length).map(()=>!0)),zr(HN(t),"The second parameter of the `sort` method must be (1) a string or boolean representing the sort direction ('ascending' / 'descending', or true / false); (2) a 1-dimensional array of strings and/or booleans; or (3) null."),zr(KN(t).length===1,"The second parameter of the `sort` method must be (1) a string or boolean representing the sort direction ('ascending' / 'descending', or true / false); (2) a 1-dimensional array of strings and/or booleans; or (3) null."),zr(e.length===t.length,"The arrays passed into the `sort` method must be equal in length."),e=e.map(i=>{if(zr(Pu(i)||cd(i),"Column references can either be column names (as strings) or column indices (as whole numbers)."),Pu(i)){let o=r.columns.indexOf(i);return zr(o>-1,`The column "${i}" does not exist!`),o}if(cd(i))return zr(parseInt(i)===i,"Column indices must be whole numbers!"),zr(i>=0,`The column index ${i} is out of bounds!`),zr(i<r.columns.length,`The index ${i} is out of bounds!`),i}),t=t.map(i=>{if(zr(Pu(i)||hg(i),"Direction references can either be strings ('ascending' or 'descending') or booleans (true or false)."),Pu(i)){let o=i.trim().toLowerCase();return zr(o==="ascending"||o==="descending","Direction references can either be strings ('ascending' or 'descending') or booleans (true or false)."),o==="ascending"}if(hg(i))return i}),r.values=pg(r.values,(i,o)=>{let s=0;for(;i[e[s]]===o[e[s]]&&s<e.length;)s++;let u=t[s];if(i[e[s]]===o[e[s]])return 0;if(i[e[s]]<o[e[s]])return u?-1:1;if(i[e[s]]>o[e[s]])return u?1:-1}),r.index=i8(r.get(null,a).values),r=r.dropColumns(a),r}XN.exports=s8});var vg=Y((rat,ZN)=>{function l8(n,e){return JSON.stringify(n.toObject(e))}ZN.exports=l8});var JN=Y((aat,gg)=>{var mg=Du(),f8=vg();function h8(n,e,t){let r=f8(n,t),a=!1,i=!1,o,s;try{let u=e;if(e.includes("/")){let l=e.split("/");u=l[l.length-1]}let c=document.createElement("a");c.href=`data:application/json;charset=utf-8,${encodeURIComponent(r)}`,c.download=u,c.dispatchEvent(new MouseEvent("click")),a=!0}catch(u){o=u}try{let u=_2("fs"),c=_2("path");u.writeFileSync(c.resolve(e),r,"utf8"),i=!0}catch(u){s=u}if(!a&&!i)throw typeof window<"u"?new mg(o):typeof gg<"u"?new mg(s):new mg("I don't know what's going wrong, but it doesn't seem like you're in Node or the browser, and we couldn't download and/or write the file to disk!");return n}gg.exports=h8});var eT=Y((iat,QN)=>{var d8=qe(),p8=yt();function v8(n,e){p8(e)?e=0:d8(e===0||e===1,"The axis parameter of the `toObject` method must be undefined, 0, or 1. An axis of 0 indicates that the returned object should be organized first by rows and then by columns. An axis of 1 indicates that the returned object should be organized first by columns and then by rows.");let t={};return e===0?n.index.forEach((r,a)=>{let i={};n.columns.forEach((o,s)=>{i[o]=n.values[a][s]}),t[r]=i}):n.columns.forEach((r,a)=>{let i={};n.index.forEach((o,s)=>{i[o]=n.values[s][a]}),t[r]=i}),t}QN.exports=v8});var cs=Y((oat,rT)=>{var tT=qe(),m8=Ue(),g8=lt(),y8=ut(),b8=go(),nT=Nl(),w8=on();function x8(n){if(g8(n)||y8(n))return n.transpose();tT(m8(n),"The `transpose` function only works on arrays, Series, and DataFrames!");let e=w8(n);if(tT(e.length<=2,"I'm not smart enough to know how to transpose arrays that have more than 2 dimensions. Sorry for the inconvenience! Please only pass 1- or 2-dimensional arrays into the `transpose` function!"),e.length===1)return nT(n);if(e.length===2){let t=b8(nT(e));for(let r=0;r<e[0];r++)for(let a=0;a<e[1];a++)t[a][r]=n[r][a];return t}}rT.exports=x8});var sT=Y((sat,oT)=>{var aT=qe(),k8=Ue(),S8=lt(),N8=Jh(),T8=ut(),E8=on();function iT(n,e,t){if(T8(t))return new n(e.values.concat(t.values));if(k8(t)){let r=E8(t);aT(r.length===1&&!N8(r),"Only vectors can be appended to Series!");let a=e.copy();return t.forEach((i,o)=>{a._values.push(i),a._index.push("item"+(e.values.length+o))}),a}return aT(!S8(t),"DataFrames cannot be appended to Series!"),iT(e,[t])}oT.exports=iT});var cT=Y((uat,uT)=>{var I8=qe(),C8=Tr();function A8(n,e){I8(C8(e),"The parameter to the `apply` method must be a function.");let t=n.copy();return t._values=t._values.map((r,a)=>e(r,a)),t}uT.exports=A8});var fT=Y((cat,lT)=>{var D8=yt();function _8(n){let e=n.copy(),t=[];return e._values=e.values.filter((r,a)=>D8(r)?!1:(t.push(e.index[a]),!0)),e._index=t,e}lT.exports=_8});var dT=Y((lat,hT)=>{var F8=nt();function R8(n,e){let t=[],r=[];e.values.forEach((i,o)=>{F8(i)&&(r.push(i),t.push(e.index[o]))});let a=new n(r);return a.name=e.name,a.index=t,a}hT.exports=R8});var vT=Y((fat,pT)=>{var{copy:O8}=Ni();function P8(n,e,t){let r=e.copy(),a=O8(r.index),i=[],o=r.values.filter((s,u)=>{let c=t(s,u,r.values);return c||i.push(r.index[u]),c});return i.forEach(s=>{a.splice(a.indexOf(s),1)}),o.length===0?(r=new n,r.name=e.name,r):(r.values=o,r.index=a,r)}pT.exports=P8});var gT=Y((hat,mT)=>{var xo=qe(),M8=nt(),B8=Lr(),L8=yt(),z8=Qa();function $8(n,e){(B8(e)||M8(e))&&(e=[e]);let t=z8((e||[]).map(r=>typeof r));return xo(t.length<=2,"Only whole numbers and/or strings are allowed in `get` arrays!"),t.length===1&&xo(t[0]==="string"||t[0]==="number","Only whole numbers and/or strings are allowed in `get` arrays!"),t.length===2&&(xo(t.indexOf("string")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!"),xo(t.indexOf("number")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!")),L8(e)||(e=e.map(r=>{if(typeof r=="string")return xo(n.index.indexOf(r)>-1,`Index "${r}" does not exist!`),r;if(typeof r=="number")return xo(r>=0,`Index ${r} is out of bounds!`),xo(parseInt(r)===r,"Indices must be integers!"),xo(r<n.index.length,`Index ${r} is out of bounds!`),n.index[r]})),n.getSubsetByNames(e)}mT.exports=$8});var bT=Y((dat,yT)=>{var Dl=qe(),q8=Ue(),W8=yt(),V8=Tl(),G8=sa(),U8=on();function H8(n,e){let t=n.shape;W8(e)&&(e=G8(0,t[0])),Dl(q8(e),"The `indices` array must be 1-dimensional array of whole numbers."),Dl(U8(e).length===1,"The `indices` array must be a 1-dimensional array of whole numbers."),Dl(e.length>0,"The `indices` array must contain at least one index."),e.forEach(a=>{Dl(V8(a),"The `indices` array must be a 1-dimensional array of whole numbers."),Dl(a<n.index.length,`The row index ${a} is out of bounds.`)});let r=e.map(a=>n.index[a]);return n.getSubsetByNames(r)}yT.exports=H8});var xT=Y((pat,wT)=>{var _l=qe(),K8=Ue(),j8=Lr(),X8=yt(),Y8=on();function Z8(n,e,t){X8(t)&&(t=e.index),_l(K8(t),"The `indices` array must be a 1-dimensional array of strings."),_l(Y8(t).length===1,"The `indices` array must be a 1-dimensional array of strings."),_l(t.length>0,"The `indices` array must contain at least one index name."),t.forEach(i=>{_l(j8(i),"The `indices` array must contain only strings."),_l(e.index.indexOf(i)>-1,`The name "${i}" does not exist in the index.`)});let r=t.map(i=>e.values[e.index.indexOf(i)]);if(r.length===1)return r[0];let a=new n(r);return a.index=t,a.name=e.name,a}wT.exports=Z8});var NT=Y((vat,ST)=>{var{copy:J8}=Ni(),kT=sa();function Q8(n){let e=n.copy(),t=typeof window>"u"?20:10;if(e.index.length>t){e=e.get(kT(0,t/2).concat(kT(e.index.length-t/2,e.index.length)));let a=J8(e.index);a.splice(parseInt(a.length/2),0,"..."),e.values.push("..."),e.index.push("..."),e=e.get(a)}let r={};return e.values.forEach((a,i)=>{let o={};o[e.name]=a,r[e.index[i]]=o}),console.table(r),console.log("Shape:",n.shape,`
`),n}ST.exports=Q8});var ET=Y((mat,TT)=>{var e7=sd();function t7(n){let e=n.copy();return e.get(e7(e.index))}TT.exports=t7});var CT=Y((gat,IT)=>{var n7=qe(),r7=Tr(),a7=yt(),i7=yo(),o7=cs();function s7(n,e,t){t=t||((u,c)=>u<c?-1:1),n7(a7(t)||r7(t),"You must pass undefined, null, or a comparison function as the second argument to the `sort` method!");let r=o7([e.values,e.index]),a=i7(r,(u,c)=>t(u[0],c[0])),i=[],o=[];a.forEach(u=>{i.push(u[0]),o.push(u[1])});let s=new n;return s._values=i,s._index=o,s.name=e.name,s}IT.exports=s7});var _T=Y((yat,DT)=>{var u7=yo(),AT=cs();function c7(n,e){let t=AT([e.values,e.index]);t=AT(u7(t,(a,i)=>{if(a[1]===i[1])return 0;if(a[1]<i[1])return-1;if(a[1]>i[1])return 1}));let r=new n(t[0]);return r.index=t[1],r.name=e.name,r}DT.exports=c7});var RT=Y((bat,FT)=>{function l7(n){let e={};return e[n.name]={},n.index.forEach((t,r)=>{e[n.name][t]=n.values[r]}),e}FT.exports=l7});var LT=Y((wat,BT)=>{var{copy:ld}=Ni(),Ui=qe(),yg=Ue(),f7=Lr(),h7=yt(),OT=id(),PT=sa(),fd=Nl(),d7=sT(),p7=cT(),v7=fT(),m7=dT(),g7=vT(),y7=gT(),b7=bT(),w7=xT(),x7=NT(),k7=ET(),S7=CT(),N7=_T(),T7=RT(),Fl=on(),E7=cs(),MT=Symbol.for("@jrc03c/js-math-tools/series");BT.exports=function(n){class e{static[Symbol.hasInstance](r){try{return!!r._symbol&&r._symbol===MT}catch{return!1}}constructor(r){let a=this;if(a.name="data",Object.defineProperty(a,"_symbol",{configurable:!1,enumerable:!1,writable:!1,value:MT}),Object.defineProperty(a,"_values",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(a,"values",{configurable:!0,enumerable:!0,get(){return a._values},set(i){Ui(yg(i),"The new values must be a 1-dimensional array!");let o=Fl(i);Ui(o.length===1,"The new array of values must be 1-dimensional!"),o[0]<a._index.length?a._index=a._index.slice(0,o[0]):o[0]>a._index.length&&(a._index=a._index.concat(PT(a._index.length,o[0]).map(s=>"item"+OT(s,(i.length-1).toString().length)))),a._values=i}}),Object.defineProperty(a,"_index",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(a,"index",{configurable:!0,enumerable:!0,get(){return a._index},set(i){Ui(yg(i),"The new index must be a 1-dimensional array of strings!"),Ui(i.length===a.shape[0],"The new index must be the same length as the old index!"),Ui(Fl(i).length===1,"The new index must be a 1-dimensional array of strings!"),i.forEach(o=>{Ui(f7(o),"All of the row names must be strings!")}),a._index=i}}),r){if(r instanceof e)a.name=r.name,a.values=ld(r.values),a.index=ld(r.index);else if(yg(r)){let i=Fl(r);Ui(i.length===1,"When passing an array into the constructor of a Series, the array must be 1-dimensional!"),a.values=r}else if(r instanceof Object){let i=Object.keys(r);Ui(i.length===1,"When passing an object into the constructor of a Series, the object must have only 1 key-value pair, where the key is the name of the data and the value is the 1-dimensional array of values!");let o=i[0],s=r[o];Ui(Fl(s).length===1,"When passing an object into the constructor of a Series, the object must have only 1 key-value pair, where the key is the name of the data and the value is the 1-dimensional array of values!"),a.name=o,a.values=s.slice()}}}get shape(){return Fl(this.values)}get length(){return this.shape[0]}get isEmpty(){return this.values.filter(a=>!h7(a)).length===0}clear(){let a=this.copy();return a.values.forEach((i,o)=>{a.values[o]=void 0}),a}get(r){return y7(this,r)}getSubsetByNames(r){return w7(e,this,r)}getSubsetByIndices(r){return b7(this,r)}loc(r){return this.getSubsetByNames(r)}iloc(r){return this.getSubsetByIndices(r)}reverse(){let r=this,a=new e(fd(r.values));return a.index=fd(r.index),a.name=r.name,a}resetIndex(){let r=this,a=r.copy();return a.index=PT(0,r.shape[0]).map(i=>"item"+OT(i,(a.index.length-1).toString().length)),a}copy(){let r=this,a=new e;return a._values=ld(r.values),a._index=ld(r.index),a.name=r.name,a}append(r){return d7(e,this,r)}apply(r){return p7(this,r)}concat(r){return this.append(r)}dropMissing(r,a){return v7(this,r,a)}dropNaN(){return m7(e,this)}toObject(){return T7(this)}print(){return x7(this)}shuffle(){return k7(this)}sort(r){return S7(e,this,r)}sortByIndex(){return N7(e,this)}filter(r){return g7(e,this,r)}toDataFrame(){let r=this,a=new n(E7([r.values]));return a.columns=[r.name],a.index=r.index,a}transpose(){let a=this.copy();return a.values=fd(a.values),a.index=fd(a.index),a}getDummies(){return this.toDataFrame().getDummies()}oneHotEncode(){return this.getDummies()}}return e}});var Ol=Y((xat,GT)=>{var{copy:bg}=Ni(),Ti=qe(),zT=kl(),I7=TS(),C7=DS(),A7=OS(),D7=MS(),_7=VS(),F7=HS(),R7=YS(),O7=eN(),P7=rN(),$T=cN(),M7=gN(),B7=kN(),L7=NN(),z7=IN(),$7=GN(),q7=YN(),W7=JN(),V7=vg(),G7=eT(),U7=pn(),Rl=Ue(),H7=mo(),qT=yt(),wg=id(),K7=go(),xg=sa(),Mu=on(),WT=cs(),VT=Symbol.for("@jrc03c/js-math-tools/dataframe");function hd(n){let e="abcdefghijklmnopqrstuvwxyz1234567890",t="";for(let r=0;r<n;r++)t+=e[parseInt(Math.random()*e.length)];return t}var Un=class{static[Symbol.hasInstance](e){try{return!!e._symbol&&e._symbol===VT}catch{return!1}}constructor(e){let t=this;if(Object.defineProperty(t,"_symbol",{configurable:!1,enumerable:!1,writable:!1,value:VT}),Object.defineProperty(t,"_values",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(t,"values",{configurable:!0,enumerable:!0,get(){return t._values.length===0||!qT(t._values[0])&&t._values[0].length===0?[[]]:t._values},set(r){Ti(Rl(r),"The new values must be a 2-dimensional array!");let a=Mu(r);Ti(a.length===2,"The new array of values must be 2-dimensional!"),a[0]<t._index.length?t._index=t._index.slice(0,a[0]):a[0]>t._index.length&&(t._index=t._index.concat(xg(t._index.length,a[0]).map(i=>"row"+wg(i,(a[0]-1).toString().length)))),a[1]<t._columns.length?t._columns=t._columns.slice(0,a[1]):a[1]>t._columns.length&&(t._columns=t._columns.concat(xg(t._columns.length,a[1]).map(i=>"col"+wg(i,(a[1]-1).toString().length)))),t._values=r}}),Object.defineProperty(t,"_columns",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(t,"columns",{configurable:!0,enumerable:!0,get(){return t._columns},set(r){Ti(Rl(r),"The new columns list must be a 1-dimensional array of strings!"),Ti(t.isEmpty||r.length===t.shape[1],"The new columns list must be the same length as the old columns list!"),Ti(Mu(r).length===1,"The new columns list must be a 1-dimensional array of strings!"),r=r.map(i=>(typeof i!="string"&&(i=JSON.stringify(i)||i.toString()),i.trim().length===0?"untitled_"+hd(8):i.trim()));let a=(()=>{let i=zT(r),o={};return i.forEach(s=>{o[s.value]=s.count}),o})();r=r.map(i=>a[i]>1?i+"_"+hd(8):i),t._columns=r}}),Object.defineProperty(t,"_index",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(t,"index",{configurable:!0,enumerable:!0,get(){return t._index},set(r){Ti(Rl(r),"The new index must be a 1-dimensional array of strings!"),Ti(t.isEmpty||r.length===t.shape[0],"The new index must be the same length as the old index!"),Ti(Mu(r).length===1,"The new index must be a 1-dimensional array of strings!"),r=r.map(i=>(typeof i!="string"&&(i=JSON.stringify(i)||i.toString()),i.trim().length===0?"untitled_"+hd(8):i.trim()));let a=(()=>{let i=zT(r),o={};return i.forEach(s=>{o[s.value]=s.count}),o})();r=r.map(i=>a[i]>1?i+"_"+hd(8):i),t._index=r}}),Ti(qT(e)||H7(e)||Rl(e),"The `data` passed into the constructor of a DataFrame must be either (1) an object where the key-value pairs are (respectively) column names and 1-dimensional arrays of values, or (2) a 2-dimensional array of values."),e)if(e instanceof Un)t.values=bg(e.values),t.columns=bg(e.columns),t.index=bg(e.index);else if(Rl(e)){let r=Mu(e);Ti(r.length===2,"The `data` array passed into the constructor of a DataFrame must be 2-dimensional!"),t.values=e}else{t._columns=Object.keys(e);let r=[];t._columns.forEach(i=>{let o=e[i];r.push(o)}),t._values=WT(r);let a=Mu(t.values);t._index=xg(0,a[0]).map(i=>"row"+wg(i,(a[0]-1).toString().length))}}get shape(){return Mu(this.values)}get length(){return this.shape[0]}get width(){return this.shape[1]}get rows(){return this.index}set rows(e){let t=this;t.index=e}get isEmpty(){return U7(this.values).length===0}clear(){let e=this,t=new Un(K7(e.shape));return t.columns=e.columns.slice(),t.index=e.index.slice(),t}get(e,t){let r=this;if(arguments.length===0)return r;if(arguments.length===1)try{return r.get(null,e)}catch{return r.get(e,null)}return P7(r,e,t)}getSubsetByNames(e,t){return B7(Un,ko,this,e,t)}getSubsetByIndices(e,t){return M7(this,e,t)}getDummies(e){return $T(Un,this,e)}oneHotEncode(e){return $T(Un,this,e)}transpose(){let e=this,t=new Un(WT(e.values));return t.columns=e.index.slice(),t.index=e.columns.slice(),t}get T(){return this.transpose()}resetIndex(e){return z7(this,e)}copy(){return D7(Un,this)}assign(e,t){return A7(Un,ko,this,e,t)}apply(e,t){return C7(Un,ko,this,e,t)}dropMissing(e,t,r){return F7(Un,ko,this,e,t,r)}dropNaN(e,t,r){return R7(Un,this,e,t,r)}drop(e,t){return _7(Un,ko,this,e,t)}dropColumns(e){return this.drop(null,e)}dropRows(e){return this.drop(e,null)}toObject(e){return G7(this,e)}toJSONString(e){return V7(this,e)}saveAsJSON(e,t){return W7(this,e,t)}print(){return L7(Un,ko,this)}sort(e,t){return q7(this,e,t)}sortByIndex(){return this.sort()}filter(e,t){return O7(Un,ko,this,e,t)}shuffle(e){return $7(this,e)}append(e,t){return I7(this,e,t)}concat(e,t){return this.append(e,t)}join(e,t){return this.append(e,t)}toString(){let e=this;return JSON.stringify(e)}},ko=LT()(Un);GT.exports={DataFrame:Un,Series:ko}});var Bu=Y((kat,HT)=>{var j7=qe(),X7=pn(),Y7=Ue(),Z7=lt(),J7=ut();function UT(n){if(Z7(n)||J7(n))return UT(n.values);j7(Y7(n),"The `max` function only works on arrays, Series, and DataFrames!");try{return Math.max(...X7(n))}catch{return NaN}}HT.exports=UT});var Lt=Y((Sat,ZT)=>{var{DataFrame:KT,Series:jT}=Ol(),XT=qe(),Pl=Ue(),kg=lt(),YT=Ja(),Q7=Tr(),Sg=ut(),eX=Bu(),tX=sa(),dd=on();function nX(n){return Pl(n)||Sg(n)||kg(n)}function rX(n){return XT(Q7(n),"You must pass a function into the `vectorize` function!"),function e(){let t,r,a=[],i=[],o=Object.keys(arguments).filter(s=>{let u=arguments[s];return Pl(u)?!0:Sg(u)?(t=!0,a.push(u),!0):kg(u)?(r=!0,i.push(u),!0):!1}).map(s=>arguments[s]);if(o.slice(0,-1).forEach((s,u)=>{XT(YT(Pl(s)?dd(s):s.shape,Pl(o[u+1])?dd(o[u+1]):o[u+1].shape),`When passing multiple arrays into the \`${n.name}\` function, all of the arrays must have the same shape!`)}),o.length>0){let s=eX(o.map(c=>c.length?c.length:c.values.length)),u=tX(0,s).map(c=>{let l=Object.keys(arguments).map(f=>{if(nX(arguments[f])){if(Pl(arguments[f]))return arguments[f][c];if(Sg(arguments[f]))return arguments[f].values[c];if(kg(arguments[f]))return arguments[f].values[c]}else return arguments[f]});return e(...l)});if(r)try{if(i.length===1&&YT(dd(i[0]),dd(u))){let c=new KT(u);return c.index=i[0].index.slice(),c.columns=i[0].columns.slice(),c}else return new KT(u)}catch{return u}if(t)try{if(a.length===1&&a[0].length===u.length){let c=new jT(u);return c.name=a[0].name,c.index=a[0].index.slice(),c}else return new jT(u)}catch{return u}return u}else return n(...arguments)}}ZT.exports=rX});var pd=Y((Nat,JT)=>{var aX=nt(),iX=Lt();function oX(n){try{return aX(n)?Math.abs(n):NaN}catch{return NaN}}JT.exports=iX(oX)});var vd=Y((Tat,QT)=>{var sX=nt(),uX=Lt();function cX(){try{let n=0,e=Object.values(arguments);for(let t=0;t<e.length;t++){if(!sX(e[t]))return NaN;n+=e[t]}return n}catch{return NaN}}QT.exports=uX(cX)});var Ml=Y((Eat,eE)=>{var lX=Lt();function fX(n,e){try{return e(n)}catch{return NaN}}eE.exports=lX(fX)});var nE=Y((Iat,tE)=>{var hX=nt(),dX=Lt();function pX(n){try{return hX(n)?Math.acos(n):NaN}catch{return NaN}}tE.exports=dX(pX)});var aE=Y((Cat,rE)=>{var vX=nt(),mX=Lt();function gX(n){try{return vX(n)?Math.asin(n):NaN}catch{return NaN}}rE.exports=mX(gX)});var oE=Y((Aat,iE)=>{var yX=nt(),bX=Lt();function wX(n){try{return yX(n)?Math.atan(n):NaN}catch{return NaN}}iE.exports=bX(wX)});var uE=Y((Dat,sE)=>{var xX=qe(),kX=wl(),SX=Ue(),NX=lt(),TX=ut(),EX=Bu();function Ng(n){if(NX(n)){let e=Ng(n.values);return[n.index[e[0]],n.columns[e[1]]]}if(TX(n)){let e=Ng(n.values);return[n.index[e]]}xX(SX(n),"The `argmax` function only works on arrays, Series, and DataFrames!");try{let e=kX(n,EX(n));return e?e.length===0?void 0:e.length===1?e[0]:e:void 0}catch{return}}sE.exports=Ng});var md=Y((_at,lE)=>{var IX=qe(),CX=pn(),AX=Ue(),DX=lt(),_X=ut();function cE(n){if(DX(n)||_X(n))return cE(n.values);IX(AX(n),"The `min` function only works on arrays, Series, and DataFrames!");try{return Math.min(...CX(n))}catch{return NaN}}lE.exports=cE});var hE=Y((Fat,fE)=>{var FX=qe(),RX=wl(),OX=Ue(),PX=lt(),MX=ut(),BX=md();function Tg(n){if(PX(n)){let e=Tg(n.values);return[n.index[e[0]],n.columns[e[1]]]}if(MX(n)){let e=Tg(n.values);return[n.index[e]]}FX(OX(n),"The `argmin` function only works on arrays, Series, and DataFrames!");try{let e=RX(n,BX(n));return e?e.length===0?void 0:e.length===1?e[0]:e:void 0}catch{return}}fE.exports=Tg});var Cg=Y((Rat,vE)=>{var dE=Ue(),Eg=ud(),LX=lt(),zX=Ja(),pE=nt(),$X=mo(),qX=ut(),Ig=yt();function Hi(n,e){if(LX(n)||qX(n))return n.apply(t=>Hi(t,e));if(dE(n))return n.map(t=>Hi(t,e));if(e==="null")return null;if(e==="number"){if(Ig(n))return NaN;let t=Hi(n,"boolean");if(Eg(t))return t?1:0;try{JSON.parse(n)}catch{let i=Hi(n,"date");if(i instanceof Date)return i.getTime()}let r=parseFloat(n);return isNaN(r)?NaN:r}if(e==="boolean"){if(Eg(n))return n;if(pE(n))return n===0?!1:n===1?!0:null;try{let t=(typeof n=="object"?n.toString()==="null"?"false":JSON.stringify(n):n.toString()).trim().toLowerCase();return t==="true"||t==="yes"||t==="y"?!0:t==="false"||t==="no"||t==="n"?!1:null}catch{return null}}if(e==="date"){if(n instanceof Date)return n;if(Ig(n))return null;let t=parseFloat(n);if(!isNaN(t)){let a=new Date(n);return a.toString()==="Invalid Date"?null:a}let r=Date.parse(n);return isNaN(r)?null:new Date(r)}if(e==="object"){if($X(n))return n;let t=Hi(n,"boolean");if(Eg(t))return null;try{let a=Hi(n,"number");if(pE(a))return JSON.parse(n),null}catch{}let r=Hi(n,"date");if(r)return r;try{let a=JSON.parse(n);return dE(a)?a.map(i=>Hi(i,e)):a}catch{return null}}if(e==="string")return Ig(n)?zX(n,void 0)?"undefined":"null":n instanceof Date?n.toJSON():(()=>typeof n=="object"?n===null?"null":JSON.stringify(n):n.toString())()}vE.exports=Hi});var gE=Y((Oat,mE)=>{var WX=nt(),VX=Lt();function GX(n){try{return WX(n)?Math.ceil(n):NaN}catch{return NaN}}mE.exports=VX(GX)});var wE=Y((Pat,bE)=>{var UX=pd(),yE=nt(),HX=yt(),KX=Lt();function jX(n,e){try{if(!yE(n))return NaN;if(HX(e))e=1e-10;else if(!yE(e))return NaN;return UX(n)<e?0:n}catch{return NaN}}bE.exports=KX(jX)});var kE=Y((Mat,xE)=>{var Ag=nt(),XX=Lt();function YX(n,e,t){try{return Ag(n)?Ag(e)?Ag(t)?n<e?e:n>t?t:n:NaN:NaN:NaN}catch{return NaN}}xE.exports=XX(YX)});var NE=Y((Bat,SE)=>{var Dg=qe(),ZX=pn(),JX=Ue(),QX=lt(),e9=nt(),t9=ut();function _g(n,e){if(QX(n)||t9(n))return _g(n.values,e);if(Dg(JX(n),"The `combinations` function only works on arrays, Series, and DataFrames!"),Dg(e9(e),"`r` must be a whole number!"),n=ZX(n),e>n.length)return[n];if(e<=0)return[[]];if(Dg(e===parseInt(e),"`r` must be a whole number!"),n.length<2)return n;let t=[];return n.forEach((r,a)=>{let i=n.slice(a+1);if(i.length<e-1)return;_g(i,e-1).forEach(s=>{t.push([r].concat(s))})}),t}SE.exports=_g});var gd=Y((Lat,EE)=>{var n9=qe(),r9=pn(),a9=Ue(),i9=lt(),o9=ut();function TE(n){if(i9(n)||o9(n))return TE(n.values);n9(a9(n),"The `mean` function only works on arrays, Series, and DataFrames!");try{let e=r9(n),t=0;return e.forEach(r=>{t+=r}),t/e.length}catch{return NaN}}EE.exports=TE});var Rg=Y((zat,FE)=>{var IE=qe(),CE=Ue(),yd=nt(),AE=ut(),DE=gd(),_E=on();function Fg(n,e){if(AE(n))return Fg(n.values,e);if(AE(e))return Fg(n,e.values);IE(CE(n)&&CE(e)&&_E(n).length===1&&_E(e).length===1,"The `covariance` function only works on 1-dimensional arrays and Series!"),IE(n.length===e.length,"The two arrays or Series passed into the `covariance` function must have the same length!");try{let t=DE(n),r=DE(e);if(!yd(t)||!yd(r))return NaN;let a=Math.max(n.length,e.length),i=0;for(let o=0;o<a;o++){if(!yd(n[o]))return NaN;if(!yd(e[o]))return NaN;i+=(n[o]-t)*(e[o]-r)}return i/n.length}catch{return NaN}}FE.exports=Fg});var bd=Y(($at,RE)=>{var s9=nt(),u9=Lt();function c9(n){try{return s9(n)?Math.sqrt(n):NaN}catch{return NaN}}RE.exports=u9(c9)});var Og=Y((qat,PE)=>{var l9=qe(),f9=pn(),h9=Ue(),d9=lt(),p9=nt(),v9=ut(),m9=gd();function OE(n){if(d9(n)||v9(n))return OE(n.values);l9(h9(n),"The `variance` function only works on arrays, Series, and DataFrames!");try{let e=f9(n),t=m9(e),r=0;for(let a=0;a<e.length;a++){if(!p9(e[a]))return NaN;r+=(e[a]-t)*(e[a]-t)}return r/e.length}catch{return NaN}}PE.exports=OE});var wd=Y((Wat,BE)=>{var g9=qe(),y9=Ue(),b9=lt(),w9=ut(),x9=bd(),k9=Og();function ME(n){if(b9(n)||w9(n))return ME(n.values);g9(y9(n),"The `std` function only works on arrays, Series, and DataFrames!");try{return x9(k9(n))}catch{return NaN}}BE.exports=ME});var GE=Y((Vat,VE)=>{var LE=qe(),S9=Rg(),zE=Ue(),$E=ut(),qE=on(),WE=wd();function Pg(n,e){if($E(n))return Pg(n.values,e);if($E(e))return Pg(n,e.values);LE(zE(n)&&zE(e)&&qE(n).length===1&&qE(e).length===1,"The `correl` function only works on 1-dimensional arrays and Series!"),LE(n.length===e.length,"The two arrays or Series passed into the `correl` function must have the same length!");try{return S9(n,e)/(WE(n)*WE(e))}catch{return NaN}}VE.exports=Pg});var HE=Y((Gat,UE)=>{var N9=nt(),T9=Lt();function E9(n){try{return N9(n)?Math.cos(n):NaN}catch{return NaN}}UE.exports=T9(E9)});var jE=Y((Uat,KE)=>{KE.exports=Object.freeze({boolean:"boolean",date:"date",null:"null",number:"number",object:"object",string:"string"})});var eI=Y((Hat,QE)=>{var I9=qe(),XE=Ue(),YE=lt(),C9=Ja(),ZE=ut(),JE=Qa();function Mg(n,e){if(YE(n)||ZE(n))return Mg(n.values,e);if(YE(e)||ZE(e))return Mg(n,e.values);I9(XE(n)&&XE(e),"The `diff` function only works on arrays, Series, and DataFrames!");let t=JE(n),r=JE(e),a=[];return t.forEach(i=>{r.findIndex(o=>C9(o,i))<0&&a.push(i)}),a}QE.exports=Mg});var xd=Y((Kat,nI)=>{var tI=nt(),A9=Lt();function D9(n,e){try{return tI(n)?tI(e)?Math.pow(n,e):NaN:NaN}catch{return NaN}}nI.exports=A9(D9)});var Bg=Y((jat,rI)=>{var _9=nt(),F9=Lt();function R9(){try{let n=Object.values(arguments);if(n.length===0)return NaN;let e=1;for(let t=0;t<n.length;t++){if(!_9(n[t]))return NaN;e*=n[t]}return e}catch{return NaN}}rI.exports=F9(R9)});var Lu=Y((Xat,aI)=>{var O9=Bg();function P9(){return O9(...arguments)}aI.exports=P9});var Lg=Y((Yat,iI)=>{var M9=vd(),B9=Lu();function L9(n,e){return M9(n,B9(e,-1))}iI.exports=L9});var kd=Y((Zat,sI)=>{var z9=qe(),$9=pn(),q9=Ue(),W9=lt(),V9=ut();function oI(n){if(W9(n)||V9(n))return oI(n.values);z9(q9(n),"The `sum` function only works on arrays, Series, and DataFrames!");try{return n.length===0?NaN:$9(n).reduce((e,t)=>e+t,0)}catch{return NaN}}sI.exports=oI});var pI=Y((Jat,dI)=>{var G9=pd(),U9=qe(),uI=Ue(),cI=lt(),H9=Ja(),lI=nt(),fI=ut(),K9=xd(),hI=on(),j9=bd(),X9=Lg(),Y9=kd();function zg(n,e){if(lI(n)&&lI(e))return G9(n-e);if(cI(n)||fI(n))return zg(n.values,e);if(cI(e)||fI(e))return zg(n,e.values);uI(n)&&uI(e)&&U9(H9(hI(n),hI(e)),"If passing two arrays, Series, or DataFrames into the `distance` function, then those objects must have the same shape!");try{return j9(Y9(K9(X9(n,e),2)))}catch{return NaN}}dI.exports=zg});var mI=Y((Qat,vI)=>{var Z9=xd(),J9=Lu();function Q9(n,e){return J9(n,Z9(e,-1))}vI.exports=Q9});var qg=Y((eit,kI)=>{var{DataFrame:gI,Series:yI}=Ol(),Sd=qe(),bI=pn(),wI=Ue(),$g=lt(),eY=nt(),Nd=ut(),tY=Lu(),Td=on(),nY=kd(),xI=cs();function So(n,e){if($g(n)){let a=So(n.values,e);if(Td(a).length===1){let i=new yI(a);return i.name=Nd(e)?e.name:i.name,i.index=n.index.slice(),i}else{let i=new gI(a);return i.index=n.index.slice(),$g(e)&&(i.columns=e.columns.slice()),i}}if($g(e)){let a=So(n,e.values);if(Td(a).length===1){let i=new yI(a);return i.name=Nd(n)?n.name:i.name,i.index=e.columns.slice(),i}else{let i=new gI(a);return i.columns=e.columns.slice(),i}}if(Nd(n))return So(n.values,e);if(Nd(e))return So(n,e.values);Sd(wI(n)&&wI(e),"The `dot` function only works on arrays, Series, and DataFrames!"),bI(n).concat(bI(e)).forEach(a=>{Sd(eY(a),"One of the arrays you passed into the `dot` function contains non-numerical values!")});let t=Td(n),r=Td(e);if(Sd(t.length<=2&&r.length<=2,"I'm not smart enough to know how to get the dot-product of arrays that have more than 2 dimensions. Sorry for the inconvenience! Please only pass 1- or 2-dimensional arrays into the `dot` function!"),Sd(t[t.length-1]===r[0],`There's a dimension misalignment in the two arrays you passed into the \`dot\` function. (${t[t.length-1]} !== ${r[0]})`),t.length===1&&r.length===1)return nY(tY(n,e));if(t.length===1&&r.length===2)return xI(e).map(a=>So(n,a));if(t.length===2&&r.length===1)return n.map(a=>So(a,e));if(t.length===2&&r.length===2){let a=xI(e),i=[];for(let o=0;o<n.length;o++){let s=[];for(let u=0;u<a.length;u++)s.push(So(n[o],a[u]));i.push(s)}return i}}kI.exports=So});var Wg=Y((tit,NI)=>{var rY=qe(),aY=Ue(),iY=lt(),oY=ut(),sY=yt();function SI(n){if(iY(n)||oY(n))return n.dropMissing(...Object.values(arguments).slice(1));rY(aY(n),"The `dropMissing` function only works on arrays, Series, and DataFrames!");let e=[];return n.forEach(t=>{try{return e.push(SI(t))}catch{sY(t)||e.push(t)}}),e}NI.exports=SI});var FI=Y((nit,_I)=>{var TI=qe(),EI=Ue(),II=lt(),uY=Ja(),CI=ut(),AI=yt(),DI=on();function Ed(n,e){if(II(n)||CI(n))return Ed(n.values,e);if(II(e)||CI(e))return Ed(n,e.values);TI(EI(n)&&EI(e),"The `dropMissingPairwise` function only works on arrays, Series, and DataFrames!"),TI(uY(DI(n),DI(e)),"The two arrays, Series, and/or DataFrames passed into the `dropMissingPairwise` function must have the same shape!");let t=[],r=[];for(let a=0;a<n.length;a++)try{let[i,o]=Ed(n[a],e[a]);t.push(i),r.push(o)}catch{!AI(n[a])&&!AI(e[a])&&(t.push(n[a]),r.push(e[a]))}return[t,r]}_I.exports=Ed});var $I=Y((rit,zI)=>{var RI=qe(),OI=Ue(),PI=lt(),cY=Ja(),MI=nt(),BI=ut(),LI=on();function Id(n,e){if(PI(n)||BI(n))return Id(n.values,e);if(PI(e)||BI(e))return Id(n,e.values);RI(OI(n)&&OI(e),"The `dropNaNPairwise` only works on arrays, Series, and DataFrames!"),RI(cY(LI(n),LI(e)),"The two arrays, Series, and/or DataFrames passed into the `dropNaNPairwise` must have the same shape!");let t=[],r=[];for(let a=0;a<n.length;a++)try{let[i,o]=Id(n[a],e[a]);t.push(i),r.push(o)}catch{MI(n[a])&&MI(e[a])&&(t.push(n[a]),r.push(e[a]))}return[t,r]}zI.exports=Id});var WI=Y((ait,qI)=>{var lY=Wg();function fY(n){return lY(n)}qI.exports=fY});var GI=Y((iit,VI)=>{var hY=nt(),dY=Lt();function pY(n){try{return hY(n)?Math.exp(n):NaN}catch{return NaN}}VI.exports=dY(pY)});var KI=Y((oit,HI)=>{var vY=Lt();function UI(n){try{return n!==parseInt(n)?NaN:n<=1?1:n*UI(n-1)}catch{return NaN}}HI.exports=vY(UI)});var ZI=Y((sit,YI)=>{var mY=qe(),gY=pn(),jI=Ue(),yY=lt(),bY=Tr(),XI=mo(),wY=ut();function Vg(n,e){if(yY(n))return Vg(gY(n.values),e);if(wY(n))return Vg(n.values,e);if(mY(XI(n)||jI(n),"You must pass (1) an object, array, Series, or DataFrame and (2) a function or value into the `find` function!"),!bY(e)){let a=e;e=i=>i===a}function t(a,i,o){if(o=o||[],o.indexOf(a)>-1)return null;if(XI(a)){o.push(a);let s=Object.keys(a);for(let u=0;u<s.length;u++){let c=s[u],l=a[c];if(i(l))return l;let f=t(l,i,o);if(f)return f}}else if(jI(a)){o.push(a);for(let s=0;s<a.length;s++){let u=a[s];if(i(u))return u;let c=t(u,i,o);if(c)return c}}else if(i(a))return a;return null}function r(a){try{return e(a)}catch{return!1}}return t(n,r)}YI.exports=Vg});var tC=Y((uit,eC)=>{var xY=qe(),kY=pn(),JI=Ue(),SY=lt(),NY=Tr(),QI=mo(),TY=ut();function Gg(n,e){if(SY(n))return Gg(kY(n.values),e);if(TY(n))return Gg(n.values,e);if(xY(QI(n)||JI(n),"You must pass (1) an object, array, Series, or DataFrame and (2) a function or value into the `findAll` function!"),!NY(e)){let i=e;e=o=>o===i}function t(i,o,s){if(s=s||[],s.indexOf(i)>-1)return null;if(QI(i)){s.push(i);let u=Object.keys(i),c=[];for(let l=0;l<u.length;l++){let f=u[l],h=i[f],d=!1;o(h)&&(c.push(h),d=!0);let p=t(h,o,s);p&&p.length>0&&p.slice(d?1:0).forEach(v=>c.push(v))}return c}else if(JI(i)){s.push(i);let u=[];for(let c=0;c<i.length;c++){let l=i[c],f=!1;o(l)&&(u.push(l),f=!0);let h=t(l,o,s);h&&h.length>0&&h.slice(f?1:0).forEach(d=>u.push(d))}return u}else if(o(i))return[i];return null}function r(i){try{return e(i)}catch{return!1}}let a=t(n,r);return a&&a.length>0?a:null}eC.exports=Gg});var rC=Y((cit,nC)=>{var EY=nt(),IY=Lt();function CY(n){try{if(n==="Infinity")return 1/0;if(n==="-Infinity")return-1/0;let e=JSON.parse(n);return EY(e)?e:NaN}catch{return NaN}}nC.exports=IY(CY)});var iC=Y((lit,aC)=>{var AY=nt(),DY=Lt();function _Y(n){try{return AY(n)?Math.floor(n):NaN}catch{return NaN}}aC.exports=DY(_Y)});var Ug=Y((fit,oC)=>{var FY=nt(),RY=Cl(),OY=od();function PY(n){FY(n)&&(n=[n]);let e=[],t=RY(n);for(let r=0;r<t;r++)e.push(0);return OY(e,n)}oC.exports=PY});var uC=Y((hit,sC)=>{var Cd=qe(),MY=nt(),BY=yt(),LY=Ug();function zY(n){Cd(!BY(n),"You must pass an integer greater than 0 (representing the size) into the `identity` function!"),Cd(MY(n),"You must pass an integer greater than 0 (representing the size) into the `identity` function!"),Cd(parseInt(n)===n,"You must pass an integer greater than 0 (representing the size) into the `identity` function!"),Cd(n>0,"You must pass an integer greater than 0 (representing the size) into the `identity` function!");let e=LY([n,n]);for(let t=0;t<n;t++)e[t][t]=1;return e}sC.exports=zY});var lC=Y((dit,cC)=>{cC.exports=["true","false","yes","no"]});var hC=Y((pit,fC)=>{fC.exports=["null","none","nan","na","n/a","","undefined"]});var pC=Y((vit,dC)=>{var $Y=Ml(),qY=qe(),WY=lC(),VY=Cg(),GY=kl(),UY=pn(),Hg=Ue(),HY=lt(),KY=nt(),jY=ut(),XY=Lr(),YY=hC();function Ad(n){if(HY(n)){let a=n.copy(),i=Ad(n.values);return a.values=i.values,{type:i.type,values:a}}if(jY(n)){let a=n.copy(),i=Ad(n.values);return a.values=i.values,{type:i.type,values:a}}if(!Hg(n)){let a=Ad([n]);return a.value=a.values[0],delete a.values,a}qY(Hg(n),"The `inferType` function only works on arrays, Series, and DataFrames!");let e=UY(n).map(a=>{if(a===void 0)return"null";try{if(typeof a=="object"){let s=new Date(a.toString());if(s instanceof Date&&s.toString()!=="Invalid Date")return"date"}}catch{}XY(a)||(a=JSON.stringify(a));let o=a.toLowerCase().trim();if(YY.indexOf(o)>-1)return"null";if(WY.indexOf(o)>-1)return"boolean";try{let s=JSON.parse(a);return KY(s)?"number":typeof s=="object"?Hg(s)?"string":"object":"string"}catch{return new Date(a).toString()!=="Invalid Date"?"date":"string"}}),r=GY(e).sort((a,i)=>i.count-a.count)[0].value;return{type:r,values:$Y(n,a=>VY(a,r))}}dC.exports=Ad});var mC=Y((mit,vC)=>{var ZY=nt(),JY=Lt();function QY(n){try{let e=JSON.parse(n);return ZY(e)?parseInt(e):NaN}catch{return NaN}}vC.exports=JY(QY)});var yC=Y((git,gC)=>{var eZ=qe(),tZ=Ue(),nZ=lt(),rZ=Ja(),aZ=ut(),Kg=Qa();function iZ(){let n=Object.values(arguments).map(t=>nZ(t)||aZ(t)?Kg(t.values):(eZ(tZ(t),"The `intersect` function only works on arrays, Series, and DataFrames!"),Kg(t)));return Kg(n).filter(t=>n.every(r=>r.findIndex(a=>rZ(a,t))>-1))}gC.exports=iZ});var kC=Y((yit,xC)=>{var bC=vd(),No=qe(),oZ=qg(),sZ=pn(),uZ=Ue(),cZ=lt(),jg=nt(),wC=Lu(),lZ=on();function Dd(n){if(cZ(n)){let t=n.copy();return t.values=Dd(t.values),t}No(uZ(n),"The `inverse` function only works on square 2-dimensional arrays or DataFrames!"),sZ(n).forEach(t=>No(jg(t),"The array passed into the `inverse` function must contain only numbers!"));let e=lZ(n);if(No(e.length===2,"The array passed into the `inverse` function must be exactly two-dimensional and square!"),No(e[0]===e[1],"The array passed into the `inverse` function must be exactly two-dimensional and square!"),No(e[0]>=0,"The array passed into the `inverse` function must be exactly two-dimensional and square!"),e[0]===0)return n;if(e[0]===1)return No(n[0][0]!==0,"This matrix cannot be inverted!"),1/n[0][0];if(e[0]===2){let t=n[0][0],r=n[0][1],a=n[1][0],i=n[1][1],o=t*i-r*a;No(o!==0,"This matrix cannot be inverted!");let s=[[i,-r],[-a,t]];return wC(s,1/o)}else if(e[0]>1){let t=(r,a)=>jg(r)||jg(a)?wC(r,a):oZ(r,a);for(let r=1;r<e[0]-1;r++)try{let a=n.slice(0,r).map(v=>v.slice(0,r)),i=n.slice(0,r).map(v=>v.slice(r,e[0])),o=n.slice(r,e[0]).map(v=>v.slice(0,r)),s=n.slice(r,e[0]).map(v=>v.slice(r,e[0])),u=Dd(a),c=Dd(bC(s,t(-1,t(t(o,u),i)))),l=bC(u,t(t(t(t(u,i),c),o),u)),f=t(-1,t(t(u,i),c)),h=t(-1,t(t(c,o),u)),d=c;return l.map((v,m)=>v.concat(f[m])).concat(h.map((v,m)=>v.concat(d[m])))}catch{}No(!1,"This matrix cannot be inverted!")}}xC.exports=Dd});var NC=Y((bit,SC)=>{var fZ=new Function(`
    try {
      return this === window
    } catch(e) {}

    try {
      return !!importScripts
    } catch(e){}

    return false
  `);SC.exports=fZ});var EC=Y((wit,TC)=>{var Xg=nt(),hZ=Lt();function dZ(n,e,t){try{return Xg(n)?Xg(e)?Xg(t)?t*(e-n)+n:NaN:NaN:NaN}catch{return NaN}}TC.exports=hZ(dZ)});var AC=Y((xit,CC)=>{var IC=nt(),pZ=yt(),vZ=Lt();function mZ(n,e){try{return e=pZ(e)?Math.E:e,IC(n)?IC(e)?Math.log(n)/Math.log(e):NaN:NaN}catch{return NaN}}CC.exports=vZ(mZ)});var FC=Y((kit,_C)=>{var gZ=qe(),yZ=pn(),bZ=Ue(),wZ=lt(),xZ=ut(),kZ=yo();function DC(n){if(wZ(n)||xZ(n))return DC(n.values);gZ(bZ(n),"The `median` function only works on arrays, Series, and DataFrames!");try{let e=kZ(yZ(n));return e.length===0?NaN:e.length%2===0?(e[e.length/2-1]+e[e.length/2])/2:e[parseInt(e.length/2)]}catch{return NaN}}_C.exports=DC});var PC=Y((Sit,OC)=>{var RC=nt(),SZ=Lt();function NZ(n,e){try{return RC(n)?RC(e)?n%e:NaN:NaN}catch{return NaN}}OC.exports=SZ(NZ)});var zC=Y((Nit,LC)=>{var TZ=qe(),EZ=kl(),IZ=pn(),CZ=Ue(),AZ=lt(),DZ=ut(),_Z=Qa(),MC=yo();function BC(n){if(AZ(n)||DZ(n))return BC(n.values);TZ(CZ(n),"The `mode` function only works on arrays, Series, and DataFrames!");try{if(n.length===0)return NaN;let e=IZ(n);if(e.length===0)return NaN;let t={},r=_Z(e);r.forEach(s=>{t[s]=EZ(e,s)});let a=MC(r,(s,u)=>t[u]-t[s]),i=a[0];return MC(a.filter(s=>t[s]===t[i]))}catch{return NaN}}LC.exports=BC});var VC=Y((Tit,WC)=>{var{random:$C}=Ou(),FZ=Ml(),RZ=yt(),OZ=go();function qC(){let n=$C(),e=$C();return Math.sqrt(-2*Math.log(n))*Math.cos(2*Math.PI*e)}function PZ(n){return RZ(n)?qC():FZ(OZ(n),qC)}WC.exports=PZ});var UC=Y((Eit,GC)=>{var MZ=Ml(),BZ=go();function LZ(n){return MZ(BZ(n),()=>1)}GC.exports=LZ});var KC=Y((Iit,HC)=>{var Yg=qe(),zZ=pn(),$Z=Ue(),qZ=lt(),WZ=nt(),VZ=ut(),GZ=yt();function _d(n,e){if(qZ(n)||VZ(n))return _d(n.values,e);if(Yg($Z(n),"The `permutations` function only works on arrays, Series, and DataFrames!"),GZ(e)&&(e=n.length),Yg(WZ(e),"`r` must be a whole number!"),n=zZ(n),e>n.length)return _d(n);if(e<=0)return[[]];if(Yg(e===parseInt(e),"`r` must be a whole number!"),n.length<2)return n;let t=[];return n.forEach((r,a)=>{let i=n.slice(0,a),o=n.slice(a+1),s=i.concat(o);_d(s,e-1).forEach(c=>{t.push([r].concat(c))})}),t}HC.exports=_d});var XC=Y((Cit,jC)=>{var{DataFrame:UZ,Series:HZ}=Ol(),KZ=Ue(),jZ=lt(),XZ=Sl(),YZ=ut(),ZZ=on();function JZ(){Object.keys(arguments).forEach(n=>{let e=arguments[n];if(KZ(e))if(XZ(e))console.log(e);else{let t=ZZ(e);t.length===1?new HZ(e).print():t.length==2?new UZ(e).print():console.log(e)}else jZ(e)||YZ(e)?e.print():console.log(e)})}jC.exports=JZ});var JC=Y((Ait,ZC)=>{var QZ=Ue(),eJ=nt(),YC=yt(),tJ=Bu(),nJ=md(),rJ=Lt(),aJ=rJ(function(n,e,t,r,a){try{return[n,e,t,r,a].every(i=>eJ(i))?t-e===0?NaN:(a-r)*(n-e)/(t-e)+r:NaN}catch{return NaN}});function iJ(n,e,t,r,a){return QZ(n)&&YC(r)&&YC(a)&&(r=e,a=t,e=nJ(n),t=tJ(n)),aJ(n,e,t,r,a)}ZC.exports=iJ});var eA=Y((Dit,QC)=>{var oJ=nt(),sJ=Lt();function uJ(n){try{return oJ(n)?Math.round(n):NaN}catch{return NaN}}QC.exports=sJ(uJ)});var nA=Y((_it,tA)=>{var cJ=nt(),lJ=Lt();function fJ(n){try{return cJ(n)?n<0?-1:n>0?1:0:NaN}catch{return NaN}}tA.exports=lJ(fJ)});var aA=Y((Fit,rA)=>{var hJ=nt(),dJ=Lt();function pJ(n){try{return hJ(n)?Math.sin(n):NaN}catch{return NaN}}rA.exports=dJ(pJ)});var oA=Y((Rit,iA)=>{var vJ=wd();function mJ(n){return vJ(n)}iA.exports=mJ});var uA=Y((Oit,sA)=>{var gJ=nt(),yJ=Lt();function bJ(n){try{return gJ(n)?Math.tan(n):NaN}catch{return NaN}}sA.exports=yJ(bJ)});var Fd=Y((Pit,fA)=>{var cA=qe(),lA=Tr();function wJ(n,e){cA(lA(n),"`fn` must be a function!");let t=new Date;return e?n(...e):n(),new Date-t}async function xJ(n,e){cA(lA(n),"`fn` must be a function!");let t=new Date;return e?await n(...e):await n(),new Date-t}fA.exports={timeSync:wJ,timeAsync:xJ}});var dA=Y((Mit,hA)=>{var kJ=Ue(),SJ=lt(),NJ=ut(),TJ=Qa();function EJ(){return TJ([...arguments].map(n=>kJ(n)?n:SJ(n)||NJ(n)?n.values:[n]))}hA.exports=EJ});var vA=Y((Bit,pA)=>{var IJ=qe(),CJ=Ue(),AJ=lt(),DJ=ut(),_J=yt(),FJ=Bu(),RJ=sa();function OJ(){let n=[],e=Object.values(arguments).map(t=>((AJ(t)||DJ(t))&&(t=t.values),IJ(CJ(t),"The `zip` function only works on arrays, Series, and DataFrames!"),t));return RJ(0,FJ(e.map(t=>t.length))).forEach(t=>{let r=[];e.forEach(a=>{let i=a[t];r.push(_J(i)?void 0:i)}),n.push(r)}),n}pA.exports=OJ});var Et=Y((Lit,Zg)=>{var{copy:PJ,decycle:MJ}=Ni(),{DataFrame:BJ,Series:LJ}=Ol(),zu={abs:pd(),add:vd(),apply:Ml(),arccos:nE(),arcsin:aE(),arctan:oE(),argmax:uE(),argmin:hE(),assert:qe(),cast:Cg(),ceil:gE(),chop:wE(),clamp:kE(),combinations:NE(),copy:PJ,correl:GE(),cos:HE(),count:kl(),covariance:Rg(),DataFrame:BJ,dataTypes:jE(),decycle:MJ,diff:eI(),distance:pI(),divide:mI(),dot:qg(),dropMissing:Wg(),dropMissingPairwise:FI(),dropNaN:ug(),dropNaNPairwise:$I(),dropUndefined:WI(),exp:GI(),factorial:KI(),find:ZI(),findAll:tC(),flatten:pn(),float:rC(),floor:iC(),identity:uC(),indexOf:wl(),inferType:pC(),int:mC(),intersect:yC(),inverse:kC(),isArray:Ue(),isBoolean:ud(),isBrowser:NC(),isDataFrame:lt(),isEqual:Ja(),isFunction:Tr(),isJagged:Sl(),isNested:Jh(),isNumber:nt(),isObject:mo(),isSeries:ut(),isString:Lr(),isUndefined:yt(),lerp:EC(),log:AC(),MathError:Du(),max:Bu(),mean:gd(),median:FC(),min:md(),mod:PC(),mode:zC(),multiply:Bg(),ndarray:go(),normal:VC(),ones:UC(),permutations:KC(),pow:xd(),print:XC(),product:Cl(),random:Ou().random,range:sa(),remap:JC(),reshape:od(),reverse:Nl(),round:eA(),scale:Lu(),seed:Ou().seed,Series:LJ,set:Qa(),shape:on(),shuffle:sd(),sign:nA(),sin:aA(),sort:yo(),sqrt:bd(),std:wd(),stdev:oA(),subtract:Lg(),sum:kd(),tan:uA(),time:Fd().timeSync,timeSync:Fd().timeSync,timeAsync:Fd().timeAsync,transpose:cs(),union:dA(),variance:Og(),vectorize:Lt(),zeros:Ug(),zip:vA(),dump:function(){let n=typeof global<"u"?global:window;if(!n)throw new zu.MathError("Cannot dump functions into global scope because neither `global` nor `window` exist in the current context!");Object.keys(zu).forEach(e=>{try{Object.defineProperty(n,e,{configurable:!1,enumerable:!0,writable:!1,value:zu[e]})}catch{n[e]=zu[e]}})}};typeof Zg<"u"&&(Zg.exports=zu);typeof window<"u"&&(window.JSMathTools=zu)});var mA=Y(()=>{});var gA=Y(()=>{});var Rd=Y(()=>{});var Cs=Y(A=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0});function zJ(n,e){return e.forEach(function(t){Object.keys(t).forEach(function(r){if(r!=="default"&&!(r in n)){var a=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,a.get?a:{enumerable:!0,get:function(){return t[r]}})}})}),n}var a0=function(n,e){return a0=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])},a0(n,e)};function Zi(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");a0(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function je(n,e,t,r){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(r.next(l))}catch(f){o(f)}}function u(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((r=r.apply(n,e||[])).next())})}function Xe(n,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(l){c=[6,l],a=0}finally{r=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function cr(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ke(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=r.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return i}function wt(n,e,t){if(t||arguments.length===2)for(var r=0,a=e.length,i;r<a;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}var $J=1e-7,qJ=1e-4,WJ=function(){function n(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return n.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},n.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},n.prototype.has=function(e){return this.data.has(e)},n.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},n.prototype.numDataIds=function(){return this.dataIdsCount},n}(),BA=function(){function n(){}return n.prototype.refCount=function(e){return $r("refCount")},n.prototype.incRef=function(e){return $r("incRef")},n.prototype.timerAvailable=function(){return!0},n.prototype.time=function(e){return $r("time")},n.prototype.read=function(e){return $r("read")},n.prototype.readSync=function(e){return $r("readSync")},n.prototype.readToGPU=function(e,t){return $r("readToGPU")},n.prototype.numDataIds=function(){return $r("numDataIds")},n.prototype.disposeData=function(e,t){return $r("disposeData")},n.prototype.write=function(e,t,r){return $r("write")},n.prototype.move=function(e,t,r,a,i){return $r("move")},n.prototype.createTensorFromGPUData=function(e,t,r){return $r("createTensorFromGPUData")},n.prototype.memory=function(){return $r("memory")},n.prototype.floatPrecision=function(){return $r("floatPrecision")},n.prototype.epsilon=function(){return this.floatPrecision()===32?$J:qJ},n.prototype.dispose=function(){return $r("dispose")},n}();function $r(n){throw new Error("'".concat(n,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function LA(n){for(var e=n.length,t=0;e>0;)t=Math.random()*e|0,e--,$d(n,e,t)}function VJ(n,e){if(n.length!==e.length)throw new Error("Array sizes must match to be shuffled together "+"First array length was ".concat(n.length)+"Second array length was ".concat(e.length));for(var t=n.length,r=0;t>0;)r=Math.random()*t|0,t--,$d(n,t,r),$d(e,t,r)}function Vl(n,e,t){return Math.max(n,Math.min(e,t))}function GJ(n){return n%2===0?n:n+1}function $d(n,e,t){var r=n[e];n[e]=n[t],n[t]=r}function UJ(n){for(var e=0,t=0;t<n.length;t++)e+=n[t];return e}function HJ(n,e){var t=Math.random();return e*t+(1-t)*n}function KJ(n,e){for(var t=0,r=0;r<n.length;r++){var a=Number(n[r])-Number(e[r]);t+=a*a}return t}function q(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function mr(n,e,t){t===void 0&&(t=""),q(Ro(n,e),function(){return t+" Shapes ".concat(n," and ").concat(e," must match")})}function Ss(n){q(n!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Ut(n){if(n.length===0)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function jJ(n){return n.length===0}function Ro(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Xu(n){return n%1===0}function XJ(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var e=Math.exp(2*n);return(e-1)/(e+1)}function YJ(n){var e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function ZJ(n){for(var e=new Uint32Array(n),t=0;t<n;++t)e[t]=t;return LA(e),e}function $l(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function JJ(n,e,t,r){return e===void 0&&(e=function(a){return 0}),new Promise(function(a,i){var o=0,s=function(){if(n()){a();return}o++;var u=e(o);if(t!=null&&o>=t){i();return}r!=null?r(s,u):setTimeout(s,u)};s()})}function QJ(n,e){for(var t=1,r=-1,a=0;a<n.length;++a)if(n[a]>=0)t*=n[a];else if(n[a]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. "+"Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(n[a]<0)throw Error("Shapes can not be < 0. Found ".concat(n[a]," at dim ").concat(a));if(r===-1){if(e>0&&e!==t)throw Error("Size(".concat(e,") must match the product of shape ").concat(n));return n}if(t===0)throw Error("Cannot infer the missing size in [".concat(n,"] when ")+"there are 0 elements");if(e%t!==0)throw Error("The implicit shape can't be a fractional number. "+"Got ".concat(e," / ").concat(t));var i=n.slice();return i[r]=e/t,i}function rf(n,e){var t=e.length;return n=n==null?e.map(function(r,a){return a}):[].concat(n),q(n.every(function(r){return r>=-t&&r<t}),function(){return"All values in axis param must be in range [-".concat(t,", ").concat(t,") but ")+"got axis ".concat(n)}),q(n.every(function(r){return Xu(r)}),function(){return"All values in axis param must be integers but "+"got axis ".concat(n)}),n.map(function(r){return r<0?t+r:r})}function zA(n,e){for(var t=[],r=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:rf(e,n).sort(),o=0,s=0;s<n.length;++s){if(i!=null){if(i[o]===s&&n[s]!==1)throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(n[s],"' is not 1"));(i[o]==null||i[o]>s)&&n[s]===1&&(t.push(n[s]),r.push(s)),i[o]<=s&&o++}n[s]!==1&&(t.push(n[s]),r.push(s))}return{newShape:t,keptDims:r}}function $A(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else throw new Error("Unknown data type ".concat(n));return t}function qA(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error("Unknown data type ".concat(n));return t}function WA(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(e," being uploaded contains ").concat(r,"."))}}function VA(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function eQ(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function qd(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype ".concat(n))}function GA(n){if(n==null)return 0;var e=0;return n.forEach(function(t){return e+=t.length}),e}function Eo(n){return typeof n=="string"||n instanceof String}function UA(n){return typeof n=="boolean"}function HA(n){return typeof n=="number"}function ep(n){return Array.isArray(n)?ep(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":HA(n)?"float32":Eo(n)?"string":UA(n)?"bool":"float32"}function Ao(n){return!!(n&&n.constructor&&n.call&&n.apply)}function Wd(n,e){for(var t=e;t<n;++t)if(n%t===0)return t;return n}function ec(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function KA(n,e,t,r){r===void 0&&(r=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(r?2:1),o=0;o<i;o++)a[o]=t[n+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(l,f){return l*f})*(r?2:1),o=0;o<i;o++)a[o]=KA(n+o*u,s,t,r);return a}function Vu(n,e,t){if(t===void 0&&(t=!1),n.length===0)return e[0];var r=n.reduce(function(a,i){return a*i})*(t?2:1);if(r===0)return[];if(r!==e.length)throw new Error("[".concat(n,"] does not match the input size ").concat(e.length).concat(t?" for a complex tensor":"","."));return KA(0,n,e,t)}function tQ(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error("Unknown dtype ".concat(e))}function A0(n,e){for(var t=tp(n,e),r=0;r<t.length;r++)t[r]=1;return t}function tp(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error("Unknown data type ".concat(e))}function nQ(n,e){var t=n.reduce(function(r,a){return r*a},1);if(e==null||e==="float32")return Vu(n,new Float32Array(t));if(e==="int32")return Vu(n,new Int32Array(t));if(e==="bool")return Vu(n,new Uint8Array(t));throw new Error("Unknown data type ".concat(e))}function Vr(n){n.forEach(function(e){q(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(n,"].")})})}function rQ(n,e,t){if(e===0)return 0;if(e===1)return n[0];for(var r=n[n.length-1],a=0;a<n.length-1;++a)r+=t[a]*n[a];return r}function aQ(n,e,t){if(e===0)return[];if(e===1)return[n];for(var r=new Array(e),a=0;a<r.length-1;++a)r[a]=Math.floor(n/t[a]),n-=r[a]*t[a];return r[r.length-1]=n,r}function np(n){return n&&n.then&&typeof n.then=="function"}var yA="tfjsflags",jA=function(){function n(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=iQ,this.populateURLFlags()}return n.prototype.setPlatform=function(e,t){this.platform!=null&&(vt().getBool("IS_TEST")||vt().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t},n.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){var a=this.urlFlags[e];vt().getBool("IS_TEST")||vt().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(a,".")),this.set(e,a)}},n.prototype.getAsync=function(e){return je(this,void 0,void 0,function(){var t,r;return Xe(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,r=e,[4,this.evaluateFlag(e)]);case 1:return t[r]=a.sent(),[2,this.flags[e]]}})})},n.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(np(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},n.prototype.getNumber=function(e){return this.get(e)},n.prototype.getBool=function(e){return this.get(e)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!1,configurable:!0}),n.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},n.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()},n.prototype.setFlags=function(e){this.flags=Object.assign({},e)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if(yA in t){var r=t[yA].split(",");r.forEach(function(a){var i=ke(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=sQ(o,s)})}}},n}();function iQ(n){var e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];return oQ(e,r[0],r[1]),r.join("=")}),e}function oQ(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function sQ(n,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if("".concat(+e)===e)return+e;throw new Error("Could not parse value flag value ".concat(e," for flag ").concat(n,"."))}function vt(){return A.ENV}A.ENV=null;function uQ(n){A.ENV=n}var Jg;function XA(){if(Jg==null){var n=void 0;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");Jg=n}return Jg}function cQ(){var n=XA();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function D0(n,e){var t=cQ();if(t.has(n))return t.get(n);var r=e();return t.set(n,r),t.get(n)}var YA="Abs",ZA="Acos",JA="Acosh",_0="Add",QA="AddN",eD="All",tD="Any",nD="ArgMax",rD="ArgMin",aD="Asin",iD="Asinh",oD="Atan",sD="Atanh",uD="Atan2",cD="AvgPool",lQ="AvgPoolGrad",lD="AvgPool3D",fQ="AvgPool3DGrad",fD="BatchMatMul",hD="BatchToSpaceND",dD="Bincount",hQ="BroadcastTo",pD="BroadcastArgs",F0="Cast",vD="Ceil",mD="ClipByValue",gD="Complex",yD="ComplexAbs",bD="Concat",wD="Conv2D",xD="Conv2DBackpropFilter",kD="Conv2DBackpropInput",SD="Conv3D",dQ="Conv3DBackpropFilterV2",ND="Conv3DBackpropInputV2",TD="Cos",ED="Cosh",ID="Cumprod",CD="Cumsum",AD="CropAndResize",DD="DenseBincount",_D="DepthToSpace",FD="DepthwiseConv2dNative",RD="DepthwiseConv2dNativeBackpropFilter",OD="DepthwiseConv2dNativeBackpropInput",PD="Diag",MD="Dilation2D",pQ="Dilation2DBackpropInput",vQ="Dilation2DBackpropFilter",BD="RealDiv",LD="Einsum",zD="Elu",mQ="EluGrad",$D="Erf",qD="Equal",WD="Exp",VD="ExpandDims",GD="Expm1",UD="FFT",HD="Fill",KD="FlipLeftRight",jD="Floor",XD="FloorDiv",YD="FusedBatchNorm",ZD="GatherV2",JD="GatherNd",QD="Greater",e_="GreaterEqual",R0="Identity",t_="IFFT",n_="Imag",r_="IsFinite",a_="IsInf",i_="IsNan",o_="LeakyRelu",s_="Less",u_="LessEqual",c_="LinSpace",l_="Log",f_="Log1p",h_="LogicalAnd",d_="LogicalNot",p_="LogicalOr",gQ="LogicalXor",yQ="LogSoftmax",bQ="LowerBound",v_="LRN",wQ="LRNGrad",m_="Max",g_="Maximum",y_="MaxPool",xQ="MaxPoolGrad",b_="MaxPool3D",kQ="MaxPool3DGrad",w_="MaxPoolWithArgmax",x_="Mean",k_="Min",S_="Minimum",N_="MirrorPad",T_="Mod",E_="Multinomial",I_="Multiply",C_="Neg",A_="NotEqual",D_="NonMaxSuppressionV3",__="NonMaxSuppressionV4",F_="NonMaxSuppressionV5",R_="OnesLike",O_="OneHot",P_="Pack",M_="PadV2",SQ="Pool",B_="Pow",L_="Prelu",z_="Prod",$_="RaggedGather",q_="RaggedRange",W_="RaggedTensorToTensor",V_="Range",G_="Real",U_="Reciprocal",H_="Relu",K_="Reshape",j_="ResizeNearestNeighbor",NQ="ResizeNearestNeighborGrad",X_="ResizeBilinear",TQ="ResizeBilinearGrad",Y_="Relu6",Z_="Reverse",J_="Round",Q_="Rsqrt",e3="ScatterNd",t3="SearchSorted",n3="Select",r3="Selu",a3="Slice",i3="Sin",o3="Sinh",s3="Sign",u3="Sigmoid",c3="Softplus",l3="Sqrt",f3="Sum",h3="SpaceToBatchND",d3="SplitV",p3="Softmax",v3="SparseFillEmptyRows",m3="SparseReshape",g3="SparseSegmentMean",y3="SparseSegmentSum",b3="SparseToDense",w3="SquaredDifference",EQ="Square",x3="StridedSlice",k3="StringNGrams",S3="StringSplit",N3="StringToHashBucketFast",T3="Sub",E3="Tan",I3="Tanh",O0="Tile",C3="TopK",A3="Transform",Md="Transpose",D3="Unique",_3="Unpack",F3="UnsortedSegmentSum",IQ="UpperBound",R3="ZerosLike",O3="Step",i0="FromPixels",P3="RotateWithOffset",o0="_FusedMatMul",s0="FusedConv2D",u0="FusedDepthwiseConv2D";function To(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];vt().getBool("IS_TEST")||vt().getBool("PROD")||console.warn.apply(console,wt([],ke(n),!1))}function CQ(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];vt().getBool("IS_TEST")||vt().getBool("PROD")||console.log.apply(console,wt([],ke(n),!1))}var Yu=D0("kernelRegistry",function(){return new Map}),Gl=D0("gradRegistry",function(){return new Map});function Vd(n,e){var t=P0(n,e);return Yu.get(t)}function c0(n){return Gl.get(n)}function Gd(n){for(var e=Yu.entries(),t=[];;){var r=e.next(),a=r.done,i=r.value;if(a)break;var o=ke(i,2),s=o[0],u=o[1],c=ke(s.split("_"),1),l=c[0];l===n&&t.push(u)}return t}function M3(n){var e=n.kernelName,t=n.backendName,r=P0(e,t);Yu.has(r)&&To("The kernel '".concat(e,"' for backend ")+"'".concat(t,"' is already registered")),Yu.set(r,n)}function AQ(n){var e=n.kernelName;Gl.has(e)&&vt().getBool("DEBUG")&&To("Overriding the gradient for '".concat(e,"'")),Gl.set(e,n)}function DQ(n,e){var t=P0(n,e);if(!Yu.has(t))throw new Error("The kernel '".concat(n,"' for backend ")+"'".concat(e,"' is not registered"));Yu.delete(t)}function _Q(n){if(!Gl.has(n))throw new Error("The gradient '".concat(n,"' for backend is not registered"));Gl.delete(n)}function FQ(n,e){var t=Gd(n);t.forEach(function(r){var a=Object.assign({},r,{backendName:e});M3(a)})}function P0(n,e){return"".concat(e,"_").concat(n)}var l0=Ht,Ta=null;try{Ta=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Ht(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}Ht.prototype.__isLong__;Object.defineProperty(Ht.prototype,"__isLong__",{value:!0});function Gr(n){return(n&&n.__isLong__)===!0}Ht.isLong=Gr;var bA={},wA={};function Ns(n,e){var t,r,a;return e?(n>>>=0,(a=0<=n&&n<256)&&(r=wA[n],r)?r:(t=Kt(n,(n|0)<0?-1:0,!0),a&&(wA[n]=t),t)):(n|=0,(a=-128<=n&&n<128)&&(r=bA[n],r)?r:(t=Kt(n,n<0?-1:0,!1),a&&(bA[n]=t),t))}Ht.fromInt=Ns;function Ea(n,e){if(isNaN(n))return e?ps:Ia;if(e){if(n<0)return ps;if(n>=B3)return $3}else{if(n<=-kA)return qr;if(n+1>=kA)return z3}return n<0?Ea(-n,e).neg():Kt(n%Zu|0,n/Zu|0,e)}Ht.fromNumber=Ea;function Kt(n,e,t){return new Ht(n,e,t)}Ht.fromBits=Kt;var Ud=Math.pow;function M0(n,e,t){if(n.length===0)throw Error("empty string");if(n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return Ia;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var r;if((r=n.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return M0(n.substring(1),e,t).neg();for(var a=Ea(Ud(t,8)),i=Ia,o=0;o<n.length;o+=8){var s=Math.min(8,n.length-o),u=parseInt(n.substring(o,o+s),t);if(s<8){var c=Ea(Ud(t,s));i=i.mul(c).add(Ea(u))}else i=i.mul(a),i=i.add(Ea(u))}return i.unsigned=e,i}Ht.fromString=M0;function ri(n,e){return typeof n=="number"?Ea(n,e):typeof n=="string"?M0(n,e):Kt(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}Ht.fromValue=ri;var xA=1<<16,RQ=1<<24,Zu=xA*xA,B3=Zu*Zu,kA=B3/2,SA=Ns(RQ),Ia=Ns(0);Ht.ZERO=Ia;var ps=Ns(0,!0);Ht.UZERO=ps;var Wu=Ns(1);Ht.ONE=Wu;var L3=Ns(1,!0);Ht.UONE=L3;var f0=Ns(-1);Ht.NEG_ONE=f0;var z3=Kt(-1,2147483647,!1);Ht.MAX_VALUE=z3;var $3=Kt(-1,-1,!0);Ht.MAX_UNSIGNED_VALUE=$3;var qr=Kt(0,-2147483648,!1);Ht.MIN_VALUE=qr;var De=Ht.prototype;De.toInt=function(){return this.unsigned?this.low>>>0:this.low};De.toNumber=function(){return this.unsigned?(this.high>>>0)*Zu+(this.low>>>0):this.high*Zu+(this.low>>>0)};De.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(qr)){var t=Ea(e),r=this.div(t),a=r.mul(t).sub(this);return r.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Ea(Ud(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};De.getHighBits=function(){return this.high};De.getHighBitsUnsigned=function(){return this.high>>>0};De.getLowBits=function(){return this.low};De.getLowBitsUnsigned=function(){return this.low>>>0};De.getNumBitsAbs=function(){if(this.isNegative())return this.eq(qr)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};De.isZero=function(){return this.high===0&&this.low===0};De.eqz=De.isZero;De.isNegative=function(){return!this.unsigned&&this.high<0};De.isPositive=function(){return this.unsigned||this.high>=0};De.isOdd=function(){return(this.low&1)===1};De.isEven=function(){return(this.low&1)===0};De.equals=function(e){return Gr(e)||(e=ri(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};De.eq=De.equals;De.notEquals=function(e){return!this.eq(e)};De.neq=De.notEquals;De.ne=De.notEquals;De.lessThan=function(e){return this.comp(e)<0};De.lt=De.lessThan;De.lessThanOrEqual=function(e){return this.comp(e)<=0};De.lte=De.lessThanOrEqual;De.le=De.lessThanOrEqual;De.greaterThan=function(e){return this.comp(e)>0};De.gt=De.greaterThan;De.greaterThanOrEqual=function(e){return this.comp(e)>=0};De.gte=De.greaterThanOrEqual;De.ge=De.greaterThanOrEqual;De.compare=function(e){if(Gr(e)||(e=ri(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};De.comp=De.compare;De.negate=function(){return!this.unsigned&&this.eq(qr)?qr:this.not().add(Wu)};De.neg=De.negate;De.add=function(e){Gr(e)||(e=ri(e));var t=this.high>>>16,r=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,d=0;return d+=i+c,h+=d>>>16,d&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=r+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,Kt(h<<16|d,l<<16|f,this.unsigned)};De.subtract=function(e){return Gr(e)||(e=ri(e)),this.add(e.neg())};De.sub=De.subtract;De.multiply=function(e){if(this.isZero())return Ia;if(Gr(e)||(e=ri(e)),Ta){var t=Ta.mul(this.low,this.high,e.low,e.high);return Kt(t,Ta.get_high(),this.unsigned)}if(e.isZero())return Ia;if(this.eq(qr))return e.isOdd()?qr:Ia;if(e.eq(qr))return this.isOdd()?qr:Ia;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(SA)&&e.lt(SA))return Ea(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,d=0,p=0;return p+=o*l,d+=p>>>16,p&=65535,d+=i*l,h+=d>>>16,d&=65535,d+=o*c,h+=d>>>16,d&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=r*l+a*c+i*u+o*s,f&=65535,Kt(d<<16|p,f<<16|h,this.unsigned)};De.mul=De.multiply;De.divide=function(e){if(Gr(e)||(e=ri(e)),e.isZero())throw Error("division by zero");if(Ta){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Ta.div_u:Ta.div_s)(this.low,this.high,e.low,e.high);return Kt(t,Ta.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?ps:Ia;var r,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return ps;if(e.gt(this.shru(1)))return L3;i=ps}else{if(this.eq(qr)){if(e.eq(Wu)||e.eq(f0))return qr;if(e.eq(qr))return Wu;var o=this.shr(1);return r=o.div(e).shl(1),r.eq(Ia)?e.isNegative()?Wu:f0:(a=this.sub(e.mul(r)),i=r.add(a.div(e)),i)}else if(e.eq(qr))return this.unsigned?ps:Ia;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Ia}for(a=this;a.gte(e);){r=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(r)/Math.LN2),u=s<=48?1:Ud(2,s-48),c=Ea(r),l=c.mul(e);l.isNegative()||l.gt(a);)r-=u,c=Ea(r,this.unsigned),l=c.mul(e);c.isZero()&&(c=Wu),i=i.add(c),a=a.sub(l)}return i};De.div=De.divide;De.modulo=function(e){if(Gr(e)||(e=ri(e)),Ta){var t=(this.unsigned?Ta.rem_u:Ta.rem_s)(this.low,this.high,e.low,e.high);return Kt(t,Ta.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};De.mod=De.modulo;De.rem=De.modulo;De.not=function(){return Kt(~this.low,~this.high,this.unsigned)};De.and=function(e){return Gr(e)||(e=ri(e)),Kt(this.low&e.low,this.high&e.high,this.unsigned)};De.or=function(e){return Gr(e)||(e=ri(e)),Kt(this.low|e.low,this.high|e.high,this.unsigned)};De.xor=function(e){return Gr(e)||(e=ri(e)),Kt(this.low^e.low,this.high^e.high,this.unsigned)};De.shiftLeft=function(e){return Gr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Kt(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Kt(0,this.low<<e-32,this.unsigned)};De.shl=De.shiftLeft;De.shiftRight=function(e){return Gr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Kt(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Kt(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};De.shr=De.shiftRight;De.shiftRightUnsigned=function(e){if(Gr(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var r=this.low;return Kt(r>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?Kt(t,0,this.unsigned):Kt(t>>>e-32,0,this.unsigned)};De.shru=De.shiftRightUnsigned;De.shr_u=De.shiftRightUnsigned;De.toSigned=function(){return this.unsigned?Kt(this.low,this.high,!1):this};De.toUnsigned=function(){return this.unsigned?this:Kt(this.low,this.high,!0)};De.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};De.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};De.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};Ht.fromBytes=function(e,t,r){return r?Ht.fromBytesLE(e,t):Ht.fromBytesBE(e,t)};Ht.fromBytesLE=function(e,t){return new Ht(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};Ht.fromBytesBE=function(e,t){return new Ht(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var OQ=zJ({__proto__:null,default:l0},[l0]),ds=l0||OQ;function af(n){return ds.fromString(n,!0,16)}var q3=af("c3a5c85c97cb3127"),fs=af("b492b66fbe98f273"),vr=af("9ae16a3b2f90404f");function h0(n){return n.xor(n.shru(47))}function W3(n,e,t){var r=n.slice(e,e+t);return ds.fromBytes(Array.from(r),!0,!0)}function $t(n,e){return W3(n,e,8)}function NA(n,e){return W3(n,e,4)}function Hn(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function Co(n,e,t){t===void 0&&(t=af("9ddfea08eb382d69"));var r=n.xor(e).mul(t);r=r.xor(r.shru(47));var a=e.xor(r).mul(t);return a=a.xor(a.shru(47)),a=a.mul(t),a}function PQ(n,e,t,r,a,i){a=a.add(n),i=Hn(i.add(a).add(r),21);var o=a;return a=a.add(e),a=a.add(t),i=i.add(Hn(a,44)),[a.add(r),i.add(o)]}function Od(n,e,t,r){return PQ($t(n,e),$t(n,e+8),$t(n,e+16),$t(n,e+24),t,r)}function MQ(n,e){if(e===void 0&&(e=n.length),e>=8){var t=vr.add(e*2),r=$t(n,0).add(vr),a=$t(n,e-8),i=Hn(a,37).mul(t).add(r),o=Hn(r,25).add(a).mul(t);return Co(i,o,t)}if(e>=4){var t=vr.add(e*2),r=NA(n,0);return Co(r.shl(3).add(e),NA(n,e-4),t)}if(e>0){var r=n[0],a=n[e>>1],i=n[e-1],s=r+(a<<8),u=e+(i<<2);return h0(vr.mul(s).xor(q3.mul(u))).mul(vr)}return vr}function BQ(n,e){e===void 0&&(e=n.length);var t=vr.add(e*2),r=$t(n,0).mul(fs),a=$t(n,8),i=$t(n,e-8).mul(t),o=$t(n,e-16).mul(vr);return Co(Hn(r.add(a),43).add(Hn(i,30)).add(o),r.add(Hn(a.add(vr),18)).add(i),t)}function LQ(n,e){e===void 0&&(e=n.length);var t=vr.add(e*2),r=$t(n,0).mul(vr),a=$t(n,8),i=$t(n,e-8).mul(t),o=$t(n,e-16).mul(vr),s=Hn(r.add(a),43).add(Hn(i,30)).add(o),u=Co(s,r.add(Hn(a.add(vr),18)).add(i),t),c=$t(n,16).mul(t),l=$t(n,24),f=s.add($t(n,e-32)).mul(t),h=u.add($t(n,e-24)).mul(t);return Co(Hn(c.add(l),43).add(Hn(f,30)).add(h),c.add(Hn(l.add(r),18)).add(f),t)}function zQ(n,e){var t,r;e===void 0&&(e=n.length);var a=ds.fromNumber(81,!0);if(e<=32)return e<=16?MQ(n,e):BQ(n,e);if(e<=64)return LQ(n,e);var i=a,o=a.mul(fs).add(113),s=h0(o.mul(vr).add(113)).mul(vr),u=[ds.UZERO,ds.UZERO],c=[ds.UZERO,ds.UZERO];i=i.mul(vr).add($t(n,0));var l=0,f=(e-1>>6)*64,h=f+(e-1&63)-63;do i=Hn(i.add(o).add(u[0]).add($t(n,l+8)),37).mul(fs),o=Hn(o.add(u[1]).add($t(n,l+48)),42).mul(fs),i=i.xor(c[1]),o=o.add(u[0]).add($t(n,l+40)),s=Hn(s.add(c[0]),33).mul(fs),u=Od(n,l,u[1].mul(fs),i.add(c[0])),c=Od(n,l+32,s.add(c[1]),o.add($t(n,l+16))),t=ke([i,s],2),s=t[0],i=t[1],l+=64;while(l!==f);var d=fs.add(s.and(255).shl(1));return l=h,c[0]=c[0].add(e-1&63),u[0]=u[0].add(c[0]),c[0]=c[0].add(u[0]),i=Hn(i.add(o).add(u[0]).add($t(n,l+8)),37).mul(d),o=Hn(o.add(u[1]).add($t(n,l+48)),42).mul(d),i=i.xor(c[1].mul(9)),o=o.add(u[0].mul(9).add($t(n,l+40))),s=Hn(s.add(c[0]),33).mul(d),u=Od(n,l,u[1].mul(d),i.add(c[0])),c=Od(n,l+32,s.add(c[1]),o.add($t(n,l+16))),r=ke([i,s],2),s=r[0],i=r[1],Co(Co(u[0],c[0],d).add(h0(o).mul(q3)).add(s),Co(u[1],c[1],d).add(i),d)}function $Q(n,e){return e==="string"?of(n):rp([n],e)}function qQ(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function rp(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Do(n)),vt().getBool("DEBUG")&&WA(n,e),qQ(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){for(var t=new Uint8Array(n.length),r=0;r<t.length;++r)Math.round(n[r])!==0&&(t[r]=1);return t}else throw new Error("Unknown data type ".concat(e))}function Ul(){return vt().platform.now()}function WQ(n,e){return vt().platform.fetch(n,e)}function of(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",vt().platform.encode(n,e)}function Hd(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",vt().platform.decode(n,e)}function er(n){return vt().platform.isTypedArray(n)}function Do(n,e,t){var r,a;if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||np(n)||n==null||er(n)&&t)e.push(n);else if(Array.isArray(n)||er(n))for(var i=0;i<n.length;++i)Do(n[i],e,t);else{var o=-1;try{for(var s=cr(Object.keys(n)),u=s.next();!u.done;u=s.next()){var c=u.value;/^([1-9]+[0-9]*|0)$/.test(c)&&(o=Math.max(o,Number(c)))}}catch(l){r={error:l}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}for(var i=0;i<=o;i++)Do(n[i],e,t)}return e}var VQ={__proto__:null,createScalarValue:$Q,toTypedArray:rp,now:Ul,fetch:WQ,encodeString:of,decodeString:Hd,isTypedArray:er,flatten:Do,shuffle:LA,shuffleCombo:VJ,clamp:Vl,nearestLargerEven:GJ,swap:$d,sum:UJ,randUniform:HJ,distSquared:KJ,assert:q,assertShapesMatch:mr,assertNonNull:Ss,sizeFromShape:Ut,isScalarShape:jJ,arraysEqual:Ro,isInt:Xu,tanh:XJ,sizeToSquarishShape:YJ,createShuffledIndices:ZJ,rightPad:$l,repeatedTry:JJ,inferFromImplicitShape:QJ,parseAxisParam:rf,squeezeShape:zA,getTypedArrayFromDType:$A,getArrayFromDType:qA,checkConversionForErrors:WA,isValidDtype:VA,hasEncodingLoss:eQ,bytesPerElement:qd,bytesFromStringArray:GA,isString:Eo,isBoolean:UA,isNumber:HA,inferDtype:ep,isFunction:Ao,nearestDivisor:Wd,computeStrides:ec,toNestedArray:Vu,convertBackendValuesAndArrayBuffer:tQ,makeOnesTypedArray:A0,makeZerosTypedArray:tp,makeZerosNestedTypedArray:nQ,assertNonNegativeIntegerDimensions:Vr,locToIndex:rQ,indexToLoc:aQ,isPromise:np,hexToLong:af,fingerPrint64:zQ},GQ=function(){function n(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new HQ)}return n.prototype.profileKernel=function(e,t,r){var a,i,o,s=function(){o=r()},u,c=Ul();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var l=cr(o),f=l.next();!f.done;f=l.next()){var h=f.value;h.dataSync()}}catch(m){a={error:m}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:Ul()-c})}if(vt().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var d=function(m){var g=o[m];g.data().then(function(y){UQ(y,g.dtype,e)})},p=0;p<o.length;p++)d(p);var v={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(m){return m.kernelMs}),extraInfo:u.then(function(m){return m.getExtraProfileInfo!=null?m.getExtraProfileInfo():""})};return v},n.prototype.logKernelProfile=function(e){var t=this,r=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(c){t.logger.logKernelProfile(r,u,c[0],c[1],o,c[2])})})},n}();function UQ(n,e,t){if(e!=="float32")return!1;for(var r=0;r<n.length;r++){var a=n[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(t,"'")),!0}return!1}var HQ=function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,a,i,o){var s=typeof a=="number"?$l("".concat(a,"ms"),9):a.error,u=$l(e,25),c=t.rank,l=t.size,f=$l(t.shape.toString(),14),h="";for(var d in i){var p=i[d];if(p!=null){var v=p.shape||t.shape,m=v.length;h+="".concat(d,": ").concat(m,"D ").concat(m>0?v:""," ")}}console.log("%c".concat(u,"	%c").concat(s,"	%c").concat(c,"D ").concat(f,"	%c").concat(l,"	%c").concat(h,"	%c").concat(o),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n}();function KQ(n,e,t){for(var r={},a={},i=0;i<e.length;i++)r[e[i].id]=!0;for(var i=0;i<n.length;i++){var o=n[i],s=o.inputs;for(var u in s){for(var c=s[u],l=!1,f=0;f<e.length;f++)if(r[c.id]){o.outputs.forEach(function(b){return r[b.id]=!0}),l=!0,a[o.id]=!0;break}if(l)break}}var h={};h[t.id]=!0;for(var d={},i=n.length-1;i>=0;i--)for(var o=n[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,d[o.id]=!0;break}for(var p=[],i=0;i<n.length;i++){var o=n[i];if(a[o.id]&&d[o.id]){var v={};for(var u in o.inputs){var m=o.inputs[u];r[m.id]&&(v[u]=m)}var g=Object.assign({},o);g.inputs=v,g.outputs=o.outputs,p.push(g)}}return p}function jQ(n,e,t,r){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var d=n[h.id];d!=null?u.push(d):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(s.kernelName,"."));var c=s.gradient(u),l=function(h){if(!(h in c))throw new Error("Cannot backprop through input ".concat(h,". ")+"Available gradients found: ".concat(Object.keys(c),"."));var d=t(function(){return c[h]()});if(d.dtype!=="float32")throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"".concat(h," must have 'float32' dtype, but has '").concat(d.dtype,"'"));var p=s.inputs[h];if(!Ro(d.shape,p.shape))throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"'".concat(h,"' has shape '").concat(d.shape,"', which does not match ")+"the shape of the input '".concat(p.shape,"'"));if(n[p.id]==null)n[p.id]=d;else{var v=n[p.id];n[p.id]=r(v,d),v.dispose()}};for(var f in s.inputs)l(f)},i=e.length-1;i>=0;i--)a(i)}var TA=20,Bl=3,Qg=7;function XQ(n,e,t,r){var a=ec(e),i=YQ(n,e,t,a),o=e.length,s=Bd(n,e,t,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(t)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(e,"]")),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function YQ(n,e,t,r){var a=Ut(e),i=r[r.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?zl(n):n;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,f=0;f<i;f++)o[f]=Math.max(o[f],Ll(u[l+f],0,t).length);return o}function Ll(n,e,t){var r;return Array.isArray(n)?r="".concat(parseFloat(n[0].toFixed(Qg))," + ")+"".concat(parseFloat(n[1].toFixed(Qg)),"j"):Eo(n)?r="'".concat(n,"'"):t==="bool"?r=V3(n):r=parseFloat(n.toFixed(Qg)).toString(),$l(r,e)}function V3(n){return n===0?"false":"true"}function Bd(n,e,t,r,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var c=zl(n);return[Ll(c[0],0,t)]}return t==="bool"?[V3(n[0])]:[n[0].toString()]}if(u===1){if(s>TA){var l=Bl*o,f=Array.from(n.slice(0,l)),h=Array.from(n.slice((s-Bl)*o,s*o));return t==="complex64"&&(f=zl(f),h=zl(h)),["["+f.map(function(T,E){return Ll(T,a[E],t)}).join(", ")+", ..., "+h.map(function(T,E){return Ll(T,a[s-Bl+E],t)}).join(", ")+"]"]}var d=t==="complex64"?zl(n):Array.from(n);return["["+d.map(function(T,E){return Ll(T,a[E],t)}).join(", ")+"]"]}var p=e.slice(1),v=r.slice(1),m=r[0]*o,g=[];if(s>TA){for(var y=0;y<Bl;y++){var b=y*m,w=b+m;g.push.apply(g,wt([],ke(Bd(n.slice(b,w),p,t,v,a,!1)),!1))}g.push("...");for(var y=s-Bl;y<s;y++){var b=y*m,w=b+m;g.push.apply(g,wt([],ke(Bd(n.slice(b,w),p,t,v,a,y===s-1)),!1))}}else for(var y=0;y<s;y++){var b=y*m,w=b+m;g.push.apply(g,wt([],ke(Bd(n.slice(b,w),p,t,v,a,y===s-1)),!1))}var x=u===2?",":"";g[0]="["+(s>0?g[0]+x:"");for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+x;for(var N=`,
`,y=2;y<u;y++)N+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":N),g}function zl(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var Kd=function(){function n(e,t,r){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=Ut(e),r!=null){var i=r.length;q(i===this.size,function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||qA(t,this.size),this.strides=ec(e)}return n.prototype.set=function(e){for(var t=this,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];r.length===0&&(r=[0]),q(r.length===this.rank,function(){return"The number of provided coordinates (".concat(r.length,") must ")+"match the rank (".concat(t.rank,")")});var i=this.locToIndex(r);this.values[i]=e},n.prototype.get=function(){for(var e,t,r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];r.length===0&&(r=[0]);var i=0;try{for(var o=cr(r),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var c="Requested out of range element at ".concat(r,". ")+"  Buffer shape=".concat(this.shape);throw new Error(c)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var l=r[r.length-1],f=0;f<r.length-1;++f)l+=this.strides[f]*r[f];return this.values[l]},n.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),n.prototype.toTensor=function(){return ei().makeTensor(this.values,this.shape,this.dtype)},n}(),ei=null,$u=null;function ZQ(n){ei=n}function JQ(n){$u=n}var Pn=function(){function n(e,t,r,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Ut(e),this.strides=ec(e),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),n.prototype.buffer=function(){return je(this,void 0,void 0,function(){var e;return Xe(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,$u.buffer(this.shape,this.dtype,e)]}})})},n.prototype.bufferSync=function(){return $u.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return je(this,void 0,void 0,function(){var e;return Xe(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Vu(this.shape,e,this.dtype==="complex64")]}})})},n.prototype.arraySync=function(){return Vu(this.shape,this.dataSync(),this.dtype==="complex64")},n.prototype.data=function(){return je(this,void 0,void 0,function(){var e,t;return Xe(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=ei().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=r.sent();try{return[2,t.map(function(a){return Hd(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}})})},n.prototype.dataToGPU=function(e){return this.throwIfDisposed(),ei().readToGPU(this.dataId,e)},n.prototype.dataSync=function(){this.throwIfDisposed();var e=ei().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return Hd(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},n.prototype.bytes=function(){return je(this,void 0,void 0,function(){var e;return Xe(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,ei().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},n.prototype.dispose=function(){this.isDisposed||(ei().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!1,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.print=function(e){return e===void 0&&(e=!1),$u.print(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),$u.clone(this)},n.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return XQ(t,this.shape,this.dtype,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),$u.cast(this,e)},n.prototype.variable=function(e,t,r){return e===void 0&&(e=!0),this.throwIfDisposed(),ei().makeVariable(this,e,t,r)},n}();Object.defineProperty(Pn,Symbol.hasInstance,{value:function(n){return!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null}});function QQ(){return D0("Tensor",function(){return Pn})}QQ();var Hl=function(n){Zi(e,n);function e(t,r,a,i){var o=n.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=r,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(t.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!Ro(t.shape,this.shape))throw new Error("shape of the new value (".concat(t.shape,") and ")+"previous value (".concat(this.shape,") must match"));ei().disposeTensor(this),this.dataId=t.dataId,ei().incRef(this,null)},e.prototype.dispose=function(){ei().disposeVariable(this),this.isDisposedInternal=!0},e}(Pn);Object.defineProperty(Hl,Symbol.hasInstance,{value:function(n){return n instanceof Pn&&n.assign!=null&&n.assign instanceof Function}});A.Rank=void 0;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(A.Rank||(A.Rank={}));var d0;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(d0||(d0={}));var p0;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(p0||(p0={}));var v0;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(v0||(v0={}));var m0;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(m0||(m0={}));var eee={float32:v0,int32:d0,bool:p0,complex64:m0};function ap(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error("Can not upcast ".concat(n," with ").concat(e))}return eee[n][e]}function tee(n){return ap(n,"int32")}function vn(n,e){if(n.dtype===e.dtype)return[n,e];var t=ap(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function G3(n,e){q(n.dtype===e.dtype,function(){return"The dtypes of the first(".concat(n.dtype,") and")+" second(".concat(e.dtype,") input must match")})}function nee(n,e){return e.some(function(t){return t.id===n.id})}function B0(n){var e=[],t=new Set;return U3(n,e,t),e}function U3(n,e,t){if(n!=null){if(n instanceof Pn){e.push(n);return}if(!!ree(n)){var r=n;for(var a in r){var i=r[a];t.has(i)||(t.add(i),U3(i,e,t))}}}}function ree(n){return Array.isArray(n)||typeof n=="object"}var aee={__proto__:null,makeTypesMatch:vn,assertTypesMatch:G3,isTensorInList:nee,getTensorsInContainer:B0};function e0(n){return n.kernelName!=null}var EA=function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return n.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},n}(),L0=function(){function n(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new EA}return n.prototype.ready=function(){return je(this,void 0,void 0,function(){var e,t,r,a;return Xe(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(r=e[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(n.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,r=e.asyncInit;if(r)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!1,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},n.prototype.registerBackend=function(e,t,r){return r===void 0&&(r=1),e in this.registryFactory?(To("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},n.prototype.setBackend=function(e){return je(this,void 0,void 0,function(){var t,r,a,i,o;return Xe(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '".concat(e,"' not found in registry"));return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,a=t.asyncInit,a?[4,r]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=r,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new GQ(this.backendInstance),[2,!0]}})})},n.prototype.setupRegisteredKernels=function(){var e=this,t=Gd(this.backendName);t.forEach(function(r){r.setupFunc!=null&&r.setupFunc(e.backendInstance)})},n.prototype.disposeRegisteredKernels=function(e){var t=this,r=Gd(e);r.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},n.prototype.initializeBackend=function(e){var t=this,r=this.registryFactory[e];if(r==null)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var a=r.factory();if(a&&!(a instanceof BA)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,To("Initialization of backend ".concat(e," failed")),To(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return To("Initialization of backend ".concat(e," failed")),To(s.stack||s.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority})},n.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],a=this.initializeBackend(r),i=a.success,o=a.asyncInit;if(o||i)return{name:r,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(e,t){var r=this.state.tensorInfo.get(t),a=r.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),r.backend=e,e.move(t,i,r.shape,r.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(e,t){var r=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return r.startScope(a)},function(){return r.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},n.prototype.scopedRun=function(e,t,r){e();try{var a=r();return t(),a}catch(i){throw t(),i}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=U.runKernel(R0,{x:e}),r={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},c={dtype:s};return U.runKernel(F0,u,c)}}},i=[];return this.addTapeNode(this.state.activeScope.name,r,[t],a,i,{}),t},n.prototype.runKernel=function(e,t,r){this.backendName==null&&this.backend;var a=Vd(e,this.backendName)!=null;if(!a)throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:r})},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(e,t,r){var a=this.backend.numDataIds(),i=0;r.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(s," data ids) after running '").concat(e,"'"))},n.prototype.runKernelFunc=function(e){var t=this,r,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var c,l=e0(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(e0(e)){var f=e.kernelName,h=e.inputs,d=e.attrs;this.backendName==null&&this.backend;var p=Vd(f,this.backendName);q(p!=null,function(){return"Cannot find registered kernel '".concat(f,"' for backend '").concat(t.backendName,"'")}),u=function(){var x=t.backend.numDataIds();c=p.kernelFunc({inputs:h,attrs:d,backend:t.backend});var N=Array.isArray(c)?c:[c];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,x,N);var T=N.map(function(C){return C.rank!=null?C:t.makeTensorFromTensorInfo(C)});if(i){var E=t.getTensorsForGradient(f,h,T);a=t.saveTensorsForBackwardMode(E)}return T}}else{var v=e.forwardFunc,m=function(x){!i||(a=x.map(function(N){return t.keep(t.clone(N))}))};u=function(){var x=t.backend.numDataIds();c=t.tidy(function(){return v(t.backend,m)});var N=Array.isArray(c)?c:[c];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(l,x,N),N}}var g=e.inputs,y=e.attrs,b=e0(e)?null:e.backwardsFunc,w;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?r=u():(w=t.profiler.profileKernel(l,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(w),r=w.outputs)}),i&&this.addTapeNode(l,g,r,b,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(x){return g[x]!=null?g[x].shape:null}),outputShapes:r.map(function(x){return x.shape}),kernelTimeMs:w.timeMs,extraInfo:w.extraInfo}),Array.isArray(c)?r:r[0]},n.prototype.saveTensorsForBackwardMode=function(e){var t=this,r=e.map(function(a){return t.keep(t.clone(a))});return r},n.prototype.getTensorsForGradient=function(e,t,r){var a=c0(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(q(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(c){return t[c]})):s=i.map(function(c){return t[c]});var u=r.filter(function(c,l){return o[l]});return s.concat(u)}return[]},n.prototype.makeTensor=function(e,t,r,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",a=a||this.backend;var i=e;r==="string"&&Eo(e[0])&&(i=e.map(function(l){return of(l)}));var o=a.write(i,t,r),s=new Pn(t,r,o,this.nextTensorId());if(this.trackTensor(s,a),r==="string"){var u=this.state.tensorInfo.get(o),c=GA(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},n.prototype.makeTensorFromDataId=function(e,t,r,a){r=r||"float32";var i={dataId:e,shape:t,dtype:r};return this.makeTensorFromTensorInfo(i,a)},n.prototype.makeTensorFromTensorInfo=function(e,t){var r=e.dataId,a=e.shape,i=e.dtype,o=new Pn(a,i,r,this.nextTensorId());return this.trackTensor(o,t),o},n.prototype.makeVariable=function(e,t,r,a){t===void 0&&(t=!0),r=r||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new Hl(e,t,r,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name ".concat(i.name," was already registered"));return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},n.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var r=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(r=e.size*qd(e.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r})),e instanceof Hl||this.track(e)},n.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},n.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},n.prototype.disposeTensor=function(e){if(!!this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var r=e.size*qd(e.dtype);this.state.numBytes-=r}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},n.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},n.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return je(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f,h;return Xe(this,function(d){switch(d.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=d.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,wt([],ke(this.state.activeProfile.kernels.map(function(p){return p.totalBytesSnapshot})),!1)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,d.label=2;case 2:d.trys.push([2,8,9,10]),i=cr(this.state.activeProfile.kernels),o=i.next(),d.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=d.sent(),c=s,[4,s.extraInfo];case 5:c.extraInfo=d.sent(),d.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return l=d.sent(),f={error:l},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},n.prototype.addTapeNode=function(e,t,r,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:i},c=c0(e);c!=null&&(a=c.gradFunc),a!=null&&(u.gradient=function(l){return l=l.map(function(f,h){if(f==null){var d=r[h],p=tp(d.size,d.dtype);return s.makeTensor(p,d.shape,d.dtype)}return f}),a(l.length>1?l:l[0],i,o)}),this.state.activeTape.push(u)},n.prototype.keep=function(e){return e.kept=!0,e},n.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=B0(e),a=new Set(r.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},n.prototype.gradients=function(e,t,r,a){var i=this;if(a===void 0&&(a=!1),q(t.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '".concat(r.dtype,"'"));var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});q(o instanceof Pn,function(){return"The result y returned by f() must be a tensor."});var s=KQ(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=r??iee(o.shape),jQ(u,s,function(l){return i.tidy(l)},oee);var c=t.map(function(l){return u[l.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(l){var f,h;try{for(var d=cr(l.saved),p=d.next();!p.done;p=d.next()){var v=p.value;v.dispose()}}catch(m){f={error:m}}finally{try{p&&!p.done&&(h=d.return)&&h.call(d)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:c}})},n.prototype.customGrad=function(e){var t=this;return q(Ao(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];q(r.every(function(c){return c instanceof Pn}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};r.forEach(function(c,l){o[l]=c});var s=function(c,l){return i=e.apply(void 0,wt([],ke(wt(wt([],ke(r),!1),[l],!1)),!1)),q(i.value instanceof Pn,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),q(Ao(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(c,l){var f=i.gradFunc(c,l),h=Array.isArray(f)?f:[f];q(h.length===r.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),q(h.every(function(p){return p instanceof Pn}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var d={};return h.forEach(function(p,v){d[v]=function(){return p}}),d};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},n.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},n.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},n.prototype.readToGPU=function(e,t){var r=this.state.tensorInfo.get(e);return r.backend.readToGPU(e,t)},n.prototype.time=function(e){return je(this,void 0,void 0,function(){var t,r;return Xe(this,function(a){switch(a.label){case 0:return t=Ul(),[4,this.backend.time(e)];case 1:return r=a.sent(),r.wallMs=Ul()-t,[2,r]}})})},n.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!1,configurable:!0}),n.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new EA;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n}();L0.nextTensorId=0;L0.nextVariableId=0;function iee(n){var e=A0(Ut(n),"float32");return U.makeTensor(e,n,"float32")}function H3(){var n=XA();if(n._tfengine==null){var e=new jA(n);n._tfengine=new L0(e)}return uQ(n._tfengine.ENV),ZQ(function(){return n._tfengine}),n._tfengine}var U=H3();function oee(n,e){var t={a:n,b:e};return U.runKernel(_0,t)}function see(){return typeof navigator<"u"&&navigator!=null}var g0;function uee(n){g0=n}function cee(n){if(g0!==void 0)return g0;if(n||see()){if(n||(n=navigator),n.product==="ReactNative")return!0;var e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){var t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function K3(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var lee={__proto__:null,mockIsMobile:uee,isMobile:cee,isBrowser:K3};var la=vt();la.registerFlag("DEBUG",function(){return!1},function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});la.registerFlag("IS_BROWSER",function(){return K3()});la.registerFlag("IS_NODE",function(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"});la.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)});la.registerFlag("PROD",function(){return!1});la.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return la.getBool("DEBUG")});la.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0});la.registerFlag("IS_TEST",function(){return!1});la.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",function(){return!0});la.registerFlag("WRAP_TO_IMAGEBITMAP",function(){return!1});la.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",function(){return!1});la.registerFlag("USE_SETTIMEOUTCUSTOM",function(){return!1});function Ii(n,e){var t=n;if(er(n))return e==="string"?[]:[n.length];var r=typeof n=="object";if(r){if("texture"in n){var a=n.channels||"RGBA";return[n.height,n.width*a.length]}else if("buffer"in n&&!(n.buffer instanceof ArrayBuffer))return[n.buffer.size/(e==null?4:qd(e))]}if(!Array.isArray(n))return[];for(var i=[];Array.isArray(t)||er(t)&&e!=="string";)i.push(t.length),t=t[0];return Array.isArray(n)&&vt().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&j3(n,i,[]),i}function j3(n,e,t){if(t=t||[],!Array.isArray(n)&&!er(n)){q(e.length===0,function(){return"Element arr[".concat(t.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(e[0]," elements")});return}q(e.length>0,function(){return"Element arr[".concat(t.join("]["),"] should be a primitive, ")+"but is an array of ".concat(n.length," elements")}),q(n.length===e[0],function(){return"Element arr[".concat(t.join("]["),"] should have ").concat(e[0]," ")+"elements, but has ".concat(n.length," elements")});for(var r=e.slice(1),a=0;a<n.length;++a)j3(n[a],r,t.concat(a))}function IA(n,e,t,r){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error("Argument '".concat(t,"' passed to '").concat(r,"' must ")+"be ".concat(n," tensor, but got ").concat(e," tensor"))}}function P(n,e,t,r){if(r===void 0&&(r="numeric"),n instanceof Pn)return IA(r,n.dtype,e,t),n;var a=ep(n);if(a!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),IA(r,a,e,t),n==null||!er(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var i=n==null?"null":n.constructor.name;throw new Error("Argument '".concat(e,"' passed to '").concat(t,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=Ii(n,a);!er(n)&&!Array.isArray(n)&&(n=[n]);var s=!0,u=a!=="string"?rp(n,a):Do(n,[],s);return U.makeTensor(u,o,a)}function Kl(n,e,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument ".concat(e," passed to ").concat(t," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=n;return a.map(function(i,o){return P(i,"".concat(e,"[").concat(o,"]"),t,r)})}var X3="__op";function H(n){var e=Object.keys(n);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(e.length," keys."));var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+X3;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];U.startScope(t);try{var s=r.apply(void 0,wt([],ke(i),!1));return np(s)&&console.error("Cannot return a Promise inside of tidy."),U.endScope(s),s}catch(u){throw U.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function fee(n,e){var t=P(n,"real","complex"),r=P(e,"imag","complex");mr(t.shape,r.shape,"real and imag shapes, ".concat(t.shape," and ").concat(r.shape,", ")+"must match in call to tf.complex().");var a={real:t,imag:r};return U.runKernel(gD,a)}var _o=H({complex_:fee});function Oo(n,e,t,r){if(r==null)r=ep(n);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(typeof n=="object"&&("texture"in n||"buffer"in n&&!(n.buffer instanceof ArrayBuffer))){if(r!=="float32"&&r!=="int32")throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(r,"."));return U.backend.createTensorFromGPUData(n,e||t,r)}if(!er(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Vr(e);var a=Ut(e),i=Ut(t);q(a===i,function(){return"Based on the provided shape, [".concat(e,"], the tensor should have ")+"".concat(a," values but has ").concat(i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==Ut(e.slice(o)):!0;q(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(t,") does not match the provided ")+"shape (".concat(e,"). ")})}}return!er(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=r!=="string"?rp(n,r):Do(n,[],!0),U.makeTensor(n,e,r)}function Gu(n,e,t){var r=Ii(n,t);return Oo(n,e,r,t)}var y0={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},jd=4;function hee(n,e){return je(this,void 0,void 0,function(){var t,r,a,i,o,s,u=this;return Xe(this,function(c){switch(c.label){case 0:for(t=[],r=[],a=Array.isArray(n)?n.map(function(l){return l.name}):Object.keys(n),i=function(l){var f=a[l],h=Array.isArray(n)?n[l].tensor:n[f];if(h.dtype!=="float32"&&h.dtype!=="int32"&&h.dtype!=="bool"&&h.dtype!=="string"&&h.dtype!=="complex64")throw new Error("Unsupported dtype in weight '".concat(f,"': ").concat(h.dtype));var d={name:f,shape:h.shape,dtype:h.dtype};if(h.dtype==="string"){var p=new Promise(function(v){return je(u,void 0,void 0,function(){var m,g,y,b,w,x,N;return Xe(this,function(T){switch(T.label){case 0:return[4,h.bytes()];case 1:for(m=T.sent(),g=m.reduce(function(E,C){return E+C.length},0)+jd*m.length,y=new Uint8Array(g),b=0,w=0;w<m.length;w++)x=m[w],N=new Uint8Array(new Uint32Array([x.length]).buffer),y.set(N,b),b+=jd,y.set(x,b),b+=x.length;return v(y),[2]}})})});r.push(p)}else r.push(h.data());e!=null&&(d.group=e),t.push(d)},o=0;o<a.length;++o)i(o);return[4,Promise.all(r)];case 1:return s=c.sent(),[2,{data:dee(s),specs:t}]}})})}function Y3(n,e){var t,r,a={},i,o=0;try{for(var s=cr(e),u=s.next();!u.done;u=s.next()){var c=u.value,l=c.name,f=c.dtype,h=c.shape,d=Ut(h),p=void 0;if("quantization"in c){var v=c.quantization;if(v.dtype==="uint8"||v.dtype==="uint16"){if(!("min"in v&&"scale"in v))throw new Error("Weight ".concat(c.name," with quantization ").concat(v.dtype," ")+"doesn't have corresponding metadata min and scale.")}else if(v.dtype==="float16"){if(f!=="float32")throw new Error("Weight ".concat(c.name," is quantized with ").concat(v.dtype," ")+"which only supports weights of type float32 not ".concat(f,"."))}else throw new Error("Weight ".concat(c.name," has unknown ")+"quantization dtype ".concat(v.dtype,". ")+"Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.");var m=y0[v.dtype],g=n.slice(o,o+d*m),y=v.dtype==="uint8"?new Uint8Array(g):new Uint16Array(g);if(f==="float32")if(v.dtype==="uint8"||v.dtype==="uint16"){p=new Float32Array(y.length);for(var b=0;b<y.length;b++){var w=y[b];p[b]=w*v.scale+v.min}}else if(v.dtype==="float16")i===void 0&&(i=bee()),p=i(y);else throw new Error("Unsupported quantization type ".concat(v.dtype," ")+"for weight type float32.");else if(f==="int32"){if(v.dtype!=="uint8"&&v.dtype!=="uint16")throw new Error("Unsupported quantization type ".concat(v.dtype," ")+"for weight type int32.");p=new Int32Array(y.length);for(var b=0;b<y.length;b++){var w=y[b];p[b]=Math.round(w*v.scale+v.min)}}else throw new Error("Unsupported dtype in weight '".concat(l,"': ").concat(f));o+=d*m}else if(f==="string"){var x=Ut(c.shape);p=[];for(var b=0;b<x;b++){var N=new Uint32Array(n.slice(o,o+jd))[0];o+=jd;var T=new Uint8Array(n.slice(o,o+N));p.push(T),o+=N}}else{var E=y0[f],g=n.slice(o,o+d*E);if(f==="float32")p=new Float32Array(g);else if(f==="int32")p=new Int32Array(g);else if(f==="bool")p=new Uint8Array(g);else if(f==="complex64"){p=new Float32Array(g);for(var C=new Float32Array(p.length/2),F=new Float32Array(p.length/2),b=0;b<C.length;b++)C[b]=p[b*2],F[b]=p[b*2+1];var _=Gu(C,h,"float32"),O=Gu(F,h,"float32");a[l]=_o(_,O),_.dispose(),O.dispose()}else throw new Error("Unsupported dtype in weight '".concat(l,"': ").concat(f));o+=d*E}f!=="complex64"&&(a[l]=Gu(p,h,f))}}catch(L){t={error:L}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return a}function dee(n){if(n===null)throw new Error("Invalid input value: ".concat(JSON.stringify(n)));var e=0,t=[];n.forEach(function(i){if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(i.constructor.name))});var r=new Uint8Array(e),a=0;return t.forEach(function(i){r.set(new Uint8Array(i.buffer),a),a+=i.byteLength}),r.buffer}var z0=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function CA(n){return z0?Buffer.byteLength(n):new Blob([n]).size}function pee(n){if(z0)return Buffer.from(n).toString("base64");for(var e=new Uint8Array(n),t="",r=0,a=e.length;r<a;r++)t+=String.fromCharCode(e[r]);return btoa(t)}function vee(n){if(z0){var e=Buffer.from(n,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var t=atob(n),r=new Uint8Array(t.length),a=0;a<t.length;++a)r.set([t.charCodeAt(a)],a);return r.buffer}function $0(n){if(n.length===1)return n[0];var e=0;n.forEach(function(a){e+=a.byteLength});var t=new Uint8Array(e),r=0;return n.forEach(function(a){t.set(new Uint8Array(a),r),r+=a.byteLength}),t.buffer}function AA(n){var e="/";for(n=n.trim();n.endsWith(e);)n=n.slice(0,n.length-1);var t=n.split(e);return t[t.length-1]}function Z3(n,e){var t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function J3(n,e,t){var r={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(r.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=e,r.weightData=t}return n.signature!=null&&(r.signature=n.signature),n.userDefinedMetadata!=null&&(r.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(r.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(r.initializerSignature=n.initializerSignature),r}function q0(n,e){return je(this,void 0,void 0,function(){var t,r,a;return Xe(this,function(i){switch(i.label){case 0:return n.weightsManifest==null?[3,2]:[4,e(n.weightsManifest)];case 1:a=ke.apply(void 0,[i.sent(),2]),t=a[0],r=a[1],i.label=2;case 2:return[2,J3(n,t,r)]}})})}function sf(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:CA(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:CA(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}function Q3(n){var e,t,r=[];try{for(var a=cr(n),i=a.next();!i.done;i=a.next()){var o=i.value;r.push.apply(r,wt([],ke(o.weights),!1))}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return r}function mee(){var n=function(r){for(var a=r<<13,i=0;(a&8388608)===0;)i-=8388608,a<<=1;return a&=-8388609,i+=947912704,a|i},e=new Uint32Array(2048);e[0]=0;for(var t=1;t<1024;t++)e[t]=n(t);for(var t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function gee(){var n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(var e=1;e<31;e++)n[e]=e<<23;for(var e=33;e<63;e++)n[e]=2147483648+(e-32<<23);return n}function yee(){for(var n=new Uint32Array(64),e=0;e<64;e++)n[e]=1024;return n[0]=n[32]=0,n}function bee(){var n=mee(),e=gee(),t=yee();return function(r){for(var a=new ArrayBuffer(4*r.length),i=new Uint32Array(a),o=0;o<r.length;o++){var s=r[o],u=n[t[s>>10]+(s&1023)]+e[s>>10];i[o]=u}return new Float32Array(a)}}var fa=function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerSaveRouter=function(e){n.getInstance().saveRouters.push(e)},n.registerLoadRouter=function(e){n.getInstance().loadRouters.push(e)},n.getSaveHandlers=function(e){return n.getHandlers(e,"save")},n.getLoadHandlers=function(e,t){return n.getHandlers(e,"load",t)},n.getHandlers=function(e,t,r){var a=[],i=t==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters;return i.forEach(function(o){var s=o(e,r);s!==null&&a.push(s)}),a},n}(),wee=function(n){return fa.registerSaveRouter(n)},xee=function(n){return fa.registerLoadRouter(n)},kee=function(n){return fa.getSaveHandlers(n)},See=function(n,e){return fa.getLoadHandlers(n,e)},b0="tensorflowjs",w0=1,vs="models_store",Io="model_info_store";function eF(){if(!vt().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function x0(n){var e=n.result;e.createObjectStore(vs,{keyPath:"modelPath"}),e.createObjectStore(Io,{keyPath:"modelPath"})}var ys=function(){function n(e){if(this.indexedDB=eF(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return n.prototype.save=function(e){return je(this,void 0,void 0,function(){return Xe(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},n.prototype.load=function(){return je(this,void 0,void 0,function(){return Xe(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},n.prototype.databaseAction=function(e,t){var r=this;return new Promise(function(a,i){var o=r.indexedDB.open(b0,w0);o.onupgradeneeded=function(){return x0(o)},o.onsuccess=function(){var s=o.result;if(t==null){var u=s.transaction(vs,"readonly"),c=u.objectStore(vs),l=c.get(r.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),i(new Error("Cannot find model with path '".concat(r.modelPath,"' ")+"in IndexedDB."));a(l.result.modelArtifacts)},l.onerror=function(m){return s.close(),i(l.error)},u.oncomplete=function(){return s.close()}}else{var f=sf(t),h=s.transaction(Io,"readwrite"),d=h.objectStore(Io),p=d.put({modelPath:r.modelPath,modelArtifactsInfo:f}),v;p.onsuccess=function(){v=s.transaction(vs,"readwrite");var m=v.objectStore(vs),g=m.put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:f});g.onsuccess=function(){return a({modelArtifactsInfo:f})},g.onerror=function(y){d=h.objectStore(Io);var b=d.delete(r.modelPath);b.onsuccess=function(){return s.close(),i(g.error)},b.onerror=function(w){return s.close(),i(g.error)}}},p.onerror=function(m){return s.close(),i(p.error)},h.oncomplete=function(){v==null?s.close():v.oncomplete=function(){return s.close()}}}},o.onerror=function(s){return i(o.error)}})},n}();ys.URL_SCHEME="indexeddb://";var tF=function(n){return vt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(ys.URL_SCHEME)?Nee(n.slice(ys.URL_SCHEME.length)):null};fa.registerSaveRouter(tF);fa.registerLoadRouter(tF);function Nee(n){return new ys(n)}function Tee(n){return n.startsWith(ys.URL_SCHEME)?n.slice(ys.URL_SCHEME.length):n}var Eee=function(){function n(){this.indexedDB=eF()}return n.prototype.listModels=function(){return je(this,void 0,void 0,function(){var e=this;return Xe(this,function(t){return[2,new Promise(function(r,a){var i=e.indexedDB.open(b0,w0);i.onupgradeneeded=function(){return x0(i)},i.onsuccess=function(){var o=i.result,s=o.transaction(Io,"readonly"),u=s.objectStore(Io),c=u.getAll();c.onsuccess=function(){var l,f,h={};try{for(var d=cr(c.result),p=d.next();!p.done;p=d.next()){var v=p.value;h[v.modelPath]=v.modelArtifactsInfo}}catch(m){l={error:m}}finally{try{p&&!p.done&&(f=d.return)&&f.call(d)}finally{if(l)throw l.error}}r(h)},c.onerror=function(l){return o.close(),a(c.error)},s.oncomplete=function(){return o.close()}},i.onerror=function(o){return a(i.error)}})]})})},n.prototype.removeModel=function(e){return je(this,void 0,void 0,function(){var t=this;return Xe(this,function(r){return e=Tee(e),[2,new Promise(function(a,i){var o=t.indexedDB.open(b0,w0);o.onupgradeneeded=function(){return x0(o)},o.onsuccess=function(){var s=o.result,u=s.transaction(Io,"readwrite"),c=u.objectStore(Io),l=c.get(e),f;l.onsuccess=function(){if(l.result==null)return s.close(),i(new Error("Cannot find model with path '".concat(e,"' ")+"in IndexedDB."));var h=c.delete(e),d=function(){f=s.transaction(vs,"readwrite");var p=f.objectStore(vs),v=p.delete(e);v.onsuccess=function(){return a(l.result.modelArtifactsInfo)},v.onerror=function(m){return i(l.error)}};h.onsuccess=d,h.onerror=function(p){return d(),s.close(),i(l.error)}},l.onerror=function(h){return s.close(),i(l.error)},u.oncomplete=function(){f==null?s.close():f.oncomplete=function(){return s.close()}}},o.onerror=function(s){return i(o.error)}})]})})},n}(),Ki="/",qu="tensorflowjs_models",nF="info",Iee="model_topology",Cee="weight_specs",Aee="weight_data",Dee="model_metadata";function rF(n){return{info:[qu,n,nF].join(Ki),topology:[qu,n,Iee].join(Ki),weightSpecs:[qu,n,Cee].join(Ki),weightData:[qu,n,Aee].join(Ki),modelMetadata:[qu,n,Dee].join(Ki)}}function aF(n){var e,t;try{for(var r=cr(Object.values(n)),a=r.next();!a.done;a=r.next()){var i=a.value;window.localStorage.removeItem(i)}}catch(o){e={error:o}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}}function _ee(n){var e=n.split(Ki);if(e.length<3)throw new Error("Invalid key format: ".concat(n));return e.slice(1,e.length-1).join(Ki)}function Fee(n){return n.startsWith(bs.URL_SCHEME)?n.slice(bs.URL_SCHEME.length):n}var bs=function(){function n(e){if(!vt().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=rF(this.modelPath)}return n.prototype.save=function(e){return je(this,void 0,void 0,function(){var t,r,a,i;return Xe(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),a=sf(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,pee(e.weightData)),i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),[2,{modelArtifactsInfo:a}]}catch{throw aF(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."))}return[2]})})},n.prototype.load=function(){return je(this,void 0,void 0,function(){var e,t,r,a,i,o,s;return Xe(this,function(u){if(e=JSON.parse(this.LS.getItem(this.keys.info)),e==null)throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},r=JSON.parse(this.LS.getItem(this.keys.topology)),r==null)throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");if(t.modelTopology=r,a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)),a==null)throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");if(t.weightSpecs=a,i=this.LS.getItem(this.keys.modelMetadata),i!=null&&(o=JSON.parse(i),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,o.signature!=null&&(t.signature=o.signature),o.userDefinedMetadata!=null&&(t.userDefinedMetadata=o.userDefinedMetadata),o.modelInitializer!=null&&(t.modelInitializer=o.modelInitializer),o.initializerSignature!=null&&(t.initializerSignature=o.initializerSignature),o.trainingConfig!=null&&(t.trainingConfig=o.trainingConfig)),s=this.LS.getItem(this.keys.weightData),s==null)throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));return t.weightData=vee(s),[2,t]})})},n}();bs.URL_SCHEME="localstorage://";var iF=function(n){return vt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(bs.URL_SCHEME)?Ree(n.slice(bs.URL_SCHEME.length)):null};fa.registerSaveRouter(iF);fa.registerLoadRouter(iF);function Ree(n){return new bs(n)}var Oee=function(){function n(){q(vt().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),q(typeof window>"u"||typeof window.localStorage<"u",function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return n.prototype.listModels=function(){return je(this,void 0,void 0,function(){var e,t,r,a,i,o;return Xe(this,function(s){for(e={},t=qu+Ki,r=Ki+nF,a=0;a<this.LS.length;++a)i=this.LS.key(a),i.startsWith(t)&&i.endsWith(r)&&(o=_ee(i),e[o]=JSON.parse(this.LS.getItem(i)));return[2,e]})})},n.prototype.removeModel=function(e){return je(this,void 0,void 0,function(){var t,r;return Xe(this,function(a){if(e=Fee(e),t=rF(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '".concat(e,"'"));return r=JSON.parse(this.LS.getItem(t.info)),aF(t),[2,r]})})},n}(),Uu="://",Fo=function(){function n(){this.managers={}}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerManager=function(e,t){q(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(Uu)&&(e=e.slice(0,e.indexOf(Uu))),q(e.length>0,function(){return"scheme must not be an empty string."});var r=n.getInstance();q(r.managers[e]==null,function(){return"A model store manager is already registered for scheme '".concat(e,"'.")}),r.managers[e]=t},n.getManager=function(e){var t=n.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '".concat(e,"'"));return t},n.getSchemes=function(){return Object.keys(n.getInstance().managers)},n}();function Ld(n){if(n.indexOf(Uu)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+"".concat(Fo.getSchemes().join(",")));return{scheme:n.split(Uu)[0],path:n.split(Uu)[1]}}function oF(n,e,t){return t===void 0&&(t=!1),je(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f;return Xe(this,function(h){switch(h.label){case 0:return q(n!==e,function(){return"Old path and new path are the same: '".concat(n,"'")}),r=fa.getLoadHandlers(n),q(r.length>0,function(){return"Copying failed because no load handler is found for source URL ".concat(n,".")}),q(r.length<2,function(){return"Copying failed because more than one (".concat(r.length,") ")+"load handlers for source URL ".concat(n,".")}),a=r[0],i=fa.getSaveHandlers(e),q(i.length>0,function(){return"Copying failed because no save handler is found for destination "+"URL ".concat(e,".")}),q(i.length<2,function(){return"Copying failed because more than one (".concat(r.length,") ")+"save handlers for destination URL ".concat(e,".")}),o=i[0],s=Ld(n).scheme,u=Ld(n).path,c=s===Ld(n).scheme,[4,a.load()];case 1:return l=h.sent(),t&&c?[4,Fo.getManager(s).removeModel(u)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[4,o.save(l)];case 4:return f=h.sent(),t&&!c?[4,Fo.getManager(s).removeModel(u)]:[3,6];case 5:h.sent(),h.label=6;case 6:return[2,f.modelArtifactsInfo]}})})}function Pee(){return je(this,void 0,void 0,function(){var n,e,t,r,a,i,o,s,u,c,l;return Xe(this,function(f){switch(f.label){case 0:n=Fo.getSchemes(),e={},f.label=1;case 1:f.trys.push([1,6,7,8]),t=cr(n),r=t.next(),f.label=2;case 2:return r.done?[3,5]:(a=r.value,[4,Fo.getManager(a).listModels()]);case 3:i=f.sent();for(o in i)s=a+Uu+o,e[s]=i[o];f.label=4;case 4:return r=t.next(),[3,2];case 5:return[3,8];case 6:return u=f.sent(),c={error:u},[3,8];case 7:try{r&&!r.done&&(l=t.return)&&l.call(t)}finally{if(c)throw c.error}return[7];case 8:return[2,e]}})})}function Mee(n){return je(this,void 0,void 0,function(){var e,t;return Xe(this,function(r){return e=Ld(n),t=Fo.getManager(e.scheme),[2,t.removeModel(e.path)]})})}function Bee(n,e){return je(this,void 0,void 0,function(){var t;return Xe(this,function(r){return t=!1,[2,oF(n,e,t)]})})}function Lee(n,e){return je(this,void 0,void 0,function(){var t;return Xe(this,function(r){return t=!0,[2,oF(n,e,t)]})})}var zee=function(){function n(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}return n.prototype.fetch=function(e,t){return fetch(e,t)},n.prototype.now=function(){return performance.now()},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},n.prototype.setTimeoutCustom=function(e,t){var r=this;if(typeof window>"u"||!vt().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(function(){window.postMessage({name:r.messageName,index:r.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",function(a){if(a.source===window&&a.data.name===r.messageName){a.stopPropagation();var i=r.functionRefs[a.data.index];i(),r.handledMessageCount++,r.handledMessageCount===r.functionRefs.length&&(r.functionRefs=[],r.handledMessageCount=0)}},!0))},n.prototype.isTypedArray=function(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray},n}();if(vt().get("IS_BROWSER")){vt().setPlatform("browser",new zee);try{Fo.registerManager(bs.URL_SCHEME,new Oee)}catch{}try{Fo.registerManager(ys.URL_SCHEME,new Eee)}catch{}}var $ee={importFetch:function(){return mA()}},t0,qee=function(){function n(){this.util=gA(),this.textEncoder=new this.util.TextEncoder}return n.prototype.fetch=function(e,t){return vt().global.fetch!=null?vt().global.fetch(e,t):(t0==null&&(t0=$ee.importFetch()),t0(e,t))},n.prototype.now=function(){var e=process.hrtime();return e[0]*1e3+e[1]/1e6},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},n.prototype.isTypedArray=function(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)},n}();vt().get("IS_NODE")&&!vt().get("IS_BROWSER")&&vt().setPlatform("node",new qee);function Xi(n,e,t){return e===void 0&&(e="float32"),e=e||"float32",Vr(n),new Kd(n,e,t)}function Wee(n,e){var t=P(n,"x","cast");if(!VA(e))throw new Error("Failed to cast to unknown dtype ".concat(e));if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var r={x:t},a={dtype:e};return U.runKernel(F0,r,a)}var Nn=H({cast_:Wee});function Vee(n){var e=P(n,"x","clone","string_or_numeric"),t={x:e};return U.runKernel(R0,t)}var gs=H({clone_:Vee});function sF(n,e){e===void 0&&(e=!1),console.log(n.toString(e))}H3();var Gee={buffer:Xi,cast:Nn,clone:gs,print:sF};JQ(Gee);function Uee(){vt().set("PROD",!0)}function Hee(){vt().set("DEBUG",!0)}function Kee(){vt().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function jee(n){vt().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Xee(){U.disposeVariables()}function Yee(){return U}function Zee(){return U.memory()}function Jee(n){return U.profile(n)}function Mn(n,e){return U.tidy(n,e)}function Er(n){var e=B0(n);e.forEach(function(t){return t.dispose()})}function uF(n){return U.keep(n)}function Qee(n){return U.time(n)}function ete(n){return U.setBackend(n)}function tte(){return U.ready()}function nte(){return U.backendName}function rte(n){U.removeBackend(n)}function ate(n){return U.findBackend(n)}function ite(n){return U.findBackendFactory(n)}function ote(n,e,t){return t===void 0&&(t=1),U.registerBackend(n,e,t)}function ste(){return U.backend}function ute(n,e){vt().setPlatform(n,e)}function cte(n,e){var t,r=P(n,"a","add"),a=P(e,"b","add");t=ke(vn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return U.runKernel(_0,i)}var ct=H({add_:cte});function lte(n,e){var t,r=P(n,"a","floorDiv"),a=P(e,"b","floorDiv");t=ke(vn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return U.runKernel(XD,i)}var cF=H({floorDiv_:lte});function fte(n,e){var t,r=P(n,"a","div"),a=P(e,"b","div");if(t=ke(vn(r,a),2),r=t[0],a=t[1],r.dtype==="int32"&&a.dtype==="int32")return cF(r,a);var i={a:r,b:a},o={};return U.runKernel(BD,i,o)}var Gt=H({div_:fte});function hte(n,e){var t,r=P(n,"a","mul"),a=P(e,"b","mul");t=ke(vn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return U.runKernel(I_,i)}var Me=H({mul_:hte});function dte(n){var e=P(n,"x","abs");if(e.dtype==="complex64"){var t={x:e};return U.runKernel(yD,t)}else{var t={x:e};return U.runKernel(YA,t)}}var ua=H({abs_:dte});function pte(n){var e=P(n,"x","acos"),t={x:e};return U.runKernel(ZA,t)}var vte=H({acos_:pte});function mte(n){var e=P(n,"x","acosh"),t={x:e};return U.runKernel(JA,t)}var gte=H({acosh_:mte});function yte(n){q(Array.isArray(n),function(){return"The argument passed to tf.addN() must be a list of tensors"}),q(n.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+"".concat(n.length)});var e=n.map(function(a,i){return P(a,"tensors".concat(i),"addN")}),t=e[0];e.forEach(function(a){if(a.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(a){if(!Ro(a.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=e;return U.runKernel(QA,r)}var bte=H({addN_:yte});function wte(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=P(n,"x","all","bool"),a={x:r},i={axis:e,keepDims:t};return U.runKernel(eD,a,i)}var xte=H({all_:wte});function kte(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=P(n,"x","any","bool"),a={x:r},i={axis:e,keepDims:t};return U.runKernel(tD,a,i)}var Ste=H({any_:kte});function Nte(n,e){e===void 0&&(e=0);var t=P(n,"x","argMax"),r={x:t},a={axis:e};return U.runKernel(nD,r,a)}var Tte=H({argMax_:Nte});function Ete(n,e){e===void 0&&(e=0);var t=P(n,"x","argMin"),r={x:t},a={axis:e};return U.runKernel(rD,r,a)}var Ite=H({argMin_:Ete});function Cte(n){var e=P(n,"x","asin"),t={x:e};return U.runKernel(aD,t)}var Ate=H({asin_:Cte});function Dte(n){var e=P(n,"x","asinh"),t={x:e};return U.runKernel(iD,t)}var _te=H({asinh_:Dte});function Fte(n){var e=P(n,"x","atan"),t={x:e};return U.runKernel(oD,t)}var Rte=H({atan_:Fte});function Ote(n,e){var t,r=P(n,"a","atan2"),a=P(e,"b","atan2");t=ke(vn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return U.runKernel(uD,i)}var Pte=H({atan2_:Ote});function Mte(n){var e=P(n,"x","atanh"),t={x:e};return U.runKernel(sD,t)}var Bte=H({atanh_:Mte});function Lte(n,e,t,r,a,i){a===void 0&&(a="NHWC");var o=n[3],s=wt(wt([],ke(e),!1),[o],!1),u=hF(a);return uf(n,s,t,i,r,null,null,u)}function lF(n,e,t,r,a,i,o){o===void 0&&(o="channelsLast");var s=ke(jl(e),2),u=s[0],c=s[1],l;if(o==="channelsLast")l=[u,c,n[3],n[3]];else if(o==="channelsFirst")l=[u,c,n[1],n[1]];else throw new Error("Unknown dataFormat ".concat(o));return uf(n,l,t,r,a,i,!1,o)}function zte(n,e,t,r,a,i,o){o===void 0&&(o="NDHWC");var s=ke(k0(e),3),u=s[0],c=s[1],l=s[2],f,h;if(o==="NDHWC")h="channelsLast",f=[u,c,l,n[4],n[4]];else if(o==="NCDHW")h="channelsFirst",f=[u,c,l,n[1],n[1]];else throw new Error("Unknown dataFormat ".concat(o));return fF(n,f,t,r,a,!1,h,i)}function uf(n,e,t,r,a,i,o,s){var u,c;o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var l=ke([-1,-1,-1,-1],4),f=l[0],h=l[1],d=l[2],p=l[3];if(s==="channelsLast")u=ke(n,4),f=u[0],h=u[1],d=u[2],p=u[3];else if(s==="channelsFirst")c=ke(n,4),f=c[0],p=c[1],h=c[2],d=c[3];else throw new Error("Unknown dataFormat ".concat(s));var v=ke(e,4),m=v[0],g=v[1],y=v[3],b=ke(jl(t),2),w=b[0],x=b[1],N=ke(jl(r),2),T=N[0],E=N[1],C=Hu(m,T),F=Hu(g,E),_=Wte(a,h,d,w,x,C,F,i,s),O=_.padInfo,L=_.outHeight,z=_.outWidth,$=o?y*p:y,B;return s==="channelsFirst"?B=[f,$,L,z]:s==="channelsLast"&&(B=[f,L,z,$]),{batchSize:f,dataFormat:s,inHeight:h,inWidth:d,inChannels:p,outHeight:L,outWidth:z,outChannels:$,padInfo:O,strideHeight:w,strideWidth:x,filterHeight:m,filterWidth:g,effectiveFilterHeight:C,effectiveFilterWidth:F,dilationHeight:T,dilationWidth:E,inShape:n,outShape:B,filterShape:e}}function fF(n,e,t,r,a,i,o,s){var u,c;i===void 0&&(i=!1),o===void 0&&(o="channelsLast");var l=ke([-1,-1,-1,-1,-1],5),f=l[0],h=l[1],d=l[2],p=l[3],v=l[4];if(o==="channelsLast")u=ke(n,5),f=u[0],h=u[1],d=u[2],p=u[3],v=u[4];else if(o==="channelsFirst")c=ke(n,5),f=c[0],v=c[1],h=c[2],d=c[3],p=c[4];else throw new Error("Unknown dataFormat ".concat(o));var m=ke(e,5),g=m[0],y=m[1],b=m[2],w=m[4],x=ke(k0(t),3),N=x[0],T=x[1],E=x[2],C=ke(k0(r),3),F=C[0],_=C[1],O=C[2],L=Hu(g,F),z=Hu(y,_),$=Hu(b,O),B=Vte(a,h,d,p,N,T,E,L,z,$,s),W=B.padInfo,X=B.outDepth,Z=B.outHeight,V=B.outWidth,j=i?w*v:w,re;return o==="channelsFirst"?re=[f,j,X,Z,V]:o==="channelsLast"&&(re=[f,X,Z,V,j]),{batchSize:f,dataFormat:o,inDepth:h,inHeight:d,inWidth:p,inChannels:v,outDepth:X,outHeight:Z,outWidth:V,outChannels:j,padInfo:W,strideDepth:N,strideHeight:T,strideWidth:E,filterDepth:g,filterHeight:y,filterWidth:b,effectiveFilterDepth:L,effectiveFilterHeight:z,effectiveFilterWidth:$,dilationDepth:F,dilationHeight:_,dilationWidth:O,inShape:n,outShape:re,filterShape:e}}function $te(n,e,t,r,a){r==null&&(r=W0(n,e,t));var i=n[0],o=n[1],s=Xl((i-e+2*r)/t+1,a),u=Xl((o-e+2*r)/t+1,a);return[s,u]}function qte(n,e,t,r,a,i){a==null&&(a=W0(n,e[0],r[0]));for(var o=[0,0,0,t],s=0;s<3;s++)n[s]+2*a>=e[s]&&(o[s]=Xl((n[s]-e[s]+2*a)/r[s]+1,i));return o}function W0(n,e,t,r){r===void 0&&(r=1);var a=Hu(e,r);return Math.floor((n[0]*(t-1)-t+a)/2)}function jl(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function k0(n){return typeof n=="number"?[n,n,n]:n}function Hu(n,e){return e<=1?n:n+(n-1)*(e-1)}function Wte(n,e,t,r,a,i,o,s,u){var c,l,f;if(typeof n=="number"){var h=n===0?"VALID":"NUMBER";c={top:n,bottom:n,left:n,right:n,type:h};var d=$te([e,t],i,r,n,s);l=d[0],f=d[1]}else if(n==="same"){l=Math.ceil(e/r),f=Math.ceil(t/a);var p=Math.max(0,(l-1)*r+i-e),v=Math.max(0,(f-1)*a+o-t),m=Math.floor(p/2),g=p-m,y=Math.floor(v/2),b=v-y;c={top:m,bottom:g,left:y,right:b,type:"SAME"}}else if(n==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-i+1)/r),f=Math.ceil((t-o+1)/a);else if(typeof n=="object"){var m=u==="channelsLast"?n[1][0]:n[2][0],g=u==="channelsLast"?n[1][1]:n[2][1],y=u==="channelsLast"?n[2][0]:n[3][0],b=u==="channelsLast"?n[2][1]:n[3][1],h=m===0&&g===0&&y===0&&b===0?"VALID":"EXPLICIT";c={top:m,bottom:g,left:y,right:b,type:h},l=Xl((e-i+m+g)/r+1,s),f=Xl((t-o+y+b)/a+1,s)}else throw Error("Unknown padding parameter: ".concat(n));return{padInfo:c,outHeight:l,outWidth:f}}function Vte(n,e,t,r,a,i,o,s,u,c,l){var f,h,d,p;if(n==="valid"&&(n=0),typeof n=="number"){var v=n===0?"VALID":"NUMBER";f={top:n,bottom:n,left:n,right:n,front:n,back:n,type:v};var m=qte([e,t,r,1],[s,u,c],1,[a,i,o],n,l);h=m[0],d=m[1],p=m[2]}else if(n==="same"){h=Math.ceil(e/a),d=Math.ceil(t/i),p=Math.ceil(r/o);var g=(h-1)*a+s-e,y=(d-1)*i+u-t,b=(p-1)*o+c-r,w=Math.floor(g/2),x=g-w,N=Math.floor(y/2),T=y-N,E=Math.floor(b/2),C=b-E;f={top:N,bottom:T,left:E,right:C,front:w,back:x,type:"SAME"}}else throw Error("Unknown padding parameter: ".concat(n));return{padInfo:f,outDepth:h,outHeight:d,outWidth:p}}function Xl(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode ".concat(e))}}function Yl(n){var e=ke(jl(n),3),t=e[0],r=e[1],a=e[2];return t===1&&r===1&&a===1}function Ji(n,e){return Yl(n)||Yl(e)}function ws(n){return jl(n).every(function(e){return e>0})}function hF(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat ".concat(n))}function Ca(n,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,"."));if(typeof e=="number")q(Xu(e),function(){return"Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,".")});else if(typeof e=="object")e.forEach(function(r){r.forEach(function(a){q(Xu(a),function(){return"Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(a,".")})})});else throw Error("Error in ".concat(n,": Unknown padding parameter: ").concat(e))}}function Gte(n,e){var t=P(n,"x","reshape","string_or_numeric"),r={x:t},a={shape:e};return U.runKernel(K_,r,a)}var ve=H({reshape_:Gte});function Ute(n,e,t,r,a){var i=P(n,"x","avgPool","float32"),o=1;q(Ji(t,o),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")});var s=i,u=!1;i.rank===3&&(u=!0,s=ve(i,[1,i.shape[0],i.shape[1],i.shape[2]])),q(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(s.rank,".")}),Ca("avgPool",r,a);var c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a},f=U.runKernel(cD,c,l);return f=Nn(f,i.dtype),u?ve(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var dF=H({avgPool_:Ute});function Hte(n,e,t,r,a,i){i===void 0&&(i="NDHWC");var o=P(n,"x","avgPool3d","float32"),s=o,u=!1;o.rank===4&&(u=!0,s=ve(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),q(s.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),q(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),q(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,function(){return"Error in avgPool3d: Stride must be > 0, but got '".concat(t,"'")}),Ca("avgPool3d",r,a);var c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a,dataFormat:i},f=U.runKernel(lD,c,l);return f=Nn(f,s.dtype),u?ve(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var Kte=H({avgPool3d_:Hte});function jte(n,e){e===void 0&&(e=0),q(n.length>=1,function(){return"Pass at least one tensor to concat"});var t=Kl(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `.concat(i.dtype,". "))}),t.length===1)return gs(t[0]);var r=t,a={axis:e};return U.runKernel(bD,r,a)}var Wr=H({concat_:jte});function Xte(n,e,t,r){var a;t===void 0&&(t=!1),r===void 0&&(r=!1);var i=P(n,"a","matMul"),o=P(e,"b","matMul");a=ke(vn(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:r};return U.runKernel(fD,s,u)}var Ft=H({matMul_:Xte});function Yte(n){var e=P(n,"x","sigmoid","float32"),t={x:e};return U.runKernel(u3,t)}var Ku=H({sigmoid_:Yte});function Zte(n,e,t){var r=P(n,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");var a={x:r},i={begin:e,size:t};return U.runKernel(a3,a,i)}var un=H({slice_:Zte});function Jte(n){var e=P(n,"x","tanh","float32"),t={x:e};return U.runKernel(I3,t)}var S0=H({tanh_:Jte});function Qte(n,e,t,r,a,i){var o=P(n,"forgetBias","basicLSTMCell"),s=P(e,"lstmKernel","basicLSTMCell"),u=P(t,"lstmBias","basicLSTMCell"),c=P(r,"data","basicLSTMCell"),l=P(a,"c","basicLSTMCell"),f=P(i,"h","basicLSTMCell"),h=Wr([c,f],1),d=Ft(h,s),p=ct(d,u),v=p.shape[0],m=p.shape[1]/4,g=[v,m],y=un(p,[0,0],g),b=un(p,[0,m],g),w=un(p,[0,m*2],g),x=un(p,[0,m*3],g),N=ct(Me(Ku(y),S0(b)),Me(l,Ku(ct(o,w)))),T=Me(S0(N),Ku(x));return[N,T]}var ene=H({basicLSTMCell_:Qte});function tne(n,e,t){var r=P(n,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});q(r.rank>=1+e.length,function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(e.length)}),q(t.length===e.length,function(){return"crops.length is ".concat(t.length," but should be equal to blockShape.length  ").concat(e.length)}),q(r.shape[0]%a===0,function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(e.join(" * ")," === ").concat(a)});var i={x:r},o={blockShape:e,crops:t};return U.runKernel(hD,i,o)}var pF=H({batchToSpaceND_:tne});function nne(n){var e;return n.rank===0||n.rank===1?e=ve(n,[1,1,1,n.size]):n.rank===2?e=ve(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=ve(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}function rne(n,e,t,r,a,i){i==null&&(i=.001);var o=P(n,"x","batchNorm"),s=P(e,"mean","batchNorm"),u=P(t,"variance","batchNorm"),c;a!=null&&(c=P(a,"scale","batchNorm"));var l;r!=null&&(l=P(r,"offset","batchNorm")),q(s.rank===u.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),q(l==null||s.rank===l.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),q(c==null||s.rank===c.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var f=nne(o),h={x:f,scale:c,offset:l,mean:s,variance:u},d={varianceEpsilon:i},p=U.runKernel(YD,h,d);return ve(p,o.shape)}var ip=H({batchNorm_:rne});function ane(n,e,t,r,a,i){var o=P(n,"x","batchNorm"),s=P(e,"mean","batchNorm"),u=P(t,"variance","batchNorm"),c;a!=null&&(c=P(a,"scale","batchNorm"));var l;return r!=null&&(l=P(r,"offset","batchNorm")),q(o.rank===2,function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(o.rank,".")}),q(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(s.rank,".")}),q(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&q(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&q(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(l.rank,".")}),ip(o,s,u,l,c,i)}var ine=H({batchNorm2d_:ane});function one(n,e,t,r,a,i){var o=P(n,"x","batchNorm"),s=P(e,"mean","batchNorm"),u=P(t,"variance","batchNorm"),c;a!=null&&(c=P(a,"scale","batchNorm"));var l;return r!=null&&(l=P(r,"offset","batchNorm")),q(o.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(o.rank,".")}),q(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(s.rank,".")}),q(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&q(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&q(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(l.rank,".")}),ip(o,s,u,l,c,i)}var sne=H({batchNorm3d_:one});function une(n,e,t,r,a,i){var o=P(n,"x","batchNorm"),s=P(e,"mean","batchNorm"),u=P(t,"variance","batchNorm"),c;a!=null&&(c=P(a,"scale","batchNorm"));var l;return r!=null&&(l=P(r,"offset","batchNorm")),q(o.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(o.rank,".")}),q(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(s.rank,".")}),q(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&q(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&q(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(l.rank,".")}),ip(o,s,u,l,c,i)}var cne=H({batchNorm4d_:une});function lne(n,e,t){var r=P(n,"x","bincount"),a=P(e,"weights","bincount");q(r.dtype==="int32",function(){return"Error in bincount: input "+"dtype must be int32, but got ".concat(r.dtype)}),q(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),q(a.size===r.size||a.size===0,function(){return"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(r.shape,", weights shape: ")+"".concat(a.shape,".")});var i={x:r,weights:a},o={size:t};return U.runKernel(dD,i,o)}var vF=H({bincount_:lne});function fne(n,e){var t=P(n,"s0","broadcastArgs","int32"),r=P(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error("broadcastArgs(): first input must be a vector (rank=1). "+"Has rank ".concat(t.rank));if(r.rank!==1)throw new Error("broadcastArgs(): second input must be a vector (rank=1). "+"Has rank ".concat(r.rank));var a={s0:t,s1:r};return U.runKernel(pD,a)}var hne=H({broadcastArgs_:fne});function dne(n,e){var t=P(n,"broadcastTo","x"),r=t.shape;if(Vr(e),e.length<t.rank)throw new Error("broadcastTo(): shape.length=".concat(e.length," < input.rank=").concat(t.rank,"."));if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=ve(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(e,"]."));var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return gs(t);var c={x:t},l={reps:o};return U.runKernel(O0,c,l)}var zd=H({broadcastTo_:dne});function pne(n){var e=P(n,"x","ceil","float32"),t={x:e};return U.runKernel(vD,t)}var vne=H({ceil_:pne});function cf(n,e,t){Vr(n);var r={shape:n,value:e,dtype:t};return U.runKernel(HD,{},r)}function mne(n,e,t){var r=P(n,"x","clipByValue");if(q(e<=t,function(){return"Error in clip: min (".concat(e,") must be ")+"less than or equal to max (".concat(t,").")}),e===t)return cf(r.shape,e,r.dtype);var a={x:r},i={clipValueMin:e,clipValueMax:t};return U.runKernel(mD,a,i)}var gne=H({clipByValue_:mne});function yne(n){return Wr(n,0)}var bne=H({concat1d_:yne});function wne(n,e){return Wr(n,e)}var xne=H({concat2d_:wne});function kne(n,e){return Wr(n,e)}var Sne=H({concat3d_:kne});function Nne(n,e){return Wr(n,e)}var Tne=H({concat4d_:Nne});function Ene(n,e,t,r,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=P(n,"x","conv2d","float32"),u=P(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=ve(s,[1,s.shape[0],s.shape[1],s.shape[2]])),q(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")}),q(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")}),Ca("conv2d",r,o);var f=a==="NHWC"?c.shape[3]:c.shape[1];q(f===u.shape[2],function(){return"Error in conv2d: depth of input (".concat(f,") must match ")+"input depth for filter ".concat(u.shape[2],".")}),q(Ji(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),q(ws(i),function(){return"Error in conv2D: Dilated rates should be larger than 0."}),q(ws(t),function(){return"Error in conv2D: Strides should be larger than 0."});var h={x:c,filter:u},d={strides:t,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},p=U.runKernel(wD,h,d);return l?ve(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var op=H({conv2d_:Ene});function Ine(n,e,t,r,a,i,o){a===void 0&&(a="NWC"),i===void 0&&(i=1);var s=P(n,"x","conv1d"),u=P(e,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=ve(s,[1,s.shape[0],s.shape[1]])),q(c.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")}),q(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+"".concat(u.rank,".")}),Ca("conv1d",r,o),q(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match ")+"input depth for filter ".concat(u.shape[1],".")}),q(Ji(t,i),function(){return"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(t," and dilation '").concat(i,"'")}),q(ws(i),function(){return"Error in conv1D: Dilated rates should be larger than 0."}),q(ws(t),function(){return"Error in conv1D: Stride should be larger than 0."}),q(a==="NWC",function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")});var f=ve(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=ve(c,[c.shape[0],1,c.shape[1],c.shape[2]]),d=[1,t],p=[1,i],v="NHWC",m=op(h,f,d,r,v,p,o);return l?ve(m,[m.shape[2],m.shape[3]]):ve(m,[m.shape[0],m.shape[2],m.shape[3]])}var Cne=H({conv1d_:Ine});function Ane(n,e,t,r,a,i,o){i===void 0&&(i="NHWC"),q(n.length===e.rank,function(){return"Length of inShape "+"(".concat(n.length,") and rank of dy (").concat(e.rank,") must match")});var s=n,u=e,c=!1;e.rank===3&&(c=!0,u=ve(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,n[0],n[1],n[2]]),q(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")}),q(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)}),q(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(t.rank)});var l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];q(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(t.shape[2],".")}),q(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output (".concat(f,") must ")+"match output depth for filter ".concat(t.shape[3],".")}),Ca("conv2dDerInput",a,o);var h={dy:u,filter:t},d={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},p=U.runKernel(kD,h,d);return c?ve(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var mF=H({conv2DBackpropInput_:Ane});function Dne(n,e,t,r,a,i){var o=P(n,"x","conv2dTranspose"),s=P(e,"filter","conv2dTranspose");return mF(t,o,s,r,a,"NHWC",i)}var _ne=H({conv2dTranspose_:Dne});function Fne(n,e,t,r,a,i){a===void 0&&(a="NDHWC"),i===void 0&&(i=[1,1,1]);var o=P(n,"x","conv3d"),s=P(e,"filter","conv3d"),u=o,c=!1;o.rank===4&&(c=!0,u=ve(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),q(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")}),q(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+"".concat(s.rank,".")}),q(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match ")+"input depth for filter ".concat(s.shape[3],".")}),q(Ji(t,i),function(){return"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),q(a==="NDHWC",function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")}),q(ws(i),function(){return"Error in conv3D: Dilated rates should be larger than 0."}),q(ws(t),function(){return"Error in conv3D: Strides should be larger than 0."});var l={x:u,filter:s},f={strides:t,pad:r,dataFormat:a,dilations:i},h=U.runKernel(SD,l,f);return c?ve(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var Rne=H({conv3d_:Fne});function One(n,e,t,r,a){q(n.length===e.rank,function(){return"Length of inShape "+"(".concat(n.length,") and rank of dy (").concat(e.rank,") must match")});var i=n,o=e,s=!1;e.rank===4&&(s=!0,o=ve(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);var u=i[4],c=o.shape[4];q(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")}),q(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)}),q(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(t.rank)}),q(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(t.shape[3],".")}),q(c===t.shape[4],function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(t.shape[4],".")});var l={dy:o,filter:t},f={pad:a,strides:r,inputShape:i},h=U.runKernel(ND,l,f);return s?ve(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var Pne=H({conv3DBackpropInput_:One});function Mne(n,e,t,r,a){var i=P(n,"x","conv3dTranspose"),o=P(e,"filter","conv3dTranspose");return Pne(t,i,o,r,a)}var Bne=H({conv3dTranspose_:Mne});function Lne(n){var e=P(n,"x","cos","float32"),t={x:e};return U.runKernel(TD,t)}var zne=H({cos_:Lne});function $ne(n){var e=P(n,"x","cosh","float32"),t={x:e};return U.runKernel(ED,t)}var qne=H({cosh_:$ne});function Wne(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var a=P(n,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:r};return U.runKernel(ID,i,o)}var Vne=H({cumprod_:Wne});function Gne(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var a=P(n,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:r};return U.runKernel(CD,i,o)}var Une=H({cumsum_:Gne});function Hne(n,e,t,r){r===void 0&&(r=!1);var a=P(n,"x","denseBincount"),i=P(e,"weights","denseBincount");q(a.dtype==="int32",function(){return"Error in denseBincount: input "+"dtype must be int32, but got ".concat(a.dtype)}),q(a.rank<=2,function(){return"Error in denseBincount: input must be at most rank 2, but got "+"rank ".concat(a.rank,".")}),q(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),q(i.size===a.size||i.size===0,function(){return"Error in denseBincount: weights must have the same shape as x or "+"0-length, but got x shape: ".concat(a.shape,", weights shape: ")+"".concat(i.shape,".")});var o={x:a,weights:i},s={size:t,binaryOutput:r};return U.runKernel(DD,o,s)}var Kne=H({denseBincount_:Hne});function jne(n,e,t){t===void 0&&(t="NHWC");var r=P(n,"x","depthToSpace","float32"),a=t==="NHWC"?r.shape[1]:r.shape[2],i=t==="NHWC"?r.shape[2]:r.shape[3],o=t==="NHWC"?r.shape[3]:r.shape[1];q(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(e)}),q(a*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(a," and ").concat(e,`  for depthToSpace with input shape
    `).concat(r.shape)}),q(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(i," and ").concat(e,` for depthToSpace with input shape
        `).concat(r.shape)}),q(o%(e*e)===0,function(){return"Dimension size must be evenly divisible by ".concat(e*e," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape)});var s={x:r},u={blockSize:e,dataFormat:t};return U.runKernel(_D,s,u)}var Xne=H({depthToSpace_:jne});function Yne(n,e,t,r,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=P(n,"x","depthwiseConv2d","float32"),u=P(e,"filter","depthwiseConv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=ve(s,[1,s.shape[0],s.shape[1],s.shape[2]])),q(c.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(c.rank,".")}),q(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")});var f=a==="NHWC"?c.shape[3]:c.shape[1];q(f===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels "+"(".concat(f,") must match the inChannels dimension in ")+"filter ".concat(u.shape[2],".")}),Ca("depthwiseConv2d",r,o);var h={x:c,filter:u},d={strides:t,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},p=U.runKernel(FD,h,d);return l?ve(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var V0=H({depthwiseConv2d_:Yne});function Zne(n){var e=P(n,"x","diag"),t={x:e};return U.runKernel(PD,t)}var Jne=H({diag_:Zne});function Qne(n,e,t,r,a,i){a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC");var o=P(n,"x","dilation2d"),s=P(e,"filter","dilation2d");q(o.rank===3||o.rank===4,function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(o.rank,".")}),q(s.rank===3,function(){return"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(s.rank,".")}),q(i==="NHWC",function(){return"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(i)});var u=o,c=!1;o.rank===3&&(u=ve(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),q(u.shape[3]===s.shape[2],function(){return"Error in dilation2d:  input and filter must have the same depth: ".concat(u.shape[3]," vs ").concat(s.shape[2])});var l={x:u,filter:s},f={strides:t,pad:r,dilations:a},h=U.runKernel(MD,l,f);return c?ve(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var ere=H({dilation2d_:Qne});function gF(n,e){for(var t=n.length,r=[],a=0;a<t;a++){var i=t-1-a,o=n[i]||1,s=e[e.length-1-a]||1;s>1&&o===1&&r.unshift(i)}return r}function G0(n,e){for(var t=[],r=0;r<e.length;r++){var a=n[n.length-r-1],i=e.length-r-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function Bn(n,e){for(var t=[],r=Math.max(n.length,e.length),a=0;a<r;a++){var i=n[n.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)t.unshift(o);else if(o===1)t.unshift(i);else if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(n," and ").concat(e,".");throw Error(s)}else t.unshift(i)}return t}var tre={__proto__:null,getBroadcastDims:gF,getReductionAxes:G0,assertAndGetBroadcastShape:Bn};function nre(n,e){var t,r=P(n,"a","equal","string_or_numeric"),a=P(e,"b","equal","string_or_numeric");t=ke(vn(r,a),2),r=t[0],a=t[1],Bn(r.shape,a.shape);var i={a:r,b:a};return U.runKernel(qD,i)}var yF=H({equal_:nre});function rre(n,e,t){var r=P(e,"a","where"),a=P(t,"b","where"),i=P(n,"condition","where","bool"),o=Bn(Bn(i.shape,r.shape),a.shape),s=zd(i,o),u=zd(r,o),c=zd(a,o),l={condition:s,t:u,e:c};return U.runKernel(n3,l)}var Ju=H({where_:rre});function are(n){var e=P(n,"x","zerosLike"),t={x:e};return U.runKernel(R3,t)}var ca=H({zerosLike_:are});function ire(n,e){var t,r=P(n,"a","div"),a=P(e,"b","div");t=ke(vn(r,a),2),r=t[0],a=t[1];var i=Gt(r,a),o=ca(i),s=yF(a,o);return Ju(s,o,i)}var ore=H({divNoNan_:ire});function sre(n,e){var t=P(n,"t1","dot"),r=P(e,"t2","dot");q((t.rank===1||t.rank===2)&&(r.rank===1||r.rank===2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(t.rank," and ").concat(r.rank,".")});var a=t.rank===1?t.size:t.shape[1],i=r.rank===1?r.size:r.shape[0];if(q(a===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+"".concat(a," and ").concat(i,".")}),t.rank===1&&r.rank===1){var o=ve(t,[1,-1]),s=ve(r,[-1,1]),u=Ft(o,s);return ve(u,[])}else if(t.rank===1&&r.rank===2){var o=ve(t,[1,-1]),s=ve(r,[r.shape[0],r.shape[1]]),u=Ft(o,s);return ve(u,[u.size])}else if(t.rank===2&&r.rank===1){var s=ve(r,[-1,1]),u=Ft(t,s);return ve(u,[u.size])}else{var s=ve(r,[r.shape[0],r.shape[1]]),u=Ft(t,s);return u}}var ure=H({dot_:sre});function cre(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var r=e.map(function(i,o){return P(i,"tensors".concat(o),"einsum")}),a={equation:n};return U.runKernel(LD,r,a)}var lre=H({einsum_:cre});function fre(n){var e=P(n,"x","elu","float32"),t={x:e};return U.runKernel(zD,t)}var bF=H({elu_:fre});function hre(n){var e=P(n,"x","erf");q(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=Nn(e,"float32"));var t={x:e};return U.runKernel($D,t)}var dre=H({erf_:hre});function U0(n,e){for(var t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function wF(n,e,t){for(var r=n.length+e.length,a=[],i=0,o=0,s=0;s<r;s++)t.indexOf(s)===-1?a.push(n[i++]):a.push(e[o++]);return a}function pre(n,e){for(var t=[],r=n.length,a=0;a<r;a++)e.indexOf(a)===-1&&t.push(n[a]);var i=e.map(function(o){return n[o]});return[t,i]}function lf(n,e){var t=e.map(function(r){return 1});return wF(n,t,e)}function vre(n,e,t){q(U0(e,t),function(){return"".concat(n," supports only inner-most axes for now. ")+"Got axes ".concat(e," and rank-").concat(t," input.")})}function mre(n,e){if(U0(n,e))return null;for(var t=[],r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach(function(a){return t.push(a)}),t}function gre(n){return n.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function yre(n,e){for(var t=[],r=e-n;r<e;++r)t.push(r);return t}function bre(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=P(n,"x","max"),a={x:r},i={reductionIndices:e,keepDims:t};return U.runKernel(m_,a,i)}var ju=H({max_:bre});function wre(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=P(n,"x","min"),a={x:r},i={axis:e,keepDims:t};return U.runKernel(k_,a,i)}var N0=H({min_:wre});function xre(n,e){var t,r=P(n,"base","pow"),a=P(e,"exp","pow");t=ke(vn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return U.runKernel(B_,i)}var Zl=H({pow_:xre});function Rt(n,e){if((er(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&er(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],r=[];return Oo(n,t,r,e)}function kre(n){var e=P(n,"x","sqrt","float32"),t={x:e};return U.runKernel(l3,t)}var Yi=H({sqrt_:kre});function Sre(n){var e=P(n,"x","square"),t={};return U.runKernel("Square",{x:e},t)}var ni=H({square_:Sre});function Nre(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=P(n,"x","sum");r.dtype==="bool"&&(r=Nn(r,"int32"));var a={x:r},i={axis:e,keepDims:t};return U.runKernel(f3,a,i)}var Vt=H({sum_:Nre});function Tre(n,e,t,r){e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1),n=P(n,"x","norm");var a=xF(n,e,t),i=a.shape;if(r){var o=rf(t,n.shape);i=lf(a.shape,o)}return ve(a,i)}function xF(n,e,t){if(t===void 0&&(t=null),n.rank===0)return ua(n);if(n.rank!==1&&t===null)return xF(ve(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Vt(ua(n),t);if(e===1/0)return ju(ua(n),t);if(e===-1/0)return N0(ua(n),t);if(e==="euclidean"||e===2)return Yi(Vt(Zl(ua(n),Rt(2,"int32")),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}if(Array.isArray(t)&&t.length===2){if(e===1)return ju(Vt(ua(n),t[0]),t[1]-1);if(e===1/0)return ju(Vt(ua(n),t[1]),t[0]);if(e===-1/0)return N0(Vt(ua(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return Yi(Vt(ni(n),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}throw new Error("Error in norm: invalid axis: ".concat(t))}var sp=H({norm_:Tre});function Ere(n,e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),sp(n,"euclidean",e,t)}var Ire=H({euclideanNorm_:Ere});function Cre(n){var e=P(n,"x","exp"),t={x:e};return U.runKernel(WD,t)}var xs=H({exp_:Cre});function Are(n,e){e===void 0&&(e=0);var t=P(n,"x","expandDims","string_or_numeric");q(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var r={input:t},a={dim:e};return U.runKernel(VD,r,a)}var hs=H({expandDims_:Are});function Dre(n){var e=P(n,"x","expm1"),t={x:e};return U.runKernel(GD,t)}var _re=H({expm1_:Dre});function Fre(n,e){var t=P(n,"x","tile","string_or_numeric");q(t.rank===e.length,function(){return"Error in transpose: rank of input ".concat(t.rank," ")+"must match length of reps ".concat(e,".")});var r={x:t},a={reps:e};return U.runKernel(O0,r,a)}var ql=H({tile_:Fre});function Rre(n,e,t,r){r===void 0&&(r="float32"),e==null&&(e=n);for(var a=Xi([n,e],r),i=n<=e?n:e,o=0;o<i;++o)a.set(1,o,o);var s=ve(a.toTensor(),[n,e]);if(t==null)return s;if(t.length===1)return ql(hs(s,0),[t[0],1,1]);if(t.length===2)return ql(hs(hs(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return ql(hs(hs(hs(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(t.length,"D."))}var kF=H({eye_:Rre});function Ore(n){var e=P(n,"x","floor","float32"),t={x:e};return U.runKernel(jD,t)}var SF=H({floor_:Ore});function Pre(n,e,t,r){t===void 0&&(t=0),r===void 0&&(r=0);var a=P(n,"x","gather"),i=P(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:r};return U.runKernel(ZD,o,s)}var NF=H({gather_:Pre});function Mre(n,e){var t,r=P(n,"a","greater","string_or_numeric"),a=P(e,"b","greater","string_or_numeric");t=ke(vn(r,a),2),r=t[0],a=t[1],Bn(r.shape,a.shape);var i={a:r,b:a};return U.runKernel(QD,i)}var up=H({greater_:Mre});function Bre(n,e){var t,r=P(n,"a","greaterEqual","string_or_numeric"),a=P(e,"b","greaterEqual","string_or_numeric");t=ke(vn(r,a),2),r=t[0],a=t[1],Bn(r.shape,a.shape);var i={a:r,b:a};return U.runKernel(e_,i)}var TF=H({greaterEqual_:Bre});function Lre(n){var e=P(n,"input","imag"),t={input:e};return U.runKernel(n_,t)}var cp=H({imag_:Lre});function zre(n){var e=P(n,"x","isFinite"),t={x:e};return U.runKernel(r_,t)}var $re=H({isFinite_:zre});function qre(n){var e=P(n,"x","isInf"),t={x:e};return U.runKernel(a_,t)}var Wre=H({isInf_:qre});function Vre(n){var e=P(n,"x","isNaN"),t={x:e};return U.runKernel(i_,t)}var Gre=H({isNaN_:Vre});function Ure(n,e){e===void 0&&(e=.2);var t=P(n,"x","leakyRelu"),r={x:t},a={alpha:e};return U.runKernel(o_,r,a)}var EF=H({leakyRelu_:Ure});function Hre(n,e){var t,r=P(n,"a","less","string_or_numeric"),a=P(e,"b","less","string_or_numeric");t=ke(vn(r,a),2),r=t[0],a=t[1],Bn(r.shape,a.shape);var i={a:r,b:a};return U.runKernel(s_,i)}var Kre=H({less_:Hre});function jre(n,e){var t,r=P(n,"a","lessEqual","string_or_numeric"),a=P(e,"b","lessEqual","string_or_numeric");t=ke(vn(r,a),2),r=t[0],a=t[1],Bn(r.shape,a.shape);var i={a:r,b:a};return U.runKernel(u_,i)}var H0=H({lessEqual_:jre});function Xre(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");var r={start:n,stop:e,num:t};return U.runKernel(c_,{},r)}function Yre(n,e,t,r,a){e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),a===void 0&&(a=.5);var i=P(n,"x","localResponseNormalization");q(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `.concat(i.rank,".")}),q(Xu(e),function(){return"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(e,".")});var o=i,s=!1;i.rank===3&&(s=!0,o=ve(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:e,bias:t,alpha:r,beta:a},l=U.runKernel(v_,u,c);return s?ve(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var Zre=H({localResponseNormalization_:Yre});function Jre(n){var e=P(n,"x","log","float32"),t={x:e};return U.runKernel(l_,t)}var Jl=H({log_:Jre});function Qre(n){var e=P(n,"x","log1p"),t={x:e};return U.runKernel(f_,t)}var IF=H({log1p_:Qre});function eae(n){return q(Ao(n),function(){return"The f passed in grad(f) must be a function"}),function(e,t){var r=P(e,"x","tf.grad","string_or_numeric"),a=t!=null?P(t,"dy","tf.grad"):null;return U.tidy(function(){var i=U.gradients(function(){return n(r)},[r],a),o=i.value,s=i.grads;return a!=null&&mr(o.shape,a.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),lp(s),s[0]})}}function tae(n){return q(Ao(n),function(){return"The f passed in grads(f) must be a function"}),function(e,t){q(Array.isArray(e),function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"});var r=Kl(e,"args","tf.grads","string_or_numeric"),a=t!=null?P(t,"dy","tf.grads"):null;return U.tidy(function(){var i=U.gradients(function(){return n.apply(void 0,wt([],ke(r),!1))},r,a),o=i.value,s=i.grads;return a!=null&&mr(o.shape,a.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),lp(s),s})}}function nae(n){return q(Ao(n),function(){return"The f passed in valueAndGrad(f) must be a function"}),function(e,t){q(e instanceof Pn,function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"}),q(t==null||t instanceof Pn,function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"});var r=U.gradients(function(){return n(e)},[e],t),a=r.grads,i=r.value;return lp(a),{grad:a[0],value:i}}}function rae(n){return q(Ao(n),function(){return"The f passed in valueAndGrads(f) must be a function"}),function(e,t){q(Array.isArray(e)&&e.every(function(a){return a instanceof Pn}),function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"}),q(t==null||t instanceof Pn,function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"});var r=U.gradients(function(){return n.apply(void 0,wt([],ke(e),!1))},e,t);return t!=null&&mr(r.value.shape,t.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),lp(r.grads),r}}function CF(n,e){q(Ao(n),function(){return"The f passed in variableGrads(f) must be a function"}),q(e==null||Array.isArray(e)&&e.every(function(f){return f instanceof Hl}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t){e=[];for(var r in U.registeredVariables)e.push(U.registeredVariables[r])}var a=t?e.filter(function(f){return!f.trainable}):null,i=e.length;e=e.filter(function(f){return f.trainable}),q(e.length>0,function(){return"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(i," variables is ")+"trainable."});var o=!0,s=U.gradients(n,e,null,o),u=s.value,c=s.grads;q(c.some(function(f){return f!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),q(u.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(u.rank," tensor")});var l={};return e.forEach(function(f,h){c[h]!=null&&(l[f.name]=c[h])}),a?.forEach(function(f){return l[f.name]=null}),{value:u,grads:l}}function Ci(n){return U.customGrad(n)}function lp(n){var e=n.filter(function(t){return t==null}).length;if(e>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}function aae(n){var e=P(n,"x","neg"),t={x:e};return U.runKernel(C_,t)}var ji=H({neg_:aae});function iae(n){var e=P(n,"x","softplus"),t={x:e};return U.runKernel(c3,t)}var AF=H({softplus_:iae});function oae(n){var e=P(n,"x","logSigmoid"),t=Ci(function(r){var a=ji(AF(ji(r))),i=function(o){var s=Me(o,Ku(ji(r)));return s};return{value:a,gradFunc:i}});return t(e)}var sae=H({logSigmoid_:oae});function uae(n,e){var t,r=P(n,"a","sub"),a=P(e,"b","sub");t=ke(vn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return U.runKernel(T3,i)}var bt=H({sub_:uae});function cae(n,e){e===void 0&&(e=-1);var t=P(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and axis was ").concat(e));var r=Ci(function(a,i){var o=!0,s=ju(a,e,!0),u=bt(a,s),c=bt(Nn(u,"float32"),Jl(Vt(xs(u),e,o)));i([c]);var l=function(f,h){var d=ke(h,1),p=d[0],v=!0,m=xs(p);return bt(f,Me(Vt(f,e,v),m))};return{value:c,gradFunc:l}});return r(t)}var lae=H({logSoftmax_:cae});function fae(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=P(n,"x","logSumExp"),a=rf(e,r.shape),i=ju(r,a,!0),o=bt(r,i),s=xs(o),u=Vt(s,a),c=Jl(u),l=ct(ve(i,c.shape),c);if(t){var f=lf(l.shape,a);return ve(l,f)}return l}var DF=H({logSumExp_:fae});function hae(n,e){var t=P(n,"a","logicalAnd","bool"),r=P(e,"b","logicalAnd","bool");Bn(t.shape,r.shape);var a={a:t,b:r};return U.runKernel(h_,a)}var Xd=H({logicalAnd_:hae});function dae(n){var e=P(n,"x","logicalNot","bool"),t={x:e};return U.runKernel(d_,t)}var _F=H({logicalNot_:dae});function pae(n,e){var t=P(n,"a","logicalOr","bool"),r=P(e,"b","logicalOr","bool");Bn(t.shape,r.shape);var a={a:t,b:r};return U.runKernel(p_,a)}var FF=H({logicalOr_:pae});function vae(n,e){var t=P(n,"a","logicalXor","bool"),r=P(e,"b","logicalXor","bool");return Bn(t.shape,r.shape),Xd(FF(n,e),_F(Xd(n,e)))}var mae=H({logicalXor_:vae});var Pd=2147483648;function gae(n,e,t){t===void 0&&(t="left");var r=P(n,"sortedSequence","searchSorted"),a=P(e,"values","searchSorted"),i=r.shape[r.shape.length-1],o=a.shape[a.shape.length-1],s=ve(r,[-1,i]),u=ve(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(Ut(u.shape)>=Pd)throw new Error("values tensor size must less than ".concat(Pd));if(s.shape[1]>=Pd)throw new Error("trailing dim_size must less than ".concat(Pd," for int32 output type, was ").concat(s.shape[1]));var c={sortedSequence:s,values:u},l={side:t};return U.runKernel(t3,c,l)}var K0=H({searchSorted_:gae});function yae(n,e){return K0(n,e,"left")}function bae(n,e,t,r,a){var i=P(n,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=ve(i,[1,i.shape[0],i.shape[1],i.shape[2]])),q(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(s.rank,".")}),q(Ji(t,o),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")}),Ca("maxPool",r,a);var c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a},f=U.runKernel(y_,c,l);return u?ve(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var RF=H({maxPool_:bae});function wae(n,e,t,r,a,i){e===void 0&&(e=[1,1,1]),i===void 0&&(i="NDHWC");var o=P(n,"x","maxPool3d"),s=o,u=!1;o.rank===4&&(u=!0,s=ve(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),q(s.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),q(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),Ca("maxPool3d",r,a);var c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a,dataFormat:i},f=U.runKernel(b_,c,l);return u?ve(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var xae=H({maxPool3d_:wae});function kae(n,e,t,r,a){a===void 0&&(a=!1);var i=P(n,"x","maxPoolWithArgmax"),o={x:i},s={filterSize:e,strides:t,pad:r,includeBatchInIndex:a},u=U.runKernel(w_,o,s);return{result:u[0],indexes:u[1]}}var Sae=H({maxPoolWithArgmax_:kae});function Nae(n,e){var t,r=P(n,"a","maximum"),a=P(e,"b","maximum");t=ke(vn(r,a),2),r=t[0],a=t[1],r.dtype==="bool"&&(r=Nn(r,"int32"),a=Nn(a,"int32")),Bn(r.shape,a.shape);var i={a:r,b:a};return U.runKernel(g_,i)}var OF=H({maximum_:Nae});function Tae(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=P(n,"x","mean"),a={x:r},i={axis:e,keepDims:t};return U.runKernel(x_,a,i)}var Yd=H({mean_:Tae});function Qu(n,e){if(e===void 0&&(e="float32"),Vr(n),e==="complex64"){var t=Qu(n,"float32"),r=Qu(n,"float32");return _o(t,r)}var a=tp(Ut(n),e);return U.makeTensor(a,n,e)}function ms(n,e){if(e===void 0&&(e="float32"),Vr(n),e==="complex64"){var t=ms(n,"float32"),r=Qu(n,"float32");return _o(t,r)}var a=A0(Ut(n),e);return U.makeTensor(a,n,e)}function Eae(n,e,t){var r=t===void 0?{}:t,a=r.indexing,i=a===void 0?"xy":a;if(i!=="xy"&&i!=="ij")throw new TypeError("".concat(i," is not a valid third argument to meshgrid"));if(n===void 0)return[];var o=P(n,"x","meshgrid",n instanceof Pn?n.dtype:"float32");if(e===void 0)return[o];var s=P(e,"y","meshgrid",e instanceof Pn?e.dtype:"float32"),u=Ut(o.shape),c=Ut(s.shape);return i==="xy"?(o=ve(o,[1,-1]),s=ve(s,[-1,1]),[Ft(ms([c,1],o.dtype),o),Ft(s,ms([1,u],s.dtype))]):(o=ve(o,[-1,1]),s=ve(s,[1,-1]),[Ft(o,ms([1,c],o.dtype)),Ft(ms([u,1],s.dtype),s)])}function Iae(n,e){var t,r=P(n,"a","minimum"),a=P(e,"b","minimum");t=ke(vn(r,a),2),r=t[0],a=t[1],r.dtype==="bool"&&(r=Nn(r,"int32"),a=Nn(a,"int32")),Bn(r.shape,a.shape);var i={a:r,b:a};return U.runKernel(S_,i)}var PF=H({minimum_:Iae});function Cae(n,e,t){q(t==="reflect"||t==="symmetric",function(){return"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(t,".")});var r=P(n,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");q(e.length===r.rank,function(){return"Padding doesn't match input. Must be ".concat(r.rank,". ")+"Got ".concat(e.length,".")});for(var a=t==="reflect"?1:0,i=function(c){q(e[c].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),q(e[c][0]>=0&&e[c][0]<=r.shape[c]-a&&e[c][1]>=0&&e[c][1]<=r.shape[c]-a,function(){return"Padding in dimension ".concat(c," cannot be greater than or equal ")+"to ".concat(r.shape[c]-a," or less than 0 for input of ")+"shape ".concat(r.shape)})},o=0;o<r.rank;o++)i(o);var s={paddings:e,mode:t},u={x:r};return U.runKernel(N_,u,s)}var Aae=H({mirrorPad_:Cae});function Dae(n,e){var t,r=P(n,"a","mod"),a=P(e,"b","mod");t=ke(vn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return U.runKernel(T_,i)}var _ae=H({mod_:Dae});function Fae(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1),n=P(n,"x","moments");var r=rf(e,n.shape),a=Yd(n,r,t),i=a.shape;t||(i=lf(a.shape,r));var o=ni(bt(Nn(n,"float32"),ve(a,i))),s=Yd(o,r,t);return{mean:a,variance:s}}var Rae=H({moments_:Fae});function Oae(n,e,t,r){for(var a=P(e,"data","multiRNNCell"),i=Kl(t,"c","multiRNNCell"),o=Kl(r,"h","multiRNNCell"),s=a,u=[],c=0;c<n.length;c++){var l=n[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}for(var f=[],h=[],c=0;c<u.length;c+=2)f.push(u[c]),h.push(u[c+1]);return[f,h]}var Pae=H({multiRNNCell_:Oae});function Mae(n,e,t,r){r===void 0&&(r=!1);var a=P(n,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+"".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));t=t||Math.random();var s=o===1?ve(a,[1,-1]):a,u={logits:s},c={numSamples:e,seed:t,normalized:r},l=U.runKernel(E_,u,c);return o===1?ve(l,[l.size]):l}var Bae=H({multinomial_:Mae});function Lae(n,e){var t,r=P(n,"a","notEqual","string_or_numeric"),a=P(e,"b","notEqual","string_or_numeric");t=ke(vn(r,a),2),r=t[0],a=t[1],Bn(r.shape,a.shape);var i={a:r,b:a};return U.runKernel(A_,i)}var MF=H({notEqual_:Lae});function zae(n,e,t,r,a){if(t===void 0&&(t=1),r===void 0&&(r=0),a===void 0&&(a="int32"),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(e));var i=P(n,"indices","oneHot","int32"),o={indices:i},s={dtype:a,depth:e,onValue:t,offValue:r};return U.runKernel(O_,o,s)}var T0=H({oneHot_:zae});function $ae(n){var e=P(n,"x","onesLike"),t={x:e};return U.runKernel(R_,t)}var qae=H({onesLike_:$ae});function Wae(n,e){var t=P(n,"v1","outerProduct"),r=P(e,"v2","outerProduct");q(t.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+"".concat(t.rank," and ").concat(r.rank,".")});var a=ve(t,[-1,1]),i=ve(r,[1,-1]);return Ft(a,i)}var Vae=H({outerProduct_:Wae});function Gae(n,e,t){t===void 0&&(t=0);var r=P(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:r};return U.runKernel(M_,i,a)}var ff=H({pad_:Gae});function Uae(n,e,t){return t===void 0&&(t=0),q(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),ff(n,[e],t)}var Hae=H({pad1d_:Uae});function Kae(n,e,t){return t===void 0&&(t=0),q(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),ff(n,e,t)}var jae=H({pad2d_:Kae});function Xae(n,e,t){return t===void 0&&(t=0),q(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),ff(n,e,t)}var Yae=H({pad3d_:Xae});function Zae(n,e,t){return t===void 0&&(t=0),q(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),ff(n,e,t)}var Jae=H({pad4d_:Zae});function Qae(n,e,t){var r=P(n,"x","spaceToBatchND");q(r.rank>=1+e.length,function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(e.length)}),q(t.length===e.length,function(){return"paddings.shape[0] ".concat(t.length," must be equal to [blockShape] ").concat(e.length)}),q(r.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(t.toString()," must be divisible by blockShapes ").concat(e.toString())});var a={x:r},i={blockShape:e,paddings:t};return U.runKernel(h3,a,i)}var BF=H({spaceToBatchND_:Qae});function eie(n,e,t,r,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),r===0&&(r="valid");var s=P(n,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=ve(s,[1,s.shape[0],s.shape[1],s.shape[2]])),q(Ji(i,a),function(){return"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'")});var l=lF(u.shape,e,i,a,r),f=[l.dilationHeight,l.dilationWidth],h;r==="same"?h=nie([l.filterHeight,l.filterWidth],f):h=[[0,0],[0,0]];var d=f[0]===1&&f[1]===1,p=ke(tie([l.inHeight,l.inWidth],f,h),2),v=p[0],m=p[1],g=d?r:"valid",y=d?u:BF(u,f,v),b=t==="avg"?function(){return dF(y,e,i,g,o)}:function(){return RF(y,e,i,g,o)},w=b(),x=d?w:pF(w,f,m);return c?ve(x,[x.shape[1],x.shape[2],x.shape[3]]):x}function tie(n,e,t){var r=t.map(function(l){return l[0]}),a=t.map(function(l){return l[1]}),i=n.concat(r,a),o=e.map(function(l,f){return(l-i[f]%l)%l}),s=a.map(function(l,f){return l+o[f]}),u=e.map(function(l,f){return[r[f],s[f]]}),c=e.map(function(l,f){return[0,o[f]]});return[u,c]}function nie(n,e){var t=n.map(function(o,s){return o+(o-1)*(e[s]-1)}),r=t.map(function(o){return o-1}),a=r.map(function(o){return Math.floor(o/2)}),i=r.map(function(o,s){return o-a[s]});return r.map(function(o,s){return[a[s],i[s]]})}var rie=H({pool_:eie});function aie(n,e){var t=P(n,"x","prelu"),r=P(e,"alpha","prelu"),a={x:t,alpha:r};return U.runKernel(L_,a)}var LF=H({prelu_:aie});function iie(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=P(n,"x","prod");r.dtype==="bool"&&(r=Nn(r,"int32"));var a={x:r},i={axis:e,keepDims:t};return U.runKernel(z_,a,i)}var oie=H({prod_:iie});function sie(n,e,t,r){var a=n.map(function(l,f){return P(l,"tensors".concat(f),"raggedGather","int32")}),i=P(e,"paramsDenseValues","raggedGather"),o=P(t,"indices","raggedGather","int32"),s={paramsNestedSplits:a,paramsDenseValues:i,indices:o},u={outputRaggedRank:r},c=U.runKernel($_,s,u);return{outputNestedSplits:c.slice(0,c.length-1),outputDenseValues:c[c.length-1]}}var uie=H({raggedGather_:sie});function cie(n,e,t){var r=P(n,"starts","raggedRange"),a=P(e,"limits","raggedRange",r.dtype),i=P(t,"deltas","raggedRange",r.dtype),o={starts:r,limits:a,deltas:i},s=U.runKernel(q_,o);return{rtNestedSplits:s[0],rtDenseValues:s[1]}}var lie=H({raggedRange_:cie});function fie(n,e,t,r,a){var i=P(n,"shape","raggedTensorToTensor","int32"),o=P(e,"values","raggedTensorToTensor"),s=P(t,"defaultValue","raggedTensorToTensor",o.dtype),u=r.map(function(f,h){return P(f,"tensors".concat(h),"raggedTensorToTensor","int32")}),c={shape:i,values:o,defaultValue:s,rowPartitionTensors:u},l={rowPartitionTypes:a};return U.runKernel(W_,c,l)}var hie=H({raggedTensorToTensor_:fie});function die(n,e,t){Vr(n);var r=Ut(n),a=null;if(t==null||t==="float32")a=new Float32Array(r);else if(t==="int32")a=new Int32Array(r);else if(t==="bool")a=new Uint8Array(r);else throw new Error("Unknown data type ".concat(t));for(var i=0;i<r;i++)a[i]=e();return U.makeTensor(a,n,t)}var pie=H({rand_:die}),Ts=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Es(n){var e={exports:{}};return n(e,e.exports),e.exports}var vie=Es(function(n){(function(e,t,r){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.alea=o})(Ts,n,!1)}),mie=Es(function(n){(function(e,t,r){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor128=o})(Ts,n,!1)}),gie=Es(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorwow=o})(Ts,n,!1)}),yie=Es(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,d;return h=l[f],h^=h>>>7,d=h^h<<24,h=l[f+1&7],d^=h^h>>>10,h=l[f+3&7],d^=h^h>>>3,h=l[f+4&7],d^=h^h<<7,h=l[f+7&7],h=h^h<<13,d^=h^h<<9,l[f]=d,u.i=f+1&7,d};function c(l,f){var h,d=[];if(f===(f|0))d[0]=f;else for(f=""+f,h=0;h<f.length;++h)d[h&7]=d[h&7]<<15^f.charCodeAt(h)+d[h+1&7]<<13;for(;d.length<8;)d.push(0);for(h=0;h<8&&d[h]===0;++h);for(h==8&&(d[7]=-1),l.x=d,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorshift7=o})(Ts,n,!1)}),bie=Es(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,d,p;return u.w=l=l+1640531527|0,p=f[h+34&127],d=f[h=h+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,p=f[h]=p^d,u.i=h,p+(l^l>>>16)|0};function c(l,f){var h,d,p,v,m,g=[],y=128;for(f===(f|0)?(d=f,f=null):(f=f+"\0",d=0,y=Math.max(y,f.length)),p=0,v=-32;v<y;++v)f&&(d^=f.charCodeAt((v+32)%f.length)),v===0&&(m=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,v>=0&&(m=m+1640531527|0,h=g[v&127]^=d+m,p=h==0?p+1:0);for(p>=128&&(g[(f&&f.length||0)&127]=-1),p=127,v=4*128;v>0;--v)d=g[p+34&127],h=g[p=p+1&127],d^=d<<13,h^=h<<17,d^=d>>>15,h^=h>>>12,g[p]=d^h;l.w=m,l.X=g,l.i=p}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor4096=o})(Ts,n,!1)}),wie=Es(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,d=u.d,p=u.a;return f=f<<25^f>>>7^h,h=h-d|0,d=d<<24^d>>>8^p,p=p-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-d|0,u.d=d<<16^h>>>16^p,u.a=p-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.tychei=o})(Ts,n,!1)}),Is=Es(function(n){(function(e,t,r){var a=256,i=6,o=52,s="random",u=r.pow(a,i),c=r.pow(2,o),l=c*2,f=a-1,h;function d(w,x,N){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(m(x.entropy?[w,b(t)]:w??y(),3),T),C=new p(T),F=function(){for(var _=C.g(i),O=u,L=0;_<c;)_=(_+L)*a,O*=a,L=C.g(1);for(;_>=l;)_/=2,O/=2,L>>>=1;return(_+L)/O};return F.int32=function(){return C.g(4)|0},F.quick=function(){return C.g(4)/4294967296},F.double=F,g(b(C.S),t),(x.pass||N||function(_,O,L,z){return z&&(z.S&&v(z,C),_.state=function(){return v(C,{})}),L?(r[s]=_,O):_})(F,E,"global"in x?x.global:this==r,x.state)}function p(w){var x,N=w.length,T=this,E=0,C=T.i=T.j=0,F=T.S=[];for(N||(w=[N++]);E<a;)F[E]=E++;for(E=0;E<a;E++)F[E]=F[C=f&C+w[E%N]+(x=F[E])],F[C]=x;(T.g=function(_){for(var O,L=0,z=T.i,$=T.j,B=T.S;_--;)O=B[z=f&z+1],L=L*a+B[f&(B[z]=B[$=f&$+O])+(B[$]=O)];return T.i=z,T.j=$,L})(a)}function v(w,x){return x.i=w.i,x.j=w.j,x.S=w.S.slice(),x}function m(w,x){var N=[],T=typeof w,E;if(x&&T=="object")for(E in w)try{N.push(m(w[E],x-1))}catch{}return N.length?N:T=="string"?w:w+"\0"}function g(w,x){for(var N=w+"",T,E=0;E<N.length;)x[f&E]=f&(T^=x[f&E]*19)+N.charCodeAt(E++);return b(x)}function y(){try{var w;return h&&(w=h.randomBytes)?w=w(a):(w=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var x=e.navigator,N=x&&x.plugins;return[+new Date,e,N,e.screen,b(t)]}}function b(w){return String.fromCharCode.apply(0,w)}if(g(r.random(),t),n.exports){n.exports=d;try{h=Rd()}catch{}}else r["seed"+s]=d})(typeof self<"u"?self:Ts,[],Math)});Is.alea=vie;Is.xor128=mie;Is.xorwow=gie;Is.xorshift7=yie;Is.xor4096=bie;Is.tychei=wie;var j0=Is,xie=.001,zF=.1;function kie(n,e,t){return t==null&&(t=X0()),E0(n,e,function(r,a){return Y0(r,a,t)})}function X0(){return U.backend.floatPrecision()===32?xie:zF}function E0(n,e,t){var r=!0;if((er(n)||er(e))&&(r=!1),er(n)&&er(e)&&(r=!0),r){var a=n.constructor.name,i=e.constructor.name;if(a!==i)throw new Error("Arrays are of different type. Actual: ".concat(a,". ")+"Expected: ".concat(i))}if(Array.isArray(n)&&Array.isArray(e)){var o=Ii(n),s=Ii(e);if(!Ro(o,s))throw new Error("Arrays have different shapes. "+"Actual: [".concat(o,"]. Expected: [").concat(s,"]"))}var u=er(n)?n:Do(n),c=er(e)?e:Do(e);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: ".concat(u.length," vs ")+"expected: ".concat(c.length,`.
`)+"Actual:   ".concat(u,`.
`)+"Expected: ".concat(c,"."));for(var l=0;l<c.length;++l){var f=u[l],h=c[l];if(!t(f,h))throw new Error("Arrays differ: actual[".concat(l,"] = ").concat(f,", expected[").concat(l,"] = ").concat(h,`.
`)+"Actual:   ".concat(u,`.
`)+"Expected: ".concat(c,"."))}typeof expect<"u"&&expect().nothing()}function Sie(n,e){n().then(function(){return e.fail()},function(){return e()}),typeof expect<"u"&&expect().nothing()}function Nie(n,e){var t=typeof e=="string"||typeof e=="number"||typeof e=="boolean"?[e]:e;return Eo(n)||Eo(n[0])||Eo(e)||Eo(e[0])?E0(n,t,function(r,a){return r==a}):E0(n,e,function(r,a){return Y0(r,a,0)})}function Tie(n,e,t){if(t==null&&(t=X0()),!Y0(n,e,t))throw new Error("Numbers differ: actual === ".concat(n,", expected === ").concat(e));typeof expect<"u"&&expect().nothing()}function Y0(n,e,t){return!isFinite(n)&&!isFinite(e)?!0:!(isNaN(n)||isNaN(e)||Math.abs(n-e)>t)}function Eie(n,e,t){for(var r=0;r<n.length;r++)if(n[r]<e||n[r]>t)throw new Error("Value out of range:".concat(n[r]," low: ").concat(e,", high: ").concat(t))}function Iie(n,e){var t=new Float32Array(n),r=new Float32Array(e);if(t.length!==r.length)throw new Error("Expected ArrayBuffer to be of length "+"".concat(r.length,", but it was ").concat(t.length));for(var a=0;a<r.length;a++)if(t[a]!==r[a])throw new Error("Expected ArrayBuffer value at ".concat(a," to be ")+"".concat(r[a]," but got ").concat(t[a]," instead"))}function $F(n){for(var e=0;e<n.length;e++){var t=n[e];Array.isArray(t)?$F(t):n[e]=of(t)}return n}function Cie(n){var e=document.createElement("video");return"playsInline"in e&&(e.playsInline=!0),e.muted=!0,e.loop=!0,e.style.position="fixed",e.style.left="0px",e.style.top="0px",e.preload="auto",e.appendChild(n),new Promise(function(t){e.addEventListener("loadeddata",function(r){return t(e)}),e.load()})}function Aie(n){return je(this,void 0,void 0,function(){return Xe(this,function(e){switch(e.label){case 0:return[4,n.play()];case 1:return e.sent(),"requestVideoFrameCallback"in n?[4,new Promise(function(t){n.requestVideoFrameCallback(t)})]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})}var Die={__proto__:null,TEST_EPSILON_FLOAT16:zF,expectArraysClose:kie,testEpsilon:X0,expectPromiseToFail:Sie,expectArraysEqual:Nie,expectNumbersClose:Tie,expectValuesInRange:Eie,expectArrayBuffersEqual:Iie,encodeStrings:$F,createVideoElement:Cie,play:Aie};var Z0=function(){function n(e,t,r,a,i){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);var o=i||Math.random();this.random=j0.alea(o.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,r,a=!1;!a;){var i=void 0,o=void 0,s=void 0;do i=2*this.random()-1,o=2*this.random()-1,s=i*i+o*o;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*i*u,r=this.mean+this.stdDev*o*u,(!this.truncated||this.isValidTruncated(t))&&(a=!0)}return(!this.truncated||this.isValidTruncated(r))&&(this.nextVal=this.convertValue(r)),this.convertValue(t)},n.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},n.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},n}(),_ie=function(){function n(e,t,r,a){this.alpha=e,this.beta=1/t,this.dtype=r;var i=a||Math.random();this.randu=j0.alea(i.toString()),this.randn=new Z0(0,1,r,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var e,t,r,a,i,o;;){do a=this.randn.nextValue(),o=1+this.c*a;while(o<=0);if(o*=o*o,e=a*a,t=1-.331*e*e,r=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<t||Math.log(i)<r)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},n.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},n}(),Fie=function(){function n(e,t,r,a){e===void 0&&(e=0),t===void 0&&(t=1);var i=this;if(this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=r,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(e," - ").concat(t," <= 1 and dtype is not float"));this.random=j0.alea(a)}return n.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n}();function Rie(n,e,t,r,a){if(t===void 0&&(t=1),r===void 0&&(r="float32"),Vr(n),t==null&&(t=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type ".concat(r));for(var i=new _ie(e,t,r,a),o=Xi(n,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var Oie=H({randomGamma_:Rie});function Pie(n,e,t,r,a){if(e===void 0&&(e=0),t===void 0&&(t=1),Vr(n),r!=null&&r==="bool")throw new Error("Unsupported data type ".concat(r));for(var i=new Z0(e,t,r,!1,a),o=Xi(n,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var qF=H({randomNormal_:Pie});function Mie(n,e,t){if(e!=null&&e==="bool")throw new Error("Unsupported data type ".concat(e));return qF(n,0,1,e,t)}var Bie=H({randomStandardNormal_:Mie});function Lie(n,e,t,r,a){e===void 0&&(e=0),t===void 0&&(t=1),r===void 0&&(r="float32"),Vr(n);for(var i=Xi(n,r),o=new Fie(e,t,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}var WF=H({randomUniform_:Lie});function Ql(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t===0)throw new Error("Cannot have a step of zero");var a={start:n,stop:e,step:t,dtype:r};return U.runKernel(V_,{},a)}function zie(n){var e=P(n,"input","real"),t={input:e};return U.runKernel(G_,t)}var ef=H({real_:zie});function $ie(n){var e=P(n,"x","reciprocal"),t={x:e};return U.runKernel(U_,t)}var qie=H({reciprocal_:$ie});function Wie(n){var e=P(n,"x","relu"),t={x:e};return U.runKernel(H_,t)}var fp=H({relu_:Wie});function Vie(n){var e=P(n,"x","relu6"),t={x:e};return U.runKernel(Y_,t)}var VF=H({relu6_:Vie});function Gie(n,e){var t=P(n,"x","reverse"),r={x:t},a={dims:e};return U.runKernel(Z_,r,a)}var ks=H({reverse_:Gie});function Uie(n){var e=P(n,"x","reverse");return q(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(e.rank,".")}),ks(e,0)}var Hie=H({reverse1d_:Uie});function Kie(n,e){var t=P(n,"x","reverse");return q(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(t.rank,".")}),ks(t,e)}var jie=H({reverse2d_:Kie});function Xie(n,e){var t=P(n,"x","reverse");return q(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(t.rank,".")}),ks(t,e)}var Yie=H({reverse3d_:Xie});function Zie(n,e){var t=P(n,"x","reverse");return q(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(t.rank,".")}),ks(t,e)}var Jie=H({reverse4d_:Zie});function Qie(n){var e=P(n,"x","round"),t={x:e};return U.runKernel(J_,t)}var GF=H({round_:Qie});function eoe(n){var e=P(n,"x","rsqrt","float32"),t={x:e};return U.runKernel(Q_,t)}var toe=H({rsqrt_:eoe});function noe(n){var e=P(n,"x","selu"),t={x:e};return U.runKernel(r3,t)}var roe=H({selu_:noe});function aoe(n,e,t,r,a,i,o){i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC");var s=P(n,"x","separableConv2d"),u=P(e,"depthwiseFilter","separableConv2d"),c=P(t,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(s.rank===3&&(f=!0,l=ve(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");q(l.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(l.rank,".")}),q(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),q(c.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),q(c.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(c.shape[0],".")}),q(c.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(c.shape[1],".")});var h=u.shape[2],d=u.shape[3];q(c.shape[2]===h*d,function(){return"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(h*d,", ")+"but got ".concat(c.shape[2],".")});var p=V0(l,u,r,a,o,i),v=1,m=op(p,c,v,"valid",o);return f?ve(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var ioe=H({separableConv2d_:aoe});function ooe(n,e){return je(this,void 0,void 0,function(){var t,r,a,i,o,s,l,u,c,l,f;return Xe(this,function(h){switch(h.label){case 0:return t=P(n,"x","setdiff1d"),r=P(e,"y","setdiff1d"),q(t.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x (".concat(t.dtype,") and y (").concat(r.dtype,").")}),q(t.rank===1,function(){return"x should be 1D tensor, but got x (".concat(t.shape,").")}),q(r.rank===1,function(){return"y should be 1D tensor, but got y (".concat(r.shape,").")}),[4,t.data()];case 1:return a=h.sent(),[4,r.data()];case 2:for(i=h.sent(),o=new Set(i),s=0,l=0;l<a.length;l++)o.has(a[l])||s++;for(u=new Kd([s],t.dtype),c=new Kd([s],"int32"),l=0,f=0;l<a.length;l++)o.has(a[l])||(u.values[f]=a[l],c.values[f]=l,f++);return[2,[u.toTensor(),c.toTensor()]]}})})}var soe=ooe;function uoe(n){var e=P(n,"x","sign"),t={x:e};return U.runKernel(s3,t)}var coe=H({sign_:uoe});function loe(n){var e=P(n,"x","sin","float32"),t={x:e};return U.runKernel(i3,t)}var foe=H({sin_:loe});function hoe(n){var e=P(n,"x","sinh"),t={x:e};return U.runKernel(o3,t)}var doe=H({sinh_:hoe});function poe(n,e,t){var r=P(n,"x","slice1d");return q(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")}),un(r,[e],[t])}var voe=H({slice1d_:poe});function moe(n,e,t){var r=P(n,"x","slice2d");return q(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")}),un(r,e,t)}var goe=H({slice2d_:moe});function yoe(n,e,t){var r=P(n,"x","slice3d");return q(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")}),un(r,e,t)}var boe=H({slice3d_:yoe});function woe(n,e,t){var r=P(n,"x","slice4d");return q(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")}),un(r,e,t)}var xoe=H({slice4d_:woe});function koe(n,e){e===void 0&&(e=-1);var t=P(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and dim was ").concat(e));var r={logits:t},a={dim:e};return U.runKernel(p3,r,a)}var Soe=H({softmax_:koe});function Noe(n){q(n.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(n.dtype,".")});var e={input:n};return U.runKernel(UD,e)}var J0=H({fft_:Noe});function Toe(n){q(n.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(n.dtype,".")});var e={input:n};return U.runKernel(t_,e)}var Zd=H({ifft_:Toe});function Eoe(n){var e=n.shape[n.shape.length-1],t=n.size/e,r;if(e<=2){var a=ve(n,[t,e]);r=Zd(a)}else{var i=[t,2*(e-1)],o=ve(ef(n),[t,e]),s=ve(cp(n),[t,e]),u=ks(un(o,[0,1],[t,e-2]),1),c=Me(ks(un(s,[0,1],[t,e-2]),1),Rt(-1)),l=Wr([o,u],1),f=Wr([s,c],1),a=ve(_o(l,f),[i[0],i[1]]);r=Zd(a)}if(r=ef(r),n.rank===3&&n.shape[0]!==0){var h=r,d=n.shape[0];r=ve(r,[d,r.shape[0]/d,r.shape[1]]),h.dispose()}return r}var UF=H({irfft_:Eoe});function Ioe(n,e,t){t===void 0&&(t=0);var r=P(n,"x","split"),a={x:r},i={numOrSizeSplits:e,axis:t};return U.runKernel(d3,a,i)}var tf=H({split_:Ioe});function Coe(n,e){q(n.dtype==="float32",function(){return"The dtype for rfft() must be real value but got ".concat(n.dtype)});var t=n.shape[n.shape.length-1],r=n.size/t,a;if(e!=null&&e<t){var i=n.shape.map(function(g){return 0}),o=n.shape.map(function(g){return g});o[n.shape.length-1]=e,a=un(n,i,o),t=e}else if(e!=null&&e>t){var s=n.shape.map(function(g){return g});s[n.shape.length-1]=e-t,a=Wr([n,Qu(s)],n.shape.length-1),t=e}else a=n;var u=ca(a),c=ve(_o(a,u),[r,t]),l=J0(c),f=Math.floor(t/2)+1,h=ef(l),d=cp(l),p=tf(h,[f,t-f],h.shape.length-1),v=tf(d,[f,t-f],d.shape.length-1),m=a.shape.slice();return m[a.shape.length-1]=f,ve(_o(p[0],v[0]),m)}var Q0=H({rfft_:Coe});function Aoe(n,e){var t,r=P(n,"a","squaredDifference"),a=P(e,"b","squaredDifference");t=ke(vn(r,a),2),r=t[0],a=t[1],Bn(r.shape,a.shape);var i={a:r,b:a},o={};return U.runKernel(w3,i,o)}var HF=H({squaredDifference_:Aoe});function Doe(n,e){var t=P(n,"x","squeeze","string_or_numeric");return ve(t,zA(t.shape,e).newShape)}var ey=H({squeeze_:Doe});function _oe(n,e){e===void 0&&(e=0);var t=Kl(n,"tensors","stack","string_or_numeric");q(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&q(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var r=t,a={axis:e};return U.runKernel(P_,r,a)}var nf=H({stack_:_oe});function Foe(n,e){e===void 0&&(e=0);var t=P(n,"x","step"),r={x:t},a={alpha:e};return U.runKernel(O3,r,a)}var KF=H({step_:Foe});function Roe(n,e,t,r,a,i,o,s,u){a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),u===void 0&&(u=0);var c=P(n,"x","stridedSlice","string_or_numeric"),l={x:c},f={begin:e,end:t,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return U.runKernel(x3,l,f)}var Ooe=H({stridedSlice_:Roe});function Poe(n){var e=P(n,"x","tan","float32"),t={x:e};return U.runKernel(E3,t)}var Moe=H({tan_:Poe});function ti(n,e){Ss(n);var t=Ii(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");var r=null;return Oo(n,r,t,e)}function Wl(n,e,t){if(Ss(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=Ii(n,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Oo(n,e,r,t)}function jF(n,e,t){if(Ss(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=Ii(n,t);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Oo(n,e,r,t)}function Boe(n,e,t){if(Ss(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=Ii(n,t);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Oo(n,e,r,t)}function Loe(n,e,t){if(Ss(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=Ii(n,t);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Oo(n,e,r,t)}function zoe(n,e,t){if(Ss(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=Ii(n,t);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||r,Oo(n,e,r,t)}function $oe(n,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var r=P(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(e<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(e));if(e>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") ")+"but got ".concat(e));var i={x:r},o={k:e,sorted:t},s=ke(U.runKernel(C3,i,o),2),u=s[0],c=s[1];return{values:u,indices:c}}var qoe=H({topk_:$oe});function Woe(n,e,t,r,a){if(e===void 0&&(e=0),t===void 0&&(t=1),Vr(n),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");for(var i=new Z0(e,t,r,!0,a),o=Xi(n,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var Voe=H({truncatedNormal_:Woe});function Goe(n,e){e===void 0&&(e=0);var t=P(n,"x","unique","string_or_numeric");q(t.rank>0,function(){return"The input tensor must be at least 1D"});var r={x:t},a={axis:e},i=ke(U.runKernel(D3,r,a),2),o=i[0],s=i[1];return{values:o,indices:s}}var Uoe=H({unique_:Goe});function Hoe(n,e,t){var r=P(n,"x","unsortedSegmentSum"),a=P(e,"segmentIds","unsortedSegmentSum","int32");q(Xu(t),function(){return"numSegments must be of dtype int"});var i={x:r,segmentIds:a},o={numSegments:t};return U.runKernel(F3,i,o)}var Koe=H({unsortedSegmentSum_:Hoe});function joe(n,e){e===void 0&&(e=0);var t=P(n,"x","unstack","string_or_numeric");q(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = ".concat(e," is not in [-").concat(t.shape.length,", ").concat(t.shape.length,")")});var r={value:t},a={axis:e};return U.runKernel(_3,r,a)}var ty=H({unstack_:joe});function Xoe(n,e){return K0(n,e,"right")}function Yoe(n,e,t,r){return e===void 0&&(e=!0),U.makeVariable(n,e,t,r)}function XF(n,e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(r);for(var a=Xi(n,"int32"),i=Xi([t.length,n.length],"int32"),r=0;r<t.length;r++){var o=a.indexToLoc(t[r]),s=r*n.length;i.values.set(o,s)}return i.toTensor()}function Zoe(n){return je(this,void 0,void 0,function(){var e,t,r;return Xe(this,function(a){switch(a.label){case 0:return e=P(n,"condition","whereAsync","bool"),[4,e.data()];case 1:return t=a.sent(),r=XF(e.shape,t),n!==e&&e.dispose(),[2,r]}})})}var YF=Zoe;function Joe(n,e,t){return je(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f,h,d,p,v;return Xe(this,function(m){switch(m.label){case 0:for(r=P(n,"tensor","boolMask"),a=P(e,"mask","boolMask","bool"),i=t??0,o=a.rank,s=r.shape,q(o>0,function(){return"mask cannot be scalar"}),mr(s.slice(i,i+o),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+o;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+o)),f=ve(r,l),h=ve(a,[-1]),[4,YF(h)];case 1:return d=m.sent(),p=ey(d,[1]),v=NF(f,p,i),n!==r&&r.dispose(),e!==a&&a.dispose(),p.dispose(),f.dispose(),h.dispose(),d.dispose(),[2,v]}})})}var Qoe=Joe;function ese(n,e,t){var r=P(n,"x","transpose");if(e==null&&(e=r.shape.map(function(o,s){return s}).reverse()),q(r.rank===e.length,function(){return"Error in transpose: rank of input ".concat(r.rank," ")+"must match length of perm ".concat(e,".")}),e.forEach(function(o){q(o>=0&&o<r.rank,function(){return"All entries in 'perm' must be between 0 and ".concat(r.rank-1)+" but got ".concat(e)})}),r.rank<=1)return r.clone();var a={x:r},i={perm:e};return r.dtype==="complex64"?Mn(function(){var o=ef(r),s=cp(r);return o=U.runKernel(Md,{x:o},i),s=U.runKernel(Md,{x:s},i),t&&(s=ji(s)),_o(o,s)}):U.runKernel(Md,a,i)}var Jd=H({transpose_:ese});function tse(n,e,t,r,a){a===void 0&&(a=!0);var i=P(n,"v","movingAverage"),o=P(e,"x","movingAverage"),s=P(t,"decay","movingAverage");G3(i,o),q(Ro(i.shape,o.shape),function(){return"Shape mismatch in v and x"});var u=Rt(1),c=bt(u,s),l=Me(bt(o,i),c);if(a){q(r!=null,function(){return"When using zeroDebias: true, step is required."});var f=P(r,"step","movingAverage");l=Gt(l,bt(u,Zl(s,f)))}return ct(i,l)}var nse=H({movingAverage_:tse});function ny(n,e,t){var r=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(t.shape)+", indices.shape: ".concat(e.shape,", shape: ").concat(n)+", sliceDim: ".concat(r,", and batchDim: ").concat(a,".");if(t.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(n.length<r+(t.rank-a))throw new Error(i+" Output shape length < ".concat(r+(t.rank-a)));if(t.rank!==a+n.length-r)throw new Error(i+" update.rank != ".concat(a+n.length-r));for(var o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(t.shape[o],") != indices.shape[").concat(o,"] (").concat(e.shape[o],")."));for(var o=0;o<t.rank-a;++o)if(t.shape[o+a]!==n[o+r])throw new Error(i+" updates.shape[".concat(o+a,"] (").concat(t.shape[o+a],") != shape[").concat(o+a,"] (").concat(n[o+a],")"))}function ry(n,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(n.rank,"."));if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(e.dtype));if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(t));if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: ".concat(e.shape));if(n.size===0)throw new Error("Updates specified for empty output. updates shape: ".concat(n.shape))}ny(t,e,n)}function ZF(n,e,t){for(var r=e.shape.length,a=r>1?e.shape[r-1]:1,i=t.length,o=1,s=a;s<i;++s)o*=t[s];var u=a<1?1:a,c=Ut(e.shape)/u,l=wt(wt([],ke(ec(t.slice(0,a))),!1),[1],!1),f=Ut(t);return{sliceRank:a,numUpdates:c,sliceSize:o,strides:l,outputSize:f}}var rse={__proto__:null,validateUpdateShape:ny,validateInput:ry,calculateShapes:ZF};function ase(n,e,t){Vr(t);var r=P(n,"indices","scatterND","int32"),a=P(e,"updates","scatterND");ry(a,r,t);var i={indices:r,updates:a},o={shape:t};return U.runKernel(e3,i,o)}var ise=H({scatterND_:ase});function ose(n,e,t,r){if(n.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+" but the dtype was ".concat(n.dtype,"."));if(n.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+" but got shape ".concat(n.shape,"."));var a=n.rank>0?n.shape[0]:1,i=n.rank>1?n.shape[1]:1;if(t.length!==i)throw new Error("outputShape has incorrect number of elements:,"+" ".concat(t.length,", should be: ").concat(i,"."));var o=e.size;if(!(e.rank===0||e.rank===1&&o===a))throw new Error("sparseValues has incorrect shape "+"".concat(e.shape,", should be [] or [").concat(a,"]"));if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function sse(n,e,t,r){r===void 0&&(r=0),Vr(t);var a=P(n,"sparseIndices","sparseToDense","int32"),i=P(e,"sparseValues","sparseToDense","string_or_numeric"),o=P(r,"defaultValue","sparseToDense",i.dtype);ose(a,i,t,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:t};return U.runKernel(b3,s,u)}var use=H({sparseToDense_:sse});function cse(n,e){var t=P(e,"indices","gatherND","int32"),r=P(n,"x","gatherND","string_or_numeric"),a={params:r,indices:t};return U.runKernel(JD,a)}var lse=H({gatherND_:cse});function fse(n,e){if(e==null)return n.shape.slice();if(Ro(n.shape,e))return e;if(n.shape.length===e.length){for(var t=[],r=0;r<n.shape.length;r++)e[r]==null&&n.shape[r]!=null?t.push(n.shape[r]):t.push(e[r]);return t}return e}function hse(n,e,t,r){var a=P(n,"x","dropout");if(q(a.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(a.dtype," tensor instead.")}),q(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got ".concat(e,".")}),e===0)return n instanceof Pn?a.clone():a;var i=fse(a,t),o=1-e,s=Gt(SF(ct(WF(i,0,1,"float32",r),o)),o);return Me(a,s)}var dse=H({dropout_:hse});function JF(n){return Math.floor(Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))))}function ay(n,e,t){for(var r=1-n%2,a=new Float32Array(n),i=0;i<n;++i){var o=2*Math.PI*i/(n+r-1);a[i]=e-t*Math.cos(o)}return ti(a,"float32")}function pse(n,e,t){return t===void 0&&(t=1),je(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f,h,d,p,v,m,m;return Xe(this,function(g){switch(g.label){case 0:return r=P(n,"predictions","inTopK"),a=P(e,"targets","inTopK"),q(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, "+"but got ".concat(r.rank)}),q(r.rank-1===a.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+"".concat(r.rank," and targets rank ").concat(a.rank)}),mr(r.shape.slice(0,r.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],q(t>0&&t<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last "+"dimension (".concat(i,"), but got ").concat(t)}),[4,r.data()];case 1:return o=g.sent(),[4,a.data()];case 2:for(s=g.sent(),u=ke([o.length/i,i],2),c=u[0],l=u[1],f=$A("bool",c),h=0;h<c;h++){for(d=h*l,p=o.subarray(d,d+l),v=[],m=0;m<p.length;m++)v.push({value:p[m],index:m});for(v.sort(function(y,b){return b.value-y.value}),f[h]=0,m=0;m<t;m++)if(v[m].index===s[h]){f[h]=1;break}}return n!==r&&r.dispose(),e!==a&&a.dispose(),[2,Gu(f,a.shape,"bool")]}})})}var vse=pse;function mse(n,e,t,r,a,i,o){i===void 0&&(i="NHWC");var s=n;n.rank===3&&(s=ve(n,[1,n.shape[0],n.shape[1],n.shape[2]]));var u=e;u.rank===3&&(u=ve(e,[1,e.shape[0],e.shape[1],e.shape[2]])),q(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")}),q(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")}),q(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(t,".")});var c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];q(c===t[2],function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(t[2],".")}),q(l===t[3],function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(t[3],").")}),Ca("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return U.runKernel(xD,f,h)}var gse=H({conv2DBackpropFilter_:mse});function hp(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return Me(n,KF(e));throw new Error("Cannot compute gradient for fused activation ".concat(t,"."))}function dp(n,e){var t=e,r=G0(n.shape,e.shape);return r.length>0&&(t=Vt(t,r)),ve(t,n.shape)}function pp(n,e,t,r){if(e==="linear")return n;if(e==="relu")return fp(n);if(e==="elu")return bF(n);if(e==="relu6")return VF(n);if(e==="prelu")return LF(n,t);if(e==="leakyrelu")return EF(n,r);if(e==="sigmoid")return Ku(n);throw new Error("Unknown fused activation ".concat(e,"."))}var vp=function(n,e){var t=n>0;return!t||e==="linear"};function yse(n){var e,t=n.x,r=n.filter,a=n.strides,i=n.pad,o=n.dataFormat,s=o===void 0?"NHWC":o,u=n.dilations,c=u===void 0?[1,1]:u,l=n.dimRoundingMode,f=n.bias,h=n.activation,d=h===void 0?"linear":h,p=n.preluActivationWeights,v=n.leakyreluAlpha;if(d=d||"linear",vp(U.state.gradientDepth,d)===!1){q(s==="NHWC",function(){return"Error in fused conv2d: got dataFormat of ".concat(s," but ")+"only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."});var m=op(t,r,a,i,s,c,l);return f!=null&&(m=ct(m,f)),pp(m,d,p,v)}var g=P(t,"x","conv2d","float32"),y=P(r,"filter","conv2d","float32"),b=g,w=!1;g.rank===3&&(w=!0,b=ve(g,[1,g.shape[0],g.shape[1],g.shape[2]])),q(b.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(b.rank,".")}),q(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(y.rank,".")}),Ca("fused conv2d",i,l);var x=s==="NHWC"?b.shape[3]:b.shape[1];q(y.shape[2]===x,function(){return"Error in conv2d: depth of input (".concat(x,") must match ")+"input depth for filter ".concat(y.shape[2],".")}),q(Ji(a,c),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(a," and dilations '").concat(c,"'")});var N=uf(b.shape,y.shape,a,c,i,l),T;f!=null&&(T=P(f,"bias","fused conv2d"),e=ke(vn(T,g),1),T=e[0],s==="NHWC"?Bn(N.outShape,T.shape):(q(T.shape.length<=1,function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+"rank-".concat(T.shape.length,".")}),q(T.shape.length===0||T.shape[0]===N.outChannels||T.shape[0]===1,function(){return"Error in fused conv2d: bias shape (".concat(T.shape,") is not ")+"compatible with the number of output channels "+"(".concat(N.outChannels,")")})));var E;if(p!=null){var C=p.shape;if(q(C.length<=1||C.length===3,function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+"rank-".concat(C.length,".")}),C.length===1)q(C[0]===1||C[0]===N.outChannels,function(){return"Error in fused conv2d: PReLU activation weights "+"(".concat(C,") is not compatible with the number of output ")+"channels (".concat(N.outChannels,").")});else if(C.length===3)try{Bn(C,N.outShape)}catch{var F="Error in fused conv2d: PReLU activation weights (".concat(C,") ")+"is not compatible with the output shape of the conv2d "+"(".concat(N.outShape,").");throw Error(F)}E=P(p,"prelu weights","fused conv2d")}var _=function(B,W){q(s==="NHWC",function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(s," but only NHWC is currently supported.")});var X=ke(W,4),Z=X[0],V=X[1],j=X[2],re=X[3],ne=hp(B,j,d);q(Yl(c),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(c,"'")});var oe=mF(V.shape,ne,Z,a,i),le=gse(V,ne,Z.shape,a,i),pe=[oe,le];if(re!=null){var xe=dp(re,ne);pe.push(xe)}return pe},O={x:b,filter:y,bias:T,preluActivationWeights:E},L={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:d,leakyreluAlpha:v};if(f==null){var z=Ci(function(B,W,X){var Z=U.runKernel(s0,O,L);return X([W,B,Z]),w&&(Z=ve(Z,[Z.shape[1],Z.shape[2],Z.shape[3]])),{value:Z,gradFunc:_}});return z(b,y)}else{var $=Ci(function(B,W,X,Z){var V=U.runKernel(s0,O,L);return Z([W,B,V,X]),w&&(V=ve(V,[V.shape[1],V.shape[2],V.shape[3]])),{value:V,gradFunc:_}});return $(b,y,T)}}var bse=H({fusedConv2d_:yse});function wse(n,e,t,r,a,i,o){i===void 0&&(i=[1,1]);var s=n;n.rank===3&&(s=ve(n,[1,n.shape[0],n.shape[1],n.shape[2]]));var u=e;u.rank===3&&(u=ve(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={x:s,dy:u},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return U.runKernel(RD,c,l)}var xse=H({depthwiseConv2dNativeBackpropFilter_:wse});function kse(n,e,t,r,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=ve(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={dy:s,filter:t},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:n},f=U.runKernel(OD,c,l);return u?ve(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var Sse=H({depthwiseConv2dNativeBackpropInput_:kse});function Nse(n){var e,t=n.x,r=n.filter,a=n.strides,i=n.pad,o=n.dataFormat,s=o===void 0?"NHWC":o,u=n.dilations,c=u===void 0?[1,1]:u,l=n.dimRoundingMode,f=n.bias,h=n.activation,d=h===void 0?"linear":h,p=n.preluActivationWeights,v=n.leakyreluAlpha;if(vp(U.state.gradientDepth,d)===!1){var m=V0(t,r,a,i,s,c,l);return f!=null&&(m=ct(m,f)),pp(m,d,p,v)}var g=P(t,"x","depthwiseConv2d","float32"),y=P(r,"filter","depthwiseConv2d","float32"),b=g,w=!1;g.rank===3&&(w=!0,b=ve(g,[1,g.shape[0],g.shape[1],g.shape[2]])),q(b.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(b.rank,".")}),q(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+"but got rank ".concat(y.rank,".")}),q(b.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels "+"(".concat(b.shape[3],") must match the inChannels dimension in ")+"filter ".concat(y.shape[2],".")}),c==null&&(c=[1,1]),q(Ji(a,c),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+"be 1. Got strides ".concat(a," and dilations '").concat(c,"'")}),Ca("fused depthwiseConv2d",i,l);var x=uf(b.shape,y.shape,a,c,i,l,!0),N;f!=null&&(N=P(f,"bias","fused conv2d"),e=ke(vn(N,g),1),N=e[0],Bn(x.outShape,N.shape));var T;p!=null&&(T=P(p,"prelu weights","fused depthwiseConv2d"));var E=function(L,z){q(Yl(c),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(c,"'")});var $=ke(z,4),B=$[0],W=$[1],X=$[2],Z=$[3],V=hp(L,X,d),j=Sse(W.shape,V,B,a,i,c,l),re=xse(W,V,B.shape,a,i,c,l);if(Z!=null){var ne=dp(N,V);return[j,re,ne]}return[j,re]},C={x:b,filter:y,bias:N,preluActivationWeights:T},F={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:d,leakyreluAlpha:v};if(f==null){var _=Ci(function(L,z,$){var B=U.runKernel(u0,C,F);return $([z,L,B]),w&&(B=ve(B,[B.shape[1],B.shape[2],B.shape[3]])),{value:B,gradFunc:E}});return _(b,y)}else{var O=Ci(function(L,z,$,B){var W=U.runKernel(u0,C,F);return B([z,L,W,$]),w&&(W=ve(W,[W.shape[1],W.shape[2],W.shape[3]])),{value:W,gradFunc:E}});return O(b,y,N)}}var Tse=H({fusedDepthwiseConv2d_:Nse});function Ese(n){var e,t,r=n.a,a=n.b,i=n.transposeA,o=i===void 0?!1:i,s=n.transposeB,u=s===void 0?!1:s,c=n.bias,l=n.activation,f=l===void 0?"linear":l,h=n.preluActivationWeights,d=n.leakyreluAlpha,p=d===void 0?.2:d;if(vp(U.state.gradientDepth,f)===!1){var v=Ft(r,a,o,u);return c!=null&&(v=ct(v,c)),pp(v,f,h,p)}var m=P(r,"a","fused matMul"),g=P(a,"b","fused matMul");e=ke(vn(m,g),2),m=e[0],g=e[1];var y=o?m.shape[m.rank-2]:m.shape[m.rank-1],b=u?g.shape[g.rank-1]:g.shape[g.rank-2],w=o?m.shape[m.rank-1]:m.shape[m.rank-2],x=u?g.shape[g.rank-2]:g.shape[g.rank-1],N=m.shape.slice(0,-2),T=g.shape.slice(0,-2),E=Ut(N),C=Ut(T);q(y===b,function(){return"Error in fused matMul: inner shapes (".concat(y,") and (")+"".concat(b,") of Tensors with shapes ").concat(m.shape," and ")+"".concat(g.shape," and transposeA=").concat(o)+" and transposeB=".concat(u," must match.")});var F=Bn(m.shape.slice(0,-2),g.shape.slice(0,-2)),_=F.concat([w,x]),O=o?ve(m,[E,y,w]):ve(m,[E,w,y]),L=u?ve(g,[C,x,b]):ve(g,[C,b,x]),z;c!=null&&(z=P(c,"bias","fused matMul"),t=ke(vn(z,m),1),z=t[0],Bn(_,z.shape));var $;h!=null&&($=P(h,"prelu weights","fused matMul"));var B=function(j,re){var ne=ke(re,4),oe=ne[0],le=ne[1],pe=ne[2],xe=ne[3],he=hp(ve(j,pe.shape),pe,f),ye,we;if(!o&&!u?(ye=Ft(he,le,!1,!0),we=Ft(oe,he,!0,!1)):!o&&u?(ye=Ft(he,le,!1,!1),we=Ft(he,oe,!0,!1)):o&&!u?(ye=Ft(le,he,!1,!0),we=Ft(oe,he,!1,!1)):(ye=Ft(le,he,!0,!0),we=Ft(he,oe,!0,!0)),c!=null){var Ae=dp(xe,he);return[ye,we,Ae]}else return[ye,we]},W={a:O,b:L,bias:z,preluActivationWeights:$},X={transposeA:o,transposeB:u,activation:f,leakyreluAlpha:p};if(c==null){var Z=Ci(function(j,re,ne){var oe=U.runKernel(o0,W,X);return ne([j,re,oe]),{value:ve(oe,_),gradFunc:B}});return Z(O,L)}else{var V=Ci(function(j,re,ne,oe){var le=U.runKernel(o0,W,X);return oe([j,re,le,ne]),{value:ve(le,_),gradFunc:B}});return V(O,L,z)}}var Ise=H({fusedMatMul_:Ese});var Cse={__proto__:null,conv2d:bse,depthwiseConv2d:Tse,matMul:Ise};function Ase(n){return ay(n,.54,.46)}var Dse=H({hammingWindow_:Ase});function _se(n){return ay(n,.5,.5)}var QF=H({hannWindow_:_se});function Fse(n,e,t,r,a){r===void 0&&(r=!1),a===void 0&&(a=0);for(var i=0,o=[];i+e<=n.size;)o.push(un(n,i,e)),i+=t;if(r)for(;i<n.size;){var s=i+e-n.size,u=Wr([un(n,i,e-s),cf([s],a)]);o.push(u),i+=t}return o.length===0?Wl([],[0,e]):ve(Wr(o),[o.length,e])}var eR=H({frame_:Fse});function Rse(n,e,t,r,a){a===void 0&&(a=QF),r==null&&(r=JF(e));var i=eR(n,e,t),o=Me(i,a(e));return Q0(o,r)}var Ose=H({stft_:Rse});function Pse(n,e,t,r,a,i){a===void 0&&(a="bilinear"),i===void 0&&(i=0);var o=P(n,"image","cropAndResize"),s=P(e,"boxes","cropAndResize","float32"),u=P(t,"boxInd","cropAndResize","int32"),c=s.shape[0];q(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),q(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] ")+"but had shape ".concat(s.shape,".")}),q(u.rank===1&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] ")+"but had shape ".concat(s.shape,".")}),q(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(r.length,".")}),q(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was ".concat(r)}),q(a==="bilinear"||a==="nearest",function(){return"method must be bilinear or nearest, but was ".concat(a)});var l={image:o,boxes:s,boxInd:u},f={method:a,extrapolationValue:i,cropSize:r},h=U.runKernel(AD,l,f);return h}var Mse=H({cropAndResize_:Pse});function Bse(n){var e=P(n,"image","flipLeftRight","float32");q(e.rank===4,function(){return"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(e.rank,".")});var t={image:e},r=U.runKernel(KD,t,{});return r}var Lse=H({flipLeftRight_:Bse});function zse(n){var e=P(n,"image","grayscaleToRGB"),t=e.rank-1,r=e.shape[t];q(e.rank>=2,function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(e.rank,".")}),q(r===1,function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(r,".")});var a=new Array(e.rank);return a.fill(1,0,t),a[t]=3,ql(e,a)}var $se=H({grayscaleToRGB_:zse});function qse(n,e,t,r){t===void 0&&(t=0),r===void 0&&(r=.5);var a=P(n,"image","rotateWithOffset","float32");q(a.rank===4,function(){return"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,".")});var i={image:a},o={radians:e,fillValue:t,center:r},s=U.runKernel(P3,i,o);return s}var Wse=H({rotateWithOffset_:qse});function tc(n,e,t,r,a,i){r==null&&(r=.5),a==null&&(a=Number.NEGATIVE_INFINITY),i==null&&(i=0);var o=n.shape[0];return t=Math.min(t,o),q(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")}),q(n.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '".concat(n.rank,"'")}),q(n.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(n.shape[1])}),q(e.rank===1,function(){return"scores must be a 1D tensor"}),q(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(e.shape[0])}),q(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")}),{maxOutputSize:t,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}function Vse(n,e,t,r,a){r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var i=P(n,"boxes","nonMaxSuppression","float32"),o=P(e,"scores","nonMaxSuppression","float32"),s=tc(i,o,t,r,a);t=s.maxOutputSize,r=s.iouThreshold,a=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:r,scoreThreshold:a};return U.runKernel(D_,{boxes:i,scores:o},u)}var Gse=H({nonMaxSuppression_:Vse});function Use(n,e,t){var r=Hse(n,e,t),a=r<0?-(r+1):r;n.splice(a,0,e)}function Hse(n,e,t){return jse(n,e,t||Kse)}function Kse(n,e){return n>e?1:n<e?-1:0}function jse(n,e,t){for(var r=0,a=n.length,i=0,o=!1;r<a;){i=r+(a-r>>>1);var s=t(e,n[i]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}function tR(n,e,t,r,a){return iy(n,e,t,r,a,0)}function nR(n,e,t,r,a,i){return iy(n,e,t,r,a,0,!1,i,!0)}function rR(n,e,t,r,a,i){return iy(n,e,t,r,a,i,!0)}function iy(n,e,t,r,a,i,o,s,u){o===void 0&&(o=!1),s===void 0&&(s=!1),u===void 0&&(u=!1);for(var c=[],l=0;l<e.length;l++)e[l]>a&&c.push({score:e[l],boxIndex:l,suppressBeginIndex:0});c.sort(DA);for(var f=i>0?-.5/i:0,h=[],d=[];h.length<t&&c.length>0;){var p=c.pop(),v=p.score,m=p.boxIndex,g=p.suppressBeginIndex;if(v<a)break;for(var y=!1,b=h.length-1;b>=g;--b){var w=Xse(n,m,h[b]);if(w>=r){y=!0;break}if(p.score=p.score*Yse(r,f,w),p.score<=a)break}p.suppressBeginIndex=h.length,y||(p.score===v?(h.push(m),d.push(p.score)):p.score>a&&Use(c,p,DA))}var x=h.length,N=t-x;s&&N>0&&(h.push.apply(h,wt([],ke(new Array(N).fill(0)),!1)),d.push.apply(d,wt([],ke(new Array(N).fill(0)),!1)));var T={selectedIndices:h};return o&&(T.selectedScores=d),u&&(T.validOutputs=x),T}function Xse(n,e,t){var r=n.subarray(e*4,e*4+4),a=n.subarray(t*4,t*4+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),f=Math.max(a[0],a[2]),h=Math.max(a[1],a[3]),d=(s-i)*(u-o),p=(f-c)*(h-l);if(d<=0||p<=0)return 0;var v=Math.max(i,c),m=Math.max(o,l),g=Math.min(s,f),y=Math.min(u,h),b=Math.max(g-v,0)*Math.max(y-m,0);return b/(d+p-b)}function Yse(n,e,t){var r=Math.exp(e*t*t);return t<=n?r:0}function DA(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}function Zse(n,e,t,r,a){return r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),je(this,void 0,void 0,function(){var i,o,s,u,c,l,f;return Xe(this,function(h){switch(h.label){case 0:return i=P(n,"boxes","nonMaxSuppressionAsync"),o=P(e,"scores","nonMaxSuppressionAsync"),s=tc(i,o,t,r,a),t=s.maxOutputSize,r=s.iouThreshold,a=s.scoreThreshold,[4,Promise.all([i.data(),o.data()])];case 1:return u=h.sent(),c=u[0],l=u[1],f=tR(c,l,t,r,a).selectedIndices,i!==n&&i.dispose(),o!==e&&o.dispose(),[2,ti(f,"int32")]}})})}var Jse=Zse;function Qse(n,e,t,r,a,i){r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var o=P(n,"boxes","nonMaxSuppression"),s=P(e,"scores","nonMaxSuppression"),u=tc(o,s,t,r,a,i);t=u.maxOutputSize,r=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma;var c={boxes:o,scores:s},l={maxOutputSize:t,iouThreshold:r,scoreThreshold:a,softNmsSigma:i},f=U.runKernel(F_,c,l);return{selectedIndices:f[0],selectedScores:f[1]}}var eue=H({nonMaxSuppressionWithScore_:Qse});function tue(n,e,t,r,a,i){return r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),je(this,void 0,void 0,function(){var o,s,u,c,l,f,h,d,p;return Xe(this,function(v){switch(v.label){case 0:return o=P(n,"boxes","nonMaxSuppressionAsync"),s=P(e,"scores","nonMaxSuppressionAsync"),u=tc(o,s,t,r,a,i),t=u.maxOutputSize,r=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return c=v.sent(),l=c[0],f=c[1],h=rR(l,f,t,r,a,i),d=h.selectedIndices,p=h.selectedScores,o!==n&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:ti(d,"int32"),selectedScores:ti(p)}]}})})}var nue=tue;function rue(n,e,t,r,a,i){r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1);var o=P(n,"boxes","nonMaxSuppression"),s=P(e,"scores","nonMaxSuppression"),u=tc(o,s,t,r,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,h={boxes:o,scores:s},d={maxOutputSize:c,iouThreshold:l,scoreThreshold:f,padToMaxOutputSize:i},p=U.runKernel(__,h,d);return{selectedIndices:p[0],validOutputs:p[1]}}var aue=H({nonMaxSuppressionPadded_:rue});function iue(n,e,t,r,a,i){return r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1),je(this,void 0,void 0,function(){var o,s,u,c,l,f,h,d,p,v,m,g;return Xe(this,function(y){switch(y.label){case 0:return o=P(n,"boxes","nonMaxSuppressionAsync"),s=P(e,"scores","nonMaxSuppressionAsync"),u=tc(o,s,t,r,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,[4,Promise.all([o.data(),s.data()])];case 1:return h=ke.apply(void 0,[y.sent(),2]),d=h[0],p=h[1],v=nR(d,p,c,l,f,i),m=v.selectedIndices,g=v.validOutputs,o!==n&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:ti(m,"int32"),validOutputs:Rt(g,"int32")}]}})})}var oue=iue;function sue(n,e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!1);var a=P(n,"images","resizeBilinear");q(a.rank===3||a.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),q(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(e,".")}),q(r===!1||t===!1,function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=ve(a,[1,a.shape[0],a.shape[1],a.shape[2]])),ke(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:r,size:e},c=U.runKernel(X_,s,u);return o?ve(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var uue=H({resizeBilinear_:sue});function cue(n,e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!1);var a=P(n,"images","resizeNearestNeighbor");q(a.rank===3||a.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),q(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(e,".")}),q(a.dtype==="float32"||a.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"}),q(r===!1||t===!1,function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=ve(a,[1,a.shape[0],a.shape[1],a.shape[2]])),ke(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:r,size:e},c=U.runKernel(j_,s,u);return o?ve(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var lue=H({resizeNearestNeighbor_:cue});function fue(n,e,t,r){var a;e===void 0&&(e="binary"),t===void 0&&(t=!1),r===void 0&&(r=.5);var i=P(n,"image","threshold"),o=.2989,s=.587,u=.114,c=i.shape[0]*i.shape[1],l=Me(ti([r]),255),f,h,d,p;if(q(i.rank===3,function(){return"Error in threshold: image must be rank 3,"+"but got rank ".concat(i.rank,".")}),q(i.shape[2]===3||i.shape[2]===1,function(){return"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(i.shape[2],".")}),q(i.dtype==="int32"||i.dtype==="float32",function(){return"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(i.dtype,".")}),q(e==="otsu"||e==="binary",function(){return"Method must be binary or otsu, but was ".concat(e)}),i.shape[2]===3){a=ke(tf(i,[1,1,1],-1),3),f=a[0],h=a[1],d=a[2];var v=Me(f,o),m=Me(h,s),g=Me(d,u);p=ct(ct(v,m),g)}else p=n;if(e==="otsu"){var y=vF(Nn(GF(p),"int32"),Gu([]),256);l=hue(y,c)}var b=t?H0(p,l):up(p,l),w=Nn(Me(b,255),"int32");return w}function hue(n,e){for(var t=ti([-1]),r=ti([0]),a=ti([0]),i,o,s,u,c,l,f=0;f<n.size-1;f++){i=un(n,0,f+1),o=un(n,f+1),c=Gt(Vt(i),e),l=Gt(Vt(o),e);var h=Vt(Me(i,Ql(0,i.size)));s=Gt(h,Vt(i));var d=cf(o.shape,i.size),p=ct(Ql(0,o.size),d),v=Me(o,p);u=Gt(Vt(v),Vt(o));var m=bt(s,u),g=bt(s,u),y=Me(c,l);a=Me(Me(y,m),g);var b=up(a,r);r=Ju(b,a,r),t=Ju(b,ti([f]),t)}return t}var due=H({threshold_:fue});function pue(n,e,t,r,a,i){t===void 0&&(t="nearest"),r===void 0&&(r="constant"),a===void 0&&(a=0);var o=P(n,"image","transform","float32"),s=P(e,"transforms","transform","float32");q(o.rank===4,function(){return"Error in transform: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),q(s.rank===2&&(s.shape[0]===o.shape[0]||s.shape[0]===1)&&s.shape[1]===8,function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"}),q(i==null||i.length===2,function(){return"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(i,".")});var u={image:o,transforms:s},c={interpolation:t,fillMode:r,fillValue:a,outputShape:i};return U.runKernel(A3,u,c)}var vue=H({transform_:pue});function mue(n,e,t){q(e%1===0,function(){return"bandPart(): numLower must be an integer, got ".concat(e,".")}),q(t%1===0,function(){return"bandPart(): numUpper must be an integer, got ".concat(t,".")});var r=P(n,"a","bandPart");q(r.rank>=2,function(){return"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")});var a=r.shape,i=ke(r.shape.slice(-2),2),o=i[0],s=i[1];if(!(e<=o))throw new Error("bandPart(): numLower (".concat(e,")")+" must not be greater than the number of rows (".concat(o,")."));if(!(t<=s))throw new Error("bandPart(): numUpper (".concat(t,")")+" must not be greater than the number of columns (".concat(s,")."));e<0&&(e=o),t<0&&(t=s);var u=ve(Ql(0,o,1,"int32"),[-1,1]),c=Ql(0,s,1,"int32"),l=bt(u,c),f=Xd(H0(l,Rt(+e,"int32")),TF(l,Rt(-t,"int32"))),h=Qu([o,s],r.dtype);return ve(nf(ty(ve(r,[-1,o,s])).map(function(d){return Ju(f,d,h)})),a)}var gue=H({bandPart_:mue});function yue(n){var e;if(Array.isArray(n)){e=!1,q(n!=null&&n.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=n[0].shape[0],r=function(u){q(n[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(n[u].shape[0]," vs. ").concat(t,")")})},a=1;a<n.length;++a)r(a)}else e=!0,n=tf(n,n.shape[0],0).map(function(u){return ey(u,[0])});q(n.length<=n[0].shape[0],function(){return"Gram-Schmidt: Number of vectors (".concat(n.length,") exceeds ")+"number of dimensions (".concat(n[0].shape[0],").")});for(var i=[],o=n,s=function(u){i.push(U.tidy(function(){var c=o[u];if(u>0)for(var l=0;l<u;++l){var f=Me(Vt(Me(i[l],c)),i[l]);c=bt(c,f)}return Gt(c,sp(c,"euclidean"))}))},a=0;a<n.length;++a)s(a);return e?nf(i,0):i}var bue=H({gramSchmidt_:yue});function wue(n,e){if(e===void 0&&(e=!1),q(n.rank>=2,function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(n.rank)}),n.rank===2)return _A(n,e);var t=n.shape.slice(0,n.shape.length-2).reduce(function(u,c){return u*c}),r=ty(ve(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),a=[],i=[];r.forEach(function(u){var c=ke(_A(u,e),2),l=c[0],f=c[1];a.push(l),i.push(f)});var o=ve(nf(a,0),n.shape),s=ve(nf(i,0),n.shape);return[o,s]}function _A(n,e){return e===void 0&&(e=!1),U.tidy(function(){q(n.shape.length===2,function(){return"qr2d() requires a 2D Tensor, but got a ".concat(n.shape.length,"D Tensor.")});for(var t=n.shape[0],r=n.shape[1],a=kF(t),i=gs(n),o=Wl([[1]],[1,1]),s=gs(o),u=t>=r?r:t,c=function(f){var h,d=i,p=s,v=a;h=ke(U.tidy(function(){var m=un(i,[f,f],[t-f,1]),g=sp(m),y=un(i,[f,f],[1,1]),b=Ju(up(y,0),Wl([[-1]]),Wl([[1]])),w=bt(y,Me(b,g)),x=Gt(m,w);x.shape[0]===1?s=gs(o):s=Wr([o,un(x,[1,0],[x.shape[0]-1,x.shape[1]])],0);var N=ji(Gt(Ft(b,w),g)),T=un(i,[f,0],[t-f,r]),E=Me(N,s),C=Jd(s);if(f===0)i=bt(T,Ft(E,Ft(C,T)));else{var F=bt(T,Ft(E,Ft(C,T)));i=Wr([un(i,[0,0],[f,r]),F],0)}var _=Jd(E),O=un(a,[0,f],[t,a.shape[1]-f]);if(f===0)a=bt(O,Ft(Ft(O,s),_));else{var L=bt(O,Ft(Ft(O,s),_));a=Wr([un(a,[0,0],[t,f]),L],1)}return[s,i,a]}),3),s=h[0],i=h[1],a=h[2],Er([d,p,v])},l=0;l<u;++l)c(l);return!e&&t>r&&(a=un(a,[0,0],[t,r]),i=un(i,[0,0],[r,r])),[a,i]})}var xue=H({qr_:wue});A.Reduction=void 0;(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(A.Reduction||(A.Reduction={}));function kue(n,e,t){t===void 0&&(t=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var r=P(n,"losses","computeWeightedLoss"),a=null;e!=null&&(a=P(e,"weights","computeWeightedLoss"));var i=a==null?r:Me(r,a);if(t===A.Reduction.NONE)return i;if(t===A.Reduction.SUM)return Vt(i);if(t===A.Reduction.MEAN){if(a==null)return Yd(i);var o=r.size/a.size,s=Gt(Vt(i),Vt(a));return o>1?Gt(s,Rt(o)):s}if(t===A.Reduction.SUM_BY_NONZERO_WEIGHTS){if(a==null)return Gt(Vt(i),Rt(r.size));var u=Me(a,ms(r.shape)),c=Nn(Vt(MF(u,Rt(0))),"float32");return Gt(Vt(i),c)}throw Error("Unknown reduction: ".concat(t))}var Qi=H({computeWeightedLoss_:kue});function Sue(n,e,t,r){r===void 0&&(r=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=P(n,"labels","absoluteDifference"),i=P(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=P(t,"weights","absoluteDifference")),mr(a.shape,i.shape,"Error in absoluteDifference: ");var s=ua(bt(a,i));return Qi(s,o,r)}var Nue=H({absoluteDifference_:Sue});function Tue(n,e,t,r,a){a===void 0&&(a=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=P(n,"labels","cosineDistance"),o=P(e,"predictions","cosineDistance"),s=null;r!=null&&(s=P(r,"weights","cosineDistance")),mr(i.shape,o.shape,"Error in cosineDistance: ");var u=Rt(1),c=bt(u,Vt(Me(i,o),t,!0));return Qi(c,s,a)}var Eue=H({cosineDistance_:Tue});function Iue(n,e,t,r){r===void 0&&(r=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=P(n,"labels","hingeLoss"),i=P(e,"predictions","hingeLoss"),o=null;t!=null&&(o=P(t,"weights","hingeLoss")),mr(a.shape,i.shape,"Error in hingeLoss: ");var s=Rt(1);a=bt(Me(Rt(2),a),s);var u=fp(bt(s,Me(a,i)));return Qi(u,o,r)}var Cue=H({hingeLoss_:Iue});function Aue(n,e,t,r,a){r===void 0&&(r=1),a===void 0&&(a=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=P(n,"labels","huberLoss"),o=P(e,"predictions","huberLoss"),s=null;t!=null&&(s=P(t,"weights","huberLoss")),mr(i.shape,o.shape,"Error in huberLoss: ");var u=Rt(r),c=ua(bt(o,i)),l=PF(c,u),f=bt(c,l),h=ct(Me(Rt(.5),ni(l)),Me(u,f));return Qi(h,s,a)}var Due=H({huberLoss_:Aue});function _ue(n,e,t,r,a){r===void 0&&(r=1e-7),a===void 0&&(a=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=P(n,"labels","logLoss"),o=P(e,"predictions","logLoss"),s=null;t!=null&&(s=P(t,"weights","logLoss")),mr(i.shape,o.shape,"Error in logLoss: ");var u=Rt(1),c=Rt(r),l=ji(Me(i,Jl(ct(o,c)))),f=Me(bt(u,i),Jl(ct(bt(u,o),c))),h=bt(l,f);return Qi(h,s,a)}var Fue=H({logLoss_:_ue});function Rue(n,e,t,r){r===void 0&&(r=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=P(n,"labels","meanSquaredError"),i=P(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=P(t,"weights","meanSquaredError")),mr(a.shape,i.shape,"Error in meanSquaredError: ");var s=HF(a,i);return Qi(s,o,r)}var Oue=H({meanSquaredError_:Rue});function Pue(n,e){var t=P(n,"labels","sigmoidCrossEntropyWithLogits"),r=P(e,"logits","sigmoidCrossEntropyWithLogits");mr(t.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=fp(r),i=Me(r,t),o=IF(xs(ji(ua(r))));return ct(bt(a,i),o)}function Mue(n,e,t,r,a){r===void 0&&(r=0),a===void 0&&(a=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=P(n,"multiClassLabels","sigmoidCrossEntropy"),o=P(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=P(t,"weights","sigmoidCrossEntropy")),mr(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Rt(r),c=Rt(1),l=Rt(.5);i=ct(Me(i,bt(c,u)),Me(l,u))}var f=Pue(i,o);return Qi(f,s,a)}var Bue=H({sigmoidCrossEntropy_:Mue});function Lue(n,e,t){if(t===void 0&&(t=-1),t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(e.rank," ")+"and dim was ".concat(t));var r=Ci(function(a,i,o){var s=!0,u=DF(i,[t],s),c=bt(Nn(i,"float32"),u);o([a,c]);var l=ji(Me(c,a)),f=Vt(l,[t]),h=function(d,p){var v=ke(p,2),m=v[0],g=v[1],y=lf(d.shape,[t]);return[Me(ve(d,y),bt(Nn(m,"float32"),xs(g))),Me(ve(d,y),bt(xs(g),Nn(m,"float32")))]};return{value:f,gradFunc:h}});return r(n,e)}function zue(n,e,t,r,a){r===void 0&&(r=0),a===void 0&&(a=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=P(n,"onehotLabels","softmaxCrossEntropy"),o=P(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=P(t,"weights","softmaxCrossEntropy")),mr(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Rt(r),c=Rt(1),l=Rt(i.shape[1]);i=ct(Me(i,bt(c,u)),Gt(u,l))}var f=Lue(i,o);return Qi(f,s,a)}var $ue=H({softmaxCrossEntropy_:zue});function que(n,e,t,r){var a=P(n,"indices","sparseFillEmptyRows","int32"),i=P(e,"values","sparseFillEmptyRows"),o=P(t,"denseShape","sparseFillEmptyRows","int32"),s=P(r,"defaultValue","sparseFillEmptyRows",i.dtype);if(a.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        `.concat(a.shape));if(i.rank!==1)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(o.rank!==1)throw new Error("Dense shape should be Tensor1D but received shape ".concat(o.shape));if(s.rank!==0)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));var u={indices:a,values:i,denseShape:o,defaultValue:s},c=U.runKernel(v3,u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}var Wue=H({sparseFillEmptyRows_:que});function Vue(n,e,t){var r=P(n,"inputIndices","sparseReshape","int32"),a=P(e,"inputShape","sparseReshape","int32"),i=P(t,"newShape","sparseReshape","int32");if(r.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        `.concat(r.shape));if(a.rank!==1)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(i.rank!==1)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));var o={inputIndices:r,inputShape:a,newShape:i},s=U.runKernel(m3,o);return{outputIndices:s[0],outputShape:s[1]}}var Gue=H({sparseReshape_:Vue});function Uue(n,e,t){var r=P(n,"data","sparseSegmentMean"),a=P(e,"indices","sparseSegmentMean","int32"),i=P(t,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          `.concat(i.shape));var o={data:r,indices:a,segmentIds:i};return U.runKernel(g3,o)}var Hue=H({sparseSegmentMean_:Uue});function Kue(n,e,t){var r=P(n,"data","sparseSegmentSum"),a=P(e,"indices","sparseSegmentSum","int32"),i=P(t,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         `.concat(i.shape));var o={data:r,indices:a,segmentIds:i};return U.runKernel(y3,o)}var jue=H({sparseSegmentSum_:Kue});function Xue(n,e,t,r,a,i,o,s){var u=P(n,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error("Data must be a vector, saw: ".concat(u.shape));var c=P(e,"dataSplits","stringNGrams");if(c.dtype!=="int32")throw new Error("Data splits must be of datatype int32");var l={separator:t,nGramWidths:r,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},f={data:u,dataSplits:c},h=U.runKernel(k3,f,l);return{nGrams:h[0],nGramsSplits:h[1]}}var Yue=H({stringNGrams_:Xue});function Zue(n,e,t){t===void 0&&(t=!0);var r=P(n,"input","stringSplit","string"),a=P(e,"delimiter","stringSplit","string");if(r.rank!==1)throw new Error("Input should be Tensor1D but received shape ".concat(r.shape));if(a.rank!==0)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));var i={skipEmpty:t},o={input:r,delimiter:a},s=U.runKernel(S3,o,i);return{indices:s[0],values:s[1],shape:s[2]}}var Jue=H({stringSplit_:Zue});function Que(n,e){var t=P(n,"input","stringToHashBucketFast","string"),r={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");var a={input:t};return U.runKernel(N3,a,r)}var ece=H({stringToHashBucketFast_:Que});var tce={fft:J0,ifft:Zd,rfft:Q0,irfft:UF},nce={hammingWindow:Dse,hannWindow:QF,frame:eR,stft:Ose},rce={flipLeftRight:Lse,grayscaleToRGB:$se,resizeNearestNeighbor:lue,resizeBilinear:uue,rotateWithOffset:Wse,cropAndResize:Mse,nonMaxSuppression:Gse,nonMaxSuppressionAsync:Jse,nonMaxSuppressionWithScore:eue,nonMaxSuppressionWithScoreAsync:nue,nonMaxSuppressionPadded:aue,nonMaxSuppressionPaddedAsync:oue,threshold:due,transform:vue},ace={bandPart:gue,gramSchmidt:bue,qr:xue},ice={absoluteDifference:Nue,computeWeightedLoss:Qi,cosineDistance:Eue,hingeLoss:Cue,huberLoss:Due,logLoss:Fue,meanSquaredError:Oue,sigmoidCrossEntropy:Bue,softmaxCrossEntropy:$ue},oce={sparseFillEmptyRows:Wue,sparseReshape:Gue,sparseSegmentMean:Hue,sparseSegmentSum:jue},sce={stringNGrams:Yue,stringSplit:Jue,stringToHashBucketFast:ece};var aR=function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(e,t){return new e(t)},n}(),iR=function(){function n(){this.classNameMap={}}return n.getMap=function(){return n.instance==null&&(n.instance=new n),n.instance},n.register=function(e){n.getMap().classNameMap[e.className]=[e,e.fromConfig]},n}();function oR(n){q(n.className!=null,function(){return"Class being registered does not have the static className property defined."}),q(typeof n.className=="string",function(){return"className is required to be a string, but got type "+typeof n.className}),q(n.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),iR.register(n)}var uce={__proto__:null,Serializable:aR,SerializationMap:iR,registerClass:oR},Po=function(n){Zi(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.minimize=function(t,r,a){r===void 0&&(r=!1);var i=this.computeGradients(t,a),o=i.value,s=i.grads;if(a!=null){var u=a.map(function(c){return{name:c.name,tensor:s[c.name]}});this.applyGradients(u)}else this.applyGradients(s);return Er(s),r?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!1,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,r){return CF(t,r)},e.prototype.dispose=function(){this.iterations_!=null&&Er(this.iterations_)},e.prototype.saveIterations=function(){return je(this,void 0,void 0,function(){return Xe(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Rt(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){return Xe(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){return Xe(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()))})})},e.prototype.extractIterations=function(t){return je(this,void 0,void 0,function(){var r;return Xe(this,function(a){switch(a.label){case 0:return r=this,[4,t[0].tensor.data()];case 1:return r.iterations_=a.sent()[0],[2,t.slice(1)]}})})},e}(aR);Object.defineProperty(Po,Symbol.hasInstance,{value:function(n){return n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null}});var oy=function(n){Zi(e,n);function e(t,r,a){a===void 0&&(a=null);var i=n.call(this)||this;return i.learningRate=t,i.rho=r,i.epsilon=a,i.accumulatedGrads=[],i.accumulatedUpdates=[],a==null&&(i.epsilon=U.backend.epsilon()),i}return Object.defineProperty(e,"className",{get:function(){return"Adadelta"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=U.registeredVariables[i],u=!1;r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:"".concat(i,"/accum_grad"),variable:Mn(function(){return ca(s).variable(u)})}),r.accumulatedUpdates[o]==null&&(r.accumulatedUpdates[o]={originalName:"".concat(i,"/accum_var"),variable:Mn(function(){return ca(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=r.accumulatedGrads[o].variable,f=r.accumulatedUpdates[o].variable;Mn(function(){var h=ct(Me(l,r.rho),Me(ni(c),1-r.rho)),d=Me(Gt(Yi(ct(f,r.epsilon)),Yi(ct(l,r.epsilon))),c),p=ct(Me(f,r.rho),Me(ni(d),1-r.rho));l.assign(h),f.assign(p);var v=ct(Me(d,-r.learningRate),s);s.assign(v)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Er(this.accumulatedGrads.map(function(t){return t.variable})),Er(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){var t;return Xe(this,function(r){switch(r.label){case 0:return t=wt(wt([],ke(this.accumulatedGrads),!1),ke(this.accumulatedUpdates),!1),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){var r,a;return Xe(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=t.length/2,a=!1,this.accumulatedGrads=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedUpdates=t.slice(r,r*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},e}(Po),sy=function(n){Zi(e,n);function e(t,r){r===void 0&&(r=.1);var a=n.call(this)||this;return a.learningRate=t,a.initialAccumulatorValue=r,a.accumulatedGrads=[],a}return Object.defineProperty(e,"className",{get:function(){return"Adagrad"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=U.registeredVariables[i];if(r.accumulatedGrads[o]==null){var u=!1;r.accumulatedGrads[o]={originalName:"".concat(i,"/accumulator"),variable:Mn(function(){return cf(s.shape,r.initialAccumulatorValue).variable(u)})}}var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=r.accumulatedGrads[o].variable;Mn(function(){var f=ct(l,ni(c));l.assign(f);var h=ct(Me(Gt(c,Yi(ct(f,U.backend.epsilon()))),-r.learningRate),s);s.assign(h)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&Er(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){return Xe(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){var r;return Xe(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),r=!1,this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(r)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},e}(Po),uy=function(n){Zi(e,n);function e(t,r,a,i){i===void 0&&(i=null);var o=n.call(this)||this;return o.learningRate=t,o.beta1=r,o.beta2=a,o.epsilon=i,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],Mn(function(){o.accBeta1=Rt(r).variable(),o.accBeta2=Rt(a).variable()}),i==null&&(o.epsilon=U.backend.epsilon()),o}return Object.defineProperty(e,"className",{get:function(){return"Adam"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Mn(function(){var i=bt(1,r.accBeta1),o=bt(1,r.accBeta2);a.forEach(function(s,u){var c=U.registeredVariables[s],l=!1;r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:Mn(function(){return ca(c).variable(l)})}),r.accumulatedSecondMoment[u]==null&&(r.accumulatedSecondMoment[u]={originalName:"".concat(s,"/v"),variable:Mn(function(){return ca(c).variable(l)})});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=r.accumulatedFirstMoment[u].variable,d=r.accumulatedSecondMoment[u].variable,p=ct(Me(h,r.beta1),Me(f,1-r.beta1)),v=ct(Me(d,r.beta2),Me(ni(f),1-r.beta2)),m=Gt(p,i),g=Gt(v,o);h.assign(p),d.assign(v);var y=ct(Me(Gt(m,ct(Yi(g),r.epsilon)),-r.learningRate),c);c.assign(y)}}),r.accBeta1.assign(Me(r.accBeta1,r.beta1)),r.accBeta2.assign(Me(r.accBeta2,r.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Er(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&Er(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){var t;return Xe(this,function(r){switch(r.label){case 0:return t=wt(wt([],ke(this.accumulatedFirstMoment),!1),ke(this.accumulatedSecondMoment),!1),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){var r,a,i=this;return Xe(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),Mn(function(){i.accBeta1.assign(Zl(i.beta1,i.iterations_+1)),i.accBeta2.assign(Zl(i.beta2,i.iterations_+1))}),r=t.length/2,a=!1,this.accumulatedFirstMoment=t.slice(0,r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),this.accumulatedSecondMoment=t.slice(r,r*2).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},e}(Po),cy=function(n){Zi(e,n);function e(t,r,a,i,o){i===void 0&&(i=null),o===void 0&&(o=0);var s=n.call(this)||this;return s.learningRate=t,s.beta1=r,s.beta2=a,s.epsilon=i,s.decay=o,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],Mn(function(){s.iteration=Rt(0).variable(),s.accBeta1=Rt(r).variable()}),i==null&&(s.epsilon=U.backend.epsilon()),s}return Object.defineProperty(e,"className",{get:function(){return"Adamax"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Mn(function(){var i=bt(1,r.accBeta1),o=Gt(-r.learningRate,ct(Me(r.iteration,r.decay),1));a.forEach(function(s,u){var c=U.registeredVariables[s],l=!1;r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:ca(c).variable(l)}),r.accumulatedWeightedInfNorm[u]==null&&(r.accumulatedWeightedInfNorm[u]={originalName:"".concat(s,"/v"),variable:ca(c).variable(l)});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=r.accumulatedFirstMoment[u].variable,d=r.accumulatedWeightedInfNorm[u].variable,p=ct(Me(h,r.beta1),Me(f,1-r.beta1)),v=Me(d,r.beta2),m=ua(f),g=OF(v,m);h.assign(p),d.assign(g);var y=ct(Me(Gt(o,i),Gt(p,ct(g,r.epsilon))),c);c.assign(y)}}),r.iteration.assign(ct(r.iteration,1)),r.accBeta1.assign(Me(r.accBeta1,r.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Er(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&Er(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){return Xe(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){return Xe(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e}(Po),mp=function(n){Zi(e,n);function e(t){var r=n.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return Object.defineProperty(e,"className",{get:function(){return"SGD"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=U.registeredVariables[i];Mn(function(){var c=ct(Me(r.c,s),u);u.assign(c)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=uF(Rt(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){return Xe(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){return Xe(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:if(t=r.sent(),t.length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,r){return new t(r.learningRate)},e}(Po),ly=function(n){Zi(e,n);function e(t,r,a){a===void 0&&(a=!1);var i=n.call(this,t)||this;return i.learningRate=t,i.momentum=r,i.useNesterov=a,i.accumulations=[],i.m=Rt(i.momentum),i}return Object.defineProperty(e,"className",{get:function(){return"Momentum"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=U.registeredVariables[i];if(r.accumulations[o]==null){var u=!1;r.accumulations[o]={originalName:"".concat(i,"/momentum"),variable:Mn(function(){return ca(s).variable(u)})}}var c=r.accumulations[o].variable,l=Array.isArray(t)?t[o].tensor:t[i];l!=null&&Mn(function(){var f,h=ct(Me(r.m,c),l);r.useNesterov?f=ct(Me(r.c,ct(l,Me(h,r.m))),s):f=ct(Me(r.c,h),s),c.assign(h),s.assign(f)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Er(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){return Xe(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){var r;return Xe(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),r=!1,this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(r)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},e}(mp),fy=function(n){Zi(e,n);function e(t,r,a,i,o){r===void 0&&(r=.9),a===void 0&&(a=0),i===void 0&&(i=null),o===void 0&&(o=!1);var s=n.call(this)||this;if(s.learningRate=t,s.decay=r,s.momentum=a,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=o,i==null&&(s.epsilon=U.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return Object.defineProperty(e,"className",{get:function(){return"RMSProp"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=U.registeredVariables[i],u=!1;r.accumulatedMeanSquares[o]==null&&(r.accumulatedMeanSquares[o]={originalName:"".concat(i,"/rms"),variable:Mn(function(){return ca(s).variable(u)})}),r.accumulatedMoments[o]==null&&(r.accumulatedMoments[o]={originalName:"".concat(i,"/momentum"),variable:Mn(function(){return ca(s).variable(u)})}),r.accumulatedMeanGrads[o]==null&&r.centered&&(r.accumulatedMeanGrads[o]={originalName:"".concat(i,"/mg"),variable:Mn(function(){return ca(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=r.accumulatedMeanSquares[o].variable,f=r.accumulatedMoments[o].variable;Mn(function(){var h=ct(Me(l,r.decay),Me(ni(c),1-r.decay));if(r.centered){var d=r.accumulatedMeanGrads[o].variable,p=ct(Me(d,r.decay),Me(c,1-r.decay)),v=Gt(Me(c,r.learningRate),Yi(bt(h,ct(ni(p),r.epsilon)))),m=ct(Me(f,r.momentum),v);l.assign(h),d.assign(p),f.assign(m);var g=bt(s,m);s.assign(g)}else{var y=ct(Me(l,r.decay),Me(ni(c),1-r.decay)),m=ct(Me(f,r.momentum),Gt(Me(c,r.learningRate),Yi(ct(y,r.epsilon))));l.assign(y),f.assign(m);var g=bt(s,m);s.assign(g)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Er(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&Er(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&Er(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){var t;return Xe(this,function(r){switch(r.label){case 0:return t=wt(wt([],ke(this.accumulatedMeanSquares),!1),ke(this.accumulatedMoments),!1),this.centered&&t.push.apply(t,wt([],ke(this.accumulatedMeanGrads),!1)),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){var r,a;return Xe(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=this.centered?t.length/3:t.length/2,a=!1,this.accumulatedMeanSquares=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedMoments=t.slice(r,r*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(r*2,r*3).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e}(Po),cce=[oy,sy,uy,cy,ly,fy,mp];function lce(){var n,e;try{for(var t=cr(cce),r=t.next();!r.done;r=t.next()){var a=r.value;oR(a)}}catch(i){n={error:i}}finally{try{r&&!r.done&&(e=t.return)&&e.call(t)}finally{if(n)throw n.error}}}var fce="model",hce=".json",dce=".weights.bin";function FA(n){return new Promise(function(e){return setTimeout(e)}).then(n)}var Qd=function(){function n(e){if(!vt().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),(e==null||e.length===0)&&(e=fce),this.modelJsonFileName=e+hce,this.weightDataFileName=e+dce}return n.prototype.save=function(e){return je(this,void 0,void 0,function(){var t,r,a,i,o,s;return Xe(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],a=Z3(e,r),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),o=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor,o.download=this.modelJsonFileName,o.href=i,[4,FA(function(){return o.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),e.weightData==null?[3,4]:(s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor,s.download=this.weightDataFileName,s.href=t,[4,FA(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:sf(e)}]}})})},n}();Qd.URL_SCHEME="downloads://";var pce=function(){function n(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, "+"but received ".concat(e));this.jsonFile=e[0],this.weightsFiles=e.slice(1)}return n.prototype.load=function(){return je(this,void 0,void 0,function(){var e=this;return Xe(this,function(t){return[2,new Promise(function(r,a){var i=new FileReader;i.onload=function(o){var s=JSON.parse(o.target.result),u=s.modelTopology;if(u==null){a(new Error("modelTopology field is missing from file ".concat(e.jsonFile.name)));return}var c=s.weightsManifest;if(c==null){a(new Error("weightManifest field is missing from file ".concat(e.jsonFile.name)));return}if(e.weightsFiles.length===0){r({modelTopology:u});return}var l=q0(s,function(f){return e.loadWeights(f)});r(l)},i.onerror=function(o){return a("Failed to read model topology and weights manifest JSON "+"from file '".concat(e.jsonFile.name,"'. BrowserFiles supports loading ")+"Keras-style tf.Model artifacts only.")},i.readAsText(e.jsonFile)})]})})},n.prototype.loadWeights=function(e){var t,r,a=this,i=[],o=[];try{for(var s=cr(e),u=s.next();!u.done;u=s.next()){var c=u.value;i.push.apply(i,wt([],ke(c.weights),!1)),o.push.apply(o,wt([],ke(c.paths),!1))}}catch(h){t={error:h}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}var l=this.checkManifestAndWeightFiles(e),f=o.map(function(h){return a.loadWeightsFile(h,l[h])});return Promise.all(f).then(function(h){return[i,$0(h)]})},n.prototype.loadWeightsFile=function(e,t){return new Promise(function(r,a){var i=new FileReader;i.onload=function(o){var s=o.target.result;r(s)},i.onerror=function(o){return a("Failed to weights data from file of path '".concat(e,"'."))},i.readAsArrayBuffer(t)})},n.prototype.checkManifestAndWeightFiles=function(e){var t,r,a=this,i=[],o=this.weightsFiles.map(function(f){return AA(f.name)}),s={};try{for(var u=cr(e),c=u.next();!c.done;c=u.next()){var l=c.value;l.paths.forEach(function(f){var h=AA(f);if(i.indexOf(h)!==-1)throw new Error("Duplicate file basename found in weights manifest: "+"'".concat(h,"'"));if(i.push(h),o.indexOf(h)===-1)throw new Error("Weight file with basename '".concat(h,"' is not provided."));s[f]=a.weightsFiles[o.indexOf(h)]})}}catch(f){t={error:f}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}if(i.length!==this.weightsFiles.length)throw new Error("Mismatch in the number of files in weights manifest "+"(".concat(i.length,") and the number of weight files provided ")+"(".concat(this.weightsFiles.length,")."));return s},n}(),vce=function(n){return vt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Qd.URL_SCHEME)?mce(n.slice(Qd.URL_SCHEME.length)):null};fa.registerSaveRouter(vce);function mce(n){return n===void 0&&(n="model"),new Qd(n)}function gce(n){return new pce(n)}function RA(n,e,t,r){o(n),t=t??0,r=r??1,s(t,r);var a=0,i=function(u){return u.then(function(c){var l=t+ ++a/n.length*(r-t);return e(l),c}),u};function o(u){q(u!=null&&Array.isArray(u)&&u.length>0,function(){return"promises must be a none empty array"})}function s(u,c){q(u>=0&&u<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(u)}),q(c>=0&&c<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(c)}),q(c>=u,function(){return"startFraction must be no more than endFraction, but "+"got startFraction ".concat(u," and endFraction ")+"".concat(c)})}return Promise.all(n.map(i))}function sR(n,e){return je(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f,h;return Xe(this,function(d){switch(d.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?vt().platform.fetch:e.fetchFunc,r=n.map(function(p){return t(p,e.requestInit,{isBinary:!0})}),a=0,i=.5,e.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return s=d.sent(),[3,4];case 2:return[4,RA(r,e.onProgress,a,i)];case 3:s=d.sent(),d.label=4;case 4:return o=s,u=o.map(function(p){return p.arrayBuffer()}),c=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(u)];case 5:return h=d.sent(),[3,8];case 6:return[4,RA(u,e.onProgress,c,l)];case 7:h=d.sent(),d.label=8;case 8:return f=h,[2,f]}})})}function yce(n,e,t,r){return e===void 0&&(e=""),je(this,void 0,void 0,function(){var a,i;return Xe(this,function(o){return a=function(s){return sR(s,{requestInit:r})},i=uR(a),[2,i(n,e,t)]})})}function uR(n){var e=this;return function(t,r,a){return r===void 0&&(r=""),je(e,void 0,void 0,function(){var i,o,s,u,c,l,f,h,d,p;return Xe(this,function(v){switch(v.label){case 0:if(i=t.map(function(){return!1}),o={},s=a!=null?a.map(function(){return!1}):[],u=[],t.forEach(function(m,g){var y=0;m.weights.forEach(function(b){var w="quantization"in b?b.quantization.dtype:b.dtype,x=y0[w]*Ut(b.shape),N=function(){i[g]=!0,o[g]==null&&(o[g]=[]),o[g].push({manifestEntry:b,groupOffset:y,sizeBytes:x})};a!=null?a.forEach(function(T,E){T===b.name&&(N(),s[E]=!0)}):N(),u.push(b.name),y+=x})}),!s.every(function(m){return m}))throw c=a.filter(function(m,g){return!s[g]}),new Error("Could not find weights in manifest with names: "+"".concat(c.join(", "),`. 
`)+"Manifest JSON has weights with names: "+"".concat(u.join(", "),"."));return l=i.reduce(function(m,g,y){return g&&m.push(y),m},[]),f=[],l.forEach(function(m){t[m].paths.forEach(function(g){var y=r+(r.endsWith("/")?"":"/")+g;f.push(y)})}),[4,n(f)];case 1:return h=v.sent(),d={},p=0,l.forEach(function(m){for(var g=t[m].paths.length,y=0,b=0;b<g;b++)y+=h[p+b].byteLength;for(var w=new ArrayBuffer(y),x=new Uint8Array(w),N=0,T=0;T<g;T++){var E=new Uint8Array(h[p+T]);x.set(E,N),N+=E.byteLength}var C=o[m];C.forEach(function(F){var _=w.slice(F.groupOffset,F.groupOffset+F.sizeBytes),O=Y3(_,[F.manifestEntry]);for(var L in O)d[L]=O[L]}),p+=g}),[2,d]}})})}}var bce="application/octet-stream",wce="application/json",hy=function(){function n(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(q(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=vt().platform.fetch,q(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&q(e.length===2,function(){return"URL paths for http must have a length of 2, "+"(actual length is ".concat(e.length,").")}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return n.prototype.save=function(e){return je(this,void 0,void 0,function(){var t,r,a,i;return Xe(this,function(o){switch(o.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit),t.body=new FormData,r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=Z3(e,r),t.body.append("model.json",new Blob([JSON.stringify(a)],{type:wce}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:bce}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if(i=o.sent(),i.ok)return[2,{modelArtifactsInfo:sf(e),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(i.status,"."))}})})},n.prototype.load=function(){return je(this,void 0,void 0,function(){var e,t,r,a,i,o=this;return Xe(this,function(s){switch(s.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(e=s.sent(),!e.ok)throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(e.status,". Please verify this URL points to ")+"the model JSON of the model to load.");s.label=2;case 2:return s.trys.push([2,4,,5]),[4,e.json()];case 3:return t=s.sent(),[3,5];case 4:throw s.sent(),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(a=t.modelTopology,i=t.weightsManifest,a==null&&i==null)throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");return[2,q0(t,function(u){return o.loadWeights(u)})]}})})},n.prototype.loadWeights=function(e){return je(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f,h,d,p,v,m,g,y,b,w,x,N,T,E;return Xe(this,function(C){switch(C.label){case 0:t=Array.isArray(this.path)?this.path[1]:this.path,r=ke(xce(t),2),a=r[0],i=r[1],o=this.weightPathPrefix||a,s=Q3(e),u=[],c=[];try{for(l=cr(e),f=l.next();!f.done;f=l.next()){h=f.value;try{for(d=(T=void 0,cr(h.paths)),p=d.next();!p.done;p=d.next())v=p.value,this.weightUrlConverter!=null?c.push(this.weightUrlConverter(v)):u.push(o+v+i)}catch(F){T={error:F}}finally{try{p&&!p.done&&(E=d.return)&&E.call(d)}finally{if(T)throw T.error}}}}catch(F){x={error:F}}finally{try{f&&!f.done&&(N=l.return)&&N.call(l)}finally{if(x)throw x.error}}return this.weightUrlConverter?(g=(m=u.push).apply,y=[u],b=[[]],[4,Promise.all(c)]):[3,2];case 1:g.apply(m,y.concat([wt.apply(void 0,b.concat([ke.apply(void 0,[C.sent()]),!1]))])),C.label=2;case 2:return[4,sR(u,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 3:return w=C.sent(),[2,[s,$0(w)]]}})})},n}();hy.URL_SCHEME_REGEX=/^https?:\/\//;function xce(n){var e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),r=n.substring(0,e),a=t>e?n.substring(t):"";return[r+"/",a]}function I0(n){return n.match(hy.URL_SCHEME_REGEX)!=null}var cR=function(n,e){if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;var t=!0;return Array.isArray(n)?t=n.every(function(r){return I0(r)}):t=I0(n),t?dy(n,e):null};fa.registerSaveRouter(cR);fa.registerLoadRouter(cR);function dy(n,e){return new hy(n,e)}function kce(n,e){return dy(n,e)}var n0=function(){function n(e){this.modelArtifacts=e}return n.prototype.load=function(){return this.modelArtifacts},n}(),lR=function(){function n(e){this.saveHandler=e}return n.prototype.save=function(e){return this.saveHandler(e)},n}(),Sce=function(){function n(e){e.load&&(this.load=function(){return Promise.resolve(e.load())}),e.save&&(this.save=function(t){return Promise.resolve(e.save(t))})}return n}();function Nce(n,e,t,r){var a=arguments;return new Sce(fR.apply(void 0,wt([],ke(a),!1)))}function fR(n,e,t,r){if(arguments.length===1){var a=n.modelTopology!=null||n.weightSpecs!=null;return a?new n0(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new n0({modelTopology:n}))}else return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new n0({modelTopology:n,weightSpecs:e,weightData:t,trainingConfig:r})}function Tce(n){return new lR(n)}function Ece(n){return new lR(n)}var Ice={__proto__:null,browserFiles:gce,browserHTTPRequest:kce,concatenateArrayBuffers:$0,decodeWeights:Y3,encodeWeights:hee,fromMemory:Nce,fromMemorySync:fR,getLoadHandlers:See,getModelArtifactsForJSON:q0,getModelArtifactsForJSONSync:J3,getModelArtifactsInfoForJSON:sf,getSaveHandlers:kee,getWeightSpecs:Q3,http:dy,isHTTPScheme:I0,loadWeights:yce,registerLoadRouter:xee,registerSaveRouter:wee,weightsLoaderFactory:uR,withSaveHandler:Tce,withSaveHandlerSync:Ece,copyModel:Bee,listModels:Pee,moveModel:Lee,removeModel:Mee};function Cce(n,e,t){var r=P(n,"labels","confusionMatrix"),a=P(e,"predictions","confusionMatrix");q(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, "+"but got ".concat(t)}),q(r.rank===1,function(){return"Expected the rank of labels to be 1, but got ".concat(r.rank)}),q(a.rank===1,function(){return"Expected the rank of predictions to be 1, "+"but got ".concat(a.rank)}),q(r.shape[0]===a.shape[0],function(){return"Mismatch in the number of examples: "+"".concat(r.shape[0]," vs. ").concat(a.shape[0],". ")+"Labels and predictions should have the same number of elements."}),q(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+"".concat(t)});var i=T0(Nn(r,"int32"),t),o=T0(Nn(a,"int32"),t),s=Jd(i),u=Ft(s,o);return Nn(u,"int32")}var Ace=H({confusionMatrix_:Cce});var Dce={__proto__:null,confusionMatrix:Ace},ls;function hR(n,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,r=!1,a=!1,i=!1,o=!1,s=!1;if(n.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)a=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)i=!0;else if(n.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&n instanceof ImageBitmap)s=!0;else throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, "+"but was ".concat(n.constructor.name));var u=Vd(i0,U.backendName);if(u!=null){var c={pixels:n},l={numChannels:e};return U.runKernel(i0,c,l)}var f=ke(a?[n.videoWidth,n.videoHeight]:[n.width,n.height],2),h=f[0],d=f[1],p;if(o)p=n.getContext("2d").getImageData(0,0,h,d).data;else if(r||t)p=n.data;else if(i||a||s){if(ls==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")ls=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else ls=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});ls.canvas.width=h,ls.canvas.height=d,ls.drawImage(n,0,0,h,d),p=ls.getImageData(0,0,h,d).data}var v;if(e===4)v=new Int32Array(p);else{var m=h*d;v=new Int32Array(m*e);for(var g=0;g<m;g++)for(var y=0;y<e;++y)v[g*e+y]=p[g*4+y]}var b=[d,h,e];return jF(v,b,"int32")}function _ce(n){return n!=null&&n.data instanceof Uint8Array}function Fce(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function Rce(n){return n!=null&&n.width!==0&&n.height!==0}function Oce(n){return Fce()&&!(n instanceof ImageBitmap)&&Rce(n)&&!_ce(n)}function Pce(n,e){return e===void 0&&(e=3),je(this,void 0,void 0,function(){var t,r;return Xe(this,function(a){switch(a.label){case 0:if(t=null,!(vt().getBool("WRAP_TO_IMAGEBITMAP")&&Oce(n)))return[3,5];r=void 0,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,createImageBitmap(n,{premultiplyAlpha:"none"})];case 2:return r=a.sent(),[3,4];case 3:return a.sent(),r=null,[3,4];case 4:return r!=null&&r.width===n.width&&r.height===n.height?t=r:t=n,[3,6];case 5:t=n,a.label=6;case 6:return[2,hR(t,e)]}})})}function Mce(n,e){return je(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f,h,d,p,v,m,g;return Xe(this,function(y){switch(y.label){case 0:if(t=P(n,"img","toPixels"),n instanceof Pn||(r=t,t=Nn(r,"int32"),r.dispose()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank ".concat(t.rank,"."));if(a=ke(t.shape.slice(0,2),2),i=a[0],o=a[1],s=t.rank===2?1:t.shape[2],s>4||s===2)throw new Error("toPixels only supports depth of size "+"1, 3 or 4 but got ".concat(s));if(t.dtype!=="float32"&&t.dtype!=="int32")throw new Error("Unsupported type for toPixels: ".concat(t.dtype,".")+" Please use float32 or int32 tensors.");return[4,t.data()];case 1:for(u=y.sent(),c=t.dtype==="float32"?255:1,l=new Uint8ClampedArray(o*i*4),f=0;f<i*o;++f){for(h=[0,0,0,255],d=0;d<s;d++){if(p=u[f*s+d],t.dtype==="float32"){if(p<0||p>1)throw new Error("Tensor values for a float32 Tensor must be in the "+"range [0 - 1] but encountered ".concat(p,"."))}else if(t.dtype==="int32"&&(p<0||p>255))throw new Error("Tensor values for a int32 Tensor must be in the "+"range [0 - 255] but encountered ".concat(p,"."));s===1?(h[0]=p*c,h[1]=p*c,h[2]=p*c):h[d]=p*c}v=f*4,l[v+0]=Math.round(h[0]),l[v+1]=Math.round(h[1]),l[v+2]=Math.round(h[2]),l[v+3]=Math.round(h[3])}return e!=null&&(e.width=o,e.height=i,m=e.getContext("2d"),g=new ImageData(l,o,i),m.putImageData(g,0,0)),t!==n&&t.dispose(),[2,l]}})})}var Bce=H({fromPixels_:hR}),Lce={__proto__:null,fromPixelsAsync:Pce,toPixels:Mce,fromPixels:Bce};function dR(n,e){var t=n.shape.length,r=e.shape.length;if(t<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+" but the rank was ".concat(t,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(r,"."));if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type,"+" but the dtype was ".concat(e.dtype,"."));if(e.shape[r-1]>t)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+"".concat(e.shape[r-1]," vs. ").concat(t));if(Ut(n.shape)===0)throw new Error("Requested more than 0 entries, but input is empty."+" Input shape: ".concat(n.shape,"."));for(var a=e.shape,i=a[a.length-1],o=1,s=0;s<a.length-1;++s)o*=a[s];var u=n.shape,c=a.slice();c.pop();for(var l=1,s=i;s<t;++s)l*=u[s],c.push(u[s]);var f=wt(wt([],ke(ec(n.shape).map(function(h){return h/l})),!1),[1],!1).slice(0,i);return[c,o,l,f]}var zce={__proto__:null,prepareAndValidate:dR},C0=-2,$ce=-1;function qce(n,e,t){var r=n.shape.length;q(r===e.length,function(){return"Error in slice".concat(r,"D: Length of begin ").concat(e," must ")+"match the rank of the array (".concat(r,").")}),q(r===t.length,function(){return"Error in slice".concat(r,"D: Length of size ").concat(t," must ")+"match the rank of the array (".concat(r,").")});for(var a=function(o){q(e[o]+t[o]<=n.shape[o],function(){return"Error in slice".concat(r,"D: begin[").concat(o,"] + size[").concat(o,"] ")+"(".concat(e[o]+t[o],") would overflow input.shape[").concat(o,"] (").concat(n.shape[o],")")})},i=0;i<r;++i)a(i)}function Wce(n){for(var e=[],t=0;n>0;)n&1&&e.push(t),n/=2,t++;return e}function Vce(n,e,t){for(var r=[],a=0;a<n.length;a++)r[a]=Math.ceil((e[a]-n[a])/t[a]);return r}function pR(n,e,t,r){for(var a=wt([],ke(n),!1),i=a.length;i<r.length;i++)a.push(1);for(var i=0;i<t;i++)i===0?a[e]=1:(a.splice(e,0,1),a.pop());return a}function vR(n,e,t){return t<=n?t:t-(e-1)}function mR(n,e){for(var t=[],r=0;r<n;r++)t.push(e+r);return t}function Gce(n,e,t,r,a,i,o,s,u){var c=n.length,l=new Array(c),f=new Array(c),h=new Array(c);if(e.length&&t>0){var d=e[0],p=t+1;l=gR(o,d,p,r,n),f=yR(s,d,p,a,n),h=pR(i,d,p,n)}else for(var v=0;v<c;v++)l[v]=wR(o,r,i,n,v,u),f[v]=xR(s,a,i,n,v,u),h[v]=bR(i,v,u);return{begin:l,end:f,strides:h}}function gR(n,e,t,r,a){for(var i=wt([],ke(a),!1),o=mR(t,e),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=0;else{var u=vR(e,t,s),c=r[u];n&1<<u&&(c=0),i[s]=c}return i}function yR(n,e,t,r,a){for(var i=wt([],ke(a),!1),o=mR(t,e),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=Number.MAX_SAFE_INTEGER;else{var u=vR(e,t,s),c=r[u];n&1<<u&&(c=Number.MAX_SAFE_INTEGER),i[s]=c}for(var l=0;l<i.length;l++){var f=a[l];i[l]<0&&(i[l]+=f),i[l]=Vl(0,i[l],a[l])}return i}function bR(n,e,t){var r=n[e];return(t&1<<e||r==null)&&(r=1),r}function wR(n,e,t,r,a,i){var o=e[a],s=t[a]||1;(n&1<<a||i&1<<a||o==null)&&(s>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),o=Vl(0,o,u-1),o}function xR(n,e,t,r,a,i){var o=e[a],s=t[a]||1;(n&1<<a||i&1<<a||o==null)&&(s>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),s>0?o=Vl(0,o,u):o=Vl(-1,o,u-1),o}function Uce(n,e,t){for(var r=t.length,a=0;a<t.length;a++)if(t[a]>1){r=a;break}for(var a=r+1;a<t.length;a++)if(e[a]>0||t[a]!==n[a])return!1;return!0}function Hce(n,e){for(var t=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function Kce(n,e,t){var r,a=n.shape.length;typeof e=="number"?r=wt([e],ke(new Array(a-1).fill(0)),!1):e.length<a?r=e.concat(new Array(a-e.length).fill(0)):r=e.slice(),r.forEach(function(o){q(o!==-1,function(){return"slice() does not support negative begin indexing."})});var i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=wt([t],ke(new Array(a-1).fill(-1)),!1):t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map(function(o,s){return o>=0?o:(q(o===-1,function(){return"Negative size values should be exactly -1 but got "+"".concat(o," for the slice() size at index ").concat(s,".")}),n.shape[s]-r[s])}),[r,i]}function jce(n,e,t,r,a,i,o,s,u){var c;if(r==null?(c=new Array(e.length),c.fill(1)):c=r,o!=null&&(o&o-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");for(var l=!1,f={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:c.slice(),beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u},h=0;h<f.dims;h++)l&&(1<<h&s)!==0&&f.numAddAxisAfterEllipsis++,1<<h&o&&(l=!0);l||(f.ellipsisMask|=1<<f.dims,f.dims++);var d={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};Xce(f,d);for(var p=!0,v=!0,m=!0,g=[],y=[],h=0;h<n.length;++h){if(d.strides[h]===0)throw Error("strides[".concat(h,"] must be non-zero"));var b=!!(d.shrinkAxisMask&1<<h),w=n[h];if(w===-1){g.push(b?1:-1);continue}var x=[d.beginMask&1<<h,d.endMask&1<<h],N=[d.strides[h]>0?0:-1,d.strides[h]>0?w:w-1];if(b&&d.strides[h]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&d.strides[h]===1;var T=!!(d.beginMask&1<<h&&d.endMask&1<<h);if(d.beginValid&&d.endValid){if(b){var E=d.begin[h]<0?w+d.begin[h]:d.begin[h];if(d.begin[h]=E,d.end[h]=d.begin[h]+1,E<0||E>=w)throw Error("slice index ".concat(d.begin[h]," of dimension ").concat(h," out of bounds."))}else d.begin[h]=OA(d.begin[h],0,d.strides[h],w,x,N),d.end[h]=OA(d.end[h],1,d.strides[h],w,x,N);var C=d.strides[h]===1&&d.begin[h]===0&&d.end[h]===w;p=p&&C,v=v&&(h===0&&d.strides[h]===1||C)}else p=p&&d.strides[h]===1&&T,v=v&&(h===0&&d.strides[h]===1||T);var F=void 0,_=!1;if(d.beginValid&&d.endValid?(F=d.end[h]-d.begin[h],_=!0):b?(F=1,_=!0):T&&w>=0&&(d.strides[h]<0?F=-w:F=w,_=!0),_){var O=void 0;F===0||F<0!=d.strides[h]<0?O=0:O=Math.trunc(F/d.strides[h])+(F%d.strides[h]!==0?1:0),g.push(O)}else g.push(-1)}for(var L=0;L<d.finalShapeGatherIndices.length;++L){var z=d.finalShapeGatherIndices[L];z>=0?y.push(g[z]):z===C0&&y.push(1)}var $=y.filter(function(B,W){return d.finalShapeGatherIndices[W]!==C0});return{finalShapeSparse:$,finalShape:y,isIdentity:p,sliceDim0:v,isSimpleSlice:m,begin:d.begin,end:d.end,strides:d.strides}}function Xce(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;var t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(var r=0;r<n.dims;r++)if(1<<r&n.ellipsisMask)for(var a=Math.min(e.dims-(n.dims-r)+1+n.numAddAxisAfterEllipsis,e.dims);t<a;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=r;else if(1<<r&n.newAxisMask)e.finalShapeGatherIndices.push(C0),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error("Index out of range using input dim ".concat(t,"; input ")+"has only ".concat(e.dims," dims, ").concat(e.begin.length,"."));n.begin!=null&&(e.begin[t]=n.begin[r]),n.end!=null&&(e.end[t]=n.end[r]),e.strides[t]=n.strides[r],n.beginMask&1<<r&&(e.beginMask|=1<<t),n.endMask&1<<r&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<r?(e.finalShapeGatherIndices.push($ce),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(r)),e.inputShapeGatherIndicesSparse[t]=r,t++}}function OA(n,e,t,r,a,i){if(a[e])return t>0?i[e]:i[e+1&1];var o=n<0?r+n:n;return o<i[0]?i[0]:o>i[1]?i[1]:o}var kR={__proto__:null,assertParamsValid:qce,maskToAxes:Wce,computeOutShape:Vce,stridesWithElidedDims:pR,getNormalizedAxes:Gce,startIndicesWithElidedDims:gR,stopIndicesWithElidedDims:yR,stridesForAxis:bR,startForAxis:wR,stopForAxis:xR,isSliceContinous:Uce,computeFlatOffset:Hce,parseSliceParams:Kce,sliceInfo:jce};var Yce="4.2.0";var SR=function(){function n(){}return n.sgd=function(e){return new mp(e)},n.momentum=function(e,t,r){return r===void 0&&(r=!1),new ly(e,t,r)},n.rmsprop=function(e,t,r,a,i){return t===void 0&&(t=.9),r===void 0&&(r=0),a===void 0&&(a=null),i===void 0&&(i=!1),new fy(e,t,r,a,i)},n.adam=function(e,t,r,a){return e===void 0&&(e=.001),t===void 0&&(t=.9),r===void 0&&(r=.999),a===void 0&&(a=null),new uy(e,t,r,a)},n.adadelta=function(e,t,r){return e===void 0&&(e=.001),t===void 0&&(t=.95),r===void 0&&(r=null),new oy(e,t,r)},n.adamax=function(e,t,r,a,i){return e===void 0&&(e=.002),t===void 0&&(t=.9),r===void 0&&(r=.999),a===void 0&&(a=null),i===void 0&&(i=0),new cy(e,t,r,a,i)},n.adagrad=function(e,t){return t===void 0&&(t=.1),new sy(e,t)},n}();var Zce=SR;var Jce=function(){return typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:function(n){return n()}}();function Qce(){return new Promise(function(n){return Jce(function(){return n()})})}function ele(n,e){var t=n[0].length;n.forEach(function(a,i){q(a.length===t,function(){return"Error in concat".concat(t,"D: rank of tensors[").concat(i,"] must be the same ")+"as the rank of the rest (".concat(t,")")})}),q(e>=0&&e<t,function(){return"Error in concat".concat(t,"D: axis must be between 0 and ").concat(t-1,".")});var r=n[0];n.forEach(function(a,i){for(var o=0;o<t;o++)q(o===e||a[o]===r[o],function(){return"Error in concat".concat(t,"D: Shape of tensors[").concat(i,"] (").concat(a,") ")+"does not match the shape of the rest (".concat(r,") ")+"along the non-concatenated axis ".concat(i,".")})})}function tle(n,e){for(var t=n[0].slice(),r=1;r<n.length;r++)t[e]+=n[r][e];return t}var Ei;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(Ei||(Ei={}));function nle(n,e,t){var r=new Array;if(t==null&&e==null)return r;if(e==null)for(;r.length<n+t.length;)r.push(-1);else r=e.slice();if(t==null)return r;if(n+t.length!==r.length)throw new Error("rt input.shape and shape=".concat(e," are incompatible: rt input.rank = ").concat(n+t.length,", but shape.rank = ").concat(r.length));for(var a=1;a<t.length;++a){var i=t[a],o=r[r.length-t.length+a],s=r[o];if(i>=0)if(s>=0){if(s!==i)throw new Error("rt input.shape and shape=".concat(e," are incompatible: rt input.shape[").concat(a+n,"] = ").concat(i," but shape[").concat(a+n,"] = ").concat(s))}else r[o]=i}return r}function rle(n){var e,t,r={FIRST_DIM_SIZE:Ei.FIRST_DIM_SIZE,VALUE_ROWIDS:Ei.VALUE_ROWIDS,ROW_LENGTHS:Ei.ROW_LENGTHS,ROW_SPLITS:Ei.ROW_SPLITS,ROW_LIMITS:Ei.ROW_LIMITS,ROW_STARTS:Ei.ROW_STARTS},a=[];try{for(var i=cr(n),o=i.next();!o.done;o=i.next()){var s=o.value;if(s in r)a.push(r[s]);else break}}catch(u){e={error:u}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return a}function ale(n){return n.length===0?0:n[0]===Ei.FIRST_DIM_SIZE?n.length-1:n.length}function ile(n,e){if(!(n==null||e==null)){var t=n.length,r=e.length;if(t>=r)throw new Error("defaultValue.shape=".concat(n," and ragged tensor flatValues.shape=").concat(e,", are incompatible: defaultValue.rank = ").concat(t," must be less than ragged tensor input flatValues.rank = ").concat(r,")"));for(var a=0;a<Math.min(t,r-1);++a){var i=n[a],o=e[a+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error("defaultValue.shape=".concat(n,", and ragged tensor input flatValues.shape=").concat(e," are incompatible: defaultValue.shape[").concat(a-n.length,"] = ").concat(i," but ragged tensor input.flatValues.shape[").concat(a-n.length,"] = ").concat(o))}}}var py=30;function ole(n){return n<=py?n:Wd(n,Math.floor(Math.sqrt(n)))}function sle(n,e,t){var r=t*(typeof n=="number"?n:n[0]),a=e*(typeof n=="number"?n:n[1]);return[r,a]}function ule(n,e,t,r){r===void 0&&(r=!0);var a=[];if(r)a=a.concat(e.slice(0)),a.push(n[0]/t),a=a.concat(n.slice(1));else{a=a.concat(n[0]);for(var i=e.length,o=0;o<i;++o)a=a.concat([n[o+1]/e[o],e[o]]);a=a.concat(n.slice(i+1))}return a}function cle(n,e,t){t===void 0&&(t=!0);var r=[];if(t){r.push(e);for(var a=e+1;a<n;++a)a<=2*e?(r.push(a),r.push(a-(e+1))):r.push(a)}else{for(var i=[],o=[],a=1;a<n;++a)a>=e*2+1||a%2===1?o.push(a):i.push(a);r.push.apply(r,wt([],ke(i),!1)),r.push(0),r.push.apply(r,wt([],ke(o),!1))}return r}function lle(n,e,t,r){r===void 0&&(r=!0);var a=[];r?a.push(n[0]/t):a.push(n[0]*t);for(var i=1;i<n.length;++i)i<=e.length?r?a.push(e[i-1]*n[i]):a.push(n[i]/e[i-1]):a.push(n[i]);return a}function fle(n,e){for(var t=[0],r=0;r<e;++r)t.push(n[r][0]);return t}function hle(n,e,t){for(var r=n.slice(0,1),a=0;a<t;++a)r.push(n[a+1]-e[a][0]-e[a][1]);return r}var dle=1.7580993408473768,ple=1.0507009873554805;var vle=.3275911,mle=.254829592,gle=-.284496736,yle=1.421413741,ble=-1.453152027,wle=1.061405429;function xle(n,e){if(n.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+"".concat(n.length,", imag: ").concat(e.length,"."));for(var t=new Float32Array(n.length*2),r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function kle(n){for(var e=new Float32Array(n.length/2),t=new Float32Array(n.length/2),r=0;r<n.length;r+=2)e[r/2]=n[r],t[r/2]=n[r+1];return{real:e,imag:t}}function Sle(n){for(var e=Math.ceil(n.length/4),t=new Float32Array(e),r=new Float32Array(e),a=0;a<n.length;a+=4)t[Math.floor(a/4)]=n[a],r[Math.floor(a/4)]=n[a+1];return{real:t,imag:r}}function Nle(n){for(var e=Math.floor(n.length/4),t=new Float32Array(e),r=new Float32Array(e),a=2;a<n.length;a+=4)t[Math.floor(a/4)]=n[a],r[Math.floor(a/4)]=n[a+1];return{real:t,imag:r}}function Tle(n,e){var t=n[e*2],r=n[e*2+1];return{real:t,imag:r}}function Ele(n,e,t,r){n[r*2]=e,n[r*2+1]=t}function Ile(n,e){for(var t=new Float32Array(n/2),r=new Float32Array(n/2),a=0;a<Math.ceil(n/2);a++){var i=(e?2:-2)*Math.PI*(a/n);t[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:t,imag:r}}function Cle(n,e,t){var r=(t?2:-2)*Math.PI*(n/e),a=Math.cos(r),i=Math.sin(r);return{real:a,imag:i}}var r0="->",Ale=/->/g,PA=",",MA="...";function Dle(n,e){n=n.replace(/\s/g,"");var t=(n.length-n.replace(Ale,"").length)/r0.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error('Equation must contain exactly one arrow ("'.concat(r0,'").'));var r=ke(n.split(r0),2),a=r[0],i=r[1];q(a.indexOf(MA)===-1,function(){return'The ellipsis notation ("'.concat(MA,'") is not supported yet.')});var o=a.split(PA),s=o.length;if(e!==s)throw new Error("Expected ".concat(s," input tensors, received ").concat(e));if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");for(var u=[],c=function(g){var y=i[g];if(!o.some(function(b){return b.indexOf(y)!==-1}))throw new Error("Output subscripts contain the label ".concat(y," ")+"not present in the input subscripts.");u.indexOf(y)===-1&&u.push(y)},l=0;l<i.length;++l)c(l);for(var l=0;l<a.length;++l){var f=a[l];u.indexOf(f)===-1&&f!==PA&&u.push(f)}for(var h=new Array(o.length),l=0;l<s;++l){if(new Set(o[l].split("")).size!==o[l].length)throw new Error("Found duplicate axes in input component ".concat(o[l],". ")+"Support for duplicate axes in input is not implemented yet.");h[l]=[];for(var d=0;d<o[l].length;++d)h[l].push(u.indexOf(o[l][d]))}for(var p=u.length,v=i.length,m=[],l=v;l<p;++l)m.push(l);return{allDims:u,summedDims:m,idDims:h}}function _le(n,e){var t=new Array(n);t.fill(-1);for(var r=0;r<e.length;++r)t[e[r]]=r;for(var a=[],r=0;r<n;++r)t[r]===-1&&a.push(r);return t=t.filter(function(i){return i!==-1}),{permutationIndices:t,expandDims:a}}function Fle(n,e,t){for(var r=new Array(n),a=function(o){for(var s=t[o].shape,u=function(l){r[e[o][l]]===void 0?r[e[o][l]]=s[l]:q(r[e[o][l]]===s[l],function(){return"Expected dimension ".concat(r[e[o][l]]," at axis ").concat(l," ")+"of input shaped ".concat(JSON.stringify(s),", ")+"but got dimension ".concat(s[l])})},c=0;c<e[o].length;++c)u(c)},i=0;i<t.length;++i)a(i)}function Rle(n,e){var t,r,a=n,i=[],o=0;n.length===0&&a.push(-1),o=n.length+1;for(var s=0;s<o;++s)i.push([]);for(var u=[],s=0;s<a.length;++s){var c=a[s],l=Ple(e,c);try{for(var f=(t=void 0,cr(l)),h=f.next();!h.done;h=f.next()){var d=h.value;u.indexOf(d)===-1&&(i[s].push(d),u.push(d))}}catch(v){t={error:v}}finally{try{h&&!h.done&&(r=f.return)&&r.call(f)}finally{if(t)throw t.error}}}return{path:a,steps:i}}function Ole(n){return n.every(function(e,t){return e===t})}function Ple(n,e){for(var t=[],r=0;r<n.length;++r)(n[r].length===0||n[r].indexOf(e)!==-1||e===-1)&&t.push(r);return t}function Mle(n,e,t){t===void 0&&(t=0);var r=[];if(typeof e=="number")q(n.shape[t]%e===0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(e).fill(n.shape[t]/e);else{var a=e.reduce(function(s,u){return u===-1&&(s+=1),s},0);q(a<=1,function(){return"There should be only one negative value in split array."});var i=e.indexOf(-1);if(i!==-1){var o=e.reduce(function(s,u){return u>0?s+u:s});e[i]=n.shape[t]-o}q(n.shape[t]===e.reduce(function(s,u){return s+u}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=e}return r}function Ble(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = `.concat(n)}function Lle(n,e){return"indices(".concat(n,", 0) is invalid: ").concat(e," < 0")}function zle(n,e,t){return"indices(".concat(n,", 0) is invalid: ").concat(e," >= ").concat(t)}function $le(n,e){return"only one output dimension may be -1, not both ".concat(n," and ").concat(e)}function qle(n,e){return"size ".concat(n," must be non-negative, not ").concat(e)}function Wle(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function Vle(n,e){var t=Ut(n),r=Ut(e);return"Input to reshape is a SparseTensor with ".concat(t,`
  dense values, but the requested shape requires a multiple of `).concat(r,". inputShape=").concat(n," outputShape= ").concat(e)}function Gle(n,e){var t=Ut(n),r=Ut(e);return"Input to reshape is a tensor with ".concat(t," dense values, but the requested shape has ").concat(r,". inputShape=").concat(n," outputShape=").concat(e)}function Ule(){return"segment ids must be >= 0"}function Hle(){return"segment ids are not increasing"}function Kle(n,e){return"Segment id ".concat(n," out of range [0, ").concat(e,"), possibly because segmentIds input is not sorted.")}function jle(n,e,t){return"Bad: indices[".concat(n,"] == ").concat(e," out of range [0, ").concat(t,")")}function Xle(n,e){var t=!1,r;for(n<=py?(r=n,t=!0):r=Wd(n,Math.floor(Math.sqrt(n)));!t;)r>e||r===n?t=!0:r=Wd(n,r+1);return r}function Yle(n,e,t){for(var r=[],a=n.length,i=0;i<a;i++)i!==e?r.push(n[i]):r.push(t);return r}function Zle(n,e,t,r){var a=e.shape.length,i=n.shape.length;if(r!==0&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>i)throw new Error("batchDims (".concat(r,`) must be less than rank(x) (
    `).concat(i,")."));if(t<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(t,")."));for(var o=0;o<r;++o)if(n.shape[o]!==e.shape[o])throw new Error("x.shape[".concat(o,"]: ").concat(n.shape[o]," should be equal to indices.shape[").concat(o,"]: ").concat(e.shape[o],"."));for(var s=n.shape[t],u=[],c=1,l=1,f=1,o=0;o<r;++o)u.push(n.shape[o]),c*=n.shape[o];for(var o=r;o<t;o++)u.push(n.shape[o]),l*=n.shape[o];for(var o=r;o<a;o++)u.push(e.shape[o]);for(var o=t+1;o<i;o++)u.push(n.shape[o]),f*=n.shape[o];return{batchSize:c,sliceSize:f,outerSize:l,dimSize:s,outputShape:u}}var Jle={__proto__:null,segOpComputeOptimalWindowSize:Xle,computeOutShape:Yle,collectGatherOpShapeInfo:Zle};function Qle(n){try{return n.map(function(e){return Hd(e)})}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(e))}}function efe(n){return n.map(function(e){return of(e)})}var tfe={__proto__:null,slice_util:kR,segment_util:Jle,fromUint8ToStringArray:Qle,fromStringArrayToUint8:efe,upcastType:ap,axesAreInnerMostDims:U0,combineLocations:wF,computeOutAndReduceShapes:pre,expandShapeToKeepDim:lf,assertAxesAreInnerMostDims:vre,getAxesPermutation:mre,getUndoAxesPermutation:gre,getInnerMostAxes:yre,getBroadcastDims:gF,getReductionAxes:G0,assertAndGetBroadcastShape:Bn,assertParamsConsistent:ele,computeOutShape:tle,computeDilation2DInfo:Lte,computePool2DInfo:lF,computePool3DInfo:zte,computeConv2DInfo:uf,computeConv3DInfo:fF,computeDefaultPad:W0,tupleValuesAreOne:Yl,eitherStridesOrDilationsAreOne:Ji,stridesOrDilationsArePositive:ws,convertConv2DDataFormat:hF,checkPadOnDimRoundingMode:Ca,getFusedDyActivation:hp,getFusedBiasGradient:dp,applyActivation:pp,shouldFuse:vp,get RowPartitionType(){return Ei},combineRaggedTensorToTensorShapes:nle,getRowPartitionTypesHelper:rle,getRaggedRank:ale,validateDefaultValueShape:ile,PARALLELIZE_THRESHOLD:py,computeOptimalWindowSize:ole,getImageCenter:sle,getReshaped:ule,getPermuted:cle,getReshapedPermuted:lle,getSliceBeginCoords:fle,getSliceSize:hle,prepareAndValidate:dR,validateUpdateShape:ny,validateInput:ry,calculateShapes:ZF,SELU_SCALEALPHA:dle,SELU_SCALE:ple,ERF_P:vle,ERF_A1:mle,ERF_A2:gle,ERF_A3:yle,ERF_A4:ble,ERF_A5:wle,warn:To,log:CQ,mergeRealAndImagArrays:xle,splitRealAndImagArrays:kle,complexWithEvenIndex:Sle,complexWithOddIndex:Nle,getComplexWithIndex:Tle,assignToTypedArray:Ele,exponents:Ile,exponent:Cle,decodeEinsumEquation:Dle,getEinsumPermutation:_le,checkEinsumDimSizes:Fle,getEinsumComputePath:Rle,isIdentityPermutation:Ole,prepareSplitSize:Mle,getSparseFillEmptyRowsIndicesDenseShapeMismatch:Ble,getSparseFillEmptyRowsNegativeIndexErrorMessage:Lle,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:zle,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:$le,getSparseReshapeNegativeOutputDimErrorMessage:qle,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:Wle,getSparseReshapeInputOutputMultipleErrorMessage:Vle,getSparseReshapeInputOutputMismatchErrorMessage:Gle,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Ule,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:Hle,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:Kle,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:jle};var nfe={__proto__:null,nonMaxSuppressionV3Impl:tR,nonMaxSuppressionV4Impl:nR,nonMaxSuppressionV5Impl:rR,whereImpl:XF};lce();A.Abs=YA;A.Acos=ZA;A.Acosh=JA;A.AdadeltaOptimizer=oy;A.AdagradOptimizer=sy;A.AdamOptimizer=uy;A.AdamaxOptimizer=cy;A.Add=_0;A.AddN=QA;A.All=eD;A.Any=tD;A.ArgMax=nD;A.ArgMin=rD;A.Asin=aD;A.Asinh=iD;A.Atan=oD;A.Atan2=uD;A.Atanh=sD;A.AvgPool=cD;A.AvgPool3D=lD;A.AvgPool3DGrad=fQ;A.AvgPoolGrad=lQ;A.BatchMatMul=fD;A.BatchToSpaceND=hD;A.Bincount=dD;A.BroadcastArgs=pD;A.BroadcastTo=hQ;A.Cast=F0;A.Ceil=vD;A.ClipByValue=mD;A.Complex=gD;A.ComplexAbs=yD;A.Concat=bD;A.Conv2D=wD;A.Conv2DBackpropFilter=xD;A.Conv2DBackpropInput=kD;A.Conv3D=SD;A.Conv3DBackpropFilterV2=dQ;A.Conv3DBackpropInputV2=ND;A.Cos=TD;A.Cosh=ED;A.CropAndResize=AD;A.Cumprod=ID;A.Cumsum=CD;A.DataStorage=WJ;A.DenseBincount=DD;A.DepthToSpace=_D;A.DepthwiseConv2dNative=FD;A.DepthwiseConv2dNativeBackpropFilter=RD;A.DepthwiseConv2dNativeBackpropInput=OD;A.Diag=PD;A.Dilation2D=MD;A.Dilation2DBackpropFilter=vQ;A.Dilation2DBackpropInput=pQ;A.Einsum=LD;A.Elu=zD;A.EluGrad=mQ;A.Environment=jA;A.Equal=qD;A.Erf=$D;A.Exp=WD;A.ExpandDims=VD;A.Expm1=GD;A.FFT=UD;A.Fill=HD;A.FlipLeftRight=KD;A.Floor=jD;A.FloorDiv=XD;A.FromPixels=i0;A.FusedBatchNorm=YD;A.FusedConv2D=s0;A.FusedDepthwiseConv2D=u0;A.GatherNd=JD;A.GatherV2=ZD;A.Greater=QD;A.GreaterEqual=e_;A.IFFT=t_;A.Identity=R0;A.Imag=n_;A.IsFinite=r_;A.IsInf=a_;A.IsNan=i_;A.KernelBackend=BA;A.LRN=v_;A.LRNGrad=wQ;A.LeakyRelu=o_;A.Less=s_;A.LessEqual=u_;A.LinSpace=c_;A.Log=l_;A.Log1p=f_;A.LogSoftmax=yQ;A.LogicalAnd=h_;A.LogicalNot=d_;A.LogicalOr=p_;A.LogicalXor=gQ;A.LowerBound=bQ;A.Max=m_;A.MaxPool=y_;A.MaxPool3D=b_;A.MaxPool3DGrad=kQ;A.MaxPoolGrad=xQ;A.MaxPoolWithArgmax=w_;A.Maximum=g_;A.Mean=x_;A.Min=k_;A.Minimum=S_;A.MirrorPad=N_;A.Mod=T_;A.MomentumOptimizer=ly;A.Multinomial=E_;A.Multiply=I_;A.Neg=C_;A.NonMaxSuppressionV3=D_;A.NonMaxSuppressionV4=__;A.NonMaxSuppressionV5=F_;A.NotEqual=A_;A.OP_SCOPE_SUFFIX=X3;A.OneHot=O_;A.OnesLike=R_;A.Optimizer=Po;A.OptimizerConstructors=SR;A.Pack=P_;A.PadV2=M_;A.Pool=SQ;A.Pow=B_;A.Prelu=L_;A.Prod=z_;A.RMSPropOptimizer=fy;A.RaggedGather=$_;A.RaggedRange=q_;A.RaggedTensorToTensor=W_;A.Range=V_;A.Real=G_;A.RealDiv=BD;A.Reciprocal=U_;A.Relu=H_;A.Relu6=Y_;A.Reshape=K_;A.ResizeBilinear=X_;A.ResizeBilinearGrad=TQ;A.ResizeNearestNeighbor=j_;A.ResizeNearestNeighborGrad=NQ;A.Reverse=Z_;A.RotateWithOffset=P3;A.Round=J_;A.Rsqrt=Q_;A.SGDOptimizer=mp;A.ScatterNd=e3;A.SearchSorted=t3;A.Select=n3;A.Selu=r3;A.Sigmoid=u3;A.Sign=s3;A.Sin=i3;A.Sinh=o3;A.Slice=a3;A.Softmax=p3;A.Softplus=c3;A.SpaceToBatchND=h3;A.SparseFillEmptyRows=v3;A.SparseReshape=m3;A.SparseSegmentMean=g3;A.SparseSegmentSum=y3;A.SparseToDense=b3;A.SplitV=d3;A.Sqrt=l3;A.Square=EQ;A.SquaredDifference=w3;A.Step=O3;A.StridedSlice=x3;A.StringNGrams=k3;A.StringSplit=S3;A.StringToHashBucketFast=N3;A.Sub=T3;A.Sum=f3;A.Tan=E3;A.Tanh=I3;A.Tensor=Pn;A.TensorBuffer=Kd;A.Tile=O0;A.TopK=C3;A.Transform=A3;A.Transpose=Md;A.Unique=D3;A.Unpack=_3;A.UnsortedSegmentSum=F3;A.UpperBound=IQ;A.Variable=Hl;A.ZerosLike=R3;A._FusedMatMul=o0;A.abs=ua;A.acos=vte;A.acosh=gte;A.add=ct;A.addN=bte;A.all=xte;A.any=Ste;A.argMax=Tte;A.argMin=Ite;A.asin=Ate;A.asinh=_te;A.atan=Rte;A.atan2=Pte;A.atanh=Bte;A.avgPool=dF;A.avgPool3d=Kte;A.backend=ste;A.backend_util=tfe;A.basicLSTMCell=ene;A.batchNorm=ip;A.batchNorm2d=ine;A.batchNorm3d=sne;A.batchNorm4d=cne;A.batchToSpaceND=pF;A.bincount=vF;A.booleanMaskAsync=Qoe;A.broadcastArgs=hne;A.broadcastTo=zd;A.broadcast_util=tre;A.browser=Lce;A.buffer=Xi;A.cast=Nn;A.ceil=vne;A.clipByValue=gne;A.clone=gs;A.complex=_o;A.concat=Wr;A.concat1d=bne;A.concat2d=xne;A.concat3d=Sne;A.concat4d=Tne;A.conv1d=Cne;A.conv2d=op;A.conv2dTranspose=_ne;A.conv3d=Rne;A.conv3dTranspose=Bne;A.copyRegisteredKernels=FQ;A.cos=zne;A.cosh=qne;A.cosineWindow=ay;A.cumprod=Vne;A.cumsum=Une;A.customGrad=Ci;A.denseBincount=Kne;A.deprecationWarn=jee;A.depthToSpace=Xne;A.depthwiseConv2d=V0;A.device_util=lee;A.diag=Jne;A.dilation2d=ere;A.disableDeprecationWarnings=Kee;A.dispose=Er;A.disposeVariables=Xee;A.div=Gt;A.divNoNan=ore;A.dot=ure;A.dropout=dse;A.einsum=lre;A.elu=bF;A.enableDebugMode=Hee;A.enableProdMode=Uee;A.enclosingPowerOfTwo=JF;A.engine=Yee;A.env=vt;A.equal=yF;A.erf=dre;A.euclideanNorm=Ire;A.exp=xs;A.expandDims=hs;A.expm1=_re;A.eye=kF;A.fft=J0;A.fill=cf;A.findBackend=ate;A.findBackendFactory=ite;A.floor=SF;A.floorDiv=cF;A.fused=Cse;A.gather=NF;A.gatherND=lse;A.gather_util=zce;A.getBackend=nte;A.getGradient=c0;A.getKernel=Vd;A.getKernelsForBackend=Gd;A.grad=eae;A.grads=tae;A.greater=up;A.greaterEqual=TF;A.ifft=Zd;A.imag=cp;A.image=rce;A.inTopKAsync=vse;A.io=Ice;A.irfft=UF;A.isFinite=$re;A.isInf=Wre;A.isNaN=Gre;A.keep=uF;A.kernel_impls=nfe;A.leakyRelu=EF;A.less=Kre;A.lessEqual=H0;A.linalg=ace;A.linspace=Xre;A.localResponseNormalization=Zre;A.log=Jl;A.log1p=IF;A.logSigmoid=sae;A.logSoftmax=lae;A.logSumExp=DF;A.logicalAnd=Xd;A.logicalNot=_F;A.logicalOr=FF;A.logicalXor=mae;A.losses=ice;A.lowerBound=yae;A.matMul=Ft;A.math=Dce;A.max=ju;A.maxPool=RF;A.maxPool3d=xae;A.maxPoolWithArgmax=Sae;A.maximum=OF;A.mean=Yd;A.memory=Zee;A.meshgrid=Eae;A.min=N0;A.minimum=PF;A.mirrorPad=Aae;A.mod=_ae;A.moments=Rae;A.movingAverage=nse;A.mul=Me;A.multiRNNCell=Pae;A.multinomial=Bae;A.neg=ji;A.nextFrame=Qce;A.norm=sp;A.notEqual=MF;A.oneHot=T0;A.ones=ms;A.onesLike=qae;A.op=H;A.outerProduct=Vae;A.pad=ff;A.pad1d=Hae;A.pad2d=jae;A.pad3d=Yae;A.pad4d=Jae;A.pool=rie;A.pow=Zl;A.prelu=LF;A.print=sF;A.prod=oie;A.profile=Jee;A.raggedGather=uie;A.raggedRange=lie;A.raggedTensorToTensor=hie;A.rand=pie;A.randomGamma=Oie;A.randomNormal=qF;A.randomStandardNormal=Bie;A.randomUniform=WF;A.range=Ql;A.ready=tte;A.real=ef;A.reciprocal=qie;A.registerBackend=ote;A.registerGradient=AQ;A.registerKernel=M3;A.relu=fp;A.relu6=VF;A.removeBackend=rte;A.reshape=ve;A.reverse=ks;A.reverse1d=Hie;A.reverse2d=jie;A.reverse3d=Yie;A.reverse4d=Jie;A.rfft=Q0;A.round=GF;A.rsqrt=toe;A.scalar=Rt;A.scatterND=ise;A.scatter_util=rse;A.searchSorted=K0;A.selu=roe;A.separableConv2d=ioe;A.serialization=uce;A.setBackend=ete;A.setPlatform=ute;A.setdiff1dAsync=soe;A.sigmoid=Ku;A.sign=coe;A.signal=nce;A.sin=foe;A.sinh=doe;A.slice=un;A.slice1d=voe;A.slice2d=goe;A.slice3d=boe;A.slice4d=xoe;A.slice_util=kR;A.softmax=Soe;A.softplus=AF;A.spaceToBatchND=BF;A.sparse=oce;A.sparseToDense=use;A.spectral=tce;A.split=tf;A.sqrt=Yi;A.square=ni;A.squaredDifference=HF;A.squeeze=ey;A.stack=nf;A.step=KF;A.stridedSlice=Ooe;A.string=sce;A.sub=bt;A.sum=Vt;A.sumOutType=tee;A.tan=Moe;A.tanh=S0;A.tensor=Gu;A.tensor1d=ti;A.tensor2d=Wl;A.tensor3d=jF;A.tensor4d=Boe;A.tensor5d=Loe;A.tensor6d=zoe;A.tensor_util=aee;A.test_util=Die;A.tidy=Mn;A.tile=ql;A.time=Qee;A.topk=qoe;A.train=Zce;A.transpose=Jd;A.truncatedNormal=Voe;A.unique=Uoe;A.unregisterGradient=_Q;A.unregisterKernel=DQ;A.unsortedSegmentSum=Koe;A.unstack=ty;A.upcastType=ap;A.upperBound=Xoe;A.util=VQ;A.valueAndGrad=nae;A.valueAndGrads=rae;A.variable=Yoe;A.variableGrads=CF;A.version_core=Yce;A.where=Ju;A.whereAsync=YF;A.zeros=Qu;A.zerosLike=ca});var OR=Y((Hit,RR)=>{RR.exports=jt;var Aa=null;try{Aa=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function jt(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}jt.prototype.__isLong__;Object.defineProperty(jt.prototype,"__isLong__",{value:!0});function Hr(n){return(n&&n.__isLong__)===!0}jt.isLong=Hr;var NR={},TR={};function Ds(n,e){var t,r,a;return e?(n>>>=0,(a=0<=n&&n<256)&&(r=TR[n],r)?r:(t=Xt(n,(n|0)<0?-1:0,!0),a&&(TR[n]=t),t)):(n|=0,(a=-128<=n&&n<128)&&(r=NR[n],r)?r:(t=Xt(n,n<0?-1:0,!1),a&&(NR[n]=t),t))}jt.fromInt=Ds;function Da(n,e){if(isNaN(n))return e?As:_a;if(e){if(n<0)return As;if(n>=AR)return FR}else{if(n<=-IR)return Ur;if(n+1>=IR)return _R}return n<0?Da(-n,e).neg():Xt(n%rc|0,n/rc|0,e)}jt.fromNumber=Da;function Xt(n,e,t){return new jt(n,e,t)}jt.fromBits=Xt;var gp=Math.pow;function my(n,e,t){if(n.length===0)throw Error("empty string");if(n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return _a;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var r;if((r=n.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return my(n.substring(1),e,t).neg();for(var a=Da(gp(t,8)),i=_a,o=0;o<n.length;o+=8){var s=Math.min(8,n.length-o),u=parseInt(n.substring(o,o+s),t);if(s<8){var c=Da(gp(t,s));i=i.mul(c).add(Da(u))}else i=i.mul(a),i=i.add(Da(u))}return i.unsigned=e,i}jt.fromString=my;function ai(n,e){return typeof n=="number"?Da(n,e):typeof n=="string"?my(n,e):Xt(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}jt.fromValue=ai;var ER=1<<16,rfe=1<<24,rc=ER*ER,AR=rc*rc,IR=AR/2,CR=Ds(rfe),_a=Ds(0);jt.ZERO=_a;var As=Ds(0,!0);jt.UZERO=As;var nc=Ds(1);jt.ONE=nc;var DR=Ds(1,!0);jt.UONE=DR;var vy=Ds(-1);jt.NEG_ONE=vy;var _R=Xt(-1,2147483647,!1);jt.MAX_VALUE=_R;var FR=Xt(-1,-1,!0);jt.MAX_UNSIGNED_VALUE=FR;var Ur=Xt(0,-2147483648,!1);jt.MIN_VALUE=Ur;var _e=jt.prototype;_e.toInt=function(){return this.unsigned?this.low>>>0:this.low};_e.toNumber=function(){return this.unsigned?(this.high>>>0)*rc+(this.low>>>0):this.high*rc+(this.low>>>0)};_e.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Ur)){var t=Da(e),r=this.div(t),a=r.mul(t).sub(this);return r.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Da(gp(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};_e.getHighBits=function(){return this.high};_e.getHighBitsUnsigned=function(){return this.high>>>0};_e.getLowBits=function(){return this.low};_e.getLowBitsUnsigned=function(){return this.low>>>0};_e.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Ur)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};_e.isZero=function(){return this.high===0&&this.low===0};_e.eqz=_e.isZero;_e.isNegative=function(){return!this.unsigned&&this.high<0};_e.isPositive=function(){return this.unsigned||this.high>=0};_e.isOdd=function(){return(this.low&1)===1};_e.isEven=function(){return(this.low&1)===0};_e.equals=function(e){return Hr(e)||(e=ai(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};_e.eq=_e.equals;_e.notEquals=function(e){return!this.eq(e)};_e.neq=_e.notEquals;_e.ne=_e.notEquals;_e.lessThan=function(e){return this.comp(e)<0};_e.lt=_e.lessThan;_e.lessThanOrEqual=function(e){return this.comp(e)<=0};_e.lte=_e.lessThanOrEqual;_e.le=_e.lessThanOrEqual;_e.greaterThan=function(e){return this.comp(e)>0};_e.gt=_e.greaterThan;_e.greaterThanOrEqual=function(e){return this.comp(e)>=0};_e.gte=_e.greaterThanOrEqual;_e.ge=_e.greaterThanOrEqual;_e.compare=function(e){if(Hr(e)||(e=ai(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};_e.comp=_e.compare;_e.negate=function(){return!this.unsigned&&this.eq(Ur)?Ur:this.not().add(nc)};_e.neg=_e.negate;_e.add=function(e){Hr(e)||(e=ai(e));var t=this.high>>>16,r=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,d=0;return d+=i+c,h+=d>>>16,d&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=r+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,Xt(h<<16|d,l<<16|f,this.unsigned)};_e.subtract=function(e){return Hr(e)||(e=ai(e)),this.add(e.neg())};_e.sub=_e.subtract;_e.multiply=function(e){if(this.isZero())return _a;if(Hr(e)||(e=ai(e)),Aa){var t=Aa.mul(this.low,this.high,e.low,e.high);return Xt(t,Aa.get_high(),this.unsigned)}if(e.isZero())return _a;if(this.eq(Ur))return e.isOdd()?Ur:_a;if(e.eq(Ur))return this.isOdd()?Ur:_a;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(CR)&&e.lt(CR))return Da(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,d=0,p=0;return p+=o*l,d+=p>>>16,p&=65535,d+=i*l,h+=d>>>16,d&=65535,d+=o*c,h+=d>>>16,d&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=r*l+a*c+i*u+o*s,f&=65535,Xt(d<<16|p,f<<16|h,this.unsigned)};_e.mul=_e.multiply;_e.divide=function(e){if(Hr(e)||(e=ai(e)),e.isZero())throw Error("division by zero");if(Aa){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Aa.div_u:Aa.div_s)(this.low,this.high,e.low,e.high);return Xt(t,Aa.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?As:_a;var r,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return As;if(e.gt(this.shru(1)))return DR;i=As}else{if(this.eq(Ur)){if(e.eq(nc)||e.eq(vy))return Ur;if(e.eq(Ur))return nc;var o=this.shr(1);return r=o.div(e).shl(1),r.eq(_a)?e.isNegative()?nc:vy:(a=this.sub(e.mul(r)),i=r.add(a.div(e)),i)}else if(e.eq(Ur))return this.unsigned?As:_a;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=_a}for(a=this;a.gte(e);){r=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(r)/Math.LN2),u=s<=48?1:gp(2,s-48),c=Da(r),l=c.mul(e);l.isNegative()||l.gt(a);)r-=u,c=Da(r,this.unsigned),l=c.mul(e);c.isZero()&&(c=nc),i=i.add(c),a=a.sub(l)}return i};_e.div=_e.divide;_e.modulo=function(e){if(Hr(e)||(e=ai(e)),Aa){var t=(this.unsigned?Aa.rem_u:Aa.rem_s)(this.low,this.high,e.low,e.high);return Xt(t,Aa.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};_e.mod=_e.modulo;_e.rem=_e.modulo;_e.not=function(){return Xt(~this.low,~this.high,this.unsigned)};_e.and=function(e){return Hr(e)||(e=ai(e)),Xt(this.low&e.low,this.high&e.high,this.unsigned)};_e.or=function(e){return Hr(e)||(e=ai(e)),Xt(this.low|e.low,this.high|e.high,this.unsigned)};_e.xor=function(e){return Hr(e)||(e=ai(e)),Xt(this.low^e.low,this.high^e.high,this.unsigned)};_e.shiftLeft=function(e){return Hr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Xt(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Xt(0,this.low<<e-32,this.unsigned)};_e.shl=_e.shiftLeft;_e.shiftRight=function(e){return Hr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Xt(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Xt(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};_e.shr=_e.shiftRight;_e.shiftRightUnsigned=function(e){if(Hr(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var r=this.low;return Xt(r>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?Xt(t,0,this.unsigned):Xt(t>>>e-32,0,this.unsigned)};_e.shru=_e.shiftRightUnsigned;_e.shr_u=_e.shiftRightUnsigned;_e.toSigned=function(){return this.unsigned?Xt(this.low,this.high,!1):this};_e.toUnsigned=function(){return this.unsigned?this:Xt(this.low,this.high,!0)};_e.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};_e.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};_e.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};jt.fromBytes=function(e,t,r){return r?jt.fromBytesLE(e,t):jt.fromBytesBE(e,t)};jt.fromBytesLE=function(e,t){return new jt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};jt.fromBytesBE=function(e,t){return new jt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}});var s4=Y(Qt=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});var R=Cs();function afe(n){if(n&&n.__esModule)return n;var e=Object.create(null);return n&&Object.keys(n).forEach(function(t){if(t!=="default"){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}}),e.default=n,e}function ife(n,e){return e.forEach(function(t){Object.keys(t).forEach(function(r){if(r!=="default"&&!(r in n)){var a=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,a.get?a:{enumerable:!0,get:function(){return t[r]}})}})}),n}var D=afe(R),Cy=function(n,e){return Cy=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])},Cy(n,e)};function se(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Cy(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Ce(n,e,t,r){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(r.next(l))}catch(f){o(f)}}function u(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((r=r.apply(n,e||[])).next())})}function Ee(n,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(l){c=[6,l],a=0}finally{r=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function fe(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function te(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=r.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return i}function Qe(n,e,t){if(t||arguments.length===2)for(var r=0,a=e.length,i;r<a;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}var Lo=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return Object.setPrototypeOf(r,e.prototype),r}return e}(Error),_i=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return Object.setPrototypeOf(r,e.prototype),r}return e}(Error),J=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return Object.setPrototypeOf(r,e.prototype),r}return e}(Error),pt=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return Object.setPrototypeOf(r,e.prototype),r}return e}(Error),ofe=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return Object.setPrototypeOf(r,e.prototype),r}return e}(Error);(function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return Object.setPrototypeOf(r,e.prototype),r}return e})(Error);var PO=function(){function n(e){this.maxEntries=e||100,this.cache=new Map}return n.prototype.get=function(e){var t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t},n.prototype.put=function(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){var r=this.cache.keys().next().value;this.cache.delete(r)}this.cache.set(e,t)},n.prototype.getMaxEntries=function(){return this.maxEntries},n.prototype.setMaxEntries=function(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got ".concat(e,"."));if(this.maxEntries>e)for(var t=0;t<this.maxEntries-e;t++){var r=this.cache.keys().next().value;this.cache.delete(r)}this.maxEntries=e},n}();function Ps(n,e){if(Array.isArray(n)){for(var t=[],r=0;r<e;r++)t=t.concat(n);return t}else{var t=new Array(e);return t.fill(n),t}}function Ai(n,e){if(!n)throw new ofe(e)}function PR(n,e){var t,r,a=0;try{for(var i=fe(n),o=i.next();!o.done;o=i.next()){var s=o.value;s===e&&a++}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return a}function Ir(n){return n.length===1?n[0]:n}function Yt(n){return Array.isArray(n)?n:[n]}function eo(n){var e=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2"),t=e.replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function _s(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,function(e,t){return t.toUpperCase()})}var Fa={};function Ky(n){if(n==null)return null;var e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function Ay(n){var e,t;if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(function(u){return Ay(u)});else{var r=Object.keys(n);try{for(var a=fe(r),i=a.next();!i.done;i=a.next()){var o=i.value,s=n[o];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[o]=s.value:Ay(s))}}catch(u){e={error:u}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}}}function Af(n,e,t,r,a){var i,o,s,u,c,l,f,h,d,p,v;if(e===void 0&&(e={}),t===void 0&&(t={}),r===void 0&&(r="object"),a===void 0&&(a=!1),typeof n=="string"){var m=n,g=void 0;if(m in t)g=t[m];else if(m in Fa)g=Fa[m];else if(g=e[m],g==null)throw new J("Unknown ".concat(r,": ").concat(n,". ")+`This may be due to one of the following reasons:
`+"1. The ".concat(r," is defined in Python, in which ")+`case it needs to be ported to TensorFlow.js or your JavaScript code.
`+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");return g}else{var y=n;if(y.className==null||y.config==null)throw new J("".concat(r,": Improper config format: ")+"".concat(JSON.stringify(y),`.
`)+"'className' and 'config' must set.");var b=y.className,w=void 0,x=void 0;if(b in t?(i=te(t[b],2),w=i[0],x=i[1]):b in Fa?(o=te(Fa.className,2),w=o[0],x=o[1]):b in e&&(s=te(e[b],2),w=s[0],x=s[1]),w==null)throw new J("Unknown ".concat(r,": ").concat(b,". ")+`This may be due to one of the following reasons:
`+"1. The ".concat(r," is defined in Python, in which ")+`case it needs to be ported to TensorFlow.js or your JavaScript code.
`+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");if(x!=null){var N={};try{for(var T=fe(Object.keys(Fa)),E=T.next();!E.done;E=T.next()){var C=E.value;N[C]=Fa[C]}}catch(Z){u={error:Z}}finally{try{E&&!E.done&&(c=T.return)&&c.call(T)}finally{if(u)throw u.error}}try{for(var F=fe(Object.keys(t)),_=F.next();!_.done;_=F.next()){var C=_.value;N[C]=t[C]}}catch(Z){l={error:Z}}finally{try{_&&!_.done&&(f=F.return)&&f.call(F)}finally{if(l)throw l.error}}var O=y.config;O.customObjects=N;var L=Object.assign({},Fa);try{for(var z=fe(Object.keys(t)),$=z.next();!$.done;$=z.next()){var C=$.value;Fa[C]=t[C]}}catch(Z){h={error:Z}}finally{try{$&&!$.done&&(d=z.return)&&d.call(z)}finally{if(h)throw h.error}}Ay(y.config);var B=x(w,y.config,t,a);return Fa=Object.assign({},L),B}else{var L=Object.assign({},Fa);try{for(var W=fe(Object.keys(t)),X=W.next();!X.done;X=W.next()){var C=X.value;Fa[C]=t[C]}}catch(j){p={error:j}}finally{try{X&&!X.done&&(v=W.return)&&v.call(W)}finally{if(p)throw p.error}}var B=new w(y.config);return Fa=Object.assign({},L),B}}}function sfe(n,e){return n<e?-1:n>e?1:0}function yp(n,e){return-1*sfe(n,e)}function zo(n){var e,t;if(n==null)return n;var r=[];try{for(var a=fe(n),i=a.next();!i.done;i=a.next()){var o=i.value;r.indexOf(o)===-1&&r.push(o)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return r}function ufe(n){if(n==null)throw new J("Invalid value in obj: ".concat(JSON.stringify(n)));for(var e in n)if(n.hasOwnProperty(e))return!1;return!0}function Bs(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new J("".concat(t," is not a valid ").concat(e,".  Valid values are ").concat(n," or null/undefined."))}function jy(n,e,t,r){return t===void 0&&(t=0),r===void 0&&(r=1/0),Ai(t>=0),Ai(r>=t),Array.isArray(n)&&n.length>=t&&n.length<=r&&n.every(function(a){return typeof a===e})}function Kn(n,e){Array.isArray(n)?(R.util.assert(n.length>0,function(){return"".concat(e," is unexpectedly an empty array.")}),n.forEach(function(t,r){return Kn(t,"element ".concat(r+1," of ").concat(e))})):R.util.assert(Number.isInteger(n)&&n>0,function(){return"Expected ".concat(e," to be a positive integer, but got ")+"".concat(MO(n),".")})}function MO(n){return n===null?"null":Array.isArray(n)?"["+n.map(function(e){return MO(e)}).join(",")+"]":typeof n=="string"?'"'.concat(n,'"'):"".concat(n)}function cfe(n,e,t){var r=t!=null?t():R.util.now(),a,i=function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var u=t!=null?t():R.util.now();return u-r<e||(r=u,a=n.apply(void 0,Qe([],te(o),!1))),a};return i}function BO(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}var lfe=0;function LO(){return lfe++}var bp={};function Up(n){return n===void 0&&(n=""),n in bp||(bp[n]=0),bp[n]+=1,n+bp[n].toString()}var ffe=["channelsFirst","channelsLast"],hfe=["nearest","bilinear"],dfe=["valid","same","causal"],pfe=["max","avg"],vfe=["sum","mul","concat","ave"];var ac=new Map;function _n(n){Bs(ffe,"DataFormat",n)}function mfe(n){Bs(hfe,"InterpolationFormat",n)}function pa(n){Bs(dfe,"PaddingMode",n)}function zO(n){Bs(pfe,"PoolMode",n)}var Sf=[],MR="/";function Rs(n,e){Sf.push(n);try{var t=e();return Sf.pop(),t}catch(r){throw Sf.pop(),r}}function gfe(){return Sf.length===0?"":Sf.join(MR)+MR}function $O(n){if(!WO(n))throw new Error("Not a valid tensor name: '"+n+"'");return gfe()+n}function qO(n){if(!WO(n))throw new Error("Not a valid tensor name: '"+n+"'");ac.has(n)||ac.set(n,0);var e=ac.get(n);if(ac.set(n,ac.get(n)+1),e>0){var t="".concat(n,"_").concat(e);return ac.set(t,1),t}else return n}var yfe=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function WO(n){return!!n.match(yfe)}function bfe(n){return n===parseInt(n.toString(),10)}function $o(n,e,t){e==null&&(e=0),t==null&&(t=n.length);for(var r=1,a=e;a<t;++a)r*=n[a];return r}function fc(n){if(n.length===0)return Number.NaN;for(var e=Number.POSITIVE_INFINITY,t=0;t<n.length;t++){var r=n[t];r<e&&(e=r)}return e}function qo(n){if(n.length===0)return Number.NaN;for(var e=Number.NEGATIVE_INFINITY,t=0;t<n.length;t++){var r=n[t];r>e&&(e=r)}return e}function li(n,e){if(e<n)throw new J("end (".concat(e,") < begin (").concat(n,") is forbidden."));for(var t=[],r=n;r<e;++r)t.push(r);return t}var gy;function qn(){return gy==null&&(gy=R.backend().epsilon()),gy}function fi(){return"channelsLast"}function Fi(n,e){return D.cast(n,e)}function Df(n,e){e===void 0&&(e=-1);var t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),D.reshape(n,t)}function wfe(n,e){return R.tidy(function(){if(n.shape.length!==2)throw new J("repeat() expects a rank-2 tensor, but received a "+"rank-".concat(n.shape.length," tensor."));var t=Df(n,1);return Dy(t,[1,e,1])})}function xfe(n){var e=[$o(n.shape)];return D.reshape(n,e)}function kfe(n){if(n.rank<=1)throw new J("batchFlatten requires a minimum rank of 2. Got rank: ".concat(n.rank,"."));var e=[n.shape[0],$o(n.shape,1)];return D.reshape(n,e)}function Os(n,e,t){return R.tidy(function(){switch(n.rank){case 1:return D.slice1d(n,e,t);case 2:return D.slice2d(n,[e,0],[t,n.shape[1]]);case 3:return D.slice3d(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return D.slice4d(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return D.slice(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return D.slice(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new J("sliceAlongFirstAxis() received an unsupported tensor rank: "+"".concat(n.rank))}})}function yy(n,e,t){return R.tidy(function(){switch(n.rank){case 1:return D.slice1d(n,e,t);case 2:return D.slice2d(n,[0,e],[n.shape[0],t]);case 3:return D.slice3d(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return D.slice4d(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new J("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(n.rank))}})}function wp(n,e,t,r){return R.tidy(function(){switch(n.rank){case 1:return D.slice1d(n,e,t);case 2:switch(r){case 1:return Os(n,e,t);case 2:return yy(n,e,t);default:throw new J("The axis is not within the rank of the tensor "+"".concat(r))}case 3:switch(r){case 1:return Os(n,e,t);case 2:return D.slice3d(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return yy(n,e,t);default:throw new J("The axis is not within the rank of the tensor "+"".concat(r))}case 4:switch(r){case 1:return Os(n,e,t);case 2:return D.slice4d(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return D.slice4d(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return yy(n,e,t);default:throw new J("The axis is not within the rank of the tensor "+"".concat(r))}default:throw new J("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(n.rank))}})}function Xy(n,e){e===void 0&&(e=-1);var t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),D.concat(n,e)}function BR(n,e){switch(n.rank){case 1:return D.concat1d([n,e]);case 2:return D.concat2d([n,e],0);case 3:return D.concat3d([n,e],0);case 4:return D.concat4d([n,e],0);default:throw new J("concatAlongFirstAxis() received an unsupported "+"tensor rank: ".concat(n.rank))}}function Dy(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new J("The length of input n (".concat(e.length,") does not match ")+"the number of dimensions in input x (".concat(n.rank,")"));return D.tile(n,e)}function Hp(n,e,t,r,a){return e===void 0&&(e=0),t===void 0&&(t=1),D.randomNormal(n,e,t,r,a)}function Ri(n,e,t,r){if(n.rank<2||e.rank<2)throw new pt("dot requires both inputs to be rank >= 2"+" but got x shape = ".concat(n.shape," and y shape = ").concat(e.shape));if(e.rank>=3){var a=n.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(a!==i)throw new pt("If rank y >= 3, then the second last dim"+" of y must equal the last dim of x but got x shape = ".concat(n.shape," and ")+" y shape = ".concat(e.shape))}if(n.rank===2&&e.rank===2){var o=!1,s=!1;return D.fused.matMul({a:n,b:e,transposeA:o,transposeB:s,bias:r?_y(n.rank,r,fi()):null,activation:t})}else{var u=n.shape.slice(),c=u.pop();n=D.reshape(n,[-1,c]);var l=e.shape.slice(),f=l.pop(),i=l.pop(),h=Qe(Qe([],te(l),!1),[f],!1),d=Array.from({length:e.rank},function(y,b){return b===0?e.rank-2:b<=e.rank-2?b-1:b});e=D.reshape(D.transpose(e,d),[i,-1]);var p=Qe(Qe([],te(u),!1),te(h),!1),o=!1,s=!1;return D.reshape(D.fused.matMul({a:n,b:e,transposeA:o,transposeB:s,bias:r?_y(n.rank,r,fi()):null,activation:t}),p)}}function VO(n,e,t){return R.tidy(function(){return Array.isArray(e)?e=R.tensor1d(e,"int32"):e=D.cast(e,"int32"),D.gather(n,e,t)})}function _f(n){return D.mul(n,n)}function _y(n,e,t){var r=e.shape;if(e.rank!==1&&e.rank!==n)throw new J("Unexpected bias dimensions: ".concat(e.rank)+"; expected it to be 1 or ".concat(n));if(n===5){if(t==="channelsFirst")return r.length===1?D.reshape(e,[1,r[0],1,1,1]):D.reshape(e,[1,r[3],r[0],r[1],r[2]]);if(t==="channelsLast")return r.length===1?D.reshape(e,[1,1,1,1,r[0]]):D.reshape(e,[1].concat(r))}else if(n===4){if(t==="channelsFirst")return r.length===1?D.reshape(e,[1,r[0],1,1]):D.reshape(e,[1,r[2],r[0],r[1]]);if(t==="channelsLast")return r.length===1?D.reshape(e,[1,1,1,r[0]]):D.reshape(e,[1].concat(r))}else if(n===3){if(t==="channelsFirst")return r.length===1?D.reshape(e,[1,r[0],1]):D.reshape(e,[1,r[1],r[0]]);if(t==="channelsLast")return r.length===1?D.reshape(e,[1,1,r[0]]):D.reshape(e,[1].concat(r))}else if(n<3)return e;throw new J("Unsupported input rank by biasAdd: ".concat(e.rank))}function pi(n,e,t){return R.tidy(function(){return t==null&&(t=fi()),_n(t),D.add(n,_y(n.rank,e,t))})}function Sfe(n,e){if(e===void 0&&(e=1),e!==1)throw new pt("Support for alpha values other than 1 (".concat(e,") is not implemented ")+"yet.");return D.elu(n)}function Nfe(n){return R.tidy(function(){return D.div(n,D.add(D.abs(n),1))})}function GO(n,e,t,r){return R.tidy(function(){return D.dropout(n,e,t,r)})}function Tfe(n){return R.tidy(function(){var e=D.add(.5,D.mul(.2,n));return D.clipByValue(e,0,1)})}function Ff(n,e,t){return t===void 0&&(t=!1),t?n():e()}var Efe=["fanIn","fanOut","fanAvg"],Ife=["normal","uniform","truncatedNormal"];function Cfe(n){Bs(Efe,"FanMode",n)}function Afe(n){Bs(Ife,"Distribution",n)}var Ba=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.fromConfigUsesCustomObjects=function(){return!1},e.prototype.getConfig=function(){return{}},e}(R.serialization.Serializable),Yy=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t,r){return R.zeros(t,r)},e}(Ba);Yy.className="Zeros";R.serialization.registerClass(Yy);var Kp=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t,r){return R.ones(t,r)},e}(Ba);Kp.className="Ones";R.serialization.registerClass(Kp);var Zy=function(n){se(e,n);function e(t){var r=n.call(this)||this;if(typeof t!="object")throw new J("Expected argument of type ConstantConfig but got ".concat(t));if(t.value===void 0)throw new J("config must have value set but got ".concat(t));return r.value=t.value,r}return e.prototype.apply=function(t,r){var a=this;return R.tidy(function(){return R.mul(R.scalar(a.value),R.ones(t,r))})},e.prototype.getConfig=function(){return{value:this.value}},e}(Ba);Zy.className="Constant";R.serialization.registerClass(Zy);var Jy=function(n){se(e,n);function e(t){var r=n.call(this)||this;return r.DEFAULT_MINVAL=-.05,r.DEFAULT_MAXVAL=.05,r.minval=t.minval||r.DEFAULT_MINVAL,r.maxval=t.maxval||r.DEFAULT_MAXVAL,r.seed=t.seed,r}return e.prototype.apply=function(t,r){return R.randomUniform(t,this.minval,this.maxval,r,this.seed)},e.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},e}(Ba);Jy.className="RandomUniform";R.serialization.registerClass(Jy);var Qy=function(n){se(e,n);function e(t){var r=n.call(this)||this;return r.DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=t.mean||r.DEFAULT_MEAN,r.stddev=t.stddev||r.DEFAULT_STDDEV,r.seed=t.seed,r}return e.prototype.apply=function(t,r){if(r=r||"float32",r!=="float32"&&r!=="int32")throw new pt("randomNormal does not support dType ".concat(r,"."));return Hp(t,this.mean,this.stddev,r,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e}(Ba);Qy.className="RandomNormal";R.serialization.registerClass(Qy);var eb=function(n){se(e,n);function e(t){var r=n.call(this)||this;return r.DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=t.mean||r.DEFAULT_MEAN,r.stddev=t.stddev||r.DEFAULT_STDDEV,r.seed=t.seed,r}return e.prototype.apply=function(t,r){if(r=r||"float32",r!=="float32"&&r!=="int32")throw new pt("truncatedNormal does not support dType ".concat(r,"."));return R.truncatedNormal(t,this.mean,this.stddev,r,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e}(Ba);eb.className="TruncatedNormal";R.serialization.registerClass(eb);var tb=function(n){se(e,n);function e(t){var r=n.call(this)||this;return r.gain=t.gain!=null?t.gain:1,r}return e.prototype.apply=function(t,r){var a=this;return R.tidy(function(){if(t.length!==2||t[0]!==t[1])throw new J("Identity matrix initializer can only be used for 2D square matrices.");return R.mul(a.gain,R.eye(t[0]))})},e.prototype.getConfig=function(){return{gain:this.gain}},e}(Ba);tb.className="Identity";R.serialization.registerClass(tb);function Dfe(n,e){e===void 0&&(e="channelsLast");var t,r;if(_n(e),n.length===2)t=n[0],r=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){var a=$o(n,2);t=n[1]*a,r=n[0]*a}else if(e==="channelsLast"){var a=$o(n,0,n.length-2);t=n[n.length-2]*a,r=n[n.length-1]*a}}else{var i=$o(n);t=Math.sqrt(i),r=Math.sqrt(i)}return[t,r]}var Cr=function(n){se(e,n);function e(t){var r=n.call(this)||this;if(t.scale<0)throw new J("scale must be a positive float. Got: ".concat(t.scale));return r.scale=t.scale==null?1:t.scale,r.mode=t.mode==null?"fanIn":t.mode,Cfe(r.mode),r.distribution=t.distribution==null?"normal":t.distribution,Afe(r.distribution),r.seed=t.seed,r}return e.prototype.apply=function(t,r){var a=Dfe(t),i=a[0],o=a[1],s=this.scale;if(this.mode==="fanIn"?s/=Math.max(1,i):this.mode==="fanOut"?s/=Math.max(1,o):s/=Math.max(1,(i+o)/2),this.distribution==="normal"){var u=Math.sqrt(s);if(r=r||"float32",r!=="float32"&&r!=="int32")throw new pt("".concat(this.getClassName()," does not support dType ").concat(r,"."));return R.truncatedNormal(t,0,u,r,this.seed)}else{var c=Math.sqrt(3*s);return R.randomUniform(t,-c,c,r,this.seed)}},e.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},e}(Ba);Cr.className="VarianceScaling";R.serialization.registerClass(Cr);var jp=function(n){se(e,n);function e(t){return n.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Cr.className},e}(Cr);jp.className="GlorotUniform";R.serialization.registerClass(jp);var Xp=function(n){se(e,n);function e(t){return n.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Cr.className},e}(Cr);Xp.className="GlorotNormal";R.serialization.registerClass(Xp);var Yp=function(n){se(e,n);function e(t){return n.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Cr.className},e}(Cr);Yp.className="HeNormal";R.serialization.registerClass(Yp);var Zp=function(n){se(e,n);function e(t){return n.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Cr.className},e}(Cr);Zp.className="HeUniform";R.serialization.registerClass(Zp);var Jp=function(n){se(e,n);function e(t){return n.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Cr.className},e}(Cr);Jp.className="LeCunNormal";R.serialization.registerClass(Jp);var Qp=function(n){se(e,n);function e(t){return n.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Cr.className},e}(Cr);Qp.className="LeCunUniform";R.serialization.registerClass(Qp);var nb=function(n){se(e,n);function e(t){var r=n.call(this)||this;if(r.DEFAULT_GAIN=1,r.gain=t.gain==null?r.DEFAULT_GAIN:t.gain,r.seed=t.seed,r.seed!=null)throw new pt("Random seed is not implemented for Orthogonal Initializer yet.");return r}return e.prototype.apply=function(t,r){var a=this;return R.tidy(function(){if(t.length<2)throw new pt("Shape must be at least 2D.");t[0]*t[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more "+"than 2000 (".concat(t[0]*t[1],") elements: ")+"Slowness may result.");var i=t[0]>t[1]?[t[1],t[0]]:t,o=Hp(i,0,1,"float32"),s=R.linalg.gramSchmidt(o);return t[0]>t[1]&&(s=R.transpose(s)),R.mul(a.gain,s)})},e.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},e}(Ba);nb.className="Orthogonal";R.serialization.registerClass(nb);var LR={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function zR(n,e){return e===void 0&&(e={}),Af(n,R.serialization.SerializationMap.getMap().classNameMap,e,"initializer")}function mn(n){return Ky(n)}function cn(n){if(typeof n=="string"){var e=n in LR?LR[n]:n;if(e==="GlorotNormal")return new Xp;if(e==="GlorotUniform")return new jp;if(e==="HeNormal")return new Yp;if(e==="HeUniform")return new Zp;if(e==="LeCunNormal")return new Jp;if(e==="LeCunUniform")return new Qp;var t={};return t.className=e,t.config={},zR(t)}else return n instanceof Ba?n:zR(n)}function Fy(n){return Array.isArray(n)&&Array.isArray(n[0])}function Ip(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function it(n){var e;if(Array.isArray(n)){if(n.length!==1)throw new J("Expected Tensor length to be 1; got ".concat(n.length));e=n[0]}else e=n;return e}function It(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new J("Expected exactly 1 Shape; got ".concat(n.length))}else return n}function Cp(n){var e,t,r=0;try{for(var a=fe(n),i=a.next();!i.done;i=a.next()){var o=i.value;o.shape.length===0?r+=1:r+=o.shape.reduce(function(s,u){return s*u})}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return r}var $R="Variable",UO=function(){function n(e,t,r,a,i){t===void 0&&(t="float32"),r===void 0&&(r=$R),a===void 0&&(a=!0),i===void 0&&(i=null),this.dtype=t??"float32",this.shape=e.shape,this.id=LO(),r=r??$R,this.originalName=$O(r),this.name=qO(this.originalName),this.trainable_=a,this.constraint=i,this.val=D.variable(e,this.trainable_,this.name,this.dtype)}return n.prototype.read=function(){return this.assertNotDisposed(),this.val},n.prototype.write=function(e){return this.assertNotDisposed(),_fe(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this},n.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},n.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))},Object.defineProperty(n.prototype,"trainable",{get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e},enumerable:!1,configurable:!0}),n}();function _fe(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function Ry(n){return n.map(function(e){return e.read()})}function rb(n){n.forEach(function(e){var t=e[0];t.write(e[1])})}var Ln=function(){function n(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}return n}(),si=function(){function n(e,t,r,a,i,o,s){this.dtype=e,this.shape=t,this.sourceLayer=r,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=LO(),o!=null&&(this.originalName=$O(o),this.name=qO(this.originalName)),this.rank=t.length}return n}(),Ffe=0,ev=function(){function n(e,t){var r,a;this.callArgs=t,this.id=Ffe++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;try{for(var i=fe(e.inboundLayers),o=i.next();!o.done;o=i.next()){var s=o.value;s?.outboundNodes.push(this)}}catch(u){r={error:u}}finally{try{o&&!o.done&&(a=i.return)&&a.call(i)}finally{if(r)throw r.error}}e.outboundLayer.inboundNodes.push(this)}return n.prototype.getConfig=function(){var e,t,r=[];try{for(var a=fe(this.inboundLayers),i=a.next();!i.done;i=a.next()){var o=i.value;o!=null?r.push(o.name):r.push(null)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:r,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},n}(),Rfe=0,gt=function(n){se(e,n);function e(t){t===void 0&&(t={});var r=n.call(this)||this;r._callHook=null,r._addedWeightNames=[],r._stateful=!1,r.id=Rfe++,r.activityRegularizer=null,r.inputSpec=null,r.supportsMasking=!1,r._trainableWeights=[],r._nonTrainableWeights=[],r._losses=[],r._updates=[],r._built=!1,r.inboundNodes=[],r.outboundNodes=[];var a=t.name;if(!a){var i=r.getClassName();a=eo(i)+"_"+Up(i)}if(r.name=a,r.trainable_=t.trainable==null?!0:t.trainable,t.inputShape!=null||t.batchInputShape!=null){var o=void 0;if(t.batchInputShape!=null)o=t.batchInputShape;else if(t.inputShape!=null){var s=null;t.batchSize!=null&&(s=t.batchSize),o=[s].concat(t.inputShape)}r.batchInputShape=o;var u=t.dtype;u==null&&(u=t.inputDType),u==null&&(u="float32"),r.dtype=u}return t.weights!=null?r.initialWeights=t.weights:r.initialWeights=null,r._refCount=null,r.fastWeightInitDuringBuild=!1,r}return e.nodeKey=function(t,r){return t.name+"_ib-"+r.toString()},e.prototype.getNodeAtIndex=function(t,r){if(this.inboundNodes.length===0)throw new _i("The layer has never been called "+"and thus has no defined ".concat(r,"."));if(this.inboundNodes.length<=t)throw new J("Asked to get ".concat(r," at node ").concat(t,", ")+"but the layer has only ".concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[t]},e.prototype.getInputAt=function(t){return Ir(this.getNodeAtIndex(t,"input").inputTensors)},e.prototype.getOutputAt=function(t){return Ir(this.getNodeAtIndex(t,"output").outputTensors)},Object.defineProperty(e.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new Lo("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(this.inboundNodes.length===0)throw new Lo("Layer ".concat(this.name)+" is not connected, no input to return.");return Ir(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){if(this.inboundNodes.length===0)throw new Lo("Layer ".concat(this.name)+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new Lo("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return Ir(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this._losses},enumerable:!1,configurable:!0}),e.prototype.calculateLosses=function(){return this.losses.map(function(t){return t()})},Object.defineProperty(e.prototype,"updates",{get:function(){return this._updates},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"built",{get:function(){return this._built},set:function(t){this._built=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this._trainableWeights.forEach(function(r){return r.trainable=t}),this.trainable_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable_?this._trainableWeights.filter(function(t){return t.trainable}):[]},set:function(t){this._trainableWeights=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._trainableWeights.filter(function(t){return!t.trainable}).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(t){this._nonTrainableWeights=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stateful",{get:function(){return this._stateful},enumerable:!1,configurable:!0}),e.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},e.prototype.assertInputCompatibility=function(t){if(t=Yt(t),!(this.inputSpec==null||this.inputSpec.length===0)){var r=Yt(this.inputSpec);if(t.length!==r.length)throw new J("Layer ".concat(this.name," expects ").concat(r.length," inputs, ")+"but it received ".concat(t.length," input tensors. ")+"Input received: ".concat(t));for(var a=0;a<t.length;a++){var i=t[a],o=r[a];if(o!=null){var s=i.rank;if(o.ndim!=null&&s!==o.ndim)throw new J("Input ".concat(a," is incompatible with layer ").concat(this.name,": ")+"expected ndim=".concat(o.ndim,", found ndim=").concat(s));if(o.maxNDim!=null&&s>o.maxNDim)throw new J("Input ".concat(a," is incompatible with layer ").concat(this.name)+": expected max_ndim=".concat(o.maxNDim,", found ndim=").concat(s));if(o.minNDim!=null&&s<o.minNDim)throw new J("Input ".concat(a," is incompatible with layer ").concat(this.name)+": expected min_ndim=".concat(o.minNDim,", found ndim=").concat(s,"."));if(o.dtype!=null&&i.dtype!==o.dtype)throw new J("Input ".concat(a," is incompatible with layer ").concat(this.name," ")+": expected dtype=".concat(o.dtype,", found dtype=").concat(i.dtype,"."));if(o.axes){var u=i.shape;for(var c in o.axes){var l=Number(c),f=o.axes[c],h=l>=0?u[l]:u[u.length+l];if(f!=null&&[f,null].indexOf(h)===-1)throw new J("Input ".concat(a," is incompatible with layer ")+"".concat(this.name,": expected axis ").concat(l," of input shape to ")+"have value ".concat(f," but got shape ").concat(u,"."))}}if(o.shape!=null)for(var d=0;d<o.shape.length;++d){var p=o.shape[d],v=i.shape[d];if(p!=null&&v!=null&&p!==v)throw new J("Input ".concat(a," is incompatible with layer ")+"".concat(this.name,": expected shape=").concat(o.shape,", ")+"found shape=".concat(i.shape,"."))}}}}},e.prototype.call=function(t,r){return t},e.prototype.invokeCallHook=function(t,r){this._callHook!=null&&this._callHook(t,r)},e.prototype.setCallHook=function(t){this._callHook=t},e.prototype.clearCallHook=function(){this._callHook=null},e.prototype.apply=function(t,r){var a,i,o,s,u=this;r=r||{},this.assertNotDisposed();var c=Yt(t),l=!0;try{for(var f=fe(c),h=f.next();!h.done;h=f.next()){var d=h.value;if(!(d instanceof si)){l=!1;break}}}catch(g){a={error:g}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}var p=!0;try{for(var v=fe(c),m=v.next();!m.done;m=v.next()){var d=m.value;if(d instanceof si){p=!1;break}}}catch(g){o={error:g}}finally{try{m&&!m.done&&(s=v.return)&&s.call(v)}finally{if(o)throw o.error}}if(l===p)throw new J("Arguments to apply() must be all SymbolicTensors or all Tensors");return Rs(this.name,function(){var g,y,b,w;if(!u.built){u.assertInputCompatibility(t);var x=[];try{for(var N=fe(Yt(t)),T=N.next();!T.done;T=N.next()){var E=T.value;x.push(E.shape)}}catch(X){g={error:X}}finally{try{T&&!T.done&&(y=N.return)&&y.call(N)}finally{if(g)throw g.error}}u.build(Ir(x)),u.built=!0,u.initialWeights&&u.setWeights(u.initialWeights),u._refCount===null&&p&&(u._refCount=1)}if(u.assertInputCompatibility(t),p){var C=u.call(t,r),F=Yt(C),_=[];try{for(var O=fe(F),L=O.next();!L.done;L=O.next()){var z=L.value;c.indexOf(z)!==-1&&(z=z.clone()),_.push(z)}}catch(X){b={error:X}}finally{try{L&&!L.done&&(w=O.return)&&w.call(O)}finally{if(b)throw b.error}}if(C=Ir(_),u.activityRegularizer!=null)throw new pt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return C}else{var $=Ofe(t),B=u.computeOutputShape($),C=void 0,W=Pfe(t);if(u.warnOnIncompatibleInputShape(Array.isArray(t)?$[0]:$),B!=null&&B.length>0&&Array.isArray(B[0])?C=B.map(function(Z,V){return new si(W,Z,u,Yt(t),r,u.name,V)}):C=new si(W,B,u,Yt(t),r,u.name),u.addInboundNode(t,C,null,null,$,B,r),u._refCount++,u.activityRegularizer!=null)throw new pt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return C}})},e.prototype.warnOnIncompatibleInputShape=function(t){if(this.batchInputShape!=null)if(t.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+"".concat(JSON.stringify(t),") does not match that of the ")+"batchInputShape (".concat(JSON.stringify(this.batchInputShape),") ")+"of the layer ".concat(this.name));else{var r=!1;this.batchInputShape.forEach(function(a,i){a!=null&&t[i]!=null&&t[i]!==a&&(r=!0)}),r&&console.warn("The shape of the input tensor "+"(".concat(JSON.stringify(t),") does not ")+"match the expectation of layer ".concat(this.name,": ")+"".concat(JSON.stringify(this.batchInputShape)))}},Object.defineProperty(e.prototype,"outputShape",{get:function(){var t,r;if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Lo("The layer ".concat(this.name," has never been called and thus has no ")+"defined output shape.");var a=[];try{for(var i=fe(this.inboundNodes),o=i.next();!o.done;o=i.next()){var s=o.value,u=JSON.stringify(s.outputShapes);a.indexOf(u)===-1&&a.push(u)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}if(a.length===1){var c=this.inboundNodes[0].outputShapes;return Array.isArray(c)&&Array.isArray(c[0])&&c.length===1?c[0]:c}else throw new Lo("The layer ".concat(this.name," has multiple inbound nodes with different ")+'output shapes. Hence the notion of "output shape" is ill-defined for the layer.')},enumerable:!1,configurable:!0}),e.prototype.countParams=function(){if(!this.built)throw new _i("You tried to call countParams() on ".concat(this.name,", ")+"but the layer is not built yet. Build it first by calling build(batchInputShape).");return Cp(this.weights)},e.prototype.build=function(t){this.built=!0},e.prototype.getWeights=function(t){return t===void 0&&(t=!1),Ry(t?this.trainableWeights:this.weights)},e.prototype.setWeights=function(t){var r=this;R.tidy(function(){var a=r.weights;if(a.length!==t.length)throw new J('You called setWeights(weights) on layer "'.concat(r.name,'" ')+"with a weight list of length ".concat(t.length,", ")+"but the layer was expecting ".concat(a.length," weights. ")+"Provided weights: ".concat(t,"..."));if(a.length!==0){for(var i=[],o=Ry(a),s=0;s<o.length;++s){var u=o[s],c=a[s],l=t[s];if(!R.util.arraysEqual(u.shape,l.shape))throw new J("Layer weight shape ".concat(u.shape," ")+"not compatible with provided weight shape ".concat(l.shape));i.push([c,l])}rb(i)}})},e.prototype.addWeight=function(t,r,a,i,o,s,u,c){if(this._addedWeightNames.indexOf(t)!==-1)throw new J("Duplicate weight name ".concat(t," for layer ").concat(this.name));this._addedWeightNames.push(t),a==null&&(a="float32"),this.fastWeightInitDuringBuild&&(i=c!=null?c():cn("zeros"));var l=i.apply(r,a),f=new UO(l,a,t,s,u);return l.dispose(),o!=null&&this.addLoss(function(){return o.apply(f.read())}),s==null&&(s=!0),s?this._trainableWeights.push(f):this._nonTrainableWeights.push(f),f},e.prototype.setFastWeightInitDuringBuild=function(t){this.fastWeightInitDuringBuild=t},e.prototype.addLoss=function(t){var r;t==null||Array.isArray(t)&&t.length===0||(t=Yt(t),this._losses!==void 0&&this._losses!==null&&(r=this.losses).push.apply(r,Qe([],te(t),!1)))},e.prototype.computeOutputShape=function(t){return t},e.prototype.computeMask=function(t,r){var a=this;if(!this.supportsMasking){if(r!=null)if(Array.isArray(r))r.forEach(function(i){if(i!=null)throw new TypeError("Layer ".concat(a.name," does not support masking, ")+"but was passed an inputMask.")});else throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.");return null}return r},e.prototype.addInboundNode=function(t,r,a,i,o,s,u){var c,l;u===void 0&&(u=null);var f=Yt(t);r=Yt(r),a=Yt(a),i=Yt(i),o=Ip(o),s=Ip(s);var h=[],d=[],p=[];try{for(var v=fe(f),m=v.next();!m.done;m=v.next()){var g=m.value;h.push(g.sourceLayer),d.push(g.nodeIndex),p.push(g.tensorIndex)}}catch(b){c={error:b}}finally{try{m&&!m.done&&(l=v.return)&&l.call(v)}finally{if(c)throw c.error}}new ev({outboundLayer:this,inboundLayers:h,nodeIndices:d,tensorIndices:p,inputTensors:f,outputTensors:r,inputMasks:a,outputMasks:i,inputShapes:o,outputShapes:s},u);for(var y=0;y<r.length;y++)r[y].sourceLayer=this,r[y].nodeIndex=this.inboundNodes.length-1,r[y].tensorIndex=y},e.prototype.getConfig=function(){var t={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(t.batchInputShape=this.batchInputShape),this.dtype!=null&&(t.dtype=this.dtype),t},e.prototype.disposeWeights=function(){return this.weights.forEach(function(t){return t.dispose()}),this.weights.length},e.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Layer '".concat(this.name,"' is already disposed."))},e.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been ")+"built yet.");if(this._refCount===null)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used ")+"yet.");this.assertNotDisposed();var t=0;return--this._refCount===0&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}},e}(R.serialization.Serializable);function Ofe(n){var e,t;n=Yt(n);var r=[];try{for(var a=fe(n),i=a.next();!i.done;i=a.next()){var o=i.value;r.push(o.shape)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return Ir(r)}function Pfe(n){return"float32"}function HO(n,e,t){var r,a;if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];var i=e.inboundNodes[t];if(i.inboundLayers.length===0)return i.inputTensors;for(var o=[],s=0;s<i.inboundLayers.length;s++){var u=i.inputTensors[s],c=i.inboundLayers[s],l=i.nodeIndices[s],f=HO(u,c,l);try{for(var h=(r=void 0,fe(f)),d=h.next();!d.done;d=h.next()){var p=d.value;o.indexOf(p)===-1&&o.push(p)}}catch(v){r={error:v}}finally{try{d&&!d.done&&(a=h.return)&&a.call(h)}finally{if(r)throw r.error}}}return o}var vc=function(n){se(e,n);function e(t){var r=n.call(this,{dtype:t.dtype,name:t.name!=null?t.name:Up("input").toString()})||this;if(t.batchSize==null&&(t.batchSize=null),t.sparse==null&&(t.sparse=!1),r.trainable=!1,r.built=!0,r.sparse=t.sparse,t.inputShape!=null&&t.batchInputShape!=null)throw new J("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=t.batchInputShape;if(a==null){if(t.inputShape==null)throw new J("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[t.batchSize].concat(t.inputShape)}else if(t.batchSize!=null)throw new J("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=t.dtype||"float32";r.batchInputShape=a,r.dtype=i,r.inputSpec=[{shape:a}];var o=new si(r.dtype,r.batchInputShape,r,[],{},r.name);return o.nodeIndex=0,o.tensorIndex=0,new ev({outboundLayer:r,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),r}return e.prototype.apply=function(t,r){throw new J("Cannot pass any input to an "+"InputLayer's apply() method. InputLayer name: ".concat(this.name))},e.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},e.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},e}(gt);vc.className="InputLayer";R.serialization.registerClass(vc);function KO(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new J("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));var t=n.dtype;t==null&&(t="float32");var r=new vc({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}),a=r.inboundNodes[0].outputTensors;return a[0]}function Mfe(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return R.cast(e,n.dtype)}catch{throw new J("The dtype of the feed (".concat(e.dtype,") can not be cast to the dtype ")+"of the key '".concat(n.name,"' (").concat(n.dtype,")."))}}var sc=function(){function n(e){var t,r;if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof n)for(var a in e.id2Value)this.id2Value[a]=e.id2Value[a],a in e.id2Mask&&(this.id2Mask[a]=e.id2Mask[a]);else{if(e==null)return;try{for(var i=fe(e),o=i.next();!o.done;o=i.next()){var s=o.value;this.add(s.key,s.value)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}}}return n.prototype.add=function(e,t,r){if(this.id2Value[e.id]==null)this.id2Value[e.id]=Mfe(e,t),this.name2Id[e.name]=e.id,r!=null&&(this.id2Mask[e.id]=r);else throw new J("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this},n.prototype.addFeed=function(e){this.add(e.key,e.value)},n.prototype.hasKey=function(e){return this.id2Value[e.id]!=null},n.prototype.names=function(){return Object.keys(this.name2Id)},n.prototype.getValue=function(e){if(e instanceof si){if(this.id2Value[e.id]==null)throw new J("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}else{var t=this.name2Id[e];if(t==null)throw new J("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}},n.prototype.getMask=function(e){if(e instanceof si){if(this.id2Value[e.id]==null)throw new J("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}else{var t=this.name2Id[e];if(t==null)throw new J("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}},n.prototype.disposeMasks=function(){this.id2Mask!=null&&R.dispose(this.id2Mask)},n}(),Ap=new PO,Dp=new PO;function Bfe(n){Ap?.setMaxEntries(n),Dp?.setMaxEntries(n)}function bf(n,e,t,r){var a,i,o,s,u=t==null?!1:t.training,c=Array.isArray(n),l=c?n:[n],f=l.map(function(le){return le.name}),h=[],d=e.names();try{for(var p=fe(f),v=p.next();!v.done;v=p.next()){var m=v.value;d.indexOf(m)!==-1?h.push(e.getValue(m)):h.push(null)}}catch(le){a={error:le}}finally{try{v&&!v.done&&(i=p.return)&&i.call(p)}finally{if(a)throw a.error}}r!=null&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);var g=f.join(",")+"|"+e.names().sort().join(","),y=Ap.get(g),b;if(y==null){var w=Lfe(l,e);y=w.sorted,b=w.recipientCounts,Ap.put(g,y),Dp.put(g,b)}b={},u||Object.assign(b,Dp.get(g));for(var x=new sc(e),N=0;N<y.length;++N){if(r!=null){var T=R.memory().numTensors;T>r.maxNumTensors&&(r.maxNumTensors=T),T<r.minNumTensors&&(r.minNumTensors=T)}var E=y[N],C=E.sourceLayer;if(!(C instanceof vc)){var F=[],_=[],O=[],L=!1;try{for(var z=(o=void 0,fe(E.inputs)),$=z.next();!$.done;$=z.next()){var B=$.value,W=x.getValue(B),X=x.getMask(B);F.push(W),_.push(X),X!=null&&(L=!0),u||(b[B.name]--,b[B.name]===0&&!e.hasKey(B)&&f.indexOf(B.name)===-1&&!W.isDisposed&&B.sourceLayer.stateful!==!0&&O.push(W))}}catch(le){o={error:le}}finally{try{$&&!$.done&&(s=z.return)&&s.call(z)}finally{if(o)throw o.error}}L&&(t=t||{},t.mask=_[0]);var Z=Yt(C.apply(F,t)),V=null;C.supportsMasking&&(V=C.computeMask(F,_));for(var j=$fe(E),re=Array.isArray(j)?j:[j],ne=0;ne<re.length;++ne){x.hasKey(re[ne])||x.add(re[ne],Z[ne],Array.isArray(V)?V[0]:V);var oe=f.indexOf(re[ne].name);oe!==-1&&(h[oe]=Z[ne])}u||R.dispose(O)}}return x.disposeMasks(),c?h:h[0]}function Lfe(n,e){var t,r,a,i;R.util.assert(n!=null&&n.length>0,function(){return"Expected at least one fetch, got none"});var o=[],s={};if(n.length===1){var u=qR(n[0],e);o=u.sorted,s=u.recipientMap}else{var c=new Set;try{for(var l=fe(n),f=l.next();!f.done;f=l.next()){var h=f.value,d=qR(h,e),p=d.sorted,v=d.recipientMap;try{for(var m=(a=void 0,fe(p)),g=m.next();!g.done;g=m.next()){var y=g.value;c.has(y.name)||(o.push(y),c.add(y.name))}}catch(x){a={error:x}}finally{try{g&&!g.done&&(i=m.return)&&i.call(m)}finally{if(a)throw a.error}}var b=function(x){s[x]==null&&(s[x]=new Set),v[x].forEach(function(N){return s[x].add(N)})};for(var w in v)b(w)}}catch(x){t={error:x}}finally{try{f&&!f.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}}return{sorted:o,recipientCounts:zfe(s)}}function zfe(n){var e={};for(var t in n)e[t]=n[t].size;return e}function qR(n,e){var t,r,a,i,o=new Set,s=[],u={};try{for(var c=fe(e.names()),l=c.next();!l.done;l=c.next()){var f=l.value;o.add(f)}}catch(b){t={error:b}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}var h=[],d=[];for(h.push(n);h.length>0;){var p=h[h.length-1];if(o.has(p.name)){h.pop();continue}var v=d[d.length-1]===h.length-1;if(p.inputs.length===0||v)h.pop(),s.push(p),o.add(p.name),v&&d.pop();else{d.push(h.length-1);try{for(var m=(a=void 0,fe(p.inputs)),g=m.next();!g.done;g=m.next()){var y=g.value;u[y.name]==null&&(u[y.name]=new Set),u[y.name].add(p.name),!o.has(y.name)&&h.push(y)}}catch(b){a={error:b}}finally{try{g&&!g.done&&(i=m.return)&&i.call(m)}finally{if(a)throw a.error}}}}return{sorted:s,recipientMap:u}}function $fe(n){var e,t,r;if(n.sourceLayer.inboundNodes.length===1)r=n.sourceLayer.output;else{for(var a=null,i=0;i<n.sourceLayer.inboundNodes.length;++i)try{for(var o=(e=void 0,fe(n.sourceLayer.inboundNodes[i].outputTensors)),s=o.next();!s.done;s=o.next()){var u=s.value;if(u.id===n.id){a=i;break}}}catch(c){e={error:c}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}r=n.sourceLayer.getOutputAt(a)}return r}var qfe=R.env();qfe.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",function(){return 100},Bfe);var jO="Abs",Wfe="Acos",Vfe="Acosh",ab="Add",Gfe="AddN",Ufe="ArgMax",Hfe="ArgMin",Kfe="Asin",jfe="Asinh",Xfe="Atan",Yfe="Atanh",Zfe="Atan2",Jfe="AvgPool",Qfe="AvgPoolGrad",ehe="AvgPool3D",the="AvgPool3DGrad",XO="BatchMatMul",YO="BatchToSpaceND",nhe="BroadcastTo",ib="Cast",rhe="Ceil",ahe="ClipByValue",ihe="Complex",ZO="ComplexAbs",JO="Concat",QO="Conv2D",ohe="Conv2DBackpropFilter",eP="Conv2DBackpropInput",she="Conv3D",uhe="Conv3DBackpropFilterV2",che="Conv3DBackpropInputV2",tP="Cos",nP="Cosh",lhe="Cumprod",rP="Cumsum",fhe="DepthwiseConv2dNative",hhe="DepthwiseConv2dNativeBackpropFilter",dhe="DepthwiseConv2dNativeBackpropInput",phe="Dilation2D",vhe="Dilation2DBackpropInput",mhe="Dilation2DBackpropFilter",aP="RealDiv",ghe="Elu",yhe="EluGrad",bhe="Erf",whe="Equal",iP="Exp",oP="ExpandDims",xhe="Expm1",khe="Fill",sP="Floor",uP="FloorDiv",She="FusedBatchNorm",cP="GatherV2",Nhe="Greater",lP="GreaterEqual",ob="Identity",The="Imag",Ehe="IsFinite",Ihe="IsInf",Che="IsNan",Ahe="LeakyRelu",Dhe="Less",_he="LessEqual",fP="Log",Fhe="Log1p",Rhe="LogicalAnd",Ohe="LogicalNot",Phe="LogSoftmax",Mhe="LRN",Bhe="LRNGrad",Lhe="Max",hP="Maximum",zhe="MaxPool",$he="MaxPoolGrad",qhe="MaxPool3D",Whe="MaxPool3DGrad",Vhe="Mean",Ghe="Min",Uhe="Minimum",Hhe="MirrorPad",Khe="Mod",dP="Multiply",pP="Neg",jhe="OnesLike",Xhe="OneHot",vP="Pack",mP="PadV2",gP="Pow",Yhe="Prelu",Zhe="Prod",Jhe="Real",Qhe="Reciprocal",ede="Relu",yP="Reshape",tde="ResizeNearestNeighbor",nde="ResizeNearestNeighborGrad",rde="ResizeBilinear",ade="ResizeBilinearGrad",ide="Relu6",bP="Reverse",ode="Round",wP="Rsqrt",xP="Select",sde="Selu",kP="Slice",SP="Sin",NP="Sinh",ude="Sign",TP="Sigmoid",cde="Softplus",EP="Sqrt",IP="Sum",CP="SpaceToBatchND",AP="SplitV",lde="Softmax",fde="SquaredDifference",hde="Square",DP="Sub",dde="Tan",pde="Tanh",sb="Tile",Sp="Transpose",_P="Unpack",FP="UnsortedSegmentSum",RP="ZerosLike",OP="Step";var vde=1e-7,mde=1e-4,gde=function(){function n(){}return n.prototype.refCount=function(e){return Kr("refCount")},n.prototype.incRef=function(e){return Kr("incRef")},n.prototype.timerAvailable=function(){return!0},n.prototype.time=function(e){return Kr("time")},n.prototype.read=function(e){return Kr("read")},n.prototype.readSync=function(e){return Kr("readSync")},n.prototype.readToGPU=function(e,t){return Kr("readToGPU")},n.prototype.numDataIds=function(){return Kr("numDataIds")},n.prototype.disposeData=function(e,t){return Kr("disposeData")},n.prototype.write=function(e,t,r){return Kr("write")},n.prototype.move=function(e,t,r,a,i){return Kr("move")},n.prototype.createTensorFromGPUData=function(e,t,r){return Kr("createTensorFromGPUData")},n.prototype.memory=function(){return Kr("memory")},n.prototype.floatPrecision=function(){return Kr("floatPrecision")},n.prototype.epsilon=function(){return this.floatPrecision()===32?vde:mde},n.prototype.dispose=function(){return Kr("dispose")},n}();function Kr(n){throw new Error("'".concat(n,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function Se(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function yde(n,e,t){t===void 0&&(t=""),Se(ub(n,e),function(){return t+" Shapes ".concat(n," and ").concat(e," must match")})}function Oi(n){if(n.length===0)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function ub(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function _p(n){return n%1===0}function Np(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function Ls(n,e){var t=e.length;return n=n==null?e.map(function(r,a){return a}):[].concat(n),Se(n.every(function(r){return r>=-t&&r<t}),function(){return"All values in axis param must be in range [-".concat(t,", ").concat(t,") but ")+"got axis ".concat(n)}),Se(n.every(function(r){return _p(r)}),function(){return"All values in axis param must be integers but "+"got axis ".concat(n)}),n.map(function(r){return r<0?t+r:r})}function bde(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error("Unknown data type ".concat(n));return t}function wde(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(e," being uploaded contains ").concat(r,"."))}}function xde(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function Oy(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype ".concat(n))}function kde(n){if(n==null)return 0;var e=0;return n.forEach(function(t){return e+=t.length}),e}function cb(n){return typeof n=="string"||n instanceof String}function Sde(n){return typeof n=="boolean"}function Nde(n){return typeof n=="number"}function lb(n){return Array.isArray(n)?lb(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":Nde(n)?"float32":cb(n)?"string":Sde(n)?"bool":"float32"}function Py(n){return!!(n&&n.constructor&&n.call&&n.apply)}function fb(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function PP(n,e,t,r){r===void 0&&(r=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(r?2:1),o=0;o<i;o++)a[o]=t[n+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(l,f){return l*f})*(r?2:1),o=0;o<i;o++)a[o]=PP(n+o*u,s,t,r);return a}function WR(n,e,t){if(t===void 0&&(t=!1),n.length===0)return e[0];var r=n.reduce(function(a,i){return a*i})*(t?2:1);if(r===0)return[];if(r!==e.length)throw new Error("[".concat(n,"] does not match the input size ").concat(e.length).concat(t?" for a complex tensor":"","."));return PP(0,n,e,t)}function MP(n,e){for(var t=hb(n,e),r=0;r<t.length;r++)t[r]=1;return t}function hb(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error("Unknown data type ".concat(e))}function Rf(n){n.forEach(function(e){Se(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(n,"].")})})}function db(n){return n&&n.then&&typeof n.then=="function"}var VR="tfjsflags",Tde=function(){function n(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Ede,this.populateURLFlags()}return n.prototype.setPlatform=function(e,t){this.platform!=null&&(Tn().getBool("IS_TEST")||Tn().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t},n.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){var a=this.urlFlags[e];Tn().getBool("IS_TEST")||Tn().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(a,".")),this.set(e,a)}},n.prototype.getAsync=function(e){return Ce(this,void 0,void 0,function(){var t,r;return Ee(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,r=e,[4,this.evaluateFlag(e)]);case 1:return t[r]=a.sent(),[2,this.flags[e]]}})})},n.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(db(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},n.prototype.getNumber=function(e){return this.get(e)},n.prototype.getBool=function(e){return this.get(e)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!1,configurable:!0}),n.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},n.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()},n.prototype.setFlags=function(e){this.flags=Object.assign({},e)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if(VR in t){var r=t[VR].split(",");r.forEach(function(a){var i=te(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=Cde(o,s)})}}},n}();function Ede(n){var e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];return Ide(e,r[0],r[1]),r.join("=")}),e}function Ide(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Cde(n,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if("".concat(+e)===e)return+e;throw new Error("Could not parse value flag value ".concat(e," for flag ").concat(n,"."))}function Tn(){return BP}var BP=null;function Ade(n){BP=n}var by;function LP(){if(by==null){var n=void 0;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");by=n}return by}function Dde(){var n=LP();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function pb(n,e){var t=Dde();if(t.has(n))return t.get(n);var r=e();return t.set(n,r),t.get(n)}function oc(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];Tn().getBool("IS_TEST")||Tn().getBool("PROD")||console.warn.apply(console,Qe([],te(n),!1))}var zP=pb("kernelRegistry",function(){return new Map}),My=pb("gradRegistry",function(){return new Map});function GR(n,e){var t=Fde(n,e);return zP.get(t)}function UR(n){return My.get(n)}function HR(n){for(var e=zP.entries(),t=[];;){var r=e.next(),a=r.done,i=r.value;if(a)break;var o=te(i,2),s=o[0],u=o[1],c=te(s.split("_"),1),l=c[0];l===n&&t.push(u)}return t}function _de(n){var e=n.kernelName;My.has(e)&&Tn().getBool("DEBUG")&&oc("Overriding the gradient for '".concat(e,"'")),My.set(e,n)}function Fde(n,e){return"".concat(e,"_").concat(n)}var By=Zt,Oa=null;try{Oa=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Zt(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}Zt.prototype.__isLong__;Object.defineProperty(Zt.prototype,"__isLong__",{value:!0});function Xr(n){return(n&&n.__isLong__)===!0}Zt.isLong=Xr;var KR={},jR={};function zs(n,e){var t,r,a;return e?(n>>>=0,(a=0<=n&&n<256)&&(r=jR[n],r)?r:(t=Jt(n,(n|0)<0?-1:0,!0),a&&(jR[n]=t),t)):(n|=0,(a=-128<=n&&n<128)&&(r=KR[n],r)?r:(t=Jt(n,n<0?-1:0,!1),a&&(KR[n]=t),t))}Zt.fromInt=zs;function Pa(n,e){if(isNaN(n))return e?Fs:Ma;if(e){if(n<0)return Fs;if(n>=$P)return VP}else{if(n<=-YR)return jr;if(n+1>=YR)return WP}return n<0?Pa(-n,e).neg():Jt(n%hc|0,n/hc|0,e)}Zt.fromNumber=Pa;function Jt(n,e,t){return new Zt(n,e,t)}Zt.fromBits=Jt;var Fp=Math.pow;function vb(n,e,t){if(n.length===0)throw Error("empty string");if(n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return Ma;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var r;if((r=n.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return vb(n.substring(1),e,t).neg();for(var a=Pa(Fp(t,8)),i=Ma,o=0;o<n.length;o+=8){var s=Math.min(8,n.length-o),u=parseInt(n.substring(o,o+s),t);if(s<8){var c=Pa(Fp(t,s));i=i.mul(c).add(Pa(u))}else i=i.mul(a),i=i.add(Pa(u))}return i.unsigned=e,i}Zt.fromString=vb;function vi(n,e){return typeof n=="number"?Pa(n,e):typeof n=="string"?vb(n,e):Jt(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}Zt.fromValue=vi;var XR=1<<16,Rde=1<<24,hc=XR*XR,$P=hc*hc,YR=$P/2,ZR=zs(Rde),Ma=zs(0);Zt.ZERO=Ma;var Fs=zs(0,!0);Zt.UZERO=Fs;var uc=zs(1);Zt.ONE=uc;var qP=zs(1,!0);Zt.UONE=qP;var Ly=zs(-1);Zt.NEG_ONE=Ly;var WP=Jt(-1,2147483647,!1);Zt.MAX_VALUE=WP;var VP=Jt(-1,-1,!0);Zt.MAX_UNSIGNED_VALUE=VP;var jr=Jt(0,-2147483648,!1);Zt.MIN_VALUE=jr;var Fe=Zt.prototype;Fe.toInt=function(){return this.unsigned?this.low>>>0:this.low};Fe.toNumber=function(){return this.unsigned?(this.high>>>0)*hc+(this.low>>>0):this.high*hc+(this.low>>>0)};Fe.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(jr)){var t=Pa(e),r=this.div(t),a=r.mul(t).sub(this);return r.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Pa(Fp(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};Fe.getHighBits=function(){return this.high};Fe.getHighBitsUnsigned=function(){return this.high>>>0};Fe.getLowBits=function(){return this.low};Fe.getLowBitsUnsigned=function(){return this.low>>>0};Fe.getNumBitsAbs=function(){if(this.isNegative())return this.eq(jr)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};Fe.isZero=function(){return this.high===0&&this.low===0};Fe.eqz=Fe.isZero;Fe.isNegative=function(){return!this.unsigned&&this.high<0};Fe.isPositive=function(){return this.unsigned||this.high>=0};Fe.isOdd=function(){return(this.low&1)===1};Fe.isEven=function(){return(this.low&1)===0};Fe.equals=function(e){return Xr(e)||(e=vi(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Fe.eq=Fe.equals;Fe.notEquals=function(e){return!this.eq(e)};Fe.neq=Fe.notEquals;Fe.ne=Fe.notEquals;Fe.lessThan=function(e){return this.comp(e)<0};Fe.lt=Fe.lessThan;Fe.lessThanOrEqual=function(e){return this.comp(e)<=0};Fe.lte=Fe.lessThanOrEqual;Fe.le=Fe.lessThanOrEqual;Fe.greaterThan=function(e){return this.comp(e)>0};Fe.gt=Fe.greaterThan;Fe.greaterThanOrEqual=function(e){return this.comp(e)>=0};Fe.gte=Fe.greaterThanOrEqual;Fe.ge=Fe.greaterThanOrEqual;Fe.compare=function(e){if(Xr(e)||(e=vi(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Fe.comp=Fe.compare;Fe.negate=function(){return!this.unsigned&&this.eq(jr)?jr:this.not().add(uc)};Fe.neg=Fe.negate;Fe.add=function(e){Xr(e)||(e=vi(e));var t=this.high>>>16,r=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,d=0;return d+=i+c,h+=d>>>16,d&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=r+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,Jt(h<<16|d,l<<16|f,this.unsigned)};Fe.subtract=function(e){return Xr(e)||(e=vi(e)),this.add(e.neg())};Fe.sub=Fe.subtract;Fe.multiply=function(e){if(this.isZero())return Ma;if(Xr(e)||(e=vi(e)),Oa){var t=Oa.mul(this.low,this.high,e.low,e.high);return Jt(t,Oa.get_high(),this.unsigned)}if(e.isZero())return Ma;if(this.eq(jr))return e.isOdd()?jr:Ma;if(e.eq(jr))return this.isOdd()?jr:Ma;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(ZR)&&e.lt(ZR))return Pa(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,d=0,p=0;return p+=o*l,d+=p>>>16,p&=65535,d+=i*l,h+=d>>>16,d&=65535,d+=o*c,h+=d>>>16,d&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=r*l+a*c+i*u+o*s,f&=65535,Jt(d<<16|p,f<<16|h,this.unsigned)};Fe.mul=Fe.multiply;Fe.divide=function(e){if(Xr(e)||(e=vi(e)),e.isZero())throw Error("division by zero");if(Oa){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Oa.div_u:Oa.div_s)(this.low,this.high,e.low,e.high);return Jt(t,Oa.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Fs:Ma;var r,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Fs;if(e.gt(this.shru(1)))return qP;i=Fs}else{if(this.eq(jr)){if(e.eq(uc)||e.eq(Ly))return jr;if(e.eq(jr))return uc;var o=this.shr(1);return r=o.div(e).shl(1),r.eq(Ma)?e.isNegative()?uc:Ly:(a=this.sub(e.mul(r)),i=r.add(a.div(e)),i)}else if(e.eq(jr))return this.unsigned?Fs:Ma;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Ma}for(a=this;a.gte(e);){r=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(r)/Math.LN2),u=s<=48?1:Fp(2,s-48),c=Pa(r),l=c.mul(e);l.isNegative()||l.gt(a);)r-=u,c=Pa(r,this.unsigned),l=c.mul(e);c.isZero()&&(c=uc),i=i.add(c),a=a.sub(l)}return i};Fe.div=Fe.divide;Fe.modulo=function(e){if(Xr(e)||(e=vi(e)),Oa){var t=(this.unsigned?Oa.rem_u:Oa.rem_s)(this.low,this.high,e.low,e.high);return Jt(t,Oa.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Fe.mod=Fe.modulo;Fe.rem=Fe.modulo;Fe.not=function(){return Jt(~this.low,~this.high,this.unsigned)};Fe.and=function(e){return Xr(e)||(e=vi(e)),Jt(this.low&e.low,this.high&e.high,this.unsigned)};Fe.or=function(e){return Xr(e)||(e=vi(e)),Jt(this.low|e.low,this.high|e.high,this.unsigned)};Fe.xor=function(e){return Xr(e)||(e=vi(e)),Jt(this.low^e.low,this.high^e.high,this.unsigned)};Fe.shiftLeft=function(e){return Xr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Jt(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Jt(0,this.low<<e-32,this.unsigned)};Fe.shl=Fe.shiftLeft;Fe.shiftRight=function(e){return Xr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Jt(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Jt(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Fe.shr=Fe.shiftRight;Fe.shiftRightUnsigned=function(e){if(Xr(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var r=this.low;return Jt(r>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?Jt(t,0,this.unsigned):Jt(t>>>e-32,0,this.unsigned)};Fe.shru=Fe.shiftRightUnsigned;Fe.shr_u=Fe.shiftRightUnsigned;Fe.toSigned=function(){return this.unsigned?Jt(this.low,this.high,!1):this};Fe.toUnsigned=function(){return this.unsigned?this:Jt(this.low,this.high,!0)};Fe.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Fe.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Fe.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};Zt.fromBytes=function(e,t,r){return r?Zt.fromBytesLE(e,t):Zt.fromBytesBE(e,t)};Zt.fromBytesLE=function(e,t){return new Zt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};Zt.fromBytesBE=function(e,t){return new Zt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var Ode=ife({__proto__:null,default:By},[By]),Pde=By||Ode;function mb(n){return Pde.fromString(n,!0,16)}mb("c3a5c85c97cb3127");mb("b492b66fbe98f273");mb("9ae16a3b2f90404f");function Mde(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function GP(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Nf(n)),Tn().getBool("DEBUG")&&wde(n,e),Mde(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){for(var t=new Uint8Array(n.length),r=0;r<t.length;++r)Math.round(n[r])!==0&&(t[r]=1);return t}else throw new Error("Unknown data type ".concat(e))}function Rp(){return Tn().platform.now()}function Bde(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",Tn().platform.encode(n,e)}function JR(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",Tn().platform.decode(n,e)}function hi(n){return Tn().platform.isTypedArray(n)}function Nf(n,e,t){var r,a;if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||db(n)||n==null||hi(n)&&t)e.push(n);else if(Array.isArray(n)||hi(n))for(var i=0;i<n.length;++i)Nf(n[i],e,t);else{var o=-1;try{for(var s=fe(Object.keys(n)),u=s.next();!u.done;u=s.next()){var c=u.value;/^([1-9]+[0-9]*|0)$/.test(c)&&(o=Math.max(o,Number(c)))}}catch(l){r={error:l}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}for(var i=0;i<=o;i++)Nf(n[i],e,t)}return e}var Lde=function(){function n(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new $de)}return n.prototype.profileKernel=function(e,t,r){var a,i,o,s=function(){o=r()},u,c=Rp();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var l=fe(o),f=l.next();!f.done;f=l.next()){var h=f.value;h.dataSync()}}catch(m){a={error:m}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:Rp()-c})}if(Tn().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var d=function(m){var g=o[m];g.data().then(function(y){zde(y,g.dtype,e)})},p=0;p<o.length;p++)d(p);var v={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(m){return m.kernelMs}),extraInfo:u.then(function(m){return m.getExtraProfileInfo!=null?m.getExtraProfileInfo():""})};return v},n.prototype.logKernelProfile=function(e){var t=this,r=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(c){t.logger.logKernelProfile(r,u,c[0],c[1],o,c[2])})})},n}();function zde(n,e,t){if(e!=="float32")return!1;for(var r=0;r<n.length;r++){var a=n[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(t,"'")),!0}return!1}var $de=function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,a,i,o){var s=typeof a=="number"?Np("".concat(a,"ms"),9):a.error,u=Np(e,25),c=t.rank,l=t.size,f=Np(t.shape.toString(),14),h="";for(var d in i){var p=i[d];if(p!=null){var v=p.shape||t.shape,m=v.length;h+="".concat(d,": ").concat(m,"D ").concat(m>0?v:""," ")}}console.log("%c".concat(u,"	%c").concat(s,"	%c").concat(c,"D ").concat(f,"	%c").concat(l,"	%c").concat(h,"	%c").concat(o),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n}();function qde(n,e,t){for(var r={},a={},i=0;i<e.length;i++)r[e[i].id]=!0;for(var i=0;i<n.length;i++){var o=n[i],s=o.inputs;for(var u in s){for(var c=s[u],l=!1,f=0;f<e.length;f++)if(r[c.id]){o.outputs.forEach(function(b){return r[b.id]=!0}),l=!0,a[o.id]=!0;break}if(l)break}}var h={};h[t.id]=!0;for(var d={},i=n.length-1;i>=0;i--)for(var o=n[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,d[o.id]=!0;break}for(var p=[],i=0;i<n.length;i++){var o=n[i];if(a[o.id]&&d[o.id]){var v={};for(var u in o.inputs){var m=o.inputs[u];r[m.id]&&(v[u]=m)}var g=Object.assign({},o);g.inputs=v,g.outputs=o.outputs,p.push(g)}}return p}function Wde(n,e,t,r){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var d=n[h.id];d!=null?u.push(d):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(s.kernelName,"."));var c=s.gradient(u),l=function(h){if(!(h in c))throw new Error("Cannot backprop through input ".concat(h,". ")+"Available gradients found: ".concat(Object.keys(c),"."));var d=t(function(){return c[h]()});if(d.dtype!=="float32")throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"".concat(h," must have 'float32' dtype, but has '").concat(d.dtype,"'"));var p=s.inputs[h];if(!ub(d.shape,p.shape))throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"'".concat(h,"' has shape '").concat(d.shape,"', which does not match ")+"the shape of the input '".concat(p.shape,"'"));if(n[p.id]==null)n[p.id]=d;else{var v=n[p.id];n[p.id]=r(v,d),v.dispose()}};for(var f in s.inputs)l(f)},i=e.length-1;i>=0;i--)a(i)}var QR=20,hf=3,wy=7;function Vde(n,e,t,r){var a=fb(e),i=Gde(n,e,t,a),o=e.length,s=Tp(n,e,t,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(t)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(e,"]")),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function Gde(n,e,t,r){var a=Oi(e),i=r[r.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?xf(n):n;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,f=0;f<i;f++)o[f]=Math.max(o[f],wf(u[l+f],0,t).length);return o}function wf(n,e,t){var r;return Array.isArray(n)?r="".concat(parseFloat(n[0].toFixed(wy))," + ")+"".concat(parseFloat(n[1].toFixed(wy)),"j"):cb(n)?r="'".concat(n,"'"):t==="bool"?r=UP(n):r=parseFloat(n.toFixed(wy)).toString(),Np(r,e)}function UP(n){return n===0?"false":"true"}function Tp(n,e,t,r,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var c=xf(n);return[wf(c[0],0,t)]}return t==="bool"?[UP(n[0])]:[n[0].toString()]}if(u===1){if(s>QR){var l=hf*o,f=Array.from(n.slice(0,l)),h=Array.from(n.slice((s-hf)*o,s*o));return t==="complex64"&&(f=xf(f),h=xf(h)),["["+f.map(function(T,E){return wf(T,a[E],t)}).join(", ")+", ..., "+h.map(function(T,E){return wf(T,a[s-hf+E],t)}).join(", ")+"]"]}var d=t==="complex64"?xf(n):Array.from(n);return["["+d.map(function(T,E){return wf(T,a[E],t)}).join(", ")+"]"]}var p=e.slice(1),v=r.slice(1),m=r[0]*o,g=[];if(s>QR){for(var y=0;y<hf;y++){var b=y*m,w=b+m;g.push.apply(g,Qe([],te(Tp(n.slice(b,w),p,t,v,a,!1)),!1))}g.push("...");for(var y=s-hf;y<s;y++){var b=y*m,w=b+m;g.push.apply(g,Qe([],te(Tp(n.slice(b,w),p,t,v,a,y===s-1)),!1))}}else for(var y=0;y<s;y++){var b=y*m,w=b+m;g.push.apply(g,Qe([],te(Tp(n.slice(b,w),p,t,v,a,y===s-1)),!1))}var x=u===2?",":"";g[0]="["+(s>0?g[0]+x:"");for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+x;for(var N=`,
`,y=2;y<u;y++)N+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":N),g}function xf(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}(function(){function n(e,t,r){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=Oi(e),r!=null){var i=r.length;Se(i===this.size,function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||bde(t,this.size),this.strides=fb(e)}return n.prototype.set=function(e){for(var t=this,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];r.length===0&&(r=[0]),Se(r.length===this.rank,function(){return"The number of provided coordinates (".concat(r.length,") must ")+"match the rank (".concat(t.rank,")")});var i=this.locToIndex(r);this.values[i]=e},n.prototype.get=function(){for(var e,t,r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];r.length===0&&(r=[0]);var i=0;try{for(var o=fe(r),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var c="Requested out of range element at ".concat(r,". ")+"  Buffer shape=".concat(this.shape);throw new Error(c)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var l=r[r.length-1],f=0;f<r.length-1;++f)l+=this.strides[f]*r[f];return this.values[l]},n.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),n.prototype.toTensor=function(){return oi().makeTensor(this.values,this.shape,this.dtype)},n})();var oi=null,df=null;function Ude(n){oi=n}var Ra=function(){function n(e,t,r,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Oi(e),this.strides=fb(e),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),n.prototype.buffer=function(){return Ce(this,void 0,void 0,function(){var e;return Ee(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,df.buffer(this.shape,this.dtype,e)]}})})},n.prototype.bufferSync=function(){return df.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return Ce(this,void 0,void 0,function(){var e;return Ee(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,WR(this.shape,e,this.dtype==="complex64")]}})})},n.prototype.arraySync=function(){return WR(this.shape,this.dataSync(),this.dtype==="complex64")},n.prototype.data=function(){return Ce(this,void 0,void 0,function(){var e,t;return Ee(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=oi().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=r.sent();try{return[2,t.map(function(a){return JR(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}})})},n.prototype.dataToGPU=function(e){return this.throwIfDisposed(),oi().readToGPU(this.dataId,e)},n.prototype.dataSync=function(){this.throwIfDisposed();var e=oi().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return JR(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},n.prototype.bytes=function(){return Ce(this,void 0,void 0,function(){var e;return Ee(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,oi().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},n.prototype.dispose=function(){this.isDisposed||(oi().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!1,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.print=function(e){return e===void 0&&(e=!1),df.print(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),df.clone(this)},n.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return Vde(t,this.shape,this.dtype,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),df.cast(this,e)},n.prototype.variable=function(e,t,r){return e===void 0&&(e=!0),this.throwIfDisposed(),oi().makeVariable(this,e,t,r)},n}();Object.defineProperty(Ra,Symbol.hasInstance,{value:function(n){return!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null}});function Hde(){return pb("Tensor",function(){return Ra})}Hde();var Op=function(n){se(e,n);function e(t,r,a,i){var o=n.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=r,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(t.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!ub(t.shape,this.shape))throw new Error("shape of the new value (".concat(t.shape,") and ")+"previous value (".concat(this.shape,") must match"));oi().disposeTensor(this),this.dataId=t.dataId,oi().incRef(this,null)},e.prototype.dispose=function(){oi().disposeVariable(this),this.isDisposedInternal=!0},e}(Ra);Object.defineProperty(Op,Symbol.hasInstance,{value:function(n){return n instanceof Ra&&n.assign!=null&&n.assign instanceof Function}});var eO;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(eO||(eO={}));var zy;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(zy||(zy={}));var $y;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})($y||($y={}));var qy;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(qy||(qy={}));var Wy;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(Wy||(Wy={}));var Kde={float32:qy,int32:zy,bool:$y,complex64:Wy};function jde(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error("Can not upcast ".concat(n," with ").concat(e))}return Kde[n][e]}function va(n,e){if(n.dtype===e.dtype)return[n,e];var t=jde(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function HP(n){var e=[],t=new Set;return KP(n,e,t),e}function KP(n,e,t){if(n!=null){if(n instanceof Ra){e.push(n);return}if(!!Xde(n)){var r=n;for(var a in r){var i=r[a];t.has(i)||(t.add(i),KP(i,e,t))}}}}function Xde(n){return Array.isArray(n)||typeof n=="object"}function xy(n){return n.kernelName!=null}var tO=function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return n.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},n}(),gb=function(){function n(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new tO}return n.prototype.ready=function(){return Ce(this,void 0,void 0,function(){var e,t,r,a;return Ee(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(r=e[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(n.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,r=e.asyncInit;if(r)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!1,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},n.prototype.registerBackend=function(e,t,r){return r===void 0&&(r=1),e in this.registryFactory?(oc("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},n.prototype.setBackend=function(e){return Ce(this,void 0,void 0,function(){var t,r,a,i,o;return Ee(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '".concat(e,"' not found in registry"));return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,a=t.asyncInit,a?[4,r]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=r,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Lde(this.backendInstance),[2,!0]}})})},n.prototype.setupRegisteredKernels=function(){var e=this,t=HR(this.backendName);t.forEach(function(r){r.setupFunc!=null&&r.setupFunc(e.backendInstance)})},n.prototype.disposeRegisteredKernels=function(e){var t=this,r=HR(e);r.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},n.prototype.initializeBackend=function(e){var t=this,r=this.registryFactory[e];if(r==null)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var a=r.factory();if(a&&!(a instanceof gde)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,oc("Initialization of backend ".concat(e," failed")),oc(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return oc("Initialization of backend ".concat(e," failed")),oc(s.stack||s.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority})},n.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],a=this.initializeBackend(r),i=a.success,o=a.asyncInit;if(o||i)return{name:r,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(e,t){var r=this.state.tensorInfo.get(t),a=r.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),r.backend=e,e.move(t,i,r.shape,r.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(e,t){var r=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return r.startScope(a)},function(){return r.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},n.prototype.scopedRun=function(e,t,r){e();try{var a=r();return t(),a}catch(i){throw t(),i}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=me.runKernel(ob,{x:e}),r={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},c={dtype:s};return me.runKernel(ib,u,c)}}},i=[];return this.addTapeNode(this.state.activeScope.name,r,[t],a,i,{}),t},n.prototype.runKernel=function(e,t,r){this.backendName==null&&this.backend;var a=GR(e,this.backendName)!=null;if(!a)throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:r})},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(e,t,r){var a=this.backend.numDataIds(),i=0;r.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(s," data ids) after running '").concat(e,"'"))},n.prototype.runKernelFunc=function(e){var t=this,r,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var c,l=xy(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(xy(e)){var f=e.kernelName,h=e.inputs,d=e.attrs;this.backendName==null&&this.backend;var p=GR(f,this.backendName);Se(p!=null,function(){return"Cannot find registered kernel '".concat(f,"' for backend '").concat(t.backendName,"'")}),u=function(){var x=t.backend.numDataIds();c=p.kernelFunc({inputs:h,attrs:d,backend:t.backend});var N=Array.isArray(c)?c:[c];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,x,N);var T=N.map(function(C){return C.rank!=null?C:t.makeTensorFromTensorInfo(C)});if(i){var E=t.getTensorsForGradient(f,h,T);a=t.saveTensorsForBackwardMode(E)}return T}}else{var v=e.forwardFunc,m=function(x){!i||(a=x.map(function(N){return t.keep(t.clone(N))}))};u=function(){var x=t.backend.numDataIds();c=t.tidy(function(){return v(t.backend,m)});var N=Array.isArray(c)?c:[c];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(l,x,N),N}}var g=e.inputs,y=e.attrs,b=xy(e)?null:e.backwardsFunc,w;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?r=u():(w=t.profiler.profileKernel(l,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(w),r=w.outputs)}),i&&this.addTapeNode(l,g,r,b,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(x){return g[x]!=null?g[x].shape:null}),outputShapes:r.map(function(x){return x.shape}),kernelTimeMs:w.timeMs,extraInfo:w.extraInfo}),Array.isArray(c)?r:r[0]},n.prototype.saveTensorsForBackwardMode=function(e){var t=this,r=e.map(function(a){return t.keep(t.clone(a))});return r},n.prototype.getTensorsForGradient=function(e,t,r){var a=UR(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(Se(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(c){return t[c]})):s=i.map(function(c){return t[c]});var u=r.filter(function(c,l){return o[l]});return s.concat(u)}return[]},n.prototype.makeTensor=function(e,t,r,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",a=a||this.backend;var i=e;r==="string"&&cb(e[0])&&(i=e.map(function(l){return Bde(l)}));var o=a.write(i,t,r),s=new Ra(t,r,o,this.nextTensorId());if(this.trackTensor(s,a),r==="string"){var u=this.state.tensorInfo.get(o),c=kde(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},n.prototype.makeTensorFromDataId=function(e,t,r,a){r=r||"float32";var i={dataId:e,shape:t,dtype:r};return this.makeTensorFromTensorInfo(i,a)},n.prototype.makeTensorFromTensorInfo=function(e,t){var r=e.dataId,a=e.shape,i=e.dtype,o=new Ra(a,i,r,this.nextTensorId());return this.trackTensor(o,t),o},n.prototype.makeVariable=function(e,t,r,a){t===void 0&&(t=!0),r=r||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new Op(e,t,r,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name ".concat(i.name," was already registered"));return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},n.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var r=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(r=e.size*Oy(e.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r})),e instanceof Op||this.track(e)},n.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},n.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},n.prototype.disposeTensor=function(e){if(!!this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var r=e.size*Oy(e.dtype);this.state.numBytes-=r}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},n.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},n.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return Ce(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f,h;return Ee(this,function(d){switch(d.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=d.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,Qe([],te(this.state.activeProfile.kernels.map(function(p){return p.totalBytesSnapshot})),!1)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,d.label=2;case 2:d.trys.push([2,8,9,10]),i=fe(this.state.activeProfile.kernels),o=i.next(),d.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=d.sent(),c=s,[4,s.extraInfo];case 5:c.extraInfo=d.sent(),d.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return l=d.sent(),f={error:l},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},n.prototype.addTapeNode=function(e,t,r,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:i},c=UR(e);c!=null&&(a=c.gradFunc),a!=null&&(u.gradient=function(l){return l=l.map(function(f,h){if(f==null){var d=r[h],p=hb(d.size,d.dtype);return s.makeTensor(p,d.shape,d.dtype)}return f}),a(l.length>1?l:l[0],i,o)}),this.state.activeTape.push(u)},n.prototype.keep=function(e){return e.kept=!0,e},n.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=HP(e),a=new Set(r.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},n.prototype.gradients=function(e,t,r,a){var i=this;if(a===void 0&&(a=!1),Se(t.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '".concat(r.dtype,"'"));var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});Se(o instanceof Ra,function(){return"The result y returned by f() must be a tensor."});var s=qde(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=r??Yde(o.shape),Wde(u,s,function(l){return i.tidy(l)},Jde);var c=t.map(function(l){return u[l.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(l){var f,h;try{for(var d=fe(l.saved),p=d.next();!p.done;p=d.next()){var v=p.value;v.dispose()}}catch(m){f={error:m}}finally{try{p&&!p.done&&(h=d.return)&&h.call(d)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:c}})},n.prototype.customGrad=function(e){var t=this;return Se(Py(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];Se(r.every(function(c){return c instanceof Ra}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};r.forEach(function(c,l){o[l]=c});var s=function(c,l){return i=e.apply(void 0,Qe([],te(Qe(Qe([],te(r),!1),[l],!1)),!1)),Se(i.value instanceof Ra,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),Se(Py(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(c,l){var f=i.gradFunc(c,l),h=Array.isArray(f)?f:[f];Se(h.length===r.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),Se(h.every(function(p){return p instanceof Ra}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var d={};return h.forEach(function(p,v){d[v]=function(){return p}}),d};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},n.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},n.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},n.prototype.readToGPU=function(e,t){var r=this.state.tensorInfo.get(e);return r.backend.readToGPU(e,t)},n.prototype.time=function(e){return Ce(this,void 0,void 0,function(){var t,r;return Ee(this,function(a){switch(a.label){case 0:return t=Rp(),[4,this.backend.time(e)];case 1:return r=a.sent(),r.wallMs=Rp()-t,[2,r]}})})},n.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!1,configurable:!0}),n.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new tO;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n}();gb.nextTensorId=0;gb.nextVariableId=0;function Yde(n){var e=MP(Oi(n),"float32");return me.makeTensor(e,n,"float32")}function Zde(){var n=LP();if(n._tfengine==null){var e=new Tde(n);n._tfengine=new gb(e)}return Ade(n._tfengine.ENV),Ude(function(){return n._tfengine}),n._tfengine}var me=Zde();function Jde(n,e){var t={a:n,b:e};return me.runKernel(ab,t)}function Qde(n,e){var t=n;if(hi(n))return e==="string"?[]:[n.length];var r=typeof n=="object";if(r){if("texture"in n){var a=n.channels||"RGBA";return[n.height,n.width*a.length]}else if("buffer"in n&&!(n.buffer instanceof ArrayBuffer))return[n.buffer.size/(e==null?4:Oy(e))]}if(!Array.isArray(n))return[];for(var i=[];Array.isArray(t)||hi(t)&&e!=="string";)i.push(t.length),t=t[0];return Array.isArray(n)&&Tn().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&jP(n,i,[]),i}function jP(n,e,t){if(t=t||[],!Array.isArray(n)&&!hi(n)){Se(e.length===0,function(){return"Element arr[".concat(t.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(e[0]," elements")});return}Se(e.length>0,function(){return"Element arr[".concat(t.join("]["),"] should be a primitive, ")+"but is an array of ".concat(n.length," elements")}),Se(n.length===e[0],function(){return"Element arr[".concat(t.join("]["),"] should have ").concat(e[0]," ")+"elements, but has ".concat(n.length," elements")});for(var r=e.slice(1),a=0;a<n.length;++a)jP(n[a],r,t.concat(a))}function nO(n,e,t,r){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error("Argument '".concat(t,"' passed to '").concat(r,"' must ")+"be ".concat(n," tensor, but got ").concat(e," tensor"))}}function Ie(n,e,t,r){if(r===void 0&&(r="numeric"),n instanceof Ra)return nO(r,n.dtype,e,t),n;var a=lb(n);if(a!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),nO(r,a,e,t),n==null||!hi(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var i=n==null?"null":n.constructor.name;throw new Error("Argument '".concat(e,"' passed to '").concat(t,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=Qde(n,a);!hi(n)&&!Array.isArray(n)&&(n=[n]);var s=!0,u=a!=="string"?GP(n,a):Nf(n,[],s);return me.makeTensor(u,o,a)}function XP(n,e,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument ".concat(e," passed to ").concat(t," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=n;return a.map(function(i,o){return Ie(i,"".concat(e,"[").concat(o,"]"),t,r)})}var epe="__op";function Ve(n){var e=Object.keys(n);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(e.length," keys."));var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+epe;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];me.startScope(t);try{var s=r.apply(void 0,Qe([],te(i),!1));return db(s)&&console.error("Cannot return a Promise inside of tidy."),me.endScope(s),s}catch(u){throw me.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function tpe(n,e){var t=Ie(n,"x","cast");if(!xde(e))throw new Error("Failed to cast to unknown dtype ".concat(e));if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var r={x:t},a={dtype:e};return me.runKernel(ib,r,a)}var St=Ve({cast_:tpe});function npe(n,e){var t,r=Ie(n,"a","mul"),a=Ie(e,"b","mul");t=te(va(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return me.runKernel(dP,i)}var be=Ve({mul_:npe});function rpe(n,e){e===void 0&&(e=0);var t=Ie(n,"x","step"),r={x:t},a={alpha:e};return me.runKernel(OP,r,a)}var yb=Ve({step_:rpe}),YP={kernelName:jO,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(n,yb(St(r,"float32"),-1))}}}};function ape(n,e){var t,r=Ie(n,"a","floorDiv"),a=Ie(e,"b","floorDiv");t=te(va(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return me.runKernel(uP,i)}var ipe=Ve({floorDiv_:ape});function ope(n,e){var t,r=Ie(n,"a","div"),a=Ie(e,"b","div");if(t=te(va(r,a),2),r=t[0],a=t[1],r.dtype==="int32"&&a.dtype==="int32")return ipe(r,a);var i={a:r,b:a},o={};return me.runKernel(aP,i,o)}var Ot=Ve({div_:ope});function spe(n){var e=Ie(n,"x","neg"),t={x:e};return me.runKernel(pP,t)}var La=Ve({neg_:spe});function upe(n,e,t,r){if(r==null)r=lb(n);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(typeof n=="object"&&("texture"in n||"buffer"in n&&!(n.buffer instanceof ArrayBuffer))){if(r!=="float32"&&r!=="int32")throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(r,"."));return me.backend.createTensorFromGPUData(n,e||t,r)}if(!hi(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Rf(e);var a=Oi(e),i=Oi(t);Se(a===i,function(){return"Based on the provided shape, [".concat(e,"], the tensor should have ")+"".concat(a," values but has ").concat(i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==Oi(e.slice(o)):!0;Se(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(t,") does not match the provided ")+"shape (".concat(e,"). ")})}}return!hi(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=r!=="string"?GP(n,r):Nf(n,[],!0),me.makeTensor(n,e,r)}function En(n,e){if((hi(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&hi(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],r=[];return upe(n,t,r,e)}function cpe(n){var e=Ie(n,"x","sqrt","float32"),t={x:e};return me.runKernel(EP,t)}var di=Ve({sqrt_:cpe});function lpe(n){var e=Ie(n,"x","square"),t={};return me.runKernel("Square",{x:e},t)}var In=Ve({square_:lpe});function fpe(n,e){var t,r=Ie(n,"a","sub"),a=Ie(e,"b","sub");t=te(va(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return me.runKernel(DP,i)}var tr=Ve({sub_:fpe}),hpe={kernelName:Wfe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){var a=In(St(r,"float32")),i=di(tr(En(1),a));return La(Ot(n,i))}}}},dpe={kernelName:Vfe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){var a=di(tr(In(St(r,"float32")),1));return Ot(n,a)}}}};function nr(n,e){for(var t=[],r=0;r<e.length;r++){var a=n[n.length-r-1],i=e.length-r-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function lr(n,e){for(var t=[],r=Math.max(n.length,e.length),a=0;a<r;a++){var i=n[n.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)t.unshift(o);else if(o===1)t.unshift(i);else if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(n," and ").concat(e,".");throw Error(s)}else t.unshift(i)}return t}function ppe(n,e){var t=Ie(n,"x","reshape","string_or_numeric"),r={x:t},a={shape:e};return me.runKernel(yP,r,a)}var Je=Ve({reshape_:ppe});function vpe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Ie(n,"x","sum");r.dtype==="bool"&&(r=St(r,"int32"));var a={x:r},i={axis:e,keepDims:t};return me.runKernel(IP,a,i)}var gn=Ve({sum_:vpe}),mpe={kernelName:ab,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=lr(r.shape,a.shape),o=function(){var u=n,c=nr(r.shape,i);return c.length>0&&(u=gn(u,c)),Je(u,r.shape)},s=function(){var u=n,c=nr(a.shape,i);return c.length>0&&(u=gn(u,c)),Je(u,a.shape)};return{a:o,b:s}}};var gpe={kernelName:Gfe,saveAllInputs:!0,gradFunc:function(n,e){var t={};return e.forEach(function(r,a){t[a]=function(){return n.clone()}}),t}};function ype(n){var e=Ie(n,"x","zerosLike"),t={x:e};return me.runKernel(RP,t)}var At=Ve({zerosLike_:ype}),bpe={kernelName:Ufe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return At(r)}}}},wpe={kernelName:Hfe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return At(r)}}}},xpe={kernelName:Kfe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Ot(n,di(tr(En(1),In(St(r,"float32")))))}}}};function kpe(n,e){var t,r=Ie(n,"a","add"),a=Ie(e,"b","add");t=te(va(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return me.runKernel(ab,i)}var xt=Ve({add_:kpe}),Spe={kernelName:jfe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){var a=di(xt(En(1),In(St(r,"float32"))));return Ot(n,a)}}}},Npe={kernelName:Zfe,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=lr(r.shape,a.shape),o=function(){var u=xt(In(r),In(a)),c=be(n,Ot(a,u)),l=nr(r.shape,i);return l.length>0&&(c=gn(c,l)),Je(c,r.shape)},s=function(){var u=xt(In(r),In(a)),c=La(be(n,Ot(r,u))),l=nr(a.shape,i);return l.length>0&&(c=gn(c,l)),Je(c,a.shape)};return{a:o,b:s}}},Tpe={kernelName:Xfe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Ot(n,xt(In(St(r,"float32")),1))}}}},Epe={kernelName:Yfe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Ot(n,tr(En(1),In(St(r,"float32"))))}}}};function ZP(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function Tf(n){var e=te(ZP(n),3),t=e[0],r=e[1],a=e[2];return t===1&&r===1&&a===1}function JP(n,e){return Tf(n)||Tf(e)}function rO(n){return ZP(n).every(function(e){return e>0})}function $s(n,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,"."));if(typeof e=="number")Se(_p(e),function(){return"Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,".")});else if(typeof e=="object")e.forEach(function(r){r.forEach(function(a){Se(_p(a),function(){return"Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(a,".")})})});else throw Error("Error in ".concat(n,": Unknown padding parameter: ").concat(e))}}function Ipe(n,e,t,r,a,i){var o=Ie(n,"dy","avgPool3dGrad"),s=Ie(e,"input","avgPool3dGrad"),u=o,c=s,l=!1;s.rank===4&&(l=!0,u=Je(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=Je(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),Se(u.rank===5,function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank "+"".concat(u.rank,".")}),Se(c.rank===5,function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank "+"".concat(c.rank,".")}),$s("avgPool3dGrad",a,i);var f={dy:u,input:c},h={filterSize:t,strides:r,pad:a,dimRoundingMode:i},d=me.runKernel(the,f,h);return l?Je(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}var Cpe=Ve({avgPool3dGrad_:Ipe}),Ape={kernelName:ehe,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.filterSize,o=t.strides,s=t.pad,u=t.dimRoundingMode;return{x:function(){return Cpe(n,a,i,o,s,u)}}}};function Dpe(n,e,t,r,a){var i=Ie(n,"dy","avgPoolGrad"),o=Ie(e,"input","avgPoolGrad");Se(o.rank===i.rank,function(){return"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")});var s=o,u=i,c=!1;o.rank===3&&(c=!0,s=Je(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=Je(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Se(u.rank===4,function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank "+"".concat(u.rank,".")}),Se(s.rank===4,function(){return"Error in avgPoolGrad: input must be rank 4 but got rank "+"".concat(s.rank,".")});var l={dy:u,input:s},f={filterSize:t,strides:r,pad:a},h=me.runKernel(Qfe,l,f);return c?Je(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var _pe=Ve({avgPoolGrad_:Dpe}),Fpe={kernelName:Jfe,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.filterSize,o=t.strides,s=t.pad;return{x:function(){return _pe(n,a,i,o,s)}}}};function Rpe(n,e,t,r){var a;t===void 0&&(t=!1),r===void 0&&(r=!1);var i=Ie(n,"a","matMul"),o=Ie(e,"b","matMul");a=te(va(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:r};return me.runKernel(XO,s,u)}var Mo=Ve({matMul_:Rpe}),Ope={kernelName:XO,inputsToSave:["a","b"],gradFunc:function(n,e,t){var r=te(e,2),a=r[0],i=r[1],o=t.transposeA,s=t.transposeB;return!o&&!s?{a:function(){return Mo(n,i,!1,!0)},b:function(){return Mo(a,n,!0,!1)}}:!o&&s?{a:function(){return Mo(n,i,!1,!1)},b:function(){return Mo(n,a,!0,!1)}}:o&&!s?{a:function(){return Mo(i,n,!1,!0)},b:function(){return Mo(a,n,!1,!1)}}:{a:function(){return Mo(i,n,!0,!0)},b:function(){return Mo(n,a,!0,!0)}}}};function Ppe(n,e,t){var r=Ie(n,"x","spaceToBatchND");Se(r.rank>=1+e.length,function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(e.length)}),Se(t.length===e.length,function(){return"paddings.shape[0] ".concat(t.length," must be equal to [blockShape] ").concat(e.length)}),Se(r.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(t.toString()," must be divisible by blockShapes ").concat(e.toString())});var a={x:r},i={blockShape:e,paddings:t};return me.runKernel(CP,a,i)}var Mpe=Ve({spaceToBatchND_:Ppe});var Bpe={kernelName:YO,gradFunc:function(n,e,t){var r=t.blockShape,a=t.crops;return{x:function(){return Mpe(n,r,a)}}}};var Lpe={kernelName:nhe,gradFunc:function(n,e,t){for(var r=t,a=r.inputShape,i=r.shape,o=Array.from(i),s=a.length-1;s>=0;s--)if(a[s]===i[s])o[s]=1;else if(a[s]!==1)throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(i,"]."));for(var u=[],s=0;s<o.length;s++)o[s]>1&&u.push(s);return{x:function(){return gn(n,u,!0)}}}};var zpe={kernelName:ib,gradFunc:function(n){return{x:function(){return n.clone()}}}};var $pe={kernelName:rhe,gradFunc:function(n){return{x:function(){return At(n)}}}};function qpe(n,e){var t,r=Ie(n,"a","greaterEqual","string_or_numeric"),a=Ie(e,"b","greaterEqual","string_or_numeric");t=te(va(r,a),2),r=t[0],a=t[1],lr(r.shape,a.shape);var i={a:r,b:a};return me.runKernel(lP,i)}var bb=Ve({greaterEqual_:qpe});function Wpe(n,e){var t,r=Ie(n,"a","lessEqual","string_or_numeric"),a=Ie(e,"b","lessEqual","string_or_numeric");t=te(va(r,a),2),r=t[0],a=t[1],lr(r.shape,a.shape);var i={a:r,b:a};return me.runKernel(_he,i)}var wb=Ve({lessEqual_:Wpe});function Vpe(n,e){var t=Ie(n,"a","logicalAnd","bool"),r=Ie(e,"b","logicalAnd","bool");lr(t.shape,r.shape);var a={a:t,b:r};return me.runKernel(Rhe,a)}var QP=Ve({logicalAnd_:Vpe});function Gpe(n){var e=Ie(n,"x","clone","string_or_numeric"),t={x:e};return me.runKernel(ob,t)}var eM=Ve({clone_:Gpe});function Upe(n,e){var t=Ie(n,"broadcastTo","x"),r=t.shape;if(Rf(e),e.length<t.rank)throw new Error("broadcastTo(): shape.length=".concat(e.length," < input.rank=").concat(t.rank,"."));if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=Je(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(e,"]."));var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return eM(t);var c={x:t},l={reps:o};return me.runKernel(sb,c,l)}var ky=Ve({broadcastTo_:Upe});function Hpe(n,e,t){var r=Ie(e,"a","where"),a=Ie(t,"b","where"),i=Ie(n,"condition","where","bool"),o=lr(lr(i.shape,r.shape),a.shape),s=ky(i,o),u=ky(r,o),c=ky(a,o),l={condition:s,t:u,e:c};return me.runKernel(xP,l)}var Ms=Ve({where_:Hpe}),Kpe={kernelName:ahe,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.clipValueMin,o=t.clipValueMax;return{x:function(){return Ms(QP(bb(a,i),wb(a,o)),n,At(n))}}}};var jpe={kernelName:ZO,inputsToSave:["x"],gradFunc:YP.gradFunc};function Xpe(n,e,t){t===void 0&&(t=0);var r=Ie(n,"x","split"),a={x:r},i={numOrSizeSplits:e,axis:t};return me.runKernel(AP,a,i)}var Ype=Ve({split_:Xpe});var Zpe={kernelName:JO,saveAllInputs:!0,gradFunc:function(n,e,t){var r=e.map(function(u){return u.shape}),a=t.axis,i=Ls(a,e[0].shape)[0],o=r.map(function(u){return u[i]}),s=Ype(n,o,i);return s.map(function(u){return function(){return u}})}};function Jpe(n,e,t,r,a,i,o){i===void 0&&(i="NHWC");var s=n;n.rank===3&&(s=Je(n,[1,n.shape[0],n.shape[1],n.shape[2]]));var u=e;u.rank===3&&(u=Je(e,[1,e.shape[0],e.shape[1],e.shape[2]])),Se(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")}),Se(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")}),Se(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(t,".")});var c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];Se(c===t[2],function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(t[2],".")}),Se(l===t[3],function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(t[3],").")}),$s("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return me.runKernel(ohe,f,h)}var tM=Ve({conv2DBackpropFilter_:Jpe});function Qpe(n,e,t,r,a,i,o){i===void 0&&(i="NHWC"),Se(n.length===e.rank,function(){return"Length of inShape "+"(".concat(n.length,") and rank of dy (").concat(e.rank,") must match")});var s=n,u=e,c=!1;e.rank===3&&(c=!0,u=Je(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,n[0],n[1],n[2]]),Se(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")}),Se(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)}),Se(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(t.rank)});var l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];Se(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(t.shape[2],".")}),Se(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output (".concat(f,") must ")+"match output depth for filter ".concat(t.shape[3],".")}),$s("conv2dDerInput",a,o);var h={dy:u,filter:t},d={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},p=me.runKernel(eP,h,d);return c?Je(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var eve=Ve({conv2DBackpropInput_:Qpe}),tve={kernelName:QO,inputsToSave:["x","filter"],gradFunc:function(n,e,t){var r=te(e,2),a=r[0],i=r[1],o=t.dilations,s=t.strides,u=t.pad,c=t.dataFormat;return Se(Tf(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(o,"'")}),{x:function(){return eve(a.shape,n,i,s,u,c)},filter:function(){return tM(a,n,i.shape,s,u,c)}}}};function nve(n,e,t,r,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=Ie(n,"x","conv2d","float32"),u=Ie(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=Je(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Se(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")}),Se(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")}),$s("conv2d",r,o);var f=a==="NHWC"?c.shape[3]:c.shape[1];Se(f===u.shape[2],function(){return"Error in conv2d: depth of input (".concat(f,") must match ")+"input depth for filter ".concat(u.shape[2],".")}),Se(JP(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),Se(rO(i),function(){return"Error in conv2D: Dilated rates should be larger than 0."}),Se(rO(t),function(){return"Error in conv2D: Strides should be larger than 0."});var h={x:c,filter:u},d={strides:t,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},p=me.runKernel(QO,h,d);return l?Je(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var rve=Ve({conv2d_:nve}),ave={kernelName:eP,inputsToSave:["dy","filter"],gradFunc:function(n,e,t){var r=te(e,2),a=r[0],i=r[1],o=t.strides,s=t.pad,u=t.dataFormat,c=t.dimRoundingMode;return{dy:function(){return rve(n,i,o,s,u,1,c)},filter:function(){return tM(n,a,i.shape,o,s,u,c)}}}};function ive(n,e,t,r,a){var i=n;n.rank===4&&(i=Je(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));var o=e;o.rank===4&&(o=Je(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),Se(i.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+"".concat(i.shape,".")}),Se(o.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+"".concat(o.shape,".")}),Se(t.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+"".concat(t,".")}),Se(i.shape[4]===t[3],function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must ")+"match input depth in filter (".concat(t[3],".")}),Se(o.shape[4]===t[4],function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must ")+"match output depth for filter (".concat(t[4],").")});var s={x:i,dy:o},u={strides:r,pad:a,filterShape:t};return me.runKernel(uhe,s,u)}var ove=Ve({conv3DBackpropFilter_:ive});function sve(n,e,t,r,a){Se(n.length===e.rank,function(){return"Length of inShape "+"(".concat(n.length,") and rank of dy (").concat(e.rank,") must match")});var i=n,o=e,s=!1;e.rank===4&&(s=!0,o=Je(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);var u=i[4],c=o.shape[4];Se(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")}),Se(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)}),Se(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(t.rank)}),Se(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(t.shape[3],".")}),Se(c===t.shape[4],function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(t.shape[4],".")});var l={dy:o,filter:t},f={pad:a,strides:r,inputShape:i},h=me.runKernel(che,l,f);return s?Je(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var uve=Ve({conv3DBackpropInput_:sve}),cve={kernelName:she,inputsToSave:["x","filter"],gradFunc:function(n,e,t){var r=t.dilations,a=t.strides,i=t.pad;Se(Tf(r),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are "+"not yet supported in gradients. Got dilations '".concat(r,"'")});var o=te(e,2),s=o[0],u=o[1];return{x:function(){return uve(s.shape,n,u,a,i)},filter:function(){return ove(s,n,u.shape,a,i)}}}};function lve(n){var e=Ie(n,"x","sin","float32"),t={x:e};return me.runKernel(SP,t)}var fve=Ve({sin_:lve}),hve={kernelName:tP,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(La(fve(St(r,"float32"))),n)}}}};function dve(n){var e=Ie(n,"x","sinh"),t={x:e};return me.runKernel(NP,t)}var pve=Ve({sinh_:dve}),vve={kernelName:nP,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(pve(St(r,"float32")),n)}}}};function mve(n,e){for(var t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function gve(n,e,t){for(var r=n.length+e.length,a=[],i=0,o=0,s=0;s<r;s++)t.indexOf(s)===-1?a.push(n[i++]):a.push(e[o++]);return a}function yve(n,e){for(var t=[],r=n.length,a=0;a<r;a++)e.indexOf(a)===-1&&t.push(n[a]);var i=e.map(function(o){return n[o]});return[t,i]}function aO(n,e){var t=e.map(function(r){return 1});return gve(n,t,e)}function nM(n,e){if(mve(n,e))return null;for(var t=[],r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach(function(a){return t.push(a)}),t}function xb(n){return n.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function bve(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var a=Ie(n,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:r};return me.runKernel(rP,i,o)}var wve=Ve({cumsum_:bve});function $n(n,e){return me.tidy(n,e)}function ha(n){var e=HP(n);e.forEach(function(t){return t.dispose()})}function xve(n){return me.keep(n)}function kve(n,e){var t=Ie(n,"real","complex"),r=Ie(e,"imag","complex");yde(t.shape,r.shape,"real and imag shapes, ".concat(t.shape," and ").concat(r.shape,", ")+"must match in call to tf.complex().");var a={real:t,imag:r};return me.runKernel(ihe,a)}var kb=Ve({complex_:kve});function Sve(n){var e=Ie(n,"input","imag"),t={input:e};return me.runKernel(The,t)}var Nve=Ve({imag_:Sve});function Tve(n){var e=Ie(n,"input","real"),t={input:e};return me.runKernel(Jhe,t)}var Eve=Ve({real_:Tve});function Ive(n,e,t){var r=Ie(n,"x","transpose");if(e==null&&(e=r.shape.map(function(o,s){return s}).reverse()),Se(r.rank===e.length,function(){return"Error in transpose: rank of input ".concat(r.rank," ")+"must match length of perm ".concat(e,".")}),e.forEach(function(o){Se(o>=0&&o<r.rank,function(){return"All entries in 'perm' must be between 0 and ".concat(r.rank-1)+" but got ".concat(e)})}),r.rank<=1)return r.clone();var a={x:r},i={perm:e};return r.dtype==="complex64"?$n(function(){var o=Eve(r),s=Nve(r);return o=me.runKernel(Sp,{x:o},i),s=me.runKernel(Sp,{x:s},i),t&&(s=La(s)),kb(o,s)}):me.runKernel(Sp,a,i)}var dc=Ve({transpose_:Ive}),Cve={kernelName:rP,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.axis,o=t.exclusive,s=t.reverse;return{x:function(){var u=nM([i],a.rank),c=wve(n,i,o,!s);return u!=null&&(c=dc(c,u)),c}}}};function Ave(n,e,t,r,a,i,o){i===void 0&&(i=[1,1]);var s=n;n.rank===3&&(s=Je(n,[1,n.shape[0],n.shape[1],n.shape[2]]));var u=e;u.rank===3&&(u=Je(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={x:s,dy:u},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return me.runKernel(hhe,c,l)}var Dve=Ve({depthwiseConv2dNativeBackpropFilter_:Ave});function _ve(n,e,t,r,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=Je(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={dy:s,filter:t},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:n},f=me.runKernel(dhe,c,l);return u?Je(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var Fve=Ve({depthwiseConv2dNativeBackpropInput_:_ve}),Rve={kernelName:fhe,inputsToSave:["x","filter"],gradFunc:function(n,e,t){var r=t.dilations,a=t.strides,i=t.pad,o=t.dimRoundingMode,s=r??[1,1];Se(Tf(s),function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(s,"'")});var u=te(e,2),c=u[0],l=u[1];return Se(c.rank===4,function(){return"Error in gradient of depthwiseConv2dNative: input must be "+"rank 4, but got rank ".concat(c.rank,".")}),Se(l.rank===4,function(){return"Error in gradient of depthwiseConv2dNative: filter must be "+"rank 4, but got rank ".concat(l.rank,".")}),Se(c.shape[3]===l.shape[2],function(){return"Error in gradient of depthwiseConv2d: number of input "+"channels (".concat(c.shape[3],") must match the inChannels dimension ")+"in filter ".concat(l.shape[2],".")}),Se(JP(a,s),function(){return"Error in gradient of depthwiseConv2d: Either strides or "+"dilations must be  1. Got strides ".concat(a," and dilations ")+"'".concat(s,"'.")}),$s("depthwiseConv2d",i,o),{x:function(){return Fve(c.shape,n,l,a,i,s,o)},filter:function(){return Dve(c,n,l.shape,a,i,s,o)}}}},Ove={kernelName:phe,inputsToSave:["x","filter"],gradFunc:function(n,e,t){var r=te(e,2),a=r[0],i=r[1],o={x:a,filter:i,dy:n},s={x:a,filter:i,dy:n};return{x:function(){return me.runKernel(vhe,o,t)},filter:function(){return me.runKernel(mhe,s,t)}}}},Pve={kernelName:ghe,outputsToSave:[!0],gradFunc:function(n,e){var t=te(e,1),r=t[0],a={dy:n,y:r};return{x:function(){return me.runKernel(yhe,a)}}}};function Mve(n){var e=Ie(n,"x","exp"),t={x:e};return me.runKernel(iP,t)}var tv=Ve({exp_:Mve}),Bve={kernelName:bhe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0],a=be(tv(La(In(r))),2/Math.sqrt(Math.PI));return{x:function(){return be(n,a)}}}},Lve={kernelName:iP,outputsToSave:[!0],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(n,r)}}}},zve={kernelName:oP,inputsToSave:["input"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{input:function(){return Je(n,r.shape)}}}},$ve={kernelName:xhe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(n,tv(r))}}}};var qve={kernelName:sP,gradFunc:function(n){return{x:function(){return At(n)}}}},Wve={kernelName:uP,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=lr(r.shape,a.shape),o=function(){var u=Ot(n,St(a,"float32")),c=nr(r.shape,i);return c.length>0?Je(gn(u,c),r.shape):u},s=function(){var u=be(n,St(r,"float32")),c=nr(a.shape,i);c.length>0&&(u=Je(gn(u,c),a.shape));var l=In(a);return La(Ot(u,St(l,"float32")))};return{a:o,b:s}}};function Vve(n){var e=Ie(n,"x","rsqrt","float32"),t={x:e};return me.runKernel(wP,t)}var Gve=Ve({rsqrt_:Vve});function Uve(n,e){var t=Ie(n,"x","tile","string_or_numeric");Se(t.rank===e.length,function(){return"Error in transpose: rank of input ".concat(t.rank," ")+"must match length of reps ".concat(e,".")});var r={x:t},a={reps:e};return me.runKernel(sb,r,a)}var Hve=Ve({tile_:Uve}),Kve={kernelName:She,inputsToSave:["x","mean","variance","scale"],gradFunc:function(n,e,t){var r=t.varianceEpsilon,a=te(e,4),i=a[0],o=a[1],s=a[2],u=a[3],c=u??En(1),l=nr(o.shape,i.shape),f=[];if(o.rank===1){for(var h=0;h<i.shape.length-1;++h)f.push(i.shape[h]);f.push(1)}var d=tr(i,o),p=be(n,c),v=Gve(xt(s,En(r))),m=be(be(be(v,v),v),En(-.5)),g=function(){return o.rank===1?Je(be(be(n,Hve(Je(v,[1,1,1,o.shape[0]]),f)),c),i.shape):Je(be(be(n,v),c),i.shape)},y=function(){var N=be(be(v,En(-1)),p);return o.rank===1&&(N=gn(N,l)),Je(N,o.shape)},b=function(){var N=be(be(m,d),p);return o.rank===1&&(N=gn(N,l)),Je(N,o.shape)},w=function(){var N=be(d,v),T=be(n,N);return o.rank===1&&(T=gn(T,l)),Je(T,o.shape)},x=function(){var N=n;return o.rank===1&&(N=gn(N,l)),Je(N,o.shape)};return{x:g,mean:y,variance:b,scale:w,offset:x}}};function jve(n,e,t){var r=Ie(n,"x","unsortedSegmentSum"),a=Ie(e,"segmentIds","unsortedSegmentSum","int32");Se(_p(t),function(){return"numSegments must be of dtype int"});var i={x:r,segmentIds:a},o={numSegments:t};return me.runKernel(FP,i,o)}var Xve=Ve({unsortedSegmentSum_:jve}),Yve={kernelName:cP,inputsToSave:["x","indices"],gradFunc:function(n,e,t){var r=te(e,2),a=r[0],i=r[1],o=t.axis,s=Ls(o,a.shape)[0],u=function(){var c=a.shape,l=i.size,f=c.slice(0,s),h=f.length,d=c.slice(o,c.length).slice(1),p=d.length,v=iO(0,h),m=iO(h+1,h+1+p),g=oO([f,[l],d]),y=Je(n,g),b=Je(i,[l]),w=oO([[h],v,m]),x=dc(y,w),N=Xve(x,b,a.shape[s]),T=xb(w);return N=dc(N,T),N};return{x:u,indices:function(){return i}}}};function iO(n,e){for(var t=[],r=n;r<e;++r)t.push(r);return t}function oO(n){for(var e=[],t=0;t<n.length;++t)for(var r=0;r<n[t].length;++r)e.push(n[t][r]);return e}var Zve={kernelName:lP,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1];return{a:function(){return At(r)},b:function(){return At(a)}}}};var Jve={kernelName:ob,gradFunc:function(n){return{x:function(){return St(n,"float32")}}}};var Qve={kernelName:Ehe,gradFunc:function(n){return{x:function(){return At(n)}}}};var eme={kernelName:Ihe,gradFunc:function(n){return{x:function(){return At(n)}}}};var tme={kernelName:Che,gradFunc:function(n){return{x:function(){return At(n)}}}};function nme(n,e){var t,r=Ie(n,"a","greater","string_or_numeric"),a=Ie(e,"b","greater","string_or_numeric");t=te(va(r,a),2),r=t[0],a=t[1],lr(r.shape,a.shape);var i={a:r,b:a};return me.runKernel(Nhe,i)}var Of=Ve({greater_:nme}),rme={kernelName:Ahe,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.alpha,o=Of(a,0);return{x:function(){return Ms(o,n,be(n,i))}}}},ame={kernelName:Fhe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Ot(n,xt(r,1))}}}},ime={kernelName:fP,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Ot(n,St(r,"float32"))}}}},ome={kernelName:Phe,inputsToSave:[],outputsToSave:[!0],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.axis;return{logits:function(){var o=!0,s=tv(a);return tr(n,be(gn(n,i,o),s))}}}};function sme(n,e,t,r,a,i,o){r===void 0&&(r=5),a===void 0&&(a=1),i===void 0&&(i=1),o===void 0&&(o=.5);var s={x:n,y:e,dy:t},u={depthRadius:r,bias:a,alpha:i,beta:o};return me.runKernel(Bhe,s,u)}var ume=Ve({localResponseNormalizationBackprop_:sme}),cme={kernelName:Mhe,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(n,e,t){var r=te(e,2),a=r[0],i=r[1],o=t.depthRadius,s=t.bias,u=t.alpha,c=t.beta;return{x:function(){return ume(a,i,n,o,s,u,c)}}}};function lme(n,e){var t,r=Ie(n,"a","equal","string_or_numeric"),a=Ie(e,"b","equal","string_or_numeric");t=te(va(r,a),2),r=t[0],a=t[1],lr(r.shape,a.shape);var i={a:r,b:a};return me.runKernel(whe,i)}var fme=Ve({equal_:lme});function rM(n,e,t,r){return e.rank<t.rank&&(e=Je(e,aO(e.shape,r))),n.rank<t.rank&&(n=Je(n,aO(n.shape,r))),{x:function(){var a=be(n,St(fme(t,e),n.dtype));return a}}}var sO={kernelName:Lhe,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(n,e,t){var r=t,a=r.reductionIndices,i=e[0],o=e[1],s=Ls(a,i.shape),u=rM(n,o,i,s);return{x:function(){return u.x()}}}};function hme(n,e){var t,r=Ie(n,"a","less","string_or_numeric"),a=Ie(e,"b","less","string_or_numeric");t=te(va(r,a),2),r=t[0],a=t[1],lr(r.shape,a.shape);var i={a:r,b:a};return me.runKernel(Dhe,i)}var dme=Ve({less_:hme}),pme={kernelName:hP,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=function(){return be(n,St(bb(r,a),"float32"))},o=function(){return be(n,St(dme(r,a),"float32"))};return{a:i,b:o}}};function vme(n,e,t,r,a,i,o){var s=Ie(n,"dy","maxPool3dGrad"),u=Ie(e,"input","maxPool3dGrad"),c=Ie(t,"output","maxPool3dGrad"),l=s,f=u,h=c,d=!1;u.rank===4&&(d=!0,l=Je(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),f=Je(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=Je(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),Se(l.rank===5,function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank "+"".concat(l.rank,".")}),Se(f.rank===5,function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank "+"".concat(f.rank,".")}),Se(h.rank===5,function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank "+"".concat(h.rank,".")}),$s("maxPool3dGrad",i,o);var p={dy:l,input:f,output:h},v={filterSize:r,strides:a,pad:i,dimRoundingMode:o},m=me.runKernel(Whe,p,v);return d?Je(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}var mme=Ve({maxPool3dGrad_:vme}),gme={kernelName:qhe,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(n,e,t){var r=te(e,2),a=r[0],i=r[1],o=t.filterSize,s=t.strides,u=t.pad,c=t.dimRoundingMode;return{x:function(){return mme(n,a,i,o,s,u,c)}}}};function yme(n,e,t,r,a,i,o){var s=Ie(n,"dy","maxPoolGrad"),u=Ie(e,"input","maxPoolGrad"),c=Ie(t,"output","maxPoolGrad");Se(u.rank===s.rank,function(){return"Rank of input (".concat(u.rank,") does not match rank of dy ")+"(".concat(s.rank,")")}),Se(s.rank===4,function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank "+"".concat(s.rank,".")}),Se(u.rank===4,function(){return"Error in maxPoolGrad: input must be rank 4 but got rank "+"".concat(u.rank,".")}),$s("maxPoolGrad",i,o);var l={dy:s,input:u,output:c},f={filterSize:r,strides:a,pad:i,dimRoundingMode:o};return me.runKernel($he,l,f)}var bme=Ve({maxPoolGrad_:yme}),wme={kernelName:zhe,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(n,e,t){var r=te(e,2),a=r[0],i=r[1],o=t.filterSize,s=t.strides,u=t.pad;return{x:function(){return bme(n,a,i,o,s,u)}}}};function Pp(n,e){if(e===void 0&&(e="float32"),Rf(n),e==="complex64"){var t=Pp(n,"float32"),r=Pp(n,"float32");return kb(t,r)}var a=hb(Oi(n),e);return me.makeTensor(a,n,e)}function nv(n,e){if(e===void 0&&(e="float32"),Rf(n),e==="complex64"){var t=nv(n,"float32"),r=Pp(n,"float32");return kb(t,r)}var a=MP(Oi(n),e);return me.makeTensor(a,n,e)}var xme={kernelName:Vhe,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.axis,o=Ls(i,a.shape),s=yve(a.shape,o),u=s[1],c=Oi(u),l=function(){var f=a.shape.slice();o.forEach(function(p){f[p]=1});var h=Je(n,f),d=Ot(be(h,nv(a.shape,"float32")),c);return d};return{x:l}}},kme={kernelName:Ghe,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(n,e,t){var r=t,a=r.axis,i=te(e,2),o=i[0],s=i[1],u=Ls(a,o.shape),c=rM(n,s,o,u);return{x:function(){return c.x()}}}},Sme={kernelName:Uhe,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=function(){return be(n,St(wb(r,a),"float32"))},o=function(){return be(n,St(Of(r,a),"float32"))};return{a:i,b:o}}};function Nme(n,e,t){var r=Ie(n,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");var a={x:r},i={begin:e,size:t};return me.runKernel(kP,a,i)}var cc=Ve({slice_:Nme});var Tme={kernelName:Hhe,inputsToSave:["x"],gradFunc:function(n,e,t){var r=e[0],a=t.paddings,i=a.map(function(o){return o[0]});return{x:function(){return cc(n,i,r.shape)}}}};function Eme(n){var e=Ie(n,"x","floor","float32"),t={x:e};return me.runKernel(sP,t)}var Ime=Ve({floor_:Eme}),Cme={kernelName:Khe,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=lr(r.shape,a.shape),o=function(){var u=nr(r.shape,i);return u.length>0?Je(gn(n,u),r.shape):n},s=function(){var u=be(n,La(Ime(Ot(r,a)))),c=nr(a.shape,i);return c.length>0?Je(gn(u,c),a.shape):u};return{a:o,b:s}}},Ame={kernelName:dP,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=lr(r.shape,a.shape),o=function(){var u=be(n,St(a,"float32")),c=nr(r.shape,i);return c.length>0?Je(gn(u,c),r.shape):u},s=function(){var u=be(n,St(r,"float32")),c=nr(a.shape,i);return c.length>0?Je(gn(u,c),a.shape):u};return{a:o,b:s}}};var Dme={kernelName:pP,gradFunc:function(n){return{x:function(){return La(n)}}}};var _me={kernelName:Xhe,inputsToSave:["indices"],gradFunc:function(n,e){var t=e[0];return{indices:function(){return Pp(t.shape,"float32")}}}};var Fme={kernelName:jhe,gradFunc:function(n){return{x:function(){return At(n)}}}};function Rme(n,e){e===void 0&&(e=0);var t=Ie(n,"x","unstack","string_or_numeric");Se(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = ".concat(e," is not in [-").concat(t.shape.length,", ").concat(t.shape.length,")")});var r={value:t},a={axis:e};return me.runKernel(_P,r,a)}var Ome=Ve({unstack_:Rme});var Pme={kernelName:vP,saveAllInputs:!0,gradFunc:function(n,e,t){var r=t.axis,a=Ome(n,r);return a.map(function(i){return function(){return i}})}};var uO={kernelName:mP,inputsToSave:["x"],gradFunc:function(n,e,t){var r=e[0],a=t.paddings,i=a.map(function(o){return o[0]});return{x:function(){return cc(n,i,r.shape)}}}};function Mme(n){var e=Ie(n,"x","log","float32"),t={x:e};return me.runKernel(fP,t)}var Bme=Ve({log_:Mme});function Lme(n,e){var t,r=Ie(n,"base","pow"),a=Ie(e,"exp","pow");t=te(va(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return me.runKernel(gP,i)}var Mp=Ve({pow_:Lme}),zme={kernelName:gP,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(n,e){var t=te(e,3),r=t[0],a=t[1],i=t[2],o=r,s=a,u=lr(o.shape,s.shape),c=function(){var f=St(s,"float32"),h=be(n,be(f,Mp(o,tr(f,En(1))))),d=nr(o.shape,u);return d.length>0&&(h=gn(h,d)),Je(h,o.shape)},l=function(){var f=Of(o,0),h=Ms(f,Bme(o),At(o)),d=be(n,be(i,h)),p=nr(s.shape,u);return p.length>0&&(d=gn(d,p)),Je(d,s.shape)};return{a:c,b:l}}},$me={kernelName:Yhe,inputsToSave:["x","alpha"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=Of(r,0);return{x:function(){return Ms(i,n,be(n,a))},alpha:function(){var o=Ms(i,At(n),be(n,r)),s=nr(a.shape,n.shape);return s.length>0&&(o=gn(o,s)),Je(o,a.shape)}}}};function qme(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var da=Tn();da.registerFlag("DEBUG",function(){return!1},function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});da.registerFlag("IS_BROWSER",function(){return qme()});da.registerFlag("IS_NODE",function(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"});da.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)});da.registerFlag("PROD",function(){return!1});da.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return da.getBool("DEBUG")});da.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0});da.registerFlag("IS_TEST",function(){return!1});da.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",function(){return!0});da.registerFlag("WRAP_TO_IMAGEBITMAP",function(){return!1});da.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",function(){return!1});da.registerFlag("USE_SETTIMEOUTCUSTOM",function(){return!1});var Sb=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function cO(n){return Sb?Buffer.byteLength(n):new Blob([n]).size}function Wme(n){if(Sb)return Buffer.from(n).toString("base64");for(var e=new Uint8Array(n),t="",r=0,a=e.length;r<a;r++)t+=String.fromCharCode(e[r]);return btoa(t)}function Vme(n){if(Sb){var e=Buffer.from(n,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var t=atob(n),r=new Uint8Array(t.length),a=0;a<t.length;++a)r.set([t.charCodeAt(a)],a);return r.buffer}function Gme(n){if(n.length===1)return n[0];var e=0;n.forEach(function(a){e+=a.byteLength});var t=new Uint8Array(e),r=0;return n.forEach(function(a){t.set(new Uint8Array(a),r),r+=a.byteLength}),t.buffer}function aM(n,e){var t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function Ume(n,e,t){var r={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(r.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=e,r.weightData=t}return n.signature!=null&&(r.signature=n.signature),n.userDefinedMetadata!=null&&(r.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(r.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(r.initializerSignature=n.initializerSignature),r}function Hme(n,e){return Ce(this,void 0,void 0,function(){var t,r,a;return Ee(this,function(i){switch(i.label){case 0:return n.weightsManifest==null?[3,2]:[4,e(n.weightsManifest)];case 1:a=te.apply(void 0,[i.sent(),2]),t=a[0],r=a[1],i.label=2;case 2:return[2,Ume(n,t,r)]}})})}function rv(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:cO(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:cO(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}function Kme(n){var e,t,r=[];try{for(var a=fe(n),i=a.next();!i.done;i=a.next()){var o=i.value;r.push.apply(r,Qe([],te(o.weights),!1))}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return r}var qs=function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerSaveRouter=function(e){n.getInstance().saveRouters.push(e)},n.registerLoadRouter=function(e){n.getInstance().loadRouters.push(e)},n.getSaveHandlers=function(e){return n.getHandlers(e,"save")},n.getLoadHandlers=function(e,t){return n.getHandlers(e,"load",t)},n.getHandlers=function(e,t,r){var a=[],i=t==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters;return i.forEach(function(o){var s=o(e,r);s!==null&&a.push(s)}),a},n}(),jme="tensorflowjs",Xme=1,kf="models_store",Ep="model_info_store";function Yme(){if(!Tn().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Zme(n){var e=n.result;e.createObjectStore(kf,{keyPath:"modelPath"}),e.createObjectStore(Ep,{keyPath:"modelPath"})}var Bp=function(){function n(e){if(this.indexedDB=Yme(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return n.prototype.save=function(e){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},n.prototype.load=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},n.prototype.databaseAction=function(e,t){var r=this;return new Promise(function(a,i){var o=r.indexedDB.open(jme,Xme);o.onupgradeneeded=function(){return Zme(o)},o.onsuccess=function(){var s=o.result;if(t==null){var u=s.transaction(kf,"readonly"),c=u.objectStore(kf),l=c.get(r.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),i(new Error("Cannot find model with path '".concat(r.modelPath,"' ")+"in IndexedDB."));a(l.result.modelArtifacts)},l.onerror=function(m){return s.close(),i(l.error)},u.oncomplete=function(){return s.close()}}else{var f=rv(t),h=s.transaction(Ep,"readwrite"),d=h.objectStore(Ep),p=d.put({modelPath:r.modelPath,modelArtifactsInfo:f}),v;p.onsuccess=function(){v=s.transaction(kf,"readwrite");var m=v.objectStore(kf),g=m.put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:f});g.onsuccess=function(){return a({modelArtifactsInfo:f})},g.onerror=function(y){d=h.objectStore(Ep);var b=d.delete(r.modelPath);b.onsuccess=function(){return s.close(),i(g.error)},b.onerror=function(w){return s.close(),i(g.error)}}},p.onerror=function(m){return s.close(),i(p.error)},h.oncomplete=function(){v==null?s.close():v.oncomplete=function(){return s.close()}}}},o.onerror=function(s){return i(o.error)}})},n}();Bp.URL_SCHEME="indexeddb://";var iM=function(n){return Tn().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Bp.URL_SCHEME)?Jme(n.slice(Bp.URL_SCHEME.length)):null};qs.registerSaveRouter(iM);qs.registerLoadRouter(iM);function Jme(n){return new Bp(n)}var pf="/",vf="tensorflowjs_models",Qme="info",ege="model_topology",tge="weight_specs",nge="weight_data",rge="model_metadata";function age(n){return{info:[vf,n,Qme].join(pf),topology:[vf,n,ege].join(pf),weightSpecs:[vf,n,tge].join(pf),weightData:[vf,n,nge].join(pf),modelMetadata:[vf,n,rge].join(pf)}}function ige(n){var e,t;try{for(var r=fe(Object.values(n)),a=r.next();!a.done;a=r.next()){var i=a.value;window.localStorage.removeItem(i)}}catch(o){e={error:o}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}}var Lp=function(){function n(e){if(!Tn().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=age(this.modelPath)}return n.prototype.save=function(e){return Ce(this,void 0,void 0,function(){var t,r,a,i;return Ee(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),a=rv(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,Wme(e.weightData)),i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),[2,{modelArtifactsInfo:a}]}catch{throw ige(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."))}return[2]})})},n.prototype.load=function(){return Ce(this,void 0,void 0,function(){var e,t,r,a,i,o,s;return Ee(this,function(u){if(e=JSON.parse(this.LS.getItem(this.keys.info)),e==null)throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},r=JSON.parse(this.LS.getItem(this.keys.topology)),r==null)throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");if(t.modelTopology=r,a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)),a==null)throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");if(t.weightSpecs=a,i=this.LS.getItem(this.keys.modelMetadata),i!=null&&(o=JSON.parse(i),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,o.signature!=null&&(t.signature=o.signature),o.userDefinedMetadata!=null&&(t.userDefinedMetadata=o.userDefinedMetadata),o.modelInitializer!=null&&(t.modelInitializer=o.modelInitializer),o.initializerSignature!=null&&(t.initializerSignature=o.initializerSignature),o.trainingConfig!=null&&(t.trainingConfig=o.trainingConfig)),s=this.LS.getItem(this.keys.weightData),s==null)throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));return t.weightData=Vme(s),[2,t]})})},n}();Lp.URL_SCHEME="localstorage://";var oM=function(n){return Tn().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Lp.URL_SCHEME)?oge(n.slice(Lp.URL_SCHEME.length)):null};qs.registerSaveRouter(oM);qs.registerLoadRouter(oM);function oge(n){return new Lp(n)}var sge="model",uge=".json",cge=".weights.bin";function lO(n){return new Promise(function(e){return setTimeout(e)}).then(n)}var zp=function(){function n(e){if(!Tn().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),(e==null||e.length===0)&&(e=sge),this.modelJsonFileName=e+uge,this.weightDataFileName=e+cge}return n.prototype.save=function(e){return Ce(this,void 0,void 0,function(){var t,r,a,i,o,s;return Ee(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],a=aM(e,r),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),o=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor,o.download=this.modelJsonFileName,o.href=i,[4,lO(function(){return o.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),e.weightData==null?[3,4]:(s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor,s.download=this.weightDataFileName,s.href=t,[4,lO(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:rv(e)}]}})})},n}();zp.URL_SCHEME="downloads://";var lge=function(n){return Tn().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(zp.URL_SCHEME)?fge(n.slice(zp.URL_SCHEME.length)):null};qs.registerSaveRouter(lge);function fge(n){return n===void 0&&(n="model"),new zp(n)}function fO(n,e,t,r){o(n),t=t??0,r=r??1,s(t,r);var a=0,i=function(u){return u.then(function(c){var l=t+ ++a/n.length*(r-t);return e(l),c}),u};function o(u){Se(u!=null&&Array.isArray(u)&&u.length>0,function(){return"promises must be a none empty array"})}function s(u,c){Se(u>=0&&u<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(u)}),Se(c>=0&&c<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(c)}),Se(c>=u,function(){return"startFraction must be no more than endFraction, but "+"got startFraction ".concat(u," and endFraction ")+"".concat(c)})}return Promise.all(n.map(i))}function hge(n,e){return Ce(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f,h;return Ee(this,function(d){switch(d.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?Tn().platform.fetch:e.fetchFunc,r=n.map(function(p){return t(p,e.requestInit,{isBinary:!0})}),a=0,i=.5,e.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return s=d.sent(),[3,4];case 2:return[4,fO(r,e.onProgress,a,i)];case 3:s=d.sent(),d.label=4;case 4:return o=s,u=o.map(function(p){return p.arrayBuffer()}),c=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(u)];case 5:return h=d.sent(),[3,8];case 6:return[4,fO(u,e.onProgress,c,l)];case 7:h=d.sent(),d.label=8;case 8:return f=h,[2,f]}})})}var dge="application/octet-stream",pge="application/json",Nb=function(){function n(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(Se(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=Tn().platform.fetch,Se(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&Se(e.length===2,function(){return"URL paths for http must have a length of 2, "+"(actual length is ".concat(e.length,").")}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return n.prototype.save=function(e){return Ce(this,void 0,void 0,function(){var t,r,a,i;return Ee(this,function(o){switch(o.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit),t.body=new FormData,r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=aM(e,r),t.body.append("model.json",new Blob([JSON.stringify(a)],{type:pge}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:dge}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if(i=o.sent(),i.ok)return[2,{modelArtifactsInfo:rv(e),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(i.status,"."))}})})},n.prototype.load=function(){return Ce(this,void 0,void 0,function(){var e,t,r,a,i,o=this;return Ee(this,function(s){switch(s.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(e=s.sent(),!e.ok)throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(e.status,". Please verify this URL points to ")+"the model JSON of the model to load.");s.label=2;case 2:return s.trys.push([2,4,,5]),[4,e.json()];case 3:return t=s.sent(),[3,5];case 4:throw s.sent(),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(a=t.modelTopology,i=t.weightsManifest,a==null&&i==null)throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");return[2,Hme(t,function(u){return o.loadWeights(u)})]}})})},n.prototype.loadWeights=function(e){return Ce(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f,h,d,p,v,m,g,y,b,w,x,N,T,E;return Ee(this,function(C){switch(C.label){case 0:t=Array.isArray(this.path)?this.path[1]:this.path,r=te(vge(t),2),a=r[0],i=r[1],o=this.weightPathPrefix||a,s=Kme(e),u=[],c=[];try{for(l=fe(e),f=l.next();!f.done;f=l.next()){h=f.value;try{for(d=(T=void 0,fe(h.paths)),p=d.next();!p.done;p=d.next())v=p.value,this.weightUrlConverter!=null?c.push(this.weightUrlConverter(v)):u.push(o+v+i)}catch(F){T={error:F}}finally{try{p&&!p.done&&(E=d.return)&&E.call(d)}finally{if(T)throw T.error}}}}catch(F){x={error:F}}finally{try{f&&!f.done&&(N=l.return)&&N.call(l)}finally{if(x)throw x.error}}return this.weightUrlConverter?(g=(m=u.push).apply,y=[u],b=[[]],[4,Promise.all(c)]):[3,2];case 1:g.apply(m,y.concat([Qe.apply(void 0,b.concat([te.apply(void 0,[C.sent()]),!1]))])),C.label=2;case 2:return[4,hge(u,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 3:return w=C.sent(),[2,[s,Gme(w)]]}})})},n}();Nb.URL_SCHEME_REGEX=/^https?:\/\//;function vge(n){var e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),r=n.substring(0,e),a=t>e?n.substring(t):"";return[r+"/",a]}function hO(n){return n.match(Nb.URL_SCHEME_REGEX)!=null}var sM=function(n,e){if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;var t=!0;return Array.isArray(n)?t=n.every(function(r){return hO(r)}):t=hO(n),t?mge(n,e):null};qs.registerSaveRouter(sM);qs.registerLoadRouter(sM);function mge(n,e){return new Nb(n,e)}function gge(n,e,t){var r,a=n.shape.length;typeof e=="number"?r=Qe([e],te(new Array(a-1).fill(0)),!1):e.length<a?r=e.concat(new Array(a-e.length).fill(0)):r=e.slice(),r.forEach(function(o){Se(o!==-1,function(){return"slice() does not support negative begin indexing."})});var i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=Qe([t],te(new Array(a-1).fill(-1)),!1):t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map(function(o,s){return o>=0?o:(Se(o===-1,function(){return"Negative size values should be exactly -1 but got "+"".concat(o," for the slice() size at index ").concat(s,".")}),n.shape[s]-r[s])}),[r,i]}var yge=function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(e,t){return new e(t)},n}();function bge(n){var e=Ie(n,"x","abs");if(e.dtype==="complex64"){var t={x:e};return me.runKernel(ZO,t)}else{var t={x:e};return me.runKernel(jO,t)}}var wge=Ve({abs_:bge});function xge(n,e){e===void 0&&(e=0),Se(n.length>=1,function(){return"Pass at least one tensor to concat"});var t=XP(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `.concat(i.dtype,". "))}),t.length===1)return eM(t[0]);var r=t,a={axis:e};return me.runKernel(JO,r,a)}var kge=Ve({concat_:xge});function Sge(n){var e=Ie(n,"x","sigmoid","float32"),t={x:e};return me.runKernel(TP,t)}var Nge=Ve({sigmoid_:Sge});function Tge(n,e,t){var r=Ie(n,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});Se(r.rank>=1+e.length,function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(e.length)}),Se(t.length===e.length,function(){return"crops.length is ".concat(t.length," but should be equal to blockShape.length  ").concat(e.length)}),Se(r.shape[0]%a===0,function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(e.join(" * ")," === ").concat(a)});var i={x:r},o={blockShape:e,crops:t};return me.runKernel(YO,i,o)}var Ege=Ve({batchToSpaceND_:Tge});function Ige(n,e,t){Rf(n);var r={shape:n,value:e,dtype:t};return me.runKernel(khe,{},r)}function Cge(n){var e=Ie(n,"x","cos","float32"),t={x:e};return me.runKernel(tP,t)}var uM=Ve({cos_:Cge});function Age(n){var e=Ie(n,"x","cosh","float32"),t={x:e};return me.runKernel(nP,t)}var Dge=Ve({cosh_:Age});function _ge(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var a=Ie(n,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:r};return me.runKernel(lhe,i,o)}var dO=Ve({cumprod_:_ge});function Fge(n,e){e===void 0&&(e=0);var t=Ie(n,"x","expandDims","string_or_numeric");Se(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var r={input:t},a={dim:e};return me.runKernel(oP,r,a)}var Rge=Ve({expandDims_:Fge});function Oge(n,e,t,r){t===void 0&&(t=0),r===void 0&&(r=0);var a=Ie(n,"x","gather"),i=Ie(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:r};return me.runKernel(cP,o,s)}var Pge=Ve({gather_:Oge});function Mge(n,e){Se(Py(n),function(){return"The f passed in variableGrads(f) must be a function"}),Se(e==null||Array.isArray(e)&&e.every(function(f){return f instanceof Op}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t){e=[];for(var r in me.registeredVariables)e.push(me.registeredVariables[r])}var a=t?e.filter(function(f){return!f.trainable}):null,i=e.length;e=e.filter(function(f){return f.trainable}),Se(e.length>0,function(){return"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(i," variables is ")+"trainable."});var o=!0,s=me.gradients(n,e,null,o),u=s.value,c=s.grads;Se(c.some(function(f){return f!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),Se(u.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(u.rank," tensor")});var l={};return e.forEach(function(f,h){c[h]!=null&&(l[f.name]=c[h])}),a?.forEach(function(f){return l[f.name]=null}),{value:u,grads:l}}function Bge(n){var e=Ie(n,"x","logicalNot","bool"),t={x:e};return me.runKernel(Ohe,t)}var Lge=Ve({logicalNot_:Bge});function zge(n,e){var t,r=Ie(n,"a","maximum"),a=Ie(e,"b","maximum");t=te(va(r,a),2),r=t[0],a=t[1],r.dtype==="bool"&&(r=St(r,"int32"),a=St(a,"int32")),lr(r.shape,a.shape);var i={a:r,b:a};return me.runKernel(hP,i)}var cM=Ve({maximum_:zge});function $ge(n,e,t){t===void 0&&(t=0);var r=Ie(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:r};return me.runKernel(mP,i,a)}var qge=Ve({pad_:$ge}),Ws=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Wge(n){if(n.__esModule)return n;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(n).forEach(function(t){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}),e}function Vs(n){var e={exports:{}};return n(e,e.exports),e.exports}var Vge=Vs(function(n){(function(e,t,r){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.alea=o})(Ws,n,!1)}),Gge=Vs(function(n){(function(e,t,r){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor128=o})(Ws,n,!1)}),Uge=Vs(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorwow=o})(Ws,n,!1)}),Hge=Vs(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,d;return h=l[f],h^=h>>>7,d=h^h<<24,h=l[f+1&7],d^=h^h>>>10,h=l[f+3&7],d^=h^h>>>3,h=l[f+4&7],d^=h^h<<7,h=l[f+7&7],h=h^h<<13,d^=h^h<<9,l[f]=d,u.i=f+1&7,d};function c(l,f){var h,d=[];if(f===(f|0))d[0]=f;else for(f=""+f,h=0;h<f.length;++h)d[h&7]=d[h&7]<<15^f.charCodeAt(h)+d[h+1&7]<<13;for(;d.length<8;)d.push(0);for(h=0;h<8&&d[h]===0;++h);for(h==8&&(d[7]=-1),l.x=d,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorshift7=o})(Ws,n,!1)}),Kge=Vs(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,d,p;return u.w=l=l+1640531527|0,p=f[h+34&127],d=f[h=h+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,p=f[h]=p^d,u.i=h,p+(l^l>>>16)|0};function c(l,f){var h,d,p,v,m,g=[],y=128;for(f===(f|0)?(d=f,f=null):(f=f+"\0",d=0,y=Math.max(y,f.length)),p=0,v=-32;v<y;++v)f&&(d^=f.charCodeAt((v+32)%f.length)),v===0&&(m=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,v>=0&&(m=m+1640531527|0,h=g[v&127]^=d+m,p=h==0?p+1:0);for(p>=128&&(g[(f&&f.length||0)&127]=-1),p=127,v=4*128;v>0;--v)d=g[p+34&127],h=g[p=p+1&127],d^=d<<13,h^=h<<17,d^=d>>>15,h^=h>>>12,g[p]=d^h;l.w=m,l.X=g,l.i=p}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor4096=o})(Ws,n,!1)}),jge=Vs(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,d=u.d,p=u.a;return f=f<<25^f>>>7^h,h=h-d|0,d=d<<24^d>>>8^p,p=p-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-d|0,u.d=d<<16^h>>>16^p,u.a=p-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.tychei=o})(Ws,n,!1)}),Xge={},Yge={__proto__:null,default:Xge},Zge=Wge(Yge),mc=Vs(function(n){(function(e,t,r){var a=256,i=6,o=52,s="random",u=r.pow(a,i),c=r.pow(2,o),l=c*2,f=a-1,h;function d(w,x,N){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(m(x.entropy?[w,b(t)]:w??y(),3),T),C=new p(T),F=function(){for(var _=C.g(i),O=u,L=0;_<c;)_=(_+L)*a,O*=a,L=C.g(1);for(;_>=l;)_/=2,O/=2,L>>>=1;return(_+L)/O};return F.int32=function(){return C.g(4)|0},F.quick=function(){return C.g(4)/4294967296},F.double=F,g(b(C.S),t),(x.pass||N||function(_,O,L,z){return z&&(z.S&&v(z,C),_.state=function(){return v(C,{})}),L?(r[s]=_,O):_})(F,E,"global"in x?x.global:this==r,x.state)}function p(w){var x,N=w.length,T=this,E=0,C=T.i=T.j=0,F=T.S=[];for(N||(w=[N++]);E<a;)F[E]=E++;for(E=0;E<a;E++)F[E]=F[C=f&C+w[E%N]+(x=F[E])],F[C]=x;(T.g=function(_){for(var O,L=0,z=T.i,$=T.j,B=T.S;_--;)O=B[z=f&z+1],L=L*a+B[f&(B[z]=B[$=f&$+O])+(B[$]=O)];return T.i=z,T.j=$,L})(a)}function v(w,x){return x.i=w.i,x.j=w.j,x.S=w.S.slice(),x}function m(w,x){var N=[],T=typeof w,E;if(x&&T=="object")for(E in w)try{N.push(m(w[E],x-1))}catch{}return N.length?N:T=="string"?w:w+"\0"}function g(w,x){for(var N=w+"",T,E=0;E<N.length;)x[f&E]=f&(T^=x[f&E]*19)+N.charCodeAt(E++);return b(x)}function y(){try{var w;return h&&(w=h.randomBytes)?w=w(a):(w=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var x=e.navigator,N=x&&x.plugins;return[+new Date,e,N,e.screen,b(t)]}}function b(w){return String.fromCharCode.apply(0,w)}if(g(r.random(),t),n.exports){n.exports=d;try{h=Zge}catch{}}else r["seed"+s]=d})(typeof self<"u"?self:Ws,[],Math)});mc.alea=Vge;mc.xor128=Gge;mc.xorwow=Uge;mc.xorshift7=Hge;mc.xor4096=Kge;mc.tychei=jge;function Jge(n,e){var t=Ie(n,"x","reverse"),r={x:t},a={dims:e};return me.runKernel(bP,r,a)}var Qge=Ve({reverse_:Jge});function e0e(n,e){e===void 0&&(e=0);var t=XP(n,"tensors","stack","string_or_numeric");Se(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&Se(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var r=t,a={axis:e};return me.runKernel(vP,r,a)}var t0e=Ve({stack_:e0e});var pO;(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(pO||(pO={}));var Gs=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.minimize=function(t,r,a){r===void 0&&(r=!1);var i=this.computeGradients(t,a),o=i.value,s=i.grads;if(a!=null){var u=a.map(function(c){return{name:c.name,tensor:s[c.name]}});this.applyGradients(u)}else this.applyGradients(s);return ha(s),r?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!1,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,r){return Mge(t,r)},e.prototype.dispose=function(){this.iterations_!=null&&ha(this.iterations_)},e.prototype.saveIterations=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:En(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()))})})},e.prototype.extractIterations=function(t){return Ce(this,void 0,void 0,function(){var r;return Ee(this,function(a){switch(a.label){case 0:return r=this,[4,t[0].tensor.data()];case 1:return r.iterations_=a.sent()[0],[2,t.slice(1)]}})})},e}(yge);Object.defineProperty(Gs,Symbol.hasInstance,{value:function(n){return n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null}});(function(n){se(e,n);function e(t,r,a){a===void 0&&(a=null);var i=n.call(this)||this;return i.learningRate=t,i.rho=r,i.epsilon=a,i.accumulatedGrads=[],i.accumulatedUpdates=[],a==null&&(i.epsilon=me.backend.epsilon()),i}return Object.defineProperty(e,"className",{get:function(){return"Adadelta"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=me.registeredVariables[i],u=!1;r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:"".concat(i,"/accum_grad"),variable:$n(function(){return At(s).variable(u)})}),r.accumulatedUpdates[o]==null&&(r.accumulatedUpdates[o]={originalName:"".concat(i,"/accum_var"),variable:$n(function(){return At(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=r.accumulatedGrads[o].variable,f=r.accumulatedUpdates[o].variable;$n(function(){var h=xt(be(l,r.rho),be(In(c),1-r.rho)),d=be(Ot(di(xt(f,r.epsilon)),di(xt(l,r.epsilon))),c),p=xt(be(f,r.rho),be(In(d),1-r.rho));l.assign(h),f.assign(p);var v=xt(be(d,-r.learningRate),s);s.assign(v)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(ha(this.accumulatedGrads.map(function(t){return t.variable})),ha(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){var t;return Ee(this,function(r){switch(r.label){case 0:return t=Qe(Qe([],te(this.accumulatedGrads),!1),te(this.accumulatedUpdates),!1),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var r,a;return Ee(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=t.length/2,a=!1,this.accumulatedGrads=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedUpdates=t.slice(r,r*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},e})(Gs);(function(n){se(e,n);function e(t,r){r===void 0&&(r=.1);var a=n.call(this)||this;return a.learningRate=t,a.initialAccumulatorValue=r,a.accumulatedGrads=[],a}return Object.defineProperty(e,"className",{get:function(){return"Adagrad"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=me.registeredVariables[i];if(r.accumulatedGrads[o]==null){var u=!1;r.accumulatedGrads[o]={originalName:"".concat(i,"/accumulator"),variable:$n(function(){return Ige(s.shape,r.initialAccumulatorValue).variable(u)})}}var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=r.accumulatedGrads[o].variable;$n(function(){var f=xt(l,In(c));l.assign(f);var h=xt(be(Ot(c,di(xt(f,me.backend.epsilon()))),-r.learningRate),s);s.assign(h)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&ha(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var r;return Ee(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),r=!1,this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(r)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},e})(Gs);(function(n){se(e,n);function e(t,r,a,i){i===void 0&&(i=null);var o=n.call(this)||this;return o.learningRate=t,o.beta1=r,o.beta2=a,o.epsilon=i,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],$n(function(){o.accBeta1=En(r).variable(),o.accBeta2=En(a).variable()}),i==null&&(o.epsilon=me.backend.epsilon()),o}return Object.defineProperty(e,"className",{get:function(){return"Adam"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);$n(function(){var i=tr(1,r.accBeta1),o=tr(1,r.accBeta2);a.forEach(function(s,u){var c=me.registeredVariables[s],l=!1;r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:$n(function(){return At(c).variable(l)})}),r.accumulatedSecondMoment[u]==null&&(r.accumulatedSecondMoment[u]={originalName:"".concat(s,"/v"),variable:$n(function(){return At(c).variable(l)})});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=r.accumulatedFirstMoment[u].variable,d=r.accumulatedSecondMoment[u].variable,p=xt(be(h,r.beta1),be(f,1-r.beta1)),v=xt(be(d,r.beta2),be(In(f),1-r.beta2)),m=Ot(p,i),g=Ot(v,o);h.assign(p),d.assign(v);var y=xt(be(Ot(m,xt(di(g),r.epsilon)),-r.learningRate),c);c.assign(y)}}),r.accBeta1.assign(be(r.accBeta1,r.beta1)),r.accBeta2.assign(be(r.accBeta2,r.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&ha(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&ha(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){var t;return Ee(this,function(r){switch(r.label){case 0:return t=Qe(Qe([],te(this.accumulatedFirstMoment),!1),te(this.accumulatedSecondMoment),!1),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var r,a,i=this;return Ee(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),$n(function(){i.accBeta1.assign(Mp(i.beta1,i.iterations_+1)),i.accBeta2.assign(Mp(i.beta2,i.iterations_+1))}),r=t.length/2,a=!1,this.accumulatedFirstMoment=t.slice(0,r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),this.accumulatedSecondMoment=t.slice(r,r*2).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},e})(Gs);(function(n){se(e,n);function e(t,r,a,i,o){i===void 0&&(i=null),o===void 0&&(o=0);var s=n.call(this)||this;return s.learningRate=t,s.beta1=r,s.beta2=a,s.epsilon=i,s.decay=o,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],$n(function(){s.iteration=En(0).variable(),s.accBeta1=En(r).variable()}),i==null&&(s.epsilon=me.backend.epsilon()),s}return Object.defineProperty(e,"className",{get:function(){return"Adamax"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);$n(function(){var i=tr(1,r.accBeta1),o=Ot(-r.learningRate,xt(be(r.iteration,r.decay),1));a.forEach(function(s,u){var c=me.registeredVariables[s],l=!1;r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:At(c).variable(l)}),r.accumulatedWeightedInfNorm[u]==null&&(r.accumulatedWeightedInfNorm[u]={originalName:"".concat(s,"/v"),variable:At(c).variable(l)});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=r.accumulatedFirstMoment[u].variable,d=r.accumulatedWeightedInfNorm[u].variable,p=xt(be(h,r.beta1),be(f,1-r.beta1)),v=be(d,r.beta2),m=wge(f),g=cM(v,m);h.assign(p),d.assign(g);var y=xt(be(Ot(o,i),Ot(p,xt(g,r.epsilon))),c);c.assign(y)}}),r.iteration.assign(xt(r.iteration,1)),r.accBeta1.assign(be(r.accBeta1,r.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&ha(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&ha(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e})(Gs);var n0e=function(n){se(e,n);function e(t){var r=n.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return Object.defineProperty(e,"className",{get:function(){return"SGD"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=me.registeredVariables[i];$n(function(){var c=xt(be(r.c,s),u);u.assign(c)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=xve(En(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:if(t=r.sent(),t.length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,r){return new t(r.learningRate)},e}(Gs);(function(n){se(e,n);function e(t,r,a){a===void 0&&(a=!1);var i=n.call(this,t)||this;return i.learningRate=t,i.momentum=r,i.useNesterov=a,i.accumulations=[],i.m=En(i.momentum),i}return Object.defineProperty(e,"className",{get:function(){return"Momentum"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=me.registeredVariables[i];if(r.accumulations[o]==null){var u=!1;r.accumulations[o]={originalName:"".concat(i,"/momentum"),variable:$n(function(){return At(s).variable(u)})}}var c=r.accumulations[o].variable,l=Array.isArray(t)?t[o].tensor:t[i];l!=null&&$n(function(){var f,h=xt(be(r.m,c),l);r.useNesterov?f=xt(be(r.c,xt(l,be(h,r.m))),s):f=xt(be(r.c,h),s),c.assign(h),s.assign(f)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&ha(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var r;return Ee(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),r=!1,this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(r)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},e})(n0e);(function(n){se(e,n);function e(t,r,a,i,o){r===void 0&&(r=.9),a===void 0&&(a=0),i===void 0&&(i=null),o===void 0&&(o=!1);var s=n.call(this)||this;if(s.learningRate=t,s.decay=r,s.momentum=a,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=o,i==null&&(s.epsilon=me.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return Object.defineProperty(e,"className",{get:function(){return"RMSProp"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=me.registeredVariables[i],u=!1;r.accumulatedMeanSquares[o]==null&&(r.accumulatedMeanSquares[o]={originalName:"".concat(i,"/rms"),variable:$n(function(){return At(s).variable(u)})}),r.accumulatedMoments[o]==null&&(r.accumulatedMoments[o]={originalName:"".concat(i,"/momentum"),variable:$n(function(){return At(s).variable(u)})}),r.accumulatedMeanGrads[o]==null&&r.centered&&(r.accumulatedMeanGrads[o]={originalName:"".concat(i,"/mg"),variable:$n(function(){return At(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=r.accumulatedMeanSquares[o].variable,f=r.accumulatedMoments[o].variable;$n(function(){var h=xt(be(l,r.decay),be(In(c),1-r.decay));if(r.centered){var d=r.accumulatedMeanGrads[o].variable,p=xt(be(d,r.decay),be(c,1-r.decay)),v=Ot(be(c,r.learningRate),di(tr(h,xt(In(p),r.epsilon)))),m=xt(be(f,r.momentum),v);l.assign(h),d.assign(p),f.assign(m);var g=tr(s,m);s.assign(g)}else{var y=xt(be(l,r.decay),be(In(c),1-r.decay)),m=xt(be(f,r.momentum),Ot(be(c,r.learningRate),di(xt(y,r.epsilon))));l.assign(y),f.assign(m);var g=tr(s,m);s.assign(g)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&ha(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&ha(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&ha(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){var t;return Ee(this,function(r){switch(r.label){case 0:return t=Qe(Qe([],te(this.accumulatedMeanSquares),!1),te(this.accumulatedMoments),!1),this.centered&&t.push.apply(t,Qe([],te(this.accumulatedMeanGrads),!1)),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var r,a;return Ee(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=this.centered?t.length/3:t.length/2,a=!1,this.accumulatedMeanSquares=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedMoments=t.slice(r,r*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(r*2,r*3).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e})(Gs);(function(){return typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:function(n){return n()}})();var vO;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(vO||(vO={}));var r0e=1.7580993408473768,a0e=1.0507009873554805;function i0e(n,e,t){var r=n.shape.slice();r[t]=1;var a=Je(e,r),i=dO(n,t,!0,!1),o=dO(n,t,!0,!0),s=be(i,o);return be(a,s)}function o0e(n,e,t){var r=n.shape.length,a=r-t.length,i=nM(t,r),o=n;i!=null&&(o=dc(n,i));var s=o.shape.slice(),u=s.splice(r-t.length,t.length),c=u.reduce(function(d,p){return d*p},1);s.push(c);var l=o.reshape(s),f=i0e(l,e,a);if(f=f.reshape(o.shape),i!=null){var h=xb(i);f=dc(f,h)}return f}var s0e={kernelName:Zhe,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.axis,o=[];return i==null?o=a.shape.map(function(s,u){return u}):typeof i=="number"?o=[i]:o=i,{x:function(){return o0e(a,n,o)}}}},u0e={kernelName:aP,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=lr(r.shape,a.shape),o=function(){var u=Ot(n,St(a,"float32")),c=nr(r.shape,i);return c.length>0?Je(gn(u,c),r.shape):u},s=function(){var u=be(n,St(r,"float32")),c=nr(a.shape,i);c.length>0&&(u=Je(gn(u,c),a.shape));var l=In(a);return La(Ot(u,St(l,"float32")))};return{a:o,b:s}}},c0e={kernelName:Qhe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Ot(n,La(In(r)))}}}},l0e={kernelName:ide,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0],a=be(wb(r,6),yb(r));return{x:function(){return be(n,St(a,"float32"))}}}},f0e={kernelName:ede,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(n,St(yb(r),"float32"))}}}},h0e={kernelName:yP,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Je(n,r.shape)}}}},d0e={kernelName:rde,inputsToSave:["images"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i={dy:n,images:a},o=function(){return me.runKernel(ade,i,t)};return{images:o}}},p0e={kernelName:tde,inputsToSave:["images"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i={dy:n,images:a},o=function(){return me.runKernel(nde,i,t)};return{images:o}}};var v0e={kernelName:bP,gradFunc:function(n,e,t){var r=t.dims,a=Ls(r,n.shape);return{x:function(){return Qge(n,a)}}}};var m0e={kernelName:ode,gradFunc:function(n){return{x:function(){return At(n)}}}},g0e={kernelName:wP,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return La(Ot(n,be(Mp(r,1.5),2)))}}}},y0e={kernelName:xP,inputsToSave:["condition"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{condition:function(){return St(At(r),"float32")},t:function(){return be(n,St(r,n.dtype))},e:function(){return be(n,St(Lge(r),n.dtype))}}}},b0e={kernelName:sde,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){var a=Of(r,En(0)),i=En(r0e),o=En(a0e),s=be(n,o),u=be(be(n,i),tv(St(r,"float32")));return Ms(a,s,u)}}}},w0e={kernelName:TP,outputsToSave:[!0],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(n,be(r,tr(En(1),r)))}}}};var x0e={kernelName:ude,gradFunc:function(n){return{x:function(){return At(n)}}}},k0e={kernelName:SP,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(uM(St(r,"float32")),n)}}}},S0e={kernelName:NP,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(Dge(St(r,"float32")),n)}}}},N0e={kernelName:kP,inputsToSave:["x"],gradFunc:function(n,e,t){for(var r=te(e,1),a=r[0],i=t.begin,o=t.size,s=a.shape,u=te(gge(a,i,o),2),c=u[0],l=u[1],f=[],h=0;h<n.rank;h++)f.push([c[h],s[h]-c[h]-l[h]]);return{x:function(){return qge(n,f)}}}},T0e={kernelName:lde,outputsToSave:[!0],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.dim,o=!0,s=be(n,a);return{logits:function(){return tr(s,be(gn(s,[i],o),a))}}}},E0e={kernelName:cde,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(n,Nge(r))}}}};var mO={kernelName:CP,gradFunc:function(n,e,t){var r=t.blockShape,a=t.paddings;return{x:function(){return Ege(n,r,a)}}}};var gO={kernelName:AP,gradFunc:function(n,e,t){var r=t.axis;return{x:function(){return kge(n,r)}}}},I0e={kernelName:EP,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Ot(n,be(di(St(r,"float32")),2))}}}},C0e={kernelName:hde,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(n,be(St(r,"float32"),2))}}}},A0e={kernelName:fde,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=En(2),o=function(){return be(n,be(i,tr(r,a)))},s=function(){return be(n,be(i,tr(a,r)))};return{a:o,b:s}}};var D0e={kernelName:OP,gradFunc:function(n){return{x:function(){return At(n)}}}},_0e={kernelName:DP,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=lr(r.shape,a.shape),o=function(){var u=n,c=nr(r.shape,i);return c.length>0&&(u=gn(u,c)),Je(u,r.shape)},s=function(){var u=n,c=nr(a.shape,i);return c.length>0&&(u=gn(u,c)),Je(La(u),a.shape)};return{a:o,b:s}}},F0e={kernelName:IP,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=a.shape.slice(),o=t.axis,s=Ls(o,a.shape);s.forEach(function(l){i[l]=1});var u=Je(n,i),c=be(u,nv(a.shape,"float32"));return{x:function(){return c}}}},R0e={kernelName:dde,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Ot(n,In(uM(r)))}}}},O0e={kernelName:pde,outputsToSave:[!0],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(tr(En(1),In(r)),n)}}}},P0e={kernelName:sb,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.reps,o=function(){var s=At(a);if(a.rank===1)for(var u=0;u<i[0];++u)s=xt(s,cc(n,[u*a.shape[0]],[a.shape[0]]));else if(a.rank===2)for(var u=0;u<i[0];++u)for(var c=0;c<i[1];++c)s=xt(s,cc(n,[u*a.shape[0],c*a.shape[1]],[a.shape[0],a.shape[1]]));else if(a.rank===3)for(var u=0;u<i[0];++u)for(var c=0;c<i[1];++c)for(var l=0;l<i[2];++l)s=xt(s,cc(n,[u*a.shape[0],c*a.shape[1],l*a.shape[2]],[a.shape[0],a.shape[1],a.shape[2]]));else if(a.rank===4)for(var u=0;u<i[0];++u)for(var c=0;c<i[1];++c)for(var l=0;l<i[2];++l)for(var f=0;f<i[3];++f)s=xt(s,cc(n,[u*a.shape[0],c*a.shape[1],l*a.shape[2],f*a.shape[3]],[a.shape[0],a.shape[1],a.shape[2],a.shape[3]]));else throw new Error("Gradient for tile operation is not implemented for rank-"+"".concat(a.rank," tensors yet."));return s};return{x:o}}};var M0e={kernelName:Sp,gradFunc:function(n,e,t){var r=t,a=r.perm,i=xb(a);return{x:function(){return dc(n,i)}}}};var B0e={kernelName:_P,gradFunc:function(n,e,t){var r=t,a=r.axis;return{value:function(){return t0e(n,a)}}}},L0e={kernelName:FP,inputsToSave:["segmentIds"],gradFunc:function(n,e){var t=te(e,1),r=t[0],a=function(){return z0e(n,r)};return{x:a}}};function z0e(n,e){for(var t=cM(e,At(e)),r=Pge(n,t),a=bb(e,En(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=Rge(a,o+1);a=QP(a,nv(r.shape,"bool"));var s=At(r);return Ms(a,r,s)}var $0e={kernelName:RP,gradFunc:function(n){return{x:function(){return At(n)}}}},Sy,yO,q0e=[YP,hpe,dpe,mpe,gpe,bpe,wpe,xpe,Spe,Npe,Tpe,Epe,Ape,Fpe,Ope,Bpe,Lpe,zpe,$pe,Kpe,jpe,Zpe,ave,tve,cve,hve,vve,Cve,Rve,Ove,u0e,Pve,Bve,Lve,zve,$ve,Wve,qve,Kve,Yve,Zve,Jve,Qve,eme,tme,rme,ame,ime,ome,cme,sO,sO,pme,gme,wme,xme,kme,Sme,Tme,Cme,Ame,Dme,_me,Fme,Pme,uO,uO,zme,$me,s0e,c0e,l0e,f0e,h0e,d0e,p0e,v0e,m0e,g0e,y0e,b0e,w0e,x0e,k0e,S0e,N0e,T0e,E0e,mO,mO,gO,gO,I0e,A0e,C0e,D0e,_0e,F0e,R0e,O0e,P0e,M0e,B0e,L0e,$0e];try{for(mf=fe(q0e),ic=mf.next();!ic.done;ic=mf.next())bO=ic.value,_de(bO)}catch(n){Sy={error:n}}finally{try{ic&&!ic.done&&(yO=mf.return)&&yO.call(mf)}finally{if(Sy)throw Sy.error}}var bO,mf,ic;function Tb(n,e){return R.tidy(function(){return D.sqrt(D.sum(D.mul(n,n),e,!0))})}var Pf=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getConfig=function(){return{}},e}(R.serialization.Serializable),Eb=function(n){se(e,n);function e(t){var r=n.call(this)||this;return r.defaultMaxValue=2,r.defaultAxis=0,r.maxValue=t.maxValue!=null?t.maxValue:r.defaultMaxValue,r.axis=t.axis!=null?t.axis:r.defaultAxis,r}return e.prototype.apply=function(t){var r=this;return R.tidy(function(){var a=Tb(t,r.axis),i=D.clipByValue(a,0,r.maxValue);return D.mul(t,D.div(i,D.add(qn(),a)))})},e.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},e}(Pf);Eb.className="MaxNorm";R.serialization.registerClass(Eb);var Ib=function(n){se(e,n);function e(t){var r=n.call(this)||this;return r.defaultAxis=0,r.axis=t.axis!=null?t.axis:r.defaultAxis,r}return e.prototype.apply=function(t){var r=this;return R.tidy(function(){return D.div(t,D.add(qn(),Tb(t,r.axis)))})},e.prototype.getConfig=function(){return{axis:this.axis}},e}(Pf);Ib.className="UnitNorm";R.serialization.registerClass(Ib);var Cb=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return D.relu(t)},e}(Pf);Cb.className="NonNeg";R.serialization.registerClass(Cb);var Ab=function(n){se(e,n);function e(t){var r=n.call(this)||this;return r.defaultMinValue=0,r.defaultMaxValue=1,r.defaultRate=1,r.defaultAxis=0,r.minValue=t.minValue!=null?t.minValue:r.defaultMinValue,r.maxValue=t.maxValue!=null?t.maxValue:r.defaultMaxValue,r.rate=t.rate!=null?t.rate:r.defaultRate,r.axis=t.axis!=null?t.axis:r.defaultAxis,r}return e.prototype.apply=function(t){var r=this;return R.tidy(function(){var a=Tb(t,r.axis),i=D.add(D.mul(r.rate,D.clipByValue(a,r.minValue,r.maxValue)),D.mul(1-r.rate,a));return D.mul(t,D.div(i,D.add(qn(),a)))})},e.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},e}(Pf);Ab.className="MinMaxNorm";R.serialization.registerClass(Ab);var wO={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Wn(n){return Ky(n)}function xO(n,e){return e===void 0&&(e={}),Af(n,R.serialization.SerializationMap.getMap().classNameMap,e,"constraint")}function Vn(n){if(n==null)return null;if(typeof n=="string"){var e=n in wO?wO[n]:n,t={className:e,config:{}};return xO(t)}else return n instanceof Pf?n:xO(n)}function W0e(n){return new Eb(n)}function V0e(n){return new Ib(n)}function G0e(){return new Cb}function U0e(n){return new Ab(n)}var H0e={__proto__:null,maxNorm:W0e,unitNorm:V0e,nonNeg:G0e,minMaxNorm:U0e};function K0e(){return new Yy}function j0e(){return new Kp}function X0e(n){return new Zy(n)}function Y0e(n){return new Jy(n)}function Z0e(n){return new Qy(n)}function J0e(n){return new eb(n)}function Q0e(n){return new tb(n)}function eye(n){return new Cr(n)}function tye(n){return new jp(n)}function nye(n){return new Xp(n)}function rye(n){return new Yp(n)}function aye(n){return new Zp(n)}function iye(n){return new Jp(n)}function oye(n){return new Qp(n)}function sye(n){return new nb(n)}var uye={__proto__:null,zeros:K0e,ones:j0e,constant:X0e,randomUniform:Y0e,randomNormal:Z0e,truncatedNormal:J0e,identity:Q0e,varianceScaling:eye,glorotUniform:tye,glorotNormal:nye,heNormal:rye,heUniform:aye,leCunNormal:iye,leCunUniform:oye,orthogonal:sye};function Bo(n){return Ce(this,void 0,void 0,function(){var e,t,r,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:if(n==null)return[2];e=[],t=[],r=[];for(a in n)i=n[a],typeof i!="number"&&(o=i,e.push(o.data()),t.push(a),r.push(o));return e.length>0?[4,Promise.all(e)]:[3,2];case 1:for(s=c.sent(),u=0;u<s.length;++u)n[t[u]]=s[u][0];R.dispose(r),c.label=2;case 2:return[2]}})})}function lM(n){if(n!=null)for(var e in n){var t=n[e];typeof t!="number"&&t.dispose()}}var kO;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(kO||(kO={}));var cye=125,pc=function(){function n(){this.validationData=null}return n.prototype.setParams=function(e){this.params=e},n.prototype.onEpochBegin=function(e,t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){return[2]})})},n.prototype.onEpochEnd=function(e,t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){return[2]})})},n.prototype.onBatchBegin=function(e,t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){return[2]})})},n.prototype.onBatchEnd=function(e,t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){return[2]})})},n.prototype.onTrainBegin=function(e){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){return[2]})})},n.prototype.onTrainEnd=function(e){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){return[2]})})},n.prototype.setModel=function(e){},n}(),fM=function(){function n(e,t){t===void 0&&(t=10),e==null&&(e=[]),this.callbacks=e,this.queueLength=t}return n.prototype.append=function(e){this.callbacks.push(e)},n.prototype.setParams=function(e){var t,r;try{for(var a=fe(this.callbacks),i=a.next();!i.done;i=a.next()){var o=i.value;o.setParams(e)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}},n.prototype.setModel=function(e){var t,r;try{for(var a=fe(this.callbacks),i=a.next();!i.done;i=a.next()){var o=i.value;o.setModel(e)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}},n.prototype.onEpochBegin=function(e,t){return Ce(this,void 0,void 0,function(){var r,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),r=fe(this.callbacks),a=r.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onEpochBegin(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=r.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=r.return)&&u.call(r)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},n.prototype.onEpochEnd=function(e,t){return Ce(this,void 0,void 0,function(){var r,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),r=fe(this.callbacks),a=r.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onEpochEnd(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=r.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=r.return)&&u.call(r)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},n.prototype.onBatchBegin=function(e,t){return Ce(this,void 0,void 0,function(){var r,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),r=fe(this.callbacks),a=r.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onBatchBegin(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=r.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=r.return)&&u.call(r)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},n.prototype.onBatchEnd=function(e,t){return Ce(this,void 0,void 0,function(){var r,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),r=fe(this.callbacks),a=r.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onBatchEnd(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=r.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=r.return)&&u.call(r)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},n.prototype.onTrainBegin=function(e){return Ce(this,void 0,void 0,function(){var t,r,a,i,o,s;return Ee(this,function(u){switch(u.label){case 0:e==null&&(e={}),u.label=1;case 1:u.trys.push([1,6,7,8]),t=fe(this.callbacks),r=t.next(),u.label=2;case 2:return r.done?[3,5]:(a=r.value,[4,a.onTrainBegin(e)]);case 3:u.sent(),u.label=4;case 4:return r=t.next(),[3,2];case 5:return[3,8];case 6:return i=u.sent(),o={error:i},[3,8];case 7:try{r&&!r.done&&(s=t.return)&&s.call(t)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},n.prototype.onTrainEnd=function(e){return Ce(this,void 0,void 0,function(){var t,r,a,i,o,s;return Ee(this,function(u){switch(u.label){case 0:e==null&&(e={}),u.label=1;case 1:u.trys.push([1,6,7,8]),t=fe(this.callbacks),r=t.next(),u.label=2;case 2:return r.done?[3,5]:(a=r.value,[4,a.onTrainEnd(e)]);case 3:u.sent(),u.label=4;case 4:return r=t.next(),[3,2];case 5:return[3,8];case 6:return i=u.sent(),o={error:i},[3,8];case 7:try{r&&!r.done&&(s=t.return)&&s.call(t)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},n}(),lye=function(n){se(e,n);function e(){return n.call(this)||this}return e.prototype.onEpochBegin=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){return this.seen=0,this.totals={},[2]})})},e.prototype.onBatchEnd=function(t,r){return Ce(this,void 0,void 0,function(){var a,i,o,s,u=this;return Ee(this,function(c){r==null&&(r={}),a=r.size==null?0:r.size,this.seen+=a,i=function(l){var f=r[l];if(typeof f=="number")o.totals.hasOwnProperty(l)||(o.totals[l]=0),o.totals[l]=o.totals[l]+f*a;else{var h=void 0;l in o.totals?h=o.totals[l]:o.totals[l]=0;var d=R.tidy(function(){return R.add(u.totals[l],R.mul(f,a))});o.totals[l]=d,h?.dispose()}},o=this;for(s in r)i(s);return[2]})})},e.prototype.onEpochEnd=function(t,r){return Ce(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f=this;return Ee(this,function(h){if(r!=null){a=function(d){if(i.totals[d]==null)return"continue";typeof i.totals[d]=="number"?r[d]=i.totals[d]/i.seen:R.tidy(function(){var p=R.mul(R.div(1,f.seen),f.totals[d]);r[d]=p,f.totals[d].dispose(),R.keep(r[d])})},i=this;try{for(o=fe(this.params.metrics),s=o.next();!s.done;s=o.next())u=s.value,a(u)}catch(d){c={error:d}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}}return[2]})})},e}(pc),hM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.onTrainBegin=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){return this.epoch=[],this.history={},[2]})})},e.prototype.onEpochEnd=function(t,r){return Ce(this,void 0,void 0,function(){var a;return Ee(this,function(i){r==null&&(r={}),this.epoch.push(t);for(a in r)this.history[a]==null&&(this.history[a]=[]),this.history[a].push(r[a]);return[2]})})},e.prototype.syncData=function(){return Ce(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f;return Ee(this,function(h){switch(h.label){case 0:t=[],r=[],a=[];for(i in this.history)for(o=this.history[i],s=0;s<o.length;++s)typeof o[s]!="number"&&(u=o[s],t.push(u.data()),r.push(i),a.push(s));return[4,Promise.all(t)];case 1:for(c=h.sent(),l=0;l<c.length;++l)f=this.history[r[l]][a[l]],f.dispose(),this.history[r[l]][a[l]]=c[l][0];return[2]}})})},e}(pc),dM=function(n){se(e,n);function e(t,r){var a=n.call(this)||this;if(a.currentEpoch=0,a.nowFunc=t.nowFunc,a.nextFrameFunc=t.nextFrameFunc||R.nextFrame,a.yieldEvery=r||"auto",a.yieldEvery==="auto"&&(a.yieldEvery=cye),a.yieldEvery==="never"&&t.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return R.util.isNumber(a.yieldEvery)&&(a.maybeWait=cfe(a.maybeWait.bind(a),a.yieldEvery,a.nowFunc)),a.trainBegin=t.onTrainBegin,a.trainEnd=t.onTrainEnd,a.epochBegin=t.onEpochBegin,a.epochEnd=t.onEpochEnd,a.batchBegin=t.onBatchBegin,a.batchEnd=t.onBatchEnd,a.yield=t.onYield,a}return e.prototype.maybeWait=function(t,r,a){return Ce(this,void 0,void 0,function(){var i;return Ee(this,function(o){switch(o.label){case 0:return i=[],this.yield==null?[3,2]:[4,Bo(a)];case 1:o.sent(),i.push(this.yield(t,r,a)),o.label=2;case 2:return i.push(this.nextFrameFunc()),[4,Promise.all(i)];case 3:return o.sent(),[2]}})})},e.prototype.onEpochBegin=function(t,r){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){switch(a.label){case 0:return this.currentEpoch=t,this.epochBegin==null?[3,3]:[4,Bo(r)];case 1:return a.sent(),[4,this.epochBegin(t,r)];case 2:a.sent(),a.label=3;case 3:return[2]}})})},e.prototype.onEpochEnd=function(t,r){return Ce(this,void 0,void 0,function(){var a;return Ee(this,function(i){switch(i.label){case 0:return a=[],this.epochEnd==null?[3,2]:[4,Bo(r)];case 1:i.sent(),a.push(this.epochEnd(t,r)),i.label=2;case 2:return this.yieldEvery==="epoch"&&a.push(this.nextFrameFunc()),[4,Promise.all(a)];case 3:return i.sent(),[2]}})})},e.prototype.onBatchBegin=function(t,r){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){switch(a.label){case 0:return this.batchBegin==null?[3,3]:[4,Bo(r)];case 1:return a.sent(),[4,this.batchBegin(t,r)];case 2:a.sent(),a.label=3;case 3:return[2]}})})},e.prototype.onBatchEnd=function(t,r){return Ce(this,void 0,void 0,function(){var a;return Ee(this,function(i){switch(i.label){case 0:return a=[],this.batchEnd==null?[3,2]:[4,Bo(r)];case 1:i.sent(),a.push(this.batchEnd(t,r)),i.label=2;case 2:return this.yieldEvery==="batch"?a.push(this.nextFrameFunc()):R.util.isNumber(this.yieldEvery)&&a.push(this.maybeWait(this.currentEpoch,t,r)),[4,Promise.all(a)];case 3:return i.sent(),[2]}})})},e.prototype.onTrainBegin=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){switch(r.label){case 0:return this.trainBegin==null?[3,3]:[4,Bo(t)];case 1:return r.sent(),[4,this.trainBegin(t)];case 2:r.sent(),r.label=3;case 3:return[2]}})})},e.prototype.onTrainEnd=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){switch(r.label){case 0:return this.trainEnd==null?[3,3]:[4,Bo(t)];case 1:return r.sent(),[4,this.trainEnd(t)];case 2:r.sent(),r.label=3;case 3:return[2]}})})},e}(pc);function pM(n,e){if(n==null&&(n={}),n instanceof pc)return[n];if(Array.isArray(n)&&n[0]instanceof pc)return n;var t=Yt(n);return t.map(function(r){return new dM(r,e)})}var Db=function(){function n(){}return n.registerCallbackConstructor=function(e,t){R.util.assert(e>=0&&Number.isInteger(e),function(){return"Verbosity level is expected to be an integer >= 0, "+"but got ".concat(e)}),n.checkForDuplicate(t),n.constructors[e]==null&&(n.constructors[e]=[]),n.constructors[e].push(t)},n.checkForDuplicate=function(e){for(var t in n.constructors){var r=n.constructors[+t];r.forEach(function(a){if(a===e)throw new J("Duplicate callback constructor.")})}},n.clear=function(){n.constructors={}},n.createCallbacks=function(e){var t=[];for(var r in n.constructors){var a=+r;e>=a&&t.push.apply(t,Qe([],te(n.constructors[a]),!1))}return t.map(function(i){return new i})},n}();Db.constructors={};function vM(n,e,t,r,a,i,o,s,u){var c=new hM,l=Qe([new lye],te(Db.createCallbacks(e)),!1);n!=null&&l.push.apply(l,Qe([],te(n),!1)),l.push(c);var f=new fM(l);return f.setParams({epochs:t,initialEpoch:r,samples:a,steps:i,batchSize:o,verbose:e,doValidation:s,metrics:u}),{callbackList:f,history:c}}function ui(n,e,t){return e===void 0&&(e={}),t===void 0&&(t=!1),Af(n,R.serialization.SerializationMap.getMap().classNameMap,e,"layer",t)}function $p(n,e){return R.tidy(function(){n.dtype!=="float32"&&(n=D.cast(n,"float32"));var t=D.sum(_f(n),e,!0),r=D.fill(t.shape,qn()),a=D.sqrt(D.maximum(t,r));return D.div(n,a)})}function Us(n,e){return R.tidy(function(){return D.mean(_f(D.sub(e,n)),-1)})}function av(n,e){return R.tidy(function(){return D.mean(D.abs(D.sub(e,n)),-1)})}function gc(n,e){return R.tidy(function(){var t=D.sub(n,e),r=D.clipByValue(D.abs(n),qn(),Number.MAX_VALUE),a=D.abs(D.div(t,r));return D.mul(100,D.mean(a,-1))})}function fye(n,e){return R.tidy(function(){var t=D.clipByValue(e,qn(),Number.MAX_VALUE),r=D.log(D.add(1,t)),a=D.clipByValue(n,qn(),Number.MAX_VALUE),i=D.log(D.add(1,a));return D.mean(_f(D.sub(r,i)),-1)})}function hye(n,e){return R.tidy(function(){var t=D.maximum(0,D.sub(1,D.mul(n,e)));return D.mean(_f(t),-1)})}function dye(n,e){return R.tidy(function(){var t=D.maximum(0,D.sub(1,D.mul(n,e)));return D.mean(t,-1)})}function pye(n,e){return R.tidy(function(){var t=D.sum(D.mul(n,e),-1),r=D.max(D.mul(D.sub(1,n),e),-1);return D.maximum(0,D.add(1,D.sub(r,t)))})}function vye(n,e){return R.tidy(function(){var t=Math.log(2),r=D.sub(e,n),a=D.sub(D.add(r,D.softplus(D.mul(-2,r))),t);return D.mean(a,-1)})}function Ef(n,e,t){return t===void 0&&(t=!1),R.tidy(function(){if(t)e=D.softmax(e);else{var r=D.sum(e,e.shape.length-1,!0);e=D.div(e,r)}return e=D.clipByValue(e,qn(),1-qn()),D.neg(D.sum(D.mul(D.cast(n,"float32"),D.log(e)),e.shape.length-1))})}function qp(n,e,t){return t===void 0&&(t=!1),R.tidy(function(){var r=D.cast(D.floor(xfe(n)),"int32");e=D.clipByValue(e,qn(),1-qn());var a=e.shape,i=D.reshape(D.oneHot(r,a[a.length-1]),a);return Ef(i,e,t)})}function mye(n,e){if(!R.util.arraysEqual(n.shape,e.shape))throw new J("logits and labels must have the same shape, but got shapes "+"".concat(JSON.stringify(n.shape)," and ").concat(JSON.stringify(e.shape)));return R.tidy(function(){var t=D.relu(e),r=D.neg(D.abs(e));return D.add(D.sub(t,D.mul(e,n)),D.log1p(D.exp(r)))})}function iv(n,e){return R.tidy(function(){var t;return t=D.clipByValue(e,qn(),1-qn()),t=D.log(D.div(t,D.sub(1,t))),D.mean(mye(n,t),-1)})}function gye(n,e){return R.tidy(function(){var t=D.clipByValue(n,qn(),1),r=D.clipByValue(e,qn(),1);return D.sum(D.mul(n,D.log(D.div(t,r))),-1)})}function yye(n,e){return R.tidy(function(){var t=D.log(D.add(qn(),e));return D.mean(D.sub(e,D.mul(n,t)),-1)})}function _b(n,e){return R.tidy(function(){var t=$p(n,-1),r=$p(e,-1),a=D.mul(t,r);return D.neg(D.sum(a,-1))})}var Wp={meanSquaredError:Us,meanAbsoluteError:av,meanAbsolutePercentageError:gc,meanSquaredLogarithmicError:fye,squaredHinge:hye,hinge:dye,categoricalHinge:pye,logcosh:vye,categoricalCrossentropy:Ef,sparseCategoricalCrossentropy:qp,binaryCrossentropy:iv,kullbackLeiblerDivergence:gye,poisson:yye,cosineProximity:_b};function Ny(n){if(typeof n=="string"){if(n in Wp)return Wp[n];var e="Unknown loss ".concat(n);throw n.toLowerCase().includes("softmaxcrossentropy")&&(e="Unknown loss ".concat(n,". ")+'Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new J(e)}else return n}function Fb(n,e){return R.tidy(function(){var t=D.mul(.5,D.onesLike(e)),r=Fi(D.greater(e,t),n.dtype);return D.mean(D.equal(n,r),-1)})}function Rb(n,e){return R.tidy(function(){return Fi(D.equal(D.argMax(n,-1),D.argMax(e,-1)),"float32")})}function mM(n,e){return R.tidy(function(){return D.cast(D.sum(D.logicalAnd(D.equal(n,1),D.equal(e,1))),"float32")})}function bye(n,e){return R.tidy(function(){return D.cast(D.sum(D.logicalAnd(D.equal(n,1),D.equal(e,0))),"float32")})}function wye(n,e){return R.tidy(function(){return D.cast(D.sum(D.logicalAnd(D.equal(n,0),D.equal(e,1))),"float32")})}function gM(n,e){return R.tidy(function(){var t=mM(n,e),r=wye(n,e),a=D.add(t,r);return D.cast(D.where(D.greater(a,0),D.div(t,a),0),"float32")})}function xye(n,e){return R.tidy(function(){var t=mM(n,e),r=bye(n,e),a=D.add(t,r);return D.cast(D.where(D.greater(a,0),D.div(t,a),0),"float32")})}function yM(n,e){return iv(n,e)}function bM(n,e){return n.rank===e.rank&&(n=D.squeeze(n,[n.rank-1])),e=D.argMax(e,-1),e.dtype!==n.dtype&&(e=D.cast(e,n.dtype)),D.cast(D.equal(n,e),"float32")}var kye=Us,Sye=Us,Nye=av,Tye=av,Eye=gc,Iye=gc,Ob=Ef,Cye=_b,wM=qp,Vp={binaryAccuracy:Fb,categoricalAccuracy:Rb,precision:gM,categoricalCrossentropy:Ob,sparseCategoricalCrossentropy:wM,mse:kye,MSE:Sye,mae:Nye,MAE:Tye,mape:Eye,MAPE:Iye,cosine:Cye};function Aye(n){if(typeof n=="string"&&n in Vp)return Vp[n];if(typeof n!="string"&&n!=null)return n;throw new J("Unknown metric ".concat(n))}function xp(n){var e,t,r,a;if(Ai(n!==null,"Unknown LossOrMetricFn ".concat(n)),typeof n=="string")return n;var i=void 0;try{for(var o=fe(Object.keys(Wp)),s=o.next();!s.done;s=o.next()){var u=s.value;if(Wp[u]===n){i=u;break}}}catch(f){e={error:f}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}if(i!==void 0)return i;try{for(var c=fe(Object.keys(Vp)),l=c.next();!l.done;l=c.next()){var u=l.value;if(Vp[u]===n){i=u;break}}}catch(f){r={error:f}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(r)throw r.error}}return i!==void 0?i:n.name}function Dye(n){var e={Adagrad:function(){return R.train.adagrad(.01)},Adadelta:function(){return R.train.adadelta(1,.95,qn())},Adam:function(){return R.train.adam(.001,.9,.999,qn())},Adamax:function(){return R.train.adamax(.002,.9,.999,qn(),0)},RMSProp:function(){return R.train.rmsprop(.001,.9,0,qn())},SGD:function(){return R.train.sgd(.01)}};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new J("Unknown Optimizer ".concat(n))}var SO=1*1024*1024;function NO(n,e,t){if(t===void 0&&(t=!1),n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!Vy(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){var r=JSON.stringify(n);r.length>SO&&console.warn('User-defined metadata of model "'.concat(e,'" is too large in ')+"size (length=".concat(r.length," when serialized). It is not ")+"recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+"".concat(SO,"."))}}function Vy(n){var e,t,r,a;if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){var i=Object.keys(n);try{for(var o=fe(i),s=o.next();!s.done;s=o.next()){var u=s.value;if(typeof u!="string"||!Vy(n[u]))return!1}}catch(d){e={error:d}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return!0}else if(Array.isArray(n)){try{for(var c=fe(n),l=c.next();!l.done;l=c.next()){var f=l.value;if(!Vy(f))return!1}}catch(d){r={error:d}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(r)throw r.error}}return!0}else return!1;else{var h=typeof n;return h==="string"||h==="number"||h==="boolean"}}function _ye(n,e,t,r){r===void 0&&(r=console.log);var a=Rye(n),i=["Layer (type)","Input Shape","Output shape","Param #"];a?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(function(h){return Math.floor(e*h)}));var o;if(!a){i.push("Receives inputs"),o=[];for(var s in n.nodesByDepth)o.push.apply(o,Qe([],te(n.nodesByDepth[s]),!1))}r("_".repeat(e)),Gp(i,t,r),r("=".repeat(e));for(var u=n.layers,c=0;c<u.length;++c)a?Oye(u[c],t,r):Pye(u[c],t,o,r),r((c===u.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();var l=Fye(n),f=Cp(n.nonTrainableWeights);r("Total params: ".concat(l+f)),r("Trainable params: ".concat(l)),r("Non-trainable params: ".concat(f)),r("_".repeat(e))}function Fye(n){var e;return n.collectedTrainableWeights!=null?e=Cp(n.collectedTrainableWeights):e=Cp(n.trainableWeights),e}function Rye(n){var e,t,r,a,i,o,s=!0,u=[],c=[];for(var l in n.nodesByDepth)u.push(n.nodesByDepth[l]);try{for(var f=fe(u),h=f.next();!h.done;h=f.next()){var d=h.value;if(d.length>1||d.length===1&&d[0].inboundLayers.length>1){s=!1;break}c.push.apply(c,Qe([],te(d),!1))}}catch(x){e={error:x}}finally{try{h&&!h.done&&(t=f.return)&&t.call(f)}finally{if(e)throw e.error}}if(s)try{for(var p=fe(n.layers),v=p.next();!v.done;v=p.next()){var m=v.value,g=!1;try{for(var y=(i=void 0,fe(m.inboundNodes)),b=y.next();!b.done;b=y.next()){var w=b.value;if(c.indexOf(w)!==-1)if(g){s=!1;break}else g=!0}}catch(x){i={error:x}}finally{try{b&&!b.done&&(o=y.return)&&o.call(y)}finally{if(i)throw i.error}}if(!s)break}}catch(x){r={error:x}}finally{try{v&&!v.done&&(a=p.return)&&a.call(p)}finally{if(r)throw r.error}}return s}function Gp(n,e,t){t===void 0&&(t=console.log);for(var r="",a=0;a<n.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r+=n[a],r=r.slice(0,e[a]),r+=" ".repeat(e[a]-r.length);t(r)}function Oye(n,e,t){var r,a;try{a=n.inboundNodes.map(function(u){return JSON.stringify(u.inputShapes)}).join(",")}catch{a="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}var i=n.name,o=n.getClassName(),s=["".concat(i," (").concat(o,")"),a,r,n.countParams().toString()];Gp(s,e,t)}function Pye(n,e,t,r){var a,i,o,s;try{s=n.inboundNodes.map(function(w){return JSON.stringify(w.inputShapes)}).join(",")}catch{s="multiple"}try{o=JSON.stringify(n.outputShape)}catch{o="multiple"}var u=[];try{for(var c=fe(n.inboundNodes),l=c.next();!l.done;l=c.next()){var f=l.value;if(!(t!=null&&t.length>0&&t.indexOf(f)===-1))for(var h=0;h<f.inboundLayers.length;++h){var d=f.inboundLayers[h].name,p=f.nodeIndices[h],v=f.tensorIndices[h];u.push("".concat(d,"[").concat(p,"][").concat(v,"]"))}}}catch(w){a={error:w}}finally{try{l&&!l.done&&(i=c.return)&&i.call(c)}finally{if(a)throw a.error}}var m=n.name,g=n.getClassName(),y=u.length===0?"":u[0],b=["".concat(m," (").concat(g,")"),s,o,n.countParams().toString(),y];Gp(b,e,r);for(var h=1;h<u.length;++h)Gp(["","","","",u[h]],e,r)}function xM(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function If(n,e){var t,r;if(n===null)return null;if(typeof n=="string")return _s(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){for(var a=[],i=n.length,o=0;o<i;++o){var s=n[o];xM(e,o,s)?a.push(s):a.push(If(s,e))}return a}else{var u={};try{for(var c=fe(Object.keys(n)),l=c.next();!l.done;l=c.next()){var f=l.value,h=n[f];if(f==="name"&&typeof h=="string")u[f]=h;else{var d=_s(f);u[d]=If(h,d)}}}catch(p){t={error:p}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}return u}}function Gy(n,e){var t,r;if(n==null)return null;if(typeof n=="string")return eo(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){for(var a=[],i=n.length,o=0;o<i;++o){var s=n[o];xM(e,o,s)?a.push(s):a.push(Gy(s,e))}return a}else{var u={};try{for(var c=fe(Object.keys(n)),l=c.next();!l.done;l=c.next()){var f=l.value,h=n[f],d=eo(f);(f==="name"||f==="className")&&typeof h=="string"?u[d]=h:u[d]=Gy(h,f)}}catch(p){t={error:p}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}return u}}var Pb="4.2.0",Mye=function(n){se(e,n);function e(t){var r,a,i,o,s,u,c,l,f,h,d,p,v,m,g,y,b,w,x,N,T,E,C,F,_=n.call(this,{})||this;if(_.containerNodes=new Set,_.name=t.name,_.name==null){var O=_.getClassName().toLowerCase();_.name=Up(O)}if(_.supportsMasking=!1,_.trainable_=!0,Array.isArray(t.inputs)?_.inputs=t.inputs.slice():_.inputs=[t.inputs],Array.isArray(t.outputs)?_.outputs=t.outputs.slice():_.outputs=[t.outputs],zo(_.inputs).length!==_.inputs.length)throw new J("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+"".concat(_.inputs.map(function(dt){return dt.name})));zo(_.outputs).length!==_.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+"".concat(_.outputs.map(function(dt){return dt.name}))),_.inputLayers=[],_.inputLayersNodeIndices=[],_.inputLayersTensorIndices=[],_.outputLayers=[],_.outputLayersNodeIndices=[],_.outputLayersTensorIndices=[],_.layers=[],_.internalContainerRefs=[];try{for(var L=fe(_.outputs),z=L.next();!z.done;z=L.next()){var $=z.value,B=$.sourceLayer,W=$.nodeIndex,X=$.tensorIndex;_.outputLayers.push(B),_.outputLayersNodeIndices.push(W),_.outputLayersTensorIndices.push(X)}}catch(dt){r={error:dt}}finally{try{z&&!z.done&&(a=L.return)&&a.call(L)}finally{if(r)throw r.error}}try{for(var Z=fe(_.inputs),V=Z.next();!V.done;V=Z.next()){var $=V.value,B=$.sourceLayer,W=$.nodeIndex,X=$.tensorIndex;Ai(W===0,"input layer has >1 nodes"),Ai(X===0,"input layer has >1 tensors"),_.inputLayers.push(B),_.inputLayersNodeIndices.push(W),_.inputLayersTensorIndices.push(X)}}catch(dt){i={error:dt}}finally{try{V&&!V.done&&(o=Z.return)&&o.call(Z)}finally{if(i)throw i.error}}_.inputNames=[],_.outputNames=[],_.feedInputShapes=[],_.feedInputNames=[],_.feedOutputNames=[];for(var j=0;j<_.inputLayers.length;j++){var B=_.inputLayers[j];if(!(B instanceof vc))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. "+"Received inputs: ".concat(t.inputs,". ")+"Input ".concat(j," (0-based) originates ")+"from layer type ".concat(B.getClassName(),"."));_.inputNames.push(B.name),_.feedInputShapes.push(B.batchInputShape),_.feedInputNames.push(B.name)}try{for(var re=fe(_.outputLayers),ne=re.next();!ne.done;ne=re.next()){var B=ne.value;_.outputNames.push(B.name)}}catch(dt){s={error:dt}}finally{try{ne&&!ne.done&&(u=re.return)&&u.call(re)}finally{if(s)throw s.error}}_.internalInputShapes=_.inputs.map(function(dt){return dt.shape}),_.internalOutputShapes=_.outputs.map(function(dt){return dt.shape});var oe={},le={},pe={},xe={},he={},ye=[],we=function(dt,Sa,Za,Br,ss,D2){(Br==null||ss==null||D2==null)&&(Br=dt.sourceLayer,ss=dt.nodeIndex,D2=dt.tensorIndex);var oa=Br.inboundNodes[ss];if(Za.indexOf(oa)!==-1)throw new _i("The tensor ".concat(dt.name,' at layer "').concat(Br.name,'" ')+"is part of a cycle.");if(Sa.indexOf(oa)===-1){_.containerNodes.add(e.nodeKey(Br,ss)),Br.id in he||(he[Br.id]=Object.keys(he).length),Za.indexOf(oa)===-1&&Za.push(oa);for(var h5=oa.inboundLayers.length,Au=0;Au<h5;Au++){var d5=oa.inputTensors[Au],p5=oa.inboundLayers[Au],v5=oa.nodeIndices[Au],m5=oa.tensorIndices[Au];we(d5,Sa,Za,p5,v5,m5)}for(Sa.push(oa);Za.indexOf(oa)>=0;)Za.splice(Za.indexOf(oa),1);ye.push(oa)}},Ae=[],Ye=[];try{for(var ht=fe(_.outputs),at=ht.next();!at.done;at=ht.next()){var $=at.value;we($,Ae,Ye)}}catch(dt){c={error:dt}}finally{try{at&&!at.done&&(l=ht.return)&&l.call(ht)}finally{if(c)throw c.error}}var rt=ye.slice().reverse();try{for(var ft=fe(rt),st=ft.next();!st.done;st=ft.next()){var Ze=st.value;le[Ze.id]=Ze,Ze.id in oe||(oe[Ze.id]=0);var tt=oe[Ze.id],et=pe[Ze.outboundLayer.id]==null?0:pe[Ze.outboundLayer.id];tt=Math.max(tt,et),pe[Ze.outboundLayer.id]=tt,xe[Ze.outboundLayer.id]=Ze.outboundLayer,oe[Ze.id]=tt;for(var j=0;j<Ze.inboundLayers.length;j++){var rn=Ze.inboundLayers[j],W=Ze.nodeIndices[j],He=rn.inboundNodes[W],kt=oe[He.id]==null?0:oe[He.id];oe[He.id]=Math.max(tt+1,kt),le[He.id]=He}}}catch(dt){f={error:dt}}finally{try{st&&!st.done&&(h=ft.return)&&h.call(ft)}finally{if(f)throw f.error}}var An={};for(var hr in oe){var tt=oe[hr];tt in An||(An[tt]=[]),An[tt].push(le[hr])}var On={};for(var Dn in pe){var tt=pe[Dn];tt in On||(On[tt]=[]),On[tt].push(xe[Dn])}var an=Object.keys(On).map(function(dt){return parseInt(dt,10)}).sort(yp);_.layers=[];try{for(var Pr=fe(an),dr=Pr.next();!dr.done;dr=Pr.next()){var tt=dr.value,Mr=On[tt];Mr.sort(function(Sa,Za){var Br=he[Sa.id],ss=he[Za.id];return Br<ss?-1:Br>ss?1:0});try{for(var Sn=(v=void 0,fe(Mr)),Vi=Sn.next();!Vi.done;Vi=Sn.next()){var B=Vi.value;B instanceof e&&_.internalContainerRefs.push(B),_.layers.push(B)}}catch(Sa){v={error:Sa}}finally{try{Vi&&!Vi.done&&(m=Sn.return)&&m.call(Sn)}finally{if(v)throw v.error}}}}catch(dt){d={error:dt}}finally{try{dr&&!dr.done&&(p=Pr.return)&&p.call(Pr)}finally{if(d)throw d.error}}_.layersByDepth=On,an=Object.keys(An).map(function(dt){return parseInt(dt,10)}).sort(yp);var Iu=_.inputs.slice(),Kh=[];try{for(var Gi=fe(an),os=Gi.next();!os.done;os=Gi.next()){var tt=os.value;try{for(var Cu=(b=void 0,fe(An[tt])),ml=Cu.next();!ml.done;ml=Cu.next()){var Ze=ml.value,B=Ze.outboundLayer;if(B!=null){try{for(var jh=(x=void 0,fe(Ze.inputTensors)),gl=jh.next();!gl.done;gl=jh.next()){var $=gl.value;if(Iu.indexOf($)===-1)throw new _i("Graph disconnected: cannot obtain value for tensor ".concat($)+' at layer "'.concat(B.name,'". ')+"The following previous layers were accessed without "+"issue: ".concat(Kh))}}catch(Br){x={error:Br}}finally{try{gl&&!gl.done&&(N=jh.return)&&N.call(jh)}finally{if(x)throw x.error}}try{for(var Xh=(T=void 0,fe(Ze.outputTensors)),yl=Xh.next();!yl.done;yl=Xh.next()){var $=yl.value;Iu.push($)}}catch(Br){T={error:Br}}finally{try{yl&&!yl.done&&(E=Xh.return)&&E.call(Xh)}finally{if(T)throw T.error}}Kh.push(B.name)}}}catch(Sa){b={error:Sa}}finally{try{ml&&!ml.done&&(w=Cu.return)&&w.call(Cu)}finally{if(b)throw b.error}}}}catch(dt){g={error:dt}}finally{try{os&&!os.done&&(y=Gi.return)&&y.call(Gi)}finally{if(g)throw g.error}}_.nodesByDepth=An;var Ym=_.layers.map(function(dt){return dt.name}),l5=function(dt){var Sa=Ym.filter(function(Za){return Za===dt}).length;if(Sa!==1)throw new _i('The name "'.concat(dt,'" is used ').concat(Sa," times ")+"in the model. All layer names should be unique. Layer names: "+JSON.stringify(Ym))};try{for(var Yh=fe(Ym),bl=Yh.next();!bl.done;bl=Yh.next()){var f5=bl.value;l5(f5)}}catch(dt){C={error:dt}}finally{try{bl&&!bl.done&&(F=Yh.return)&&F.call(Yh)}finally{if(C)throw C.error}}return _.outboundNodes=[],_.inboundNodes=[],new ev({outboundLayer:_,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:_.inputs,outputTensors:_.outputs,inputMasks:_.inputs.map(function(dt){return null}),outputMasks:_.outputs.map(function(dt){return null}),inputShapes:_.inputs.map(function(dt){return dt.shape}),outputShapes:_.outputs.map(function(dt){return dt.shape})}),_.built=!0,_._refCount=1,_}return e.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Container '".concat(this.name,"' is already disposed."))},e.prototype.dispose=function(){var t,r,a,i;this.assertNotDisposed();var o={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){var c=u.value;o.numDisposedVariables+=c.dispose().numDisposedVariables}}catch(d){t={error:d}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}try{for(var l=fe(this.internalContainerRefs),f=l.next();!f.done;f=l.next()){var h=f.value;o.numDisposedVariables+=h.dispose().numDisposedVariables}}catch(d){a={error:d}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}}return o.refCountAfterDispose=this._refCount,o},Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this.layers.forEach(function(r){r._trainableWeights.forEach(function(a){return a.trainable=t})}),this.trainable_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){var t,r;if(this._trainableWeights.length>0)throw new J("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var a=[];try{for(var i=fe(this.layers),o=i.next();!o.done;o=i.next()){var s=o.value;a=a.concat(s.trainableWeights)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return a},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){var t,r,a,i,o=[];try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){var c=u.value;o.push.apply(o,Qe([],te(c.nonTrainableWeights),!1))}}catch(d){t={error:d}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}if(!this.trainable){var l=[];try{for(var f=fe(this.layers),h=f.next();!h.done;h=f.next()){var c=h.value;l.push.apply(l,Qe([],te(c.trainableWeights),!1))}}catch(d){a={error:d}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}return l.concat(o)}return o},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!1,configurable:!0}),e.prototype.loadWeights=function(t,r){var a,i,o,s;r===void 0&&(r=!0);var u={},c=0;try{for(var l=fe(this.layers),f=l.next();!f.done;f=l.next()){var h=f.value;try{for(var d=(o=void 0,fe(h.weights)),p=d.next();!p.done;p=d.next()){var v=p.value;if(u[v.originalName]!=null)throw new J("Duplicate weight name: ".concat(v.originalName));u[v.originalName]=v,c++}}catch(N){o={error:N}}finally{try{p&&!p.done&&(s=d.return)&&s.call(d)}finally{if(o)throw o.error}}}}catch(N){a={error:N}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}var m=[];for(var g in t){var y=g;if(u[g]==null){var b=g.split("/"),w=b.slice(0,-2).concat([b[b.length-1]]);y=w.join("/")}if(u[y]!=null)m.push([u[y],t[g]]);else if(r)throw new J("Provided weight data has no target variable: ".concat(g));delete u[y]}if(r){var x=[];for(var g in u)x.push(g);if(x.length>0)throw new J("".concat(x.length," of ").concat(c," weights are not set: ")+"".concat(x))}rb(m)},e.prototype.updatedConfig=function(){var t=this.getConfig(),r={};return r.className=this.getClassName(),r.config=t,r.kerasVersion="tfjs-layers ".concat(Pb),r.backend="TensorFlow.js",r},e.prototype.toJSON=function(t,r){r===void 0&&(r=!0);var a=Gy(this.updatedConfig());return r?JSON.stringify(a):a},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){t=Yt(t);for(var i=new sc,o=0;o<a.inputs.length;++o)i.add(a.inputs[o],t[o]);return bf(a.outputs,i,r)})},e.prototype.computeMask=function(t,r){var a=this;return R.tidy(function(){t=Yt(t);var i;return r==null?i=Ps(null,t.length):i=Yt(r),a.runInternalGraph(t,i)[1]})},e.prototype.computeOutputShape=function(t){var r,a,i,o,s=Ip(t);if(s.length!==this.inputLayers.length)throw new J("Invalid inputShape argument ".concat(t,": ")+"model has ".concat(this.inputLayers.length," tensor inputs."));for(var u={},c=0;c<s.length;c++){var l=this.inputLayers[c],f=s[c],h=l.name+"_0_0";u[h]=f}var d=Object.keys(this.nodesByDepth).map(function(W){return parseInt(W,10)}).sort(yp);if(d.length>1)try{for(var p=fe(d),v=p.next();!v.done;v=p.next()){var m=v.value,g=this.nodesByDepth[m];try{for(var y=(i=void 0,fe(g)),b=y.next();!b.done;b=y.next()){var w=b.value,l=w.outboundLayer;if(this.inputLayers.map(function(X){return X.id}).indexOf(l.id)===-1){for(var x=[],N=0;N<w.inboundLayers.length;N++){var T=w.inboundLayers[N],E=w.nodeIndices[N],C=w.tensorIndices[N],h="".concat(T.name,"_").concat(E,"_").concat(C),F=u[h];x.push(F)}for(var _=l.computeOutputShape(Ir(x)),O=Ip(_),L=l.inboundNodes.indexOf(w),N=0;N<O.length;N++){var h="".concat(l.name,"_").concat(L,"_").concat(N);u[h]=O[N]}}}}catch(W){i={error:W}}finally{try{b&&!b.done&&(o=y.return)&&o.call(y)}finally{if(i)throw i.error}}}}catch(W){r={error:W}}finally{try{v&&!v.done&&(a=p.return)&&a.call(p)}finally{if(r)throw r.error}}for(var z=[],$=[],c=0;c<this.outputLayers.length;c++){var l=this.outputLayers[c],L=this.outputLayersNodeIndices[c],C=this.outputLayersTensorIndices[c],h="".concat(l.name,"_").concat(L,"_").concat(C);$.push(h)}for(var c=0;c<$.length;c++){var B=$[c];Ai(B in u),z.push(u[B])}return Ir(z)},e.prototype.runInternalGraph=function(t,r){var a,i,o,s,u,c,l,f;r==null&&(r=Ps(null,t.length));for(var h={},d=0;d<this.inputs.length;++d){var p=this.inputs[d],v=t[d],m=r[d];h[p.id]=[v,m]}var g=Object.keys(this.nodesByDepth).map(function(we){return parseInt(we,10)}).sort(yp);try{for(var y=fe(g),b=y.next();!b.done;b=y.next()){var w=b.value,x=this.nodesByDepth[w];try{for(var N=(o=void 0,fe(x)),T=N.next();!T.done;T=N.next()){var E=T.value,C=E.outboundLayer,F=E.inputTensors,_=E.outputTensors,O=new Array;try{for(var L=(u=void 0,fe(F)),z=L.next();!z.done;z=L.next()){var p=z.value;p.id in h&&O.push(h[p.id])}}catch(we){u={error:we}}finally{try{z&&!z.done&&(c=L.return)&&c.call(L)}finally{if(u)throw u.error}}if(O.length===F.length){var $={},B=void 0,W=void 0,X=void 0,Z=void 0;if(E.callArgs!=null&&($=E.callArgs),O.length===1){var V=te(O[0],2),j=V[0],re=V[1];$.mask==null&&($.mask=re),X=Yt(C.call(j,$)),Z=Yt(C.computeMask(j,re)),B=[j],W=[re]}else B=O.map(function(we){return we[0]}),W=O.map(function(we){return we[1]}),$.mask==null&&($.mask=W),X=Yt(C.call(B,$)),Z=Yt(C.computeMask(B,W));if(C.activityRegularizer)throw new pt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var d=0;d<_.length;++d){var p=_[d],v=X[d],m=Z[d];h[p.id]=[v,m]}}}}catch(we){o={error:we}}finally{try{T&&!T.done&&(s=N.return)&&s.call(N)}finally{if(o)throw o.error}}}}catch(we){a={error:we}}finally{try{b&&!b.done&&(i=y.return)&&i.call(y)}finally{if(a)throw a.error}}var ne=[],oe=[],le=[];try{for(var pe=fe(this.outputs),xe=pe.next();!xe.done;xe=pe.next()){var p=xe.value;Ai(p.id in h,"Could not compute output ".concat(p.name," : ").concat(p.id));var he=te(h[p.id],2),ye=he[0],m=he[1];le.push(ye.shape),ne.push(ye),oe.push(m)}}catch(we){l={error:we}}finally{try{xe&&!xe.done&&(f=pe.return)&&f.call(pe)}finally{if(l)throw l.error}}return[ne,oe,le]},e.prototype.buildNodeConversionMap=function(t){var r,a,i={},o;try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){var c=u.value;o=c instanceof e?1:0;for(var l=0;l<c.inboundNodes.length;l++){var f=e.nodeKey(c,l);this.containerNodes.has(f)&&(i[f]=o,o+=1)}}}catch(h){r={error:h}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}return i},e.prototype.getLayer=function(t,r){var a,i;if(r!=null){if(this.layers.length<=r)throw new J("Was asked to retrieve layer at index ".concat(r,", but model only ")+"has ".concat(this.layers.length," layer(s)."));return this.layers[r]}else if(t==null)throw new J("Provide either a layer name or layer index");try{for(var o=fe(this.layers),s=o.next();!s.done;s=o.next()){var u=s.value;if(u.name===t)return u}}catch(c){a={error:c}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(a)throw a.error}}throw new J("No such layer: ".concat(t))},e.prototype.calculateLosses=function(){var t=this;return R.tidy(function(){var r,a,i=[];try{for(var o=fe(t.layers),s=o.next();!s.done;s=o.next())for(var u=s.value,c=0;c<u.inboundNodes.length;++c){var l=e.nodeKey(u,c);t.containerNodes.has(l)&&i.push.apply(i,Qe([],te(u.calculateLosses()),!1))}}catch(f){r={error:f}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}return i})},e.prototype.getConfig=function(){var t,r,a={name:this.name},i=this.buildNodeConversionMap(this.layers),o=[];try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){for(var c=u.value,l=c.getClassName(),f=c.getConfig(),h=[],d=0;d<c.inboundNodes.length;d++){var p=c.inboundNodes[d],v=e.nodeKey(c,d),m={};if(this.containerNodes.has(v)){if(p.callArgs)try{JSON.stringify(p.callArgs),m=p.callArgs}catch{console.warn("Layer ".concat(c.name," was passed ")+"non-serializable keyword arguments: "+"".concat(p.callArgs,". They will not be included ")+"in the serialized model (and thus will be missing at deserialization time)."),m={}}if(p.inboundLayers.length>0){for(var g=[],y=0;y<p.inboundLayers.length;y++){var b=p.inboundLayers[y],w=p.nodeIndices[y],x=p.tensorIndices[y],N=e.nodeKey(b,w),T=i[N];T==null&&(T=0),g.push([b.name,T,x,m])}h.push(g)}}}var E={};E.name=c.name,E.className=l,E.config=f,E.inboundNodes=h,o.push(E)}}catch(_){t={error:_}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}a.layers=o;for(var C=[],y=0;y<this.inputLayers.length;y++){var c=this.inputLayers[y],w=this.inputLayersNodeIndices[y],v=e.nodeKey(c,w);if(!!this.containerNodes.has(v)){var T=i[v];T==null&&(T=0);var x=this.inputLayersTensorIndices[y];C.push([c.name,T,x])}}a.inputLayers=C;for(var F=[],y=0;y<this.outputLayers.length;y++){var c=this.outputLayers[y],w=this.outputLayersNodeIndices[y],v=e.nodeKey(c,w);if(!!this.containerNodes.has(v)){var T=i[v];T==null&&(T=0);var x=this.outputLayersTensorIndices[y];F.push([c.name,T,x])}}return a.outputLayers=F,a},e.fromConfig=function(t,r,a,i){var o,s,u,c,l,f,h,d,p,v;i===void 0&&(i=!1);var m={},g={};function y(ye,we){ye.name in g?g[ye.name].push(we):g[ye.name]=[we]}function b(ye,we){var Ae,Ye,ht=[],at;try{for(var rt=fe(we),ft=rt.next();!ft.done;ft=rt.next()){var st=ft.value,Ze=st[0],tt=st[1],et=st[2];if(at=st[3]==null?{}:st[3],!(Ze in m)){y(ye,we);return}var rn=m[Ze];if(rn.inboundNodes.length<=tt){y(ye,we);return}var He=rn.inboundNodes[tt];ht.push(He.outputTensors[et])}}catch(kt){Ae={error:kt}}finally{try{ft&&!ft.done&&(Ye=rt.return)&&Ye.call(rt)}finally{if(Ae)throw Ae.error}}ht.length>0&&ye.apply(Ir(ht),at)}function w(ye){var we=ye.name,Ae=ui(ye,r.customObjects!=null?r.customObjects:{});Ae.setFastWeightInitDuringBuild(i),m[we]=Ae;var Ye=ye.inboundNodes;Ye.forEach(function(ht){if(!(ht instanceof Array))throw new J("Corrupted configuration, expected array for nodeData: ".concat(ht));y(Ae,ht)})}var x=r.name,N=r.layers;try{for(var T=fe(N),E=T.next();!E.done;E=T.next()){var C=E.value;w(C)}}catch(ye){o={error:ye}}finally{try{E&&!E.done&&(s=T.return)&&s.call(T)}finally{if(o)throw o.error}}for(;!ufe(g);)try{for(var F=(u=void 0,fe(N)),_=F.next();!_.done;_=F.next()){var C=_.value,O=m[C.name];if(O.name in g){var L=g[O.name];delete g[O.name];try{for(var z=(l=void 0,fe(L)),$=z.next();!$.done;$=z.next()){var B=$.value;b(O,B)}}catch(we){l={error:we}}finally{try{$&&!$.done&&(f=z.return)&&f.call(z)}finally{if(l)throw l.error}}}}}catch(ye){u={error:ye}}finally{try{_&&!_.done&&(c=F.return)&&c.call(F)}finally{if(u)throw u.error}}var W=[],X=[],Z=r.inputLayers;try{for(var V=fe(Z),j=V.next();!j.done;j=V.next()){var C=j.value,re=C[0],ne=C[1],oe=C[2];Ai(re in m);var O=m[re],le=O.inboundNodes[ne].outputTensors;W.push(le[oe])}}catch(ye){h={error:ye}}finally{try{j&&!j.done&&(d=V.return)&&d.call(V)}finally{if(h)throw h.error}}var pe=r.outputLayers;try{for(var xe=fe(pe),he=xe.next();!he.done;he=xe.next()){var C=he.value,re=C[0],ne=C[1],oe=C[2];Ai(re in m);var O=m[re],le=O.inboundNodes[ne].outputTensors;X.push(le[oe])}}catch(ye){p={error:ye}}finally{try{he&&!he.done&&(v=xe.return)&&v.call(xe)}finally{if(p)throw p.error}}return new t({inputs:W,outputs:X,name:x})},Object.defineProperty(e.prototype,"stateful",{get:function(){var t,r;if(this._stateful)throw new J("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");try{for(var a=fe(this.layers),i=a.next();!i.done;i=a.next()){var o=i.value;if(o.stateful)return!0}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return!1},enumerable:!1,configurable:!0}),e.prototype.resetStates=function(){var t=this;R.tidy(function(){t.layers.forEach(function(r){r.stateful&&r.resetStates()})})},e}(gt);function Bye(n,e,t){var r=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(function(i){return null});if(r===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==r)throw new Error("Provided ".concat(t," is an array of ").concat(n.length," ")+"element(s), but the model has ".concat(r," outputs. ")+"Make sure a set of weights is provided for each model output.");return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){var a=[];return e.forEach(function(i){i in n?a.push(n[i]):a.push(null)}),a}else throw new Error("The model has multiple (".concat(r,") outputs, ")+"so ".concat(t," must be either an array with ")+"".concat(r," elements or an object with ").concat(e," keys. ")+"Provided ".concat(t," not understood: ").concat(JSON.stringify(n)))}function kM(n,e){return Bye(n,e,"classWeight")}function SM(n,e,t,r){return Ce(this,void 0,void 0,function(){var a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:if(e!=null||r!=null)throw new Error("Support sampleWeight is not implemented yet");return t==null?[3,2]:(a=R.tidy(function(){if(n.shape.length===1)return R.clone(n);if(n.shape.length===2)if(n.shape[1]>1){var l=1;return R.argMax(n,l)}else{if(n.shape[1]===1)return R.reshape(n,[n.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(n.shape[1],") ")+"during handling of class weights. The size is expected to be >= 1.")}else throw new Error("Unexpected rank of target (y) tensor (".concat(n.rank,") during ")+"handling of class weights. The rank is expected to be 1 or 2.")}),s=(o=Array).from,[4,a.data()]);case 1:return i=s.apply(o,[c.sent()]),R.dispose(a),u=[],i.forEach(function(l){if(t[l]==null)throw new Error("classWeight must contain all classes in the training data. "+"The class ".concat(l," exists in the data but not in ")+"classWeight");u.push(t[l])}),[2,R.tensor1d(u,"float32")];case 2:return[2,null]}})})}function Lye(n,e){return R.mul(n,e)}var zye=32;function NM(n,e){var t,r,a=e;t=a.xs,r=a.ys,D.util.assert(t!=null&&r!=null,function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+"".concat(e)});var i=TO("input",n.inputNames,t),o=TO("output",n.outputNames,r),s=i[0].shape[0];D.util.assert(i.length===n.inputs.length,function(){return"LayersModel has ".concat(n.inputs.length," inputs, but the dataset ")+"provides ".concat(i.length," inputs.  (Expected input keys: ")+"".concat(JSON.stringify(n.inputNames),")")}),D.util.assert(o.length===n.outputs.length,function(){return"LayersModel has ".concat(n.outputs.length," outputs, but the dataset ")+"provides ".concat(o.length," outputs.  (Expected output keys: ")+"".concat(JSON.stringify(n.outputNames),")")});for(var u=function(h){D.util.assert(i[h].shape[0]===s,function(){return"Batch size mismatch: input "+"".concat(n.inputNames[h]," has ").concat(i[h].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(n.inputNames[0],".")})},c=0;c<i.length;c++)u(c);for(var l=function(h){D.util.assert(o[h].shape[0]===s,function(){return"Batch size mismatch: output "+"".concat(n.outputNames[h]," has ").concat(o[h].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(n.inputNames[0],".")})},f=0;f<o.length;f++)l(f);return{xs:i,ys:o}}function TO(n,e,t){var r,a;if(t instanceof D.Tensor)return[t];if(Array.isArray(t))return D.util.assert(t.length===e.length,function(){return"Received an array of ".concat(t.length," Tensors, but expected ").concat(e.length," to match the ").concat(n," keys ").concat(e,".")}),t;var i=[];try{for(var o=fe(e),s=o.next();!s.done;s=o.next()){var u=s.value;if(t[u]==null)throw new J("The feature data generated by the dataset lacks the required "+"".concat(n," key '").concat(u,"'."));i.push(t[u])}}catch(c){r={error:c}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}return i}function $ye(n){if(n.length===3)throw new pt("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}function qye(n,e,t){return Ce(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f,h,d,p,v,m,g,y,b,w,x,N,T,E,C,F,_,V,O,L,z,$,V,B,W,X,Z,V;return Ee(this,function(j){switch(j.label){case 0:if(r=t.batchesPerEpoch!=null,D.util.assert(n.optimizer!=null,function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."}),D.util.assert(t!=null,function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."}),D.util.assert(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),function(){return"For fitDataset(), config.epochs is expected to be a positive "+"integer, but got ".concat(t.epochs)}),D.util.assert(!r||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a "+"positive integer if specified, but got ".concat(t.batchesPerEpoch)}),D.util.assert(t.validationSplit==null,function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."}),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0,j.label=1;case 1:return j.trys.push([1,,26,27]),a=t.validationData!=null,i=void 0,o=void 0,a&&(EO(t.validationData)?D.util.assert(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, "+"but got ".concat(t.validationBatches)}):(s=$ye(t.validationData),i=s.xs,o=s.ys)),u=n.makeTrainFunction(),c=n.getDedupedMetricsNames(),l=void 0,a?l=c.slice().concat(c.map(function(re){return"val_"+re})):l=c.slice(),f=pM(t.callbacks,t.yieldEvery),h=t.verbose==null?1:t.verbose,d=vM(f,h,t.epochs,null,null,Wye(e,t),null,a,l),p=d.callbackList,v=d.history,p.setModel(n),n.history=v,[4,p.onTrainBegin()];case 2:return j.sent(),n.stopTraining_=!1,m=t.initialEpoch==null?0:t.initialEpoch,[4,e.iterator()];case 3:g=j.sent(),j.label=4;case 4:return m<t.epochs?(y={},[4,p.onEpochBegin(m)]):[3,23];case 5:return j.sent(),b=0,w=0,r?[3,7]:[4,e.iterator()];case 6:g=j.sent(),j.label=7;case 7:return!r||b<t.batchesPerEpoch?[4,g.next()]:[3,21];case 8:return x=j.sent(),r&&x.done?(console.warn("You provided `batchesPerEpoch` as "+"".concat(t.batchesPerEpoch,", ")+"but your dataset iterator ran out of data after "+"".concat(b," batches; ")+"interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+"".concat(t.batchesPerEpoch*t.epochs," batches). ")+"You may need to use the repeat() function when building your dataset."),[3,21]):x.value==null?[3,15]:(N=NM(n,x.value),T=N.xs,E=N.ys,C={},C.batch=w,C.size=T[0].shape[0],[4,p.onBatchBegin(w,C)]);case 9:if(j.sent(),F=[],t.classWeight==null)return[3,13];_=kM(t.classWeight,n.outputNames),V=0,j.label=10;case 10:return V<_.length?(L=(O=F).push,[4,SM(E[V],null,_[V])]):[3,13];case 11:L.apply(O,[j.sent()]),j.label=12;case 12:return++V,[3,10];case 13:for(z=T.concat(E).concat(F),$=u(z),D.dispose(z),V=0;V<c.length;++V)B=c[V],W=$[V],C[B]=W,D.keep(W);return[4,p.onBatchEnd(w,C)];case 14:j.sent(),lM(C),w++,b++,j.label=15;case 15:return(r?b>=t.batchesPerEpoch:x.done)?a?(X=void 0,EO(t.validationData)?(Z=Yt,[4,n.evaluateDataset(t.validationData,{batches:t.validationBatches})]):[3,17]):[3,19]:[3,20];case 16:return X=Z.apply(void 0,[j.sent()]),[3,18];case 17:X=Yt(n.evaluate(i,o,{batchSize:t.validationBatchSize==null?zye:t.validationBatchSize,verbose:0})),j.label=18;case 18:for(V=0;V<n.metricsNames.length;++V)y["val_".concat(n.metricsNames[V])]=X[V];j.label=19;case 19:return[3,21];case 20:return n.stopTraining_?[3,21]:[3,7];case 21:return[4,p.onEpochEnd(m,y)];case 22:return j.sent(),m++,n.stopTraining_?[3,23]:[3,4];case 23:return[4,p.onTrainEnd()];case 24:return j.sent(),[4,n.history.syncData()];case 25:return j.sent(),[2,n.history];case 26:return n.isTraining=!1,[7];case 27:return[2]}})})}function Wye(n,e){var t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function EO(n){return typeof n.iterator=="function"}function Vye(n){return typeof n.next=="function"}function Gye(n,e,t){return Ce(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f,h,d;return Ee(this,function(p){switch(p.label){case 0:if(t=t||{},r=t.batches!=null,a=n.testFunction,i=[],t.verbose>0)throw new pt("Verbose mode is not implemented yet.");return D.util.assert(!r||t.batches>0&&Number.isInteger(t.batches),function(){return"Test loop expects `batches` to be a positive integer, but "+"received ".concat(JSON.stringify(t.batches))}),Vye(e)?(s=e,[3,3]):[3,1];case 1:return[4,e.iterator()];case 2:s=p.sent(),p.label=3;case 3:o=s,u=0,c=0,l=function(){var v;return Ee(this,function(m){switch(m.label){case 0:return[4,o.next()];case 1:return v=m.sent(),i=D.tidy(function(){if(v.value){var g=NM(n,v.value),y=g.xs,b=g.ys,w=y.concat(b),x=D.tidy(function(){return a(w)});if(D.dispose(w),c===0)for(var N=0;N<x.length;++N)i.push(R.scalar(0));for(var T=w[0].shape[0],E=function(C){var F=x[C],_=i[C];i[C]=D.tidy(function(){return D.add(i[C],D.mul(T,F))}),c>0&&D.dispose(_)},N=0;N<x.length;++N)E(N);D.dispose(x),u+=T,++c}return i}),v.done?(r&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` "+"batches (in this case, ".concat(t.batches," batches). ")+"You may need to use the repeat() function when building your dataset."),[2,"break"]):[2]}})},p.label=4;case 4:return!r||c<t.batches?[5,l()]:[3,6];case 5:return f=p.sent(),f==="break"?[3,6]:[3,4];case 6:for(h=0;h<i.length;++h)d=i[h],i[h]=D.div(i[h],u),D.dispose(d);return[2,Ir(i)]}})})}function Ty(n){D.util.assert(n>0&&Number.isInteger(n),function(){return"batchSize is required to be a positive integer, but got ".concat(n)})}function gf(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(function(r){return Os(r,e,t-e)}):Os(n,e,t-e)}function Uy(n,e){return D.tidy(function(){return n==null?null:Array.isArray(n)?n.map(function(t){return Uy(t,e)}):VO(n,e.dtype==="int32"?e:D.cast(e,"int32"))})}function Ey(n,e){for(var t=[],r=0,a=null;r<n;)a=r+e,a>=n&&(a=n),t.push([r,a]),r=a;return t}function TM(n){var e=[];n instanceof R.Tensor&&(n=[n]);for(var t=0;t<n.length;++t){var r=n[t];if(r.rank===1)e.push(Df(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(r)}}return e}function ii(n,e){if(n!=null){var t=[];if(e instanceof R.Tensor)t.push(e.id);else if(Array.isArray(e))e.forEach(function(s){return t.push(s.id)});else if(e!=null)for(var r in e){var a=e[r];t.push(a.id)}var i=[];if(n instanceof R.Tensor)t.indexOf(n.id)===-1&&i.push(n);else if(Array.isArray(n))n.forEach(function(s){t.indexOf(s.id)===-1&&i.push(s)});else if(n!=null)for(var r in n){var o=n[r];t.indexOf(o.id)===-1&&i.push(o)}i.forEach(function(s){s.isDisposed||s.dispose()})}}function Uye(n){return n instanceof R.Tensor}function Hy(n){return Array.isArray(n)}function IO(n){return!Uye(n)&&!Hy(n)}function CO(n,e,t,r,a){var i,o;if(r===void 0&&(r=!0),a===void 0&&(a=""),e==null||e.length===0){if(n!=null){var s=!1;if(Hy(n)&&n.length>0)s=!0;else if(IO(n)){for(var u in n)if(n.hasOwnProperty(u)){s=!0;break}}else s=!0;if(s)throw new J("Error when checking model ".concat(a," expected no data, ")+"but got ".concat(n))}return[]}if(n==null)return e.map(function(y){return null});var c;if(IO(n)){n=n,c=[];try{for(var l=fe(e),f=l.next();!f.done;f=l.next()){var h=f.value;if(n[h]==null)throw new J('No data provided for "'.concat(h,'". Need data for each key in: ')+"".concat(e));c.push(n[h])}}catch(y){i={error:y}}finally{try{f&&!f.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}}else if(Hy(n)){if(n=n,n.length!==e.length)throw new J("Error when checking model ".concat(a,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"model expected. Expected to see ".concat(e.length," Tensor(s), but ")+"instead got the following list of Tensor(s): ".concat(n));c=n}else{if(n=n,e.length>1)throw new J("The model ".concat(a," expects ").concat(e.length," Tensor(s), ")+"but only received one Tensor. Found: Tensor with shape ".concat(n.shape));c=[n]}if(c=TM(c),t!=null){for(var d=0;d<e.length;++d)if(t[d]!=null){var p=c[d];if(p.shape.length!==t[d].length)throw new J("Error when checking ".concat(a,": expected ").concat(e[d]," ")+"to have ".concat(t[d].length," dimension(s). but got array with ")+"shape ".concat(p.shape));for(var v=0;v<t[d].length;++v)if(!(v===0&&!r)){var m=p.shape[v],g=t[d][v];if(g!=null&&g>=0&&m!==g)throw new J("".concat(a," expected a batch of elements where each ")+"example has shape [".concat(t[d].slice(1,t[d].length),"] ")+"(i.e.,tensor shape [*,".concat(t[d].slice(1,t[d].length),"])")+" but the ".concat(a," received an input with ").concat(p.shape[0])+" examples, each with shape [".concat(p.shape.slice(1,p.shape.length),"]")+" (tensor shape [".concat(p.shape,"])"))}}}return c}function Hye(n,e,t){var r=zo(n.map(function(i){return i.shape[0]}));r.sort();var a=zo(e.map(function(i){return i.shape[0]}));if(a.sort(),r.length>1)throw new J("All input Tensors (x) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(n.map(function(i){return i.shape}))));if(a.length>1)throw new J("All target Tensors (y) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(e.map(function(i){return i.shape}))));if(r.length>0&&a.length>0&&!R.util.arraysEqual(r,a))throw new J("Input Tensors should have the same number of samples as target "+"Tensors. Found ".concat(r[0]," input sample(s) and ").concat(a[0]," target ")+"sample(s).")}function Kye(n,e,t){for(var r=[Us,iv,Ef],a=0;a<n.length;++a){var i=n[a],o=e[a],s=t[a];if(o!=null){if(o===Ef&&i.shape[i.shape.length-1]===1)throw new J("You are passing a target array of shape ".concat(i.shape," while using ")+"a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(r.indexOf(o)!==-1)for(var u=i.shape.slice(1),c=s.slice(1),l=0;l<u.length;++l){var f=u[l],h=c[l];if(h!=null&&f!==h)throw new J("A target Tensor with shape ".concat(i.shape," was passed for an ")+"output of shape ".concat(s,", while using a loss function that ")+"expects targets to have the same shape as the output.")}}}}function AO(n,e,t,r,a){r===void 0&&(r=!0),a===void 0&&(a="");var i;if(Array.isArray(n)){if(n.length!==e.length)throw new J("Error when checking model ".concat(a,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"the model expected. Expected to see ".concat(e.length," Tensor(s),")+" but instead got ".concat(n.length," Tensors(s)."));i=n}else{if(e.length>1)throw new J("The model expects ".concat(e.length," ").concat(a," Tensors, ")+"but only received one Tensor. Found: array with shape "+"".concat(JSON.stringify(n.shape),"."));i=[n]}if(t!=null){for(var o=0;o<e.length;++o)if(t[o]!=null){var s=i[o];if(s.shape.length!==t[o].length)throw new J("Error when checking ".concat(a,": expected ").concat(e[o]," ")+"to have ".concat(t[o].length," dimension(s), but got array with ")+"shape ".concat(JSON.stringify(s.shape)));for(var u=0;u<t[o].length;++u)if(!(u===0&&!r)){var c=s.shape[u],l=t[o][u];if(l!=null&&l!==c)throw new J("Error when checking ".concat(a,": expected ")+"".concat(e[o]," to have shape ").concat(JSON.stringify(t[o])," but ")+"got array with shape ".concat(JSON.stringify(s.shape),"."))}}}}function jye(n,e){var t,r;if(n==null||Array.isArray(n)&&n.length===0)return e.map(function(l){return[]});var a;if(typeof n=="string"||typeof n=="function")a=[n];else if(Array.isArray(n)||typeof n=="object")a=n;else throw new TypeError("Type of metrics argument not understood. Expected an string,"+"function, Array, or Object, found: ".concat(n));if(Array.isArray(a))return e.map(function(l){return a});var i=[];try{for(var o=fe(e),s=o.next();!s.done;s=o.next()){var u=s.value,c=a.hasOwnProperty(u)?a[u]:[];Array.isArray(c)||(c=[c]),i.push(c)}}catch(l){t={error:l}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return i}var Xye="layers-model",to=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.isTraining=!1,r}return e.prototype.summary=function(t,r,a){if(a===void 0&&(a=console.log),!this.built)throw new J("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");_ye(this,t,r,a)},e.prototype.compile=function(t){var r,a,i=this;if(t.loss==null&&(t.loss=[]),this.loss=t.loss,typeof t.optimizer=="string")this.optimizer_=Dye(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof R.Optimizer))throw new J("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}var o=[];if(!Array.isArray(t.loss)&&typeof t.loss!="string"&&typeof t.loss!="function"){t.loss=t.loss;for(var s in t.loss)if(this.outputNames.indexOf(s)===-1)throw new J('Unknown entry in loss dictionary: "'.concat(s,'". ')+"Only expected the following keys: ".concat(this.outputNames));try{for(var u=fe(this.outputNames),c=u.next();!c.done;c=u.next()){var s=c.value;t.loss[s]==null&&console.warn('Output "'.concat(s,'" is missing from loss dictionary. We assume ')+"this was done on purpose, and we will not be expecting data "+"to be passed to ".concat(s," during training")),o.push(Ny(t.loss[s]))}}catch(g){r={error:g}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(r)throw r.error}}}else if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new J("When passing an Array as loss, it should have one entry per "+"model output. The model has ".concat(this.outputs.length," output(s), ")+"but you passed loss=".concat(t.loss,"."));var l=t.loss;o=l.map(function(g){return Ny(g)})}else{var f=Ny(t.loss);this.outputs.forEach(function(g){o.push(f)})}this.lossFunctions=o,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var h=0;h<this.outputs.length;++h){var d=this.internalOutputShapes[h],s=this.outputNames[h];this.feedOutputNames.push(s),this.feedOutputShapes.push(d),this.feedLossFns.push(this.lossFunctions[h])}var p=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Rs("loss",function(){for(var g=0;g<i.outputs.length;++g)if(p.indexOf(g)===-1){var y=i.lossFunctions[g];i.outputs.length>1&&(i.metricsTensors.push([y,g]),i.metricsNames.push(i.outputNames[g]+"_loss"))}});var v=jye(t.metrics,this.outputNames),m=function(g,y,b){i.outputNames.length>1&&(y=i.outputNames[g]+"_"+y),i.metricsNames.push(y),i.metricsTensors.push([b,g])};Rs("metric",function(){for(var g=function(b){if(p.indexOf(b)!==-1)return"continue";var w=v[b],x=function(N){var T,E,C="",F,_,O,L=function(W){if(typeof W=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(W)!==-1){var X=i.internalOutputShapes[b];X[X.length-1]===1||i.lossFunctions[b]===iv?["accuracy","acc"].indexOf(W)!==-1?_=Fb:["crossentropy","ce"].indexOf(W)!==-1&&(_=yM):i.lossFunctions[b]===qp?["accuracy","acc"].indexOf(W)!==-1?_=bM:["crossentropy","ce"].indexOf(W)!==-1&&(_=wM):["accuracy","acc"].indexOf(W)!==-1?_=Rb:["crossentropy","ce"].indexOf(W)!==-1&&(_=Ob);var Z=void 0;["accuracy","acc"].indexOf(W)!==-1?Z="acc":["crossentropy","ce"].indexOf(W)!==-1&&(Z="ce"),O=_,F=C+Z}else{var V=Aye(W);O=V,F=C+xp(W)}var j;Rs(F,function(){j=O}),m(b,F,j)};try{for(var z=(T=void 0,fe(N)),$=z.next();!$.done;$=z.next()){var B=$.value;L(B)}}catch(W){T={error:W}}finally{try{$&&!$.done&&(E=z.return)&&E.call(z)}finally{if(T)throw T.error}}};x(w)},y=0;y<i.outputs.length;++y)g(y)}),this.collectedTrainableWeights=this.trainableWeights},e.prototype.checkTrainableWeightsConsistency=function(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},e.prototype.evaluate=function(t,r,a){a===void 0&&(a={});var i=a.batchSize==null?32:a.batchSize;Ty(i);var o=!0,s=this.standardizeUserDataXY(t,r,o,i);try{var u=s[0].concat(s[1]);this.makeTestFunction();var c=this.testFunction,l=this.testLoop(c,u,i,a.verbose,a.steps);return Ir(l)}finally{ii(s[0],t),ii(s[1],r)}},e.prototype.evaluateDataset=function(t,r){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){return this.makeTestFunction(),[2,Gye(this,t,r)]})})},e.prototype.checkNumSamples=function(t,r,a,i){i===void 0&&(i="steps");var o;if(a!=null){if(o=null,r!=null)throw new J("If ".concat(i," is set, batchSize must be null or undefined.")+"Got batchSize = ".concat(r))}else if(t!=null)Array.isArray(t)?o=t[0].shape[0]:o=t.shape[0];else throw new J("Either the input data should have a defined shape, or "+"".concat(i," shoud be specified."));return o},e.prototype.execute=function(t,r){var a,i;if(Array.isArray(r)&&r.length===0)throw new J("`outputs` is an empty Array, which is not allowed.");var o=Array.isArray(r),s=o?r:[r],u=this.retrieveSymbolicTensors(s),c=new sc;if(t instanceof R.Tensor&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new J("The number of inputs provided (".concat(t.length,") ")+"does not match the number of inputs of this model "+"(".concat(this.inputs.length,")."));for(var l=0;l<this.inputs.length;++l)c.add(this.inputs[l],t[l])}else try{for(var f=fe(this.inputs),h=f.next();!h.done;h=f.next()){var d=h.value,p=t[d.name];if(p==null)throw new J("No value is provided for the model's input ".concat(d.name));c.add(d,p)}}catch(m){a={error:m}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}var v=bf(u,c);return o?v:v[0]},e.prototype.retrieveSymbolicTensors=function(t){var r,a,i=Ps(null,t.length),o=t.length;try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){for(var c=u.value,l=Array.isArray(c.output)?c.output:[c.output],f=l.map(function(v){return v.name}),h=0;h<t.length;++h){var d=f.indexOf(t[h]);if(d!==-1&&(i[h]=l[d],o--),o===0)break}if(o===0)break}}catch(v){r={error:v}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}if(o>0){var p=[];throw i.forEach(function(v,m){v==null&&p.push(t[m])}),new J("Cannot find SymbolicTensors for output name(s): "+"".concat(JSON.stringify(p)))}return i},e.prototype.predictLoop=function(t,r,a){var i=this;return r===void 0&&(r=32),a===void 0&&(a=!1),D.tidy(function(){var o=i.checkNumSamples(t);if(a)throw new pt("Verbose predictLoop() is not implemented yet.");for(var s=Ey(o,r),u=i.outputs.map(function(f){return[]}),c=function(f){var h=D.tidy(function(){var d=s[f][0],p=s[f][1],v=gf(t,d,p),m=[];if(Array.isArray(v))for(var g=0;g<v.length;++g)m.push({key:i.inputs[g],value:v[g]});else m.push({key:i.inputs[0],value:v});var y=new sc(m);return bf(i.outputs,y)});h.forEach(function(d,p){return u[p].push(d)})},l=0;l<s.length;++l)c(l);return Ir(u.map(function(f){return D.concat(f,0)}))})},e.prototype.predict=function(t,r){r===void 0&&(r={});var a=TM(t);AO(a,this.inputNames,this.feedInputShapes,!1);try{var i=r.batchSize==null?32:r.batchSize;return Ty(i),this.predictLoop(a,i)}finally{ii(a,t)}},e.prototype.predictOnBatch=function(t){AO(t,this.inputNames,this.feedInputShapes,!0);var r=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,r)},e.prototype.standardizeUserDataXY=function(t,r,a,i){if(this.optimizer_==null)throw new _i("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var o=[],s=0;s<this.feedOutputShapes.length;++s){var u=this.feedOutputShapes[s],c=this.feedLossFns[s];c===qp?o.push(u.slice(0,u.length-1).concat([1])):o.push(u)}if(t=CO(t,this.feedInputNames,this.feedInputShapes,!1,"input"),r=CO(r,this.feedOutputNames,o,!1,"target"),Hye(t,r),Kye(r,this.feedLossFns,this.feedOutputShapes),this.stateful&&i!=null&&i>0&&t[0].shape[0]%i!==0)throw new J("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+"".concat(i,". Found: ").concat(t[0].shape[0]," sample(s)."));return[t,r]},e.prototype.standardizeUserData=function(t,r,a,i,o,s){return o===void 0&&(o=!0),Ce(this,void 0,void 0,function(){var u,c,l,f,h,d,p,v;return Ee(this,function(m){switch(m.label){case 0:if(u=te(this.standardizeUserDataXY(t,r,o,s),2),c=u[0],l=u[1],a!=null)throw new Error("sample weight is not supported yet.");if(f=null,i==null)return[3,4];h=kM(i,this.outputNames),f=[],d=0,m.label=1;case 1:return d<h.length?(v=(p=f).push,[4,SM(l[d],null,h[d])]):[3,4];case 2:v.apply(p,[m.sent()]),m.label=3;case 3:return++d,[3,1];case 4:return[2,[c,l,f]]}})})},e.prototype.testLoop=function(t,r,a,i,o){var s=this;return i===void 0&&(i=0),D.tidy(function(){var u=s.checkNumSamples(r,a,o,"steps"),c=[];if(i>0)throw new pt("Verbose mode is not implemented yet.");if(o!=null)throw new pt("steps mode in testLoop() is not implemented yet");for(var l=Ey(u,a),f=R.tensor1d(li(0,u)),h=0;h<l.length;++h){var d=l[h][0],p=l[h][1],v=Os(f,d,p-d),m=Uy(r,v),g=t(m);if(h===0)for(var y=0;y<g.length;++y)c.push(R.scalar(0));for(var y=0;y<g.length;++y){var b=g[y];c[y]=D.add(c[y],D.mul(p-d,b))}}for(var y=0;y<c.length;++y)c[y]=D.div(c[y],u);return c})},e.prototype.getDedupedMetricsNames=function(){for(var t=this.metricsNames,r=[],a=0;a<t.length;++a){var i=t[a],o=i;if(PR(t,i)>1){var s=PR(t.slice(0,a),i);o+="_".concat(s)}r.push(o)}return r},e.prototype.makeTrainFunction=function(){var t=this;return function(r){var a=[],i=r.slice(0,t.inputs.length),o=r.slice(t.inputs.length,t.inputs.length+t.outputs.length),s=r.slice(t.inputs.length+t.outputs.length,t.inputs.length+t.outputs.length*2),u=[],c=function(){for(var d=[],p=0;p<t.inputs.length;++p)d.push({key:t.inputs[p],value:i[p]});for(var v=new sc(d),m=bf(t.outputs,v,{training:!0}),g,p=0;p<t.lossFunctions.length;++p){var y=t.lossFunctions[p],b=y(o[p],m[p]);s[p]!=null&&(b=Lye(b,s[p]));var w=D.mean(b);a.push(w),p===0?g=b:g=D.add(g,b)}for(var p=0;p<t.metricsTensors.length;++p){var x=void 0;if(t.outputs.length>1&&p<t.outputs.length)x=a[p];else{var N=t.metricsTensors[p][0],T=t.metricsTensors[p][1];x=D.mean(N(o[T],m[T]))}D.keep(x),u.push(x)}return g=D.mean(g),t.calculateLosses().forEach(function(E){g=D.add(g,E)}),g},l=t.collectedTrainableWeights.map(function(d){return d.read()}),f=!0,h=t.optimizer_.minimize(c,f,l);return[h].concat(u)}},e.prototype.makeTestFunction=function(){var t=this;this.testFunction=function(r){return D.tidy(function(){for(var a=[],i,o=r.slice(0,t.inputs.length),s=r.slice(t.inputs.length,t.inputs.length+t.outputs.length),u=[],c=0;c<t.inputs.length;++c)u.push({key:t.inputs[c],value:o[c]});for(var l=new sc(u),f=bf(t.outputs,l),c=0;c<t.lossFunctions.length;++c){var h=t.lossFunctions[c],d=D.mean(h(s[c],f[c]));c===0?i=d:i=D.add(i,d),a.push(i)}for(var c=0;c<t.metricsTensors.length;++c){var p=t.metricsTensors[c][0],v=t.metricsTensors[c][1],m=D.mean(p(s[v],f[v]));a.push(m)}return a})}},e.prototype.fit=function(t,r,a){return a===void 0&&(a={}),Ce(this,void 0,void 0,function(){var i,o,s,u,c,l,f,h,d,p,v,m,g,y,b,w,x,N,T,E,C,F,_,O,L;return Ee(this,function(z){switch(z.label){case 0:if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0,z.label=1;case 1:return z.trys.push([1,,7,8]),p=a.batchSize==null?32:a.batchSize,Ty(p),v=!1,[4,this.standardizeUserData(t,r,a.sampleWeight,a.classWeight,v,p)];case 2:if(m=z.sent(),i=m[0],o=m[1],d=m[2],g=!1,y=void 0,!(a.validationData!=null&&a.validationData.length>0))return[3,4];if(g=!0,a.validationData.length===2)c=a.validationData[0],l=a.validationData[1];else throw a.validationData.length===3?new pt("validationData including sample weights is not supported yet."):new J("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+"".concat(a.validationData," is invalid."));return b=!0,[4,this.standardizeUserData(c,l,null,null,b,p)];case 3:return w=z.sent(),f=w[0],h=w[1],y=f.concat(h),[3,5];case 4:a.validationSplit!=null&&a.validationSplit>0&&a.validationSplit<1?(g=!0,x=Math.floor(i[0].shape[0]*(1-a.validationSplit)),N=i[0].shape[0],f=gf(i,x,N),s=i,i=gf(i,0,x),h=gf(o,x,N),u=o,o=gf(o,0,x),y=f.concat(h)):a.validationSteps!=null&&(g=!0),z.label=5;case 5:return T=i.concat(o).concat(d),this.checkTrainableWeightsConsistency(),E=this.makeTrainFunction(),C=this.getDedupedMetricsNames(),F=void 0,_=void 0,g?(this.makeTestFunction(),F=this.testFunction,_=C.slice().concat(C.map(function($){return"val_"+$}))):(F=null,y=[],_=C.slice()),O=pM(a.callbacks,a.yieldEvery),[4,this.fitLoop(E,T,C,p,a.epochs,a.verbose,O,F,y,a.shuffle,_,a.initialEpoch,null,null)];case 6:return L=z.sent(),[2,L];case 7:return this.isTraining=!1,ii(i,t),ii(o,r),ii(s,t),ii(u,r),ii(f,c),ii(h,l),d!=null&&D.dispose(d),[7];case 8:return[2]}})})},e.prototype.fitLoop=function(t,r,a,i,o,s,u,c,l,f,h,d,p,v){return Ce(this,void 0,void 0,function(){var m,g,y,b,w,x,N,T,E,C,F=this;return Ee(this,function(_){switch(_.label){case 0:if(i==null&&(i=32),o==null&&(o=1),f==null&&(f=!0),d==null&&(d=0),m=!1,c!=null&&l!=null&&(m=!0),v!=null&&(m=!0,p==null))throw new J("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");return g=this.checkNumSamples(r,i,p,"steps_per_epoch"),g!=null&&(y=li(0,g)),s==null&&(s=1),b=vM(u,s,o,d,g,p,i,m,h),w=b.callbackList,x=b.history,w.setModel(this),this.history=x,[4,w.onTrainBegin()];case 1:_.sent(),this.stopTraining_=!1,N=function(O){var L,z,$,B,W,X;return Ee(this,function(Z){switch(Z.label){case 0:return[4,w.onEpochBegin(O)];case 1:if(Z.sent(),L={},p==null)return[3,2];throw new pt("stepsPerEpoch mode is not implemented yet.");case 2:if(f==="batch")throw new pt("batch shuffling is not implemneted yet");f&&R.util.shuffle(y),z=R.tensor1d(y),$=Ey(g,i),B=function(V){var j;return Ee(this,function(re){switch(re.label){case 0:return j={},[4,w.onBatchBegin(V,j)];case 1:return re.sent(),D.tidy(function(){var ne=$[V][0],oe=$[V][1],le=Os(z,ne,oe-ne);j.batch=V,j.size=oe-ne;for(var pe=Uy(r,le),xe=t(pe),he=0;he<a.length;++he){var ye=a[he],we=xe[he];j[ye]=we,D.keep(we)}if(V===$.length-1&&m)for(var Ae=F.testLoop(c,l,i),he=0;he<a.length;++he){var ye=a[he],we=Ae[he];D.keep(we),L["val_"+ye]=we}}),[4,w.onBatchEnd(V,j)];case 2:return re.sent(),lM(j),T.stopTraining_?[2,"break"]:[2]}})},W=0,Z.label=3;case 3:return W<$.length?[5,B(W)]:[3,6];case 4:if(X=Z.sent(),X==="break")return[3,6];Z.label=5;case 5:return++W,[3,3];case 6:z.dispose(),Z.label=7;case 7:return[4,w.onEpochEnd(O,L)];case 8:return Z.sent(),T.stopTraining_?[2,"break"]:[2]}})},T=this,E=d,_.label=2;case 2:return E<o?[5,N(E)]:[3,5];case 3:if(C=_.sent(),C==="break")return[3,5];_.label=4;case 4:return++E,[3,2];case 5:return[4,w.onTrainEnd()];case 6:return _.sent(),[4,this.history.syncData()];case 7:return _.sent(),[2,this.history]}})})},e.prototype.fitDataset=function(t,r){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){return[2,qye(this,t,r)]})})},e.prototype.trainOnBatch=function(t,r){return Ce(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f,h,d,p,v,m;return Ee(this,function(g){switch(g.label){case 0:return[4,this.standardizeUserData(t,r)];case 1:a=g.sent(),i=a[0],o=a[1],s=this.makeTrainFunction(),u=s(i.concat(o)),c=[],g.label=2;case 2:g.trys.push([2,7,8,9]),l=fe(u),f=l.next(),g.label=3;case 3:return f.done?[3,6]:(h=f.value,[4,h.data()]);case 4:d=g.sent(),c.push(d[0]),g.label=5;case 5:return f=l.next(),[3,3];case 6:return[3,9];case 7:return p=g.sent(),v={error:p},[3,9];case 8:try{f&&!f.done&&(m=l.return)&&m.call(l)}finally{if(v)throw v.error}return[7];case 9:return D.dispose(u),ii(a[0],t),ii(a[1],r),[2,Ir(c)]}})})},e.prototype.getNamedWeights=function(t){for(var r=[],a=t!=null&&t.trainableOnly,i=a?this.trainableWeights:this.weights,o=this.getWeights(a),s=0;s<i.length;++s)a&&!i[s].trainable||r.push({name:i[s].originalName,tensor:o[s]});return r},Object.defineProperty(e.prototype,"stopTraining",{get:function(){return this.stopTraining_},set:function(t){this.stopTraining_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"optimizer",{get:function(){return this.optimizer_},set:function(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){var t=n.prototype.dispose.call(this);if(t.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){var r=D.memory().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=r-D.memory().numTensors}return t},e.prototype.getLossIdentifiers=function(){var t,r,a,i,o;if(typeof this.loss=="string")o=eo(this.loss);else if(Array.isArray(this.loss)){try{for(var s=fe(this.loss),u=s.next();!u.done;u=s.next()){var c=u.value;if(typeof c!="string")throw new Error("Serialization of non-string loss is not supported.")}}catch(v){t={error:v}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}o=this.loss.map(function(v){return eo(v)})}else{var l=Object.keys(this.loss);o={};var f=this.loss;try{for(var h=fe(l),d=h.next();!d.done;d=h.next()){var p=d.value;if(typeof f[p]=="string")o[p]=eo(f[p]);else throw new Error("Serialization of non-string loss is not supported.")}}catch(v){a={error:v}}finally{try{d&&!d.done&&(i=h.return)&&i.call(h)}finally{if(a)throw a.error}}}return o},e.prototype.getMetricIdentifiers=function(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[eo(xp(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(function(a){return eo(xp(a))});var t={};for(var r in this.metrics)t[r]=eo(xp(this.metrics[r]));return t},e.prototype.getTrainingConfig=function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}},e.prototype.loadTrainingConfig=function(t){if(t.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(t.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(t.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");var r=If(t.optimizer_config),a=ui(r),i;if(typeof t.loss=="string")i=_s(t.loss);else if(Array.isArray(t.loss))i=t.loss.map(function(u){return _s(u)});else if(t.loss!=null){i={};for(var o in t.loss)i[o]=_s(t.loss[o])}var s;if(Array.isArray(t.metrics))s=t.metrics.map(function(u){return _s(u)});else if(t.metrics!=null){s={};for(var o in t.metrics)s[o]=_s(t.metrics[o])}this.compile({loss:i,metrics:s,optimizer:a})},e.prototype.save=function(t,r){return Ce(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f,h,d,p,v,m,g,y;return Ee(this,function(b){switch(b.label){case 0:if(typeof t=="string"){if(a=R.io.getSaveHandlers(t),a.length===0)throw new J("Cannot find any save handlers for URL '".concat(t,"'"));if(a.length>1)throw new J("Found more than one (".concat(a.length,") save handlers for ")+"URL '".concat(t,"'"));t=a[0]}if(t.save==null)throw new J("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,R.io.encodeWeights(this.getNamedWeights(r))];case 1:return i=b.sent(),o=!1,s=null,u=this.toJSON(s,o),c={modelTopology:u,format:Xye,generatedBy:"TensorFlow.js tfjs-layers v".concat(Pb),convertedBy:null},l=r==null?!1:r.includeOptimizer,l&&this.optimizer!=null?(c.trainingConfig=this.getTrainingConfig(),f="optimizer",m=(v=R.io).encodeWeights,[4,this.optimizer.getWeights()]):[3,4];case 2:return[4,m.apply(v,[b.sent(),f])];case 3:h=b.sent(),d=h.data,p=h.specs,(y=i.specs).push.apply(y,Qe([],te(p),!1)),i.data=R.io.concatenateArrayBuffers([i.data,d]),b.label=4;case 4:return this.userDefinedMetadata!=null&&(g=!0,NO(this.userDefinedMetadata,this.name,g),c.userDefinedMetadata=this.userDefinedMetadata),c.weightData=i.data,c.weightSpecs=i.specs,[2,t.save(c)]}})})},e.prototype.setUserDefinedMetadata=function(t){NO(t,this.name),this.userDefinedMetadata=t},e.prototype.getUserDefinedMetadata=function(){return this.userDefinedMetadata},e}(Mye);to.className="Model";R.serialization.registerClass(to);var EM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e}(to);EM.className="Functional";R.serialization.registerClass(EM);function Yye(n,e){return Ce(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f;return Ee(this,function(h){switch(h.label){case 0:return"modelTopology"in n||(n={modelTopology:n}),n=n,t=n.modelTopology,t.model_config!=null&&(t=t.model_config),r=If(t),a=ui(r,e),n.weightsManifest==null?[3,2]:[4,R.io.loadWeights(n.weightsManifest,n.pathPrefix,a.weights.map(function(d){return d.originalName}))];case 1:i=h.sent(),o={};try{for(s=fe(a.weights),u=s.next();!u.done;u=s.next())c=u.value,o[c.originalName]=i[c.originalName]}catch(d){l={error:d}}finally{try{u&&!u.done&&(f=s.return)&&f.call(s)}finally{if(l)throw l.error}}a.loadWeights(o),R.dispose(i),h.label=2;case 2:return[2,a]}})})}function Zye(n,e){return Ce(this,void 0,void 0,function(){var t;return Ee(this,function(r){if(e==null&&(e={}),typeof n=="string"){if(t=R.io.getLoadHandlers(n,e),t.length===0)t.push(R.io.browserHTTPRequest(n,e));else if(t.length>1)throw new J("Found more than one (".concat(t.length,") load handlers for ")+"URL '".concat(n,"'"));n=t[0]}return[2,Jye(n,void 0,e)]})})}function Jye(n,e,t){return Ce(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f;return Ee(this,function(h){switch(h.label){case 0:if(t==null&&(t={}),n.load==null)throw new J("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,n.load()];case 1:if(r=h.sent(),a=r.modelTopology,a.model_config!=null&&(a=a.model_config),i=t.strict==null?!0:t.strict,o=r.weightData!=null&&r.weightSpecs!=null&&i,s=ui(If(a),e,o),u=r.trainingConfig,u!=null&&s.loadTrainingConfig(u),r.userDefinedMetadata!=null&&s.setUserDefinedMetadata(r.userDefinedMetadata),r.weightData==null)return[3,4];if(r.weightSpecs==null)throw new J("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");return c=Qye(r.weightData,r.weightSpecs),l=c.modelWeights,f=c.optimizerWeights,s.loadWeights(l,i),s.optimizer!=null&&f.length>0?[4,s.optimizer.setWeights(f)]:[3,3];case 2:h.sent(),h.label=3;case 3:R.dispose(l),R.dispose(f.map(function(d){return d.tensor})),h.label=4;case 4:return[2,s]}})})}function Qye(n,e){var t=R.io.decodeWeights(n,e),r={},a=[];return e.forEach(function(i){i.group==="optimizer"?a.push({name:i.name,tensor:t[i.name]}):r[i.name]=t[i.name]}),{modelWeights:r,optimizerWeights:a}}var ov=function(n){se(e,n);function e(t){var r,a,i=n.call(this,{inputs:[],outputs:[]})||this;if(t=t||{},i.trainable=!0,i.built=!1,i.name=t.name!=null?t.name:Up("sequential_"),t.layers!=null)try{for(var o=fe(t.layers),s=o.next();!s.done;s=o.next()){var u=s.value;i.add(u)}}catch(c){r={error:c}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}return i}return e.prototype.checkShape=function(t){var r=t.inboundNodes[0].outputTensors[0].shape;if(r.some(function(a){return a<0}))throw new J("Negative dimension size caused by adding layer "+"".concat(t.name," with input shape [")+"".concat(t.inboundNodes[0].inputTensors[0].shape,"]"))},e.prototype.add=function(t){var r=t instanceof e||t instanceof to,a;if(r){if(a=t,a.outputs.length!==1)throw new J("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(a.inputs.length!==1)throw new J("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new J("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var i=KO({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(i)}if(r)this.outputs=a.outputs,this.inputs=a.inputs;else{if(t.inboundNodes.length!==1)throw new J("A layer added to a Sequential model must not already be "+"connected somewhere else. LayersModel received layer ".concat(t.name," ")+"which has ".concat(t.inboundNodes.length," pre-existing inbound ")+"connections.");if(t.inboundNodes[0].outputTensors.length!==1)throw new J("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=HO(this.outputs[0])}this.inboundNodes=[],new ev({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Ps(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(function(s){return s.shape}),outputShapes:this.outputs[0].shape})}else{var o=t.apply(this.outputs[0]);if(Array.isArray(o))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[o],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1},e.prototype.pop=function(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},e.prototype.call=function(t,r){return this.model==null&&this.build(),this.model.call(t,r)},e.prototype.build=function(t){if(It(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new to({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},e.prototype.countParams=function(){return this.built||this.build(),n.prototype.countParams.call(this)},e.prototype.summary=function(t,r,a){a===void 0&&(a=console.log),this.built||this.build(),n.prototype.summary.call(this,t,r,a)},e.prototype.setWeights=function(t){this.model==null&&this.build(),this.model.setWeights(t)},e.prototype.evaluate=function(t,r,a){if(a===void 0&&(a={}),!this.built)throw new _i("The model needs to be compiled before being used.");return this.model.evaluate(t,r,a)},e.prototype.evaluateDataset=function(t,r){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){if(!this.built)throw new _i("The model needs to be compiled before being used.");return[2,this.model.evaluateDataset(t,r)]})})},e.prototype.predict=function(t,r){return r===void 0&&(r={}),this.model==null&&this.build(),this.model.predict(t,r)},e.prototype.predictOnBatch=function(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)},e.prototype.compile=function(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},Object.defineProperty(e.prototype,"optimizer",{get:function(){return this.model==null?void 0:this.model.optimizer},set:function(t){this.model.optimizer=t},enumerable:!1,configurable:!0}),e.prototype.fit=function(t,r,a){return a===void 0&&(a={}),Ce(this,void 0,void 0,function(){return Ee(this,function(i){if(!this.built)throw new _i("The model needs to be compiled before being used.");return[2,this.model.fit(t,r,a)]})})},e.prototype.fitDataset=function(t,r){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){if(!this.built)throw new _i("The model needs to be compiled before being used.");return[2,this.model.fitDataset(t,r)]})})},e.prototype.trainOnBatch=function(t,r){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){return[2,this.model.trainOnBatch(t,r)]})})},e.fromConfig=function(t,r,a,i){var o,s;i===void 0&&(i=!1);var u,c={};if(r instanceof Array){if(r[0].className==null||r[0].className==="Merge")throw new J("Legacy serialization format not supported yet.");u=r}else R.util.assert(r.layers!=null,function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."}),u=r.layers,delete r.layers,c=r;var l=new t(c);if(!(l instanceof e))throw new pt("Sequential.fromConfig called on non-Sequential input: ".concat(l));try{for(var f=fe(u),h=f.next();!h.done;h=f.next()){var d=h.value,p=void 0,v=ui(d,p,i);i&&v.setFastWeightInitDuringBuild(!0),l.add(v)}}catch(m){o={error:m}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}return l},Object.defineProperty(e.prototype,"stopTraining",{get:function(){if(this.model==null)throw new J("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(t){if(this.model==null)throw new J("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t},enumerable:!1,configurable:!0}),e.prototype.getConfig=function(){var t,r,a=[];try{for(var i=fe(this.layers),o=i.next();!o.done;o=i.next()){var s=o.value,u={};u.className=s.getClassName(),u.config=s.getConfig(),a.push(u)}}catch(c){t={error:c}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return{name:this.name,layers:a}},e}(to);ov.className="Sequential";R.serialization.registerClass(ov);function ebe(n){return new to(n)}function tbe(n){return new ov(n)}function IM(n){return KO(n)}function nbe(n,e){Db.registerCallbackConstructor(n,e)}var Ar=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getConfig=function(){return{}},e}(R.serialization.Serializable),CM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t,r){return r===void 0&&(r=1),Sfe(t,r)},e}(Ar);CM.className="elu";R.serialization.registerClass(CM);var AM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return D.selu(t)},e}(Ar);AM.className="selu";R.serialization.registerClass(AM);var DM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return D.relu(t)},e}(Ar);DM.className="relu";R.serialization.registerClass(DM);var _M=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return R.tidy(function(){return D.minimum(6,D.relu(t))})},e}(Ar);_M.className="relu6";R.serialization.registerClass(_M);var FM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return t},e}(Ar);FM.className="linear";R.serialization.registerClass(FM);var RM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return D.sigmoid(t)},e}(Ar);RM.className="sigmoid";R.serialization.registerClass(RM);var OM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return Tfe(t)},e}(Ar);OM.className="hardSigmoid";R.serialization.registerClass(OM);var PM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return D.softplus(t)},e}(Ar);PM.className="softplus";R.serialization.registerClass(PM);var MM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return Nfe(t)},e}(Ar);MM.className="softsign";R.serialization.registerClass(MM);var BM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return D.tanh(t)},e}(Ar);BM.className="tanh";R.serialization.registerClass(BM);var Mb=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t,r){return r===void 0&&(r=-1),D.softmax(t,r)},e}(Ar);Mb.className="softmax";R.serialization.registerClass(Mb);var LM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t,r){return r===void 0&&(r=-1),D.logSoftmax(t,r)},e}(Ar);LM.className="logSoftmax";R.serialization.registerClass(LM);var zM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t,r){return r===void 0&&(r=1),R.tidy(function(){return D.mul(D.sigmoid(D.mul(t,r)),t)})},e}(Ar);zM.className="swish";R.serialization.registerClass(zM);var $M=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return R.tidy(function(){return D.mul(t,D.tanh(D.softplus(t)))})},e}(Ar);$M.className="mish";R.serialization.registerClass($M);function Wo(n){return n.getClassName()}function Iy(n,e){return e===void 0&&(e={}),Af(n,R.serialization.SerializationMap.getMap().classNameMap,e,"activation")}function Vo(n){if(n==null){var e={};return e.className="linear",e.config={},Iy(e)}if(typeof n=="string"){var e={};return e.className=n,e.config={},Iy(e)}else return n instanceof Ar?n:Iy(n)}function Bb(n){if(n!=null&&typeof n!="object")throw new Error("Argument to L1L2 regularizer's constructor is expected to be an "+"object, but received: ".concat(n))}var qM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e}(R.serialization.Serializable),Mf=function(n){se(e,n);function e(t){var r=n.call(this)||this;return Bb(t),r.l1=t==null||t.l1==null?.01:t.l1,r.l2=t==null||t.l2==null?.01:t.l2,r.hasL1=r.l1!==0,r.hasL2=r.l2!==0,r}return e.prototype.apply=function(t){var r=this;return R.tidy(function(){var a=R.zeros([1]);return r.hasL1&&(a=R.add(a,R.sum(D.mul(r.l1,R.abs(t))))),r.hasL2&&(a=R.add(a,R.sum(D.mul(r.l2,_f(t))))),D.reshape(a,[])})},e.prototype.getConfig=function(){return{l1:this.l1,l2:this.l2}},e.fromConfig=function(t,r){return new t({l1:r.l1,l2:r.l2})},e}(qM);Mf.className="L1L2";R.serialization.registerClass(Mf);function rbe(n){return Bb(n),new Mf({l1:n!=null?n.l1:null,l2:0})}function abe(n){return Bb(n),new Mf({l2:n!=null?n.l2:null,l1:0})}var DO={l1l2:"L1L2"};function zt(n){return Ky(n)}function _O(n,e){return e===void 0&&(e={}),Af(n,R.serialization.SerializationMap.getMap().classNameMap,e,"regularizer")}function ln(n){if(n==null)return null;if(typeof n=="string"){var e=n in DO?DO[n]:n,t={className:e,config:{}};return _O(t)}else return n instanceof qM?n:_O(n)}var Lb=function(n){se(e,n);function e(t){var r=n.call(this,t??{})||this;return r.supportsMasking=!0,t!=null&&(r.maxValue=t.maxValue),r}return e.prototype.call=function(t,r){t=it(t);var a=R.relu(t);return this.maxValue!=null&&(a=R.clipByValue(a,0,this.maxValue)),a},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={maxValue:this.maxValue},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);Lb.className="ReLU";R.serialization.registerClass(Lb);var zb=function(n){se(e,n);function e(t){var r=n.call(this,t??{})||this;return r.DEFAULT_ALPHA=.3,t==null&&(t={}),r.alpha=t.alpha==null?r.DEFAULT_ALPHA:t.alpha,r}return e.prototype.call=function(t,r){var a=it(t);return R.leakyRelu(a,this.alpha)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={alpha:this.alpha},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);zb.className="LeakyReLU";R.serialization.registerClass(zb);var $b=function(n){se(e,n);function e(t){var r=n.call(this,t??{})||this;if(r.DEFAULT_ALPHA_INITIALIZER="zeros",t==null&&(t={}),r.supportsMasking=!0,r.alphaInitializer=cn(t.alphaInitializer||r.DEFAULT_ALPHA_INITIALIZER),r.alphaRegularizer=ln(t.alphaRegularizer),r.alphaConstraint=Vn(t.alphaConstraint),t.sharedAxes==null)r.sharedAxes=null;else if(Array.isArray(t.sharedAxes))r.sharedAxes=t.sharedAxes;else if(typeof t.sharedAxes=="number")r.sharedAxes=[t.sharedAxes];else throw new J("Expected sharedAxes to be a number or an array of numbers, "+"but got ".concat(t.sharedAxes));return r}return e.prototype.build=function(t){var r,a;t=It(t);var i=t.slice(1);if(this.sharedAxes!=null)try{for(var o=fe(this.sharedAxes),s=o.next();!s.done;s=o.next()){var u=s.value;i[u-1]=1}}catch(l){r={error:l}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}this.alpha=this.addWeight("alpha",i,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var c={};if(this.sharedAxes!=null)for(var u=1;u<t.length;++u)c[u]=t[u];this.inputSpec=[new Ln({ndim:t.length,axes:c})],this.built=!0},e.prototype.call=function(t,r){return t=it(t),R.prelu(t,this.alpha.read())},e.prototype.getConfig=function(){var t={alphaInitializer:mn(this.alphaInitializer),alphaRegularizer:zt(this.alphaRegularizer),alphaConstraint:Wn(this.alphaConstraint),sharedAxes:this.sharedAxes},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);$b.className="PReLU";R.serialization.registerClass($b);var qb=function(n){se(e,n);function e(t){var r=n.call(this,t??{})||this;if(r.DEFAULT_ALPHA=1,t==null&&(t={}),t.alpha!=null&&t.alpha!==r.DEFAULT_ALPHA)throw new pt("Non-default alpha value (".concat(t.alpha,") is not supported by the ")+"ELU layer yet.");return r.alpha=t.alpha==null?r.DEFAULT_ALPHA:t.alpha,r}return e.prototype.call=function(t,r){var a=it(t);return R.elu(a)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={alpha:this.alpha},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);qb.className="ELU";R.serialization.registerClass(qb);var Wb=function(n){se(e,n);function e(t){var r=n.call(this,t??{})||this;return r.DEFAULT_THETA=1,t==null&&(t={}),r.theta=t.theta==null?r.DEFAULT_THETA:t.theta,r}return e.prototype.call=function(t,r){var a=it(t);return R.mul(a,R.cast(R.greater(a,this.theta),"float32"))},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={theta:this.theta},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);Wb.className="ThresholdedReLU";R.serialization.registerClass(Wb);var Vb=function(n){se(e,n);function e(t){var r=n.call(this,t??{})||this;return r.DEFAULT_AXIS=1,t==null&&(t={}),r.softmax=new Mb().apply,r.axis=t.axis==null?r.DEFAULT_AXIS:t.axis,r}return e.prototype.call=function(t,r){var a=it(t);return this.softmax(a,this.axis)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={axis:this.axis},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);Vb.className="Softmax";R.serialization.registerClass(Vb);function lc(n,e,t){if(typeof n=="number")return Ps(n,e);if(n.length!==e)throw new J("The ".concat(t," argument must be an integer or tuple of ").concat(e," integers.")+" Received: ".concat(n.length," elements."));for(var r=0;r<e;++r){var a=n[r];if(!bfe(a))throw new J("The ".concat(t," argument must be an integer or tuple of ").concat(e)+" integers. Received: ".concat(JSON.stringify(n)," including a")+" non-integer number ".concat(a))}return n}function ci(n,e,t,r,a){if(a===void 0&&(a=1),n==null)return n;var i=e+(e-1)*(a-1),o;return t==="same"?o=n:o=n-i+1,Math.floor((o+r-1)/r)}function Di(n,e,t,r){if(n==null)return null;if(r==="valid")n=n*e+qo([t-e,0]);else if(r==="same")n=n*e;else throw new J("Unsupport padding mode: ".concat(r,"."));return n}function Gb(n,e){return R.tidy(function(){return _n(e),e==="channelsFirst"?D.transpose(n,[0,2,3,1]):n})}function WM(n,e){return R.tidy(function(){return _n(e),e==="channelsFirst"?D.transpose(n,[0,2,3,4,1]):n})}function ibe(n,e,t,r,a,i,o){return r===void 0&&(r=1),a===void 0&&(a="valid"),o===void 0&&(o=1),R.tidy(function(){if(i==null&&(i=fi()),_n(i),n.shape.length!==3)throw new J("The input of a conv1dWithBias operation should be 3, but is "+"".concat(n.shape.length," instead."));if(e.shape.length!==3)throw new J("The kernel for a conv1dWithBias operation should be 3, but is "+"".concat(e.shape.length," instead"));if(t!=null&&t.shape.length!==1)throw new J("The bias for a conv1dWithBias operation should be 1, but is "+"".concat(e.shape.length," instead"));if(i==="channelsFirst"&&(n=D.transpose(n,[0,2,1])),a==="causal")throw new pt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=D.conv1d(n,e,r,a==="same"?"same":"valid","NWC",o);return t!=null&&(s=pi(s,t)),s})}function FO(n,e,t,r,a,i,o,s){return r===void 0&&(r=[1,1]),a===void 0&&(a="valid"),s===void 0&&(s=null),R.tidy(function(){if(i==null&&(i=fi()),_n(i),n.rank!==3&&n.rank!==4)throw new J("conv2dWithBiasActivation expects input to be of rank 3 or 4, "+"but received ".concat(n.rank,"."));if(e.rank!==3&&e.rank!==4)throw new J("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, "+"but received ".concat(n.rank,"."));var u=Gb(n,i);if(a==="causal")throw new pt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=D.fused.conv2d({x:u,filter:e,strides:r,pad:a==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:t,activation:s}),i==="channelsFirst"&&(u=D.transpose(u,[0,3,1,2])),u})}function obe(n,e,t,r,a,i,o){return r===void 0&&(r=[1,1,1]),a===void 0&&(a="valid"),R.tidy(function(){if(i==null&&(i=fi()),_n(i),n.rank!==4&&n.rank!==5)throw new J("conv3dWithBias expects input to be of rank 4 or 5, but received "+"".concat(n.rank,"."));if(e.rank!==4&&e.rank!==5)throw new J("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+"".concat(n.rank,"."));var s=WM(n,i);if(a==="causal")throw new pt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=D.conv3d(s,e,r,a==="same"?"same":"valid","NDHWC",o),t!=null&&(s=pi(s,t)),i==="channelsFirst"&&(s=D.transpose(s,[0,4,1,2,3])),s})}var VM=function(n){se(e,n);function e(t,r){var a=n.call(this,r)||this;if(a.bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",e.verifyArgs(r),a.rank=t,Kn(a.rank,"rank"),a.rank!==1&&a.rank!==2&&a.rank!==3)throw new pt("Convolution layer for rank other than 1, 2, or 3 (".concat(a.rank,") is ")+"not implemented yet.");if(a.kernelSize=lc(r.kernelSize,t,"kernelSize"),a.strides=lc(r.strides==null?1:r.strides,t,"strides"),a.padding=r.padding==null?"valid":r.padding,pa(a.padding),a.dataFormat=r.dataFormat==null?"channelsLast":r.dataFormat,_n(a.dataFormat),a.activation=Vo(r.activation),a.useBias=r.useBias==null?!0:r.useBias,a.biasInitializer=cn(r.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=Vn(r.biasConstraint),a.biasRegularizer=ln(r.biasRegularizer),a.activityRegularizer=ln(r.activityRegularizer),a.dilationRate=lc(r.dilationRate==null?1:r.dilationRate,t,"dilationRate"),a.rank===1&&Array.isArray(a.dilationRate)&&a.dilationRate.length!==1)throw new J("dilationRate must be a number or an array of a single number for 1D convolution, but received "+"".concat(JSON.stringify(a.dilationRate)));if(a.rank===2){if(typeof a.dilationRate=="number")a.dilationRate=[a.dilationRate,a.dilationRate];else if(a.dilationRate.length!==2)throw new J("dilationRate must be a number or array of two numbers for 2D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)))}else if(a.rank===3){if(typeof a.dilationRate=="number")a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(a.dilationRate.length!==3)throw new J("dilationRate must be a number or array of three numbers for 3D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)))}return a}return e.verifyArgs=function(t){if(Ai("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!jy(t.kernelSize,"number",1,3))throw new J("BaseConv expects config.kernelSize to be number or number[] with "+"length 1, 2, or 3, but received ".concat(JSON.stringify(t.kernelSize),"."))},e.prototype.getConfig=function(){var t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Wo(this.activation),useBias:this.useBias,biasInitializer:mn(this.biasInitializer),biasRegularizer:zt(this.biasRegularizer),activityRegularizer:zt(this.activityRegularizer),biasConstraint:Wn(this.biasConstraint)},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt),sv=function(n){se(e,n);function e(t,r){var a=n.call(this,t,r)||this;return a.kernel=null,e.verifyArgs(r),a.filters=r.filters,Kn(a.filters,"filters"),a.kernelInitializer=cn(r.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=Vn(r.kernelConstraint),a.kernelRegularizer=ln(r.kernelRegularizer),a}return e.prototype.build=function(t){var r;t=It(t);var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new J("The channel dimension of the input should be defined. "+"Found ".concat(t[a]));var i=t[a],o=this.kernelSize.concat([i,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(r={},r[a]=i,r)}],this.built=!0},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){t=it(t);var i,o=a.bias==null?null:a.bias.read(),s=BO(a.activation.getClassName());if(s!=null&&a.rank===2)i=FO(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate,s);else{if(a.rank===1)i=ibe(t,a.kernel.read(),o,a.strides[0],a.padding,a.dataFormat,a.dilationRate[0]);else if(a.rank===2)i=FO(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate);else if(a.rank===3)i=obe(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate);else throw new pt("convolutions greater than 3D are not implemented yet.");a.activation!=null&&(i=a.activation.apply(i))}return i})},e.prototype.computeOutputShape=function(t){t=It(t);for(var r=[],a=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2),i=0;i<a.length;++i){var o=ci(a[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);r.push(o)}var s=[t[0]];return this.dataFormat==="channelsLast"?(s=s.concat(r),s.push(this.filters)):(s.push(this.filters),s=s.concat(r)),s},e.prototype.getConfig=function(){var t={filters:this.filters,kernelInitializer:mn(this.kernelInitializer),kernelRegularizer:zt(this.kernelRegularizer),kernelConstraint:Wn(this.kernelConstraint)},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e.verifyArgs=function(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new J("Convolution layer expected config.filters to be a 'number' > 0 "+"but got ".concat(JSON.stringify(t.filters)))},e}(VM),uv=function(n){se(e,n);function e(t){var r=n.call(this,2,t)||this;return e.verifyArgs(t),r}return e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this);return delete t.rank,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!jy(t.kernelSize,"number",1,2))throw new J("Conv2D expects config.kernelSize to be number or number[] with "+"length 1 or 2, but received ".concat(JSON.stringify(t.kernelSize),"."))},e}(sv);uv.className="Conv2D";R.serialization.registerClass(uv);var cv=function(n){se(e,n);function e(t){var r=n.call(this,3,t)||this;return e.verifyArgs(t),r}return e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this);return delete t.rank,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!(Array.isArray(t.kernelSize)&&(t.kernelSize.length===1||t.kernelSize.length===3)))throw new J("Conv3D expects config.kernelSize to be number or"+" [number, number, number], but received ".concat(JSON.stringify(t.kernelSize),"."))},e}(sv);cv.className="Conv3D";R.serialization.registerClass(cv);var Ub=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;if(r.inputSpec=[new Ln({ndim:4})],r.padding!=="same"&&r.padding!=="valid")throw new J("Conv2DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(r.padding));return r}return e.prototype.build=function(t){var r;if(t=It(t),t.length!==4)throw new J("Input should have rank 4; Received input shape: "+JSON.stringify(t));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new J("The channel dimension of the inputs should be defined. Found `None`.");var i=t[a],o=this.kernelSize.concat([this.filters,i]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Ln({ndim:4,axes:(r={},r[a]=i,r)})],this.built=!0},e.prototype.call=function(t,r){var a=this;return D.tidy(function(){var i=it(t);if(i.shape.length!==4)throw new J("Conv2DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(i.shape.length));var o=i.shape,s=o[0],u,c;a.dataFormat==="channelsFirst"?(u=2,c=3):(u=1,c=2);var l=o[u],f=o[c],h=a.kernelSize[0],d=a.kernelSize[1],p=a.strides[0],v=a.strides[1],m=Di(l,p,h,a.padding),g=Di(f,v,d,a.padding),y=[s,m,g,a.filters];a.dataFormat!=="channelsLast"&&(i=D.transpose(i,[0,2,3,1]));var b=D.conv2dTranspose(i,a.kernel.read(),y,a.strides,a.padding);return a.dataFormat!=="channelsLast"&&(b=D.transpose(b,[0,3,1,2])),a.bias!=null&&(b=pi(b,a.bias.read(),a.dataFormat)),a.activation!=null&&(b=a.activation.apply(b)),b})},e.prototype.computeOutputShape=function(t){t=It(t);var r=t.slice(),a,i,o;this.dataFormat==="channelsFirst"?(a=1,i=2,o=3):(a=3,i=1,o=2);var s=this.kernelSize[0],u=this.kernelSize[1],c=this.strides[0],l=this.strides[1];return r[a]=this.filters,r[i]=Di(r[i],c,s,this.padding),r[o]=Di(r[o],l,u,this.padding),r},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this);return delete t.dilationRate,t},e}(uv);Ub.className="Conv2DTranspose";R.serialization.registerClass(Ub);var Hb=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;if(r.inputSpec=[new Ln({ndim:5})],r.padding!=="same"&&r.padding!=="valid")throw new J("Conv3DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(r.padding));return r}return e.prototype.build=function(t){var r;if(t=It(t),t.length!==5)throw new J("Input should have rank 5; Received input shape: "+JSON.stringify(t));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new J("The channel dimension of the inputs should be defined. Found `None`.");var i=t[a],o=this.kernelSize.concat([this.filters,i]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Ln({ndim:5,axes:(r={},r[a]=i,r)})],this.built=!0},e.prototype.call=function(t,r){var a=this;return D.tidy(function(){var i=it(t);if(i.shape.length!==5)throw new J("Conv3DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(i.shape.length));var o=i.shape,s=o[0],u,c,l;a.dataFormat==="channelsFirst"?(l=2,u=3,c=4):(l=1,u=2,c=3);var f=o[l],h=o[u],d=o[c],p=a.kernelSize[0],v=a.kernelSize[1],m=a.kernelSize[2],g=a.strides[0],y=a.strides[1],b=a.strides[2],w=Di(f,g,p,a.padding),x=Di(h,y,v,a.padding),N=Di(d,b,m,a.padding),T=[s,w,x,N,a.filters];a.dataFormat!=="channelsLast"&&(i=D.transpose(i,[0,2,3,4,1]));var E=D.conv3dTranspose(i,a.kernel.read(),T,a.strides,a.padding);return a.dataFormat!=="channelsLast"&&(E=D.transpose(E,[0,4,1,2,3])),a.bias!==null&&(E=pi(E,a.bias.read(),a.dataFormat)),a.activation!==null&&(E=a.activation.apply(E)),E})},e.prototype.computeOutputShape=function(t){t=It(t);var r=t.slice(),a,i,o,s;this.dataFormat==="channelsFirst"?(a=1,i=2,o=3,s=4):(a=4,i=1,o=2,s=3);var u=this.kernelSize[0],c=this.kernelSize[1],l=this.kernelSize[2],f=this.strides[0],h=this.strides[1],d=this.strides[2];return r[a]=this.filters,r[i]=Di(r[i],f,u,this.padding),r[o]=Di(r[o],h,c,this.padding),r[s]=Di(r[s],d,l,this.padding),r},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this);return delete t.dilationRate,t},e}(cv);Hb.className="Conv3DTranspose";R.serialization.registerClass(Hb);var GM=function(n){se(e,n);function e(t,r){var a=n.call(this,t,r)||this;if(a.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,r.filters==null)throw new J("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(r.kernelInitializer!=null||r.kernelRegularizer!=null||r.kernelConstraint!=null)throw new J("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(r.padding!=null&&r.padding!=="same"&&r.padding!=="valid")throw new J("SeparableConv".concat(a.rank,"D supports only padding modes: ")+"'same' and 'valid', but received ".concat(JSON.stringify(r.padding)));return a.depthMultiplier=r.depthMultiplier==null?1:r.depthMultiplier,a.depthwiseInitializer=cn(r.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=ln(r.depthwiseRegularizer),a.depthwiseConstraint=Vn(r.depthwiseConstraint),a.pointwiseInitializer=cn(r.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=ln(r.pointwiseRegularizer),a.pointwiseConstraint=Vn(r.pointwiseConstraint),a}return e.prototype.build=function(t){var r;if(t=It(t),t.length<this.rank+2)throw new J("Inputs to SeparableConv".concat(this.rank,"D should have rank ")+"".concat(this.rank+2,", but received input shape: ")+"".concat(JSON.stringify(t)));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null||t[a]<0)throw new J("The channel dimension of the inputs should be defined, "+"but found ".concat(JSON.stringify(t[a])));for(var i=t[a],o=this.kernelSize.concat([i,this.depthMultiplier]),s=[],u=0;u<this.rank;++u)s.push(1);s.push(i*this.depthMultiplier,this.filters);var c=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",o,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,c,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",s,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,c,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,c,this.biasConstraint):this.bias=null,this.inputSpec=[new Ln({ndim:this.rank+2,axes:(r={},r[a]=i,r)})],this.built=!0},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){t=it(t);var i;if(a.rank===1)throw new pt("1D separable convolution is not implemented yet.");return a.rank===2&&(a.dataFormat==="channelsFirst"&&(t=D.transpose(t,[0,2,3,1])),i=D.separableConv2d(t,a.depthwiseKernel.read(),a.pointwiseKernel.read(),a.strides,a.padding,a.dilationRate,"NHWC")),a.useBias&&(i=pi(i,a.bias.read(),a.dataFormat)),a.activation!=null&&(i=a.activation.apply(i)),a.dataFormat==="channelsFirst"&&(i=D.transpose(i,[0,3,1,2])),i})},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this);return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=mn(this.depthwiseInitializer),t.pointwiseInitializer=mn(this.pointwiseInitializer),t.depthwiseRegularizer=zt(this.depthwiseRegularizer),t.pointwiseRegularizer=zt(this.pointwiseRegularizer),t.depthwiseConstraint=Wn(this.depthwiseConstraint),t.pointwiseConstraint=Wn(this.pointwiseConstraint),t},e}(sv);GM.className="SeparableConv";var Kb=function(n){se(e,n);function e(t){return n.call(this,2,t)||this}return e}(GM);Kb.className="SeparableConv2D";R.serialization.registerClass(Kb);var jb=function(n){se(e,n);function e(t){var r=n.call(this,1,t)||this;return e.verifyArgs(t),r.inputSpec=[{ndim:3}],r}return e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this);return delete t.rank,delete t.dataFormat,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!jy(t.kernelSize,"number",1,1))throw new J("Conv1D expects config.kernelSize to be number or number[] with "+"length 1, but received ".concat(JSON.stringify(t.kernelSize),"."))},e}(sv);jb.className="Conv1D";R.serialization.registerClass(jb);var Xb=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return typeof t.cropping=="number"?r.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:typeof t.cropping[0]=="number"?r.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:r.cropping=t.cropping,r.dataFormat=t.dataFormat===void 0?"channelsLast":t.dataFormat,r.inputSpec=[{ndim:4}],r}return e.prototype.computeOutputShape=function(t){return this.dataFormat==="channelsFirst"?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){if(t=it(t),a.dataFormat==="channelsLast"){var i=wp(t,a.cropping[0][0],t.shape[1]-a.cropping[0][0]-a.cropping[0][1],2);return wp(i,a.cropping[1][0],t.shape[2]-a.cropping[1][1]-a.cropping[1][0],3)}else{var i=wp(t,a.cropping[0][0],t.shape[2]-a.cropping[0][0]-a.cropping[0][1],3);return wp(i,a.cropping[1][0],t.shape[3]-a.cropping[1][1]-a.cropping[1][0],4)}})},e.prototype.getConfig=function(){var t={cropping:this.cropping,dataFormat:this.dataFormat},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);Xb.className="Cropping2D";R.serialization.registerClass(Xb);var Yb=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.DEFAULT_SIZE=[2,2],r.inputSpec=[{ndim:4}],r.size=t.size==null?r.DEFAULT_SIZE:t.size,r.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,_n(r.dataFormat),r.interpolation=t.interpolation==null?"nearest":t.interpolation,mfe(r.interpolation),r}return e.prototype.computeOutputShape=function(t){if(this.dataFormat==="channelsFirst"){var r=t[2]==null?null:this.size[0]*t[2],a=t[3]==null?null:this.size[1]*t[3];return[t[0],t[1],r,a]}else{var r=t[1]==null?null:this.size[0]*t[1],a=t[2]==null?null:this.size[1]*t[2];return[t[0],r,a,t[3]]}},e.prototype.call=function(t,r){var a=this;return D.tidy(function(){var i=it(t),o=i.shape;if(a.dataFormat==="channelsFirst"){i=D.transpose(i,[0,2,3,1]);var s=a.size[0]*o[2],u=a.size[1]*o[3],c=a.interpolation==="nearest"?D.image.resizeNearestNeighbor(i,[s,u]):D.image.resizeBilinear(i,[s,u]);return D.transpose(c,[0,3,1,2])}else{var s=a.size[0]*o[1],u=a.size[1]*o[2];return a.interpolation==="nearest"?D.image.resizeNearestNeighbor(i,[s,u]):D.image.resizeBilinear(i,[s,u])}})},e.prototype.getConfig=function(){var t={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);Yb.className="UpSampling2D";R.serialization.registerClass(Yb);function sbe(n,e,t,r,a,i){return t===void 0&&(t=[1,1]),r===void 0&&(r="valid"),R.tidy(function(){a==null&&(a=fi()),_n(a);var o=Gb(n,a);if(n.rank!==4)throw new J("Input for depthwiseConv2d is required to be 4-D, but is instead "+"".concat(n.rank,"-D"));if(e.rank!==4)throw new J("depthwiseKernel is required to be 4-D, but is instead "+"".concat(e.rank,"-D"));return o=D.depthwiseConv2d(o,e,t,r==="same"?"same":"valid","NHWC",i),a==="channelsFirst"&&(o=D.transpose(o,[0,3,1,2])),o})}var Zb=function(n){se(e,n);function e(t){var r=n.call(this,2,t)||this;return r.depthwiseKernel=null,r.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,r.depthwiseInitializer=cn(t.depthwiseInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.depthwiseConstraint=Vn(t.depthwiseConstraint),r.depthwiseRegularizer=ln(t.depthwiseRegularizer),r}return e.prototype.build=function(t){if(t=It(t),t.length<4)throw new J("Inputs to DepthwiseConv2D should have rank 4. "+"Received input shape: ".concat(JSON.stringify(t),"."));var r=this.dataFormat==="channelsFirst"?1:3;if(t[r]==null||t[r]<0)throw new J("The channel dimension of the inputs to DepthwiseConv2D should "+"be defined, but is not (".concat(t[r],")."));var a=t[r],i=[this.kernelSize[0],this.kernelSize[1],a,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[a*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){t=it(t);var i=sbe(t,a.depthwiseKernel.read(),a.strides,a.padding,a.dataFormat,null);return a.useBias&&(i=pi(i,a.bias.read(),a.dataFormat)),a.activation!=null&&(i=a.activation.apply(i)),i})},e.prototype.computeOutputShape=function(t){t=It(t);var r=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,o=ci(r,this.kernelSize[0],this.padding,this.strides[0]),s=ci(a,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[t[0],i,o,s]:[t[0],o,s,i]},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this);return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=mn(this.depthwiseInitializer),t.depthwiseRegularizer=zt(this.depthwiseRegularizer),t.depthwiseConstraint=Wn(this.depthwiseRegularizer),t},e}(VM);Zb.className="DepthwiseConv2D";R.serialization.registerClass(Zb);function UM(n,e,t,r){if(Array.isArray(n)){if(e!=null||t!=null)throw new J("When inputs is an array, neither initialState or constants should be provided");r!=null&&(t=n.slice(n.length-r,n.length),n=n.slice(0,n.length-r)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function a(i){return i==null||Array.isArray(i)?i:[i]}return e=a(e),t=a(t),{inputs:n,initialState:e,constants:t}}function HM(n,e,t,r,a,i,o,s){return r===void 0&&(r=!1),o===void 0&&(o=!1),s===void 0&&(s=!1),D.tidy(function(){var u=e.shape.length;if(u<3)throw new J("Input should be at least 3D, but is ".concat(u,"D."));var c=[1,0].concat(li(2,u));if(e=D.transpose(e,c),i!=null)throw new pt("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),a!=null&&(a=D.cast(D.cast(a,"bool"),"float32"),a.rank===u-1&&(a=D.expandDims(a,-1)),a=D.transpose(a,c)),r&&(e=D.reverse(e,0),a!=null&&(a=D.reverse(a,0)));var l=[],f,h=t,d=e.shape[0],p=D.unstack(e),v;a!=null&&(v=D.unstack(a));for(var m=function(w){var x=p[w],N=D.tidy(function(){return n(x,h)});if(a==null)f=N[0],h=N[1];else{var T=D.tidy(function(){var E=v[w],C=D.sub(D.onesLike(E),E),F=D.add(D.mul(N[0],E),D.mul(h[0],C)),_=h.map(function(O,L){return D.add(D.mul(N[1][L],E),D.mul(O,C))});return{output:F,newStates:_}});f=T.output,h=T.newStates}s&&l.push(f)},g=0;g<d;++g)m(g);var y;if(s){var b=1;y=D.stack(l,b)}return[f,y,h]})}var no=function(n){se(e,n);function e(t){var r=n.call(this,t)||this,a;if(t.cell==null)throw new J("cell property is missing for the constructor of RNN.");if(Array.isArray(t.cell)?a=new hv({cells:t.cell}):a=t.cell,a.stateSize==null)throw new J("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=a,r.returnSequences=t.returnSequences==null?!1:t.returnSequences,r.returnState=t.returnState==null?!1:t.returnState,r.goBackwards=t.goBackwards==null?!1:t.goBackwards,r._stateful=t.stateful==null?!1:t.stateful,r.unroll=t.unroll==null?!1:t.unroll,r.supportsMasking=!0,r.inputSpec=[new Ln({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],r}return e.prototype.getStates=function(){if(this.states_==null){var t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return li(0,t).map(function(r){return null})}else return this.states_},e.prototype.setStates=function(t){this.states_=t},e.prototype.computeOutputShape=function(t){var r,a;Fy(t)&&(t=t[0]),t=t;var i=this.cell.stateSize;Array.isArray(i)||(i=[i]);var o=i[0],s;if(this.returnSequences?s=[t[0],t[1],o]:s=[t[0],o],this.returnState){var u=[];try{for(var c=fe(i),l=c.next();!l.done;l=c.next()){var f=l.value;u.push([t[0],f])}}catch(h){r={error:h}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(r)throw r.error}}return[s].concat(u)}else return s},e.prototype.computeMask=function(t,r){var a=this;return D.tidy(function(){Array.isArray(r)&&(r=r[0]);var i=a.returnSequences?r:null;if(a.returnState){var o=a.states.map(function(s){return null});return[i].concat(o)}else return i})},Object.defineProperty(e.prototype,"states",{get:function(){if(this.states_==null){for(var t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,r=[],a=0;a<t;++a)r.push(null);return r}else return this.states_},set:function(t){this.states_=t},enumerable:!1,configurable:!0}),e.prototype.build=function(t){if(this.numConstants!=null)throw new pt("Constants support is not implemented in RNN yet.");Fy(t)&&(t=t[0]),t=t;var r=this.stateful?t[0]:null,a=t.slice(2);this.inputSpec[0]=new Ln({shape:Qe([r,null],te(a),!1)});var i=[t[0]].concat(t.slice(2));this.cell.build(i);var o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!R.util.arraysEqual(this.stateSpec.map(function(s){return s.shape[s.shape.length-1]}),o))throw new J("An initialState was passed that is not compatible with "+"cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; ")+"However cell.stateSize is ".concat(this.cell.stateSize))}else this.stateSpec=o.map(function(s){return new Ln({shape:[null,s]})});this.stateful&&this.resetStates()},e.prototype.resetStates=function(t,r){var a=this;r===void 0&&(r=!1),R.tidy(function(){if(!a.stateful)throw new Lo("Cannot call resetStates() on an RNN Layer that is not stateful.");var i=a.inputSpec[0].shape[0];if(i==null)throw new J("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(a.states_==null)Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(l){return D.zeros([i,l])}):a.states_=[D.zeros([i,a.cell.stateSize])];else if(t==null)D.dispose(a.states_),a.keptStates!=null&&(D.dispose(a.keptStates),a.keptStates=[]),Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(l){return D.zeros([i,l])}):a.states_[0]=D.zeros([i,a.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==a.states_.length)throw new J("Layer ".concat(a.name," expects ").concat(a.states_.length," state(s), ")+"but it received ".concat(t.length," state value(s). Input ")+"received: ".concat(t));r===!0?a.keptStates.push(a.states_.slice()):D.dispose(a.states_);for(var o=0;o<a.states_.length;++o){var s=t[o],u=Array.isArray(a.cell.stateSize)?a.cell.stateSize[o]:a.cell.stateSize,c=[i,u];if(!R.util.arraysEqual(s.shape,c))throw new J("State ".concat(o," is incompatible with layer ").concat(a.name,": ")+"expected shape=".concat(c,", received shape=").concat(s.shape));a.states_[o]=s}}a.states_=a.states_.map(function(l){return D.keep(l.clone())})})},e.prototype.apply=function(t,r){var a,i,o=r==null?null:r.initialState,s=r==null?null:r.constants;r==null&&(r={});var u=UM(t,o,s,this.numConstants);t=u.inputs,o=u.initialState,s=u.constants;var c=[],l=[];if(o!=null){r.initialState=o,c=c.concat(o),this.stateSpec=[];try{for(var f=fe(o),h=f.next();!h.done;h=f.next()){var d=h.value;this.stateSpec.push(new Ln({shape:d.shape}))}}catch(b){a={error:b}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}l=l.concat(this.stateSpec)}s!=null&&(r.constants=s,c=c.concat(s),this.numConstants=s.length);var p=c[0]instanceof si;if(p){var v=[t].concat(c),m=this.inputSpec.concat(l),g=this.inputSpec;this.inputSpec=m;var y=n.prototype.apply.call(this,v,r);return this.inputSpec=g,y}else return n.prototype.apply.call(this,t,r)},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i=r==null?null:r.mask,o=r==null?null:r.training,s=r==null?null:r.initialState;t=it(t),s==null&&(a.stateful?s=a.states_:s=a.getInitialState(t));var u=Array.isArray(a.cell.stateSize)?a.cell.stateSize.length:1;if(s.length!==u)throw new J("RNN Layer has ".concat(u," state(s) but was passed ")+"".concat(s.length," initial state(s)."));a.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var c={training:o},l=function(m,g){var y=a.cell.call([m].concat(g),c);return[y[0],y.slice(1)]},f=HM(l,t,s,a.goBackwards,i,null,a.unroll,a.returnSequences),h=f[0],d=f[1],p=f[2];a.stateful&&a.resetStates(p,o);var v=a.returnSequences?d:h;return a.returnState?[v].concat(p):v})},e.prototype.getInitialState=function(t){var r=this;return R.tidy(function(){var a=D.zeros(t.shape);return a=D.sum(a,[1,2]),a=Df(a),Array.isArray(r.cell.stateSize)?r.cell.stateSize.map(function(i){return i>1?Dy(a,[1,i]):a}):r.cell.stateSize>1?[Dy(a,[1,r.cell.stateSize])]:[a]})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!1,configurable:!0}),e.prototype.setFastWeightInitDuringBuild=function(t){n.prototype.setFastWeightInitDuringBuild.call(this,t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(r.numConstants=this.numConstants);var a=this.cell.getConfig();return this.getClassName()===e.className&&(r.cell={className:this.cell.getClassName(),config:a}),Object.assign(Object.assign(Object.assign({},a),t),r)},e.fromConfig=function(t,r,a){a===void 0&&(a={});var i=r.cell,o=ui(i,a);return new t(Object.assign(r,{cell:o}))},e}(gt);no.className="RNN";R.serialization.registerClass(no);var yc=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e}(gt),lv=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.DEFAULT_ACTIVATION="tanh",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=t.units,Kn(r.units,"units"),r.activation=Vo(t.activation==null?r.DEFAULT_ACTIVATION:t.activation),r.useBias=t.useBias==null?!0:t.useBias,r.kernelInitializer=cn(t.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=cn(t.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=cn(t.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=ln(t.kernelRegularizer),r.recurrentRegularizer=ln(t.recurrentRegularizer),r.biasRegularizer=ln(t.biasRegularizer),r.kernelConstraint=Vn(t.kernelConstraint),r.recurrentConstraint=Vn(t.recurrentConstraint),r.biasConstraint=Vn(t.biasConstraint),r.dropout=fc([1,qo([0,t.dropout==null?0:t.dropout])]),r.recurrentDropout=fc([1,qo([0,t.recurrentDropout==null?0:t.recurrentDropout])]),r.dropoutFunc=t.dropoutFunc,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return e.prototype.build=function(t){t=It(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){if(t=t,t.length!==2)throw new J("SimpleRNNCell expects 2 input Tensors, got ".concat(t.length,"."));var i=t[1];t=t[0];var o=r.training==null?!1:r.training;0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=Go({ones:function(){return D.onesLike(t)},rate:a.dropout,training:o,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=Go({ones:function(){return D.onesLike(i)},rate:a.recurrentDropout,training:o,dropoutFunc:a.dropoutFunc}));var s,u=a.dropoutMask,c=a.recurrentDropoutMask;u!=null?s=Ri(D.mul(t,u),a.kernel.read()):s=Ri(t,a.kernel.read()),a.bias!=null&&(s=pi(s,a.bias.read())),c!=null&&(i=D.mul(i,c));var l=D.add(s,Ri(i,a.recurrentKernel.read()));return a.activation!=null&&(l=a.activation.apply(l)),[l,l]})},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r={units:this.units,activation:Wo(this.activation),useBias:this.useBias,kernelInitializer:mn(this.kernelInitializer),recurrentInitializer:mn(this.recurrentInitializer),biasInitializer:mn(this.biasInitializer),kernelRegularizer:zt(this.kernelRegularizer),recurrentRegularizer:zt(this.recurrentRegularizer),biasRegularizer:zt(this.biasRegularizer),activityRegularizer:zt(this.activityRegularizer),kernelConstraint:Wn(this.kernelConstraint),recurrentConstraint:Wn(this.recurrentConstraint),biasConstraint:Wn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},t),r)},e}(yc);lv.className="SimpleRNNCell";R.serialization.registerClass(lv);var Jb=function(n){se(e,n);function e(t){return t.cell=new lv(t),n.call(this,t)||this}return e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.cell.dropoutMask!=null&&(D.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(D.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=r==null?null:r.mask,o=r==null?null:r.training,s=r==null?null:r.initialState;return n.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,r){return new t(r)},e}(no);Jb.className="SimpleRNN";R.serialization.registerClass(Jb);var fv=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;if(r.DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new J("GRUCell does not support reset_after parameter set to true.");return r.units=t.units,Kn(r.units,"units"),r.activation=Vo(t.activation===void 0?r.DEFAULT_ACTIVATION:t.activation),r.recurrentActivation=Vo(t.recurrentActivation===void 0?r.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),r.useBias=t.useBias==null?!0:t.useBias,r.kernelInitializer=cn(t.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=cn(t.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=cn(t.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=ln(t.kernelRegularizer),r.recurrentRegularizer=ln(t.recurrentRegularizer),r.biasRegularizer=ln(t.biasRegularizer),r.kernelConstraint=Vn(t.kernelConstraint),r.recurrentConstraint=Vn(t.recurrentConstraint),r.biasConstraint=Vn(t.biasConstraint),r.dropout=fc([1,qo([0,t.dropout==null?0:t.dropout])]),r.recurrentDropout=fc([1,qo([0,t.recurrentDropout==null?0:t.recurrentDropout])]),r.dropoutFunc=t.dropoutFunc,r.implementation=t.implementation,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return e.prototype.build=function(t){t=It(t);var r=t[t.length-1];this.kernel=this.addWeight("kernel",[r,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){if(t=t,t.length!==2)throw new J("GRUCell expects 2 input Tensors (inputs, h, c), got "+"".concat(t.length,"."));var i=r.training==null?!1:r.training,o=t[1];t=t[0],0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=Go({ones:function(){return D.onesLike(t)},rate:a.dropout,training:i,count:3,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=Go({ones:function(){return D.onesLike(o)},rate:a.recurrentDropout,training:i,count:3,dropoutFunc:a.dropoutFunc}));var s=a.dropoutMask,u=a.recurrentDropoutMask,c,l,f;0<a.dropout&&a.dropout<1&&(t=D.mul(t,s[0]));var h=Ri(t,a.kernel.read());a.useBias&&(h=pi(h,a.bias.read())),0<a.recurrentDropout&&a.recurrentDropout<1&&(o=D.mul(o,u[0]));var d=a.recurrentKernel.read(),p=te(D.split(d,[2*a.units,a.units],d.rank-1),2),v=p[0],m=p[1],g=Ri(o,v),y=te(D.split(h,3,h.rank-1),3),b=y[0],w=y[1],x=y[2],N=te(D.split(g,2,g.rank-1),2),T=N[0],E=N[1];c=a.recurrentActivation.apply(D.add(b,T)),l=a.recurrentActivation.apply(D.add(w,E));var C=Ri(D.mul(l,o),m);f=a.activation.apply(D.add(x,C));var F=D.add(D.mul(c,o),D.mul(D.add(1,D.neg(c)),f));return[F,F]})},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r={units:this.units,activation:Wo(this.activation),recurrentActivation:Wo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:mn(this.kernelInitializer),recurrentInitializer:mn(this.recurrentInitializer),biasInitializer:mn(this.biasInitializer),kernelRegularizer:zt(this.kernelRegularizer),recurrentRegularizer:zt(this.recurrentRegularizer),biasRegularizer:zt(this.biasRegularizer),activityRegularizer:zt(this.activityRegularizer),kernelConstraint:Wn(this.kernelConstraint),recurrentConstraint:Wn(this.recurrentConstraint),biasConstraint:Wn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},t),r)},e}(yc);fv.className="GRUCell";R.serialization.registerClass(fv);var Qb=function(n){se(e,n);function e(t){return t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new fv(t),n.call(this,t)||this}return e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.cell.dropoutMask!=null&&(D.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(D.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=r==null?null:r.mask,o=r==null?null:r.training,s=r==null?null:r.initialState;return n.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,r){return r.implmentation===0&&(r.implementation=1),new t(r)},e}(no);Qb.className="GRU";R.serialization.registerClass(Qb);var Bf=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=t.units,Kn(r.units,"units"),r.activation=Vo(t.activation===void 0?r.DEFAULT_ACTIVATION:t.activation),r.recurrentActivation=Vo(t.recurrentActivation===void 0?r.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),r.useBias=t.useBias==null?!0:t.useBias,r.kernelInitializer=cn(t.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=cn(t.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=cn(t.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.unitForgetBias=t.unitForgetBias,r.kernelRegularizer=ln(t.kernelRegularizer),r.recurrentRegularizer=ln(t.recurrentRegularizer),r.biasRegularizer=ln(t.biasRegularizer),r.kernelConstraint=Vn(t.kernelConstraint),r.recurrentConstraint=Vn(t.recurrentConstraint),r.biasConstraint=Vn(t.biasConstraint),r.dropout=fc([1,qo([0,t.dropout==null?0:t.dropout])]),r.recurrentDropout=fc([1,qo([0,t.recurrentDropout==null?0:t.recurrentDropout])]),r.dropoutFunc=t.dropoutFunc,r.implementation=t.implementation,r.stateSize=[r.units,r.units],r.dropoutMask=null,r.recurrentDropoutMask=null,r}return e.prototype.build=function(t){var r;t=It(t);var a=t[t.length-1];this.kernel=this.addWeight("kernel",[a,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);var i;if(this.useBias){if(this.unitForgetBias){var o=this.biasInitializer,s=this.units;i=new(r=function(u){se(c,u);function c(){return u!==null&&u.apply(this,arguments)||this}return c.prototype.apply=function(l,f){var h=o.apply([s]),d=new Kp().apply([s]),p=o.apply([s*2]);return BR(BR(h,d),p)},c}(Ba),r.className="CustomInit",r)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i=r.training==null?!1:r.training;if(t=t,t.length!==3)throw new J("LSTMCell expects 3 input Tensors (inputs, h, c), got "+"".concat(t.length,"."));var o=t[1],s=t[2];t=t[0],0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=Go({ones:function(){return D.onesLike(t)},rate:a.dropout,training:i,count:4,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=Go({ones:function(){return D.onesLike(o)},rate:a.recurrentDropout,training:i,count:4,dropoutFunc:a.dropoutFunc}));var u=a.dropoutMask,c=a.recurrentDropoutMask,l,f,h,d;0<a.dropout&&a.dropout<1&&(t=D.mul(t,u[0]));var p=Ri(t,a.kernel.read());0<a.recurrentDropout&&a.recurrentDropout<1&&(o=D.mul(o,c[0])),p=D.add(p,Ri(o,a.recurrentKernel.read())),a.useBias&&(p=pi(p,a.bias.read()));var v=te(D.split(p,4,p.rank-1),4),m=v[0],g=v[1],y=v[2],b=v[3];l=a.recurrentActivation.apply(m),f=a.recurrentActivation.apply(g),h=D.add(D.mul(f,s),D.mul(l,a.activation.apply(y))),d=a.recurrentActivation.apply(b);var w=D.mul(d,a.activation.apply(h));return[w,w,h]})},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r={units:this.units,activation:Wo(this.activation),recurrentActivation:Wo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:mn(this.kernelInitializer),recurrentInitializer:mn(this.recurrentInitializer),biasInitializer:mn(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:zt(this.kernelRegularizer),recurrentRegularizer:zt(this.recurrentRegularizer),biasRegularizer:zt(this.biasRegularizer),activityRegularizer:zt(this.activityRegularizer),kernelConstraint:Wn(this.kernelConstraint),recurrentConstraint:Wn(this.recurrentConstraint),biasConstraint:Wn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},t),r)},e}(yc);Bf.className="LSTMCell";R.serialization.registerClass(Bf);var e1=function(n){se(e,n);function e(t){return t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Bf(t),n.call(this,t)||this}return e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.cell.dropoutMask!=null&&(D.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(D.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=r==null?null:r.mask,o=r==null?null:r.training,s=r==null?null:r.initialState;return n.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,r){return r.implmentation===0&&(r.implementation=1),new t(r)},e}(no);e1.className="LSTM";R.serialization.registerClass(e1);var hv=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.cells=t.cells,r}return Object.defineProperty(e.prototype,"stateSize",{get:function(){var t,r,a=[];try{for(var i=fe(this.cells.slice().reverse()),o=i.next();!o.done;o=i.next()){var s=o.value;Array.isArray(s.stateSize)?a.push.apply(a,Qe([],te(s.stateSize),!1)):a.push(s.stateSize)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return a},enumerable:!1,configurable:!0}),e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i,o,s,u;t=t;var c=t.slice(1),l=[];try{for(var f=fe(a.cells.slice().reverse()),h=f.next();!h.done;h=f.next()){var d=h.value;Array.isArray(d.stateSize)?l.push(c.splice(0,d.stateSize.length)):l.push(c.splice(0,1))}}catch(w){i={error:w}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}l.reverse();for(var p=[],v,m=0;m<a.cells.length;++m){var d=a.cells[m];c=l[m],m===0?v=[t[0]].concat(c):v=[v[0]].concat(c),v=d.call(v,r),p.push(v.slice(1))}c=[];try{for(var g=fe(p.slice().reverse()),y=g.next();!y.done;y=g.next()){var b=y.value;c.push.apply(c,Qe([],te(b),!1))}}catch(w){s={error:w}}finally{try{y&&!y.done&&(u=g.return)&&u.call(g)}finally{if(s)throw s.error}}return[v[0]].concat(c)})},e.prototype.build=function(t){Fy(t)&&(t=t[0]),t=t;var r;this.cells.forEach(function(a,i){Rs("RNNCell_".concat(i),function(){a.build(t),Array.isArray(a.stateSize)?r=a.stateSize[0]:r=a.stateSize,t=[t[0],r]})}),this.built=!0},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r=function(o){return{className:o.getClassName(),config:o.getConfig()}},a=this.cells.map(r),i={cells:a};return Object.assign(Object.assign({},t),i)},e.fromConfig=function(t,r,a){var i,o;a===void 0&&(a={});var s=[];try{for(var u=fe(r.cells),c=u.next();!c.done;c=u.next()){var l=c.value;s.push(ui(l,a))}}catch(f){i={error:f}}finally{try{c&&!c.done&&(o=u.return)&&o.call(u)}finally{if(i)throw i.error}}return new t({cells:s})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){var t,r;if(!this.trainable)return[];var a=[];try{for(var i=fe(this.cells),o=i.next();!o.done;o=i.next()){var s=o.value;a.push.apply(a,Qe([],te(s.trainableWeights),!1))}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return a},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){var t,r,a,i,o=[];try{for(var s=fe(this.cells),u=s.next();!u.done;u=s.next()){var c=u.value;o.push.apply(o,Qe([],te(c.nonTrainableWeights),!1))}}catch(d){t={error:d}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}if(!this.trainable){var l=[];try{for(var f=fe(this.cells),h=f.next();!h.done;h=f.next()){var c=h.value;l.push.apply(l,Qe([],te(c.trainableWeights),!1))}}catch(d){a={error:d}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}return l.concat(o)}return o},enumerable:!1,configurable:!0}),e.prototype.getWeights=function(){var t,r,a=[];try{for(var i=fe(this.cells),o=i.next();!o.done;o=i.next()){var s=o.value;a.push.apply(a,Qe([],te(s.weights),!1))}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return Ry(a)},e.prototype.setWeights=function(t){var r,a,i=[];try{for(var o=fe(this.cells),s=o.next();!s.done;s=o.next())for(var u=s.value,c=u.weights.length,l=t.splice(c),f=0;f<u.weights.length;++f)i.push([u.weights[f],l[f]])}catch(h){r={error:h}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}rb(i)},e}(yc);hv.className="StackedRNNCells";R.serialization.registerClass(hv);function Go(n){var e=n.ones,t=n.rate,r=n.training,a=r===void 0?!1:r,i=n.count,o=i===void 0?1:i,s=n.dropoutFunc,u=function(){return s!=null?s(e(),t):GO(e(),t)},c=function(){return Ff(u,e,a)};if(!o||o<=1)return D.keep(c().clone());var l=Array(o).fill(void 0).map(c);return l.map(function(f){return D.keep(f.clone())})}var ube=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(n);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(n,r[a])&&(t[r[a]]=n[r[a]]);return t};(function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(yc);var KM=function(n){se(e,n);function e(t){var r=this;if(t.unroll)throw new pt("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new pt("It is not possible at the moment to stack convolutional cells.");return r=n.call(this,t)||this,r.inputSpec=[new Ln({ndim:5})],r}return e.prototype.call=function(t,r){var a=this;return D.tidy(function(){if(a.cell.dropoutMask!=null&&(D.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(D.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null),r&&r.constants)throw new J("ConvRNN2D cell does not support constants");var i=r==null?null:r.mask,o=r==null?null:r.training,s=r==null?null:r.initialState;return n.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.prototype.computeOutputShape=function(t){var r=this.computeSingleOutputShape(t);return this.returnSequences||(r=Qe([r[0]],te(r.slice(2)),!1)),this.returnState&&(r=Qe([r],te(Array(2).fill(Qe([t[0]],te(r.slice(-3)),!1))),!1)),r},e.prototype.getInitialState=function(t){var r=this;return D.tidy(function(){var a=r.cell.stateSize,i=t.shape,o=r.computeSingleOutputShape(i),s=Qe([o[0]],te(o.slice(2)),!1),u=D.zeros(s);return Array.isArray(a)?Array(a.length).fill(u):[u]})},e.prototype.resetStates=function(t,r){var a=this;r===void 0&&(r=!1),D.tidy(function(){if(!a.stateful)throw new Lo("Cannot call resetStates() on an RNN Layer that is not stateful.");var i=a.inputSpec[0].shape,o=a.computeSingleOutputShape(i),s=Qe([o[0]],te(o.slice(2)),!1),u=i[0];if(u==null)throw new J("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(a.getStates()==null)Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(){return D.zeros(s)}):a.states_=[D.zeros(s)];else if(t==null)D.dispose(a.states_),a.keptStates!=null&&(D.dispose(a.keptStates),a.keptStates=[]),Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(){return D.zeros(s)}):a.states_[0]=D.zeros(s);else{if(Array.isArray(t)||(t=[t]),t.length!==a.states_.length)throw new J("Layer ".concat(a.name," expects ").concat(a.states_.length," state(s), ")+"but it received ".concat(t.length," state value(s). Input ")+"received: ".concat(t));r?a.keptStates.push(a.states_.slice()):D.dispose(a.states_);for(var c=0;c<a.states_.length;++c){var l=t[c],f=s;if(!R.util.arraysEqual(l.shape,f))throw new J("State ".concat(c," is incompatible with layer ").concat(a.name,": ")+"expected shape=".concat(f,", received shape=").concat(l.shape));a.states_[c]=l}}a.states_=a.states_.map(function(h){return D.keep(h.clone())})})},e.prototype.computeSingleOutputShape=function(t){var r=this.cell,a=r.dataFormat,i=r.filters,o=r.kernelSize,s=r.padding,u=r.strides,c=r.dilationRate,l=a==="channelsFirst",f=t[l?3:2],h=t[l?4:3],d=ci(f,o[0],s,u[0],c[0]),p=ci(h,o[1],s,u[1],c[1]),v=Qe(Qe([],te(t.slice(0,2)),!1),te(l?[i,d,p]:[d,p,i]),!1);return v},e}(no);KM.className="ConvRNN2D";var dv=function(n){se(e,n);function e(t){var r=this,a=t.filters,i=t.kernelSize,o=t.strides,s=t.padding,u=t.dataFormat,c=t.dilationRate;return r=n.call(this,Object.assign(Object.assign({},t),{units:a}))||this,r.filters=a,Kn(r.filters,"filters"),r.kernelSize=lc(i,2,"kernelSize"),r.kernelSize.forEach(function(l){return Kn(l,"kernelSize")}),r.strides=lc(o||1,2,"strides"),r.strides.forEach(function(l){return Kn(l,"strides")}),r.padding=s||"valid",pa(r.padding),r.dataFormat=u||"channelsLast",_n(r.dataFormat),r.dilationRate=lc(c||1,2,"dilationRate"),r.dilationRate.forEach(function(l){return Kn(l,"dilationRate")}),r}return e.prototype.build=function(t){var r;t=It(t);var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new J("The channel dimension of the input should be defined. "+"Found ".concat(t[a]));var i=t[a],o=4,s=this.kernelSize.concat([i,this.filters*o]);this.kernel=this.addWeight("kernel",s,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var u=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",u,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var c=void 0;if(this.unitForgetBias){var l=this.biasInitializer,f=this.filters;c=new(r=function(h){se(d,h);function d(){return h!==null&&h.apply(this,arguments)||this}return d.prototype.apply=function(p,v){var m=l.apply([f]),g=D.ones([f]),y=l.apply([f*2]);return Xy([m,g,y])},d}(Ba),r.className="CustomInit",r)}else c=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,c,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0},e.prototype.call=function(t,r){var a=this;return D.tidy(function(){if(t.length!==3)throw new J("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+"".concat(t.length,"."));var i=r.training||!1,o=t[0],s=t[1],u=t[2],c=4;0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=Go({ones:function(){return D.onesLike(o)},rate:a.dropout,training:i,count:c,dropoutFunc:a.dropoutFunc}));var l=a.dropoutMask,f=function(le,pe,xe){return!pe||!pe[xe]?le:D.mul(pe[xe],le)},h=f(o,l,0),d=f(o,l,1),p=f(o,l,2),v=f(o,l,3);0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=Go({ones:function(){return D.onesLike(s)},rate:a.recurrentDropout,training:i,count:c,dropoutFunc:a.dropoutFunc}));var m=a.recurrentDropoutMask,g=f(s,m,0),y=f(s,m,1),b=f(s,m,2),w=f(s,m,3),x=3,N=te(D.split(a.kernel.read(),c,x),4),T=N[0],E=N[1],C=N[2],F=N[3],_=te(a.useBias?D.split(a.bias.read(),c):[null,null,null,null],4),O=_[0],L=_[1],z=_[2],$=_[3];h=a.inputConv(h,T,O,a.padding),d=a.inputConv(d,E,L,a.padding),p=a.inputConv(p,C,z,a.padding),v=a.inputConv(v,F,$,a.padding);var B=te(D.split(a.recurrentKernel.read(),c,x),4),W=B[0],X=B[1],Z=B[2],V=B[3];g=a.recurrentConv(g,W),y=a.recurrentConv(y,X),b=a.recurrentConv(b,Z),w=a.recurrentConv(w,V);var j=a.recurrentActivation.apply(D.add(h,g)),re=a.recurrentActivation.apply(D.add(d,y)),ne=D.add(D.mul(re,u),D.mul(j,a.activation.apply(D.add(p,b)))),oe=D.mul(a.recurrentActivation.apply(D.add(v,w)),a.activation.apply(ne));return[oe,oe,ne]})},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this);t.units;var r=ube(t,["units"]),a={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},r),a)},e.prototype.inputConv=function(t,r,a,i){var o=D.conv2d(t,r,this.strides,i||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return a?pi(o,a,this.dataFormat):o},e.prototype.recurrentConv=function(t,r){var a=1;return D.conv2d(t,r,a,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")},e}(Bf);dv.className="ConvLSTM2DCell";D.serialization.registerClass(dv);var t1=function(n){se(e,n);function e(t){var r=new dv(t);return n.call(this,Object.assign(Object.assign({},t),{cell:r}))||this}return e.fromConfig=function(t,r){return new t(r)},e}(KM);t1.className="ConvLSTM2D";D.serialization.registerClass(t1);var pv=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.rate=Math.max(Math.min(t.rate,1),0),r.noiseShape=t.noiseShape,r.seed=t.seed,r.supportsMasking=!0,r}return e.prototype.getNoiseShape=function(t){if(this.noiseShape==null)return this.noiseShape;for(var r=t.shape,a=[],i=0;i<this.noiseShape.length;++i)a.push(this.noiseShape[i]==null?r[i]:this.noiseShape[i]);return a},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t);if(0<a.rate&&a.rate<1){var o=r.training==null?!1:r.training,s=a.getNoiseShape(i),u=Ff(function(){return GO(i,a.rate,s,a.seed)},function(){return i},o);return u}return t})},e.prototype.getConfig=function(){var t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e.prototype.dispose=function(){return n.prototype.dispose.call(this)},e}(gt);pv.className="Dropout";R.serialization.registerClass(pv);var n1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.inputSpec=[{ndim:3}],r}return e.prototype.getNoiseShape=function(t){var r=t.shape;return[r[0],1,r[2]]},e}(pv);n1.className="SpatialDropout1D";R.serialization.registerClass(n1);var r1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;if(r.activation=null,r.useBias=!0,r.kernel=null,r.bias=null,r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_BIAS_INITIALIZER="zeros",t.batchInputShape==null&&t.inputShape==null&&t.inputDim!=null){var a=null;t.batchSize!=null&&(a=t.batchSize),r.batchInputShape=[a,t.inputDim]}return r.units=t.units,Kn(r.units,"units"),r.activation=Vo(t.activation),t.useBias!=null&&(r.useBias=t.useBias),r.kernelInitializer=cn(t.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.biasInitializer=cn(t.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelConstraint=Vn(t.kernelConstraint),r.biasConstraint=Vn(t.biasConstraint),r.kernelRegularizer=ln(t.kernelRegularizer),r.biasRegularizer=ln(t.biasRegularizer),r.activityRegularizer=ln(t.activityRegularizer),r.supportsMasking=!0,r.inputSpec=[{minNDim:2}],r}return e.prototype.build=function(t){var r;t=It(t);var a=t[t.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[a,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(r={},r[-1]=a,r)}],this.built=!0},e.prototype.computeOutputShape=function(t){t=It(t);var r=t.slice();return r[r.length-1]=this.units,r},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t),o=BO(a.activation.getClassName()),s;return o!=null?s=Ri(i,a.kernel.read(),o,a.bias?a.bias.read():null):(s=Ri(i,a.kernel.read()),a.bias!=null&&(s=pi(s,a.bias.read())),a.activation!=null&&(s=a.activation.apply(s))),s})},e.prototype.getConfig=function(){var t={units:this.units,activation:Wo(this.activation),useBias:this.useBias,kernelInitializer:mn(this.kernelInitializer),biasInitializer:mn(this.biasInitializer),kernelRegularizer:zt(this.kernelRegularizer),biasRegularizer:zt(this.biasRegularizer),activityRegularizer:zt(this.activityRegularizer),kernelConstraint:Wn(this.kernelConstraint),biasConstraint:Wn(this.biasConstraint)},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);r1.className="Dense";R.serialization.registerClass(r1);var a1=function(n){se(e,n);function e(t){var r=this;return t=t||{},r=n.call(this,t)||this,r.inputSpec=[{minNDim:3}],r.dataFormat=t.dataFormat,r}return e.prototype.computeOutputShape=function(t){var r,a;t=It(t);try{for(var i=fe(t.slice(1)),o=i.next();!o.done;o=i.next()){var s=o.value;if(s==null)throw new J('The shape of the input to "Flatten" is not fully defined '+"(got ".concat(t.slice(1),"). Make sure to pass a complete ")+'"input_shape" or "batch_input_shape" argument to the first layer in your model.')}}catch(u){r={error:u}}finally{try{o&&!o.done&&(a=i.return)&&a.call(i)}finally{if(r)throw r.error}}return[t[0],$o(t,1)]},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t);if(a.dataFormat==="channelsFirst"&&i.rank>1){for(var o=[0],s=2;s<i.rank;++s)o.push(s);o.push(1),i=R.transpose(i,o)}return kfe(i)})},e.prototype.getConfig=function(){var t={};this.dataFormat!=null&&(t.dataFormat=this.dataFormat);var r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);a1.className="Flatten";R.serialization.registerClass(a1);var i1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.supportsMasking=!0,r.activation=Vo(t.activation),r}return e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t);return a.activation.apply(i)})},e.prototype.getConfig=function(){var t={activation:Wo(this.activation)},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);i1.className="Activation";R.serialization.registerClass(i1);var o1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.n=t.n,r.inputSpec=[{ndim:2}],r}return e.prototype.computeOutputShape=function(t){return[t[0],this.n,t[1]]},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){return t=it(t),wfe(t,a.n)})},e.prototype.getConfig=function(){var t={n:this.n},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);o1.className="RepeatVector";R.serialization.registerClass(o1);var s1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;r.targetShape=t.targetShape;for(var a=0;a<r.targetShape.length;++a)r.isUnknown(r.targetShape[a])&&(r.targetShape[a]=null);return r}return e.prototype.isUnknown=function(t){return t<0||t==null},e.prototype.fixUnknownDimension=function(t,r){for(var a="Total size of new array must be unchanged.",i=r.slice(),o=1,s=null,u=0;u<i.length;++u){var c=i[u];if(this.isUnknown(c))if(s===null)s=u;else throw new J("Can only specifiy one unknown dimension.");else o*=c}var l=$o(t);if(s!==null){if(o===0||l%o!==0)throw new J(a);i[s]=l/o}else if(l!==o)throw new J(a);return i},e.prototype.computeOutputShape=function(t){for(var r=!1,a=0;a<t.length;++a)if(this.isUnknown(t[a])){r=!0;break}return r?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t),o=i.shape,s=o.slice(0,1).concat(a.fixUnknownDimension(o.slice(1),a.targetShape));return R.reshape(i,s)})},e.prototype.getConfig=function(){var t={targetShape:this.targetShape},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);s1.className="Reshape";R.serialization.registerClass(s1);var u1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;if(t.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+"".concat(t.dims," instead."));var a=li(1,t.dims.length+1);if(!R.util.arraysEqual(t.dims.slice().sort(),a))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");return r.dims=t.dims,r.dimsIncludingBatch=[0].concat(r.dims),r.inputSpec=[new Ln({ndim:r.dims.length+1})],r}return e.prototype.computeOutputShape=function(t){t=It(t);var r=t.slice();return this.dims.forEach(function(a,i){r[i+1]=t[a]}),r},e.prototype.call=function(t,r){return R.transpose(it(t),this.dimsIncludingBatch)},e.prototype.getConfig=function(){var t={dims:this.dims},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);u1.className="Permute";R.serialization.registerClass(u1);var c1=function(n){se(e,n);function e(t){var r=n.call(this,t??{})||this;return r.supportsMasking=!0,t!=null?r.maskValue=t.maskValue==null?0:t.maskValue:r.maskValue=0,r}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r={maskValue:this.maskValue};return Object.assign(r,t),r},e.prototype.computeMask=function(t,r){var a=it(t),i=-1;return R.any(R.notEqual(a,this.maskValue),i)},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t),o=-1,s=!0,u=R.any(R.notEqual(i,a.maskValue),o,s),c=R.mul(i,R.cast(u,i.dtype));return c})},e}(gt);c1.className="Masking";R.serialization.registerClass(c1);var l1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;if(r.embeddings=null,r.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",t.batchInputShape==null&&t.inputShape==null){var a=null;t.batchSize!=null&&(a=t.batchSize),t.inputLength==null?r.batchInputShape=[a,null]:r.batchInputShape=[a].concat(Yt(t.inputLength))}return r.inputDim=t.inputDim,Kn(r.inputDim,"inputDim"),r.outputDim=t.outputDim,Kn(r.outputDim,"outputDim"),r.embeddingsInitializer=cn(t.embeddingsInitializer||r.DEFAULT_EMBEDDINGS_INITIALIZER),r.embeddingsRegularizer=ln(t.embeddingsRegularizer),r.activityRegularizer=ln(t.activityRegularizer),r.embeddingsConstraint=Vn(t.embeddingsConstraint),r.maskZero=t.maskZero,r.supportsMasking=t.maskZero,r.inputLength=t.inputLength,r}return e.prototype.build=function(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},e.prototype.warnOnIncompatibleInputShape=function(t){},e.prototype.computeMask=function(t,r){var a=this;return R.tidy(function(){return a.maskZero?(t=it(t),R.notEqual(t,R.zerosLike(t))):null})},e.prototype.computeOutputShape=function(t){if(t=It(t),this.inputLength==null)return Qe(Qe([],te(t),!1),[this.outputDim],!1);var r=Yt(this.inputLength);if(r.length!==t.length-1)throw new J('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(t));for(var a=0,i=0;i<r.length;++i){var o=r[i],s=t[i+1];if(o!=null&&s!=null&&o!==s)throw new J('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(t));o==null&&(r[a]=s),a++}return Qe(Qe([t[0]],te(r),!1),[this.outputDim],!1)},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t);i.dtype!=="int32"&&(i=Fi(i,"int32"));var o=VO(a.embeddings.read(),R.reshape(i,[i.size]));return R.reshape(o,It(a.computeOutputShape(i.shape)))})},e.prototype.getConfig=function(){var t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:mn(this.embeddingsInitializer),embeddingsRegularizer:zt(this.embeddingsRegularizer),activityRegularizer:zt(this.activityRegularizer),embeddingsConstraint:Wn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);l1.className="Embedding";R.serialization.registerClass(l1);var Hs=function(n){se(e,n);function e(t){var r=n.call(this,t||{})||this;return r.supportsMasking=!0,r}return e.prototype.mergeFunction=function(t){throw new pt},e.prototype.computeElementwiseOpOutputShape=function(t,r){if(t==null||r==null)return null;if(t.length<r.length)return this.computeElementwiseOpOutputShape(r,t);if(r.length===0)return t;for(var a=t.slice(0,t.length-r.length),i=0;i<r.length;++i){var o=t[t.length-r.length+i],s=r[i];if(o==null||s==null||o<0||s<0)a.push(null);else if(o===1)a.push(s);else if(s===1)a.push(o);else{if(o!==s)throw new J("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(r));a.push(o)}}return a},e.prototype.build=function(t){var r,a;if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[It(t)]),t=t,t.length<2)throw new J("A merge layer should be called on an Array of at least 2 inputs."+" Got ".concat(t.length," input(s)."));var i=[];try{for(var o=fe(t),s=o.next();!s.done;s=o.next()){var u=s.value;u!=null&&u[0]!==null&&i.push(u[0])}}catch(h){r={error:h}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}if(i=zo(i),i.length>1)throw new J("Can not merge tensors with different batch sizes. "+"Got tensors with shapes: ".concat(JSON.stringify(t),"."));for(var c=t[0]==null?null:t[0].slice(1),l=1;l<t.length;++l){var u=t[l]==null?null:t[l].slice(1);c=this.computeElementwiseOpOutputShape(c,u)}var f=t.map(function(h){return h.length});t.indexOf(null)===-1&&zo(f).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i,o,s,u;if(t=t,a.reshapeRequired){var c=[],l=t.map(function(L){return L.rank});if(l.indexOf(null)===-1){var f=qo(l);try{for(var h=fe(t),d=h.next();!d.done;d=h.next()){for(var p=d.value,v=p.rank,m=0;m<f-v;++m)p=Df(p,1);c.push(p)}}catch(L){i={error:L}}finally{try{d&&!d.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}return a.mergeFunction(c)}else{var g=!1;try{for(var y=fe(t),b=y.next();!b.done;b=y.next()){var p=b.value,v=p.rank;if(v==null){var w=p.shape,x=w[0],N=w.slice(1).concat([x]),T=D.reshape(p,[x].concat($o(w.slice(1))));T=D.transpose(T,[1,0]),T=D.reshape(T,N),c.push(T),g=!0}else if(v>1){var E=li(1,v).concat([0]);c.push(D.transpose(p,E)),g=!0}else c.push(p)}}catch(L){s={error:L}}finally{try{b&&!b.done&&(u=y.return)&&u.call(y)}finally{if(s)throw s.error}}var C=a.mergeFunction(c),F=C.rank;if(g){if(F==null){var _=C.shape,O=_.length,x=_[O-1],N=[x].concat(_.slice(0,_.length-1));C=D.reshape(D.transpose(D.reshape(C,[-1,x]),[1,0]),N)}else if(F>1){var E=[F-1].concat(li(0,F-1));C=D.transpose(C,E)}}return C}}else return a.mergeFunction(t)})},e.prototype.computeOutputShape=function(t){var r,a;t=t;var i;t[0]==null?i=null:i=t[0].slice(1);for(var o=1;o<t.length;++o){var s=t[o]==null?null:t[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}var u=[];try{for(var c=fe(t),l=c.next();!l.done;l=c.next()){var s=l.value;s!=null&&s[0]!==null&&u.push(s[0])}}catch(f){r={error:f}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(r)throw r.error}}return u=zo(u),u.length===1?i=u.concat(i):i=[null].concat(i),i},e.prototype.computeMask=function(t,r){return D.tidy(function(){if(r==null)return null;if(!Array.isArray(r))throw new J("`mask` should be an Array");if(!Array.isArray(t))throw new J("`inputs` should be an Array");if(r.length!==t.length)throw new J("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths "+"(".concat(t.length," vs ").concat(r.length,")"));if(r.every(function(o){return o==null}))return null;r=r.map(function(o){return o==null?o:D.expandDims(o,0)});for(var a=r[0],i=1;i<r.length-1;++i)a=D.logicalAnd(a,r[i]);return a})},e}(gt),f1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.mergeFunction=function(t){return R.tidy(function(){for(var r=t[0].clone(),a=1;a<t.length;++a)r=D.add(r,t[a]);return r})},e}(Hs);f1.className="Add";R.serialization.registerClass(f1);var h1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.mergeFunction=function(t){return R.tidy(function(){for(var r=t[0].clone(),a=1;a<t.length;++a)r=D.mul(r,t[a]);return r})},e}(Hs);h1.className="Multiply";R.serialization.registerClass(h1);var d1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.mergeFunction=function(t){return R.tidy(function(){for(var r=t[0].clone(),a=1;a<t.length;++a)r=D.add(r,t[a]);return D.mul(1/t.length,r)})},e}(Hs);d1.className="Average";R.serialization.registerClass(d1);var p1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.mergeFunction=function(t){return R.tidy(function(){for(var r=t[0],a=1;a<t.length;++a)r=D.maximum(r,t[a]);return r})},e}(Hs);p1.className="Maximum";R.serialization.registerClass(p1);var v1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.mergeFunction=function(t){return R.tidy(function(){for(var r=t[0],a=1;a<t.length;++a)r=D.minimum(r,t[a]);return r})},e}(Hs);v1.className="Minimum";R.serialization.registerClass(v1);var m1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.DEFAULT_AXIS=-1,t==null&&(t={}),r.axis=t.axis==null?r.DEFAULT_AXIS:t.axis,r.supportsMasking=!0,r.reshapeRequired=!1,r}return e.prototype.build=function(t){var r,a,i,o;if(!(Array.isArray(t)&&Array.isArray(t[0]))||t.length===1)throw new J("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;var s=!0;try{for(var u=fe(t),c=u.next();!c.done;c=u.next()){var l=c.value;if(l!=null){s=!1;break}}}catch(g){r={error:g}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(r)throw r.error}}if(!s){for(var f=[],h=0;h<t.length;++h){var d=t[h].slice();d.splice(this.axis,1);var p=!1;try{for(var v=(i=void 0,fe(f)),m=v.next();!m.done;m=v.next()){var l=m.value;if(R.util.arraysEqual(l,d)){p=!0;break}}}catch(g){i={error:g}}finally{try{m&&!m.done&&(o=v.return)&&o.call(v)}finally{if(i)throw i.error}}p||f.push(d)}if(f.length>1)throw new J("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}},e.prototype.mergeFunction=function(t){var r=this;return R.tidy(function(){return Xy(t,r.axis)})},e.prototype.computeOutputShape=function(t){var r,a;if(!(Array.isArray(t)&&Array.isArray(t[0])))throw new J("A `Concatenate` layer should be called on a list of inputs.");var i=t,o=i[0].slice(),s=this.axis<0?o.length+this.axis:this.axis;try{for(var u=fe(i.slice(1)),c=u.next();!c.done;c=u.next()){var l=c.value;if(o[s]==null||l[s]==null){o[s]=null;break}o[s]+=l[s]}}catch(f){r={error:f}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(r)throw r.error}}return o},e.prototype.computeMask=function(t,r){var a=this;if(r==null)return null;if(!Array.isArray(r))throw new J("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new J("`inputs` should be an array for Concatenate");if(r.length!==t.length)throw new J("Mismatch in the length of mask (".concat(r.length,") ")+"and the legnth of inputs (".concat(t.length,")"));return D.tidy(function(){var i=!0;if(r.forEach(function(c){if(c!=null){i=!1;return}}),i)return null;for(var o=[],s=0;s<t.length;++s)r[s]==null?o.push(D.cast(D.onesLike(t[s]),"bool")):r[s].rank<t[s].rank?o.push(D.expandDims(r[s],-1)):o.push(r[s]);var u=D.concat(o,a.axis);return D.all(u,-1,!1)})},e.prototype.getConfig=function(){var t={axis:this.axis},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(Hs);m1.className="Concatenate";R.serialization.registerClass(m1);function yf(n,e){for(;n<0;)n+=e;return n}function cbe(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new pt("batchDot is not implemented for tensors of 4D or higher rank yet");if(D.util.assert(n.shape.length>=2,function(){return"batchDot requires the rank of x to be >= 2, "+"but got ".concat(n.shape.length)}),D.util.assert(n.shape.length>=2,function(){return"batchDot requires the rank of y to be >= 2, "+"but got ".concat(e.shape.length)}),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new pt("batchDot is not implemented for complex64-type Tensors yet.");var r=n.shape.length,a=e.shape.length;t==null&&(t=[r-1,a-2]);var i=t;return D.tidy(function(){var o;if(r>a){o=r-a;for(var s=[],u=0;u<o;++u)s.push(1);e=D.reshape(e,e.shape.concat(s))}else if(a>r){o=a-r;for(var s=[],u=0;u<o;++u)s.push(1);n=D.reshape(n,n.shape.concat(s))}else o=0;var c;if(n.shape.length===2&&e.shape.length===2)i[0]===i[1]?c=D.sum(D.mul(n,e),i[0]):c=D.sum(D.mul(D.transpose(n,[1,0]),e),i[1]);else{var l=i[0]!==n.shape.length-1,f=i[1]===e.shape.length-1;c=D.matMul(n,e,l,f)}if(o>0){var h=void 0;r>a?h=r+a-3:h=r-1;for(var d=[],u=h;u<h+o;++u)d.push(u);c=D.squeeze(c,d)}return c.shape.length===1&&(c=D.expandDims(c,1)),c})}var g1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.axes=t.axes,r.normalize=t.normalize==null?!1:t.normalize,r.supportsMasking=!0,r.reshapeRequired=!1,r}return e.prototype.build=function(t){D.util.assert(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var r=t[0],a=t[1];if(r.length>3||a.length>3)throw new pt("Dot layer does not support tensors of 4D or higher rank yet.");var i=this.interpretAxes(r,a);if(r[i[0]]!==a[i[1]])throw new J("Dimension incompatibility: "+"".concat(r[i[0]]," !== ").concat(a[i[1]]))},e.prototype.mergeFunction=function(t){if(t.length!==2)throw new J("A `Dot` layer must be called on exactly 2 inputs, "+"but received ".concat(t.length," input(s)."));var r=t[0],a=t[1],i;return Array.isArray(this.axes)?i=this.axes.map(function(o,s){return yf(o,t[s].shape.length)}):i=[yf(this.axes,r.shape.length),yf(this.axes,a.shape.length)],this.normalize&&(r=$p(r,i[0]),a=$p(a,i[1])),cbe(r,a,i)},e.prototype.interpretAxes=function(t,r){var a;return Array.isArray(this.axes)?a=this.axes:a=[yf(this.axes,t.length),yf(this.axes,r.length)],a},e.prototype.computeOutputShape=function(t){D.util.assert(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var r=t[0].slice(),a=t[1].slice();if(r.length>3||a.length>3)throw new pt("Dot layer does not support tensors of 4D or higher rank yet.");var i=this.interpretAxes(r,a);r.splice(i[0],1),a.splice(i[1],1),a.splice(0,1);var o=r.concat(a);return o.length===1&&o.push(1),o},e.prototype.computeMask=function(t,r){return null},e.prototype.getConfig=function(){var t={axes:this.axes,normalize:this.normalize},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(Hs);g1.className="Dot";R.serialization.registerClass(g1);var y1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.supportsMasking=!0,r.stddev=t.stddev,r}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r={stddev:this.stddev};return Object.assign(r,t),r},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t),o=function(){return R.add(Hp(i.shape,0,a.stddev),i)},s=Ff(o,function(){return i},r.training||!1);return s})},e}(gt);y1.className="GaussianNoise";R.serialization.registerClass(y1);var b1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.supportsMasking=!0,r.rate=t.rate,r}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r={rate:this.rate};return Object.assign(r,t),r},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t);if(a.rate>0&&a.rate<1){var o=function(){var s=Math.sqrt(a.rate/(1-a.rate));return R.mul(i,Hp(i.shape,1,s))};return Ff(o,function(){return i},r.training||!1)}return i})},e}(gt);b1.className="GaussianDropout";R.serialization.registerClass(b1);var w1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.supportsMasking=!0,r.rate=t.rate,r.noiseShape=t.noiseShape,r}return e.prototype._getNoiseShape=function(t){return this.noiseShape||it(t).shape},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r={rate:this.rate};return Object.assign(r,t),r},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){if(a.rate<1&&a.rate>0){var i=a._getNoiseShape(t),o=function(){var s=it(t),u=1.6732632423543772,c=1.0507009873554805,l=-u*c,f=R.greaterEqual(R.randomUniform(i),a.rate);f=Fi(f,"float32");var h=Math.pow((1-a.rate)*(1+a.rate*Math.pow(l,2)),-.5),d=-h*l*a.rate,p=R.add(R.mul(s,f),R.mul(R.add(f,-1),l));return R.add(R.mul(p,h),d)};return Ff(o,function(){return it(t)},r.training||!1)}return t})},e}(gt);w1.className="AlphaDropout";R.serialization.registerClass(w1);function Cf(n,e,t,r,a,i){i===void 0&&(i=.001);var o;if(n.rank===2)o=D.batchNorm2d(n,e,t,r,a,i);else if(n.rank===3)o=D.batchNorm3d(n,e,t,r,a,i);else if(n.rank===4)o=D.batchNorm4d(n,e,t,r,a,i);else throw new pt("batchNormalization is not implemented for array of rank ".concat(n.rank," ")+"yet");return o}function lbe(n,e,t,r,a){return a===void 0&&(a=.001),R.tidy(function(){var i=D.moments(n,r),o=i.mean,s=i.variance,u=Cf(n,o,s,t,e,a);return[u,o,s]})}function fbe(n,e,t,r,a){return a===void 0&&(a=.001),R.tidy(function(){var i,o,s=D.moments(n,r),u=s.mean,c=s.variance,l=[];try{for(var f=fe(li(0,n.rank)),h=f.next();!h.done;h=f.next()){var d=h.value;r.indexOf(d)!==-1?l.push(1):l.push(n.shape[d])}}catch(b){i={error:b}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}var p=R.reshape(u,l),v=R.reshape(c,l),m=e==null?null:R.reshape(e,l),g=t==null?null:R.reshape(t,l),y=Cf(n,p,v,g,m,a);return[y,u,c]})}function hbe(n,e,t,r,a){return a===void 0&&(a=.001),R.util.arraysEqual(r.slice().sort(),li(0,n.rank-1))?lbe(n,e,t,r,a):fbe(n,e,t,r,a)}var x1=function(n){se(e,n);function e(t){var r=this;return t==null&&(t={}),r=n.call(this,t)||this,r.supportsMasking=!0,r.axis=t.axis==null?-1:t.axis,r.momentum=t.momentum==null?.99:t.momentum,r.epsilon=t.epsilon==null?.001:t.epsilon,r.center=t.center==null?!0:t.center,r.scale=t.scale==null?!0:t.scale,r.betaInitializer=cn(t.betaInitializer||"zeros"),r.gammaInitializer=cn(t.gammaInitializer||"ones"),r.movingMeanInitializer=cn(t.movingMeanInitializer||"zeros"),r.movingVarianceInitializer=cn(t.movingVarianceInitializer||"ones"),r.betaConstraint=Vn(t.betaConstraint),r.gammaConstraint=Vn(t.gammaConstraint),r.betaRegularizer=ln(t.betaRegularizer),r.gammaRegularizer=ln(t.gammaRegularizer),r}return e.prototype.build=function(t){var r;t=It(t);var a=this.axis>=0?this.axis:this.axis+t.length,i=t[a];if(i==null)throw new J("Axis ".concat(a," of input tensor should have a defined dimension but ")+"the layer received an input with shape "+"".concat(JSON.stringify(t),"."));this.inputSpec=[new Ln({ndim:t.length,axes:(r={},r[a]=i,r)})];var o=[i];this.scale&&(this.gamma=this.addWeight("gamma",o,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",o,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",o,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",o,null,this.movingVarianceInitializer,null,!1),this.built=!0},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i=r.training==null?!1:r.training,o=it(t),s=o.shape,u=s.length,c=li(0,u),l=a.axis>=0?a.axis:a.axis+u;c.splice(l,1);var f=Ps(1,u);f[l]=s[l];var h=c.slice();h.sort();var d=!R.util.arraysEqual(h,li(0,u).slice(0,u-1)),p=function(){if(d){var x=R.reshape(a.movingMean.read(),f),N=R.reshape(a.movingVariance.read(),f),T=a.center?R.reshape(a.beta.read(),f):null,E=a.scale?R.reshape(a.gamma.read(),f):null;return Cf(o,x,N,T,E,a.epsilon)}else return Cf(o,a.movingMean.read(),a.movingVariance.read(),a.beta==null?null:a.beta.read(),a.gamma==null?null:a.gamma.read(),a.epsilon)};if(!i)return p();var v=te(hbe(o,a.gamma.read(),a.beta.read(),c,a.epsilon),3),m=v[0],g=v[1],y=v[2],b=function(x,N,T){D.tidy(function(){var E=1-T,C=x.read(),F=D.mul(D.sub(C,N),E);x.write(D.sub(C,F))})},w=function(){b(a.movingMean,g,a.momentum),b(a.movingVariance,y,a.momentum)};return w(),m})},e.prototype.getConfig=function(){var t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:mn(this.betaInitializer),gammaInitializer:mn(this.gammaInitializer),movingMeanInitializer:mn(this.movingMeanInitializer),movingVarianceInitializer:mn(this.movingVarianceInitializer),betaRegularizer:zt(this.betaRegularizer),gammaRegularizer:zt(this.gammaRegularizer),betaConstraint:Wn(this.betaConstraint),gammaConstraint:Wn(this.gammaConstraint)},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);x1.className="BatchNormalization";R.serialization.registerClass(x1);var k1=function(n){se(e,n);function e(t){var r,a,i=this;if(t==null&&(t={}),i=n.call(this,t)||this,i.axis=t.axis==null?-1:t.axis,typeof i.axis=="number"){if(!Number.isInteger(i.axis))throw new Error("Expected axis to be an integer, but received ".concat(i.axis))}else if(Array.isArray(i.axis))try{for(var o=fe(i.axis),s=o.next();!s.done;s=o.next()){var u=s.value;if(!Number.isInteger(u))throw new Error("Expected axis to be an array of integers, "+"but received ".concat(JSON.stringify(i.axis)))}}catch(c){r={error:c}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}else throw new Error("Expected axis to be an integer or an array of integers, "+"but received ".concat(JSON.stringify(i.axis)));return i.epsilon=t.epsilon==null?.001:t.epsilon,i.center=t.center==null?!0:t.center,i.scale=t.scale==null?!0:t.scale,i.betaInitializer=cn(t.betaInitializer||"zeros"),i.gammaInitializer=cn(t.gammaInitializer||"ones"),i.betaRegularizer=ln(t.betaRegularizer),i.gammaRegularizer=ln(t.gammaRegularizer),i.supportsMasking=!0,i}return e.prototype.build=function(t){var r,a;t=It(t);var i=t.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(var o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=i);try{for(var s=fe(this.axis),u=s.next();!u.done;u=s.next()){var c=u.value;if(c<0||c>=i)throw new Error("Invalid axis: ".concat(c))}}catch(h){r={error:h}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}if(this.axis.length!==zo(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));var l=this.axis.map(function(h){return t[h]}),f=!0;this.scale?this.gamma=this.addWeight("gamma",l,"float32",this.gammaInitializer,this.gammaRegularizer,f):this.gamma=null,this.center?this.beta=this.addWeight("beta",l,"float32",this.betaInitializer,this.betaRegularizer,f):this.beta=null,this.built=!0},e.prototype.call=function(t,r){var a=this,i=it(t),o=i.shape,s=o.length;return R.tidy(function(){var u,c,l=!0,f=R.moments(i,a.axis,l),h=f.mean,d=f.variance,p=Ps(1,s);try{for(var v=fe(a.axis),m=v.next();!m.done;m=v.next()){var g=m.value;p[g]=o[g]}}catch(E){u={error:E}}finally{try{m&&!m.done&&(c=v.return)&&c.call(v)}finally{if(u)throw u.error}}for(var y=function(E){return E!=null&&E.shape.length!==s?D.reshape(E,p):E},b=a.scale?y(a.gamma.read()):null,w=a.center?y(a.beta.read()):null,x=[],N=[],T=0;T<s;++T)a.axis.indexOf(T)!==-1?(x.push(o[T]),N.push(1)):(x.push(1),N.push(o[T]));return h=D.tile(h,x),d=D.tile(d,x),b!=null&&(b=D.tile(b,N)),w!=null&&(w=D.tile(w,N)),Cf(i,h,d,w,b,a.epsilon)})},e.prototype.getConfig=function(){var t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:mn(this.betaInitializer),gammaInitializer:mn(this.gammaInitializer),betaRegularizer:zt(this.betaRegularizer),gammaRegularizer:zt(this.gammaRegularizer)},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);k1.className="LayerNormalization";R.serialization.registerClass(k1);function dbe(n,e,t){return R.tidy(function(){if(n.rank!==4)throw new J("temporalPadding expects input tensor to be 4-D, but received a "+"".concat(n.rank,"-D tensor."));if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new J("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=fi()),t!=="channelsLast"&&t!=="channelsFirst")throw new J("Unknown data format: ".concat(t,". ")+"Supported data formats are 'channelsLast' and 'channelsFirst.");var r;return t==="channelsFirst"?r=[[0,0],[0,0],e[0],e[1]]:r=[[0,0],e[0],e[1],[0,0]],D.pad(n,r)})}var S1=function(n){se(e,n);function e(t){var r=this;if(t==null&&(t={}),r=n.call(this,t)||this,r.dataFormat=t.dataFormat==null?fi():t.dataFormat,t.padding==null)r.padding=[[1,1],[1,1]];else if(typeof t.padding=="number")r.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,t.padding.length!==2)throw new J("ZeroPadding2D expects padding to be a length-2 array, but "+"received a length-".concat(t.padding.length," array."));var a=void 0,i=void 0;if(typeof t.padding[0]=="number")a=[t.padding[0],t.padding[0]],i=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,t.padding[0].length!==2)throw new J("ZeroPadding2D expects height padding to be a length-2 array, "+"but received a length-".concat(t.padding[0].length," array."));if(a=t.padding[0],t.padding[1].length!==2)throw new J("ZeroPadding2D expects width padding to be a length-2 array, "+"but received a length-".concat(t.padding[1].length," array."));i=t.padding[1]}r.padding=[a,i]}return r.inputSpec=[new Ln({ndim:4})],r}return e.prototype.computeOutputShape=function(t){t=It(t);var r,a;return this.dataFormat==="channelsFirst"?(t[2]!=null&&t[2]>=0?r=t[2]+this.padding[0][0]+this.padding[0][1]:r=null,t[3]!=null&&t[3]>=0?a=t[3]+this.padding[1][0]+this.padding[1][1]:a=null,[t[0],t[1],r,a]):(t[1]!=null&&t[1]>=0?r=t[1]+this.padding[0][0]+this.padding[0][1]:r=null,t[2]!=null&&t[2]>=0?a=t[2]+this.padding[1][0]+this.padding[1][1]:a=null,[t[0],r,a,t[3]])},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){return dbe(it(t),a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={padding:this.padding,dataFormat:this.dataFormat},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);S1.className="ZeroPadding2D";R.serialization.registerClass(S1);function vv(n,e,t,r,a,i){return R.tidy(function(){_n(a),zO(i),pa(r),t==null&&(t=[1,1]),r==null&&(r="valid"),a==null&&(a=fi()),i==null&&(i="max"),n=Gb(n,a);var o,s=r==="same"?"same":"valid";return i==="max"?o=D.maxPool(n,e,t,s):o=D.avgPool(n,e,t,s),a==="channelsFirst"&&(o=D.transpose(o,[0,3,1,2])),o})}function jM(n,e,t,r,a,i){return R.tidy(function(){_n(a),zO(i),pa(r),t==null&&(t=[1,1,1]),r==null&&(r="valid"),a==null&&(a=fi()),i==null&&(i="max"),n=WM(n,a);var o,s=r==="same"?"same":"valid";return i==="max"?o=D.maxPool3d(n,e,t,s):o=D.avgPool3d(n,e,t,s),a==="channelsFirst"&&(o=D.transpose(o,[0,4,1,2,3])),o})}var XM=function(n){se(e,n);function e(t){var r=this;if(t.poolSize==null&&(t.poolSize=2),r=n.call(this,t)||this,typeof t.poolSize=="number")r.poolSize=[t.poolSize];else if(Array.isArray(t.poolSize)&&t.poolSize.length===1&&typeof t.poolSize[0]=="number")r.poolSize=t.poolSize;else throw new J("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(t.poolSize)));if(Kn(r.poolSize,"poolSize"),t.strides==null)r.strides=r.poolSize;else if(typeof t.strides=="number")r.strides=[t.strides];else if(Array.isArray(t.strides)&&t.strides.length===1&&typeof t.strides[0]=="number")r.strides=t.strides;else throw new J("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(t.strides)));return Kn(r.strides,"strides"),r.padding=t.padding==null?"valid":t.padding,pa(r.padding),r.inputSpec=[new Ln({ndim:3})],r}return e.prototype.computeOutputShape=function(t){t=It(t);var r=ci(t[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],r,t[2]]},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r),t=Df(it(t),2);var i=a.poolingFunction(it(t),[a.poolSize[0],1],[a.strides[0],1],a.padding,"channelsLast");return D.squeeze(i,[2])})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt),N1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.poolingFunction=function(t,r,a,i,o){return _n(o),pa(i),vv(t,r,a,i,o,"max")},e}(XM);N1.className="MaxPooling1D";R.serialization.registerClass(N1);var T1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.poolingFunction=function(t,r,a,i,o){return _n(o),pa(i),vv(t,r,a,i,o,"avg")},e}(XM);T1.className="AveragePooling1D";R.serialization.registerClass(T1);var YM=function(n){se(e,n);function e(t){var r=this;if(t.poolSize==null&&(t.poolSize=[2,2]),r=n.call(this,t)||this,r.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],t.strides==null)r.strides=r.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==2)throw new J("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+"".concat(t.strides.length,"."));r.strides=t.strides}else r.strides=[t.strides,t.strides];return Kn(r.poolSize,"poolSize"),Kn(r.strides,"strides"),r.padding=t.padding==null?"valid":t.padding,r.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,_n(r.dataFormat),pa(r.padding),r.inputSpec=[new Ln({ndim:4})],r}return e.prototype.computeOutputShape=function(t){t=It(t);var r=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2];return r=ci(r,this.poolSize[0],this.padding,this.strides[0]),a=ci(a,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[t[0],t[1],r,a]:[t[0],r,a,t[3]]},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){return a.invokeCallHook(t,r),a.poolingFunction(it(t),a.poolSize,a.strides,a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt),E1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.poolingFunction=function(t,r,a,i,o){return _n(o),pa(i),vv(t,r,a,i,o,"max")},e}(YM);E1.className="MaxPooling2D";R.serialization.registerClass(E1);var I1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.poolingFunction=function(t,r,a,i,o){return _n(o),pa(i),vv(t,r,a,i,o,"avg")},e}(YM);I1.className="AveragePooling2D";R.serialization.registerClass(I1);var ZM=function(n){se(e,n);function e(t){var r=this;if(t.poolSize==null&&(t.poolSize=[2,2,2]),r=n.call(this,t)||this,r.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],t.strides==null)r.strides=r.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==3)throw new J("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+"".concat(t.strides.length,"."));r.strides=t.strides}else r.strides=[t.strides,t.strides,t.strides];return Kn(r.poolSize,"poolSize"),Kn(r.strides,"strides"),r.padding=t.padding==null?"valid":t.padding,r.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,_n(r.dataFormat),pa(r.padding),r.inputSpec=[new Ln({ndim:5})],r}return e.prototype.computeOutputShape=function(t){t=It(t);var r=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[4]:t[3];return r=ci(r,this.poolSize[0],this.padding,this.strides[0]),a=ci(a,this.poolSize[1],this.padding,this.strides[1]),i=ci(i,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[t[0],t[1],r,a,i]:[t[0],r,a,i,t[4]]},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){return a.invokeCallHook(t,r),a.poolingFunction(it(t),a.poolSize,a.strides,a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt),C1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.poolingFunction=function(t,r,a,i,o){return _n(o),pa(i),jM(t,r,a,i,o,"max")},e}(ZM);C1.className="MaxPooling3D";R.serialization.registerClass(C1);var A1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.poolingFunction=function(t,r,a,i,o){return _n(o),pa(i),jM(t,r,a,i,o,"avg")},e}(ZM);A1.className="AveragePooling3D";R.serialization.registerClass(A1);var JM=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.inputSpec=[new Ln({ndim:3})],r}return e.prototype.computeOutputShape=function(t){return[t[0],t[2]]},e.prototype.call=function(t,r){throw new pt},e}(gt),D1=function(n){se(e,n);function e(t){return n.call(this,t||{})||this}return e.prototype.call=function(t,r){return R.tidy(function(){var a=it(t);return D.mean(a,1)})},e}(JM);D1.className="GlobalAveragePooling1D";R.serialization.registerClass(D1);var _1=function(n){se(e,n);function e(t){return n.call(this,t||{})||this}return e.prototype.call=function(t,r){return R.tidy(function(){var a=it(t);return D.max(a,1)})},e}(JM);_1.className="GlobalMaxPooling1D";R.serialization.registerClass(_1);var QM=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,_n(r.dataFormat),r.inputSpec=[new Ln({ndim:4})],r}return e.prototype.computeOutputShape=function(t){return t=t,this.dataFormat==="channelsLast"?[t[0],t[3]]:[t[0],t[1]]},e.prototype.call=function(t,r){throw new pt},e.prototype.getConfig=function(){var t={dataFormat:this.dataFormat},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt),F1=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i=it(t);return a.dataFormat==="channelsLast"?D.mean(i,[1,2]):D.mean(i,[2,3])})},e}(QM);F1.className="GlobalAveragePooling2D";R.serialization.registerClass(F1);var R1=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i=it(t);return a.dataFormat==="channelsLast"?D.max(i,[1,2]):D.max(i,[2,3])})},e}(QM);R1.className="GlobalMaxPooling2D";R.serialization.registerClass(R1);var e4=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.layer=t.layer,r}return e.prototype.build=function(t){this.built=!0},Object.defineProperty(e.prototype,"trainable",{get:function(){return this.layer!=null?this.layer.trainable:!1},set:function(t){this.layer!=null&&(this.layer.trainable=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!1,configurable:!0}),e.prototype.getWeights=function(){return this.layer.getWeights()},e.prototype.setWeights=function(t){this.layer.setWeights(t)},e.prototype.getConfig=function(){var t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e.prototype.setFastWeightInitDuringBuild=function(t){n.prototype.setFastWeightInitDuringBuild.call(this,t),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(t)},e.fromConfig=function(t,r,a){a===void 0&&(a={});var i=r.layer,o=ui(i,a);delete r.layer;var s={layer:o};return Object.assign(s,r),new t(s)},e}(gt),O1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.supportsMasking=!0,r}return e.prototype.build=function(t){if(t=It(t),t.length<3)throw new J("TimeDistributed layer expects an input shape >= 3D, but received "+"input shape ".concat(JSON.stringify(t)));this.inputSpec=[{shape:t}];var r=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(r),this.layer.built=!0),n.prototype.build.call(this,t)},e.prototype.computeOutputShape=function(t){t=It(t);var r=[t[0]].concat(t.slice(2)),a=this.layer.computeOutputShape(r),i=t[1];return[a[0],i].concat(a.slice(1))},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){t=it(t);var i=function(u,c){var l=it(a.layer.call(u,r));return[l,[]]},o=HM(i,t,[],!1,null,null,!1,!0),s=o[1];return s})},e}(e4);O1.className="TimeDistributed";R.serialization.registerClass(O1);function pbe(n){Bs(vfe,"BidirectionalMergeMode",n)}var vbe="concat",P1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this,a=t.layer.getConfig(),i={};i.className=t.layer.getClassName(),i.config=a,r.forwardLayer=ui(i),a.goBackwards=a.goBackwards!==!0;var o={};if(o.className=t.layer.getClassName(),o.config=a,r.backwardLayer=ui(o),r.forwardLayer.name="forward_"+r.forwardLayer.name,r.backwardLayer.name="backward_"+r.backwardLayer.name,r.mergeMode=t.mergeMode===void 0?vbe:t.mergeMode,pbe(r.mergeMode),t.weights)throw new pt("weights support is not implemented for Bidirectional layer yet.");return r._stateful=t.layer.stateful,r.returnSequences=t.layer.returnSequences,r.returnState=t.layer.returnState,r.supportsMasking=!0,r._trainable=!0,r.inputSpec=t.layer.inputSpec,r.numConstants=null,r}return Object.defineProperty(e.prototype,"trainable",{get:function(){return this._trainable},set:function(t){this._trainable=t,this.forwardLayer!=null&&(this.forwardLayer.trainable=t),this.backwardLayer!=null&&(this.backwardLayer.trainable=t)},enumerable:!1,configurable:!0}),e.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},e.prototype.setWeights=function(t){var r=t.length,a=Math.floor(r/2);this.forwardLayer.setWeights(t.slice(0,a)),this.backwardLayer.setWeights(t.slice(a))},e.prototype.computeOutputShape=function(t){var r=this.forwardLayer.computeOutputShape(t);Array.isArray(r)&&Array.isArray(r[0])||(r=[r]),r=r;var a,i,o;return this.returnState&&(o=r.slice(1)),a=r[0],a=a,this.mergeMode==="concat"?(a[a.length-1]*=2,i=[a]):this.mergeMode==null?i=[a,a.slice()]:i=[a],this.returnState?this.mergeMode==null?i.concat(o).concat(o.slice()):[a].concat(o).concat(o.slice()):Ir(i)},e.prototype.apply=function(t,r){var a,i,o=r==null?null:r.initialState,s=r==null?null:r.constants;r==null&&(r={});var u=UM(t,o,s,this.numConstants);if(t=u.inputs,o=u.initialState,s=u.constants,Array.isArray(t)&&(o=t.slice(1),t=t[0]),(o==null||o.length===0)&&s==null)return n.prototype.apply.call(this,t,r);var c=[],l=[];if(o!=null){var f=o.length;if(f%2>0)throw new J("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");r.initialState=o,c.push.apply(c,Qe([],te(o),!1));var h=o.map(function(x){return new Ln({shape:x.shape})});this.forwardLayer.stateSpec=h.slice(0,f/2),this.backwardLayer.stateSpec=h.slice(f/2),l.push.apply(l,Qe([],te(h),!1))}if(s!=null)throw new pt("Support for constants in Bidirectional layers is not implemented yet.");var d=c[0]instanceof si;try{for(var p=fe(c),v=p.next();!v.done;v=p.next()){var m=v.value;if(m instanceof si!==d)throw new J("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}}catch(x){a={error:x}}finally{try{v&&!v.done&&(i=p.return)&&i.call(p)}finally{if(a)throw a.error}}if(d){var g=[t].concat(c),y=this.inputSpec.concat(l),b=this.inputSpec;this.inputSpec=y;var w=n.prototype.apply.call(this,g,r);return this.inputSpec=b,w}else return n.prototype.apply.call(this,t,r)},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i=r.initialState,o,s;if(i==null)o=a.forwardLayer.call(t,r),s=a.backwardLayer.call(t,r);else{var u=i.slice(0,i.length/2),c=i.slice(i.length/2);o=a.forwardLayer.call(t,Object.assign(r,{initialState:u})),s=a.backwardLayer.call(t,Object.assign(r,{initialState:c}))}var l;a.returnState&&(Array.isArray(o)&&(l=o.slice(1).concat(s.slice(1))),o=o[0],s=s[0]),a.returnSequences&&(s=D.reverse(s,1));var f;return a.mergeMode==="concat"?f=Xy([o,s]):a.mergeMode==="sum"?f=D.add(o,s):a.mergeMode==="ave"?f=D.mul(.5,D.add(o,s)):a.mergeMode==="mul"?f=D.mul(o,s):a.mergeMode==null&&(f=[o,s]),a.returnState?a.mergeMode==null?f.concat(l):[f].concat(l):f})},e.prototype.resetStates=function(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},e.prototype.build=function(t){var r=this;Rs(this.forwardLayer.name,function(){r.forwardLayer.build(t)}),Rs(this.backwardLayer.name,function(){r.backwardLayer.build(t)}),this.built=!0},e.prototype.computeMask=function(t,r){Array.isArray(r)&&(r=r[0]);var a;if(this.returnSequences?this.mergeMode==null?a=[r,r]:a=r:this.mergeMode==null?a=[null,null]:a=null,this.returnState){var i=this.forwardLayer.states,o=i.map(function(s){return null});return Array.isArray(a)?a.concat(o).concat(o):[a].concat(o).concat(o)}else return a},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!1,configurable:!0}),e.prototype.setFastWeightInitDuringBuild=function(t){n.prototype.setFastWeightInitDuringBuild.call(this,t),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(t),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(t)},e.prototype.getConfig=function(){var t={mergeMode:this.mergeMode},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e.fromConfig=function(t,r){var a=ui(r.layer);if(delete r.layer,r.numConstants!=null)throw new pt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var i=r;return i.layer=a,new t(i)},e}(e4);P1.className="Bidirectional";R.serialization.registerClass(P1);var M1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.scale=t.scale,t.offset?r.offset=t.offset:r.offset=0,r}return e.prototype.getConfig=function(){var t={scale:this.scale,offset:this.offset},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){return t=it(t),t.dtype!=="float32"&&(t=Fi(t,"float32")),R.add(R.mul(t,a.scale),a.offset)})},e}(gt);M1.className="Rescaling";R.serialization.registerClass(M1);var mbe=R.image.resizeBilinear,gbe=R.image.cropAndResize,B1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.height=t.height,r.width=t.width,r}return e.prototype.centerCrop=function(t,r,a,i,o,s,u,c){return R.tidy(function(){var l,f=!1,h=r/s,d=a/u,p=(i+r)/s,v=(o+a)/u,m=[h,d,p,v],g=[];t.rank===3?(f=!0,l=R.stack([t])):l=t;for(var y=0;y<l.shape[0];y++)g.push(m);var b=R.tensor(g,[g.length,4]),w=R.range(0,g.length,1,"int32"),x=[i,o],N=gbe(l,b,w,x,"nearest");return Fi(f?it(R.unstack(N)):N,c)})},e.prototype.upsize=function(t,r,a,i){return R.tidy(function(){var o=mbe(t,[r,a]);return Fi(o,i)})},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i=it(t),o=i.dtype,s=i.shape,u=s[s.length-3],c=s[s.length-2],l=0;u!==a.height&&(l=Math.floor((u-a.height)/2));var f=0;return c!==a.width&&(f=Math.floor((c-a.width)/2),f===0&&(f=1)),l>=0&&f>=0?a.centerCrop(i,l,f,a.height,a.width,u,c,o):a.upsize(t,a.height,a.width,o)})},e.prototype.getConfig=function(){var t={height:this.height,width:this.width},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e.prototype.computeOutputShape=function(t){t=It(t);var r=t.length-3,a=t.length-2;return t[r]=this.height,t[a]=this.width,t},e}(gt);B1.className="CenterCrop";R.serialization.registerClass(B1);function ybe(n,e,t,r){var a=it(n);if(a.dtype!=="int32"&&(a=Fi(a,"int32")),e==="int")return a;var i=a.shape;if(a.rank===0&&(a=R.expandDims(a,-1)),e==="oneHot"&&a.shape[a.shape.length-1]!==1&&(a=R.expandDims(a,-1)),a.rank>2)throw new J("When outputMode is not int, maximum output rank is 2"+" Received outputMode ".concat(e," and input shape ").concat(i)+" which would result in output rank ".concat(a.rank,"."));var o=["multiHot","oneHot"].includes(e),s=a,u;if(typeof r<"u"&&e==="count"?u=R.denseBincount(s,r,t,o):u=R.denseBincount(s,[],t,o),e!=="tfIdf")return u;if(r)return R.mul(u,r);throw new J("When outputMode is 'tfIdf', weights must be provided.")}var L1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.numTokens=t.numTokens,t.outputMode?r.outputMode=t.outputMode:r.outputMode="multiHot",r}return e.prototype.getConfig=function(){var t={numTokens:this.numTokens,outputMode:this.outputMode},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e.prototype.computeOutputShape=function(t){return t=It(t),t==null?[this.numTokens]:this.outputMode==="oneHot"&&t[t.length-1]!==1?(t.push(this.numTokens),t):(t[t.length-1]=this.numTokens,t)},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){t=it(t),t.dtype!=="int32"&&(t=Fi(t,"int32"));var i;if(typeof r.countWeights<"u"){if(a.outputMode!=="count")throw new J(`countWeights is not used when outputMode !== count.
              Received countWeights=`.concat(r.countWeights));i=it(r.countWeights)}var o=R.max(t),s=R.min(t),u=R.greater(a.numTokens,o).bufferSync().get(0),c=R.greaterEqual(s,0).bufferSync().get(0);if(!(u&&c))throw new J("Input values must be between 0 < values <="+" numTokens with numTokens=".concat(a.numTokens));return ybe(t,a.outputMode,a.numTokens,i)})},e}(gt);L1.className="CategoryEncoding";R.serialization.registerClass(L1);var bbe=["bilinear","nearest"],RO=new Set(bbe),z1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;if(r.height=t.height,r.width=t.width,t.interpolation)if(RO.has(t.interpolation))r.interpolation=t.interpolation;else throw new J("Invalid interpolation parameter: ".concat(t.interpolation," is not implemented"));else r.interpolation="bilinear";return r.cropToAspectRatio=Boolean(t.cropToAspectRatio),r}return e.prototype.computeOutputShape=function(t){t=It(t);var r=t[2];return[this.height,this.width,r]},e.prototype.getConfig=function(){var t={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i=[a.height,a.width];if(a.interpolation==="bilinear")return R.image.resizeBilinear(t,i,!a.cropToAspectRatio);if(a.interpolation==="nearest")return R.image.resizeNearestNeighbor(t,i,!a.cropToAspectRatio);throw new Error("Interpolation is ".concat(a.interpolation," but only ").concat(Qe([],te(RO),!1)," are supported"))})},e}(gt);z1.className="Resizing";R.serialization.registerClass(z1);function wbe(n){return new vc(n)}function xbe(n){return new qb(n)}function kbe(n){return new Lb(n)}function Sbe(n){return new zb(n)}function Nbe(n){return new $b(n)}function Tbe(n){return new Vb(n)}function Ebe(n){return new Wb(n)}function Ibe(n){return new jb(n)}function Cbe(n){return new uv(n)}function Abe(n){return new Ub(n)}function Dbe(n){return new cv(n)}function _be(n){return new Hb(n)}function Fbe(n){return new Kb(n)}function Rbe(n){return new Xb(n)}function Obe(n){return new Yb(n)}function Pbe(n){return new Zb(n)}function Mbe(n){return new i1(n)}function Bbe(n){return new r1(n)}function Lbe(n){return new pv(n)}function zbe(n){return new n1(n)}function $be(n){return new a1(n)}function qbe(n){return new o1(n)}function Wbe(n){return new s1(n)}function Vbe(n){return new u1(n)}function Gbe(n){return new l1(n)}function Ube(n){return new f1(n)}function Hbe(n){return new d1(n)}function Kbe(n){return new m1(n)}function jbe(n){return new p1(n)}function Xbe(n){return new v1(n)}function Ybe(n){return new h1(n)}function Zbe(n){return new g1(n)}function Jbe(n){return new x1(n)}function Qbe(n){return new k1(n)}function e1e(n){return new S1(n)}function $1(n){return new T1(n)}function t1e(n){return $1(n)}function n1e(n){return $1(n)}function q1(n){return new I1(n)}function r1e(n){return q1(n)}function a1e(n){return q1(n)}function W1(n){return new A1(n)}function i1e(n){return W1(n)}function o1e(n){return W1(n)}function s1e(n){return new D1(n)}function u1e(n){return new F1(n)}function t4(n){return new _1(n)}function n4(n){return new R1(n)}function r4(n){return new N1(n)}function a4(n){return new E1(n)}function c1e(n){return new C1(n)}function l1e(n){return new Qb(n)}function f1e(n){return new fv(n)}function h1e(n){return new e1(n)}function d1e(n){return new Bf(n)}function p1e(n){return new Jb(n)}function v1e(n){return new lv(n)}function m1e(n){return new t1(n)}function g1e(n){return new dv(n)}function y1e(n){return new no(n)}function b1e(n){return new hv(n)}function w1e(n){return new P1(n)}function x1e(n){return new O1(n)}var k1e=t4,S1e=n4,N1e=r4,T1e=a4;function E1e(n){return new y1(n)}function I1e(n){return new b1(n)}function C1e(n){return new w1(n)}function A1e(n){return new c1(n)}function D1e(n){return new M1(n)}function _1e(n){return new B1(n)}function F1e(n){return new z1(n)}function R1e(n){return new L1(n)}var O1e={__proto__:null,inputLayer:wbe,elu:xbe,reLU:kbe,leakyReLU:Sbe,prelu:Nbe,softmax:Tbe,thresholdedReLU:Ebe,conv1d:Ibe,conv2d:Cbe,conv2dTranspose:Abe,conv3d:Dbe,conv3dTranspose:_be,separableConv2d:Fbe,cropping2D:Rbe,upSampling2d:Obe,depthwiseConv2d:Pbe,activation:Mbe,dense:Bbe,dropout:Lbe,spatialDropout1d:zbe,flatten:$be,repeatVector:qbe,reshape:Wbe,permute:Vbe,embedding:Gbe,add:Ube,average:Hbe,concatenate:Kbe,maximum:jbe,minimum:Xbe,multiply:Ybe,dot:Zbe,batchNormalization:Jbe,layerNormalization:Qbe,zeroPadding2d:e1e,averagePooling1d:$1,avgPool1d:t1e,avgPooling1d:n1e,averagePooling2d:q1,avgPool2d:r1e,avgPooling2d:a1e,averagePooling3d:W1,avgPool3d:i1e,avgPooling3d:o1e,globalAveragePooling1d:s1e,globalAveragePooling2d:u1e,globalMaxPooling1d:t4,globalMaxPooling2d:n4,maxPooling1d:r4,maxPooling2d:a4,maxPooling3d:c1e,gru:l1e,gruCell:f1e,lstm:h1e,lstmCell:d1e,simpleRNN:p1e,simpleRNNCell:v1e,convLstm2d:m1e,convLstm2dCell:g1e,rnn:y1e,stackedRNNCells:b1e,bidirectional:w1e,timeDistributed:x1e,globalMaxPool1d:k1e,globalMaxPool2d:S1e,maxPool1d:N1e,maxPool2d:T1e,Layer:gt,RNN:no,RNNCell:yc,input:IM,gaussianNoise:E1e,gaussianDropout:I1e,alphaDropout:C1e,masking:A1e,rescaling:D1e,centerCrop:_1e,resizing:F1e,categoryEncoding:R1e};function P1e(n,e){return Fb(n,e)}function M1e(n,e){return yM(n,e)}function B1e(n,e){return bM(n,e)}function L1e(n,e){return Rb(n,e)}function z1e(n,e){return Ob(n,e)}function $1e(n,e){return gM(n,e)}function q1e(n,e){return xye(n,e)}function W1e(n,e){return _b(n,e)}function V1e(n,e){return av(n,e)}function G1e(n,e){return gc(n,e)}function U1e(n,e){return gc(n,e)}function H1e(n,e){return gc(n,e)}function K1e(n,e){return Us(n,e)}function j1e(n,e){return Us(n,e)}function X1e(n,e){return Us(n,e)}var Y1e={__proto__:null,binaryAccuracy:P1e,binaryCrossentropy:M1e,sparseCategoricalAccuracy:B1e,categoricalAccuracy:L1e,categoricalCrossentropy:z1e,precision:$1e,recall:q1e,cosineProximity:W1e,meanAbsoluteError:V1e,meanAbsolutePercentageError:G1e,MAPE:U1e,mape:H1e,meanSquaredError:K1e,MSE:j1e,mse:X1e};var Z1e={__proto__:null,modelFromJSON:Yye};function J1e(n){return new Mf(n)}function Q1e(n){return rbe(n)}function ewe(n){return abe(n)}var twe={__proto__:null,l1l2:J1e,l1:Q1e,l2:ewe},i4=function(n){se(e,n);function e(){var t=n.apply(this,Qe([],te(arguments),!1))||this;return t.model=null,t}return e.prototype.setModel=function(t){if(!(t instanceof to))throw new Error("model must be a LayersModel, not some other Container");this.model=t},e}(pc);function kp(n,e){return n<e}function OO(n,e){return n>e}var o4=function(n){se(e,n);function e(t){var r=n.call(this)||this;if(t==null&&(t={}),t.restoreBestWeights)throw new pt("restoreBestWeights = True is not implemented in EarlyStopping yet.");return r.monitor=t.monitor||"val_loss",r.minDelta=Math.abs(t.minDelta||0),r.patience=t.patience||0,r.verbose=t.verbose||0,r.mode=t.mode||"auto",r.baseline=t.baseline,["auto","min","max"].indexOf(r.mode)===-1&&(console.warn("EarlyStopping mode '".concat(r.mode,"' is invalid. ")+"Falling back to mode 'auto'."),r.mode="auto"),r.mode==="min"?r.monitorFunc=kp:r.mode==="max"||r.monitor.indexOf("acc")!==-1?r.monitorFunc=OO:r.monitorFunc=kp,r.monitorFunc===kp&&(r.minDelta*=-1),r}return e.prototype.onTrainBegin=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){return this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===kp?1/0:-1/0,[2]})})},e.prototype.onEpochEnd=function(t,r){return Ce(this,void 0,void 0,function(){var a;return Ee(this,function(i){switch(i.label){case 0:return[4,Bo(r)];case 1:return i.sent(),a=this.getMonitorValue(r),a==null?[2]:(this.monitorFunc(a-this.minDelta,this.best)?(this.best=a,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=t,this.model.stopTraining=!0)),[2])}})})},e.prototype.onTrainEnd=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){return this.stoppedEpoch>0&&this.verbose&&console.log("Epoch ".concat(this.stoppedEpoch,": early stopping.")),[2]})})},e.prototype.getMonitorValue=function(t){t==null&&(t={});var r=t[this.monitor];return r==null&&console.warn("Metric for EarlyStopping ".concat(this.monitor," is not available. ")+"Available metrics are: ".concat(Object.keys(t))),r},e}(i4);function nwe(n){return new o4(n)}var rwe={earlyStopping:nwe};Qt.Callback=i4;Qt.CallbackList=fM;Qt.CustomCallback=dM;Qt.EarlyStopping=o4;Qt.History=hM;Qt.InputSpec=Ln;Qt.LayerVariable=UO;Qt.LayersModel=to;Qt.RNN=no;Qt.Sequential=ov;Qt.SymbolicTensor=si;Qt.callbacks=rwe;Qt.constraints=H0e;Qt.initializers=uye;Qt.input=IM;Qt.layers=O1e;Qt.loadLayersModel=Zye;Qt.metrics=Y1e;Qt.model=ebe;Qt.models=Z1e;Qt.registerCallbackConstructor=nbe;Qt.regularizers=twe;Qt.sequential=tbe;Qt.version_layers=Pb});var WB=Y(Xo=>{"use strict";Object.defineProperty(Xo,"__esModule",{value:!0});var Be=Cs();function awe(n){if(n&&n.__esModule)return n;var e=Object.create(null);return n&&Object.keys(n).forEach(function(t){if(t!=="default"){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}}),e.default=n,e}function iwe(n,e){return e.forEach(function(t){Object.keys(t).forEach(function(r){if(r!=="default"&&!(r in n)){var a=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,a.get?a:{enumerable:!0,get:function(){return t[r]}})}})}),n}var u4=awe(Be);var owe=Be.env();owe.registerFlag("KEEP_INTERMEDIATE_TENSORS",function(){return!1},function(n){n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});var j1=function(n,e){return j1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])},j1(n,e)};function swe(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");j1(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Pt(n,e,t,r){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(r.next(l))}catch(f){o(f)}}function u(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((r=r.apply(n,e||[])).next())})}function Dt(n,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(l){c=[6,l],a=0}finally{r=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Sc(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ne(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=r.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return i}function yn(n,e,t){if(t||arguments.length===2)for(var r=0,a=e.length,i;r<a;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}var za;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(za||(za={}));var c4;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(c4||(c4={}));var ww={};function uwe(n,e){var t={tfOpName:n,category:"custom",inputs:[],attrs:[],customExecutor:e};ww[n]=t}function z4(n){return ww[n]}function cwe(n){delete ww[n]}function I(n,e,t,r,a){var i=e.inputParams[n];if(i&&i.inputIndexStart!==void 0){var o=i.inputIndexStart,s=i.inputIndexEnd===0?void 0:i.inputIndexEnd===void 0?o+1:i.inputIndexEnd;if(i.type==="tensor")return gr(e.inputNames[i.inputIndexStart],t,r,a);if(i.type==="tensors"){var u=e.inputNames.slice(o,s);return u.map(function(h){return gr(h,t,r,a)})}var c=gr(e.inputNames.slice(o)[0],t,r,a),l=c.dataSync();return i.type==="number"?l[0]:Be.util.toNestedArray(c.shape,l)}var f=e.attrParams[n];return f&&f.value}function gr(n,e,t,r){var a=Ne(Zr(n),2),i=a[0],o=a[1];if(r!=null){var s=r.getHashTableHandleByName(i);if(s!=null)return s}var u=t.currentContextIds.find(function(c){return!!e[xv(i,c)]});return u!==void 0?e[xv(i,u)][o]:void 0}function lwe(n,e,t){return e[xv(n,t.currentContextId)]}function ro(n,e){var t=Ne(Zr(n),3),r=t[0],a=t[1],i=t[2];return[xv(r,e&&e.currentContextId),a,i]}function xv(n,e){return e?"".concat(n,"-").concat(e):n}function Zr(n){var e=n.split(":");if(e.length===1)return[n,0,void 0];var t=e[0],r=e.length===3?e[1]:void 0,a=Number(e[e.length-1]);return[t,a,r]}function gv(n,e,t){var r=I("pad",n,e,t);if(r==="explicit"){r=I("explicitPaddings",n,e,t);for(var a=[[0,0],[0,0],[0,0],[0,0]],i=0;i<4;i++)a[i][0]=r[i*2],a[i][1]=r[i*2+1];return a}return r}function ao(n){return n.kept?n:Be.clone(n)}var fwe=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],hwe={__proto__:null,json:fwe};var dwe=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],pwe={__proto__:null,json:dwe};var vwe=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],mwe={__proto__:null,json:vwe};var gwe=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],ywe={__proto__:null,json:gwe};var bwe=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],wwe={__proto__:null,json:bwe};var xwe=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],kwe={__proto__:null,json:xwe};var Swe=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],Nwe={__proto__:null,json:Swe};var Twe=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],Ewe={__proto__:null,json:Twe};var Iwe=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],Cwe={__proto__:null,json:Iwe};var Awe=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],Dwe={__proto__:null,json:Awe};var _we=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],Fwe={__proto__:null,json:_we};var Rwe=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}],Owe={__proto__:null,json:Rwe};var Pwe=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}],Mwe={__proto__:null,json:Pwe};var Bwe=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],Lwe={__proto__:null,json:Bwe};var zwe=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}],$we={__proto__:null,json:zwe};var qwe=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],Wwe={__proto__:null,json:qwe};var Vwe=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],Gwe={__proto__:null,json:Vwe};var Uwe=[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],Hwe={__proto__:null,json:Uwe};var Kwe=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],jwe={__proto__:null,json:Kwe},l4=function(){function n(){var e=[hwe,pwe,mwe,ywe,wwe,kwe,Nwe,Ewe,Cwe,Dwe,Fwe,Owe,Mwe,Lwe,$we,Wwe,Gwe,Hwe,jwe],t=[].concat.apply([],yn([],Ne(e.map(function(r){return r.json})),!1));this.opMappers=t.reduce(function(r,a){return r[a.tfOpName]=a,r},{})}return Object.defineProperty(n,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!1,configurable:!0}),n.prototype.transformGraph=function(e,t){var r=this;t===void 0&&(t={});var a=e.node,i=[],o=[],s=[],u=a.reduce(function(m,g){return m[g.name]=r.mapNode(g),g.op.startsWith("Placeholder")?i.push(m[g.name]):g.op==="Const"?o.push(m[g.name]):(g.input==null||g.input.length===0)&&s.push(m[g.name]),m},{}),c=[],l=[],f={},h={};t!=null&&(f=this.mapSignatureEntries(t.inputs),h=this.mapSignatureEntries(t.outputs));var d=Object.keys(u);d.forEach(function(m){var g=u[m];g.inputNames.forEach(function(y,b){var w=Ne(ro(y),3),x=w[0],N=w[2],T=u[x];if(T.outputs!=null){var E=T.outputs.indexOf(N);if(E!==-1){var C="".concat(x,":").concat(E);g.inputNames[b]=C}}g.inputs.push(T),T.children.push(g)})}),Object.keys(h).length===0?d.forEach(function(m){var g=u[m];g.children.length===0&&l.push(g)}):Object.keys(h).forEach(function(m){var g=Ne(ro(m),1),y=g[0],b=u[y];b!=null&&(b.signatureKey=h[m],l.push(b))}),Object.keys(f).length>0?Object.keys(f).forEach(function(m){var g=Ne(ro(m),1),y=g[0],b=u[y];b&&(b.signatureKey=f[m],c.push(b))}):c=i;var p={};e.library!=null&&e.library.function!=null&&(p=e.library.function.reduce(function(m,g){return m[g.signature.name]=r.mapFunction(g),m},{}));var v={nodes:u,inputs:c,outputs:l,weights:o,placeholders:i,signature:t,functions:p};return s.length>0&&(v.initNodes=s),v},n.prototype.mapSignatureEntries=function(e){return Object.keys(e||{}).reduce(function(t,r){return t[e[r].name]=r,t},{})},n.prototype.mapNode=function(e){var t=z4(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});var r={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(function(a){return a.startsWith("^")?a.slice(1):a}),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return t.inputs!=null&&(r.inputParams=t.inputs.reduce(function(a,i){return a[i.name]={type:i.type,inputIndexStart:i.start,inputIndexEnd:i.end},a},{})),t.attrs!=null&&(r.attrParams=t.attrs.reduce(function(a,i){var o=i.type,s=void 0;switch(i.type){case"string":s=X1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=X1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"string[]":s=nw(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=nw(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number":s=Z1(e.attr,i.tfName,i.defaultValue||0),s===void 0&&!!i.tfDeprecatedName&&(s=Z1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number[]":s=tw(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=tw(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool":s=Y1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=Y1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool[]":s=aw(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=aw(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape":s=ew(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=ew(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape[]":s=rw(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=rw(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype":s=J1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=J1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype[]":s=Q1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=Q1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"func":s=f4(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=f4(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: ".concat(i.type," for op: ").concat(e.op))}return a[i.name]={value:s,type:o},a},{})),r},n.prototype.mapFunction=function(e){var t=this,r=e.nodeDef,a=[],i=[],o={};r!=null&&(o=r.reduce(function(h,d){return h[d.name]=t.mapNode(d),d.op==="Const"&&i.push(h[d.name]),h},{}));var s=[],u=[];e.signature.inputArg.forEach(function(h){var d=Ne(ro(h.name),1),p=d[0],v={name:p,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:xw(h.type),type:"dtype"}},children:[]};v.signatureKey=h.name,s.push(v),o[p]=v});var c=Object.keys(o);c.forEach(function(h){var d=o[h];d.inputNames.forEach(function(p,v){var m=Ne(ro(p),3),g=m[0],y=m[2],b=o[g];if(b.outputs!=null){var w=b.outputs.indexOf(y);if(w!==-1){var x="".concat(g,":").concat(w);d.inputNames[v]=x}}d.inputs.push(b),b.children.push(d)})});var l=e.ret;e.signature.outputArg.forEach(function(h){var d=Ne(ro(l[h.name]),2),p=d[0],v=d[1],m=o[p];m!=null&&(m.defaultOutput=v,u.push(m))});var f=this.mapArgsToSignature(e);return{nodes:o,inputs:s,outputs:u,weights:i,placeholders:a,signature:f}},n.prototype.mapArgsToSignature=function(e){var t=this;return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce(function(r,a){return r[a.name]=t.mapArgToTensorInfo(a),r},{}),outputs:e.signature.outputArg.reduce(function(r,a){return r[a.name]=t.mapArgToTensorInfo(a,e.ret),r},{})}},n.prototype.mapArgToTensorInfo=function(e,t){var r=e.name;return t!=null&&(r=t[r]),{name:r,dtype:e.type}},n}();function Xwe(n){var e=Be.env().global;if(typeof e.atob<"u")return e.atob(n);if(typeof Buffer<"u")return new Buffer(n,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function $4(n,e){var t=Array.isArray(n)?String.fromCharCode.apply(null,n):Xwe(n);return e?t:t.toLowerCase()}function X1(n,e,t,r){r===void 0&&(r=!1);var a=n[e];return a!=null?$4(a.s,r):t}function Y1(n,e,t){var r=n[e];return r?r.b:t}function Z1(n,e,t){var r=n[e]||{},a=r.i!=null?r.i:r.f!=null?r.f:t;return typeof a=="number"?a:parseInt(a,10)}function xw(n){switch(typeof n=="string"&&(n=za[n]),n){case za.DT_FLOAT:case za.DT_HALF:return"float32";case za.DT_INT32:case za.DT_INT64:case za.DT_INT8:case za.DT_UINT8:return"int32";case za.DT_BOOL:return"bool";case za.DT_DOUBLE:return"float32";case za.DT_STRING:return"string";default:return null}}function f4(n,e,t){var r=n[e];return r&&r.func?r.func.name:t}function J1(n,e,t){var r=n[e];return r&&r.type?xw(r.type):t}function Q1(n,e,t){var r=n[e];return r&&r.list&&r.list.type?r.list.type.map(function(a){return xw(a)}):t}function q4(n){if(!n.unknownRank)return n.dim!=null?n.dim.map(function(e){return typeof e.size=="number"?e.size:parseInt(e.size,10)}):[]}function ew(n,e,t){var r=n[e];return r&&r.shape?q4(r.shape):t}function tw(n,e,t){var r=n[e];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map(function(a){return typeof a=="number"?a:parseInt(a,10)}):t}function nw(n,e,t,r){r===void 0&&(r=!1);var a=n[e];return a&&a.list&&a.list.s?a.list.s.map(function(i){return $4(i,r)}):t}function rw(n,e,t){var r=n[e];return r&&r.list&&r.list.shape?r.list.shape.map(function(a){return q4(a)}):t}function aw(n,e,t){var r=n[e];return r&&r.list&&r.list.b?r.list.b:t}var Ywe=function(){function n(e,t,r){var a=this;this.node=e,this.tensorMap=t,this.context=r,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(function(i){return a.getInput(i)}),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce(function(i,o){return i[o]=a.getAttr(o),i},{}))}return n.prototype.getInput=function(e){return gr(e,this.tensorMap,this.context)},n.prototype.getAttr=function(e,t){var r=this.node.rawAttrs[e];if(r.tensor!=null)return gr(e,this.tensorMap,this.context);if(r.i!=null||r.f!=null)return Z1(this.node.rawAttrs,e,t);if(r.s!=null)return X1(this.node.rawAttrs,e,t);if(r.b!=null)return Y1(this.node.rawAttrs,e,t);if(r.shape!=null)return ew(this.node.rawAttrs,e,t);if(r.type!=null)return J1(this.node.rawAttrs,e,t);if(r.list!=null){if(r.list.i!=null||r.list.f!=null)return tw(this.node.rawAttrs,e,t);if(r.list.s!=null)return nw(this.node.rawAttrs,e,t);if(r.list.shape!=null)return rw(this.node.rawAttrs,e,t);if(r.list.b!=null)return aw(this.node.rawAttrs,e,t);if(r.list.type!=null)return Q1(this.node.rawAttrs,e,t)}return t},n}();var Zwe=1e-7,Jwe=1e-4,Qwe=function(){function n(){}return n.prototype.refCount=function(e){return Yr("refCount")},n.prototype.incRef=function(e){return Yr("incRef")},n.prototype.timerAvailable=function(){return!0},n.prototype.time=function(e){return Yr("time")},n.prototype.read=function(e){return Yr("read")},n.prototype.readSync=function(e){return Yr("readSync")},n.prototype.readToGPU=function(e,t){return Yr("readToGPU")},n.prototype.numDataIds=function(){return Yr("numDataIds")},n.prototype.disposeData=function(e,t){return Yr("disposeData")},n.prototype.write=function(e,t,r){return Yr("write")},n.prototype.move=function(e,t,r,a,i){return Yr("move")},n.prototype.createTensorFromGPUData=function(e,t,r){return Yr("createTensorFromGPUData")},n.prototype.memory=function(){return Yr("memory")},n.prototype.floatPrecision=function(){return Yr("floatPrecision")},n.prototype.epsilon=function(){return this.floatPrecision()===32?Zwe:Jwe},n.prototype.dispose=function(){return Yr("dispose")},n}();function Yr(n){throw new Error("'".concat(n,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function G(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function Ua(n,e,t){t===void 0&&(t=""),G(Ac(n,e),function(){return t+" Shapes ".concat(n," and ").concat(e," must match")})}function Cc(n){G(n!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Fr(n){if(n.length===0)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function Ac(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Hf(n){return n%1===0}function yv(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function Dv(n,e){var t=e.length;return n=n==null?e.map(function(r,a){return a}):[].concat(n),G(n.every(function(r){return r>=-t&&r<t}),function(){return"All values in axis param must be in range [-".concat(t,", ").concat(t,") but ")+"got axis ".concat(n)}),G(n.every(function(r){return Hf(r)}),function(){return"All values in axis param must be integers but "+"got axis ".concat(n)}),n.map(function(r){return r<0?t+r:r})}function exe(n,e){for(var t=[],r=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:Dv(e,n).sort(),o=0,s=0;s<n.length;++s){if(i!=null){if(i[o]===s&&n[s]!==1)throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(n[s],"' is not 1"));(i[o]==null||i[o]>s)&&n[s]===1&&(t.push(n[s]),r.push(s)),i[o]<=s&&o++}n[s]!==1&&(t.push(n[s]),r.push(s))}return{newShape:t,keptDims:r}}function txe(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else throw new Error("Unknown data type ".concat(n));return t}function nxe(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error("Unknown data type ".concat(n));return t}function rxe(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(e," being uploaded contains ").concat(r,"."))}}function axe(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function iw(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype ".concat(n))}function ixe(n){if(n==null)return 0;var e=0;return n.forEach(function(t){return e+=t.length}),e}function kw(n){return typeof n=="string"||n instanceof String}function oxe(n){return typeof n=="boolean"}function sxe(n){return typeof n=="number"}function Sw(n){return Array.isArray(n)?Sw(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":sxe(n)?"float32":kw(n)?"string":oxe(n)?"bool":"float32"}function h4(n){return!!(n&&n.constructor&&n.call&&n.apply)}function Nw(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function W4(n,e,t,r){r===void 0&&(r=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(r?2:1),o=0;o<i;o++)a[o]=t[n+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(l,f){return l*f})*(r?2:1),o=0;o<i;o++)a[o]=W4(n+o*u,s,t,r);return a}function d4(n,e,t){if(t===void 0&&(t=!1),n.length===0)return e[0];var r=n.reduce(function(a,i){return a*i})*(t?2:1);if(r===0)return[];if(r!==e.length)throw new Error("[".concat(n,"] does not match the input size ").concat(e.length).concat(t?" for a complex tensor":"","."));return W4(0,n,e,t)}function V4(n,e){for(var t=Tw(n,e),r=0;r<t.length;r++)t[r]=1;return t}function Tw(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error("Unknown data type ".concat(e))}function ga(n){n.forEach(function(e){G(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(n,"].")})})}function Ew(n){return n&&n.then&&typeof n.then=="function"}var p4="tfjsflags",uxe=function(){function n(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=cxe,this.populateURLFlags()}return n.prototype.setPlatform=function(e,t){this.platform!=null&&(ma().getBool("IS_TEST")||ma().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t},n.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){var a=this.urlFlags[e];ma().getBool("IS_TEST")||ma().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(a,".")),this.set(e,a)}},n.prototype.getAsync=function(e){return Pt(this,void 0,void 0,function(){var t,r;return Dt(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,r=e,[4,this.evaluateFlag(e)]);case 1:return t[r]=a.sent(),[2,this.flags[e]]}})})},n.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(Ew(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},n.prototype.getNumber=function(e){return this.get(e)},n.prototype.getBool=function(e){return this.get(e)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!1,configurable:!0}),n.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},n.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()},n.prototype.setFlags=function(e){this.flags=Object.assign({},e)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if(p4 in t){var r=t[p4].split(",");r.forEach(function(a){var i=Ne(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=fxe(o,s)})}}},n}();function cxe(n){var e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];return lxe(e,r[0],r[1]),r.join("=")}),e}function lxe(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function fxe(n,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if("".concat(+e)===e)return+e;throw new Error("Could not parse value flag value ".concat(e," for flag ").concat(n,"."))}function ma(){return G4}var G4=null;function hxe(n){G4=n}var V1;function U4(){if(V1==null){var n=void 0;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");V1=n}return V1}function dxe(){var n=U4();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function Iw(n,e){var t=dxe();if(t.has(n))return t.get(n);var r=e();return t.set(n,r),t.get(n)}var pxe="Abs",vxe="Acos",mxe="Acosh",H4="Add",gxe="AddN",yxe="All",bxe="Any",wxe="ArgMax",xxe="ArgMin",kxe="Asin",Sxe="Asinh",Nxe="Atan",Txe="Atanh",Exe="Atan2",Ixe="AvgPool",Cxe="AvgPool3D",Axe="BatchMatMul",Dxe="BatchToSpaceND",_xe="Bincount",Fxe="BroadcastArgs",K4="Cast",Rxe="Ceil",Oxe="ClipByValue",Pxe="Complex",Mxe="ComplexAbs",Bxe="Concat",Lxe="Conv2D",zxe="Conv2DBackpropFilter",$xe="Conv2DBackpropInput",qxe="Conv3D",Wxe="Conv3DBackpropInputV2",Vxe="Cos",Gxe="Cosh",Uxe="Cumprod",Hxe="Cumsum",Kxe="CropAndResize",jxe="DenseBincount",Xxe="DepthToSpace",Yxe="DepthwiseConv2dNative",Zxe="DepthwiseConv2dNativeBackpropFilter",Jxe="DepthwiseConv2dNativeBackpropInput",Qxe="Diag",eke="Dilation2D",tke="RealDiv",nke="Einsum",rke="Elu",ake="Erf",ike="Equal",oke="Exp",ske="ExpandDims",uke="Expm1",cke="FFT",lke="Fill",fke="FlipLeftRight",hke="Floor",dke="FloorDiv",pke="FusedBatchNorm",vke="GatherV2",mke="GatherNd",gke="Greater",yke="GreaterEqual",j4="Identity",bke="IFFT",wke="Imag",xke="IsFinite",kke="IsInf",Ske="IsNan",Nke="LeakyRelu",Tke="Less",Eke="LessEqual",Ike="LinSpace",Cke="Log",Ake="Log1p",Dke="LogicalAnd",_ke="LogicalNot",Fke="LogicalOr",Rke="LRN",Oke="Max",Pke="Maximum",Mke="MaxPool",Bke="MaxPool3D",Lke="MaxPoolWithArgmax",zke="Mean",$ke="Min",qke="Minimum",Wke="MirrorPad",Vke="Mod",Gke="Multinomial",Uke="Multiply",Hke="Neg",Kke="NotEqual",jke="NonMaxSuppressionV3",Xke="NonMaxSuppressionV4",Yke="NonMaxSuppressionV5",Zke="OnesLike",Jke="OneHot",Qke="Pack",e2e="PadV2",t2e="Pow",n2e="Prelu",r2e="Prod",a2e="RaggedGather",i2e="RaggedRange",o2e="RaggedTensorToTensor",s2e="Range",u2e="Real",c2e="Reciprocal",l2e="Relu",f2e="Reshape",h2e="ResizeNearestNeighbor",d2e="ResizeBilinear",p2e="Relu6",v2e="Reverse",m2e="Round",g2e="Rsqrt",y2e="ScatterNd",b2e="SearchSorted",w2e="Select",x2e="Selu",k2e="Slice",S2e="Sin",N2e="Sinh",T2e="Sign",E2e="Sigmoid",I2e="Softplus",C2e="Sqrt",A2e="Sum",D2e="SpaceToBatchND",_2e="SplitV",F2e="Softmax",R2e="SparseFillEmptyRows",O2e="SparseReshape",P2e="SparseSegmentMean",M2e="SparseSegmentSum",B2e="SparseToDense",L2e="SquaredDifference",z2e="StridedSlice",$2e="StringNGrams",q2e="StringSplit",W2e="StringToHashBucketFast",V2e="Sub",G2e="Tan",U2e="Tanh",X4="Tile",H2e="TopK",K2e="Transform",G1="Transpose",j2e="Unique",X2e="Unpack",Y2e="UnsortedSegmentSum",Z2e="ZerosLike",J2e="Step",Q2e="RotateWithOffset",v4="_FusedMatMul",m4="FusedConv2D",g4="FusedDepthwiseConv2D";function Lf(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];ma().getBool("IS_TEST")||ma().getBool("PROD")||console.warn.apply(console,yn([],Ne(n),!1))}var Y4=Iw("kernelRegistry",function(){return new Map}),eSe=Iw("gradRegistry",function(){return new Map});function y4(n,e){var t=tSe(n,e);return Y4.get(t)}function b4(n){return eSe.get(n)}function w4(n){for(var e=Y4.entries(),t=[];;){var r=e.next(),a=r.done,i=r.value;if(a)break;var o=Ne(i,2),s=o[0],u=o[1],c=Ne(s.split("_"),1),l=c[0];l===n&&t.push(u)}return t}function tSe(n,e){return"".concat(e,"_").concat(n)}var ow=tn,Wa=null;try{Wa=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function tn(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}tn.prototype.__isLong__;Object.defineProperty(tn.prototype,"__isLong__",{value:!0});function ea(n){return(n&&n.__isLong__)===!0}tn.isLong=ea;var x4={},k4={};function Qs(n,e){var t,r,a;return e?(n>>>=0,(a=0<=n&&n<256)&&(r=k4[n],r)?r:(t=nn(n,(n|0)<0?-1:0,!0),a&&(k4[n]=t),t)):(n|=0,(a=-128<=n&&n<128)&&(r=x4[n],r)?r:(t=nn(n,n<0?-1:0,!1),a&&(x4[n]=t),t))}tn.fromInt=Qs;function Va(n,e){if(isNaN(n))return e?js:Ga;if(e){if(n<0)return js;if(n>=Z4)return eB}else{if(n<=-N4)return Jr;if(n+1>=N4)return Q4}return n<0?Va(-n,e).neg():nn(n%Nc|0,n/Nc|0,e)}tn.fromNumber=Va;function nn(n,e,t){return new tn(n,e,t)}tn.fromBits=nn;var kv=Math.pow;function Cw(n,e,t){if(n.length===0)throw Error("empty string");if(n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return Ga;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var r;if((r=n.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return Cw(n.substring(1),e,t).neg();for(var a=Va(kv(t,8)),i=Ga,o=0;o<n.length;o+=8){var s=Math.min(8,n.length-o),u=parseInt(n.substring(o,o+s),t);if(s<8){var c=Va(kv(t,s));i=i.mul(c).add(Va(u))}else i=i.mul(a),i=i.add(Va(u))}return i.unsigned=e,i}tn.fromString=Cw;function bi(n,e){return typeof n=="number"?Va(n,e):typeof n=="string"?Cw(n,e):nn(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}tn.fromValue=bi;var S4=1<<16,nSe=1<<24,Nc=S4*S4,Z4=Nc*Nc,N4=Z4/2,T4=Qs(nSe),Ga=Qs(0);tn.ZERO=Ga;var js=Qs(0,!0);tn.UZERO=js;var bc=Qs(1);tn.ONE=bc;var J4=Qs(1,!0);tn.UONE=J4;var sw=Qs(-1);tn.NEG_ONE=sw;var Q4=nn(-1,2147483647,!1);tn.MAX_VALUE=Q4;var eB=nn(-1,-1,!0);tn.MAX_UNSIGNED_VALUE=eB;var Jr=nn(0,-2147483648,!1);tn.MIN_VALUE=Jr;var Re=tn.prototype;Re.toInt=function(){return this.unsigned?this.low>>>0:this.low};Re.toNumber=function(){return this.unsigned?(this.high>>>0)*Nc+(this.low>>>0):this.high*Nc+(this.low>>>0)};Re.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Jr)){var t=Va(e),r=this.div(t),a=r.mul(t).sub(this);return r.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Va(kv(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};Re.getHighBits=function(){return this.high};Re.getHighBitsUnsigned=function(){return this.high>>>0};Re.getLowBits=function(){return this.low};Re.getLowBitsUnsigned=function(){return this.low>>>0};Re.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Jr)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};Re.isZero=function(){return this.high===0&&this.low===0};Re.eqz=Re.isZero;Re.isNegative=function(){return!this.unsigned&&this.high<0};Re.isPositive=function(){return this.unsigned||this.high>=0};Re.isOdd=function(){return(this.low&1)===1};Re.isEven=function(){return(this.low&1)===0};Re.equals=function(e){return ea(e)||(e=bi(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Re.eq=Re.equals;Re.notEquals=function(e){return!this.eq(e)};Re.neq=Re.notEquals;Re.ne=Re.notEquals;Re.lessThan=function(e){return this.comp(e)<0};Re.lt=Re.lessThan;Re.lessThanOrEqual=function(e){return this.comp(e)<=0};Re.lte=Re.lessThanOrEqual;Re.le=Re.lessThanOrEqual;Re.greaterThan=function(e){return this.comp(e)>0};Re.gt=Re.greaterThan;Re.greaterThanOrEqual=function(e){return this.comp(e)>=0};Re.gte=Re.greaterThanOrEqual;Re.ge=Re.greaterThanOrEqual;Re.compare=function(e){if(ea(e)||(e=bi(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Re.comp=Re.compare;Re.negate=function(){return!this.unsigned&&this.eq(Jr)?Jr:this.not().add(bc)};Re.neg=Re.negate;Re.add=function(e){ea(e)||(e=bi(e));var t=this.high>>>16,r=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,d=0;return d+=i+c,h+=d>>>16,d&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=r+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,nn(h<<16|d,l<<16|f,this.unsigned)};Re.subtract=function(e){return ea(e)||(e=bi(e)),this.add(e.neg())};Re.sub=Re.subtract;Re.multiply=function(e){if(this.isZero())return Ga;if(ea(e)||(e=bi(e)),Wa){var t=Wa.mul(this.low,this.high,e.low,e.high);return nn(t,Wa.get_high(),this.unsigned)}if(e.isZero())return Ga;if(this.eq(Jr))return e.isOdd()?Jr:Ga;if(e.eq(Jr))return this.isOdd()?Jr:Ga;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(T4)&&e.lt(T4))return Va(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,d=0,p=0;return p+=o*l,d+=p>>>16,p&=65535,d+=i*l,h+=d>>>16,d&=65535,d+=o*c,h+=d>>>16,d&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=r*l+a*c+i*u+o*s,f&=65535,nn(d<<16|p,f<<16|h,this.unsigned)};Re.mul=Re.multiply;Re.divide=function(e){if(ea(e)||(e=bi(e)),e.isZero())throw Error("division by zero");if(Wa){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Wa.div_u:Wa.div_s)(this.low,this.high,e.low,e.high);return nn(t,Wa.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?js:Ga;var r,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return js;if(e.gt(this.shru(1)))return J4;i=js}else{if(this.eq(Jr)){if(e.eq(bc)||e.eq(sw))return Jr;if(e.eq(Jr))return bc;var o=this.shr(1);return r=o.div(e).shl(1),r.eq(Ga)?e.isNegative()?bc:sw:(a=this.sub(e.mul(r)),i=r.add(a.div(e)),i)}else if(e.eq(Jr))return this.unsigned?js:Ga;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Ga}for(a=this;a.gte(e);){r=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(r)/Math.LN2),u=s<=48?1:kv(2,s-48),c=Va(r),l=c.mul(e);l.isNegative()||l.gt(a);)r-=u,c=Va(r,this.unsigned),l=c.mul(e);c.isZero()&&(c=bc),i=i.add(c),a=a.sub(l)}return i};Re.div=Re.divide;Re.modulo=function(e){if(ea(e)||(e=bi(e)),Wa){var t=(this.unsigned?Wa.rem_u:Wa.rem_s)(this.low,this.high,e.low,e.high);return nn(t,Wa.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Re.mod=Re.modulo;Re.rem=Re.modulo;Re.not=function(){return nn(~this.low,~this.high,this.unsigned)};Re.and=function(e){return ea(e)||(e=bi(e)),nn(this.low&e.low,this.high&e.high,this.unsigned)};Re.or=function(e){return ea(e)||(e=bi(e)),nn(this.low|e.low,this.high|e.high,this.unsigned)};Re.xor=function(e){return ea(e)||(e=bi(e)),nn(this.low^e.low,this.high^e.high,this.unsigned)};Re.shiftLeft=function(e){return ea(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?nn(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):nn(0,this.low<<e-32,this.unsigned)};Re.shl=Re.shiftLeft;Re.shiftRight=function(e){return ea(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?nn(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):nn(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Re.shr=Re.shiftRight;Re.shiftRightUnsigned=function(e){if(ea(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var r=this.low;return nn(r>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?nn(t,0,this.unsigned):nn(t>>>e-32,0,this.unsigned)};Re.shru=Re.shiftRightUnsigned;Re.shr_u=Re.shiftRightUnsigned;Re.toSigned=function(){return this.unsigned?nn(this.low,this.high,!1):this};Re.toUnsigned=function(){return this.unsigned?this:nn(this.low,this.high,!0)};Re.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Re.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Re.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};tn.fromBytes=function(e,t,r){return r?tn.fromBytesLE(e,t):tn.fromBytesBE(e,t)};tn.fromBytesLE=function(e,t){return new tn(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};tn.fromBytesBE=function(e,t){return new tn(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var rSe=iwe({__proto__:null,default:ow},[ow]),aSe=ow||rSe;function Aw(n){return aSe.fromString(n,!0,16)}Aw("c3a5c85c97cb3127");Aw("b492b66fbe98f273");Aw("9ae16a3b2f90404f");function iSe(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function tB(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Kf(n)),ma().getBool("DEBUG")&&rxe(n,e),iSe(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){for(var t=new Uint8Array(n.length),r=0;r<t.length;++r)Math.round(n[r])!==0&&(t[r]=1);return t}else throw new Error("Unknown data type ".concat(e))}function Sv(){return ma().platform.now()}function oSe(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",ma().platform.encode(n,e)}function E4(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",ma().platform.decode(n,e)}function yi(n){return ma().platform.isTypedArray(n)}function Kf(n,e,t){var r,a;if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||Ew(n)||n==null||yi(n)&&t)e.push(n);else if(Array.isArray(n)||yi(n))for(var i=0;i<n.length;++i)Kf(n[i],e,t);else{var o=-1;try{for(var s=Sc(Object.keys(n)),u=s.next();!u.done;u=s.next()){var c=u.value;/^([1-9]+[0-9]*|0)$/.test(c)&&(o=Math.max(o,Number(c)))}}catch(l){r={error:l}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}for(var i=0;i<=o;i++)Kf(n[i],e,t)}return e}var sSe=function(){function n(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new cSe)}return n.prototype.profileKernel=function(e,t,r){var a,i,o,s=function(){o=r()},u,c=Sv();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var l=Sc(o),f=l.next();!f.done;f=l.next()){var h=f.value;h.dataSync()}}catch(m){a={error:m}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:Sv()-c})}if(ma().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var d=function(m){var g=o[m];g.data().then(function(y){uSe(y,g.dtype,e)})},p=0;p<o.length;p++)d(p);var v={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(m){return m.kernelMs}),extraInfo:u.then(function(m){return m.getExtraProfileInfo!=null?m.getExtraProfileInfo():""})};return v},n.prototype.logKernelProfile=function(e){var t=this,r=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(c){t.logger.logKernelProfile(r,u,c[0],c[1],o,c[2])})})},n}();function uSe(n,e,t){if(e!=="float32")return!1;for(var r=0;r<n.length;r++){var a=n[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(t,"'")),!0}return!1}var cSe=function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,a,i,o){var s=typeof a=="number"?yv("".concat(a,"ms"),9):a.error,u=yv(e,25),c=t.rank,l=t.size,f=yv(t.shape.toString(),14),h="";for(var d in i){var p=i[d];if(p!=null){var v=p.shape||t.shape,m=v.length;h+="".concat(d,": ").concat(m,"D ").concat(m>0?v:""," ")}}console.log("%c".concat(u,"	%c").concat(s,"	%c").concat(c,"D ").concat(f,"	%c").concat(l,"	%c").concat(h,"	%c").concat(o),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n}();function lSe(n,e,t){for(var r={},a={},i=0;i<e.length;i++)r[e[i].id]=!0;for(var i=0;i<n.length;i++){var o=n[i],s=o.inputs;for(var u in s){for(var c=s[u],l=!1,f=0;f<e.length;f++)if(r[c.id]){o.outputs.forEach(function(b){return r[b.id]=!0}),l=!0,a[o.id]=!0;break}if(l)break}}var h={};h[t.id]=!0;for(var d={},i=n.length-1;i>=0;i--)for(var o=n[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,d[o.id]=!0;break}for(var p=[],i=0;i<n.length;i++){var o=n[i];if(a[o.id]&&d[o.id]){var v={};for(var u in o.inputs){var m=o.inputs[u];r[m.id]&&(v[u]=m)}var g=Object.assign({},o);g.inputs=v,g.outputs=o.outputs,p.push(g)}}return p}function fSe(n,e,t,r){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var d=n[h.id];d!=null?u.push(d):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(s.kernelName,"."));var c=s.gradient(u),l=function(h){if(!(h in c))throw new Error("Cannot backprop through input ".concat(h,". ")+"Available gradients found: ".concat(Object.keys(c),"."));var d=t(function(){return c[h]()});if(d.dtype!=="float32")throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"".concat(h," must have 'float32' dtype, but has '").concat(d.dtype,"'"));var p=s.inputs[h];if(!Ac(d.shape,p.shape))throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"'".concat(h,"' has shape '").concat(d.shape,"', which does not match ")+"the shape of the input '".concat(p.shape,"'"));if(n[p.id]==null)n[p.id]=d;else{var v=n[p.id];n[p.id]=r(v,d),v.dispose()}};for(var f in s.inputs)l(f)},i=e.length-1;i>=0;i--)a(i)}var I4=20,zf=3,U1=7;function hSe(n,e,t,r){var a=Nw(e),i=dSe(n,e,t,a),o=e.length,s=bv(n,e,t,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(t)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(e,"]")),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function dSe(n,e,t,r){var a=Fr(e),i=r[r.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?Vf(n):n;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,f=0;f<i;f++)o[f]=Math.max(o[f],Wf(u[l+f],0,t).length);return o}function Wf(n,e,t){var r;return Array.isArray(n)?r="".concat(parseFloat(n[0].toFixed(U1))," + ")+"".concat(parseFloat(n[1].toFixed(U1)),"j"):kw(n)?r="'".concat(n,"'"):t==="bool"?r=nB(n):r=parseFloat(n.toFixed(U1)).toString(),yv(r,e)}function nB(n){return n===0?"false":"true"}function bv(n,e,t,r,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var c=Vf(n);return[Wf(c[0],0,t)]}return t==="bool"?[nB(n[0])]:[n[0].toString()]}if(u===1){if(s>I4){var l=zf*o,f=Array.from(n.slice(0,l)),h=Array.from(n.slice((s-zf)*o,s*o));return t==="complex64"&&(f=Vf(f),h=Vf(h)),["["+f.map(function(T,E){return Wf(T,a[E],t)}).join(", ")+", ..., "+h.map(function(T,E){return Wf(T,a[s-zf+E],t)}).join(", ")+"]"]}var d=t==="complex64"?Vf(n):Array.from(n);return["["+d.map(function(T,E){return Wf(T,a[E],t)}).join(", ")+"]"]}var p=e.slice(1),v=r.slice(1),m=r[0]*o,g=[];if(s>I4){for(var y=0;y<zf;y++){var b=y*m,w=b+m;g.push.apply(g,yn([],Ne(bv(n.slice(b,w),p,t,v,a,!1)),!1))}g.push("...");for(var y=s-zf;y<s;y++){var b=y*m,w=b+m;g.push.apply(g,yn([],Ne(bv(n.slice(b,w),p,t,v,a,y===s-1)),!1))}}else for(var y=0;y<s;y++){var b=y*m,w=b+m;g.push.apply(g,yn([],Ne(bv(n.slice(b,w),p,t,v,a,y===s-1)),!1))}var x=u===2?",":"";g[0]="["+(s>0?g[0]+x:"");for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+x;for(var N=`,
`,y=2;y<u;y++)N+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":N),g}function Vf(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var uw=function(){function n(e,t,r){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=Fr(e),r!=null){var i=r.length;G(i===this.size,function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||nxe(t,this.size),this.strides=Nw(e)}return n.prototype.set=function(e){for(var t=this,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];r.length===0&&(r=[0]),G(r.length===this.rank,function(){return"The number of provided coordinates (".concat(r.length,") must ")+"match the rank (".concat(t.rank,")")});var i=this.locToIndex(r);this.values[i]=e},n.prototype.get=function(){for(var e,t,r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];r.length===0&&(r=[0]);var i=0;try{for(var o=Sc(r),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var c="Requested out of range element at ".concat(r,". ")+"  Buffer shape=".concat(this.shape);throw new Error(c)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var l=r[r.length-1],f=0;f<r.length-1;++f)l+=this.strides[f]*r[f];return this.values[l]},n.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),n.prototype.toTensor=function(){return mi().makeTensor(this.values,this.shape,this.dtype)},n}(),mi=null,$f=null;function pSe(n){mi=n}var Dr=function(){function n(e,t,r,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Fr(e),this.strides=Nw(e),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),n.prototype.buffer=function(){return Pt(this,void 0,void 0,function(){var e;return Dt(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,$f.buffer(this.shape,this.dtype,e)]}})})},n.prototype.bufferSync=function(){return $f.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return Pt(this,void 0,void 0,function(){var e;return Dt(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,d4(this.shape,e,this.dtype==="complex64")]}})})},n.prototype.arraySync=function(){return d4(this.shape,this.dataSync(),this.dtype==="complex64")},n.prototype.data=function(){return Pt(this,void 0,void 0,function(){var e,t;return Dt(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=mi().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=r.sent();try{return[2,t.map(function(a){return E4(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}})})},n.prototype.dataToGPU=function(e){return this.throwIfDisposed(),mi().readToGPU(this.dataId,e)},n.prototype.dataSync=function(){this.throwIfDisposed();var e=mi().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return E4(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},n.prototype.bytes=function(){return Pt(this,void 0,void 0,function(){var e;return Dt(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,mi().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},n.prototype.dispose=function(){this.isDisposed||(mi().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!1,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.print=function(e){return e===void 0&&(e=!1),$f.print(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),$f.clone(this)},n.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return hSe(t,this.shape,this.dtype,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),$f.cast(this,e)},n.prototype.variable=function(e,t,r){return e===void 0&&(e=!0),this.throwIfDisposed(),mi().makeVariable(this,e,t,r)},n}();Object.defineProperty(Dr,Symbol.hasInstance,{value:function(n){return!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null}});function vSe(){return Iw("Tensor",function(){return Dr})}vSe();var cw=function(n){swe(e,n);function e(t,r,a,i){var o=n.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=r,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(t.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!Ac(t.shape,this.shape))throw new Error("shape of the new value (".concat(t.shape,") and ")+"previous value (".concat(this.shape,") must match"));mi().disposeTensor(this),this.dataId=t.dataId,mi().incRef(this,null)},e.prototype.dispose=function(){mi().disposeVariable(this),this.isDisposedInternal=!0},e}(Dr);Object.defineProperty(cw,Symbol.hasInstance,{value:function(n){return n instanceof Dr&&n.assign!=null&&n.assign instanceof Function}});var C4;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(C4||(C4={}));var lw;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(lw||(lw={}));var fw;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(fw||(fw={}));var hw;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(hw||(hw={}));var dw;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(dw||(dw={}));var mSe={float32:hw,int32:lw,bool:fw,complex64:dw};function gSe(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error("Can not upcast ".concat(n," with ").concat(e))}return mSe[n][e]}function Cn(n,e){if(n.dtype===e.dtype)return[n,e];var t=gSe(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function ySe(n,e){G(n.dtype===e.dtype,function(){return"The dtypes of the first(".concat(n.dtype,") and")+" second(".concat(e.dtype,") input must match")})}function rB(n){var e=[],t=new Set;return aB(n,e,t),e}function aB(n,e,t){if(n!=null){if(n instanceof Dr){e.push(n);return}if(!!bSe(n)){var r=n;for(var a in r){var i=r[a];t.has(i)||(t.add(i),aB(i,e,t))}}}}function bSe(n){return Array.isArray(n)||typeof n=="object"}function H1(n){return n.kernelName!=null}var A4=function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return n.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},n}(),Dw=function(){function n(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new A4}return n.prototype.ready=function(){return Pt(this,void 0,void 0,function(){var e,t,r,a;return Dt(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(r=e[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(n.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,r=e.asyncInit;if(r)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!1,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},n.prototype.registerBackend=function(e,t,r){return r===void 0&&(r=1),e in this.registryFactory?(Lf("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},n.prototype.setBackend=function(e){return Pt(this,void 0,void 0,function(){var t,r,a,i,o;return Dt(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '".concat(e,"' not found in registry"));return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,a=t.asyncInit,a?[4,r]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=r,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new sSe(this.backendInstance),[2,!0]}})})},n.prototype.setupRegisteredKernels=function(){var e=this,t=w4(this.backendName);t.forEach(function(r){r.setupFunc!=null&&r.setupFunc(e.backendInstance)})},n.prototype.disposeRegisteredKernels=function(e){var t=this,r=w4(e);r.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},n.prototype.initializeBackend=function(e){var t=this,r=this.registryFactory[e];if(r==null)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var a=r.factory();if(a&&!(a instanceof Qwe)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,Lf("Initialization of backend ".concat(e," failed")),Lf(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return Lf("Initialization of backend ".concat(e," failed")),Lf(s.stack||s.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority})},n.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],a=this.initializeBackend(r),i=a.success,o=a.asyncInit;if(o||i)return{name:r,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(e,t){var r=this.state.tensorInfo.get(t),a=r.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),r.backend=e,e.move(t,i,r.shape,r.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(e,t){var r=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return r.startScope(a)},function(){return r.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},n.prototype.scopedRun=function(e,t,r){e();try{var a=r();return t(),a}catch(i){throw t(),i}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=Q.runKernel(j4,{x:e}),r={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},c={dtype:s};return Q.runKernel(K4,u,c)}}},i=[];return this.addTapeNode(this.state.activeScope.name,r,[t],a,i,{}),t},n.prototype.runKernel=function(e,t,r){this.backendName==null&&this.backend;var a=y4(e,this.backendName)!=null;if(!a)throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:r})},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(e,t,r){var a=this.backend.numDataIds(),i=0;r.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(s," data ids) after running '").concat(e,"'"))},n.prototype.runKernelFunc=function(e){var t=this,r,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var c,l=H1(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(H1(e)){var f=e.kernelName,h=e.inputs,d=e.attrs;this.backendName==null&&this.backend;var p=y4(f,this.backendName);G(p!=null,function(){return"Cannot find registered kernel '".concat(f,"' for backend '").concat(t.backendName,"'")}),u=function(){var x=t.backend.numDataIds();c=p.kernelFunc({inputs:h,attrs:d,backend:t.backend});var N=Array.isArray(c)?c:[c];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,x,N);var T=N.map(function(C){return C.rank!=null?C:t.makeTensorFromTensorInfo(C)});if(i){var E=t.getTensorsForGradient(f,h,T);a=t.saveTensorsForBackwardMode(E)}return T}}else{var v=e.forwardFunc,m=function(x){!i||(a=x.map(function(N){return t.keep(t.clone(N))}))};u=function(){var x=t.backend.numDataIds();c=t.tidy(function(){return v(t.backend,m)});var N=Array.isArray(c)?c:[c];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(l,x,N),N}}var g=e.inputs,y=e.attrs,b=H1(e)?null:e.backwardsFunc,w;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?r=u():(w=t.profiler.profileKernel(l,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(w),r=w.outputs)}),i&&this.addTapeNode(l,g,r,b,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(x){return g[x]!=null?g[x].shape:null}),outputShapes:r.map(function(x){return x.shape}),kernelTimeMs:w.timeMs,extraInfo:w.extraInfo}),Array.isArray(c)?r:r[0]},n.prototype.saveTensorsForBackwardMode=function(e){var t=this,r=e.map(function(a){return t.keep(t.clone(a))});return r},n.prototype.getTensorsForGradient=function(e,t,r){var a=b4(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(G(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(c){return t[c]})):s=i.map(function(c){return t[c]});var u=r.filter(function(c,l){return o[l]});return s.concat(u)}return[]},n.prototype.makeTensor=function(e,t,r,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",a=a||this.backend;var i=e;r==="string"&&kw(e[0])&&(i=e.map(function(l){return oSe(l)}));var o=a.write(i,t,r),s=new Dr(t,r,o,this.nextTensorId());if(this.trackTensor(s,a),r==="string"){var u=this.state.tensorInfo.get(o),c=ixe(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},n.prototype.makeTensorFromDataId=function(e,t,r,a){r=r||"float32";var i={dataId:e,shape:t,dtype:r};return this.makeTensorFromTensorInfo(i,a)},n.prototype.makeTensorFromTensorInfo=function(e,t){var r=e.dataId,a=e.shape,i=e.dtype,o=new Dr(a,i,r,this.nextTensorId());return this.trackTensor(o,t),o},n.prototype.makeVariable=function(e,t,r,a){t===void 0&&(t=!0),r=r||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new cw(e,t,r,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name ".concat(i.name," was already registered"));return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},n.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var r=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(r=e.size*iw(e.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r})),e instanceof cw||this.track(e)},n.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},n.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},n.prototype.disposeTensor=function(e){if(!!this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var r=e.size*iw(e.dtype);this.state.numBytes-=r}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},n.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},n.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return Pt(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f,h;return Dt(this,function(d){switch(d.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=d.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,yn([],Ne(this.state.activeProfile.kernels.map(function(p){return p.totalBytesSnapshot})),!1)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,d.label=2;case 2:d.trys.push([2,8,9,10]),i=Sc(this.state.activeProfile.kernels),o=i.next(),d.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=d.sent(),c=s,[4,s.extraInfo];case 5:c.extraInfo=d.sent(),d.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return l=d.sent(),f={error:l},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},n.prototype.addTapeNode=function(e,t,r,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:i},c=b4(e);c!=null&&(a=c.gradFunc),a!=null&&(u.gradient=function(l){return l=l.map(function(f,h){if(f==null){var d=r[h],p=Tw(d.size,d.dtype);return s.makeTensor(p,d.shape,d.dtype)}return f}),a(l.length>1?l:l[0],i,o)}),this.state.activeTape.push(u)},n.prototype.keep=function(e){return e.kept=!0,e},n.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=rB(e),a=new Set(r.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},n.prototype.gradients=function(e,t,r,a){var i=this;if(a===void 0&&(a=!1),G(t.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '".concat(r.dtype,"'"));var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});G(o instanceof Dr,function(){return"The result y returned by f() must be a tensor."});var s=lSe(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=r??wSe(o.shape),fSe(u,s,function(l){return i.tidy(l)},kSe);var c=t.map(function(l){return u[l.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(l){var f,h;try{for(var d=Sc(l.saved),p=d.next();!p.done;p=d.next()){var v=p.value;v.dispose()}}catch(m){f={error:m}}finally{try{p&&!p.done&&(h=d.return)&&h.call(d)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:c}})},n.prototype.customGrad=function(e){var t=this;return G(h4(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];G(r.every(function(c){return c instanceof Dr}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};r.forEach(function(c,l){o[l]=c});var s=function(c,l){return i=e.apply(void 0,yn([],Ne(yn(yn([],Ne(r),!1),[l],!1)),!1)),G(i.value instanceof Dr,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),G(h4(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(c,l){var f=i.gradFunc(c,l),h=Array.isArray(f)?f:[f];G(h.length===r.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),G(h.every(function(p){return p instanceof Dr}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var d={};return h.forEach(function(p,v){d[v]=function(){return p}}),d};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},n.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},n.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},n.prototype.readToGPU=function(e,t){var r=this.state.tensorInfo.get(e);return r.backend.readToGPU(e,t)},n.prototype.time=function(e){return Pt(this,void 0,void 0,function(){var t,r;return Dt(this,function(a){switch(a.label){case 0:return t=Sv(),[4,this.backend.time(e)];case 1:return r=a.sent(),r.wallMs=Sv()-t,[2,r]}})})},n.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!1,configurable:!0}),n.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new A4;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n}();Dw.nextTensorId=0;Dw.nextVariableId=0;function wSe(n){var e=V4(Fr(n),"float32");return Q.makeTensor(e,n,"float32")}function xSe(){var n=U4();if(n._tfengine==null){var e=new uxe(n);n._tfengine=new Dw(e)}return hxe(n._tfengine.ENV),pSe(function(){return n._tfengine}),n._tfengine}var Q=xSe();function kSe(n,e){var t={a:n,b:e};return Q.runKernel(H4,t)}function Ho(n,e){var t=n;if(yi(n))return e==="string"?[]:[n.length];var r=typeof n=="object";if(r){if("texture"in n){var a=n.channels||"RGBA";return[n.height,n.width*a.length]}else if("buffer"in n&&!(n.buffer instanceof ArrayBuffer))return[n.buffer.size/(e==null?4:iw(e))]}if(!Array.isArray(n))return[];for(var i=[];Array.isArray(t)||yi(t)&&e!=="string";)i.push(t.length),t=t[0];return Array.isArray(n)&&ma().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&iB(n,i,[]),i}function iB(n,e,t){if(t=t||[],!Array.isArray(n)&&!yi(n)){G(e.length===0,function(){return"Element arr[".concat(t.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(e[0]," elements")});return}G(e.length>0,function(){return"Element arr[".concat(t.join("]["),"] should be a primitive, ")+"but is an array of ".concat(n.length," elements")}),G(n.length===e[0],function(){return"Element arr[".concat(t.join("]["),"] should have ").concat(e[0]," ")+"elements, but has ".concat(n.length," elements")});for(var r=e.slice(1),a=0;a<n.length;++a)iB(n[a],r,t.concat(a))}function D4(n,e,t,r){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error("Argument '".concat(t,"' passed to '").concat(r,"' must ")+"be ".concat(n," tensor, but got ").concat(e," tensor"))}}function M(n,e,t,r){if(r===void 0&&(r="numeric"),n instanceof Dr)return D4(r,n.dtype,e,t),n;var a=Sw(n);if(a!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),D4(r,a,e,t),n==null||!yi(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var i=n==null?"null":n.constructor.name;throw new Error("Argument '".concat(e,"' passed to '").concat(t,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=Ho(n,a);!yi(n)&&!Array.isArray(n)&&(n=[n]);var s=!0,u=a!=="string"?tB(n,a):Kf(n,[],s);return Q.makeTensor(u,o,a)}function Nv(n,e,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument ".concat(e," passed to ").concat(t," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=n;return a.map(function(i,o){return M(i,"".concat(e,"[").concat(o,"]"),t,r)})}var oB="__op";function K(n){var e=Object.keys(n);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(e.length," keys."));var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+oB;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];Q.startScope(t);try{var s=r.apply(void 0,yn([],Ne(i),!1));return Ew(s)&&console.error("Cannot return a Promise inside of tidy."),Q.endScope(s),s}catch(u){throw Q.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function SSe(n){var e=M(n,"x","abs");if(e.dtype==="complex64"){var t={x:e};return Q.runKernel(Mxe,t)}else{var t={x:e};return Q.runKernel(pxe,t)}}var $a=K({abs_:SSe});function NSe(n){var e=M(n,"x","acos"),t={x:e};return Q.runKernel(vxe,t)}var TSe=K({acos_:NSe});function ESe(n){var e=M(n,"x","acosh"),t={x:e};return Q.runKernel(mxe,t)}var ISe=K({acosh_:ESe});function CSe(n,e){var t,r=M(n,"a","add"),a=M(e,"b","add");t=Ne(Cn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return Q.runKernel(H4,i)}var jn=K({add_:CSe});function ASe(n){G(Array.isArray(n),function(){return"The argument passed to tf.addN() must be a list of tensors"}),G(n.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+"".concat(n.length)});var e=n.map(function(a,i){return M(a,"tensors".concat(i),"addN")}),t=e[0];e.forEach(function(a){if(a.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(a){if(!Ac(a.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=e;return Q.runKernel(gxe,r)}var DSe=K({addN_:ASe});function _Se(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","all","bool"),a={x:r},i={axis:e,keepDims:t};return Q.runKernel(yxe,a,i)}var FSe=K({all_:_Se});function RSe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","any","bool"),a={x:r},i={axis:e,keepDims:t};return Q.runKernel(bxe,a,i)}var OSe=K({any_:RSe});function PSe(n,e){e===void 0&&(e=0);var t=M(n,"x","argMax"),r={x:t},a={axis:e};return Q.runKernel(wxe,r,a)}var MSe=K({argMax_:PSe});function BSe(n,e){e===void 0&&(e=0);var t=M(n,"x","argMin"),r={x:t},a={axis:e};return Q.runKernel(xxe,r,a)}var LSe=K({argMin_:BSe});function zSe(n){var e=M(n,"x","asin"),t={x:e};return Q.runKernel(kxe,t)}var $Se=K({asin_:zSe});function qSe(n){var e=M(n,"x","asinh"),t={x:e};return Q.runKernel(Sxe,t)}var WSe=K({asinh_:qSe});function VSe(n){var e=M(n,"x","atan"),t={x:e};return Q.runKernel(Nxe,t)}var GSe=K({atan_:VSe});function USe(n,e){var t,r=M(n,"a","atan2"),a=M(e,"b","atan2");t=Ne(Cn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return Q.runKernel(Exe,i)}var HSe=K({atan2_:USe});function KSe(n){var e=M(n,"x","atanh"),t={x:e};return Q.runKernel(Txe,t)}var jSe=K({atanh_:KSe});function XSe(n,e){var t=M(n,"x","cast");if(!axe(e))throw new Error("Failed to cast to unknown dtype ".concat(e));if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var r={x:t},a={dtype:e};return Q.runKernel(K4,r,a)}var rr=K({cast_:XSe});function YSe(n,e,t,r,a,i,o){o===void 0&&(o="channelsLast");var s=Ne(jf(e),2),u=s[0],c=s[1],l;if(o==="channelsLast")l=[u,c,n[3],n[3]];else if(o==="channelsFirst")l=[u,c,n[1],n[1]];else throw new Error("Unknown dataFormat ".concat(o));return _w(n,l,t,r,a,i,!1,o)}function _w(n,e,t,r,a,i,o,s){var u,c;o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var l=Ne([-1,-1,-1,-1],4),f=l[0],h=l[1],d=l[2],p=l[3];if(s==="channelsLast")u=Ne(n,4),f=u[0],h=u[1],d=u[2],p=u[3];else if(s==="channelsFirst")c=Ne(n,4),f=c[0],p=c[1],h=c[2],d=c[3];else throw new Error("Unknown dataFormat ".concat(s));var v=Ne(e,4),m=v[0],g=v[1],y=v[3],b=Ne(jf(t),2),w=b[0],x=b[1],N=Ne(jf(r),2),T=N[0],E=N[1],C=pw(m,T),F=pw(g,E),_=QSe(a,h,d,w,x,C,F,i,s),O=_.padInfo,L=_.outHeight,z=_.outWidth,$=o?y*p:y,B;return s==="channelsFirst"?B=[f,$,L,z]:s==="channelsLast"&&(B=[f,L,z,$]),{batchSize:f,dataFormat:s,inHeight:h,inWidth:d,inChannels:p,outHeight:L,outWidth:z,outChannels:$,padInfo:O,strideHeight:w,strideWidth:x,filterHeight:m,filterWidth:g,effectiveFilterHeight:C,effectiveFilterWidth:F,dilationHeight:T,dilationWidth:E,inShape:n,outShape:B,filterShape:e}}function ZSe(n,e,t,r,a){r==null&&(r=JSe(n,e,t));var i=n[0],o=n[1],s=Tv((i-e+2*r)/t+1,a),u=Tv((o-e+2*r)/t+1,a);return[s,u]}function JSe(n,e,t,r){r===void 0&&(r=1);var a=pw(e,r);return Math.floor((n[0]*(t-1)-t+a)/2)}function jf(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function pw(n,e){return e<=1?n:n+(n-1)*(e-1)}function QSe(n,e,t,r,a,i,o,s,u){var c,l,f;if(typeof n=="number"){var h=n===0?"VALID":"NUMBER";c={top:n,bottom:n,left:n,right:n,type:h};var d=ZSe([e,t],i,r,n,s);l=d[0],f=d[1]}else if(n==="same"){l=Math.ceil(e/r),f=Math.ceil(t/a);var p=Math.max(0,(l-1)*r+i-e),v=Math.max(0,(f-1)*a+o-t),m=Math.floor(p/2),g=p-m,y=Math.floor(v/2),b=v-y;c={top:m,bottom:g,left:y,right:b,type:"SAME"}}else if(n==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-i+1)/r),f=Math.ceil((t-o+1)/a);else if(typeof n=="object"){var m=u==="channelsLast"?n[1][0]:n[2][0],g=u==="channelsLast"?n[1][1]:n[2][1],y=u==="channelsLast"?n[2][0]:n[3][0],b=u==="channelsLast"?n[2][1]:n[3][1],h=m===0&&g===0&&y===0&&b===0?"VALID":"EXPLICIT";c={top:m,bottom:g,left:y,right:b,type:h},l=Tv((e-i+m+g)/r+1,s),f=Tv((t-o+y+b)/a+1,s)}else throw Error("Unknown padding parameter: ".concat(n));return{padInfo:c,outHeight:l,outWidth:f}}function Tv(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode ".concat(e))}}function Ev(n){var e=Ne(jf(n),3),t=e[0],r=e[1],a=e[2];return t===1&&r===1&&a===1}function Ko(n,e){return Ev(n)||Ev(e)}function Tc(n){return jf(n).every(function(e){return e>0})}function wi(n,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,"."));if(typeof e=="number")G(Hf(e),function(){return"Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,".")});else if(typeof e=="object")e.forEach(function(r){r.forEach(function(a){G(Hf(a),function(){return"Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(a,".")})})});else throw Error("Error in ".concat(n,": Unknown padding parameter: ").concat(e))}}function eNe(n,e){var t=M(n,"x","reshape","string_or_numeric"),r={x:t},a={shape:e};return Q.runKernel(f2e,r,a)}var ge=K({reshape_:eNe});function tNe(n,e,t,r,a){var i=M(n,"x","avgPool","float32"),o=1;G(Ko(t,o),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")});var s=i,u=!1;i.rank===3&&(u=!0,s=ge(i,[1,i.shape[0],i.shape[1],i.shape[2]])),G(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(s.rank,".")}),wi("avgPool",r,a);var c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a},f=Q.runKernel(Ixe,c,l);return f=rr(f,i.dtype),u?ge(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var sB=K({avgPool_:tNe});function nNe(n,e,t,r,a,i){i===void 0&&(i="NDHWC");var o=M(n,"x","avgPool3d","float32"),s=o,u=!1;o.rank===4&&(u=!0,s=ge(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),G(s.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),G(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),G(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,function(){return"Error in avgPool3d: Stride must be > 0, but got '".concat(t,"'")}),wi("avgPool3d",r,a);var c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a,dataFormat:i},f=Q.runKernel(Cxe,c,l);return f=rr(f,s.dtype),u?ge(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var rNe=K({avgPool3d_:nNe});function aNe(n){var e=M(n,"x","clone","string_or_numeric"),t={x:e};return Q.runKernel(j4,t)}var wc=K({clone_:aNe});function iNe(n,e){e===void 0&&(e=0),G(n.length>=1,function(){return"Pass at least one tensor to concat"});var t=Nv(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `.concat(i.dtype,". "))}),t.length===1)return wc(t[0]);var r=t,a={axis:e};return Q.runKernel(Bxe,r,a)}var Qr=K({concat_:iNe});function oNe(n,e,t,r){var a;t===void 0&&(t=!1),r===void 0&&(r=!1);var i=M(n,"a","matMul"),o=M(e,"b","matMul");a=Ne(Cn(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:r};return Q.runKernel(Axe,s,u)}var Bt=K({matMul_:oNe});function sNe(n,e){var t,r=M(n,"a","mul"),a=M(e,"b","mul");t=Ne(Cn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return Q.runKernel(Uke,i)}var mt=K({mul_:sNe});function uNe(n){var e=M(n,"x","sigmoid","float32"),t={x:e};return Q.runKernel(E2e,t)}var xc=K({sigmoid_:uNe});function cNe(n,e,t){var r=M(n,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");var a={x:r},i={begin:e,size:t};return Q.runKernel(k2e,a,i)}var fn=K({slice_:cNe});function lNe(n){var e=M(n,"x","tanh","float32"),t={x:e};return Q.runKernel(U2e,t)}var vw=K({tanh_:lNe});function fNe(n,e,t,r,a,i){var o=M(n,"forgetBias","basicLSTMCell"),s=M(e,"lstmKernel","basicLSTMCell"),u=M(t,"lstmBias","basicLSTMCell"),c=M(r,"data","basicLSTMCell"),l=M(a,"c","basicLSTMCell"),f=M(i,"h","basicLSTMCell"),h=Qr([c,f],1),d=Bt(h,s),p=jn(d,u),v=p.shape[0],m=p.shape[1]/4,g=[v,m],y=fn(p,[0,0],g),b=fn(p,[0,m],g),w=fn(p,[0,m*2],g),x=fn(p,[0,m*3],g),N=jn(mt(xc(y),vw(b)),mt(l,xc(jn(o,w)))),T=mt(vw(N),xc(x));return[N,T]}var hNe=K({basicLSTMCell_:fNe});function dNe(n,e,t){var r=M(n,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});G(r.rank>=1+e.length,function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(e.length)}),G(t.length===e.length,function(){return"crops.length is ".concat(t.length," but should be equal to blockShape.length  ").concat(e.length)}),G(r.shape[0]%a===0,function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(e.join(" * ")," === ").concat(a)});var i={x:r},o={blockShape:e,crops:t};return Q.runKernel(Dxe,i,o)}var uB=K({batchToSpaceND_:dNe});function pNe(n){var e;return n.rank===0||n.rank===1?e=ge(n,[1,1,1,n.size]):n.rank===2?e=ge(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=ge(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}function vNe(n,e,t,r,a,i){i==null&&(i=.001);var o=M(n,"x","batchNorm"),s=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm"),c;a!=null&&(c=M(a,"scale","batchNorm"));var l;r!=null&&(l=M(r,"offset","batchNorm")),G(s.rank===u.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),G(l==null||s.rank===l.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),G(c==null||s.rank===c.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var f=pNe(o),h={x:f,scale:c,offset:l,mean:s,variance:u},d={varianceEpsilon:i},p=Q.runKernel(pke,h,d);return ge(p,o.shape)}var _v=K({batchNorm_:vNe});function mNe(n,e,t,r,a,i){var o=M(n,"x","batchNorm"),s=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm"),c;a!=null&&(c=M(a,"scale","batchNorm"));var l;return r!=null&&(l=M(r,"offset","batchNorm")),G(o.rank===2,function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(o.rank,".")}),G(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(s.rank,".")}),G(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&G(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&G(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(l.rank,".")}),_v(o,s,u,l,c,i)}var gNe=K({batchNorm2d_:mNe});function yNe(n,e,t,r,a,i){var o=M(n,"x","batchNorm"),s=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm"),c;a!=null&&(c=M(a,"scale","batchNorm"));var l;return r!=null&&(l=M(r,"offset","batchNorm")),G(o.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(o.rank,".")}),G(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(s.rank,".")}),G(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&G(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&G(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(l.rank,".")}),_v(o,s,u,l,c,i)}var bNe=K({batchNorm3d_:yNe});function wNe(n,e,t,r,a,i){var o=M(n,"x","batchNorm"),s=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm"),c;a!=null&&(c=M(a,"scale","batchNorm"));var l;return r!=null&&(l=M(r,"offset","batchNorm")),G(o.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(o.rank,".")}),G(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(s.rank,".")}),G(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&G(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&G(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(l.rank,".")}),_v(o,s,u,l,c,i)}var xNe=K({batchNorm4d_:wNe});function kNe(n,e,t){var r=M(n,"x","bincount"),a=M(e,"weights","bincount");G(r.dtype==="int32",function(){return"Error in bincount: input "+"dtype must be int32, but got ".concat(r.dtype)}),G(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),G(a.size===r.size||a.size===0,function(){return"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(r.shape,", weights shape: ")+"".concat(a.shape,".")});var i={x:r,weights:a},o={size:t};return Q.runKernel(_xe,i,o)}var cB=K({bincount_:kNe});function SNe(n,e){var t=M(n,"s0","broadcastArgs","int32"),r=M(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error("broadcastArgs(): first input must be a vector (rank=1). "+"Has rank ".concat(t.rank));if(r.rank!==1)throw new Error("broadcastArgs(): second input must be a vector (rank=1). "+"Has rank ".concat(r.rank));var a={s0:t,s1:r};return Q.runKernel(Fxe,a)}var NNe=K({broadcastArgs_:SNe});function TNe(n,e){var t=M(n,"broadcastTo","x"),r=t.shape;if(ga(e),e.length<t.rank)throw new Error("broadcastTo(): shape.length=".concat(e.length," < input.rank=").concat(t.rank,"."));if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=ge(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(e,"]."));var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return wc(t);var c={x:t},l={reps:o};return Q.runKernel(X4,c,l)}var wv=K({broadcastTo_:TNe});function Uo(n,e,t){return e===void 0&&(e="float32"),e=e||"float32",ga(n),new uw(n,e,t)}function ENe(n){var e=M(n,"x","ceil","float32"),t={x:e};return Q.runKernel(Rxe,t)}var INe=K({ceil_:ENe});function Fv(n,e,t){ga(n);var r={shape:n,value:e,dtype:t};return Q.runKernel(lke,{},r)}function CNe(n,e,t){var r=M(n,"x","clipByValue");if(G(e<=t,function(){return"Error in clip: min (".concat(e,") must be ")+"less than or equal to max (".concat(t,").")}),e===t)return Fv(r.shape,e,r.dtype);var a={x:r},i={clipValueMin:e,clipValueMax:t};return Q.runKernel(Oxe,a,i)}var ANe=K({clipByValue_:CNe});function DNe(n,e){var t=M(n,"real","complex"),r=M(e,"imag","complex");Ua(t.shape,r.shape,"real and imag shapes, ".concat(t.shape," and ").concat(r.shape,", ")+"must match in call to tf.complex().");var a={real:t,imag:r};return Q.runKernel(Pxe,a)}var Ys=K({complex_:DNe});function _Ne(n){return Qr(n,0)}var FNe=K({concat1d_:_Ne});function RNe(n,e){return Qr(n,e)}var ONe=K({concat2d_:RNe});function PNe(n,e){return Qr(n,e)}var MNe=K({concat3d_:PNe});function BNe(n,e){return Qr(n,e)}var LNe=K({concat4d_:BNe});function zNe(n,e,t,r,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=M(n,"x","conv2d","float32"),u=M(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),G(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")}),G(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")}),wi("conv2d",r,o);var f=a==="NHWC"?c.shape[3]:c.shape[1];G(f===u.shape[2],function(){return"Error in conv2d: depth of input (".concat(f,") must match ")+"input depth for filter ".concat(u.shape[2],".")}),G(Ko(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),G(Tc(i),function(){return"Error in conv2D: Dilated rates should be larger than 0."}),G(Tc(t),function(){return"Error in conv2D: Strides should be larger than 0."});var h={x:c,filter:u},d={strides:t,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},p=Q.runKernel(Lxe,h,d);return l?ge(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var Rv=K({conv2d_:zNe});function $Ne(n,e,t,r,a,i,o){a===void 0&&(a="NWC"),i===void 0&&(i=1);var s=M(n,"x","conv1d"),u=M(e,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=ge(s,[1,s.shape[0],s.shape[1]])),G(c.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")}),G(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+"".concat(u.rank,".")}),wi("conv1d",r,o),G(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match ")+"input depth for filter ".concat(u.shape[1],".")}),G(Ko(t,i),function(){return"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(t," and dilation '").concat(i,"'")}),G(Tc(i),function(){return"Error in conv1D: Dilated rates should be larger than 0."}),G(Tc(t),function(){return"Error in conv1D: Stride should be larger than 0."}),G(a==="NWC",function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")});var f=ge(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=ge(c,[c.shape[0],1,c.shape[1],c.shape[2]]),d=[1,t],p=[1,i],v="NHWC",m=Rv(h,f,d,r,v,p,o);return l?ge(m,[m.shape[2],m.shape[3]]):ge(m,[m.shape[0],m.shape[2],m.shape[3]])}var qNe=K({conv1d_:$Ne});function WNe(n,e,t,r,a,i,o){i===void 0&&(i="NHWC"),G(n.length===e.rank,function(){return"Length of inShape "+"(".concat(n.length,") and rank of dy (").concat(e.rank,") must match")});var s=n,u=e,c=!1;e.rank===3&&(c=!0,u=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,n[0],n[1],n[2]]),G(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")}),G(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)}),G(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(t.rank)});var l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];G(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(t.shape[2],".")}),G(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output (".concat(f,") must ")+"match output depth for filter ".concat(t.shape[3],".")}),wi("conv2dDerInput",a,o);var h={dy:u,filter:t},d={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},p=Q.runKernel($xe,h,d);return c?ge(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var lB=K({conv2DBackpropInput_:WNe});function VNe(n,e,t,r,a,i){var o=M(n,"x","conv2dTranspose"),s=M(e,"filter","conv2dTranspose");return lB(t,o,s,r,a,"NHWC",i)}var GNe=K({conv2dTranspose_:VNe});function UNe(n,e,t,r,a,i){a===void 0&&(a="NDHWC"),i===void 0&&(i=[1,1,1]);var o=M(n,"x","conv3d"),s=M(e,"filter","conv3d"),u=o,c=!1;o.rank===4&&(c=!0,u=ge(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),G(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")}),G(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+"".concat(s.rank,".")}),G(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match ")+"input depth for filter ".concat(s.shape[3],".")}),G(Ko(t,i),function(){return"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),G(a==="NDHWC",function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")}),G(Tc(i),function(){return"Error in conv3D: Dilated rates should be larger than 0."}),G(Tc(t),function(){return"Error in conv3D: Strides should be larger than 0."});var l={x:u,filter:s},f={strides:t,pad:r,dataFormat:a,dilations:i},h=Q.runKernel(qxe,l,f);return c?ge(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var HNe=K({conv3d_:UNe});function KNe(n,e,t,r,a){G(n.length===e.rank,function(){return"Length of inShape "+"(".concat(n.length,") and rank of dy (").concat(e.rank,") must match")});var i=n,o=e,s=!1;e.rank===4&&(s=!0,o=ge(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);var u=i[4],c=o.shape[4];G(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")}),G(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)}),G(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(t.rank)}),G(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(t.shape[3],".")}),G(c===t.shape[4],function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(t.shape[4],".")});var l={dy:o,filter:t},f={pad:a,strides:r,inputShape:i},h=Q.runKernel(Wxe,l,f);return s?ge(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var jNe=K({conv3DBackpropInput_:KNe});function XNe(n,e,t,r,a){var i=M(n,"x","conv3dTranspose"),o=M(e,"filter","conv3dTranspose");return jNe(t,i,o,r,a)}var YNe=K({conv3dTranspose_:XNe});function ZNe(n){var e=M(n,"x","cos","float32"),t={x:e};return Q.runKernel(Vxe,t)}var JNe=K({cos_:ZNe});function QNe(n){var e=M(n,"x","cosh","float32"),t={x:e};return Q.runKernel(Gxe,t)}var eTe=K({cosh_:QNe});function tTe(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var a=M(n,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:r};return Q.runKernel(Uxe,i,o)}var nTe=K({cumprod_:tTe});function rTe(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var a=M(n,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:r};return Q.runKernel(Hxe,i,o)}var aTe=K({cumsum_:rTe});function iTe(n,e,t,r){r===void 0&&(r=!1);var a=M(n,"x","denseBincount"),i=M(e,"weights","denseBincount");G(a.dtype==="int32",function(){return"Error in denseBincount: input "+"dtype must be int32, but got ".concat(a.dtype)}),G(a.rank<=2,function(){return"Error in denseBincount: input must be at most rank 2, but got "+"rank ".concat(a.rank,".")}),G(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),G(i.size===a.size||i.size===0,function(){return"Error in denseBincount: weights must have the same shape as x or "+"0-length, but got x shape: ".concat(a.shape,", weights shape: ")+"".concat(i.shape,".")});var o={x:a,weights:i},s={size:t,binaryOutput:r};return Q.runKernel(jxe,o,s)}var oTe=K({denseBincount_:iTe});function sTe(n,e,t){t===void 0&&(t="NHWC");var r=M(n,"x","depthToSpace","float32"),a=t==="NHWC"?r.shape[1]:r.shape[2],i=t==="NHWC"?r.shape[2]:r.shape[3],o=t==="NHWC"?r.shape[3]:r.shape[1];G(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(e)}),G(a*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(a," and ").concat(e,`  for depthToSpace with input shape
    `).concat(r.shape)}),G(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(i," and ").concat(e,` for depthToSpace with input shape
        `).concat(r.shape)}),G(o%(e*e)===0,function(){return"Dimension size must be evenly divisible by ".concat(e*e," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape)});var s={x:r},u={blockSize:e,dataFormat:t};return Q.runKernel(Xxe,s,u)}var uTe=K({depthToSpace_:sTe});function cTe(n,e,t,r,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=M(n,"x","depthwiseConv2d","float32"),u=M(e,"filter","depthwiseConv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),G(c.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(c.rank,".")}),G(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")});var f=a==="NHWC"?c.shape[3]:c.shape[1];G(f===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels "+"(".concat(f,") must match the inChannels dimension in ")+"filter ".concat(u.shape[2],".")}),wi("depthwiseConv2d",r,o);var h={x:c,filter:u},d={strides:t,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},p=Q.runKernel(Yxe,h,d);return l?ge(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var Fw=K({depthwiseConv2d_:cTe});function lTe(n){var e=M(n,"x","diag"),t={x:e};return Q.runKernel(Qxe,t)}var fTe=K({diag_:lTe});function hTe(n,e,t,r,a,i){a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC");var o=M(n,"x","dilation2d"),s=M(e,"filter","dilation2d");G(o.rank===3||o.rank===4,function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(o.rank,".")}),G(s.rank===3,function(){return"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(s.rank,".")}),G(i==="NHWC",function(){return"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(i)});var u=o,c=!1;o.rank===3&&(u=ge(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),G(u.shape[3]===s.shape[2],function(){return"Error in dilation2d:  input and filter must have the same depth: ".concat(u.shape[3]," vs ").concat(s.shape[2])});var l={x:u,filter:s},f={strides:t,pad:r,dilations:a},h=Q.runKernel(eke,l,f);return c?ge(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var dTe=K({dilation2d_:hTe});function pTe(n,e){var t,r=M(n,"a","floorDiv"),a=M(e,"b","floorDiv");t=Ne(Cn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return Q.runKernel(dke,i)}var fB=K({floorDiv_:pTe});function vTe(n,e){var t,r=M(n,"a","div"),a=M(e,"b","div");if(t=Ne(Cn(r,a),2),r=t[0],a=t[1],r.dtype==="int32"&&a.dtype==="int32")return fB(r,a);var i={a:r,b:a},o={};return Q.runKernel(tke,i,o)}var yr=K({div_:vTe});function mTe(n,e){for(var t=[],r=0;r<e.length;r++){var a=n[n.length-r-1],i=e.length-r-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function Xn(n,e){for(var t=[],r=Math.max(n.length,e.length),a=0;a<r;a++){var i=n[n.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)t.unshift(o);else if(o===1)t.unshift(i);else if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(n," and ").concat(e,".");throw Error(s)}else t.unshift(i)}return t}function gTe(n,e){var t,r=M(n,"a","equal","string_or_numeric"),a=M(e,"b","equal","string_or_numeric");t=Ne(Cn(r,a),2),r=t[0],a=t[1],Xn(r.shape,a.shape);var i={a:r,b:a};return Q.runKernel(ike,i)}var hB=K({equal_:gTe});function yTe(n,e,t){var r=M(e,"a","where"),a=M(t,"b","where"),i=M(n,"condition","where","bool"),o=Xn(Xn(i.shape,r.shape),a.shape),s=wv(i,o),u=wv(r,o),c=wv(a,o),l={condition:s,t:u,e:c};return Q.runKernel(w2e,l)}var Ec=K({where_:yTe});function bTe(n){var e=M(n,"x","zerosLike"),t={x:e};return Q.runKernel(Z2e,t)}var Rw=K({zerosLike_:bTe});function wTe(n,e){var t,r=M(n,"a","div"),a=M(e,"b","div");t=Ne(Cn(r,a),2),r=t[0],a=t[1];var i=yr(r,a),o=Rw(i),s=hB(a,o);return Ec(s,o,i)}var xTe=K({divNoNan_:wTe});function kTe(n,e){var t=M(n,"t1","dot"),r=M(e,"t2","dot");G((t.rank===1||t.rank===2)&&(r.rank===1||r.rank===2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(t.rank," and ").concat(r.rank,".")});var a=t.rank===1?t.size:t.shape[1],i=r.rank===1?r.size:r.shape[0];if(G(a===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+"".concat(a," and ").concat(i,".")}),t.rank===1&&r.rank===1){var o=ge(t,[1,-1]),s=ge(r,[-1,1]),u=Bt(o,s);return ge(u,[])}else if(t.rank===1&&r.rank===2){var o=ge(t,[1,-1]),s=ge(r,[r.shape[0],r.shape[1]]),u=Bt(o,s);return ge(u,[u.size])}else if(t.rank===2&&r.rank===1){var s=ge(r,[-1,1]),u=Bt(t,s);return ge(u,[u.size])}else{var s=ge(r,[r.shape[0],r.shape[1]]),u=Bt(t,s);return u}}var STe=K({dot_:kTe});function NTe(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var r=e.map(function(i,o){return M(i,"tensors".concat(o),"einsum")}),a={equation:n};return Q.runKernel(nke,r,a)}var TTe=K({einsum_:NTe});function ETe(n){var e=M(n,"x","elu","float32"),t={x:e};return Q.runKernel(rke,t)}var dB=K({elu_:ETe});function ITe(n){var e=M(n,"x","erf");G(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=rr(e,"float32"));var t={x:e};return Q.runKernel(ake,t)}var CTe=K({erf_:ITe});function ATe(n,e,t){for(var r=n.length+e.length,a=[],i=0,o=0,s=0;s<r;s++)t.indexOf(s)===-1?a.push(n[i++]):a.push(e[o++]);return a}function Ov(n,e){var t=e.map(function(r){return 1});return ATe(n,t,e)}function DTe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","max"),a={x:r},i={reductionIndices:e,keepDims:t};return Q.runKernel(Oke,a,i)}var kc=K({max_:DTe});function _Te(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","min"),a={x:r},i={axis:e,keepDims:t};return Q.runKernel($ke,a,i)}var mw=K({min_:_Te});function FTe(n,e){var t,r=M(n,"base","pow"),a=M(e,"exp","pow");t=Ne(Cn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return Q.runKernel(t2e,i)}var Ow=K({pow_:FTe});function jo(n,e,t,r){if(r==null)r=Sw(n);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(typeof n=="object"&&("texture"in n||"buffer"in n&&!(n.buffer instanceof ArrayBuffer))){if(r!=="float32"&&r!=="int32")throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(r,"."));return Q.backend.createTensorFromGPUData(n,e||t,r)}if(!yi(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){ga(e);var a=Fr(e),i=Fr(t);G(a===i,function(){return"Based on the provided shape, [".concat(e,"], the tensor should have ")+"".concat(a," values but has ").concat(i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==Fr(e.slice(o)):!0;G(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(t,") does not match the provided ")+"shape (".concat(e,"). ")})}}return!yi(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=r!=="string"?tB(n,r):Kf(n,[],!0),Q.makeTensor(n,e,r)}function bn(n,e){if((yi(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&yi(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],r=[];return jo(n,t,r,e)}function RTe(n){var e=M(n,"x","sqrt","float32"),t={x:e};return Q.runKernel(C2e,t)}var gw=K({sqrt_:RTe});function OTe(n){var e=M(n,"x","square"),t={};return Q.runKernel("Square",{x:e},t)}var Pv=K({square_:OTe});function PTe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","sum");r.dtype==="bool"&&(r=rr(r,"int32"));var a={x:r},i={axis:e,keepDims:t};return Q.runKernel(A2e,a,i)}var en=K({sum_:PTe});function MTe(n,e,t,r){e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1),n=M(n,"x","norm");var a=pB(n,e,t),i=a.shape;if(r){var o=Dv(t,n.shape);i=Ov(a.shape,o)}return ge(a,i)}function pB(n,e,t){if(t===void 0&&(t=null),n.rank===0)return $a(n);if(n.rank!==1&&t===null)return pB(ge(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return en($a(n),t);if(e===1/0)return kc($a(n),t);if(e===-1/0)return mw($a(n),t);if(e==="euclidean"||e===2)return gw(en(Ow($a(n),bn(2,"int32")),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}if(Array.isArray(t)&&t.length===2){if(e===1)return kc(en($a(n),t[0]),t[1]-1);if(e===1/0)return kc(en($a(n),t[1]),t[0]);if(e===-1/0)return mw(en($a(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return gw(en(Pv(n),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}throw new Error("Error in norm: invalid axis: ".concat(t))}var Mv=K({norm_:MTe});function BTe(n,e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),Mv(n,"euclidean",e,t)}var LTe=K({euclideanNorm_:BTe});function zTe(n){var e=M(n,"x","exp"),t={x:e};return Q.runKernel(oke,t)}var Zs=K({exp_:zTe});function $Te(n,e){e===void 0&&(e=0);var t=M(n,"x","expandDims","string_or_numeric");G(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var r={input:t},a={dim:e};return Q.runKernel(ske,r,a)}var Ks=K({expandDims_:$Te});function qTe(n){var e=M(n,"x","expm1"),t={x:e};return Q.runKernel(uke,t)}var WTe=K({expm1_:qTe});function VTe(n,e){var t=M(n,"x","tile","string_or_numeric");G(t.rank===e.length,function(){return"Error in transpose: rank of input ".concat(t.rank," ")+"must match length of reps ".concat(e,".")});var r={x:t},a={reps:e};return Q.runKernel(X4,r,a)}var Gf=K({tile_:VTe});function GTe(n,e,t,r){r===void 0&&(r="float32"),e==null&&(e=n);for(var a=Uo([n,e],r),i=n<=e?n:e,o=0;o<i;++o)a.set(1,o,o);var s=ge(a.toTensor(),[n,e]);if(t==null)return s;if(t.length===1)return Gf(Ks(s,0),[t[0],1,1]);if(t.length===2)return Gf(Ks(Ks(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return Gf(Ks(Ks(Ks(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(t.length,"D."))}var vB=K({eye_:GTe});function UTe(n){var e=M(n,"x","floor","float32"),t={x:e};return Q.runKernel(hke,t)}var mB=K({floor_:UTe});function HTe(n,e,t,r){t===void 0&&(t=0),r===void 0&&(r=0);var a=M(n,"x","gather"),i=M(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:r};return Q.runKernel(vke,o,s)}var gB=K({gather_:HTe});function KTe(n,e){var t,r=M(n,"a","greater","string_or_numeric"),a=M(e,"b","greater","string_or_numeric");t=Ne(Cn(r,a),2),r=t[0],a=t[1],Xn(r.shape,a.shape);var i={a:r,b:a};return Q.runKernel(gke,i)}var Bv=K({greater_:KTe});function jTe(n,e){var t,r=M(n,"a","greaterEqual","string_or_numeric"),a=M(e,"b","greaterEqual","string_or_numeric");t=Ne(Cn(r,a),2),r=t[0],a=t[1],Xn(r.shape,a.shape);var i={a:r,b:a};return Q.runKernel(yke,i)}var yB=K({greaterEqual_:jTe});function XTe(n){var e=M(n,"input","imag"),t={input:e};return Q.runKernel(wke,t)}var Lv=K({imag_:XTe});function YTe(n){var e=M(n,"x","isFinite"),t={x:e};return Q.runKernel(xke,t)}var ZTe=K({isFinite_:YTe});function JTe(n){var e=M(n,"x","isInf"),t={x:e};return Q.runKernel(kke,t)}var QTe=K({isInf_:JTe});function eEe(n){var e=M(n,"x","isNaN"),t={x:e};return Q.runKernel(Ske,t)}var tEe=K({isNaN_:eEe});function nEe(n,e){e===void 0&&(e=.2);var t=M(n,"x","leakyRelu"),r={x:t},a={alpha:e};return Q.runKernel(Nke,r,a)}var bB=K({leakyRelu_:nEe});function rEe(n,e){var t,r=M(n,"a","less","string_or_numeric"),a=M(e,"b","less","string_or_numeric");t=Ne(Cn(r,a),2),r=t[0],a=t[1],Xn(r.shape,a.shape);var i={a:r,b:a};return Q.runKernel(Tke,i)}var aEe=K({less_:rEe});function iEe(n,e){var t,r=M(n,"a","lessEqual","string_or_numeric"),a=M(e,"b","lessEqual","string_or_numeric");t=Ne(Cn(r,a),2),r=t[0],a=t[1],Xn(r.shape,a.shape);var i={a:r,b:a};return Q.runKernel(Eke,i)}var Pw=K({lessEqual_:iEe});function oEe(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");var r={start:n,stop:e,num:t};return Q.runKernel(Ike,{},r)}function sEe(n,e,t,r,a){e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),a===void 0&&(a=.5);var i=M(n,"x","localResponseNormalization");G(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `.concat(i.rank,".")}),G(Hf(e),function(){return"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(e,".")});var o=i,s=!1;i.rank===3&&(s=!0,o=ge(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:e,bias:t,alpha:r,beta:a},l=Q.runKernel(Rke,u,c);return s?ge(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var uEe=K({localResponseNormalization_:sEe});function cEe(n){var e=M(n,"x","log","float32"),t={x:e};return Q.runKernel(Cke,t)}var Xf=K({log_:cEe});function lEe(n){var e=M(n,"x","log1p"),t={x:e};return Q.runKernel(Ake,t)}var wB=K({log1p_:lEe});function oo(n){return Q.customGrad(n)}function fEe(n){var e=M(n,"x","neg"),t={x:e};return Q.runKernel(Hke,t)}var io=K({neg_:fEe});function hEe(n){var e=M(n,"x","softplus"),t={x:e};return Q.runKernel(I2e,t)}var xB=K({softplus_:hEe});function dEe(n){var e=M(n,"x","logSigmoid"),t=oo(function(r){var a=io(xB(io(r))),i=function(o){var s=mt(o,xc(io(r)));return s};return{value:a,gradFunc:i}});return t(e)}var pEe=K({logSigmoid_:dEe});function vEe(n,e){var t,r=M(n,"a","sub"),a=M(e,"b","sub");t=Ne(Cn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return Q.runKernel(V2e,i)}var Ct=K({sub_:vEe});function mEe(n,e){e===void 0&&(e=-1);var t=M(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and axis was ").concat(e));var r=oo(function(a,i){var o=!0,s=kc(a,e,!0),u=Ct(a,s),c=Ct(rr(u,"float32"),Xf(en(Zs(u),e,o)));i([c]);var l=function(f,h){var d=Ne(h,1),p=d[0],v=!0,m=Zs(p);return Ct(f,mt(en(f,e,v),m))};return{value:c,gradFunc:l}});return r(t)}var gEe=K({logSoftmax_:mEe});function yEe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","logSumExp"),a=Dv(e,r.shape),i=kc(r,a,!0),o=Ct(r,i),s=Zs(o),u=en(s,a),c=Xf(u),l=jn(ge(i,c.shape),c);if(t){var f=Ov(l.shape,a);return ge(l,f)}return l}var kB=K({logSumExp_:yEe});function bEe(n,e){var t=M(n,"a","logicalAnd","bool"),r=M(e,"b","logicalAnd","bool");Xn(t.shape,r.shape);var a={a:t,b:r};return Q.runKernel(Dke,a)}var Iv=K({logicalAnd_:bEe});function wEe(n){var e=M(n,"x","logicalNot","bool"),t={x:e};return Q.runKernel(_ke,t)}var SB=K({logicalNot_:wEe});function xEe(n,e){var t=M(n,"a","logicalOr","bool"),r=M(e,"b","logicalOr","bool");Xn(t.shape,r.shape);var a={a:t,b:r};return Q.runKernel(Fke,a)}var NB=K({logicalOr_:xEe});function kEe(n,e){var t=M(n,"a","logicalXor","bool"),r=M(e,"b","logicalXor","bool");return Xn(t.shape,r.shape),Iv(NB(n,e),SB(Iv(n,e)))}var SEe=K({logicalXor_:kEe});var mv=2147483648;function NEe(n,e,t){t===void 0&&(t="left");var r=M(n,"sortedSequence","searchSorted"),a=M(e,"values","searchSorted"),i=r.shape[r.shape.length-1],o=a.shape[a.shape.length-1],s=ge(r,[-1,i]),u=ge(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(Fr(u.shape)>=mv)throw new Error("values tensor size must less than ".concat(mv));if(s.shape[1]>=mv)throw new Error("trailing dim_size must less than ".concat(mv," for int32 output type, was ").concat(s.shape[1]));var c={sortedSequence:s,values:u},l={side:t};return Q.runKernel(b2e,c,l)}var Mw=K({searchSorted_:NEe});function TEe(n,e){return Mw(n,e,"left")}function EEe(n,e,t,r,a){var i=M(n,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=ge(i,[1,i.shape[0],i.shape[1],i.shape[2]])),G(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(s.rank,".")}),G(Ko(t,o),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")}),wi("maxPool",r,a);var c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a},f=Q.runKernel(Mke,c,l);return u?ge(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var TB=K({maxPool_:EEe});function IEe(n,e,t,r,a,i){e===void 0&&(e=[1,1,1]),i===void 0&&(i="NDHWC");var o=M(n,"x","maxPool3d"),s=o,u=!1;o.rank===4&&(u=!0,s=ge(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),G(s.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),G(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),wi("maxPool3d",r,a);var c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a,dataFormat:i},f=Q.runKernel(Bke,c,l);return u?ge(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var CEe=K({maxPool3d_:IEe});function AEe(n,e,t,r,a){a===void 0&&(a=!1);var i=M(n,"x","maxPoolWithArgmax"),o={x:i},s={filterSize:e,strides:t,pad:r,includeBatchInIndex:a},u=Q.runKernel(Lke,o,s);return{result:u[0],indexes:u[1]}}var DEe=K({maxPoolWithArgmax_:AEe});function _Ee(n,e){var t,r=M(n,"a","maximum"),a=M(e,"b","maximum");t=Ne(Cn(r,a),2),r=t[0],a=t[1],r.dtype==="bool"&&(r=rr(r,"int32"),a=rr(a,"int32")),Xn(r.shape,a.shape);var i={a:r,b:a};return Q.runKernel(Pke,i)}var FEe=K({maximum_:_Ee});function REe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","mean"),a={x:r},i={axis:e,keepDims:t};return Q.runKernel(zke,a,i)}var Cv=K({mean_:REe});function Ic(n,e){if(e===void 0&&(e="float32"),ga(n),e==="complex64"){var t=Ic(n,"float32"),r=Ic(n,"float32");return Ys(t,r)}var a=Tw(Fr(n),e);return Q.makeTensor(a,n,e)}function Xs(n,e){if(e===void 0&&(e="float32"),ga(n),e==="complex64"){var t=Xs(n,"float32"),r=Ic(n,"float32");return Ys(t,r)}var a=V4(Fr(n),e);return Q.makeTensor(a,n,e)}function OEe(n,e,t){var r=t===void 0?{}:t,a=r.indexing,i=a===void 0?"xy":a;if(i!=="xy"&&i!=="ij")throw new TypeError("".concat(i," is not a valid third argument to meshgrid"));if(n===void 0)return[];var o=M(n,"x","meshgrid",n instanceof Dr?n.dtype:"float32");if(e===void 0)return[o];var s=M(e,"y","meshgrid",e instanceof Dr?e.dtype:"float32"),u=Fr(o.shape),c=Fr(s.shape);return i==="xy"?(o=ge(o,[1,-1]),s=ge(s,[-1,1]),[Bt(Xs([c,1],o.dtype),o),Bt(s,Xs([1,u],s.dtype))]):(o=ge(o,[-1,1]),s=ge(s,[1,-1]),[Bt(o,Xs([1,c],o.dtype)),Bt(Xs([u,1],s.dtype),s)])}function PEe(n,e){var t,r=M(n,"a","minimum"),a=M(e,"b","minimum");t=Ne(Cn(r,a),2),r=t[0],a=t[1],r.dtype==="bool"&&(r=rr(r,"int32"),a=rr(a,"int32")),Xn(r.shape,a.shape);var i={a:r,b:a};return Q.runKernel(qke,i)}var EB=K({minimum_:PEe});function MEe(n,e,t){G(t==="reflect"||t==="symmetric",function(){return"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(t,".")});var r=M(n,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");G(e.length===r.rank,function(){return"Padding doesn't match input. Must be ".concat(r.rank,". ")+"Got ".concat(e.length,".")});for(var a=t==="reflect"?1:0,i=function(c){G(e[c].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),G(e[c][0]>=0&&e[c][0]<=r.shape[c]-a&&e[c][1]>=0&&e[c][1]<=r.shape[c]-a,function(){return"Padding in dimension ".concat(c," cannot be greater than or equal ")+"to ".concat(r.shape[c]-a," or less than 0 for input of ")+"shape ".concat(r.shape)})},o=0;o<r.rank;o++)i(o);var s={paddings:e,mode:t},u={x:r};return Q.runKernel(Wke,u,s)}var BEe=K({mirrorPad_:MEe});function LEe(n,e){var t,r=M(n,"a","mod"),a=M(e,"b","mod");t=Ne(Cn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return Q.runKernel(Vke,i)}var zEe=K({mod_:LEe});function $Ee(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1),n=M(n,"x","moments");var r=Dv(e,n.shape),a=Cv(n,r,t),i=a.shape;t||(i=Ov(a.shape,r));var o=Pv(Ct(rr(n,"float32"),ge(a,i))),s=Cv(o,r,t);return{mean:a,variance:s}}var qEe=K({moments_:$Ee});function WEe(n,e,t,r){for(var a=M(e,"data","multiRNNCell"),i=Nv(t,"c","multiRNNCell"),o=Nv(r,"h","multiRNNCell"),s=a,u=[],c=0;c<n.length;c++){var l=n[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}for(var f=[],h=[],c=0;c<u.length;c+=2)f.push(u[c]),h.push(u[c+1]);return[f,h]}var VEe=K({multiRNNCell_:WEe});function GEe(n,e,t,r){r===void 0&&(r=!1);var a=M(n,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+"".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));t=t||Math.random();var s=o===1?ge(a,[1,-1]):a,u={logits:s},c={numSamples:e,seed:t,normalized:r},l=Q.runKernel(Gke,u,c);return o===1?ge(l,[l.size]):l}var UEe=K({multinomial_:GEe});function HEe(n,e){var t,r=M(n,"a","notEqual","string_or_numeric"),a=M(e,"b","notEqual","string_or_numeric");t=Ne(Cn(r,a),2),r=t[0],a=t[1],Xn(r.shape,a.shape);var i={a:r,b:a};return Q.runKernel(Kke,i)}var IB=K({notEqual_:HEe});function KEe(n,e,t,r,a){if(t===void 0&&(t=1),r===void 0&&(r=0),a===void 0&&(a="int32"),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(e));var i=M(n,"indices","oneHot","int32"),o={indices:i},s={dtype:a,depth:e,onValue:t,offValue:r};return Q.runKernel(Jke,o,s)}var jEe=K({oneHot_:KEe});function XEe(n){var e=M(n,"x","onesLike"),t={x:e};return Q.runKernel(Zke,t)}var YEe=K({onesLike_:XEe});function ZEe(n,e){var t=M(n,"v1","outerProduct"),r=M(e,"v2","outerProduct");G(t.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+"".concat(t.rank," and ").concat(r.rank,".")});var a=ge(t,[-1,1]),i=ge(r,[1,-1]);return Bt(a,i)}var JEe=K({outerProduct_:ZEe});function QEe(n,e,t){t===void 0&&(t=0);var r=M(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:r};return Q.runKernel(e2e,i,a)}var eh=K({pad_:QEe});function eIe(n,e,t){return t===void 0&&(t=0),G(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),eh(n,[e],t)}var tIe=K({pad1d_:eIe});function nIe(n,e,t){return t===void 0&&(t=0),G(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),eh(n,e,t)}var rIe=K({pad2d_:nIe});function aIe(n,e,t){return t===void 0&&(t=0),G(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),eh(n,e,t)}var iIe=K({pad3d_:aIe});function oIe(n,e,t){return t===void 0&&(t=0),G(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),eh(n,e,t)}var sIe=K({pad4d_:oIe});function uIe(n,e,t){var r=M(n,"x","spaceToBatchND");G(r.rank>=1+e.length,function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(e.length)}),G(t.length===e.length,function(){return"paddings.shape[0] ".concat(t.length," must be equal to [blockShape] ").concat(e.length)}),G(r.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(t.toString()," must be divisible by blockShapes ").concat(e.toString())});var a={x:r},i={blockShape:e,paddings:t};return Q.runKernel(D2e,a,i)}var CB=K({spaceToBatchND_:uIe});function cIe(n,e,t,r,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),r===0&&(r="valid");var s=M(n,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),G(Ko(i,a),function(){return"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'")});var l=YSe(u.shape,e,i,a,r),f=[l.dilationHeight,l.dilationWidth],h;r==="same"?h=fIe([l.filterHeight,l.filterWidth],f):h=[[0,0],[0,0]];var d=f[0]===1&&f[1]===1,p=Ne(lIe([l.inHeight,l.inWidth],f,h),2),v=p[0],m=p[1],g=d?r:"valid",y=d?u:CB(u,f,v),b=t==="avg"?function(){return sB(y,e,i,g,o)}:function(){return TB(y,e,i,g,o)},w=b(),x=d?w:uB(w,f,m);return c?ge(x,[x.shape[1],x.shape[2],x.shape[3]]):x}function lIe(n,e,t){var r=t.map(function(l){return l[0]}),a=t.map(function(l){return l[1]}),i=n.concat(r,a),o=e.map(function(l,f){return(l-i[f]%l)%l}),s=a.map(function(l,f){return l+o[f]}),u=e.map(function(l,f){return[r[f],s[f]]}),c=e.map(function(l,f){return[0,o[f]]});return[u,c]}function fIe(n,e){var t=n.map(function(o,s){return o+(o-1)*(e[s]-1)}),r=t.map(function(o){return o-1}),a=r.map(function(o){return Math.floor(o/2)}),i=r.map(function(o,s){return o-a[s]});return r.map(function(o,s){return[a[s],i[s]]})}var hIe=K({pool_:cIe});function dIe(n,e){var t=M(n,"x","prelu"),r=M(e,"alpha","prelu"),a={x:t,alpha:r};return Q.runKernel(n2e,a)}var AB=K({prelu_:dIe});function pIe(n,e){e===void 0&&(e=!1),console.log(n.toString(e))}function vIe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","prod");r.dtype==="bool"&&(r=rr(r,"int32"));var a={x:r},i={axis:e,keepDims:t};return Q.runKernel(r2e,a,i)}var mIe=K({prod_:vIe});function gIe(n,e,t,r){var a=n.map(function(l,f){return M(l,"tensors".concat(f),"raggedGather","int32")}),i=M(e,"paramsDenseValues","raggedGather"),o=M(t,"indices","raggedGather","int32"),s={paramsNestedSplits:a,paramsDenseValues:i,indices:o},u={outputRaggedRank:r},c=Q.runKernel(a2e,s,u);return{outputNestedSplits:c.slice(0,c.length-1),outputDenseValues:c[c.length-1]}}var yIe=K({raggedGather_:gIe});function bIe(n,e,t){var r=M(n,"starts","raggedRange"),a=M(e,"limits","raggedRange",r.dtype),i=M(t,"deltas","raggedRange",r.dtype),o={starts:r,limits:a,deltas:i},s=Q.runKernel(i2e,o);return{rtNestedSplits:s[0],rtDenseValues:s[1]}}var wIe=K({raggedRange_:bIe});function xIe(n,e,t,r,a){var i=M(n,"shape","raggedTensorToTensor","int32"),o=M(e,"values","raggedTensorToTensor"),s=M(t,"defaultValue","raggedTensorToTensor",o.dtype),u=r.map(function(f,h){return M(f,"tensors".concat(h),"raggedTensorToTensor","int32")}),c={shape:i,values:o,defaultValue:s,rowPartitionTensors:u},l={rowPartitionTypes:a};return Q.runKernel(o2e,c,l)}var kIe=K({raggedTensorToTensor_:xIe});function SIe(n,e,t){ga(n);var r=Fr(n),a=null;if(t==null||t==="float32")a=new Float32Array(r);else if(t==="int32")a=new Int32Array(r);else if(t==="bool")a=new Uint8Array(r);else throw new Error("Unknown data type ".concat(t));for(var i=0;i<r;i++)a[i]=e();return Q.makeTensor(a,n,t)}var NIe=K({rand_:SIe}),eu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function TIe(n){if(n.__esModule)return n;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(n).forEach(function(t){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}),e}function tu(n){var e={exports:{}};return n(e,e.exports),e.exports}var EIe=tu(function(n){(function(e,t,r){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.alea=o})(eu,n,!1)}),IIe=tu(function(n){(function(e,t,r){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor128=o})(eu,n,!1)}),CIe=tu(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorwow=o})(eu,n,!1)}),AIe=tu(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,d;return h=l[f],h^=h>>>7,d=h^h<<24,h=l[f+1&7],d^=h^h>>>10,h=l[f+3&7],d^=h^h>>>3,h=l[f+4&7],d^=h^h<<7,h=l[f+7&7],h=h^h<<13,d^=h^h<<9,l[f]=d,u.i=f+1&7,d};function c(l,f){var h,d=[];if(f===(f|0))d[0]=f;else for(f=""+f,h=0;h<f.length;++h)d[h&7]=d[h&7]<<15^f.charCodeAt(h)+d[h+1&7]<<13;for(;d.length<8;)d.push(0);for(h=0;h<8&&d[h]===0;++h);for(h==8&&(d[7]=-1),l.x=d,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorshift7=o})(eu,n,!1)}),DIe=tu(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,d,p;return u.w=l=l+1640531527|0,p=f[h+34&127],d=f[h=h+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,p=f[h]=p^d,u.i=h,p+(l^l>>>16)|0};function c(l,f){var h,d,p,v,m,g=[],y=128;for(f===(f|0)?(d=f,f=null):(f=f+"\0",d=0,y=Math.max(y,f.length)),p=0,v=-32;v<y;++v)f&&(d^=f.charCodeAt((v+32)%f.length)),v===0&&(m=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,v>=0&&(m=m+1640531527|0,h=g[v&127]^=d+m,p=h==0?p+1:0);for(p>=128&&(g[(f&&f.length||0)&127]=-1),p=127,v=4*128;v>0;--v)d=g[p+34&127],h=g[p=p+1&127],d^=d<<13,h^=h<<17,d^=d>>>15,h^=h>>>12,g[p]=d^h;l.w=m,l.X=g,l.i=p}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor4096=o})(eu,n,!1)}),_Ie=tu(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,d=u.d,p=u.a;return f=f<<25^f>>>7^h,h=h-d|0,d=d<<24^d>>>8^p,p=p-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-d|0,u.d=d<<16^h>>>16^p,u.a=p-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.tychei=o})(eu,n,!1)}),FIe={},RIe={__proto__:null,default:FIe},OIe=TIe(RIe),nu=tu(function(n){(function(e,t,r){var a=256,i=6,o=52,s="random",u=r.pow(a,i),c=r.pow(2,o),l=c*2,f=a-1,h;function d(w,x,N){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(m(x.entropy?[w,b(t)]:w??y(),3),T),C=new p(T),F=function(){for(var _=C.g(i),O=u,L=0;_<c;)_=(_+L)*a,O*=a,L=C.g(1);for(;_>=l;)_/=2,O/=2,L>>>=1;return(_+L)/O};return F.int32=function(){return C.g(4)|0},F.quick=function(){return C.g(4)/4294967296},F.double=F,g(b(C.S),t),(x.pass||N||function(_,O,L,z){return z&&(z.S&&v(z,C),_.state=function(){return v(C,{})}),L?(r[s]=_,O):_})(F,E,"global"in x?x.global:this==r,x.state)}function p(w){var x,N=w.length,T=this,E=0,C=T.i=T.j=0,F=T.S=[];for(N||(w=[N++]);E<a;)F[E]=E++;for(E=0;E<a;E++)F[E]=F[C=f&C+w[E%N]+(x=F[E])],F[C]=x;(T.g=function(_){for(var O,L=0,z=T.i,$=T.j,B=T.S;_--;)O=B[z=f&z+1],L=L*a+B[f&(B[z]=B[$=f&$+O])+(B[$]=O)];return T.i=z,T.j=$,L})(a)}function v(w,x){return x.i=w.i,x.j=w.j,x.S=w.S.slice(),x}function m(w,x){var N=[],T=typeof w,E;if(x&&T=="object")for(E in w)try{N.push(m(w[E],x-1))}catch{}return N.length?N:T=="string"?w:w+"\0"}function g(w,x){for(var N=w+"",T,E=0;E<N.length;)x[f&E]=f&(T^=x[f&E]*19)+N.charCodeAt(E++);return b(x)}function y(){try{var w;return h&&(w=h.randomBytes)?w=w(a):(w=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var x=e.navigator,N=x&&x.plugins;return[+new Date,e,N,e.screen,b(t)]}}function b(w){return String.fromCharCode.apply(0,w)}if(g(r.random(),t),n.exports){n.exports=d;try{h=OIe}catch{}}else r["seed"+s]=d})(typeof self<"u"?self:eu,[],Math)});nu.alea=EIe;nu.xor128=IIe;nu.xorwow=CIe;nu.xorshift7=AIe;nu.xor4096=DIe;nu.tychei=_Ie;var Bw=nu;var Lw=function(){function n(e,t,r,a,i){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);var o=i||Math.random();this.random=Bw.alea(o.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,r,a=!1;!a;){var i=void 0,o=void 0,s=void 0;do i=2*this.random()-1,o=2*this.random()-1,s=i*i+o*o;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*i*u,r=this.mean+this.stdDev*o*u,(!this.truncated||this.isValidTruncated(t))&&(a=!0)}return(!this.truncated||this.isValidTruncated(r))&&(this.nextVal=this.convertValue(r)),this.convertValue(t)},n.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},n.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},n}(),PIe=function(){function n(e,t,r,a){this.alpha=e,this.beta=1/t,this.dtype=r;var i=a||Math.random();this.randu=Bw.alea(i.toString()),this.randn=new Lw(0,1,r,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var e,t,r,a,i,o;;){do a=this.randn.nextValue(),o=1+this.c*a;while(o<=0);if(o*=o*o,e=a*a,t=1-.331*e*e,r=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<t||Math.log(i)<r)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},n.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},n}(),MIe=function(){function n(e,t,r,a){e===void 0&&(e=0),t===void 0&&(t=1);var i=this;if(this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=r,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(e," - ").concat(t," <= 1 and dtype is not float"));this.random=Bw.alea(a)}return n.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n}();function BIe(n,e,t,r,a){if(t===void 0&&(t=1),r===void 0&&(r="float32"),ga(n),t==null&&(t=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type ".concat(r));for(var i=new PIe(e,t,r,a),o=Uo(n,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var LIe=K({randomGamma_:BIe});function zIe(n,e,t,r,a){if(e===void 0&&(e=0),t===void 0&&(t=1),ga(n),r!=null&&r==="bool")throw new Error("Unsupported data type ".concat(r));for(var i=new Lw(e,t,r,!1,a),o=Uo(n,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var DB=K({randomNormal_:zIe});function $Ie(n,e,t){if(e!=null&&e==="bool")throw new Error("Unsupported data type ".concat(e));return DB(n,0,1,e,t)}var qIe=K({randomStandardNormal_:$Ie});function WIe(n,e,t,r,a){e===void 0&&(e=0),t===void 0&&(t=1),r===void 0&&(r="float32"),ga(n);for(var i=Uo(n,r),o=new MIe(e,t,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}var _B=K({randomUniform_:WIe});function Yf(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t===0)throw new Error("Cannot have a step of zero");var a={start:n,stop:e,step:t,dtype:r};return Q.runKernel(s2e,{},a)}function VIe(n){var e=M(n,"input","real"),t={input:e};return Q.runKernel(u2e,t)}var Zf=K({real_:VIe});function GIe(n){var e=M(n,"x","reciprocal"),t={x:e};return Q.runKernel(c2e,t)}var UIe=K({reciprocal_:GIe});function HIe(n){var e=M(n,"x","relu"),t={x:e};return Q.runKernel(l2e,t)}var zv=K({relu_:HIe});function KIe(n){var e=M(n,"x","relu6"),t={x:e};return Q.runKernel(p2e,t)}var FB=K({relu6_:KIe});function jIe(n,e){var t=M(n,"x","reverse"),r={x:t},a={dims:e};return Q.runKernel(v2e,r,a)}var Js=K({reverse_:jIe});function XIe(n){var e=M(n,"x","reverse");return G(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(e.rank,".")}),Js(e,0)}var YIe=K({reverse1d_:XIe});function ZIe(n,e){var t=M(n,"x","reverse");return G(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(t.rank,".")}),Js(t,e)}var JIe=K({reverse2d_:ZIe});function QIe(n,e){var t=M(n,"x","reverse");return G(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(t.rank,".")}),Js(t,e)}var eCe=K({reverse3d_:QIe});function tCe(n,e){var t=M(n,"x","reverse");return G(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(t.rank,".")}),Js(t,e)}var nCe=K({reverse4d_:tCe});function rCe(n){var e=M(n,"x","round"),t={x:e};return Q.runKernel(m2e,t)}var RB=K({round_:rCe});function aCe(n){var e=M(n,"x","rsqrt","float32"),t={x:e};return Q.runKernel(g2e,t)}var iCe=K({rsqrt_:aCe});function oCe(n){var e=M(n,"x","selu"),t={x:e};return Q.runKernel(x2e,t)}var sCe=K({selu_:oCe});function uCe(n,e,t,r,a,i,o){i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC");var s=M(n,"x","separableConv2d"),u=M(e,"depthwiseFilter","separableConv2d"),c=M(t,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(s.rank===3&&(f=!0,l=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");G(l.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(l.rank,".")}),G(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),G(c.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),G(c.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(c.shape[0],".")}),G(c.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(c.shape[1],".")});var h=u.shape[2],d=u.shape[3];G(c.shape[2]===h*d,function(){return"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(h*d,", ")+"but got ".concat(c.shape[2],".")});var p=Fw(l,u,r,a,o,i),v=1,m=Rv(p,c,v,"valid",o);return f?ge(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var cCe=K({separableConv2d_:uCe});function lCe(n,e){return Pt(this,void 0,void 0,function(){var t,r,a,i,o,s,l,u,c,l,f;return Dt(this,function(h){switch(h.label){case 0:return t=M(n,"x","setdiff1d"),r=M(e,"y","setdiff1d"),G(t.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x (".concat(t.dtype,") and y (").concat(r.dtype,").")}),G(t.rank===1,function(){return"x should be 1D tensor, but got x (".concat(t.shape,").")}),G(r.rank===1,function(){return"y should be 1D tensor, but got y (".concat(r.shape,").")}),[4,t.data()];case 1:return a=h.sent(),[4,r.data()];case 2:for(i=h.sent(),o=new Set(i),s=0,l=0;l<a.length;l++)o.has(a[l])||s++;for(u=new uw([s],t.dtype),c=new uw([s],"int32"),l=0,f=0;l<a.length;l++)o.has(a[l])||(u.values[f]=a[l],c.values[f]=l,f++);return[2,[u.toTensor(),c.toTensor()]]}})})}var fCe=lCe;function hCe(n){var e=M(n,"x","sign"),t={x:e};return Q.runKernel(T2e,t)}var dCe=K({sign_:hCe});function pCe(n){var e=M(n,"x","sin","float32"),t={x:e};return Q.runKernel(S2e,t)}var vCe=K({sin_:pCe});function mCe(n){var e=M(n,"x","sinh"),t={x:e};return Q.runKernel(N2e,t)}var gCe=K({sinh_:mCe});function yCe(n,e,t){var r=M(n,"x","slice1d");return G(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")}),fn(r,[e],[t])}var bCe=K({slice1d_:yCe});function wCe(n,e,t){var r=M(n,"x","slice2d");return G(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")}),fn(r,e,t)}var xCe=K({slice2d_:wCe});function kCe(n,e,t){var r=M(n,"x","slice3d");return G(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")}),fn(r,e,t)}var SCe=K({slice3d_:kCe});function NCe(n,e,t){var r=M(n,"x","slice4d");return G(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")}),fn(r,e,t)}var TCe=K({slice4d_:NCe});function ECe(n,e){e===void 0&&(e=-1);var t=M(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and dim was ").concat(e));var r={logits:t},a={dim:e};return Q.runKernel(F2e,r,a)}var ICe=K({softmax_:ECe});function CCe(n){G(n.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(n.dtype,".")});var e={input:n};return Q.runKernel(cke,e)}var zw=K({fft_:CCe});function ACe(n){G(n.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(n.dtype,".")});var e={input:n};return Q.runKernel(bke,e)}var Av=K({ifft_:ACe});function DCe(n){var e=n.shape[n.shape.length-1],t=n.size/e,r;if(e<=2){var a=ge(n,[t,e]);r=Av(a)}else{var i=[t,2*(e-1)],o=ge(Zf(n),[t,e]),s=ge(Lv(n),[t,e]),u=Js(fn(o,[0,1],[t,e-2]),1),c=mt(Js(fn(s,[0,1],[t,e-2]),1),bn(-1)),l=Qr([o,u],1),f=Qr([s,c],1),a=ge(Ys(l,f),[i[0],i[1]]);r=Av(a)}if(r=Zf(r),n.rank===3&&n.shape[0]!==0){var h=r,d=n.shape[0];r=ge(r,[d,r.shape[0]/d,r.shape[1]]),h.dispose()}return r}var OB=K({irfft_:DCe});function _Ce(n,e,t){t===void 0&&(t=0);var r=M(n,"x","split"),a={x:r},i={numOrSizeSplits:e,axis:t};return Q.runKernel(_2e,a,i)}var Jf=K({split_:_Ce});function FCe(n,e){G(n.dtype==="float32",function(){return"The dtype for rfft() must be real value but got ".concat(n.dtype)});var t=n.shape[n.shape.length-1],r=n.size/t,a;if(e!=null&&e<t){var i=n.shape.map(function(g){return 0}),o=n.shape.map(function(g){return g});o[n.shape.length-1]=e,a=fn(n,i,o),t=e}else if(e!=null&&e>t){var s=n.shape.map(function(g){return g});s[n.shape.length-1]=e-t,a=Qr([n,Ic(s)],n.shape.length-1),t=e}else a=n;var u=Rw(a),c=ge(Ys(a,u),[r,t]),l=zw(c),f=Math.floor(t/2)+1,h=Zf(l),d=Lv(l),p=Jf(h,[f,t-f],h.shape.length-1),v=Jf(d,[f,t-f],d.shape.length-1),m=a.shape.slice();return m[a.shape.length-1]=f,ge(Ys(p[0],v[0]),m)}var $w=K({rfft_:FCe});function RCe(n,e){var t,r=M(n,"a","squaredDifference"),a=M(e,"b","squaredDifference");t=Ne(Cn(r,a),2),r=t[0],a=t[1],Xn(r.shape,a.shape);var i={a:r,b:a},o={};return Q.runKernel(L2e,i,o)}var PB=K({squaredDifference_:RCe});function OCe(n,e){var t=M(n,"x","squeeze","string_or_numeric");return ge(t,exe(t.shape,e).newShape)}var qw=K({squeeze_:OCe});function PCe(n,e){e===void 0&&(e=0);var t=Nv(n,"tensors","stack","string_or_numeric");G(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&G(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var r=t,a={axis:e};return Q.runKernel(Qke,r,a)}var Qf=K({stack_:PCe});function MCe(n,e){e===void 0&&(e=0);var t=M(n,"x","step"),r={x:t},a={alpha:e};return Q.runKernel(J2e,r,a)}var MB=K({step_:MCe});function BCe(n,e,t,r,a,i,o,s,u){a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),u===void 0&&(u=0);var c=M(n,"x","stridedSlice","string_or_numeric"),l={x:c},f={begin:e,end:t,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return Q.runKernel(z2e,l,f)}var LCe=K({stridedSlice_:BCe});function zCe(n){var e=M(n,"x","tan","float32"),t={x:e};return Q.runKernel(G2e,t)}var $Ce=K({tan_:zCe});function Ww(n,e,t){var r=Ho(n,t);return jo(n,e,r,t)}function gi(n,e){Cc(n);var t=Ho(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");var r=null;return jo(n,r,t,e)}function Uf(n,e,t){if(Cc(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=Ho(n,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return jo(n,e,r,t)}function qCe(n,e,t){if(Cc(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=Ho(n,t);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return jo(n,e,r,t)}function WCe(n,e,t){if(Cc(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=Ho(n,t);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return jo(n,e,r,t)}function VCe(n,e,t){if(Cc(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=Ho(n,t);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return jo(n,e,r,t)}function GCe(n,e,t){if(Cc(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=Ho(n,t);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||r,jo(n,e,r,t)}function UCe(n,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var r=M(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(e<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(e));if(e>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") ")+"but got ".concat(e));var i={x:r},o={k:e,sorted:t},s=Ne(Q.runKernel(H2e,i,o),2),u=s[0],c=s[1];return{values:u,indices:c}}var HCe=K({topk_:UCe});function KCe(n,e,t,r,a){if(e===void 0&&(e=0),t===void 0&&(t=1),ga(n),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");for(var i=new Lw(e,t,r,!0,a),o=Uo(n,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var jCe=K({truncatedNormal_:KCe});function XCe(n,e){e===void 0&&(e=0);var t=M(n,"x","unique","string_or_numeric");G(t.rank>0,function(){return"The input tensor must be at least 1D"});var r={x:t},a={axis:e},i=Ne(Q.runKernel(j2e,r,a),2),o=i[0],s=i[1];return{values:o,indices:s}}var YCe=K({unique_:XCe});function ZCe(n,e,t){var r=M(n,"x","unsortedSegmentSum"),a=M(e,"segmentIds","unsortedSegmentSum","int32");G(Hf(t),function(){return"numSegments must be of dtype int"});var i={x:r,segmentIds:a},o={numSegments:t};return Q.runKernel(Y2e,i,o)}var JCe=K({unsortedSegmentSum_:ZCe});function QCe(n,e){e===void 0&&(e=0);var t=M(n,"x","unstack","string_or_numeric");G(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = ".concat(e," is not in [-").concat(t.shape.length,", ").concat(t.shape.length,")")});var r={value:t},a={axis:e};return Q.runKernel(X2e,r,a)}var Vw=K({unstack_:QCe});function eAe(n,e){return Mw(n,e,"right")}function tAe(n,e,t,r){return e===void 0&&(e=!0),Q.makeVariable(n,e,t,r)}function nAe(n,e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(r);for(var a=Uo(n,"int32"),i=Uo([t.length,n.length],"int32"),r=0;r<t.length;r++){var o=a.indexToLoc(t[r]),s=r*n.length;i.values.set(o,s)}return i.toTensor()}function rAe(n){return Pt(this,void 0,void 0,function(){var e,t,r;return Dt(this,function(a){switch(a.label){case 0:return e=M(n,"condition","whereAsync","bool"),[4,e.data()];case 1:return t=a.sent(),r=nAe(e.shape,t),n!==e&&e.dispose(),[2,r]}})})}var BB=rAe;function aAe(n,e,t){return Pt(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f,h,d,p,v;return Dt(this,function(m){switch(m.label){case 0:for(r=M(n,"tensor","boolMask"),a=M(e,"mask","boolMask","bool"),i=t??0,o=a.rank,s=r.shape,G(o>0,function(){return"mask cannot be scalar"}),Ua(s.slice(i,i+o),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+o;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+o)),f=ge(r,l),h=ge(a,[-1]),[4,BB(h)];case 1:return d=m.sent(),p=qw(d,[1]),v=gB(f,p,i),n!==r&&r.dispose(),e!==a&&a.dispose(),p.dispose(),f.dispose(),h.dispose(),d.dispose(),[2,v]}})})}var iAe=aAe;function oAe(n,e){return Q.tidy(n,e)}function sAe(n){var e=rB(n);e.forEach(function(t){return t.dispose()})}function uAe(n,e,t){var r=M(n,"x","transpose");if(e==null&&(e=r.shape.map(function(o,s){return s}).reverse()),G(r.rank===e.length,function(){return"Error in transpose: rank of input ".concat(r.rank," ")+"must match length of perm ".concat(e,".")}),e.forEach(function(o){G(o>=0&&o<r.rank,function(){return"All entries in 'perm' must be between 0 and ".concat(r.rank-1)+" but got ".concat(e)})}),r.rank<=1)return r.clone();var a={x:r},i={perm:e};return r.dtype==="complex64"?oAe(function(){var o=Zf(r),s=Lv(r);return o=Q.runKernel(G1,{x:o},i),s=Q.runKernel(G1,{x:s},i),t&&(s=io(s)),Ys(o,s)}):Q.runKernel(G1,a,i)}var yw=K({transpose_:uAe});function cAe(n,e,t,r,a){a===void 0&&(a=!0);var i=M(n,"v","movingAverage"),o=M(e,"x","movingAverage"),s=M(t,"decay","movingAverage");ySe(i,o),G(Ac(i.shape,o.shape),function(){return"Shape mismatch in v and x"});var u=bn(1),c=Ct(u,s),l=mt(Ct(o,i),c);if(a){G(r!=null,function(){return"When using zeroDebias: true, step is required."});var f=M(r,"step","movingAverage");l=yr(l,Ct(u,Ow(s,f)))}return jn(i,l)}var lAe=K({movingAverage_:cAe});function fAe(n,e,t){var r=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(t.shape)+", indices.shape: ".concat(e.shape,", shape: ").concat(n)+", sliceDim: ".concat(r,", and batchDim: ").concat(a,".");if(t.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(n.length<r+(t.rank-a))throw new Error(i+" Output shape length < ".concat(r+(t.rank-a)));if(t.rank!==a+n.length-r)throw new Error(i+" update.rank != ".concat(a+n.length-r));for(var o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(t.shape[o],") != indices.shape[").concat(o,"] (").concat(e.shape[o],")."));for(var o=0;o<t.rank-a;++o)if(t.shape[o+a]!==n[o+r])throw new Error(i+" updates.shape[".concat(o+a,"] (").concat(t.shape[o+a],") != shape[").concat(o+a,"] (").concat(n[o+a],")"))}function hAe(n,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(n.rank,"."));if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(e.dtype));if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(t));if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: ".concat(e.shape));if(n.size===0)throw new Error("Updates specified for empty output. updates shape: ".concat(n.shape))}fAe(t,e,n)}function dAe(n,e,t){ga(t);var r=M(n,"indices","scatterND","int32"),a=M(e,"updates","scatterND");hAe(a,r,t);var i={indices:r,updates:a},o={shape:t};return Q.runKernel(y2e,i,o)}var pAe=K({scatterND_:dAe});function vAe(n,e,t,r){if(n.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+" but the dtype was ".concat(n.dtype,"."));if(n.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+" but got shape ".concat(n.shape,"."));var a=n.rank>0?n.shape[0]:1,i=n.rank>1?n.shape[1]:1;if(t.length!==i)throw new Error("outputShape has incorrect number of elements:,"+" ".concat(t.length,", should be: ").concat(i,"."));var o=e.size;if(!(e.rank===0||e.rank===1&&o===a))throw new Error("sparseValues has incorrect shape "+"".concat(e.shape,", should be [] or [").concat(a,"]"));if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function mAe(n,e,t,r){r===void 0&&(r=0),ga(t);var a=M(n,"sparseIndices","sparseToDense","int32"),i=M(e,"sparseValues","sparseToDense","string_or_numeric"),o=M(r,"defaultValue","sparseToDense",i.dtype);vAe(a,i,t,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:t};return Q.runKernel(B2e,s,u)}var gAe=K({sparseToDense_:mAe});function yAe(n,e){var t=M(e,"indices","gatherND","int32"),r=M(n,"x","gatherND","string_or_numeric"),a={params:r,indices:t};return Q.runKernel(mke,a)}var bAe=K({gatherND_:yAe});function wAe(n,e){if(e==null)return n.shape.slice();if(Ac(n.shape,e))return e;if(n.shape.length===e.length){for(var t=[],r=0;r<n.shape.length;r++)e[r]==null&&n.shape[r]!=null?t.push(n.shape[r]):t.push(e[r]);return t}return e}function xAe(n,e,t,r){var a=M(n,"x","dropout");if(G(a.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(a.dtype," tensor instead.")}),G(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got ".concat(e,".")}),e===0)return n instanceof Dr?a.clone():a;var i=wAe(a,t),o=1-e,s=yr(mB(jn(_B(i,0,1,"float32",r),o)),o);return mt(a,s)}var kAe=K({dropout_:xAe});function LB(n){return Math.floor(Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))))}function Gw(n,e,t){for(var r=1-n%2,a=new Float32Array(n),i=0;i<n;++i){var o=2*Math.PI*i/(n+r-1);a[i]=e-t*Math.cos(o)}return gi(a,"float32")}function SAe(n,e,t){return t===void 0&&(t=1),Pt(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f,h,d,p,v,m,m;return Dt(this,function(g){switch(g.label){case 0:return r=M(n,"predictions","inTopK"),a=M(e,"targets","inTopK"),G(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, "+"but got ".concat(r.rank)}),G(r.rank-1===a.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+"".concat(r.rank," and targets rank ").concat(a.rank)}),Ua(r.shape.slice(0,r.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],G(t>0&&t<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last "+"dimension (".concat(i,"), but got ").concat(t)}),[4,r.data()];case 1:return o=g.sent(),[4,a.data()];case 2:for(s=g.sent(),u=Ne([o.length/i,i],2),c=u[0],l=u[1],f=txe("bool",c),h=0;h<c;h++){for(d=h*l,p=o.subarray(d,d+l),v=[],m=0;m<p.length;m++)v.push({value:p[m],index:m});for(v.sort(function(y,b){return b.value-y.value}),f[h]=0,m=0;m<t;m++)if(v[m].index===s[h]){f[h]=1;break}}return n!==r&&r.dispose(),e!==a&&a.dispose(),[2,Ww(f,a.shape,"bool")]}})})}var NAe=SAe;function TAe(n,e,t,r,a,i,o){i===void 0&&(i="NHWC");var s=n;n.rank===3&&(s=ge(n,[1,n.shape[0],n.shape[1],n.shape[2]]));var u=e;u.rank===3&&(u=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]])),G(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")}),G(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")}),G(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(t,".")});var c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];G(c===t[2],function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(t[2],".")}),G(l===t[3],function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(t[3],").")}),wi("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return Q.runKernel(zxe,f,h)}var EAe=K({conv2DBackpropFilter_:TAe});function Uw(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return mt(n,MB(e));throw new Error("Cannot compute gradient for fused activation ".concat(t,"."))}function Hw(n,e){var t=e,r=mTe(n.shape,e.shape);return r.length>0&&(t=en(t,r)),ge(t,n.shape)}function Kw(n,e,t,r){if(e==="linear")return n;if(e==="relu")return zv(n);if(e==="elu")return dB(n);if(e==="relu6")return FB(n);if(e==="prelu")return AB(n,t);if(e==="leakyrelu")return bB(n,r);if(e==="sigmoid")return xc(n);throw new Error("Unknown fused activation ".concat(e,"."))}var jw=function(n,e){var t=n>0;return!t||e==="linear"};function IAe(n){var e,t=n.x,r=n.filter,a=n.strides,i=n.pad,o=n.dataFormat,s=o===void 0?"NHWC":o,u=n.dilations,c=u===void 0?[1,1]:u,l=n.dimRoundingMode,f=n.bias,h=n.activation,d=h===void 0?"linear":h,p=n.preluActivationWeights,v=n.leakyreluAlpha;if(d=d||"linear",jw(Q.state.gradientDepth,d)===!1){G(s==="NHWC",function(){return"Error in fused conv2d: got dataFormat of ".concat(s," but ")+"only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."});var m=Rv(t,r,a,i,s,c,l);return f!=null&&(m=jn(m,f)),Kw(m,d,p,v)}var g=M(t,"x","conv2d","float32"),y=M(r,"filter","conv2d","float32"),b=g,w=!1;g.rank===3&&(w=!0,b=ge(g,[1,g.shape[0],g.shape[1],g.shape[2]])),G(b.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(b.rank,".")}),G(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(y.rank,".")}),wi("fused conv2d",i,l);var x=s==="NHWC"?b.shape[3]:b.shape[1];G(y.shape[2]===x,function(){return"Error in conv2d: depth of input (".concat(x,") must match ")+"input depth for filter ".concat(y.shape[2],".")}),G(Ko(a,c),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(a," and dilations '").concat(c,"'")});var N=_w(b.shape,y.shape,a,c,i,l),T;f!=null&&(T=M(f,"bias","fused conv2d"),e=Ne(Cn(T,g),1),T=e[0],s==="NHWC"?Xn(N.outShape,T.shape):(G(T.shape.length<=1,function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+"rank-".concat(T.shape.length,".")}),G(T.shape.length===0||T.shape[0]===N.outChannels||T.shape[0]===1,function(){return"Error in fused conv2d: bias shape (".concat(T.shape,") is not ")+"compatible with the number of output channels "+"(".concat(N.outChannels,")")})));var E;if(p!=null){var C=p.shape;if(G(C.length<=1||C.length===3,function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+"rank-".concat(C.length,".")}),C.length===1)G(C[0]===1||C[0]===N.outChannels,function(){return"Error in fused conv2d: PReLU activation weights "+"(".concat(C,") is not compatible with the number of output ")+"channels (".concat(N.outChannels,").")});else if(C.length===3)try{Xn(C,N.outShape)}catch{var F="Error in fused conv2d: PReLU activation weights (".concat(C,") ")+"is not compatible with the output shape of the conv2d "+"(".concat(N.outShape,").");throw Error(F)}E=M(p,"prelu weights","fused conv2d")}var _=function(B,W){G(s==="NHWC",function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(s," but only NHWC is currently supported.")});var X=Ne(W,4),Z=X[0],V=X[1],j=X[2],re=X[3],ne=Uw(B,j,d);G(Ev(c),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(c,"'")});var oe=lB(V.shape,ne,Z,a,i),le=EAe(V,ne,Z.shape,a,i),pe=[oe,le];if(re!=null){var xe=Hw(re,ne);pe.push(xe)}return pe},O={x:b,filter:y,bias:T,preluActivationWeights:E},L={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:d,leakyreluAlpha:v};if(f==null){var z=oo(function(B,W,X){var Z=Q.runKernel(m4,O,L);return X([W,B,Z]),w&&(Z=ge(Z,[Z.shape[1],Z.shape[2],Z.shape[3]])),{value:Z,gradFunc:_}});return z(b,y)}else{var $=oo(function(B,W,X,Z){var V=Q.runKernel(m4,O,L);return Z([W,B,V,X]),w&&(V=ge(V,[V.shape[1],V.shape[2],V.shape[3]])),{value:V,gradFunc:_}});return $(b,y,T)}}var CAe=K({fusedConv2d_:IAe});function AAe(n,e,t,r,a,i,o){i===void 0&&(i=[1,1]);var s=n;n.rank===3&&(s=ge(n,[1,n.shape[0],n.shape[1],n.shape[2]]));var u=e;u.rank===3&&(u=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={x:s,dy:u},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return Q.runKernel(Zxe,c,l)}var DAe=K({depthwiseConv2dNativeBackpropFilter_:AAe});function _Ae(n,e,t,r,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={dy:s,filter:t},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:n},f=Q.runKernel(Jxe,c,l);return u?ge(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var FAe=K({depthwiseConv2dNativeBackpropInput_:_Ae});function RAe(n){var e,t=n.x,r=n.filter,a=n.strides,i=n.pad,o=n.dataFormat,s=o===void 0?"NHWC":o,u=n.dilations,c=u===void 0?[1,1]:u,l=n.dimRoundingMode,f=n.bias,h=n.activation,d=h===void 0?"linear":h,p=n.preluActivationWeights,v=n.leakyreluAlpha;if(jw(Q.state.gradientDepth,d)===!1){var m=Fw(t,r,a,i,s,c,l);return f!=null&&(m=jn(m,f)),Kw(m,d,p,v)}var g=M(t,"x","depthwiseConv2d","float32"),y=M(r,"filter","depthwiseConv2d","float32"),b=g,w=!1;g.rank===3&&(w=!0,b=ge(g,[1,g.shape[0],g.shape[1],g.shape[2]])),G(b.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(b.rank,".")}),G(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+"but got rank ".concat(y.rank,".")}),G(b.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels "+"(".concat(b.shape[3],") must match the inChannels dimension in ")+"filter ".concat(y.shape[2],".")}),c==null&&(c=[1,1]),G(Ko(a,c),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+"be 1. Got strides ".concat(a," and dilations '").concat(c,"'")}),wi("fused depthwiseConv2d",i,l);var x=_w(b.shape,y.shape,a,c,i,l,!0),N;f!=null&&(N=M(f,"bias","fused conv2d"),e=Ne(Cn(N,g),1),N=e[0],Xn(x.outShape,N.shape));var T;p!=null&&(T=M(p,"prelu weights","fused depthwiseConv2d"));var E=function(L,z){G(Ev(c),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(c,"'")});var $=Ne(z,4),B=$[0],W=$[1],X=$[2],Z=$[3],V=Uw(L,X,d),j=FAe(W.shape,V,B,a,i,c,l),re=DAe(W,V,B.shape,a,i,c,l);if(Z!=null){var ne=Hw(N,V);return[j,re,ne]}return[j,re]},C={x:b,filter:y,bias:N,preluActivationWeights:T},F={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:d,leakyreluAlpha:v};if(f==null){var _=oo(function(L,z,$){var B=Q.runKernel(g4,C,F);return $([z,L,B]),w&&(B=ge(B,[B.shape[1],B.shape[2],B.shape[3]])),{value:B,gradFunc:E}});return _(b,y)}else{var O=oo(function(L,z,$,B){var W=Q.runKernel(g4,C,F);return B([z,L,W,$]),w&&(W=ge(W,[W.shape[1],W.shape[2],W.shape[3]])),{value:W,gradFunc:E}});return O(b,y,N)}}var OAe=K({fusedDepthwiseConv2d_:RAe});function PAe(n){var e,t,r=n.a,a=n.b,i=n.transposeA,o=i===void 0?!1:i,s=n.transposeB,u=s===void 0?!1:s,c=n.bias,l=n.activation,f=l===void 0?"linear":l,h=n.preluActivationWeights,d=n.leakyreluAlpha,p=d===void 0?.2:d;if(jw(Q.state.gradientDepth,f)===!1){var v=Bt(r,a,o,u);return c!=null&&(v=jn(v,c)),Kw(v,f,h,p)}var m=M(r,"a","fused matMul"),g=M(a,"b","fused matMul");e=Ne(Cn(m,g),2),m=e[0],g=e[1];var y=o?m.shape[m.rank-2]:m.shape[m.rank-1],b=u?g.shape[g.rank-1]:g.shape[g.rank-2],w=o?m.shape[m.rank-1]:m.shape[m.rank-2],x=u?g.shape[g.rank-2]:g.shape[g.rank-1],N=m.shape.slice(0,-2),T=g.shape.slice(0,-2),E=Fr(N),C=Fr(T);G(y===b,function(){return"Error in fused matMul: inner shapes (".concat(y,") and (")+"".concat(b,") of Tensors with shapes ").concat(m.shape," and ")+"".concat(g.shape," and transposeA=").concat(o)+" and transposeB=".concat(u," must match.")});var F=Xn(m.shape.slice(0,-2),g.shape.slice(0,-2)),_=F.concat([w,x]),O=o?ge(m,[E,y,w]):ge(m,[E,w,y]),L=u?ge(g,[C,x,b]):ge(g,[C,b,x]),z;c!=null&&(z=M(c,"bias","fused matMul"),t=Ne(Cn(z,m),1),z=t[0],Xn(_,z.shape));var $;h!=null&&($=M(h,"prelu weights","fused matMul"));var B=function(j,re){var ne=Ne(re,4),oe=ne[0],le=ne[1],pe=ne[2],xe=ne[3],he=Uw(ge(j,pe.shape),pe,f),ye,we;if(!o&&!u?(ye=Bt(he,le,!1,!0),we=Bt(oe,he,!0,!1)):!o&&u?(ye=Bt(he,le,!1,!1),we=Bt(he,oe,!0,!1)):o&&!u?(ye=Bt(le,he,!1,!0),we=Bt(oe,he,!1,!1)):(ye=Bt(le,he,!0,!0),we=Bt(he,oe,!0,!0)),c!=null){var Ae=Hw(xe,he);return[ye,we,Ae]}else return[ye,we]},W={a:O,b:L,bias:z,preluActivationWeights:$},X={transposeA:o,transposeB:u,activation:f,leakyreluAlpha:p};if(c==null){var Z=oo(function(j,re,ne){var oe=Q.runKernel(v4,W,X);return ne([j,re,oe]),{value:ge(oe,_),gradFunc:B}});return Z(O,L)}else{var V=oo(function(j,re,ne,oe){var le=Q.runKernel(v4,W,X);return oe([j,re,le,ne]),{value:ge(le,_),gradFunc:B}});return V(O,L,z)}}var MAe=K({fusedMatMul_:PAe});var BAe={__proto__:null,conv2d:CAe,depthwiseConv2d:OAe,matMul:MAe};function LAe(n){return Gw(n,.54,.46)}var zAe=K({hammingWindow_:LAe});function $Ae(n){return Gw(n,.5,.5)}var zB=K({hannWindow_:$Ae});function qAe(n,e,t,r,a){r===void 0&&(r=!1),a===void 0&&(a=0);for(var i=0,o=[];i+e<=n.size;)o.push(fn(n,i,e)),i+=t;if(r)for(;i<n.size;){var s=i+e-n.size,u=Qr([fn(n,i,e-s),Fv([s],a)]);o.push(u),i+=t}return o.length===0?Uf([],[0,e]):ge(Qr(o),[o.length,e])}var $B=K({frame_:qAe});function WAe(n,e,t,r,a){a===void 0&&(a=zB),r==null&&(r=LB(e));var i=$B(n,e,t),o=mt(i,a(e));return $w(o,r)}var VAe=K({stft_:WAe});function GAe(n,e,t,r,a,i){a===void 0&&(a="bilinear"),i===void 0&&(i=0);var o=M(n,"image","cropAndResize"),s=M(e,"boxes","cropAndResize","float32"),u=M(t,"boxInd","cropAndResize","int32"),c=s.shape[0];G(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),G(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] ")+"but had shape ".concat(s.shape,".")}),G(u.rank===1&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] ")+"but had shape ".concat(s.shape,".")}),G(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(r.length,".")}),G(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was ".concat(r)}),G(a==="bilinear"||a==="nearest",function(){return"method must be bilinear or nearest, but was ".concat(a)});var l={image:o,boxes:s,boxInd:u},f={method:a,extrapolationValue:i,cropSize:r},h=Q.runKernel(Kxe,l,f);return h}var UAe=K({cropAndResize_:GAe});function HAe(n){var e=M(n,"image","flipLeftRight","float32");G(e.rank===4,function(){return"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(e.rank,".")});var t={image:e},r=Q.runKernel(fke,t,{});return r}var KAe=K({flipLeftRight_:HAe});function jAe(n){var e=M(n,"image","grayscaleToRGB"),t=e.rank-1,r=e.shape[t];G(e.rank>=2,function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(e.rank,".")}),G(r===1,function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(r,".")});var a=new Array(e.rank);return a.fill(1,0,t),a[t]=3,Gf(e,a)}var XAe=K({grayscaleToRGB_:jAe});function YAe(n,e,t,r){t===void 0&&(t=0),r===void 0&&(r=.5);var a=M(n,"image","rotateWithOffset","float32");G(a.rank===4,function(){return"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,".")});var i={image:a},o={radians:e,fillValue:t,center:r},s=Q.runKernel(Q2e,i,o);return s}var ZAe=K({rotateWithOffset_:YAe});function Dc(n,e,t,r,a,i){r==null&&(r=.5),a==null&&(a=Number.NEGATIVE_INFINITY),i==null&&(i=0);var o=n.shape[0];return t=Math.min(t,o),G(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")}),G(n.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '".concat(n.rank,"'")}),G(n.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(n.shape[1])}),G(e.rank===1,function(){return"scores must be a 1D tensor"}),G(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(e.shape[0])}),G(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")}),{maxOutputSize:t,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}function JAe(n,e,t,r,a){r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var i=M(n,"boxes","nonMaxSuppression","float32"),o=M(e,"scores","nonMaxSuppression","float32"),s=Dc(i,o,t,r,a);t=s.maxOutputSize,r=s.iouThreshold,a=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:r,scoreThreshold:a};return Q.runKernel(jke,{boxes:i,scores:o},u)}var QAe=K({nonMaxSuppression_:JAe});function eDe(n,e,t){var r=tDe(n,e,t),a=r<0?-(r+1):r;n.splice(a,0,e)}function tDe(n,e,t){return rDe(n,e,t||nDe)}function nDe(n,e){return n>e?1:n<e?-1:0}function rDe(n,e,t){for(var r=0,a=n.length,i=0,o=!1;r<a;){i=r+(a-r>>>1);var s=t(e,n[i]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}function aDe(n,e,t,r,a){return Xw(n,e,t,r,a,0)}function iDe(n,e,t,r,a,i){return Xw(n,e,t,r,a,0,!1,i,!0)}function oDe(n,e,t,r,a,i){return Xw(n,e,t,r,a,i,!0)}function Xw(n,e,t,r,a,i,o,s,u){o===void 0&&(o=!1),s===void 0&&(s=!1),u===void 0&&(u=!1);for(var c=[],l=0;l<e.length;l++)e[l]>a&&c.push({score:e[l],boxIndex:l,suppressBeginIndex:0});c.sort(_4);for(var f=i>0?-.5/i:0,h=[],d=[];h.length<t&&c.length>0;){var p=c.pop(),v=p.score,m=p.boxIndex,g=p.suppressBeginIndex;if(v<a)break;for(var y=!1,b=h.length-1;b>=g;--b){var w=sDe(n,m,h[b]);if(w>=r){y=!0;break}if(p.score=p.score*uDe(r,f,w),p.score<=a)break}p.suppressBeginIndex=h.length,y||(p.score===v?(h.push(m),d.push(p.score)):p.score>a&&eDe(c,p,_4))}var x=h.length,N=t-x;s&&N>0&&(h.push.apply(h,yn([],Ne(new Array(N).fill(0)),!1)),d.push.apply(d,yn([],Ne(new Array(N).fill(0)),!1)));var T={selectedIndices:h};return o&&(T.selectedScores=d),u&&(T.validOutputs=x),T}function sDe(n,e,t){var r=n.subarray(e*4,e*4+4),a=n.subarray(t*4,t*4+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),f=Math.max(a[0],a[2]),h=Math.max(a[1],a[3]),d=(s-i)*(u-o),p=(f-c)*(h-l);if(d<=0||p<=0)return 0;var v=Math.max(i,c),m=Math.max(o,l),g=Math.min(s,f),y=Math.min(u,h),b=Math.max(g-v,0)*Math.max(y-m,0);return b/(d+p-b)}function uDe(n,e,t){var r=Math.exp(e*t*t);return t<=n?r:0}function _4(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}function cDe(n,e,t,r,a){return r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),Pt(this,void 0,void 0,function(){var i,o,s,u,c,l,f;return Dt(this,function(h){switch(h.label){case 0:return i=M(n,"boxes","nonMaxSuppressionAsync"),o=M(e,"scores","nonMaxSuppressionAsync"),s=Dc(i,o,t,r,a),t=s.maxOutputSize,r=s.iouThreshold,a=s.scoreThreshold,[4,Promise.all([i.data(),o.data()])];case 1:return u=h.sent(),c=u[0],l=u[1],f=aDe(c,l,t,r,a).selectedIndices,i!==n&&i.dispose(),o!==e&&o.dispose(),[2,gi(f,"int32")]}})})}var lDe=cDe;function fDe(n,e,t,r,a,i){r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var o=M(n,"boxes","nonMaxSuppression"),s=M(e,"scores","nonMaxSuppression"),u=Dc(o,s,t,r,a,i);t=u.maxOutputSize,r=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma;var c={boxes:o,scores:s},l={maxOutputSize:t,iouThreshold:r,scoreThreshold:a,softNmsSigma:i},f=Q.runKernel(Yke,c,l);return{selectedIndices:f[0],selectedScores:f[1]}}var hDe=K({nonMaxSuppressionWithScore_:fDe});function dDe(n,e,t,r,a,i){return r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),Pt(this,void 0,void 0,function(){var o,s,u,c,l,f,h,d,p;return Dt(this,function(v){switch(v.label){case 0:return o=M(n,"boxes","nonMaxSuppressionAsync"),s=M(e,"scores","nonMaxSuppressionAsync"),u=Dc(o,s,t,r,a,i),t=u.maxOutputSize,r=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return c=v.sent(),l=c[0],f=c[1],h=oDe(l,f,t,r,a,i),d=h.selectedIndices,p=h.selectedScores,o!==n&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:gi(d,"int32"),selectedScores:gi(p)}]}})})}var pDe=dDe;function vDe(n,e,t,r,a,i){r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1);var o=M(n,"boxes","nonMaxSuppression"),s=M(e,"scores","nonMaxSuppression"),u=Dc(o,s,t,r,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,h={boxes:o,scores:s},d={maxOutputSize:c,iouThreshold:l,scoreThreshold:f,padToMaxOutputSize:i},p=Q.runKernel(Xke,h,d);return{selectedIndices:p[0],validOutputs:p[1]}}var mDe=K({nonMaxSuppressionPadded_:vDe});function gDe(n,e,t,r,a,i){return r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1),Pt(this,void 0,void 0,function(){var o,s,u,c,l,f,h,d,p,v,m,g;return Dt(this,function(y){switch(y.label){case 0:return o=M(n,"boxes","nonMaxSuppressionAsync"),s=M(e,"scores","nonMaxSuppressionAsync"),u=Dc(o,s,t,r,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,[4,Promise.all([o.data(),s.data()])];case 1:return h=Ne.apply(void 0,[y.sent(),2]),d=h[0],p=h[1],v=iDe(d,p,c,l,f,i),m=v.selectedIndices,g=v.validOutputs,o!==n&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:gi(m,"int32"),validOutputs:bn(g,"int32")}]}})})}var yDe=gDe;function bDe(n,e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!1);var a=M(n,"images","resizeBilinear");G(a.rank===3||a.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),G(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(e,".")}),G(r===!1||t===!1,function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=ge(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Ne(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:r,size:e},c=Q.runKernel(d2e,s,u);return o?ge(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var wDe=K({resizeBilinear_:bDe});function xDe(n,e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!1);var a=M(n,"images","resizeNearestNeighbor");G(a.rank===3||a.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),G(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(e,".")}),G(a.dtype==="float32"||a.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"}),G(r===!1||t===!1,function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=ge(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Ne(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:r,size:e},c=Q.runKernel(h2e,s,u);return o?ge(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var kDe=K({resizeNearestNeighbor_:xDe});function SDe(n,e,t,r){var a;e===void 0&&(e="binary"),t===void 0&&(t=!1),r===void 0&&(r=.5);var i=M(n,"image","threshold"),o=.2989,s=.587,u=.114,c=i.shape[0]*i.shape[1],l=mt(gi([r]),255),f,h,d,p;if(G(i.rank===3,function(){return"Error in threshold: image must be rank 3,"+"but got rank ".concat(i.rank,".")}),G(i.shape[2]===3||i.shape[2]===1,function(){return"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(i.shape[2],".")}),G(i.dtype==="int32"||i.dtype==="float32",function(){return"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(i.dtype,".")}),G(e==="otsu"||e==="binary",function(){return"Method must be binary or otsu, but was ".concat(e)}),i.shape[2]===3){a=Ne(Jf(i,[1,1,1],-1),3),f=a[0],h=a[1],d=a[2];var v=mt(f,o),m=mt(h,s),g=mt(d,u);p=jn(jn(v,m),g)}else p=n;if(e==="otsu"){var y=cB(rr(RB(p),"int32"),Ww([]),256);l=NDe(y,c)}var b=t?Pw(p,l):Bv(p,l),w=rr(mt(b,255),"int32");return w}function NDe(n,e){for(var t=gi([-1]),r=gi([0]),a=gi([0]),i,o,s,u,c,l,f=0;f<n.size-1;f++){i=fn(n,0,f+1),o=fn(n,f+1),c=yr(en(i),e),l=yr(en(o),e);var h=en(mt(i,Yf(0,i.size)));s=yr(h,en(i));var d=Fv(o.shape,i.size),p=jn(Yf(0,o.size),d),v=mt(o,p);u=yr(en(v),en(o));var m=Ct(s,u),g=Ct(s,u),y=mt(c,l);a=mt(mt(y,m),g);var b=Bv(a,r);r=Ec(b,a,r),t=Ec(b,gi([f]),t)}return t}var TDe=K({threshold_:SDe});function EDe(n,e,t,r,a,i){t===void 0&&(t="nearest"),r===void 0&&(r="constant"),a===void 0&&(a=0);var o=M(n,"image","transform","float32"),s=M(e,"transforms","transform","float32");G(o.rank===4,function(){return"Error in transform: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),G(s.rank===2&&(s.shape[0]===o.shape[0]||s.shape[0]===1)&&s.shape[1]===8,function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"}),G(i==null||i.length===2,function(){return"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(i,".")});var u={image:o,transforms:s},c={interpolation:t,fillMode:r,fillValue:a,outputShape:i};return Q.runKernel(K2e,u,c)}var IDe=K({transform_:EDe});function CDe(n,e,t){G(e%1===0,function(){return"bandPart(): numLower must be an integer, got ".concat(e,".")}),G(t%1===0,function(){return"bandPart(): numUpper must be an integer, got ".concat(t,".")});var r=M(n,"a","bandPart");G(r.rank>=2,function(){return"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")});var a=r.shape,i=Ne(r.shape.slice(-2),2),o=i[0],s=i[1];if(!(e<=o))throw new Error("bandPart(): numLower (".concat(e,")")+" must not be greater than the number of rows (".concat(o,")."));if(!(t<=s))throw new Error("bandPart(): numUpper (".concat(t,")")+" must not be greater than the number of columns (".concat(s,")."));e<0&&(e=o),t<0&&(t=s);var u=ge(Yf(0,o,1,"int32"),[-1,1]),c=Yf(0,s,1,"int32"),l=Ct(u,c),f=Iv(Pw(l,bn(+e,"int32")),yB(l,bn(-t,"int32"))),h=Ic([o,s],r.dtype);return ge(Qf(Vw(ge(r,[-1,o,s])).map(function(d){return Ec(f,d,h)})),a)}var ADe=K({bandPart_:CDe});function DDe(n){var e;if(Array.isArray(n)){e=!1,G(n!=null&&n.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=n[0].shape[0],r=function(u){G(n[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(n[u].shape[0]," vs. ").concat(t,")")})},a=1;a<n.length;++a)r(a)}else e=!0,n=Jf(n,n.shape[0],0).map(function(u){return qw(u,[0])});G(n.length<=n[0].shape[0],function(){return"Gram-Schmidt: Number of vectors (".concat(n.length,") exceeds ")+"number of dimensions (".concat(n[0].shape[0],").")});for(var i=[],o=n,s=function(u){i.push(Q.tidy(function(){var c=o[u];if(u>0)for(var l=0;l<u;++l){var f=mt(en(mt(i[l],c)),i[l]);c=Ct(c,f)}return yr(c,Mv(c,"euclidean"))}))},a=0;a<n.length;++a)s(a);return e?Qf(i,0):i}var _De=K({gramSchmidt_:DDe});function FDe(n,e){if(e===void 0&&(e=!1),G(n.rank>=2,function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(n.rank)}),n.rank===2)return F4(n,e);var t=n.shape.slice(0,n.shape.length-2).reduce(function(u,c){return u*c}),r=Vw(ge(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),a=[],i=[];r.forEach(function(u){var c=Ne(F4(u,e),2),l=c[0],f=c[1];a.push(l),i.push(f)});var o=ge(Qf(a,0),n.shape),s=ge(Qf(i,0),n.shape);return[o,s]}function F4(n,e){return e===void 0&&(e=!1),Q.tidy(function(){G(n.shape.length===2,function(){return"qr2d() requires a 2D Tensor, but got a ".concat(n.shape.length,"D Tensor.")});for(var t=n.shape[0],r=n.shape[1],a=vB(t),i=wc(n),o=Uf([[1]],[1,1]),s=wc(o),u=t>=r?r:t,c=function(f){var h,d=i,p=s,v=a;h=Ne(Q.tidy(function(){var m=fn(i,[f,f],[t-f,1]),g=Mv(m),y=fn(i,[f,f],[1,1]),b=Ec(Bv(y,0),Uf([[-1]]),Uf([[1]])),w=Ct(y,mt(b,g)),x=yr(m,w);x.shape[0]===1?s=wc(o):s=Qr([o,fn(x,[1,0],[x.shape[0]-1,x.shape[1]])],0);var N=io(yr(Bt(b,w),g)),T=fn(i,[f,0],[t-f,r]),E=mt(N,s),C=yw(s);if(f===0)i=Ct(T,Bt(E,Bt(C,T)));else{var F=Ct(T,Bt(E,Bt(C,T)));i=Qr([fn(i,[0,0],[f,r]),F],0)}var _=yw(E),O=fn(a,[0,f],[t,a.shape[1]-f]);if(f===0)a=Ct(O,Bt(Bt(O,s),_));else{var L=Ct(O,Bt(Bt(O,s),_));a=Qr([fn(a,[0,0],[t,f]),L],1)}return[s,i,a]}),3),s=h[0],i=h[1],a=h[2],sAe([d,p,v])},l=0;l<u;++l)c(l);return!e&&t>r&&(a=fn(a,[0,0],[t,r]),i=fn(i,[0,0],[r,r])),[a,i]})}var RDe=K({qr_:FDe});var _r;(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(_r||(_r={}));function ODe(n,e,t){t===void 0&&(t=_r.SUM_BY_NONZERO_WEIGHTS);var r=M(n,"losses","computeWeightedLoss"),a=null;e!=null&&(a=M(e,"weights","computeWeightedLoss"));var i=a==null?r:mt(r,a);if(t===_r.NONE)return i;if(t===_r.SUM)return en(i);if(t===_r.MEAN){if(a==null)return Cv(i);var o=r.size/a.size,s=yr(en(i),en(a));return o>1?yr(s,bn(o)):s}if(t===_r.SUM_BY_NONZERO_WEIGHTS){if(a==null)return yr(en(i),bn(r.size));var u=mt(a,Xs(r.shape)),c=rr(en(IB(u,bn(0))),"float32");return yr(en(i),c)}throw Error("Unknown reduction: ".concat(t))}var so=K({computeWeightedLoss_:ODe});function PDe(n,e,t,r){r===void 0&&(r=_r.SUM_BY_NONZERO_WEIGHTS);var a=M(n,"labels","absoluteDifference"),i=M(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=M(t,"weights","absoluteDifference")),Ua(a.shape,i.shape,"Error in absoluteDifference: ");var s=$a(Ct(a,i));return so(s,o,r)}var MDe=K({absoluteDifference_:PDe});function BDe(n,e,t,r,a){a===void 0&&(a=_r.SUM_BY_NONZERO_WEIGHTS);var i=M(n,"labels","cosineDistance"),o=M(e,"predictions","cosineDistance"),s=null;r!=null&&(s=M(r,"weights","cosineDistance")),Ua(i.shape,o.shape,"Error in cosineDistance: ");var u=bn(1),c=Ct(u,en(mt(i,o),t,!0));return so(c,s,a)}var LDe=K({cosineDistance_:BDe});function zDe(n,e,t,r){r===void 0&&(r=_r.SUM_BY_NONZERO_WEIGHTS);var a=M(n,"labels","hingeLoss"),i=M(e,"predictions","hingeLoss"),o=null;t!=null&&(o=M(t,"weights","hingeLoss")),Ua(a.shape,i.shape,"Error in hingeLoss: ");var s=bn(1);a=Ct(mt(bn(2),a),s);var u=zv(Ct(s,mt(a,i)));return so(u,o,r)}var $De=K({hingeLoss_:zDe});function qDe(n,e,t,r,a){r===void 0&&(r=1),a===void 0&&(a=_r.SUM_BY_NONZERO_WEIGHTS);var i=M(n,"labels","huberLoss"),o=M(e,"predictions","huberLoss"),s=null;t!=null&&(s=M(t,"weights","huberLoss")),Ua(i.shape,o.shape,"Error in huberLoss: ");var u=bn(r),c=$a(Ct(o,i)),l=EB(c,u),f=Ct(c,l),h=jn(mt(bn(.5),Pv(l)),mt(u,f));return so(h,s,a)}var WDe=K({huberLoss_:qDe});function VDe(n,e,t,r,a){r===void 0&&(r=1e-7),a===void 0&&(a=_r.SUM_BY_NONZERO_WEIGHTS);var i=M(n,"labels","logLoss"),o=M(e,"predictions","logLoss"),s=null;t!=null&&(s=M(t,"weights","logLoss")),Ua(i.shape,o.shape,"Error in logLoss: ");var u=bn(1),c=bn(r),l=io(mt(i,Xf(jn(o,c)))),f=mt(Ct(u,i),Xf(jn(Ct(u,o),c))),h=Ct(l,f);return so(h,s,a)}var GDe=K({logLoss_:VDe});function UDe(n,e,t,r){r===void 0&&(r=_r.SUM_BY_NONZERO_WEIGHTS);var a=M(n,"labels","meanSquaredError"),i=M(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=M(t,"weights","meanSquaredError")),Ua(a.shape,i.shape,"Error in meanSquaredError: ");var s=PB(a,i);return so(s,o,r)}var HDe=K({meanSquaredError_:UDe});function KDe(n,e){var t=M(n,"labels","sigmoidCrossEntropyWithLogits"),r=M(e,"logits","sigmoidCrossEntropyWithLogits");Ua(t.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=zv(r),i=mt(r,t),o=wB(Zs(io($a(r))));return jn(Ct(a,i),o)}function jDe(n,e,t,r,a){r===void 0&&(r=0),a===void 0&&(a=_r.SUM_BY_NONZERO_WEIGHTS);var i=M(n,"multiClassLabels","sigmoidCrossEntropy"),o=M(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=M(t,"weights","sigmoidCrossEntropy")),Ua(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=bn(r),c=bn(1),l=bn(.5);i=jn(mt(i,Ct(c,u)),mt(l,u))}var f=KDe(i,o);return so(f,s,a)}var XDe=K({sigmoidCrossEntropy_:jDe});function YDe(n,e,t){if(t===void 0&&(t=-1),t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(e.rank," ")+"and dim was ".concat(t));var r=oo(function(a,i,o){var s=!0,u=kB(i,[t],s),c=Ct(rr(i,"float32"),u);o([a,c]);var l=io(mt(c,a)),f=en(l,[t]),h=function(d,p){var v=Ne(p,2),m=v[0],g=v[1],y=Ov(d.shape,[t]);return[mt(ge(d,y),Ct(rr(m,"float32"),Zs(g))),mt(ge(d,y),Ct(Zs(g),rr(m,"float32")))]};return{value:f,gradFunc:h}});return r(n,e)}function ZDe(n,e,t,r,a){r===void 0&&(r=0),a===void 0&&(a=_r.SUM_BY_NONZERO_WEIGHTS);var i=M(n,"onehotLabels","softmaxCrossEntropy"),o=M(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=M(t,"weights","softmaxCrossEntropy")),Ua(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=bn(r),c=bn(1),l=bn(i.shape[1]);i=jn(mt(i,Ct(c,u)),yr(u,l))}var f=YDe(i,o);return so(f,s,a)}var JDe=K({softmaxCrossEntropy_:ZDe});function QDe(n,e,t,r){var a=M(n,"indices","sparseFillEmptyRows","int32"),i=M(e,"values","sparseFillEmptyRows"),o=M(t,"denseShape","sparseFillEmptyRows","int32"),s=M(r,"defaultValue","sparseFillEmptyRows",i.dtype);if(a.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        `.concat(a.shape));if(i.rank!==1)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(o.rank!==1)throw new Error("Dense shape should be Tensor1D but received shape ".concat(o.shape));if(s.rank!==0)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));var u={indices:a,values:i,denseShape:o,defaultValue:s},c=Q.runKernel(R2e,u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}var e_e=K({sparseFillEmptyRows_:QDe});function t_e(n,e,t){var r=M(n,"inputIndices","sparseReshape","int32"),a=M(e,"inputShape","sparseReshape","int32"),i=M(t,"newShape","sparseReshape","int32");if(r.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        `.concat(r.shape));if(a.rank!==1)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(i.rank!==1)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));var o={inputIndices:r,inputShape:a,newShape:i},s=Q.runKernel(O2e,o);return{outputIndices:s[0],outputShape:s[1]}}var n_e=K({sparseReshape_:t_e});function r_e(n,e,t){var r=M(n,"data","sparseSegmentMean"),a=M(e,"indices","sparseSegmentMean","int32"),i=M(t,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          `.concat(i.shape));var o={data:r,indices:a,segmentIds:i};return Q.runKernel(P2e,o)}var a_e=K({sparseSegmentMean_:r_e});function i_e(n,e,t){var r=M(n,"data","sparseSegmentSum"),a=M(e,"indices","sparseSegmentSum","int32"),i=M(t,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         `.concat(i.shape));var o={data:r,indices:a,segmentIds:i};return Q.runKernel(M2e,o)}var o_e=K({sparseSegmentSum_:i_e});function s_e(n,e,t,r,a,i,o,s){var u=M(n,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error("Data must be a vector, saw: ".concat(u.shape));var c=M(e,"dataSplits","stringNGrams");if(c.dtype!=="int32")throw new Error("Data splits must be of datatype int32");var l={separator:t,nGramWidths:r,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},f={data:u,dataSplits:c},h=Q.runKernel($2e,f,l);return{nGrams:h[0],nGramsSplits:h[1]}}var u_e=K({stringNGrams_:s_e});function c_e(n,e,t){t===void 0&&(t=!0);var r=M(n,"input","stringSplit","string"),a=M(e,"delimiter","stringSplit","string");if(r.rank!==1)throw new Error("Input should be Tensor1D but received shape ".concat(r.shape));if(a.rank!==0)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));var i={skipEmpty:t},o={input:r,delimiter:a},s=Q.runKernel(q2e,o,i);return{indices:s[0],values:s[1],shape:s[2]}}var l_e=K({stringSplit_:c_e});function f_e(n,e){var t=M(n,"input","stringToHashBucketFast","string"),r={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");var a={input:t};return Q.runKernel(W2e,a,r)}var h_e=K({stringToHashBucketFast_:f_e});var d_e={fft:zw,ifft:Av,rfft:$w,irfft:OB},p_e={hammingWindow:zAe,hannWindow:zB,frame:$B,stft:VAe},v_e={flipLeftRight:KAe,grayscaleToRGB:XAe,resizeNearestNeighbor:kDe,resizeBilinear:wDe,rotateWithOffset:ZAe,cropAndResize:UAe,nonMaxSuppression:QAe,nonMaxSuppressionAsync:lDe,nonMaxSuppressionWithScore:hDe,nonMaxSuppressionWithScoreAsync:pDe,nonMaxSuppressionPadded:mDe,nonMaxSuppressionPaddedAsync:yDe,threshold:TDe,transform:IDe},m_e={bandPart:ADe,gramSchmidt:_De,qr:RDe},g_e={absoluteDifference:MDe,computeWeightedLoss:so,cosineDistance:LDe,hingeLoss:$De,huberLoss:WDe,logLoss:GDe,meanSquaredError:HDe,sigmoidCrossEntropy:XDe,softmaxCrossEntropy:JDe},y_e={sparseFillEmptyRows:e_e,sparseReshape:n_e,sparseSegmentMean:a_e,sparseSegmentSum:o_e},b_e={stringNGrams:u_e,stringSplit:l_e,stringToHashBucketFast:h_e};var ar={__proto__:null,abs:$a,acos:TSe,acosh:ISe,add:jn,addN:DSe,all:FSe,any:OSe,argMax:MSe,argMin:LSe,asin:$Se,asinh:WSe,atan:GSe,atan2:HSe,atanh:jSe,avgPool:sB,avgPool3d:rNe,basicLSTMCell:hNe,batchToSpaceND:uB,batchNorm:_v,batchNorm2d:gNe,batchNorm3d:bNe,batchNorm4d:xNe,bincount:cB,broadcastArgs:NNe,broadcastTo:wv,buffer:Uo,cast:rr,ceil:INe,clipByValue:ANe,clone:wc,complex:Ys,concat:Qr,concat1d:FNe,concat2d:ONe,concat3d:MNe,concat4d:LNe,conv1d:qNe,conv2d:Rv,conv2dTranspose:GNe,conv3d:HNe,conv3dTranspose:YNe,cos:JNe,cosh:eTe,cumprod:nTe,cumsum:aTe,denseBincount:oTe,depthToSpace:uTe,depthwiseConv2d:Fw,diag:fTe,dilation2d:dTe,div:yr,divNoNan:xTe,dot:STe,einsum:TTe,elu:dB,equal:hB,erf:CTe,euclideanNorm:LTe,exp:Zs,expandDims:Ks,expm1:WTe,eye:vB,fill:Fv,floor:mB,floorDiv:fB,gather:gB,greater:Bv,greaterEqual:yB,imag:Lv,isFinite:ZTe,isInf:QTe,isNaN:tEe,leakyRelu:bB,less:aEe,lessEqual:Pw,linspace:oEe,localResponseNormalization:uEe,log:Xf,log1p:wB,logSigmoid:pEe,logSoftmax:gEe,logSumExp:kB,logicalAnd:Iv,logicalNot:SB,logicalOr:NB,logicalXor:SEe,lowerBound:TEe,matMul:Bt,max:kc,maxPool:TB,maxPool3d:CEe,maxPoolWithArgmax:DEe,maximum:FEe,mean:Cv,meshgrid:OEe,min:mw,minimum:EB,mirrorPad:BEe,mod:zEe,moments:qEe,mul:mt,multiRNNCell:VEe,multinomial:UEe,neg:io,notEqual:IB,oneHot:jEe,ones:Xs,onesLike:YEe,outerProduct:JEe,pad:eh,pad1d:tIe,pad2d:rIe,pad3d:iIe,pad4d:sIe,pool:hIe,pow:Ow,prelu:AB,print:pIe,prod:mIe,raggedGather:yIe,raggedRange:wIe,raggedTensorToTensor:kIe,rand:NIe,randomGamma:LIe,randomNormal:DB,randomStandardNormal:qIe,randomUniform:_B,range:Yf,real:Zf,reciprocal:UIe,relu:zv,relu6:FB,reshape:ge,reverse:Js,reverse1d:YIe,reverse2d:JIe,reverse3d:eCe,reverse4d:nCe,round:RB,rsqrt:iCe,scalar:bn,selu:sCe,separableConv2d:cCe,setdiff1dAsync:fCe,sigmoid:xc,sign:dCe,sin:vCe,sinh:gCe,slice:fn,slice1d:bCe,slice2d:xCe,slice3d:SCe,slice4d:TCe,softmax:ICe,softplus:xB,spaceToBatchND:CB,fft:zw,ifft:Av,irfft:OB,rfft:$w,split:Jf,sqrt:gw,square:Pv,squaredDifference:PB,squeeze:qw,stack:Qf,step:MB,stridedSlice:LCe,sub:Ct,sum:en,tan:$Ce,tanh:vw,tensor:Ww,tensor1d:gi,tensor2d:Uf,tensor3d:qCe,tensor4d:WCe,tensor5d:VCe,tensor6d:GCe,tile:Gf,topk:HCe,truncatedNormal:jCe,unique:YCe,unsortedSegmentSum:JCe,unstack:Vw,upperBound:eAe,variable:tAe,where:Ec,whereAsync:BB,zeros:Ic,zerosLike:Rw,op:K,OP_SCOPE_SUFFIX:oB,booleanMaskAsync:iAe,transpose:yw,norm:Mv,movingAverage:lAe,scatterND:pAe,searchSorted:Mw,sparseToDense:gAe,gatherND:bAe,dropout:kAe,enclosingPowerOfTwo:LB,cosineWindow:Gw,inTopKAsync:NAe,image:v_e,linalg:m_e,losses:g_e,spectral:d_e,fused:BAe,signal:p_e,sparse:y_e,string:b_e};var w_e=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"BiasAdd":case"AddV2":case"Add":return[r.add(I("a",n,e,t),I("b",n,e,t))];case"AddN":return[r.addN(I("tensors",n,e,t))];case"FloorMod":case"Mod":return[r.mod(I("a",n,e,t),I("b",n,e,t))];case"Mul":return[r.mul(I("a",n,e,t),I("b",n,e,t))];case"RealDiv":case"Div":return[r.div(I("a",n,e,t),I("b",n,e,t))];case"DivNoNan":return[r.divNoNan(I("a",n,e,t),I("b",n,e,t))];case"FloorDiv":return[r.floorDiv(I("a",n,e,t),I("b",n,e,t))];case"Sub":return[r.sub(I("a",n,e,t),I("b",n,e,t))];case"Minimum":return[r.minimum(I("a",n,e,t),I("b",n,e,t))];case"Maximum":return[r.maximum(I("a",n,e,t),I("b",n,e,t))];case"Pow":return[r.pow(I("a",n,e,t),I("b",n,e,t))];case"SquaredDifference":return[r.squaredDifference(I("a",n,e,t),I("b",n,e,t))];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var x_e=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"Abs":case"ComplexAbs":return[r.abs(I("x",n,e,t))];case"Acos":return[r.acos(I("x",n,e,t))];case"Acosh":return[r.acosh(I("x",n,e,t))];case"Asin":return[r.asin(I("x",n,e,t))];case"Asinh":return[r.asinh(I("x",n,e,t))];case"Atan":return[r.atan(I("x",n,e,t))];case"Atan2":return[r.atan2(I("x",n,e,t),I("y",n,e,t))];case"Atanh":return[r.atanh(I("x",n,e,t))];case"Ceil":return[r.ceil(I("x",n,e,t))];case"Complex":return[r.complex(I("real",n,e,t),I("imag",n,e,t))];case"Cos":return[r.cos(I("x",n,e,t))];case"Cosh":return[r.cosh(I("x",n,e,t))];case"Elu":return[r.elu(I("x",n,e,t))];case"Erf":return[r.erf(I("x",n,e,t))];case"Exp":return[r.exp(I("x",n,e,t))];case"Expm1":return[r.expm1(I("x",n,e,t))];case"Floor":return[r.floor(I("x",n,e,t))];case"Log":return[r.log(I("x",n,e,t))];case"Log1p":return[r.log1p(I("x",n,e,t))];case"Imag":return[r.imag(I("x",n,e,t))];case"Neg":return[r.neg(I("x",n,e,t))];case"Reciprocal":return[r.reciprocal(I("x",n,e,t))];case"Real":return[r.real(I("x",n,e,t))];case"Relu":return[r.relu(I("x",n,e,t))];case"Round":return[r.round(I("x",n,e,t))];case"Selu":return[r.selu(I("x",n,e,t))];case"Sigmoid":return[r.sigmoid(I("x",n,e,t))];case"Sin":return[r.sin(I("x",n,e,t))];case"Sign":return[r.sign(I("x",n,e,t))];case"Sinh":return[r.sinh(I("x",n,e,t))];case"Softplus":return[r.softplus(I("x",n,e,t))];case"Sqrt":return[r.sqrt(I("x",n,e,t))];case"Square":return[r.square(I("x",n,e,t))];case"Tanh":return[r.tanh(I("x",n,e,t))];case"Tan":return[r.tan(I("x",n,e,t))];case"ClipByValue":return[r.clipByValue(I("x",n,e,t),I("clipValueMin",n,e,t),I("clipValueMax",n,e,t))];case"Relu6":return[r.relu6(I("x",n,e,t))];case"Rsqrt":return[r.rsqrt(gr(n.inputNames[0],e,t))];case"Prod":return[r.prod(I("x",n,e,t),I("axes",n,e,t))];case"LeakyRelu":return[r.leakyRelu(I("x",n,e,t),I("alpha",n,e,t))];case"Prelu":return[r.prelu(I("x",n,e,t),I("alpha",n,e,t))];case"IsNan":return[r.isNaN(gr(n.inputNames[0],e,t))];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};function qa(n,e,t){if(t===void 0&&(t=""),!(typeof n=="number"||typeof e=="number")){Be.util.assert(n.length===e.length,function(){return t+" Shapes ".concat(n," and ").concat(e," must match")});for(var r=0;r<n.length;r++){var a=n[r],i=e[r];Be.util.assert(a<0||i<0||a===i,function(){return t+" Shapes ".concat(n," and ").concat(e," must match")})}}}function R4(n){return!(typeof n=="number"||n.some(function(e){return e<0}))}function qf(n,e,t){var r=bw(n,t),a=!R4(r);if(a&&e.length===0)throw new Error("Tried to calculate elements of an empty list"+" with non-fully-defined elementShape: ".concat(r));if(a&&e.forEach(function(i){r=bw(i.shape,r)}),!R4(r))throw new Error("Non-fully-defined elementShape: ".concat(r));return r}function bw(n,e){if(typeof n=="number")return e;if(typeof e=="number")return n;if(n.length!==e.length)throw new Error("Incompatible ranks during merge: ".concat(n," vs. ").concat(e));for(var t=[],r=0;r<n.length;++r){var a=n[r],i=e[r];if(a>=0&&i>=0&&a!==i)throw new Error("Incompatible shape during merge: ".concat(n," vs. ").concat(e));t[r]=a>=0?a:i}return t}var k_e=function(){function n(e,t,r,a,i,o,s){this.name=e,this.dtype=t,this.maxSize=r,this.elementShape=a,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=Be.scalar(0),Be.keep(this.idTensor)}return Object.defineProperty(n.prototype,"id",{get:function(){return this.idTensor.id},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"closed",{get:function(){return this.closed_},enumerable:!1,configurable:!0}),n.prototype.clearAndClose=function(e){this.tensors.forEach(function(t){(e==null||!e.has(t.tensor.id))&&t.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()},n.prototype.size=function(){return this.tensors.length},n.prototype.read=function(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read ")+"(perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor},n.prototype.readMany=function(e){var t=this;return e.map(function(r){return t.read(r)})},n.prototype.write=function(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));var r=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,`,
          because the value dtype is `).concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=t.shape),qa(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),r.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(r.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));r.tensor=t,Be.keep(t),r.written=!0,this.tensors[e]=r},n.prototype.writeMany=function(e,t){var r=this;if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,")+"because the index size: ".concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach(function(a,i){return r.write(a,t[i])})},n.prototype.gather=function(e,t){if(!!t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(var r=0;r<this.size();r++)e.push(r)}if(e.length===0)return Be.tensor([],[0].concat(this.elementShape));var a=this.readMany(e);return qa(this.elementShape,a[0].shape,"TensorArray shape mismatch: "),Be.stack(a,0)},n.prototype.concat=function(e){if(!!e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(this.size()===0)return Be.tensor([],[0].concat(this.elementShape));for(var t=[],r=0;r<this.size();r++)t.push(r);var a=this.readMany(t);return qa(this.elementShape,a[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(a[0].shape,")")),Be.concat(a,0)},n.prototype.scatter=function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));var r=Math.max.apply(Math,yn([],Ne(e),!1));if(!this.dynamicSize&&r>=this.maxSize)throw new Error("Max index must be < array size (".concat(r,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,Be.unstack(t,0))},n.prototype.split=function(e,t){var r=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));var a=0,i=e.map(function(l){return a+=l,a});if(a!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        `.concat(a,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), ")+"and the TensorArray is not marked as dynamically resizeable");var o=a===0?0:t.size/a,s=[];Be.tidy(function(){t=Be.reshape(t,[1,a,o]);for(var l=0;l<e.length;++l){var f=l===0?0:i[l-1],h=[0,f,0],d=[1,e[l],o];s[l]=Be.reshape(Be.slice(t,h,d),r.elementShape)}return s});for(var u=[],c=0;c<e.length;c++)u[c]=c;this.writeMany(u,s)},n}(),$v=function(){function n(e,t,r,a){a===void 0&&(a=-1),this.tensors=e,this.elementShape=t,this.elementDtype=r,e?.forEach(function(i){if(r!==i.dtype)throw new Error("Invalid data types; op elements ".concat(r,", but list elements ").concat(i.dtype));qa(t,i.shape,"TensorList shape mismatch: "),Be.keep(i)}),this.idTensor=Be.scalar(0),this.maxNumElements=a,Be.keep(this.idTensor)}return Object.defineProperty(n.prototype,"id",{get:function(){return this.idTensor.id},enumerable:!1,configurable:!0}),n.prototype.copy=function(){return new n(yn([],Ne(this.tensors),!1),this.elementShape,this.elementDtype)},n.prototype.clearAndClose=function(e){this.tensors.forEach(function(t){(e==null||!e.has(t.id))&&t.dispose()}),this.tensors.length=0,this.idTensor.dispose()},n.prototype.size=function(){return this.tensors.length},n.prototype.stack=function(e,t,r){var a=this;if(r===void 0&&(r=-1),t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(r!==-1&&this.tensors.length!==r)throw new Error("Operation expected a list with ".concat(r," elements but got a list with ").concat(this.tensors.length," elements."));qa(e,this.elementShape,"TensorList shape mismatch: ");var i=qf(this.elementShape,this.tensors,e);return Be.tidy(function(){var o=a.tensors.map(function(s){return Be.reshape(s,i)});return Be.stack(o,0)})},n.prototype.popBack=function(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(this.size()===0)throw new Error("Trying to pop from an empty list.");var r=qf(this.elementShape,this.tensors,e),a=this.tensors.pop();return a.kept=!1,qa(a.shape,e,"TensorList shape mismatch: "),Be.reshape(a,r)},n.prototype.pushBack=function(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(this.elementDtype));if(qa(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Be.keep(e),this.tensors.push(e)},n.prototype.resize=function(e){if(e<0)throw new Error("TensorListResize expects size to be non-negative. Got: ".concat(e));if(this.maxNumElements!==-1&&e>this.maxNumElements)throw new Error("TensorListResize input size ".concat(e," is greater maxNumElement ").concat(this.maxNumElements,"."));var t=new n([],this.elementShape,this.elementDtype,this.maxNumElements);t.tensors.length=e;for(var r=0;r<Math.min(this.tensors.length,e);++r)t.tensors[r]=this.tensors[r];return t},n.prototype.getItem=function(e,t,r){if(r!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(r,", but list elements ").concat(this.elementDtype));if(e<0||e>this.tensors.length)throw new Error("Trying to access element ".concat(e," in a list with ").concat(this.tensors.length," elements."));if(this.tensors[e]==null)throw new Error("element at index ".concat(e," is null."));qa(this.tensors[e].shape,t,"TensorList shape mismatch: ");var a=qf(this.elementShape,this.tensors,t);return Be.reshape(this.tensors[e],a)},n.prototype.setItem=function(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t.dtype,", but list elements ").concat(this.elementDtype));if(e<0||this.maxNumElements!==-1&&e>=this.maxNumElements)throw new Error("Trying to set element ".concat(e," in a list with max ").concat(this.maxNumElements," elements."));qa(this.elementShape,t.shape,"TensorList shape mismatch: "),Be.keep(t),this.tensors[e]!=null&&(this.tensors[e].kept=!1),this.tensors[e]=t},n.prototype.gather=function(e,t,r){var a=this;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));qa(this.elementShape,r,"TensorList shape mismatch: "),e=e.slice(0,this.size());var i=qf(this.elementShape,this.tensors,r);return e.length===0?Be.tensor([],[0].concat(i)):Be.tidy(function(){var o=e.map(function(s){return Be.reshape(a.tensors[s],i)});return Be.stack(o,0)})},n.prototype.concat=function(e,t){var r=this;if(!!e&&e!==this.elementDtype)throw new Error("TensorList dtype is ".concat(this.elementDtype," but concat requested dtype ").concat(e));qa(this.elementShape,t,"TensorList shape mismatch: ");var a=qf(this.elementShape,this.tensors,t);return this.size()===0?Be.tensor([],[0].concat(a)):Be.tidy(function(){var i=r.tensors.map(function(o){return Be.reshape(o,a)});return Be.concat(i,0)})},n}();function S_e(n,e,t){var r=n.dtype;if(n.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: ".concat(n.shape));if(n.dtype!==t)throw new Error("Invalid data types; op elements ".concat(n.dtype,", but list elements ").concat(t));var a=n.shape.slice(1);qa(a,e,"TensorList shape mismatch: ");var i=Be.unstack(n);return new $v(i,e,r)}function N_e(n,e,t,r){return new $v([],n,e,r)}function T_e(n,e,t,r){if(e.length!==n.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(n.shape[0]));var a=Math.max.apply(Math,yn([],Ne(e),!1));if(r!=null&&r!==-1&&a>=r)throw new Error("Max index must be < array size (".concat(a,"  vs. ").concat(r,")"));var i=new $v([],t,n.dtype,r),o=Be.unstack(n,0);return e.forEach(function(s,u){i.setItem(s,o[u])}),i}function E_e(n,e,t){var r=0,a=e.map(function(f){return r+=f,r});if(r!==n.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        `.concat(r,", and tensor's shape is: ").concat(n.shape));for(var i=n.shape.slice(1),o=bw(i,t),s=r===0?0:n.size/r,u=Be.tidy(function(){var f=[];n=Be.reshape(n,[1,r,s]);for(var h=0;h<e.length;++h){var d=h===0?0:a[h-1],p=[0,d,0],v=[1,e[h],s];f[h]=Be.reshape(Be.slice(n,p,v),o)}return n.dispose(),f}),c=new $v([],t,n.dtype,e.length),l=0;l<u.length;l++)c.setItem(l,u[l]);return c}var I_e=function(n,e,t){return Pt(void 0,void 0,void 0,function(){var r,a,i,o,c,h,s,u,c,l,f,h,d,p,v,v,y,m,y,g,y,y,y,An,b,et,w,x,N,T,E,C,oe,st,F,_,le,O,we,Ae,L,z,$,pe,xe,B,rt,W,ft,X,tt,rn,Z,V,j,re,ne,kt,oe,st,He,kt,le,et,Ze,He,pe,xe,et,Ye,He,et,at,he,Ye,ye,He,we,Ae,et,at,He,kt,et,at,Ye,He,ht,et,at,He,rt,He,ft,et,kt,st,He,kt,et,Ze,He,tt,et,rn,He,kt,He,kt,An,hr,On;return Dt(this,function(Dn){switch(Dn.label){case 0:switch(r=n.op,r){case"If":return[3,1];case"StatelessIf":return[3,1];case"While":return[3,3];case"StatelessWhile":return[3,3];case"LoopCond":return[3,9];case"Switch":return[3,10];case"Merge":return[3,12];case"Enter":return[3,13];case"Exit":return[3,14];case"NextIteration":return[3,15];case"TensorArrayV3":return[3,16];case"TensorArrayWriteV3":return[3,17];case"TensorArrayReadV3":return[3,18];case"TensorArrayGatherV3":return[3,19];case"TensorArrayScatterV3":return[3,20];case"TensorArrayConcatV3":return[3,21];case"TensorArraySplitV3":return[3,22];case"TensorArraySizeV3":return[3,23];case"TensorArrayCloseV3":return[3,24];case"TensorListSetItem":return[3,25];case"TensorListGetItem":return[3,26];case"TensorListScatterV2":return[3,27];case"TensorListScatter":return[3,27];case"TensorListReserve":return[3,28];case"EmptyTensorList":return[3,28];case"TensorListGather":return[3,29];case"TensorListStack":return[3,30];case"TensorListFromTensor":return[3,31];case"TensorListConcat":return[3,32];case"TensorListConcatV2":return[3,32];case"TensorListPushBack":return[3,33];case"TensorListPopBack":return[3,34];case"TensorListSplit":return[3,35];case"TensorListLength":return[3,36];case"TensorListResize":return[3,37]}return[3,38];case 1:return a=I("thenBranch",n,e,t),i=I("elseBranch",n,e,t),o=I("cond",n,e,t),c=I("args",n,e,t),[4,o.data()];case 2:return h=Dn.sent(),h[0]?[2,t.functionMap[a].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap)]:[2,t.functionMap[i].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap)];case 3:return s=I("body",n,e,t),u=I("cond",n,e,t),c=I("args",n,e,t),[4,t.functionMap[u].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap)];case 4:return l=Dn.sent(),f=c.map(function(an){return an.id}),[4,l[0].data()];case 5:h=Dn.sent(),l.forEach(function(an){!an.kept&&f.indexOf(an.id)===-1&&an.dispose()}),d=c,p=function(){var an,Pr,dr;return Dt(this,function(Mr){switch(Mr.label){case 0:return an=d,[4,t.functionMap[s].executeFunctionAsync(d,t.tensorArrayMap,t.tensorListMap)];case 1:return d=Mr.sent(),Pr=d.map(function(Sn){return Sn.id}),an.forEach(function(Sn){!Sn.kept&&f.indexOf(Sn.id)===-1&&Pr.indexOf(Sn.id)===-1&&Sn.dispose()}),[4,t.functionMap[u].executeFunctionAsync(d,t.tensorArrayMap,t.tensorListMap)];case 2:return dr=Mr.sent(),[4,dr[0].data()];case 3:return h=Mr.sent(),dr.forEach(function(Sn){!Sn.kept&&f.indexOf(Sn.id)===-1&&Pr.indexOf(Sn.id)===-1&&Sn.dispose()}),[2]}})},Dn.label=6;case 6:return h[0]?[5,p()]:[3,8];case 7:return Dn.sent(),[3,6];case 8:return[2,d];case 9:return v=I("pred",n,e,t),[2,[ao(v)]];case 10:return v=I("pred",n,e,t),y=I("data",n,e,t),y.kept||(y=ao(y)),[4,v.data()];case 11:return[2,Dn.sent()[0]?[void 0,y]:[y,void 0]];case 12:return m=n.inputNames.find(function(an){return gr(an,e,t)!==void 0}),m?(y=gr(m,e,t),[2,[ao(y)]]):[2,void 0];case 13:return g=I("frameName",n,e,t),y=I("tensor",n,e,t),t.enterFrame(g),[2,[ao(y)]];case 14:return y=I("tensor",n,e,t),t.exitFrame(),[2,[ao(y)]];case 15:return y=I("tensor",n,e,t),t.nextIteration(),[2,[ao(y)]];case 16:return An=I("size",n,e,t),b=I("dtype",n,e,t),et=I("elementShape",n,e,t),w=I("dynamicSize",n,e,t),x=I("clearAfterRead",n,e,t),N=I("identicalElementShapes",n,e,t),T=I("name",n,e,t),E=new k_e(T,b,An,et,N,w,x),t.addTensorArray(E),[2,[E.idTensor,Be.scalar(1)]];case 17:return C=I("tensorArrayId",n,e,t),oe=I("index",n,e,t),st=I("tensor",n,e,t),F=t.getTensorArray(C.id),F.write(oe,st),[2,[F.idTensor]];case 18:return _=I("tensorArrayId",n,e,t),le=I("index",n,e,t),O=t.getTensorArray(_.id),[2,[O.read(le)]];case 19:return we=I("tensorArrayId",n,e,t),Ae=I("indices",n,e,t),L=I("dtype",n,e,t),z=t.getTensorArray(we.id),[2,[z.gather(Ae,L)]];case 20:return $=I("tensorArrayId",n,e,t),pe=I("indices",n,e,t),xe=I("tensor",n,e,t),B=t.getTensorArray($.id),B.scatter(pe,xe),[2,[B.idTensor]];case 21:return rt=I("tensorArrayId",n,e,t),W=t.getTensorArray(rt.id),ft=I("dtype",n,e,t),[2,[W.concat(ft)]];case 22:return X=I("tensorArrayId",n,e,t),tt=I("tensor",n,e,t),rn=I("lengths",n,e,t),Z=t.getTensorArray(X.id),Z.split(rn,tt),[2,[Z.idTensor]];case 23:return V=I("tensorArrayId",n,e,t),j=t.getTensorArray(V.id),[2,[Be.scalar(j.size(),"int32")]];case 24:return re=I("tensorArrayId",n,e,t),ne=t.getTensorArray(re.id),ne.clearAndClose(),[2,[ne.idTensor]];case 25:return kt=I("tensorListId",n,e,t),oe=I("index",n,e,t),st=I("tensor",n,e,t),He=t.getTensorList(kt.id),He.setItem(oe,st),[2,[He.idTensor]];case 26:return kt=I("tensorListId",n,e,t),le=I("index",n,e,t),et=I("elementShape",n,e,t),Ze=I("elementDType",n,e,t),He=t.getTensorList(kt.id),[2,[He.getItem(le,et,Ze)]];case 27:return pe=I("indices",n,e,t),xe=I("tensor",n,e,t),et=I("elementShape",n,e,t),Ye=I("numElements",n,e,t),He=T_e(xe,pe,et,Ye),t.addTensorList(He),[2,[He.idTensor]];case 28:return et=I("elementShape",n,e,t),at=I("elementDType",n,e,t),he=void 0,n.op==="TensorListReserve"?he="numElements":he="maxNumElements",Ye=I(he,n,e,t),ye=n.op==="TensorListReserve"?-1:Ye,He=N_e(et,at,Ye,ye),t.addTensorList(He),[2,[He.idTensor]];case 29:return we=I("tensorListId",n,e,t),Ae=I("indices",n,e,t),et=I("elementShape",n,e,t),at=I("elementDType",n,e,t),He=t.getTensorList(we.id),[2,[He.gather(Ae,at,et)]];case 30:return kt=I("tensorListId",n,e,t),et=I("elementShape",n,e,t),at=I("elementDType",n,e,t),Ye=I("numElements",n,e,t),He=t.getTensorList(kt.id),[2,[He.stack(et,at,Ye)]];case 31:return ht=I("tensor",n,e,t),et=I("elementShape",n,e,t),at=I("elementDType",n,e,t),He=S_e(ht,et,at),t.addTensorList(He),[2,[He.idTensor]];case 32:return rt=I("tensorListId",n,e,t),He=t.getTensorList(rt.id),ft=I("dtype",n,e,t),et=I("elementShape",n,e,t),[2,[He.concat(ft,et)]];case 33:return kt=I("tensorListId",n,e,t),st=I("tensor",n,e,t),He=t.getTensorList(kt.id),He.pushBack(st),[2,[He.idTensor]];case 34:return kt=I("tensorListId",n,e,t),et=I("elementShape",n,e,t),Ze=I("elementDType",n,e,t),He=t.getTensorList(kt.id),[2,[He.popBack(et,Ze)]];case 35:return tt=I("tensor",n,e,t),et=I("elementShape",n,e,t),rn=I("lengths",n,e,t),He=E_e(tt,rn,et),t.addTensorList(He),[2,[He.idTensor]];case 36:return kt=I("tensorListId",n,e,t),He=t.getTensorList(kt.id),[2,[Be.scalar(He.size(),"int32")]];case 37:return kt=I("tensorListId",n,e,t),An=I("size",n,e,t),hr=t.getTensorList(kt.id),On=hr.resize(An),t.addTensorList(On),[2,[On.idTensor]];case 38:throw TypeError("Node type ".concat(n.op," is not implemented"))}})})};function O4(n,e,t){var r=Ne(I("fusedOps",n,e,t),2),a=r[0],i=r[1],o=a==="biasadd",s=!o,u=i==="prelu",c=a==="fusedbatchnorm",l=I("numArgs",n,e,t);if(o){if(u&&l!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!u&&o&&l!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(c)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");var f=I("strides",n,e,t),h=gv(n,e,t),d=I("dataFormat",n,e,t).toUpperCase(),p=I("dilations",n,e,t),v=Ne(I("args",n,e,t),2),m=v[0],g=v[1];s&&(g=m,m=void 0);var y=I("leakyreluAlpha",n,e,t);return{stride:f,pad:h,dataFormat:d,dilations:p,biasArg:m,preluArg:g,activationFunc:i,leakyreluAlpha:y}}var C_e=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"Conv1D":{var a=I("stride",n,e,t),i=I("pad",n,e,t),o=I("dataFormat",n,e,t).toUpperCase(),s=I("dilation",n,e,t);return[r.conv1d(I("x",n,e,t),I("filter",n,e,t),a,i,o,s)]}case"Conv2D":{var a=I("strides",n,e,t),i=gv(n,e,t),o=I("dataFormat",n,e,t).toUpperCase(),u=I("dilations",n,e,t);return[r.conv2d(I("x",n,e,t),I("filter",n,e,t),[a[1],a[2]],i,o,[u[1],u[2]])]}case"_FusedConv2D":{var c=O4(n,e,t),a=c.stride,i=c.pad,o=c.dataFormat,u=c.dilations,l=c.biasArg,f=c.preluArg,h=c.activationFunc,d=c.leakyreluAlpha;return[r.fused.conv2d({x:I("x",n,e,t),filter:I("filter",n,e,t),strides:[a[1],a[2]],pad:i,dataFormat:o,dilations:[u[1],u[2]],bias:l,activation:h,preluActivationWeights:f,leakyreluAlpha:d})]}case"FusedDepthwiseConv2dNative":{var p=O4(n,e,t),a=p.stride,i=p.pad,o=p.dataFormat,u=p.dilations,l=p.biasArg,f=p.preluArg,h=p.activationFunc,d=p.leakyreluAlpha;return[r.fused.depthwiseConv2d({x:I("x",n,e,t),filter:I("filter",n,e,t),strides:[a[1],a[2]],pad:i,dataFormat:o,dilations:[u[1],u[2]],bias:l,activation:h,preluActivationWeights:f,leakyreluAlpha:d})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{var v=I("outputShape",n,e,t),a=I("strides",n,e,t),i=gv(n,e,t);return[r.conv2dTranspose(I("x",n,e,t),I("filter",n,e,t),v,[a[1],a[2]],i)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{var a=I("strides",n,e,t),i=gv(n,e,t),u=I("dilations",n,e,t),o=I("dataFormat",n,e,t).toUpperCase();return[r.depthwiseConv2d(I("input",n,e,t),I("filter",n,e,t),[a[1],a[2]],i,o,[u[1],u[2]])]}case"Conv3D":{var a=I("strides",n,e,t),i=I("pad",n,e,t),o=I("dataFormat",n,e,t).toUpperCase(),u=I("dilations",n,e,t);return[r.conv3d(I("x",n,e,t),I("filter",n,e,t),[a[1],a[2],a[3]],i,o,[u[1],u[2],u[3]])]}case"AvgPool":{var a=I("strides",n,e,t),i=I("pad",n,e,t),m=I("kernelSize",n,e,t);return[r.avgPool(I("x",n,e,t),[m[1],m[2]],[a[1],a[2]],i)]}case"MaxPool":{var a=I("strides",n,e,t),i=I("pad",n,e,t),m=I("kernelSize",n,e,t);return[r.maxPool(I("x",n,e,t),[m[1],m[2]],[a[1],a[2]],i)]}case"MaxPoolWithArgmax":{var a=I("strides",n,e,t),i=I("pad",n,e,t),m=I("kernelSize",n,e,t),g=I("includeBatchInIndex",n,e,t),y=r.maxPoolWithArgmax(I("x",n,e,t),[m[1],m[2]],[a[1],a[2]],i,g),b=y.result,w=y.indexes;return[b,w]}case"AvgPool3D":{var a=I("strides",n,e,t),i=I("pad",n,e,t),m=I("kernelSize",n,e,t);return[r.avgPool3d(I("x",n,e,t),[m[1],m[2],m[3]],[a[1],a[2],a[3]],i)]}case"MaxPool3D":{var a=I("strides",n,e,t),i=I("pad",n,e,t),m=I("kernelSize",n,e,t);return[r.maxPool3d(I("x",n,e,t),[m[1],m[2],m[3]],[a[1],a[2],a[3]],i)]}case"Dilation2D":{var x=I("strides",n,e,t),i=I("pad",n,e,t),u=I("dilations",n,e,t),N=x[1],T=x[2],E=u[1],C=u[2];return[r.dilation2d(I("x",n,e,t),I("filter",n,e,t),[N,T],i,[E,C],"NHWC")]}default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var A_e=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"Fill":{var a=I("shape",n,e,t),i=I("dtype",n,e,t),o=I("value",n,e,t);return[r.fill(a,o,i)]}case"LinSpace":{var s=I("start",n,e,t),u=I("stop",n,e,t),c=I("num",n,e,t);return[r.linspace(s,u,c)]}case"Multinomial":{var l=I("logits",n,e,t),f=I("numSamples",n,e,t),h=I("seed",n,e,t);return[r.multinomial(l,f,h)]}case"OneHot":{var d=I("indices",n,e,t),p=I("depth",n,e,t),v=I("onValue",n,e,t),m=I("offValue",n,e,t),i=I("dtype",n,e,t);return[r.oneHot(d,p,v,m,i)]}case"Ones":return[r.ones(I("shape",n,e,t),I("dtype",n,e,t))];case"OnesLike":return[r.onesLike(I("x",n,e,t))];case"RandomStandardNormal":return[r.randomStandardNormal(I("shape",n,e,t),I("dtype",n,e,t),I("seed",n,e,t))];case"RandomUniform":return[r.randomUniform(I("shape",n,e,t),I("minval",n,e,t),I("maxval",n,e,t),I("dtype",n,e,t))];case"Range":{var s=I("start",n,e,t),u=I("stop",n,e,t),g=I("step",n,e,t);return[r.range(s,u,g,I("dtype",n,e,t))]}case"TruncatedNormal":{var a=I("shape",n,e,t),y=I("mean",n,e,t),b=I("stdDev",n,e,t),h=I("seed",n,e,t);return[r.truncatedNormal(a,y,b,I("dtype",n,e,t),h)]}case"Zeros":return[r.zeros(I("shape",n,e,t),I("dtype",n,e,t))];case"ZerosLike":return[r.zerosLike(I("x",n,e,t))];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};function K1(n,e,t){var r=I("boxes",n,e,t),a=I("scores",n,e,t),i=I("maxOutputSize",n,e,t),o=I("iouThreshold",n,e,t),s=I("scoreThreshold",n,e,t),u=I("softNmsSigma",n,e,t);return{boxes:r,scores:a,maxOutputSize:i,iouThreshold:o,scoreThreshold:s,softNmsSigma:u}}var D_e=function(n,e,t,r,a){return a===void 0&&(a=ar),Pt(void 0,void 0,void 0,function(){var i,o,f,h,d,p,v,s,g,u,f,h,d,p,v,c,g,l,f,h,d,p,v,m,g;return Dt(this,function(y){switch(y.label){case 0:switch(i=n.op,i){case"NonMaxSuppressionV5":return[3,1];case"NonMaxSuppressionV4":return[3,3];case"NonMaxSuppressionV3":return[3,5];case"NonMaxSuppressionV2":return[3,5];case"Where":return[3,7];case"ListDiff":return[3,9]}return[3,10];case 1:return o=K1(n,e,t),f=o.boxes,h=o.scores,d=o.maxOutputSize,p=o.iouThreshold,v=o.scoreThreshold,s=o.softNmsSigma,[4,a.image.nonMaxSuppressionWithScoreAsync(f,h,d,p,v,s)];case 2:return g=y.sent(),[2,[g.selectedIndices,g.selectedScores]];case 3:return u=K1(n,e,t),f=u.boxes,h=u.scores,d=u.maxOutputSize,p=u.iouThreshold,v=u.scoreThreshold,c=I("padToMaxOutputSize",n,e,t),[4,a.image.nonMaxSuppressionPaddedAsync(f,h,d,p,v,c)];case 4:return g=y.sent(),[2,[g.selectedIndices,g.validOutputs]];case 5:return l=K1(n,e,t),f=l.boxes,h=l.scores,d=l.maxOutputSize,p=l.iouThreshold,v=l.scoreThreshold,[4,a.image.nonMaxSuppressionAsync(f,h,d,p,v)];case 6:return[2,[y.sent()]];case 7:return m=a.cast(I("condition",n,e,t),"bool"),[4,a.whereAsync(m)];case 8:return g=[y.sent()],m.dispose(),[2,g];case 9:return[2,a.setdiff1dAsync(I("x",n,e,t),I("y",n,e,t))];case 10:throw TypeError("Node type ".concat(n.op," is not implemented"))}})})};var __e=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"LowerBound":{var a=I("sortedSequence",n,e,t),i=I("values",n,e,t);return[r.lowerBound(a,i)]}case"TopKV2":{var o=I("x",n,e,t),s=I("k",n,e,t),u=I("sorted",n,e,t),c=r.topk(o,s,u);return[c.values,c.indices]}case"UpperBound":{var a=I("sortedSequence",n,e,t),i=I("values",n,e,t);return[r.upperBound(a,i)]}case"Unique":{var o=I("x",n,e,t),c=r.unique(o);return[c.values,c.indices]}case"UniqueV2":{var o=I("x",n,e,t),l=I("axis",n,e,t),c=r.unique(o,l);return[c.values,c.indices]}default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var F_e=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"Const":return e[n.name];case"PlaceholderWithDefault":var a=I("default",n,e,t);return[gr(n.name,e,t)||a];case"Placeholder":return[gr(n.name,e,t)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{var i=I("x",n,e,t);return[ao(i)]}case"IdentityN":return I("x",n,e,t).map(function(h){return ao(h)});case"Snapshot":var o=I("x",n,e,t);return[ao(o)];case"Shape":return[r.tensor1d(I("x",n,e,t).shape,"int32")];case"ShapeN":return I("x",n,e,t).map(function(h){return r.tensor1d(h.shape)});case"Size":return[r.scalar(I("x",n,e,t).size,"int32")];case"Rank":return[r.scalar(I("x",n,e,t).rank,"int32")];case"NoOp":return[r.scalar(1)];case"Print":var s=I("x",n,e,t),u=I("data",n,e,t),c=I("message",n,e,t),l=I("summarize",n,e,t);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(c);for(var f=0;f<u.length;f++)console.log(Array.prototype.slice.call(u[f].dataSync()).slice(0,l));return[s];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}},R_e=function(){function n(e,t){this.keyDType=e,this.valueDType=t,this.handle=Be.scalar(0),this.tensorMap=new Map,Be.keep(this.handle)}return Object.defineProperty(n.prototype,"id",{get:function(){return this.handle.id},enumerable:!1,configurable:!0}),n.prototype.clearAndClose=function(){this.tensorMap.forEach(function(e){return e.dispose()}),this.tensorMap.clear(),this.handle.dispose()},n.prototype.size=function(){return this.tensorMap.size},n.prototype.tensorSize=function(){return bn(this.size(),"int32")},n.prototype.import=function(e,t){return Pt(this,void 0,void 0,function(){var r,a=this;return Dt(this,function(i){switch(i.label){case 0:return this.checkKeyAndValueTensor(e,t),[4,e.data()];case 1:return r=i.sent(),this.tensorMap.forEach(function(o){return o.dispose()}),this.tensorMap.clear(),[2,Be.tidy(function(){var o=Be.unstack(t),s=r.length,u=o.length;Be.util.assert(s===u,function(){return"The number of elements doesn't match, keys has "+"".concat(s," elements, the values has ").concat(u," ")+"elements."});for(var c=0;c<s;c++){var l=r[c],f=o[c];Be.keep(f),a.tensorMap.set(l,f)}return a.handle})]}})})},n.prototype.find=function(e,t){return Pt(this,void 0,void 0,function(){var r,a=this;return Dt(this,function(i){switch(i.label){case 0:return this.checkKeyAndValueTensor(e,t),[4,e.data()];case 1:return r=i.sent(),[2,Be.tidy(function(){for(var o=[],s=0;s<r.length;s++){var u=r[s],c=a.findWithDefault(u,t);o.push(c)}return Be.stack(o)})]}})})},n.prototype.findWithDefault=function(e,t){var r=this.tensorMap.get(e);return r??t},n.prototype.checkKeyAndValueTensor=function(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype ".concat(this.keyDType,", but got ")+"".concat(e.dtype));if(t.dtype!==this.valueDType)throw new Error("Expect value dtype ".concat(this.valueDType,", but got ")+"".concat(t.dtype))},n}(),O_e=function(n,e,t,r){return Pt(void 0,void 0,void 0,function(){var a,i,o,s,h,f,c,u,h,f,c,l,h,f,h;return Dt(this,function(d){switch(d.label){case 0:switch(a=n.op,a){case"HashTable":return[3,1];case"HashTableV2":return[3,1];case"InitializeTable":return[3,2];case"InitializeTableV2":return[3,2];case"LookupTableImport":return[3,2];case"LookupTableImportV2":return[3,2];case"LookupTableFind":return[3,4];case"LookupTableFindV2":return[3,4];case"LookupTableSize":return[3,6];case"LookupTableSizeV2":return[3,6]}return[3,7];case 1:return i=r.getHashTableHandleByName(n.name),i!=null?[2,[i]]:(o=I("keyDType",n,e,t),s=I("valueDType",n,e,t),h=new R_e(o,s),r.addHashTable(n.name,h),[2,[h.handle]]);case 2:return f=I("tableHandle",n,e,t,r),c=I("keys",n,e,t),u=I("values",n,e,t),h=r.getHashTableById(f.id),[4,h.import(c,u)];case 3:return[2,[d.sent()]];case 4:return f=I("tableHandle",n,e,t,r),c=I("keys",n,e,t),l=I("defaultValue",n,e,t),h=r.getHashTableById(f.id),[4,h.find(c,l)];case 5:return[2,[d.sent()]];case 6:return f=I("tableHandle",n,e,t,r),h=r.getHashTableById(f.id),[2,[h.tensorSize()]];case 7:throw TypeError("Node type ".concat(n.op," is not implemented"))}})})};var P_e=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"ResizeBilinear":{var a=I("images",n,e,t),i=I("size",n,e,t),o=I("alignCorners",n,e,t),s=I("halfPixelCenters",n,e,t);return[r.image.resizeBilinear(a,[i[0],i[1]],o,s)]}case"ResizeNearestNeighbor":{var a=I("images",n,e,t),i=I("size",n,e,t),o=I("alignCorners",n,e,t),s=I("halfPixelCenters",n,e,t);return[r.image.resizeNearestNeighbor(a,[i[0],i[1]],o,s)]}case"CropAndResize":{var u=I("image",n,e,t),c=I("boxes",n,e,t),l=I("boxInd",n,e,t),f=I("cropSize",n,e,t),h=I("method",n,e,t),d=I("extrapolationValue",n,e,t);return[r.image.cropAndResize(u,c,l,f,h,d)]}case"ImageProjectiveTransformV3":{var a=I("images",n,e,t),p=I("transforms",n,e,t),v=I("outputShape",n,e,t),m=I("fillValue",n,e,t),g=I("interpolation",n,e,t),y=I("fillMode",n,e,t);return[r.image.transform(a,p,g.toLowerCase(),y.toLowerCase(),m,v)]}default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var M_e=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"Equal":return[r.equal(I("a",n,e,t),I("b",n,e,t))];case"NotEqual":return[r.notEqual(I("a",n,e,t),I("b",n,e,t))];case"Greater":return[r.greater(I("a",n,e,t),I("b",n,e,t))];case"GreaterEqual":return[r.greaterEqual(I("a",n,e,t),I("b",n,e,t))];case"Less":return[r.less(I("a",n,e,t),I("b",n,e,t))];case"LessEqual":return[r.lessEqual(I("a",n,e,t),I("b",n,e,t))];case"LogicalAnd":return[r.logicalAnd(I("a",n,e,t),I("b",n,e,t))];case"LogicalNot":return[r.logicalNot(I("a",n,e,t))];case"LogicalOr":return[r.logicalOr(I("a",n,e,t),I("b",n,e,t))];case"Select":case"SelectV2":return[r.where(I("condition",n,e,t),I("a",n,e,t),I("b",n,e,t))];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}},B_e=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[r.matMul(I("a",n,e,t),I("b",n,e,t),I("transposeA",n,e,t),I("transposeB",n,e,t))];case"Einsum":return[r.einsum.apply(r,yn([I("equation",n,e,t)],Ne(I("tensors",n,e,t)),!1))];case"Transpose":return[r.transpose(I("x",n,e,t),I("perm",n,e,t))];case"_FusedMatMul":var a=Ne(I("fusedOps",n,e,t),2),i=a[0],o=a[1],s=i==="biasadd",u=o==="prelu",c=I("numArgs",n,e,t),l=I("leakyreluAlpha",n,e,t);if(s){if(u&&c!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!u&&c!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var f=Ne(I("args",n,e,t),2),h=f[0],d=f[1];return[r.fused.matMul({a:I("a",n,e,t),b:I("b",n,e,t),transposeA:I("transposeA",n,e,t),transposeB:I("transposeB",n,e,t),bias:h,activation:o,preluActivationWeights:d,leakyreluAlpha:l})];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var L_e=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"EuclideanNorm":return[r.euclideanNorm(I("x",n,e,t),I("axis",n,e,t),I("keepDims",n,e,t))];case"FusedBatchNorm":case"FusedBatchNormV2":return[r.batchNorm(I("x",n,e,t),I("mean",n,e,t),I("variance",n,e,t),I("offset",n,e,t),I("scale",n,e,t),I("epsilon",n,e,t))];case"FusedBatchNormV3":return[r.batchNorm(I("x",n,e,t),I("mean",n,e,t),I("variance",n,e,t),I("offset",n,e,t),I("scale",n,e,t),I("epsilon",n,e,t))];case"LRN":return[r.localResponseNormalization(I("x",n,e,t),I("radius",n,e,t),I("bias",n,e,t),I("alpha",n,e,t),I("beta",n,e,t))];case"Softmax":return[r.softmax(I("x",n,e,t))];case"LogSoftmax":return[r.logSoftmax(I("x",n,e,t))];case"SparseToDense":return[r.sparseToDense(I("sparseIndices",n,e,t),I("outputShape",n,e,t),I("sparseValues",n,e,t),I("defaultValue",n,e,t))];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var z_e=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"RaggedGather":{var a=r.raggedGather(I("paramsNestedSplits",n,e,t),I("paramsDenseValues",n,e,t),I("indices",n,e,t),I("outputRaggedRank",n,e,t)),i=a.outputNestedSplits,o=a.outputDenseValues;return i.concat(o)}case"RaggedRange":{var s=r.raggedRange(I("starts",n,e,t),I("limits",n,e,t),I("splits",n,e,t)),u=s.rtNestedSplits,c=s.rtDenseValues;return[u,c]}case"RaggedTensorToTensor":return[r.raggedTensorToTensor(I("shape",n,e,t),I("values",n,e,t),I("defaultValue",n,e,t),I("rowPartitionTensors",n,e,t),I("rowPartitionTypes",n,e,t))];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var $_e=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"Max":{var a=I("axis",n,e,t),i=I("keepDims",n,e,t);return[r.max(I("x",n,e,t),a,i)]}case"Mean":{var a=I("axis",n,e,t),i=I("keepDims",n,e,t);return[r.mean(I("x",n,e,t),a,i)]}case"Min":{var a=I("axis",n,e,t),i=I("keepDims",n,e,t);return[r.min(I("x",n,e,t),a,i)]}case"Sum":{var a=I("axis",n,e,t),i=I("keepDims",n,e,t);return[r.sum(I("x",n,e,t),a,i)]}case"All":{var a=I("axis",n,e,t),i=I("keepDims",n,e,t);return[r.all(I("x",n,e,t),a,i)]}case"Any":{var a=I("axis",n,e,t),i=I("keepDims",n,e,t);return[r.any(I("x",n,e,t),a,i)]}case"ArgMax":{var a=I("axis",n,e,t);return[r.argMax(I("x",n,e,t),a)]}case"ArgMin":{var a=I("axis",n,e,t);return[r.argMin(I("x",n,e,t),a)]}case"Prod":{var a=I("axis",n,e,t),i=I("keepDims",n,e,t);return[r.prod(I("x",n,e,t),a,i)]}case"Cumprod":{var a=I("axis",n,e,t),o=I("exclusive",n,e,t),s=I("reverse",n,e,t);return[r.cumprod(I("x",n,e,t),a,o,s)]}case"Cumsum":{var a=I("axis",n,e,t),o=I("exclusive",n,e,t),s=I("reverse",n,e,t);return[r.cumsum(I("x",n,e,t),a,o,s)]}case"Bincount":var u=I("x",n,e,t),c=I("weights",n,e,t),l=I("size",n,e,t);return[r.bincount(u,c,l)];case"DenseBincount":{var f=I("x",n,e,t),h=I("weights",n,e,t),d=I("size",n,e,t),p=I("binaryOutput",n,e,t);return[r.denseBincount(f,h,d,p)]}default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var q_e=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"ConcatV2":case"Concat":{var a=I("n",n,e,t),i=I("axis",n,e,t),o=I("tensors",n,e,t);return o=o.slice(0,a),[r.concat(o,i)]}case"Gather":{var s=I("x",n,e,t),u=I("indices",n,e,t);return[r.gather(s,r.cast(u,"int32"),0)]}case"GatherV2":{var i=I("axis",n,e,t),c=I("batchDims",n,e,t),s=I("x",n,e,t),u=I("indices",n,e,t);return[r.gather(s,r.cast(u,"int32"),i,c)]}case"Reverse":{for(var l=I("dims",n,e,t),i=[],f=0;f<l.length;f++)l[f]&&i.push(f);var s=I("x",n,e,t);return[r.reverse(s,i)]}case"ReverseV2":{var i=I("axis",n,e,t),s=I("x",n,e,t);return[r.reverse(s,i)]}case"Slice":{var h=I("begin",n,e,t),d=I("size",n,e,t);return[r.slice(I("x",n,e,t),h,d)]}case"StridedSlice":{var h=I("begin",n,e,t),p=I("end",n,e,t),v=I("strides",n,e,t),m=I("beginMask",n,e,t),g=I("endMask",n,e,t),y=I("ellipsisMask",n,e,t),b=I("newAxisMask",n,e,t),w=I("shrinkAxisMask",n,e,t),x=I("x",n,e,t);return[r.stridedSlice(x,h,p,v,m,g,y,b,w)]}case"Pack":return Be.tidy(function(){var L=I("axis",n,e,t),z=I("tensors",n,e,t),$=z[0].shape,B=r.squeeze(z[0]).shape,W=z.map(function(X){var Z=Be.util.arraysEqual(X.shape,$);if(!Z&&!Be.util.arraysEqual(r.squeeze(X).shape,B))throw new Error("the input tensors shape does not match");return Z?X:r.reshape(X,$)});return[r.stack(W,L)]});case"Unpack":{var i=I("axis",n,e,t),x=I("tensor",n,e,t);return r.unstack(x,i)}case"Tile":{var N=I("reps",n,e,t);return[r.tile(I("x",n,e,t),N)]}case"Split":case"SplitV":{var i=I("axis",n,e,t),T=I("numOrSizeSplits",n,e,t),x=I("x",n,e,t);return r.split(x,T,i)}case"ScatterNd":{var u=I("indices",n,e,t),E=I("values",n,e,t),C=I("shape",n,e,t);return[r.scatterND(u,E,C)]}case"GatherNd":{var F=I("x",n,e,t),u=I("indices",n,e,t);return[r.gatherND(F,u)]}case"SparseToDense":{var u=I("sparseIndices",n,e,t),C=I("outputShape",n,e,t),_=I("sparseValues",n,e,t),O=I("defaultValue",n,e,t);return[r.sparseToDense(u,_,C,_.dtype===O.dtype?O:r.cast(O,_.dtype))]}default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var W_e=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"SparseFillEmptyRows":{var a=r.sparse.sparseFillEmptyRows(I("indices",n,e,t),I("values",n,e,t),I("denseShape",n,e,t),I("defaultValue",n,e,t)),i=a.outputIndices,o=a.outputValues,s=a.emptyRowIndicator,u=a.reverseIndexMap;return[i,o,s,u]}case"SparseReshape":{var c=r.sparse.sparseReshape(I("inputIndices",n,e,t),I("inputShape",n,e,t),I("newShape",n,e,t)),i=c.outputIndices,l=c.outputShape;return[i,l]}case"SparseSegmentMean":{var f=r.sparse.sparseSegmentMean(I("data",n,e,t),I("indices",n,e,t),I("segmentIds",n,e,t));return[f]}case"SparseSegmentSum":{var f=r.sparse.sparseSegmentSum(I("data",n,e,t),I("indices",n,e,t),I("segmentIds",n,e,t));return[f]}default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var V_e=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"FFT":return[r.fft(I("x",n,e,t))];case"IFFT":return[r.ifft(I("x",n,e,t))];case"RFFT":return[r.rfft(I("x",n,e,t))];case"IRFFT":return[r.irfft(I("x",n,e,t))];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var G_e=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"StringNGrams":{var a=r.string.stringNGrams(I("data",n,e,t),I("dataSplits",n,e,t),I("separator",n,e,t),I("nGramWidths",n,e,t),I("leftPad",n,e,t),I("rightPad",n,e,t),I("padWidth",n,e,t),I("preserveShortSequences",n,e,t)),i=a.nGrams,o=a.nGramsSplits;return[i,o]}case"StringSplit":{var s=r.string.stringSplit(I("input",n,e,t),I("delimiter",n,e,t),I("skipEmpty",n,e,t)),u=s.indices,c=s.values,l=s.shape;return[u,c,l]}case"StringToHashBucketFast":{var f=r.string.stringToHashBucketFast(I("input",n,e,t),I("numBuckets",n,e,t));return[f]}default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var U_e=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"Cast":return[r.cast(I("x",n,e,t),I("dtype",n,e,t))];case"ExpandDims":{var a=I("axis",n,e,t);return[r.expandDims(I("x",n,e,t),a)]}case"Squeeze":{var a=I("axis",n,e,t);return[r.squeeze(I("x",n,e,t),a)]}case"Reshape":return[r.reshape(I("x",n,e,t),I("shape",n,e,t))];case"MirrorPad":return[r.mirrorPad(I("x",n,e,t),I("padding",n,e,t),I("mode",n,e,t))];case"PadV2":case"Pad":return[r.pad(I("x",n,e,t),I("padding",n,e,t),I("constantValue",n,e,t))];case"SpaceToBatchND":{var i=I("blockShape",n,e,t),o=I("paddings",n,e,t);return[r.spaceToBatchND(I("x",n,e,t),i,o)]}case"BatchToSpaceND":{var i=I("blockShape",n,e,t),s=I("crops",n,e,t);return[r.batchToSpaceND(I("x",n,e,t),i,s)]}case"DepthToSpace":{var u=I("blockSize",n,e,t),c=I("dataFormat",n,e,t).toUpperCase();return[r.depthToSpace(I("x",n,e,t),u,c)]}case"BroadcastTo":return[r.broadcastTo(I("x",n,e,t),I("shape",n,e,t))];case"BroadcastArgs":return[r.broadcastArgs(I("s0",n,e,t),I("s1",n,e,t))];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};function P4(n,e,t,r,a){a===void 0&&(a=u4.tidy);var i=function(o,s,u){switch(o.category){case"arithmetic":return a(function(){return w_e(o,s,u)});case"basic_math":return a(function(){return x_e(o,s,u)});case"control":return I_e(o,s,u);case"convolution":return a(function(){return C_e(o,s,u)});case"creation":return a(function(){return A_e(o,s,u)});case"dynamic":return D_e(o,s,u);case"evaluation":return a(function(){return __e(o,s,u)});case"image":return a(function(){return P_e(o,s,u)});case"graph":return a(function(){return F_e(o,s,u)});case"logical":return a(function(){return M_e(o,s,u)});case"matrices":return a(function(){return B_e(o,s,u)});case"normalization":return a(function(){return L_e(o,s,u)});case"ragged":return a(function(){return z_e(o,s,u)});case"reduction":return a(function(){return $_e(o,s,u)});case"slice_join":return a(function(){return q_e(o,s,u)});case"sparse":return a(function(){return W_e(o,s,u)});case"spectral":return a(function(){return V_e(o,s,u)});case"string":return a(function(){return G_e(o,s,u)});case"transformation":return a(function(){return U_e(o,s,u)});case"hash_table":return O_e(o,s,u,r);case"custom":var c=z4(o.op);if(c&&c.customExecutor)return c.customExecutor(new Ywe(o,s,u));throw TypeError("Custom op ".concat(o.op," is not registered."));default:throw TypeError("Unknown op '".concat(o.op,"'. File an issue at ")+"https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(n,e,t);return u4.util.isPromise(i)?i.then(function(o){return[].concat(o)}):[].concat(i)}var M4=function(){function n(e,t,r,a){e===void 0&&(e={}),t===void 0&&(t={}),r===void 0&&(r={}),a===void 0&&(a={}),this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=r,this.functionMap=a,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return n.prototype.newFrame=function(e,t){return{id:e,frameName:t,iterationId:0}},Object.defineProperty(n.prototype,"currentContext",{get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!1,configurable:!0}),n.prototype.generateCurrentContextIds=function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var r=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(r))}e.push(""),this._currentContextIds=e},n.prototype.contextIdforContexts=function(e){return e?e.map(function(t){return t.id===0&&t.iterationId===0?"":"".concat(t.frameName,"-").concat(t.iterationId)}).join("/"):""},n.prototype.enterFrame=function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},n.prototype.exitFrame=function(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")},n.prototype.nextIteration=function(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")},n.prototype.getWeight=function(e){return this.weightMap[e]},n.prototype.addTensorArray=function(e){this.tensorArrayMap[e.id]=e},n.prototype.getTensorArray=function(e){return this.tensorArrayMap[e]},n.prototype.addTensorList=function(e){this.tensorListMap[e.id]=e},n.prototype.getTensorList=function(e){return this.tensorListMap[e]},n.prototype.dispose=function(e){for(var t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(var t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)},n}();function B4(n,e,t,r){var a=new Set,i=[],o=null,s=null,u=new Set,c=Object.keys(n).map(function(d){return Zr(d)[0]}),l=[];r!=null&&(l=r.map(function(d){return Zr(d.name)[0]}));for(var f=yn([],Ne(e),!1);f.length>0;){var h=f.pop();if((qB(h)||Y_e(h)||Z_e(h))&&o==null&&(o=h,s=o.children.map(function(d){return d.name}).filter(function(d){return a.has(d)})),a.add(h.name),t[h.name]==null&&c.indexOf(h.name)===-1&&l.indexOf(h.name)===-1){if(h.inputs.length===0){i.push(h.name);continue}h.inputs.forEach(function(d){u.has(d.name)||(u.add(d.name),f.push(d))})}}return{inputs:n,outputs:e,usedNodes:a,missingInputs:i,dynamicNode:o,syncInputs:s}}function H_e(n,e,t){var r=t.usedNodes,a=t.inputs,i=[],o=Object.keys(a).map(function(f){return Zr(f)[0]}).map(function(f){return n.nodes[f]}),s=n.initNodes;o.forEach(function(f){r.has(f.name)&&i.push(f)}),n.weights.forEach(function(f){r.has(f.name)&&i.push(f)}),s?.forEach(function(f){r.has(f.name)&&i.push(f)});for(var u=new Set,c=[];i.length>0;){var l=i.pop();u.add(l.name),e[l.name]||c.push(l),l.children.forEach(function(f){!u.has(f.name)&&r.has(f.name)&&f.inputs.every(function(h){return u.has(h.name)})&&i.push(f)})}return c}var K_e=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],j_e=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],X_e=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function qB(n){return K_e.indexOf(n.op)>=0}function Y_e(n){return j_e.indexOf(n.op)>=0}function Z_e(n){return X_e.indexOf(n.op)>=0}var L4=function(){function n(e,t){var r=this;this.graph=e,this.parent=t,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,e.functions!=null&&Object.keys(e.functions).forEach(function(a){r._functionExecutorMap[a]=new n(e.functions[a],r)})}return Object.defineProperty(n.prototype,"weightIds",{get:function(){return this.parent?this.parent.weightIds:this._weightIds},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"functionExecutorMap",{get:function(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"weightMap",{get:function(){return this.parent?this.parent.weightMap:this._weightMap},set:function(e){var t=Object.keys(e).map(function(r){return e[r].map(function(a){return a.id})});this._weightIds=[].concat.apply([],yn([],Ne(t),!1)),this._weightMap=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"resourceManager",{set:function(e){this._resourceManager=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"inputs",{get:function(){return this._inputs.map(function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"outputs",{get:function(){return this._outputs.map(function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"inputNodes",{get:function(){return this._inputs.map(function(e){return e.signatureKey||e.name})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"outputNodes",{get:function(){return this._outputs.map(function(e){var t=e.signatureKey||e.name;return e.defaultOutput?"".concat(t,":").concat(e.defaultOutput):t})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"functions",{get:function(){var e=this;return Object.keys(this._functions).reduce(function(t,r){return t[r]=e._functions[r].signature,t},{})},enumerable:!1,configurable:!0}),n.prototype.getCompilationKey=function(e,t){var r=e.map(function(i){return i.name}).sort(),a=t.map(function(i){return i.name}).sort();return r.join(this.SEPERATOR)+"--"+a.join(this.SEPERATOR)},n.prototype.compile=function(e,t){var r=B4(e,t,this.weightMap,this._initNodes),a=r.missingInputs,i=r.dynamicNode,o=r.syncInputs;if(i!=null)throw new Error("This execution contains the node '".concat(i.name,"', which has ")+"the dynamic op '".concat(i.op,"'. Please use ")+"model.executeAsync() instead. Alternatively, to avoid the "+"dynamic ops, specify the inputs [".concat(o,"]"));if(a.length>0){var s=t.map(function(c){return c.name}),u=Object.keys(e);throw new Error("Cannot compute the outputs [".concat(s,"] from the provided inputs ")+"[".concat(u,"]. Missing the following inputs: [").concat(a,"]"))}return H_e(this.graph,this.weightMap,r)},n.prototype.cloneAndKeepTensor=function(e){if(e==null)return null;var t=e.clone();return Be.keep(t),t},n.prototype.cloneTensorList=function(e){var t=this;if(!e)return null;var r=e.map(function(a){return t.cloneAndKeepTensor(a)});return r},n.prototype.cloneTensorMap=function(e){var t=this;return Object.fromEntries(Object.entries(e).map(function(r){var a=Ne(r,2),i=a[0],o=a[1];return[i,t.cloneTensorList(o)]}))},n.prototype.execute=function(e,t){var r=this;this.disposeIntermediateTensors(),e=this.mapInputs(e);var a=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var i=a.map(function(h){return r.graph.nodes[Zr(h)[0]]}),o=t.map(function(h){return Zr(h)[0]}),s=o.map(function(h){return r.graph.nodes[h]});s.length===0&&(s=this._outputs);var u=this.getCompilationKey(i,s),c=this.compiledMap.get(u);c==null&&(c=this.compile(e,s),this.compiledMap.set(u,c));try{this.keepIntermediateTensors=Be.env().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(h){this.keepIntermediateTensors=!1,console.warn(h.message)}var l={},f={};return Be.tidy(function(){var h=new M4(r.weightMap,l,f,r.functionExecutorMap),d=Object.assign({},r.weightMap);r.keepIntermediateTensors&&(r.clonedTensorsMap=r.cloneTensorMap(r.weightMap)),Object.keys(e).forEach(function(b){var w=Ne(Zr(b),2),x=w[0],N=w[1],T=[];T[N]=e[b],d[x]=T,r.keepIntermediateTensors&&(r.clonedTensorsMap[x]=r.cloneTensorList(T))});for(var p=r.getFrozenTensorIds(d),v={},m=0;m<c.length;m++){var g=c[m];if(!d[g.name]){var y=P4(g,d,h,r._resourceManager);if(Be.util.isPromise(y))throw new Error("The execution of the op '".concat(g.op,"' returned a promise. ")+"Please use model.executeAsync() instead.");d[g.name]=y,r.keepIntermediateTensors&&(r.clonedTensorsMap[g.name]=r.cloneTensorList(y)),r.checkTensorForDisposal(g.name,g,d,h,p,o,v)}}return r.parent==null&&h.dispose(p),t.map(function(b){return gr(b,d,h)})})},n.prototype.getFrozenTensorIds=function(e){var t=[].concat.apply([],Object.keys(e).map(function(r){return e[r]}).map(function(r){return r.map(function(a){return a.id})}));return new Set(t)},n.prototype.checkTensorForDisposal=function(e,t,r,a,i,o,s){t.category==="control"||o.indexOf(e)!==-1||(r[e].forEach(function(u){u!=null&&(s[u.id]=(s[u.id]||0)+t.children.length)}),t.inputs.forEach(function(u){if(u.category!=="control"){var c=lwe(u.name,r,a);c?.forEach(function(l){if(l&&!l.kept&&!i.has(l.id)){var f=s[l.id];f===1?(l.dispose(),delete s[l.id]):f!=null&&s[l.id]--}})}}))},n.prototype.executeAsync=function(e,t){return Pt(this,void 0,void 0,function(){return Dt(this,function(r){return[2,this._executeAsync(e,t)]})})},n.prototype.disposeIntermediateTensors=function(){!this.clonedTensorsMap||(Object.values(this.clonedTensorsMap).forEach(function(e){var t,r;try{for(var a=Sc(e),i=a.next();!i.done;i=a.next()){var o=i.value;o&&!o.isDisposed&&o.dispose()}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}}),this.clonedTensorsMap=null)},n.prototype.getIntermediateTensors=function(){return this.clonedTensorsMap},n.prototype._executeAsync=function(e,t,r,a,i){return r===void 0&&(r=!1),a===void 0&&(a={}),i===void 0&&(i={}),Pt(this,void 0,void 0,function(){var o,s,u,c,l,f;return Dt(this,function(h){switch(h.label){case 0:this.disposeIntermediateTensors(),r||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t));try{this.keepIntermediateTensors=Be.env().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(d){this.keepIntermediateTensors=!1,console.warn(d.message)}return o=new M4(this.weightMap,a,i,this.functionExecutorMap),this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),[4,this.executeWithControlFlow(e,o,t,r)];case 1:return s=h.sent(),u=t.map(function(d){return gr(d,s,o)}),c=u.map(function(d){return d.id}),l=Object.keys(e).map(function(d){return e[d].id}),f=new Set(yn(yn(yn([],Ne(c),!1),Ne(l),!1),Ne(this.weightIds),!1)),Object.values(s).forEach(function(d){d.forEach(function(p){p&&!p.isDisposed&&!f.has(p.id)&&p.dispose()})}),this.parent==null&&o.dispose(f),[2,u]}})})},n.prototype.executeFunctionAsync=function(e,t,r){return Pt(this,void 0,void 0,function(){var a,i=this;return Dt(this,function(o){return a=e.reduce(function(s,u,c){return s[i.inputs[c].name]=u,s},{}),[2,this._executeAsync(a,this.outputNodes,!0,t,r)]})})},n.prototype.executeWithControlFlow=function(e,t,r,a){return Pt(this,void 0,void 0,function(){var i,o,s,u,c,l,f,h,d,p,v,m,g,y,b,w,x,N=this;return Dt(this,function(T){switch(T.label){case 0:i=Object.keys(e),o=i.map(function(E){return N.graph.nodes[Zr(E)[0]]}),s=r.map(function(E){return Zr(E)[0]}),u=s.map(function(E){return N.graph.nodes[E]}),u.length===0&&(u=this._outputs),c=B4(e,u,this.weightMap,this._initNodes),l=c.usedNodes,f=c.missingInputs,h=c.dynamicNode,d=c.syncInputs,p=yn(yn(yn([],Ne(o),!1),Ne(this.graph.weights),!1),Ne(this._initNodes||[]),!1).map(function(E){return{node:E,contexts:t.currentContext}}),v=Object.assign({},this.weightMap),Object.keys(e).forEach(function(E){var C=Ne(Zr(E),2),F=C[0],_=C[1],O=[];O[_]=e[E],v[F]=O}),m={},g=this.getFrozenTensorIds(v),y={},T.label=1;case 1:return p.length>0?(b=this.processStack(o,p,t,v,y,g,s,m,l),[4,Promise.all(b)]):[3,3];case 2:return T.sent(),[3,1];case 3:if(h==null&&!a&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),w=u.filter(function(E){return!qB(E)&&!gr(E.name,v,t)}).map(function(E){return E.name}),w.length>0)throw x="",h!=null&&(x="Alternatively, to avoid the dynamic ops, use model.execute() "+"and specify the inputs [".concat(d,"]")),new Error("Cannot compute the outputs [".concat(w,"] from the provided ")+"inputs [".concat(i,"]. Consider providing the following inputs: ")+"[".concat(f,"]. ").concat(x));return[2,v]}})})},n.prototype.processStack=function(e,t,r,a,i,o,s,u,c){for(var l=this,f=[],h=function(){var p,v,m=t.pop();r.currentContext=m.contexts;var g="";if(m.node.op==="Enter"&&I("isConstant",m.node,a,r)&&(p=Ne(ro(m.node.name,r),1),g=p[0]),a[m.node.name]==null){var y=P4(m.node,a,r,d._resourceManager);g||(v=Ne(ro(m.node.name,r),1),g=v[0]);var b=r.currentContext;Be.util.isPromise(y)?f.push(y.then(function(w){return a[g]=w,l.keepIntermediateTensors&&(l.clonedTensorsMap[g]=l.cloneTensorList(w)),r.currentContext=b,l.checkTensorForDisposal(g,m.node,a,r,o,s,u),l.processChildNodes(m.node,t,r,a,i,c),w})):(a[g]=y,d.keepIntermediateTensors&&(d.clonedTensorsMap[g]=d.cloneTensorList(y)),d.checkTensorForDisposal(g,m.node,a,r,o,s,u),d.processChildNodes(m.node,t,r,a,i,c))}else d.processChildNodes(m.node,t,r,a,i,c)},d=this;t.length>0;)h();return f},n.prototype.processChildNodes=function(e,t,r,a,i,o){e.children.forEach(function(s){var u=Ne(ro(s.name,r),1),c=u[0];i[c]||!o.has(s.name)||(s.op==="Merge"?s.inputNames.some(function(l){return!!gr(l,a,r)})&&(i[c]=!0,t.push({contexts:r.currentContext,node:s})):s.inputNames.every(function(l){return!!gr(l,a,r)})&&(i[c]=!0,t.push({contexts:r.currentContext,node:s})))})},n.prototype.dispose=function(){var e=this;Object.keys(this.weightMap).forEach(function(t){return e.weightMap[t].forEach(function(r){return r.dispose()})})},n.prototype.checkInputShapeAndType=function(e){var t=this;Object.keys(e).forEach(function(r){var a=e[r],i=Ne(Zr(r),1),o=i[0],s=t.graph.nodes[o];if(s.attrParams.shape&&s.attrParams.shape.value){var u=s.attrParams.shape.value,c=u.length===a.shape.length&&a.shape.every(function(l,f){return u[f]===-1||u[f]===l});Be.util.assert(c,function(){return"The shape of dict['".concat(s.name,"'] provided in ")+"model.execute(dict) must be [".concat(u,"], but was ")+"[".concat(a.shape,"]")})}s.attrParams.dtype&&s.attrParams.dtype.value&&Be.util.assert(a.dtype===s.attrParams.dtype.value,function(){return"The dtype of dict['".concat(s.name,"'] provided in ")+"model.execute(dict) must be "+"".concat(s.attrParams.dtype.value,", but was ").concat(a.dtype)})})},n.prototype.mapInputs=function(e){var t,r,a={};for(var i in e){var o=(r=(t=this._signature)===null||t===void 0?void 0:t.inputs)===null||r===void 0?void 0:r[i];o!=null?a[o.name]=e[i]:a[i]=e[i]}return a},n.prototype.checkInputs=function(e){var t=this,r=Object.keys(e).filter(function(a){var i=Ne(Zr(a),1),o=i[0];return t.graph.nodes[o]==null});if(r.length>0)throw new Error("The dict provided in model.execute(dict) has "+"keys: [".concat(r,"] that are not part of graph"))},n.prototype.mapOutputs=function(e){var t=this;return e.map(function(r){var a,i,o=(i=(a=t._signature)===null||a===void 0?void 0:a.outputs)===null||i===void 0?void 0:i[r];return o!=null?o.name:r},{})},n.prototype.checkOutputs=function(e){var t=this;e.forEach(function(r){var a=Ne(Zr(r),1),i=a[0];if(!t.graph.nodes[i])throw new Error("The output '".concat(r,"' is not found in the graph"))})},n}(),J_e=function(){function n(e,t){e===void 0&&(e={}),t===void 0&&(t={}),this.hashTableNameToHandle=e,this.hashTableMap=t}return n.prototype.addHashTable=function(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t},n.prototype.getHashTableHandleByName=function(e){return this.hashTableNameToHandle[e]},n.prototype.getHashTableById=function(e){return this.hashTableMap[e]},n.prototype.dispose=function(){for(var e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(var t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]},n}(),Q_e="?tfjs-format=file",e3e="model.json",Yw=function(){function n(e,t,r){t===void 0&&(t={}),r===void 0&&(r=Be.io),this.modelUrl=e,this.loadOptions=t,this.version="n/a",this.io=r,t==null&&(this.loadOptions={}),this.resourceManager=new J_e}return Object.defineProperty(n.prototype,"modelVersion",{get:function(){return this.version},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"metadata",{get:function(){return this.artifacts.userDefinedMetadata},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"modelSignature",{get:function(){return this.signature},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"modelStructuredOutputKeys",{get:function(){return this.structuredOutputKeys},enumerable:!1,configurable:!0}),n.prototype.findIOHandler=function(){var e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{var t=this.io.getLoadHandlers(e,this.loadOptions);if(t.length===0)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one (".concat(t.length,") load handlers for ")+"URL '".concat([e],"'"));this.handler=t[0]}},n.prototype.load=function(){var e=this;if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");var t=this.handler.load();return Be.util.isPromise(t)?t.then(function(r){return e.loadSync(r)}):this.loadSync(t)},n.prototype.loadSync=function(e){this.artifacts=e;var t=this.artifacts.modelTopology,r=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){var a=this.artifacts.userDefinedMetadata;a.signature!=null&&(r=a.signature),a.structuredOutputKeys!=null&&(this.structuredOutputKeys=a.structuredOutputKeys)}this.signature=r,this.version="".concat(t.versions.producer,".").concat(t.versions.minConsumer);var i=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new L4(l4.Instance.transformGraph(t,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(i),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){var o=l4.Instance.transformGraph(e.modelInitializer);this.initializer=new L4(o),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0},n.prototype.save=function(e,t){return Pt(this,void 0,void 0,function(){var r;return Dt(this,function(a){if(typeof e=="string"){if(r=this.io.getSaveHandlers(e),r.length===0)throw new Error("Cannot find any save handlers for URL '".concat(e,"'"));if(r.length>1)throw new Error("Found more than one (".concat(r.length,") save handlers for ")+"URL '".concat(e,"'"));e=r[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[2,e.save(this.artifacts)]})})},n.prototype.addStructuredOutputNames=function(e){var t=this;if(this.structuredOutputKeys){var r=e instanceof Be.Tensor?[e]:e,a={};return r.forEach(function(i,o){return a[t.structuredOutputKeys[o]]=i}),a}return e},n.prototype.predict=function(e,t){var r=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(r)},n.prototype.predictAsync=function(e,t){return Pt(this,void 0,void 0,function(){var r;return Dt(this,function(a){switch(a.label){case 0:return[4,this.executeAsync(e,this.outputNodes)];case 1:return r=a.sent(),[2,this.addStructuredOutputNames(r)]}})})},n.prototype.normalizeInputs=function(e){var t=this,r;if(!(e instanceof Be.Tensor)&&!Array.isArray(e)){var a=(r=this.signature)===null||r===void 0?void 0:r.inputs;if(a!=null)for(var i in a){var o=a[i];o.resourceId!=null&&(e[i]=this.resourceIdToCapturedInput[o.resourceId])}return e}e=Array.isArray(e)?e:[e];var s=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+s!==this.inputNodes.length)throw new Error("Input tensor count mismatch, the graph model has ".concat(this.inputNodes.length-s," non-resource placeholders, while there are ").concat(e.length," input tensors provided."));var u=0;return this.inputNodes.reduce(function(c,l){var f,h,d,p=(d=(h=(f=t.signature)===null||f===void 0?void 0:f.inputs)===null||h===void 0?void 0:h[l])===null||d===void 0?void 0:d.resourceId;return p!=null?c[l]=t.resourceIdToCapturedInput[p]:c[l]=e[u++],c},{})},n.prototype.normalizeOutputs=function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]},n.prototype.executeInitializerGraph=function(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))},n.prototype.executeInitializerGraphAsync=function(){return Pt(this,void 0,void 0,function(){return Dt(this,function(e){return this.initializer==null?[2,[]]:this.initializerSignature==null?[2,this.initializer.executeAsync({},[])]:[2,this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))]})})},n.prototype.setResourceIdToCapturedInput=function(e){if(this.resourceIdToCapturedInput={},this.initializerSignature)for(var t=this.initializerSignature.outputs,r=Object.keys(t),a=0;a<r.length;a++){var i=r[a],o=t[i];this.resourceIdToCapturedInput[o.resourceId]=e[a]}},n.prototype.execute=function(e,t){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var r=this.executor.execute(e,t);return r.length>1?r:r[0]},n.prototype.executeAsync=function(e,t){return Pt(this,void 0,void 0,function(){var r,a;return Dt(this,function(i){switch(i.label){case 0:return this.resourceIdToCapturedInput!=null?[3,2]:(r=this.setResourceIdToCapturedInput,[4,this.executeInitializerGraphAsync()]);case 1:r.apply(this,[i.sent()]),i.label=2;case 2:return e=this.normalizeInputs(e),t=this.normalizeOutputs(t),[4,this.executor.executeAsync(e,t)];case 3:return a=i.sent(),[2,a.length>1?a:a[0]]}})})},n.prototype.getIntermediateTensors=function(){return this.executor.getIntermediateTensors()},n.prototype.disposeIntermediateTensors=function(){this.executor.disposeIntermediateTensors()},n.prototype.convertTensorMapToTensorsMap=function(e){return Object.keys(e).reduce(function(t,r){return t[r]=[e[r]],t},{})},n.prototype.dispose=function(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&Be.dispose(this.resourceIdToCapturedInput)),this.resourceManager.dispose()},n}();function t3e(n,e,t){return e===void 0&&(e={}),t===void 0&&(t=Be.io),Pt(this,void 0,void 0,function(){var r;return Dt(this,function(a){switch(a.label){case 0:if(n==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");return e==null&&(e={}),e.fromTFHub&&typeof n=="string"&&(n=r3e(n)),r=new Yw(n,e,t),[4,r.load()];case 1:return a.sent(),[2,r]}})})}function n3e(n){if(n==null)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");var e;if(n instanceof Array){var t=Ne(n,2),r=t[0],a=t[1];if(!r)throw new Error("modelJSON must be the first element of the array");if(!a||!(a instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in r))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in r))throw new Error("Model JSON is missing 'weightsManifest'");var i=Be.io.getWeightSpecs(r.weightsManifest),o=Be.io.getModelArtifactsForJSONSync(r,i,a);e=Be.io.fromMemorySync(o)}else if("load"in n)e=n;else if("modelTopology"in n&&"weightSpecs"in n&&"weightData"in n)e=Be.io.fromMemorySync(n);else throw new Error("Unknown model format");var s=new Yw(e);return s.load(),s}function r3e(n){return n.endsWith("/")||(n=n+"/"),"".concat(n).concat(e3e).concat(Q_e)}var a3e="4.2.0";Xo.GraphModel=Yw;Xo.deregisterOp=cwe;Xo.loadGraphModel=t3e;Xo.loadGraphModelSync=n3e;Xo.registerOp=uwe;Xo.version_converter=a3e});var Zw=Y(()=>{});var VB=Y(()=>{});var lL=Y(Rr=>{"use strict";Object.defineProperty(Rr,"__esModule",{value:!0});var wn=Cs();function i3e(n){if(n&&n.__esModule)return n;var e=Object.create(null);return n&&Object.keys(n).forEach(function(t){if(t!=="default"){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}}),e.default=n,e}var hn=i3e(wn),Qw=function(n,e){return Qw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])},Qw(n,e)};function _t(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Qw(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Le(n,e,t,r){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(r.next(l))}catch(f){o(f)}}function u(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((r=r.apply(n,e||[])).next())})}function ze(n,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(l){c=[6,l],a=0}finally{r=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function ru(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function o3e(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=r.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return i}function s3e(n,e,t){if(t||arguments.length===2)for(var r=0,a=e.length,i;r<a;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}var au=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function u3e(n){if(n.__esModule)return n;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(n).forEach(function(t){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}),e}function iu(n){var e={exports:{}};return n(e,e.exports),e.exports}var c3e=iu(function(n){(function(e,t,r){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.alea=o})(au,n,!1)}),l3e=iu(function(n){(function(e,t,r){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor128=o})(au,n,!1)}),f3e=iu(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorwow=o})(au,n,!1)}),h3e=iu(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,d;return h=l[f],h^=h>>>7,d=h^h<<24,h=l[f+1&7],d^=h^h>>>10,h=l[f+3&7],d^=h^h>>>3,h=l[f+4&7],d^=h^h<<7,h=l[f+7&7],h=h^h<<13,d^=h^h<<9,l[f]=d,u.i=f+1&7,d};function c(l,f){var h,d=[];if(f===(f|0))d[0]=f;else for(f=""+f,h=0;h<f.length;++h)d[h&7]=d[h&7]<<15^f.charCodeAt(h)+d[h+1&7]<<13;for(;d.length<8;)d.push(0);for(h=0;h<8&&d[h]===0;++h);for(h==8&&(d[7]=-1),l.x=d,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorshift7=o})(au,n,!1)}),d3e=iu(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,d,p;return u.w=l=l+1640531527|0,p=f[h+34&127],d=f[h=h+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,p=f[h]=p^d,u.i=h,p+(l^l>>>16)|0};function c(l,f){var h,d,p,v,m,g=[],y=128;for(f===(f|0)?(d=f,f=null):(f=f+"\0",d=0,y=Math.max(y,f.length)),p=0,v=-32;v<y;++v)f&&(d^=f.charCodeAt((v+32)%f.length)),v===0&&(m=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,v>=0&&(m=m+1640531527|0,h=g[v&127]^=d+m,p=h==0?p+1:0);for(p>=128&&(g[(f&&f.length||0)&127]=-1),p=127,v=4*128;v>0;--v)d=g[p+34&127],h=g[p=p+1&127],d^=d<<13,h^=h<<17,d^=d>>>15,h^=h>>>12,g[p]=d^h;l.w=m,l.X=g,l.i=p}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor4096=o})(au,n,!1)}),p3e=iu(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,d=u.d,p=u.a;return f=f<<25^f>>>7^h,h=h-d|0,d=d<<24^d>>>8^p,p=p-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-d|0,u.d=d<<16^h>>>16^p,u.a=p-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.tychei=o})(au,n,!1)}),v3e={},m3e={__proto__:null,default:v3e},g3e=u3e(m3e),ou=iu(function(n){(function(e,t,r){var a=256,i=6,o=52,s="random",u=r.pow(a,i),c=r.pow(2,o),l=c*2,f=a-1,h;function d(w,x,N){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(m(x.entropy?[w,b(t)]:w??y(),3),T),C=new p(T),F=function(){for(var _=C.g(i),O=u,L=0;_<c;)_=(_+L)*a,O*=a,L=C.g(1);for(;_>=l;)_/=2,O/=2,L>>>=1;return(_+L)/O};return F.int32=function(){return C.g(4)|0},F.quick=function(){return C.g(4)/4294967296},F.double=F,g(b(C.S),t),(x.pass||N||function(_,O,L,z){return z&&(z.S&&v(z,C),_.state=function(){return v(C,{})}),L?(r[s]=_,O):_})(F,E,"global"in x?x.global:this==r,x.state)}function p(w){var x,N=w.length,T=this,E=0,C=T.i=T.j=0,F=T.S=[];for(N||(w=[N++]);E<a;)F[E]=E++;for(E=0;E<a;E++)F[E]=F[C=f&C+w[E%N]+(x=F[E])],F[C]=x;(T.g=function(_){for(var O,L=0,z=T.i,$=T.j,B=T.S;_--;)O=B[z=f&z+1],L=L*a+B[f&(B[z]=B[$=f&$+O])+(B[$]=O)];return T.i=z,T.j=$,L})(a)}function v(w,x){return x.i=w.i,x.j=w.j,x.S=w.S.slice(),x}function m(w,x){var N=[],T=typeof w,E;if(x&&T=="object")for(E in w)try{N.push(m(w[E],x-1))}catch{}return N.length?N:T=="string"?w:w+"\0"}function g(w,x){for(var N=w+"",T,E=0;E<N.length;)x[f&E]=f&(T^=x[f&E]*19)+N.charCodeAt(E++);return b(x)}function y(){try{var w;return h&&(w=h.randomBytes)?w=w(a):(w=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var x=e.navigator,N=x&&x.plugins;return[+new Date,e,N,e.screen,b(t)]}}function b(w){return String.fromCharCode.apply(0,w)}if(g(r.random(),t),n.exports){n.exports=d;try{h=g3e}catch{}}else r["seed"+s]=d})(typeof self<"u"?self:au,[],Math)});ou.alea=c3e;ou.xor128=l3e;ou.xorwow=f3e;ou.xorshift7=h3e;ou.xor4096=d3e;ou.tychei=p3e;var KB=ou;function y3e(n,e){return Vv(n,e)}function Vv(n,e,t,r){if(t===void 0&&(t=new Map),r===void 0&&(r=new Set),n==null)return null;if(typeof Blob=="function"&&n instanceof Blob)return n.slice();if(r.has(n))throw new Error("Circular references are not supported.");if(t.has(n))return t.get(n);var a=e(n);if(a.recurse&&a.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse)if(_c(n)){var i=Array.isArray(n)?[]:{};r.add(n);for(var o in n){var s=n[o],u=Vv(s,e,t,r);i[o]=u}return r.delete(n),n.__proto__&&(i.__proto__=n.__proto__),i}else throw new Error("Can't recurse into non-iterable type: ".concat(n));else return t.set(n,a.value),a.value}function b3e(n,e){return e===void 0&&(e=XB),jB(n,e)}function jB(n,e,t){t===void 0&&(t=new Set);var r=n[0];if(t.has(r))throw new Error("Circular references are not supported.");var a=e(n);if(a.recurse&&a.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse)if(_c(r)){var i=Array.isArray(r)?[]:{};t.add(r);var o=function(u){var c=n.map(function(f){return f[u]}),l=jB(c,e,t);i[u]=l};for(var s in r)o(s);return t.delete(r),i}else throw new Error("Can't recurse into non-iterable type: ".concat(r));else return a.value}function XB(n){return n===null?null:_c(n[0])?{value:null,recurse:!0}:{value:n,recurse:!1}}function YB(n,e){return Le(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f;return ze(this,function(h){switch(h.label){case 0:t=new Map,Vv(n,e,t),h.label=1;case 1:h.trys.push([1,6,7,8]),r=ru(Array.from(t.keys())),a=r.next(),h.label=2;case 2:return a.done?[3,5]:(i=a.value,o=t.get(i),hn.util.isPromise(o)?[4,o]:[3,4]);case 3:s=h.sent(),t.set(i,s),h.label=4;case 4:return a=r.next(),[3,2];case 5:return[3,8];case 6:return u=h.sent(),l={error:u},[3,8];case 7:try{a&&!a.done&&(f=r.return)&&f.call(r)}finally{if(l)throw l.error}return[7];case 8:return c=Vv(n,e,t),[2,c]}})})}function _c(n){var e=!1;if(hn.env().get("IS_BROWSER"))e=n instanceof TextDecoder;else{var t=Zw().StringDecoder;e=n instanceof t}return n!=null&&!ArrayBuffer.isView(n)&&(Array.isArray(n)||typeof n=="object"&&!(n instanceof hn.Tensor)&&!(n instanceof Promise)&&!e)}function w3e(n){return n==null||x3e(n)||Array.isArray(n)||typeof n=="object"&&n instanceof hn.Tensor||hn.util.isTypedArray(n)}function x3e(n){return n===null||typeof n!="object"&&typeof n!="function"}function k3e(n){return y3e(n,S3e)}function S3e(n){return n instanceof hn.Tensor?{value:n.clone(),recurse:!1}:_c(n)?{value:null,recurse:!0}:{value:n,recurse:!1}}var ZB=function(){function n(e){if(this.capacity=e,this.begin=0,this.end=0,e==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}return n.prototype.wrap=function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity},n.prototype.get=function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]},n.prototype.set=function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t},n.prototype.length=function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e},n.prototype.isFull=function(){return this.length()===this.capacity},n.prototype.isEmpty=function(){return this.length()===0},n.prototype.push=function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)},n.prototype.pushAll=function(e){var t,r;try{for(var a=ru(e),i=a.next();!i.done;i=a.next()){var o=i.value;this.push(o)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}},n.prototype.pop=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e},n.prototype.unshift=function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)},n.prototype.shift=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e},n.prototype.shuffleExcise=function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),r=this.get(t);return this.set(t,this.pop()),r},n}(),JB=function(n){_t(e,n);function e(){return n.call(this,e.INITIAL_CAPACITY)||this}return e.prototype.isFull=function(){return!1},e.prototype.push=function(t){n.prototype.isFull.call(this)&&this.expand(),n.prototype.push.call(this,t)},e.prototype.unshift=function(t){n.prototype.isFull.call(this)&&this.expand(),n.prototype.unshift.call(this,t)},e.prototype.expand=function(){for(var t=this.capacity*2,r=new Array(t),a=this.length(),i=0;i<a;i++)r[i]=this.get(this.wrap(this.begin+i));this.data=r,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=a},e}(ZB);JB.INITIAL_CAPACITY=32;function QB(n){return new E3e(n)}function ex(n){return new I3e(n)}function N3e(n,e){return new eL(n,e)}function T3e(n,e){return e===void 0&&(e=Yo.FAIL),new M3e(n,e)}var Yn=function(){function n(){}return n.prototype.toArray=function(){return Le(this,void 0,void 0,function(){var e,t;return ze(this,function(r){switch(r.label){case 0:return e=[],[4,this.next()];case 1:t=r.sent(),r.label=2;case 2:return t.done?[3,4]:(e.push(t.value),[4,this.next()]);case 3:return t=r.sent(),[3,2];case 4:return[2,e]}})})},n.prototype.toArrayForTest=function(){return Le(this,void 0,void 0,function(){var e,t,r;return ze(this,function(a){switch(a.label){case 0:return e=this.prefetch(100),t=[],[4,e.next()];case 1:r=a.sent(),a.label=2;case 2:return r.done?[3,4]:(t.push(r.value),[4,e.next()]);case 3:return r=a.sent(),[3,2];case 4:return[2,t]}})})},n.prototype.resolveFully=function(){return Le(this,void 0,void 0,function(){var e;return ze(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:e=t.sent(),t.label=2;case 2:return e.done?[3,4]:[4,this.next()];case 3:return e=t.sent(),[3,2];case 4:return[2]}})})},n.prototype.resolveWhile=function(e){return Le(this,void 0,void 0,function(){var t,r;return ze(this,function(a){switch(a.label){case 0:return[4,this.next()];case 1:t=a.sent(),r=e(t.value),a.label=2;case 2:return!t.done&&r?[4,this.next()]:[3,4];case 3:return t=a.sent(),r=e(t.value),[3,2];case 4:return[2]}})})},n.prototype.handleErrors=function(e){return new O3e(this,e)},n.prototype.filter=function(e){return new F3e(this,e)},n.prototype.map=function(e){return new R3e(this,e)},n.prototype.mapAsync=function(e){return new GB(this,e)},n.prototype.serialMapAsync=function(e){return new GB(this,e).serial()},n.prototype.flatmap=function(e){return new P3e(this,e)},n.prototype.forEachAsync=function(e){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,this.map(e).resolveFully()]})})},n.prototype.serialForEach=function(e){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,this.serialMapAsync(e).resolveWhile(function(r){return r===!0})]})})},n.prototype.rowMajorBatch=function(e,t){return t===void 0&&(t=!0),new _3e(this,e,t)},n.prototype.columnMajorBatch=function(e,t,r){t===void 0&&(t=!0),r===void 0&&(r=XB);var a=this.rowMajorBatch(e,t);return a.map(function(i){return b3e(i,r)})},n.prototype.concatenate=function(e,t){return new eL(QB([this,e]),t)},n.prototype.take=function(e){return e<0||e==null?this:new D3e(this,e)},n.prototype.skip=function(e){return e<0||e==null?this:new A3e(this,e)},n.prototype.prefetch=function(e){return new tL(this,e)},n.prototype.shuffle=function(e,t){return new B3e(this,e,t)},n.prototype.serial=function(){return new C3e(this)},n}(),E3e=function(n){_t(e,n);function e(t){var r=n.call(this)||this;return r.items=t,r.trav=0,r}return e.prototype.summary=function(){return"Array of ".concat(this.items.length," items")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(r){return this.trav>=this.items.length?[2,{value:null,done:!0}]:(t=this.items[this.trav],this.trav++,[2,{value:k3e(t),done:!1}])})})},e}(Yn),I3e=function(n){_t(e,n);function e(t){var r=n.call(this)||this;return r.nextFn=t,r}return e.prototype.summary=function(){return"Function call"},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){try{return[2,this.nextFn()]}catch(r){throw r.message="Error thrown while iterating through a dataset: ".concat(r.message),r}return[2]})})},e}(Yn),C3e=function(n){_t(e,n);function e(t){var r=n.call(this)||this;return r.upstream=t,r.lastRead=Promise.resolve({value:null,done:!1}),r}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Serial")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(r){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,this.upstream.next()]})})},e}(Yn),A3e=function(n){_t(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.maxCount=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Skip")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(r){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(r){switch(r.label){case 0:return this.count++<this.maxCount?[4,this.upstream.next()]:[3,2];case 1:return t=r.sent(),t.done?[2,t]:(hn.dispose(t.value),[3,0]);case 2:return[2,this.upstream.next()]}})})},e}(Yn),D3e=function(n){_t(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.maxCount=r,a.count=0,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Take")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return this.count++>=this.maxCount?[2,{value:null,done:!0}]:[2,this.upstream.next()]})})},e}(Yn),_3e=function(n){_t(e,n);function e(t,r,a){a===void 0&&(a=!0);var i=n.call(this)||this;return i.upstream=t,i.batchSize=r,i.enableSmallLastBatch=a,i.lastRead=Promise.resolve({value:null,done:!1}),i}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> RowMajorBatch")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(r){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t,r;return ze(this,function(a){switch(a.label){case 0:t=[],a.label=1;case 1:return t.length<this.batchSize?[4,this.upstream.next()]:[3,3];case 2:return r=a.sent(),r.done?this.enableSmallLastBatch&&t.length>0?[2,{value:t,done:!1}]:[2,{value:null,done:!0}]:(t.push(r.value),[3,1]);case 3:return[2,{value:t,done:!1}]}})})},e}(Yn),F3e=function(n){_t(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.predicate=r,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Filter")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(r){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(r){switch(r.label){case 0:return[4,this.upstream.next()];case 1:return t=r.sent(),t.done||this.predicate(t.value)?[2,t]:(hn.dispose(t.value),[3,0]);case 2:return[2]}})})},e}(Yn),R3e=function(n){_t(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.transform=r,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Map")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l;return ze(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:if(t=f.sent(),t.done)return[2,{value:null,done:!0}];r=hn.tensor_util.getTensorsInContainer(t.value),a=this.transform(t.value),i=hn.tensor_util.getTensorsInContainer(a);try{for(o=ru(r),s=o.next();!s.done;s=o.next())u=s.value,hn.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){c={error:h}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}return[2,{value:a,done:!1}]}})})},e}(Yn),O3e=function(n){_t(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.handler=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> handleErrors")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(r){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(r){switch(r.label){case 0:r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.upstream.next()];case 2:return[2,r.sent()];case 3:return t=r.sent(),this.handler(t)?[3,4]:[2,{value:null,done:!0}];case 4:return[3,0];case 5:return[2]}})})},e}(Yn),GB=function(n){_t(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.transform=r,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> AsyncMap")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l;return ze(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:return t=f.sent(),t.done?[2,{value:null,done:!0}]:(r=hn.tensor_util.getTensorsInContainer(t.value),[4,this.transform(t.value)]);case 2:a=f.sent(),i=hn.tensor_util.getTensorsInContainer(a);try{for(o=ru(r),s=o.next();!s.done;s=o.next())u=s.value,hn.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){c={error:h}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}return[2,{value:a,done:!1}]}})})},e}(Yn),tx=function(n){_t(e,n);function e(){var t=n.call(this)||this;return t.outputQueue=new JB,t.lastRead=Promise.resolve({value:null,done:!1}),t}return e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(r){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){switch(t.label){case 0:return this.outputQueue.length()!==0?[3,2]:[4,this.pump()];case 1:return t.sent()?[3,0]:[2,{value:null,done:!0}];case 2:return[2,{value:this.outputQueue.shift(),done:!1}]}})})},e}(Yn),P3e=function(n){_t(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.transform=r,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Flatmap")},e.prototype.pump=function(){return Le(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l;return ze(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:if(t=f.sent(),t.done)return[2,!1];r=hn.tensor_util.getTensorsInContainer(t.value),a=this.transform(t.value),i=hn.tensor_util.getTensorsInContainer(a),this.outputQueue.pushAll(a);try{for(o=ru(r),s=o.next();!s.done;s=o.next())u=s.value,hn.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){c={error:h}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}return[2,!0]}})})},e}(tx),eL=function(n){_t(e,n);function e(t,r){var a=n.call(this)||this;return a.baseErrorHandler=r,a.lastRead=null,a.iterator=null,a.moreIterators=t,a}return e.prototype.summary=function(){var t="TODO: fill in upstream of chained summaries";return"".concat(t," -> Chained")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return this.lastRead=this.readFromChain(this.lastRead),[2,this.lastRead]})})},e.prototype.readFromChain=function(t){return Le(this,void 0,void 0,function(){var r,a;return ze(this,function(i){switch(i.label){case 0:return[4,t];case 1:return i.sent(),this.iterator!=null?[3,3]:[4,this.moreIterators.next()];case 2:if(r=i.sent(),r.done)return[2,{value:null,done:!0}];this.iterator=r.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler)),i.label=3;case 3:return[4,this.iterator.next()];case 4:return a=i.sent(),a.done?(this.iterator=null,[2,this.readFromChain(t)]):[2,a]}})})},e}(Yn),Yo;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(Yo||(Yo={}));var M3e=function(n){_t(e,n);function e(t,r){r===void 0&&(r=Yo.FAIL);var a=n.call(this)||this;return a.iterators=t,a.mismatchMode=r,a.count=0,a.currentPromise=null,a}return e.prototype.summary=function(){var t="TODO: fill in upstream of zip summaries";return"{".concat(t,"} -> Zip")},e.prototype.nextState=function(t){return Le(this,void 0,void 0,function(){function r(s){if(s instanceof Yn){var u=s.next();return{value:u.then(function(c){return a++,c.done&&i++,c.value}),recurse:!1}}else return{value:null,recurse:!0}}var a,i,o;return ze(this,function(s){switch(s.label){case 0:return[4,t];case 1:return s.sent(),a=0,i=0,[4,YB(this.iterators,r)];case 2:if(o=s.sent(),a===i)return[2,{value:null,done:!0}];if(i>0)switch(this.mismatchMode){case Yo.FAIL:throw new Error("Zipped streams should have the same length. "+"Mismatched at element ".concat(this.count,"."));case Yo.SHORTEST:return[2,{value:null,done:!0}];case Yo.LONGEST:}return this.count++,[2,{value:o,done:!1}]}})})},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return this.currentPromise=this.nextState(this.currentPromise),[2,this.currentPromise]})})},e}(Yn),tL=function(n){_t(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.bufferSize=r,a.buffer=new ZB(r),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Prefetch")},e.prototype.refill=function(){for(;!this.buffer.isFull();){var t=this.upstream.next();this.buffer.push(t)}},e.prototype.next=function(){return this.refill(),this.buffer.shift()},e}(Yn),B3e=function(n){_t(e,n);function e(t,r,a){var i=n.call(this,t,r)||this;return i.upstream=t,i.windowSize=r,i.upstreamExhausted=!1,i.random=KB.alea(a||hn.util.now().toString()),i.lastRead=Promise.resolve({value:null,done:!1}),i}return e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(r){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.randomInt=function(t){return Math.floor(this.random()*t)},e.prototype.chooseIndex=function(){return this.randomInt(this.buffer.length())},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t,r;return ze(this,function(a){switch(a.label){case 0:this.upstreamExhausted||this.refill(),a.label=1;case 1:return this.buffer.isEmpty()?[3,3]:(t=this.chooseIndex(),[4,this.buffer.shuffleExcise(t)]);case 2:if(r=a.sent(),r.done)this.upstreamExhausted=!0;else return this.refill(),[2,r];return[3,1];case 3:return[2,{value:null,done:!0}]}})})},e}(tL),Fc=function(){function n(){this.size=null}return n.prototype.batch=function(e,t){var r=this;t===void 0&&(t=!0);var a=this;hn.util.assert(e>0,function(){return`batchSize needs to be positive, but it is
      `.concat(e)});var i;return this.size===1/0||this.size==null?i=this.size:t?i=Math.ceil(this.size/e):i=Math.floor(this.size/e),ta(function(){return Le(r,void 0,void 0,function(){return ze(this,function(o){switch(o.label){case 0:return[4,a.iterator()];case 1:return[2,o.sent().columnMajorBatch(e,t,$3e)]}})})},i)},n.prototype.concatenate=function(e){var t=this,r=this,a;return this.size===1/0||e.size===1/0?a=1/0:this.size!=null&&e.size!=null?a=this.size+e.size:a=null,ta(function(){return Le(t,void 0,void 0,function(){var i,o;return ze(this,function(s){switch(s.label){case 0:return[4,r.iterator()];case 1:return o=(i=s.sent()).concatenate,[4,e.iterator()];case 2:return[2,o.apply(i,[s.sent()])]}})})},a)},n.prototype.filter=function(e){var t=this,r=this,a;return this.size===1/0?a=1/0:a=null,ta(function(){return Le(t,void 0,void 0,function(){return ze(this,function(i){switch(i.label){case 0:return[4,r.iterator()];case 1:return[2,i.sent().filter(function(o){return hn.tidy(function(){return e(o)})})]}})})},a)},n.prototype.forEachAsync=function(e){return Le(this,void 0,void 0,function(){return ze(this,function(t){switch(t.label){case 0:return[4,this.iterator()];case 1:return[2,t.sent().forEachAsync(e)]}})})},n.prototype.map=function(e){var t=this,r=this;return ta(function(){return Le(t,void 0,void 0,function(){return ze(this,function(a){switch(a.label){case 0:return[4,r.iterator()];case 1:return[2,a.sent().map(function(i){return hn.tidy(function(){return e(i)})})]}})})},this.size)},n.prototype.mapAsync=function(e){var t=this,r=this;return ta(function(){return Le(t,void 0,void 0,function(){return ze(this,function(a){switch(a.label){case 0:return[4,r.iterator()];case 1:return[2,a.sent().mapAsync(e)]}})})},this.size)},n.prototype.prefetch=function(e){var t=this;if(e==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var r=this;return ta(function(){return Le(t,void 0,void 0,function(){return ze(this,function(a){switch(a.label){case 0:return[4,r.iterator()];case 1:return[2,a.sent().prefetch(e)]}})})},this.size)},n.prototype.repeat=function(e){var t=this,r=this,a;return this.size!=null&&e>0?a=this.size*e:e===0?a=0:this.size!=null&&(e===void 0||e<0)?a=1/0:a=null,ta(function(){return Le(t,void 0,void 0,function(){var i,o=this;return ze(this,function(s){return i=ex(function(){return Le(o,void 0,void 0,function(){var u;return ze(this,function(c){switch(c.label){case 0:return u={},[4,r.iterator()];case 1:return[2,(u.value=c.sent(),u.done=!1,u)]}})})}),[2,N3e(i.take(e))]})})},a)},n.prototype.skip=function(e){var t=this,r=this,a;return this.size!=null&&e>=0&&this.size>=e?a=this.size-e:this.size!=null&&(this.size<e||e===void 0||e<0)?a=0:a=null,ta(function(){return Le(t,void 0,void 0,function(){return ze(this,function(i){switch(i.label){case 0:return[4,r.iterator()];case 1:return[2,i.sent().skip(e)]}})})},a)},n.prototype.shuffle=function(e,t,r){var a=this;if(r===void 0&&(r=!0),e==null||e<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting "+"bufferSize to the dataset size (".concat(this.size," elements)"));var i=this,o=KB.alea(t||hn.util.now().toString());return ta(function(){return Le(a,void 0,void 0,function(){var s;return ze(this,function(u){switch(u.label){case 0:return s=o.int32(),r&&(s+=o.int32()),[4,i.iterator()];case 1:return[2,u.sent().shuffle(e,s.toString())]}})})},this.size)},n.prototype.take=function(e){var t=this,r=this,a;return this.size!=null&&this.size>e?a=e:this.size!=null&&this.size<=e?a=this.size:a=null,ta(function(){return Le(t,void 0,void 0,function(){return ze(this,function(i){switch(i.label){case 0:return[4,r.iterator()];case 1:return[2,i.sent().take(e)]}})})},a)},n.prototype.toArray=function(){return Le(this,void 0,void 0,function(){return ze(this,function(e){switch(e.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,e.sent().toArray()]}})})},n.prototype.toArrayForTest=function(){return Le(this,void 0,void 0,function(){return ze(this,function(e){switch(e.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,e.sent().toArrayForTest()]}})})},n}();Fc.MAX_BUFFER_SIZE=1e4;function ta(n,e){return e===void 0&&(e=null),new(function(t){_t(r,t);function r(){var a=t.apply(this,s3e([],o3e(arguments),!1))||this;return a.size=e,a}return r.prototype.iterator=function(){return Le(this,void 0,void 0,function(){return ze(this,function(a){return[2,n()]})})},r}(Fc))}function L3e(n){var e=this;return ta(function(){return Le(e,void 0,void 0,function(){return ze(this,function(t){return[2,QB(n)]})})},n.length)}function z3e(n){var e=this;if(!_c(n))throw new Error("The argument to zip() must be an object or array.");var t;if(Array.isArray(n))for(var r=0;r<n.length;r++)t=t==null?n[r].size:Math.min(t,n[r].size);else if(n instanceof Object)for(var a in n)t=t==null?n[a].size:Math.min(t,n[a].size);return ta(function(){return Le(e,void 0,void 0,function(){var i;return ze(this,function(o){switch(o.label){case 0:return[4,YB(n,function(s){if(s instanceof Fc)return{value:s.iterator(),recurse:!1};if(_c(s))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")})];case 1:return i=o.sent(),[2,T3e(i,Yo.SHORTEST)]}})})},t)}function $3e(n){if(n===null)return null;var e=n[0];if(w3e(e)){var t=q3e(n);return{value:t,recurse:!1}}return{value:null,recurse:!0}}function q3e(n){if(n.length===0)throw new Error("Can't make a batch of zero elements.");return n[0]instanceof hn.Tensor?hn.stack(n):hn.tensor(n)}var nL=function(n){_t(e,n);function e(t){var r=n.call(this)||this;return r.input=t,r}return e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){var t,r,a;return ze(this,function(i){switch(i.label){case 0:return[4,this.input.iterator()];case 1:return t=i.sent(),r=t.decodeUTF8(),a=r.split(`
`).map(function(o){return o.endsWith("\r")&&(o=o.slice(0,-1)),o}),[2,a]}})})},e}(Fc),qv='"',th=Symbol("out"),UB=Symbol("field"),Wv=Symbol("quote"),Jw=Symbol("quoteafterquote"),HB=Symbol("quoteinquote"),rL=function(n){_t(e,n);function e(t,r){var a=n.call(this)||this;return a.input=t,a.hasHeader=!0,a.fullColumnNames=null,a.columnNamesValidated=!1,a.columnConfigs=null,a.configuredColumnsOnly=!1,a.delimiter=",",a.delimWhitespace=!1,a.base=new nL(t),r||(r={}),a.hasHeader=r.hasHeader!==!1,a.fullColumnNames=r.columnNames,a.columnConfigs=r.columnConfigs,a.configuredColumnsOnly=r.configuredColumnsOnly,r.delimWhitespace?(wn.util.assert(r.delimiter==null,function(){return"Delimiter should not be provided when delimWhitespace is true."}),a.delimWhitespace=!0,a.delimiter=" "):a.delimiter=r.delimiter?r.delimiter:",",a}return e.prototype.columnNames=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){switch(t.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:t.sent(),t.label=2;case 2:return[2,this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames]}})})},e.prototype.setColumnNames=function(){return Le(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f=this;return ze(this,function(h){switch(h.label){case 0:return[4,this.maybeReadHeaderLine()];case 1:if(t=h.sent(),!this.fullColumnNames&&!t)throw new Error("Column names must be provided if there is no header line.");if(this.fullColumnNames&&t&&wn.util.assert(t.length===this.fullColumnNames.length,function(){return"The length of provided columnNames ("+f.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+")."}),this.fullColumnNames||(this.fullColumnNames=t),r=this.fullColumnNames.reduce(function(d,p){return d[p]=d[p]+1||1,d},{}),a=Object.keys(r).filter(function(d){return r[d]>1}),wn.util.assert(a.length===0,function(){return"Duplicate column names found: "+a.toString()}),this.columnConfigs)try{for(i=ru(Object.keys(this.columnConfigs)),o=i.next();!o.done;o=i.next())if(s=o.value,u=this.fullColumnNames.indexOf(s),u===-1)throw new Error('The key "'+s+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}catch(d){c={error:d}}finally{try{o&&!o.done&&(l=i.return)&&l.call(i)}finally{if(c)throw c.error}}return this.columnNamesValidated=!0,[2]}})})},e.prototype.maybeReadHeaderLine=function(){return Le(this,void 0,void 0,function(){var t,r,a,i;return ze(this,function(o){switch(o.label){case 0:return this.hasHeader?[4,this.base.iterator()]:[3,3];case 1:return t=o.sent(),[4,t.next()];case 2:if(r=o.sent(),r.done)throw new Error("No data was found for CSV parsing.");return a=r.value,i=this.parseRow(a,!1),[2,i];case 3:return[2,null]}})})},e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){var t,r=this;return ze(this,function(a){switch(a.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:a.sent(),a.label=2;case 2:return[4,this.base.iterator()];case 3:return t=a.sent(),this.hasHeader&&(t=t.skip(1)),[2,t.map(function(i){return r.makeDataElement(i)})]}})})},e.prototype.makeDataElement=function(t){for(var r=this.parseRow(t),a={},i={},o=0;o<this.fullColumnNames.length;o++){var s=this.fullColumnNames[o],u=this.columnConfigs?this.columnConfigs[s]:null;if(!(this.configuredColumnsOnly&&!u)){var c=r[o],l=null;if(c==="")if(u&&u.default!==void 0)l=u.default;else{if(u&&(u.required||u.isLabel))throw new Error("Required column ".concat(s," is empty in this line: ").concat(t));l=void 0}else{var f=Number(c);if(isNaN(f))u&&u.dtype==="bool"?l=this.getBoolean(c):l=c;else if(!u||!u.dtype)l=f;else switch(u.dtype){case"float32":l=f;break;case"int32":l=Math.floor(f);break;case"bool":l=this.getBoolean(c);break;default:l=f}}u&&u.isLabel?i[s]=l:a[s]=l}}return Object.keys(i).length===0?a:{xs:a,ys:i}},e.prototype.getBoolean=function(t){return t==="1"||t.toLowerCase()==="true"?1:0},e.prototype.parseRow=function(t,r){r===void 0&&(r=!0);for(var a=[],i=0,o=t.length,s=th,u=0;u<o;u++)switch(s){case th:switch(t.charAt(u)){case qv:i=u+1,s=Wv;break;case this.delimiter:if(i=u+1,this.delimiter===" "&&this.delimWhitespace)break;a.push(""),s=th;break;default:s=UB,i=u;break}break;case UB:switch(t.charAt(u)){case this.delimiter:a.push(t.substring(i,u)),s=th,i=u+1;break}break;case Wv:switch(t.charAt(u)){case qv:s=Jw;break}break;case Jw:switch(t.charAt(u)){case this.delimiter:a.push(t.substring(i,u-1)),s=th,i=u+1;break;case qv:s=Wv;break;default:s=HB;break}break;case HB:switch(t.charAt(u)){case qv:s=Wv;break}break}if(s===Jw?a.push(t.substring(i,o-1)):a.push(t.substring(i)),r&&a.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have ".concat(this.fullColumnNames.length," elements in a row, but got ").concat(a));return a},e}(Fc),W3e=function(n){_t(e,n);function e(t){var r=n.call(this)||this;r.microphoneConfig=t,r.isClosed=!1,r.fftSize=t.fftSize||1024;var a=Math.log2(r.fftSize);if(r.fftSize<0||a<4||a>14||!Number.isInteger(a))throw new Error("Invalid fftSize: it must be a power of 2 between "+"2 to 4 and 2 to 14, but got ".concat(r.fftSize));if(r.numFrames=t.numFramesPerSpectrogram||43,r.sampleRateHz=t.sampleRateHz,r.columnTruncateLength=t.columnTruncateLength||r.fftSize,r.audioTrackConstraints=t.audioTrackConstraints,r.smoothingTimeConstant=t.smoothingTimeConstant||0,r.includeSpectrogram=t.includeSpectrogram!==!1,r.includeWaveform=t.includeWaveform===!0,!r.includeSpectrogram&&!r.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return r}return e.prototype.summary=function(){return"microphone"},e.create=function(t){return t===void 0&&(t={}),Le(this,void 0,void 0,function(){var r;return ze(this,function(a){switch(a.label){case 0:if(!wn.env().get("IS_BROWSER"))throw new Error("microphone API is only supported in browser environment.");return r=new e(t),[4,r.start()];case 1:return a.sent(),[2,r]}})})},e.prototype.start=function(){return Le(this,void 0,void 0,function(){var t,r,a,i;return ze(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),t=this,[4,navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null?!0:this.audioTrackConstraints,video:!1})];case 1:return t.stream=o.sent(),[3,3];case 2:throw r=o.sent(),new Error("Error thrown while initializing video stream: ".concat(r.message));case 3:if(!this.stream)throw new Error("Could not obtain audio from microphone.");if(a=window.AudioContext||window.webkitAudioContext,this.audioContext=new a,!this.sampleRateHz)this.sampleRateHz=this.audioContext.sampleRate;else if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error("Mismatch in sampling rate: "+"Expected: ".concat(this.sampleRateHz,"; ")+"Actual: ".concat(this.audioContext.sampleRate));return i=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.fftSize*2,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,i.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize),[2]}})})},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,r,a,i,o;return ze(this,function(s){switch(s.label){case 0:return this.isClosed?[2,{value:null,done:!0}]:[4,this.getAudioData()];case 1:return a=s.sent(),this.includeSpectrogram&&(i=this.flattenQueue(a.freqDataQueue),t=this.getTensorFromAudioDataArray(i,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(o=this.flattenQueue(a.timeDataQueue),r=this.getTensorFromAudioDataArray(o,[this.numFrames*this.fftSize,1])),[2,{value:{spectrogram:t,waveform:r},done:!1}]}})})},e.prototype.capture=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:return[2,t.sent().value]}})})},e.prototype.getAudioData=function(){return Le(this,void 0,void 0,function(){var t,r,a,i=this;return ze(this,function(o){return t=[],r=[],a=0,[2,new Promise(function(s){var u=setInterval(function(){i.includeSpectrogram&&(i.analyser.getFloatFrequencyData(i.freqData),i.freqData[0]===-1/0&&s({freqDataQueue:t,timeDataQueue:r}),t.push(i.freqData.slice(0,i.columnTruncateLength))),i.includeWaveform&&(i.analyser.getFloatTimeDomainData(i.timeData),r.push(i.timeData.slice())),++a===i.numFrames&&(clearInterval(u),s({freqDataQueue:t,timeDataQueue:r}))},i.fftSize/i.sampleRateHz*1e3)})]})})},e.prototype.stop=function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())},e.prototype.toArray=function(){throw new Error("Can not convert infinite audio stream to array.")},e.prototype.getSampleRate=function(){return this.sampleRateHz},e.prototype.flattenQueue=function(t){var r=t[0].length,a=new Float32Array(t.length*r);return t.forEach(function(i,o){return a.set(i,o*r)}),a},e.prototype.getTensorFromAudioDataArray=function(t,r){var a=new Float32Array(wn.util.sizeFromShape(r));return a.set(t,a.length-t.length),wn.tensor(a,r)},e}(Yn),V3e=function(n){_t(e,n);function e(t,r){var a=n.call(this)||this;if(a.webcamVideoElement=t,a.webcamConfig=r,a.isClosed=!0,a.resize=!1,a.needToResize())if(a.resize=!0,a.cropSize=[a.webcamConfig.resizeHeight,a.webcamConfig.resizeWidth],a.cropBoxInd=wn.tensor1d([0],"int32"),a.webcamConfig.centerCrop){var i=a.webcamConfig.resizeWidth*1/a.webcamVideoElement.width,o=a.webcamConfig.resizeHeight*1/a.webcamVideoElement.height,s=(1-i)/2,u=(1-o)/2,c=s+i,l=o+u;a.cropBox=wn.tensor2d([u,s,l,c],[1,4])}else a.cropBox=wn.tensor2d([0,0,1,1],[1,4]);return a}return e.prototype.summary=function(){return"webcam"},e.create=function(t,r){return r===void 0&&(r={}),Le(this,void 0,void 0,function(){var a;return ze(this,function(i){switch(i.label){case 0:if(!wn.env().get("IS_BROWSER"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!t){if(t=document.createElement("video"),!r.resizeWidth||!r.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");t.width=r.resizeWidth,t.height=r.resizeHeight}return a=new e(t,r),[4,a.start()];case 1:return i.sent(),[2,a]}})})},e.prototype.start=function(){return Le(this,void 0,void 0,function(){var t,r,a=this;return ze(this,function(i){switch(i.label){case 0:this.webcamConfig.facingMode&&wn.util.assert(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",function(){return"Invalid webcam facing mode: ".concat(a.webcamConfig.facingMode,". ")+"Please provide 'user' or 'environment'"}),i.label=1;case 1:return i.trys.push([1,3,,4]),t=this,[4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})];case 2:return t.stream=i.sent(),[3,4];case 3:throw r=i.sent(),r.message="Error thrown while initializing video stream: ".concat(r.message),r;case 4:if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(o){console.log(o),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,[2,new Promise(function(o){a.webcamVideoElement.onloadedmetadata=function(){o()}})]}})})},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(r){if(this.isClosed)return[2,{value:null,done:!0}];try{t=wn.browser.fromPixels(this.webcamVideoElement)}catch(a){throw new Error("Error thrown converting video to pixels: ".concat(JSON.stringify(a)))}if(this.resize)try{return[2,{value:this.cropAndResizeFrame(t),done:!1}]}catch(a){throw new Error("Error thrown cropping the video: ".concat(a.message))}finally{t.dispose()}else return[2,{value:t,done:!1}];return[2]})})},e.prototype.needToResize=function(){return!!(this.webcamConfig.resizeWidth&&this.webcamConfig.resizeHeight&&(this.webcamVideoElement.width!==this.webcamConfig.resizeWidth||this.webcamVideoElement.height!==this.webcamConfig.resizeHeight))},e.prototype.cropAndResizeFrame=function(t){var r=this;return wn.tidy(function(){var a=wn.expandDims(wn.cast(t,"float32"),0),i;i=wn.image.cropAndResize(a,r.cropBox,r.cropBoxInd,r.cropSize,"bilinear");var o=i.shape;return wn.reshape(i,o.slice(1))})},e.prototype.capture=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:return[2,t.sent().value]}})})},e.prototype.stop=function(){var t=this.stream.getTracks();t.forEach(function(r){return r.stop()});try{this.webcamVideoElement.srcObject=null}catch(r){console.log(r),this.webcamVideoElement.src=null}this.isClosed=!0},e.prototype.toArray=function(){throw new Error("Can not convert infinite video stream to array.")},e}(Yn);var aL=function(){function n(){}return n}(),iL=function(n){_t(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.split=function(t){return new G3e(this,t)},e}(Yn),G3e=function(n){_t(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.impl=new U3e(t,r),a}return e.prototype.summary=function(){return this.impl.summary()},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,this.impl.next()]})})},e}(iL),U3e=function(n){_t(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.separator=r,a.carryover="",a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Split('").concat(this.separator,"')")},e.prototype.pump=function(){return Le(this,void 0,void 0,function(){var t,r,a,i,o,s,u;return ze(this,function(c){switch(c.label){case 0:return[4,this.upstream.next()];case 1:if(t=c.sent(),t.done)return this.carryover===""?[2,!1]:(this.outputQueue.push(this.carryover),this.carryover="",[2,!0]);r=t.value.split(this.separator),r[0]=this.carryover+r[0];try{for(a=ru(r.slice(0,-1)),i=a.next();!i.done;i=a.next())o=i.value,this.outputQueue.push(o)}catch(l){s={error:l}}finally{try{i&&!i.done&&(u=a.return)&&u.call(a)}finally{if(s)throw s.error}}return this.carryover=r[r.length-1],[2,!0]}})})},e}(tx),H3e=function(n){_t(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.decodeUTF8=function(){return new K3e(this)},e}(Yn),K3e=function(n){_t(e,n);function e(t){var r=n.call(this)||this;return r.upstream=t,r.impl=new j3e(t),r}return e.prototype.summary=function(){return this.impl.summary()},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,this.impl.next()]})})},e}(iL),j3e=function(n){_t(e,n);function e(t){var r=n.call(this)||this;if(r.upstream=t,wn.env().get("IS_BROWSER"))r.decoder=new TextDecoder("utf-8");else{var a=Zw().StringDecoder;r.decoder=new a("utf8")}return r}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Utf8")},e.prototype.pump=function(){return Le(this,void 0,void 0,function(){var t,r,a;return ze(this,function(i){switch(i.label){case 0:return[4,this.upstream.next()];case 1:return t=i.sent(),t.done?[2,!1]:(r=t.value,wn.env().get("IS_BROWSER")?a=this.decoder.decode(r,{stream:!0}):a=this.decoder.write(Buffer.from(r.buffer)),this.outputQueue.push(a),[2,!0])}})})},e}(tx),oL=function(n){_t(e,n);function e(t,r){r===void 0&&(r={});var a=n.call(this)||this;return a.file=t,a.options=r,wn.util.assert(t instanceof Uint8Array||(wn.env().get("IS_BROWSER")?t instanceof File||t instanceof Blob:!1),function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."}),a.offset=r.offset||0,a.chunkSize=r.chunkSize||1024*1024,a}return e.prototype.summary=function(){return"FileChunks ".concat(this.file)},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,r,a=this;return ze(this,function(i){switch(i.label){case 0:return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?[2,{value:null,done:!0}]:(t=new Promise(function(o,s){var u=a.offset+a.chunkSize;if(a.file instanceof Uint8Array)o(new Uint8Array(a.file.slice(a.offset,u)));else{var c=new FileReader;c.onload=function(f){var h=c.result;if(h instanceof ArrayBuffer&&(h=new Uint8Array(h)),!(h instanceof Uint8Array))return s(new TypeError("FileReader returned unknown type."));o(h)},c.onabort=function(f){return s(new Error("Aborted"))},c.onerror=function(f){return s(new Error(f.type))};var l=a.file.slice(a.offset,u);c.readAsArrayBuffer(l)}a.offset=u}),r={},[4,t]);case 1:return[2,(r.value=i.sent(),r.done=!1,r)]}})})},e}(H3e);function X3e(n,e,t){return e===void 0&&(e={}),Le(this,void 0,void 0,function(){var r,a,i,o,s;return ze(this,function(u){switch(u.label){case 0:return typeof n=="string"?r=n:(r=n.url,a=Y3e(n)),[4,(t||wn.util.fetch)(r,a)];case 1:return i=u.sent(),i.ok?(s=Uint8Array.bind,[4,i.arrayBuffer()]):[3,3];case 2:return o=new(s.apply(Uint8Array,[void 0,u.sent()])),[2,new oL(o,e)];case 3:throw new Error(i.statusText)}})})}var Y3e=function(n){var e={method:n.method,headers:n.headers,body:n.body,mode:n.mode,credentials:n.credentials,cache:n.cache,redirect:n.redirect,referrer:n.referrer,integrity:n.integrity};return e};function sL(n){return typeof n=="string"&&n.slice(0,7)==="file://"}var uL=function(n){_t(e,n);function e(t,r){r===void 0&&(r={});var a=n.call(this)||this;return a.input=t,a.options=r,a}return e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(r){return sL(this.input)&&wn.env().get("IS_NODE")&&(t=VB(),this.input=t.readFileSync(this.input.slice(7))),[2,new oL(this.input,this.options)]})})},e}(aL),cL=function(n){_t(e,n);function e(t,r){r===void 0&&(r={});var a=n.call(this)||this;return a.url=t,a.fileOptions=r,a}return e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return sL(this.url)?[2,new uL(this.url,this.fileOptions).iterator()]:[2,X3e(this.url,this.fileOptions)]})})},e}(aL);function Z3e(n,e){return e===void 0&&(e={}),new rL(new cL(n),e)}function J3e(n){var e=this,t=ex(n);return ta(function(){return Le(e,void 0,void 0,function(){return ze(this,function(r){return[2,t]})})})}function Q3e(n){var e=this;return ta(function(){return Le(e,void 0,void 0,function(){var t;return ze(this,function(r){switch(r.label){case 0:return[4,n()];case 1:return t=r.sent(),[2,ex(function(){return t.next()})]}})})})}function eFe(n,e){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,V3e.create(n,e)]})})}function tFe(n){return Le(this,void 0,void 0,function(){return ze(this,function(e){return[2,W3e.create(n)]})})}var nFe="4.2.0";Rr.CSVDataset=rL;Rr.Dataset=Fc;Rr.FileDataSource=uL;Rr.TextLineDataset=nL;Rr.URLDataSource=cL;Rr.array=L3e;Rr.csv=Z3e;Rr.func=J3e;Rr.generator=Q3e;Rr.microphone=tFe;Rr.version_data=nFe;Rr.webcam=eFe;Rr.zip=z3e});var hL=Y((fL,nx)=>{(function(n,e,t){function r(s){var u=this,c=o();u.next=function(){var l=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=l-(u.c=l|0)},u.c=1,u.s0=c(" "),u.s1=c(" "),u.s2=c(" "),u.s0-=c(s),u.s0<0&&(u.s0+=1),u.s1-=c(s),u.s1<0&&(u.s1+=1),u.s2-=c(s),u.s2<0&&(u.s2+=1),c=null}function a(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function i(s,u){var c=new r(s),l=u&&u.state,f=c.next;return f.int32=function(){return c.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,l&&(typeof l=="object"&&a(l,c),f.state=function(){return a(c,{})}),f}function o(){var s=4022871197,u=function(c){c=String(c);for(var l=0;l<c.length;l++){s+=c.charCodeAt(l);var f=.02519603282416938*s;s=f>>>0,f-=s,f*=s,s=f>>>0,f-=s,s+=f*4294967296}return(s>>>0)*23283064365386963e-26};return u}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.alea=i})(fL,typeof nx=="object"&&nx,typeof define=="function"&&define)});var pL=Y((dL,rx)=>{(function(n,e,t){function r(o){var s=this,u="";s.x=0,s.y=0,s.z=0,s.w=0,s.next=function(){var l=s.x^s.x<<11;return s.x=s.y,s.y=s.z,s.z=s.w,s.w^=s.w>>>19^l^l>>>8},o===(o|0)?s.x=o:u+=o;for(var c=0;c<u.length+64;c++)s.x^=u.charCodeAt(c)|0,s.next()}function a(o,s){return s.x=o.x,s.y=o.y,s.z=o.z,s.w=o.w,s}function i(o,s){var u=new r(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,d=(f+h)/(1<<21);while(d===0);return d},l.int32=u.next,l.quick=l,c&&(typeof c=="object"&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xor128=i})(dL,typeof rx=="object"&&rx,typeof define=="function"&&define)});var mL=Y((vL,ax)=>{(function(n,e,t){function r(o){var s=this,u="";s.next=function(){var l=s.x^s.x>>>2;return s.x=s.y,s.y=s.z,s.z=s.w,s.w=s.v,(s.d=s.d+362437|0)+(s.v=s.v^s.v<<4^(l^l<<1))|0},s.x=0,s.y=0,s.z=0,s.w=0,s.v=0,o===(o|0)?s.x=o:u+=o;for(var c=0;c<u.length+64;c++)s.x^=u.charCodeAt(c)|0,c==u.length&&(s.d=s.x<<10^s.x>>>4),s.next()}function a(o,s){return s.x=o.x,s.y=o.y,s.z=o.z,s.w=o.w,s.v=o.v,s.d=o.d,s}function i(o,s){var u=new r(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,d=(f+h)/(1<<21);while(d===0);return d},l.int32=u.next,l.quick=l,c&&(typeof c=="object"&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xorwow=i})(vL,typeof ax=="object"&&ax,typeof define=="function"&&define)});var yL=Y((gL,ix)=>{(function(n,e,t){function r(o){var s=this;s.next=function(){var c=s.x,l=s.i,f,h,d;return f=c[l],f^=f>>>7,h=f^f<<24,f=c[l+1&7],h^=f^f>>>10,f=c[l+3&7],h^=f^f>>>3,f=c[l+4&7],h^=f^f<<7,f=c[l+7&7],f=f^f<<13,h^=f^f<<9,c[l]=h,s.i=l+1&7,h};function u(c,l){var f,h,d=[];if(l===(l|0))h=d[0]=l;else for(l=""+l,f=0;f<l.length;++f)d[f&7]=d[f&7]<<15^l.charCodeAt(f)+d[f+1&7]<<13;for(;d.length<8;)d.push(0);for(f=0;f<8&&d[f]===0;++f);for(f==8?h=d[7]=-1:h=d[f],c.x=d,c.i=0,f=256;f>0;--f)c.next()}u(s,o)}function a(o,s){return s.x=o.x.slice(),s.i=o.i,s}function i(o,s){o==null&&(o=+new Date);var u=new r(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,d=(f+h)/(1<<21);while(d===0);return d},l.int32=u.next,l.quick=l,c&&(c.x&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xorshift7=i})(gL,typeof ix=="object"&&ix,typeof define=="function"&&define)});var wL=Y((bL,ox)=>{(function(n,e,t){function r(o){var s=this;s.next=function(){var c=s.w,l=s.X,f=s.i,h,d;return s.w=c=c+1640531527|0,d=l[f+34&127],h=l[f=f+1&127],d^=d<<13,h^=h<<17,d^=d>>>15,h^=h>>>12,d=l[f]=d^h,s.i=f,d+(c^c>>>16)|0};function u(c,l){var f,h,d,p,v,m=[],g=128;for(l===(l|0)?(h=l,l=null):(l=l+"\0",h=0,g=Math.max(g,l.length)),d=0,p=-32;p<g;++p)l&&(h^=l.charCodeAt((p+32)%l.length)),p===0&&(v=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,p>=0&&(v=v+1640531527|0,f=m[p&127]^=h+v,d=f==0?d+1:0);for(d>=128&&(m[(l&&l.length||0)&127]=-1),d=127,p=4*128;p>0;--p)h=m[d+34&127],f=m[d=d+1&127],h^=h<<13,f^=f<<17,h^=h>>>15,f^=f>>>12,m[d]=h^f;c.w=v,c.X=m,c.i=d}u(s,o)}function a(o,s){return s.i=o.i,s.w=o.w,s.X=o.X.slice(),s}function i(o,s){o==null&&(o=+new Date);var u=new r(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,d=(f+h)/(1<<21);while(d===0);return d},l.int32=u.next,l.quick=l,c&&(c.X&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xor4096=i})(bL,typeof ox=="object"&&ox,typeof define=="function"&&define)});var kL=Y((xL,sx)=>{(function(n,e,t){function r(o){var s=this,u="";s.next=function(){var l=s.b,f=s.c,h=s.d,d=s.a;return l=l<<25^l>>>7^f,f=f-h|0,h=h<<24^h>>>8^d,d=d-l|0,s.b=l=l<<20^l>>>12^f,s.c=f=f-h|0,s.d=h<<16^f>>>16^d,s.a=d-l|0},s.a=0,s.b=0,s.c=-1640531527,s.d=1367130551,o===Math.floor(o)?(s.a=o/4294967296|0,s.b=o|0):u+=o;for(var c=0;c<u.length+20;c++)s.b^=u.charCodeAt(c)|0,s.next()}function a(o,s){return s.a=o.a,s.b=o.b,s.c=o.c,s.d=o.d,s}function i(o,s){var u=new r(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,d=(f+h)/(1<<21);while(d===0);return d},l.int32=u.next,l.quick=l,c&&(typeof c=="object"&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.tychei=i})(xL,typeof sx=="object"&&sx,typeof define=="function"&&define)});var NL=Y((SL,Gv)=>{(function(n,e,t){var r=256,a=6,i=52,o="random",s=t.pow(r,a),u=t.pow(2,i),c=u*2,l=r-1,f;function h(b,w,x){var N=[];w=w==!0?{entropy:!0}:w||{};var T=m(v(w.entropy?[b,y(e)]:b??g(),3),N),E=new d(N),C=function(){for(var F=E.g(a),_=s,O=0;F<u;)F=(F+O)*r,_*=r,O=E.g(1);for(;F>=c;)F/=2,_/=2,O>>>=1;return(F+O)/_};return C.int32=function(){return E.g(4)|0},C.quick=function(){return E.g(4)/4294967296},C.double=C,m(y(E.S),e),(w.pass||x||function(F,_,O,L){return L&&(L.S&&p(L,E),F.state=function(){return p(E,{})}),O?(t[o]=F,_):F})(C,T,"global"in w?w.global:this==t,w.state)}function d(b){var w,x=b.length,N=this,T=0,E=N.i=N.j=0,C=N.S=[];for(x||(b=[x++]);T<r;)C[T]=T++;for(T=0;T<r;T++)C[T]=C[E=l&E+b[T%x]+(w=C[T])],C[E]=w;(N.g=function(F){for(var _,O=0,L=N.i,z=N.j,$=N.S;F--;)_=$[L=l&L+1],O=O*r+$[l&($[L]=$[z=l&z+_])+($[z]=_)];return N.i=L,N.j=z,O})(r)}function p(b,w){return w.i=b.i,w.j=b.j,w.S=b.S.slice(),w}function v(b,w){var x=[],N=typeof b,T;if(w&&N=="object")for(T in b)try{x.push(v(b[T],w-1))}catch{}return x.length?x:N=="string"?b:b+"\0"}function m(b,w){for(var x=b+"",N,T=0;T<x.length;)w[l&T]=l&(N^=w[l&T]*19)+x.charCodeAt(T++);return y(w)}function g(){try{var b;return f&&(b=f.randomBytes)?b=b(r):(b=new Uint8Array(r),(n.crypto||n.msCrypto).getRandomValues(b)),y(b)}catch{var w=n.navigator,x=w&&w.plugins;return[+new Date,n,x,n.screen,y(e)]}}function y(b){return String.fromCharCode.apply(0,b)}if(m(t.random(),e),typeof Gv=="object"&&Gv.exports){Gv.exports=h;try{f=Rd()}catch{}}else typeof define=="function"&&define.amd?define(function(){return h}):t["seed"+o]=h})(typeof self<"u"?self:SL,[],Math)});var EL=Y((eot,TL)=>{var rFe=hL(),aFe=pL(),iFe=mL(),oFe=yL(),sFe=wL(),uFe=kL(),su=NL();su.alea=rFe;su.xor128=aFe;su.xorwow=iFe;su.xorshift7=oFe;su.xor4096=sFe;su.tychei=uFe;TL.exports=su});var Gz=Y(oh=>{"use strict";Object.defineProperty(oh,"__esModule",{value:!0});var S=Cs(),cFe=EL();function lFe(n){if(n&&n.__esModule)return n;var e=Object.create(null);return n&&Object.keys(n).forEach(function(t){if(t!=="default"){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}}),e.default=n,e}var fFe=lFe(cFe),cx=function(n,e){return cx=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])},cx(n,e)};function hFe(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");cx(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function IL(n,e,t,r){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(r.next(l))}catch(f){o(f)}}function u(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((r=r.apply(n,e||[])).next())})}function CL(n,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(l){c=[6,l],a=0}finally{r=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Pc(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function We(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=r.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return i}function ya(n,e,t){if(t||arguments.length===2)for(var r=0,a=e.length,i;r<a;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}function Ge(n,e){Array.isArray(n)||(n=[n]),n.forEach(function(t){t!=null&&S.util.assert(t.dtype!=="complex64",function(){return"".concat(e," does not support complex64 tensors in the CPU backend.")})})}var dFe=S.kernel_impls.whereImpl,hx=function(n){hFe(e,n);function e(){var t=n.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new S.DataStorage(t,S.engine()),t}return e.prototype.nextDataId=function(){return e.nextDataId++},e.prototype.write=function(t,r,a){this.firstUse&&(this.firstUse=!1,S.env().get("IS_NODE")&&S.backend_util.warn(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));var i={id:this.nextDataId()};return this.data.set(i,{values:t,dtype:a,refCount:1}),i},e.prototype.makeTensorInfo=function(t,r,a){var i;if(r==="string"&&a!=null&&a.length>0&&S.util.isString(a[0])){var o=a.map(function(s){return S.util.encodeString(s)});i=this.write(o,t,r)}else i=this.write(a,t,r);return{dataId:i,shape:t,dtype:r}},e.prototype.refCount=function(t){if(this.data.has(t)){var r=this.data.get(t);return r.refCount}return 0},e.prototype.incRef=function(t){var r=this.data.get(t);r.refCount++},e.prototype.decRef=function(t){if(this.data.has(t)){var r=this.data.get(t);r.refCount--}},e.prototype.move=function(t,r,a,i,o){this.data.set(t,{values:r,dtype:i,refCount:o})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return IL(this,void 0,void 0,function(){return CL(this,function(r){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var r=this.data.get(t),a=r.dtype,i=r.complexTensorInfos;if(a==="complex64"){var o=this.readSync(i.real.dataId),s=this.readSync(i.imag.dataId);return S.backend_util.mergeRealAndImagArrays(o,s)}return S.util.convertBackendValuesAndArrayBuffer(this.data.get(t).values,a)},e.prototype.bufferSync=function(t){var r=this.readSync(t.dataId);if(t.dtype==="string")try{var a=r.map(function(i){return S.util.decodeString(i)});return S.buffer(t.shape,t.dtype,a)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return S.buffer(t.shape,t.dtype,r)},e.prototype.makeOutput=function(t,r,a){return S.engine().makeTensorFromTensorInfo(this.makeTensorInfo(r,a,t),this)},e.prototype.disposeData=function(t,r){if(r===void 0&&(r=!1),this.data.has(t)){if(this.data.get(t).refCount--,!r&&this.data.get(t).refCount>0)return!1;var a=this.data.get(t).complexTensorInfos;a!=null&&(this.disposeData(a.real.dataId,!0),this.disposeData(a.imag.dataId,!0)),this.data.delete(t)}return!0},e.prototype.disposeIntermediateTensorInfo=function(t){this.disposeData(t.dataId)},e.prototype.time=function(t){return IL(this,void 0,void 0,function(){var r,a;return CL(this,function(i){return r=S.util.now(),t(),a=S.util.now()-r,[2,{kernelMs:a}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.where=function(t){Ge([t],"where");var r=this.readSync(t.dataId);return dFe(t.shape,r)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return n.prototype.epsilon.call(this)},e}(S.KernelBackend);hx.nextDataId=0;function BL(n){for(var e=new Float32Array(n.length),t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}var pFe=function(n){var e=n.inputs.x,t=n.backend;Ge(e,"abs");var r=new Float32Array(S.util.sizeFromShape(e.shape)),a=t.data.get(e.dataId).values;return r=BL(a),t.makeOutput(r,e.shape,e.dtype)},vFe={kernelName:S.Abs,backendName:"cpu",kernelFunc:pFe};function zn(n){return function(e,t,r,a,i){var o=S.backend_util.assertAndGetBroadcastShape(e,t),s=o.length,u=S.util.computeStrides(o),c=S.util.sizeFromShape(o),l=S.util.getTypedArrayFromDType(i,c),f=e.length,h=t.length,d=S.util.computeStrides(e),p=S.util.computeStrides(t),v=S.backend_util.getBroadcastDims(e,o),m=S.backend_util.getBroadcastDims(t,o);if(v.length+m.length===0)for(var g=0;g<l.length;++g)l[g]=n(r[g%r.length],a[g%a.length]);else for(var y=function(b){var w=S.util.indexToLoc(b,s,u),x=w.slice(-f);v.forEach(function(C){return x[C]=0});var N=S.util.locToIndex(x,f,d),T=w.slice(-h);m.forEach(function(C){return T[C]=0});var E=S.util.locToIndex(T,h,p);l[b]=n(r[N],a[E])},g=0;g<l.length;++g)y(g);return[l,o]}}function na(n){var e=n.inputs,t=n.backend,r=e.real,a=e.imag,i=t.data.get(r.dataId).values,o=t.data.get(a.dataId).values,s=t.makeTensorInfo(r.shape,"complex64"),u=t.data.get(s.dataId);return u.complexTensorInfos={real:t.makeTensorInfo(r.shape,"float32",i),imag:t.makeTensorInfo(a.shape,"float32",o)},s}var mFe={kernelName:S.Complex,backendName:"cpu",kernelFunc:na};function Uv(n,e,t){if(t===void 0&&(t="float32"),t==="complex64"){var r=Uv(n,e,"float32"),a=Uv(n,e,"float32");return na({inputs:{real:r,imag:a},backend:n})}var i=S.util.makeZerosTypedArray(S.util.sizeFromShape(e),t);return n.makeTensorInfo(e,t,i)}function Pi(n){var e=n.inputs,t=n.backend,r=e.x;return t.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var gFe={kernelName:S.Identity,backendName:"cpu",kernelFunc:Pi};function uu(n){var e=n.inputs,t=n.backend,r=e.input,a=t.data.get(r.dataId).complexTensorInfos.real,i=t.data.get(a.dataId).values;return t.makeTensorInfo(a.shape,a.dtype,i)}var yFe={kernelName:S.Real,backendName:"cpu",kernelFunc:uu};function LL(n,e,t,r){if(r==="int32"){var a=Int32Array.from(n);return[e,"int32",a]}if(r==="bool"){var i=S.util.toTypedArray([0],t),o=We(zn(function(c,l){return c!==l?1:0})(e,[],n,i,"bool"),2),s=o[0],u=o[1];return[u,"bool",s]}throw new Error("Error in Cast: failed to cast ".concat(t," to ").concat(r))}function Zo(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.dtype;if(i==="complex64"){if(a.dtype==="complex64")return Pi({inputs:{x:a},backend:t});var o=Uv(t,a.shape,a.dtype),s=Zo({inputs:{x:a},backend:t,attrs:{dtype:"float32"}}),u=na({inputs:{real:s,imag:o},backend:t});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}if(a.dtype==="complex64"){var c=uu({inputs:{input:a},backend:t}),u=Zo({inputs:{x:c},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(c),u}if(!S.util.hasEncodingLoss(a.dtype,i)){var u=Pi({inputs:{x:a},backend:t});return{dataId:u.dataId,shape:u.shape,dtype:i}}var l=t.data.get(a.dataId).values,f=We(LL(l,a.shape,a.dtype,i),3),h=f[0],d=f[1],p=f[2];return t.makeTensorInfo(h,d,p)}var bFe={kernelName:S.Cast,backendName:"cpu",kernelFunc:Zo};function Zn(n,e,t,r){return t==null?function(a){var i=a.inputs,o=a.backend,s=i.a,u=i.b,c=o;Ge([s,u],n);var l=c.data.get(s.dataId).values,f=c.data.get(u.dataId).values,h=s.dtype==="string"?S.backend_util.fromUint8ToStringArray(l):l,d=s.dtype==="string"?S.backend_util.fromUint8ToStringArray(f):f,p=r||s.dtype,v=We(e(s.shape,u.shape,h,d,p),2),m=v[0],g=v[1];return c.makeTensorInfo(g,p,m)}:function(a){var i=a.inputs,o=a.backend,s=i.a,u=i.b,c=o;if(s.dtype==="complex64"||u.dtype==="complex64"){var l=Zo({inputs:{x:s},backend:c,attrs:{dtype:"complex64"}}),f=c.data.get(l.dataId),h=f.complexTensorInfos.real,d=f.complexTensorInfos.imag,p=c.data.get(h.dataId).values,v=c.data.get(d.dataId).values,m=Zo({inputs:{x:u},backend:c,attrs:{dtype:"complex64"}}),g=c.data.get(m.dataId),y=g.complexTensorInfos.real,b=g.complexTensorInfos.imag,w=c.data.get(y.dataId).values,x=c.data.get(b.dataId).values,N=We(t(s.shape,u.shape,p,v,w,x),3),T=N[0],E=N[1],C=N[2],F=c.makeTensorInfo(C,"float32",T),_=c.makeTensorInfo(C,"float32",E),O=na({inputs:{real:F,imag:_},backend:c});return c.disposeIntermediateTensorInfo(l),c.disposeIntermediateTensorInfo(m),c.disposeIntermediateTensorInfo(F),c.disposeIntermediateTensorInfo(_),O}else{var L=c.data.get(s.dataId).values,z=c.data.get(u.dataId).values,$=r||s.dtype,B=We(e(s.shape,u.shape,L,z,$),2),W=B[0],C=B[1];return c.makeTensorInfo(C,$,W)}}}function dx(n){return function(e,t,r,a,i,o){var s=S.backend_util.assertAndGetBroadcastShape(e,t),u=S.util.sizeFromShape(s),c=s.length,l=S.util.computeStrides(s),f=S.util.getTypedArrayFromDType("float32",u),h=S.util.getTypedArrayFromDType("float32",u),d=S.backend_util.getBroadcastDims(e,s),p=S.backend_util.getBroadcastDims(t,s),v=S.backend_util.mergeRealAndImagArrays(r,a),m=S.backend_util.mergeRealAndImagArrays(i,o),g=e.length,y=S.util.computeStrides(e),b=t.length,w=S.util.computeStrides(t);if(d.length+p.length===0)for(var x=0;x<f.length;x++){var N=x%v.length,T=x%m.length,E=n(v[N*2],v[N*2+1],m[T*2],m[T*2+1]);f[x]=E.real,h[x]=E.imag}else for(var C=function(F){var _=S.util.indexToLoc(F,c,l),O=_.slice(-g);d.forEach(function(W){return O[W]=0});var L=S.util.locToIndex(O,g,y),z=_.slice(-b);p.forEach(function(W){return z[W]=0});var $=S.util.locToIndex(z,b,w),B=n(v[L*2],v[L*2+1],m[$*2],m[$*2+1]);f[F]=B.real,h[F]=B.imag},x=0;x<f.length;x++)C(x);return[f,h,s]}}var zL=zn(function(n,e){return n+e}),wFe=dx(function(n,e,t,r){return{real:n+t,imag:e+r}}),Mc=Zn(S.Add,zL,wFe),xFe={kernelName:S.Add,backendName:"cpu",kernelFunc:Mc};function px(n,e,t,r,a){for(var i=S.util.sizeFromShape(r),o=S.util.makeZerosTypedArray(a,t),s=0;s<n.length;s++){var u=n[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(i>0?o[u]+=e[s]:o[u]+=1)}return o}function $L(n,e,t,r){r===void 0&&(r=!1);for(var a=n.shape[0],i=n.shape[1],o=S.buffer([a,t],e.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=n.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=t||(r?o.set(1,s,c):e.size>0?o.set(o.get(s,c)+e.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o}function Jo(n){return function(e,t,r){for(var a=S.util.getTypedArrayFromDType(t,e.length),i=0;i<e.length;++i)a[i]=n(e[i],r);return a}}function Mt(n,e,t){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(Ge(s,n),s.dtype==="string"||t==="string")throw new Error("unaryKernelFunc does not support string input/output");for(var u=o,c=u.data.get(s.dataId).values,l=S.util.sizeFromShape(s.shape),f=t||s.dtype,h=S.util.getArrayFromDType(f,l),d=0;d<l;++d)h[d]=e(c[d],i);return u.makeTensorInfo(s.shape,f,h)}}function zc(n,e,t){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(Ge(s,n),s.dtype==="string"||t==="string")throw new Error("unaryKernelFunc does not support string input/output");var u=o,c=u.data.get(s.dataId).values,l=t||s.dtype,f=e(c,l,i);return u.makeTensorInfo(s.shape,l,f)}}var qL=Jo(function(n){return Math.ceil(n)}),kFe=zc(S.Ceil,qL),SFe={kernelName:S.Ceil,backendName:"cpu",kernelFunc:kFe};function WL(n,e,t,r){var a=S.util.getArrayFromDType(t,S.util.sizeFromShape(e));if(r&&t!=="string"){var i=0;n.forEach(function(s){var u=S.util.sizeFromShape(s.shape);a.set(s.vals,i),i+=u})}else{var o=0;n.forEach(function(s){for(var u=t==="string"?S.backend_util.fromUint8ToStringArray(s.vals):s.vals,c=0,l=0;l<s.shape[0];++l)for(var f=l*e[1]+o,h=0;h<s.shape[1];++h)a[f+h]=u[c++];o+=s.shape[1]})}return a}var VL=zn(function(n,e){return n===e?1:0}),GL=Zn(S.Equal,VL,null,"bool"),NFe={kernelName:S.Equal,backendName:"cpu",kernelFunc:GL};var UL=Jo(function(n){return Math.exp(n)}),HL=zc(S.Exp,UL,"float32"),TFe={kernelName:S.Exp,backendName:"cpu",kernelFunc:HL};var KL=Jo(function(n){return Math.expm1(n)}),EFe=zc(S.Expm1,KL),IFe={kernelName:S.Expm1,backendName:"cpu",kernelFunc:EFe};var jL=Jo(function(n){return Math.floor(n)}),CFe=zc(S.Floor,jL),AFe={kernelName:S.Floor,backendName:"cpu",kernelFunc:CFe};function XL(n,e,t,r,a,i,o,s,u){for(var c=S.buffer([r,i],t),l=0;l<r;l++){for(var f=[],h=0,d=0;d<a;d++){var p=n[l*a+d];h+=p*o[d],f.push(p)}if(h<0||h>=u/i)throw new Error("Invalid indices: ".concat(f," does not index into ").concat(s));for(var v=0;v<i;v++)c.values[l*i+v]=e.get.apply(e,ya([],We(e.indexToLoc(h*i+v)),!1))}return c}function YL(n,e,t){for(var r=S.buffer(t,n.dtype),a=0;a<r.size;++a){var i=r.indexToLoc(a),o=i.slice(),s=o[0],u=o[2],c=e.locToIndex([s,u]);o[2]=e.values[c];var l=n.locToIndex(o);0<=l&&l<n.values.length&&(r.values[a]=n.values[l])}return r}var ZL=zn(function(n,e){return n>e?1:0}),DFe=Zn(S.Greater,ZL,null,"bool"),_Fe={kernelName:S.Greater,backendName:"cpu",kernelFunc:DFe};var JL=zn(function(n,e){return n>=e?1:0}),FFe=Zn(S.GreaterEqual,JL,null,"bool"),RFe={kernelName:S.GreaterEqual,backendName:"cpu",kernelFunc:FFe};var QL=zn(function(n,e){return n<e?1:0}),OFe=Zn(S.Less,QL,null,"bool"),PFe={kernelName:S.Less,backendName:"cpu",kernelFunc:OFe};var ez=zn(function(n,e){return n<=e?1:0}),MFe=Zn(S.LessEqual,ez,null,"bool"),BFe={kernelName:S.LessEqual,backendName:"cpu",kernelFunc:MFe};function tz(n,e,t){var r=(e-n)/(t-1),a=S.util.makeZerosTypedArray(t,"float32");a[0]=n;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return a}var nz=Jo(function(n){return Math.log(n)}),LFe=zc(S.Log,nz),zFe={kernelName:S.Log,backendName:"cpu",kernelFunc:LFe};function rz(n,e,t,r){for(var a=S.util.getTypedArrayFromDType(r,S.util.sizeFromShape(t)),i=0;i<a.length;++i){for(var o=i*e,s=n[o],u=0;u<e;++u){var c=n[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a}var az=zn(function(n,e){return Math.max(n,e)}),$Fe=Zn(S.Maximum,az),qFe={kernelName:S.Maximum,backendName:"cpu",kernelFunc:$Fe};var iz=zn(function(n,e){return Math.min(n,e)}),WFe=Zn(S.Minimum,iz),VFe={kernelName:S.Minimum,backendName:"cpu",kernelFunc:WFe};var vx=zn(function(n,e){return n*e}),GFe=dx(function(n,e,t,r){return{real:n*t-e*r,imag:n*r+e*t}}),Xv=Zn(S.Multiply,vx,GFe),UFe={kernelName:S.Multiply,backendName:"cpu",kernelFunc:Xv};function oz(n,e,t){var r=S.util.createScalarValue(-1,t);return vx([],e,r,n,t)}function HFe(n){var e=n.inputs,t=n.backend,r=e.x;Ge(r,"neg");var a=t.data.get(r.dataId).values,i=We(oz(a,r.shape,r.dtype),2),o=i[0],s=i[1];return t.makeTensorInfo(s,r.dtype,o)}var KFe={kernelName:S.Neg,backendName:"cpu",kernelFunc:HFe};var sz=zn(function(n,e){return n!==e?1:0}),jFe=Zn(S.NotEqual,sz,null,"bool"),XFe={kernelName:S.NotEqual,backendName:"cpu",kernelFunc:jFe};function mx(n,e,t,r,a){for(var i=e.length,o=S.util.sizeFromShape(e),s=S.util.computeStrides(e),u=S.util.computeStrides(a),c=S.util.getTypedArrayFromDType(t,S.util.sizeFromShape(a)),l=0;l<o;++l){for(var f=S.util.indexToLoc(l,i,s),h=new Array(f.length),d=0;d<h.length;d++)h[d]=f[r[d]];var p=S.util.locToIndex(h,i,u);c[p]=n[l]}return c}function Or(n){var e=n.inputs,t=n.attrs,r=n.backend,a=e.x,i=t.perm;Ge(a,"transpose");for(var o=a.shape.length,s=new Array(o),u=0;u<s.length;u++)s[u]=a.shape[i[u]];var c=r.data.get(a.dataId).values,l=mx(c,a.shape,a.dtype,i,s),f=r.write(l,s,a.dtype);return{dataId:f,shape:s,dtype:a.dtype}}var YFe={kernelName:S.Transpose,backendName:"cpu",kernelFunc:Or};function uz(n,e,t,r){for(var a=We(S.backend_util.computeOutAndReduceShapes(n,r),2),i=a[0],o=a[1],s=S.upcastType(e,"int32"),u=S.util.makeZerosTypedArray(S.util.sizeFromShape(i),s),c=S.util.sizeFromShape(o),l=0;l<u.length;++l){for(var f=l*c,h=1,d=0;d<c;++d)h*=t[f+d];u[l]=h}return{outVals:u,outShape:i,outDtype:s}}function ZFe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims;Ge(a,"prod");var s=a.shape.length,u=S.util.parseAxisParam(i,a.shape),c=S.backend_util.getAxesPermutation(u,s),l=u,f=a,h=[];c!=null&&(f=Or({inputs:{x:a},backend:t,attrs:{perm:c}}),h.push(f),l=S.backend_util.getInnerMostAxes(l.length,s));var d=t.data.get(f.dataId).values,p=uz(f.shape,f.dtype,d,l),v=p.outVals,m=p.outShape,g=p.outDtype,y=m;return o&&(y=S.backend_util.expandShapeToKeepDim(m,u)),h.forEach(function(b){return t.disposeIntermediateTensorInfo(b)}),t.makeTensorInfo(y,g,v)}var JFe={kernelName:S.Prod,backendName:"cpu",kernelFunc:ZFe};function QFe(n,e,t){n.forEach(function(r,a){if(r<0||r>=t){var i=S.util.indexToLoc(a,e.length,S.util.computeStrides(e)).join(",");throw new Error("indices[".concat(i,"] = ").concat(r," is not in [0, ").concat(t,")"))}})}function eRe(n,e){for(var t=0;t<n.length;++t){var r=n[t],a=t===n.length-1?e:n[t+1].length;if(r.length===0)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<r.length;++i)if(r[i-1]>r[i])throw new Error("Ragged splits must be sorted in ascending order")}}function tRe(n,e,t,r){var a=[],i=0,o=e.length-1+t.length,s=new Array(o).fill(null).map(function(){return[0]});eRe(t,r);for(var u=1,c=0;c<e.length-1;++c){u*=e[c];for(var l=e[c+1],f=1;f<u+1;++f)s[c].push(f*l)}for(var f=0;f<n.length;++f){for(var h=n[f],d=n[f]+1,c=0;c<t.length;++c){var p=t[c],v=c+e.length-1;if(v>=0)for(var m=s[v],g=m[m.length-1]-p[h],y=h;y<d;++y)s[v].push(p[y+1]+g);h=p[h],d=p[d]}d!==h&&(a.push([h,d]),i+=d-h)}return{outSplits:s,valueSlices:a,numValues:i}}function nRe(n){for(var e=[],t=function(a){var i=n[a].length,o=S.util.getArrayFromDType("int32",i);e.push(o),n[a].forEach(function(s,u){return o[u]=s})},r=0;r<n.length;++r)t(r);return e}function AL(n,e){for(var t=n.slice(0,e);t.length<e;)t.push(1);for(var r=e;r<n.length;r++)t[e-1]*=n[r];return t}function rRe(n,e,t,r,a,i){var o,s,u=AL(e,2)[1],c=AL(i,2)[1],l=0;try{for(var f=Pc(t),h=f.next();!h.done;h=f.next())for(var d=h.value,p=d[0];p<d[1];++p){for(var v=0;v<r;++v)a[l*c+v]=n[p*u+v];++l}}catch(m){o={error:m}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}}function aRe(n,e,t,r,a){var i=e.slice();i[0]=a;var o=S.util.getArrayFromDType(t,S.util.sizeFromShape(i)),s=n.length,u=s===0?0:s/e[0];return rRe(n,e,r,u,o,i),[o,i]}function cz(n,e,t,r,a,i,o,s){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");var u=e[0][0]-1;if(QFe(i,o,u),r.length===0)throw new Error("params.rank must be nonzero");var c=r[0],l=tRe(i,o,n,c),f=l.outSplits,h=l.valueSlices,d=l.numValues,p=nRe(f),v=aRe(t,r,a,h,d);return[p,v[0],v[1]]}var DL=2147483647;function lz(n,e,t,r,a,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");var s=e.length===0,u=a.length===0,c=o.length===0,l=[];s||l.push(e[0]),u||l.push(a[0]),c||l.push(o[0]);for(var f=1;f<l.length;++f)if(l[f]!==l[f-1])throw new Error("starts, limits, and deltas must have the same shape");var h=l.length===0?1:l[0],d=S.util.getArrayFromDType("int32",h+1);d[0]=0;for(var p=0;p<h;++p){var v=s?n[0]:n[p],m=u?r[0]:r[p],g=c?i[0]:i[p];if(g===0)throw new Error("Requires delta != 0");var y=void 0;if(g>0&&m<v||g<0&&m>v)y=0;else if(y=Math.ceil(Math.abs((m-v)/g)),y>DL)throw new Error("Requires ((limit - start) / delta) <= ".concat(DL));d[p+1]=d[p]+y}for(var b=d[h],w=S.util.getArrayFromDType(t,b),x=0,p=0;p<h;++p)for(var N=d[p+1]-d[p],T=s?n[0]:n[p],g=c?i[0]:i[p],f=0;f<N;++f)w[x++]=T,T+=g;return[d,w]}var Ha=S.backend_util.RowPartitionType,iRe=function(){function n(e,t,r,a,i,o,s,u,c,l){this.shape=e,this.shapeShape=t,this.values=r,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=S.backend_util.getRowPartitionTypesHelper(l),this.raggedRank=S.backend_util.getRaggedRank(this.rowPartitionTypes)}return n.prototype.getRowPartitionTypeByDimension=function(e){return this.rowPartitionTypes[0]===Ha.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]},n.prototype.getRowPartitionTensor=function(e){return this.rowPartitionTypes[0]===Ha.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]},n.prototype.getMaxWidth=function(e){var t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Ha.VALUE_ROWIDS:return n.getMaxWidthValueRowID(t);case Ha.ROW_SPLITS:return n.getMaxWidthRowSplit(t);default:throw new Error("Cannot handle partition type ".concat(Ha[this.getRowPartitionTypeByDimension(e-1)]))}},n.getMaxWidthRowSplit=function(e){var t=e.length;if(t===0||t===1)return 0;for(var r=0,a=0;a<t-1;++a){var i=e[a+1]-e[a];i>r&&(r=i)}return r},n.getMaxWidthValueRowID=function(e){var t=e.length;if(t===0)return 0;for(var r=0,a=e[0],i=0,o=1;o<t;++o){var s=e[o];s!==a&&(a=s,i=Math.max(o-r,i),r=o)}return Math.max(t-r,i)},n.prototype.tensorShapeFromTensor=function(e,t,r){if(r===void 0&&(r=!0),t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return FL(e,r)},n.prototype.calculateOutputSize=function(e){var t=this.valuesShape,r=this.defaultValueShape;S.backend_util.validateDefaultValueShape(r,t);var a=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=S.backend_util.combineRaggedTensorToTensorShapes(this.raggedRank,a,t),o=i;o[0]<0&&(o[0]=e);for(var s=1;s<=this.raggedRank;++s)o[s]<0&&(o[s]=this.getMaxWidth(s));return o},n.prototype.calculateFirstParentOutputIndex=function(e,t,r){for(var a=Math.min(e,r),i=[],o=0,s=0;s<a;++s,o+=t)i.push(o);for(var s=a;s<e;++s)i.push(-1);return S.util.assert(i.length===e,function(){return"Final length of result must be equal to firstDimension."}),i},n.prototype.calculateOutputIndexRowSplit=function(e,t,r,a){for(var i=e.length,o=[],s=0;s<i-1;++s){var u=e[s+1]-e[s],c=Math.min(a,u),l=t[s];l===-1&&(c=0);for(var f=0;f<c;++f)o.push(l),l+=r;for(var f=0;f<u-c;++f)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o},n.prototype.calculateOutputIndexValueRowID=function(e,t,r,a){var i=e.length,o=[];if(i===0)return[];var s=0,u=e[0];if(u>=t.length)throw new Error("Got currentValueRowId=".concat(u,", which is not less than ").concat(t.length));var c=t[u];o.push(c);for(var l=1;l<i;++l){var f=e[l];if(f===u)c>=0&&(++s,s<a?c+=r:c=-1);else{if(s=0,u=f,f>=t.length)throw new Error("Got nextValueRowId=".concat(f," which is not less than ").concat(t.length));c=t[f]}o.push(c)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o},n.prototype.calculateOutputIndex=function(e,t,r,a){var i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case Ha.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,r,a);case Ha.ROW_SPLITS:if(i.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(i.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(i,t,r,a);default:throw new Error("Unsupported partition type: ".concat(Ha[o]))}},n.prototype.getFirstDimensionSize=function(){var e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case Ha.FIRST_DIM_SIZE:return e[0];case Ha.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Ha.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(Ha[t]))}},n.prototype.compute=function(){var e=this.rowPartitionValues[0];if(e.length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var t=this.getFirstDimensionSize(),r=this.calculateOutputSize(t),a=new Array(this.raggedRank+1);a[a.length-1]=1;for(var i=a.length-2;i>=0;--i)a[i]=a[i+1]*r[i+1];var o=FL(r,!1),s=S.util.getArrayFromDType(this.valuesDType,S.util.sizeFromShape(o)),u=a[0]*r[0];if(u>0){for(var c=this.calculateFirstParentOutputIndex(t,a[0],r[0]),i=1;i<=this.raggedRank;++i){var l=this.calculateOutputIndex(i-1,c,a[i],r[i]);c=l}this.setOutput(this.raggedRank,c,s,o)}return[o,s]},n.prototype.setOutput=function(e,t,r,a){if(r.length!==0){var i=this.values,o=r,s=a.slice();s=s.slice(e+1);var u=S.util.sizeFromShape(s),c=t.length,l=this.defaultValue;if(l.length!==u&&l.length!==1){var f=this.defaultValueShape;S.tidy(function(){var x=S.reshape(l,f),N=S.broadcastTo(x,s);l=N.dataSync()})}for(var h=0,d=0,p=0,v=0;v<=c;++v){var m=v<c?t[v]:-1;if(m===p){++p;continue}if(d<p){var g=i.subarray(h*u),y=o.subarray(d*u),b=(p-d)*u;_L(y,g,b)}if(v>=c){var w=r.length;m=Math.floor(w/u)}if(m>p)if(this.defaultValue.length===1)o.subarray(p*u,m*u).fill(this.defaultValue[0]),p=m;else for(;m>p;){var y=o.slice(p*u);_L(y,l,u),++p}m<0?(h=v+1,d=p):(h=v,d=p,p=d+1)}}},n}();function _L(n,e,t){for(var r=0;r<t;r++)n[r]=e[r]}function FL(n,e){var t,r,a=[];try{for(var i=Pc(n),o=i.next();!o.done;o=i.next()){var s=o.value;if(s<0){if(!e)throw new Error("Dimension ".concat(s," must be >= 0"));if(s<-1)throw new Error("Dimension ".concat(s," must be >= -1"));s=-1}a.push(s)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return a}function fz(n,e,t,r,a,i,o,s,u,c){return new iRe(n,e,t,r,a,i,o,s,u,c).compute()}function hz(n,e,t,r){var a=n===e,i=n<e&&t<0,o=e<n&&t>1;if(a||i||o)return S.util.makeZerosTypedArray(0,r);var s=Math.abs(Math.ceil((e-n)/t)),u=S.util.makeZerosTypedArray(s,r);e<n&&t===1&&(t=-1),u[0]=n;for(var c=1;c<u.length;c++)u[c]=u[c-1]+t;return u}var dz=Jo(function(n){return 1/Math.sqrt(n)}),oRe=zc(S.Rsqrt,dz),sRe={kernelName:S.Rsqrt,backendName:"cpu",kernelFunc:oRe};function Oc(n,e,t,r,a,i,o,s,u,c){var l=[r/a,a],f=n.values,h=e.values;if(r===0)return S.buffer(t,e.dtype);var d=S.buffer(l,e.dtype);typeof u=="string"||typeof u=="number"?d.values.fill(u):typeof u=="boolean"&&d.values.fill(+u);for(var p=0;p<i;p++){for(var v=[],m=0,g=0;g<o;g++){var y=f[p*o+g];v.push(y),m+=y*s[g]}if(m<0||m>=r/a)throw new Error("Invalid indices: ".concat(v," does not index into ").concat(t));for(var b=0;b<a;b++)c?d.values[m*a+b]+=h[p*a+b]:d.values[m*a+b]=e.rank===0?h[0]:h[p*a+b]}return d}var uRe=Jo(function(n){return 1/(1+Math.exp(-n))}),pz=Mt(S.Sigmoid,function(n){return 1/(1+Math.exp(-n))}),cRe={kernelName:S.Sigmoid,backendName:"cpu",kernelFunc:pz};function vz(n,e,t,r,a){var i=S.slice_util.isSliceContinous(r,e,t),o=S.util.sizeFromShape(t),s=S.util.computeStrides(r);if(i){var u=S.slice_util.computeFlatOffset(e,s);return a==="string"?n.slice(u,u+o):n.subarray(u,u+o)}for(var c=a==="string"?S.backend_util.fromUint8ToStringArray(n):n,l=S.buffer(r,a,c),f=S.buffer(t,a),h=0;h<f.size;++h){var d=f.indexToLoc(h),p=d.map(function(v,m){return v+e[m]});f.set.apply(f,ya([l.get.apply(l,ya([],We(p),!1))],We(d),!1))}return a==="string"?S.backend_util.fromStringArrayToUint8(f.values):f.values}function cu(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.begin,o=r.size;Ge(a,"slice");var s=We(S.slice_util.parseSliceParams(a,i,o),2),u=s[0],c=s[1];S.slice_util.assertParamsValid(a,u,c);var l=t.data.get(a.dataId).values,f=vz(l,u,c,a.shape,a.dtype);return t.makeTensorInfo(c,a.dtype,f)}var lRe={kernelName:S.Slice,backendName:"cpu",kernelFunc:cu};function mz(n,e,t,r,a,i,o){var s=e[0],u=i[0],c=new Array(u),l=new Array(s),f=e[1];if(u===0){if(s!==0)throw new Error(S.backend_util.getSparseFillEmptyRowsIndicesDenseShapeMismatch(s));var h=S.util.getArrayFromDType(t,0),d=S.util.getArrayFromDType(a,0);return[h,[0,f],d,c,l]}for(var p=!0,v=0,m=new Array(u).fill(0),g=0;g<s;++g){var y=n[g*f];if(y<0)throw new Error(S.backend_util.getSparseFillEmptyRowsNegativeIndexErrorMessage(g,y));if(y>=u)throw new Error(S.backend_util.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(g,y,u));++m[y],p=p&&y>=v,v=y}for(var b=!0,y=0;y<u;++y){var w=m[y]===0;c[y]=w,b=b&&!w,m[y]=Math.max(m[y],1),y>0&&(m[y]+=m[y-1])}if(b&&p){for(var h=n,d=r,g=0;g<s;++g)l[g]=g;return[h,[s,f],d,c,l]}else{for(var x=m[u-1],h=S.util.getArrayFromDType(t,x*f),d=S.util.getArrayFromDType(a,x),N=new Array(u).fill(0),g=0;g<s;++g){var y=n[g*f],T=N[y],E=(y===0?0:m[y-1])+T;N[y]++;for(var C=0;C<f;++C)h[E*f+C]=n[g*f+C];d[E]=r[g],l[g]=E}for(var y=0;y<u;++y){var F=N[y];if(F===0){var _=y===0?0:m[y-1];h[_*f+0]=y;for(var O=1;O<f;++O)h[_*f+O]=0;d[_]=o}}return[h,[x,f],d,c,l]}}function gz(n,e,t,r,a){for(var i=S.util.sizeFromShape(r),o=e[0],s=a.length,u=[],c=1,l=-1,f=0;f<s;++f){var h=a[f];if(h===-1){if(l!==-1)throw new Error(S.backend_util.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(l,f));l=f,u.push(1)}else{if(h<0)throw new Error(S.backend_util.getSparseReshapeNegativeOutputDimErrorMessage(f,h));c*=h,u.push(h)}}if(l!==-1){if(c<=0)throw new Error(S.backend_util.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());var d=Math.trunc(i/c);if(c*d!==i)throw new Error(S.backend_util.getSparseReshapeInputOutputMultipleErrorMessage(r,u));u[l]=d}var p=S.util.sizeFromShape(u);if(p!==i)throw new Error(S.backend_util.getSparseReshapeInputOutputMismatchErrorMessage(r,u));var v=r.length,m=[];if(v>0){m[v-1]=1;for(var f=v-2;f>=0;--f)m[f]=m[f+1]*r[f+1]}var g=[];if(s>0){g[s-1]=1;for(var f=s-2;f>=0;--f)g[f]=g[f+1]*u[f+1]}for(var y=S.util.getArrayFromDType(t,o*s),b=0;b<o;++b){for(var w=0,x=0;x<v;++x)w+=n[b*v+x]*m[x];for(var x=0;x<s;++x)y[b*s+x]=Math.trunc(w/g[x]),w%=g[x]}return[y,[o,s],u]}function gx(n,e,t,r,a,i,o){i===void 0&&(i=!1),o===void 0&&(o=0);var s=r.length,u=[e[0],n.length/e[0]],c=u[1],l=s>0?a[s-1]+1:0,f=l;if(f<0)throw new Error(S.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var h=e.slice();h[0]=f;var d=h.reduce(function(T,E){return T*E},1),p=S.util.getArrayFromDType(t,d);if(s===0)return f>0&&p.fill(o),[p,h];if(f<=0)throw new Error(S.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());for(var v=0,m=1,g=0,y=a[v];;){var b=0;if(m<s){if(b=a[m],y===b){++m;continue}if(y>=b)throw new Error(S.backend_util.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=f)throw new Error(S.backend_util.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,f));y>g&&p.fill(o,g*c,y*c);for(var w=v;w<m;++w){var x=r[w];if(x<0||x>=u[0])throw new Error(S.backend_util.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(w,r[w],u[0]));for(var N=0;N<c;N++)p[y*c+N]+=n[x*c+N]}if(i)for(var N=0;N<c;N++)p[y*c+N]/=m-v;if(v=m,++m,g=y+1,y=b,m>s)break}return g<f&&p.fill(o,g*c,f*c),[p,h]}var fRe=Jo(function(n){return Math.sqrt(n)}),hRe=Mt(S.Sqrt,function(n){return Math.sqrt(n)}),dRe={kernelName:S.Sqrt,backendName:"cpu",kernelFunc:hRe};var yz=zn(function(n,e){var t=n-e;return t*t}),pRe=Zn(S.SquaredDifference,yz),vRe={kernelName:S.SquaredDifference,backendName:"cpu",kernelFunc:pRe};function bz(n,e,t,r){for(var a=S.buffer(n,e.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*t[u]+r[u];a.set.apply(a,ya([e.get.apply(e,ya([],We(s),!1))],We(o),!1))}return a}var mRe=function(){function n(e,t,r,a,i,o){this.separator=S.util.encodeString(e),this.nGramWidths=t,this.leftPad=S.util.encodeString(r),this.rightPad=S.util.encodeString(a),this.padWidth=i,this.preserveShort=o}return n.prototype.getPadWidth=function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)},n.prototype.getNumNGrams=function(e,t){var r=this.getPadWidth(t);return Math.max(0,e+2*r-t+1)},n.prototype.createNGrams=function(e,t,r,a,i,o){for(var s=function(l){var f=u.getPadWidth(o),h=Math.max(0,f-l),d=Math.max(0,f-(i-(l+1))),p=o-(h+d),v=t+(h>0?0:l-f),m=0;m+=h*u.leftPad.length;for(var g=0;g<p;++g)m+=e[v+g].length;m+=d*u.rightPad.length;var y=h+d+p-1;m+=y*u.separator.length,r[a+l]=new Uint8Array(m);for(var b=r[a+l],w=0,x=function(N){return N.forEach(function(T){return b[w++]=T})},g=0;g<h;++g)x(u.leftPad),x(u.separator);for(var g=0;g<p-1;++g)x(e[v+g]),x(u.separator);if(p>0){x(e[v+p-1]);for(var g=0;g<d;++g)x(u.separator),x(u.rightPad)}else{for(var g=0;g<d-1;++g)x(u.rightPad),x(u.separator);x(u.rightPad)}},u=this,c=0;c<i;++c)s(c)},n.prototype.compute=function(e,t){var r=this,a=e.length,i=t.length;if(i>0){var o=t[0];if(o!==0)throw new Error("First split value must be 0, got ".concat(o));for(var s=1;s<i;++s){var u=t[s]>=o;if(u=u&&t[s]<=a,!u)throw new Error("Invalid split value ".concat(t[s],", must be in [").concat(o,", ").concat(a,"]"));o=t[s]}if(o!==a)throw new Error("Last split value must be data size. Expected ".concat(a,", got ").concat(o))}var c=i-1,l=S.util.getArrayFromDType("int32",i);if(a===0||i===0){for(var f=new Array(a),s=0;s<=c;++s)l[s]=0;return[f,l]}l[0]=0;for(var h=function(g){var y=t[g]-t[g-1],b=0;d.nGramWidths.forEach(function(w){b+=r.getNumNGrams(y,w)}),d.preserveShort&&y>0&&b===0&&(b=1),l[g]=l[g-1]+b},d=this,s=1;s<=c;++s)h(s);for(var p=new Array(l[c]),v=function(g){var y=t[g],b=l[g];if(m.nGramWidths.forEach(function(T){var E=t[g+1]-t[g],C=r.getNumNGrams(E,T);r.createNGrams(e,y,p,b,C,T),b+=C}),m.preserveShort&&b===l[g]){var w=t[g+1]-t[g];if(w===0)return"continue";var x=w+2*m.padWidth,N=1;m.createNGrams(e,y,p,b,N,x)}},m=this,s=0;s<c;++s)v(s);return[p,l]},n}();function wz(n,e,t,r,a,i,o,s){return new mRe(t,r,a,i,o,s).compute(n,e)}function gRe(n,e,t,r){if(!!n.length){if(e.length===0){for(var a=0;a<n.length;++a)r.push(n.subarray(a,a+1));return}if(e.length===1){for(var i=e[0],o=n.indexOf(i);o!==-1;){var s=n.subarray(0,o);(!t||s.length!==0)&&r.push(s),n=n.subarray(o+1),o=n.indexOf(i)}(!t||n.length!==0)&&r.push(n);return}for(var u=0,a=0;a<n.length+1;a++)if(a===n.length||e.indexOf(n[a])!==-1){var s=n.subarray(u,a);(!t||s.length!==0)&&r.push(s),u=a+1}}}function xz(n,e,t){for(var r=n.length,a=[],i=0,o=0,s=new Array(r),u=0;u<r;++u){var c=a.length;gRe(n[u],e,t,a);var l=a.length-c;s[u]=l,i+=l,o=Math.max(o,l)}for(var f=S.util.getArrayFromDType("int32",i*2),h=new Array(i),d=[r,o],p=0,u=0;u<r;++u)for(var v=0;v<s[u];++v)f[p*2]=u,f[p*2+1]=v,h[p]=a[p],++p;return[f,h,d]}function kz(n,e){for(var t=S.util.getArrayFromDType("int32",n.length),r=0;r<n.length;++r)t[r]=S.util.fingerPrint64(n[r]).modulo(e).getLowBitsUnsigned();return t}var Sz=zn(function(n,e){return n-e}),yRe=dx(function(n,e,t,r){return{real:n-t,imag:e-r}}),yx=Zn(S.Sub,Sz,yRe),bRe={kernelName:S.Sub,backendName:"cpu",kernelFunc:yx};function Nz(n,e){for(var t=new Array(n.rank),r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];for(var a=S.buffer(t,n.dtype),r=0;r<a.values.length;++r){for(var i=a.indexToLoc(r),o=new Array(n.rank),s=0;s<o.length;s++)o[s]=i[s]%n.shape[s];var u=n.locToIndex(o);a.values[r]=n.values[u]}return a}var rh=function(n,e){var t=e.value-n.value;return t===0?n.index-e.index:t};function Tz(n,e,t,r){for(t===void 0&&(t=0),r===void 0&&(r=n.length-1);r>t;){if(r-t>600){var a=r-t+1,i=e-t+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2),c=Math.max(t,Math.floor(e-i*s/a+u)),l=Math.min(r,Math.floor(e+(a-i)*s/a+u));Tz(n,e,c,l)}var f=n[e],h=t,d=r;for(S.util.swap(n,t,e),rh(n[r],f)>0&&S.util.swap(n,t,r);h<d;){for(S.util.swap(n,h,d),h++,d--;rh(n[h],f)<0;)h=h+1;for(;rh(n[d],f)>0;)d=d-1}rh(n[t],f)===0?S.util.swap(n,t,d):(d=d+1,S.util.swap(n,d,r)),d<=e&&(t=d+1),e<=d&&(r=d-1)}}function Ez(n,e,t,r,a){for(var i=e[e.length-1],o=We([n.length/i,i],2),s=o[0],u=o[1],c=S.util.getTypedArrayFromDType(t,s*r),l=S.util.getTypedArrayFromDType("int32",s*r),f=function(p){var v=p*u,m=n.subarray(v,v+u),g=new Array(m.length);m.forEach(function(N,T){return g[T]={value:N,index:T}}),r<g.length&&(Tz(g,r),g=g.slice(0,r)),a&&g.sort(rh);for(var y=p*r,b=c.subarray(y,y+r),w=l.subarray(y,y+r),x=0;x<r;x++)b[x]=g[x].value,w[x]=g[x].index},h=0;h<s;h++)f(h);var d=e.slice();return d[d.length-1]=r,[S.buffer(d,t,c),S.buffer(d,"int32",l)]}function Iz(n,e,t,r){for(var a=S.util.parseAxisParam(e,t)[0],i=[1,t[0],1],o=0;o<a;o++)i[0]*=t[o];i[1]=t[a];for(var o=a+1;o<t.length;o++)i[2]*=t[o];for(var s={},u=new Int32Array(t[a]),c=new S.TensorBuffer(i,r,n),l=[],f=i[0]===1&&i[2]===1,o=0;o<t[a];o++){var h=void 0;if(f)h=n[o].toString();else{for(var d=[],p=0;p<i[0];p++)for(var v=0;v<i[2];v++)d.push(c.get(p,o,v));h=d.join(",")}if(s[h]!==void 0)u[o]=s[h];else{var m=Object.keys(s).length;s[h]=m,u[o]=m,l.push(o)}}var g=i.slice();g[1]=Object.keys(s).length;var y=new S.TensorBuffer(g,r);l.forEach(function(w,x){for(var N=0;N<i[0];N++)for(var T=0;T<i[2];T++)y.set(c.get(N,w,T),N,x,T)});var b=t.slice();return b[a]=g[1],{outputValues:y.values,outputShape:b,indices:u}}var wRe={__proto__:null,simpleAbsImpl:BL,addImpl:zL,bincountImpl:px,bincountReduceImpl:$L,castImpl:LL,ceilImpl:qL,concatImpl:WL,equalImpl:VL,expImpl:UL,expm1Impl:KL,floorImpl:jL,gatherNdImpl:XL,gatherV2Impl:YL,greaterImpl:ZL,greaterEqualImpl:JL,lessImpl:QL,lessEqualImpl:ez,linSpaceImpl:tz,logImpl:nz,maxImpl:rz,maximumImpl:az,minimumImpl:iz,multiplyImpl:vx,negImpl:oz,notEqualImpl:sz,prodImpl:uz,raggedGatherImpl:cz,raggedRangeImpl:lz,raggedTensorToTensorImpl:fz,rangeImpl:hz,rsqrtImpl:dz,scatterImpl:Oc,sigmoidImpl:uRe,sliceImpl:vz,sparseFillEmptyRowsImpl:mz,sparseReshapeImpl:gz,sparseSegmentReductionImpl:gx,sqrtImpl:fRe,squaredDifferenceImpl:yz,stridedSliceImpl:bz,stringNGramsImpl:wz,stringSplitImpl:xz,stringToHashBucketFastImpl:kz,subImpl:Sz,tileImpl:Nz,topKImpl:Ez,transposeImpl:mx,uniqueImpl:Iz};var xRe="4.2.0";S.registerBackend("cpu",function(){return new hx},1);var Cz=Mt(S.Elu,function(n){return n>=0?n:Math.exp(n)-1}),kRe={kernelName:S.Elu,backendName:"cpu",kernelFunc:Cz};function Az(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.alpha;Ge([a],"leakyRelu");for(var o=S.util.sizeFromShape(a.shape),s=t.data.get(a.dataId).values,u=S.util.getTypedArrayFromDType("float32",o),c=0;c<s.length;c++)u[c]=s[c]<0?i*s[c]:s[c];return t.makeTensorInfo(a.shape,"float32",u)}var SRe={kernelName:S.LeakyRelu,backendName:"cpu",kernelFunc:Az},NRe=zn(function(n,e){return n<0?e*n:n});function Dz(n){var e=n.inputs,t=n.backend,r=e.x,a=e.alpha;Ge([r,a],"prelu");var i=t.data.get(r.dataId).values,o=t.data.get(a.dataId).values,s=We(NRe(r.shape,a.shape,i,o,"float32"),2),u=s[0],c=s[1];return t.makeTensorInfo(c,"float32",u)}var TRe={kernelName:S.Prelu,backendName:"cpu",kernelFunc:Dz};var _z=Mt(S.Relu,function(n){return Math.max(0,n)}),ERe={kernelName:S.Relu,backendName:"cpu",kernelFunc:_z};var Fz=Mt(S.Relu6,function(n){return Math.min(Math.max(0,n),6)}),IRe={kernelName:S.Relu6,backendName:"cpu",kernelFunc:Fz};function Hv(n,e,t,r,a){if(t==="linear")return Pi({inputs:{x:e},backend:n});if(t==="relu")return _z({inputs:{x:e},backend:n});if(t==="elu")return Cz({inputs:{x:e},backend:n});if(t==="relu6")return Fz({inputs:{x:e},backend:n});if(t==="prelu")return Dz({inputs:{x:e,alpha:r},backend:n});if(t==="leakyrelu")return Az({inputs:{x:e},backend:n,attrs:{alpha:a}});if(t==="sigmoid")return pz({inputs:{x:e},backend:n});throw new Error("Activation ".concat(t," has not been implemented for the CPU backend."))}function qt(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.shape,o=S.util.sizeFromShape(a.shape),s=S.util.inferFromImplicitShape(i,o),u=S.util.sizeFromShape(s);S.util.assert(o===u,function(){return"The new shape (".concat(s,") has ").concat(u," elements and the old ")+"shape (".concat(a.shape,") has ").concat(o," elements. The new shape and old ")+"shape must have the same number of elements."}),t.incRef(a.dataId);var c=t.data.get(a.dataId);if(c.complexTensorInfos!=null){var l=c.complexTensorInfos.real,f=c.complexTensorInfos.imag;l.shape=s,f.shape=s}return{dataId:a.dataId,shape:s,dtype:a.dtype}}var CRe={kernelName:S.Reshape,backendName:"cpu",kernelFunc:qt};function Rz(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.a,i=e.b,o=r.transposeA,s=r.transposeB;Ge([a,i],"matMul");var u=a.shape.length,c=i.shape.length,l=o?a.shape[u-2]:a.shape[u-1],f=s?i.shape[c-1]:i.shape[c-2],h=o?a.shape[u-1]:a.shape[u-2],d=s?i.shape[c-2]:i.shape[c-1],p=a.shape.slice(0,-2),v=i.shape.slice(0,-2),m=S.util.sizeFromShape(p),g=S.util.sizeFromShape(v),y=S.broadcast_util.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)),b=y.concat([h,d]);S.util.assert(l===f,function(){return"Error in matMul: inner shapes (".concat(l,") and (")+"".concat(f,") of Tensors with shapes ").concat(a.shape," and ")+"".concat(i.shape," and transposeA=").concat(o)+" and transposeB=".concat(s," must match.")});for(var w=o?[m,l,h]:[m,h,l],x=s?[g,d,f]:[g,f,d],N=qt({inputs:{x:a},backend:t,attrs:{shape:w}}),T=qt({inputs:{x:i},backend:t,attrs:{shape:x}}),E=o?N.shape[1]:N.shape[2],C=o?N.shape[2]:N.shape[1],F=s?T.shape[1]:T.shape[2],_=Math.max(m,g),O=t.data.get(N.dataId).values,L=t.data.get(T.dataId).values,z=S.util.computeStrides(N.shape),$=S.util.computeStrides(T.shape),B=We(o?[z[0],1,z[1]]:[z[0],z[1],1],3),W=B[0],X=B[1],Z=B[2],V=We(s?[1,$[1],$[0]]:[$[1],1,$[0]],3),j=V[0],re=V[1],ne=V[2],oe=C*F,le=S.buffer([_,C,F],N.dtype),pe=le.values,xe=t.blockSize,he=0;he<_;he++)for(var ye=he%m,we=he%g,Ae=0;Ae<C;Ae+=xe)for(var Ye=Math.min(Ae+xe,C),ht=0;ht<F;ht+=xe)for(var at=Math.min(ht+xe,F),rt=0;rt<E;rt+=xe)for(var ft=Math.min(rt+xe,E),st=Ae;st<Ye;st++)for(var Ze=ht;Ze<at;Ze++){for(var tt=0,et=rt;et<ft;et++){var rn=O[ye*W+st*X+et*Z],He=L[et*j+Ze*re+we*ne];tt+=rn*He}pe[he*oe+(st*F+Ze)]+=tt}return t.disposeIntermediateTensorInfo(N),t.disposeIntermediateTensorInfo(T),t.makeTensorInfo(b,le.dtype,le.values)}var ARe={kernelName:S.BatchMatMul,backendName:"cpu",kernelFunc:Rz};function DRe(n){var e,t,r=n.inputs,a=n.backend,i=n.attrs,o=r.a,s=r.b,u=r.bias,c=r.preluActivationWeights,l=i.transposeA,f=i.transposeB,h=i.activation,d=i.leakyreluAlpha,p,v,m,g=[],y=Rz({inputs:{a:o,b:s},attrs:{transposeA:l,transposeB:f},backend:a});p=y,u&&(v=Mc({inputs:{a:p,b:u},backend:a}),g.push(p),p=v),h&&(m=Hv(a,p,h,c,d),g.push(p),p=m);try{for(var b=Pc(g),w=b.next();!w.done;w=b.next()){var x=w.value;a.disposeIntermediateTensorInfo(x)}}catch(N){e={error:N}}finally{try{w&&!w.done&&(t=b.return)&&t.call(b)}finally{if(e)throw e.error}}return p}var _Re={kernelName:S._FusedMatMul,backendName:"cpu",kernelFunc:DRe};var FRe=Mt(S.Acos,function(n){return Math.acos(n)}),RRe={kernelName:S.Acos,backendName:"cpu",kernelFunc:FRe};var ORe=Mt(S.Acosh,function(n){return Math.acosh(n)}),PRe={kernelName:S.Acosh,backendName:"cpu",kernelFunc:ORe};function MRe(n){var e=n.inputs,t=n.backend,r=e;Ge(e,"addN");for(var a=r.map(function(l){return t.data.get(l.dataId).values}),i=S.buffer(r[0].shape,r[0].dtype),o=i.values,s=0;s<r.length;s++)for(var u=a[s],c=0;c<o.length;c++)o[c]+=u[c];return t.makeTensorInfo(i.shape,i.dtype,i.values)}var BRe={kernelName:S.AddN,backendName:"cpu",kernelFunc:MRe};function LRe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims;Ge(a,"all");var s=S.util.parseAxisParam(i,a.shape),u=s,c=S.backend_util.getAxesPermutation(u,a.shape.length),l=a;c!=null&&(l=Or({inputs:{x:a},backend:t,attrs:{perm:c}}),u=S.backend_util.getInnerMostAxes(u.length,a.shape.length)),S.backend_util.assertAxesAreInnerMostDims("all",u,l.shape.length);for(var f=We(S.backend_util.computeOutAndReduceShapes(l.shape,u),2),h=f[0],d=f[1],p=S.util.sizeFromShape(d),v=S.util.makeZerosTypedArray(S.util.sizeFromShape(h),l.dtype),m=t.data.get(l.dataId).values,g=0;g<v.length;++g){for(var y=g*p,b=m[y],w=0;w<p;++w){var x=m[y+w];b=b&&x}v[g]=b}c!=null&&t.disposeIntermediateTensorInfo(l);var N=t.makeTensorInfo(h,l.dtype,v);if(o){var T=S.backend_util.expandShapeToKeepDim(h,s),E=qt({inputs:{x:N},backend:t,attrs:{shape:T}});return t.disposeIntermediateTensorInfo(N),E}return N}var zRe={kernelName:S.All,backendName:"cpu",kernelFunc:LRe};function $Re(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims;Ge(a,"any");var s=S.util.parseAxisParam(i,a.shape),u=s,c=S.backend_util.getAxesPermutation(u,a.shape.length),l=a;c!=null&&(l=Or({inputs:{x:a},backend:t,attrs:{perm:c}}),u=S.backend_util.getInnerMostAxes(u.length,a.shape.length)),S.backend_util.assertAxesAreInnerMostDims("any",u,l.shape.length);for(var f=We(S.backend_util.computeOutAndReduceShapes(l.shape,u),2),h=f[0],d=f[1],p=S.util.sizeFromShape(d),v=S.util.makeZerosTypedArray(S.util.sizeFromShape(h),l.dtype),m=t.data.get(l.dataId).values,g=0;g<v.length;++g){for(var y=g*p,b=m[y],w=0;w<p;++w){var x=m[y+w];b=b||x}v[g]=b}c!=null&&t.disposeIntermediateTensorInfo(l);var N=t.makeTensorInfo(h,l.dtype,v);if(o){var T=S.backend_util.expandShapeToKeepDim(h,s),E=qt({inputs:{x:N},backend:t,attrs:{shape:T}});return t.disposeIntermediateTensorInfo(N),E}return N}var qRe={kernelName:S.Any,backendName:"cpu",kernelFunc:$Re};function WRe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis;Ge(a,"argMax");var o=S.util.parseAxisParam(i,a.shape),s=S.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=Or({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=S.backend_util.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],S.backend_util.assertAxesAreInnerMostDims("argMax",o,u.shape.length);for(var l=We(S.backend_util.computeOutAndReduceShapes(u.shape,o),2),f=l[0],h=l[1],d=S.util.sizeFromShape(f),p=S.util.makeZerosTypedArray(d,"int32"),v=S.util.sizeFromShape(h),m=t.data.get(u.dataId).values,g=0;g<p.length;++g){for(var y=g*v,b=m[y],w=0,x=0;x<v;++x){var N=m[y+x];N>b&&(b=N,w=x)}p[g]=w}return c.forEach(function(T){return t.disposeIntermediateTensorInfo(T)}),t.makeTensorInfo(f,"int32",p)}var VRe={kernelName:S.ArgMax,backendName:"cpu",kernelFunc:WRe};function GRe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis;Ge(a,"argMin");var o=S.util.parseAxisParam(i,a.shape),s=S.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=Or({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=S.backend_util.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],S.backend_util.assertAxesAreInnerMostDims("argMin",o,u.shape.length);for(var l=We(S.backend_util.computeOutAndReduceShapes(u.shape,o),2),f=l[0],h=l[1],d=S.util.sizeFromShape(f),p=S.util.makeZerosTypedArray(d,"int32"),v=S.util.sizeFromShape(h),m=t.data.get(u.dataId).values,g=0;g<p.length;++g){for(var y=g*v,b=m[y],w=0,x=0;x<v;++x){var N=m[y+x];N<b&&(b=N,w=x)}p[g]=w}return c.forEach(function(T){return t.disposeIntermediateTensorInfo(T)}),t.makeTensorInfo(f,"int32",p)}var URe={kernelName:S.ArgMin,backendName:"cpu",kernelFunc:GRe};var HRe=Mt(S.Asin,function(n){return Math.asin(n)}),KRe={kernelName:S.Asin,backendName:"cpu",kernelFunc:HRe};var jRe=Mt(S.Asinh,function(n){return Math.asinh(n)}),XRe={kernelName:S.Asinh,backendName:"cpu",kernelFunc:jRe};var YRe=Mt(S.Atan,function(n){return Math.atan(n)}),ZRe={kernelName:S.Atan,backendName:"cpu",kernelFunc:YRe};var JRe=zn(function(n,e){return Math.atan2(n,e)}),QRe=Zn(S.Atan2,JRe),eOe={kernelName:S.Atan2,backendName:"cpu",kernelFunc:QRe};var tOe=Mt(S.Atanh,function(n){return Math.atanh(n)}),nOe={kernelName:S.Atanh,backendName:"cpu",kernelFunc:tOe};function bx(n,e,t,r,a,i){for(var o=a.strideHeight,s=a.strideWidth,u=a.dilationHeight,c=a.dilationWidth,l=a.effectiveFilterHeight,f=a.effectiveFilterWidth,h=a.padInfo.top,d=a.padInfo.left,p=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=S.buffer(a.outShape,t),m=v.values,g=a.outShape[1]*a.outShape[2]*a.outShape[3],y=a.outShape[2]*a.outShape[3],b=a.outShape[3],w=0;w<a.batchSize;++w)for(var x=w*g,N=w*r[0],T=0;T<a.inChannels;++T)for(var E=0;E<a.outHeight;++E)for(var C=E*o-h,F=Math.max(0,C),_=Math.min(a.inHeight,l+C),O=x+E*y,L=0;L<a.outWidth;++L){for(var z=L*s-d,$=Math.max(0,z),B=Math.min(a.inWidth,f+z),W=p,X=0,Z=0,V=F;V<_;V+=u){for(var j=N+V*r[1],re=$;re<B;re+=c){var ne=j+re*r[2],oe=n[ne+T];i==="max"&&oe>W?W=oe:i==="avg"&&(X+=oe,Z++)}if(isNaN(W))break}var le=O+L*b+T;m[le]=i==="avg"?X/Z:W}return v}function Oz(n,e,t,r,a,i){a===void 0&&(a=!1),i===void 0&&(i=!1);for(var o=S.buffer(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,d=r.padInfo.top,p=r.padInfo.left,v=S.buffer(e,t,n),m=0;m<r.batchSize;++m)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.outHeight;++y){for(var b=y*s-d,w=b;w<0;)w+=c;for(var x=Math.min(r.inHeight,f+b),N=0;N<r.outWidth;++N){for(var T=N*u-p,E=T;E<0;)E+=l;for(var C=Math.min(r.inWidth,h+T),F=Number.NEGATIVE_INFINITY,_=-1,O=w;O<x;O+=c)for(var L=O-b,z=E;z<C;z+=l){var $=z-T,B=v.get(m,O,z,g);B>F&&(F=B,a?_=i?((m*r.inHeight+O)*r.inWidth+z)*r.inChannels+g:(O*r.inWidth+z)*r.inChannels+g:_=L*h+$)}o.set(_,m,y,N,g)}}return o}function Pz(n,e,t,r,a,i){for(var o=a.strideDepth,s=a.strideHeight,u=a.strideWidth,c=a.dilationDepth,l=a.dilationHeight,f=a.dilationWidth,h=a.effectiveFilterDepth,d=a.effectiveFilterHeight,p=a.effectiveFilterWidth,v=a.padInfo.front,m=a.padInfo.top,g=a.padInfo.left,y=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=S.buffer(a.outShape,t),w=b.values,x=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],N=a.outShape[2]*a.outShape[3]*a.outShape[4],T=a.outShape[3]*a.outShape[4],E=a.outShape[4],C=0;C<a.batchSize;++C)for(var F=C*x,_=C*r[0],O=0;O<a.inChannels;++O)for(var L=0;L<a.outDepth;++L){for(var z=L*o-v,$=z;$<0;)$+=c;for(var B=Math.min(a.inDepth,h+z),W=F+L*N,X=0;X<a.outHeight;++X){for(var Z=X*s-m,V=Z;V<0;)V+=l;for(var j=Math.min(a.inHeight,d+Z),re=W+X*T,ne=0;ne<a.outWidth;++ne){for(var oe=ne*u-g,le=oe;le<0;)le+=f;for(var pe=Math.min(a.inWidth,p+oe),xe=re+ne*E,he=y,ye=0,we=0,Ae=$;Ae<B;Ae+=c){for(var Ye=_+Ae*r[1],ht=V;ht<j;ht+=l){for(var at=Ye+ht*r[2],rt=le;rt<pe;rt+=f){var ft=at+rt*r[3],st=n[ft+O];if(i==="max"&&st>he?he=st:i==="avg"&&(ye+=st,we++),isNaN(he))break}if(isNaN(he))break}if(isNaN(he))break}var Ze=xe+O;w[Ze]=i==="avg"?ye/Math.max(we,1):he}}}return b}function rOe(n,e){for(var t=S.buffer(e.outShape,"int32"),r=e.strideDepth,a=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,s=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterDepth,l=e.effectiveFilterHeight,f=e.effectiveFilterWidth,h=e.padInfo.front,d=e.padInfo.top,p=e.padInfo.left,v=0;v<e.batchSize;++v)for(var m=0;m<e.inChannels;++m)for(var g=0;g<e.outDepth;++g){for(var y=g*r-h,b=y;b<0;)b+=o;for(var w=Math.min(e.inDepth,c+y),x=0;x<e.outHeight;++x){for(var N=x*a-d,T=N;T<0;)T+=s;for(var E=Math.min(e.inHeight,l+N),C=0;C<e.outWidth;++C){for(var F=C*i-p,_=F;_<0;)_+=u;for(var O=Math.min(e.inWidth,f+F),L=Number.NEGATIVE_INFINITY,z=-1,$=b;$<w;$+=o)for(var B=$-y,W=T;W<E;W+=s)for(var X=W-N,Z=_;Z<O;Z+=u){var V=Z-F,j=n.get(v,$,W,Z,m);j>=L&&(L=j,z=B*l*f+X*l+V)}t.set(z,v,g,x,C,m)}}}return t}function aOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x;Ge(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=1;S.util.assert(S.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=S.backend_util.computePool2DInfo(a.shape,i,o,c,s,u),f;if(l.filterWidth===1&&l.filterHeight===1&&S.util.arraysEqual(l.inShape,l.outShape))f=Pi({inputs:{x:a},backend:t});else{var h=t.data.get(a.dataId).values,d=S.util.computeStrides(a.shape),p=bx(h,a.shape,a.dtype,d,l,"avg");f=t.makeTensorInfo(l.outShape,a.dtype,p.values)}return f}var iOe={kernelName:S.AvgPool,backendName:"cpu",kernelFunc:aOe};function oOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;Ge(a,"avgPool3d");var l=S.backend_util.computePool3DInfo(a.shape,i,o,1,s,u,c),f=t.data.get(a.dataId).values,h=Pz(f,a.shape,a.dtype,S.util.computeStrides(a.shape),l,"avg");return t.makeTensorInfo(h.shape,"float32",h.values)}var sOe={kernelName:S.AvgPool3D,backendName:"cpu",kernelFunc:oOe};function uOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;Ge([a,i],"avgPool3DGrad");for(var l=S.backend_util.computePool3DInfo(i.shape,o,s,1,u,c),f=l.strideDepth,h=l.strideHeight,d=l.strideWidth,p=l.filterDepth,v=l.filterHeight,m=l.filterWidth,g=l.dilationDepth,y=l.dilationHeight,b=l.dilationWidth,w=l.effectiveFilterDepth,x=l.effectiveFilterHeight,N=l.effectiveFilterWidth,T=w-1-l.padInfo.front,E=N-1-l.padInfo.left,C=x-1-l.padInfo.top,F=S.buffer(i.shape,"float32"),_=1/(p*v*m),O=t.bufferSync(a),L=0;L<l.batchSize;++L)for(var z=0;z<l.inChannels;++z)for(var $=0;$<l.inDepth;++$)for(var B=0;B<l.inHeight;++B)for(var W=0;W<l.inWidth;++W){for(var X=$-T,Z=B-C,V=W-E,j=0,re=0;re<w;re+=g){var ne=(X+re)/f;if(!(ne<0||ne>=l.outDepth||Math.floor(ne)!==ne))for(var oe=0;oe<x;oe+=y){var le=(Z+oe)/h;if(!(le<0||le>=l.outHeight||Math.floor(le)!==le))for(var pe=0;pe<N;pe+=b){var xe=(V+pe)/d;if(!(xe<0||xe>=l.outWidth||Math.floor(xe)!==xe)){var he=O.get(L,ne,le,xe,z);j+=he}}}}F.set(j*_,L,$,B,W,z)}return t.makeTensorInfo(F.shape,F.dtype,F.values)}var cOe={kernelName:S.AvgPool3DGrad,backendName:"cpu",kernelFunc:uOe};function lOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.input,o=i;Ge([a,i],"avgPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=S.backend_util.computePool2DInfo(o.shape,s,u,1,c),f=l.strideHeight,h=l.strideWidth,d=l.filterHeight,p=l.filterWidth,v=l.dilationHeight,m=l.dilationWidth,g=l.effectiveFilterHeight,y=l.effectiveFilterWidth,b=y-1-l.padInfo.left,w=g-1-l.padInfo.top,x=S.buffer(o.shape,"float32"),N=1/(d*p),T=t.data.get(a.dataId).values,E=S.buffer(a.shape,"float32",T),C=0;C<l.batchSize;++C)for(var F=0;F<l.inChannels;++F)for(var _=0;_<l.inHeight;++_)for(var O=0;O<l.inWidth;++O){for(var L=_-w,z=O-b,$=0,B=0;B<g;B+=v){var W=(L+B)/f;if(!(W<0||W>=l.outHeight||Math.floor(W)!==W))for(var X=0;X<y;X+=m){var Z=(z+X)/h;if(!(Z<0||Z>=l.outWidth||Math.floor(Z)!==Z)){var V=E.get(C,W,Z,F);$+=V}}}x.set($*N,C,_,O,F)}return t.makeTensorInfo(x.shape,x.dtype,x.values)}var fOe={kernelName:S.AvgPoolGrad,backendName:"cpu",kernelFunc:lOe};function hOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.scale,o=e.offset,s=e.mean,u=e.variance;S.util.assert(s.shape.length===u.shape.length,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),S.util.assert(o==null||s.shape.length===o.shape.length,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),S.util.assert(i==null||s.shape.length===i.shape.length,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),Ge([a,s,u,i,o],"batchNorm");var c=r.varianceEpsilon;c==null&&(c=.001);for(var l=t.data.get(a.dataId).values,f=t.data.get(s.dataId).values,h=t.data.get(u.dataId).values,d=i?t.data.get(i.dataId).values:new Float32Array([1]),p=o?t.data.get(o.dataId).values:new Float32Array([0]),v=new Float32Array(l.length),m=p.length,g=d.length,y=h.length,b=f.length,w=0,x=0,N=0,T=0,E=0;E<l.length;++E)v[E]=p[w++]+(l[E]-f[x++])*d[N++]/Math.sqrt(h[T++]+c),w>=m&&(w=0),x>=b&&(x=0),N>=g&&(N=0),T>=y&&(T=0);return t.makeTensorInfo(a.shape,a.dtype,v)}var dOe={kernelName:S.FusedBatchNorm,backendName:"cpu",kernelFunc:hOe};function pOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.blockShape,o=r.crops;Ge([a],"batchToSpaceND");var s=i.reduce(function(g,y){return g*y}),u=S.backend_util.getReshaped(a.shape,i,s),c=S.backend_util.getPermuted(u.length,i.length),l=S.backend_util.getReshapedPermuted(a.shape,i,s),f=S.backend_util.getSliceBeginCoords(o,i.length),h=S.backend_util.getSliceSize(l,o,i.length),d=qt({inputs:{x:a},backend:t,attrs:{shape:u}}),p=Or({inputs:{x:d},backend:t,attrs:{perm:c}}),v=qt({inputs:{x:p},backend:t,attrs:{shape:l}}),m=cu({inputs:{x:v},backend:t,attrs:{begin:f,size:h}});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(v),m}var vOe={kernelName:S.BatchToSpaceND,backendName:"cpu",kernelFunc:pOe};function mOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.weights,o=r.size,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=px(s,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,c)}var gOe={kernelName:S.Bincount,backendName:"cpu",kernelFunc:mOe};function yOe(n){var e=n.inputs,t=n.backend,r=e.s0,a=e.s1,i=t.data.get(r.dataId).values,o=t.data.get(a.dataId).values,s=S.backend_util.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return t.makeTensorInfo([s.length],"int32",Int32Array.from(s))}var bOe={kernelName:S.BroadcastArgs,backendName:"cpu",kernelFunc:yOe};var wOe=Mt(S.ClipByValue,function(n,e){var t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),xOe={kernelName:S.ClipByValue,backendName:"cpu",kernelFunc:wOe};var kOe=function(n){for(var e=n.inputs.x,t=n.backend,r=new Float32Array(S.util.sizeFromShape(e.shape)),a=t.data.get(e.dataId),i=a.complexTensorInfos.real,o=a.complexTensorInfos.imag,s=t.data.get(i.dataId).values,u=t.data.get(o.dataId).values,c=0;c<s.length;c++){var l=s[c],f=u[c];r[c]=Math.hypot(l,f)}return t.makeOutput(r,e.shape,"float32")},SOe={kernelName:S.ComplexAbs,backendName:"cpu",kernelFunc:kOe};function Bc(n){var e=n.inputs,t=n.backend,r=e.input,a=t.data.get(r.dataId).complexTensorInfos.imag,i=t.data.get(a.dataId).values;return t.makeTensorInfo(a.shape,a.dtype,i)}var NOe={kernelName:S.Imag,backendName:"cpu",kernelFunc:Bc};function Lc(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.axis,i=S.util.parseAxisParam(a,e[0].shape)[0],o=e.map(function(w){return w.shape});S.backend_util.assertParamsConsistent(o,i);var s=S.backend_util.computeOutShape(e.map(function(w){return w.shape}),i);if(S.util.sizeFromShape(s)===0)return t.makeTensorInfo(s,e[0].dtype,[]);var u=e.filter(function(w){return S.util.sizeFromShape(w.shape)>0});if(u.length===1)return Pi({inputs:{x:u[0]},backend:t});if(u[0].dtype==="complex64"){var c=u.map(function(w){return uu({inputs:{input:w},backend:t})}),l=u.map(function(w){return Bc({inputs:{input:w},backend:t})}),f=Lc({inputs:c,backend:t,attrs:{axis:i}}),h=Lc({inputs:l,backend:t,attrs:{axis:i}}),d=na({inputs:{real:f,imag:h},backend:t});return c.forEach(function(w){return t.disposeIntermediateTensorInfo(w)}),l.forEach(function(w){return t.disposeIntermediateTensorInfo(w)}),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),d}var p=u.map(function(w){var x=S.util.sizeFromShape(w.shape.slice(i)),N=[-1,x];return qt({inputs:{x:w},backend:t,attrs:{shape:N}})}),v=p.map(function(w){return{vals:t.data.get(w.dataId).values,shape:w.shape}});s=S.backend_util.computeOutShape(p.map(function(w){return w.shape}),1);var m=p[0].shape[0]===1,g=WL(v,s,e[0].dtype,m),y=S.backend_util.computeOutShape(u.map(function(w){return w.shape}),i),b=t.makeTensorInfo(y,e[0].dtype,g);return p.forEach(function(w){return t.disposeIntermediateTensorInfo(w)}),b}var TOe={kernelName:S.Concat,backendName:"cpu",kernelFunc:Lc};function Mz(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dilations,l=r.dimRoundingMode;Ge([a,i],"conv2d");for(var f=S.backend_util.convertConv2DDataFormat(u),h=S.backend_util.computeConv2DInfo(a.shape,i.shape,o,c,s,l,!1,f),d=h.filterHeight,p=h.filterWidth,v=h.dilationHeight,m=h.dilationWidth,g=h.padInfo.left,y=h.padInfo.top,b=h.dataFormat==="channelsLast",w=new S.TensorBuffer(h.outShape,a.dtype),x=S.util.computeStrides(a.shape),N=S.util.computeStrides(i.shape),T=x[0],E=b?x[1]:x[2],C=b?x[2]:1,F=b?1:x[1],_=w.strides[0],O=b?w.strides[1]:w.strides[2],L=b?w.strides[2]:1,z=b?1:w.strides[1],$=t.data.get(a.dataId).values,B=t.data.get(i.dataId).values,W=w.values,X=0;X<h.batchSize;++X)for(var Z=X*T,V=X*_,j=0;j<h.outHeight;++j)for(var re=V+j*O,ne=j*h.strideHeight-y,oe=0;oe<d;++oe){var le=ne+oe*v;if(!(le<0||le>=h.inHeight))for(var pe=oe*N[0],xe=Z+le*E,he=0;he<h.outWidth;++he)for(var ye=re+he*L,we=he*h.strideWidth-g,Ae=0;Ae<p;++Ae){var Ye=we+Ae*m;if(!(Ye<0||Ye>=h.inWidth))for(var ht=pe+Ae*N[1],at=xe+Ye*C,rt=ht,ft=0;ft<h.inChannels;++ft){for(var st=$[at+ft*F],Ze=0;Ze<h.outChannels;++Ze)W[ye+Ze*z]+=st*B[rt+Ze];rt+=h.outChannels}}}return t.makeTensorInfo(w.shape,w.dtype,W)}var EOe={kernelName:S.Conv2D,backendName:"cpu",kernelFunc:Mz};function IOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape;Ge([a,i],"conv2dBackpropFilter");for(var f=S.backend_util.convertConv2DDataFormat(u),h=S.backend_util.computeConv2DInfo(a.shape,l,o,1,s,c,!1,f),d=h.strideHeight,p=h.strideWidth,v=h.filterHeight,m=h.filterWidth,g=h.dataFormat==="channelsLast",y=new S.TensorBuffer(h.filterShape,"float32"),b=h.padInfo.left,w=h.padInfo.top,x=t.data.get(a.dataId).values,N=t.data.get(i.dataId).values,T=new S.TensorBuffer(a.shape,a.dtype,x),E=new S.TensorBuffer(i.shape,i.dtype,N),C=0;C<v;++C)for(var F=Math.max(0,Math.ceil((w-C)/d)),_=Math.min(h.outHeight,(h.inHeight+w-C)/d),O=0;O<m;++O)for(var L=Math.max(0,Math.ceil((b-O)/p)),z=Math.min(h.outWidth,(h.inWidth+b-O)/p),$=0;$<h.inChannels;++$)for(var B=0;B<h.outChannels;++B){for(var W=0,X=0;X<h.batchSize;++X)for(var Z=F;Z<_;++Z)for(var V=C+Z*d-w,j=L;j<z;++j){var re=O+j*p-b;g?W+=T.get(X,V,re,$)*E.get(X,Z,j,B):W+=T.get(X,$,V,re)*E.get(X,B,Z,j)}y.set(W,C,O,$,B)}return t.makeTensorInfo(y.shape,y.dtype,y.values)}var COe={kernelName:S.Conv2DBackpropFilter,backendName:"cpu",kernelFunc:IOe};function AOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode;Ge([a,i],"conv2dBackpropInput");var f=S.util.computeStrides(i.shape),h=S.util.computeStrides(a.shape),d=S.backend_util.convertConv2DDataFormat(c),p=S.backend_util.computeConv2DInfo(o,i.shape,s,1,u,l,!1,d),v=new S.TensorBuffer(p.inShape,"float32"),m=v.values,g=t.data.get(a.dataId).values,y=t.data.get(i.dataId).values,b=We(f,3),w=b[0],x=b[1],N=b[2],T=p.batchSize,E=p.filterHeight,C=p.filterWidth,F=p.inChannels,_=p.inHeight,O=p.inWidth,L=p.outChannels,z=p.outHeight,$=p.outWidth,B=p.strideHeight,W=p.strideWidth;d=p.dataFormat;for(var X=E-1-p.padInfo.top,Z=C-1-p.padInfo.left,V=d==="channelsLast",j=v.strides[0],re=V?v.strides[1]:v.strides[2],ne=V?v.strides[2]:1,oe=V?1:v.strides[1],le=h[0],pe=V?h[1]:h[2],xe=V?h[2]:1,he=V?1:h[1],ye=0;ye<T;++ye)for(var we=0;we<F;++we)for(var Ae=0;Ae<_;++Ae)for(var Ye=Ae-X,ht=Math.max(0,Math.ceil(Ye/B)),at=Math.min(z,(E+Ye)/B),rt=0;rt<O;++rt){for(var ft=rt-Z,st=Math.max(0,Math.ceil(ft/W)),Ze=Math.min($,(C+ft)/W),tt=0,et=ht;et<at;++et)for(var rn=et*B-Ye,He=st;He<Ze;++He)for(var kt=He*W-ft,An=le*ye+pe*et+xe*He,hr=w*(E-1-rn)+x*(C-1-kt)+N*we,On=0;On<L;++On){var Dn=g[An+he*On],an=y[hr+On];tt+=Dn*an}var Pr=j*ye+re*Ae+ne*rt+oe*we;m[Pr]=tt}return t.makeTensorInfo(v.shape,v.dtype,v.values)}var DOe={kernelName:S.Conv2DBackpropInput,backendName:"cpu",kernelFunc:AOe};function _Oe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=r.strides,s=r.pad,u=r.dilations;Ge([a,i],"conv3d");for(var c=S.backend_util.computeConv3DInfo(a.shape,i.shape,o,u,s),l=c.filterDepth,f=c.filterHeight,h=c.filterWidth,d=c.dilationDepth,p=c.dilationHeight,v=c.dilationWidth,m=c.padInfo,g=m.front,y=m.left,b=m.top,w=new S.TensorBuffer(c.outShape,a.dtype),x=t.data.get(a.dataId).values,N=t.data.get(i.dataId).values,T=w.values,E=S.util.computeStrides(a.shape),C=S.util.computeStrides(i.shape),F=0;F<c.batchSize;++F)for(var _=F*E[0],O=F*w.strides[0],L=0;L<c.outDepth;++L)for(var z=O+L*w.strides[1],$=L*c.strideDepth-g,B=0;B<l;++B){var W=$+B*d;if(!(W<0||W>=c.inDepth))for(var X=B*C[0],Z=_+W*E[1],V=0;V<c.outHeight;++V)for(var j=z+V*w.strides[2],re=V*c.strideHeight-b,ne=0;ne<f;++ne){var oe=re+ne*p;if(!(oe<0||oe>=c.inHeight))for(var le=X+ne*C[1],pe=Z+oe*E[2],xe=0;xe<c.outWidth;++xe)for(var he=j+xe*c.outChannels,ye=xe*c.strideWidth-y,we=0;we<h;++we){var Ae=ye+we*v;if(!(Ae<0||Ae>=c.inWidth))for(var Ye=le+we*C[2],ht=pe+Ae*c.inChannels,at=Ye,rt=0;rt<c.inChannels;++rt){for(var ft=x[ht+rt],st=0;st<c.outChannels;++st)T[he+st]+=ft*N[at+st];at+=c.outChannels}}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}var FOe={kernelName:S.Conv3D,backendName:"cpu",kernelFunc:_Oe};function ROe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.dy,o=r.strides,s=r.pad,u=r.filterShape;Ge([a,i],"conv3dBackpropFilterV2");for(var c=S.util.computeStrides(a.shape),l=S.util.computeStrides(i.shape),f=S.backend_util.computeConv3DInfo(a.shape,u,o,1,s),h=f.strideDepth,d=f.strideHeight,p=f.strideWidth,v=f.filterDepth,m=f.filterHeight,g=f.filterWidth,y=new S.TensorBuffer(f.filterShape,"float32"),b=y.values,w=We(y.strides,4),x=w[0],N=w[1],T=w[2],E=w[3],C=t.data.get(i.dataId).values,F=We(l,4),_=F[0],O=F[1],L=F[2],z=F[3],$=t.data.get(a.dataId).values,B=We(c,4),W=B[0],X=B[1],Z=B[2],V=B[3],j=f.padInfo.front,re=f.padInfo.left,ne=f.padInfo.top,oe=0;oe<v;++oe)for(var le=Math.max(0,Math.ceil((j-oe)/h)),pe=Math.min(f.outDepth,(f.inDepth+j-oe)/h),xe=oe*x,he=0;he<m;++he)for(var ye=Math.max(0,Math.ceil((ne-he)/d)),we=Math.min(f.outHeight,(f.inHeight+ne-he)/d),Ae=he*N+xe,Ye=0;Ye<g;++Ye)for(var ht=Math.max(0,Math.ceil((re-Ye)/p)),at=Math.min(f.outWidth,(f.inWidth+re-Ye)/p),rt=Ye*T+Ae,ft=0;ft<f.inChannels;++ft)for(var st=ft*E+rt,Ze=0;Ze<f.outChannels;++Ze){for(var tt=0,et=0;et<f.batchSize;++et)for(var rn=et*W,He=et*_,kt=le;kt<pe;++kt)for(var An=oe+kt*h-j,hr=An*X+rn,On=kt*O+He,Dn=ye;Dn<we;++Dn)for(var an=he+Dn*d-ne,Pr=an*Z+hr,dr=Dn*L+On,Mr=ht;Mr<at;++Mr){var Sn=Ye+Mr*p-re,Vi=Sn*V+Pr,Iu=Mr*z+dr;tt+=$[Vi+ft]*C[Iu+Ze]}b[st+Ze]=tt}return t.makeTensorInfo(y.shape,y.dtype,y.values)}var OOe={kernelName:S.Conv3DBackpropFilterV2,backendName:"cpu",kernelFunc:ROe};function POe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.filter,o=r.pad,s=r.strides,u=r.inputShape;Ge([a],"conv3dBackpropInputV2");for(var c=S.util.computeStrides(a.shape),l=S.util.computeStrides(i.shape),f=S.backend_util.computeConv3DInfo(u,i.shape,s,1,o),h=new S.TensorBuffer(f.inShape,"float32"),d=h.values,p=We(h.strides,4),v=p[0],m=p[1],g=p[2],y=p[3],b=t.data.get(a.dataId).values,w=We(c,4),x=w[0],N=w[1],T=w[2],E=w[3],C=t.data.get(i.dataId).values,F=We(l,4),_=F[0],O=F[1],L=F[2],z=F[3],$=f.batchSize,B=f.filterDepth,W=f.filterHeight,X=f.filterWidth,Z=f.inChannels,V=f.inDepth,j=f.inHeight,re=f.inWidth,ne=f.outChannels,oe=f.outDepth,le=f.outHeight,pe=f.outWidth,xe=f.strideDepth,he=f.strideHeight,ye=f.strideWidth,we=B-1-f.padInfo.front,Ae=W-1-f.padInfo.top,Ye=X-1-f.padInfo.left,ht=0;ht<$;++ht)for(var at=0;at<Z;++at)for(var rt=0;rt<V;++rt)for(var ft=rt-we,st=Math.max(0,Math.ceil(ft/xe)),Ze=Math.min(oe,(B+ft)/xe),tt=0;tt<j;++tt)for(var et=tt-Ae,rn=Math.max(0,Math.ceil(et/he)),He=Math.min(le,(W+et)/he),kt=0;kt<re;++kt){for(var An=kt-Ye,hr=Math.max(0,Math.ceil(An/ye)),On=Math.min(pe,(X+An)/ye),Dn=0,an=st;an<Ze;++an)for(var Pr=an*xe-ft,dr=rn;dr<He;++dr)for(var Mr=dr*he-et,Sn=hr;Sn<On;++Sn)for(var Vi=Sn*ye-An,Iu=x*ht+N*an+T*dr+E*Sn,Kh=_*(B-1-Pr)+O*(W-1-Mr)+L*(X-1-Vi)+z*at,Gi=0;Gi<ne;++Gi){var os=b[Iu+Gi],Cu=C[Kh+Gi];Dn+=os*Cu}d[v*ht+m*rt+g*tt+y*kt+at]=Dn}return t.makeTensorInfo(h.shape,h.dtype,h.values)}var MOe={kernelName:S.Conv3DBackpropInputV2,backendName:"cpu",kernelFunc:POe};var BOe=Mt(S.Cos,function(n){return Math.cos(n)}),LOe={kernelName:S.Cos,backendName:"cpu",kernelFunc:BOe};var zOe=Mt(S.Cosh,function(n){return Math.cosh(n)}),$Oe={kernelName:S.Cosh,backendName:"cpu",kernelFunc:zOe};function qOe(n){for(var e=n.inputs,t=n.backend,r=n.attrs,a=e.image,i=e.boxes,o=e.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=We(a.shape,4),f=l[0],h=l[1],d=l[2],p=l[3],v=i.shape[0],m=We(s,2),g=m[0],y=m[1],b=S.buffer([v,g,y,p],"float32"),w=t.data.get(i.dataId).values,x=t.data.get(o.dataId).values,N=t.data.get(a.dataId).values,T=S.util.computeStrides(a.shape),E=S.util.computeStrides(b.shape),C=0;C<v;C++){var F=C*4,_=w[F],O=w[F+1],L=w[F+2],z=w[F+3],$=x[C];if(!($>=f))for(var B=g>1?(L-_)*(h-1)/(g-1):0,W=y>1?(z-O)*(d-1)/(y-1):0,X=0;X<g;X++){var Z=g>1?_*(h-1)+X*B:.5*(_+L)*(h-1);if(Z<0||Z>h-1){for(var V=0;V<y;V++)for(var j=0;j<p;j++){var re=j+V*E[2]+X*E[1]+C*E[0];b.values[re]=c}continue}if(u==="bilinear")for(var ne=Math.floor(Z),oe=Math.ceil(Z),le=Z-ne,V=0;V<y;V++){var pe=y>1?O*(d-1)+V*W:.5*(O+z)*(d-1);if(pe<0||pe>d-1){for(var j=0;j<p;j++){var re=j+V*E[2]+X*E[1]+C*E[0];b.values[re]=c}continue}for(var xe=Math.floor(pe),he=Math.ceil(pe),ye=pe-xe,j=0;j<p;j++){var re=j+xe*T[2]+ne*T[1]+$*T[0],we=N[re];re=j+he*T[2]+ne*T[1]+$*T[0];var Ae=N[re];re=j+xe*T[2]+oe*T[1]+$*T[0];var Ye=N[re];re=j+he*T[2]+oe*T[1]+$*T[0];var ht=N[re],at=we+(Ae-we)*ye,rt=Ye+(ht-Ye)*ye;re=j+V*E[2]+X*E[1]+C*E[0],b.values[re]=at+(rt-at)*le}}else for(var V=0;V<y;++V){var pe=y>1?O*(d-1)+V*W:.5*(O+z)*(d-1);if(pe<0||pe>d-1){for(var j=0;j<p;j++){var re=j+V*E[2]+X*E[1]+C*E[0];b.values[re]=c}continue}for(var ft=Math.round(pe),st=Math.round(Z),j=0;j<p;j++){var Ze=j+ft*T[2]+st*T[1]+$*T[0],tt=j+V*E[2]+X*E[1]+C*E[0];b.values[tt]=N[Ze]}}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}var WOe={kernelName:S.CropAndResize,backendName:"cpu",kernelFunc:qOe};function VOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.exclusive,s=r.reverse;Ge(a,"cumprod");var u=S.backend_util.getAxesPermutation([i],a.shape.length),c=a;u!=null&&(c=Or({inputs:{x:a},backend:t,attrs:{perm:u}}));var l=S.backend_util.getInnerMostAxes(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var f=S.upcastType(c.dtype,"int32"),h=S.util.makeOnesTypedArray(S.util.sizeFromShape(c.shape),f),d=t.data.get(c.dataId).values,p=c.shape[c.shape.length-1],v=s?function(T,E){return T+p-E-1}:function(T,E){return T+E},m=0;m<d.length;m+=p)for(var g=0;g<p;g++){var y=v(m,g);if(g===0)h[y]=o?1:d[y];else{var b=v(m,g-1);h[y]=o?d[b]*h[b]:d[y]*h[b]}}var w=t.makeTensorInfo(c.shape,f,h);if(u!=null){var x=S.backend_util.getUndoAxesPermutation(u),N=Or({inputs:{x:w},backend:t,attrs:{perm:x}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(c),N}return w}var GOe={kernelName:S.Cumprod,backendName:"cpu",kernelFunc:VOe};function UOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.exclusive,s=r.reverse;Ge(a,"cumsum");var u=S.backend_util.getAxesPermutation([i],a.shape.length),c=a;u!=null&&(c=Or({inputs:{x:a},backend:t,attrs:{perm:u}}));var l=S.backend_util.getInnerMostAxes(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var f=S.upcastType(c.dtype,"int32"),h=S.util.makeZerosTypedArray(S.util.sizeFromShape(c.shape),f),d=t.data.get(c.dataId).values,p=c.shape[c.shape.length-1],v=s?function(T,E){return T+p-E-1}:function(T,E){return T+E},m=0;m<d.length;m+=p)for(var g=0;g<p;g++){var y=v(m,g);if(g===0)h[y]=o?0:d[y];else{var b=v(m,g-1);h[y]=o?d[b]+h[b]:d[y]+h[b]}}var w=t.makeTensorInfo(c.shape,f,h);if(u!=null){var x=S.backend_util.getUndoAxesPermutation(u),N=Or({inputs:{x:w},backend:t,attrs:{perm:x}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(c),N}return w}var HOe={kernelName:S.Cumsum,backendName:"cpu",kernelFunc:UOe};function KOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.weights,o=r.size,s=r.binaryOutput;if(a.shape.length===1){var u=t.data.get(a.dataId).values,c=t.data.get(i.dataId).values,l=px(u,c,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,l)}else if(a.shape.length===2){var f=t.bufferSync(a),h=t.bufferSync(i),d=$L(f,h,o,s);return t.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}var jOe={kernelName:S.DenseBincount,backendName:"cpu",kernelFunc:KOe};function XOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.blockSize,o=r.dataFormat;S.util.assert(o==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(o)});for(var s=a.shape[0],u=a.shape[1],c=a.shape[2],l=a.shape[3],f=u*i,h=c*i,d=l/(i*i),p=t.data.get(a.dataId).values,v=new Float32Array(s*f*h*d),m=0,g=0;g<s;++g)for(var y=0;y<f;++y)for(var b=Math.floor(y/i),w=y%i,x=0;x<h;++x)for(var N=Math.floor(x/i),T=x%i,E=(w*i+T)*d,C=0;C<d;++C){var F=C+E,_=F+l*(N+c*(b+u*g));v[m++]=p[_]}return t.makeTensorInfo([s,f,h,d],a.dtype,v)}var YOe={kernelName:S.DepthToSpace,backendName:"cpu",kernelFunc:XOe};function Bz(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode;Ge([a,i],"depthwiseConv2DNative");var l=S.util.computeStrides(a.shape),f=S.util.computeStrides(i.shape),h=u;h==null&&(h=[1,1]),S.util.assert(S.backend_util.eitherStridesOrDilationsAreOne(o,h),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(h,"'")});for(var d=S.backend_util.computeConv2DInfo(a.shape,i.shape,o,h,s,c,!0),p=d.filterHeight,v=d.filterWidth,m=d.dilationHeight,g=d.dilationWidth,y=d.padInfo,b=y.left,w=y.top,x=d.outChannels/d.inChannels,N=new S.TensorBuffer(d.outShape,a.dtype),T=t.data.get(a.dataId).values,E=t.data.get(i.dataId).values,C=N.values,F=0;F<d.batchSize;++F)for(var _=F*l[0],O=F*N.strides[0],L=0;L<d.outHeight;++L)for(var z=O+L*N.strides[1],$=L*d.strideHeight-w,B=0;B<p;++B){var W=$+B*m;if(!(W<0||W>=d.inHeight))for(var X=B*f[0],Z=_+W*l[1],V=0;V<d.outWidth;++V)for(var j=z+V*N.strides[2],re=V*d.strideWidth-b,ne=0;ne<v;++ne){var oe=re+ne*g;if(!(oe<0||oe>=d.inWidth))for(var le=X+ne*f[1],pe=Z+oe*d.inChannels,xe=j,he=le,ye=0;ye<d.inChannels;++ye){for(var we=T[pe+ye],Ae=0;Ae<x;++Ae)C[xe+Ae]+=we*E[he+Ae];xe+=x,he+=x}}}return t.makeTensorInfo(N.shape,N.dtype,N.values)}var ZOe={kernelName:S.DepthwiseConv2dNative,backendName:"cpu",kernelFunc:Bz};function JOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape;Ge([a,i],"depthwiseConv2dNativeBackpropFilter");for(var f=S.backend_util.computeConv2DInfo(a.shape,l,o,s,u,c,!0),h=f.strideHeight,d=f.strideWidth,p=f.filterHeight,v=f.filterWidth,m=new S.TensorBuffer(f.filterShape,"float32"),g=f.padInfo.left,y=f.padInfo.top,b=f.outChannels/f.inChannels,w=t.data.get(a.dataId).values,x=new S.TensorBuffer(a.shape,a.dtype,w),N=t.data.get(i.dataId).values,T=new S.TensorBuffer(i.shape,i.dtype,N),E=0;E<p;++E)for(var C=Math.max(0,Math.ceil((y-E)/h)),F=Math.min(f.outHeight,(f.inHeight+y-E)/h),_=0;_<v;++_)for(var O=Math.max(0,Math.ceil((g-_)/d)),L=Math.min(f.outWidth,(f.inWidth+g-_)/d),z=0;z<f.outChannels;++z){for(var $=Math.trunc(z/b),B=z%b,W=0,X=0;X<f.batchSize;++X)for(var Z=C;Z<F;++Z)for(var V=E+Z*h-y,j=O;j<L;++j){var re=_+j*d-g;W+=x.get(X,V,re,$)*T.get(X,Z,j,z)}m.set(W,E,_,$,B)}return t.makeTensorInfo(m.shape,m.dtype,m.values)}var QOe={kernelName:S.DepthwiseConv2dNativeBackpropFilter,backendName:"cpu",kernelFunc:JOe};function ePe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.inputShape;Ge([a,i],"depthwiseConv2DNativeBackpropInput");for(var f=S.util.computeStrides(a.shape),h=S.util.computeStrides(i.shape),d=S.backend_util.computeConv2DInfo(l,i.shape,o,s,u,c,!0),p=new S.TensorBuffer(d.inShape,"float32"),v=p.values,m=We(p.strides,3),g=m[0],y=m[1],b=m[2],w=t.data.get(a.dataId).values,x=We(f,3),N=x[0],T=x[1],E=x[2],C=t.data.get(i.dataId).values,F=We(h,3),_=F[0],O=F[1],L=F[2],z=d.batchSize,$=d.filterHeight,B=d.filterWidth,W=d.inChannels,X=d.inHeight,Z=d.inWidth,V=d.outChannels,j=d.outHeight,re=d.outWidth,ne=d.strideHeight,oe=d.strideWidth,le=$-1-d.padInfo.top,pe=B-1-d.padInfo.left,xe=V/W,he=0;he<z;++he)for(var ye=0;ye<W;++ye)for(var we=0;we<X;++we)for(var Ae=we-le,Ye=Math.max(0,Math.ceil(Ae/ne)),ht=Math.min(j,($+Ae)/ne),at=0;at<Z;++at){for(var rt=at-pe,ft=Math.max(0,Math.ceil(rt/oe)),st=Math.min(re,(B+rt)/oe),Ze=0,tt=Ye;tt<ht;++tt)for(var et=tt*ne-Ae,rn=ft;rn<st;++rn)for(var He=rn*oe-rt,kt=N*he+T*tt+E*rn,An=_*($-1-et)+O*(B-1-He)+L*ye,hr=0;hr<xe;++hr){var On=ye*xe+hr,Dn=w[kt+On],an=C[An+hr];Ze+=Dn*an}v[g*he+y*we+b*at+ye]=Ze}return t.makeTensorInfo(p.shape,p.dtype,p.values)}var tPe={kernelName:S.DepthwiseConv2dNativeBackpropInput,backendName:"cpu",kernelFunc:ePe};function nPe(n){for(var e=n.inputs,t=n.backend,r=e.x,a=S.util.sizeFromShape(r.shape),i=t.data.get(r.dataId).values,o=S.buffer([a,a],r.dtype),s=o.values,u=0;u<i.length;u++)s[u*a+u]=i[u];var c=ya(ya([],We(r.shape),!1),We(r.shape),!1);return t.makeTensorInfo(c,o.dtype,o.values)}var rPe={kernelName:S.Diag,backendName:"cpu",kernelFunc:nPe};var aPe={kernelName:S.Dilation2D,backendName:"cpu",kernelFunc:function(n){for(var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=r.strides,s=r.pad,u=r.dilations,c=t,l=c.data.get(a.dataId).values,f=a.shape.length,h=c.data.get(i.dataId).values,d=i.shape.length,p=S.backend_util.computeDilation2DInfo(a.shape,i.shape,o,s,"NHWC",u),v=p.batchSize,m=p.inHeight,g=p.inWidth,y=p.inChannels,b=p.outHeight,w=p.outWidth,x=p.padInfo,N=p.strideHeight,T=p.strideWidth,E=p.filterHeight,C=p.filterWidth,F=p.dilationHeight,_=p.dilationWidth,O=p.outShape,L=S.util.sizeFromShape(O),z=O.length,$=S.util.getArrayFromDType(a.dtype,L),B=0;B<v;++B)for(var W=0;W<b;++W)for(var X=W*N-x.top,Z=0;Z<w;++Z)for(var V=Z*T-x.left,j=0;j<y;++j){for(var re=Number.MIN_SAFE_INTEGER,ne=0;ne<E;++ne){var oe=X+ne*F;if(oe>=0&&oe<m)for(var le=0;le<C;++le){var pe=V+le*_;if(pe>=0&&pe<g){var xe=S.util.locToIndex([B,oe,pe,j],f,S.util.computeStrides(a.shape)),he=S.util.locToIndex([ne,le,j],d,S.util.computeStrides(i.shape)),ye=l[xe]+h[he];ye>re&&(re=ye)}}}var we=S.util.locToIndex([B,W,Z,j],z,S.util.computeStrides(O));$[we]=re}var Ae=c.write(S.util.toTypedArray($,a.dtype),O,a.dtype);return{dataId:Ae,shape:O,dtype:a.dtype}}};var iPe={kernelName:S.Dilation2DBackpropFilter,backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=e.dy,s=r.strides,u=r.pad,c=r.dilations,l=t,f=S.util.toNestedArray(a.shape,l.data.get(a.dataId).values),h=S.util.toNestedArray(i.shape,l.data.get(i.dataId).values),d=S.backend_util.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),p=d.batchSize,v=d.inHeight,m=d.inWidth,g=d.inChannels,y=d.outHeight,b=d.outWidth,w=d.padInfo,x=d.strideHeight,N=d.strideWidth,T=d.filterHeight,E=d.filterWidth,C=d.dilationHeight,F=d.dilationWidth,_=d.outShape;S.util.assert(o.rank===_.length,function(){return"Error in ".concat(S.Dilation2DBackpropFilter,", dy ")+"must have the same rank as output ".concat(_.length,", but got ")+"".concat(o.rank)});for(var O=S.util.toNestedArray(_,l.data.get(o.dataId).values),L=S.util.makeZerosNestedTypedArray(i.shape,i.dtype),z=0;z<p;++z)for(var $=0;$<y;++$)for(var B=$*x-w.top,W=0;W<b;++W)for(var X=W*N-w.left,Z=0;Z<g;++Z){for(var V=Number.MIN_SAFE_INTEGER,j=0,re=0,ne=0;ne<T;++ne){var oe=B+ne*C;if(oe>=0&&oe<v)for(var le=0;le<E;++le){var pe=X+le*F;if(pe>=0&&pe<m){var xe=f[z][oe][pe][Z]+h[ne][le][Z];xe>V&&(V=xe,j=ne,re=le)}}}L[j][re][Z]+=O[z][$][W][Z]}var he=l.write(S.util.toTypedArray(L,a.dtype),i.shape,i.dtype);return{dataId:he,shape:i.shape,dtype:i.dtype}}};var oPe={kernelName:S.Dilation2DBackpropInput,backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=e.dy,s=r.strides,u=r.pad,c=r.dilations,l=t,f=S.util.toNestedArray(a.shape,l.data.get(a.dataId).values),h=S.util.toNestedArray(i.shape,l.data.get(i.dataId).values),d=S.backend_util.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),p=d.batchSize,v=d.inHeight,m=d.inWidth,g=d.inChannels,y=d.outHeight,b=d.outWidth,w=d.padInfo,x=d.strideHeight,N=d.strideWidth,T=d.filterHeight,E=d.filterWidth,C=d.dilationHeight,F=d.dilationWidth,_=d.outShape;S.util.assert(o.rank===_.length,function(){return"Error in ".concat(S.Dilation2DBackpropInput,", dy ")+"must have the same rank as output ".concat(_.length,", but got ")+"".concat(o.rank)});for(var O=S.util.toNestedArray(_,l.data.get(o.dataId).values),L=S.util.makeZerosNestedTypedArray(a.shape,a.dtype),z=0;z<p;++z)for(var $=0;$<y;++$)for(var B=$*x-w.top,W=0;W<b;++W)for(var X=W*N-w.left,Z=0;Z<g;++Z){for(var V=Number.MIN_SAFE_INTEGER,j=B<0?0:B,re=X<0?0:X,ne=0;ne<T;++ne){var oe=B+ne*C;if(oe>=0&&oe<v)for(var le=0;le<E;++le){var pe=X+le*F;if(pe>=0&&pe<m){var xe=f[z][oe][pe][Z]+h[ne][le][Z];xe>V&&(V=xe,j=oe,re=pe)}}}L[z][j][re][Z]+=O[z][$][W][Z]}var he=l.write(S.util.toTypedArray(L,a.dtype),a.shape,a.dtype);return{dataId:he,shape:a.shape,dtype:a.dtype}}};function ih(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims;Ge(a,"sum");var s;a.dtype==="bool"?s=Zo({inputs:{x:a},backend:t,attrs:{dtype:"int32"}}):s=Pi({inputs:{x:a},backend:t});var u=s.shape.length,c=S.util.parseAxisParam(i,s.shape),l=S.backend_util.getAxesPermutation(c,u),f=c,h=s;l!=null&&(h=Or({inputs:{x:s},backend:t,attrs:{perm:l}}),f=S.backend_util.getInnerMostAxes(f.length,u)),S.backend_util.assertAxesAreInnerMostDims("sum",f,h.shape.length);for(var d=We(S.backend_util.computeOutAndReduceShapes(h.shape,f),2),p=d[0],v=d[1],m=S.backend_util.upcastType(h.dtype,"int32"),g=Uv(t,p,m),y=S.util.sizeFromShape(v),b=t.data.get(g.dataId).values,w=t.data.get(h.dataId).values,x=0;x<b.length;++x){for(var N=x*y,T=0,E=0;E<y;++E)T+=w[N+E];b[x]=T}if(o){var C=S.backend_util.expandShapeToKeepDim(g.shape,c),F=g;g=qt({inputs:{x:g},backend:t,attrs:{shape:C}}),t.disposeIntermediateTensorInfo(F)}return t.disposeIntermediateTensorInfo(s),l!=null&&t.disposeIntermediateTensorInfo(h),g}var sPe={kernelName:S.Sum,backendName:"cpu",kernelFunc:ih};function uPe(n){var e,t,r,a,i=n.inputs,o=n.backend,s=n.attrs,u=s.equation,c=i,l=S.backend_util.decodeEinsumEquation(u,c.length),f=l.allDims,h=l.summedDims,d=l.idDims;S.backend_util.checkEinsumDimSizes(f.length,d,c);for(var p=S.backend_util.getEinsumComputePath(h,d),v=p.path,m=p.steps,g=m.length,y=null,b=f.length,w=[],x=0;x<g;++x){try{for(var N=(e=void 0,Pc(m[x])),T=N.next();!T.done;T=N.next()){var E=T.value,C=S.backend_util.getEinsumPermutation(b,d[E]),F=C.permutationIndices,_=C.expandDims,O=void 0;S.backend_util.isIdentityPermutation(F)?O=c[E]:(O=Or({inputs:{x:c[E]},backend:o,attrs:{perm:F}}),w.push(O));for(var L=O.shape.slice(),z=0;z<_.length;++z)L.splice(_[z],0,1);S.util.arraysEqual(O.shape,L)||(O=qt({inputs:{x:O},backend:o,attrs:{shape:L}}),w.push(O)),y===null?y=O:(y=Xv({inputs:{a:O,b:y},backend:o}),w.push(y))}}catch(X){e={error:X}}finally{try{T&&!T.done&&(t=N.return)&&t.call(N)}finally{if(e)throw e.error}}x<g-1&&(v[x]>=0&&(y=ih({inputs:{x:y},backend:o,attrs:{axis:v[x]-(f.length-b),keepDims:!1}}),w.push(y)),b--)}try{for(var $=Pc(w),B=$.next();!B.done;B=$.next()){var W=B.value;W!==y&&o.disposeIntermediateTensorInfo(W)}}catch(X){r={error:X}}finally{try{B&&!B.done&&(a=$.return)&&a.call($)}finally{if(r)throw r.error}}return y}var cPe={kernelName:S.Einsum,backendName:"cpu",kernelFunc:uPe};function lPe(n){var e=n.inputs,t=n.backend,r=e.dy,a=e.y;Ge([r,a],"eluGrad");for(var i=new Float32Array(S.util.sizeFromShape(a.shape)),o=t.data.get(a.dataId).values,s=t.data.get(r.dataId).values,u=0;u<o.length;++u){var c=o[u];c>=1?i[u]=s[u]:i[u]=s[u]*(c+1)}return t.makeTensorInfo(a.shape,"float32",i)}var fPe={kernelName:S.EluGrad,backendName:"cpu",kernelFunc:lPe};var hPe=S.backend_util.ERF_P,dPe=S.backend_util.ERF_A1,pPe=S.backend_util.ERF_A2,vPe=S.backend_util.ERF_A3,mPe=S.backend_util.ERF_A4,gPe=S.backend_util.ERF_A5,yPe=Mt(S.Erf,function(n){var e=Math.sign(n),t=Math.abs(n),r=1/(1+hPe*t);return e*(1-((((gPe*r+mPe)*r+vPe)*r+pPe)*r+dPe)*r*Math.exp(-t*t))}),bPe={kernelName:S.Erf,backendName:"cpu",kernelFunc:yPe};function Kv(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.input,i=r.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(S.util.assert(-(o+1)<=i,function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")}),u=o+i+1),s.splice(u,0,1),qt({inputs:{x:a},backend:t,attrs:{shape:s}})}var wPe={kernelName:S.ExpandDims,backendName:"cpu",kernelFunc:Kv};var xPe=zn(function(n,e){return n/e}),wx=Zn(S.RealDiv,xPe),lx={kernelName:S.RealDiv,backendName:"cpu",kernelFunc:wx};function Lz(n,e,t){for(var r=n.shape,a=r[0],i=r[1],o=t.data.get(n.dataId),s=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,c=[a,i],l=S.util.sizeFromShape(c),f=S.util.getTypedArrayFromDType("float32",l),h=S.util.getTypedArrayFromDType("float32",l),d=0;d<a;d++){for(var p=cu({inputs:{x:s},backend:t,attrs:{begin:[d,0],size:[1,i]}}),v=cu({inputs:{x:u},backend:t,attrs:{begin:[d,0],size:[1,i]}}),m=na({inputs:{real:p,imag:v},backend:t}),g=kPe(m,e,t),y=g.real,b=g.imag,w=S.backend_util.mergeRealAndImagArrays(y,b),x=0;x<i;x++){var N=S.backend_util.getComplexWithIndex(w,x);f[d*i+x]=N.real,h[d*i+x]=N.imag}t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(m)}var T=t.makeTensorInfo(c,"float32",f),E=t.makeTensorInfo(c,"float32",h),C=na({inputs:{real:T,imag:E},backend:t});return t.disposeIntermediateTensorInfo(T),t.disposeIntermediateTensorInfo(E),C}function kPe(n,e,t){var r=S.util.sizeFromShape(n.shape),a=t.data.get(n.dataId),i=t.data.get(a.complexTensorInfos.real.dataId).values,o=t.data.get(a.complexTensorInfos.imag.dataId).values;if(SPe(r)){var s=fx(i,o,r,e,t),u=[n.shape[0],n.shape[1]];if(e){var c=t.makeTensorInfo(u,"float32",s.real),l=t.makeTensorInfo(u,"float32",s.imag),f=t.makeTensorInfo([],"float32",S.util.createScalarValue(r,"float32")),h=Pi({inputs:{x:f},backend:t}),d=lx.kernelFunc({inputs:{a:c,b:f},backend:t}),p=lx.kernelFunc({inputs:{a:l,b:h},backend:t}),v=t.data.get(d.dataId).values,m=t.data.get(p.dataId).values;return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(p),{real:v,imag:m}}return s}else{var g=S.backend_util.mergeRealAndImagArrays(i,o),y=NPe(g,r,e);return S.backend_util.splitRealAndImagArrays(y)}}function SPe(n){return(n&n-1)===0}function fx(n,e,t,r,a){if(t===1)return{real:n,imag:e};var i=S.backend_util.mergeRealAndImagArrays(n,e),o=t/2,s=S.backend_util.complexWithEvenIndex(i),u=s.real,c=s.imag,l=[u.length],f=a.makeTensorInfo(l,"float32",u),h=a.makeTensorInfo(l,"float32",c),d=na({inputs:{real:f,imag:h},backend:a}),p=S.backend_util.complexWithOddIndex(i),v=p.real,m=p.imag,g=[v.length],y=a.makeTensorInfo(g,"float32",v),b=a.makeTensorInfo(g,"float32",m),w=na({inputs:{real:y,imag:b},backend:a}),x=fx(u,c,o,r,a),N=x.real,T=x.imag,E=[N.length],C=a.makeTensorInfo(E,"float32",N),F=a.makeTensorInfo(E,"float32",T),_=na({inputs:{real:C,imag:F},backend:a}),O=fx(v,m,o,r,a),L=O.real,z=O.imag,$=[L.length],B=a.makeTensorInfo($,"float32",L),W=a.makeTensorInfo($,"float32",z),X=na({inputs:{real:B,imag:W},backend:a}),Z=S.backend_util.exponents(t,r),V=[Z.real.length],j=a.makeTensorInfo(V,"float32",Z.real),re=a.makeTensorInfo(V,"float32",Z.imag),ne=na({inputs:{real:j,imag:re},backend:a}),oe=Xv({inputs:{a:ne,b:X},backend:a}),le=Mc({inputs:{a:_,b:oe},backend:a}),pe=yx({inputs:{a:_,b:oe},backend:a}),xe=uu({inputs:{input:le},backend:a}),he=uu({inputs:{input:pe},backend:a}),ye=Bc({inputs:{input:le},backend:a}),we=Bc({inputs:{input:pe},backend:a}),Ae=Lc({inputs:[xe,he],backend:a,attrs:{axis:0}}),Ye=Lc({inputs:[ye,we],backend:a,attrs:{axis:0}}),ht=a.data.get(Ae.dataId).values,at=a.data.get(Ye.dataId).values;return a.disposeIntermediateTensorInfo(f),a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(d),a.disposeIntermediateTensorInfo(y),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(w),a.disposeIntermediateTensorInfo(C),a.disposeIntermediateTensorInfo(F),a.disposeIntermediateTensorInfo(_),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(X),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(re),a.disposeIntermediateTensorInfo(ne),a.disposeIntermediateTensorInfo(oe),a.disposeIntermediateTensorInfo(le),a.disposeIntermediateTensorInfo(pe),a.disposeIntermediateTensorInfo(xe),a.disposeIntermediateTensorInfo(ye),a.disposeIntermediateTensorInfo(he),a.disposeIntermediateTensorInfo(we),a.disposeIntermediateTensorInfo(Ae),a.disposeIntermediateTensorInfo(Ye),{real:ht,imag:at}}function NPe(n,e,t){for(var r=new Float32Array(e*2),a=0;a<e;a++){for(var i=0,o=0,s=0;s<e;s++){var u=S.backend_util.exponent(a*s,e,t),c=S.backend_util.getComplexWithIndex(n,s);i+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}t&&(i/=e,o/=e),S.backend_util.assignToTypedArray(r,i,o,a)}return r}function TPe(n){var e=n.inputs,t=n.backend,r=e.input,a=S.util.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],o=a/i,s=qt({inputs:{x:r},backend:t,attrs:{shape:[o,i]}}),u=Lz(s,!1,t),c=qt({inputs:{x:u},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(u),c}var EPe={kernelName:S.FFT,backendName:"cpu",kernelFunc:TPe};function xx(n){var e=n.backend,t=n.attrs,r=t.shape,a=t.value,i=t.dtype,o=i||S.util.inferDtype(a),s=S.util.getArrayFromDType(o,S.util.sizeFromShape(r));return CPe(s,a,o),e.makeTensorInfo(r,o,s)}var IPe={kernelName:S.Fill,backendName:"cpu",kernelFunc:xx};function CPe(n,e,t){n.fill(e)}var APe={kernelName:S.FlipLeftRight,backendName:"cpu",kernelFunc:function(n){var e=n.inputs;n.attrs;for(var t=n.backend,r=e.image,a=t,i=S.util.getTypedArrayFromDType(r.dtype,S.util.sizeFromShape(r.shape)),o=We(r.shape,4),s=o[0],u=o[1],c=o[2],l=o[3],f=a.data.get(r.dataId).values,h=0;h<s;h++)for(var d=h*c*u*l,p=0;p<u;p++)for(var v=p*(c*l),m=0;m<c;m++)for(var g=m*l,y=0;y<l;y++){var b=Math.round(c-m-1),w=d+v+g+y,x=f[w];if(b>=0&&b<c){var N=b*l,T=d+v+N+y;x=f[T]}i[w]=x}var E=a.write(i,r.shape,r.dtype);return{dataId:E,shape:r.shape,dtype:r.dtype}}};var DPe=zn(function(n,e){return Math.floor(n/e)}),_Pe=Zn(S.FloorDiv,DPe,null,"int32"),FPe={kernelName:S.FloorDiv,backendName:"cpu",kernelFunc:_Pe};function RPe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,f=r.dilations,h=r.dimRoundingMode,d=r.activation,p=r.leakyreluAlpha,v=Mz({inputs:{x:a,filter:i},backend:t,attrs:{strides:u,pad:c,dataFormat:l,dilations:f,dimRoundingMode:h}});if(o){var m=v;if(l==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){var g=qt({inputs:{x:o},backend:t,attrs:{shape:[o.shape[0],1,1]}});v=Mc({inputs:{a:v,b:g},backend:t}),t.disposeIntermediateTensorInfo(g)}else v=Mc({inputs:{a:v,b:o},backend:t});t.disposeIntermediateTensorInfo(m)}if(d){var m=v;if(l==="NCHW"&&d==="prelu"&&s.shape.length===1&&s.shape[0]!==1){var y=qt({inputs:{x:s},backend:t,attrs:{shape:[s.shape[0],1,1]}});v=Hv(t,v,d,y,p),t.disposeIntermediateTensorInfo(y)}else v=Hv(t,v,d,s,p);t.disposeIntermediateTensorInfo(m)}return v}var OPe={kernelName:S.FusedConv2D,backendName:"cpu",kernelFunc:RPe};function PPe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,f=r.dilations,h=r.dimRoundingMode,d=r.activation,p=r.leakyreluAlpha,v=Bz({inputs:{x:a,filter:i},backend:t,attrs:{strides:u,pad:c,dataFormat:l,dilations:f,dimRoundingMode:h}});if(o){var m=v;v=Mc({inputs:{a:v,b:o},backend:t}),t.disposeIntermediateTensorInfo(m)}if(d){var m=v;v=Hv(t,v,d,s,p),t.disposeIntermediateTensorInfo(m)}return v}var MPe={kernelName:S.FusedDepthwiseConv2D,backendName:"cpu",kernelFunc:PPe};function BPe(n){var e=n.inputs,t=n.backend,r=e.params,a=e.indices,i=S.util.sizeFromShape(r.shape),o=a.shape,s=o[o.length-1],u=We(S.backend_util.prepareAndValidate(r,a),4),c=u[0],l=u[1],f=u[2],h=u[3];if(l===0)return t.makeTensorInfo(c,r.dtype,[]);var d=t.data.get(a.dataId).values,p=t.bufferSync(r),v=XL(d,p,r.dtype,l,s,f,h,r.shape,i);return t.makeTensorInfo(c,r.dtype,v.values)}var LPe={kernelName:S.GatherNd,backendName:"cpu",kernelFunc:BPe};function zPe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.indices,o=r.axis,s=r.batchDims;Ge([a,i],"gatherV2");for(var u=S.util.parseAxisParam(o,a.shape)[0],c=t.data.get(i.dataId).values,l=a.shape[u],f=function(N){var T=c[N];S.util.assert(T<=l-1&&T>=0,function(){return"GatherV2: the index value ".concat(T," is not in [0, ").concat(l-1,"]")})},h=0;h<c.length;++h)f(h);var d=s;s==null&&(d=0);var p=S.util.sizeFromShape(i.shape),v=S.backend_util.segment_util.collectGatherOpShapeInfo(a,i,u,d),m=qt({inputs:{x:a},backend:t,attrs:{shape:[v.batchSize,v.outerSize,v.dimSize,v.sliceSize]}}),g=qt({inputs:{x:i},backend:t,attrs:{shape:[v.batchSize,p/v.batchSize]}}),y=[v.batchSize,v.outerSize,p/v.batchSize,v.sliceSize],b=t.bufferSync(g),w=t.bufferSync(m),x=YL(w,b,y);return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.makeTensorInfo(v.outputShape,x.dtype,x.values)}var $Pe={kernelName:S.GatherV2,backendName:"cpu",kernelFunc:zPe};function qPe(n){var e=n.inputs,t=n.backend,r=e.input,a=S.util.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],o=a/i,s=qt({inputs:{x:r},backend:t,attrs:{shape:[o,i]}}),u=Lz(s,!0,t),c=qt({inputs:{x:u},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(u),c}var WPe={kernelName:S.IFFT,backendName:"cpu",kernelFunc:qPe};var VPe=Mt(S.IsFinite,function(n){return Number.isFinite(n)?1:0},"bool"),GPe={kernelName:S.IsFinite,backendName:"cpu",kernelFunc:VPe};var UPe=Mt(S.IsInf,function(n){return Math.abs(n)===1/0?1:0},"bool"),HPe={kernelName:S.IsInf,backendName:"cpu",kernelFunc:UPe};var KPe=Mt(S.IsNan,function(n){return Number.isNaN(n)?1:0},"bool"),jPe={kernelName:S.IsNan,backendName:"cpu",kernelFunc:KPe};function XPe(n){var e=n.backend,t=n.attrs,r=t.start,a=t.stop,i=t.num,o=tz(r,a,i);return e.makeTensorInfo([o.length],"float32",o)}var YPe={kernelName:S.LinSpace,backendName:"cpu",kernelFunc:XPe};var ZPe=Mt(S.Log1p,function(n){return Math.log1p(n)}),JPe={kernelName:S.Log1p,backendName:"cpu",kernelFunc:ZPe};var QPe=zn(function(n,e){return n&&e}),eMe=Zn(S.LogicalAnd,QPe,null,"bool"),tMe={kernelName:S.LogicalAnd,backendName:"cpu",kernelFunc:eMe};var nMe=Mt(S.LogicalNot,function(n){return n?0:1},"bool"),rMe={kernelName:S.LogicalNot,backendName:"cpu",kernelFunc:nMe};var aMe=zn(function(n,e){return n||e}),iMe=Zn(S.LogicalOr,aMe,null,"bool"),oMe={kernelName:S.LogicalOr,backendName:"cpu",kernelFunc:iMe};function sMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta;Ge(a,"LRN");var c=a.shape[3],l=c-1,f=t.data.get(a.dataId).values,h=S.util.sizeFromShape(a.shape),d=new Float32Array(h);function p(y){for(var b=y%c,w=y-b+Math.max(0,b-i),x=y-b+Math.min(b+i,l),N=0;w<=x;w++){var T=f[w];N+=T*T}return N}for(var v=0;v<h;v++){var m=p(v),g=f[v]*Math.pow(o+s*m,-u);d[v]=g}return t.makeTensorInfo(a.shape,a.dtype,d)}var uMe={kernelName:S.LRN,backendName:"cpu",kernelFunc:sMe};function cMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.y,o=e.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta;Ge(o,"LRNGrad");for(var f=S.util.sizeFromShape(o.shape),h=o.shape[3],d=t.data.get(o.dataId).values,p=t.data.get(a.dataId).values,v=t.data.get(i.dataId).values,m=new Float32Array(f),g=f,y=0;y<g;y++){for(var b=y%h,w=y-b+Math.max(0,b-s),x=y-b+Math.min(h,b+s+1),N=0,T=w;T<x;T++)N+=Math.pow(p[T],2);N=c*N+u;for(var T=w;T<x;T++){var E=-2*c*l*p[T]*v[y]/N;y===T&&(E+=Math.pow(N,-l)),E*=d[y],m[T]+=E}}return t.makeTensorInfo(o.shape,a.dtype,m)}var lMe={kernelName:S.LRNGrad,backendName:"cpu",kernelFunc:cMe};function zz(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.reductionIndices,o=r.keepDims,s=t,u=a.shape,c=u.length,l=S.util.parseAxisParam(i,u),f=l,h=S.backend_util.getAxesPermutation(f,c),d=s.data.get(a.dataId).values;if(h!=null){for(var p=new Array(c),v=0;v<p.length;v++)p[v]=u[h[v]];d=mx(d,u,a.dtype,h,p),f=S.backend_util.getInnerMostAxes(f.length,c),u=p}Ge(a,"max"),S.backend_util.assertAxesAreInnerMostDims("max",f,c);var m=We(S.backend_util.computeOutAndReduceShapes(u,f),2),g=m[0],y=m[1],b=S.util.sizeFromShape(y),w=rz(d,b,g,a.dtype),x=s.write(w,g,a.dtype),N=g;if(o){var p=S.backend_util.expandShapeToKeepDim(g,l);N=p}return{dataId:x,shape:N,dtype:a.dtype}}var fMe={kernelName:S.Max,backendName:"cpu",kernelFunc:zz};function hMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x;Ge(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=1;S.util.assert(S.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=S.backend_util.computePool2DInfo(a.shape,i,o,c,s,u),f;if(l.filterWidth===1&&l.filterHeight===1&&S.util.arraysEqual(l.inShape,l.outShape))f=Pi({inputs:{x:a},backend:t});else{var h=t.data.get(a.dataId).values,d=S.util.computeStrides(a.shape),p=bx(h,a.shape,a.dtype,d,l,"max");f=t.makeTensorInfo(l.outShape,a.dtype,p.values)}return f}var dMe={kernelName:S.MaxPool,backendName:"cpu",kernelFunc:hMe};function pMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;Ge(a,"maxPool3d");var l=S.backend_util.computePool3DInfo(a.shape,i,o,1,s,u,c),f=t.data.get(a.dataId).values,h=Pz(f,a.shape,a.dtype,S.util.computeStrides(a.shape),l,"max");return t.makeTensorInfo(h.shape,"float32",h.values)}var vMe={kernelName:S.MaxPool3D,backendName:"cpu",kernelFunc:pMe};function mMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;Ge([a,i],"maxPool3DGrad");for(var l=S.backend_util.computePool3DInfo(i.shape,o,s,1,u,c),f=t.bufferSync(i),h=rOe(f,l),d=l.strideDepth,p=l.strideHeight,v=l.strideWidth,m=l.dilationDepth,g=l.dilationHeight,y=l.dilationWidth,b=l.effectiveFilterDepth,w=l.effectiveFilterHeight,x=l.effectiveFilterWidth,N=b-1-l.padInfo.front,T=x-1-l.padInfo.left,E=w-1-l.padInfo.top,C=S.buffer(i.shape,"float32"),F=t.bufferSync(a),_=0;_<l.batchSize;++_)for(var O=0;O<l.inChannels;++O)for(var L=0;L<l.inDepth;++L)for(var z=0;z<l.inHeight;++z)for(var $=0;$<l.inWidth;++$){for(var B=L-N,W=z-E,X=$-T,Z=0,V=0;V<b;V+=m){var j=(B+V)/d;if(!(j<0||j>=l.outDepth||Math.floor(j)!==j))for(var re=0;re<w;re+=g){var ne=(W+re)/p;if(!(ne<0||ne>=l.outHeight||Math.floor(ne)!==ne))for(var oe=0;oe<x;oe+=y){var le=(X+oe)/v;if(!(le<0||le>=l.outWidth||Math.floor(le)!==le)){var pe=b*w*x-1-h.get(_,j,ne,le,O),xe=V*w*x+re*x+oe,he=pe===xe?1:0;if(he!==0){var ye=F.get(_,j,ne,le,O);Z+=ye*he}}}}}C.set(Z,_,L,z,$,O)}return t.makeTensorInfo(C.shape,C.dtype,C.values)}var gMe={kernelName:S.MaxPool3DGrad,backendName:"cpu",kernelFunc:mMe};function yMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.input,o=e.output,s=i;Ge([i,o],"maxPoolGrad");for(var u=r.filterSize,c=r.strides,l=r.pad,f=r.dimRoundingMode,h=S.backend_util.computePool2DInfo(s.shape,u,c,1,l,f),d=t.data.get(s.dataId).values,p=S.buffer(h.outShape,s.dtype,Oz(d,s.shape,s.dtype,h).values),v=h.strideHeight,m=h.strideWidth,g=h.dilationHeight,y=h.dilationWidth,b=h.effectiveFilterHeight,w=h.effectiveFilterWidth,x=w-1-h.padInfo.left,N=b-1-h.padInfo.top,T=S.buffer(s.shape,"float32"),E=t.data.get(a.dataId).values,C=S.buffer(a.shape,"float32",E),F=0;F<h.batchSize;++F)for(var _=0;_<h.inChannels;++_)for(var O=0;O<h.inHeight;++O)for(var L=0;L<h.inWidth;++L){for(var z=O-N,$=L-x,B=0,W=0;W<b;W+=g){var X=(z+W)/v;if(!(X<0||X>=h.outHeight||Math.floor(X)!==X))for(var Z=0;Z<w;Z+=y){var V=($+Z)/m;if(!(V<0||V>=h.outWidth||Math.floor(V)!==V)){var j=b*w-1-p.get(F,X,V,_),re=W*w+Z,ne=j===re?1:0;if(ne!==0){var oe=C.get(F,X,V,_);B+=oe*ne}}}}T.set(B,F,O,L,_)}return t.makeTensorInfo(T.shape,T.dtype,T.values)}var bMe={kernelName:S.MaxPoolGrad,backendName:"cpu",kernelFunc:yMe};function wMe(n,e,t,r,a){var i=S.util.computeStrides(e),o=bx(n,e,t,i,a,"max"),s=Oz(n,e,t,a,!0,r);return[o.values,s.values]}var xMe={kernelName:S.MaxPoolWithArgmax,backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.attrs,r=n.backend,a=e.x,i=t.filterSize,o=t.strides,s=t.pad,u=t.includeBatchInIndex,c=r;Ge(a,"MaxPoolWithArgmax");var l=c.data.get(a.dataId).values,f=S.backend_util.computePool2DInfo(a.shape,i,o,[1,1],s),h=We(wMe(l,a.shape,a.dtype,u,f),2),d=h[0],p=h[1],v=c.write(d,f.outShape,a.dtype),m=c.write(p,f.outShape,a.dtype);return[{dataId:v,shape:f.outShape,dtype:a.dtype},{dataId:m,shape:f.outShape,dtype:"int32"}]}};function kMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims,s=S.util.parseAxisParam(i,a.shape),u=S.backend_util.computeOutAndReduceShapes(a.shape,s),c=u[1],l=S.util.sizeFromShape(c),f=[],h=t.makeTensorInfo([],"float32",new Float32Array([l]));f.push(h);var d=Zo({inputs:{x:a},backend:t,attrs:{dtype:"float32"}});f.push(d);var p=wx({inputs:{a:d,b:h},backend:t});f.push(p);var v=ih({inputs:{x:p},backend:t,attrs:{axis:i,keepDims:o}});return f.forEach(function(m){return t.disposeIntermediateTensorInfo(m)}),v}var SMe={kernelName:S.Mean,backendName:"cpu",kernelFunc:kMe};function NMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims;Ge(a,"min");var s=S.util.parseAxisParam(i,a.shape),u=s,c=S.backend_util.getAxesPermutation(u,a.shape.length),l=a;c!=null&&(l=Or({inputs:{x:a},backend:t,attrs:{perm:c}}),u=S.backend_util.getInnerMostAxes(u.length,a.shape.length)),S.backend_util.assertAxesAreInnerMostDims("min",u,l.shape.length);for(var f=We(S.backend_util.computeOutAndReduceShapes(l.shape,u),2),h=f[0],d=f[1],p=S.util.sizeFromShape(d),v=S.util.makeZerosTypedArray(S.util.sizeFromShape(h),l.dtype),m=t.data.get(l.dataId).values,g=0;g<v.length;++g){for(var y=g*p,b=m[y],w=0;w<p;++w){var x=m[y+w];(Number.isNaN(x)||x<b)&&(b=x)}v[g]=b}c!=null&&t.disposeIntermediateTensorInfo(l);var N=t.makeTensorInfo(h,l.dtype,v);if(o){var T=S.backend_util.expandShapeToKeepDim(h,s),E=qt({inputs:{x:N},backend:t,attrs:{shape:T}});return t.disposeIntermediateTensorInfo(N),E}return N}var TMe={kernelName:S.Min,backendName:"cpu",kernelFunc:NMe};function EMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.paddings,o=r.mode;Ge(a,"mirrorPad");for(var s=i.map(function(T,E){return T[0]+a.shape[E]+T[1]}),u=i.map(function(T){return T[0]}),c=i.map(function(T,E){return T[0]+a.shape[E]}),l=o==="reflect"?0:1,f=t.data.get(a.dataId).values,h=a.shape.length,d=S.util.computeStrides(a.shape),p=S.util.sizeFromShape(s),v=s.length,m=S.util.computeStrides(s),g=S.util.getTypedArrayFromDType(a.dtype,p),y=0;y<p;y++){for(var b=S.util.indexToLoc(y,v,m),w=0;w<v;w++)b[w]<u[w]?b[w]=u[w]*2-b[w]-l:b[w]>=c[w]&&(b[w]=(c[w]-1)*2-b[w]+l);b=b.map(function(T,E){return T-u[E]});var x=S.util.locToIndex(b,h,d);g[y]=f[x]}var N=t.write(g,s,a.dtype);return{dataId:N,shape:s,dtype:a.dtype}}var IMe={kernelName:S.MirrorPad,backendName:"cpu",kernelFunc:EMe};var CMe=zn(function(n,e){var t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e}),AMe=Zn(S.Mod,CMe),DMe={kernelName:S.Mod,backendName:"cpu",kernelFunc:AMe};function $z(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.logits,i=r.dim,o=a.shape.length,s=i;if(s===-1&&(s=o-1),s!==o-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(o," and dim was ").concat(s));var u=S.util.parseAxisParam([s],a.shape),c=zz({inputs:{x:a},backend:t,attrs:{reductionIndices:u,keepDims:!1}}),l=S.backend_util.expandShapeToKeepDim(c.shape,u),f=qt({inputs:{x:c},backend:t,attrs:{shape:l}}),h=yx({inputs:{a,b:f},backend:t}),d=HL({inputs:{x:h},backend:t}),p=ih({inputs:{x:d},backend:t,attrs:{axis:u,keepDims:!1}}),v=qt({inputs:{x:p},backend:t,attrs:{shape:l}}),m=wx({inputs:{a:d,b:v},backend:t});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(v),m}var _Me={kernelName:S.Softmax,backendName:"cpu",kernelFunc:$z};function FMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.logits,i=r.numSamples,o=r.seed,s=r.normalized;Ge(a,"multinomial");for(var u=s?a:$z({inputs:{logits:a},backend:t,attrs:{dim:-1}}),c=u.shape[0],l=u.shape[1],f=t.data.get(u.dataId).values,h=[c,i],d=S.util.makeZerosTypedArray(S.util.sizeFromShape(h),"int32"),p=0;p<c;++p){var v=p*l,m=new Float32Array(l-1);m[0]=f[v];for(var g=1;g<m.length;++g)m[g]=m[g-1]+f[v+g];for(var y=fFe.alea(o.toString()),b=p*i,w=0;w<i;++w){var x=y();d[b+w]=m.length;for(var g=0;g<m.length;g++)if(x<m[g]){d[b+w]=g;break}}}return s||t.disposeIntermediateTensorInfo(u),t.makeTensorInfo(h,"int32",d)}var RMe={kernelName:S.Multinomial,backendName:"cpu",kernelFunc:FMe};var OMe=S.kernel_impls.nonMaxSuppressionV3Impl;function PMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.boxes,i=e.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold;Ge(a,"NonMaxSuppression");var c=t.data.get(a.dataId).values,l=t.data.get(i.dataId).values,f=OMe(c,l,o,s,u).selectedIndices;return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}var MMe={kernelName:S.NonMaxSuppressionV3,backendName:"cpu",kernelFunc:PMe};var BMe=S.kernel_impls.nonMaxSuppressionV4Impl;function LMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.boxes,i=e.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize;Ge(a,"NonMaxSuppressionPadded");var l=t.data.get(a.dataId).values,f=t.data.get(i.dataId).values,h=BMe(l,f,o,s,u,c),d=h.selectedIndices,p=h.validOutputs;return[t.makeTensorInfo([d.length],"int32",new Int32Array(d)),t.makeTensorInfo([],"int32",new Int32Array([p]))]}var zMe={kernelName:S.NonMaxSuppressionV4,backendName:"cpu",kernelFunc:LMe};var $Me=S.kernel_impls.nonMaxSuppressionV5Impl;function qMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.boxes,i=e.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma;Ge(a,"NonMaxSuppressionWithScore");var l=t.data.get(a.dataId).values,f=t.data.get(i.dataId).values,h=o,d=s,p=u,v=c,m=$Me(l,f,h,d,p,v),g=m.selectedIndices,y=m.selectedScores;return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var WMe={kernelName:S.NonMaxSuppressionV5,backendName:"cpu",kernelFunc:qMe};function VMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue;Ge(a,"oneHot");var c=S.util.sizeFromShape(a.shape),l=new Float32Array(c*o);l.fill(u);for(var f=t.data.get(a.dataId).values,h=0;h<c;++h)f[h]>=0&&f[h]<o&&(l[h*o+f[h]]=s);return t.makeTensorInfo(ya(ya([],We(a.shape),!1),[o],!1),i,l)}var GMe={kernelName:S.OneHot,backendName:"cpu",kernelFunc:VMe};function jv(n){var e=n.inputs,t=n.backend,r=e.x;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){var a=uu({inputs:{input:r},backend:t}),i=jv({inputs:{x:a},backend:t}),o=Bc({inputs:{input:r},backend:t}),s=jv({inputs:{x:o},backend:t}),u=na({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return xx({backend:t,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var UMe={kernelName:S.ZerosLike,backendName:"cpu",kernelFunc:jv};function qz(n){var e=n.inputs,t=n.backend,r=e.x;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){var a=uu({inputs:{input:r},backend:t}),i=qz({inputs:{x:a},backend:t}),o=Bc({inputs:{input:r},backend:t}),s=jv({inputs:{x:o},backend:t}),u=na({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return xx({backend:t,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}var HMe={kernelName:S.OnesLike,backendName:"cpu",kernelFunc:qz};function Wz(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.axis;if(e.length===1)return Kv({inputs:{input:e[0]},backend:t,attrs:{dim:a}});var i=e[0].shape,o=e[0].dtype;e.forEach(function(l){S.util.assertShapesMatch(i,l.shape,"All tensors passed to stack must have matching shapes"),S.util.assert(o===l.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=[],u=e.map(function(l){var f=Kv({inputs:{input:l},backend:t,attrs:{dim:a}});return s.push(f),f}),c=Lc({inputs:u,backend:t,attrs:{axis:a}});return s.forEach(function(l){return t.disposeIntermediateTensorInfo(l)}),c}var KMe={kernelName:S.Pack,backendName:"cpu",kernelFunc:Wz};function jMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.paddings,o=r.constantValue;Ge(a,"pad");var s=i.map(function(N,T){return N[0]+a.shape[T]+N[1]}),u=i.map(function(N){return N[0]}),c=t.data.get(a.dataId).values,l=S.util.sizeFromShape(a.shape),f=a.shape.length,h=S.util.computeStrides(a.shape),d=S.util.sizeFromShape(s),p=s.length,v=S.util.computeStrides(s),m=S.util.getTypedArrayFromDType(a.dtype,d);o!==0&&m.fill(o);for(var g=0;g<l;g++){var y=S.util.indexToLoc(g,f,h),b=y.map(function(N,T){return N+u[T]}),w=S.util.locToIndex(b,p,v);m[w]=c[g]}var x=t.write(m,s,a.dtype);return{dataId:x,shape:s,dtype:a.dtype}}var Vz={kernelName:S.PadV2,backendName:"cpu",kernelFunc:jMe};var XMe=zn(function(n,e){return Math.pow(n,e)}),YMe=Zn(S.Pow,XMe),ZMe={kernelName:S.Pow,backendName:"cpu",kernelFunc:YMe};function JMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.paramsNestedSplits,i=e.paramsDenseValues,o=e.indices;r.outputRaggedRank;var s=a.map(function(g){return t.data.get(g.dataId).values}),u=a.map(function(g){return g.shape}),c=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values,f=We(cz(s,u,c,i.shape,i.dtype,l,o.shape),3),h=f[0],d=f[1],p=f[2],v=h.map(function(g){return t.makeTensorInfo([g.length],"int32",g)}),m=t.makeTensorInfo(p,i.dtype,d);return v.concat([m])}var QMe={kernelName:S.RaggedGather,backendName:"cpu",kernelFunc:JMe};function e4e(n){var e=n.inputs,t=n.backend,r=e.starts,a=e.limits,i=e.deltas,o=t.data.get(r.dataId).values,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=We(lz(o,r.shape,r.dtype,s,a.shape,u,i.shape),2),l=c[0],f=c[1],h=t.makeTensorInfo([l.length],"int32",l),d=t.makeTensorInfo([f.length],r.dtype,f);return[h,d]}var t4e={kernelName:S.RaggedRange,backendName:"cpu",kernelFunc:e4e};function n4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.shape,i=e.values,o=e.defaultValue,s=e.rowPartitionTensors,u=r.rowPartitionTypes,c=t.data.get(a.dataId).values,l=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,h=s.map(function(g){return t.data.get(g.dataId).values}),d=s.map(function(g){return g.shape}),p=We(fz(c,a.shape,l,i.shape,i.dtype,f,o.shape,h,d,u),2),v=p[0],m=p[1];return t.makeTensorInfo(v,i.dtype,m)}var r4e={kernelName:S.RaggedTensorToTensor,backendName:"cpu",kernelFunc:n4e};function a4e(n){var e=n.backend,t=n.attrs,r=t.start,a=t.stop,i=t.dtype,o=t.step,s=hz(r,a,o,i);return e.makeTensorInfo([s.length],i,s)}var i4e={kernelName:S.Range,backendName:"cpu",kernelFunc:a4e};var o4e=Mt(S.Reciprocal,function(n){return 1/n}),s4e={kernelName:S.Reciprocal,backendName:"cpu",kernelFunc:o4e};function u4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;Ge(a,"resizeBilinear");for(var u=S.util.computeStrides(a.shape),c=We(s,2),l=c[0],f=c[1],h=We(a.shape,4),d=h[0],p=h[1],v=h[2],m=h[3],g=t.data.get(a.dataId).values,y=new Float32Array(S.util.sizeFromShape([d,l,f,m])),b=[i&&l>1?p-1:p,i&&f>1?v-1:v],w=[i&&l>1?l-1:l,i&&f>1?f-1:f],x=0,N=b[0]/w[0],T=b[1]/w[1],E=0;E<d;E++)for(var C=0;C<l;C++){var F=void 0;o?F=N*(C+.5)-.5:F=N*C;for(var _=Math.max(0,Math.floor(F)),O=F-_,L=Math.min(p-1,Math.ceil(F)),z=E*u[0]+_*u[1],$=E*u[0]+L*u[1],B=0;B<f;B++){var W=void 0;o?W=T*(B+.5)-.5:W=T*B;for(var X=Math.max(0,Math.floor(W)),Z=W-X,V=Math.min(v-1,Math.ceil(W)),j=z+X*u[2],re=$+X*u[2],ne=z+V*u[2],oe=$+V*u[2],le=0;le<m;le++){var pe=g[j+le],xe=g[re+le],he=g[ne+le],ye=g[oe+le],we=pe+(he-pe)*Z,Ae=xe+(ye-xe)*Z,Ye=we+(Ae-we)*O;y[x++]=Ye}}}return t.makeTensorInfo([d,l,f,m],"float32",y)}var c4e={kernelName:S.ResizeBilinear,backendName:"cpu",kernelFunc:u4e};function l4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.images,i=e.dy,o=r.alignCorners;Ge([i,a],"resizeBilinearGrad");for(var s=S.util.computeStrides(a.shape),u=We(a.shape,4),c=u[0],l=u[1],f=u[2],h=u[3],d=We(i.shape,3),p=d[1],v=d[2],m=new Float32Array(c*l*f*h),g=[o&&p>1?l-1:l,o&&v>1?f-1:f],y=[o&&p>1?p-1:p,o&&v>1?v-1:v],b=g[0]/y[0],w=g[1]/y[1],x=t.data.get(i.dataId).values,N=0,T=0;T<c;T++)for(var E=T*s[0],C=0;C<p;C++)for(var F=C*b,_=Math.floor(F),O=Math.min(Math.ceil(F),l-1),L=E+_*s[1],z=E+O*s[1],$=F-_,B=1-$,W=0;W<v;W++)for(var X=W*w,Z=Math.floor(X),V=Math.min(Math.ceil(X),f-1),j=X-Z,re=1-j,ne=L+Z*s[2],oe=L+V*s[2],le=z+Z*s[2],pe=z+V*s[2],xe=B*re,he=B*j,ye=$*re,we=$*j,Ae=0;Ae<h;Ae++){var Ye=x[N++];m[ne+Ae]+=Ye*xe,m[oe+Ae]+=Ye*he,m[le+Ae]+=Ye*ye,m[pe+Ae]+=Ye*we}return t.makeTensorInfo([c,f,l,h],"float32",m)}var f4e={kernelName:S.ResizeBilinearGrad,backendName:"cpu",kernelFunc:l4e};function h4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;Ge(a,"resizeNearestNeighbor");for(var u=S.util.computeStrides(a.shape),c=We(s,2),l=c[0],f=c[1],h=We(a.shape,4),d=h[0],p=h[1],v=h[2],m=h[3],g=t.data.get(a.dataId).values,y=new Float32Array(d*l*f*m),b=[i&&l>1?p-1:p,i&&f>1?v-1:v],w=[i&&l>1?l-1:l,i&&f>1?f-1:f],x=b[0]/w[0],N=b[1]/w[1],T=0,E=0;E<d;E++)for(var C=E*u[0],F=0;F<l;F++){var _=o?x*(F+.5):x*F,O=Math.min(p-1,i?Math.round(_):Math.floor(_));o&&(O=Math.max(0,O));for(var L=C+O*u[1],z=0;z<f;z++){var $=o?N*(z+.5):N*z,B=Math.min(v-1,i?Math.round($):Math.floor($));o&&(B=Math.max(0,B));for(var W=L+B*u[2],X=0;X<m;X++){var Z=g[W+X];y[T++]=Z}}}return t.makeTensorInfo([d,l,f,m],a.dtype,y)}var d4e={kernelName:S.ResizeNearestNeighbor,backendName:"cpu",kernelFunc:h4e};function p4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.images,i=e.dy,o=r.alignCorners;Ge([i,a],"resizeNearestNeighborGrad");for(var s=S.util.computeStrides(a.shape),u=S.util.computeStrides(i.shape),c=We(a.shape,4),l=c[0],f=c[1],h=c[2],d=c[3],p=We(i.shape,3),v=p[1],m=p[2],g=new Float32Array(l*f*h*d),y=t.data.get(i.dataId).values,b=[o&&v>1?f-1:f,o&&m>1?h-1:h],w=[o&&v>1?v-1:v,o&&m>1?m-1:m],x=b[0]/w[0],N=b[1]/w[1],T=1/x,E=1/N,C=Math.ceil(T)*2+2,F=Math.ceil(E)*2+2,_=0;_<l;_++)for(var O=_*s[0],L=0;L<f;L++)for(var z=O+L*s[1],$=Math.floor(L*T),B=Math.floor($-C/2),W=0;W<h;W++)for(var X=z+W*s[2],Z=Math.floor(W*E),V=Math.floor(Z-F/2),j=0;j<d;j++){for(var re=0,ne=0;ne<C;ne++){var oe=ne+B;if(!(oe<0||oe>=v)){var le=O+oe*u[1],pe=oe*x,xe=Math.min(f-1,o?Math.round(pe):Math.floor(pe));if(L===xe)for(var he=0;he<F;he++){var ye=he+V;if(!(ye<0||ye>=m)){var we=le+ye*u[2],Ae=ye*N,Ye=Math.min(h-1,o?Math.round(Ae):Math.floor(Ae));W===Ye&&(re+=y[we+j])}}}}g[X+j]=re}return t.makeTensorInfo(a.shape,a.dtype,g)}var v4e={kernelName:S.ResizeNearestNeighborGrad,backendName:"cpu",kernelFunc:p4e};function m4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.dims;Ge(a,"reverse");var o=a.shape.length,s=S.util.parseAxisParam(i,a.shape);if(o===0)return Pi({inputs:{x:a},backend:t});for(var u=new S.TensorBuffer(a.shape,a.dtype),c=t.bufferSync(a),l=function(h){var d=u.indexToLoc(h),p=d.slice();s.forEach(function(v){return p[v]=a.shape[v]-1-p[v]}),u.set.apply(u,ya([c.get.apply(c,ya([],We(p),!1))],We(d),!1))},f=0;f<u.size;f++)l(f);return t.makeTensorInfo(u.shape,u.dtype,u.values)}var g4e={kernelName:S.Reverse,backendName:"cpu",kernelFunc:m4e},y4e={kernelName:S.RotateWithOffset,backendName:"cpu",kernelFunc:function(n){for(var e=n.inputs,t=n.attrs,r=n.backend,a=e.image,i=t.radians,o=t.fillValue,s=t.center,u=r,c=S.util.getTypedArrayFromDType(a.dtype,S.util.sizeFromShape(a.shape)),l=We(a.shape,4),f=l[0],h=l[1],d=l[2],p=l[3],v=We(S.backend_util.getImageCenter(s,h,d),2),m=v[0],g=v[1],y=255,b=Math.sin(i),w=Math.cos(i),x=u.data.get(a.dataId).values,N=0;N<f;N++)for(var T=N*d*h*p,E=0;E<h;E++)for(var C=E*(d*p),F=0;F<d;F++)for(var _=F*p,O=0;O<p;O++){var L=[f,E,F,O],z=L[2],$=L[1],B=(z-m)*w-($-g)*b,W=(z-m)*b+($-g)*w;B=Math.round(B+m),W=Math.round(W+g);var X=o;if(typeof o!="number"&&(O===3?X=y:X=o[O]),B>=0&&B<d&&W>=0&&W<h){var Z=W*(d*p),V=B*p,j=T+Z+V+O;X=x[j]}var re=T+C+_+O;c[re]=X}var ne=u.write(c,a.shape,a.dtype);return{dataId:ne,shape:a.shape,dtype:a.dtype}}};var b4e=Mt(S.Round,function(n){var e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),w4e={kernelName:S.Round,backendName:"cpu",kernelFunc:b4e};function x4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.indices,i=e.updates,o=r.shape,s=S.backend_util.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,f=s.strides,h=s.outputSize,d=!0,p=t.bufferSync(a),v=t.bufferSync(i),m=Oc(p,v,o,h,l,c,u,f,0,d);return t.makeTensorInfo(o,m.dtype,m.values)}var k4e={kernelName:S.ScatterNd,backendName:"cpu",kernelFunc:x4e};function S4e(n,e){for(var t=0,r=n.length,a=0;t<r;)a=Math.floor((t+r)/2),n[a]<e?t=a+1:r=a;return r}function N4e(n,e){for(var t=0,r=n.length,a=0;t<r;)a=Math.floor((t+r)/2),n[a]<=e?t=a+1:r=a;return r}function T4e(n,e,t,r,a,i){for(var o=S.util.getArrayFromDType("int32",t*a),s=0;s<t;++s)for(var u=n.slice(s*r,(s+1)*r),c=s*a,l=0;l<a;++l)o[c+l]=i==="left"?S4e(u,e[l+c]):N4e(u,e[l+c]);return o}function E4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.sortedSequence,i=e.values,o=r.side,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=T4e(s,u,a.shape[0],a.shape[1],i.shape[1],o);return t.makeTensorInfo(i.shape,"int32",c)}var I4e={kernelName:S.SearchSorted,backendName:"cpu",kernelFunc:E4e};function C4e(n){var e=n.inputs,t=n.backend,r=e.condition,a=e.t,i=e.e;Ge([r,a,i],"select");for(var o=r.shape.length,s=t.data.get(r.dataId).values,u=t.data.get(a.dataId).values,c=t.data.get(i.dataId).values,l=S.upcastType(a.dtype,i.dtype),f=S.util.makeZerosTypedArray(S.util.sizeFromShape(a.shape),l),h=0,d=o===0||o>1||a.shape.length===1?1:S.util.sizeFromShape(a.shape.slice(1)),p=0;p<s.length;p++)for(var v=0;v<d;v++)s[p]===1?f[h++]=u[p]:f[h++]=c[p];return t.makeTensorInfo(a.shape,l,f)}var A4e={kernelName:S.Select,backendName:"cpu",kernelFunc:C4e};var D4e=S.backend_util.SELU_SCALEALPHA,_4e=S.backend_util.SELU_SCALE,F4e=Mt(S.Selu,function(n){return n>=0?_4e*n:D4e*(Math.exp(n)-1)}),R4e={kernelName:S.Selu,backendName:"cpu",kernelFunc:F4e};var O4e=Mt(S.Sign,function(n){return n<0?-1:n>0?1:0}),P4e={kernelName:S.Sign,backendName:"cpu",kernelFunc:O4e};var M4e=Mt(S.Sin,function(n){return Math.sin(n)}),B4e={kernelName:S.Sin,backendName:"cpu",kernelFunc:M4e};var L4e=Mt(S.Sinh,function(n){return Math.sinh(n)}),z4e={kernelName:S.Sinh,backendName:"cpu",kernelFunc:L4e};var $4e=11920928955078125e-23,RL=Math.log($4e)+2,q4e=Mt(S.Softplus,function(n){var e=n>-RL,t=n<RL,r=Math.exp(n),a;return t?a=r:e?a=n:a=Math.log(1+r),a}),W4e={kernelName:S.Softplus,backendName:"cpu",kernelFunc:q4e};function V4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.blockShape,o=r.paddings;Ge([a],"spaceToBatchND");var s=S.util.sizeFromShape(i),u=[[0,0]];u.push.apply(u,ya([],We(o),!1));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=Vz.kernelFunc({inputs:{x:a},backend:t,attrs:{paddings:u,constantValue:0}}),f=S.backend_util.getReshaped(l.shape,i,s,!1),h=S.backend_util.getPermuted(f.length,i.length,!1),d=S.backend_util.getReshapedPermuted(l.shape,i,s,!1),p={x:l},v={shape:f},m=qt({inputs:p,backend:t,attrs:v}),g={x:m},y={perm:h},b=Or({inputs:g,backend:t,attrs:y}),w={x:b},x={shape:d},N=qt({inputs:w,backend:t,attrs:x});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(b),N}var G4e={kernelName:S.SpaceToBatchND,backendName:"cpu",kernelFunc:V4e};function U4e(n){var e=n.inputs,t=n.backend,r=e.indices,a=e.values,i=e.denseShape,o=e.defaultValue;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        `.concat(i.shape));if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        `.concat(r.shape));if(a.shape.length!==1)throw new Error(`Values must be a vector, saw:
        `.concat(a.shape));if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        `.concat(o.shape));var s=t.data.get(r.dataId).values,u=t.data.get(a.dataId).values,c=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values[0],f=We(mz(s,r.shape,r.dtype,u,a.dtype,c,l),5),h=f[0],d=f[1],p=f[2],v=f[3],m=f[4];return[t.makeTensorInfo(d,r.dtype,h),t.makeTensorInfo([d[0]],a.dtype,p),t.makeTensorInfo([v.length],"bool",new Uint8Array(v.map(function(g){return Number(g)}))),t.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}var H4e={kernelName:S.SparseFillEmptyRows,backendName:"cpu",kernelFunc:U4e};function K4e(n){var e=n.inputs,t=n.backend,r=e.inputIndices,a=e.inputShape,i=e.newShape;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        `.concat(r.shape));if(a.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        `.concat(a.shape));if(i.shape.length!==1)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(t.data.get(a.dataId).values),s=t.data.get(r.dataId).values,u=Array.from(t.data.get(i.dataId).values),c=We(gz(s,r.shape,r.dtype,o,u),3),l=c[0],f=c[1],h=c[2];return[t.makeTensorInfo(f,r.dtype,l),t.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}var j4e={kernelName:S.SparseReshape,backendName:"cpu",kernelFunc:K4e};function X4e(n){var e=n.inputs,t=n.backend,r=e.data,a=e.indices,i=e.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          `.concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=t.data.get(r.dataId).values,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=We(gx(o,r.shape,r.dtype,s,u,!0),2),l=c[0],f=c[1];return t.makeTensorInfo(f,r.dtype,l)}var Y4e={kernelName:S.SparseSegmentMean,backendName:"cpu",kernelFunc:X4e};function Z4e(n){var e=n.inputs,t=n.backend,r=e.data,a=e.indices,i=e.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         `.concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=t.data.get(r.dataId).values,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=We(gx(o,r.shape,r.dtype,s,u),2),l=c[0],f=c[1];return t.makeTensorInfo(f,r.dtype,l)}var J4e={kernelName:S.SparseSegmentSum,backendName:"cpu",kernelFunc:Z4e};function Q4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.sparseIndices,i=e.sparseValues,o=e.defaultValue,s=r.outputShape,u=S.backend_util.calculateShapes(i,a,s),c=u.sliceRank,l=u.numUpdates,f=u.sliceSize,h=u.strides,d=u.outputSize,p=!1,v=t.bufferSync(a),m;switch(i.dtype){case"bool":{var g=t.bufferSync(i),y=Boolean(t.data.get(o.dataId).values[0]);m=Oc(v,g,s,d,f,l,c,h,y,p);break}case"float32":{var g=t.bufferSync(i),y=t.data.get(o.dataId).values[0];m=Oc(v,g,s,d,f,l,c,h,y,p);break}case"int32":{var g=t.bufferSync(i),y=t.data.get(o.dataId).values[0];m=Oc(v,g,s,d,f,l,c,h,y,p);break}case"string":{var g=t.bufferSync(i),y=S.util.decodeString(t.data.get(o.dataId).values[0]);m=Oc(v,g,s,d,f,l,c,h,y,p);break}default:throw new Error("Unsupported type ".concat(i.dtype))}return t.makeTensorInfo(s,m.dtype,m.values)}var eBe={kernelName:S.SparseToDense,backendName:"cpu",kernelFunc:Q4e};function tBe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.numOrSizeSplits,o=r.axis,s=S.util.parseAxisParam(o,a.shape)[0],u=S.backend_util.prepareSplitSize(a,i,s),c=new Array(a.shape.length).fill(0),l=a.shape.slice();return u.map(function(f){var h=ya([],We(l),!1);h[s]=f;var d=cu({inputs:{x:a},backend:t,attrs:{begin:c,size:h}});return c[s]+=f,d})}var nBe={kernelName:S.SplitV,backendName:"cpu",kernelFunc:tBe};var rBe={kernelName:S.Square,backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,a=t;Ge(r,"square");for(var i=a.data.get(r.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}var c=a.write(o,r.shape,r.dtype);return{dataId:c,shape:r.shape,dtype:r.dtype}}};var aBe=Mt(S.Step,function(n,e){var t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),iBe={kernelName:S.Step,backendName:"cpu",kernelFunc:aBe};function oBe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.begin,o=r.end,s=r.strides,u=r.beginMask,c=r.endMask,l=r.ellipsisMask,f=r.newAxisMask,h=r.shrinkAxisMask;Ge(a,"stridedSlice");var d=S.slice_util.sliceInfo(a.shape,i,o,s,u,c,l,f,h),p=d.finalShapeSparse,v=d.finalShape,m=d.isIdentity,g=d.sliceDim0,y=d.isSimpleSlice,b=d.begin,w=d.end,x=d.strides,N;if(m)N=qt({inputs:{x:a},backend:t,attrs:{shape:v}});else if(g||y){S.util.assert(a.shape.length>=1,function(){return"Input must have rank at least 1, got: ".concat(a.shape.length)});var T=S.slice_util.computeOutShape(b,w,x),E=cu({inputs:{x:a},backend:t,attrs:{begin:b,size:T}});N=qt({inputs:{x:E},backend:t,attrs:{shape:v}}),t.disposeIntermediateTensorInfo(E)}else{var C=t.bufferSync(a),F=bz(p,C,x,b);N=t.makeTensorInfo(v,F.dtype,F.values)}return N}var sBe={kernelName:S.StridedSlice,backendName:"cpu",kernelFunc:oBe};function uBe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,c=r.preserveShortSequences,l=e.data,f=e.dataSplits,h=t.data.get(l.dataId).values,d=t.data.get(f.dataId).values,p=We(wz(h,d,a,i,o,s,u,c),2),v=p[0],m=p[1];return[t.makeTensorInfo([v.length],"string",v),t.makeTensorInfo(f.shape,"int32",m)]}var cBe={kernelName:S.StringNGrams,backendName:"cpu",kernelFunc:uBe};function lBe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.skipEmpty,i=e.input,o=e.delimiter;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error("Input must be a vector, got shape: ".concat(i.shape));if(o.shape.length!==0)throw new Error("Delimiter must be a scalar, got shape: ".concat(o.shape));var s=t.data.get(i.dataId).values,u=t.data.get(o.dataId).values[0],c=We(xz(s,u,a),3),l=c[0],f=c[1],h=c[2],d=f.length;return[t.makeTensorInfo([d,2],"int32",l),t.makeTensorInfo([d],"string",f),t.makeTensorInfo([2],"int32",new Int32Array(h))]}var fBe={kernelName:S.StringSplit,backendName:"cpu",kernelFunc:lBe};function hBe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.numBuckets,i=e.input;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");var o=t.data.get(i.dataId).values,s=kz(o,a);return t.makeTensorInfo(i.shape,"int32",s)}var dBe={kernelName:S.StringToHashBucketFast,backendName:"cpu",kernelFunc:hBe};var pBe=Mt(S.Tan,function(n){return Math.tan(n)}),vBe={kernelName:S.Tan,backendName:"cpu",kernelFunc:pBe};var mBe=Mt(S.Tanh,function(n){return Math.tanh(n)}),gBe={kernelName:S.Tanh,backendName:"cpu",kernelFunc:mBe};function yBe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.reps;Ge(a,"tile");var o=Nz(t.bufferSync(a),i);return t.makeTensorInfo(o.shape,o.dtype,o.values)}var bBe={kernelName:S.Tile,backendName:"cpu",kernelFunc:yBe};function wBe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.k,o=r.sorted;Ge(a,"topk");var s=t.data.get(a.dataId).values,u=We(Ez(s,a.shape,a.dtype,i,o),2),c=u[0],l=u[1];return[t.makeTensorInfo(c.shape,c.dtype,c.values),t.makeTensorInfo(l.shape,l.dtype,l.values)]}var xBe={kernelName:S.TopK,backendName:"cpu",kernelFunc:wBe};function kBe(n){var e=n.inputs,t=n.attrs,r=n.backend,a=e.image,i=e.transforms,o=t.interpolation,s=t.fillMode,u=t.fillValue,c=t.outputShape,l=We(a.shape,4),f=l[0],h=l[1],d=l[2],p=l[3],v=We(c??[h,d],2),m=v[0],g=v[1],y=[f,m,g,p],b=S.util.computeStrides(a.shape),w=b[0],x=b[1],N=b[2],T=S.util.computeStrides(y),E=T[0],C=T[1],F=T[2],_=S.util.getTypedArrayFromDType(a.dtype,S.util.sizeFromShape(y));_.fill(u);for(var O=r.data.get(a.dataId).values,L=r.data.get(i.dataId).values,z=0;z<f;++z){for(var $=i.shape[0]===1?L:L.subarray(z*8,z*8+8),B=0;B<m;++B)for(var W=0;W<g;++W)for(var X=0;X<p;++X){var Z=void 0,V=$[6]*W+$[7]*B+1;if(V!==0){var j=($[0]*W+$[1]*B+$[2])/V,re=($[3]*W+$[4]*B+$[5])/V,ne=OL(j,d,s),oe=OL(re,h,s);switch(o){case"nearest":Z=CBe(O,h,d,w,x,N,z,oe,ne,X,u);break;case"bilinear":Z=ABe(O,h,d,w,x,N,z,oe,ne,X,u);break;default:throw new Error("Error in Transform: Expect 'nearest' or "+"'bilinear', but got ".concat(o))}var le=z*E+B*C+W*F+X;_[le]=Z}}return r.makeTensorInfo(y,a.dtype,_)}var pe=r.write(_,y,a.dtype);return{dataId:pe,shape:a.shape,dtype:a.dtype}}var SBe={kernelName:S.Transform,backendName:"cpu",kernelFunc:kBe};function OL(n,e,t){switch(t){case"reflect":return NBe(n,e);case"wrap":return TBe(n,e);case"nearest":return IBe(n,e);case"constant":default:return EBe(n)}}function NBe(n,e){var t=n;if(t<0)if(e<=1)t=0;else{var r=2*e;t<r&&(t=r*Math.trunc(-t/r)+t),t=t<-e?t+r:-t-1}else if(t>e-1)if(e<=1)t=0;else{var r=2*e;t-=r*Math.trunc(t/r),t>=e&&(t=r-t-1)}return S.util.clamp(0,t,e-1)}function TBe(n,e){var t=n;if(t<0)if(e<=1)t=0;else{var r=e-1;t+=e*(Math.trunc(-t/r)+1)}else if(t>e-1)if(e<=1)t=0;else{var r=e-1;t-=e*Math.trunc(t/r)}return S.util.clamp(0,t,e-1)}function EBe(n,e){return n}function IBe(n,e){return S.util.clamp(0,n,e-1)}function ah(n,e,t,r,a,i,o,s,u,c,l){var f=o*r+s*a+u*i+c;return 0<=s&&s<e&&0<=u&&u<t?n[f]:l}function CBe(n,e,t,r,a,i,o,s,u,c,l){var f=Math.round(s),h=Math.round(u);return ah(n,e,t,r,a,i,o,f,h,c,l)}function ABe(n,e,t,r,a,i,o,s,u,c,l){var f=Math.floor(s),h=Math.floor(u),d=f+1,p=h+1,v=(p-u)*ah(n,e,t,r,a,i,o,f,h,c,l)+(u-h)*ah(n,e,t,r,a,i,o,f,p,c,l),m=(p-u)*ah(n,e,t,r,a,i,o,d,h,c,l)+(u-h)*ah(n,e,t,r,a,i,o,d,p,c,l);return(d-s)*v+(s-f)*m}function DBe(n){var e=n.inputs,t=n.attrs,r=n.backend,a=t.axis,i=e.x;Ge(i,"unique");var o=r.data.get(i.dataId).values,s=Iz(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[r.makeTensorInfo(c,i.dtype,u),r.makeTensorInfo([l.length],"int32",l)]}var _Be={kernelName:S.Unique,backendName:"cpu",kernelFunc:DBe};function FBe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a.shape.length,s=a.shape[i],u=new Array(o-1),c=0,l=0;l<o;l++)l!==i&&(u[c++]=a.shape[l]);var f=new Array(o).fill(0),h=a.shape.slice();h[i]=1;for(var d=new Array(s),l=0;l<d.length;l++){f[i]=l;var p=cu({inputs:{x:a},backend:t,attrs:{begin:f,size:h}});d[l]=qt({inputs:{x:p},backend:t,attrs:{shape:u}}),t.disposeIntermediateTensorInfo(p)}return d}var RBe={kernelName:S.Unpack,backendName:"cpu",kernelFunc:FBe};function OBe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.segmentIds,o=r.numSegments;Ge(a,"unsortedSegmentSum");for(var s=a.shape.length,u=i.shape.length,c=[],l=[],f=s-u,h=i,d=0;d<f;++d){var p=Kv({inputs:{input:h},backend:t,attrs:{dim:d+1}});h=p,l.push(p)}for(var d=0;d<o;++d){var v=S.util.createScalarValue(d,"int32"),m=t.makeTensorInfo([],"int32",v),g=GL({inputs:{a:m,b:h},backend:t}),y=Zo({inputs:{x:g},backend:t,attrs:{dtype:"float32"}}),b=Xv({inputs:{a:y,b:a},backend:t}),w=ih({inputs:{x:b},backend:t,attrs:{axis:0,keepDims:!1}});c.push(w),l.push(m),l.push(g),l.push(y),l.push(b),l.push(w)}var x=Wz({inputs:c,backend:t,attrs:{axis:0}});return l.forEach(function(N){return t.disposeIntermediateTensorInfo(N)}),x}var PBe={kernelName:S.UnsortedSegmentSum,backendName:"cpu",kernelFunc:OBe},ux,PL,MBe=[_Re,vFe,RRe,PRe,xFe,BRe,zRe,qRe,VRe,URe,KRe,XRe,ZRe,eOe,nOe,iOe,sOe,cOe,fOe,ARe,dOe,vOe,gOe,bOe,bFe,SFe,xOe,mFe,SOe,TOe,EOe,COe,DOe,FOe,OOe,MOe,LOe,$Oe,WOe,GOe,HOe,jOe,YOe,ZOe,QOe,tPe,rPe,aPe,iPe,oPe,cPe,kRe,fPe,NFe,bPe,TFe,wPe,IFe,EPe,IPe,APe,AFe,FPe,OPe,MPe,LPe,$Pe,_Fe,RFe,gFe,WPe,NOe,GPe,HPe,jPe,SRe,PFe,BFe,YPe,zFe,JPe,tMe,rMe,oMe,uMe,lMe,fMe,qFe,dMe,vMe,gMe,bMe,xMe,SMe,TMe,VFe,IMe,DMe,RMe,UFe,KFe,MMe,zMe,WMe,XFe,GMe,HMe,KMe,Vz,ZMe,TRe,JFe,QMe,t4e,r4e,i4e,yFe,lx,s4e,ERe,IRe,CRe,c4e,f4e,d4e,v4e,g4e,y4e,w4e,sRe,k4e,I4e,A4e,R4e,cRe,P4e,B4e,z4e,lRe,_Me,W4e,G4e,H4e,j4e,Y4e,J4e,eBe,nBe,dRe,rBe,vRe,iBe,sBe,cBe,fBe,dBe,bRe,sPe,vBe,gBe,bBe,xBe,SBe,YFe,_Be,RBe,PBe,UMe];try{for(nh=Pc(MBe),Rc=nh.next();!Rc.done;Rc=nh.next())ML=Rc.value,S.registerKernel(ML)}catch(n){ux={error:n}}finally{try{Rc&&!Rc.done&&(PL=nh.return)&&PL.call(nh)}finally{if(ux)throw ux.error}}var ML,nh,Rc;oh.MathBackendCPU=hx;oh.shared=wRe;oh.version_cpu=xRe});var Zq=Y(Bi=>{"use strict";Object.defineProperty(Bi,"__esModule",{value:!0});var k=Cs();function BBe(n){if(n&&n.__esModule)return n;var e=Object.create(null);return n&&Object.keys(n).forEach(function(t){if(t!=="default"){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}}),e.default=n,e}var LBe=BBe(k),Nx=function(n,e){return Nx=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])},Nx(n,e)};function zBe(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Nx(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Wc(n,e,t,r){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(r.next(l))}catch(f){o(f)}}function u(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((r=r.apply(n,e||[])).next())})}function Vc(n,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(l){c=[6,l],a=0}finally{r=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function ra(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Te(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=r.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return i}function dn(n,e,t){if(t||arguments.length===2)for(var r=0,a=e.length,i;r<a;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}var fu={},Yv={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function x$(n,e){fu[n]=e}function xi(n,e){if(!(n in fu)||e!=null){var t=qBe(n,e);if(t!==null)fu[n]=t;else return console.log("Could not get context for WebGL version",n),null}var r=fu[n];return r==null||r.isContextLost()?(delete fu[n],xi(n)):(r.disable(r.DEPTH_TEST),r.disable(r.STENCIL_TEST),r.disable(r.BLEND),r.disable(r.DITHER),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SAMPLE_COVERAGE),r.enable(r.SCISSOR_TEST),r.enable(r.CULL_FACE),r.cullFace(r.BACK),fu[n])}function $Be(n){if(typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function qBe(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=e??$Be(n);return t.addEventListener("webglcontextlost",function(r){r.preventDefault(),delete fu[n]},!1),k.env().getBool("SOFTWARE_WEBGL_ENABLED")&&(Yv.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",Yv)||t.getContext("experimental-webgl",Yv):t.getContext("webgl2",Yv)}var dh;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(dh||(dh={}));var ba;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(ba||(ba={}));var ir;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(ir||(ir={}));function yh(n,e){return[e,n]}function WBe(n,e){return n*e}function Zv(n){var e=k.util.sizeFromShape(n),t=Math.ceil(e/4);return k.util.sizeToSquarishShape(t)}function Uc(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function VBe(n,e){var t=Te(Uc(n,e),2),r=t[0],a=t[1];return r*a*4}function Fx(n,e){var t=n,r,a,i,o,s,u,c,l,f,h;return k.env().getNumber("WEBGL_VERSION")===2?(r=t.R32F,a=t.R16F,i=t.RGBA16F,o=t.RGBA32F,s=t.RED,c=4,l=1,f=t.HALF_FLOAT,h=t.FLOAT,u=t.RGBA8):(r=n.RGBA,a=n.RGBA,i=n.RGBA,o=t.RGBA,s=n.RGBA,c=4,l=4,f=e!=null?e.HALF_FLOAT_OES:null,h=n.FLOAT,u=n.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:a,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:s,downloadTextureFormat:u,downloadUnpackNumChannels:c,defaultNumChannels:l,textureTypeHalfFloat:f,textureTypeFloat:h}}function Oe(n,e){var t=e();return k.env().getBool("DEBUG")&&GBe(n),t}function GBe(n){var e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+S$(n,e))}var UBe=596e-10,HBe=65504;function k$(n){return!!(k.env().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||UBe<Math.abs(n)&&Math.abs(n)<HBe)}function S$(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(e)}}function uh(n,e){return uo(n,function(){return n.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function N$(n,e){var t=uo(n,function(){return n.createShader(n.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Oe(n,function(){return n.shaderSource(t,e)}),Oe(n,function(){return n.compileShader(t)}),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function T$(n,e){var t=uo(n,function(){return n.createShader(n.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Oe(n,function(){return n.shaderSource(t,e)}),Oe(n,function(){return n.compileShader(t)}),k.env().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw Rx(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}var KBe=/ERROR: [0-9]+:([0-9]+):/g;function Rx(n,e){var t=KBe.exec(e);if(t==null){console.log("Couldn't parse line number in error: ".concat(e)),console.log(n);return}for(var r=+t[1],a=n.split(`
`),i=a.length.toString().length+2,o=a.map(function(h,d){return k.util.rightPad((d+1).toString(),i)+h}),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var c=o.slice(0,r-1),l=o.slice(r-1,r),f=o.slice(r);console.log(c.join(`
`)),console.log(e.split(`
`)[0]),console.log("%c ".concat(k.util.rightPad(l[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join(`
`))}function E$(n){return uo(n,function(){return n.createProgram()},"Unable to create WebGLProgram.")}function I$(n,e){if(Oe(n,function(){return n.linkProgram(e)}),!k.env().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function tm(n,e){if(Oe(n,function(){return n.validateProgram(e)}),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function C$(n,e){var t=uo(n,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return Oe(n,function(){return n.bindBuffer(n.ARRAY_BUFFER,t)}),Oe(n,function(){return n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)}),t}function A$(n,e){var t=uo(n,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return Oe(n,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)}),Oe(n,function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)}),t}function jBe(){return k.env().getNumber("WEBGL_VERSION")===2?1:4}function D$(n){return uo(n,function(){return n.createTexture()},"Unable to create WebGLTexture.")}function _$(n,e){var t=k.env().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){var r="[".concat(n,"x").concat(e,"]");throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t){var r="[".concat(n,"x").concat(e,"]"),a="[".concat(t,"x").concat(t,"]");throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+a+".")}}function F$(n){return uo(n,function(){return n.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function Tx(n,e,t,r,a,i,o){var s=n.getAttribLocation(e,t);return s===-1?!1:(Oe(n,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),Oe(n,function(){return n.vertexAttribPointer(s,a,n.FLOAT,!1,i,o)}),Oe(n,function(){return n.enableVertexAttribArray(s)}),!0)}function R$(n,e,t){L$(n,t),Oe(n,function(){return n.activeTexture(n.TEXTURE0+t)}),Oe(n,function(){return n.bindTexture(n.TEXTURE_2D,e)})}function XBe(n,e){L$(n,e),Oe(n,function(){return n.activeTexture(n.TEXTURE0+e)}),Oe(n,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function O$(n,e,t){return uo(n,function(){return n.getUniformLocation(e,t)},'uniform "'+t+'" not present in program.')}function P$(n,e,t){return n.getUniformLocation(e,t)}function M$(n,e,t,r){Oe(n,function(){return R$(n,e,r)}),Oe(n,function(){return n.uniform1i(t,r)})}function YBe(n){Oe(n,function(){return n.bindFramebuffer(n.FRAMEBUFFER,null)}),Oe(n,function(){return n.viewport(0,0,n.canvas.width,n.canvas.height)}),Oe(n,function(){return n.scissor(0,0,n.canvas.width,n.canvas.height)})}function nm(n,e,t){Oe(n,function(){return n.bindFramebuffer(n.FRAMEBUFFER,t)}),Oe(n,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0)})}function Ex(n,e){Oe(n,function(){return n.bindFramebuffer(n.FRAMEBUFFER,e)}),Oe(n,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)})}function ch(n){var e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+B$(n,e))}function B$(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(e)}}function uo(n,e,t){var r=Oe(n,function(){return e()});if(r==null)throw new Error(t);return r}function L$(n,e){var t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t){var a="[gl.TEXTURE0, gl.TEXTURE".concat(t,"]");throw new Error("textureUnit must be in ".concat(a,"."))}}function hu(n,e){return e===void 0&&(e=2),k.util.sizeFromShape(n.slice(0,n.length-e))}function du(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function lh(n){var e=[1,1,1],t=n.length===0||n.length===1&&n[0]===1;return t||(e=dn([hu(n)],Te(du(n)),!1)),e}function z$(n,e){var t;e===void 0&&(e=!1);var r=k.env().getNumber("WEBGL_MAX_TEXTURE_SIZE"),a=k.env().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");if(a===1/0&&k.env().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(a=r/2),e&&(r=r*2,a=a*2,n=n.map(function(h,d){return d>=n.length-2?k.util.nearestLargerEven(n[d]):n[d]}),n.length===1&&(n=[2,n[0]])),n.length!==2){var i=k.util.squeezeShape(n);n=i.newShape}var o=k.util.sizeFromShape(n),s=null;n.length<=1&&o<=r?s=[1,o]:n.length===2&&n[0]<=r&&n[1]<=r?s=n:n.length===3&&n[0]*n[1]<=r&&n[2]<=r?s=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=r&&n[1]*n[2]<=r?s=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=r&&n[3]<=r?s=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=r&&n[1]*n[2]*n[3]<=r&&(s=[n[0],n[1]*n[2]*n[3]]);var u=s!=null&&Math.max.apply(Math,dn([],Te(s),!1))>a&&Math.min.apply(Math,dn([],Te(s),!1))<=(e?2:1)&&Math.min.apply(Math,dn([],Te(s),!1))>0;if(s==null||u)if(e){var c=hu(n),l=2,f=2;n.length&&(t=Te(du(n),2),l=t[0],f=t[1]),o=c*(l/2)*(f/2),s=k.util.sizeToSquarishShape(o).map(function(h){return h*2})}else s=k.util.sizeToSquarishShape(o);return s}function Jv(n){return n%2===0}function ph(n,e){if(n=n.slice(-2),e=e.slice(-2),k.util.arraysEqual(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){var t=n.slice(-1)[0],r=e.slice(-1)[0];if(t===r||Jv(t)&&Jv(r)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&Jv(n[0])&&Jv(e[0])}var rm,am;function $$(n){if(rm==null){var e=xi(n);rm=e.getParameter(e.MAX_TEXTURE_SIZE)}return rm}function ZBe(){rm=null}function JBe(){am=null}function q$(n){if(am==null){var e=xi(n);am=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,am)}function W$(n){if(n===0)return 0;var e,t=xi(n);return wa(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:wa(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function wa(n,e){var t=n.getExtension(e);return t!=null}function Ix(n){try{var e=xi(n);if(e!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function V$(n){if(n===0)return!1;var e=xi(n);if(n===1){if(!wa(e,"OES_texture_float"))return!1}else if(!wa(e,"EXT_color_buffer_float"))return!1;var t=Cx(e);return t}function G$(n){if(n===0)return!1;var e=xi(n);if(n===1){if(!wa(e,"OES_texture_float")||!wa(e,"WEBGL_color_buffer_float"))return!1}else{if(wa(e,"EXT_color_buffer_float"))return Cx(e);var t="EXT_color_buffer_half_float";if(wa(e,t)){var r=e.getExtension(t);return QBe(e,r)}return!1}var a=Cx(e);return a}function Cx(n){var e=Fx(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t);var r=1,a=1;n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,r,a,0,e.textureFormatFloat,e.textureTypeFloat,null);var i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);var o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(i),o}function QBe(n,e){var t=Fx(n,e),r=n.createTexture();n.bindTexture(n.TEXTURE_2D,r);var a=1,i=1;n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,a,i,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);var o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r,0);var s=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(r),n.deleteFramebuffer(o),s}function U$(n){if(n!==2)return!1;var e=xi(n),t=e.fenceSync!=null;return t}function Hc(n,e){Array.isArray(n)||(n=[n]),n.forEach(function(t){t!=null&&k.util.assert(t.dtype!=="complex64",function(){return"".concat(e," does not support complex64 tensors ")+"in the WebGL backend."})})}var eLe={__proto__:null,callAndCheck:Oe,canBeRepresented:k$,getWebGLErrorMessage:S$,getExtensionOrThrow:uh,createVertexShader:N$,createFragmentShader:T$,logShaderSourceAndInfoLog:Rx,createProgram:E$,linkProgram:I$,validateProgram:tm,createStaticVertexBuffer:C$,createStaticIndexBuffer:A$,getNumChannels:jBe,createTexture:D$,validateTextureSize:_$,createFramebuffer:F$,bindVertexBufferToProgramAttribute:Tx,bindTextureUnit:R$,unbindTextureUnit:XBe,getProgramUniformLocationOrThrow:O$,getProgramUniformLocation:P$,bindTextureToProgramUniformSampler:M$,bindCanvasToFramebuffer:YBe,bindColorTextureToFramebuffer:nm,unbindColorTextureFromFramebuffer:Ex,validateFramebuffer:ch,getFramebufferErrorMessage:B$,getBatchDim:hu,getRowsCols:du,getShapeAs3D:lh,getTextureShapeFromLogicalShape:z$,isReshapeFree:ph,getWebGLMaxTextureSize:$$,resetMaxTextureSize:ZBe,resetMaxTexturesInShader:JBe,getMaxTexturesInShader:q$,getWebGLDisjointQueryTimerVersion:W$,hasExtension:wa,isWebGLVersionEnabled:Ix,isCapableOfRenderingToFloatTexture:V$,isDownloadFloatTextureEnabled:G$,isWebGLFenceEnabled:U$,assertNotComplex:Hc};var Ke=k.env();Ke.registerFlag("HAS_WEBGL",function(){return Ke.getNumber("WEBGL_VERSION")>0});Ke.registerFlag("WEBGL_VERSION",function(){return Ix(2)?2:Ix(1)?1:0});Ke.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",function(){return!1});Ke.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return Ke.get("WEBGL_VERSION")===2});Ke.registerFlag("WEBGL_CPU_FORWARD",function(){return!0});Ke.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1});Ke.registerFlag("WEBGL_PACK",function(){return Ke.getBool("HAS_WEBGL")});Ke.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_CLIP",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_REDUCE",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_LAZILY_UNPACK",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_CONV_IM2COL",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return $$(Ke.getNumber("WEBGL_VERSION"))});Ke.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return q$(Ke.getNumber("WEBGL_VERSION"))});Ke.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var n=Ke.getNumber("WEBGL_VERSION");return n===0?0:W$(n)});Ke.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return Ke.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!k.device_util.isMobile()});Ke.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return V$(Ke.getNumber("WEBGL_VERSION"))});Ke.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return Ke.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Ke.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")});Ke.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return G$(Ke.getNumber("WEBGL_VERSION"))});Ke.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return U$(Ke.getNumber("WEBGL_VERSION"))});Ke.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){var n=Ke.getBool("WEBGL_RENDER_FLOAT32_ENABLED");return n?4:0});Ke.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",function(){return-1},function(n){if(n<0&&n!==-1)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never "+"delete) or at least 0, but got ".concat(n,"."))});Ke.registerFlag("WEBGL_FLUSH_THRESHOLD",function(){return k.device_util.isMobile()?1:-1},function(n){if(n<0&&n!==-1)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never "+"manual flush) or at least 0, but got ".concat(n,"."))});Ke.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",function(){return 128});Ke.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",function(){return!1});Ke.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",function(){return 1e5});Ke.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",function(){return 128});Ke.registerFlag("WEBGL_EXP_CONV",function(){return!1});Ke.registerFlag("SOFTWARE_WEBGL_ENABLED",function(){return Ke.getBool("IS_TEST")});Ke.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",function(){return 1/0});Ke.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",function(){return!1});Ke.registerFlag("WEBGL2_ISNAN_CUSTOM",function(){return!1});Ke.registerFlag("ENGINE_COMPILE_ONLY",function(){return!1});function xr(){var n,e,t,r,a,i,o,s,u,c;return k.env().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",s=k.env().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",u="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",r="varying",a="texture2D",i="gl_FragColor",o="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function pu(n,e,t){t===void 0&&(t="index");var r=k.util.computeStrides(e);return r.map(function(a,i){var o="int ".concat(n[i]," = ").concat(t," / ").concat(a),s=i===r.length-1?"int ".concat(n[i+1]," = ").concat(t," - ").concat(n[i]," * ").concat(a):"index -= ".concat(n[i]," * ").concat(a);return"".concat(o,"; ").concat(s,";")}).join("")}function lm(n,e,t){t===void 0&&(t="index");var r=k.util.computeStrides(e);return r.map(function(a,i){var o="int ".concat(n[i]," = ").concat(t," / outShapeStrides[").concat(i,"]"),s=i===r.length-1?"int ".concat(n[i+1]," = ").concat(t," - ").concat(n[i]," * outShapeStrides[").concat(i,"]"):"index -= ".concat(n[i]," * outShapeStrides[").concat(i,"]");return"".concat(o,"; ").concat(s,";")}).join("")}function tLe(n,e){var t=n.length,r=n.map(function(o){return"".concat(e,"[").concat(o,"]")}),a=new Array(t-1);a[t-2]=r[t-1];for(var i=t-3;i>=0;--i)a[i]="(".concat(a[i+1]," * ").concat(r[i+1],")");return a}function nLe(n,e,t){t===void 0&&(t="index");var r=n.map(function(i,o){return o}),a=tLe(r,e);return a.map(function(i,o){var s="int ".concat(n[o]," = ").concat(t," / ").concat(a[o]),u=o===a.length-1?"int ".concat(n[o+1]," = ").concat(t," - ").concat(n[o]," * ").concat(a[o]):"index -= ".concat(n[o]," * ").concat(a[o]);return"".concat(s,"; ").concat(u,";")}).join("")}function Ox(n){var e=k.util.computeStrides(n).map(function(t){return t.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `.concat(e[0]," + coords.y * ").concat(e[1],` + coords.z;
  }
`)}function Px(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}var H$=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`,K$=k.backend_util.getBroadcastDims;function rLe(n,e,t){var r=[];if(n.forEach(function(d){var p=k.util.sizeFromShape(d.shapeInfo.logicalShape);if(d.shapeInfo.isUniform?r.push("uniform float ".concat(d.name).concat(p>1?"[".concat(p,"]"):"",";")):(r.push("uniform sampler2D ".concat(d.name,";")),r.push("uniform int offset".concat(d.name,";"))),t.enableShapeUniforms){var v=Mx(t.packedInputs,d.shapeInfo.logicalShape,d.shapeInfo.texShape).uniformShape;switch(v.length){case 1:r.push("uniform int ".concat(d.name,"Shape;"));break;case 2:r.push("uniform ivec2 ".concat(d.name,"Shape;"));break;case 3:r.push("uniform ivec3 ".concat(d.name,"Shape;"));break;case 4:r.push("uniform ivec4 ".concat(d.name,"Shape;"));break}r.push("uniform ivec2 ".concat(d.name,"TexShape;"))}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;");break}r.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(function(d){r.push("uniform ".concat(d.type," ").concat(d.name).concat(d.arrayIndex?"[".concat(d.arrayIndex,"]"):"",";"))});var a=r.join(`
`),i=n.map(function(d){return aLe(d,e,t.packedInputs,t.enableShapeUniforms)}).join(`
`),o=e.texShape,s=xr(),u=sLe(s),c,l,f=lLe(s);e.isPacked?(c=iLe(e.logicalShape,o,t.enableShapeUniforms),l=cLe(s)):(c=oLe(e.logicalShape,o,t.enableShapeUniforms),l=uLe(s)),t.packedInputs&&(f+=pLe);var h=[f,u,l,a,c,i,t.userCode].join(`
`);return h}function Kc(n,e){e===void 0&&(e=!1);var t=n.shapeInfo.logicalShape;switch(t.length){case 0:return ELe(n,e);case 1:return CLe(n,e);case 2:return DLe(n,e);case 3:return FLe(n,e);case 4:return OLe(n,e);case 5:return PLe(n);case 6:return MLe(n);default:throw new Error("".concat(t.length,"-D input sampling")+" is not yet supported")}}function j$(n,e){var t=n.shapeInfo.logicalShape;switch(t.length){case 0:return TLe(n);case 1:return ILe(n,e);case 2:return ALe(n,e);case 3:return _Le(n,e);default:return RLe(n,e)}}function aLe(n,e,t,r){t===void 0&&(t=!1);var a="";t?a+=j$(n,r):a+=Kc(n,r);var i=n.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(t?a+=BLe(n,e):a+=LLe(n,e)),a}function iLe(n,e,t){switch(n.length){case 0:return X$();case 1:return vLe(n,e,t);case 2:return SLe(n,e,t);case 3:return gLe(n,e,t);default:return bLe(n,e,t)}}function oLe(n,e,t){switch(n.length){case 0:return X$();case 1:return mLe(n,e,t);case 2:return NLe(n,e,t);case 3:return yLe(n,e,t);case 4:return wLe(n,e,t);case 5:return xLe(n,e);case 6:return kLe(n,e);default:throw new Error("".concat(n.length,"-D output sampling is not yet supported"))}}function sLe(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `.concat(n.texture2D,`(textureSampler, uv).r;
    }
  `)}function uLe(n){return`
    void setOutput(float val) {
      `.concat(n.output,` = vec4(val, 0, 0, 0);
    }
  `)}function cLe(n){return`
    void setOutput(vec4 val) {
      `.concat(n.output,` = val;
    }
  `)}function lLe(n){var e="".concat(n.version,`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `).concat(n.varyingFs,` vec2 resultUV;
    `).concat(n.defineOutput,`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `).concat(n.defineSpecialNaN,`
    `).concat(n.defineSpecialInf,`
    `).concat(n.defineRound,`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `).concat(fLe,`
    `).concat(hLe,`
    `).concat(dLe,`
  `);return e}var fLe=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,hLe=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,dLe=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,pLe=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function X$(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function vLe(n,e,t){var r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return r[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `.concat(r[1],`.0);
      }
    `):r[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `.concat(r[0],`.0);
      }
    `):t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(r[0],", ").concat(r[1],`));
      return 2 * (resTexRC.x * `).concat(r[1],` + resTexRC.y);
    }
  `)}function mLe(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * `.concat(e[1],`.0);
      }
    `):e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * `.concat(e[0],`.0);
      }
    `):t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(e[0],", ").concat(e[1],`));
      return resTexRC.x * `).concat(e[1],` + resTexRC.y;
    }
  `)}function gLe(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;var r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],a=Math.ceil(n[2]/2),i=a*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(r[0],", ").concat(r[1],`));
      int index = resTexRC.x * `).concat(r[1],` + resTexRC.y;

      int b = index / `).concat(i,`;
      index -= b * `).concat(i,`;

      int r = 2 * (index / `).concat(a,`);
      int c = imod(index, `).concat(a,`) * 2;

      return ivec3(b, r, c);
    }
  `)}function yLe(n,e,t){if(t){var r=lm(["r","c","d"],n);return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    `.concat(r,`
    return ivec3(r, c, d);
  }
`)}var a=pu(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
      `).concat(a,`
      return ivec3(r, c, d);
    }
  `)}function bLe(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;for(var r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],a=Math.ceil(n[n.length-1]/2),i=a*Math.ceil(n[n.length-2]/2),o=i,s="",u="b, r, c",c=2;c<n.length-1;c++)o*=n[n.length-c-1],s=`
      int b`.concat(c," = index / ").concat(o,`;
      index -= b`).concat(c," * ").concat(o,`;
    `)+s,u="b".concat(c,", ")+u;return`
    ivec`.concat(n.length,` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`).concat(r[0],", ").concat(r[1],`));
      int index = resTexRC.x * `).concat(r[1],` + resTexRC.y;

      `).concat(s,`

      int b = index / `).concat(i,`;
      index -= b * `).concat(i,`;

      int r = 2 * (index / `).concat(a,`);
      int c = imod(index, `).concat(a,`) * 2;

      return ivec`).concat(n.length,"(").concat(u,`);
    }
  `)}function wLe(n,e,t){if(t){var r=lm(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      `.concat(r,`
      return ivec4(r, c, d, d2);
    }
  `)}var a=pu(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
      `).concat(a,`
      return ivec4(r, c, d, d2);
    }
  `)}function xLe(n,e){var t=pu(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`.concat(e[0],`,
                             `).concat(e[1],`));

      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;

      `).concat(t,`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `)}function kLe(n,e){var t=pu(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;

      `).concat(t,`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `)}function SLe(n,e,t){var r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(k.util.arraysEqual(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`.concat(r[0],", ").concat(r[1],`));
      }
    `);var a=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(r[0],", ").concat(r[1],`));

      int index = resTexRC.x * `).concat(r[1],` + resTexRC.y;
      int r = 2 * (index / `).concat(a,`);
      int c = imod(index, `).concat(a,`) * 2;

      return ivec2(r, c);
    }
  `)}function NLe(n,e,t){return k.util.arraysEqual(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`.concat(e[0],", ").concat(e[1],`));
      }
    `):n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`.concat(e[0],", ").concat(e[1],`));
        int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
        return ivec2(index, 0);
      }
    `):n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`.concat(e[0],", ").concat(e[1],`));
        int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
        return ivec2(0, index);
      }
    `):t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
      int r = index / `).concat(n[1],`;
      int c = index - r * `).concat(n[1],`;
      return ivec2(r, c);
    }
  `)}function vu(n){return"offset".concat(n)}function TLe(n){var e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=xr();return`
    vec4 `.concat(t,`() {
      return `).concat(r.texture2D,"(").concat(e,`, halfCR);
    }
  `)}function ELe(n,e){var t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return"float ".concat(r,"() {return ").concat(t,";}");var a=Te(n.shapeInfo.texShape,2),i=a[0],o=a[1];if(i===1&&o===1)return`
      float `.concat(r,`() {
        return sampleTexture(`).concat(t,`, halfCR);
      }
    `);var s=vu(t);if(e)return`
    float `.concat(r,`() {
      vec2 uv = uvFromFlat(`).concat(t,"TexShape[0], ").concat(t,"TexShape[1], ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `);var u=Te(n.shapeInfo.texShape,2),c=u[0],l=u[1];return`
    float `.concat(r,`() {
      vec2 uv = uvFromFlat(`).concat(c,", ").concat(l,", ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function ILe(n,e){var t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),a=n.shapeInfo.texShape,i=xr();if(e)return`
    vec4 `.concat(r,`(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(t,"TexShape[0]) / 2.0), ceil(float(").concat(t,`TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return `).concat(i.texture2D,"(").concat(t,`, uv);
    }
  `);var o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return`
    vec4 `.concat(r,`(int index) {
      vec2 uv = packedUVfrom1D(
        `).concat(o[0],", ").concat(o[1],`, index);
      return `).concat(i.texture2D,"(").concat(t,`, uv);
    }
  `)}function CLe(n,e){var t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float `.concat(r,`(int index) {
        `).concat(jc(n),`
      }
    `);var a=n.shapeInfo.texShape,i=a[0],o=a[1];if(o===1&&i===1)return`
      float `.concat(r,`(int index) {
        return sampleTexture(`).concat(t,`, halfCR);
      }
    `);var s=vu(t);return o===1?e?`
      float `.concat(r,`(int index) {
        vec2 uv = vec2(0.5, (float(index + `).concat(s,") + 0.5) / float(").concat(t,`TexShape[0]));
        return sampleTexture(`).concat(t,`, uv);
      }
    `):`
      float `.concat(r,`(int index) {
        vec2 uv = vec2(0.5, (float(index + `).concat(s,") + 0.5) / ").concat(i,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `):i===1?e?`
      float `.concat(r,`(int index) {
        vec2 uv = vec2((float(index + `).concat(s,") + 0.5) / float(").concat(t,`TexShape[1]), 0.5);
        return sampleTexture(`).concat(t,`, uv);
      }
    `):`
      float `.concat(r,`(int index) {
        vec2 uv = vec2((float(index + `).concat(s,") + 0.5) / ").concat(o,`.0, 0.5);
        return sampleTexture(`).concat(t,`, uv);
      }
    `):e?`
    float `.concat(r,`(int index) {
      vec2 uv = uvFromFlat(`).concat(t,"TexShape[0], ").concat(t,"TexShape[1], index + ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `):`
    float `.concat(r,`(int index) {
      vec2 uv = uvFromFlat(`).concat(i,", ").concat(o,", index + ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function ALe(n,e){var t=n.shapeInfo.logicalShape,r=n.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape,o=i[0],s=i[1],u=xr();if(i!=null&&k.util.arraysEqual(t,i))return e?`
      vec4 `.concat(a,`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(r,"TexShape[1], ").concat(r,`TexShape[0]);

        return `).concat(u.texture2D,"(").concat(r,`, uv);
      }
    `):`
      vec4 `.concat(a,`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(s,".0, ").concat(o,`.0);

        return `).concat(u.texture2D,"(").concat(r,`, uv);
      }
    `);if(e)return`
    vec4 `.concat(a,`(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,`TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(`).concat(r,`Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return `).concat(u.texture2D,"(").concat(r,`, uv);
    }
  `);var c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],l=Math.ceil(t[1]/2);return`
    vec4 `.concat(a,`(int row, int col) {
      vec2 uv = packedUVfrom2D(`).concat(l,", ").concat(c[0],", ").concat(c[1],`, row, col);
      return `).concat(u.texture2D,"(").concat(r,`, uv);
    }
  `)}function DLe(n,e){var t=n.shapeInfo.logicalShape,r=n.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape;if(i!=null&&k.util.arraysEqual(t,i)){if(e)return`
      float `.concat(a,`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(r,"TexShape[1], ").concat(r,`TexShape[0]);
        return sampleTexture(`).concat(r,`, uv);
      }
    `);var o=i[0],s=i[1];return`
    float `.concat(a,`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(s,".0, ").concat(o,`.0);
      return sampleTexture(`).concat(r,`, uv);
    }
  `)}var u=k.util.squeezeShape(t),c=u.newShape,l=u.keptDims,f=c;if(f.length<t.length){var h=Xc(n,f),d=["row","col"];return`
      `.concat(Kc(h,e),`
      float `).concat(a,`(int row, int col) {
        return `).concat(a,"(").concat(Yc(d,l),`);
      }
    `)}if(n.shapeInfo.isUniform)return`
      float `.concat(a,`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`).concat(t[1],`, 1)));
        `).concat(jc(n),`
      }
    `);var p=i[0],v=i[1],m=vu(r);return v===1?e?`
      float `.concat(a,`(int row, int col) {
        float index = dot(vec3(row, col, `).concat(m,"), vec3(").concat(r,`Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(`).concat(r,`TexShape[0]));
        return sampleTexture(`).concat(r,`, uv);
      }
    `):`
    float `.concat(a,`(int row, int col) {
      float index = dot(vec3(row, col, `).concat(m,"), vec3(").concat(t[1],`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `).concat(p,`.0);
      return sampleTexture(`).concat(r,`, uv);
    }
  `):p===1?e?`
      float `.concat(a,`(int row, int col) {
        float index = dot(vec3(row, col, `).concat(m,"), vec3(").concat(r,`Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(`).concat(r,`TexShape[1]), 0.5);
        return sampleTexture(`).concat(r,`, uv);
      }
    `):`
    float `.concat(a,`(int row, int col) {
      float index = dot(vec3(row, col, `).concat(m,"), vec3(").concat(t[1],`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `).concat(v,`.0, 0.5);
      return sampleTexture(`).concat(r,`, uv);
    }
  `):e?`
      float `.concat(a,`(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `).concat(r,"Shape[1] + col + ").concat(m,`;
        vec2 uv = uvFromFlat(`).concat(r,"TexShape[0], ").concat(r,`TexShape[1], index);
        return sampleTexture(`).concat(r,`, uv);
      }
    `):`
  float `.concat(a,`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `).concat(t[1]," + col + ").concat(m,`;
    vec2 uv = uvFromFlat(`).concat(p,", ").concat(v,`, index);
    return sampleTexture(`).concat(r,`, uv);
  }
`)}function _Le(n,e){var t=n.shapeInfo.logicalShape,r=n.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(t[0]===1){var s=t.slice(1),u=[1,2],c=Xc(n,s),l=["b","row","col"];return`
        `.concat(j$(c,e),`
        vec4 `).concat(a,`(int b, int row, int col) {
          return `).concat(a,"(").concat(Yc(l,u),`);
        }
      `)}var f=xr();if(e)return`
    vec4 `.concat(a,`(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,`TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(`).concat(r,`Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(`).concat(r,`Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return `).concat(f.texture2D,"(").concat(r,`, uv);
    }
  `);var h=o[0],d=o[1],p=Math.ceil(t[2]/2),v=p*Math.ceil(t[1]/2);return`
    vec4 `.concat(a,`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `).concat(h,", ").concat(d,", ").concat(v,", ").concat(p,`, b, row, col);
      return `).concat(f.texture2D,"(").concat(r,`, uv);
    }
  `)}function FLe(n,e){var t=n.shapeInfo.logicalShape,r=n.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t[1]*t[2],o=t[2],s=k.util.squeezeShape(t),u=s.newShape,c=s.keptDims,l=u;if(l.length<t.length){var f=Xc(n,l),h=["row","col","depth"];return`
        `.concat(Kc(f,e),`
        float `).concat(a,`(int row, int col, int depth) {
          return `).concat(a,"(").concat(Yc(h,c),`);
        }
      `)}if(n.shapeInfo.isUniform)return`
      float `.concat(a,`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`).concat(i,", ").concat(o,`, 1)));
        `).concat(jc(n),`
      }
    `);var d=n.shapeInfo.texShape,p=d[0],v=d[1],m=n.shapeInfo.flatOffset;if(v===i&&m==null)return e?`
      float `.concat(a,`(int row, int col, int depth) {
        int stride1 = `).concat(r,`Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(r,"TexShape[1], ").concat(r,`TexShape[0]);
        return sampleTexture(`).concat(r,`, uv);
      }
    `):`
        float `.concat(a,`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`).concat(o,`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`).concat(v,".0, ").concat(p,`.0);
          return sampleTexture(`).concat(r,`, uv);
        }
      `);if(v===o&&m==null)return e?`
      float `.concat(a,`(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(`).concat(r,`Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`).concat(r,"TexShape[1], ").concat(r,`TexShape[0]);
        return sampleTexture(`).concat(r,`, uv);
      }
    `):`
    float `.concat(a,`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`).concat(t[1],`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`).concat(v,".0, ").concat(p,`.0);
      return sampleTexture(`).concat(r,`, uv);
    }
  `);var g=vu(r);return e?`
    float `.concat(a,`(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = `).concat(r,"Shape[1] * ").concat(r,`Shape[2];
      int stride1 = `).concat(r,`Shape[2];
      int index = row * stride0 + col * stride1 + depth + `).concat(g,`;
      vec2 uv = uvFromFlat(`).concat(r,"TexShape[0], ").concat(r,`TexShape[1], index);
      return sampleTexture(`).concat(r,`, uv);
    }
    `):`
      float `.concat(a,`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `).concat(i," + col * ").concat(o," + depth + ").concat(g,`;
        vec2 uv = uvFromFlat(`).concat(p,", ").concat(v,`, index);
        return sampleTexture(`).concat(r,`, uv);
      }
  `)}function RLe(n,e){var t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),a=xr();if(e)return`
    vec4 `.concat(r,`(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(`).concat(t,`Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(`).concat(t,`Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= `).concat(t,`Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(t,"TexShape[0]) / 2.0), ceil(float(").concat(t,`TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return `).concat(a.texture2D,"(").concat(t,`, uv);
    }
  `);for(var i=n.shapeInfo.logicalShape,o=i.length,s=n.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=u[0],l=u[1],f=Math.ceil(i[o-1]/2),h=f*Math.ceil(i[o-2]/2),d="int b, int row, int col",p="b * ".concat(h," + (row / 2) * ").concat(f," + (col / 2)"),v=2;v<o-1;v++)d="int b".concat(v,", ")+d,h*=i[o-v-1],p="b".concat(v," * ").concat(h," + ")+p;return`
    vec4 `.concat(r,"(").concat(d,`) {
      int index = `).concat(p,`;
      int texR = index / `).concat(l,`;
      int texC = index - texR * `).concat(l,`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`).concat(l,", ").concat(c,`);
      return `).concat(a.texture2D,"(").concat(t,`, uv);
    }
  `)}function OLe(n,e){var t=n.shapeInfo.logicalShape,r=n.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t[3],o=t[2]*i,s=t[1]*o,u=k.util.squeezeShape(t),c=u.newShape,l=u.keptDims;if(c.length<t.length){var f=Xc(n,c),h=["row","col","depth","depth2"];return`
      `.concat(Kc(f,e),`
      float `).concat(a,`(int row, int col, int depth, int depth2) {
        return `).concat(a,"(").concat(Yc(h,l),`);
      }
    `)}if(n.shapeInfo.isUniform)return`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`).concat(s,", ").concat(o,", ").concat(i,`, 1)));
        `).concat(jc(n),`
      }
    `);var d=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,v=p[0],m=p[1],g="int stride2 = ".concat(r,"Shape[3];"),y="int stride1 = ".concat(r,"Shape[2] * stride2;"),b="int stride0 = ".concat(r,"Shape[1] * stride1;");if(m===s&&d==null)return e?`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        `).concat(g,`
        `).concat(y,`
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(r,"TexShape[1], ").concat(r,`TexShape[0]);
        return sampleTexture(`).concat(r,`, uv);
      }
    `):`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`).concat(o,", ").concat(i,`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(m,".0, ").concat(v,`.0);
        return sampleTexture(`).concat(r,`, uv);
      }
    `);if(m===i&&d==null)return e?`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`).concat(r,"Shape[1] * ").concat(r,"Shape[2], ").concat(r,`Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(r,"TexShape[1], ").concat(r,`TexShape[0]);
        return sampleTexture(`).concat(r,`, uv);
      }
    `):`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`).concat(t[1]*t[2],", ").concat(t[2],`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(m,".0, ").concat(v,`.0);
        return sampleTexture(`).concat(r,`, uv);
      }
    `);var w=vu(r);return e?`
    float `.concat(a,`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      `).concat(g,`
      `).concat(y,`
      `).concat(b,`
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(`).concat(r,"TexShape[0], ").concat(r,"TexShape[1], index + ").concat(w,`);
      return sampleTexture(`).concat(r,`, uv);
    }
  `):`
    float `.concat(a,`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `).concat(s," + col * ").concat(o,` +
          depth * `).concat(i,` + depth2;
      vec2 uv = uvFromFlat(`).concat(v,", ").concat(m,", index + ").concat(w,`);
      return sampleTexture(`).concat(r,`, uv);
    }
  `)}function PLe(n){var e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),a=e[4],i=e[3]*a,o=e[2]*i,s=e[1]*o,u=k.util.squeezeShape(e),c=u.newShape,l=u.keptDims;if(c.length<e.length){var f=Xc(n,c),h=["row","col","depth","depth2","depth3"];return`
      `.concat(Kc(f),`
      float `).concat(r,`(int row, int col, int depth, int depth2, int depth3) {
        return `).concat(r,"(").concat(Yc(h,l),`);
      }
    `)}if(n.shapeInfo.isUniform)return`
      float `.concat(r,`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`).concat(s,", ").concat(o,", ").concat(i,", ").concat(a,`)) +
          depth3;
        `).concat(jc(n),`
      }
    `);var d=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,v=p[0],m=p[1];if(m===s&&d==null)return`
      float `.concat(r,`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`).concat(o,", ").concat(i,", ").concat(a,`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(m,".0, ").concat(v,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);if(m===a&&d==null)return`
      float `.concat(r,`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`).concat(e[1]*e[2]*e[3],`,
               `).concat(e[2]*e[3],", ").concat(e[3],`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(m,".0, ").concat(v,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);var g=vu(t);return`
    float `.concat(r,`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `).concat(s," + col * ").concat(o," + depth * ").concat(i,` +
          depth2 * `).concat(a," + depth3 + ").concat(g,`;
      vec2 uv = uvFromFlat(`).concat(v,", ").concat(m,`, index);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function MLe(n){var e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),a=k.util.squeezeShape(e),i=a.newShape,o=a.keptDims;if(i.length<e.length){var s=Xc(n,i),u=["row","col","depth","depth2","depth3","depth4"];return`
      `.concat(Kc(s),`
      float `).concat(r,`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `).concat(r,"(").concat(Yc(u,o),`);
      }
    `)}var c=e[5],l=e[4]*c,f=e[3]*l,h=e[2]*f,d=e[1]*h;if(n.shapeInfo.isUniform)return`
      float `.concat(r,`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`).concat(d,", ").concat(h,", ").concat(f,", ").concat(l,`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`).concat(c,`, 1)));
        `).concat(jc(n),`
      }
    `);var p=n.shapeInfo.flatOffset,v=n.shapeInfo.texShape,m=v[0],g=v[1];if(g===d&&p==null)return`
      float `.concat(r,`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`).concat(h,", ").concat(f,", ").concat(l,", ").concat(c,`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(g,".0, ").concat(m,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);if(g===c&&p==null)return`
      float `.concat(r,`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`).concat(e[1]*e[2]*e[3]*e[4],`,
               `).concat(e[2]*e[3]*e[4],`,
               `).concat(e[3]*e[4],`,
               `).concat(e[4],`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(g,".0, ").concat(m,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);var y=vu(t);return`
    float `.concat(r,`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `).concat(d," + col * ").concat(h," + depth * ").concat(f,` +
          depth2 * `).concat(l," + depth3 * ").concat(c," + depth4 + ").concat(y,`;
      vec2 uv = uvFromFlat(`).concat(m,", ").concat(g,`, index);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function jc(n){var e=n.name,t=k.util.sizeFromShape(n.shapeInfo.logicalShape);return t<2?"return ".concat(e,";"):`
    for (int i = 0; i < `.concat(t,`; i++) {
      if (i == index) {
        return `).concat(e,`[i];
      }
    }
  `)}function BLe(n,e){var t=n.name,r=t.charAt(0).toUpperCase()+t.slice(1),a="get"+r+"AtOutCoords",i=n.shapeInfo.logicalShape.length,o=e.logicalShape.length,s=K$(n.shapeInfo.logicalShape,e.logicalShape),u=Wt(o),c=o-i,l,f=["x","y","z","w","u","v"];i===0?l="":o<2&&s.length>=1?l="coords = 0;":l=s.map(function(w){return"coords.".concat(f[w+c]," = 0;")}).join(`
`);var h="";o<2&&i>0?h="coords":h=n.shapeInfo.logicalShape.map(function(w,x){return"coords.".concat(f[x+c])}).join(", ");var d="return outputValue;",p=k.util.sizeFromShape(n.shapeInfo.logicalShape),v=p===1,m=k.util.sizeFromShape(e.logicalShape),g=m===1;if(i===1&&!v&&!g)d=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(v&&!g)o===1?d=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:d=`
        return vec4(outputValue.x);
      `;else if(s.length){var y=i-2,b=i-1;s.indexOf(y)>-1&&s.indexOf(b)>-1?d="return vec4(outputValue.x);":s.indexOf(y)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":s.indexOf(b)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 `.concat(a,`() {
      `).concat(u,` coords = getOutputCoords();
      `).concat(l,`
      vec4 outputValue = get`).concat(r,"(").concat(h,`);
      `).concat(d,`
    }
  `)}function LLe(n,e){var t=n.name,r=t.charAt(0).toUpperCase()+t.slice(1),a="get"+r+"AtOutCoords",i=e.texShape,o=n.shapeInfo.texShape,s=n.shapeInfo.logicalShape.length,u=e.logicalShape.length;if(!n.shapeInfo.isUniform&&s===u&&n.shapeInfo.flatOffset==null&&k.util.arraysEqual(o,i))return`
      float `.concat(a,`() {
        return sampleTexture(`).concat(t,`, resultUV);
      }
    `);var c=Wt(u),l=K$(n.shapeInfo.logicalShape,e.logicalShape),f=u-s,h,d=["x","y","z","w","u","v"];s===0?h="":u<2&&l.length>=1?h="coords = 0;":h=l.map(function(v){return"coords.".concat(d[v+f]," = 0;")}).join(`
`);var p="";return u<2&&s>0?p="coords":p=n.shapeInfo.logicalShape.map(function(v,m){return"coords.".concat(d[m+f])}).join(", "),`
    float `.concat(a,`() {
      `).concat(c,` coords = getOutputCoords();
      `).concat(h,`
      return get`).concat(r,"(").concat(p,`);
    }
  `)}function Wt(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error("GPU for rank ".concat(n," is not yet supported"))}function Mx(n,e,t){var r=k.util.squeezeShape(e),a=r.newShape,i=r.keptDims,o=e.length,s=n&&o===3&&e[0]===1,u=s?e.slice(1):a,c=!n&&o>1&&!k.util.arraysEqual(e,t)&&a.length<o||s,l=c?u:e;return{useSqueezeShape:c,uniformShape:l,keptDims:i}}function Xc(n,e){var t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Yc(n,e){return e.map(function(t){return n[t]}).join(", ")}function zLe(n,e,t,r){var a=t.map(function(l,f){var h={logicalShape:l.shape,texShape:l.isUniform?null:l.texData.texShape,isUniform:l.isUniform,isPacked:l.isUniform?!1:l.texData.isPacked,flatOffset:null};return l.texData!=null&&l.texData.slice!=null&&l.texData.slice.flatOffset>0&&(h.flatOffset=l.texData.slice.flatOffset),{name:e.variableNames[f],shapeInfo:h}}),i=a.map(function(l){return l.shapeInfo}),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},s=rLe(a,o,e),u=T$(n.gl,s),c=n.createProgram(u);return k.env().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:e,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o},Y$(n,e,c))}function Y$(n,e,t){var r={},a={},i={},o=[],s,u,c,l=null,f=null;f=n.getUniformLocation(t,"NAN",!1),k.env().getNumber("WEBGL_VERSION")===1&&(l=n.getUniformLocation(t,"INFINITY",!1));for(var h=!1,d=0;d<e.variableNames.length;d++){var p=e.variableNames[d];r[p]=n.getUniformLocation(t,p,h),r["offset".concat(p)]=n.getUniformLocation(t,"offset".concat(p),h),e.enableShapeUniforms&&(a["".concat(p,"Shape")]=n.getUniformLocation(t,"".concat(p,"Shape"),h),i["".concat(p,"TexShape")]=n.getUniformLocation(t,"".concat(p,"TexShape"),h))}return e.enableShapeUniforms&&(s=n.getUniformLocation(t,"outShape",h),c=n.getUniformLocation(t,"outShapeStrides",h),u=n.getUniformLocation(t,"outTexShape",h)),e.customUniforms&&e.customUniforms.forEach(function(v,m){o[m]=n.getUniformLocation(t,v.name,h)}),{uniformLocations:r,customUniformLocations:o,infLoc:l,nanLoc:f,inShapesLocations:a,inTexShapesLocations:i,outShapeLocation:s,outShapeStridesLocation:c,outTexShapeLocation:u}}function Uz(n,e){if(n.length!==e.length)throw Error("Binary was compiled with ".concat(n.length," inputs, but ")+"was executed with ".concat(e.length," inputs"));n.forEach(function(t,r){var a=t.logicalShape,i=e[r],o=i.shape;if(!k.util.arraysEqual(a,o))throw Error("Binary was compiled with different shapes than "+"the current args. Shapes ".concat(a," and ").concat(o," must match"));if(!(t.isUniform&&i.isUniform)){var s=t.texShape,u=i.isUniform?null:i.texData.texShape;if(!k.util.arraysEqual(s,u))throw Error("Binary was compiled with different texture shapes than the"+" current args. Shape ".concat(s," and ").concat(u," must match"))}})}function $Le(n,e,t,r,a){e.program.enableShapeUniforms||(Uz(e.inShapeInfos,t),Uz([e.outShapeInfo],[r]));var i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?n.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):n.setOutputMatrixTexture(i.texture,o[0],o[1]),n.setProgram(e.webGLProgram),k.env().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN),t.forEach(function(c,l){var f=e.program.variableNames[l],h=e.uniformLocations[f],d=e.uniformLocations["offset".concat(f)],p=e.inShapesLocations["".concat(f,"Shape")],v=e.inTexShapesLocations["".concat(f,"TexShape")];if(p){var m=Mx(e.program.packedInputs,c.shape,c.texData.texShape).uniformShape;switch(m.length){case 1:n.gl.uniform1iv(p,new Int32Array(m));break;case 2:n.gl.uniform2iv(p,new Int32Array(m));break;case 3:n.gl.uniform3iv(p,new Int32Array(m));break;case 4:n.gl.uniform4iv(p,new Int32Array(m));break}}if(v&&n.gl.uniform2i(v,c.texData.texShape[0],c.texData.texShape[1]),h!=null){if(c.isUniform){if(k.util.sizeFromShape(c.shape)<2)n.gl.uniform1f(h,c.uniformValues[0]);else{var g=c.uniformValues;g instanceof Float32Array||(g=new Float32Array(g)),n.gl.uniform1fv(h,g)}return}c.texData.slice!=null&&d!=null&&n.gl.uniform1i(d,c.texData.slice.flatOffset),n.setInputMatrixTexture(c.texData.texture.texture,h,l)}});var s=e.outShapeLocation;if(s)switch(r.shape.length){case 1:n.gl.uniform1iv(s,new Int32Array(r.shape));break;case 2:n.gl.uniform2iv(s,new Int32Array(r.shape));break;case 3:n.gl.uniform3iv(s,new Int32Array(r.shape));break;case 4:n.gl.uniform4iv(s,new Int32Array(r.shape));break}if(e.outShapeStridesLocation){var u=k.util.computeStrides(r.shape);switch(r.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(u));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(u));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(u));break}}e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),e.program.customUniforms&&a&&e.program.customUniforms.forEach(function(c,l){var f=e.customUniformLocations[l],h=a[l];if(c.type==="float")n.gl.uniform1fv(f,h);else if(c.type==="vec2")n.gl.uniform2fv(f,h);else if(c.type==="vec3")n.gl.uniform3fv(f,h);else if(c.type==="vec4")n.gl.uniform4fv(f,h);else if(c.type==="int")n.gl.uniform1iv(f,h);else if(c.type==="ivec2")n.gl.uniform2iv(f,h);else if(c.type==="ivec3")n.gl.uniform3iv(f,h);else if(c.type==="ivec4")n.gl.uniform4iv(f,h);else throw Error("uniform type ".concat(c.type," is not supported yet."))}),n.executeProgram()}function qLe(n,e,t){var r="";e.concat(t).forEach(function(o){var s=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!o.isUniform){var u=o.texData.texShape,c=Mx(n.packedInputs,o.shape,u),l=c.useSqueezeShape,f=c.uniformShape,h=c.keptDims,d="",p="",v="";if(f.length===1&&n.packedInputs){var m=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];d="".concat(m[0]>1,"_").concat(m[1]>1)}else if(f.length===2&&!n.packedInputs)p="".concat(f[0]>1,"_").concat(f[1]>1);else if(f.length>2&&!n.packedInputs){var g=k.util.computeStrides(f);v="".concat(g[0]===u[1],"_").concat(g[g.length-1]===u[1])}var y=o.shape.length,b=f.length===2&&k.util.arraysEqual(o.shape,u),w=k.util.sizeFromShape(o.shape)===1,x=k.backend_util.getBroadcastDims(o.shape,t.shape),N=!n.packedInputs&&y===t.shape.length&&k.util.arraysEqual(u,t.texData.texShape),T=n.packedInputs||f.length>2?"":"".concat(u[0]>1,"_").concat(u[1]>1);r+="".concat(y,"_").concat(N,"_").concat(l?h:"","_").concat(f.length,"_").concat(w,"_").concat(x,"_").concat(b,"_").concat(d,"_").concat(p,"_").concat(v,"_").concat(T,"_").concat(s)}else{var E=o.isUniform?"uniform":o.texData.texShape;r+="".concat(o.shape,"_").concat(E,"_").concat(s)}});var a=n.userCode,i=n.constructor.name;return i+="_"+r+"_"+a+"".concat(k.env().getNumber("WEBGL_VERSION")),i}function kr(n){return k.env().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}var WLe=function(){function n(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=dh.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var t=xr();this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `.concat(this.enableShapeUniforms?lm(["r","c","d"],e):pu(["r","c","d"],e),`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `).concat(t.output,` = result;
      }
    `)}return n}();var VLe=function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=dh.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var t=xr();this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `.concat(this.enableShapeUniforms?lm(["r","c","d"],e):pu(["r","c","d"],e),`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `).concat(t.output,` = result;
      }
    `)}return n}();var GLe=function(){function n(e){this.variableNames=["A"],this.outTexUsage=ba.DOWNLOAD;var t=xr();this.outputShape=e,this.userCode=`
      `.concat(H$,`

      void main() {
        float x = getAAtOutCoords();
        `).concat(t.output,` = encode_float(x);
      }
    `)}return n}();var ULe=function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ba.DOWNLOAD;var t=xr();this.outputShape=e,this.userCode=`
      `.concat(H$,`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `).concat(t.output,` = encode_float(x);
      }
    `)}return n}();var HLe={R:0,G:1,B:2,A:3},Hz=function(){function n(e,t,r){t===void 0&&(t=!1),r===void 0&&(r="RGBA"),this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];var a=xr();this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length);var i="result";t&&(i="floor(result * 255. + 0.5)");for(var o="",s=0;s<r.length;s++){var u=r[s];o+=`
          if(offset == `.concat(s,`) {
            result = values[`).concat(HLe[u],`];
          }`)}this.userCode=`
      `.concat(this.enableShapeUniforms?Px():Ox(e),`

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, `).concat(r.length,`);

        flatIndex = idiv(flatIndex, `).concat(r.length,`, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = `).concat(a.texture2D,`(A, uv);
          `).concat(o,`
        }
        `).concat(a.output," = vec4(").concat(i,`, 0., 0., 0.);
      }
    `)}return n}();var KLe=function(){function n(e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];var r=xr();this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length);var a="",i="result";t&&(i="floor(result * 255. + 0.5)");for(var o=0;o<=1;o++)for(var s=0;s<=1;s++){var u=o*2+s;a+=`
          localCoords = coords;
          if(localCoords[2] + `.concat(s," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(e[2]),`) {
          localCoords[2] += `).concat(s,`;
          if (localCoords[1] + `).concat(o," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(e[1]),`) {
            localCoords[1] += `).concat(o,`;

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = `).concat(r.texture2D,`(A, uv);

            if (offset == 0) {
              result[`).concat(u,`] = values[0];
            } else if (offset == 1) {
              result[`).concat(u,`] = values[1];
            } else if (offset == 2) {
              result[`).concat(u,`] = values[2];
            } else {
              result[`).concat(u,`] = values[3];
            }
          }
        }
        `)}this.userCode=`
        `.concat(this.enableShapeUniforms?Px():Ox(e),`

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          `).concat(a,`

          `).concat(r.output," = ").concat(i,`;
        }
    `)}return n}();function Z$(n){var e=xr(),t="".concat(e.version,`
    precision highp float;
    `).concat(e.attribute,` vec3 clipSpacePos;
    `).concat(e.attribute,` vec2 uv;
    `).concat(e.varyingVs,` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`);return N$(n,t)}function J$(n){var e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return C$(n,e)}function Q$(n){var e=new Uint16Array([0,1,2,2,1,3]);return A$(n,e)}function bh(n,e,t,r,a,i){_$(e,t);var o=D$(n),s=n.TEXTURE_2D;return Oe(n,function(){return n.bindTexture(s,o)}),Oe(n,function(){return n.texParameteri(s,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)}),Oe(n,function(){return n.texParameteri(s,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)}),Oe(n,function(){return n.texParameteri(s,n.TEXTURE_MIN_FILTER,n.NEAREST)}),Oe(n,function(){return n.texParameteri(s,n.TEXTURE_MAG_FILTER,n.NEAREST)}),k.env().getNumber("WEBGL_VERSION")===1?Oe(n,function(){return n.texImage2D(s,0,r,e,t,0,a,i,null)}):Oe(n,function(){return n.texStorage2D(s,1,r,e,t)}),Oe(n,function(){return n.bindTexture(n.TEXTURE_2D,null)}),{texture:o,texShape:[t,e]}}function Bx(n){return n.internalFormatFloat}function eq(n,e,t,r){var a=Te(yh(e,t),2),i=a[0],o=a[1];return bh(n,i,o,Bx(r),r.textureFormatFloat,n.FLOAT)}function Lx(n){return n.internalFormatHalfFloat}function tq(n,e,t,r){var a=Te(yh(e,t),2),i=a[0],o=a[1];return bh(n,i,o,Lx(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function zx(n){return n.downloadTextureFormat}function nq(n,e,t,r){var a=Te(yh(e,t),2),i=a[0],o=a[1];return bh(n,i,o,zx(r),n.RGBA,n.UNSIGNED_BYTE)}function $x(n){return n.internalFormatPackedFloat}function rq(n,e,t,r){var a=Te(Uc(e,t),2),i=a[0],o=a[1];return bh(n,i,o,$x(r),n.RGBA,n.FLOAT)}function qx(n){return n.internalFormatPackedHalfFloat}function aq(n,e,t,r){var a=Te(Uc(e,t),2),i=a[0],o=a[1];return bh(n,i,o,qx(r),n.RGBA,r.textureTypeHalfFloat)}function iq(n,e,t){var r=0,a=3*4,i=3*4+2*4;Oe(n,function(){return n.bindBuffer(n.ARRAY_BUFFER,t)});var o=Tx(n,e,"clipSpacePos",t,3,i,r);return o&&Tx(n,e,"uv",t,2,i,a)}function oq(n,e,t,r,a,i){Oe(n,function(){return n.bindTexture(n.TEXTURE_2D,e)});var o,s,u;a instanceof Uint8Array?(o=new Uint8Array(t*r*4),s=n.UNSIGNED_BYTE,u=n.RGBA):(o=new Float32Array(t*r*4),s=n.FLOAT,u=i.internalFormatPackedFloat),o.set(a),k.env().getNumber("WEBGL_VERSION")===2?Oe(n,function(){return n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,r,n.RGBA,s,o)}):Oe(n,function(){return n.texImage2D(n.TEXTURE_2D,0,u,t,r,0,n.RGBA,s,o)}),Oe(n,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function sq(n,e,t){Oe(n,function(){return n.bindTexture(n.TEXTURE_2D,e)}),t.data instanceof Uint8Array?k.env().getNumber("WEBGL_VERSION")===2?Oe(n,function(){return n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)}):Oe(n,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)}):k.env().getNumber("WEBGL_VERSION")===2?Oe(n,function(){return n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)}):Oe(n,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)}),Oe(n,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function uq(n,e,t,r){var a=n.createBuffer();Oe(n,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,a)});var i=4,o=4,s=i*o*e*t;return Oe(n,function(){return n.bufferData(n.PIXEL_PACK_BUFFER,s,n.STREAM_READ)}),Oe(n,function(){return n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)}),Oe(n,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,null)}),a}function cq(n,e,t){var r=n,a=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}function lq(n,e,t,r){var a=Te(yh(e,t),2),i=a[0],o=a[1],s=4,u=new Uint8Array(WBe(e*t,s));return Oe(n,function(){return n.readPixels(0,0,i,o,r.downloadTextureFormat,n.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function fq(n,e,t,r,a,i,o,s){var u=n,c=new Float32Array(VBe(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function hq(n,e,t){var r=new Float32Array(e*t*4);return Oe(n,function(){return n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,r)}),r}var jLe={__proto__:null,createVertexShader:Z$,createVertexBuffer:J$,createIndexBuffer:Q$,getInternalFormatForFloat32MatrixTexture:Bx,createFloat32MatrixTexture:eq,getInternalFormatForFloat16MatrixTexture:Lx,createFloat16MatrixTexture:tq,getInternalFormatForUnsignedBytesMatrixTexture:zx,createUnsignedBytesMatrixTexture:nq,getInternalFormatForPackedMatrixTexture:$x,createPackedMatrixTexture:rq,getInternalFormatForFloat16PackedMatrixTexture:qx,createFloat16PackedMatrixTexture:aq,bindVertexProgramAttributeStreams:iq,uploadDenseMatrixToTexture:oq,uploadPixelDataToTexture:sq,createBufferFromOutputTexture:uq,downloadFloat32MatrixFromBuffer:cq,downloadByteEncodedFloatMatrixFromOutputTexture:lq,downloadPackedMatrixFromBuffer:fq,downloadMatrixFromPackedOutputTexture:hq},im=function(){function n(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];var t=k.env().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,x$(t,e)):this.gl=xi(t),e=this.gl,k.env().getNumber("WEBGL_VERSION")===2){var r=e;this.createVertexArray=function(){return Oe(r,function(){return r.createVertexArray()})},this.bindVertexArray=function(c){return Oe(r,function(){return r.bindVertexArray(c)})},this.deleteVertexArray=function(c){return Oe(r,function(){return r.deleteVertexArray(c)})},this.getVertexArray=function(){return Oe(r,function(){return r.getParameter(r.VERTEX_ARRAY_BINDING)})}}else if(e!=null){var a=e.getExtension("OES_vertex_array_object");if(a==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=function(){return Oe(e,function(){return a.createVertexArrayOES()})},this.bindVertexArray=function(c){return Oe(e,function(){return a.bindVertexArrayOES(c)})},this.deleteVertexArray=function(c){return Oe(e,function(){return a.deleteVertexArrayOES(c)})},this.getVertexArray=function(){return Oe(e,function(){return e.getParameter(a.VERTEX_ARRAY_BINDING_OES)})}}var i="WEBGL_color_buffer_float",o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),k.env().getNumber("WEBGL_VERSION")===1){var s="OES_texture_float",u="OES_texture_half_float";if(this.textureFloatExtension=uh(this.gl,s),wa(this.gl,u))this.textureHalfFloatExtension=uh(this.gl,u);else if(k.env().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(i),wa(this.gl,o))this.colorBufferHalfFloatExtension=uh(this.gl,o);else if(k.env().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(i="EXT_color_buffer_float",wa(this.gl,i))this.colorBufferFloatExtension=this.gl.getExtension(i);else if(wa(this.gl,o))this.colorBufferHalfFloatExtension=this.gl.getExtension(o);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=J$(this.gl),this.indexBuffer=Q$(this.gl),this.framebuffer=F$(this.gl),this.textureConfig=Fx(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return k.env().getBool("DEBUG")},enumerable:!1,configurable:!0}),n.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Oe(t,function(){return t.finish()}),Oe(t,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Oe(t,function(){return t.deleteFramebuffer(e.framebuffer)}),Oe(t,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),Oe(t,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),Oe(t,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),eq(this.gl,e,t,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),tq(this.gl,e,t,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),nq(this.gl,e,t,this.textureConfig)},n.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),sq(this.gl,e,t)},n.prototype.uploadDenseMatrixToTexture=function(e,t,r,a){this.throwIfDisposed(),oq(this.gl,e,t,r,a,this.textureConfig)},n.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),aq(this.gl,e,t,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),rq(this.gl,e,t,this.textureConfig)},n.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(Ex(this.gl,this.framebuffer),this.outputTexture=null),Oe(this.gl,function(){return t.gl.deleteTexture(e)})},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,r){var a=this;return this.downloadMatrixDriver(e,function(){return lq(a.gl,t,r,a.textureConfig)})},n.prototype.downloadPackedMatrixFromBuffer=function(e,t,r,a,i,o){return fq(this.gl,e,t,r,a,i,o,this.textureConfig)},n.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return cq(this.gl,e,t)},n.prototype.createBufferFromTexture=function(e,t,r){this.bindTextureToFrameBuffer(e);var a=uq(this.gl,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),a},n.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},n.prototype.createFence=function(e){var t=this,r,a;if(k.env().getBool("WEBGL_FENCE_API_ENABLED")){var i=e,o=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),a=function(){var s=i.clientWaitSync(o,0,0);return s===i.ALREADY_SIGNALED||s===i.CONDITION_SATISFIED},r=o}else k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(r=this.beginQuery(),this.endQuery(),a=function(){return t.isQueryAvailable(r,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):a=function(){return!0};return{query:r,isFencePassed:a}},n.prototype.downloadMatrixFromPackedTexture=function(e,t,r){var a=this;return this.downloadMatrixDriver(e,function(){return hq(a.gl,t,r)})},n.prototype.createProgram=function(e){var t=this;this.throwIfDisposed();var r=this.gl;this.vertexShader==null&&(this.vertexShader=Z$(r));var a=E$(r);Oe(r,function(){return r.attachShader(a,t.vertexShader)}),Oe(r,function(){return r.attachShader(a,e)}),I$(r,a);var i;return i=Object.assign(a,{vao:this.createVertexArray()}),this.bindVertexArray(i.vao),Oe(r,function(){return r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.indexBuffer)}),console.assert(iq(r,i,this.vertexBuffer),"gpgpu_util.bindVertexProgramAttributeStreams not fully successful."),this.debug&&tm(r,i),this.setProgram(i),i},n.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Oe(this.gl,function(){return t.gl.deleteProgram(e)}),this.deleteVertexArray(e.vao))},n.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&(this.bindVertexArray(this.program.vao),this.debug&&tm(this.gl,this.program)),Oe(this.gl,function(){return t.gl.useProgram(e)})},n.prototype.getUniformLocation=function(e,t,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?O$(this.gl,e,t):P$(this.gl,e,t)},n.prototype.getAttributeLocation=function(e,t){var r=this;return this.throwIfDisposed(),Oe(this.gl,function(){return r.gl.getAttribLocation(e,t)})},n.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},n.prototype.setInputMatrixTexture=function(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),M$(this.gl,e,t,r)},n.prototype.setOutputMatrixTexture=function(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)},n.prototype.setOutputPackedMatrixTexture=function(e,t,r){this.throwIfDisposed();var a=Te(Uc(t,r),2),i=a[0],o=a[1];this.setOutputMatrixTextureDriver(e,i,o)},n.prototype.setOutputMatrixWriteRegion=function(e,t,r,a){this.setOutputMatrixWriteRegionDriver(r,e,a,t)},n.prototype.setOutputPackedMatrixWriteRegion=function(e,t,r,a){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){this.program!=null&&tm(this.gl,this.program),ch(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;if(this.debug){var t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Oe(e,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},n.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Oe(this.gl,function(){return e.gl.finish()})},n.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=uh(this.gl,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,r),r}var a=this.getQueryTimerExtensionWebGL1(),i=a.createQueryEXT();return a.beginQueryEXT(a.TIME_ELAPSED_EXT,i),i},n.prototype.endQuery=function(){if(k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2();e.endQuery(t.TIME_ELAPSED_EXT);return}var r=this.getQueryTimerExtensionWebGL1();r.endQueryEXT(r.TIME_ELAPSED_EXT)},n.prototype.waitForQueryAndGetTime=function(e){return Wc(this,void 0,void 0,function(){var t=this;return Vc(this,function(r){switch(r.label){case 0:return[4,k.util.repeatedTry(function(){return t.disposed||t.isQueryAvailable(e,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(e,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},n.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var r=this.gl,a=r.getQueryParameter(e,r.QUERY_RESULT);return a/1e6}else{var i=this.getQueryTimerExtensionWebGL1(),a=i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT);return a/1e6}},n.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var r=this.gl,a=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{var a=this.getQueryTimerExtensionWebGL1(),i=a.getQueryObjectEXT(e,a.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),i&&!this.disjoint}},n.prototype.pollFence=function(e){var t=this;return new Promise(function(r){t.addItemToPoll(function(){return e.isFencePassed()},function(){return r()})})},n.prototype.pollItems=function(){for(var e=XLe(this.itemsToPoll.map(function(a){return a.isDoneFn})),t=0;t<=e;++t){var r=this.itemsToPoll[t].resolveFn;r()}this.itemsToPoll=this.itemsToPoll.slice(e+1)},n.prototype.addItemToPoll=function(e,t){var r=this;if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),!(this.itemsToPoll.length>1)){var a=void 0;"setTimeoutCustom"in k.env().platform&&(a=k.env().platform.setTimeoutCustom.bind(k.env().platform)),k.util.repeatedTry(function(){return r.pollItems(),r.itemsToPoll.length===0},function(){return 0},null,a)}},n.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),nm(this.gl,e,this.framebuffer),this.debug&&ch(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(nm(this.gl,this.outputTexture,this.framebuffer),this.debug&&ch(this.gl)):Ex(this.gl,this.framebuffer)},n.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var r=t();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(e,t,r){this.throwIfDisposed();var a=this.gl;nm(a,e,this.framebuffer),this.debug&&ch(a),this.outputTexture=e,Oe(a,function(){return a.viewport(0,0,t,r)}),Oe(a,function(){return a.scissor(0,0,t,r)})},n.prototype.setOutputMatrixWriteRegionDriver=function(e,t,r,a){var i=this;this.throwIfDisposed(),Oe(this.gl,function(){return i.gl.scissor(e,t,r,a)})},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},n}();function XLe(n){for(var e=0;e<n.length;++e){var t=n[e]();if(!t)break}return e-1}function YLe(n){for(var e=new Float32Array(n.length),t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}function ja(n){return function(e,t,r,a,i){var o=k.backend_util.assertAndGetBroadcastShape(e,t),s=o.length,u=k.util.computeStrides(o),c=k.util.sizeFromShape(o),l=k.util.getTypedArrayFromDType(i,c),f=e.length,h=t.length,d=k.util.computeStrides(e),p=k.util.computeStrides(t),v=k.backend_util.getBroadcastDims(e,o),m=k.backend_util.getBroadcastDims(t,o);if(v.length+m.length===0)for(var g=0;g<l.length;++g)l[g]=n(r[g%r.length],a[g%a.length]);else for(var y=function(b){var w=k.util.indexToLoc(b,s,u),x=w.slice(-f);v.forEach(function(C){return x[C]=0});var N=k.util.locToIndex(x,f,d),T=w.slice(-h);m.forEach(function(C){return T[C]=0});var E=k.util.locToIndex(T,h,p);l[b]=n(r[N],a[E])},g=0;g<l.length;++g)y(g);return[l,o]}}function ZLe(n,e,t,r){if(r==="int32"){var a=Int32Array.from(n);return[e,"int32",a]}if(r==="bool"){var i=k.util.toTypedArray([0],t),o=Te(ja(function(c,l){return c!==l?1:0})(e,[],n,i,"bool"),2),s=o[0],u=o[1];return[u,"bool",s]}throw new Error("Error in Cast: failed to cast ".concat(t," to ").concat(r))}var JLe=ja(function(n,e){return n+e});function QLe(n,e,t,r,a){for(var i=k.util.sizeFromShape(r),o=k.util.makeZerosTypedArray(a,t),s=0;s<n.length;s++){var u=n[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(i>0?o[u]+=e[s]:o[u]+=1)}return o}function eze(n,e,t,r){r===void 0&&(r=!1);for(var a=n.shape[0],i=n.shape[1],o=k.buffer([a,t],e.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=n.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=t||(r?o.set(1,s,c):e.size>0?o.set(o.get(s,c)+e.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o}function ts(n){return function(e,t,r){for(var a=k.util.getTypedArrayFromDType(t,e.length),i=0;i<e.length;++i)a[i]=n(e[i],r);return a}}var tze=ts(function(n){return Math.ceil(n)});function nze(n,e,t,r){var a=k.util.getArrayFromDType(t,k.util.sizeFromShape(e));if(r&&t!=="string"){var i=0;n.forEach(function(s){var u=k.util.sizeFromShape(s.shape);a.set(s.vals,i),i+=u})}else{var o=0;n.forEach(function(s){for(var u=t==="string"?k.backend_util.fromUint8ToStringArray(s.vals):s.vals,c=0,l=0;l<s.shape[0];++l)for(var f=l*e[1]+o,h=0;h<s.shape[1];++h)a[f+h]=u[c++];o+=s.shape[1]})}return a}var rze=ja(function(n,e){return n===e?1:0});var aze=ts(function(n){return Math.exp(n)});var ize=ts(function(n){return Math.expm1(n)});var oze=ts(function(n){return Math.floor(n)});function sze(n,e,t,r,a,i,o,s,u){for(var c=k.buffer([r,i],t),l=0;l<r;l++){for(var f=[],h=0,d=0;d<a;d++){var p=n[l*a+d];h+=p*o[d],f.push(p)}if(h<0||h>=u/i)throw new Error("Invalid indices: ".concat(f," does not index into ").concat(s));for(var v=0;v<i;v++)c.values[l*i+v]=e.get.apply(e,dn([],Te(e.indexToLoc(h*i+v)),!1))}return c}function uze(n,e,t){for(var r=k.buffer(t,n.dtype),a=0;a<r.size;++a){var i=r.indexToLoc(a),o=i.slice(),s=o[0],u=o[2],c=e.locToIndex([s,u]);o[2]=e.values[c];var l=n.locToIndex(o);0<=l&&l<n.values.length&&(r.values[a]=n.values[l])}return r}var cze=ja(function(n,e){return n>e?1:0});var lze=ja(function(n,e){return n>=e?1:0});var fze=ja(function(n,e){return n<e?1:0});var hze=ja(function(n,e){return n<=e?1:0});function dze(n,e,t){var r=(e-n)/(t-1),a=k.util.makeZerosTypedArray(t,"float32");a[0]=n;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return a}var pze=ts(function(n){return Math.log(n)});function vze(n,e,t,r){for(var a=k.util.getTypedArrayFromDType(r,k.util.sizeFromShape(t)),i=0;i<a.length;++i){for(var o=i*e,s=n[o],u=0;u<e;++u){var c=n[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a}var mze=ja(function(n,e){return Math.max(n,e)});var gze=ja(function(n,e){return Math.min(n,e)});var dq=ja(function(n,e){return n*e});function yze(n,e,t){var r=k.util.createScalarValue(-1,t);return dq([],e,r,n,t)}var bze=ja(function(n,e){return n!==e?1:0});function wze(n,e,t,r,a){for(var i=e.length,o=k.util.sizeFromShape(e),s=k.util.computeStrides(e),u=k.util.computeStrides(a),c=k.util.getTypedArrayFromDType(t,k.util.sizeFromShape(a)),l=0;l<o;++l){for(var f=k.util.indexToLoc(l,i,s),h=new Array(f.length),d=0;d<h.length;d++)h[d]=f[r[d]];var p=k.util.locToIndex(h,i,u);c[p]=n[l]}return c}function xze(n,e,t,r){for(var a=Te(k.backend_util.computeOutAndReduceShapes(n,r),2),i=a[0],o=a[1],s=k.upcastType(e,"int32"),u=k.util.makeZerosTypedArray(k.util.sizeFromShape(i),s),c=k.util.sizeFromShape(o),l=0;l<u.length;++l){for(var f=l*c,h=1,d=0;d<c;++d)h*=t[f+d];u[l]=h}return{outVals:u,outShape:i,outDtype:s}}function kze(n,e,t){n.forEach(function(r,a){if(r<0||r>=t){var i=k.util.indexToLoc(a,e.length,k.util.computeStrides(e)).join(",");throw new Error("indices[".concat(i,"] = ").concat(r," is not in [0, ").concat(t,")"))}})}function Sze(n,e){for(var t=0;t<n.length;++t){var r=n[t],a=t===n.length-1?e:n[t+1].length;if(r.length===0)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<r.length;++i)if(r[i-1]>r[i])throw new Error("Ragged splits must be sorted in ascending order")}}function Nze(n,e,t,r){var a=[],i=0,o=e.length-1+t.length,s=new Array(o).fill(null).map(function(){return[0]});Sze(t,r);for(var u=1,c=0;c<e.length-1;++c){u*=e[c];for(var l=e[c+1],f=1;f<u+1;++f)s[c].push(f*l)}for(var f=0;f<n.length;++f){for(var h=n[f],d=n[f]+1,c=0;c<t.length;++c){var p=t[c],v=c+e.length-1;if(v>=0)for(var m=s[v],g=m[m.length-1]-p[h],y=h;y<d;++y)s[v].push(p[y+1]+g);h=p[h],d=p[d]}d!==h&&(a.push([h,d]),i+=d-h)}return{outSplits:s,valueSlices:a,numValues:i}}function Tze(n){for(var e=[],t=function(a){var i=n[a].length,o=k.util.getArrayFromDType("int32",i);e.push(o),n[a].forEach(function(s,u){return o[u]=s})},r=0;r<n.length;++r)t(r);return e}function Kz(n,e){for(var t=n.slice(0,e);t.length<e;)t.push(1);for(var r=e;r<n.length;r++)t[e-1]*=n[r];return t}function Eze(n,e,t,r,a,i){var o,s,u=Kz(e,2)[1],c=Kz(i,2)[1],l=0;try{for(var f=ra(t),h=f.next();!h.done;h=f.next())for(var d=h.value,p=d[0];p<d[1];++p){for(var v=0;v<r;++v)a[l*c+v]=n[p*u+v];++l}}catch(m){o={error:m}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}}function Ize(n,e,t,r,a){var i=e.slice();i[0]=a;var o=k.util.getArrayFromDType(t,k.util.sizeFromShape(i)),s=n.length,u=s===0?0:s/e[0];return Eze(n,e,r,u,o,i),[o,i]}function Cze(n,e,t,r,a,i,o,s){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");var u=e[0][0]-1;if(kze(i,o,u),r.length===0)throw new Error("params.rank must be nonzero");var c=r[0],l=Nze(i,o,n,c),f=l.outSplits,h=l.valueSlices,d=l.numValues,p=Tze(f),v=Ize(t,r,a,h,d);return[p,v[0],v[1]]}var jz=2147483647;function Aze(n,e,t,r,a,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");var s=e.length===0,u=a.length===0,c=o.length===0,l=[];s||l.push(e[0]),u||l.push(a[0]),c||l.push(o[0]);for(var f=1;f<l.length;++f)if(l[f]!==l[f-1])throw new Error("starts, limits, and deltas must have the same shape");var h=l.length===0?1:l[0],d=k.util.getArrayFromDType("int32",h+1);d[0]=0;for(var p=0;p<h;++p){var v=s?n[0]:n[p],m=u?r[0]:r[p],g=c?i[0]:i[p];if(g===0)throw new Error("Requires delta != 0");var y=void 0;if(g>0&&m<v||g<0&&m>v)y=0;else if(y=Math.ceil(Math.abs((m-v)/g)),y>jz)throw new Error("Requires ((limit - start) / delta) <= ".concat(jz));d[p+1]=d[p]+y}for(var b=d[h],w=k.util.getArrayFromDType(t,b),x=0,p=0;p<h;++p)for(var N=d[p+1]-d[p],T=s?n[0]:n[p],g=c?i[0]:i[p],f=0;f<N;++f)w[x++]=T,T+=g;return[d,w]}var Ka=k.backend_util.RowPartitionType,Dze=function(){function n(e,t,r,a,i,o,s,u,c,l){this.shape=e,this.shapeShape=t,this.values=r,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=k.backend_util.getRowPartitionTypesHelper(l),this.raggedRank=k.backend_util.getRaggedRank(this.rowPartitionTypes)}return n.prototype.getRowPartitionTypeByDimension=function(e){return this.rowPartitionTypes[0]===Ka.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]},n.prototype.getRowPartitionTensor=function(e){return this.rowPartitionTypes[0]===Ka.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]},n.prototype.getMaxWidth=function(e){var t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Ka.VALUE_ROWIDS:return n.getMaxWidthValueRowID(t);case Ka.ROW_SPLITS:return n.getMaxWidthRowSplit(t);default:throw new Error("Cannot handle partition type ".concat(Ka[this.getRowPartitionTypeByDimension(e-1)]))}},n.getMaxWidthRowSplit=function(e){var t=e.length;if(t===0||t===1)return 0;for(var r=0,a=0;a<t-1;++a){var i=e[a+1]-e[a];i>r&&(r=i)}return r},n.getMaxWidthValueRowID=function(e){var t=e.length;if(t===0)return 0;for(var r=0,a=e[0],i=0,o=1;o<t;++o){var s=e[o];s!==a&&(a=s,i=Math.max(o-r,i),r=o)}return Math.max(t-r,i)},n.prototype.tensorShapeFromTensor=function(e,t,r){if(r===void 0&&(r=!0),t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return Yz(e,r)},n.prototype.calculateOutputSize=function(e){var t=this.valuesShape,r=this.defaultValueShape;k.backend_util.validateDefaultValueShape(r,t);var a=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=k.backend_util.combineRaggedTensorToTensorShapes(this.raggedRank,a,t),o=i;o[0]<0&&(o[0]=e);for(var s=1;s<=this.raggedRank;++s)o[s]<0&&(o[s]=this.getMaxWidth(s));return o},n.prototype.calculateFirstParentOutputIndex=function(e,t,r){for(var a=Math.min(e,r),i=[],o=0,s=0;s<a;++s,o+=t)i.push(o);for(var s=a;s<e;++s)i.push(-1);return k.util.assert(i.length===e,function(){return"Final length of result must be equal to firstDimension."}),i},n.prototype.calculateOutputIndexRowSplit=function(e,t,r,a){for(var i=e.length,o=[],s=0;s<i-1;++s){var u=e[s+1]-e[s],c=Math.min(a,u),l=t[s];l===-1&&(c=0);for(var f=0;f<c;++f)o.push(l),l+=r;for(var f=0;f<u-c;++f)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o},n.prototype.calculateOutputIndexValueRowID=function(e,t,r,a){var i=e.length,o=[];if(i===0)return[];var s=0,u=e[0];if(u>=t.length)throw new Error("Got currentValueRowId=".concat(u,", which is not less than ").concat(t.length));var c=t[u];o.push(c);for(var l=1;l<i;++l){var f=e[l];if(f===u)c>=0&&(++s,s<a?c+=r:c=-1);else{if(s=0,u=f,f>=t.length)throw new Error("Got nextValueRowId=".concat(f," which is not less than ").concat(t.length));c=t[f]}o.push(c)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o},n.prototype.calculateOutputIndex=function(e,t,r,a){var i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case Ka.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,r,a);case Ka.ROW_SPLITS:if(i.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(i.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(i,t,r,a);default:throw new Error("Unsupported partition type: ".concat(Ka[o]))}},n.prototype.getFirstDimensionSize=function(){var e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case Ka.FIRST_DIM_SIZE:return e[0];case Ka.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Ka.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(Ka[t]))}},n.prototype.compute=function(){var e=this.rowPartitionValues[0];if(e.length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var t=this.getFirstDimensionSize(),r=this.calculateOutputSize(t),a=new Array(this.raggedRank+1);a[a.length-1]=1;for(var i=a.length-2;i>=0;--i)a[i]=a[i+1]*r[i+1];var o=Yz(r,!1),s=k.util.getArrayFromDType(this.valuesDType,k.util.sizeFromShape(o)),u=a[0]*r[0];if(u>0){for(var c=this.calculateFirstParentOutputIndex(t,a[0],r[0]),i=1;i<=this.raggedRank;++i){var l=this.calculateOutputIndex(i-1,c,a[i],r[i]);c=l}this.setOutput(this.raggedRank,c,s,o)}return[o,s]},n.prototype.setOutput=function(e,t,r,a){if(r.length!==0){var i=this.values,o=r,s=a.slice();s=s.slice(e+1);var u=k.util.sizeFromShape(s),c=t.length,l=this.defaultValue;if(l.length!==u&&l.length!==1){var f=this.defaultValueShape;k.tidy(function(){var x=k.reshape(l,f),N=k.broadcastTo(x,s);l=N.dataSync()})}for(var h=0,d=0,p=0,v=0;v<=c;++v){var m=v<c?t[v]:-1;if(m===p){++p;continue}if(d<p){var g=i.subarray(h*u),y=o.subarray(d*u),b=(p-d)*u;Xz(y,g,b)}if(v>=c){var w=r.length;m=Math.floor(w/u)}if(m>p)if(this.defaultValue.length===1)o.subarray(p*u,m*u).fill(this.defaultValue[0]),p=m;else for(;m>p;){var y=o.slice(p*u);Xz(y,l,u),++p}m<0?(h=v+1,d=p):(h=v,d=p,p=d+1)}}},n}();function Xz(n,e,t){for(var r=0;r<t;r++)n[r]=e[r]}function Yz(n,e){var t,r,a=[];try{for(var i=ra(n),o=i.next();!o.done;o=i.next()){var s=o.value;if(s<0){if(!e)throw new Error("Dimension ".concat(s," must be >= 0"));if(s<-1)throw new Error("Dimension ".concat(s," must be >= -1"));s=-1}a.push(s)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return a}function _ze(n,e,t,r,a,i,o,s,u,c){return new Dze(n,e,t,r,a,i,o,s,u,c).compute()}function Fze(n,e,t,r){var a=n===e,i=n<e&&t<0,o=e<n&&t>1;if(a||i||o)return k.util.makeZerosTypedArray(0,r);var s=Math.abs(Math.ceil((e-n)/t)),u=k.util.makeZerosTypedArray(s,r);e<n&&t===1&&(t=-1),u[0]=n;for(var c=1;c<u.length;c++)u[c]=u[c-1]+t;return u}var Rze=ts(function(n){return 1/Math.sqrt(n)});function Oze(n,e,t,r,a,i,o,s,u,c){var l=[r/a,a],f=n.values,h=e.values;if(r===0)return k.buffer(t,e.dtype);var d=k.buffer(l,e.dtype);typeof u=="string"||typeof u=="number"?d.values.fill(u):typeof u=="boolean"&&d.values.fill(+u);for(var p=0;p<i;p++){for(var v=[],m=0,g=0;g<o;g++){var y=f[p*o+g];v.push(y),m+=y*s[g]}if(m<0||m>=r/a)throw new Error("Invalid indices: ".concat(v," does not index into ").concat(t));for(var b=0;b<a;b++)c?d.values[m*a+b]+=h[p*a+b]:d.values[m*a+b]=e.rank===0?h[0]:h[p*a+b]}return d}var Pze=ts(function(n){return 1/(1+Math.exp(-n))});function Mze(n,e,t,r,a){var i=k.slice_util.isSliceContinous(r,e,t),o=k.util.sizeFromShape(t),s=k.util.computeStrides(r);if(i){var u=k.slice_util.computeFlatOffset(e,s);return a==="string"?n.slice(u,u+o):n.subarray(u,u+o)}for(var c=a==="string"?k.backend_util.fromUint8ToStringArray(n):n,l=k.buffer(r,a,c),f=k.buffer(t,a),h=0;h<f.size;++h){var d=f.indexToLoc(h),p=d.map(function(v,m){return v+e[m]});f.set.apply(f,dn([l.get.apply(l,dn([],Te(p),!1))],Te(d),!1))}return a==="string"?k.backend_util.fromStringArrayToUint8(f.values):f.values}function Bze(n,e,t,r,a,i,o){var s=e[0],u=i[0],c=new Array(u),l=new Array(s),f=e[1];if(u===0){if(s!==0)throw new Error(k.backend_util.getSparseFillEmptyRowsIndicesDenseShapeMismatch(s));var h=k.util.getArrayFromDType(t,0),d=k.util.getArrayFromDType(a,0);return[h,[0,f],d,c,l]}for(var p=!0,v=0,m=new Array(u).fill(0),g=0;g<s;++g){var y=n[g*f];if(y<0)throw new Error(k.backend_util.getSparseFillEmptyRowsNegativeIndexErrorMessage(g,y));if(y>=u)throw new Error(k.backend_util.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(g,y,u));++m[y],p=p&&y>=v,v=y}for(var b=!0,y=0;y<u;++y){var w=m[y]===0;c[y]=w,b=b&&!w,m[y]=Math.max(m[y],1),y>0&&(m[y]+=m[y-1])}if(b&&p){for(var h=n,d=r,g=0;g<s;++g)l[g]=g;return[h,[s,f],d,c,l]}else{for(var x=m[u-1],h=k.util.getArrayFromDType(t,x*f),d=k.util.getArrayFromDType(a,x),N=new Array(u).fill(0),g=0;g<s;++g){var y=n[g*f],T=N[y],E=(y===0?0:m[y-1])+T;N[y]++;for(var C=0;C<f;++C)h[E*f+C]=n[g*f+C];d[E]=r[g],l[g]=E}for(var y=0;y<u;++y){var F=N[y];if(F===0){var _=y===0?0:m[y-1];h[_*f+0]=y;for(var O=1;O<f;++O)h[_*f+O]=0;d[_]=o}}return[h,[x,f],d,c,l]}}function Lze(n,e,t,r,a){for(var i=k.util.sizeFromShape(r),o=e[0],s=a.length,u=[],c=1,l=-1,f=0;f<s;++f){var h=a[f];if(h===-1){if(l!==-1)throw new Error(k.backend_util.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(l,f));l=f,u.push(1)}else{if(h<0)throw new Error(k.backend_util.getSparseReshapeNegativeOutputDimErrorMessage(f,h));c*=h,u.push(h)}}if(l!==-1){if(c<=0)throw new Error(k.backend_util.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());var d=Math.trunc(i/c);if(c*d!==i)throw new Error(k.backend_util.getSparseReshapeInputOutputMultipleErrorMessage(r,u));u[l]=d}var p=k.util.sizeFromShape(u);if(p!==i)throw new Error(k.backend_util.getSparseReshapeInputOutputMismatchErrorMessage(r,u));var v=r.length,m=[];if(v>0){m[v-1]=1;for(var f=v-2;f>=0;--f)m[f]=m[f+1]*r[f+1]}var g=[];if(s>0){g[s-1]=1;for(var f=s-2;f>=0;--f)g[f]=g[f+1]*u[f+1]}for(var y=k.util.getArrayFromDType(t,o*s),b=0;b<o;++b){for(var w=0,x=0;x<v;++x)w+=n[b*v+x]*m[x];for(var x=0;x<s;++x)y[b*s+x]=Math.trunc(w/g[x]),w%=g[x]}return[y,[o,s],u]}function zze(n,e,t,r,a,i,o){i===void 0&&(i=!1),o===void 0&&(o=0);var s=r.length,u=[e[0],n.length/e[0]],c=u[1],l=s>0?a[s-1]+1:0,f=l;if(f<0)throw new Error(k.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var h=e.slice();h[0]=f;var d=h.reduce(function(T,E){return T*E},1),p=k.util.getArrayFromDType(t,d);if(s===0)return f>0&&p.fill(o),[p,h];if(f<=0)throw new Error(k.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());for(var v=0,m=1,g=0,y=a[v];;){var b=0;if(m<s){if(b=a[m],y===b){++m;continue}if(y>=b)throw new Error(k.backend_util.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=f)throw new Error(k.backend_util.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,f));y>g&&p.fill(o,g*c,y*c);for(var w=v;w<m;++w){var x=r[w];if(x<0||x>=u[0])throw new Error(k.backend_util.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(w,r[w],u[0]));for(var N=0;N<c;N++)p[y*c+N]+=n[x*c+N]}if(i)for(var N=0;N<c;N++)p[y*c+N]/=m-v;if(v=m,++m,g=y+1,y=b,m>s)break}return g<f&&p.fill(o,g*c,f*c),[p,h]}var $ze=ts(function(n){return Math.sqrt(n)});function qze(n,e,t,r){for(var a=k.buffer(n,e.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*t[u]+r[u];a.set.apply(a,dn([e.get.apply(e,dn([],Te(s),!1))],Te(o),!1))}return a}var Wze=function(){function n(e,t,r,a,i,o){this.separator=k.util.encodeString(e),this.nGramWidths=t,this.leftPad=k.util.encodeString(r),this.rightPad=k.util.encodeString(a),this.padWidth=i,this.preserveShort=o}return n.prototype.getPadWidth=function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)},n.prototype.getNumNGrams=function(e,t){var r=this.getPadWidth(t);return Math.max(0,e+2*r-t+1)},n.prototype.createNGrams=function(e,t,r,a,i,o){for(var s=function(l){var f=u.getPadWidth(o),h=Math.max(0,f-l),d=Math.max(0,f-(i-(l+1))),p=o-(h+d),v=t+(h>0?0:l-f),m=0;m+=h*u.leftPad.length;for(var g=0;g<p;++g)m+=e[v+g].length;m+=d*u.rightPad.length;var y=h+d+p-1;m+=y*u.separator.length,r[a+l]=new Uint8Array(m);for(var b=r[a+l],w=0,x=function(N){return N.forEach(function(T){return b[w++]=T})},g=0;g<h;++g)x(u.leftPad),x(u.separator);for(var g=0;g<p-1;++g)x(e[v+g]),x(u.separator);if(p>0){x(e[v+p-1]);for(var g=0;g<d;++g)x(u.separator),x(u.rightPad)}else{for(var g=0;g<d-1;++g)x(u.rightPad),x(u.separator);x(u.rightPad)}},u=this,c=0;c<i;++c)s(c)},n.prototype.compute=function(e,t){var r=this,a=e.length,i=t.length;if(i>0){var o=t[0];if(o!==0)throw new Error("First split value must be 0, got ".concat(o));for(var s=1;s<i;++s){var u=t[s]>=o;if(u=u&&t[s]<=a,!u)throw new Error("Invalid split value ".concat(t[s],", must be in [").concat(o,", ").concat(a,"]"));o=t[s]}if(o!==a)throw new Error("Last split value must be data size. Expected ".concat(a,", got ").concat(o))}var c=i-1,l=k.util.getArrayFromDType("int32",i);if(a===0||i===0){for(var f=new Array(a),s=0;s<=c;++s)l[s]=0;return[f,l]}l[0]=0;for(var h=function(g){var y=t[g]-t[g-1],b=0;d.nGramWidths.forEach(function(w){b+=r.getNumNGrams(y,w)}),d.preserveShort&&y>0&&b===0&&(b=1),l[g]=l[g-1]+b},d=this,s=1;s<=c;++s)h(s);for(var p=new Array(l[c]),v=function(g){var y=t[g],b=l[g];if(m.nGramWidths.forEach(function(T){var E=t[g+1]-t[g],C=r.getNumNGrams(E,T);r.createNGrams(e,y,p,b,C,T),b+=C}),m.preserveShort&&b===l[g]){var w=t[g+1]-t[g];if(w===0)return"continue";var x=w+2*m.padWidth,N=1;m.createNGrams(e,y,p,b,N,x)}},m=this,s=0;s<c;++s)v(s);return[p,l]},n}();function Vze(n,e,t,r,a,i,o,s){return new Wze(t,r,a,i,o,s).compute(n,e)}function Gze(n,e,t,r){if(!!n.length){if(e.length===0){for(var a=0;a<n.length;++a)r.push(n.subarray(a,a+1));return}if(e.length===1){for(var i=e[0],o=n.indexOf(i);o!==-1;){var s=n.subarray(0,o);(!t||s.length!==0)&&r.push(s),n=n.subarray(o+1),o=n.indexOf(i)}(!t||n.length!==0)&&r.push(n);return}for(var u=0,a=0;a<n.length+1;a++)if(a===n.length||e.indexOf(n[a])!==-1){var s=n.subarray(u,a);(!t||s.length!==0)&&r.push(s),u=a+1}}}function Uze(n,e,t){for(var r=n.length,a=[],i=0,o=0,s=new Array(r),u=0;u<r;++u){var c=a.length;Gze(n[u],e,t,a);var l=a.length-c;s[u]=l,i+=l,o=Math.max(o,l)}for(var f=k.util.getArrayFromDType("int32",i*2),h=new Array(i),d=[r,o],p=0,u=0;u<r;++u)for(var v=0;v<s[u];++v)f[p*2]=u,f[p*2+1]=v,h[p]=a[p],++p;return[f,h,d]}function Hze(n,e){for(var t=k.util.getArrayFromDType("int32",n.length),r=0;r<n.length;++r)t[r]=k.util.fingerPrint64(n[r]).modulo(e).getLowBitsUnsigned();return t}var Kze=ja(function(n,e){return n-e});function jze(n,e){for(var t=new Array(n.rank),r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];for(var a=k.buffer(t,n.dtype),r=0;r<a.values.length;++r){for(var i=a.indexToLoc(r),o=new Array(n.rank),s=0;s<o.length;s++)o[s]=i[s]%n.shape[s];var u=n.locToIndex(o);a.values[r]=n.values[u]}return a}var fh=function(n,e){var t=e.value-n.value;return t===0?n.index-e.index:t};function pq(n,e,t,r){for(t===void 0&&(t=0),r===void 0&&(r=n.length-1);r>t;){if(r-t>600){var a=r-t+1,i=e-t+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2),c=Math.max(t,Math.floor(e-i*s/a+u)),l=Math.min(r,Math.floor(e+(a-i)*s/a+u));pq(n,e,c,l)}var f=n[e],h=t,d=r;for(k.util.swap(n,t,e),fh(n[r],f)>0&&k.util.swap(n,t,r);h<d;){for(k.util.swap(n,h,d),h++,d--;fh(n[h],f)<0;)h=h+1;for(;fh(n[d],f)>0;)d=d-1}fh(n[t],f)===0?k.util.swap(n,t,d):(d=d+1,k.util.swap(n,d,r)),d<=e&&(t=d+1),e<=d&&(r=d-1)}}function Xze(n,e,t,r,a){for(var i=e[e.length-1],o=Te([n.length/i,i],2),s=o[0],u=o[1],c=k.util.getTypedArrayFromDType(t,s*r),l=k.util.getTypedArrayFromDType("int32",s*r),f=function(p){var v=p*u,m=n.subarray(v,v+u),g=new Array(m.length);m.forEach(function(N,T){return g[T]={value:N,index:T}}),r<g.length&&(pq(g,r),g=g.slice(0,r)),a&&g.sort(fh);for(var y=p*r,b=c.subarray(y,y+r),w=l.subarray(y,y+r),x=0;x<r;x++)b[x]=g[x].value,w[x]=g[x].index},h=0;h<s;h++)f(h);var d=e.slice();return d[d.length-1]=r,[k.buffer(d,t,c),k.buffer(d,"int32",l)]}function Yze(n,e,t,r){for(var a=k.util.parseAxisParam(e,t)[0],i=[1,t[0],1],o=0;o<a;o++)i[0]*=t[o];i[1]=t[a];for(var o=a+1;o<t.length;o++)i[2]*=t[o];for(var s={},u=new Int32Array(t[a]),c=new k.TensorBuffer(i,r,n),l=[],f=i[0]===1&&i[2]===1,o=0;o<t[a];o++){var h=void 0;if(f)h=n[o].toString();else{for(var d=[],p=0;p<i[0];p++)for(var v=0;v<i[2];v++)d.push(c.get(p,o,v));h=d.join(",")}if(s[h]!==void 0)u[o]=s[h];else{var m=Object.keys(s).length;s[h]=m,u[o]=m,l.push(o)}}var g=i.slice();g[1]=Object.keys(s).length;var y=new k.TensorBuffer(g,r);l.forEach(function(w,x){for(var N=0;N<i[0];N++)for(var T=0;T<i[2];T++)y.set(c.get(N,w,T),N,x,T)});var b=t.slice();return b[a]=g[1],{outputValues:y.values,outputShape:b,indices:u}}var Zze=JLe,vq=QLe,Jze=eze,Qze=ZLe,e$e=tze,t$e=nze,n$e=rze,r$e=aze,a$e=ize,i$e=oze,o$e=sze,s$e=uze,u$e=cze,c$e=lze,l$e=fze,f$e=hze,h$e=dze,d$e=pze,p$e=vze,v$e=mze,m$e=gze,g$e=dq,y$e=yze,b$e=bze,w$e=xze,x$e=Cze,k$e=Aze,S$e=_ze,N$e=Fze,T$e=Rze,E$e=Oze,I$e=Pze,mq=YLe,C$e=Mze,A$e=Bze,D$e=Lze,gq=zze,_$e=$ze,F$e=qze,R$e=Vze,O$e=Uze,P$e=Hze,M$e=Kze,B$e=jze,L$e=Xze,Wx=wze,z$e=Yze;function yq(n,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return"".concat(n,".").concat(t)})}function br(n,e){return e===1?[n]:yq(n,e)}function $$e(n,e){if(n===1)return"rc";for(var t="",r=0;r<n;r++)t+=e[r],r<n-1&&(t+=",");return t}var q$e=function(){function n(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=kr(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=br("rc",this.rank),r=Wt(this.rank),a=this.getOutOfBoundsCondition(t),i=this.getSetup(t),o=this.getOutput(t);this.userCode=`
        void main() {
          `.concat(r,` rc = getOutputCoords();

          if(`).concat(a,`) {
            setOutput(vec4(0));
          } else {
            `).concat(i,`

            setOutput(vec4(`).concat(o,`));
          }
        }
      `)}}return n.prototype.getSourceCoordsArr=function(e){for(var t=[],r=0;r<=1;r++)for(var a=0;a<=1;a++){for(var i="".concat(r===0?"r":"rp1",", ").concat(a===0?"c":"cp1"),o=2;o<this.rank;o++)i="".concat(e[e.length-1-o],",")+i;t.push(i)}return t},n.prototype.getOutOfBoundsCondition=function(e){if(this.rank===1)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);for(var t="",r=this.rank-2;r<this.rank;r++)t+="".concat(e[r]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(r,"]"):this.outputShape[r]),r<this.rank-1&&(t+="||");return t},n.prototype.getSetup=function(e){if(this.rank===1)return"";var t=e.slice(-2),r=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],a=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return`
      int r = `.concat(t[0],`;
      int c = `).concat(t[1],`;
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= `).concat(r,`;
      bool rEdge = rp1 >= `).concat(a,`;
    `)},n.prototype.getOutput=function(e){var t=this.getSourceCoordsArr(e);if(this.rank===1){var r=this.enableShapeUniforms?"outShape":this.outputShape[0];return"getA(rc), (rc + 1 >= ".concat(r," ? 0. : getA(rc + 1)), 0, 0")}return"getA(".concat(t[0],`),
            cEdge ? 0. : getA(`).concat(t[1],`),
            rEdge ? 0. : getA(`).concat(t[2],`),
            rEdge || cEdge ? 0. : getA(`).concat(t[3],")")},n}();var bq=function(){function n(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length);for(var r="",a=0;a<4;a++){var i="thisRC = rc;";a%2===1&&(i+="thisRC.z += 1;"),a>1&&(i+="thisRC.y += 1;"),r+=`
        `.concat(i,`
        `).concat(a>0?"if(thisRC.y < rows && thisRC.z < cols){":"",`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`).concat(a,`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `).concat(a>0?"}":"",`
      `)}this.userCode=`
      `.concat(W$e(t,this.enableShapeUniforms),`
      `).concat(this.enableShapeUniforms?Px():Ox(e),`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `).concat(this.enableShapeUniforms?"outShape[1]":e[1],`;
        int cols = `).concat(this.enableShapeUniforms?"outShape[2]":e[2],`;

        `).concat(r,`

        setOutput(result);
      }
    `)}return n}();function W$e(n,e){var t=e?nLe(["r","c","d"],"inputShape"):pu(["r","c","d"],n);return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `.concat(t,`
      return ivec3(r, c, d);
    }
  `)}var V$e=function(){function n(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(e,t,r){var a=Jz(t,r),i=Qz(e,a,r);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);var o=Zz(e,a,this.gpgpu.gl,this.gpgpu.textureConfig,r);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[i].shift();return this.usedTextures[i].push(s),s}var u;return a===ir.PACKED_2X2_FLOAT32?u=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):a===ir.PACKED_2X2_FLOAT16?u=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):a===ir.UNPACKED_FLOAT32?u=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):a===ir.UNPACKED_FLOAT16?u=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):a===ir.PACKED_4X1_UNSIGNED_BYTE&&(u=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(u),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),u},n.prototype.releaseTexture=function(e,t,r,a){if(this.freeTextures!=null){var i=Jz(r,a),o=Qz(t,i,a);o in this.freeTextures||(this.freeTextures[o]=[]);var s=Zz(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,a),u=k.env().get("WEBGL_DELETE_TEXTURE_THRESHOLD");u!==-1&&this._numBytesAllocated>u?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=s):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=s),this.numUsedTextures--;var c=this.usedTextures[o],l=c.indexOf(e);if(l<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c.splice(l,1),this.log()}},n.prototype.log=function(){if(!!this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}},Object.defineProperty(n.prototype,"numBytesAllocated",{get:function(){return this._numBytesAllocated},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"numBytesFree",{get:function(){return this._numBytesFree},enumerable:!1,configurable:!0}),n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(r){e.gpgpu.deleteMatrixTexture(r.texture)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(a){e.gpgpu.deleteMatrixTexture(a.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}},n}();function G$e(n,e){var t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error("Unknown internal format ".concat(e))}function Zz(n,e,t,r,a){var i=U$e(e,r),o;if(a){var s=Te(Uc(n[0],n[1]),2),u=s[0],c=s[1];o=u*c}else{var l=Te(yh(n[0],n[1]),2),f=l[0],h=l[1];o=f*h}var d=G$e(t,i);return o*d}function U$e(n,e){switch(n){case ir.PACKED_2X2_FLOAT32:return $x(e);case ir.PACKED_2X2_FLOAT16:return qx(e);case ir.UNPACKED_FLOAT32:return Bx(e);case ir.UNPACKED_FLOAT16:return Lx(e);case ir.PACKED_4X1_UNSIGNED_BYTE:return zx(e);default:throw new Error("Unknown physical texture type ".concat(n))}}function H$e(n){return k.env().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?ir.PACKED_2X2_FLOAT32:ir.UNPACKED_FLOAT32:n?ir.PACKED_2X2_FLOAT16:ir.UNPACKED_FLOAT16}function Jz(n,e){if(n===ba.UPLOAD)return ir.PACKED_2X2_FLOAT32;if(n===ba.RENDER||n==null)return H$e(e);if(n===ba.DOWNLOAD||n===ba.PIXELS)return ir.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(n))}function Qz(n,e,t){return"".concat(n[0],"_").concat(n[1],"_").concat(e,"_").concat(t)}var Mi=function(){function n(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        `.concat(t,`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `)}return n}(),Xa="if (isnan(x)) return x;",K$e="return x;",e$="return abs(x);",j$e="return (x >= 0.0) ? x : (exp(x) - 1.0);",X$e=Xa+`
  return (x < 0.0) ? 0.0 : x;
`,Y$e=Xa+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Qo="return x;",Z$e="return 1.0 / (1.0 + exp(-1.0 * x));";var J$e="return x;",Q$e=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,eqe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,tqe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,nqe="return 1.0 / (1.0 + exp(-1.0 * x));",es=function(){function n(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `.concat(t,`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `)}return n}();var rqe=function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length);var t=e.length,r=br("rc",t),a=Wt(t),i=$$e(t,r),o=r.slice(-2),s=t<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode=`
      void main() {
        `.concat(a,` rc = getOutputCoords();
        vec4 packedInput = getA(`).concat(i,`);

        setOutput(getChannel(packedInput, `).concat(s,`));
      }
    `)}return n}(),aqe=k.kernel_impls.whereImpl,iqe=1e-7,oqe=1e-4,Qv={};function sqe(n){return n in Qv||(Qv[n]={}),Qv[n]}var uqe=k.env().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),cqe=600;function lqe(){return k.env().global.screen==null?1024:k.env().global.screen.height*k.env().global.screen.width*window.devicePixelRatio*cqe/1024/1024}var Vx=function(n){zBe(e,n);function e(t){var r=n.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.lastGlFlushTime=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!k.env().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");var a;if(t!=null){if(t instanceof im)a=t;else{var i=xi(k.env().getNumber("WEBGL_VERSION"),t);a=new im(i)}r.binaryCache={},r.gpgpuCreatedLocally=!1}else{var i=xi(k.env().getNumber("WEBGL_VERSION"));a=new im(i),r.binaryCache=sqe(k.env().getNumber("WEBGL_VERSION")),r.gpgpuCreatedLocally=!0}return r.gpgpu=a,r.canvas=r.gpgpu.gl.canvas,r.textureManager=new V$e(r.gpgpu),r.numMBBeforeWarning=lqe(),r.texData=new k.DataStorage(r,k.engine()),r}return e.prototype.nextDataId=function(){return e.nextDataId++},e.prototype.numDataIds=function(){return this.texData.numDataIds()-this.pendingDeletes},e.prototype.writeTexture=function(t,r,a,i,o,s){var u=this.makeTensorInfo(r,a),c=this.texData.get(u.dataId);c.isPacked=!1,c.texture={texture:t,texShape:[i,o]},c.texShape=[i,o];var l=lh(r),f=new Hz(l,!1,s),h=this.runWebGLProgram(f,[u],a,[[i,o]]);return h.shape=r,c.texture=null,this.disposeIntermediateTensorInfo(u),h.dataId},e.prototype.write=function(t,r,a){if((k.env().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||k.env().getBool("DEBUG"))&&this.checkNumericalProblems(t),a==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var i={id:this.nextDataId()};return this.texData.set(i,{shape:r,dtype:a,values:t,usage:ba.UPLOAD,refCount:1}),i},e.prototype.refCount=function(t){if(this.texData.has(t)){var r=this.texData.get(t);return r.refCount}return 0},e.prototype.incRef=function(t){var r=this.texData.get(t);r.refCount++},e.prototype.decRef=function(t){if(this.texData.has(t)){var r=this.texData.get(t);r.refCount--}},e.prototype.move=function(t,r,a,i,o){if(k.env().getBool("DEBUG")&&this.checkNumericalProblems(r),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:a,dtype:i,values:r,usage:ba.UPLOAD,refCount:o})},e.prototype.disposeIntermediateTensorInfo=function(t){this.disposeData(t.dataId)},e.prototype.readSync=function(t){var r=this.texData.get(t),a=r.values,i=r.dtype,o=r.complexTensorInfos,s=r.slice,u=r.shape,c=r.isPacked;if(s!=null){var l=void 0;c?l=new es(u,Qo):l=new Mi(u,Qo);var f=this.runWebGLProgram(l,[{dataId:t,shape:u,dtype:i}],i),h=this.readSync(f.dataId);return this.disposeIntermediateTensorInfo(f),h}if(a!=null)return this.convertAndCacheOnCPU(t);if(i==="string")return a;var d=this.activeTimers!=null,p;d&&(p=k.util.now());var v;if(i==="complex64"){var m=this.readSync(o.real.dataId),g=this.readSync(o.imag.dataId);v=k.backend_util.mergeRealAndImagArrays(m,g)}else v=this.getValuesFromTexture(t);return d&&(this.downloadWaitMs+=k.util.now()-p),this.convertAndCacheOnCPU(t,v)},e.prototype.read=function(t){return Wc(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f,h,d,p,v,m,g,y,b,w,x,N,T,E,C;return Vc(this,function(F){switch(F.label){case 0:if(this.pendingRead.has(t))return r=this.pendingRead.get(t),[2,new Promise(function(_){return r.push(_)})];if(a=this.texData.get(t),i=a.values,o=a.shape,s=a.slice,u=a.dtype,c=a.complexTensorInfos,l=a.isPacked,s!=null)return f=void 0,l?f=new es(o,Qo):f=new Mi(o,Qo),h=this.runWebGLProgram(f,[{dataId:t,shape:o,dtype:u}],u),d=this.read(h.dataId),this.disposeIntermediateTensorInfo(h),[2,d];if(i!=null)return[2,this.convertAndCacheOnCPU(t)];if(k.env().getBool("DEBUG")&&!k.env().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&k.env().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,u!=="complex64"&&k.env().get("WEBGL_BUFFER_SUPPORTED")&&(v=this.decode(t),m=this.texData.get(v.dataId),p=(C=this.gpgpu).createBufferFromTexture.apply(C,dn([m.texture.texture],Te(Zv(o)),!1))),this.pendingRead.set(t,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:F.sent(),F.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([this.read(c.real.dataId),this.read(c.imag.dataId)])];case 3:return y=F.sent(),b=y[0],w=y[1],g=k.backend_util.mergeRealAndImagArrays(b,w),[3,5];case 4:p==null?g=this.getValuesFromTexture(t):(x=k.util.sizeFromShape(o),g=this.gpgpu.downloadFloat32MatrixFromBuffer(p,x)),F.label=5;case 5:return v!=null&&this.disposeIntermediateTensorInfo(v),p!=null&&(N=this.gpgpu.gl,Oe(N,function(){return N.deleteBuffer(p)})),T=this.convertAndCacheOnCPU(t,g),E=this.pendingRead.get(t),this.pendingRead.delete(t),E.forEach(function(_){return _(T)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&k.engine().removeDataId(t,this),this.pendingDeletes--),[2,T]}})})},e.prototype.readToGPU=function(t,r){r===void 0&&(r={});var a=this.texData.get(t),i=a.values,o=a.shape,s=a.slice,u=a.dtype,c=a.isPacked,l=a.texture;if(u==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(s!=null){var f=void 0;c?f=new es(o,Qo):f=new Mi(o,Qo);var h=this.runWebGLProgram(f,[{dataId:t,shape:o,dtype:u}],u),d=this.readToGPU(h,r);return this.disposeIntermediateTensorInfo(h),d}if(l==null)throw i!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");var p=this.decode(t,r.customTexShape),v=k.engine().makeTensorFromTensorInfo(p),m=this.texData.get(p.dataId);return Object.assign({tensorRef:v},m.texture)},e.prototype.bufferSync=function(t){var r=this.readSync(t.dataId);if(t.dtype==="string")try{var a=r.map(function(i){return k.util.decodeString(i)});return k.buffer(t.shape,t.dtype,a)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return k.buffer(t.shape,t.dtype,r)},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var r=0;r<t.length;r++){var a=t[r];if(!k$(a))throw k.env().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value ".concat(a," cannot be represented with your ")+"current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value ".concat(a," cannot be represented on this device."))}},e.prototype.getValuesFromTexture=function(t){var r,a=this.texData.get(t),i=a.shape,o=a.dtype,s=a.isPacked,u=k.util.sizeFromShape(i);if(k.env().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var c=this.decode(t),l=this.texData.get(c.dataId),f=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,dn([l.texture.texture],Te(Zv(i)),!1)).subarray(0,u);return this.disposeIntermediateTensorInfo(c),f}var h=k.env().getBool("WEBGL_PACK")&&s===!0,d=h?lh(i):i,p=h?new ULe(d):new GLe(d),v=this.runWebGLProgram(p,[{shape:d,dtype:o,dataId:t}],"float32"),m=this.texData.get(v.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture.texture,m.texShape[0],m.texShape[1]).subarray(0,u);return this.disposeIntermediateTensorInfo(v),g},e.prototype.timerAvailable=function(){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0},e.prototype.time=function(t){var r=this,a=this.activeTimers,i=[],o=!1;this.programTimersStack==null?(this.programTimersStack=i,o=!0):this.activeTimers.push(i),this.activeTimers=i,t();var s=k.util.flatten(this.activeTimers.map(function(l){return l.query})).filter(function(l){return l!=null}),u=k.util.flatten(this.activeTimers.map(function(l){return l.name})).filter(function(l){return l!=null});this.activeTimers=a,o&&(this.programTimersStack=null);var c={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return function(){return Wc(r,void 0,void 0,function(){var l;return Vc(this,function(f){switch(f.label){case 0:return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(s)]:[3,2];case 1:return l=f.sent(),c.kernelMs=k.util.sum(l),c.getExtraProfileInfo=function(){return l.map(function(h,d){return{name:u[d],ms:h}}).map(function(h){return"".concat(h.name,": ").concat(h.ms)}).join(", ")},[3,3];case 2:c.kernelMs={error:"WebGL query timers are not supported in this environment."},f.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,c]}})})}()},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}},e.prototype.startTimer=function(){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:k.util.now(),endMs:null}},e.prototype.endTimer=function(t){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=k.util.now(),t)},e.prototype.getQueryTime=function(t){return Wc(this,void 0,void 0,function(){var r;return Vc(this,function(a){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:(r=t,[2,r.endMs-r.startMs])})})},e.prototype.disposeData=function(t,r){if(r===void 0&&(r=!1),this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(r?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!r&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);var a=this.texData.get(t).complexTensorInfos;return a!=null&&(this.disposeData(a.real.dataId,r),this.disposeData(a.imag.dataId,r)),this.texData.delete(t),!0},e.prototype.releaseGPUData=function(t){var r=this.texData.get(t),a=r.texture,i=r.dtype,o=r.texShape,s=r.usage,u=r.isPacked,c=r.slice,l=c&&c.origDataId||t,f=this.dataRefCount.get(l);f>1?this.dataRefCount.set(l,f-1):(this.dataRefCount.delete(l),a!=null&&(this.numBytesInGPU-=this.computeBytes(o,i),this.textureManager.releaseTexture(a,o,s,u)));var h=this.texData.get(t);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.shouldExecuteOnCPU=function(t,r){var a=this;return r===void 0&&(r=uqe),k.env().getBool("WEBGL_CPU_FORWARD")&&t.every(function(i){return a.texData.get(i.dataId).texture==null&&k.util.sizeFromShape(i.shape)<r})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.where=function(t){k.backend_util.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=t.dataSync();return aqe(t.shape,r)},e.prototype.packedUnaryOp=function(t,r,a){var i=new es(t.shape,r),o=this.compileAndRun(i,[t],a);return k.engine().makeTensorFromTensorInfo(o)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t])&&t.dtype!=="complex64"){var r=mq(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,r)}if(k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,e$,t.dtype);var a=new Mi(t.shape,e$),i=this.compileAndRun(a,[t]);return k.engine().makeTensorFromTensorInfo(i)},e.prototype.makeTensorInfo=function(t,r,a){var i;if(r==="string"&&a!=null&&a.length>0&&k.util.isString(a[0])){var o=a.map(function(s){return k.util.encodeString(s)});i=this.write(o,t,r)}else i=this.write(a,t,r);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:r}},e.prototype.makeOutput=function(t,r,a){return k.engine().makeTensorFromTensorInfo(this.makeTensorInfo(t,r,a),this)},e.prototype.unpackTensor=function(t){var r=new rqe(t.shape);return this.runWebGLProgram(r,[t],t.dtype)},e.prototype.packTensor=function(t){var r=new q$e(t.shape),a=!0;return this.runWebGLProgram(r,[t],t.dtype,null,a)},e.prototype.packedReshape=function(t,r){var a=dn([hu(t.shape)],Te(du(t.shape)),!1),i={dtype:t.dtype,shape:a,dataId:t.dataId},o=dn([hu(r)],Te(du(r)),!1),s=new bq(o,a),u=!0,c=[a],l=this.runWebGLProgram(s,[i],t.dtype,c,u);return{dataId:l.dataId,shape:r,dtype:l.dtype}},e.prototype.decode=function(t,r){var a=this.texData.get(t),i=a.isPacked,o=a.shape,s=a.dtype;if(r!=null){var u=k.util.sizeFromShape(o),c=r[0]*r[1]*4;k.util.assert(u<=c,function(){return"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."})}var l=lh(o),f;i?f=new VLe(l):f=new WLe(l);var h=!0,d=[r??Zv(l)],p=this.runWebGLProgram(f,[{shape:l,dtype:s,dataId:t}],s,d,h,r);return{dtype:s,shape:o,dataId:p.dataId}},e.prototype.runWebGLProgram=function(t,r,a,i,o,s){var u=this;o===void 0&&(o=!1);var c=this.makeTensorInfo(t.outputShape,a),l=this.texData.get(c.dataId);if(t.packedOutput&&(l.isPacked=!0),t.outPackingScheme===dh.DENSE){var f=s??Zv(t.outputShape);l.texShape=f.map(function(N){return N*2})}if(t.outTexUsage!=null&&(l.usage=t.outTexUsage),k.util.sizeFromShape(c.shape)===0)return l.values=k.util.getTypedArrayFromDType(c.dtype,0),c;var h=[],d=r.map(function(N){if(N.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var T=u.texData.get(N.dataId);if(T.texture==null){if(!t.packedInputs&&k.util.sizeFromShape(N.shape)<=k.env().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:N.shape,texData:null,isUniform:!0,uniformValues:T.values};t.packedInputs&&(T.isPacked=!0,T.shape=N.shape)}if(u.uploadToGPU(N.dataId),!!T.isPacked!=!!t.packedInputs)N=T.isPacked?u.unpackTensor(N):u.packTensor(N),h.push(N),T=u.texData.get(N.dataId);else if(T.isPacked&&!ph(T.shape,N.shape)){var E=N,C=N.shape;N.shape=T.shape,N=u.packedReshape(N,C),h.push(N),T=u.texData.get(N.dataId),E.shape=C}return{shape:N.shape,texData:T,isUniform:!1}});this.uploadToGPU(c.dataId);var p={shape:c.shape,texData:l,isUniform:!1},v=qLe(t,d,p),m=this.getAndSaveBinary(v,function(){return zLe(u.gpgpu,t,d,p)}),g=this.activeTimers!=null,y;g&&(y=this.startTimer()),k.env().get("ENGINE_COMPILE_ONLY")||$Le(this.gpgpu,m,d,p,i),h.forEach(function(N){return u.disposeIntermediateTensorInfo(N)}),g&&(y=this.endTimer(y),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(y)}));var b=k.env().get("WEBGL_FLUSH_THRESHOLD");if(b>0){var w=k.util.now();w-this.lastGlFlushTime>b&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=w)}if(!k.env().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&o===!1){var x=this.unpackTensor(c);return this.disposeIntermediateTensorInfo(c),x}return c},e.prototype.compileAndRun=function(t,r,a,i,o){o===void 0&&(o=!1),a=a||r[0].dtype;var s=this.runWebGLProgram(t,r,a,i,o);return s},e.prototype.getAndSaveBinary=function(t,r){return t in this.binaryCache||(this.binaryCache[t]=r()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;if(!this.disposed){if(!k.env().getBool("IS_TEST")){var r=Object.keys(this.binaryCache);r.forEach(function(a){t.gpgpu.deleteProgram(t.binaryCache[a].webGLProgram),delete t.binaryCache[a]})}this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=k.tidy(function(){if(!k.env().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=k.env().getBool("DEBUG");k.env().set("DEBUG",!1);var a=t.abs(k.scalar(1e-8)).dataSync()[0];if(k.env().set("DEBUG",r),a>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?iqe:oqe},e.prototype.uploadToGPU=function(t){var r,a=this.texData.get(t),i=a.shape,o=a.dtype,s=a.values,u=a.texture,c=a.usage,l=a.isPacked;if(u==null){var f=this.activeTimers!=null,h;f&&(h=k.util.now());var d=a.texShape;if(d==null&&(d=z$(i,l),a.texShape=d),s!=null){var p=lh(i),v=void 0,m=d[1],g=d[0],y=s instanceof Uint8Array||s instanceof Uint8ClampedArray;(l||!y)&&(r=Te(Uc(d[0],d[1]),2),m=r[0],g=r[1]),l?v=new KLe(p,y):v=new Hz(p,y);var b=y?[g,m]:d,w=this.makeTensorInfo(b,o),x=this.texData.get(w.dataId);y?x.usage=ba.PIXELS:x.usage=ba.UPLOAD,x.texShape=b,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(w.dataId),m,g,s);var N=[[g,m]],T=!0,E=this.runWebGLProgram(v,[w],o,N,T),C=this.texData.get(E.dataId);a.texShape=C.texShape,a.isPacked=C.isPacked,a.usage=C.usage,k.env().get("ENGINE_COMPILE_ONLY")?this.disposeData(E.dataId):(a.texture=C.texture,a.values=null,this.texData.delete(E.dataId)),this.disposeIntermediateTensorInfo(w),f&&(this.uploadWaitMs+=k.util.now()-h)}else{var F=this.acquireTexture(d,c,o,l);a.texture=F}}},e.prototype.convertAndCacheOnCPU=function(t,r){var a=this.texData.get(t),i=a.dtype;return r!=null&&(a.values=fqe(r,i)),a.values},e.prototype.acquireTexture=function(t,r,a,i){if(this.numBytesInGPU+=this.computeBytes(t,a),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(o," MB, ")+"most likely due to a memory leak")}return this.textureManager.acquireTexture(t,r,i)},e.prototype.computeBytes=function(t,r){return t[0]*t[1]*k.util.bytesPerElement(r)},e.prototype.checkCompileCompletion=function(){var t,r;try{for(var a=ra(Object.entries(this.binaryCache)),i=a.next();!i.done;i=a.next()){var o=Te(i.value,2),s=o[1];this.checkCompletion_(s)}}catch(u){t={error:u}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}},e.prototype.checkCompileCompletionAsync=function(){return Wc(this,void 0,void 0,function(){var t,r,a,i,l,o,s,u,c,l,f,h,d,p,v=this;return Vc(this,function(m){if(t=[],this.gpgpu.parallelCompilationExtension){try{for(r=ra(Object.entries(this.binaryCache)),a=r.next();!a.done;a=r.next())i=Te(a.value,2),l=i[1],t.push(this.checkCompletionAsync_(l))}catch(g){f={error:g}}finally{try{a&&!a.done&&(h=r.return)&&h.call(r)}finally{if(f)throw f.error}}return[2,Promise.all(t)]}else{o=function(g){var y=new Promise(function(b){try{v.checkCompletion_(g),b(!0)}catch(w){throw w}});t.push(y)};try{for(s=ra(Object.entries(this.binaryCache)),u=s.next();!u.done;u=s.next())c=Te(u.value,2),l=c[1],o(l)}catch(g){d={error:g}}finally{try{u&&!u.done&&(p=s.return)&&p.call(s)}finally{if(d)throw d.error}}return[2,Promise.all(t)]}})})},e.prototype.checkCompletionAsync_=function(t){return Wc(this,void 0,void 0,function(){return Vc(this,function(r){switch(r.label){case 0:return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?[2,this.checkCompletion_(t)]:[3,1];case 1:return[4,k.nextFrame()];case 2:return r.sent(),[2,this.checkCompletionAsync_(t)]}})})},e.prototype.checkCompletion_=function(t){if(this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(Rx(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0},e.prototype.getUniformLocations=function(){var t,r;try{for(var a=ra(Object.entries(this.binaryCache)),i=a.next();!i.done;i=a.next()){var o=Te(i.value,2),s=o[1],u=Y$(this.gpgpu,s.program,s.webGLProgram),c=u.uniformLocations,l=u.customUniformLocations,f=u.infLoc,h=u.nanLoc,d=u.inShapesLocations,p=u.inTexShapesLocations,v=u.outShapeLocation,m=u.outShapeStridesLocation,g=u.outTexShapeLocation;s.uniformLocations=c,s.customUniformLocations=l,s.infLoc=f,s.nanLoc=h,s.inShapesLocations=d,s.inTexShapesLocations=p,s.outShapeLocation=v,s.outShapeStridesLocation=m,s.outTexShapeLocation=g}}catch(y){t={error:y}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}},e.prototype.createTensorFromGPUData=function(t,r,a){t.channels=t.channels||"RGBA";var i=t.texture,o=t.height,s=t.width,u=t.channels,c=k.engine().backend;if(!c.gpgpu.gl.isTexture(i))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");var l=c.writeTexture(i,r,a,o,s,u);return k.engine().makeTensorFromDataId(l,r,a,c)},e}(k.KernelBackend);Vx.nextDataId=0;function fqe(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){for(var t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length),r=0;r<t.length;++r)t[r]=Math.round(n[r]);return t}else throw new Error("Unknown dtype ".concat(e))}var hqe="4.2.0";function wq(){k.env().set("WEBGL_FORCE_F16_TEXTURES",!0)}k.device_util.isBrowser()&&k.registerBackend("webgl",function(){return new Vx},2);var dqe={forceHalfFloat:wq};var Gx=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`,Gc=function(){function n(e,t,r){this.variableNames=["A","B"],this.outputShape=k.backend_util.assertAndGetBroadcastShape(t,r),this.enableShapeUniforms=kr(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        `.concat(e,`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `)}return n}();var wh=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`,xh=function(){function n(e,t,r,a){a===void 0&&(a=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=k.backend_util.assertAndGetBroadcastShape(t,r);var i=this.outputShape.length;this.enableShapeUniforms=kr(i);var o="";if(a)if(i===0||k.util.sizeFromShape(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else{var s=Wt(i);if(o=`
          `.concat(s,` coords = getOutputCoords();
        `),i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= `.concat(this.outputShape[0],` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `);else{var u=br("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (`.concat(u[i-2]," + 1) >= outShape[").concat(i,` - 2];
            bool nextColOutOfBounds =
              (`).concat(u[i-1]," + 1) >= outShape[").concat(i,` - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `):o+=`
            bool nextRowOutOfBounds =
              (`.concat(u[i-2]," + 1) >= ").concat(this.outputShape[i-2],`;
            bool nextColOutOfBounds =
              (`).concat(u[i-1]," + 1) >= ").concat(this.outputShape[i-1],`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `)}}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `.concat(e,`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `).concat(o,`

        setOutput(result);
      }
    `)}return n}();function aa(n){var e=n.inputs,t=n.backend,r=e.x;return t.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var pqe={kernelName:k.Identity,backendName:"webgl",kernelFunc:aa};function ns(n){var e=n.inputs,t=n.backend,r=e.real,a=e.imag,i=t.makeTensorInfo(r.shape,"complex64"),o=t.texData.get(i.dataId),s=aa({inputs:{x:r},backend:t}),u=aa({inputs:{x:a},backend:t});return o.complexTensorInfos={real:s,imag:u},i}var vqe={kernelName:k.Complex,backendName:"webgl",kernelFunc:ns};var xq="return (a < 0.) ? b * a : a;",kq=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function mqe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.alpha,o=t.makeTensorInfo([],"float32",k.util.createScalarValue(i,"float32")),s=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new xh(kq,a.shape,o.shape):new Gc(xq,a.shape,o.shape),u=t.runWebGLProgram(s,[a,o],"float32");return t.disposeIntermediateTensorInfo(o),u}var gqe={kernelName:k.LeakyRelu,backendName:"webgl",kernelFunc:mqe};var Sq="return (a < 0.) ? b * a : a;",Nq=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function yqe(n){var e=n.inputs,t=n.backend,r=e.x,a=e.alpha,i=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new xh(Nq,r.shape,a.shape):new Gc(Sq,r.shape,a.shape);return t.runWebGLProgram(i,[r,a],"float32")}var bqe={kernelName:k.Prelu,backendName:"webgl",kernelFunc:yqe},Zc="if (isnan(x)) return x;";function Nt(n){var e=n.opSnippet,t=n.packedOpSnippet,r=n.cpuKernelImpl,a=n.dtype;return function(i){var o=i.inputs,s=i.backend,u=o.x,c=s,l=a||u.dtype;if(c.shouldExecuteOnCPU([u])&&r!=null){var f=c.texData.get(u.dataId),h=r(f.values,l);return c.makeTensorInfo(u.shape,l,h)}var d=k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null,p;return d?p=new es(u.shape,t):p=new Mi(u.shape,e),c.runWebGLProgram(p,[u],l)}}function or(n){var e=n.opSnippet,t=n.packedOpSnippet,r=n.checkOutOfBounds,a=r===void 0?!1:r,i=n.supportsComplex,o=i===void 0?!1:i,s=n.cpuKernelImpl,u=n.dtype;return function(c){var l=c.inputs,f=c.backend,h=l.a,d=l.b,p=f;if(o&&h.dtype==="complex64"){var v=p.texData.get(h.dataId),m=p.texData.get(d.dataId),g=Te([[v.complexTensorInfos.real,m.complexTensorInfos.real],[v.complexTensorInfos.imag,m.complexTensorInfos.imag]].map(function(W){var X=Te(W,2),Z=X[0],V=X[1],j={dataId:Z.dataId,dtype:Z.dtype,shape:h.shape},re={dataId:V.dataId,dtype:V.dtype,shape:d.shape},ne=new Gc(e,h.shape,d.shape);return p.runWebGLProgram(ne,[j,re],k.upcastType(Z.dtype,V.dtype))}),2),y=g[0],b=g[1],w=ns({inputs:{real:y,imag:b},backend:p});return p.disposeIntermediateTensorInfo(y),p.disposeIntermediateTensorInfo(b),w}var x=u||k.upcastType(h.dtype,d.dtype);if((h.dtype==="string"||d.dtype==="string"||p.shouldExecuteOnCPU([h,d]))&&s!=null){var N=p.texData.get(h.dataId).values,T=p.texData.get(d.dataId).values,E=h.dtype==="string"?k.backend_util.fromUint8ToStringArray(N):N,C=h.dtype==="string"?k.backend_util.fromUint8ToStringArray(T):T,F=Te(s(h.shape,d.shape,E,C,x),2),_=F[0],O=F[1],L=p.makeTensorInfo(O,x),z=p.texData.get(L.dataId);return z.values=_,L}var $=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null,B;return $?B=new xh(t,h.shape,d.shape,a):B=new Gc(e,h.shape,d.shape),p.runWebGLProgram(B,[h,d],x)}}function vh(n,e){if(e===void 0&&(e=!1),n==="linear")return e?J$e:K$e;if(n==="relu")return e?eqe:X$e;if(n==="elu")return e?Q$e:j$e;if(n==="relu6")return e?tqe:Y$e;if(n==="prelu")return e?Nq:Sq;if(n==="leakyrelu")return e?kq:xq;if(n==="sigmoid")return e?nqe:Z$e;throw new Error("Activation ".concat(n," has not been implemented for the WebGL backend."))}var Tq=function(){function n(e,t,r,a,i,o,s,u,c){a===void 0&&(a=!1),i===void 0&&(i=!1),o===void 0&&(o=!1),s===void 0&&(s=null),u===void 0&&(u=!1),c===void 0&&(c=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=kr(this.outputShape.length);var l=a?e[1]:e[2],f=Math.ceil(l/2),h=a?"i * 2, rc.y":"rc.y, i * 2",d=i?"rc.z, i * 2":"i * 2, rc.z",p=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],v=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],m="",g="";s&&(u?m=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `.concat(s,`
        }`):c?m=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          `.concat(s,`
        }`):m=`vec4 activation(vec4 x) {
          `.concat(s,`
        }`),g="result = activation(result);");var y=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");var b="rc.x",w="rc.x";e[0]<t[0]?b="imod(rc.x, ".concat(e[0],")"):t[0]<e[0]&&(w="imod(rc.x, ".concat(t[0],")")),this.userCode=`
      `.concat(m,`
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = `).concat(f,`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = `).concat(b,`;
        int batchB = `).concat(w,`;
        for (int i = 0; i < `).concat(f,`; i++) {
          vec4 a = getMatrixA(batchA, `).concat(h,`);
          vec4 b = getMatrixB(batchB, `).concat(d,`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`).concat(p[0]," * ").concat(v[0],`);
          result += (`).concat(p[1]," * ").concat(v[1],`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `).concat(y,`

        `).concat(g,`

        setOutput(result);
      }
    `)}return n}();var t$={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},n$=function(){function n(e,t,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=k.backend_util.assertAndGetBroadcastShape(t,r),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `.concat(e,`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `)}return n}(),r$="return a * b;";function Ux(n){var e=n.inputs,t=n.backend,r=e.a,a=e.b,i=k.backend_util.upcastType(r.dtype,a.dtype);if(r.dtype==="complex64"){var o=t.texData.get(r.dataId),s=t.texData.get(a.dataId),u=new n$(t$.REAL,r.shape,a.shape),c=new n$(t$.IMAG,r.shape,a.shape),l=[{dataId:o.complexTensorInfos.real.dataId,dtype:o.complexTensorInfos.real.dtype,shape:r.shape},{dataId:o.complexTensorInfos.imag.dataId,dtype:o.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:a.shape},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:a.shape}],f=t.runWebGLProgram(u,l,"float32"),h=t.runWebGLProgram(c,l,"float32"),d=ns({inputs:{real:f,imag:h},backend:t});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),d}if(t.shouldExecuteOnCPU([r,a])){var o=t.texData.get(r.dataId),s=t.texData.get(a.dataId),p=Te(g$e(r.shape,a.shape,o.values,s.values,i),2),v=p[0],m=p[1],g=t.makeTensorInfo(m,i),y=t.texData.get(g.dataId);return y.values=v,g}var b;return k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?b=new xh(r$,r.shape,a.shape):b=new Gc(r$,r.shape,a.shape),t.runWebGLProgram(b,[r,a],i)}var wqe={kernelName:k.Multiply,backendName:"webgl",kernelFunc:Ux};function xqe(n,e,t){var r=dn([hu(n.shape)],Te(du(n.shape)),!1),a={dtype:n.dtype,shape:r,dataId:n.dataId},i=dn([hu(e)],Te(du(e)),!1),o=new bq(i,r),s=!0,u=[r],c=t.runWebGLProgram(o,[a],n.dtype,u,s);return{dataId:c.dataId,shape:e,dtype:c.dtype}}function Pe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.shape,o=t,s=k.util.sizeFromShape(a.shape),u=k.util.inferFromImplicitShape(i,s),c=k.util.sizeFromShape(u);k.util.assert(s===c,function(){return"The new shape (".concat(u,") has ").concat(c," elements and the old ")+"shape (".concat(a.shape,") has ").concat(s," elements. The new shape and old ")+"shape must have the same number of elements."});var l=o.texData.get(a.dataId);return l.isPacked&&!ph(a.shape,u)&&!(l.texture!==null&&ph(l.shape,u))?xqe(a,u,o):(o.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype})}var kqe={kernelName:k.Reshape,backendName:"webgl",kernelFunc:Pe};var a$=function(){function n(e,t){this.variableNames=["x"];var r=e.windowSize,a=e.batchSize,i=e.inSize,o=e.outSize;this.outputShape=[a,o];var s=Math.floor(r/4)*4,u=r%4,c="sumValue += dot(values, ones);";if(t!=null){var l=1/t;c="sumValue += dot(values * ".concat(k.util.isInt(l)?l.toPrecision(2):l,", ones);")}var f="";i%r>0&&(f=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return 0.0;
        }
      `)),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `.concat(f,`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `).concat(r,`;

        float sumValue = 0.0;

        for (int i = 0; i < `).concat(s,`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `).concat(c,`
        }

        int inIdx = inOffset + `).concat(s,`;
        if (`).concat(u===1,`) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          `).concat(c,`
        } else if (`).concat(u===2,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          `).concat(c,`
        } else if (`).concat(u===3,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          `).concat(c,`
        }
        setOutput(sumValue);
      }
    `)}return n}();var Sqe=function(){function n(e,t){this.variableNames=["x"];var r=e.windowSize,a=e.batchSize,i=e.inSize,o=e.outSize;this.outputShape=[a,o];var s="0.0",u="";t==="prod"?s="1.0":t==="min"?(s="1.0 / 1e-20",u="min"):t==="max"&&(s="-1.0 / 1e-20",u="max");var c="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="sum"?c="sumValue":t==="prod"?c="prodValue":t==="all"?c="allValue":t==="any"&&(c="anyValue");var l=Math.floor(r/4)*4,f=r%4,h=`
      if (`.concat(t==="sum",`) {
        sumValue += dot(values, ones);
      } else if (`).concat(t==="prod",`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `).concat(u,`(values, minMaxValue);
        if (`).concat(t==="min"," || ").concat(t==="max",`) {
          minMaxValue = `).concat(u,`(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `),d="vec4";t==="all"?(s="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,d="bvec4"):t==="any"&&(s="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,d="bvec4");var p="";i%r>0&&(p=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return initializationValue;
        }
      `)),this.userCode=`
      const float initializationValue = `.concat(s,`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `).concat(p,`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `).concat(r,`;

        vec4 minMaxValue = vec4(`).concat(s,`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `).concat(l,`; i += 4) {
          int inIdx = inOffset + i;
          `).concat(d," values = ").concat(d,`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `).concat(h,`
        }

        int inIdx = inOffset + `).concat(l,`;
        if (`).concat(f===1,`) {
          `).concat(d," values = ").concat(d,`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `).concat(h,`
        } else if (`).concat(f===2,`) {
          `).concat(d," values = ").concat(d,`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `).concat(h,`
        } else if (`).concat(f===3,`) {
          `).concat(d," values = ").concat(d,`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `).concat(h,`
        }
        setOutput(`).concat(c,`);
      }
    `)}return n}();function Nqe(n){for(var e=[];e.length===0||e[e.length-1].outSize!==1;){var t=e.length?e[e.length-1].outSize:n[1],r=k.backend_util.computeOptimalWindowSize(t);e.push({inSize:t,windowSize:r,outSize:Math.ceil(t/r)})}return e}function mu(n,e,t,r){for(var a=Nqe(n.shape),i=n,o=0;o<a.length;o++){var s=a[o],u=s.inSize,c=s.windowSize,l=s.outSize,f=void 0,h=void 0;t==="mean"?f=o===0?new a$({windowSize:c,inSize:u,batchSize:n.shape[0],outSize:l},u):new a$({windowSize:c,inSize:u,batchSize:n.shape[0],outSize:l}):f=new Sqe({windowSize:c,inSize:u,batchSize:n.shape[0],outSize:l},t),h=i,i=r.runWebGLProgram(f,[i],e),h.dataId!==n.dataId&&r.disposeIntermediateTensorInfo(h)}return i}var Tqe=function(){function n(e,t){this.variableNames=["A"];for(var r=new Array(e.length),a=0;a<r.length;a++)r[a]=e[t[a]];this.outputShape=r,this.rank=r.length;var i=Wt(this.rank),o=Eqe(t);this.userCode=`
    void main() {
      `.concat(i,` resRC = getOutputCoords();
      setOutput(getA(`).concat(o,`));
    }
    `)}return n}();function Eqe(n){var e=n.length;if(e>6)throw Error("Transpose for rank ".concat(e," is not yet supported"));for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e),a=0;a<n.length;a++)r[n[a]]=t[a];return r.join()}var Iqe=function(){function n(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var r=new Array(e.length),a=0;a<r.length;a++)r[a]=e[t[a]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=Wt(this.rank),o=yq("rc",this.rank),s=new Array(this.rank),a=0;a<t.length;a++)s[t[a]]=o[a];var u="vec2(".concat(s.slice(-2).join(),")"),c="++".concat(o[this.rank-1]," < ").concat(r[this.rank-1]),l="getChannel(getA(".concat(s.join(),"), ").concat(u,")");this.userCode=`
    void main() {
      `.concat(i,` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `).concat(l,`;
      if(`).concat(c,`) {
        result[1] = `).concat(l,`;
      }
      --`).concat(o[this.rank-1],`;
      if(++`).concat(o[this.rank-2]," < ").concat(r[this.rank-2],`) {
        result[2] = `).concat(l,`;
        if(`).concat(c,`) {
          result[3] = `).concat(l,`;
        }
      }
      setOutput(result);
    }
    `)}return n}();function fm(n,e,t){var r=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Iqe(n.shape,e):new Tqe(n.shape,e);return t.runWebGLProgram(r,[n],n.dtype)}function Cqe(n,e,t,r){var a=e,i=n.shape.length,o=k.util.parseAxisParam(a,n.shape),s=o,u=k.backend_util.getAxesPermutation(s,i),c=u!=null,l=n;c&&(l=fm(n,u,r),s=k.backend_util.getInnerMostAxes(s.length,i)),k.backend_util.assertAxesAreInnerMostDims("sum",s,i);var f=Te(k.backend_util.computeOutAndReduceShapes(l.shape,s),2),h=f[0],d=f[1],p=h;t&&(p=k.backend_util.expandShapeToKeepDim(h,o));var v=k.util.sizeFromShape(d),m=k.util.sizeFromShape(n.shape),g=m/v,y=Pe({inputs:{x:l},attrs:{shape:[g,v]},backend:r}),b=k.sumOutType(n.dtype),w=mu(y,b,"sum",r),x=Pe({inputs:{x:w},attrs:{shape:p},backend:r});return r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(w),c&&r.disposeIntermediateTensorInfo(l),x}function hm(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims;return Cqe(a,i,o,t)}var Aqe={kernelName:k.Sum,backendName:"webgl",kernelFunc:hm};function wr(n){for(var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.perm,o=t,s=a.shape.length,u=new Array(s),c=0;c<u.length;c++)u[c]=a.shape[i[c]];var l;if(o.shouldExecuteOnCPU([a])){var f=o.texData.get(a.dataId),h=f.values,d=Wx(h,a.shape,a.dtype,i,u);l=o.makeTensorInfo(u,a.dtype);var p=o.texData.get(l.dataId);p.values=d}else l=fm(a,i,o);return l}var Dqe={kernelName:k.Transpose,backendName:"webgl",kernelFunc:wr},Eq=1e3;function sm(n){var e,t,r=n.a,a=n.b,i=n.transposeA,o=n.transposeB,s=n.backend,u=n.bias,c=u===void 0?null:u,l=n.preluActivationWeights,f=l===void 0?null:l,h=n.leakyreluAlpha,d=h===void 0?0:h,p=n.activation,v=p===void 0?null:p,m=r.shape.length,g=a.shape.length,y=i?r.shape[m-2]:r.shape[m-1],b=o?a.shape[g-1]:a.shape[g-2],w=i?r.shape[m-1]:r.shape[m-2],x=o?a.shape[g-2]:a.shape[g-1],N=r.shape.slice(0,-2),T=a.shape.slice(0,-2),E=k.util.sizeFromShape(N),C=k.util.sizeFromShape(T),F=k.broadcast_util.assertAndGetBroadcastShape(r.shape.slice(0,-2),a.shape.slice(0,-2)),_=F.concat([w,x]);k.util.assert(y===b,function(){return"Error in matMul: inner shapes (".concat(y,") and (")+"".concat(b,") of Tensors with shapes ").concat(r.shape," and ")+"".concat(a.shape," and transposeA=").concat(i)+" and transposeB=".concat(o," must match.")});var O=i?[E,y,w]:[E,w,y],L=o?[C,x,b]:[C,b,x],z=Pe({inputs:{x:r},backend:s,attrs:{shape:O}}),$=Pe({inputs:{x:a},backend:s,attrs:{shape:L}}),B=[z,$],W=Math.max(E,C),X=i?z.shape[1]:z.shape[2],Z=c!=null,V=f!=null,j=v==="leakyrelu",re=v!=null?vh(v,!0):null,ne=Z||V||j||re!=null,oe;if((w===1||x===1)&&X>Eq&&ne===!1){var le=z,pe=$;i&&(le=wr({inputs:{x:z},backend:s,attrs:{perm:[0,2,1]}}),B.push(le)),o&&(pe=wr({inputs:{x:$},backend:s,attrs:{perm:[0,2,1]}}),B.push(pe));var xe=x!==1,he=x===1,ye=le;xe&&(ye=Pe({inputs:{x:le},backend:s,attrs:{shape:[W,X,1]}}),B.push(ye));var we=x===1?2:1,Ae=pe;he&&(Ae=Pe({inputs:{x:pe},backend:s,attrs:{shape:[W,1,X]}}),B.push(Ae));var Ye=Ux({inputs:{a:ye,b:Ae},backend:s});oe=hm({inputs:{x:Ye},backend:s,attrs:{axis:we,keepDims:!0}}),B.push(Ye)}else{var ht=k.upcastType(r.dtype,a.dtype),at=new Tq(O,L,[W,w,x],i,o,Z,re,V,j),rt=[z,$];if(c!=null&&rt.push(c),V&&rt.push(f),j){var ft=s.makeTensorInfo([],"float32",k.util.createScalarValue(d,"float32"));rt.push(ft),B.push(ft)}oe=s.runWebGLProgram(at,rt,ht)}var st=Pe({inputs:{x:oe},backend:s,attrs:{shape:_}});B.push(oe);try{for(var Ze=ra(B),tt=Ze.next();!tt.done;tt=Ze.next()){var et=tt.value;s.disposeIntermediateTensorInfo(et)}}catch(rn){e={error:rn}}finally{try{tt&&!tt.done&&(t=Ze.return)&&t.call(Ze)}finally{if(e)throw e.error}}return st}function _qe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.a,i=e.b,o=e.bias,s=e.preluActivationWeights,u=r.transposeA,c=r.transposeB,l=r.activation,f=r.leakyreluAlpha;return sm({a,b:i,transposeA:u,transposeB:c,backend:t,bias:o,preluActivationWeights:s,leakyreluAlpha:f,activation:l})}var Fqe={kernelName:k._FusedMatMul,backendName:"webgl",kernelFunc:_qe};var i$="return abs(x);";function Rqe(n){var e=n.inputs,t=n.backend,r=e.x;if(t.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){var a=t.texData.get(r.dataId),i=mq(a.values);return t.makeTensorInfo(r.shape,r.dtype,i)}var o;return k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new es(r.shape,i$):o=new Mi(r.shape,i$),t.runWebGLProgram(o,[r],r.dtype)}var Oqe={kernelName:k.Abs,backendName:"webgl",kernelFunc:Rqe};var Pqe=Xa+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,Mqe=Nt({opSnippet:Pqe}),Bqe={kernelName:k.Acos,backendName:"webgl",kernelFunc:Mqe};var Lqe=Xa+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,zqe=Nt({opSnippet:Lqe}),$qe={kernelName:k.Acosh,backendName:"webgl",kernelFunc:zqe};var o$="return a + b;",qqe=or({opSnippet:o$,packedOpSnippet:o$,supportsComplex:!0,cpuKernelImpl:Zze}),Wqe={kernelName:k.Add,backendName:"webgl",kernelFunc:qqe};var Vqe=function(){function n(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(function(i,o){return"T".concat(o)});var r=[];this.variableNames.forEach(function(i){r.push("float v".concat(i," = get").concat(i,"AtOutCoords();"))});var a=this.variableNames.map(function(i){return"v".concat(i)}).join(" + ");this.userCode=`
      void main() {
        `.concat(r.join(`
        `),`

        float result = `).concat(a,`;
        setOutput(result);
      }
    `)}return n}();var Gqe=function(){function n(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(function(i,o){return"T".concat(o)});var r=[];this.variableNames.forEach(function(i){r.push("vec4 v".concat(i," = get").concat(i,"AtOutCoords();"))});var a=this.variableNames.map(function(i){return"v".concat(i)}).join(" + ");this.userCode=`
      void main() {
        `.concat(r.join(`
        `),`

        vec4 result = `).concat(a,`;
        setOutput(result);
      }
    `)}return n}();function om(n){var e=n.inputs,t=n.backend,r=e;if(r.length===1)return aa({inputs:{x:r[0]},backend:t});if(r.length>k.env().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(r.length/2),i=om({inputs:r.slice(0,a),backend:t}),o=om({inputs:r.slice(a),backend:t});return om({inputs:[i,o],backend:t})}var s=r.map(function(f){return f.dtype}).reduce(function(f,h){return k.upcastType(f,h)}),u=r.map(function(f){return f.shape}),c=k.env().getBool("WEBGL_PACK"),l=c?new Gqe(r[0].shape,u):new Vqe(r[0].shape,u);return t.runWebGLProgram(l,r,s)}var Uqe={kernelName:k.AddN,backendName:"webgl",kernelFunc:om};function Hqe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=a;l!=null&&(f=wr({inputs:{x:a},backend:t,attrs:{perm:l}}),c=k.backend_util.getInnerMostAxes(c.length,s)),k.backend_util.assertAxesAreInnerMostDims("all",c,s);var h=Te(k.backend_util.computeOutAndReduceShapes(f.shape,c),2),d=h[0],p=h[1],v=k.util.sizeFromShape(p),m=Pe({inputs:{x:f},backend:t,attrs:{shape:[-1,v]}}),g=mu(m,m.dtype,"all",t),y;if(o){var b=k.backend_util.expandShapeToKeepDim(d,u);y=Pe({inputs:{x:g},backend:t,attrs:{shape:b}})}else y=Pe({inputs:{x:g},backend:t,attrs:{shape:d}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),l!=null&&t.disposeIntermediateTensorInfo(f),y}var Kqe={kernelName:k.All,backendName:"webgl",kernelFunc:Hqe};function jqe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=a;l!=null&&(f=wr({inputs:{x:a},backend:t,attrs:{perm:l}}),c=k.backend_util.getInnerMostAxes(c.length,s)),k.backend_util.assertAxesAreInnerMostDims("any",c,s);var h=Te(k.backend_util.computeOutAndReduceShapes(f.shape,c),2),d=h[0],p=h[1],v=k.util.sizeFromShape(p),m=Pe({inputs:{x:f},backend:t,attrs:{shape:[-1,v]}}),g=mu(m,m.dtype,"any",t),y;if(o){var b=k.backend_util.expandShapeToKeepDim(d,u);y=Pe({inputs:{x:g},backend:t,attrs:{shape:b}})}else y=Pe({inputs:{x:g},backend:t,attrs:{shape:d}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),l!=null&&t.disposeIntermediateTensorInfo(f),y}var Xqe={kernelName:k.Any,backendName:"webgl",kernelFunc:jqe};var Yqe=function(){function n(e,t,r){this.variableNames=["A"];var a=e.windowSize,i=e.batchSize,o=e.outSize;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s=t==="max"?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `.concat(a,`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `).concat(a,`; i++) {
          int inIdx = `).concat(u,`;
          float candidate = getA(batch, inIdx);
          if (candidate `).concat(s,` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `)}return n}();var Zqe=function(){function n(e,t,r,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,k.util.assert(e.length>2,function(){return"Packed arg".concat(r.charAt(0).toUpperCase()+r.slice(1)," supports only inputs with rank above 2.")});var i=e[e.length-1],o=Math.ceil(i/t);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),a||this.variableNames.push("bestIndicesA");var s=this.outputShape,u=s.length,c=Wt(u),l=br("coords",u),f,h;if(o===1){h=u+1;var d=Wt(h);f=`
        `.concat(d," sourceLocR = ").concat(d,"(").concat(l.join(),`, 0);
        ++`).concat(l[u-1],`;
        `).concat(d," sourceLocG = ").concat(d,"(").concat(l.join(),`, 0);
        ++`).concat(l[u-2],`;
        `).concat(d," sourceLocA = ").concat(d,"(").concat(l.join(),`, 0);
        --`).concat(l[u-1],`;
        `).concat(d," sourceLocB = ").concat(d,"(").concat(l.join(),`, 0);
        --`).concat(l[u-2],";")}else h=u,f=`
        `.concat(c,` sourceLocR = coords;
        ++`).concat(l[u-1],`;
        `).concat(c,` sourceLocG = coords;
        ++`).concat(l[u-2],`;
        `).concat(c,` sourceLocA = coords;
        --`).concat(l[u-1],`;
        `).concat(c,` sourceLocB = coords;
        --`).concat(l[u-2],";");var p=["x","y","z","w","u","v"].slice(0,h),v="."+p[h-1],m=p.map(function(C){return"int "+C}),g=br("sourceLocR",h-1).concat("inIdx.r"),y=br("sourceLocG",h-1).concat("inIdx.g"),b=br("sourceLocB",h-1).concat("inIdx.b"),w=br("sourceLocA",h-1).concat("inIdx.a"),x=r==="max"?"greaterThan":"lessThan",N=a?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`.concat(g.join(),`),
                             getBestIndicesAChannel(`).concat(y.join(),`),
                             getBestIndicesAChannel(`).concat(b.join(),`),
                             getBestIndicesAChannel(`).concat(w.join(),")));"),T=`vec4(
            getAChannel(`.concat(g.join(),`),
            hasNextCol ? getAChannel(`).concat(y.join(),`) : 0.,
            hasNextRow ? getAChannel(`).concat(b.join(),`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`).concat(w.join(),") : 0.)"),E=a?"":`
      float getBestIndicesAChannel(`.concat(m.join(),`) {
        return getChannel(getBestIndicesA(`).concat(p.join(),`),
                                          vec2(`).concat(p.slice(-2).join(),`));
      }`);this.userCode=`
      float getAChannel(`.concat(m.join(),`) {
        return getChannel(getA(`).concat(p.join(),`),
                               vec2(`).concat(p.slice(-2).join(),`));
      }
      `).concat(E,`
      void main() {
        `).concat(c,` coords = getOutputCoords();
        bool hasNextCol = `).concat(l[u-1]," < ").concat(s[u-1]-1,`;
        bool hasNextRow = `).concat(l[u-2]," < ").concat(s[u-2]-1,`;
        `).concat(f,`
        ivec4 srcIdx = ivec4(sourceLocR`).concat(v,", sourceLocG").concat(v,`,
          sourceLocB`).concat(v,", sourceLocA").concat(v,") * ").concat(t,`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `).concat(T,`;

        for (int i = 0; i < `).concat(t,`; i++) {
          inIdx = srcIdx;
          `).concat(N,`
          vec4 candidate = `).concat(T,`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`).concat(x,`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `)}return n}();function Iq(n,e,t,r){r===void 0&&(r=null);var a=e.shape[0],i=e.shape[1];r!=null&&(a=r.shape[0],i=r.shape[1]);var o=k.backend_util.computeOptimalWindowSize(i),s={windowSize:o,inSize:i,batchSize:a,outSize:Math.ceil(i/o)},u=new Yqe(s,t,r==null),c=[e];r!=null&&c.push(r);var l=n.runWebGLProgram(u,c,"int32");if(l.shape[1]===1)return l;var f=Iq(n,e,t,l);return n.disposeIntermediateTensorInfo(l),f}function Cq(n,e,t,r){r===void 0&&(r=null);var a=r!=null?r.shape:e.shape,i=a[a.length-1],o=k.backend_util.computeOptimalWindowSize(i),s=new Zqe(a,o,t,r==null),u=r==null?[e]:[e,r],c=n.runWebGLProgram(s,u,"int32");if(c.shape.length===e.shape.length){var l=Cq(n,e,t,c);return n.disposeIntermediateTensorInfo(c),l}return c}function Aq(n,e,t,r){var a=[t];if(k.backend_util.assertAxesAreInnerMostDims("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,e.shape.length),!k.env().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){var i=[],o=n.texData.get(e.dataId),s=o!==null&&o.isPacked,u=e;s&&(u=n.unpackTensor(e),i.push(u));var c=Te(k.backend_util.computeOutAndReduceShapes(u.shape,a),2),l=c[0],f=c[1],h=k.util.sizeFromShape(f),d=Pe({inputs:{x:u},backend:n,attrs:{shape:[-1,h]}});i.push(d);var p=Iq(n,d,r);i.push(p);var v=Pe({inputs:{x:p},backend:n,attrs:{shape:l}});return i.forEach(function(m){return n.disposeIntermediateTensorInfo(m)}),v}return Cq(n,e,r)}function Jqe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=k.util.parseAxisParam(i,a.shape),s=k.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=wr({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=k.backend_util.getInnerMostAxes(o.length,u.shape.length)),k.backend_util.assertAxesAreInnerMostDims("argMax",[o[0]],u.shape.length);var l=Aq(t,u,o[0],"max");return c.forEach(function(f){return t.disposeIntermediateTensorInfo(f)}),l}var Qqe={kernelName:k.ArgMax,backendName:"webgl",kernelFunc:Jqe};function eWe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=k.util.parseAxisParam(i,a.shape),s=k.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=wr({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=k.backend_util.getInnerMostAxes(o.length,u.shape.length)),k.backend_util.assertAxesAreInnerMostDims("argMin",[o[0]],u.shape.length);var l=Aq(t,u,o[0],"min");return c.forEach(function(f){return t.disposeIntermediateTensorInfo(f)}),l}var tWe={kernelName:k.ArgMin,backendName:"webgl",kernelFunc:eWe};var nWe=Xa+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,rWe=Nt({opSnippet:nWe}),aWe={kernelName:k.Asin,backendName:"webgl",kernelFunc:rWe};var iWe=Xa+"return log(x + sqrt(x * x + 1.0));",oWe=Nt({opSnippet:iWe}),sWe={kernelName:k.Asinh,backendName:"webgl",kernelFunc:oWe};var uWe=Xa+`
  return atan(x);
`,cWe=Nt({opSnippet:uWe}),lWe={kernelName:k.Atan,backendName:"webgl",kernelFunc:cWe};var fWe=Gx+`
  return atan(a, b);
`,hWe=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+wh+`
  return result;
`,dWe=or({opSnippet:fWe,packedOpSnippet:hWe}),pWe={kernelName:k.Atan2,backendName:"webgl",kernelFunc:dWe};var vWe=Xa+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,mWe=Nt({opSnippet:vWe}),gWe={kernelName:k.Atanh,backendName:"webgl",kernelFunc:mWe};var mh=function(){function n(e,t,r,a,i){if(a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x"],t==="avg"&&r)throw new Error("Cannot compute positions for average pool.");var o=e.filterWidth,s=e.strideHeight,u=e.strideWidth,c=e.dilationHeight,l=e.dilationWidth,f=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.top,p=e.padInfo.left;this.outputShape=e.outShape;var v=t==="avg",m="((batch  * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + d"),g="(xR * ".concat(e.inWidth," + xC) * ").concat(e.inChannels," + d"),y="0.0";if(v||(y="-1.0 / 1e-20"),r){var b=">=";this.userCode=`
        const ivec2 strides = ivec2(`.concat(s,", ").concat(u,`);
        const ivec2 pads = ivec2(`).concat(d,", ").concat(p,`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `).concat(f,`;
              wR += `).concat(c,`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int wC = 0; wC < `).concat(h,`;
                wC += `).concat(l,`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value `).concat(b,` currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = `).concat(a?i?m:g:"wR * ".concat(h," + wC"),`;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `);return}var w="max",x="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(x="avgValue / max(count, 1.0)");var N=Math.floor(o/4)*4,T=o%4,E=`
      if (`.concat(v,`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = `).concat(w,`(values, minMaxValue);
      }
    `);this.userCode=`
      const ivec2 strides = ivec2(`.concat(s,", ").concat(u,`);
      const ivec2 pads = ivec2(`).concat(d,", ").concat(p,`);
      const float initializationValue = `).concat(y,`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `).concat(e.inWidth,`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`).concat(y,`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `).concat(f,`;
            wR += `).concat(c,`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `).concat(e.inHeight,`) {
            continue;
          }

          for (int wC = 0; wC < `).concat(N,`; wC += 4) {
            int xC = xCCorner + wC * `).concat(l,`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `).concat(l,`, d),
              getValue(batch, xR, xC + 2 * `).concat(l,`, d),
              getValue(batch, xR, xC + 3 * `).concat(l,`, d)
            );

            `).concat(E,`
          }

          int xC = xCCorner + `).concat(N,`;
          if (`).concat(T===1,`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `).concat(E,`
          } else if (`).concat(T===2,`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `).concat(l,`, d),
              initializationValue,
              initializationValue
            );

            `).concat(E,`
          } else if (`).concat(T===3,`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `).concat(l,`, d),
              getValue(batch, xR, xC + 2 * `).concat(l,`, d),
              initializationValue
            );

            `).concat(E,`
          }
        }
        setOutput(`).concat(x,`);
      }
    `)}return n}(),Hx=function(){function n(e,t,r,a,i){if(a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x"],t==="avg"&&r)throw new Error("Cannot compute positions for average pool.");var o=e.filterWidth,s=e.strideDepth,u=e.strideHeight,c=e.strideWidth,l=e.dilationDepth,f=e.dilationHeight,h=e.dilationWidth,d=e.effectiveFilterDepth,p=e.effectiveFilterHeight,v=e.effectiveFilterWidth,m=e.padInfo.front,g=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;var b=t==="avg",w="0.0";if(b||(w="-1.0 / 1e-20"),r){var x=">=";this.userCode=`
        const ivec3 strides =
            ivec3(`.concat(s,", ").concat(u,", ").concat(c,`);
        const ivec3 pads = ivec3(`).concat(m,", ").concat(g,", ").concat(y,`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `).concat(d,`;
              wD += `).concat(l,`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `).concat(e.inDepth,`) {
              continue;
            }

            for (int wR = 0; wR < `).concat(p,`;
                wR += `).concat(f,`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `).concat(e.inHeight,`) {
                continue;
              }

              for (int wC = 0; wC < `).concat(v,`;
                  wC += `).concat(h,`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value `).concat(x,` currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = `).concat(a?i?"(((batch * ".concat(e.inDepth," + xD) * ").concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"((xD * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"wD * ".concat(p," * ").concat(v,` +
                      wR * `).concat(v," + wC"),`;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `);return}var N="max",T="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(T="avgValue / max(count, 1.0)");var E=Math.floor(o/4)*4,C=o%4,F=`
      if (`.concat(b,`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = `).concat(N,`(values, minMaxValue);
      }
    `);this.userCode=`
      const ivec3 strides =
        ivec3(`.concat(s,", ").concat(u,", ").concat(c,`);
      const ivec3 pads = ivec3(`).concat(m,", ").concat(g,", ").concat(y,`);
      const float initializationValue = `).concat(w,`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `).concat(e.inWidth,`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`).concat(w,`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `).concat(d,`;
            wD += `).concat(l,`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `).concat(e.inDepth,`) {
            continue;
          }

          for (int wR = 0; wR < `).concat(p,`;
            wR += `).concat(f,`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int wC = 0; wC < `).concat(E,`; wC += 4) {
              int xC = xCCorner + wC * `).concat(h,`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `).concat(h,`, ch),
                getValue(batch, xD, xR, xC + 2 * `).concat(h,`, ch),
                getValue(batch, xD, xR, xC + 3 * `).concat(h,`, ch)
              );

              `).concat(F,`
            }

            int xC = xCCorner + `).concat(E,`;
            if (`).concat(C===1,`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `).concat(F,`
            } else if (`).concat(C===2,`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `).concat(h,`, ch),
                initializationValue,
                initializationValue
              );

              `).concat(F,`
            } else if (`).concat(C===3,`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `).concat(h,`, ch),
                getValue(batch, xD, xR, xC + 2 * `).concat(h,`, ch),
                initializationValue
              );

              `).concat(F,`
            }
          }
        }
        setOutput(`).concat(T,`);
      }
    `)}return n}();function yWe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x;Hc(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=1;k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=k.backend_util.computePool2DInfo(a.shape,i,o,c,s,u);if(l.filterWidth===1&&l.filterHeight===1&&k.util.arraysEqual(l.inShape,l.outShape))return aa({inputs:{x:a},backend:t});var f=new mh(l,"avg",!1);return t.runWebGLProgram(f,[a],"float32")}var bWe={kernelName:k.AvgPool,backendName:"webgl",kernelFunc:yWe};function wWe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat,l=[1,1,1],f=k.backend_util.computePool3DInfo(a.shape,i,o,l,s,u,c),h=new Hx(f,"avg",!1);return t.runWebGLProgram(h,[a],"float32")}var xWe={kernelName:k.AvgPool3D,backendName:"webgl",kernelFunc:wWe};var kWe=function(){function n(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,r=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=u-1-e.padInfo.top,f=c-1-e.padInfo.left,h=1/(t*r);this.userCode=`
      const ivec2 pads = ivec2(`.concat(l,", ").concat(f,`);
      const float avgMultiplier = float(`).concat(h,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(u,`;
            wR += `).concat(o,`) {
          float dyR = float(dyRCorner + wR) / `).concat(a,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `).concat(c,`;
            wC+= `).concat(s,`) {
            float dyC = float(dyCCorner + wC) / `).concat(i,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `)}return n}(),SWe=function(){function n(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,r=e.filterHeight,a=e.filterWidth,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=e.dilationDepth,c=e.dilationHeight,l=e.dilationWidth,f=e.effectiveFilterDepth,h=e.effectiveFilterHeight,d=e.effectiveFilterWidth,p=f-1-e.padInfo.front,v=h-1-e.padInfo.top,m=d-1-e.padInfo.left,g=1/(t*r*a);this.userCode=`
      const ivec3 pads = ivec3(`.concat(p,", ").concat(v,", ").concat(m,`);
      const float avgMultiplier = float(`).concat(g,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `).concat(f,`;
            wD += `).concat(u,`) {
          float dyD = float(dyDCorner + wD) / `).concat(i,`.0;

          if (dyD < 0.0 || dyD >= `).concat(e.outDepth,`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `).concat(h,`;
              wR += `).concat(c,`) {
            float dyR = float(dyRCorner + wR) / `).concat(o,`.0;

            if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `).concat(d,`;
                wC += `).concat(l,`) {
              float dyC = float(dyCCorner + wC) / `).concat(s,`.0;

              if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}();function NWe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.input,o=i,s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,f=[1,1,1],h=k.backend_util.computePool3DInfo(o.shape,s,u,f,c,l),d=new SWe(h);return t.runWebGLProgram(d,[a],o.dtype)}var TWe={kernelName:k.AvgPool3DGrad,backendName:"webgl",kernelFunc:NWe};function EWe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.input,o=i;Hc([a,i],"avgPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=k.backend_util.computePool2DInfo(o.shape,s,u,1,c),f=new kWe(l);return t.runWebGLProgram(f,[a],o.dtype)}var IWe={kernelName:k.AvgPoolGrad,backendName:"webgl",kernelFunc:EWe};function CWe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.a,i=e.b,o=r.transposeA,s=r.transposeB;return sm({a,b:i,transposeA:o,transposeB:s,backend:t})}var AWe={kernelName:k.BatchMatMul,backendName:"webgl",kernelFunc:CWe};var DWe=function(){function n(e,t,r,a,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],k.backend_util.assertAndGetBroadcastShape(e,t),k.backend_util.assertAndGetBroadcastShape(e,r);var s="0.0";a!=null&&(k.backend_util.assertAndGetBroadcastShape(e,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";i!=null&&(k.backend_util.assertAndGetBroadcastShape(e,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `.concat(s,`;
        float scale = `).concat(u,`;
        float inv = scale * inversesqrt(variance + float(`).concat(o,`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `)}return n}();var _We=function(){function n(e,t,r,a,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],k.backend_util.assertAndGetBroadcastShape(e,t),k.backend_util.assertAndGetBroadcastShape(e,r);var s="vec4(0.0)";a!=null&&(k.backend_util.assertAndGetBroadcastShape(e,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";i!=null&&(k.backend_util.assertAndGetBroadcastShape(e,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = `.concat(s,`;
        vec4 scale = `).concat(u,`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`).concat(o,`));

        setOutput((x - mean) * inv + offset);
      }
    `)}return n}();var FWe=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.mean,o=e.variance,s=e.offset,u=e.scale;k.util.assert(i.shape.length===o.shape.length,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),k.util.assert(s==null||i.shape.length===s.shape.length,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),k.util.assert(u==null||i.shape.length===u.shape.length,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var c=r.varianceEpsilon;c==null&&(c=.001);var l=[a,i,o],f=null;s!=null&&(f=s.shape,l.push(s));var h=null;u!=null&&(h=u.shape,l.push(u));var d=k.env().getBool("WEBGL_PACK_NORMALIZATION")?new _We(a.shape,i.shape,o.shape,f,h,c):new DWe(a.shape,i.shape,o.shape,f,h,c),p=t.runWebGLProgram(d,l,l[0].dtype);return p},RWe={kernelName:k.FusedBatchNorm,backendName:"webgl",kernelFunc:FWe};var OWe=function(){function n(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t=Wt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var r=PWe(this.rank),a,i=e.map(function(o,s){return"sourceLoc.".concat(Ax[s]," = start[").concat(s,"] + coords.").concat(Ax[s],";")});a=`
        `.concat(t,` sourceLoc;
        `).concat(t,` coords = getOutputCoords();
        `).concat(i.join(`
`),`
      `),this.userCode=`
      void main() {
        `.concat(a,`
        setOutput(getSource(`).concat(r,`));
      }
    `)}return n}(),Ax=["x","y","z","w","u","v"];function PWe(n){if(n===1)return"sourceLoc";if(n<=6)return Ax.slice(0,n).map(function(e){return"sourceLoc."+e}).join(",");throw Error("Slicing for rank ".concat(n," is not yet supported"))}var MWe=function(){function n(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var t=Wt(this.rank),r=br("coords",this.rank),a=br("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s=`
      result.x = `.concat(o,`;
      if (++`).concat(r[this.rank-1]," < ").concat(e[this.rank-1],`) {
        ++`).concat(a[this.rank-1],`;
        result.y = `).concat(o,`;
        --`).concat(a[this.rank-1],`;
      }
    `),u=this.rank===1?"":`
      --`.concat(r[this.rank-1],`;
      if (++`).concat(r[this.rank-2]," < ").concat(e[this.rank-2],`) {
        ++`).concat(a[this.rank-2],`;
        result.z = `).concat(o,`;
        if (++`).concat(r[this.rank-1]," < ").concat(e[this.rank-1],`) {
          ++`).concat(a[this.rank-1],`;
          result.w = `).concat(o,`;
        }
      }
    `),c=this.rank<=4?`sourceLoc = coords +
            `.concat(t,"(").concat(e.map(function(l,f){return"start[".concat(f,"]")}).join(),");"):e.map(function(l,f){return"".concat(a[f]," = ").concat(r[f]," + start[").concat(f,"];")}).join(`
`);this.userCode=`
      void main() {
        `.concat(t,` coords = getOutputCoords();
        `).concat(t,` sourceLoc;
        `).concat(c,`
        vec4 result = vec4(0.);
        `).concat(s,`
        `).concat(u,`
        setOutput(result);
      }
    `)}return n}();function BWe(n,e,t,r){var a=r.texData.get(n.dataId),i=r.makeTensorInfo(t,n.dtype),o=r.texData.get(i.dataId);Object.assign(o,a),o.refCount=1,o.shape=t,o.dtype=n.dtype;var s=k.slice_util.computeFlatOffset(e,k.util.computeStrides(n.shape));a.slice&&(s+=a.slice.flatOffset),o.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||n.dataId};var u=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,u+1),i}function Jc(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.begin,o=r.size,s=Te(k.slice_util.parseSliceParams(a,i,o),2),u=s[0],c=s[1];if(k.slice_util.assertParamsValid(a,u,c),k.util.sizeFromShape(c)===0)return t.makeTensorInfo(c,a.dtype,[]);if(t.shouldExecuteOnCPU([a])||a.dtype==="string"){var l=t.texData.get(a.dataId),f=C$e(l.values,u,c,a.shape,a.dtype);return t.makeTensorInfo(c,a.dtype,f)}var h=t.texData.get(a.dataId).isPacked,d=k.slice_util.isSliceContinous(a.shape,u,c);if(h||!d){var p=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new MWe(c):new OWe(c),v=[u];return t.runWebGLProgram(p,[a],a.dtype,v)}return t.uploadToGPU(a.dataId),BWe(a,u,c,t)}var LWe={kernelName:k.Slice,backendName:"webgl",kernelFunc:Jc};var zWe=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.blockShape,o=r.crops;k.util.assert(a.shape.length<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var s=i.reduce(function(y,b){return y*b}),u=k.backend_util.getReshaped(a.shape,i,s),c=k.backend_util.getPermuted(u.length,i.length),l=k.backend_util.getReshapedPermuted(a.shape,i,s),f=k.backend_util.getSliceBeginCoords(o,i.length),h=k.backend_util.getSliceSize(l,o,i.length),d=[],p=Pe({inputs:{x:a},backend:t,attrs:{shape:u}}),v=wr({inputs:{x:p},backend:t,attrs:{perm:c}}),m=Pe({inputs:{x:v},backend:t,attrs:{shape:l}}),g=Jc({inputs:{x:m},backend:t,attrs:{begin:f,size:h}});return d.push(p),d.push(v),d.push(m),d.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),g},$We={kernelName:k.BatchToSpaceND,backendName:"webgl",kernelFunc:zWe};function qWe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.weights,o=r.size,s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=vq(s,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,c)}var WWe={kernelName:k.Bincount,backendName:"webgl",kernelFunc:qWe};function VWe(n){var e=n.inputs,t=n.backend,r=e.s0,a=e.s1,i=t.readSync(r.dataId),o=t.readSync(a.dataId),s=k.backend_util.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return t.makeTensorInfo([s.length],"int32",Int32Array.from(s))}var GWe={kernelName:k.BroadcastArgs,backendName:"webgl",kernelFunc:VWe};var UWe="return float(a != b);",Dq=or({opSnippet:UWe,cpuKernelImpl:b$e,dtype:"bool"}),HWe={kernelName:k.NotEqual,backendName:"webgl",kernelFunc:Dq};function kh(n){var e=n.inputs,t=n.backend,r=e.input,a=t.texData.get(r.dataId);return aa({inputs:{x:a.complexTensorInfos.real},backend:t})}var KWe={kernelName:k.Real,backendName:"webgl",kernelFunc:kh};var jWe="return float(int(x));";function XWe(n,e){var t=new Mi(n.shape,jWe),r=e.runWebGLProgram(t,[n],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}function Dx(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.dtype;if(i==="complex64"){if(a.dtype==="complex64")return aa({inputs:{x:a},backend:t});var o=LBe.zeros(a.shape),s=Dx({inputs:{x:a},backend:t,attrs:{dtype:"float32"}}),u=ns({inputs:{real:s,imag:o},backend:t});return o.dispose(),t.disposeIntermediateTensorInfo(s),u}if(a.dtype==="complex64"){var c=kh({inputs:{input:a},backend:t}),u=Dx({inputs:{x:c},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(c),u}if(!k.util.hasEncodingLoss(a.dtype,i)){var u=aa({inputs:{x:a},backend:t});return{dataId:u.dataId,shape:u.shape,dtype:i}}if(t.shouldExecuteOnCPU([a])){var l=t.texData.get(a.dataId).values,f=Te(Qze(l,a.shape,a.dtype,i),3),h=f[0],d=f[1],p=f[2];return t.makeTensorInfo(h,d,p)}if(i==="int32")return XWe(a,t);if(i==="bool"){var v=t.makeTensorInfo([],"bool",k.util.getTypedArrayFromDType("bool",1)),m={a,b:v},u=Dq({inputs:m,backend:t});return t.disposeIntermediateTensorInfo(v),u}throw new Error("Error in Cast: failed to cast ".concat(a.dtype," to ").concat(i))}var YWe={kernelName:k.Cast,backendName:"webgl",kernelFunc:Dx};var s$="return ceil(x);",ZWe=Nt({opSnippet:s$,packedOpSnippet:s$,cpuKernelImpl:e$e}),JWe={kernelName:k.Ceil,backendName:"webgl",kernelFunc:ZWe};var QWe=function(){function n(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return n}();var eVe=function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return n}();function tVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.clipValueMin,o=r.clipValueMax,s;k.env().getBool("WEBGL_PACK_CLIP")?s=new eVe(a.shape):s=new QWe(a.shape);var u=[[i],[o]];return t.runWebGLProgram(s,[a],a.dtype,u)}var nVe={kernelName:k.ClipByValue,backendName:"webgl",kernelFunc:tVe};var rVe=function(){function n(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}return n}();function u$(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function aVe(n){var e=n.inputs,t=n.backend,r=e.x,a=t.texData.get(r.dataId),i=new rVe(r.shape),o=[u$(r,a.complexTensorInfos.real),u$(r,a.complexTensorInfos.imag)];return t.runWebGLProgram(i,o,o[0].dtype)}var iVe={kernelName:k.ComplexAbs,backendName:"webgl",kernelFunc:aVe};var oVe=function(){function n(e){this.outputShape=[],this.outputShape=k.backend_util.computeOutShape(e,1),this.variableNames=e.map(function(u,c){return"T".concat(c)});var t=new Array(e.length-1);t[0]=e[0][1];for(var r=1;r<t.length;r++)t[r]=t[r-1]+e[r][1];for(var a=["if (yC < ".concat(t[0],") setOutput(getT0(yR, yC));")],r=1;r<t.length;r++){var i=t[r-1];a.push("else if (yC < ".concat(t[r],") ")+"setOutput(getT".concat(r,"(yR, yC-").concat(i,"));"))}var o=t.length,s=t[t.length-1];a.push("else setOutput(getT".concat(o,"(yR, yC-").concat(s,"));")),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `.concat(a.join(`
        `),`
      }
    `)}return n}();var sVe=function(){function n(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=k.backend_util.computeOutShape(e,t);var r=this.outputShape,a=r.length,i=Wt(a),o=br("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=e.map(function(g,y){return"T".concat(y)});var u=new Array(e.length-1);u[0]=e[0][t];for(var c=1;c<u.length;c++)u[c]=u[c-1]+e[c][t];for(var l=s[t],f=s.slice(-2),h=s.join(),d="if (".concat(l," < ").concat(u[0],`) {
        return getChannel(
            getT0(`).concat(h,"), vec2(").concat(f.join(),`));
        }`),c=1;c<u.length;c++){var p=u[c-1];d+=`
        if (`.concat(l," < ").concat(u[c],"  && ").concat(l," >= ").concat(u[c-1],`) {
          return getChannel(
            getT`).concat(c,"(").concat(em(s,l,p),`),
            vec2(`).concat(em(f,l,p),`));
        }`)}var v=u.length,m=u[u.length-1];d+=`
        return getChannel(
          getT`.concat(v,"(").concat(em(s,l,m),`),
          vec2(`).concat(em(f,l,m),"));"),this.userCode=`
      float getValue(`.concat(s.map(function(g){return"int "+g}),`) {
        `).concat(d,`
      }

      void main() {
        `).concat(i,` coords = getOutputCoords();
        vec4 result = vec4(getValue(`).concat(o,`), 0., 0., 0.);

        `).concat(o[a-1]," = ").concat(o[a-1],` + 1;
        if (`).concat(o[a-1]," < ").concat(r[a-1],`) {
          result.g = getValue(`).concat(o,`);
        }

        `).concat(o[a-2]," = ").concat(o[a-2],` + 1;
        if (`).concat(o[a-2]," < ").concat(r[a-2],`) {
          result.a = getValue(`).concat(o,`);
        }

        `).concat(o[a-1]," = ").concat(o[a-1],` - 1;
        if (`).concat(o[a-2]," < ").concat(r[a-2],` &&
            `).concat(o[a-1]," < ").concat(r[a-1],`) {
          result.b = getValue(`).concat(o,`);
        }
        setOutput(result);
      }
    `)}return n}();function em(n,e,t){var r=n.indexOf(e),a=n.map(function(i,o){return o===r?"".concat(i," - ").concat(t):i});return a.join()}function dm(n){var e=n.inputs,t=n.backend,r=e.input,a=t.texData.get(r.dataId);return aa({inputs:{x:a.complexTensorInfos.imag},backend:t})}var uVe={kernelName:k.Imag,backendName:"webgl",kernelFunc:dm};function hh(n,e,t){var r,a,i=n[0].dtype;if(i==="complex64"){var o=n.map(function(V){return kh({inputs:{input:V},backend:t})}),s=n.map(function(V){return dm({inputs:{input:V},backend:t})}),u=hh(o,e,t),c=hh(s,e,t),l=ns({inputs:{real:u,imag:c},backend:t});return o.forEach(function(V){return t.disposeIntermediateTensorInfo(V)}),s.forEach(function(V){return t.disposeIntermediateTensorInfo(V)}),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(c),l}var f=t.shouldExecuteOnCPU(n);if(i==="string"&&(f=!0),f){var h=n.map(function(V){var j=k.util.sizeFromShape(V.shape.slice(e)),re=[-1,j];return Pe({inputs:{x:V},backend:t,attrs:{shape:re}})}),d=h.map(function(V){return{vals:t.readSync(V.dataId),shape:V.shape}}),p=k.backend_util.computeOutShape(h.map(function(V){return V.shape}),1),v=h[0].shape[0]===1,m=t$e(d,p,i,v),g=k.backend_util.computeOutShape(n.map(function(V){return V.shape}),e),y=t.makeTensorInfo(g,i,m);return h.forEach(function(V){return t.disposeIntermediateTensorInfo(V)}),y}var b=n.filter(function(V){return k.util.sizeFromShape(V.shape)>0}),w=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&b[0].shape.length>1;if(b.length===1){var x=w?new Mi(n[0].shape,Qo):new es(n[0].shape,Qo);return t.runWebGLProgram(x,n,i)}var N=k.env().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(b.length>N){for(var T=[],E=0;E<b.length;E+=N){var C=b.slice(E,E+N);T.push(hh(C,e,t))}var F=hh(T,e,t);try{for(var _=ra(T),O=_.next();!O.done;O=_.next()){var E=O.value;t.disposeIntermediateTensorInfo(E)}}catch(V){r={error:V}}finally{try{O&&!O.done&&(a=_.return)&&a.call(_)}finally{if(r)throw r.error}}return F}if(w){var L=new sVe(b.map(function(V){return V.shape}),e);return t.runWebGLProgram(L,b,i)}var z=cVe(b,e,t),$=z.tensors2D,B=z.outShape,W=new oVe($.map(function(V){return V.shape})),X=t.runWebGLProgram(W,$,i);$.forEach(function(V){return t.disposeIntermediateTensorInfo(V)});var Z=Pe({inputs:{x:X},attrs:{shape:B},backend:t});return t.disposeIntermediateTensorInfo(X),Z}function cVe(n,e,t){var r=k.backend_util.computeOutShape(n.map(function(i){return i.shape}),e),a=n.map(function(i){return Pe({inputs:{x:i},attrs:{shape:[-1,k.util.sizeFromShape(i.shape.slice(e))]},backend:t})});return{tensors2D:a,outShape:r}}function _q(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.axis,i=k.util.parseAxisParam(a,e[0].shape)[0],o=e.map(function(c){return c.shape});k.backend_util.assertParamsConsistent(o,i);var s=k.backend_util.computeOutShape(e.map(function(c){return c.shape}),i);if(k.util.sizeFromShape(s)===0)return t.makeTensorInfo(s,e[0].dtype,[]);var u=e.filter(function(c){return k.util.sizeFromShape(c.shape)>0});return u.length===1?aa({inputs:{x:u[0]},backend:t}):hh(u,i,t)}var lVe={kernelName:k.Concat,backendName:"webgl",kernelFunc:_q};var Fq=function(){function n(e,t,r,a,i){t===void 0&&(t=!1),r===void 0&&(r=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,f=e.dilationWidth,h=e.filterHeight,d=e.filterWidth,p=Math.floor(e.inChannels/4)*4,v=e.inChannels%4,m=e.dataFormat==="channelsLast",g=m?1:2,y=m?2:3,b=m?3:1,w="",x="";r&&(a?w=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `.concat(r,`
        }`):i?w=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          `.concat(r,`
        }`):w=`
          float activation(float x) {
            `.concat(r,`
          }
        `),x="result = activation(result);");var N=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `.concat(w,`

      const ivec2 strides = ivec2(`).concat(u,", ").concat(c,`);
      const ivec2 pads = ivec2(`).concat(o,", ").concat(s,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`).concat(b,`];

        ivec2 xRCCorner =
            ivec2(coords[`).concat(g,"], coords[").concat(y,`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(h,`; wR++) {
          int xR = xRCorner + wR * `).concat(l,`;

          if (xR < 0 || xR >= `).concat(e.inHeight,`) {
            continue;
          }

          for (int wC = 0; wC < `).concat(d,`; wC++) {
            int xC = xCCorner + wC * `).concat(f,`;

            if (xC < 0 || xC >= `).concat(e.inWidth,`) {
              continue;
            }

            for (int d1 = 0; d1 < `).concat(p,`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`).concat(m,`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`).concat(v===1,`) {

              if (`).concat(m,`) {
                dotProd +=
                    getX(batch, xR, xC, `).concat(p,`) *
                    getW(wR, wC, `).concat(p,`, d2);
              } else {
                dotProd +=
                    getX(batch, `).concat(p,`, xR, xC) *
                    getW(wR, wC, `).concat(p,`, d2);
              }

            } else if (`).concat(v===2,`) {
              vec2 wValues = vec2(
                getW(wR, wC, `).concat(p,`, d2),
                getW(wR, wC, `).concat(p,` + 1, d2)
              );

              if (`).concat(m,`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `).concat(p,`),
                  getX(batch, xR, xC, `).concat(p,` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `).concat(p,`, xR, xC),
                  getX(batch, `).concat(p,` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`).concat(v===3,`) {
              vec3 wValues = vec3(
                getW(wR, wC, `).concat(p,`, d2),
                getW(wR, wC, `).concat(p,` + 1, d2),
                getW(wR, wC, `).concat(p,` + 2, d2)
              );

              if (`).concat(m,`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `).concat(p,`),
                  getX(batch, xR, xC, `).concat(p,` + 1),
                  getX(batch, xR, xC, `).concat(p,` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `).concat(p,`, xR, xC),
                  getX(batch, `).concat(p,` + 1, xR, xC),
                  getX(batch, `).concat(p,` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `).concat(N,`
        `).concat(x,`
        setOutput(result);
      }
    `)}return n}(),fVe=function(){function n(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,r=e.padInfo.top,a=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=e.dilationDepth,c=e.dilationHeight,l=e.dilationWidth,f=e.filterDepth,h=e.filterHeight,d=e.filterWidth,p=Math.floor(e.inChannels/4)*4,v=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`.concat(i,", ").concat(o,", ").concat(s,`);
      const ivec3 pads = ivec3(`).concat(t,", ").concat(r,", ").concat(a,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `).concat(f,`; wF++) {
          int xF = xFCorner + wF * `).concat(u,`;

          if (xF < 0 || xF >= `).concat(e.inDepth,`) {
            continue;
          }

          for (int wR = 0; wR < `).concat(h,`; wR++) {
            int xR = xRCorner + wR * `).concat(c,`;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int wC = 0; wC < `).concat(d,`; wC++) {
              int xC = xCCorner + wC * `).concat(l,`;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              for (int d1 = 0; d1 < `).concat(p,`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`).concat(v===1,`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `).concat(p,`) *
                  getW(wF, wR, wC, `).concat(p,`, d2);
              } else if (`).concat(v===2,`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `).concat(p,`),
                  getX(batch, xF, xR, xC, `).concat(p,` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `).concat(p,`, d2),
                  getW(wF, wR, wC, `).concat(p,` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`).concat(v===3,`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `).concat(p,`),
                  getX(batch, xF, xR, xC, `).concat(p,` + 1),
                  getX(batch, xF, xR, xC, `).concat(p,` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `).concat(p,`, d2),
                  getW(wF, wR, wC, `).concat(p,` + 1, d2),
                  getW(wF, wR, wC, `).concat(p,` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}();var Rq=function(){function n(e,t,r,a,i){t===void 0&&(t=!1),r===void 0&&(r=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=kr(this.outputShape.length);for(var o=e.padInfo.left,s=e.strideWidth,u=e.dilationWidth,c=e.filterHeight,l=e.filterWidth,f=l,h=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`,d=0;d<l;d++)h+=`
           vec4 xTexelC`.concat(d*2,`;
           int xTexelC`).concat(d*2,`Ready;
           vec4 xTexelC`).concat(d*2+1,`;
           int xTexelC`).concat(d*2+1,`Ready;
           vec4 xC`).concat(d,";");h+=`
     for (int r = 0; r < `.concat(c,`; r++) {
      for (int d1 = 0; d1 < `).concat(e.inChannels,`; d1 += 2) {
       `);for(var d=0;d<l;d++)h+=`
           xTexelC`.concat(d*2,` = vec4(0.0);
           xTexelC`).concat(d*2,`Ready = 0;
           xTexelC`).concat(d*2+1,` = vec4(0.0);
           xTexelC`).concat(d*2+1,`Ready = 0;
           xC`).concat(d," = vec4(0.0);");h+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(var p=0;p<(f+1)/2;p++){var v=p*2;if(h+=`
           xC = xCCorner + `.concat(v*u,`;
           `),s===1){if(v<l&&(o%2===1?(h+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                   xTexelC`).concat(v,` = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`).concat(v,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(v,`Ready = 1;
                 }
               `),u===1&&v>0?h+=`
                 xC`.concat(v," = vec4(xTexelC").concat(v-2,".zw, xTexelC").concat(v,`.xy);
                 `):h+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC`.concat(v," = vec4(previous.zw, xTexelC").concat(v,`.xy);
                   } else {
                     xC`).concat(v," = vec4(0.0, 0.0, xTexelC").concat(v,`.xy);
                   }
                   `)):h+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                   xTexelC`).concat(v,` = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC`).concat(v,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(v,`Ready = 1;
                 }

                 xC`).concat(v," = xTexelC").concat(v,`;
                 `),v+1<l)){var m=o%2===0?k.util.nearestLargerEven(u):u;u%2===0&&o%2===1||u%2!==0&&o%2!==1?(h+=`
                   xCOffset = xC + imod(pads[1], 2) + `.concat(m,`;

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                     xTexelC`).concat(v+1,` = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC`).concat(v+1,`.zw = vec2(0.0);
                     }
                     xTexelC`).concat(v+1,`Ready = 1;
                   }
                   `),u>1?h+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC`.concat(v+1," = vec4(previous.zw, xTexelC").concat(v+1,`.xy);
                     } else {
                      xC`).concat(v+1," = vec4(0.0, 0.0, xTexelC").concat(v+1,`.xy);
                     }
                     `):h+=`
                     xC`.concat(v+1," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,`.xy);
                     `)):m===1?h+=`
                     xC`.concat(v+1," = xTexelC").concat(v,`;
                     `):h+=`
                     xCOffset = xC + `.concat(m,`;

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                       xTexelC`).concat(v+1,` = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC`).concat(v+1,`.zw = vec2(0.0);
                       }
                       xTexelC`).concat(v+1,`Ready = 1;
                     }

                     xC`).concat(v+1," = xTexelC").concat(v+1,`;
                     `)}}else v<l&&(o%2===1?(h+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                   xTexelC`).concat(v,` = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`).concat(v,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(v,`Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                   xTexelC`).concat(v+1,` = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC`).concat(v+1,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(v+1,`Ready = 1;
                 }

                 xC`).concat(v," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,`.zw);
               `),v+1<l&&(h+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC`.concat(v+1," = vec4(xTexelC").concat(v+1,`.xy, final.xy);
                 `))):(h+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                   xTexelC`).concat(v,` = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC`).concat(v,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(v,`Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                   xTexelC`).concat(v+1,` = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`).concat(v+1,`.zw = vec2(0.);
                   }
                   xTexelC`).concat(v+1,`Ready = 1;
                 }

                 xC`).concat(v,` = vec4(
                   xTexelC`).concat(v,".xy, xTexelC").concat(v+1,`.xy);
               `),v+1<l&&(h+=`
                   xC`.concat(v+1," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,`.zw);
                 `))));v<l&&(h+=`
             wTexel = getW(r, `.concat(v,`, d1, d2);
             dotProd += xC`).concat(v,`.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < `).concat(e.inChannels,`) {
               dotProd += xC`).concat(v,`.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `),v+1<l&&(h+=`
               wTexel = getW(r, `.concat(v+1,`, d1, d2);
               dotProd += xC`).concat(v+1,`.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < `).concat(e.inChannels,`) {
                 dotProd += xC`).concat(v+1,`.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `)))}h+=`
     }
   `,h+=`
     }
   `,h+=`
     }
   `;var g="",y="";r&&(a?g=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           `.concat(r,`
         }`):i?g=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           `.concat(r,`
         }`):g=`vec4 activation(vec4 x) {
           `.concat(r,`
         }`),y="result = activation(result);");var b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       `.concat(g,`

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         `).concat(h,`

         vec4 result = dotProd - vec4(0.000000000000001);
         `).concat(b,`
         `).concat(y,`
         setOutput(result);
       }
     `)}return n}();var hVe=function(){function n(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length);for(var r=t.dataFormat,a=xr(),i=r==="channelsLast",o=i?1:2,s=i?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < ".concat(e[2]," && pos < ").concat(e[1],") {"),c="",l=0;l<=1;l++)for(var f=0;f<=1;f++)c+=`
          blockIndex = rc.z + `.concat(f,`;
          pos = rc.y + `).concat(l,`;

          `).concat(u,`
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[`).concat(o,`] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[`).concat(s,`] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (`).concat(i,`) {
                  innerDims = vec2(d1, ch);
                  result[`).concat(l*2+f,`] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`).concat(l*2+f,`] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `);this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `.concat(c,`

        `).concat(a.output,` = result;
      }
    `)}return n}();function um(n,e){var t=n.length;return t>=3?e?dn(dn([],Te(n.slice(0,-3)),!1),[n[t-3]*n[t-2],n[t-1]],!1):dn(dn([],Te(n.slice(0,-3)),!1),[n[t-3],n[t-2]*n[t-1]],!1):!e&&t===1&&n[0]>1?[n[0],1]:null}function Oq(n){var e,t,r=n.x,a=n.filter,i=n.convInfo,o=n.backend,s=n.bias,u=s===void 0?null:s,c=n.preluActivationWeights,l=c===void 0?null:c,f=n.leakyreluAlpha,h=f===void 0?0:f,d=n.activation,p=d===void 0?null:d,v=r.shape,m=o.texData.get(r.dataId),g=i.inChannels,y=v[0]*v[1]*v[2],b=i.outChannels,w=i.dataFormat==="channelsLast",x=!1,N=!1,T,E=[];if(l!=null){var C=um(l.shape,w);C!=null&&(l=Pe({inputs:{x:l},backend:o,attrs:{shape:C}}),E.push(l))}if(u!=null){var C=um(u.shape,w);C!=null&&(u=Pe({inputs:{x:u},backend:o,attrs:{shape:C}}),E.push(u))}var F=(y===1||b===1)&&g>Eq,_=!F&&m.isPacked&&w&&m.texture!=null&&v[2]%2!==0&&k.util.arraysEqual(m.shape.slice(-3),v.slice(-3));if(_){var C=v[0]*v[1]*(v[2]+1),O={dataId:r.dataId,shape:[1,C,i.inChannels],dtype:r.dtype},L=m.shape;m.shape=m.shape.slice(),m.shape[m.shape.length-2]++,k.util.assert(ph(m.shape,O.shape),function(){return"packed reshape ".concat(m.shape," to ").concat(O.shape," isn't free")});var z=Pe({inputs:{x:a},backend:o,attrs:{shape:[1,i.inChannels,i.outChannels]}});E.push(z);var $=sm({a:O,b:z,backend:o,transposeA:x,transposeB:N,bias:u,activation:p,preluActivationWeights:l,leakyreluAlpha:h}),B=o.texData.get($.dataId);k.util.assert(B.isPacked,function(){return"batchMatMul result is expected to be packed"}),m.shape=L,B.shape=i.outShape,T=aa({inputs:{x:$},backend:o}),T.shape=i.outShape,E.push($)}else{var W=i.outHeight*i.outWidth,X=Pe({inputs:{x:r},backend:o,attrs:{shape:w?[i.batchSize,W,i.inChannels]:[i.batchSize,i.inChannels,W]}}),z=Pe({inputs:{x:a},backend:o,attrs:{shape:[1,i.inChannels,i.outChannels]}}),Z=sm({a:w?X:z,b:w?z:X,transposeA:!w,transposeB:N,backend:o,bias:u,activation:p,preluActivationWeights:l,leakyreluAlpha:h});T=Pe({inputs:{x:Z},backend:o,attrs:{shape:i.outShape}}),E.push(X),E.push(z),E.push(Z)}try{for(var V=ra(E),j=V.next();!j.done;j=V.next()){var re=j.value;o.disposeIntermediateTensorInfo(re)}}catch(ne){e={error:ne}}finally{try{j&&!j.done&&(t=V.return)&&t.call(V)}finally{if(e)throw e.error}}return T}function Pq(n){var e,t,r=n.x,a=n.filter,i=n.convInfo,o=n.backend,s=n.bias,u=s===void 0?null:s,c=n.preluActivationWeights,l=c===void 0?null:c,f=n.leakyreluAlpha,h=f===void 0?0:f,d=n.activation,p=d===void 0?null:d,v=i.filterWidth,m=i.filterHeight,g=i.inChannels,y=i.outWidth,b=i.outHeight,w=i.dataFormat,x=w==="channelsLast",N=v*m*g,T=b*y,E=[i.batchSize,N,T],C=!0,F=!1,_=[];if(l!=null){var O=um(l.shape,x);O!=null&&(l=Pe({inputs:{x:l},backend:o,attrs:{shape:O}}),_.push(l))}if(u!=null){var O=um(u.shape,x);O!=null&&(u=Pe({inputs:{x:u},backend:o,attrs:{shape:O}}),_.push(u))}var L=Pe({inputs:{x:a},backend:o,attrs:{shape:[1,N,k.util.sizeFromShape(a.shape)/N]}});_.push(L);var z=new hVe(E,i),$=[r.shape,[i.padInfo.top,i.padInfo.left],[i.strideHeight,i.strideWidth],[i.dilationHeight,i.dilationWidth],[i.inChannels],[i.filterWidth*i.inChannels],[i.outWidth]],B=o.runWebGLProgram(z,[r],"float32",$),W=Pe({inputs:{x:B},backend:o,attrs:{shape:E}});_.push(B),_.push(W);var X=u!=null,Z=l!=null,V=p==="leakyrelu",j=p?vh(p,!0):null,re=new Tq(x?W.shape:L.shape,x?L.shape:W.shape,x?[i.batchSize,T,i.outChannels]:[i.batchSize,i.outChannels,T],C,F,X,j,Z,V),ne=x?[W,L]:[L,W];if(u&&ne.push(u),Z&&ne.push(l),V){var oe=o.makeTensorInfo([],"float32",k.util.createScalarValue(h,"float32"));ne.push(oe),_.push(oe)}var le=o.runWebGLProgram(re,ne,"float32"),pe=Pe({inputs:{x:le},backend:o,attrs:{shape:i.outShape}});_.push(le);try{for(var xe=ra(_),he=xe.next();!he.done;he=xe.next()){var ye=he.value;o.disposeIntermediateTensorInfo(ye)}}catch(we){e={error:we}}finally{try{he&&!he.done&&(t=xe.return)&&t.call(xe)}finally{if(e)throw e.error}}return pe}function dVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dilations,l=r.dimRoundingMode,f=k.backend_util.convertConv2DDataFormat(u),h=k.backend_util.computeConv2DInfo(a.shape,i.shape,o,c,s,l,!1,f),d;if(h.filterHeight===1&&h.filterWidth===1&&h.dilationHeight===1&&h.dilationWidth===1&&h.strideHeight===1&&h.strideWidth===1&&(h.padInfo.type==="SAME"||h.padInfo.type==="VALID"))d=Oq({x:a,filter:i,convInfo:h,backend:t});else if(h.strideWidth<=2&&f==="channelsLast"&&k.env().getBool("WEBGL_EXP_CONV")){var p=new Rq(h),v=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];d=t.runWebGLProgram(p,[a,i],"float32",v)}else if(k.env().getBool("WEBGL_CONV_IM2COL"))d=Pq({x:a,filter:i,convInfo:h,backend:t});else{var p=new Fq(h);d=t.runWebGLProgram(p,[a,i],"float32")}var m=Pe({inputs:{x:d},backend:t,attrs:{shape:h.outShape}});return t.disposeIntermediateTensorInfo(d),m}var pVe={kernelName:k.Conv2D,backendName:"webgl",kernelFunc:dVe};var vVe=function(){function n(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,r=e.strideWidth,a=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `.concat(e.batchSize,`; b++) {
          for (int yR = 0; yR < `).concat(e.outHeight,`; yR++) {
            int xR = wR + yR * `).concat(t," - ").concat(a,`;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int yC = 0; yC < `).concat(e.outWidth,`; yC++) {
              int xC = wC + yC * `).concat(r," - ").concat(i,`;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              if (`).concat(o,`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}(),mVe=function(){function n(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,r=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",s=t-1-e.padInfo.top,u=r-1-e.padInfo.left,c=o?1:2,l=o?2:3,f=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(`.concat(s,", ").concat(u,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`).concat(f,`];

        ivec2 dyCorner = ivec2(coords[`).concat(c,"], coords[").concat(l,`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(t,`; wR++) {
          float dyR = float(dyRCorner + wR) / `).concat(a,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `).concat(t,` - 1 - wR;

          for (int wC = 0; wC < `).concat(r,`; wC++) {
            float dyC = float(dyCCorner + wC) / `).concat(i,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `).concat(r,` - 1 - wC;

            for (int d2 = 0; d2 < `).concat(e.outChannels,`; d2++) {

              if (`).concat(o,`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}(),gVe=function(){function n(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,r=e.strideHeight,a=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,s=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `.concat(e.batchSize,`; b++) {
          for (int yF = 0; yF < `).concat(e.outDepth,`; yF++) {
            int xF = wF + yF * `).concat(t," - ").concat(i,`;

            if (xF < 0 || xF >= `).concat(e.inDepth,`) {
              continue;
            }

            for (int yR = 0; yR < `).concat(e.outHeight,`; yR++) {
              int xR = wR + yR * `).concat(r," - ").concat(o,`;

              if (xR < 0 || xR >= `).concat(e.inHeight,`) {
                continue;
              }

              for (int yC = 0; yC < `).concat(e.outWidth,`; yC++) {
                int xC = wC + yC * `).concat(a," - ").concat(s,`;

                if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}(),yVe=function(){function n(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,r=e.filterHeight,a=e.filterWidth,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=t-1-e.padInfo.front,c=r-1-e.padInfo.top,l=a-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`.concat(u,", ").concat(c,", ").concat(l,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `).concat(t,`; wF++) {
          float dyF = float(dyFCorner + wF) / `).concat(i,`.0;

          if (dyF < 0.0 || dyF >= `).concat(e.outDepth,`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `).concat(t,` - 1 - wF;

          for (int wR = 0; wR < `).concat(r,`; wR++) {
            float dyR = float(dyRCorner + wR) / `).concat(o,`.0;

            if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `).concat(r,` - 1 - wR;

            for (int wC = 0; wC < `).concat(a,`; wC++) {
              float dyC = float(dyCCorner + wC) / `).concat(s,`.0;

              if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `).concat(a,` - 1 - wC;

              for (int d2 = 0; d2 < `).concat(e.outChannels,`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}();function bVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape,f=k.backend_util.convertConv2DDataFormat(u),h=k.backend_util.computeConv2DInfo(a.shape,l,o,1,s,c,!1,f),d=new vVe(h);return t.runWebGLProgram(d,[a,i],"float32")}var wVe={kernelName:k.Conv2DBackpropFilter,backendName:"webgl",kernelFunc:bVe};function xVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode,f=k.backend_util.convertConv2DDataFormat(c),h=k.backend_util.computeConv2DInfo(o,i.shape,s,1,u,l,!1,f),d=new mVe(h);return t.runWebGLProgram(d,[a,i],"float32")}var kVe={kernelName:k.Conv2DBackpropInput,backendName:"webgl",kernelFunc:xVe};function SVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=r.strides,s=r.pad,u=r.dilations,c=k.backend_util.computeConv3DInfo(a.shape,i.shape,o,u,s),l=new fVe(c);return t.runWebGLProgram(l,[a,i],"float32")}var NVe={kernelName:k.Conv3D,backendName:"webgl",kernelFunc:SVe};function TVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.dy,o=r.strides,s=r.pad,u=r.filterShape,c=k.backend_util.computeConv3DInfo(a.shape,u,o,1,s),l=new gVe(c);return t.runWebGLProgram(l,[a,i],"float32")}var EVe={kernelName:k.Conv3DBackpropFilterV2,backendName:"webgl",kernelFunc:TVe};function IVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.filter,o=r.pad,s=r.strides,u=r.inputShape,c=k.backend_util.computeConv3DInfo(u,i.shape,s,1,o),l=new yVe(c);return t.runWebGLProgram(l,[a,i],"float32")}var CVe={kernelName:k.Conv3DBackpropInputV2,backendName:"webgl",kernelFunc:IVe};var AVe=Zc+`
  return cos(x);
`,DVe=Nt({opSnippet:AVe}),_Ve={kernelName:k.Cos,backendName:"webgl",kernelFunc:DVe};var FVe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,RVe=Nt({opSnippet:FVe}),OVe={kernelName:k.Cosh,backendName:"webgl",kernelFunc:RVe};var PVe=function(){function n(e,t,r,a,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3],f=Te(t,1),h=f[0],d=Te(r,2),p=d[0],v=d[1];this.outputShape=[h,p,v,l];var m=a==="bilinear"?1:0,g=Te(["".concat(u-1,".0"),"".concat(c-1,".0")],2),y=g[0],b=g[1],w=Te(p>1?["".concat((u-1)/(p-1)),"(y2-y1) * height_ratio","y1*".concat(y," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(y)],3),x=w[0],N=w[1],T=w[2],E=Te(v>1?["".concat((c-1)/(v-1)),"(x2-x1) * width_ratio","x1*".concat(b," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(b)],3),C=E[0],F=E[1],_=E[2];this.userCode=`
      const float height_ratio = float(`.concat(x,`);
      const float width_ratio = float(`).concat(C,`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `).concat(s,`) {
          return;
        }

        float height_scale = `).concat(N,`;
        float width_scale = `).concat(F,`;

        float in_y = `).concat(T,`;
        if( in_y < 0.0 || in_y > `).concat(y,` ) {
          setOutput(float(`).concat(i,`));
          return;
        }
        float in_x = `).concat(_,`;
        if( in_x < 0.0 || in_x > `).concat(b,` ) {
          setOutput(float(`).concat(i,`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`).concat(m,` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `)}return n}();var MVe=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.image,i=e.boxes,o=e.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=new PVe(a.shape,i.shape,s,u,c);return t.runWebGLProgram(l,[a,i,o],"float32")},BVe={kernelName:k.CropAndResize,backendName:"webgl",kernelFunc:MVe},gh;(function(n){n.Prod="*",n.Sum="+"})(gh||(gh={}));var c$=function(){function n(e,t,r,a){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];var i=this.outputShape.length,o=this.op===gh.Prod?"1.0":"0.0",s=r?o:"getX(".concat(l$(i,"coords",this.op),")"),u=this.outputShape[this.outputShape.length-1],c="",l="";r?(c=a?"end != ".concat(u-1):"end != 0",l=a?"end + 1":"end - 1"):(c=a?"end + pow2 < ".concat(u):"end >= pow2",l=a?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        `.concat(Wt(i),` coords = getOutputCoords();
        int end = `).concat(f$(i,"coords",this.op),`;
        float val = `).concat(s,`;
        int pow2 = int(pow(2.0, index));
        if (`).concat(c,`) {
          int idx = `).concat(l,`;
          `).concat(f$(i,"coords",this.op),` = idx;
          val `).concat(this.op,"= getX(").concat(l$(i,"coords",this.op),`);
        }
        setOutput(val);
      }
    `)}return n}();function l$(n,e,t){if(n===1)return"".concat(e);if(n===2)return"".concat(e,".x, ").concat(e,".y");if(n===3)return"".concat(e,".x, ").concat(e,".y, ").concat(e,".z");if(n===4)return"".concat(e,".x, ").concat(e,".y, ").concat(e,".z, ").concat(e,".w");throw new Error("Cumulative ".concat(t," for rank ").concat(n," is not yet supported"))}function f$(n,e,t){if(n===1)return"".concat(e);if(n===2)return"".concat(e,".y");if(n===3)return"".concat(e,".z");if(n===4)return"".concat(e,".w");throw new Error("Cumulative ".concat(t," for rank ").concat(n," is not yet supported"))}function Mq(n,e,t,r,a,i){var o=e.shape.length,s=k.backend_util.getAxesPermutation([r],o),u=e;s!=null&&(u=wr({inputs:{x:e},backend:t,attrs:{perm:s}}));var c=k.backend_util.getInnerMostAxes(1,o)[0];if(c!==o-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(e.shape.length-1," ")+"but got axis=".concat(r));for(var l=u.shape[c],f=aa({inputs:{x:u},backend:t}),h=0;h<=Math.ceil(Math.log2(l))-1;h++){var d=new c$(n,u.shape,!1,i),p=[[h]],v=f;f=t.runWebGLProgram(d,[f],f.dtype,p),t.disposeIntermediateTensorInfo(v)}if(a){var d=new c$(n,u.shape,a,i),v=f;f=t.runWebGLProgram(d,[f],f.dtype),t.disposeIntermediateTensorInfo(v)}if(s!=null){var m=k.backend_util.getUndoAxesPermutation(s),g=wr({inputs:{x:f},backend:t,attrs:{perm:m}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(u),g}return f}function LVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.exclusive,s=r.reverse;return Mq(gh.Prod,a,t,i,o,s)}var zVe={kernelName:k.Cumprod,backendName:"webgl",kernelFunc:LVe};function $Ve(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.exclusive,s=r.reverse;return Mq(gh.Sum,a,t,i,o,s)}var qVe={kernelName:k.Cumsum,backendName:"webgl",kernelFunc:$Ve};function WVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.weights,o=r.size,s=r.binaryOutput;if(a.shape.length===1){var u=t.readSync(a.dataId),c=t.readSync(i.dataId),l=vq(u,c,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,l)}else if(a.shape.length===2){var f=t.bufferSync(a),h=t.bufferSync(i),d=Jze(f,h,o,s);return t.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}var VVe={kernelName:k.DenseBincount,backendName:"webgl",kernelFunc:WVe};var GVe=function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `.concat(this.getHeightCoordString(),`;
      int w = `).concat(this.getWidthCoordString(),`;
      int d = `).concat(this.getDepthCoordString(),`;

      int in_h = h / `).concat(t,`;
      int offset_h = imod(h, `).concat(t,`);
      int in_w = w / `).concat(t,`;
      int offset_w = imod(w, `).concat(t,`);
      int offset_d = (offset_h * `).concat(t,` + offset_w) *
        `).concat(this.getOutputDepthSize(),`;
      int in_d = d + offset_d;

      float result = `).concat(this.getInputSamplingString(),`;
      setOutput(result);
    }
  `)}return n.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n}();function UVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.blockSize,o=r.dataFormat,s=a.shape[0],u=o==="NHWC"?a.shape[1]:a.shape[2],c=o==="NHWC"?a.shape[2]:a.shape[3],l=o==="NHWC"?a.shape[3]:a.shape[1],f=u*i,h=c*i,d=l/(i*i),p=o==="NHWC"?[s,f,h,d]:[s,d,f,h],v=new GVe(p,i,o);return t.runWebGLProgram(v,[a],a.dtype)}var HVe={kernelName:k.DepthToSpace,backendName:"webgl",kernelFunc:UVe};var Bq=function(){function n(e,t,r,a,i){t===void 0&&(t=!1),r===void 0&&(r=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=kr(this.outputShape.length);var o=e.filterHeight,s=e.filterWidth,u=e.outChannels/e.inChannels,c="",l="";r&&(a?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `.concat(r,`
        }`):i?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          `.concat(r,`
        }`):c=`
          float activation(float x) {
            `.concat(r,`
          }
        `),l="result = activation(result);");var f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `.concat(c,`

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `).concat(u,`;
        int q = d2 - d1 * `).concat(u,`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `).concat(o,`; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < `).concat(s,`; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `).concat(f,`
        `).concat(l,`
        setOutput(result);
      }
    `)}return n}();var Lq=function(){function n(e,t,r,a,i){t===void 0&&(t=!1),r===void 0&&(r=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=kr(this.outputShape.length);for(var o=e.outChannels/e.inChannels,s=e.padInfo.left,u=e.strideWidth,c=e.dilationWidth,l=e.filterHeight,f=e.filterWidth,h=f,d=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`,p=0;p<f;p++)d+=`
          vec4 xTexelC`.concat(p*2,`;
          int xTexelC`).concat(p*2,`Ready;
          vec4 xTexelC`).concat(p*2+1,`;
          int xTexelC`).concat(p*2+1,`Ready;
          vec4 xC`).concat(p,";");d+=`
    for (int r = 0; r < `.concat(l,`; r++) {
      `);for(var p=0;p<f;p++)d+=`
          xTexelC`.concat(p*2,` = vec4(0.0);
          xTexelC`).concat(p*2,`Ready = 0;
          xTexelC`).concat(p*2+1,` = vec4(0.0);
          xTexelC`).concat(p*2+1,`Ready = 0;
          xC`).concat(p," = vec4(0.0);");d+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(var v=0;v<(h+1)/2;v++){var m=v*2;if(d+=`
          xC = xCCorner + `.concat(m*c,`;
          `),u===1){if(m<f&&(s%2===1?(d+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                  xTexelC`).concat(m,` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`).concat(m,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(m,`Ready = 1;
                }
              `),c===1&&m>0?d+=`
                xC`.concat(m," = vec4(xTexelC").concat(m-2,".zw, xTexelC").concat(m,`.xy);
                `):d+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC`.concat(m," = vec4(previous.zw, xTexelC").concat(m,`.xy);
                  } else {
                    xC`).concat(m," = vec4(0.0, 0.0, xTexelC").concat(m,`.xy);
                  }
                  `)):d+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                  xTexelC`).concat(m,` = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC`).concat(m,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(m,`Ready = 1;
                }

                xC`).concat(m," = xTexelC").concat(m,`;
                `),m+1<f)){var g=s%2===0?k.util.nearestLargerEven(c):c;c%2===0&&s%2===1||c%2!==0&&s%2!==1?(d+=`
                  xCOffset = xC + imod(pads[1], 2) + `.concat(g,`;

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                    xTexelC`).concat(m+1,` = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC`).concat(m+1,`.zw = vec2(0.0);
                    }
                    xTexelC`).concat(m+1,`Ready = 1;
                  }
                  `),c>1?d+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC`.concat(m+1," = vec4(previous.zw, xTexelC").concat(m+1,`.xy);
                    } else {
                     xC`).concat(m+1," = vec4(0.0, 0.0, xTexelC").concat(m+1,`.xy);
                    }
                    `):d+=`
                    xC`.concat(m+1," = vec4(xTexelC").concat(m,".zw, xTexelC").concat(m+1,`.xy);
                    `)):g===1?d+=`
                    xC`.concat(m+1," = xTexelC").concat(m,`;
                    `):d+=`
                    xCOffset = xC + `.concat(g,`;

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                      xTexelC`).concat(m+1,` = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC`).concat(m+1,`.zw = vec2(0.0);
                      }
                      xTexelC`).concat(m+1,`Ready = 1;
                    }

                    xC`).concat(m+1," = xTexelC").concat(m+1,`;
                    `)}}else m<f&&(s%2===1?(d+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                  xTexelC`).concat(m,` = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`).concat(m,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(m,`Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                  xTexelC`).concat(m+1,` = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC`).concat(m+1,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(m+1,`Ready = 1;
                }

                xC`).concat(m," = vec4(xTexelC").concat(m,".zw, xTexelC").concat(m+1,`.zw);
              `),m+1<f&&(d+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC`.concat(m+1," = vec4(xTexelC").concat(m+1,`.xy, final.xy);
                `))):(d+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                  xTexelC`).concat(m,` = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC`).concat(m,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(m,`Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                  xTexelC`).concat(m+1,` = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`).concat(m+1,`.zw = vec2(0.);
                  }
                  xTexelC`).concat(m+1,`Ready = 1;
                }

                xC`).concat(m,` = vec4(
                  xTexelC`).concat(m,".xy, xTexelC").concat(m+1,`.xy);
              `),m+1<f&&(d+=`
                  xC`.concat(m+1," = vec4(xTexelC").concat(m,".zw, xTexelC").concat(m+1,`.zw);
                `))));m<f&&(d+=`
            wTexel = getW(r, `.concat(m,`, d1, q);
            dotProd += xC`).concat(m,` * vec4(wTexel.xz, wTexel.xz);
          `),m+1<f&&(d+=`
              wTexel = getW(r, `.concat(m+1,`, d1, q);
              dotProd += xC`).concat(m+1,` * vec4(wTexel.xz, wTexel.xz);
            `)))}d+=`
    }
  `,d+=`
      }
    `;var y="",b="";r&&(a?y=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `.concat(r,`
        }`):i?y=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          `.concat(r,`
        }`):y=`vec4 activation(vec4 x) {
          `.concat(r,`
        }`),b="result = activation(result);");var w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `.concat(y,`

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `).concat(o,`;
        int q = d2 - d1 * `).concat(o,`;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        `).concat(d,`

        vec4 result = dotProd - vec4(0.000000000000001);
        `).concat(w,`
        `).concat(b,`
        setOutput(result);
      }
    `)}return n}();function KVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode,l=u;l==null&&(l=[1,1]),k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,l),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(l,"'")});var f=k.backend_util.computeConv2DInfo(a.shape,i.shape,o,l,s,c,!0),h;k.env().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?h=new Lq(f):h=new Bq(f);var d=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return t.runWebGLProgram(h,[a,i],"float32",d)}var jVe={kernelName:k.DepthwiseConv2dNative,backendName:"webgl",kernelFunc:KVe};var XVe=function(){function n(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,r=e.strideWidth,a=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `.concat(o,` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `).concat(e.batchSize,`; b++) {
          for (int yR = 0; yR < `).concat(e.outHeight,`; yR++) {
            int xR = wR + yR * `).concat(t," - ").concat(a,`;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int yC = 0; yC < `).concat(e.outWidth,`; yC++) {
              int xC = wC + yC * `).concat(r," - ").concat(i,`;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}(),YVe=function(){function n(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,r=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,s=r-1-e.padInfo.left,u=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`.concat(o,", ").concat(s,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `).concat(t,`; wR++) {
          float dyR = float(dyRCorner + wR) / `).concat(a,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `).concat(t,` - 1 - wR;

          for (int wC = 0; wC < `).concat(r,`; wC++) {
            float dyC = float(dyCCorner + wC) / `).concat(i,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `).concat(r,` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `).concat(u,`; dm++) {
              int d2 = d1 * `).concat(u,` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}();function ZVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape,f=k.backend_util.computeConv2DInfo(a.shape,l,o,s,u,c,!0),h=new XVe(f);return t.runWebGLProgram(h,[a,i],"float32")}var JVe={kernelName:k.DepthwiseConv2dNativeBackpropFilter,backendName:"webgl",kernelFunc:ZVe};function QVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.inputShape,f=k.backend_util.computeConv2DInfo(l,i.shape,o,s,u,c,!0),h=new YVe(f);return t.runWebGLProgram(h,[a,i],"float32")}var eGe={kernelName:k.DepthwiseConv2dNativeBackpropInput,backendName:"webgl",kernelFunc:QVe};var tGe=function(){function n(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}return n}();function nGe(n){var e=n.inputs,t=n.backend,r=e.x,a=dn(dn([],Te(r.shape),!1),Te(r.shape),!1),i=k.util.sizeFromShape(r.shape),o=Pe({inputs:{x:r},backend:t,attrs:{shape:[i]}}),s=new tGe(i),u=t.runWebGLProgram(s,[o],o.dtype),c=Pe({inputs:{x:u},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(u),c}var rGe={kernelName:k.Diag,backendName:"webgl",kernelFunc:nGe};var aGe=function(){function n(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.inHeight,r=e.inWidth,a=e.padInfo,i=e.strideHeight,o=e.strideWidth,s=e.filterHeight,u=e.filterWidth,c=e.dilationHeight,l=e.dilationWidth,f=a.top,h=a.left;this.userCode=`
      const ivec2 strides = ivec2(`.concat(i,", ").concat(o,`);
      const ivec2 pads = ivec2(`).concat(f,", ").concat(h,`);
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < `).concat(s,`; h++) {
          int hIn = hBeg + h * `).concat(c,`;

          if (hIn >= 0 && hIn < `).concat(t,`) {
            for (int w = 0; w < `).concat(u,`; w++) {
              int wIn = wBeg + w * `).concat(l,`;

              if (wIn >= 0 && wIn < `).concat(r,`) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `)}return n}();function iGe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=r.strides,s=r.pad,u=r.dilations,c=k.backend_util.computeDilation2DInfo(a.shape,i.shape,o,s,"NHWC",u),l,f=new aGe(c);l=t.runWebGLProgram(f,[a,i],"float32");var h=Pe({inputs:{x:l},backend:t,attrs:{shape:c.outShape}});return t.disposeIntermediateTensorInfo(l),h}var oGe={kernelName:k.Dilation2D,backendName:"webgl",kernelFunc:iGe};function sGe(n){var e,t,r,a,i=n.inputs,o=n.backend,s=n.attrs,u=s.equation,c=i,l=k.backend_util.decodeEinsumEquation(u,c.length),f=l.allDims,h=l.summedDims,d=l.idDims;k.backend_util.checkEinsumDimSizes(f.length,d,c);for(var p=k.backend_util.getEinsumComputePath(h,d),v=p.path,m=p.steps,g=m.length,y=null,b=f.length,w=[],x=0;x<g;++x){try{for(var N=(e=void 0,ra(m[x])),T=N.next();!T.done;T=N.next()){var E=T.value,C=k.backend_util.getEinsumPermutation(b,d[E]),F=C.permutationIndices,_=C.expandDims,O=void 0;k.backend_util.isIdentityPermutation(F)?O=c[E]:(O=wr({inputs:{x:c[E]},backend:o,attrs:{perm:F}}),w.push(O));for(var L=O.shape.slice(),z=0;z<_.length;++z)L.splice(_[z],0,1);k.util.arraysEqual(O.shape,L)||(O=Pe({inputs:{x:O},backend:o,attrs:{shape:L}}),w.push(O)),y===null?y=O:(y=Ux({inputs:{a:O,b:y},backend:o}),w.push(y))}}catch(X){e={error:X}}finally{try{T&&!T.done&&(t=N.return)&&t.call(N)}finally{if(e)throw e.error}}x<g-1&&(v[x]>=0&&(y=hm({inputs:{x:y},backend:o,attrs:{axis:v[x]-(f.length-b),keepDims:!1}}),w.push(y)),b--)}try{for(var $=ra(w),B=$.next();!B.done;B=$.next()){var W=B.value;W!==y&&o.disposeIntermediateTensorInfo(W)}}catch(X){r={error:X}}finally{try{B&&!B.done&&(a=$.return)&&a.call($)}finally{if(r)throw r.error}}return y}var uGe={kernelName:k.Einsum,backendName:"webgl",kernelFunc:sGe};var cGe="return (x >= 0.0) ? x : (exp(x) - 1.0);",lGe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,fGe=Nt({opSnippet:cGe,packedOpSnippet:lGe}),hGe={kernelName:k.Elu,backendName:"webgl",kernelFunc:fGe};var dGe="return (b >= 1.0) ? a : a * (b + 1.0);",pGe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,vGe=function(n){var e=n.inputs,t=n.backend,r=e.dy,a=e.y,i=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new xh(pGe,r.shape,a.shape):new Gc(dGe,r.shape,a.shape);return t.runWebGLProgram(i,[r,a],r.dtype)},mGe={kernelName:k.EluGrad,backendName:"webgl",kernelFunc:vGe};var gGe=`
  return vec4(equal(a, b));
`,yGe="return float(a == b);",bGe=or({opSnippet:yGe,packedOpSnippet:gGe,dtype:"bool",cpuKernelImpl:n$e}),wGe={kernelName:k.Equal,backendName:"webgl",kernelFunc:bGe};var xGe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = `.concat(k.backend_util.ERF_P,`;
  float a1 = `).concat(k.backend_util.ERF_A1,`;
  float a2 = `).concat(k.backend_util.ERF_A2,`;
  float a3 = `).concat(k.backend_util.ERF_A3,`;
  float a4 = `).concat(k.backend_util.ERF_A4,`;
  float a5 = `).concat(k.backend_util.ERF_A5,`;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`),kGe=Nt({opSnippet:xGe}),SGe={kernelName:k.Erf,backendName:"webgl",kernelFunc:kGe};var NGe=Zc+`
  return exp(x);
`,TGe=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,zq=Nt({opSnippet:NGe,packedOpSnippet:TGe,cpuKernelImpl:r$e,dtype:"float32"}),EGe={kernelName:k.Exp,backendName:"webgl",kernelFunc:zq};function _x(n){var e=n.inputs,t=n.attrs,r=n.backend,a=t.dim,i=e.input,o=i.shape.length,s=i.shape.slice(),u=a;return a<0&&(k.util.assert(-(o+1)<=a,function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")}),u=o+a+1),s.splice(u,0,1),Pe({inputs:{x:i},backend:r,attrs:{shape:s}})}var IGe={kernelName:k.ExpandDims,backendName:"webgl",kernelFunc:_x};var h$="return exp(x) - 1.0;",CGe=Nt({opSnippet:h$,packedOpSnippet:h$,cpuKernelImpl:a$e}),AGe={kernelName:k.Expm1,backendName:"webgl",kernelFunc:CGe};var d$=function(){function n(e,t,r){this.variableNames=["real","imag"];var a=t[1];this.outputShape=t;var i=r?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),o=r?"".concat(a,".0"):"1.0",s;if(e==="real")s="return real * expR - imag * expI;";else if(e==="imag")s="return real * expI + imag * expR;";else throw new Error('FFT component must be either "real" or "imag", got '.concat(e,"."));this.userCode=`
      const float exponentMultiplier = `.concat(i,`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `).concat(s,`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`).concat(a,`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `).concat(a,`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `).concat(o,`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `)}return n}();function $q(n,e,t){var r=t.texData.get(n.dataId),a=k.util.sizeFromShape(n.shape),i=n.shape[n.shape.length-1],o=a/i,s=Pe({inputs:{x:n},backend:t,attrs:{shape:[o,i]}}),u=s.shape,c=new d$("real",u,e),l=new d$("imag",u,e),f=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:u},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:u}],h=t.runWebGLProgram(c,f,"float32"),d=t.runWebGLProgram(l,f,"float32"),p=ns({inputs:{real:h,imag:d},backend:t});t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(d);var v=Pe({inputs:{x:p},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(p),v}function DGe(n){var e=n.inputs,t=n.backend,r=e.input;return $q(r,!1,t)}var _Ge={kernelName:k.FFT,backendName:"webgl",kernelFunc:DGe};var FGe=function(){function n(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return n}();function Sh(n){var e=n.backend,t=n.attrs,r=t.shape,a=t.value,i=t.dtype;if(i=i||k.util.inferDtype(a),i==="string"){var o=k.util.getArrayFromDType(i,k.util.sizeFromShape(r));return o.fill(a),e.makeTensorInfo(r,i,o)}else{var s=new FGe(r,a),u=[[a]];return e.runWebGLProgram(s,[],i,u)}}var RGe={kernelName:k.Fill,backendName:"webgl",kernelFunc:Sh};var OGe=function(){function n(e){this.variableNames=["Image"],this.outputShape=[];var t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = `.concat(t,` - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < `).concat(t,`) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `)}return n}();var PGe={kernelName:k.FlipLeftRight,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.image,a=t,i=new OGe(r.shape),o=a.runWebGLProgram(i,[r],r.dtype);return o}};var p$="return floor(x);",MGe=Nt({opSnippet:p$,packedOpSnippet:p$,cpuKernelImpl:i$e}),BGe={kernelName:k.Floor,backendName:"webgl",kernelFunc:MGe};var LGe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,zGe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,$Ge=or({opSnippet:LGe,packedOpSnippet:zGe,dtype:"int32"}),qGe={kernelName:k.FloorDiv,backendName:"webgl",kernelFunc:$Ge},WGe=function(){function n(e){this.variableNames=["A"];var t=xr(),r=Te(e,2),a=r[0],i=r[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`.concat(i,".0, ").concat(a,`.0);

        vec4 values = `).concat(t.texture2D,`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `)}return n}(),VGe=function(){function n(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=xr(),r=Te(e,2),a=r[0],i=r[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`.concat(i,".0, ").concat(a,`.0);
            vec4 values = `).concat(t.texture2D,`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `).concat(t.output,` = result;
      }
    `)}return n}(),GGe={kernelName:k.FromPixels,backendName:"webgl",kernelFunc:UGe},$c,kx=k.env().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function UGe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.pixels,i=r.numChannels,o=typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement,u=Te(o?[a.videoWidth,a.videoHeight]:[a.width,a.height],2),c=u[0],l=u[1],f=[l,c],h=[l,c,i];if(s||o){var d=k.env().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");($c==null||d!==kx)&&(kx=d,$c=document.createElement("canvas").getContext("2d",{willReadFrequently:kx})),$c.canvas.width=c,$c.canvas.height=l,$c.drawImage(a,0,0,c,l),a=$c.canvas}var p=t.makeTensorInfo(f,"int32");t.texData.get(p.dataId).usage=ba.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(p.dataId),a);var v=k.env().getBool("WEBGL_PACK")?new VGe(h):new WGe(h),m=t.runWebGLProgram(v,[p],"int32");return t.disposeData(p.dataId),m}function HGe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,f=r.dilations,h=r.dimRoundingMode,d=r.activation,p=r.leakyreluAlpha,v=k.backend_util.convertConv2DDataFormat(l),m=k.backend_util.computeConv2DInfo(a.shape,i.shape,u,f,c,h,!1,v),g,y=[],b=o!=null,w=s!=null,x=d==="leakyrelu",N=function(){var L=[a,i],z=function(B,W){if(W==="NCHW"&&B.shape.length===1&&B.shape[0]!==1){var X=Pe({inputs:{x:B},backend:t,attrs:{shape:[B.shape[0],1,1]}});return y.push(X),X}return B};if(b&&L.push(z(o,l)),w&&L.push(z(s,l)),x){var $=t.makeTensorInfo([],"float32",k.util.createScalarValue(p,"float32"));L.push($),y.push($)}return L};if(m.filterHeight===1&&m.filterWidth===1&&m.dilationHeight===1&&m.dilationWidth===1&&m.strideHeight===1&&m.strideWidth===1&&(m.padInfo.type==="SAME"||m.padInfo.type==="VALID"))g=Oq({x:a,filter:i,convInfo:m,backend:t,bias:o,activation:d,preluActivationWeights:s,leakyreluAlpha:p});else if(m.strideWidth<=2&&v==="channelsLast"&&k.env().getBool("WEBGL_EXP_CONV")){var T=d?vh(d,!0):null,E=new Rq(m,b,T,w,x),C=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],F=N();g=t.runWebGLProgram(E,F,"float32",C)}else if(k.env().getBool("WEBGL_CONV_IM2COL"))g=Pq({x:a,filter:i,convInfo:m,backend:t,bias:o,activation:d,preluActivationWeights:s,leakyreluAlpha:p});else{var T=d?vh(d,!1):null,E=new Fq(m,b,T,w,x),_=N();g=t.runWebGLProgram(E,_,"float32")}var O=Pe({inputs:{x:g},backend:t,attrs:{shape:m.outShape}});return y.push(g),y.forEach(function(L){return t.disposeIntermediateTensorInfo(L)}),O}var KGe={kernelName:k.FusedConv2D,backendName:"webgl",kernelFunc:HGe};function jGe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=r.strides,c=r.pad,l=r.dilations,f=r.dimRoundingMode,h=r.activation,d=r.leakyreluAlpha,p=[],v=l;v==null&&(v=[1,1]),k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(u,v),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(u," and dilations '").concat(v,"'")});var m=k.backend_util.computeConv2DInfo(a.shape,i.shape,u,v,c,f,!0),g=k.env().getBool("WEBGL_PACK_DEPTHWISECONV")&&m.strideWidth<=2&&m.outChannels/m.inChannels===1,y=h?vh(h,g):null,b=[a,i],w=o!=null,x=s!=null,N=h==="leakyrelu";if(w&&b.push(o),x&&b.push(s),N){var T=t.makeTensorInfo([],"float32",k.util.createScalarValue(d,"float32"));b.push(T),p.push(T)}var E;g?E=new Lq(m,w,y,x,N):E=new Bq(m,w,y,x,N);var C=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],F=t.runWebGLProgram(E,b,"float32",C);return p.forEach(function(_){return t.disposeIntermediateTensorInfo(_)}),F}var XGe={kernelName:k.FusedDepthwiseConv2D,backendName:"webgl",kernelFunc:jGe},YGe=function(){function n(e,t,r,a){this.sliceDim=e,this.strides=t,this.paramsShape=a,this.variableNames=["x","indices"],this.outputShape=r;for(var i=Wt(r.length),o=`
    int index;`,s=0;s<this.sliceDim;s++)o+=`
          index = round(getIndices(coords[0], `.concat(s,`));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= `).concat(this.paramsShape[s],`;
          flattenIndex += index * `).concat(this.strides[s],";");this.userCode=`
         void main() {
          `.concat(i,` coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          `).concat(o,`

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `)}return n}();function ZGe(n){var e=n.inputs,t=n.backend,r=e.params,a=e.indices,i=a.shape,o=i[i.length-1],s=k.util.sizeFromShape(r.shape),u=Te(k.backend_util.prepareAndValidate(r,a),4),c=u[0],l=u[1],f=u[2],h=u[3],d=Pe({inputs:{x:a},backend:t,attrs:{shape:[l,o]}}),p=Pe({inputs:{x:r},backend:t,attrs:{shape:[k.util.sizeFromShape(r.shape)/f,f]}});if(t.shouldExecuteOnCPU([r,a])||r.dtype==="string"){var v=t.readSync(a.dataId),m=t.bufferSync(r),g=o$e(v,m,r.dtype,l,o,f,h,r.shape,s);return t.makeTensorInfo(c,r.dtype,g.values)}var y=new YGe(o,h,[l,f],r.shape),b=t.runWebGLProgram(y,[p,d],p.dtype),w=Pe({inputs:{x:b},backend:t,attrs:{shape:c}});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(b),w}var JGe={kernelName:k.GatherNd,backendName:"webgl",kernelFunc:ZGe};var QGe=function(){function n(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;var r=Wt(this.rank),a=eUe(e);this.userCode=`
      void main() {
        `.concat(r,` resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < `).concat(e[2],`) ? 1.0 : 0.0;
        setOutput(inBounds * getA(`).concat(a,`));
      }
    `)}return n}();function eUe(n,e){for(var t=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],a=0;a<n.length;a++)a===2?r.push("index"):r.push("".concat(t[a]));return r.join()}function qq(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.indices,o=r.axis,s=r.batchDims,u=k.util.parseAxisParam(o,a.shape)[0];if(k.env().get("DEBUG"))for(var c=t.readSync(i.dataId),l=a.shape[u],f=function(C){var F=c[C];k.util.assert(F<=l-1&&F>=0,function(){return"GatherV2: the index value ".concat(F," is not in [0, ").concat(l-1,"]")})},h=0;h<c.length;++h)f(h);var d=k.backend_util.segment_util.collectGatherOpShapeInfo(a,i,u,s),p=k.util.sizeFromShape(i.shape),v=[],m=Pe({inputs:{x:a},backend:t,attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]}}),g=Pe({inputs:{x:i},backend:t,attrs:{shape:[d.batchSize,p/d.batchSize]}});v.push(m),v.push(g);var y=[d.batchSize,d.outerSize,p/d.batchSize,d.sliceSize];if(t.shouldExecuteOnCPU([a,i])||a.dtype==="string"){var b=t.bufferSync(g),w=t.bufferSync(m),x=s$e(w,b,y);return v.forEach(function(C){return t.disposeIntermediateTensorInfo(C)}),t.makeTensorInfo(d.outputShape,x.dtype,x.values)}var N=new QGe(m.shape,y),T=t.runWebGLProgram(N,[m,g],m.dtype);v.push(T);var E=Pe({inputs:{x:T},backend:t,attrs:{shape:d.outputShape}});return v.forEach(function(C){return t.disposeIntermediateTensorInfo(C)}),E}var tUe={kernelName:k.GatherV2,backendName:"webgl",kernelFunc:qq};var nUe="return float(a > b);",rUe=`
  return vec4(greaterThan(a, b));
`,aUe=or({opSnippet:nUe,packedOpSnippet:rUe,cpuKernelImpl:u$e,dtype:"bool"}),iUe={kernelName:k.Greater,backendName:"webgl",kernelFunc:aUe};var oUe="return float(a >= b);",sUe=`
  return vec4(greaterThanEqual(a, b));
`,uUe=or({opSnippet:oUe,packedOpSnippet:sUe,dtype:"bool",cpuKernelImpl:c$e}),cUe={kernelName:k.GreaterEqual,backendName:"webgl",kernelFunc:uUe};function lUe(n){var e=n.inputs,t=n.backend,r=e.input;return $q(r,!0,t)}var fUe={kernelName:k.IFFT,backendName:"webgl",kernelFunc:lUe};var hUe="return float(!isnan(x) && !isinf(x));",dUe=Nt({opSnippet:hUe,dtype:"bool"}),pUe={kernelName:k.IsFinite,backendName:"webgl",kernelFunc:dUe};var vUe="return float(isinf(x));",mUe=Nt({opSnippet:vUe,dtype:"bool"}),gUe={kernelName:k.IsInf,backendName:"webgl",kernelFunc:mUe};var yUe="return float(isnan(x));",bUe=Nt({opSnippet:yUe,dtype:"bool"}),wUe={kernelName:k.IsNan,backendName:"webgl",kernelFunc:bUe};var xUe="return float(a < b);",kUe=`
  return vec4(lessThan(a, b));
`,SUe=or({opSnippet:xUe,packedOpSnippet:kUe,cpuKernelImpl:l$e,dtype:"bool"}),NUe={kernelName:k.Less,backendName:"webgl",kernelFunc:SUe};var TUe="return float(a <= b);",EUe=`
  return vec4(lessThanEqual(a, b));
`,IUe=or({opSnippet:TUe,packedOpSnippet:EUe,cpuKernelImpl:f$e,dtype:"bool"}),CUe={kernelName:k.LessEqual,backendName:"webgl",kernelFunc:IUe};function AUe(n){var e=n.backend,t=n.attrs,r=t.start,a=t.stop,i=t.num,o=h$e(r,a,i);return e.makeTensorInfo([o.length],"float32",o)}var DUe={kernelName:k.LinSpace,backendName:"webgl",kernelFunc:AUe};var _Ue=Zc+`
  return x < 0.0 ? 0./0. : log(x);
`,FUe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,RUe=Nt({opSnippet:_Ue,packedOpSnippet:FUe,cpuKernelImpl:d$e}),OUe={kernelName:k.Log,backendName:"webgl",kernelFunc:RUe};var PUe=Zc+`
  return log(1.0 + x);
`,MUe=Nt({opSnippet:PUe}),BUe={kernelName:k.Log1p,backendName:"webgl",kernelFunc:MUe};var LUe="return float(a >= 1.0 && b >= 1.0);",zUe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,$Ue=or({opSnippet:LUe,packedOpSnippet:zUe,dtype:"bool"}),qUe={kernelName:k.LogicalAnd,backendName:"webgl",kernelFunc:$Ue};var WUe="return float(!(x >= 1.0));",VUe=Nt({opSnippet:WUe}),GUe={kernelName:k.LogicalNot,backendName:"webgl",kernelFunc:VUe};var UUe="return float(a >= 1.0 || b >= 1.0);",HUe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,KUe=or({opSnippet:UUe,packedOpSnippet:HUe,dtype:"bool"}),jUe={kernelName:k.LogicalOr,backendName:"webgl",kernelFunc:KUe};var XUe=function(){function n(e,t,r,a,i){this.variableNames=["x"],this.outputShape=[];var o=t,s=e[3]-1;this.outputShape=e;var u,c="float(".concat(r,") + float(").concat(a,") * sum");i===.5?u="inversesqrt(".concat(c,")"):i===1?u="1.0/(".concat(c,")"):u="exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`.concat(o,"; j <= ").concat(o,`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `).concat(s,`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `).concat(u,`;
        setOutput(val);
      }
    `)}return n}();var YUe=function(){function n(e,t,r,a,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o=t,s=e[3]-1;this.outputShape=e;var u,c="float(".concat(r,") + float(").concat(a,") * sum");i===.5?u="inversesqrt(".concat(c,")"):i===1?u="1.0/(".concat(c,")"):u="exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `.concat(this.outputShape[3],`;
        bool hasNextRow = c < `).concat(this.outputShape[2],`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `).concat(o,`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `).concat(o,"; j <= ").concat(o,`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`).concat(s,`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `).concat(u,`;
        setOutput(result);
      }
    `)}return n}();var ZUe=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta,c=k.env().getBool("WEBGL_PACK_NORMALIZATION")?new YUe(a.shape,i,o,s,u):new XUe(a.shape,i,o,s,u);return t.runWebGLProgram(c,[a],a.dtype)},JUe={kernelName:k.LRN,backendName:"webgl",kernelFunc:ZUe};var QUe=function(){function n(e,t,r,a,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=r,this.alpha=a,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `.concat(this.depth,`; ++d) {
          int depthBegin = int(max(0.0, float(d - `).concat(t,`)));
          int depthEnd = int(min(float(`).concat(this.depth,`),
              float(d + `).concat(t,` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `).concat(this.depth,`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`).concat(a,") * norm + float(").concat(r,`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`).concat(a,`)
                * float(`).concat(i,`)
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `).concat(i,`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `)}return n}();var e6e=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.y,o=e.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta,f=new QUe(a.shape,s,u,c,l);return t.runWebGLProgram(f,[a,i,o],a.dtype)},t6e={kernelName:k.LRNGrad,backendName:"webgl",kernelFunc:e6e};function n6e(n,e,t,r){var a=k.util.sizeFromShape(e),i=k.util.sizeFromShape(n.shape),o=i/a,s=Pe({inputs:{x:n},attrs:{shape:[o,a]},backend:r}),u=mu(s,n.dtype,"max",r),c=Pe({inputs:{x:u},attrs:{shape:t},backend:r});return r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}function Wq(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.reductionIndices,o=r.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=l!=null,h=t.shouldExecuteOnCPU([a]),d=a;if(f){if(h){for(var p=t.texData.get(d.dataId),v=p.values,m=new Array(s),g=0;g<m.length;g++)m[g]=a.shape[l[g]];var y=Wx(v,a.shape,a.dtype,l,m);d=t.makeTensorInfo(m,a.dtype);var b=t.texData.get(d.dataId);b.values=y}else d=fm(a,l,t);c=k.backend_util.getInnerMostAxes(c.length,s)}k.backend_util.assertAxesAreInnerMostDims("max",c,s);var w=Te(k.backend_util.computeOutAndReduceShapes(d.shape,c),2),x=w[0],N=w[1],T=x;o&&(T=k.backend_util.expandShapeToKeepDim(x,u));var E;if(h){var p=t.texData.get(d.dataId),v=p.values,C=p$e(v,k.util.sizeFromShape(N),T,a.dtype);E=t.makeTensorInfo(T,a.dtype);var F=t.texData.get(E.dataId);F.values=C}else E=n6e(d,N,T,t);return f&&t.disposeIntermediateTensorInfo(d),E}var r6e={kernelName:k.Max,backendName:"webgl",kernelFunc:Wq};var a6e=Gx+`
  return max(a, b);
`,i6e=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+wh+`
  return result;
`,o6e=or({opSnippet:a6e,packedOpSnippet:i6e,cpuKernelImpl:v$e}),s6e={kernelName:k.Maximum,backendName:"webgl",kernelFunc:o6e};function u6e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x;Hc(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=1;k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=k.backend_util.computePool2DInfo(a.shape,i,o,c,s,u);if(l.filterWidth===1&&l.filterHeight===1&&k.util.arraysEqual(l.inShape,l.outShape))return aa({inputs:{x:a},backend:t});var f=new mh(l,"max",!1);return t.runWebGLProgram(f,[a],a.dtype)}var c6e={kernelName:k.MaxPool,backendName:"webgl",kernelFunc:u6e};function l6e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=[1,1,1],f=k.backend_util.computePool3DInfo(a.shape,i,o,l,s,c,u),h=new Hx(f,"max",!1);return t.runWebGLProgram(h,[a],a.dtype)}var f6e={kernelName:k.MaxPool3D,backendName:"webgl",kernelFunc:l6e};var h6e=function(){function n(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,r=e.strideWidth,a=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,s=i-1-e.padInfo.top,u=o-1-e.padInfo.left,c=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(`.concat(s,", ").concat(u,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(i,`;
          wR += `).concat(a,`) {
          float dyR = float(dyRCorner + wR) / `).concat(t,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `).concat(o,`; wC++) {
            float dyC = float(dyCCorner + wC) / `).concat(r,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `).concat(c,` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `).concat(o,` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `)}return n}(),d6e=function(){function n(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,r=e.strideHeight,a=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterDepth,c=e.effectiveFilterHeight,l=e.effectiveFilterWidth,f=u-1-e.padInfo.front,h=c-1-e.padInfo.top,d=l-1-e.padInfo.left,p=u*c*l-1;this.userCode=`
      const ivec3 pads = ivec3(`.concat(f,", ").concat(h,", ").concat(d,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `).concat(u,`;
           wD += `).concat(i,`) {
          float dyD = float(dyDCorner + wD) / `).concat(t,`.0;

          if (dyD < 0.0 || dyD >= `).concat(e.outDepth,`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `).concat(c,`;
              wR += `).concat(o,`) {
            float dyR = float(dyRCorner + wR) / `).concat(r,`.0;

            if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `).concat(l,`;
                wC += `).concat(s,`) {
              float dyC = float(dyCCorner + wC) / `).concat(a,`.0;

              if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `).concat(p,` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `).concat(c," * ").concat(l,` +
                  wR * `).concat(l,` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}();function p6e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.input,o=i,s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,f=[1,1,1],h=k.backend_util.computePool3DInfo(o.shape,s,u,f,c,l),d=new Hx(h,"max",!0),p=t.runWebGLProgram(d,[o],o.dtype),v=new d6e(h),m=t.runWebGLProgram(v,[a,p],o.dtype);return t.disposeIntermediateTensorInfo(p),m}var v6e={kernelName:k.MaxPool3DGrad,backendName:"webgl",kernelFunc:p6e};function m6e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.input,o=e.output,s=i;Hc([i,o],"maxPoolGrad");var u=r.filterSize,c=r.strides,l=r.pad,f=r.dimRoundingMode,h=k.backend_util.computePool2DInfo(s.shape,u,c,1,l,f),d=!0,p=new mh(h,"max",d),v=t.runWebGLProgram(p,[s],s.dtype),m=new h6e(h),g=t.runWebGLProgram(m,[a,v],s.dtype);return t.disposeIntermediateTensorInfo(v),g}var g6e={kernelName:k.MaxPoolGrad,backendName:"webgl",kernelFunc:m6e};function y6e(n,e,t,r){var a=new mh(t,"max",!1),i=r.runWebGLProgram(a,[n],"float32");a=new mh(t,"max",!0,!0,e);var o=r.runWebGLProgram(a,[n],"float32");return[i,o]}var b6e={kernelName:k.MaxPoolWithArgmax,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.attrs,r=n.backend,a=e.x,i=t.filterSize,o=t.strides,s=t.pad,u=t.includeBatchInIndex,c=r;k.util.assert(a.shape.length===4,function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,".")});var l=[1,1];k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,l),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(l,"'")});var f=k.backend_util.computePool2DInfo(a.shape,i,o,l,s),h=Te(y6e(a,u,f,c),2),d=h[0],p=h[1];return[d,p]}};function w6e(n,e,t,r){var a=k.util.sizeFromShape(e),i=k.util.sizeFromShape(n.shape),o=i/a,s=Pe({inputs:{x:n},attrs:{shape:[o,a]},backend:r}),u=mu(s,"float32","mean",r),c=Pe({inputs:{x:u},attrs:{shape:t},backend:r});return r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}var x6e={kernelName:k.Mean,backendName:"webgl",kernelFunc:function(n){var e,t,r=n.inputs,a=n.attrs,i=n.backend,o=r.x,s=a.keepDims,u=a.axis,c=i,l=o.shape.length,f=k.util.parseAxisParam(u,o.shape),h=f,d=k.backend_util.getAxesPermutation(h,l),p=d!=null,v=c.shouldExecuteOnCPU([o]),m=[],g=o;if(p){if(v){for(var y=c.texData.get(g.dataId),b=y.values,w=new Array(l),x=0;x<w.length;x++)w[x]=o.shape[d[x]];var N=Wx(b,o.shape,o.dtype,d,w);g=c.makeTensorInfo(w,o.dtype);var T=c.texData.get(g.dataId);T.values=N}else g=fm(o,d,c);m.push(g),h=k.backend_util.getInnerMostAxes(h.length,l)}k.backend_util.assertAxesAreInnerMostDims("sum",h,l);var E=Te(k.backend_util.computeOutAndReduceShapes(g.shape,h),2),C=E[0],F=E[1],_=C;s&&(_=k.backend_util.expandShapeToKeepDim(C,f));var O=w6e(g,F,_,c);try{for(var L=ra(m),z=L.next();!z.done;z=L.next()){var x=z.value;c.disposeIntermediateTensorInfo(x)}}catch($){e={error:$}}finally{try{z&&!z.done&&(t=L.return)&&t.call(L)}finally{if(e)throw e.error}}return O}};function k6e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=a;l!=null&&(f=wr({inputs:{x:a},backend:t,attrs:{perm:l}}),c=k.backend_util.getInnerMostAxes(c.length,a.shape.length)),k.backend_util.assertAxesAreInnerMostDims("min",c,s);var h=Te(k.backend_util.computeOutAndReduceShapes(f.shape,c),2),d=h[0],p=h[1],v=k.util.sizeFromShape(p),m=Pe({inputs:{x:f},backend:t,attrs:{shape:[-1,v]}}),g=mu(m,m.dtype,"min",t),y;if(o){var b=k.backend_util.expandShapeToKeepDim(d,u);y=Pe({inputs:{x:g},backend:t,attrs:{shape:b}})}else y=Pe({inputs:{x:g},backend:t,attrs:{shape:d}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),l!=null&&t.disposeIntermediateTensorInfo(f),y}var S6e={kernelName:k.Min,backendName:"webgl",kernelFunc:k6e};var N6e=Gx+`
  return min(a, b);
`,T6e=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+wh+`
  return result;
`,E6e=or({opSnippet:N6e,packedOpSnippet:T6e,cpuKernelImpl:m$e}),I6e={kernelName:k.Minimum,backendName:"webgl",kernelFunc:E6e};var C6e=function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=t.map(function(l,f){return l[0]+e[f]+l[1]});var a=e.length,i=Wt(a),o=t.map(function(l){return l[0]}).join(","),s=t.map(function(l,f){return l[0]+e[f]}).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),c=r==="reflect"?0:1;if(a===1){this.userCode=`
        int start = `.concat(o,`;
        int end = `).concat(s,`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - `).concat(c,`;
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + `).concat(c,`;
          }
          setOutput(getX(outC - start));
        }
      `);return}this.userCode=`
      `.concat(i," start = ").concat(i,"(").concat(o,`);
      `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outC = getOutputCoords();
        for (int i = 0; i < `).concat(a,`; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - `).concat(c,`;
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + `).concat(c,`;
          }
        }
        `).concat(i,` coords = outC - start;
        setOutput(getX(`).concat(u,`));
      }
    `)}return n}();var A6e=function(){function n(e,t,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(v,m){return v[0]+e[m]+v[1]});var a=e.length,i=Wt(a),o=t.map(function(v){return v[0]}).join(","),s=t.map(function(v,m){return v[0]+e[m]}).join(","),u=br("rc",a),c=br("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),f=a===1?"source":"vec2(".concat(c.slice(-2).join(),")"),h=r==="reflect"?0:1,d="";if(a===1){var p=`
        `.concat(i,` source = rc;
        if (source < start) {
          source = start * 2 - source - `).concat(h,`;
        } else if (source >= end) {
          source = (end - 1) * 2 - source + `).concat(h,`;
        }
        source -= start;
      `);d=`
        `.concat(i,` rc = outputLoc;
        `).concat(p,`
        result[0] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        `).concat(u[a-1],` += 1;
        if(`).concat(l,`) {
          `).concat(p,`
          result[1] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        }
      `)}else{var p=`
        `.concat(i,` source = rc;
        `).concat(i," lt = ").concat(i,`(lessThan(source, start));
        `).concat(i," gte = ").concat(i,`(greaterThanEqual(source, end));
        `).concat(i,` orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - `).concat(h,`) +
                gte * ((end - 1) * 2 - source + `).concat(h,`);
        source -= start;
      `);d=`
        `.concat(i,` rc = outputLoc;
        `).concat(p,`
        result[0] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        `).concat(u[a-1],` += 1;
        if(`).concat(l,`) {
          `).concat(p,`
          result[1] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        }
        rc = outputLoc;
        `).concat(u[a-2],` += 1;
        if(`).concat(u[a-2]," < ").concat(this.outputShape[a-2],`) {
          `).concat(p,`
          result[2] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
          `).concat(u[a-1],` += 1;
          if(`).concat(l,`) {
            `).concat(p,`
            result[3] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
          }
        }
      `)}this.userCode=`
      const `.concat(i," start = ").concat(i,"(").concat(o,`);
      const `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `).concat(d,`
        setOutput(result);
      }
    `)}return n}();var D6e=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.paddings,o=r.mode,s=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new A6e(a.shape,i,o):new C6e(a.shape,i,o),u=t.runWebGLProgram(s,[a],a.dtype);return u},_6e={kernelName:k.MirrorPad,backendName:"webgl",kernelFunc:D6e};var F6e=`if (b == 0.0) return NAN;
  return mod(a, b);`,R6e=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+wh+`
  return result;
`,O6e=or({opSnippet:F6e,packedOpSnippet:R6e}),P6e={kernelName:k.Mod,backendName:"webgl",kernelFunc:O6e};var M6e=function(){function n(e,t,r){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,r],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `.concat(t-1,`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`).concat(t-1,`));
      }
    `)}return n}();var B6e=`
if (a == b) {
  return 1.0;
};
return a / b;`,L6e=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,Vq=or({opSnippet:B6e,packedOpSnippet:L6e,checkOutOfBounds:!0}),z6e={kernelName:k.RealDiv,backendName:"webgl",kernelFunc:Vq};var v$="return a - b;",Gq=or({opSnippet:v$,packedOpSnippet:v$,supportsComplex:!0,cpuKernelImpl:M$e}),$6e={kernelName:k.Sub,backendName:"webgl",kernelFunc:Gq};function Uq(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.logits,i=r.dim,o=k.util.parseAxisParam([i],a.shape),s=Wq({inputs:{x:a},backend:t,attrs:{reductionIndices:o,keepDims:!1}}),u=k.backend_util.expandShapeToKeepDim(s.shape,o),c=Pe({inputs:{x:s},backend:t,attrs:{shape:u}}),l=Gq({inputs:{a,b:c},backend:t}),f=zq({inputs:{x:l},backend:t}),h=hm({inputs:{x:f},backend:t,attrs:{axis:o,keepDims:!1}}),d=Pe({inputs:{x:h},backend:t,attrs:{shape:u}}),p=Vq({inputs:{a:f,b:d},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(d),p}var q6e={kernelName:k.Softmax,backendName:"webgl",kernelFunc:Uq};function W6e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.logits,i=r.numSamples,o=r.seed,s=r.normalized,u=s?a:Uq({inputs:{logits:a},backend:t,attrs:{dim:a.shape.length-1}}),c=u.shape[0],l=u.shape[1],f=new M6e(c,l,i),h=[[o]],d=t.runWebGLProgram(f,[u],"int32",h);return s||t.disposeIntermediateTensorInfo(u),d}var V6e={kernelName:k.Multinomial,backendName:"webgl",kernelFunc:W6e},G6e=Xa+`
  return -x;
`,U6e=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function H6e(n){var e=n.inputs,t=n.backend,r=e.x;if(t.shouldExecuteOnCPU([r])){var a=t.texData.get(r.dataId),i=Te(y$e(a.values,r.shape,r.dtype),2),o=i[0],s=i[1];return t.makeTensorInfo(s,r.dtype,o)}var u;return k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")?u=new es(r.shape,U6e):u=new Mi(r.shape,G6e),t.runWebGLProgram(u,[r],r.dtype)}var K6e={kernelName:k.Neg,backendName:"webgl",kernelFunc:H6e};var j6e=k.kernel_impls.nonMaxSuppressionV3Impl;function X6e(n){k.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=n.inputs,t=n.backend,r=n.attrs,a=e.boxes,i=e.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=t.readSync(a.dataId),l=t.readSync(i.dataId),f=j6e(c,l,o,s,u).selectedIndices;return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}var Y6e={kernelName:k.NonMaxSuppressionV3,backendName:"webgl",kernelFunc:X6e};var Z6e=k.kernel_impls.nonMaxSuppressionV4Impl;function J6e(n){k.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=n.inputs,t=n.backend,r=n.attrs,a=e.boxes,i=e.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize,l=t.readSync(a.dataId),f=t.readSync(i.dataId),h=Z6e(l,f,o,s,u,c),d=h.selectedIndices,p=h.validOutputs;return[t.makeTensorInfo([d.length],"int32",new Int32Array(d)),t.makeTensorInfo([],"int32",new Int32Array([p]))]}var Q6e={kernelName:k.NonMaxSuppressionV4,backendName:"webgl",kernelFunc:J6e};var eHe=k.kernel_impls.nonMaxSuppressionV5Impl;function tHe(n){k.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=n.inputs,t=n.backend,r=n.attrs,a=e.boxes,i=e.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma,l=t.readSync(a.dataId),f=t.readSync(i.dataId),h=o,d=s,p=u,v=c,m=eHe(l,f,h,d,p,v),g=m.selectedIndices,y=m.selectedScores;return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var nHe={kernelName:k.NonMaxSuppressionV5,backendName:"webgl",kernelFunc:tHe};var rHe=function(){function n(e,t,r,a){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`.concat(a,"), float(").concat(r,`),
                      float(index == coords.y)));
      }
    `)}return n}(),aHe=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue,c=k.util.sizeFromShape(a.shape),l=new rHe(c,o,s,u),f=Pe({inputs:{x:a},backend:t,attrs:{shape:[c]}}),h=t.runWebGLProgram(l,[f],i);t.disposeIntermediateTensorInfo(f);var d=dn(dn([],Te(a.shape),!1),[o],!1),p=Pe({inputs:{x:h},backend:t,attrs:{shape:d}});return t.disposeIntermediateTensorInfo(h),p},iHe={kernelName:k.OneHot,backendName:"webgl",kernelFunc:aHe};function cm(n){var e=n.inputs,t=n.backend,r=e.x;if(r.dtype==="complex64"){var a=kh({inputs:{input:r},backend:t}),i=cm({inputs:{x:a},backend:t}),o=dm({inputs:{input:r},backend:t}),s=cm({inputs:{x:o},backend:t}),u=ns({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return Sh({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:t})}var oHe={kernelName:k.ZerosLike,backendName:"webgl",kernelFunc:cm};function Hq(n){var e=n.inputs,t=n.backend,r=e.x;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){var a=kh({inputs:{input:r},backend:t}),i=Hq({inputs:{x:a},backend:t}),o=dm({inputs:{input:r},backend:t}),s=cm({inputs:{x:o},backend:t}),u=ns({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return Sh({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:t})}var sHe={kernelName:k.OnesLike,backendName:"webgl",kernelFunc:Hq};function uHe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.axis;if(e.length===1)return _x({inputs:{input:e[0]},backend:t,attrs:{dim:a}});var i=e[0].shape,o=e[0].dtype;e.forEach(function(l){k.util.assertShapesMatch(i,l.shape,"All tensors passed to stack must have matching shapes"),k.util.assert(o===l.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=[],u=e.map(function(l){var f=_x({inputs:{input:l},backend:t,attrs:{dim:a}});return s.push(f),f}),c=_q({inputs:u,backend:t,attrs:{axis:a}});return s.forEach(function(l){return t.disposeIntermediateTensorInfo(l)}),c}var cHe={kernelName:k.Pack,backendName:"webgl",kernelFunc:uHe};var lHe=function(){function n(e,t,r){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(function(c,l){return c[0]+e[l]+c[1]});var a=e.length,i=Wt(a),o=t.map(function(c){return c[0]}).join(","),s=t.map(function(c,l){return c[0]+e[l]}).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);if(a===1){this.userCode=`
        int start = `.concat(o,`;
        int end = `).concat(s,`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `);return}this.userCode=`
      `.concat(i," start = ").concat(i,"(").concat(o,`);
      `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          `).concat(i,` coords = outC - start;
          setOutput(getX(`).concat(u,`));
        }
      }
    `)}return n}();var fHe=function(){function n(e,t,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(function(g,y){return g[0]+e[y]+g[1]});for(var a=e.length,i=Wt(a),o=t.map(function(g){return g[0]}).join(","),s=t.map(function(g,y){return g[0]+e[y]}).join(","),u=br("rc",a),c=br("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),f=a===1?"source":"vec2(".concat(c.slice(-2).join(),")"),h=["".concat(i," rc = outputLoc;"),"".concat(u[a-1],` += 1;
       if(`).concat(l,`) {
      `),a===1?"":`}
       rc = outputLoc;
       `.concat(u[a-2],` += 1;
       if(`).concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),a===1?"":"  ".concat(u[a-1],` += 1;
         if(`).concat(l,") {")],d=a===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",p="",v=0,m=a===1?2:4;v<m;v++)p+=`
        `.concat(h[v],`
        if (`).concat(d,`) {
          result[`).concat(v,`] = float(value);
        } else {
          `).concat(i,` source = rc - start;
          result[`).concat(v,"] = getChannel(getX(").concat(c.join(),"), ").concat(f,`);
        }
      `);p+=a===1?"} ":"}}",this.userCode=`
      const `.concat(i," start = ").concat(i,"(").concat(o,`);
      const `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `).concat(p,`
        setOutput(result);
      }
    `)}return n}();var Kq=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.paddings,o=r.constantValue;if(k.util.sizeFromShape(a.shape)===0){var s=i.map(function(l,f){return l[0]+a.shape[f]+l[1]});return Sh({backend:t,attrs:{shape:s,value:o,dtype:a.dtype}})}var u=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new fHe(a.shape,i,o):new lHe(a.shape,i,o),c=[[o]];return t.runWebGLProgram(u,[a],a.dtype,c)},hHe={kernelName:k.PadV2,backendName:"webgl",kernelFunc:Kq};var dHe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,pHe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+wh+`
  return result;
`,vHe=or({opSnippet:dHe,packedOpSnippet:pHe}),mHe={kernelName:k.Pow,backendName:"webgl",kernelFunc:vHe};function gHe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=[],c=k.util.parseAxisParam(i,a.shape),l=c,f=k.backend_util.getAxesPermutation(l,s),h=a;f!=null&&(h=wr({inputs:{x:a},backend:t,attrs:{perm:f}}),l=k.backend_util.getInnerMostAxes(l.length,s),u.push(h)),k.backend_util.assertAxesAreInnerMostDims("prod",l,s);var d;if(t.shouldExecuteOnCPU([h])){var p=t.texData.get(h.dataId).values,v=w$e(h.shape,h.dtype,p,l),m=v.outVals,g=v.outShape,y=v.outDtype;d=t.makeTensorInfo(g,y,m)}else{var b=Te(k.backend_util.computeOutAndReduceShapes(h.shape,l),2),g=b[0],w=b[1],x=k.util.sizeFromShape(w),N=Pe({inputs:{x:h},backend:t,attrs:{shape:[-1,x]}}),T=k.sumOutType(a.dtype),E=mu(N,T,"prod",t);d=Pe({inputs:{x:E},backend:t,attrs:{shape:g}}),u.push(N),u.push(E)}if(o){u.push(d);var C=k.backend_util.expandShapeToKeepDim(d.shape,c);d=Pe({inputs:{x:d},backend:t,attrs:{shape:C}})}return u.forEach(function(F){return t.disposeIntermediateTensorInfo(F)}),d}var yHe={kernelName:k.Prod,backendName:"webgl",kernelFunc:gHe};function bHe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.paramsNestedSplits,i=e.paramsDenseValues,o=e.indices;r.outputRaggedRank;var s=a.map(function(g){return t.readSync(g.dataId)}),u=a.map(function(g){return g.shape}),c=t.readSync(i.dataId),l=t.readSync(o.dataId),f=Te(x$e(s,u,c,i.shape,i.dtype,l,o.shape),3),h=f[0],d=f[1],p=f[2],v=h.map(function(g){return t.makeTensorInfo([g.length],"int32",g)}),m=t.makeTensorInfo(p,i.dtype,d);return v.concat([m])}var wHe={kernelName:k.RaggedGather,backendName:"webgl",kernelFunc:bHe};function xHe(n){var e=n.inputs,t=n.backend,r=e.starts,a=e.limits,i=e.deltas,o=t.readSync(r.dataId),s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=Te(k$e(o,r.shape,r.dtype,s,a.shape,u,i.shape),2),l=c[0],f=c[1],h=t.makeTensorInfo([l.length],"int32",l),d=t.makeTensorInfo([f.length],r.dtype,f);return[h,d]}var kHe={kernelName:k.RaggedRange,backendName:"webgl",kernelFunc:xHe};function SHe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.shape,i=e.values,o=e.defaultValue,s=e.rowPartitionTensors,u=r.rowPartitionTypes,c=t.readSync(a.dataId),l=t.readSync(i.dataId),f=t.readSync(o.dataId),h=s.map(function(g){return t.readSync(g.dataId)}),d=s.map(function(g){return g.shape}),p=Te(S$e(c,a.shape,l,i.shape,i.dtype,f,o.shape,h,d,u),2),v=p[0],m=p[1];return t.makeTensorInfo(v,i.dtype,m)}var NHe={kernelName:k.RaggedTensorToTensor,backendName:"webgl",kernelFunc:SHe};var jq=function(n){var e=n.backend,t=n.attrs,r=t.start,a=t.stop,i=t.step,o=t.dtype,s=N$e(r,a,i,o);return e.makeTensorInfo([s.length],o,s)},THe={kernelName:k.Range,backendName:"webgl",kernelFunc:jq};var EHe="return 1.0 / x;",IHe=Nt({opSnippet:EHe}),CHe={kernelName:k.Reciprocal,backendName:"webgl",kernelFunc:IHe};var AHe=Xa+`
  return (x < 0.0) ? 0.0 : x;
`,DHe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,_He=Nt({opSnippet:AHe,packedOpSnippet:DHe}),FHe={kernelName:k.Relu,backendName:"webgl",kernelFunc:_He};var RHe=Xa+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,OHe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,PHe=Nt({opSnippet:RHe,packedOpSnippet:OHe}),MHe={kernelName:k.Relu6,backendName:"webgl",kernelFunc:PHe};var BHe=function(){function n(e,t,r,a,i){this.variableNames=["A"],this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,r,l];var f=[a&&t>1?u-1:u,a&&r>1?c-1:c],h=[a&&t>1?t-1:t,a&&r>1?r-1:r],d;i?d="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`);
      const vec2 inputShapeRC = vec2(`).concat(u,".0, ").concat(c,`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = `).concat(d,`;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `)}return n}();var LHe=function(){function n(e,t,r,a,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,r,l];var f=[a&&t>1?u-1:u,a&&r>1?c-1:c],h=[a&&t>1?t-1:t,a&&r>1?r-1:r],d;i?d="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`,
          `).concat(f[1]/h[1],`);
      const vec3 inputShapeRC = vec3(`).concat(u,".0, ").concat(c,`.0,
                                     `).concat(c,`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = `).concat(d,`;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `).concat(l-1,`;
        bool hasNextRow = coords.z < `).concat(r-1,`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `)}return n}();function zHe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size,u=Te(s,2),c=u[0],l=u[1],f=k.env().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new LHe(a.shape,c,l,i,o):new BHe(a.shape,c,l,i,o);return t.runWebGLProgram(f,[a],"float32")}var $He={kernelName:k.ResizeBilinear,backendName:"webgl",kernelFunc:zHe};var qHe=function(){function n(e,t,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;var a=Te(t,3),i=a[1],o=a[2],s=Te(e,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],f=[r&&u>1?u-1:u,r&&c>1?c-1:c],h=l[0]/f[0],d=l[1]/f[1],p=1/h,v=1/d,m=Math.ceil(p)*2+2,g=Math.ceil(v)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`.concat(h,`);
        const float widthScale = float(`).concat(d,`);

        const float invHeightScale = float(`).concat(p,`);
        const float invWidthScale = float(`).concat(v,`);

        const int winHeight = int(`).concat(m,`);
        const int winWidth = int(`).concat(g,`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `).concat(u,`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `).concat(c,`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `).concat(i-1,`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `).concat(o-1,`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `)}return n}();function WHe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.images,i=e.dy,o=r.alignCorners,s=new qHe(i.shape,a.shape,o);return t.runWebGLProgram(s,[i],i.dtype)}var VHe={kernelName:k.ResizeBilinearGrad,backendName:"webgl",kernelFunc:WHe};var GHe=function(){function n(e,t,r,a,i){this.variableNames=["A"],this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,r,l];var f=[a&&t>1?u-1:u,a&&r>1?c-1:c],h=[a&&t>1?t-1:t,a&&r>1?r-1:r],d=a?"0.5":"0.0",p;i?p="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`);
      const vec2 inputShapeRC = vec2(`).concat(u,".0, ").concat(c,`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = `).concat(p,`;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `).concat(d,`)));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `)}return n}();var UHe=function(){function n(e,t,r,a,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,r,l];var f=[a&&t>1?u-1:u,a&&r>1?c-1:c],h=[a&&t>1?t-1:t,a&&r>1?r-1:r],d=a?"0.5":"0.0",p;i?p="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`,
          `).concat(f[1]/h[1],`);
      const vec3 inputShapeRC = vec3(`).concat(u,".0, ").concat(c,`.0,
                                     `).concat(c,`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = `).concat(p,`;

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `).concat(d,`)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `).concat(l-1,`;
        bool hasNextRow = coords.z < `).concat(r-1,`;

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `)}return n}();function HHe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size,u=Te(s,2),c=u[0],l=u[1],f=k.env().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new UHe(a.shape,c,l,i,o):new GHe(a.shape,c,l,i,o);return t.runWebGLProgram(f,[a],a.dtype)}var KHe={kernelName:k.ResizeNearestNeighbor,backendName:"webgl",kernelFunc:HHe};var jHe=function(){function n(e,t,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;var a=Te(t,3),i=a[1],o=a[2],s=Te(e,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],f=[r&&u>1?u-1:u,r&&c>1?c-1:c],h=l[0]/f[0],d=l[1]/f[1],p=1/h,v=1/d,m=Math.ceil(p)*2+2,g=Math.ceil(v)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`.concat(h,`);
        const float widthScale = float(`).concat(d,`);

        const float invHeightScale = float(`).concat(p,`);
        const float invWidthScale = float(`).concat(v,`);

        const int winHeight = int(`).concat(m,`);
        const int winWidth = int(`).concat(g,`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `).concat(u,`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `).concat(c,`) {
              continue;
            }

            float sourceFracRow =
              float(`).concat(l[0],`) *
                (float(dyR) / float(`).concat(f[0],`));

            float sourceFracCol =
                float(`).concat(l[1],`) *
                  (float(dyC) / float(`).concat(f[1],`));

            int sourceNearestRow = int(min(
                float(int(`).concat(i,`) - 1),
                `).concat(r,` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`).concat(o,`) - 1),
                `).concat(r,` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `)}return n}();function XHe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.images,i=e.dy,o=r.alignCorners,s=new jHe(i.shape,a.shape,o);return t.runWebGLProgram(s,[i],i.dtype)}var YHe={kernelName:k.ResizeNearestNeighborGrad,backendName:"webgl",kernelFunc:XHe};var ZHe=function(){function n(e,t){this.variableNames=["x"];var r=e.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));if(this.outputShape=e,r===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`.concat(e[0],` - coord - 1));
        }
      `);return}var a=function(s){return t.indexOf(s)!==-1&&e[s]!==1?"".concat(e[s]," - coords[").concat(s,"] - 1"):"coords[".concat(s,"]")},i=e.map(function(s,u){return a(u)}).join(","),o=Wt(r);this.userCode=`
      void main() {
        `.concat(o,` coords = getOutputCoords();
        setOutput(getX(`).concat(i,`));
      }
    `)}return n}();var JHe=function(){function n(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var r=e.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));this.outputShape=e;var a=br("rc",r),i="".concat(a[r-1]," + 1 < ").concat(this.outputShape[r-1]),o="".concat(a[r-2]," + 1 < ").concat(this.outputShape[r-2]),s=Wt(r);r===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`.concat(e[0],` - rc - 1),
            `).concat(e[0],` - rc - 1);
          if(`).concat(i,`){
              result.g = getChannel(getX(`).concat(e[0],` - (rc  + 1) - 1),
                `).concat(e[0],` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `):this.userCode=`
        void main() {
          `.concat(s,` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `).concat(u(a.slice()),`;
          if(`).concat(i,`){
            result.g = `).concat(c(a.slice()),`;
          }
          if(`).concat(o,`) {
            result.b = `).concat(l(a.slice()),`;
            if(`).concat(i,`) {
              result.a = `).concat(f(a.slice()),`;
            }
          }
          setOutput(result);
        }
    `);function u(p){return h(p)}function c(p){return p[r-1]="("+p[r-1]+" + 1)",h(p)}function l(p){return p[r-2]="("+p[r-2]+" + 1)",h(p)}function f(p){return p[r-1]="("+p[r-1]+" + 1)",p[r-2]="("+p[r-2]+" + 1)",h(p)}function h(p){var v=e.map(function(y,b){return d(b,p)}),m=v.join(","),g=v.slice(-2).join(",");return"getChannel(getX(".concat(m,"), vec2(").concat(g,"))")}function d(p,v){return t.indexOf(p)!==-1&&e[p]!==1?"".concat(e[p]," - ").concat(v[p]," - 1"):"".concat(v[p])}}return n}();function QHe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.dims,o=a.shape.length,s=k.util.parseAxisParam(i,a.shape);if(o===0)return aa({inputs:{x:a},backend:t});var u=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new JHe(a.shape,s):new ZHe(a.shape,s);return t.runWebGLProgram(u,[a],a.dtype)}var e5e={kernelName:k.Reverse,backendName:"webgl",kernelFunc:QHe};var t5e=function(){function n(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];var r=e[1],a=e[2];this.outputShape=e;var i="";typeof t=="number"?i="float outputValue = ".concat(t.toFixed(2),";"):i=`
        vec3 fill = vec3(`.concat(t.join(","),`);
        float outputValue = fill[coords[3]];`),this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          `.concat(i,`
          if(coordX >= 0 && coordX < `).concat(a," && coordY >= 0 && coordY < ").concat(r,`) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `)}return n}(),n5e={kernelName:k.RotateWithOffset,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.attrs,r=n.backend,a=e.image,i=t.radians,o=t.fillValue,s=t.center,u=r,c=new t5e(a.shape,o),l=Te(k.backend_util.getImageCenter(s,a.shape[1],a.shape[2]),2),f=l[0],h=l[1],d=[[f,h,Math.sin(i),Math.cos(i)]],p=u.runWebGLProgram(c,[a],a.dtype,d);return p}};var r5e=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,a5e=Nt({opSnippet:r5e}),i5e={kernelName:k.Round,backendName:"webgl",kernelFunc:a5e};var o5e="return inversesqrt(x);",s5e=Nt({opSnippet:o5e,cpuKernelImpl:T$e}),u5e={kernelName:k.Rsqrt,backendName:"webgl",kernelFunc:s5e};var Xq=function(){function n(e,t,r,a,i,o,s){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var u=Wt(i.length),c=Wt(o.length),l="";r===1?l="i":r===2&&(l="i, j");var f="getIndices(".concat(l,")"),h="";a===1?h="i":a===2&&(h="i, coords[1]");var d="getUpdates(".concat(h,")"),p=t>1?"strides[j]":"strides";this.userCode=`
        `.concat(u," strides = ").concat(u,"(").concat(i,`);

        void main() {
          `).concat(c,` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `).concat(e,`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `).concat(t,`; j++) {
              int index = round(`).concat(f,`);
              flattenedIndex += index * `).concat(p,`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `).concat(d,`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `)}return n}();function c5e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.indices,i=e.updates,o=r.shape,s=k.backend_util.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,f=s.strides,h=s.outputSize,d=[h/l,l];if(h===0)return t.makeTensorInfo(o,a.dtype);var p=Pe({inputs:{x:a},backend:t,attrs:{shape:[c,u]}}),v=Pe({inputs:{x:i},backend:t,attrs:{shape:[c,l]}}),m=t.makeTensorInfo([],"float32",new Float32Array([0])),g=new Xq(c,u,p.shape.length,v.shape.length,f,d),y=t.runWebGLProgram(g,[v,p,m],v.dtype),b=Pe({inputs:{x:y},backend:t,attrs:{shape:o}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(m),b}var l5e={kernelName:k.ScatterNd,backendName:"webgl",kernelFunc:c5e};var f5e=function(){function n(e,t,r,a){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,r];var i="while (left < right) {",o="for (int i = 0; i < ".concat(Math.ceil(Math.log2(t+1)),"; ++i) { if (left >= right) break;"),s=k.env().getNumber("WEBGL_VERSION")===2?i:o,u=a==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         `.concat(s,`
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) `).concat(u,` value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `)}return n}();function h5e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.sortedSequence,i=e.values,o=r.side,s=new f5e(a.shape[0],a.shape[1],i.shape[1],o),u=[[a.shape[1]]];return t.runWebGLProgram(s,[a,i],"int32",u)}var d5e={kernelName:k.SearchSorted,backendName:"webgl",kernelFunc:h5e};var p5e=function(){function n(e,t,r){this.variableNames=["c","a","b"],this.outputShape=t;var a,i;if(r>4)throw Error("Where for rank ".concat(r," is not yet supported"));if(r===1)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<t.length;c++)u.push("".concat(o[c])),c<e&&s.push("".concat(o[c]));a=s.join(),i=u.join()}var l=Wt(r);this.userCode=`
      void main() {
        `.concat(l,` resRC = getOutputCoords();
        float cVal = getC(`).concat(a,`);
        if (cVal >= 1.0) {
          setOutput(getA(`).concat(i,`));
        } else {
          setOutput(getB(`).concat(i,`));
        }
      }
    `)}return n}();function v5e(n){var e=n.inputs,t=n.backend,r=e.condition,a=e.t,i=e.e,o=new p5e(r.shape.length,a.shape,a.shape.length);return t.runWebGLProgram(o,[r,a,i],k.upcastType(a.dtype,i.dtype))}var m5e={kernelName:k.Select,backendName:"webgl",kernelFunc:v5e};var g5e=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `.concat(k.backend_util.SELU_SCALEALPHA,`;
  float scale = `).concat(k.backend_util.SELU_SCALE,`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`),y5e=Nt({opSnippet:g5e}),b5e={kernelName:k.Selu,backendName:"webgl",kernelFunc:y5e};var w5e=Zc+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,x5e=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,k5e=Nt({opSnippet:w5e,packedOpSnippet:x5e,cpuKernelImpl:I$e}),S5e={kernelName:k.Sigmoid,backendName:"webgl",kernelFunc:k5e};var N5e=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,T5e=Nt({opSnippet:N5e}),E5e={kernelName:k.Sign,backendName:"webgl",kernelFunc:T5e};var I5e=Zc+`
  return sin(x);
`,C5e=Nt({opSnippet:I5e}),A5e={kernelName:k.Sin,backendName:"webgl",kernelFunc:C5e};var D5e=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,_5e=Nt({opSnippet:D5e}),F5e={kernelName:k.Sinh,backendName:"webgl",kernelFunc:_5e};var R5e=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,O5e=Nt({opSnippet:R5e}),P5e={kernelName:k.Softplus,backendName:"webgl",kernelFunc:O5e},M5e=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.blockShape,o=r.paddings;k.util.assert(a.shape.length<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var s=i.reduce(function(y,b){return y*b}),u=[[0,0]];u.push.apply(u,dn([],Te(o),!1));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=[],f=Kq({inputs:{x:a},backend:t,attrs:{paddings:u,constantValue:0}}),h=k.backend_util.getReshaped(f.shape,i,s,!1),d=k.backend_util.getPermuted(h.length,i.length,!1),p=k.backend_util.getReshapedPermuted(f.shape,i,s,!1),v=Pe({inputs:{x:f},backend:t,attrs:{shape:h}}),m=wr({inputs:{x:v},backend:t,attrs:{perm:d}}),g=Pe({inputs:{x:m},backend:t,attrs:{shape:p}});return l.push(f),l.push(v),l.push(m),l.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),g},B5e={kernelName:k.SpaceToBatchND,backendName:"webgl",kernelFunc:M5e};function L5e(n){var e=n.inputs,t=n.backend,r=e.indices,a=e.values,i=e.denseShape,o=e.defaultValue;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         `.concat(i.shape));if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         `.concat(r.shape));if(a.shape.length!==1)throw new Error(`Values must be a vector, saw:
         `.concat(a.shape));if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        `.concat(o.shape));var s=t.readSync(r.dataId),u=t.readSync(a.dataId),c=t.readSync(i.dataId),l=t.readSync(o.dataId)[0],f=Te(A$e(s,r.shape,r.dtype,u,a.dtype,c,l),5),h=f[0],d=f[1],p=f[2],v=f[3],m=f[4];return[t.makeTensorInfo(d,r.dtype,h),t.makeTensorInfo([d[0]],a.dtype,p),t.makeTensorInfo([v.length],"bool",new Uint8Array(v.map(function(g){return Number(g)}))),t.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}var z5e={kernelName:k.SparseFillEmptyRows,backendName:"webgl",kernelFunc:L5e};function $5e(n){var e=n.inputs,t=n.backend,r=e.inputIndices,a=e.inputShape,i=e.newShape;if(r.shape.length!==2)throw new Error("Input indices should be a matrix but received shape ".concat(r.shape));if(a.shape.length!==1)throw new Error("Input shape should be a vector but received shape ".concat(a.shape));if(i.shape.length!==1)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(t.readSync(a.dataId)),s=t.readSync(r.dataId),u=Array.from(t.readSync(i.dataId)),c=Te(D$e(s,r.shape,r.dtype,o,u),3),l=c[0],f=c[1],h=c[2];return[t.makeTensorInfo(f,r.dtype,l),t.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}var q5e={kernelName:k.SparseReshape,backendName:"webgl",kernelFunc:$5e};function W5e(n){var e=n.inputs,t=n.backend,r=e.data,a=e.indices,i=e.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              `.concat(i.shape));var o=t.readSync(r.dataId),s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=Te(gq(o,r.shape,r.dtype,s,u,!0),2),l=c[0],f=c[1];return t.makeTensorInfo(f,r.dtype,l)}var V5e={kernelName:k.SparseSegmentMean,backendName:"webgl",kernelFunc:W5e};function G5e(n){var e=n.inputs,t=n.backend,r=e.data,a=e.indices,i=e.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             `.concat(i.shape));var o=t.readSync(r.dataId),s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=Te(gq(o,r.shape,r.dtype,s,u),2),l=c[0],f=c[1];return t.makeTensorInfo(f,r.dtype,l)}var U5e={kernelName:k.SparseSegmentSum,backendName:"webgl",kernelFunc:G5e};function H5e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.sparseIndices,i=e.sparseValues,o=e.defaultValue,s=r.outputShape,u=k.backend_util.calculateShapes(i,a,s),c=u.sliceRank,l=u.numUpdates,f=u.sliceSize,h=u.strides,d=u.outputSize,p=!1;if(i.dtype==="string"){var v=t.bufferSync(a),m=t.bufferSync(i),g=k.util.decodeString(t.readSync(o.dataId)[0]),y=E$e(v,m,s,d,f,l,c,h,g,p);return t.makeTensorInfo(s,y.dtype,y.values)}var b=new Xq(l,c,a.shape.length,i.shape.length,h,[d,1],p),w=t.runWebGLProgram(b,[i,a,o],i.dtype),x=Pe({inputs:{x:w},backend:t,attrs:{shape:s}});return t.disposeIntermediateTensorInfo(w),x}var K5e={kernelName:k.SparseToDense,backendName:"webgl",kernelFunc:H5e};function j5e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.numOrSizeSplits,o=r.axis,s=k.util.parseAxisParam(o,a.shape)[0],u=k.backend_util.prepareSplitSize(a,i,s),c=a.shape.length,l=new Array(c).fill(0),f=a.shape.slice();return u.map(function(h){var d=dn([],Te(f),!1);d[s]=h;var p=Jc({inputs:{x:a},backend:t,attrs:{begin:l,size:d}});return l[s]+=h,p})}var X5e={kernelName:k.SplitV,backendName:"webgl",kernelFunc:j5e};var m$="return sqrt(x);",Y5e=Nt({opSnippet:m$,packedOpSnippet:m$,cpuKernelImpl:_$e}),Z5e={kernelName:k.Sqrt,backendName:"webgl",kernelFunc:Y5e};var J5e="return x * x;",Q5e=Nt({opSnippet:J5e}),eKe={kernelName:k.Square,backendName:"webgl",kernelFunc:Q5e};var g$="return (a - b) * (a - b);",tKe=or({opSnippet:g$,packedOpSnippet:g$}),nKe={kernelName:k.SquaredDifference,backendName:"webgl",kernelFunc:tKe};function rKe(n){var e=n.inputs,t=n.attrs,r=n.backend,a=e.x,i=Xa+`
    return x > 0.0 ? 1.0 : float(`.concat(t.alpha,`);
  `),o=new Mi(a.shape,i);return r.runWebGLProgram(o,[a],a.dtype)}var aKe={kernelName:k.Step,backendName:"webgl",kernelFunc:rKe};var iKe=function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=r;var a=r.length,i=Wt(r.length),o=Wt(r.length),s="";if(a===1)s="coords * strides + begin";else{var u=0;s=r.map(function(c,l){return u++,r.length===1?"coords * strides[".concat(l,"] + begin[").concat(l,"]"):"coords[".concat(u-1,"] * strides[").concat(l,"] + begin[").concat(l,"]")}).join(",")}this.userCode=`
      `.concat(i," begin = ").concat(i,"(").concat(e,`);
      `).concat(i," strides = ").concat(i,"(").concat(t,`);

      void main() {
        `).concat(o,` coords = getOutputCoords();
        setOutput(getX(`).concat(s,`));
      }
    `)}return n}();function oKe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.begin,o=r.end,s=r.strides,u=r.beginMask,c=r.endMask,l=r.ellipsisMask,f=r.newAxisMask,h=r.shrinkAxisMask,d=k.slice_util.sliceInfo(a.shape,i,o,s,u,c,l,f,h),p=d.finalShapeSparse,v=d.finalShape,m=d.isIdentity,g=d.sliceDim0,y=d.isSimpleSlice,b=d.begin,w=d.end,x=d.strides,N;if(m)N=Pe({inputs:{x:a},backend:t,attrs:{shape:v}});else if(g||y){k.util.assert(a.shape.length>=1,function(){return"Input must have rank at least 1, got: ".concat(a.shape.length)});var T=k.slice_util.computeOutShape(b,w,x),E=Jc({inputs:{x:a},backend:t,attrs:{begin:b,size:T}});N=Pe({inputs:{x:E},backend:t,attrs:{shape:v}}),t.disposeIntermediateTensorInfo(E)}else{var C=t.shouldExecuteOnCPU([a]);if(C){var F=t.readSync(a.dataId),_=k.buffer(a.shape,a.dtype,F),O=F$e(p,_,x,b);N=t.makeTensorInfo(v,a.dtype,O.values)}else{var L=new iKe(b,x,p);N=t.runWebGLProgram(L,[a],a.dtype)}}var z=Pe({inputs:{x:N},backend:t,attrs:{shape:v}});return t.disposeIntermediateTensorInfo(N),z}var sKe={kernelName:k.StridedSlice,backendName:"webgl",kernelFunc:oKe};function uKe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,c=r.preserveShortSequences,l=e.data,f=e.dataSplits,h=t.readSync(l.dataId),d=t.readSync(f.dataId),p=Te(R$e(h,d,a,i,o,s,u,c),2),v=p[0],m=p[1];return[t.makeTensorInfo([v.length],"string",v),t.makeTensorInfo(f.shape,"int32",m)]}var cKe={kernelName:k.StringNGrams,backendName:"webgl",kernelFunc:uKe};function lKe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.skipEmpty,i=e.input,o=e.delimiter;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error("Input must be a vector, got shape: ".concat(i.shape));if(o.shape.length!==0)throw new Error("Delimiter must be a scalar, got shape: ".concat(o.shape));var s=t.readSync(i.dataId),u=t.readSync(o.dataId)[0],c=Te(O$e(s,u,a),3),l=c[0],f=c[1],h=c[2],d=f.length;return[t.makeTensorInfo([d,2],"int32",l),t.makeTensorInfo([d],"string",f),t.makeTensorInfo([2],"int32",new Int32Array(h))]}var fKe={kernelName:k.StringSplit,backendName:"webgl",kernelFunc:lKe};function hKe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.numBuckets,i=e.input;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");var o=t.readSync(i.dataId),s=P$e(o,a);return t.makeTensorInfo(i.shape,"int32",s)}var dKe={kernelName:k.StringToHashBucketFast,backendName:"webgl",kernelFunc:hKe};var pKe="return tan(x);",vKe=Nt({opSnippet:pKe}),mKe={kernelName:k.Tan,backendName:"webgl",kernelFunc:vKe};var gKe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,yKe=Nt({opSnippet:gKe}),bKe={kernelName:k.Tanh,backendName:"webgl",kernelFunc:yKe};var wKe=function(){function n(e,t){this.variableNames=["A"];for(var r=new Array(e.length),a=0;a<r.length;a++)r[a]=e[a]*t[a];this.outputShape=r,this.rank=r.length;var i=Wt(this.rank),o=xKe(e);this.userCode=`
      void main() {
        `.concat(i,` resRC = getOutputCoords();
        setOutput(getA(`).concat(o,`));
      }
    `)}return n}();function xKe(n){var e=n.length;if(e>5)throw Error("Tile for rank ".concat(e," is not yet supported"));if(e===1)return"imod(resRC, ".concat(n[0],")");for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<n.length;a++)r.push("imod(".concat(t[a],", ").concat(n[a],")"));return r.join()}function Yq(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.reps;if(a.dtype==="string"||a.shape.length>5){var o=t.readSync(a.dataId),s=a.dtype==="string"?o.map(function(h){return k.util.decodeString(h)}):o,u=k.buffer(a.shape,a.dtype,s),c=B$e(u,i);return t.makeTensorInfo(c.shape,c.dtype,c.values)}var l=new wKe(a.shape,i),f=t.runWebGLProgram(l,[a],a.dtype);return f}var kKe={kernelName:k.Tile,backendName:"webgl",kernelFunc:Yq},SKe=function(){function n(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}return n}(),NKe=function(){function n(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}return n}();function lu(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function y$(n){for(var e=1;e<n;)e*=2;return e}function TKe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.k,o=r.sorted,s=k.env().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=k.env().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=a.shape,l=c[c.length-1];if(t.shouldExecuteOnCPU([a])||l<s||i>u){var f=t.readSync(a.dataId),h=Te(L$e(f,c,a.dtype,i,o),2),d=h[0],p=h[1];return[t.makeTensorInfo(d.shape,d.dtype,d.values),t.makeTensorInfo(p.shape,p.dtype,p.values)]}if(i===0)return c[c.length-1]=0,[t.makeTensorInfo(c,a.dtype,[]),t.makeTensorInfo(c,"int32",[])];if(l===1)return[a,Sh({attrs:{shape:c,dtype:"int32",value:0},backend:t})];var v=t.texData.get(a.dataId),m=v!==null&&v.isPacked,g=m?t.unpackTensor(a):a,y=k.util.sizeFromShape(c),b=y/l,w=Pe({inputs:{x:g},attrs:{shape:[b,l]},backend:t});m&&lu(t,g);for(var x=y$(i),N=y$(l),T=null,E=function(){return T===null?[w,w]:[w,T]},C=function(ne,oe,le){var pe=E(),xe=new SKe(le),he=T===null?1:0,ye=[[l],[he],[Number.NEGATIVE_INFINITY],[ne],[oe]],we=T;T=t.runWebGLProgram(xe,pe,"int32",ye),lu(t,we)},F=1;F<x;F*=2)for(var _=F*2,O=F;O>=1;O/=2)C(_,O,[b,N]);for(var L=N;L>x;L/=2){var z=E(),$=new NKe([b,L/2]),B=T===null?1:0,W=[[l],[B],[x]],X=T;T=t.runWebGLProgram($,z,"int32",W),lu(t,X);for(var F=x/2,_=F*2,O=F;O>=1;O/=2)C(_,O,T.shape)}var Z=T;T=Jc({inputs:{x:T},backend:t,attrs:{begin:0,size:[b,i]}}),lu(t,Z);var V=qq({inputs:{x:w,indices:T},backend:t,attrs:{axis:1,batchDims:1}});lu(t,w);var j=c.slice(0,-1);j.push(i),Z=T,T=Pe({inputs:{x:T},attrs:{shape:j},backend:t}),lu(t,Z);var re=V;return V=Pe({inputs:{x:V},attrs:{shape:j},backend:t}),lu(t,re),[V,T]}var EKe={kernelName:k.TopK,backendName:"webgl",kernelFunc:TKe};var IKe=function(){function n(e,t,r,a,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;var s=r==="nearest"?1:2,u;switch(a){case"constant":u=1;break;case"reflect":u=2;break;case"wrap":u=3;break;case"nearest":u=4;break;default:u=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(`.concat(u,` == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (`).concat(u,` == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (`).concat(u,` == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < `).concat(e," && 0 <= coordX && coordX < ").concat(t,`) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(`).concat(i,`);
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(`).concat(i,`);
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(`).concat(t,`));
                float mapY = mapCoord(inY, float(`).concat(e,`));

                if (`).concat(s,` == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `)}return n}();function CKe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.image,i=e.transforms,o=r.interpolation,s=r.fillMode,u=r.fillValue,c=r.outputShape,l=Te(a.shape,4),f=l[0],h=l[1],d=l[2],p=l[3],v=Te(c??[h,d],2),m=v[0],g=v[1],y=[f,m,g,p],b=new IKe(h,d,o,s,u,y);return t.runWebGLProgram(b,[a,i],"float32")}var AKe={kernelName:k.Transform,backendName:"webgl",kernelFunc:CKe};function DKe(n){var e=n.inputs,t=n.attrs,r=n.backend,a=t.axis,i=e.x;Hc(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=r.readSync(i.dataId),s=z$e(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[r.makeTensorInfo(c,i.dtype,u),r.makeTensorInfo([l.length],"int32",l)]}var _Ke={kernelName:k.Unique,backendName:"webgl",kernelFunc:DKe};function FKe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],c=new Array(s-1),l=0,f=0;f<s;f++)f!==i&&(c[l++]=o.shape[f]);var h=[],d=new Array(s).fill(0),p=o.shape.slice();p[i]=1;for(var v=new Array(u),f=0;f<v.length;f++){d[i]=f;var m=Jc({inputs:{x:o},backend:t,attrs:{begin:d,size:p}}),g=Pe({inputs:{x:m},backend:t,attrs:{shape:c}});v[f]=g,h.push(m)}return h.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),v}var RKe={kernelName:k.Unpack,backendName:"webgl",kernelFunc:FKe};var OKe=function(){function n(e,t){this.variableNames=["x","segmentIds"];var r=e.windowSize,a=e.batchSize,i=e.inSize,o=e.numSegments,s=o*Math.ceil(i/r);this.outputShape=[a,s];var u="0.0",c="sumValue",l=Math.floor(r/4)*4,f=r%4,h=`
        sumValue += dot(values, segFilter);
    `,d="";i%r>0&&(d=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return initializationValue;
        }
      `));var p="";i%r>0&&(p=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return -1.0;
        }
      `)),this.userCode=`
      const float initializationValue = `.concat(u,`;

      float getValue(int batch, int inIdx) {
        `).concat(d,`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `).concat(p,`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `).concat(o,")) * float(").concat(r,`));
        int currentSeg = int(mod(float(outIdx), float(`).concat(o,`)));

        float sumValue = 0.0;

        for (int i = 0; i < `).concat(l,`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `).concat(h,`
        }

        int inIdx = inOffset + `).concat(l,`;
        if (`).concat(f===1,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `).concat(h,`
        } else if (`).concat(f===2,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `).concat(h,`
        } else if (`).concat(f===3,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `).concat(h,`
        }
        setOutput(`).concat(c,`);
      }
    `)}return n}();function PKe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.segmentIds,o=r.numSegments,s=a.shape.length,u=[],c=0,l=k.backend_util.getAxesPermutation([c],s),f=a;l!=null&&(f=wr({inputs:{x:a},backend:t,attrs:{perm:l}}),u.push(f),c=k.backend_util.getInnerMostAxes(1,s)[0]);var h=k.backend_util.segment_util.computeOutShape(f.shape,c,o),d=k.util.sizeFromShape([f.shape[c]]),p=Pe({inputs:{x:f},backend:t,attrs:{shape:[-1,d]}});u.push(p);var v=k.sumOutType(a.dtype),m=function(x,N,T,E,C){var F=x.shape[0],_=x.shape[1],O=k.backend_util.segment_util.segOpComputeOptimalWindowSize(_,C),L={windowSize:O,inSize:_,batchSize:F,numSegments:C},z=new OKe(L,N),$=t.compileAndRun(z,[x,T],E);if(u.push($),$.shape[1]===C)return $;var B=jq({backend:t,attrs:{start:0,stop:C,step:1,dtype:"float32"}}),W=Yq({inputs:{x:B},backend:t,attrs:{reps:[_/O]}});u.push(B),u.push(W);var X=m($,N,W,E,C);return X},g=m(p,"unsortedSegmentSum",i,v,o),y=Pe({inputs:{x:g},backend:t,attrs:{shape:h}}),b=y;if(l!=null){u.push(y);var w=k.backend_util.getUndoAxesPermutation(l);b=wr({inputs:{x:b},backend:t,attrs:{perm:w}})}return u.forEach(function(x){return t.disposeIntermediateTensorInfo(x)}),b}var MKe={kernelName:k.UnsortedSegmentSum,backendName:"webgl",kernelFunc:PKe},Sx,b$,BKe=[Fqe,Oqe,Bqe,$qe,Wqe,Uqe,Kqe,Xqe,Qqe,tWe,aWe,sWe,lWe,pWe,gWe,bWe,xWe,TWe,IWe,AWe,RWe,$We,WWe,GWe,YWe,JWe,nVe,vqe,iVe,lVe,pVe,wVe,kVe,NVe,EVe,CVe,_Ve,OVe,BVe,zVe,qVe,VVe,HVe,jVe,JVe,eGe,rGe,oGe,uGe,hGe,mGe,wGe,SGe,EGe,IGe,AGe,_Ge,RGe,PGe,BGe,qGe,GGe,KGe,XGe,JGe,tUe,iUe,cUe,pqe,fUe,uVe,pUe,gUe,wUe,gqe,NUe,CUe,DUe,OUe,BUe,qUe,GUe,jUe,JUe,t6e,r6e,s6e,c6e,f6e,v6e,g6e,b6e,x6e,S6e,I6e,_6e,P6e,V6e,wqe,K6e,Y6e,Q6e,nHe,HWe,iHe,sHe,cHe,hHe,mHe,bqe,yHe,wHe,kHe,NHe,THe,KWe,z6e,CHe,FHe,MHe,kqe,$He,VHe,KHe,YHe,e5e,n5e,i5e,u5e,l5e,d5e,m5e,b5e,S5e,E5e,A5e,F5e,LWe,q6e,P5e,B5e,z5e,q5e,V5e,U5e,K5e,X5e,Z5e,eKe,nKe,aKe,sKe,cKe,fKe,dKe,$6e,Aqe,mKe,bKe,kKe,EKe,AKe,Dqe,_Ke,RKe,MKe,oHe];try{for(sh=ra(BKe),qc=sh.next();!qc.done;qc=sh.next())w$=qc.value,k.registerKernel(w$)}catch(n){Sx={error:n}}finally{try{qc&&!qc.done&&(b$=sh.return)&&b$.call(sh)}finally{if(Sx)throw Sx.error}}var w$,sh,qc;Bi.GPGPUContext=im;Bi.MathBackendWebGL=Vx;Bi.forceHalfFloat=wq;Bi.gpgpu_util=jLe;Bi.setWebGLContext=x$;Bi.version_webgl=hqe;Bi.webgl=dqe;Bi.webgl_util=eLe});var $h=Y(xu=>{"use strict";Object.defineProperty(xu,"__esModule",{value:!0});function LKe(n){return n&&typeof n=="object"&&"default"in n?n.default:n}var Yx=Cs(),wW=OR(),zKe=LKe(wW),Zx=s4(),Jx=WB(),xW=lL(),$Ke=Gz(),qKe=Zq(),kW="Abs",SW="Acos",NW="Acosh",mk="Add",WKe="AddN",VKe="All",GKe="Any",TW="ArgMax",EW="ArgMin",IW="Asin",CW="Asinh",AW="Atan",DW="Atanh",_W="Atan2",FW="AvgPool",UKe="AvgPoolGrad",HKe="AvgPool3D",KKe="AvgPool3DGrad",RW="BatchMatMul",OW="BatchToSpaceND",jKe="BroadcastTo",gk="Cast",PW="Ceil",MW="ClipByValue",XKe="Complex",BW="ComplexAbs",LW="Concat",zW="Conv2D",YKe="Conv2DBackpropFilter",$W="Conv2DBackpropInput",ZKe="Conv3D",JKe="Conv3DBackpropFilterV2",QKe="Conv3DBackpropInputV2",qW="Cos",WW="Cosh",eje="Cumprod",VW="Cumsum",tje="DepthToSpace",GW="DepthwiseConv2dNative",nje="DepthwiseConv2dNativeBackpropFilter",rje="DepthwiseConv2dNativeBackpropInput",UW="Dilation2D",aje="Dilation2DBackpropInput",ije="Dilation2DBackpropFilter",HW="RealDiv",KW="Elu",oje="EluGrad",jW="Erf",sje="Equal",XW="Exp",YW="ExpandDims",ZW="Expm1",uje="FFT",cje="Fill",JW="Floor",QW="FloorDiv",eV="FusedBatchNorm",tV="GatherV2",lje="Greater",nV="GreaterEqual",yk="Identity",fje="IFFT",hje="Imag",rV="IsFinite",aV="IsInf",iV="IsNan",oV="LeakyRelu",dje="Less",pje="LessEqual",sV="Log",uV="Log1p",vje="LogicalAnd",mje="LogicalNot",gje="LogicalOr",yje="LogSoftmax",cV="LRN",bje="LRNGrad",lV="Max",fV="Maximum",hV="MaxPool",wje="MaxPoolGrad",xje="MaxPool3D",kje="MaxPool3DGrad",dV="Mean",pV="Min",vV="Minimum",mV="MirrorPad",gV="Mod",yV="Multiply",bV="Neg",Sje="NotEqual",wV="OnesLike",xV="OneHot",kV="Pack",SV="PadV2",NV="Pow",TV="Prelu",EV="Prod",Nje="Real",IV="Reciprocal",CV="Relu",AV="Reshape",DV="ResizeNearestNeighbor",Tje="ResizeNearestNeighborGrad",_V="ResizeBilinear",Eje="ResizeBilinearGrad",FV="Relu6",RV="Reverse",OV="Round",PV="Rsqrt",MV="Select",BV="Selu",LV="Slice",zV="Sin",$V="Sinh",qV="Sign",WV="Sigmoid",VV="Softplus",GV="Sqrt",UV="Sum",HV="SpaceToBatchND",KV="SplitV",jV="Softmax",XV="SquaredDifference",Ije="Square",Cje="StridedSlice",YV="Sub",ZV="Tan",JV="Tanh",bk="Tile",Aje="TopK",pm="Transpose",Dje="Unique",QV="Unpack",eG="UnsortedSegmentSum",tG="ZerosLike",nG="Step";var _je=1e-7,Fje=1e-4,Qx=class{refCount(e){return ia("refCount")}incRef(e){return ia("incRef")}timerAvailable(){return!0}time(e){return ia("time")}read(e){return ia("read")}readSync(e){return ia("readSync")}readToGPU(e,t){return ia("readToGPU")}numDataIds(){return ia("numDataIds")}disposeData(e,t){return ia("disposeData")}write(e,t,r){return ia("write")}move(e,t,r,a,i){return ia("move")}createTensorFromGPUData(e,t,r){return ia("createTensorFromGPUData")}memory(){return ia("memory")}floatPrecision(){return ia("floatPrecision")}epsilon(){return this.floatPrecision()===32?_je:Fje}dispose(){return ia("dispose")}};function ia(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function ie(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function Rje(n,e,t=""){ie(wk(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function lo(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function wk(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function _h(n){return n%1===0}function vm(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function $i(n,e){let t=e.length;return n=n==null?e.map((r,a)=>a):[].concat(n),ie(n.every(r=>r>=-t&&r<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),ie(n.every(r=>_h(r)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(r=>r<0?t+r:r)}function Oje(n,e){let t=[],r=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:$i(e,n).sort(),o=0;for(let s=0;s<n.length;++s){if(i!=null){if(i[o]===s&&n[s]!==1)throw new Error(`Can't squeeze axis ${s} since its dim '${n[s]}' is not 1`);(i[o]==null||i[o]>s)&&n[s]===1&&(t.push(n[s]),r.push(s)),i[o]<=s&&o++}n[s]!==1&&(t.push(n[s]),r.push(s))}return{newShape:t,keptDims:r}}function Pje(n,e){for(let t=0;t<n.length;t++){let r=n[t];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}function Mje(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function ek(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function Bje(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function xk(n){return typeof n=="string"||n instanceof String}function Lje(n){return typeof n=="boolean"}function zje(n){return typeof n=="number"}function kk(n){return Array.isArray(n)?kk(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":zje(n)?"float32":xk(n)?"string":Lje(n)?"bool":"float32"}function tk(n){return!!(n&&n.constructor&&n.call&&n.apply)}function rG(n){let e=n.length;if(e<2)return[];let t=new Array(e-1);t[e-2]=n[e-1];for(let r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function aG(n,e,t,r=!1){let a=new Array;if(e.length===1){let i=e[0]*(r?2:1);for(let o=0;o<i;o++)a[o]=t[n+o]}else{let i=e[0],o=e.slice(1),s=o.reduce((u,c)=>u*c)*(r?2:1);for(let u=0;u<i;u++)a[u]=aG(n+u*s,o,t,r)}return a}function Jq(n,e,t=!1){if(n.length===0)return e[0];let r=n.reduce((a,i)=>a*i)*(t?2:1);if(r===0)return[];if(r!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return aG(0,n,e,t)}function iG(n,e){let t=Sk(n,e);for(let r=0;r<t.length;r++)t[r]=1;return t}function Sk(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function zh(n){n.forEach(e=>{ie(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function Nk(n){return n&&n.then&&typeof n.then=="function"}var Qq="tfjsflags",nk=class{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=$je,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(xn().getBool("IS_TEST")||xn().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){let a=this.urlFlags[e];xn().getBool("IS_TEST")||xn().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${a}.`),this.set(e,a)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];let t=this.evaluateFlag(e);if(Nk(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;let e=this.getQueryParams(this.global.location.search);Qq in e&&e[Qq].split(",").forEach(r=>{let[a,i]=r.split(":");this.urlFlags[a]=Wje(a,i)})}};function $je(n){let e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...r)=>(qje(e,r[0],r[1]),r.join("="))),e}function qje(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Wje(n,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if(`${+e}`===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${n}.`)}function xn(){return oG}var oG=null;function Vje(n){oG=n}var Kx;function sG(){if(Kx==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");Kx=n}return Kx}function Gje(){let n=sG();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function Tk(n,e){let t=Gje();if(t.has(n))return t.get(n);{let r=e();return t.set(n,r),t.get(n)}}function Qc(...n){xn().getBool("IS_TEST")||xn().getBool("PROD")||console.warn(...n)}var uG=Tk("kernelRegistry",()=>new Map),rk=Tk("gradRegistry",()=>new Map);function eW(n,e){let t=Hje(n,e);return uG.get(t)}function tW(n){return rk.get(n)}function nW(n){let e=uG.entries(),t=[];for(;;){let{done:r,value:a}=e.next();if(r)break;let[i,o]=a,[s]=i.split("_");s===n&&t.push(o)}return t}function Uje(n){let{kernelName:e}=n;rk.has(e)&&xn().getBool("DEBUG")&&Qc(`Overriding the gradient for '${e}'`),rk.set(e,n)}function Hje(n,e){return`${e}_${n}`}var Kje=zKe||wW;function Ek(n){return Kje.fromString(n,!0,16)}var rot=Ek("c3a5c85c97cb3127"),aot=Ek("b492b66fbe98f273"),iot=Ek("9ae16a3b2f90404f");function jje(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function cG(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Fh(n)),xn().getBool("DEBUG")&&Pje(n,e),jje(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){let t=new Uint8Array(n.length);for(let r=0;r<t.length;++r)Math.round(n[r])!==0&&(t[r]=1);return t}else throw new Error(`Unknown data type ${e}`)}function bm(){return xn().platform.now()}function Xje(n,e="utf-8"){return e=e||"utf-8",xn().platform.encode(n,e)}function rW(n,e="utf-8"){return e=e||"utf-8",xn().platform.decode(n,e)}function ki(n){return xn().platform.isTypedArray(n)}function Fh(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||Nk(n)||n==null||ki(n)&&t)e.push(n);else if(Array.isArray(n)||ki(n))for(let r=0;r<n.length;++r)Fh(n[r],e,t);else{let r=-1;for(let a of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(a)&&(r=Math.max(r,Number(a)));for(let a=0;a<=r;a++)Fh(n[a],e,t)}return e}var ak=class{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new ik)}profileKernel(e,t,r){let a,i=()=>{a=r()},o,s=bm();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(let c of a)c.dataSync();o=Promise.resolve({kernelMs:bm()-s})}if(xn().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<a.length;c++){let l=a[c];l.data().then(f=>{Yje(f,l.dtype,e)})}return{kernelName:e,outputs:a,inputs:t,timeMs:o.then(c=>c.kernelMs),extraInfo:o.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){let{kernelName:t,outputs:r,timeMs:a,inputs:i,extraInfo:o}=e;r.forEach(s=>{Promise.all([s.data(),a,o]).then(u=>{this.logger.logKernelProfile(t,s,u[0],u[1],i,u[2])})})}};function Yje(n,e,t){if(e!=="float32")return!1;for(let r=0;r<n.length;r++){let a=n[r];if(isNaN(a)||!isFinite(a))return console.warn(`Found ${a} in the result of '${t}'`),!0}return!1}var ik=class{logKernelProfile(e,t,r,a,i,o){let s=typeof a=="number"?vm(`${a}ms`,9):a.error,u=vm(e,25),c=t.rank,l=t.size,f=vm(t.shape.toString(),14),h="";for(let d in i){let p=i[d];if(p!=null){let v=p.shape||t.shape,m=v.length;h+=`${d}: ${m}D ${m>0?v:""} `}}console.log(`%c${u}	%c${s}	%c${c}D ${f}	%c${l}	%c${h}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};function Zje(n,e,t){let r={},a={};for(let u=0;u<e.length;u++)r[e[u].id]=!0;for(let u=0;u<n.length;u++){let c=n[u],l=c.inputs;for(let f in l){let h=l[f],d=!1;for(let p=0;p<e.length;p++)if(r[h.id]){c.outputs.forEach(v=>r[v.id]=!0),d=!0,a[c.id]=!0;break}if(d)break}}let i={};i[t.id]=!0;let o={};for(let u=n.length-1;u>=0;u--){let c=n[u],l=c.inputs;for(let f=0;f<c.outputs.length;f++)if(i[c.outputs[f].id]){for(let h in l)i[l[h].id]=!0,o[c.id]=!0;break}}let s=[];for(let u=0;u<n.length;u++){let c=n[u];if(a[c.id]&&o[c.id]){let l={};for(let h in c.inputs){let d=c.inputs[h];r[d.id]&&(l[h]=d)}let f=Object.assign({},c);f.inputs=l,f.outputs=c.outputs,s.push(f)}}return s}function Jje(n,e,t,r){for(let a=e.length-1;a>=0;a--){let i=e[a],o=[];if(i.outputs.forEach(u=>{let c=n[u.id];c!=null?o.push(c):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);let s=i.gradient(o);for(let u in i.inputs){if(!(u in s))throw new Error(`Cannot backprop through input ${u}. Available gradients found: ${Object.keys(s)}.`);let c=t(()=>s[u]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${u} must have 'float32' dtype, but has '${c.dtype}'`);let l=i.inputs[u];if(!wk(c.shape,l.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${u}' has shape '${c.shape}', which does not match the shape of the input '${l.shape}'`);if(n[l.id]==null)n[l.id]=c;else{let f=n[l.id];n[l.id]=r(f,c),f.dispose()}}}}var aW=20,Nh=3,jx=7;function Qje(n,e,t,r){let a=rG(e),i=e8e(n,e,t,a),o=e.length,s=mm(n,e,t,a,i),u=["Tensor"];return r&&(u.push(`  dtype: ${t}`),u.push(`  rank: ${o}`),u.push(`  shape: [${e}]`),u.push("  values:")),u.push(s.map(c=>"    "+c).join(`
`)),u.join(`
`)}function e8e(n,e,t,r){let a=lo(e),i=r[r.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?Ah(n):n;if(s>1)for(let c=0;c<a/i;c++){let l=c*i;for(let f=0;f<i;f++)o[f]=Math.max(o[f],Ch(u[l+f],0,t).length)}return o}function Ch(n,e,t){let r;return Array.isArray(n)?r=`${parseFloat(n[0].toFixed(jx))} + ${parseFloat(n[1].toFixed(jx))}j`:xk(n)?r=`'${n}'`:t==="bool"?r=lG(n):r=parseFloat(n.toFixed(jx)).toString(),vm(r,e)}function lG(n){return n===0?"false":"true"}function mm(n,e,t,r,a,i=!0){let o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){let v=Ah(n);return[Ch(v[0],0,t)]}return t==="bool"?[lG(n[0])]:[n[0].toString()]}if(u===1){if(s>aW){let m=Nh*o,g=Array.from(n.slice(0,m)),y=Array.from(n.slice((s-Nh)*o,s*o));return t==="complex64"&&(g=Ah(g),y=Ah(y)),["["+g.map((b,w)=>Ch(b,a[w],t)).join(", ")+", ..., "+y.map((b,w)=>Ch(b,a[s-Nh+w],t)).join(", ")+"]"]}let v=t==="complex64"?Ah(n):Array.from(n);return["["+v.map((m,g)=>Ch(m,a[g],t)).join(", ")+"]"]}let c=e.slice(1),l=r.slice(1),f=r[0]*o,h=[];if(s>aW){for(let v=0;v<Nh;v++){let m=v*f,g=m+f;h.push(...mm(n.slice(m,g),c,t,l,a,!1))}h.push("...");for(let v=s-Nh;v<s;v++){let m=v*f,g=m+f;h.push(...mm(n.slice(m,g),c,t,l,a,v===s-1))}}else for(let v=0;v<s;v++){let m=v*f,g=m+f;h.push(...mm(n.slice(m,g),c,t,l,a,v===s-1))}let d=u===2?",":"";h[0]="["+(s>0?h[0]+d:"");for(let v=1;v<h.length-1;v++)h[v]=" "+h[v]+d;let p=`,
`;for(let v=2;v<u;v++)p+=`
`;return h[h.length-1]=" "+h[h.length-1]+"]"+(i?"":p),h}function Ah(n){let e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var Li=null,Th=null,t8e=null;function n8e(n){Li=n}function r8e(n){t8e=n}var Sr=class{constructor(e,t,r,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=lo(e),this.strides=rG(e),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){let e=await this.data();return Th.buffer(this.shape,this.dtype,e)}bufferSync(){return Th.buffer(this.shape,this.dtype,this.dataSync())}async array(){let e=await this.data();return Jq(this.shape,e,this.dtype==="complex64")}arraySync(){return Jq(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();let e=Li().read(this.dataId);if(this.dtype==="string"){let t=await e;try{return t.map(r=>rW(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Li().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();let e=Li().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>rW(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();let e=await Li().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(Li().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Th.print(this,e)}clone(){return this.throwIfDisposed(),Th.clone(this)}toString(e=!1){let t=this.dataSync();return Qje(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Th.cast(this,e)}variable(e=!0,t,r){return this.throwIfDisposed(),Li().makeVariable(this,e,t,r)}};Object.defineProperty(Sr,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function ce(){return Tk("Tensor",()=>Sr)}ce();var tl=class extends Sr{constructor(e,t,r,a){super(e.shape,e.dtype,e.dataId,a),this.trainable=t,this.name=r}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!wk(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Li().disposeTensor(this),this.dataId=e.dataId,Li().incRef(this,null)}dispose(){Li().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(tl,Symbol.hasInstance,{value:n=>n instanceof Sr&&n.assign!=null&&n.assign instanceof Function});var iW;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(iW||(iW={}));var ok;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(ok||(ok={}));var sk;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(sk||(sk={}));var uk;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(uk||(uk={}));var ck;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(ck||(ck={}));var a8e={float32:uk,int32:ok,bool:sk,complex64:ck};function i8e(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return a8e[n][e]}function Qn(n,e){if(n.dtype===e.dtype)return[n,e];let t=i8e(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function fG(n){let e=[];return hG(n,e,new Set),e}function hG(n,e,t){if(n==null)return;if(n instanceof Sr){e.push(n);return}if(!o8e(n))return;let r=n;for(let a in r){let i=r[a];t.has(i)||(t.add(i),hG(i,e,t))}}function o8e(n){return Array.isArray(n)||typeof n=="object"}function Xx(n){return n.kernelName!=null}var wm=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(let e in this.registeredVariables)this.registeredVariables[e].dispose()}},rs=class{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new wm}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;let e=this.getSortedBackends();for(let t=0;t<e.length;t++){let r=e[t];if(await this.initializeBackend(r).success){await this.setBackend(r);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){let{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){let{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,r=1){return e in this.registryFactory?(Qc(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:r},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;let{success:t,asyncInit:r}=this.initializeBackend(e);if(!(r?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new ak(this.backendInstance),!0}setupRegisteredKernels(){nW(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){nW(e).forEach(r=>{r.disposeFunc!=null&&r.disposeFunc(this.registry[e])})}initializeBackend(e){let t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{let r=t.factory();if(r&&!(r instanceof Qx)&&typeof r.then=="function"){let a=++this.pendingBackendInitId,i=r.then(o=>a<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(a<this.pendingBackendInitId||(this.pendingBackendInit=null,Qc(`Initialization of backend ${e} failed`),Qc(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(r){return Qc(`Initialization of backend ${e} failed`),Qc(r.stack||r.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){let e=this.getSortedBackends();for(let t=0;t<e.length;t++){let r=e[t],{success:a,asyncInit:i}=this.initializeBackend(r);if(i||a)return{name:r,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){let r=this.state.tensorInfo.get(t),a=r.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),r.backend=e,e.move(t,i,r.shape,r.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let r=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}let a;return this.scopedRun(()=>this.startScope(r),()=>this.endScope(a),()=>(a=t(),a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),a))}scopedRun(e,t,r){e();try{let a=r();return t(),a}catch(a){throw t(),a}}nextTensorId(){return rs.nextTensorId++}nextVariableId(){return rs.nextVariableId++}clone(e){let t=ae.runKernel(yk,{x:e}),r={x:e},a=o=>({x:()=>{let s="float32",u={x:o},c={dtype:s};return ae.runKernel(gk,u,c)}}),i=[];return this.addTapeNode(this.state.activeScope.name,r,[t],a,i,{}),t}runKernel(e,t,r){if(this.backendName==null&&this.backend,!(eW(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:r})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,r){let a=this.backend.numDataIds(),i=0;r.forEach(u=>{i+=u.dtype==="complex64"?3:1});let o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${s} data ids) after running '${e}'`)}runKernelFunc(e){let t,r=[],a=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let s;this.backendName==null&&this.backend;let u,c=Xx(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Xx(e)){let{kernelName:p,inputs:v,attrs:m}=e;this.backendName==null&&this.backend;let g=eW(p,this.backendName);ie(g!=null,()=>`Cannot find registered kernel '${p}' for backend '${this.backendName}'`),s=()=>{let y=this.backend.numDataIds();u=g.kernelFunc({inputs:v,attrs:m,backend:this.backend});let b=Array.isArray(u)?u:[u];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(p,y,b);let w=b.map(x=>x.rank!=null?x:this.makeTensorFromTensorInfo(x));if(a){let x=this.getTensorsForGradient(p,v,w);r=this.saveTensorsForBackwardMode(x)}return w}}else{let{forwardFunc:p}=e,v=m=>{!a||(r=m.map(g=>this.keep(this.clone(g))))};s=()=>{let m=this.backend.numDataIds();u=this.tidy(()=>p(this.backend,v));let g=Array.isArray(u)?u:[u];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,m,g),g}}let{inputs:l,attrs:f}=e,h=Xx(e)?null:e.backwardsFunc,d;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=s():(d=this.profiler.profileKernel(c,l,()=>s()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(d),t=d.outputs)}),a&&this.addTapeNode(c,l,t,h,r,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(l).map(p=>l[p]!=null?l[p].shape:null),outputShapes:t.map(p=>p.shape),kernelTimeMs:d.timeMs,extraInfo:d.extraInfo}),Array.isArray(u)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(r=>this.keep(this.clone(r)))}getTensorsForGradient(e,t,r){let a=tW(e);if(a!=null){let i=a.inputsToSave||[],o=a.outputsToSave||[],s;a.saveAllInputs?(ie(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),s=Object.keys(t).map(c=>t[c])):s=i.map(c=>t[c]);let u=r.filter((c,l)=>o[l]);return s.concat(u)}return[]}makeTensor(e,t,r,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",a=a||this.backend;let i=e;r==="string"&&xk(e[0])&&(i=e.map(u=>Xje(u)));let o=a.write(i,t,r),s=new Sr(t,r,o,this.nextTensorId());if(this.trackTensor(s,a),r==="string"){let u=this.state.tensorInfo.get(o),c=Bje(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s}makeTensorFromDataId(e,t,r,a){r=r||"float32";let i={dataId:e,shape:t,dtype:r};return this.makeTensorFromTensorInfo(i,a)}makeTensorFromTensorInfo(e,t){let{dataId:r,shape:a,dtype:i}=e,o=new Sr(a,i,r,this.nextTensorId());return this.trackTensor(o,t),o}makeVariable(e,t=!0,r,a){r=r||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));let i=new tl(e,t,r,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let r=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(r=e.size*ek(e.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r})),e instanceof tl||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;let t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){let r=e.size*ek(e.dtype);this.state.numBytes-=r}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(let e in this.state.registeredVariables){let t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){let e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;let t=this.state.numBytes,r=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(a=>a.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r;for(let a of this.state.activeProfile.kernels)a.kernelTimeMs=await a.kernelTimeMs,a.extraInfo=await a.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,r,a,i,o){let s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:i},u=tW(e);u!=null&&(a=u.gradFunc),a!=null&&(s.gradient=c=>(c=c.map((l,f)=>{if(l==null){let h=r[f],d=Sk(h.size,h.dtype);return this.makeTensor(d,h.shape,h.dtype)}return l}),a(c.length>1?c:c[0],i,o))),this.state.activeTape.push(s)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){let t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){let t=fG(e),r=new Set(t.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){let o=this.state.activeScope.track[i];!o.kept&&!r.has(o.id)&&o.dispose()}let a=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(i=>{!i.kept&&i.scopeId===a.id&&this.track(i)})}gradients(e,t,r,a=!1){if(ie(t.length>0,()=>"gradients() received an empty list of xs."),r!=null&&r.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${r.dtype}'`);let i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));ie(i instanceof Sr,()=>"The result y returned by f() must be a tensor.");let o=Zje(this.state.activeTape,t,i);if(!a&&o.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let s={};s[i.id]=r??s8e(i.shape),Jje(s,o,c=>this.tidy(c),c8e);let u=t.map(c=>s[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(let l of c.saved)l.dispose()}),this.state.activeTape=null),{value:i,grads:u}})}customGrad(e){return ie(tk(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{ie(t.every(s=>s instanceof Sr),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let r,a={};t.forEach((s,u)=>{a[u]=s});let i=(s,u)=>(r=e(...t,u),ie(r.value instanceof Sr,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),ie(tk(r.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),r.value),o=(s,u)=>{let c=r.gradFunc(s,u),l=Array.isArray(c)?c:[c];ie(l.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),ie(l.every(h=>h instanceof Sr),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let f={};return l.forEach((h,d)=>{f[d]=()=>h}),f};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:a})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){let t=bm(),r=await this.backend.time(e);return r.wallMs=bm()-t,r}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new wm;for(let e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}};rs.nextTensorId=0;rs.nextVariableId=0;function s8e(n){let e=iG(lo(n),"float32");return ae.makeTensor(e,n,"float32")}function u8e(){let n=sG();if(n._tfengine==null){let e=new nk(n);n._tfengine=new rs(e)}return Vje(n._tfengine.ENV),n8e(()=>n._tfengine),n._tfengine}var ae=u8e();function c8e(n,e){let t={a:n,b:e};return ae.runKernel(mk,t)}function l8e(n,e){let t=n;if(ki(n))return e==="string"?[]:[n.length];if(typeof n=="object"){if("texture"in n){let i=n.channels||"RGBA";return[n.height,n.width*i.length]}else if("buffer"in n&&!(n.buffer instanceof ArrayBuffer))return[n.buffer.size/(e==null?4:ek(e))]}if(!Array.isArray(n))return[];let a=[];for(;Array.isArray(t)||ki(t)&&e!=="string";)a.push(t.length),t=t[0];return Array.isArray(n)&&xn().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&dG(n,a,[]),a}function dG(n,e,t){if(t=t||[],!Array.isArray(n)&&!ki(n)){ie(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}ie(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),ie(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);let r=e.slice(1);for(let a=0;a<n.length;++a)dG(n[a],r,t.concat(a))}function oW(n,e,t,r){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${r}' must be ${n} tensor, but got ${e} tensor`)}}function ee(n,e,t,r="numeric"){if(n instanceof Sr)return oW(r,n.dtype,e,t),n;let a=kk(n);if(a!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),oW(r,a,e,t),n==null||!ki(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){let u=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${u}'`)}let i=l8e(n,a);!ki(n)&&!Array.isArray(n)&&(n=[n]);let s=a!=="string"?cG(n,a):Fh(n,[],!0);return ae.makeTensor(s,i,a)}function pG(n,e,t,r="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((i,o)=>ee(i,`${e}[${o}]`,t,r))}var f8e="__op";function ue(n){let e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+f8e;let a=(...i)=>{ae.startScope(t);try{let o=r(...i);return Nk(o)&&console.error("Cannot return a Promise inside of tidy."),ae.endScope(o),o}catch(o){throw ae.endScope(null),o}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function h8e(n,e){let t=ee(n,"x","cast");if(!Mje(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");let r={x:t},a={dtype:e};return ae.runKernel(gk,r,a)}var ot=ue({cast_:h8e});function d8e(n,e){let t=ee(n,"a","mul"),r=ee(e,"b","mul");[t,r]=Qn(t,r);let a={a:t,b:r};return ae.runKernel(yV,a)}var $e=ue({mul_:d8e});function p8e(n,e=0){let r={x:ee(n,"x","step")},a={alpha:e};return ae.runKernel(nG,r,a)}var Im=ue({step_:p8e});var vG={kernelName:kW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(n,Im(ot(t,"float32"),-1))}}};function v8e(n,e){let t=ee(n,"a","floorDiv"),r=ee(e,"b","floorDiv");[t,r]=Qn(t,r);let a={a:t,b:r};return ae.runKernel(QW,a)}var mG=ue({floorDiv_:v8e});function m8e(n,e){let t=ee(n,"a","div"),r=ee(e,"b","div");if([t,r]=Qn(t,r),t.dtype==="int32"&&r.dtype==="int32")return mG(t,r);let a={a:t,b:r},i={};return ae.runKernel(HW,a,i)}var Fn=ue({div_:m8e});function g8e(n){let t={x:ee(n,"x","neg")};return ae.runKernel(bV,t)}var Nr=ue({neg_:g8e});function y8e(n,e,t,r){if(r==null)r=kk(n);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(typeof n=="object"&&("texture"in n||"buffer"in n&&!(n.buffer instanceof ArrayBuffer))){if(r!=="float32"&&r!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${r}.`);return ae.backend.createTensorFromGPUData(n,e||t,r)}if(!ki(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){zh(e);let a=lo(e),i=lo(t);ie(a===i,()=>`Based on the provided shape, [${e}], the tensor should have ${a} values but has ${i}`);for(let o=0;o<t.length;++o){let s=t[o],u=o===t.length-1?s!==lo(e.slice(o)):!0;ie(t[o]===e[o]||!u,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!ki(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=r!=="string"?cG(n,r):Fh(n,[],!0),ae.makeTensor(n,e,r)}function Jn(n,e){if((ki(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&ki(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return y8e(n,[],[],e)}function b8e(n){let t={x:ee(n,"x","sqrt","float32")};return ae.runKernel(GV,t)}var as=ue({sqrt_:b8e});function w8e(n){let e=ee(n,"x","square"),t={};return ae.runKernel("Square",{x:e},t)}var sr=ue({square_:w8e});function x8e(n,e){let t=ee(n,"a","sub"),r=ee(e,"b","sub");[t,r]=Qn(t,r);let a={a:t,b:r};return ae.runKernel(YV,a)}var fr=ue({sub_:x8e});var k8e={kernelName:SW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>{let r=sr(ot(t,"float32")),a=as(fr(Jn(1),r));return Nr(Fn(n,a))}}}};var S8e={kernelName:NW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>{let r=as(fr(sr(ot(t,"float32")),1));return Fn(n,r)}}}};function ur(n,e){let t=[];for(let r=0;r<e.length;r++){let a=n[n.length-r-1],i=e.length-r-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function Rn(n,e){let t=[],r=Math.max(n.length,e.length);for(let a=0;a<r;a++){let i=n[n.length-a-1];i==null&&(i=1);let o=e[e.length-a-1];if(o==null&&(o=1),i===1)t.unshift(o);else if(o===1)t.unshift(i);else if(i!==o){let s=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(s)}else t.unshift(i)}return t}function N8e(n,e){let r={x:ee(n,"x","reshape","string_or_numeric")},a={shape:e};return ae.runKernel(AV,r,a)}var de=ue({reshape_:N8e});function T8e(n,e=null,t=!1){let r=ee(n,"x","sum");r.dtype==="bool"&&(r=ot(r,"int32"));let a={x:r},i={axis:e,keepDims:t};return ae.runKernel(UV,a,i)}var Tt=ue({sum_:T8e});var E8e={kernelName:mk,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e,a=Rn(t.shape,r.shape);return{a:()=>{let s=n,u=ur(t.shape,a);return u.length>0&&(s=Tt(s,u)),de(s,t.shape)},b:()=>{let s=n,u=ur(r.shape,a);return u.length>0&&(s=Tt(s,u)),de(s,r.shape)}}}};var I8e={kernelName:WKe,saveAllInputs:!0,gradFunc:(n,e)=>{let t={};return e.forEach((r,a)=>{t[a]=()=>n.clone()}),t}};function C8e(n){let t={x:ee(n,"x","zerosLike")};return ae.runKernel(tG,t)}var kn=ue({zerosLike_:C8e});var A8e={kernelName:TW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>kn(t)}}};var D8e={kernelName:EW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>kn(t)}}};var _8e={kernelName:IW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Fn(n,as(fr(Jn(1),sr(ot(t,"float32")))))}}};function F8e(n,e){let t=ee(n,"a","add"),r=ee(e,"b","add");[t,r]=Qn(t,r);let a={a:t,b:r};return ae.runKernel(mk,a)}var Ya=ue({add_:F8e});var R8e={kernelName:CW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>{let r=as(Ya(Jn(1),sr(ot(t,"float32"))));return Fn(n,r)}}}};var O8e={kernelName:_W,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e,a=Rn(t.shape,r.shape);return{a:()=>{let s=Ya(sr(t),sr(r)),u=$e(n,Fn(r,s)),c=ur(t.shape,a);return c.length>0&&(u=Tt(u,c)),de(u,t.shape)},b:()=>{let s=Ya(sr(t),sr(r)),u=Nr($e(n,Fn(t,s))),c=ur(r.shape,a);return c.length>0&&(u=Tt(u,c)),de(u,r.shape)}}}};var P8e={kernelName:AW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Fn(n,Ya(sr(ot(t,"float32")),1))}}};var M8e={kernelName:DW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Fn(n,fr(Jn(1),sr(ot(t,"float32"))))}}};function B8e(n,e,t,r,a,i,o="channelsLast"){let[s,u]=Rh(e),c;if(o==="channelsLast")c=[s,u,n[3],n[3]];else if(o==="channelsFirst")c=[s,u,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return L8e(n,c,t,r,a,i,!1,o)}function L8e(n,e,t,r,a,i,o=!1,s="channelsLast"){let[u,c,l,f]=[-1,-1,-1,-1];if(s==="channelsLast")[u,c,l,f]=n;else if(s==="channelsFirst")[u,f,c,l]=n;else throw new Error(`Unknown dataFormat ${s}`);let[h,d,,p]=e,[v,m]=Rh(t),[g,y]=Rh(r),b=lk(h,g),w=lk(d,y),{padInfo:x,outHeight:N,outWidth:T}=q8e(a,c,l,v,m,b,w,i,s),E=o?p*f:p,C;return s==="channelsFirst"?C=[u,E,N,T]:s==="channelsLast"&&(C=[u,N,T,E]),{batchSize:u,dataFormat:s,inHeight:c,inWidth:l,inChannels:f,outHeight:N,outWidth:T,outChannels:E,padInfo:x,strideHeight:v,strideWidth:m,filterHeight:h,filterWidth:d,effectiveFilterHeight:b,effectiveFilterWidth:w,dilationHeight:g,dilationWidth:y,inShape:n,outShape:C,filterShape:e}}function z8e(n,e,t,r,a){r==null&&(r=$8e(n,e,t));let i=n[0],o=n[1],s=xm((i-e+2*r)/t+1,a),u=xm((o-e+2*r)/t+1,a);return[s,u]}function $8e(n,e,t,r=1){let a=lk(e,r);return Math.floor((n[0]*(t-1)-t+a)/2)}function Rh(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function lk(n,e){return e<=1?n:n+(n-1)*(e-1)}function q8e(n,e,t,r,a,i,o,s,u){let c,l,f;if(typeof n=="number"){c={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};let d=z8e([e,t],i,r,n,s);l=d[0],f=d[1]}else if(n==="same"){l=Math.ceil(e/r),f=Math.ceil(t/a);let h=Math.max(0,(l-1)*r+i-e),d=Math.max(0,(f-1)*a+o-t),p=Math.floor(h/2),v=h-p,m=Math.floor(d/2),g=d-m;c={top:p,bottom:v,left:m,right:g,type:"SAME"}}else if(n==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-i+1)/r),f=Math.ceil((t-o+1)/a);else if(typeof n=="object"){let h=u==="channelsLast"?n[1][0]:n[2][0],d=u==="channelsLast"?n[1][1]:n[2][1],p=u==="channelsLast"?n[2][0]:n[3][0],v=u==="channelsLast"?n[2][1]:n[3][1];c={top:h,bottom:d,left:p,right:v,type:h===0&&d===0&&p===0&&v===0?"VALID":"EXPLICIT"},l=xm((e-i+h+d)/r+1,s),f=xm((t-o+p+v)/a+1,s)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:c,outHeight:l,outWidth:f}}function xm(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function Oh(n){let[e,t,r]=Rh(n);return e===1&&t===1&&r===1}function il(n,e){return Oh(n)||Oh(e)}function km(n){return Rh(n).every(e=>e>0)}function Si(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")ie(_h(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(r=>{r.forEach(a=>{ie(_h(a),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${a}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}function W8e(n,e,t,r,a,i){let o=ee(n,"dy","avgPool3dGrad"),s=ee(e,"input","avgPool3dGrad"),u=o,c=s,l=!1;s.rank===4&&(l=!0,u=de(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=de(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),ie(u.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),ie(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),Si("avgPool3dGrad",a,i);let f={dy:u,input:c},h={filterSize:t,strides:r,pad:a,dimRoundingMode:i},d=ae.runKernel(KKe,f,h);return l?de(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}var V8e=ue({avgPool3dGrad_:W8e});var G8e={kernelName:HKe,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{filterSize:a,strides:i,pad:o,dimRoundingMode:s}=t;return{x:()=>V8e(n,r,a,i,o,s)}}};function U8e(n,e,t,r,a){let i=ee(n,"dy","avgPoolGrad"),o=ee(e,"input","avgPoolGrad");ie(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let s=o,u=i,c=!1;o.rank===3&&(c=!0,s=de(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=de(i,[1,i.shape[0],i.shape[1],i.shape[2]])),ie(u.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${u.rank}.`),ie(s.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${s.rank}.`);let l={dy:u,input:s},f={filterSize:t,strides:r,pad:a},h=ae.runKernel(UKe,l,f);return c?de(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var H8e=ue({avgPoolGrad_:U8e});var K8e={kernelName:FW,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{filterSize:a,strides:i,pad:o}=t;return{x:()=>H8e(n,r,a,i,o)}}};function j8e(n,e,t=!1,r=!1){let a=ee(n,"a","matMul"),i=ee(e,"b","matMul");[a,i]=Qn(a,i);let o={a,b:i},s={transposeA:t,transposeB:r};return ae.runKernel(RW,o,s)}var xa=ue({matMul_:j8e});var X8e={kernelName:RW,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{let[r,a]=e,{transposeA:i,transposeB:o}=t;return!i&&!o?{a:()=>xa(n,a,!1,!0),b:()=>xa(r,n,!0,!1)}:!i&&o?{a:()=>xa(n,a,!1,!1),b:()=>xa(n,r,!0,!1)}:i&&!o?{a:()=>xa(a,n,!1,!0),b:()=>xa(r,n,!1,!1)}:{a:()=>xa(a,n,!0,!0),b:()=>xa(n,r,!0,!0)}}};function Y8e(n,e,t){let r=ee(n,"x","spaceToBatchND");ie(r.rank>=1+e.length,()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`),ie(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),ie(r.shape.reduce((o,s,u)=>u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);let a={x:r},i={blockShape:e,paddings:t};return ae.runKernel(HV,a,i)}var Ik=ue({spaceToBatchND_:Y8e});var Z8e={kernelName:OW,gradFunc:(n,e,t)=>{let{blockShape:r,crops:a}=t;return{x:()=>Ik(n,r,a)}}};var J8e={kernelName:jKe,gradFunc:(n,e,t)=>{let r=t,a=r.inputShape,i=r.shape,o=Array.from(i);for(let u=a.length-1;u>=0;u--)if(a[u]===i[u])o[u]=1;else if(a[u]!==1)throw new Error(`broadcastTo(): [${a}] cannot be broadcast to [${i}].`);let s=[];for(let u=0;u<o.length;u++)o[u]>1&&s.push(u);return{x:()=>Tt(n,s,!0)}}};var Q8e={kernelName:gk,gradFunc:n=>({x:()=>n.clone()})};var e7e={kernelName:PW,gradFunc:n=>({x:()=>kn(n)})};function t7e(n,e){let t=ee(n,"a","greaterEqual","string_or_numeric"),r=ee(e,"b","greaterEqual","string_or_numeric");[t,r]=Qn(t,r),Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(nV,a)}var Cm=ue({greaterEqual_:t7e});function n7e(n,e){let t=ee(n,"a","lessEqual","string_or_numeric"),r=ee(e,"b","lessEqual","string_or_numeric");[t,r]=Qn(t,r),Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(pje,a)}var Am=ue({lessEqual_:n7e});function r7e(n,e){let t=ee(n,"a","logicalAnd","bool"),r=ee(e,"b","logicalAnd","bool");Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(vje,a)}var Ph=ue({logicalAnd_:r7e});function a7e(n){let t={x:ee(n,"x","clone","string_or_numeric")};return ae.runKernel(yk,t)}var gG=ue({clone_:a7e});function i7e(n,e){let t=ee(n,"broadcastTo","x"),r=t.shape;if(zh(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){let c=t.shape.slice();for(;c.length<e.length;)c.unshift(1);t=de(t,c)}let a=t.shape,i=Array.from(e);for(let c=e.length-1;c>=0;c--)if(a[c]===e[c])i[c]=1;else if(t.shape[c]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);if(i.map((c,l)=>c>1?l:-1).filter(c=>c>=0).length===0)return gG(t);let s={x:t},u={reps:i};return ae.runKernel(bk,s,u)}var gm=ue({broadcastTo_:i7e});function o7e(n,e,t){let r=ee(e,"a","where"),a=ee(t,"b","where"),i=ee(n,"condition","where","bool"),o=Rn(Rn(i.shape,r.shape),a.shape),s=gm(i,o),u=gm(r,o),c=gm(a,o),l={condition:s,t:u,e:c};return ae.runKernel(MV,l)}var fo=ue({where_:o7e});var s7e={kernelName:MW,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{clipValueMin:a,clipValueMax:i}=t;return{x:()=>fo(Ph(Cm(r,a),Am(r,i)),n,kn(n))}}};var u7e={kernelName:BW,inputsToSave:["x"],gradFunc:vG.gradFunc};function c7e(n,e,t=0){let a={x:ee(n,"x","split")},i={numOrSizeSplits:e,axis:t};return ae.runKernel(KV,a,i)}var Sm=ue({split_:c7e});var l7e={kernelName:LW,saveAllInputs:!0,gradFunc:(n,e,t)=>{let r=e.map(u=>u.shape),{axis:a}=t,i=$i(a,e[0].shape)[0],o=r.map(u=>u[i]);return Sm(n,o,i).map(u=>()=>u)}};function f7e(n,e,t,r,a,i="NHWC",o){let s=n;n.rank===3&&(s=de(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let u=e;u.rank===3&&(u=de(e,[1,e.shape[0],e.shape[1],e.shape[2]])),ie(s.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${s.shape}.`),ie(u.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`),ie(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);let c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];ie(c===t[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${t[2]}.`),ie(l===t[3],()=>`Error in conv2dDerFilter: depth of dy (${l}) must match output depth for filter (${t[3]}).`),Si("conv2dDerFilter",a,o);let f={x:s,dy:u},h={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return ae.runKernel(YKe,f,h)}var yG=ue({conv2DBackpropFilter_:f7e});function h7e(n,e,t,r,a,i="NHWC",o){ie(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let s=n,u=e,c=!1;e.rank===3&&(c=!0,u=de(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,n[0],n[1],n[2]]),ie(s.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${s.length}.`),ie(u.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`),ie(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);let l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];ie(l===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[2]}.`),ie(f===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${t.shape[3]}.`),Si("conv2dDerInput",a,o);let h={dy:u,filter:t},d={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},p=ae.runKernel($W,h,d);return c?de(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var bG=ue({conv2DBackpropInput_:h7e});var d7e={kernelName:zW,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{let[r,a]=e,{dilations:i,strides:o,pad:s,dataFormat:u}=t;return ie(Oh(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>bG(r.shape,n,a,o,s,u),filter:()=>yG(r,n,a.shape,o,s,u)}}};function p7e(n,e,t,r,a="NHWC",i=[1,1],o){let s=ee(n,"x","conv2d","float32"),u=ee(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=de(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ie(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),ie(u.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`),Si("conv2d",r,o);let f=a==="NHWC"?c.shape[3]:c.shape[1];ie(f===u.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${u.shape[2]}.`),ie(il(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),ie(km(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),ie(km(t),()=>"Error in conv2D: Strides should be larger than 0.");let h={x:c,filter:u},d={strides:t,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},p=ae.runKernel(zW,h,d);return l?de(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var Dm=ue({conv2d_:p7e});var v7e={kernelName:$W,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{let[r,a]=e,{strides:i,pad:o,dataFormat:s,dimRoundingMode:u}=t;return{dy:()=>Dm(n,a,i,o,s,1,u),filter:()=>yG(n,r,a.shape,i,o,s,u)}}};function m7e(n,e,t,r,a){let i=n;n.rank===4&&(i=de(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let o=e;o.rank===4&&(o=de(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),ie(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),ie(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),ie(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),ie(i.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${t[3]}.`),ie(o.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${t[4]}).`);let s={x:i,dy:o},u={strides:r,pad:a,filterShape:t};return ae.runKernel(JKe,s,u)}var g7e=ue({conv3DBackpropFilter_:m7e});function y7e(n,e,t,r,a){ie(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let i=n,o=e,s=!1;e.rank===4&&(s=!0,o=de(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);let u=i[4],c=o.shape[4];ie(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),ie(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),ie(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),ie(u===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${t.shape[3]}.`),ie(c===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${t.shape[4]}.`);let l={dy:o,filter:t},f={pad:a,strides:r,inputShape:i},h=ae.runKernel(QKe,l,f);return s?de(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var b7e=ue({conv3DBackpropInput_:y7e});var w7e={kernelName:ZKe,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{let{dilations:r,strides:a,pad:i}=t;ie(Oh(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);let[o,s]=e;return{x:()=>b7e(o.shape,n,s,a,i),filter:()=>g7e(o,n,s.shape,a,i)}}};function x7e(n){let t={x:ee(n,"x","sin","float32")};return ae.runKernel(zV,t)}var wG=ue({sin_:x7e});var k7e={kernelName:qW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(Nr(wG(ot(t,"float32"))),n)}}};function S7e(n){let t={x:ee(n,"x","sinh")};return ae.runKernel($V,t)}var xG=ue({sinh_:S7e});var N7e={kernelName:WW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(xG(ot(t,"float32")),n)}}};function T7e(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function E7e(n,e,t){let r=n.length+e.length,a=[],i=0,o=0;for(let s=0;s<r;s++)t.indexOf(s)===-1?a.push(n[i++]):a.push(e[o++]);return a}function I7e(n,e){let t=[],r=n.length;for(let i=0;i<r;i++)e.indexOf(i)===-1&&t.push(n[i]);let a=e.map(i=>n[i]);return[t,a]}function Nm(n,e){let t=e.map(r=>1);return E7e(n,t,e)}function kG(n,e){if(T7e(n,e))return null;let t=[];for(let r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach(r=>t.push(r)),t}function Ck(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function C7e(n,e=0,t=!1,r=!1){let i={x:ee(n,"x","cumsum")},o={axis:e,exclusive:t,reverse:r};return ae.runKernel(VW,i,o)}var SG=ue({cumsum_:C7e});function A7e(n){xn().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}r8e(A7e);function D7e(n,e){return ae.tidy(n,e)}function sW(n){fG(n).forEach(t=>t.dispose())}function _7e(n,e){let t=ee(n,"real","complex"),r=ee(e,"imag","complex");Rje(t.shape,r.shape,`real and imag shapes, ${t.shape} and ${r.shape}, must match in call to tf.complex().`);let a={real:t,imag:r};return ae.runKernel(XKe,a)}var nl=ue({complex_:_7e});function F7e(n){let t={input:ee(n,"input","imag")};return ae.runKernel(hje,t)}var Ak=ue({imag_:F7e});function R7e(n){let t={input:ee(n,"input","real")};return ae.runKernel(Nje,t)}var Tm=ue({real_:R7e});function O7e(n,e,t){let r=ee(n,"x","transpose");if(e==null&&(e=r.shape.map((o,s)=>s).reverse()),ie(r.rank===e.length,()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`),e.forEach(o=>{ie(o>=0&&o<r.rank,()=>`All entries in 'perm' must be between 0 and ${r.rank-1} but got ${e}`)}),r.rank<=1)return r.clone();let a={x:r},i={perm:e};return r.dtype==="complex64"?D7e(()=>{let o=Tm(r),s=Ak(r);return o=ae.runKernel(pm,{x:o},i),s=ae.runKernel(pm,{x:s},i),t&&(s=Nr(s)),nl(o,s)}):ae.runKernel(pm,a,i)}var gu=ue({transpose_:O7e});var P7e={kernelName:VW,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{axis:a,exclusive:i,reverse:o}=t;return{x:()=>{let s=kG([a],r.rank),u=SG(n,a,i,!o);return s!=null&&(u=gu(u,s)),u}}}};function M7e(n,e,t,r,a,i=[1,1],o){let s=n;n.rank===3&&(s=de(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let u=e;u.rank===3&&(u=de(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let c={x:s,dy:u},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return ae.runKernel(nje,c,l)}var B7e=ue({depthwiseConv2dNativeBackpropFilter_:M7e});function L7e(n,e,t,r,a,i=[1,1],o){let s=e,u=!1;e.rank===3&&(u=!0,s=de(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let c={dy:s,filter:t},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:n},f=ae.runKernel(rje,c,l);return u?de(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var z7e=ue({depthwiseConv2dNativeBackpropInput_:L7e});var $7e={kernelName:GW,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{let{dilations:r,strides:a,pad:i,dimRoundingMode:o}=t,s=r??[1,1];ie(Oh(s),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`);let[u,c]=e;return ie(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${u.rank}.`),ie(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),ie(u.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),ie(il(a,s),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${a} and dilations '${s}'.`),Si("depthwiseConv2d",i,o),{x:()=>z7e(u.shape,n,c,a,i,s,o),filter:()=>B7e(u,n,c.shape,a,i,s,o)}}};var q7e={kernelName:UW,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{let[r,a]=e,i={x:r,filter:a,dy:n},o={x:r,filter:a,dy:n};return{x:()=>ae.runKernel(aje,i,t),filter:()=>ae.runKernel(ije,o,t)}}};var W7e={kernelName:KW,outputsToSave:[!0],gradFunc:(n,e)=>{let[t]=e,r={dy:n,y:t};return{x:()=>ae.runKernel(oje,r)}}};function V7e(n){let t={x:ee(n,"x","exp")};return ae.runKernel(XW,t)}var is=ue({exp_:V7e});var G7e={kernelName:jW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e,r=$e(is(Nr(sr(t))),2/Math.sqrt(Math.PI));return{x:()=>$e(n,r)}}};var U7e={kernelName:XW,outputsToSave:[!0],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(n,t)}}};var H7e={kernelName:YW,inputsToSave:["input"],gradFunc:(n,e)=>{let[t]=e;return{input:()=>de(n,t.shape)}}};var K7e={kernelName:ZW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(n,is(t))}}};var j7e={kernelName:JW,gradFunc:n=>({x:()=>kn(n)})};var X7e={kernelName:QW,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e,a=Rn(t.shape,r.shape);return{a:()=>{let s=Fn(n,ot(r,"float32")),u=ur(t.shape,a);return u.length>0?de(Tt(s,u),t.shape):s},b:()=>{let s=$e(n,ot(t,"float32")),u=ur(r.shape,a);u.length>0&&(s=de(Tt(s,u),r.shape));let c=sr(r);return Nr(Fn(s,ot(c,"float32")))}}}};function Y7e(n){let t={x:ee(n,"x","rsqrt","float32")};return ae.runKernel(PV,t)}var NG=ue({rsqrt_:Y7e});function Z7e(n,e){let t=ee(n,"x","tile","string_or_numeric");ie(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);let r={x:t},a={reps:e};return ae.runKernel(bk,r,a)}var TG=ue({tile_:Z7e});var J7e={kernelName:eV,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{let{varianceEpsilon:r}=t,[a,i,o,s]=e,u=s??Jn(1),c=ur(i.shape,a.shape),l=[];if(i.rank===1){for(let w=0;w<a.shape.length-1;++w)l.push(a.shape[w]);l.push(1)}let f=fr(a,i),h=$e(n,u),d=NG(Ya(o,Jn(r))),p=$e($e($e(d,d),d),Jn(-.5));return{x:()=>i.rank===1?de($e($e(n,TG(de(d,[1,1,1,i.shape[0]]),l)),u),a.shape):de($e($e(n,d),u),a.shape),mean:()=>{let w=$e($e(d,Jn(-1)),h);return i.rank===1&&(w=Tt(w,c)),de(w,i.shape)},variance:()=>{let w=$e($e(p,f),h);return i.rank===1&&(w=Tt(w,c)),de(w,i.shape)},scale:()=>{let w=$e(f,d),x=$e(n,w);return i.rank===1&&(x=Tt(x,c)),de(x,i.shape)},offset:()=>{let w=n;return i.rank===1&&(w=Tt(w,c)),de(w,i.shape)}}}};function Q7e(n,e,t){let r=ee(n,"x","unsortedSegmentSum"),a=ee(e,"segmentIds","unsortedSegmentSum","int32");ie(_h(t),()=>"numSegments must be of dtype int");let i={x:r,segmentIds:a},o={numSegments:t};return ae.runKernel(eG,i,o)}var EG=ue({unsortedSegmentSum_:Q7e});var eXe={kernelName:tV,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{let[r,a]=e,{axis:i}=t,o=$i(i,r.shape)[0];return{x:()=>{let u=r.shape,c=a.size,l=u.slice(0,o),f=l.length,h=u.slice(i,u.length).slice(1),d=h.length,p=uW(0,f),v=uW(f+1,f+1+d),m=cW([l,[c],h]),g=de(n,m),y=de(a,[c]),b=cW([[f],p,v]),w=gu(g,b),x=EG(w,y,r.shape[o]),N=Ck(b);return x=gu(x,N),x},indices:()=>a}}};function uW(n,e){let t=[];for(let r=n;r<e;++r)t.push(r);return t}function cW(n){let e=[];for(let t=0;t<n.length;++t)for(let r=0;r<n[t].length;++r)e.push(n[t][r]);return e}var tXe={kernelName:nV,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e;return{a:()=>kn(t),b:()=>kn(r)}}};var nXe={kernelName:yk,gradFunc:n=>({x:()=>ot(n,"float32")})};var rXe={kernelName:rV,gradFunc:n=>({x:()=>kn(n)})};var aXe={kernelName:aV,gradFunc:n=>({x:()=>kn(n)})};var iXe={kernelName:iV,gradFunc:n=>({x:()=>kn(n)})};function oXe(n,e){let t=ee(n,"a","greater","string_or_numeric"),r=ee(e,"b","greater","string_or_numeric");[t,r]=Qn(t,r),Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(lje,a)}var ol=ue({greater_:oXe});var sXe={kernelName:oV,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{alpha:a}=t,i=ol(r,0);return{x:()=>fo(i,n,$e(n,a))}}};var uXe={kernelName:uV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Fn(n,Ya(t,1))}}};var cXe={kernelName:sV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Fn(n,ot(t,"float32"))}}};var lXe={kernelName:yje,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{let[r]=e,{axis:a}=t;return{logits:()=>{let o=is(r);return fr(n,$e(Tt(n,a,!0),o))}}}};function fXe(n,e,t,r=5,a=1,i=1,o=.5){let s={x:n,y:e,dy:t},u={depthRadius:r,bias:a,alpha:i,beta:o};return ae.runKernel(bje,s,u)}var hXe=ue({localResponseNormalizationBackprop_:fXe});var dXe={kernelName:cV,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{let[r,a]=e,{depthRadius:i,bias:o,alpha:s,beta:u}=t;return{x:()=>hXe(r,a,n,i,o,s,u)}}};function pXe(n,e){let t=ee(n,"a","equal","string_or_numeric"),r=ee(e,"b","equal","string_or_numeric");[t,r]=Qn(t,r),Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(sje,a)}var Dk=ue({equal_:pXe});function IG(n,e,t,r){return e.rank<t.rank&&(e=de(e,Nm(e.shape,r))),n.rank<t.rank&&(n=de(n,Nm(n.shape,r))),{x:()=>$e(n,ot(Dk(t,e),n.dtype))}}var lW={kernelName:lV,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{let r=t,{reductionIndices:a}=r,i=e[0],o=e[1],s=$i(a,i.shape),u=IG(n,o,i,s);return{x:()=>u.x()}}};function vXe(n,e){let t=ee(n,"a","less","string_or_numeric"),r=ee(e,"b","less","string_or_numeric");[t,r]=Qn(t,r),Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(dje,a)}var CG=ue({less_:vXe});var mXe={kernelName:fV,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e;return{a:()=>$e(n,ot(Cm(t,r),"float32")),b:()=>$e(n,ot(CG(t,r),"float32"))}}};function gXe(n,e,t,r,a,i,o){let s=ee(n,"dy","maxPool3dGrad"),u=ee(e,"input","maxPool3dGrad"),c=ee(t,"output","maxPool3dGrad"),l=s,f=u,h=c,d=!1;u.rank===4&&(d=!0,l=de(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),f=de(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=de(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),ie(l.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),ie(f.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${f.rank}.`),ie(h.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${h.rank}.`),Si("maxPool3dGrad",i,o);let p={dy:l,input:f,output:h},v={filterSize:r,strides:a,pad:i,dimRoundingMode:o},m=ae.runKernel(kje,p,v);return d?de(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}var yXe=ue({maxPool3dGrad_:gXe});var bXe={kernelName:xje,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{let[r,a]=e,{filterSize:i,strides:o,pad:s,dimRoundingMode:u}=t;return{x:()=>yXe(n,r,a,i,o,s,u)}}};function wXe(n,e,t,r,a,i,o){let s=ee(n,"dy","maxPoolGrad"),u=ee(e,"input","maxPoolGrad"),c=ee(t,"output","maxPoolGrad");ie(u.rank===s.rank,()=>`Rank of input (${u.rank}) does not match rank of dy (${s.rank})`),ie(s.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${s.rank}.`),ie(u.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${u.rank}.`),Si("maxPoolGrad",i,o);let l={dy:s,input:u,output:c},f={filterSize:r,strides:a,pad:i,dimRoundingMode:o};return ae.runKernel(wje,l,f)}var xXe=ue({maxPoolGrad_:wXe});var kXe={kernelName:hV,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{let[r,a]=e,{filterSize:i,strides:o,pad:s}=t;return{x:()=>xXe(n,r,a,i,o,s)}}};function Mh(n,e="float32"){if(zh(n),e==="complex64"){let r=Mh(n,"float32"),a=Mh(n,"float32");return nl(r,a)}let t=Sk(lo(n),e);return ae.makeTensor(t,n,e)}function _m(n,e="float32"){if(zh(n),e==="complex64"){let r=_m(n,"float32"),a=Mh(n,"float32");return nl(r,a)}let t=iG(lo(n),e);return ae.makeTensor(t,n,e)}var SXe={kernelName:dV,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{axis:a}=t,i=$i(a,r.shape),s=I7e(r.shape,i)[1],u=lo(s);return{x:()=>{let l=r.shape.slice();i.forEach(d=>{l[d]=1});let f=de(n,l);return Fn($e(f,_m(r.shape,"float32")),u)}}}};var NXe={kernelName:pV,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{let r=t,{axis:a}=r,[i,o]=e,s=$i(a,i.shape),u=IG(n,o,i,s);return{x:()=>u.x()}}};var TXe={kernelName:vV,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e;return{a:()=>$e(n,ot(Am(t,r),"float32")),b:()=>$e(n,ot(ol(t,r),"float32"))}}};function EXe(n,e,t){let r=ee(n,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");let a={x:r},i={begin:e,size:t};return ae.runKernel(LV,a,i)}var zi=ue({slice_:EXe});var IXe={kernelName:mV,inputsToSave:["x"],gradFunc:(n,e,t)=>{let r=e[0],{paddings:a}=t,i=a.map(o=>o[0]);return{x:()=>zi(n,i,r.shape)}}};function CXe(n){let t={x:ee(n,"x","floor","float32")};return ae.runKernel(JW,t)}var AG=ue({floor_:CXe});var AXe={kernelName:gV,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e,a=Rn(t.shape,r.shape);return{a:()=>{let s=ur(t.shape,a);return s.length>0?de(Tt(n,s),t.shape):n},b:()=>{let s=$e(n,Nr(AG(Fn(t,r)))),u=ur(r.shape,a);return u.length>0?de(Tt(s,u),r.shape):s}}}};var DXe={kernelName:yV,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e,a=Rn(t.shape,r.shape);return{a:()=>{let s=$e(n,ot(r,"float32")),u=ur(t.shape,a);return u.length>0?de(Tt(s,u),t.shape):s},b:()=>{let s=$e(n,ot(t,"float32")),u=ur(r.shape,a);return u.length>0?de(Tt(s,u),r.shape):s}}}};var _Xe={kernelName:bV,gradFunc:n=>({x:()=>Nr(n)})};var FXe={kernelName:xV,inputsToSave:["indices"],gradFunc:(n,e)=>{let t=e[0];return{indices:()=>Mh(t.shape,"float32")}}};var RXe={kernelName:wV,gradFunc:n=>({x:()=>kn(n)})};function OXe(n,e=0){let t=ee(n,"x","unstack","string_or_numeric");ie(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);let r={value:t},a={axis:e};return ae.runKernel(QV,r,a)}var DG=ue({unstack_:OXe});var PXe={kernelName:kV,saveAllInputs:!0,gradFunc:(n,e,t)=>{let{axis:r}=t;return DG(n,r).map(i=>()=>i)}};var fW={kernelName:SV,inputsToSave:["x"],gradFunc:(n,e,t)=>{let r=e[0],{paddings:a}=t,i=a.map(o=>o[0]);return{x:()=>zi(n,i,r.shape)}}};function MXe(n){let t={x:ee(n,"x","log","float32")};return ae.runKernel(sV,t)}var Fm=ue({log_:MXe});function BXe(n,e){let t=ee(n,"base","pow"),r=ee(e,"exp","pow");[t,r]=Qn(t,r);let a={a:t,b:r};return ae.runKernel(NV,a)}var Rm=ue({pow_:BXe});var LXe={kernelName:NV,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{let[t,r,a]=e,i=t,o=r,s=Rn(i.shape,o.shape);return{a:()=>{let l=ot(o,"float32"),f=$e(n,$e(l,Rm(i,fr(l,Jn(1))))),h=ur(i.shape,s);return h.length>0&&(f=Tt(f,h)),de(f,i.shape)},b:()=>{let l=ol(i,0),f=fo(l,Fm(i),kn(i)),h=$e(n,$e(a,f)),d=ur(o.shape,s);return d.length>0&&(h=Tt(h,d)),de(h,o.shape)}}}};var zXe={kernelName:TV,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{let[t,r]=e,a=ol(t,0);return{x:()=>fo(a,n,$e(n,r)),alpha:()=>{let i=fo(a,kn(n),$e(n,t)),o=ur(r.shape,n.shape);return o.length>0&&(i=Tt(i,o)),de(i,r.shape)}}}};function $Xe(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var ka=xn();ka.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});ka.registerFlag("IS_BROWSER",()=>$Xe());ka.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");ka.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));ka.registerFlag("PROD",()=>!1);ka.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>ka.getBool("DEBUG"));ka.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);ka.registerFlag("IS_TEST",()=>!1);ka.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>!0);ka.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);ka.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);ka.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);var _k=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function hW(n){return _k?Buffer.byteLength(n):new Blob([n]).size}function qXe(n){if(_k)return Buffer.from(n).toString("base64");let e=new Uint8Array(n),t="";for(let r=0,a=e.length;r<a;r++)t+=String.fromCharCode(e[r]);return btoa(t)}function WXe(n){if(_k){let r=Buffer.from(n,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}let e=atob(n),t=new Uint8Array(e.length);for(let r=0;r<e.length;++r)t.set([e.charCodeAt(r)],r);return t.buffer}function VXe(n){if(n.length===1)return n[0];let e=0;n.forEach(a=>{e+=a.byteLength});let t=new Uint8Array(e),r=0;return n.forEach(a=>{t.set(new Uint8Array(a),r),r+=a.byteLength}),t.buffer}function _G(n,e){let t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function GXe(n,e,t){let r={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(r.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=e,r.weightData=t}return n.signature!=null&&(r.signature=n.signature),n.userDefinedMetadata!=null&&(r.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(r.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(r.initializerSignature=n.initializerSignature),r}async function UXe(n,e){let t,r;return n.weightsManifest!=null&&([t,r]=await e(n.weightsManifest)),GXe(n,t,r)}function Om(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:hW(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:hW(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}function HXe(n){let e=[];for(let t of n)e.push(...t.weights);return e}var Gn=class{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Gn.instance==null&&(Gn.instance=new Gn),Gn.instance}static registerSaveRouter(e){Gn.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Gn.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Gn.getHandlers(e,"save")}static getLoadHandlers(e,t){return Gn.getHandlers(e,"load",t)}static getHandlers(e,t,r){let a=[];return(t==="load"?Gn.getInstance().loadRouters:Gn.getInstance().saveRouters).forEach(o=>{let s=o(e,r);s!==null&&a.push(s)}),a}};var KXe="tensorflowjs",jXe=1,Dh="models_store",ym="model_info_store";function XXe(){if(!xn().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function YXe(n){let e=n.result;e.createObjectStore(Dh,{keyPath:"modelPath"}),e.createObjectStore(ym,{keyPath:"modelPath"})}var rl=class{constructor(e){if(this.indexedDB=XXe(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((r,a)=>{let i=this.indexedDB.open(KXe,jXe);i.onupgradeneeded=()=>YXe(i),i.onsuccess=()=>{let o=i.result;if(t==null){let s=o.transaction(Dh,"readonly"),c=s.objectStore(Dh).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return o.close(),a(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));r(c.result.modelArtifacts)},c.onerror=l=>(o.close(),a(c.error)),s.oncomplete=()=>o.close()}else{let s=Om(t),u=o.transaction(ym,"readwrite"),c=u.objectStore(ym),l=c.put({modelPath:this.modelPath,modelArtifactsInfo:s}),f;l.onsuccess=()=>{f=o.transaction(Dh,"readwrite");let d=f.objectStore(Dh).put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:s});d.onsuccess=()=>r({modelArtifactsInfo:s}),d.onerror=p=>{c=u.objectStore(ym);let v=c.delete(this.modelPath);v.onsuccess=()=>(o.close(),a(d.error)),v.onerror=m=>(o.close(),a(d.error))}},l.onerror=h=>(o.close(),a(l.error)),u.oncomplete=()=>{f==null?o.close():f.oncomplete=()=>o.close()}}},i.onerror=o=>a(i.error)})}};rl.URL_SCHEME="indexeddb://";var FG=n=>xn().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(rl.URL_SCHEME)?ZXe(n.slice(rl.URL_SCHEME.length)):null;Gn.registerSaveRouter(FG);Gn.registerLoadRouter(FG);function ZXe(n){return new rl(n)}var Eh="/",Ih="tensorflowjs_models",JXe="info",QXe="model_topology",e9e="weight_specs",t9e="weight_data",n9e="model_metadata";function r9e(n){return{info:[Ih,n,JXe].join(Eh),topology:[Ih,n,QXe].join(Eh),weightSpecs:[Ih,n,e9e].join(Eh),weightData:[Ih,n,t9e].join(Eh),modelMetadata:[Ih,n,n9e].join(Eh)}}function a9e(n){for(let e of Object.values(n))window.localStorage.removeItem(e)}var al=class{constructor(e){if(!xn().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=r9e(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),a=Om(e);try{this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,qXe(e.weightData));let i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:a}}catch{throw a9e(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${a.modelTopologyBytes}, weightSpecsBytes=${a.weightSpecsBytes}, weightDataBytes=${a.weightDataBytes}.`)}}}async load(){let e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let t={},r=JSON.parse(this.LS.getItem(this.keys.topology));if(r==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=r;let a=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(a==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=a;let i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){let s=JSON.parse(i);t.format=s.format,t.generatedBy=s.generatedBy,t.convertedBy=s.convertedBy,s.signature!=null&&(t.signature=s.signature),s.userDefinedMetadata!=null&&(t.userDefinedMetadata=s.userDefinedMetadata),s.modelInitializer!=null&&(t.modelInitializer=s.modelInitializer),s.initializerSignature!=null&&(t.initializerSignature=s.initializerSignature),s.trainingConfig!=null&&(t.trainingConfig=s.trainingConfig)}let o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=WXe(o),t}};al.URL_SCHEME="localstorage://";var RG=n=>xn().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(al.URL_SCHEME)?i9e(n.slice(al.URL_SCHEME.length)):null;Gn.registerSaveRouter(RG);Gn.registerLoadRouter(RG);function i9e(n){return new al(n)}var o9e="model",s9e=".json",u9e=".weights.bin";function dW(n){return new Promise(e=>setTimeout(e)).then(n)}var ho=class{constructor(e){if(!xn().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(ho.URL_SCHEME)&&(e=e.slice(ho.URL_SCHEME.length)),(e==null||e.length===0)&&(e=o9e),this.modelJsonFileName=e+s9e,this.weightDataFileName=e+u9e}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");let t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],a=_G(e,r),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),o=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(o.download=this.modelJsonFileName,o.href=i,await dW(()=>o.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){let s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;s.download=this.weightDataFileName,s.href=t,await dW(()=>s.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:Om(e)}}}};ho.URL_SCHEME="downloads://";var c9e=n=>xn().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(ho.URL_SCHEME)?l9e(n.slice(ho.URL_SCHEME.length)):null;Gn.registerSaveRouter(c9e);function l9e(n="model"){return new ho(n)}function pW(n,e,t,r){o(n),t=t??0,r=r??1,s(t,r);let a=0,i=u=>(u.then(c=>{let l=t+ ++a/n.length*(r-t);return e(l),c}),u);function o(u){ie(u!=null&&Array.isArray(u)&&u.length>0,()=>"promises must be a none empty array")}function s(u,c){ie(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${u}`),ie(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),ie(c>=u,()=>`startFraction must be no more than endFraction, but got startFraction ${u} and endFraction ${c}`)}return Promise.all(n.map(i))}async function f9e(n,e){e==null&&(e={});let t=e.fetchFunc==null?xn().platform.fetch:e.fetchFunc,r=n.map(f=>t(f,e.requestInit,{isBinary:!0})),a=0,i=.5,s=(e.onProgress==null?await Promise.all(r):await pW(r,e.onProgress,a,i)).map(f=>f.arrayBuffer()),u=.5,c=1;return e.onProgress==null?await Promise.all(s):await pW(s,e.onProgress,u,c)}var h9e="application/octet-stream",d9e="application/json",Bh=class{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(ie(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=xn().platform.fetch,ie(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&ie(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;let r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=_G(e,r);t.body.append("model.json",new Blob([JSON.stringify(a)],{type:d9e}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:h9e}),"model.weights.bin");let i=await this.fetch(this.path,t);if(i.ok)return{modelArtifactsInfo:Om(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async load(){let e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}let r=t.modelTopology,a=t.weightsManifest;if(r==null&&a==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return UXe(t,i=>this.loadWeights(i))}async loadWeights(e){let t=Array.isArray(this.path)?this.path[1]:this.path,[r,a]=p9e(t),i=this.weightPathPrefix||r,o=HXe(e),s=[],u=[];for(let l of e)for(let f of l.paths)this.weightUrlConverter!=null?u.push(this.weightUrlConverter(f)):s.push(i+f+a);this.weightUrlConverter&&s.push(...await Promise.all(u));let c=await f9e(s,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[o,VXe(c)]}};Bh.URL_SCHEME_REGEX=/^https?:\/\//;function p9e(n){let e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),r=n.substring(0,e),a=t>e?n.substring(t):"";return[r+"/",a]}function vW(n){return n.match(Bh.URL_SCHEME_REGEX)!=null}var OG=(n,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(n)?t=n.every(r=>vW(r)):t=vW(n),t)return v9e(n,e)}return null};Gn.registerSaveRouter(OG);Gn.registerLoadRouter(OG);function v9e(n,e){return new Bh(n,e)}function m9e(n,e,t=1,r=0,a="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);let o={indices:ee(n,"indices","oneHot","int32")},s={dtype:a,depth:e,onValue:t,offValue:r};return ae.runKernel(xV,o,s)}var g9e=ue({oneHot_:m9e});function y9e(n,e,t){let r,a=n.shape.length;typeof e=="number"?r=[e,...new Array(a-1).fill(0)]:e.length<a?r=e.concat(new Array(a-e.length).fill(0)):r=e.slice(),r.forEach(o=>{ie(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=[t,...new Array(a-1).fill(-1)]:t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map((o,s)=>o>=0?o:(ie(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${s}.`),n.shape[s]-r[s])),[r,i]}var fk=class{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}};function b9e(n){let e=ee(n,"x","abs");if(e.dtype==="complex64"){let t={x:e};return ae.runKernel(BW,t)}else{let t={x:e};return ae.runKernel(kW,t)}}var co=ue({abs_:b9e});function w9e(n){let t={x:ee(n,"x","acos")};return ae.runKernel(SW,t)}var x9e=ue({acos_:w9e});function k9e(n){let t={x:ee(n,"x","acosh")};return ae.runKernel(NW,t)}var S9e=ue({acosh_:k9e});function N9e(n,e=null,t=!1){let a={x:ee(n,"x","all","bool")},i={axis:e,keepDims:t};return ae.runKernel(VKe,a,i)}var T9e=ue({all_:N9e});function E9e(n,e=null,t=!1){let a={x:ee(n,"x","any","bool")},i={axis:e,keepDims:t};return ae.runKernel(GKe,a,i)}var I9e=ue({any_:E9e});function C9e(n,e=0){let r={x:ee(n,"x","argMax")},a={axis:e};return ae.runKernel(TW,r,a)}var A9e=ue({argMax_:C9e});function D9e(n,e=0){let r={x:ee(n,"x","argMin")},a={axis:e};return ae.runKernel(EW,r,a)}var _9e=ue({argMin_:D9e});function F9e(n){let t={x:ee(n,"x","asin")};return ae.runKernel(IW,t)}var R9e=ue({asin_:F9e});function O9e(n){let t={x:ee(n,"x","asinh")};return ae.runKernel(CW,t)}var P9e=ue({asinh_:O9e});function M9e(n){let t={x:ee(n,"x","atan")};return ae.runKernel(AW,t)}var B9e=ue({atan_:M9e});function L9e(n,e){let t=ee(n,"a","atan2"),r=ee(e,"b","atan2");[t,r]=Qn(t,r);let a={a:t,b:r};return ae.runKernel(_W,a)}var z9e=ue({atan2_:L9e});function $9e(n){let t={x:ee(n,"x","atanh")};return ae.runKernel(DW,t)}var q9e=ue({atanh_:$9e});function W9e(n,e,t,r,a){let i=ee(n,"x","avgPool","float32"),o=1;ie(il(t,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);let s=i,u=!1;i.rank===3&&(u=!0,s=de(i,[1,i.shape[0],i.shape[1],i.shape[2]])),ie(s.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${s.rank}.`),Si("avgPool",r,a);let c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a},f=ae.runKernel(FW,c,l);return f=ot(f,i.dtype),u?de(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var PG=ue({avgPool_:W9e});function V9e(n,e=0){ie(n.length>=1,()=>"Pass at least one tensor to concat");let t=pG(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),t.length===1)return gG(t[0]);let r=t,a={axis:e};return ae.runKernel(LW,r,a)}var Lh=ue({concat_:V9e});function G9e(n){let t={x:ee(n,"x","sigmoid","float32")};return ae.runKernel(WV,t)}var Fk=ue({sigmoid_:G9e});function U9e(n){let t={x:ee(n,"x","tanh","float32")};return ae.runKernel(JV,t)}var H9e=ue({tanh_:U9e});function K9e(n,e,t){let r=ee(n,"x","batchToSpaceND"),a=e.reduce((s,u)=>s*u);ie(r.rank>=1+e.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`),ie(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),ie(r.shape[0]%a===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${a}`);let i={x:r},o={blockShape:e,crops:t};return ae.runKernel(OW,i,o)}var Rk=ue({batchToSpaceND_:K9e});function j9e(n){let e;return n.rank===0||n.rank===1?e=de(n,[1,1,1,n.size]):n.rank===2?e=de(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=de(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}function X9e(n,e,t,r,a,i){i==null&&(i=.001);let o=ee(n,"x","batchNorm"),s=ee(e,"mean","batchNorm"),u=ee(t,"variance","batchNorm"),c;a!=null&&(c=ee(a,"scale","batchNorm"));let l;r!=null&&(l=ee(r,"offset","batchNorm")),ie(s.rank===u.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),ie(l==null||s.rank===l.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),ie(c==null||s.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let h={x:j9e(o),scale:c,offset:l,mean:s,variance:u},d={varianceEpsilon:i},p=ae.runKernel(eV,h,d);return de(p,o.shape)}var Y9e=ue({batchNorm_:X9e});function Z9e(n){let t={x:ee(n,"x","ceil","float32")};return ae.runKernel(PW,t)}var J9e=ue({ceil_:Z9e});function Q9e(n,e,t){zh(n);let r={shape:n,value:e,dtype:t};return ae.runKernel(cje,{},r)}function eYe(n,e,t){let r=ee(n,"x","clipByValue");if(ie(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return Q9e(r.shape,e,r.dtype);let a={x:r},i={clipValueMin:e,clipValueMax:t};return ae.runKernel(MW,a,i)}var tYe=ue({clipByValue_:eYe});function nYe(n,e,t,r,a="NWC",i=1,o){let s=ee(n,"x","conv1d"),u=ee(e,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=de(s,[1,s.shape[0],s.shape[1]])),ie(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),ie(u.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`),Si("conv1d",r,o),ie(c.shape[2]===u.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${u.shape[1]}.`),ie(il(t,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${i}'`),ie(km(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),ie(km(t),()=>"Error in conv1D: Stride should be larger than 0."),ie(a==="NWC",()=>`Error in conv1d: got dataFormat of ${a} but only NWC is currently supported.`);let f=de(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=de(c,[c.shape[0],1,c.shape[1],c.shape[2]]),m=Dm(h,f,[1,t],r,"NHWC",[1,i],o);return l?de(m,[m.shape[2],m.shape[3]]):de(m,[m.shape[0],m.shape[2],m.shape[3]])}var rYe=ue({conv1d_:nYe});function aYe(n,e,t,r,a,i){let o=ee(n,"x","conv2dTranspose"),s=ee(e,"filter","conv2dTranspose");return bG(t,o,s,r,a,"NHWC",i)}var iYe=ue({conv2dTranspose_:aYe});function oYe(n){let t={x:ee(n,"x","cos","float32")};return ae.runKernel(qW,t)}var Ok=ue({cos_:oYe});function sYe(n){let t={x:ee(n,"x","cosh","float32")};return ae.runKernel(WW,t)}var MG=ue({cosh_:sYe});function uYe(n,e=0,t=!1,r=!1){let i={x:ee(n,"x","cumprod")},o={axis:e,exclusive:t,reverse:r};return ae.runKernel(eje,i,o)}var hk=ue({cumprod_:uYe});function cYe(n,e,t="NHWC"){let r=ee(n,"x","depthToSpace","float32"),a=t==="NHWC"?r.shape[1]:r.shape[2],i=t==="NHWC"?r.shape[2]:r.shape[3],o=t==="NHWC"?r.shape[3]:r.shape[1];ie(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),ie(a*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${a} and ${e}  for depthToSpace with input shape
    ${r.shape}`),ie(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${r.shape}`),ie(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${r.shape}`);let s={x:r},u={blockSize:e,dataFormat:t};return ae.runKernel(tje,s,u)}var lYe=ue({depthToSpace_:cYe});function fYe(n,e,t,r,a="NHWC",i=[1,1],o){let s=ee(n,"x","depthwiseConv2d","float32"),u=ee(e,"filter","depthwiseConv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=de(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ie(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),ie(u.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`);let f=a==="NHWC"?c.shape[3]:c.shape[1];ie(f===u.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${f}) must match the inChannels dimension in filter ${u.shape[2]}.`),Si("depthwiseConv2d",r,o);let h={x:c,filter:u},d={strides:t,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},p=ae.runKernel(GW,h,d);return l?de(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var BG=ue({depthwiseConv2d_:fYe});function hYe(n,e,t,r,a=[1,1],i="NHWC"){let o=ee(n,"x","dilation2d"),s=ee(e,"filter","dilation2d");ie(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),ie(s.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${s.rank}.`),ie(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let u=o,c=!1;o.rank===3&&(u=de(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),ie(u.shape[3]===s.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${u.shape[3]} vs ${s.shape[2]}`);let l={x:u,filter:s},f={strides:t,pad:r,dilations:a},h=ae.runKernel(UW,l,f);return c?de(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var dYe=ue({dilation2d_:hYe});function pYe(n,e){let t=ee(n,"a","div"),r=ee(e,"b","div");[t,r]=Qn(t,r);let a=Fn(t,r),i=kn(a),o=Dk(r,i);return fo(o,i,a)}var vYe=ue({divNoNan_:pYe});function mYe(n,e){let t=ee(n,"t1","dot"),r=ee(e,"t2","dot");ie((t.rank===1||t.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${r.rank}.`);let a=t.rank===1?t.size:t.shape[1],i=r.rank===1?r.size:r.shape[0];if(ie(a===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${a} and ${i}.`),t.rank===1&&r.rank===1){let o=de(t,[1,-1]),s=de(r,[-1,1]),u=xa(o,s);return de(u,[])}else if(t.rank===1&&r.rank===2){let o=de(t,[1,-1]),s=de(r,[r.shape[0],r.shape[1]]),u=xa(o,s);return de(u,[u.size])}else if(t.rank===2&&r.rank===1){let o=de(r,[-1,1]),s=xa(t,o);return de(s,[s.size])}else{let o=de(r,[r.shape[0],r.shape[1]]);return xa(t,o)}}var gYe=ue({dot_:mYe});function yYe(n){let t={x:ee(n,"x","elu","float32")};return ae.runKernel(KW,t)}var bYe=ue({elu_:yYe});function wYe(n){let e=ee(n,"x","erf");ie(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=ot(e,"float32"));let t={x:e};return ae.runKernel(jW,t)}var xYe=ue({erf_:wYe});function kYe(n,e=null,t=!1){let a={x:ee(n,"x","max")},i={reductionIndices:e,keepDims:t};return ae.runKernel(lV,a,i)}var el=ue({max_:kYe});function SYe(n,e=null,t=!1){let a={x:ee(n,"x","min")},i={axis:e,keepDims:t};return ae.runKernel(pV,a,i)}var dk=ue({min_:SYe});function NYe(n,e="euclidean",t=null,r=!1){n=ee(n,"x","norm");let a=LG(n,e,t),i=a.shape;if(r){let o=$i(t,n.shape);i=Nm(a.shape,o)}return de(a,i)}function LG(n,e,t=null){if(n.rank===0)return co(n);if(n.rank!==1&&t===null)return LG(de(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Tt(co(n),t);if(e===1/0)return el(co(n),t);if(e===-1/0)return dk(co(n),t);if(e==="euclidean"||e===2)return as(Tt(Rm(co(n),Jn(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return el(Tt(co(n),t[0]),t[1]-1);if(e===1/0)return el(Tt(co(n),t[1]),t[0]);if(e===-1/0)return dk(Tt(co(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return as(Tt(sr(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}var zG=ue({norm_:NYe});function TYe(n,e=null,t=!1){return zG(n,"euclidean",e,t)}var EYe=ue({euclideanNorm_:TYe});function IYe(n,e=0){let t=ee(n,"x","expandDims","string_or_numeric");ie(e<=t.rank,()=>"Axis must be <= rank of the tensor");let r={input:t},a={dim:e};return ae.runKernel(YW,r,a)}var $G=ue({expandDims_:IYe});function CYe(n){let t={x:ee(n,"x","expm1")};return ae.runKernel(ZW,t)}var AYe=ue({expm1_:CYe});function DYe(n,e,t=0,r=0){let a=ee(n,"x","gather"),i=ee(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:r};return ae.runKernel(tV,o,s)}var qG=ue({gather_:DYe});function _Ye(n){let t={x:ee(n,"x","isFinite")};return ae.runKernel(rV,t)}var FYe=ue({isFinite_:_Ye});function RYe(n){let t={x:ee(n,"x","isInf")};return ae.runKernel(aV,t)}var OYe=ue({isInf_:RYe});function PYe(n){let t={x:ee(n,"x","isNaN")};return ae.runKernel(iV,t)}var MYe=ue({isNaN_:PYe});function BYe(n,e=.2){let r={x:ee(n,"x","leakyRelu")},a={alpha:e};return ae.runKernel(oV,r,a)}var LYe=ue({leakyRelu_:BYe});function zYe(n,e=5,t=1,r=1,a=.5){let i=ee(n,"x","localResponseNormalization");ie(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),ie(_h(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,s=!1;i.rank===3&&(s=!0,o=de(i,[1,i.shape[0],i.shape[1],i.shape[2]]));let u={x:o},c={depthRadius:e,bias:t,alpha:r,beta:a},l=ae.runKernel(cV,u,c);return s?de(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var $Ye=ue({localResponseNormalization_:zYe});function qYe(n){let t={x:ee(n,"x","log1p")};return ae.runKernel(uV,t)}var WYe=ue({log1p_:qYe});function VYe(n,e){ie(tk(n),()=>"The f passed in variableGrads(f) must be a function"),ie(e==null||Array.isArray(e)&&e.every(c=>c instanceof tl),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");let t=e!=null;if(!t){e=[];for(let c in ae.registeredVariables)e.push(ae.registeredVariables[c])}let r=t?e.filter(c=>!c.trainable):null,a=e.length;e=e.filter(c=>c.trainable),ie(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${a} variables is trainable.`);let i=!0,{value:o,grads:s}=ae.gradients(n,e,null,i);ie(s.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),ie(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);let u={};return e.forEach((c,l)=>{s[l]!=null&&(u[c.name]=s[l])}),r?.forEach(c=>u[c.name]=null),{value:o,grads:u}}function WG(n){return ae.customGrad(n)}function GYe(n){let t={x:ee(n,"x","softplus")};return ae.runKernel(VV,t)}var VG=ue({softplus_:GYe});function UYe(n){let e=ee(n,"x","logSigmoid");return WG(r=>({value:Nr(VG(Nr(r))),gradFunc:o=>$e(o,Fk(Nr(r)))}))(e)}var HYe=ue({logSigmoid_:UYe});function KYe(n,e=-1){let t=ee(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return WG((a,i)=>{let s=el(a,e,!0),u=fr(a,s),c=fr(ot(u,"float32"),Fm(Tt(is(u),e,!0)));return i([c]),{value:c,gradFunc:(f,h)=>{let[d]=h,p=!0,v=is(d);return fr(f,$e(Tt(f,e,p),v))}}})(t)}var jYe=ue({logSoftmax_:KYe});function XYe(n,e=null,t=!1){let r=ee(n,"x","logSumExp"),a=$i(e,r.shape),i=el(r,a,!0),o=fr(r,i),s=is(o),u=Tt(s,a),c=Fm(u),l=Ya(de(i,c.shape),c);if(t){let f=Nm(l.shape,a);return de(l,f)}return l}var YYe=ue({logSumExp_:XYe});function ZYe(n){let t={x:ee(n,"x","logicalNot","bool")};return ae.runKernel(mje,t)}var Pk=ue({logicalNot_:ZYe});function JYe(n,e){let t=ee(n,"a","logicalOr","bool"),r=ee(e,"b","logicalOr","bool");Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(gje,a)}var GG=ue({logicalOr_:JYe});function QYe(n,e){let t=ee(n,"a","logicalXor","bool"),r=ee(e,"b","logicalXor","bool");return Rn(t.shape,r.shape),Ph(GG(n,e),Pk(Ph(n,e)))}var eZe=ue({logicalXor_:QYe});function tZe(n,e,t,r,a){let i=ee(n,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=de(i,[1,i.shape[0],i.shape[1],i.shape[2]])),ie(s.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.rank}.`),ie(il(t,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),Si("maxPool",r,a);let c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a},f=ae.runKernel(hV,c,l);return u?de(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var UG=ue({maxPool_:tZe});function nZe(n,e){let t=ee(n,"a","maximum"),r=ee(e,"b","maximum");[t,r]=Qn(t,r),t.dtype==="bool"&&(t=ot(t,"int32"),r=ot(r,"int32")),Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(fV,a)}var HG=ue({maximum_:nZe});function rZe(n,e=null,t=!1){let a={x:ee(n,"x","mean")},i={axis:e,keepDims:t};return ae.runKernel(dV,a,i)}var aZe=ue({mean_:rZe});function iZe(n,e){let t=ee(n,"a","minimum"),r=ee(e,"b","minimum");[t,r]=Qn(t,r),t.dtype==="bool"&&(t=ot(t,"int32"),r=ot(r,"int32")),Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(vV,a)}var oZe=ue({minimum_:iZe});function sZe(n,e,t){ie(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);let r=ee(n,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");ie(e.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`);let a=t==="reflect"?1:0;for(let s=0;s<r.rank;s++)ie(e[s].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),ie(e[s][0]>=0&&e[s][0]<=r.shape[s]-a&&e[s][1]>=0&&e[s][1]<=r.shape[s]-a,()=>`Padding in dimension ${s} cannot be greater than or equal to ${r.shape[s]-a} or less than 0 for input of shape ${r.shape}`);let i={paddings:e,mode:t},o={x:r};return ae.runKernel(mV,o,i)}var uZe=ue({mirrorPad_:sZe});function cZe(n,e){let t=ee(n,"a","mod"),r=ee(e,"b","mod");[t,r]=Qn(t,r);let a={a:t,b:r};return ae.runKernel(gV,a)}var lZe=ue({mod_:cZe});function fZe(n,e){let t=ee(n,"a","notEqual","string_or_numeric"),r=ee(e,"b","notEqual","string_or_numeric");[t,r]=Qn(t,r),Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(Sje,a)}var hZe=ue({notEqual_:fZe});function dZe(n){let t={x:ee(n,"x","onesLike")};return ae.runKernel(wV,t)}var pZe=ue({onesLike_:dZe});function vZe(n,e,t=0){let r=ee(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let a={paddings:e,constantValue:t},i={x:r};return ae.runKernel(SV,i,a)}var KG=ue({pad_:vZe});function mZe(n,e,t,r,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),r===0&&(r="valid");let s=ee(n,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=de(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ie(il(i,a),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${a}'`);let l=B8e(u.shape,e,i,a,r),f=[l.dilationHeight,l.dilationWidth],h;r==="same"?h=yZe([l.filterHeight,l.filterWidth],f):h=[[0,0],[0,0]];let d=f[0]===1&&f[1]===1,[p,v]=gZe([l.inHeight,l.inWidth],f,h),m=d?r:"valid",g=d?u:Ik(u,f,p),b=(t==="avg"?()=>PG(g,e,i,m,o):()=>UG(g,e,i,m,o))(),w=d?b:Rk(b,f,v);return c?de(w,[w.shape[1],w.shape[2],w.shape[3]]):w}function gZe(n,e,t){let r=t.map(l=>l[0]),a=t.map(l=>l[1]),i=n.concat(r,a),o=e.map((l,f)=>(l-i[f]%l)%l),s=a.map((l,f)=>l+o[f]),u=e.map((l,f)=>[r[f],s[f]]),c=e.map((l,f)=>[0,o[f]]);return[u,c]}function yZe(n,e){let r=n.map((o,s)=>o+(o-1)*(e[s]-1)).map(o=>o-1),a=r.map(o=>Math.floor(o/2)),i=r.map((o,s)=>o-a[s]);return r.map((o,s)=>[a[s],i[s]])}var bZe=ue({pool_:mZe});function wZe(n,e){let t=ee(n,"x","prelu"),r=ee(e,"alpha","prelu"),a={x:t,alpha:r};return ae.runKernel(TV,a)}var xZe=ue({prelu_:wZe});function kZe(n,e=null,t=!1){let r=ee(n,"x","prod");r.dtype==="bool"&&(r=ot(r,"int32"));let a={x:r},i={axis:e,keepDims:t};return ae.runKernel(EV,a,i)}var SZe=ue({prod_:kZe});var yu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function bu(n,e){return e={exports:{}},n(e,e.exports),e.exports}var NZe=bu(function(n){(function(e,t,r){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.alea=o})(yu,n,!1)}),TZe=bu(function(n){(function(e,t,r){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor128=o})(yu,n,!1)}),EZe=bu(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorwow=o})(yu,n,!1)}),IZe=bu(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,d,p;return h=l[f],h^=h>>>7,d=h^h<<24,h=l[f+1&7],d^=h^h>>>10,h=l[f+3&7],d^=h^h>>>3,h=l[f+4&7],d^=h^h<<7,h=l[f+7&7],h=h^h<<13,d^=h^h<<9,l[f]=d,u.i=f+1&7,d};function c(l,f){var h,d,p=[];if(f===(f|0))d=p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8?d=p[7]=-1:d=p[h],l.x=p,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorshift7=o})(yu,n,!1)}),CZe=bu(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,d,p;return u.w=l=l+1640531527|0,p=f[h+34&127],d=f[h=h+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,p=f[h]=p^d,u.i=h,p+(l^l>>>16)|0};function c(l,f){var h,d,p,v,m,g=[],y=128;for(f===(f|0)?(d=f,f=null):(f=f+"\0",d=0,y=Math.max(y,f.length)),p=0,v=-32;v<y;++v)f&&(d^=f.charCodeAt((v+32)%f.length)),v===0&&(m=d),d^=d<<10,d^=d>>>15,d^=d<<4,d^=d>>>13,v>=0&&(m=m+1640531527|0,h=g[v&127]^=d+m,p=h==0?p+1:0);for(p>=128&&(g[(f&&f.length||0)&127]=-1),p=127,v=4*128;v>0;--v)d=g[p+34&127],h=g[p=p+1&127],d^=d<<13,h^=h<<17,d^=d>>>15,h^=h>>>12,g[p]=d^h;l.w=m,l.X=g,l.i=p}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor4096=o})(yu,n,!1)}),AZe=bu(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,d=u.d,p=u.a;return f=f<<25^f>>>7^h,h=h-d|0,d=d<<24^d>>>8^p,p=p-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-d|0,u.d=d<<16^h>>>16^p,u.a=p-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,d=(c.next()>>>0)/4294967296,p=(h+d)/(1<<21);while(p===0);return p},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.tychei=o})(yu,n,!1)}),wu=bu(function(n){(function(e,t,r){var a=256,i=6,o=52,s="random",u=r.pow(a,i),c=r.pow(2,o),l=c*2,f=a-1,h;function d(w,x,N){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(m(x.entropy?[w,b(t)]:w??y(),3),T),C=new p(T),F=function(){for(var _=C.g(i),O=u,L=0;_<c;)_=(_+L)*a,O*=a,L=C.g(1);for(;_>=l;)_/=2,O/=2,L>>>=1;return(_+L)/O};return F.int32=function(){return C.g(4)|0},F.quick=function(){return C.g(4)/4294967296},F.double=F,g(b(C.S),t),(x.pass||N||function(_,O,L,z){return z&&(z.S&&v(z,C),_.state=function(){return v(C,{})}),L?(r[s]=_,O):_})(F,E,"global"in x?x.global:this==r,x.state)}function p(w){var x,N=w.length,T=this,E=0,C=T.i=T.j=0,F=T.S=[];for(N||(w=[N++]);E<a;)F[E]=E++;for(E=0;E<a;E++)F[E]=F[C=f&C+w[E%N]+(x=F[E])],F[C]=x;(T.g=function(_){for(var O,L=0,z=T.i,$=T.j,B=T.S;_--;)O=B[z=f&z+1],L=L*a+B[f&(B[z]=B[$=f&$+O])+(B[$]=O)];return T.i=z,T.j=$,L})(a)}function v(w,x){return x.i=w.i,x.j=w.j,x.S=w.S.slice(),x}function m(w,x){var N=[],T=typeof w,E;if(x&&T=="object")for(E in w)try{N.push(m(w[E],x-1))}catch{}return N.length?N:T=="string"?w:w+"\0"}function g(w,x){for(var N=w+"",T,E=0;E<N.length;)x[f&E]=f&(T^=x[f&E]*19)+N.charCodeAt(E++);return b(x)}function y(){try{var w;return h&&(w=h.randomBytes)?w=w(a):(w=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var x=e.navigator,N=x&&x.plugins;return[+new Date,e,N,e.screen,b(t)]}}function b(w){return String.fromCharCode.apply(0,w)}if(g(r.random(),t),n.exports){n.exports=d;try{h=Rd()}catch{}}else r["seed"+s]=d})(typeof self<"u"?self:yu,[],Math)});wu.alea=NZe;wu.xor128=TZe;wu.xorwow=EZe;wu.xorshift7=IZe;wu.xor4096=CZe;wu.tychei=AZe;var DZe=wu,oot=DZe.alea;function _Ze(n){let t={x:ee(n,"x","reciprocal")};return ae.runKernel(IV,t)}var FZe=ue({reciprocal_:_Ze});function RZe(n){let t={x:ee(n,"x","relu")};return ae.runKernel(CV,t)}var OZe=ue({relu_:RZe});function PZe(n){let t={x:ee(n,"x","relu6")};return ae.runKernel(FV,t)}var MZe=ue({relu6_:PZe});function BZe(n,e){let r={x:ee(n,"x","reverse")},a={dims:e};return ae.runKernel(RV,r,a)}var Em=ue({reverse_:BZe});function LZe(n){let t={x:ee(n,"x","round")};return ae.runKernel(OV,t)}var zZe=ue({round_:LZe});function $Ze(n){let t={x:ee(n,"x","selu")};return ae.runKernel(BV,t)}var qZe=ue({selu_:$Ze});function WZe(n,e,t,r,a,i=[1,1],o="NHWC"){let s=ee(n,"x","separableConv2d"),u=ee(e,"depthwiseFilter","separableConv2d"),c=ee(t,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(s.rank===3&&(f=!0,l=de(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");ie(l.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${l.rank}.`),ie(u.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`),ie(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`),ie(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),ie(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);let h=u.shape[2],d=u.shape[3];ie(c.shape[2]===h*d,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*d}, but got ${c.shape[2]}.`);let p=BG(l,u,r,a,o,i),m=Dm(p,c,1,"valid",o);return f?de(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var VZe=ue({separableConv2d_:WZe});function GZe(n){let t={x:ee(n,"x","sign")};return ae.runKernel(qV,t)}var UZe=ue({sign_:GZe});function HZe(n,e=-1){let t=ee(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);let r={logits:t},a={dim:e};return ae.runKernel(jV,r,a)}var KZe=ue({softmax_:HZe});function jZe(n){ie(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);let e={input:n};return ae.runKernel(uje,e)}var jG=ue({fft_:jZe});function XZe(n){ie(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);let e={input:n};return ae.runKernel(fje,e)}var pk=ue({ifft_:XZe});function YZe(n){let e=n.shape[n.shape.length-1],t=n.size/e,r;if(e<=2){let a=de(n,[t,e]);r=pk(a)}else{let a=[t,2*(e-1)],i=de(Tm(n),[t,e]),o=de(Ak(n),[t,e]),s=Em(zi(i,[0,1],[t,e-2]),1),u=$e(Em(zi(o,[0,1],[t,e-2]),1),Jn(-1)),c=Lh([i,s],1),l=Lh([o,u],1),f=de(nl(c,l),[a[0],a[1]]);r=pk(f)}if(r=Tm(r),n.rank===3&&n.shape[0]!==0){let a=r,i=n.shape[0];r=de(r,[i,r.shape[0]/i,r.shape[1]]),a.dispose()}return r}var ZZe=ue({irfft_:YZe});function JZe(n,e){ie(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1],r=n.size/t,a;if(e!=null&&e<t){let p=n.shape.map(m=>0),v=n.shape.map(m=>m);v[n.shape.length-1]=e,a=zi(n,p,v),t=e}else if(e!=null&&e>t){let p=n.shape.map(v=>v);p[n.shape.length-1]=e-t,a=Lh([n,Mh(p)],n.shape.length-1),t=e}else a=n;let i=kn(a),o=de(nl(a,i),[r,t]),s=jG(o),u=Math.floor(t/2)+1,c=Tm(s),l=Ak(s),f=Sm(c,[u,t-u],c.shape.length-1),h=Sm(l,[u,t-u],l.shape.length-1),d=a.shape.slice();return d[a.shape.length-1]=u,de(nl(f[0],h[0]),d)}var QZe=ue({rfft_:JZe});function eJe(n,e){let t=ee(n,"a","squaredDifference"),r=ee(e,"b","squaredDifference");[t,r]=Qn(t,r),Rn(t.shape,r.shape);let a={a:t,b:r},i={};return ae.runKernel(XV,a,i)}var tJe=ue({squaredDifference_:eJe});function nJe(n,e){let t=ee(n,"x","squeeze","string_or_numeric");return de(t,Oje(t.shape,e).newShape)}var rJe=ue({squeeze_:nJe});function aJe(n,e=0){let t=pG(n,"tensors","stack","string_or_numeric");ie(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&ie(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");let r=t,a={axis:e};return ae.runKernel(kV,r,a)}var XG=ue({stack_:aJe});function iJe(n,e,t,r,a=0,i=0,o=0,s=0,u=0){let l={x:ee(n,"x","stridedSlice","string_or_numeric")},f={begin:e,end:t,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return ae.runKernel(Cje,l,f)}var oJe=ue({stridedSlice_:iJe});function sJe(n){let t={x:ee(n,"x","tan","float32")};return ae.runKernel(ZV,t)}var uJe=ue({tan_:sJe});function cJe(n,e=1,t=!0){let r=ee(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");let a=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>a)throw new Error(`'k' passed to topk() must be <= the last dimension (${a}) but got ${e}`);let i={x:r},o={k:e,sorted:t},[s,u]=ae.runKernel(Aje,i,o);return{values:s,indices:u}}var lJe=ue({topk_:cJe});function fJe(n,e=0){let t=ee(n,"x","unique","string_or_numeric");ie(t.rank>0,()=>"The input tensor must be at least 1D");let r={x:t},a={axis:e},[i,o]=ae.runKernel(Dje,r,a);return{values:i,indices:o}}var hJe=ue({unique_:fJe});function dJe(n,e,t=!1,r=!1){let a=ee(n,"images","resizeBilinear");ie(a.rank===3||a.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${a.rank}.`),ie(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),ie(r===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=a,o=!1;a.rank===3&&(o=!0,i=de(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let[]=e,s={images:i},u={alignCorners:t,halfPixelCenters:r,size:e},c=ae.runKernel(_V,s,u);return o?de(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var pJe=ue({resizeBilinear_:dJe});function vJe(n,e,t=!1,r=!1){let a=ee(n,"images","resizeNearestNeighbor");ie(a.rank===3||a.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${a.rank}.`),ie(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),ie(a.dtype==="float32"||a.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),ie(r===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=a,o=!1;a.rank===3&&(o=!0,i=de(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let[]=e,s={images:i},u={alignCorners:t,halfPixelCenters:r,size:e},c=ae.runKernel(DV,s,u);return o?de(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var mJe=ue({resizeNearestNeighbor_:vJe});var mW;(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(mW||(mW={}));var vk=class extends fk{minimize(e,t=!1,r){let{value:a,grads:i}=this.computeGradients(e,r);if(r!=null){let o=r.map(s=>({name:s.name,tensor:i[s.name]}));this.applyGradients(o)}else this.applyGradients(i);return sW(i),t?a:(a.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return VYe(e,t)}dispose(){this.iterations_!=null&&sW(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Jn(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}};Object.defineProperty(vk,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});var sot=(()=>typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n())();var gW;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(gW||(gW={}));var gJe=1.7580993408473768,yJe=1.0507009873554805;function bJe(n,e,t){let r=n.shape.slice();r[t]=1;let a=de(e,r),i=hk(n,t,!0,!1),o=hk(n,t,!0,!0),s=$e(i,o);return $e(a,s)}function wJe(n,e,t){let r=n.shape.length,a=r-t.length,i=kG(t,r),o=n;i!=null&&(o=gu(n,i));let s=o.shape.slice(),c=s.splice(r-t.length,t.length).reduce((h,d)=>h*d,1);s.push(c);let l=o.reshape(s),f=bJe(l,e,a);if(f=f.reshape(o.shape),i!=null){let h=Ck(i);f=gu(f,h)}return f}var xJe={kernelName:EV,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{axis:a}=t,i=[];return a==null?i=r.shape.map((o,s)=>s):typeof a=="number"?i=[a]:i=a,{x:()=>wJe(r,n,i)}}};var kJe={kernelName:HW,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e,a=Rn(t.shape,r.shape);return{a:()=>{let s=Fn(n,ot(r,"float32")),u=ur(t.shape,a);return u.length>0?de(Tt(s,u),t.shape):s},b:()=>{let s=$e(n,ot(t,"float32")),u=ur(r.shape,a);u.length>0&&(s=de(Tt(s,u),r.shape));let c=sr(r);return Nr(Fn(s,ot(c,"float32")))}}}};var SJe={kernelName:IV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Fn(n,Nr(sr(t)))}}};var NJe={kernelName:FV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e,r=$e(Am(t,6),Im(t));return{x:()=>$e(n,ot(r,"float32"))}}};var TJe={kernelName:CV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(n,ot(Im(t),"float32"))}}};var EJe={kernelName:AV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>de(n,t.shape)}}};var IJe={kernelName:_V,inputsToSave:["images"],gradFunc:(n,e,t)=>{let[r]=e,a={dy:n,images:r};return{images:()=>ae.runKernel(Eje,a,t)}}};var CJe={kernelName:DV,inputsToSave:["images"],gradFunc:(n,e,t)=>{let[r]=e,a={dy:n,images:r};return{images:()=>ae.runKernel(Tje,a,t)}}};var AJe={kernelName:RV,gradFunc:(n,e,t)=>{let{dims:r}=t,a=$i(r,n.shape);return{x:()=>Em(n,a)}}};var DJe={kernelName:OV,gradFunc:n=>({x:()=>kn(n)})};var _Je={kernelName:PV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Nr(Fn(n,$e(Rm(t,1.5),2)))}}};var FJe={kernelName:MV,inputsToSave:["condition"],gradFunc:(n,e)=>{let[t]=e;return{condition:()=>ot(kn(t),"float32"),t:()=>$e(n,ot(t,n.dtype)),e:()=>$e(n,ot(Pk(t),n.dtype))}}};var RJe={kernelName:BV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>{let r=ol(t,Jn(0)),a=Jn(gJe),i=Jn(yJe),o=$e(n,i),s=$e($e(n,a),is(ot(t,"float32")));return fo(r,o,s)}}}};var OJe={kernelName:WV,outputsToSave:[!0],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(n,$e(t,fr(Jn(1),t)))}}};var PJe={kernelName:qV,gradFunc:n=>({x:()=>kn(n)})};var MJe={kernelName:zV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(Ok(ot(t,"float32")),n)}}};var BJe={kernelName:$V,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(MG(ot(t,"float32")),n)}}};var LJe={kernelName:LV,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{begin:a,size:i}=t,o=r.shape,[s,u]=y9e(r,a,i),c=[];for(let l=0;l<n.rank;l++)c.push([s[l],o[l]-s[l]-u[l]]);return{x:()=>KG(n,c)}}};var zJe={kernelName:jV,outputsToSave:[!0],gradFunc:(n,e,t)=>{let[r]=e,{dim:a}=t,i=!0,o=$e(n,r);return{logits:()=>fr(o,$e(Tt(o,[a],i),r))}}};var $Je={kernelName:VV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(n,Fk(t))}}};var yW={kernelName:HV,gradFunc:(n,e,t)=>{let{blockShape:r,paddings:a}=t;return{x:()=>Rk(n,r,a)}}};var bW={kernelName:KV,gradFunc:(n,e,t)=>{let{axis:r}=t;return{x:()=>Lh(n,r)}}};var qJe={kernelName:GV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Fn(n,$e(as(ot(t,"float32")),2))}}};var WJe={kernelName:Ije,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(n,$e(ot(t,"float32"),2))}}};var VJe={kernelName:XV,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e,a=Jn(2);return{a:()=>$e(n,$e(a,fr(t,r))),b:()=>$e(n,$e(a,fr(r,t)))}}};var GJe={kernelName:nG,gradFunc:n=>({x:()=>kn(n)})};var UJe={kernelName:YV,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e,a=Rn(t.shape,r.shape);return{a:()=>{let s=n,u=ur(t.shape,a);return u.length>0&&(s=Tt(s,u)),de(s,t.shape)},b:()=>{let s=n,u=ur(r.shape,a);return u.length>0&&(s=Tt(s,u)),de(Nr(s),r.shape)}}}};var HJe={kernelName:UV,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,a=r.shape.slice(),{axis:i}=t;$i(i,r.shape).forEach(c=>{a[c]=1});let s=de(n,a),u=$e(s,_m(r.shape,"float32"));return{x:()=>u}}};var KJe={kernelName:ZV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Fn(n,sr(Ok(t)))}}};var jJe={kernelName:JV,outputsToSave:[!0],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(fr(Jn(1),sr(t)),n)}}};var XJe={kernelName:bk,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{reps:a}=t;return{x:()=>{let o=kn(r);if(r.rank===1)for(let s=0;s<a[0];++s)o=Ya(o,zi(n,[s*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)o=Ya(o,zi(n,[s*r.shape[0],u*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)for(let c=0;c<a[2];++c)o=Ya(o,zi(n,[s*r.shape[0],u*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)for(let c=0;c<a[2];++c)for(let l=0;l<a[3];++l)o=Ya(o,zi(n,[s*r.shape[0],u*r.shape[1],c*r.shape[2],l*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return o}}}};var YJe={kernelName:pm,gradFunc:(n,e,t)=>{let r=t,{perm:a}=r,i=Ck(a);return{x:()=>gu(n,i)}}};var ZJe={kernelName:QV,gradFunc:(n,e,t)=>{let r=t,{axis:a}=r;return{value:()=>XG(n,a)}}};var JJe={kernelName:eG,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>QJe(n,t)}}};function QJe(n,e){let t=HG(e,kn(e)),r=qG(n,t),a=Cm(e,Jn(0,"int32")),i=r.rank-a.rank;for(let s=0;s<i;++s)a=$G(a,s+1);a=Ph(a,_m(r.shape,"bool"));let o=kn(r);return fo(a,r,o)}var eQe={kernelName:tG,gradFunc:n=>({x:()=>kn(n)})};var tQe=[vG,k8e,S8e,E8e,I8e,A8e,D8e,_8e,R8e,O8e,P8e,M8e,G8e,K8e,X8e,Z8e,J8e,Q8e,e7e,s7e,u7e,l7e,v7e,d7e,w7e,k7e,N7e,P7e,$7e,q7e,kJe,W7e,G7e,U7e,H7e,K7e,X7e,j7e,J7e,eXe,tXe,nXe,rXe,aXe,iXe,sXe,uXe,cXe,lXe,dXe,lW,lW,mXe,bXe,kXe,SXe,NXe,TXe,IXe,AXe,DXe,_Xe,FXe,RXe,PXe,fW,fW,LXe,zXe,xJe,SJe,NJe,TJe,EJe,IJe,CJe,AJe,DJe,_Je,FJe,RJe,OJe,PJe,MJe,BJe,LJe,zJe,$Je,yW,yW,bW,bW,qJe,VJe,WJe,GJe,UJe,HJe,KJe,jJe,XJe,YJe,ZJe,JJe,eQe];for(let n of tQe)Uje(n);ce().prototype.abs=function(){return this.throwIfDisposed(),co(this)};ce().prototype.acos=function(){return this.throwIfDisposed(),x9e(this)};ce().prototype.acosh=function(){return this.throwIfDisposed(),S9e(this)};ce().prototype.add=function(n){return this.throwIfDisposed(),Ya(this,n)};ce().prototype.all=function(n,e){return this.throwIfDisposed(),T9e(this,n,e)};ce().prototype.any=function(n,e){return this.throwIfDisposed(),I9e(this,n,e)};ce().prototype.argMax=function(n){return this.throwIfDisposed(),A9e(this,n)};ce().prototype.argMin=function(n){return this.throwIfDisposed(),_9e(this,n)};ce().prototype.asScalar=function(){return this.throwIfDisposed(),ie(this.size===1,()=>"The array must have only 1 element."),de(this,[])};ce().prototype.asType=function(n){return this.throwIfDisposed(),ot(this,n)};ce().prototype.as1D=function(){return this.throwIfDisposed(),de(this,[this.size])};ce().prototype.as2D=function(n,e){return this.throwIfDisposed(),de(this,[n,e])};ce().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),de(this,[n,e,t])};ce().prototype.as4D=function(n,e,t,r){return this.throwIfDisposed(),de(this,[n,e,t,r])};ce().prototype.as5D=function(n,e,t,r,a){return this.throwIfDisposed(),de(this,[n,e,t,r,a])};ce().prototype.asin=function(){return this.throwIfDisposed(),R9e(this)};ce().prototype.asinh=function(){return this.throwIfDisposed(),P9e(this)};ce().prototype.atan=function(){return this.throwIfDisposed(),B9e(this)};ce().prototype.atan2=function(n){return this.throwIfDisposed(),z9e(this,n)};ce().prototype.atanh=function(){return this.throwIfDisposed(),q9e(this)};ce().prototype.avgPool=function(n,e,t,r){return this.throwIfDisposed(),PG(this,n,e,t,r)};ce().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),Rk(this,n,e)};ce().prototype.batchNorm=function(n,e,t,r,a){return this.throwIfDisposed(),Y9e(this,n,e,t,r,a)};ce().prototype.broadcastTo=function(n){return this.throwIfDisposed(),gm(this,n)};ce().prototype.cast=function(n){return this.throwIfDisposed(),ot(this,n)};ce().prototype.ceil=function(){return this.throwIfDisposed(),J9e(this)};ce().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),tYe(this,n,e)};ce().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof Sr&&(n=[n]),Lh([this,...n],e)};ce().prototype.conv1d=function(n,e,t,r,a,i){return this.throwIfDisposed(),rYe(this,n,e,t,r,a,i)};ce().prototype.conv2dTranspose=function(n,e,t,r,a){return this.throwIfDisposed(),iYe(this,n,e,t,r,a)};ce().prototype.conv2d=function(n,e,t,r,a,i){return this.throwIfDisposed(),Dm(this,n,e,t,r,a,i)};ce().prototype.cos=function(){return this.throwIfDisposed(),Ok(this)};ce().prototype.cosh=function(){return this.throwIfDisposed(),MG(this)};ce().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),hk(this,n,e,t)};ce().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),SG(this,n,e,t)};ce().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),lYe(this,n,e)};ce().prototype.depthwiseConv2d=function(n,e,t,r,a,i){return this.throwIfDisposed(),BG(this,n,e,t,r,a,i)};ce().prototype.dilation2d=function(n,e,t,r,a){return this.throwIfDisposed(),dYe(this,n,e,t,r,a)};ce().prototype.divNoNan=function(n){return this.throwIfDisposed(),vYe(this,n)};ce().prototype.div=function(n){return this.throwIfDisposed(),Fn(this,n)};ce().prototype.dot=function(n){return this.throwIfDisposed(),gYe(this,n)};ce().prototype.elu=function(){return this.throwIfDisposed(),bYe(this)};ce().prototype.equal=function(n){return this.throwIfDisposed(),Dk(this,n)};ce().prototype.erf=function(){return this.throwIfDisposed(),xYe(this)};ce().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),EYe(this,n,e)};ce().prototype.exp=function(){return this.throwIfDisposed(),is(this)};ce().prototype.expandDims=function(n){return this.throwIfDisposed(),$G(this,n)};ce().prototype.expm1=function(){return this.throwIfDisposed(),AYe(this)};ce().prototype.fft=function(){return this.throwIfDisposed(),jG(this)};ce().prototype.flatten=function(){return this.throwIfDisposed(),de(this,[this.size])};ce().prototype.floor=function(){return this.throwIfDisposed(),AG(this)};ce().prototype.floorDiv=function(n){return this.throwIfDisposed(),mG(this,n)};ce().prototype.gather=function(n,e){return this.throwIfDisposed(),qG(this,n,e)};ce().prototype.greaterEqual=function(n){return this.throwIfDisposed(),Cm(this,n)};ce().prototype.greater=function(n){return this.throwIfDisposed(),ol(this,n)};ce().prototype.ifft=function(){return this.throwIfDisposed(),pk(this)};ce().prototype.irfft=function(){return this.throwIfDisposed(),ZZe(this)};ce().prototype.isFinite=function(){return this.throwIfDisposed(),FYe(this)};ce().prototype.isInf=function(){return this.throwIfDisposed(),OYe(this)};ce().prototype.isNaN=function(){return this.throwIfDisposed(),MYe(this)};ce().prototype.leakyRelu=function(n){return this.throwIfDisposed(),LYe(this,n)};ce().prototype.lessEqual=function(n){return this.throwIfDisposed(),Am(this,n)};ce().prototype.less=function(n){return this.throwIfDisposed(),CG(this,n)};ce().prototype.localResponseNormalization=function(n,e,t,r){return this.throwIfDisposed(),$Ye(this,n,e,t,r)};ce().prototype.logSigmoid=function(){return this.throwIfDisposed(),HYe(this)};ce().prototype.logSoftmax=function(n){return this.throwIfDisposed(),jYe(this,n)};ce().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),YYe(this,n,e)};ce().prototype.log=function(){return this.throwIfDisposed(),Fm(this)};ce().prototype.log1p=function(){return this.throwIfDisposed(),WYe(this)};ce().prototype.logicalAnd=function(n){return this.throwIfDisposed(),Ph(this,n)};ce().prototype.logicalNot=function(){return this.throwIfDisposed(),Pk(this)};ce().prototype.logicalOr=function(n){return this.throwIfDisposed(),GG(this,n)};ce().prototype.logicalXor=function(n){return this.throwIfDisposed(),eZe(this,n)};ce().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),xa(this,n,e,t)};ce().prototype.maxPool=function(n,e,t,r){return this.throwIfDisposed(),UG(this,n,e,t,r)};ce().prototype.max=function(n,e){return this.throwIfDisposed(),el(this,n,e)};ce().prototype.maximum=function(n){return this.throwIfDisposed(),HG(this,n)};ce().prototype.mean=function(n,e){return this.throwIfDisposed(),aZe(this,n,e)};ce().prototype.min=function(n,e){return this.throwIfDisposed(),dk(this,n,e)};ce().prototype.minimum=function(n){return this.throwIfDisposed(),oZe(this,n)};ce().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),uZe(this,n,e)};ce().prototype.mod=function(n){return this.throwIfDisposed(),lZe(this,n)};ce().prototype.mul=function(n){return this.throwIfDisposed(),$e(this,n)};ce().prototype.neg=function(){return this.throwIfDisposed(),Nr(this)};ce().prototype.norm=function(n,e,t){return this.throwIfDisposed(),zG(this,n,e,t)};ce().prototype.notEqual=function(n){return this.throwIfDisposed(),hZe(this,n)};ce().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),g9e(this,n,e,t)};ce().prototype.onesLike=function(){return this.throwIfDisposed(),pZe(this)};ce().prototype.pad=function(n,e){return this.throwIfDisposed(),KG(this,n,e)};ce().prototype.pool=function(n,e,t,r,a,i){return this.throwIfDisposed(),bZe(this,n,e,t,r,a,i)};ce().prototype.pow=function(n){return this.throwIfDisposed(),Rm(this,n)};ce().prototype.prelu=function(n){return this.throwIfDisposed(),xZe(this,n)};ce().prototype.prod=function(n,e){return this.throwIfDisposed(),SZe(this,n,e)};ce().prototype.reciprocal=function(){return this.throwIfDisposed(),FZe(this)};ce().prototype.relu=function(){return this.throwIfDisposed(),OZe(this)};ce().prototype.relu6=function(){return this.throwIfDisposed(),MZe(this)};ce().prototype.reshapeAs=function(n){return this.throwIfDisposed(),de(this,n.shape)};ce().prototype.reshape=function(n){return this.throwIfDisposed(),de(this,n)};ce().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),pJe(this,n,e,t)};ce().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),mJe(this,n,e,t)};ce().prototype.reverse=function(n){return this.throwIfDisposed(),Em(this,n)};ce().prototype.rfft=function(){return this.throwIfDisposed(),QZe(this)};ce().prototype.round=function(){return this.throwIfDisposed(),zZe(this)};ce().prototype.rsqrt=function(){return this.throwIfDisposed(),NG(this)};ce().prototype.selu=function(){return this.throwIfDisposed(),qZe(this)};ce().prototype.separableConv2d=function(n,e,t,r,a,i){return this.throwIfDisposed(),VZe(this,n,e,t,r,a,i)};ce().prototype.sigmoid=function(){return this.throwIfDisposed(),Fk(this)};ce().prototype.sign=function(){return this.throwIfDisposed(),UZe(this)};ce().prototype.sin=function(){return this.throwIfDisposed(),wG(this)};ce().prototype.sinh=function(){return this.throwIfDisposed(),xG(this)};ce().prototype.slice=function(n,e){return this.throwIfDisposed(),zi(this,n,e)};ce().prototype.softmax=function(n){return this.throwIfDisposed(),KZe(this,n)};ce().prototype.softplus=function(){return this.throwIfDisposed(),VG(this)};ce().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),Ik(this,n,e)};ce().prototype.split=function(n,e){return this.throwIfDisposed(),Sm(this,n,e)};ce().prototype.sqrt=function(){return this.throwIfDisposed(),as(this)};ce().prototype.square=function(){return this.throwIfDisposed(),sr(this)};ce().prototype.squaredDifference=function(n){return this.throwIfDisposed(),tJe(this,n)};ce().prototype.squeeze=function(n){return this.throwIfDisposed(),rJe(this,n)};ce().prototype.stack=function(n,e){this.throwIfDisposed();let t=n instanceof Sr?[this,n]:[this,...n];return XG(t,e)};ce().prototype.step=function(n){return this.throwIfDisposed(),Im(this,n)};ce().prototype.stridedSlice=function(n,e,t,r,a,i,o,s){return this.throwIfDisposed(),oJe(this,n,e,t,r,a,i,o,s)};ce().prototype.sub=function(n){return this.throwIfDisposed(),fr(this,n)};ce().prototype.sum=function(n,e){return this.throwIfDisposed(),Tt(this,n,e)};ce().prototype.tan=function(){return this.throwIfDisposed(),uJe(this)};ce().prototype.tanh=function(){return this.throwIfDisposed(),H9e(this)};ce().prototype.tile=function(n){return this.throwIfDisposed(),TG(this,n)};ce().prototype.toBool=function(){return this.throwIfDisposed(),ot(this,"bool")};ce().prototype.toFloat=function(){return this.throwIfDisposed(),ot(this,"float32")};ce().prototype.toInt=function(){return this.throwIfDisposed(),ot(this,"int32")};ce().prototype.topk=function(n,e){return this.throwIfDisposed(),lJe(this,n,e)};ce().prototype.transpose=function(n){return this.throwIfDisposed(),gu(this,n)};ce().prototype.unique=function(n){return this.throwIfDisposed(),hJe(this,n)};ce().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),EG(this,n,e)};ce().prototype.unstack=function(n){return this.throwIfDisposed(),DG(this,n)};ce().prototype.where=function(n,e){return this.throwIfDisposed(),fo(n,this,e)};ce().prototype.zerosLike=function(){return this.throwIfDisposed(),kn(this)};var nQe="4.2.0";var rQe={"tfjs-core":Yx.version_core,"tfjs-backend-cpu":$Ke.version_cpu,"tfjs-backend-webgl":qKe.version_webgl,"tfjs-data":xW.version_data,"tfjs-layers":Zx.version_layers,"tfjs-converter":Jx.version_converter,tfjs:nQe};Object.keys(Yx).forEach(function(n){n!=="default"&&Object.defineProperty(xu,n,{enumerable:!0,get:function(){return Yx[n]}})});Object.keys(Zx).forEach(function(n){n!=="default"&&Object.defineProperty(xu,n,{enumerable:!0,get:function(){return Zx[n]}})});Object.keys(Jx).forEach(function(n){n!=="default"&&Object.defineProperty(xu,n,{enumerable:!0,get:function(){return Jx[n]}})});xu.data=xW;xu.version=rQe});var sl=Y((cot,ZG)=>{var{argmin:aQe,distance:iQe,isArray:oQe,isDataFrame:YG,isNumber:sQe,isSeries:uQe,shape:cQe}=Et(),Pm=$h(),lQe=new Function("try { return this === window } catch(e) { return false }");function fQe(n){return qh(n)?n.shape.length===2:YG(n)?!0:oQe(n)&&cQe(n).length===2}function qh(n){return n instanceof Pm.Tensor}function hQe(n){return sQe(n)&&parseInt(n)===n&&n>=0}function dQe(n,e){return Pm.tidy(()=>{qh(n)&&(n=n.arraySync()),qh(e)&&(e=e.arraySync());let t=[],r=e.slice();return n.forEach(a=>{let i=aQe(r.map(o=>iQe(a,o)));t.push(r[i]),r.splice(i,1)}),t.concat(r)})}function pQe(n){return Pm.tidy(()=>((YG(n)||uQe(n))&&(n=n.values),qh(n)||(n=Pm.tensor(n)),n.div(n.abs())))}ZG.exports={isBrowser:lQe,isMatrix:fQe,isTFTensor:qh,isWholeNumber:hQe,orderCentroids:dQe,sign:pQe}});var Lk=Y((lot,eU)=>{var{assert:Mk,flatten:JG,isDataFrame:ku,isEqual:Bk,isSeries:Su,isUndefined:vQe,shape:ul}=Et(),{isTFTensor:Nu,sign:mQe}=sl(),qi=$h();function gQe(n,e){return Nu(n)&&(n=n.arraySync()),(ku(n)||Su(n))&&(n=n.values),Nu(e)&&(e=e.arraySync()),(ku(e)||Su(e))&&(e=e.values),Mk(Bk(ul(n),ul(e)),"`yPred` and `yTrue` must have the same shape!"),qi.tidy(()=>qi.tensor(n).sub(qi.tensor(e)).pow(2).sum().arraySync())}function yQe(n,e){Nu(n)&&(n=n.arraySync()),(ku(n)||Su(n))&&(n=n.values),Nu(e)&&(e=e.arraySync()),(ku(e)||Su(e))&&(e=e.values),Mk(Bk(ul(n),ul(e)),"`yPred` and `yTrue` must have the same shape!");let t=JG(n),r=JG(e),a=0;return t.forEach((i,o)=>{i===r[o]&&a++}),a/t.length}function QG(n,e,t){return qi.tidy(()=>{Nu(n)&&(n=n.arraySync()),(ku(n)||Su(n))&&(n=n.values),Nu(e)&&(e=e.arraySync()),(ku(e)||Su(e))&&(e=e.values),vQe(t)&&(t=n),Nu(t)&&(t=t.arraySync()),(ku(t)||Su(t))&&(t=t.values),typeof t=="number"&&(t=[t]),Mk(Bk(ul(n),ul(e)),"`yTrue` and `yPred` must have the same shape!"),n=qi.tensor(n),e=qi.tensor(e),t=qi.tensor(t);let r=n.sub(e).pow(2).sum(),a=n.sub(t.mean()).pow(2).sum();return qi.scalar(1).sub(r.div(a)).arraySync()})}function bQe(n,e,t){return qi.tidy(()=>{let r=qi.scalar(QG(n,e,t));return mQe(r).mul(r.abs().sqrt()).arraySync()})}eU.exports={sse:gQe,accuracy:yQe,rSquared:QG,rScore:bQe}});var Wi=Y((fot,tU)=>{tU.exports={shouldIgnoreNaNValues:!0}});var cl=Y((hot,rU)=>{var{assert:wQe,flatten:xQe,isArray:kQe,isDataFrame:SQe,isNumber:NQe,isSeries:TQe}=Et();function nU(n){if(SQe(n)||TQe(n))return nU(n.values);wQe(kQe(n),"The `containsOnlyNumbers` function only works on arrays, Series, and DataFrames!");let e=xQe(n);for(let t=0;t<e.length;t++)if(!NQe(e[t]))return!1;return!0}rU.exports=nU});var $k=Y((dot,aU)=>{var{dropMissing:EQe,flatten:IQe,isArray:CQe,isDataFrame:AQe,isSeries:DQe}=Et();function zk(n){return typeof n=="number"?n===0||n===1:AQe(n)||DQe(n)?zk(n.values):CQe(n)?n.length===0?!1:EQe(IQe(n)).every(t=>zk(t)):!1}aU.exports=zk});var pU=Y((pot,dU)=>{var{abs:iU,apply:oU,assert:sU,clamp:_Qe,copy:FQe,divide:RQe,dropNaN:OQe,flatten:PQe,isArray:MQe,isDataFrame:BQe,isNumber:uU,isSeries:LQe,max:cU,median:lU,min:zQe,sort:$Qe,subtract:fU}=Et(),qQe=Wi(),WQe=cl(),VQe=$k();function hU(n,e){if(BQe(n)||LQe(n)){let u=n.copy();return u._values=hU(u._values,e),u}if(sU(MQe(n),"The `clipOutliers` function only works on arrays, Series, and DataFrames!"),e=e||5,sU(uU(e),"Any `maxScore` value passed into the `clipOutliers` function must be a number!"),!qQe.shouldIgnoreNaNValues&&!WQe(n))return oU(n,()=>NaN);let t=PQe(n),r=OQe(t);if(VQe(r)||r.length===0)return n;let a=lU(r),i=lU(iU(fU(r,a))),o=!1;if(i===0){let u=$Qe(FQe(r)),c=u.filter(d=>d<a),l=u.filter(d=>d>a),f=a,h=a;if(c.length>0&&(f=cU(c)),l.length>0&&(h=zQe(l)),i=(h-f)/2,i===0)return n;o=(a-f)/i>e||(h-a)/i>e}return cU(RQe(iU(fU(r,a)),i))>e||o?oU(n,u=>uU(u)?_Qe(u,a-e*i,a+e*i):u):n}dU.exports=hU});var Wk=Y((vot,kU)=>{var{assert:vU,dropNaN:mU,isArray:gU,isSeries:yU,mean:bU,shape:wU,variance:xU}=Et(),GQe=Wi();function qk(n,e){if(yU(n))return qk(n.values,e);if(yU(e))return qk(n,e.values);vU(gU(n)&&gU(e)&&wU(n).length===1&&wU(e).length===1,"The `cohensd` function only works on 1-dimensional arrays and Series!"),vU(n.length===e.length,"Two arrays or Series passed into the `cohensd` function must have the same length!"),GQe.shouldIgnoreNaNValues&&(n=mU(n),e=mU(e));try{let t=bU(n),r=bU(e),a=Math.sqrt((xU(n)+xU(e))/2);return(t-r)/a}catch{return NaN}}kU.exports=qk});var EU=Y((mot,TU)=>{var{assert:SU,DataFrame:UQe,isArray:HQe,isSeries:KQe,shape:jQe,zeros:XQe}=Et();function NU(n){if(KQe(n)){let r=new UQe(NU(n.values));return r.index=n.index.slice(),r.columns=n.index.slice(),r}SU(HQe(n),"The `diagonalize` function only works on 1-dimensional arrays and Series!");let e=jQe(n);SU(e.length===1,"The `diagonalize` function only works on 1-dimensional arrays and Series!");let t=XQe([e[0],e[0]]);return n.forEach((r,a)=>t[a][a]=r),t}TU.exports=NU});var Hk=Y((got,DU)=>{var{assert:Vk,clamp:YQe,correl:IU,DataFrame:Mm,dropNaNPairwise:ZQe,isArray:CU,isDataFrame:Bm,isJagged:AU,isUndefined:JQe,ndarray:QQe}=Et(),eet=Wi();function Gk(n){let e="@jrc03c/js-data-science-helpers/get-correlation-matrix";return Object.defineProperty(n,e,{configurable:!1,enumerable:!1,writable:!1,value:Symbol.for(e)}),n}function Uk(n,e){if(JQe(e)&&(e=n),Bm(n)){let r=new Mm(Uk(n.values,e));return r.index=n.columns.slice(),r.columns=Bm(e)?e.columns.slice():new Mm(e).columns.slice(),Gk(r)}if(Bm(e)){let r=new Mm(Uk(n,e.values));return r.index=Bm(n)?n.columns.slice():new Mm(n).columns.slice(),r.columns=e.columns.slice(),Gk(r)}Vk(CU(n)&&CU(e),"The `getCorrelationMatrix` function only works on 2-dimensional arrays and DataFrames!"),Vk(!AU(n)&&!AU(e),"The `getCorrelationMatrix` function only works on non-jagged 2-dimensional arrays and DataFrames!"),Vk(n.length===e.length,'The dimensions of the matrices you passed into the `getCorrelationMatrix` function aren\'t compatible! ([shape(a).join(", ")] vs. [shape(b).join(", ")]) The function expects that you\'ll be comparing the columns of two matrices where the columns are all of the same length, so please make sure that the matrices are oriented accordingly.');let t=QQe([n[0].length,e[0].length]);for(let r=0;r<n[0].length;r++){let a=n.map(i=>i[r]);for(let i=0;i<e[0].length;i++){let o=e.map(s=>s[i]);eet.shouldIgnoreNaNValues?t[r][i]=IU(...ZQe(a,o)):t[r][i]=IU(a,o)}}return Gk(YQe(t,-1,1))}DU.exports=Uk});var Kk=Y((yot,_U)=>{function tet(n){try{let e="@jrc03c/js-data-science-helpers/get-correlation-matrix";return n[e]===Symbol.for(e)}catch{return!1}}_U.exports=tet});var PU=Y((bot,OU)=>{var{DataFrame:jk,isArray:net,isDataFrame:Lm,isNumber:FU,MathError:ret,sort:aet}=Et(),RU=Hk(),iet=Kk();function oet(n,e,t){t=Object.values(arguments).find(i=>FU(i))||1-1e-5;let r=(()=>{let i=Object.values(arguments).filter(o=>net(o)||Lm(o));if(i.length===1){let o=i[0];if(iet(o))return Lm(o)?o:new jk(o);{let s=RU(o,null);return Lm(s)?s:new jk(s)}}if(i.length===2){let o=RU(i[0],i[1]);return Lm(o)?o:new jk(o)}throw new ret("You must pass 1 or 2 2-dimensional arrays or DataFrames into the `getHighlyCorrelatedColumns` function!")})(),a={};return r.values.forEach((i,o)=>{i.forEach((s,u)=>{if(FU(s)&&s>t){let c=r.index[o],l=r.columns[u];a[c]||(a[c]=[]),a[c].indexOf(l)<0&&a[c].push(l),a[l]||(a[l]=[]),a[l].indexOf(c)<0&&a[l].push(c)}})}),Object.keys(a).forEach(i=>{a[i]=aet(a[i])}),a}OU.exports=oet});var Xk=Y((wot,BU)=>{var{dropNaN:set,isArray:uet,isDataFrame:cet,isNumber:fet,isSeries:het,pow:det,sqrt:pet,sum:vet}=Et(),met=Wi();function MU(n){return cet(n)||het(n)?MU(n.values):fet(n)?Math.abs(n):uet(n)?(met.shouldIgnoreNaNValues&&(n=set(n)),pet(vet(det(n,2)))):NaN}BU.exports=MU});var Yk=Y((xot,qU)=>{var{assert:LU,DataFrame:get,isArray:yet,isSeries:bet,isString:wet,isUndefined:zU,set:xet,shape:ket,sort:Net}=Et();function $U(){if(arguments.length===1&&bet(arguments[0])){let{name:a,values:i}=arguments[0],o=$U(a,i),s=new get(o);return s.index=arguments[0].index.slice(),s}let[n,e]=arguments;LU(wet(n),"When passing two arguments into the `getOneHotEncodings` function, the first argument must be a string representing the name of the variable being encoded!"),LU(yet(e)&&ket(e).length===1,"When passing two arguments into the `getOneHotEncodings` function, the second argument must be a 1-dimensional array!");let t={};return Net(xet(e)).filter(a=>typeof a!="number"||a.toString()!=="NaN").filter(a=>!zU(a)).map(a=>n+"_"+a).slice(0,-1).forEach(a=>{t[a]=e.map(i=>a===n+"_"+i?1:typeof i=="number"&&i.toString()==="NaN"?NaN:zU(i)?NaN:0)}),t}qU.exports=$U});var VU=Y((kot,WU)=>{var{count:Tet}=Et();function Eet(n){return Tet(n).map(t=>(t.percentage=t.count/n.length,t))}WU.exports=Eet});var GU=Y((Sot,Iet)=>{Iet.exports=[.5,.49601,.49202,.48803,.48405,.48006,.47608,.4721,.46812,.46414,.46017,.4562,.45224,.44828,.44433,.44038,.4364,.43251,.42858,.42465,.42074,.41683,.41294,.40905,.40517,.40129,.39743,.39358,.38974,.38591,.38209,.37828,.37448,.3707,.36693,.36317,.35942,.35569,.35197,.34827,.34458,.3409,.33724,.3336,.32997,.32636,.32276,.31918,.31561,.31207,.30854,.30503,.30153,.29806,.2946,.29116,.28774,.28434,.28096,.2776,.27425,.27093,.26763,.26435,.26109,.25785,.25463,.25143,.24825,.2451,.24196,.23885,.23576,.2327,.22965,.22663,.22363,.22065,.2177,.21476,.21186,.20897,.20611,.20327,.20045,.19766,.19489,.19215,.18943,.18673,.18406,.18141,.17879,.17619,.17361,.17106,.16853,.16602,.16354,.16109,.15866,.15625,.15386,.15151,.14917,.14686,.14457,.14231,.14007,.13786,.13567,.1335,.13136,.12924,.12714,.12507,.12302,.121,.119,.11702,.11507,.11314,.11123,.10935,.10749,.10565,.10383,.10204,.10027,.09853,.0968,.0951,.09342,.09176,.09012,.08851,.08692,.08534,.08379,.08226,.08076,.07927,.0778,.07636,.07493,.07353,.07215,.07078,.06944,.06811,.06681,.06552,.06426,.06301,.06178,.06057,.05938,.05821,.05705,.05592,.0548,.0537,.05262,.05155,.0505,.04947,.04846,.04746,.04648,.04551,.04457,.04363,.04272,.04182,.04093,.04006,.0392,.03836,.03754,.03673,.03593,.03515,.03438,.03362,.03288,.03216,.03144,.03074,.03005,.02938,.02872,.02807,.02743,.0268,.02619,.02559,.025,.02442,.02385,.0233,.02275,.02222,.02169,.02118,.02068,.02018,.0197,.01923,.01876,.01831,.01786,.01743,.017,.01659,.01618,.01578,.01539,.015,.01463,.01426,.0139,.01355,.01321,.01287,.01255,.01222,.01191,.0116,.0113,.01101,.01072,.01044,.01017,.0099,.00964,.00939,.00914,.00889,.00866,.00842,.0082,.00798,.00776,.00755,.00734,.00714,.00695,.00676,.00657,.00639,.00621,.00604,.00587,.0057,.00554,.00539,.00523,.00508,.00494,.0048,.00466,.00453,.0044,.00427,.00415,.00402,.00391,.00379,.00368,.00357,.00347,.00336,.00326,.00317,.00307,.00298,.00289,.0028,.00272,.00264,.00256,.00248,.0024,.00233,.00226,.00219,.00212,.00205,.00199,.00193,.00187,.00181,.00175,.00169,.00164,.00159,.00154,.00149,.00144,.00139,.00135,.00131,.00126,.00122,.00118,.00114,.00111,.00107,.00104,.001,97e-5,94e-5,9e-4,87e-5,84e-5,82e-5,79e-5,76e-5,74e-5,71e-5,69e-5,66e-5,64e-5,62e-5,6e-4,58e-5,56e-5,54e-5,52e-5,5e-4,48e-5,47e-5,45e-5,43e-5,42e-5,4e-4,39e-5,38e-5,36e-5,35e-5,34e-5,32e-5,31e-5,3e-4,29e-5,28e-5,27e-5,26e-5,25e-5,24e-5,23e-5,22e-5,22e-5,21e-5,2e-4,19e-5,19e-5,18e-5,17e-5,17e-5,16e-5,15e-5,15e-5,14e-5,14e-5,13e-5,13e-5,12e-5,12e-5,11e-5,11e-5,1e-4,1e-4,1e-4,9e-5,9e-5,8e-5,8e-5,8e-5,8e-5,7e-5,7e-5,7e-5,6e-5,6e-5,6e-5,6e-5,5e-5,5e-5,5e-5,5e-5,5e-5,4e-5,4e-5,4e-5,4e-5,4e-5,4e-5,3e-5,3e-5,3e-5,3e-5,3e-5,3e-5,3e-5,3e-5,2e-5,2e-5,2e-5,2e-5]});var Jk=Y((Not,QU)=>{var{abs:UU,assert:Cet,dropNaNPairwise:Aet,flatten:zm,isArray:HU,isDataFrame:KU,isEqual:Det,isSeries:jU,mean:XU,remap:_et,round:Fet,shape:YU,sqrt:Ret,std:ZU}=Et(),Oet=Wi(),JU=GU();function Pet(n){return UU(n)>4.1?0:JU[Fet(_et(UU(n),0,4.1,0,JU.length))]}function Zk(n,e){if(KU(n)||jU(n))return Zk(n.values,e);if(KU(e)||jU(e))return Zk(n,e.values);Cet(HU(n)&&HU(e)&&Det(YU(n),YU(e)),"You must pass two identically-shaped arrays, Series, or DataFrames into the `pValue` function!");let[t,r]=Oet.shouldIgnoreNaNValues?Aet(zm(n),zm(e)):[zm(n),zm(e)];if(t.length===0||r.length===0)return NaN;let a=XU(t),i=XU(r),o=ZU(t),s=ZU(r),u=t.length,c=r.length,l=(a-i)/Ret(o*o/u+s*s/c);return 2*Pet(l)}QU.exports=Zk});var a6=Y((Tot,r6)=>{var{assert:Qk,clamp:Met,DataFrame:$m,dropNaNPairwise:Bet,isArray:e6,isDataFrame:qm,isJagged:t6,isUndefined:Let,ndarray:zet}=Et(),$et=Wi(),n6=Jk();function e2(n){let e="@jrc03c/js-data-science-helpers/get-p-value-matrix";return Object.defineProperty(n,e,{configurable:!1,enumerable:!1,writable:!1,value:Symbol.for(e)}),n}function t2(n,e){if(Let(e)&&(e=n),qm(n)){let r=new $m(t2(n.values,e));return r.index=n.columns.slice(),r.columns=qm(e)?e.columns.slice():new $m(e).columns.slice(),e2(r)}if(qm(e)){let r=new $m(t2(n,e.values));return r.index=qm(n)?n.columns.slice():new $m(n).columns.slice(),r.columns=e.columns.slice(),e2(r)}Qk(e6(n)&&e6(e),"The `getPValueMatrix` function only works on 2-dimensional arrays and DataFrames!"),Qk(!t6(n)&&!t6(e),"The `getPValueMatrix` function only works on non-jagged 2-dimensional arrays and DataFrames!"),Qk(n.length===e.length,'The dimensions of the matrices you passed into the `getPValueMatrix` function aren\'t compatible! ([shape(a).join(", ")] vs. [shape(b).join(", ")]) The function expects that you\'ll be comparing the columns of two matrices where the columns are all of the same length, so please make sure that the matrices are oriented accordingly.');let t=zet([n[0].length,e[0].length]);for(let r=0;r<n[0].length;r++){let a=n.map(i=>i[r]);for(let i=0;i<e[0].length;i++){let o=e.map(s=>s[i]);$et.shouldIgnoreNaNValues?t[r][i]=n6(...Bet(a,o)):t[r][i]=n6(a,o)}}return e2(Met(t,0,1))}r6.exports=t2});var c6=Y((Eot,u6)=>{var{assert:Wm,intersect:qet,isDataFrame:i6,isSeries:o6,isUndefined:s6}=Et(),ll=class{constructor(e){let t=this;Wm(s6(e)||e===ll.DROP_NAN_MODE||e===ll.DROP_MISSING_MODE,"The `mode` value passed into the `IndexMatcher` constructor must be undefined or one of [IndexMatcher.DROP_NAN_MODE, IndexMatcher.DROP_MISSING_MODE]! (By default, the mode is `Indexer.DROP_MISSING_MODE`.)"),t.mode=s6(e)?ll.DROP_MISSING_MODE:e,t.index=null}fit(){let e=this,t=[];return Object.values(arguments).forEach(r=>{Wm(i6(r)||o6(r),"The `IndexMatcher` only works on Series and DataFrames! To drop NaN values in a pair-wise fashion from regular arrays, use the `dropNaNPairwise` function from the @jrc03c/js-math-tools library."),e.mode===ll.DROP_MISSING_MODE?t.push(r.dropMissing().index):t.push(r.dropNaN().index)}),e.index=qet(...t),e}transform(){let e=this;Wm(!!e.index,"The IndexMatcher hasn't been fitted yet! Please call the `fit` method before calling the `transform` method.");let t=Object.values(arguments).map(r=>(Wm(i6(r)||o6(r),"The `IndexMatcher` only works on Series and DataFrames! To drop NaN values in a pair-wise fashion from regular arrays, use the `dropNaNPairwise` function from the @jrc03c/js-math-tools library."),r.get(e.index,null)));return t.length===1?t[0]:t}fitAndTransform(){return this.fit(...arguments).transform(...arguments)}},Wh=ll;Zm(Wh,"DROP_NAN_MODE","DROP_NAN_MODE"),Zm(Wh,"DROP_MISSING_MODE","DROP_MISSING_MODE");u6.exports=Wh});var r2=Y((Cot,p6)=>{var{assert:n2,isArray:Wet,isBoolean:Vet,isDataFrame:l6,isSeries:f6,int:Get,isNumber:Uet,isUndefined:h6,range:d6,set:Het,shape:Ket,shuffle:jet}=Et();p6.exports=function(){let e=Array.from(arguments),t=e.find(d=>Vet(d)),r=h6(t)?!0:t,a=e.find(d=>Uet(d)),i=h6(a)?.1:a;n2(i>0&&i<1,"`testSize` must be a number between 0 and 1 (exclusive on both ends)!");let o=e.filter(d=>Wet(d)||l6(d)||f6(d));n2(o.length>0,"You must pass at least one dataset into the `trainTestSplit` function!");let s=o.map(d=>Ket(d)[0]);n2(Het(s).length===1,`All datasets passed into the \`trainTestSplit\` function must be the same length at their shallowest dimension! The lengths of your datasets, though, are: ${s.join(", ")}`);let u=[],c=r?jet(d6(0,s[0])):d6(0,s[0]),l=Get((1-i)*c.length),f=c.slice(0,l),h=c.slice(l);return o.forEach(d=>{if(l6(d))u.push(d.get(f,null)),u.push(d.get(h,null));else if(f6(d))u.push(d.get(f)),u.push(d.get(h));else{let p=[],v=[];d.forEach((m,g)=>{f.indexOf(g)>-1?p.push(m):v.push(m)}),u.push(p),u.push(v)}}),u}});var Gm=Y((Aot,w6)=>{var{add:Xet,argmin:Yet,assert:Zet,flatten:v6,isArray:Jet,isDataFrame:m6,isEqual:Qet,int:ett,isNumber:ttt,isSeries:g6,normal:a2,pow:ntt,random:rtt,range:att,scale:itt,shape:Vm,subtract:ott,sum:stt}=Et(),utt=r2();function i2(n,e){(m6(n)||g6(n))&&(n=n.values),(m6(e)||g6(e))&&(e=e.values),Zet(Qet(Vm(n),Vm(e)),"`yPred` and `yTrue` must have the same shape!");let t=v6(n),r=v6(e),a=0;return t.forEach((i,o)=>{i===r[o]&&a++}),a/t.length}function ctt(n){test(`tests that the \`${n.name}\` model works correctly`,()=>{let e=a2([5,10]).map(f=>f.map(h=>h*100+a2()*100)),t=[],r=att(0,500).map(()=>{let f=ett(rtt()*e.length),h=e[f];return t.push(f),Xet(h,itt(5,a2(Vm(h))))}),[a,i,o,s]=utt(r,t),u=new n({k:e.length});u.fit(a),u.centroids=y6(e,u.centroids);let c=u.predict(a),l=u.predict(i);expect(i2(o,c)).toBeGreaterThan(.95),expect(i2(s,l)).toBeGreaterThan(.95)})}function ltt(n){return Jet(n)&&Vm(n).length===2}function ftt(n){return ttt(n)&&parseInt(n)===n&&n>=0}function y6(n,e){return n.map(t=>e[Yet(e.map(r=>b6(t,r)))])}function b6(n,e){return stt(ntt(ott(n,e),2))}w6.exports={accuracy:i2,createGenericTest:ctt,isMatrix:ltt,isWholeNumber:ftt,orderCentroids:y6,sse:b6}});var u2=Y((Dot,N6)=>{var{add:x6,argmin:htt,assert:Tu,copy:dtt,distance:k6,divide:ptt,isDataFrame:vtt,isFunction:mtt,isUndefined:Um,normal:gtt,random:ytt,range:btt,scale:wtt,shuffle:xtt,zeros:S6}=Et(),{isMatrix:ktt,isWholeNumber:o2,sse:Stt}=Gm(),s2=class{constructor(e){Tu(typeof e=="object","`config` must be an object! See the documentation for more information about the properties that the `config` object can contain."),Tu(o2(e.k),"`k` must be a whole number!"),Tu(o2(e.maxIterations)||Um(e.maxIterations),"`maxIterations` must be a whole number or undefined!"),Tu(o2(e.maxRestarts)||Um(e.maxRestarts),"`maxRestarts` must be a whole number or undefined!"),Tu(typeof e.tolerance=="number"||Um(e.tolerance),"`tolerance` must be a number or undefined!");let t=this;t.k=e.k,t.maxRestarts=e.maxRestarts||25,t.maxIterations=e.maxIterations||100,t.tolerance=e.tolerance||1e-4,t.centroids=null,t._fitState=null}initializeCentroids(e){let t=this;return xtt(e).slice(0,t.k)}fitStep(e,t){let r=this;if(Tu(ktt(e),"`x` must be a matrix!"),vtt(e)&&(e=e.values),Um(t)||Tu(mtt(t),"If defined, `progress` must be a function!"),r._fitState){if(r._fitState.isFinished)return r}else{let u=r.initializeCentroids(e);r._fitState={currentRestart:0,currentIteration:0,currentCentroids:u,bestCentroids:u,bestScore:-1/0,isFinished:!1}}let a=r.predict(e,r._fitState.currentCentroids),i=[],o=S6(r.k);e.forEach((u,c)=>{let l=a[c];i[l]||(i[l]=S6(u.length)),i[l]=x6(i[l],u),o[l]++});let s=btt(0,r.k).map(u=>o[u]===0?x6(r._fitState.currentCentroids[parseInt(ytt()*r._fitState.currentCentroids.length)],wtt(.001,gtt(r._fitState.currentCentroids[0].length))):ptt(i[u],o[u]));if(k6(r._fitState.currentCentroids,s)<r.tolerance?r._fitState.currentIteration=r.maxIterations-1:r._fitState.currentCentroids=s,t&&t((r._fitState.currentRestart+r._fitState.currentIteration/r.maxIterations)/r.maxRestarts,r),r._fitState.currentIteration++,r._fitState.currentIteration>=r.maxIterations){let u=r.score(e,r._fitState.currentCentroids);if(u>r._fitState.bestScore&&(r._fitState.bestScore=u,r._fitState.bestCentroids=dtt(r._fitState.currentCentroids)),r._fitState.currentIteration=0,r._fitState.currentRestart++,r._fitState.currentRestart>=r.maxRestarts)r._fitState.isFinished=!0,r.centroids=r._fitState.bestCentroids,t&&t(1,r);else{let c=r.initializeCentroids(e);r._fitState.currentCentroids=c}}return r}fit(e,t){let r=this;for(r._fitState&&(r._fitState=null);!r._fitState||!r._fitState.isFinished;)r.fitStep(e,t);return r}predict(e,t){if(t=t||this.centroids,!t)throw new Error("No centroids were provided to the `predict` method, and the K-Means model hasn't been fitted yet. Please either pass centroids as a second parameter to the `predict` method or run the `fit` method first!");return e.map(a=>htt(t.map(i=>k6(a,i))))}score(e,t){let r=this;if(t=t||r.centroids,!t)throw new Error("No centroids were provided to the `score` method, and the K-Means model hasn't been fitted yet. Please either pass centroids as a second parameter to the `score` method or run the `fit` method first!");let i=r.predict(e,t).map(o=>t[o]);return-Stt(e,i)}};N6.exports=s2});var l2=Y((_ot,I6)=>{var{argmin:Ntt,distance:T6,divide:Ttt,max:Ett,random:E6}=Et(),Itt=u2(),c2=class extends Itt{initializeCentroids(e){let t=this,r=[e[parseInt(E6()*e.length)]];for(;r.length<t.k;){let a=e.map(o=>T6(o,r[Ntt(r.map(s=>T6(o,s)))])),i=Ttt(a,Ett(a));r.push(e[i.findIndex(o=>E6()<o)])}return r}};I6.exports=c2});var D6=Y((Fot,A6)=>{var{assert:po,isArray:Ctt,isDataFrame:Att,isEqual:Dtt,isFunction:_tt,isUndefined:fl,range:Ftt,shape:C6}=Et(),{isMatrix:Rtt,isWholeNumber:f2}=Gm(),Ott=l2(),h2=class{constructor(e){fl(e)&&(e={}),po(typeof e=="object","`config` must be an object! See the documentation for more information about the properties that the `config` object can contain."),fl(e.ks)&&(e.ks=Ftt(1,16)),po(Ctt(e.ks),"`ks` must be an array of whole numbers!"),e.ks.forEach(r=>{po(f2(r),"`ks` must be an array of whole numbers!")}),po(f2(e.maxIterations)||fl(e.maxIterations),"`maxIterations` must be a whole number or undefined!"),po(f2(e.maxRestarts)||fl(e.maxRestarts),"`maxRestarts` must be a whole number or undefined!"),po(typeof e.tolerance=="number"||fl(e.tolerance),"`tolerance` must be a number or undefined!");let t=this;t.ks=e.ks,t.maxRestarts=e.maxRestarts||25,t.maxIterations=e.maxIterations||100,t.tolerance=e.tolerance||1e-4,t.scoreStopRatio=e.scoreStopRatio||.85,t.modelClass=e.modelClass||Ott,t.fittedModel=null,t._fitState=null}fitStep(e,t){let r=this;if(po(Rtt(e),"`x` must be a matrix!"),Att(e)&&(e=e.values),fl(t)||po(_tt(t),"If defined, `progress` must be a function!"),!r._fitState)r._fitState={isFinished:!1,lastScore:-1/0,currentIndex:0};else if(r._fitState.isFinished)return r;let a=r.ks[r._fitState.currentIndex],i=new r.modelClass({k:a,maxRestarts:10,maxIterations:20});i.fit(e,s=>t?t((r._fitState.currentIndex+s)/(r.ks.length+1)):null);let o=i.score(e);return o/r._fitState.lastScore>r.scoreStopRatio?(r._fitState.isFinished=!0,r._fitState.currentIndex--):(r._fitState.lastScore=o,r._fitState.currentIndex+1>=r.ks.length?r._fitState.isFinished=!0:r._fitState.currentIndex++),r._fitState.isFinished&&(r.fittedModel=new r.modelClass({k:r.ks[r._fitState.currentIndex],maxRestarts:r.maxRestarts,maxIterations:r.maxIterations}),r.fittedModel.fit(e,s=>t?t((r.ks.length+s)/(r.ks.length+1)):null),t&&t(1)),r}fit(e,t){let r=this;for(r._fitState=null;!r._fitState||!r._fitState.isFinished;)r.fitStep(e,t);return r}predict(e,t){return this.fittedModel.predict(e,t)}score(e,t){return this.fittedModel.score(e,t)}get k(){return this.fittedModel.k}set k(e){throw new Error("You can't set the k-value manually! It has to be set automatically via the `fit` method.")}get centroids(){return this.fittedModel.centroids}set centroids(e){let t=this;po(Dtt(C6(e),C6(t.fittedModel.centroids)),"When assigning a new value to the `centroids` property, the new centroids must have the same shape as the old centroids!"),t.fittedModel.centroids=e}};A6.exports=h2});var F6=Y((Rot,_6)=>{_6.exports={KMeansMeta:D6(),KMeansNaive:u2(),KMeansPlusPlus:l2(),helpers:Gm()}});var d2=Y((Oot,L6)=>{var{apply:Ptt,assert:Mtt,dropNaN:R6,isArray:Btt,isDataFrame:Ltt,isSeries:ztt,mean:O6,std:P6}=Et(),M6=Wi();function B6(n){if(Ltt(n)||ztt(n)){let r=n.copy();return r.values=B6(r.values),r}Mtt(Btt(n),"The `normalize` function only works on arrays, Series, and DataFrames!");let e=(()=>M6.shouldIgnoreNaNValues?O6(R6(n)):O6(n))(),t=(()=>M6.shouldIgnoreNaNValues?P6(R6(n)):P6(n))();return t===0?n:Ptt(n,r=>(r-e)/t)}L6.exports=B6});var v2=Y((Pot,V6)=>{var{assert:hl,dot:z6,isArray:$6,isSeries:p2,scale:$tt,Series:qtt,shape:q6}=Et(),W6=cl();function Hm(n,e){if(p2(n)){if(p2(e))return new qtt(Hm(n.values,e.values));{let t=n.copy();return t.values=Hm(n.values,e),t}}if(p2(e)){let t=e.copy();return t.values=Hm(n,e.values),t}return hl($6(n),"`project` only works on vectors!"),hl($6(e),"`project` only works on vectors!"),hl(W6(n),"`project` only works on vectors of numbers!"),hl(W6(e),"`project` only works on vectors of numbers!"),hl(q6(n).length===1,"`project` only works on vectors!"),hl(q6(e).length===1,"`project` only works on vectors!"),$tt(z6(e,n)/z6(e,e),e)}V6.exports=Hm});var j6=Y((Mot,K6)=>{var{assert:G6,copy:Wtt,DataFrame:Vtt,divide:Gtt,isArray:Utt,isDataFrame:Htt,isJagged:Ktt,shape:jtt,subtract:Xtt,transpose:U6}=Et(),Ytt=cl(),Ztt=Xk(),Jtt=v2();function H6(n){if(Htt(n)){let a=new Vtt(H6(n.values));return a.index=n.index.slice(),a.columns=n.columns.slice(),a}G6(Utt(n)&&!Ktt(n)&&jtt(n).length===2,"`orthonormalize` only works on matrices!"),G6(Ytt(n),"`orthonormalize` only works on matrices of numbers!");let e=U6(n),t=[];e.forEach(a=>{let i=Wtt(a);t.forEach(o=>{i=Xtt(i,Jtt(i,o))}),t.push(i)});let r=t.map(a=>Gtt(a,Ztt(a)));return U6(r)}K6.exports=H6});var Y6=Y((Bot,X6)=>{function Qtt(n){if(typeof n!="string")throw new Error("`text` must be a string!");n=n.trim();let e="",t=!1;for(let r=0;r<n.length;r++){let a=n[r];a.match(/[A-Za-z0-9]/g)?(e.length===0?e+=a.toLowerCase():t?e+=a.toUpperCase():e+=a,t=!1):!a.includes("'")&&!a.includes("\u2019")&&!a.includes("\u275C")&&(t=!0)}return e}X6.exports=Qtt});var J6=Y((Lot,Z6)=>{function ent(n,e){return e=e||"",n.split(`
`).map(t=>t.trim().length>0?e+t:t).join(`
`)}Z6.exports=ent});var eH=Y((zot,Q6)=>{function tnt(n,e,t){if(typeof n!="string")throw new Error("`text` must be a string!");if(typeof e!="string")throw new Error("`a` must be a string!");if(typeof t!="string")throw new Error("`b` must be a string!");return n.split(e).join(t)}Q6.exports=tnt});var nH=Y(($ot,tH)=>{tH.exports="!\"#%&'()*+,-./:;<=>?@[]^_`{|}~\xA0\xA1\xA4\xA7\xA9\xAA\xAB\xAE\xB0\xB1\xB6\xB7\xBA\xBB\xBF\xD7\xF7\u0254\u0300\u0301\u0302\u0303\u037E\u0387\u055A\u055B\u055C\u055D\u055E\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A\u066B\u066C\u066D\u06D4\u0700\u0701\u0702\u0703\u0704\u0705\u0706\u0707\u0708\u0709\u070A\u070B\u070C\u070D\u07F7\u07F8\u07F9\u0830\u0831\u0832\u0833\u0834\u0835\u0836\u0837\u0838\u0839\u083A\u083B\u083C\u083D\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04\u0F05\u0F06\u0F07\u0F08\u0F09\u0F0A\u0F0B\u0F0C\u0F0D\u0F0E\u0F0F\u0F10\u0F11\u0F12\u0F14\u0F3A\u0F3B\u0F3C\u0F3D\u0F85\u0FD0\u0FD1\u0FD2\u0FD3\u0FD4\u0FD9\u0FDA\u104A\u104B\u104C\u104D\u104E\u104F\u10FB\u1360\u1361\u1362\u1363\u1364\u1365\u1366\u1367\u1368\u1400\u166E\u169B\u169C\u16EB\u16EC\u16ED\u1735\u1736\u17D4\u17D5\u17D6\u17D8\u17D9\u17DA\u1800\u1801\u1802\u1803\u1804\u1805\u1806\u1807\u1808\u1809\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0\u1AA1\u1AA2\u1AA3\u1AA4\u1AA5\u1AA6\u1AA8\u1AA9\u1AAA\u1AAB\u1AAC\u1AAD\u1B5A\u1B5B\u1B5C\u1B5D\u1B5E\u1B5F\u1B60\u1BFC\u1BFD\u1BFE\u1BFF\u1C3B\u1C3C\u1C3D\u1C3E\u1C3F\u1C7E\u1C7F\u1CC0\u1CC1\u1CC2\u1CC3\u1CC4\u1CC5\u1CC6\u1CC7\u1CD3\u2010\u2011\u2012\u2013\u2014\u2015\u2016\u2017\u2018\u2019\u201A\u201B\u201C\u201D\u201E\u201F\u2020\u2021\u2022\u2023\u2024\u2025\u2026\u2027\u2030\u2031\u2032\u2033\u2034\u2035\u2036\u2037\u2038\u2039\u203A\u203B\u203C\u203D\u203E\u203F\u2040\u2041\u2042\u2043\u2045\u2046\u2047\u2048\u2049\u204A\u204B\u204C\u204D\u204E\u204F\u2050\u2051\u2052\u2053\u2054\u2055\u2056\u2057\u2058\u2059\u205A\u205B\u205C\u205D\u205E\u207D\u207E\u208D\u208E\u2116\u2117\u2120\u2122\u212E\u2212\u2234\u2235\u2248\u2300\u2308\u2309\u230A\u230B\u2311\u2329\u232A\u2380\u25CA\u25CC\u261E\u2640\u2642\u26A5\u2766\u2767\u2768\u2769\u276A\u276B\u276C\u276D\u276E\u276F\u2770\u2771\u2772\u2773\u2774\u2775\u27C5\u27C6\u27E6\u27E7\u27E8\u27E9\u27EA\u27EB\u27EC\u27ED\u27EE\u27EF\u2983\u2984\u2985\u2986\u2987\u2988\u2989\u298A\u298B\u298C\u298D\u298E\u298F\u2990\u2991\u2992\u2993\u2994\u2995\u2996\u2997\u2998\u29D8\u29D9\u29DA\u29DB\u29FC\u29FD\u2CF9\u2CFA\u2CFB\u2CFC\u2CFE\u2CFF\u2D70\u2E00\u2E01\u2E02\u2E03\u2E04\u2E05\u2E06\u2E07\u2E08\u2E09\u2E0A\u2E0B\u2E0C\u2E0D\u2E0E\u2E0F\u2E10\u2E11\u2E12\u2E13\u2E14\u2E15\u2E16\u2E17\u2E18\u2E19\u2E1A\u2E1B\u2E1C\u2E1D\u2E1E\u2E1F\u2E20\u2E21\u2E22\u2E23\u2E24\u2E25\u2E26\u2E27\u2E28\u2E29\u2E2A\u2E2B\u2E2C\u2E2D\u2E2E\u2E30\u2E31\u2E32\u2E33\u2E34\u2E35\u2E36\u2E37\u2E38\u2E39\u2E3A\u2E3B\u2E3C\u2E3D\u2E3E\u2E3F\u2E40\u2E41\u2E42\u2E43\u2E44\u2E45\u2E46\u2E47\u2E48\u2E49\u2E4A\u2E4B\u2E4C\u2E4D\u2E4E\u2E4F\u2E52\u3001\u3002\u3003\u3008\u3009\u300A\u300B\u300C\u300D\u300E\u300F\u3010\u3011\u3014\u3015\u3016\u3017\u3018\u3019\u301A\u301B\u301C\u301D\u301E\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D\uA60E\uA60F\uA673\uA67E\uA6F2\uA6F3\uA6F4\uA6F5\uA6F6\uA6F7\uA874\uA875\uA876\uA877\uA8CE\uA8CF\uA8F8\uA8F9\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1\uA9C2\uA9C3\uA9C4\uA9C5\uA9C6\uA9C7\uA9C8\uA9C9\uA9CA\uA9CB\uA9CC\uA9CD\uA9DE\uA9DF\uAA5C\uAA5D\uAA5E\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uD800\uD801\uD802\uD803\uD804\uD805\uD806\uD807\uD809\uD81A\uD81B\uD82F\uD836\uD83A\u{1F03B}\uDC41\uDC42\uDC43\uDC44\uDC45\uDC47\uDC48\uDC49\uDC4A\uDC4B\uDC4C\uDC4D\uDC4E\uDC4F\uDC57\uDC5A\uDC5B\uDC5D\uDC70\uDC71\uDC72\uDC73\uDC74\uDC9F\uDCBB\uDCBC\uDCBE\uDCBF\uDCC0\uDCC1\uDCC6\uDD00\uDD01\uDD02\uDD1F\uDD2F\uDD3F\uDD40\uDD41\uDD42\uDD43\uDD44\uDD45\uDD46\uDD5E\uDD5F\uDD6F\uDD74\uDD75\uDDC1\uDDC2\uDDC3\uDDC4\uDDC5\uDDC6\uDDC7\uDDC8\uDDC9\uDDCA\uDDCB\uDDCC\uDDCD\uDDCE\uDDCF\uDDD0\uDDD1\uDDD2\uDDD3\uDDD4\uDDD5\uDDD6\uDDD7\uDDDB\uDDDD\uDDDE\uDDDF\uDDE2\uDE38\uDE39\uDE3A\uDE3B\uDE3C\uDE3D\uDE3F\uDE40\uDE41\uDE42\uDE43\uDE44\uDE45\uDE46\uDE50\uDE51\uDE52\uDE53\uDE54\uDE55\uDE56\uDE57\uDE58\uDE60\uDE61\uDE62\uDE63\uDE64\uDE65\uDE66\uDE67\uDE68\uDE69\uDE6A\uDE6B\uDE6C\uDE6E\uDE6F\uDE7F\uDE87\uDE88\uDE89\uDE8A\uDE8B\uDE97\uDE98\uDE99\uDE9A\uDE9B\uDE9C\uDE9E\uDE9F\uDEA0\uDEA1\uDEA2\uDEA9\uDEAD\uDEF0\uDEF1\uDEF2\uDEF3\uDEF4\uDEF5\uDEF6\uDEF7\uDEF8\uDF37\uDF38\uDF39\uDF3A\uDF3B\uDF3C\uDF3D\uDF3E\uDF3F\uDF44\uDF55\uDF56\uDF57\uDF58\uDF59\uDF99\uDF9A\uDF9B\uDF9C\uDF9F\uDFD0\uDFE2\uDFFF\uFD3F\uFE10\uFE11\uFE12\uFE13\uFE14\uFE15\uFE16\uFE17\uFE18\uFE19\uFE30\uFE31\uFE32\uFE33\uFE34\uFE35\uFE36\uFE37\uFE38\uFE39\uFE3A\uFE3B\uFE3C\uFE3D\uFE3E\uFE3F\uFE40\uFE41\uFE42\uFE43\uFE44\uFE45\uFE46\uFE47\uFE48\uFE49\uFE4A\uFE4B\uFE4C\uFE4D\uFE4E\uFE4F\uFE50\uFE51\uFE52\uFE54\uFE55\uFE56\uFE57\uFE58\uFE59\uFE5A\uFE5B\uFE5C\uFE5D\uFE5E\uFE5F\uFE60\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01\uFF02\uFF03\uFF05\uFF06\uFF07\uFF08\uFF09\uFF0A\uFF0C\uFF0D\uFF0E\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B\uFF3C\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F\uFF60\uFF61\uFF62\uFF63\uFF64\uFF65"});var m2=Y((qot,iH)=>{var nnt=eH(),rnt=nH(),rH="  ",aH=" ";function ant(n){if(typeof n!="string")throw new Error("`text` must be a string!");let e="";for(let t=0;t<n.length;t++){let r=n[t].toLowerCase();rnt.includes(r)?e+=aH:e+=r}for(;e.includes(rH);)e=nnt(e,rH,aH);return e.trim()}iH.exports=ant});var sH=Y((Wot,oH)=>{var int=m2();function ont(n){if(typeof n!="string")throw new Error("`text` must be a string!");let e=int(n).split(" ");return e.length===0?"":e.length===1?e[0]:e.join("-")}oH.exports=ont});var cH=Y((Vot,uH)=>{var snt=m2();function unt(n){if(typeof n!="string")throw new Error("`text` must be a string!");let e=snt(n).split(" ");return e.length===0?"":e.length===1?e[0]:e.join("_")}uH.exports=unt});var fH=Y((Got,lH)=>{var{decycle:cnt}=Et();function lnt(n,e,t){return JSON.stringify(cnt(n),e,t)}lH.exports=lnt});var dH=Y((Uot,hH)=>{function fnt(n){let e=n.split(`
`),t=e.filter(a=>a.trim().length>0).map(a=>a.split("").findIndex(i=>!i.match(/\s/g))),r=Math.min(...t);return e.map(a=>a.substring(r)).join(`
`)}hH.exports=fnt});var vH=Y((Hot,pH)=>{function hnt(n,e){if(typeof n!="string")throw new Error("The first argument to the `wrap` function must be a string!");if((typeof e>"u"||e===null)&&(typeof process<"u"&&typeof process.stdout<"u"&&typeof process.stdout.columns=="number"?e=process.stdout.columns>80?80:process.stdout.columns:e=80),isNaN(e)||typeof e!="number")throw new Error("The second argument to the `wrap` function must be undefined, null, or an integer!");let t=[];return n.split(`
`).forEach(r=>{if(r.trim().length===0)return t.push("");let a=r.split(/[^\s]/g)[0],i=r.replace(a,"").split(" "),o=a;i.forEach(s=>{let u=o+(o.trim().length>0?" ":"")+s;u.length>e?(t.push(o),o=a+s):o=u}),o.length>0&&t.push(o)}),t.join(`
`)}pH.exports=hnt});var mH=Y((Kot,g2)=>{var Vh={camelify:Y6(),indent:J6(),kebabify:sH(),snakeify:cH(),stringify:fH(),unindent:dH(),wrap:vH(),dump(){Object.keys(Vh).forEach(n=>{typeof global<"u"&&(global[n]=Vh[n]),typeof window<"u"&&(window[n]=Vh[n])})}};typeof g2<"u"&&(g2.exports=Vh);typeof window<"u"&&(window.JSTextTools=Vh)});var SH=Y((jot,kH)=>{var{assert:dl,correl:gH,count:dnt,DataFrame:yH,inferType:pnt,isArray:vnt,isDataFrame:mnt,isFunction:gnt,isJagged:ynt,isNumber:Gh,isUndefined:bH,shape:bnt,sort:wnt,sum:xnt}=Et(),{stringify:knt}=mH(),Snt=Yk(),wH=n=>Gh(n)&&(parseInt(n)===n||n===1/0);function xH(n,e){e=e||{};let t=Gh(e.maxUniqueValues)?e.maxUniqueValues:7,r=Gh(e.minNonMissingValues)?e.minNonMissingValues:15,a=Gh(e.maxCorrelationThreshold)?e.maxCorrelationThreshold:1-1e-5,i=e.progress||null;if(vnt(n))return dl(bnt(n).length===2&&!ynt(n),"The `convertToNumerical` function only works on non-jagged 2-dimensional arrays and DataFrames!"),xH(new yH(n));dl(mnt(n),"You must pass a DataFrame into the `convertToNumerical` function!"),dl(wH(t),"`maxUniqueValues` must be a whole number!"),dl(wH(r),"`minNonMissingValues` must be a whole number!"),dl(Gh(a),"`maxCorrelationThreshold` must be a number!"),bH(i)||dl(gnt(i),"If defined, `progress` must be a function!");let o={};return n.apply((s,u)=>{i&&i(u/n.columns.length);let c=pnt(s.values);if(c.type==="boolean"&&(c.values=c.values.map(f=>f?1:0)),c.type==="date"&&(c.values=c.values.map(f=>{try{return f.getTime()}catch{return NaN}})),c.type==="null")return;c.type,c.type==="object"&&(c.values=c.values.map(f=>knt(f))),c.type;let l=c.values.filter(f=>!bH(f));if(!(c.values.length-l.length>r)){if(c.type!=="boolean"){let f=wnt(dnt(l),(d,p)=>p.count-d.count);if(xnt(f.slice(0,t).map(d=>d.count))/l.length>=.9){if(f.length<2)return;let d=Snt(s.name,c.values);for(;Object.keys(d).length>0;){let p=Object.keys(d)[0],v=d[p];delete d[p];let m=Object.keys(o);for(let g=0;g<m.length;g++){let y=o[m[g]];if(gH(v,y)>a)return}o[p]=v}return}if(c.type==="object"||c.type==="string")return}if(c.type==="boolean"||c.type==="date"||c.type==="number"){let f=Object.keys(o);for(let h=0;h<f.length;h++){let d=o[f[h]];if(gH(c.values,d)>a)return}o[s.name]=c.values}}}),new yH(o)}kH.exports=xH});var RH=Y((Xot,FH)=>{var{abs:Nnt,add:Tnt,assert:Uh,isArray:NH,isDataFrame:TH,isEqual:Ent,isSeries:EH,mean:Int,pow:IH,scale:Cnt,shape:CH,sign:Ant,sqrt:Dnt,sum:AH}=Et(),DH=cl(),_H=(n,e)=>Tnt(n,Cnt(e,-1));function y2(n,e){if(TH(n)||EH(n))return y2(n.values,e);if(TH(e)||EH(e))return y2(n,e.values);Uh(NH(n),"You must pass two same-shaped numerical arrays into the `rScore` function!"),Uh(NH(e),"You must pass two same-shaped numerical arrays into the `rScore` function!"),Uh(Ent(CH(n),CH(e)),"You must pass two same-shaped numerical arrays into the `rScore` function!"),Uh(DH(n),"You must pass two same-shaped numerical arrays into the `rScore` function!"),Uh(DH(e),"You must pass two same-shaped numerical arrays into the `rScore` function!");let t=AH(IH(_H(n,e),2)),r=AH(IH(_H(n,Int(n)),2));if(r===0)return NaN;let a=1-t/r;return Ant(a)*Dnt(Nnt(a))}FH.exports=y2});var LH=Y((Yot,BH)=>{var{argmax:OH,assert:Hh,copy:_nt,DataFrame:Fnt,dot:Rnt,isArray:Ont,isDataFrame:Pnt,isEqual:PH,isJagged:Mnt,isNumber:Bnt,reverse:Lnt,shape:znt,transpose:$nt}=Et();function MH(n){if(Ont(n)){Hh(znt(n).length===2&&!Mnt(n),"The `sortCorrelationMatrix` function only works on non-jagged 2-dimensional arrays and DataFrames!");let s=new Fnt(n);return s.index=s.columns.slice(),MH(s).values}Hh(Pnt(n),"You must pass a 2-dimensional array or DataFrame into the `sortCorrelationMatrix` function!");let e=n.copy(),t=[];e.values.forEach((s,u)=>{s.forEach((c,l)=>{Bnt(c)?Hh(c>=-1&&c<=1,"The correlation matrix passed into the `sortCorrelationMatrix` function must not contain values less than -1 or greater than 1!"):(t.push({row:e.index[u],col:e.columns[l],value:c}),e.values[u][l]=-1/0)})}),Hh(PH(e.values,$nt(e.values)),"The correlation matrix passed into the `sortCorrelationMatrix` function must be symmetrical!"),Hh(PH(e.index,e.columns),"The correlation matrix passed into the `sortCorrelationMatrix` function must be symmetrical! (In this case, although the values themselves are symmetrical, the row and column names differ.)");let r=_nt(e.index),a=[];for(;r.length>0;)if(a.length===0){let s=OH(e.values.map(u=>Rnt(u,u)));a.push(r[s]),r.splice(s,1)}else{let s=e.index.indexOf(a.at(-1)),u=OH(r.map(l=>e.values[e.index.indexOf(l)][s])),c=r[u];a.push(c),r.splice(u,1)}let i=Lnt(a),o=e.get(i,i);return t.forEach(s=>{let u=o.index.indexOf(s.row),c=o.columns.indexOf(s.col);o.values[u][c]=s.value,o.values[c][u]=s.value}),o}BH.exports=MH});var $H=Y((Zot,zH)=>{var qnt=d2();function Wnt(){return qnt(...arguments)}zH.exports=Wnt});var XH=Y((Jot,jH)=>{var{assert:Km,DataFrame:qH,dropNaN:Vnt,flatten:WH,isArray:Gnt,isDataFrame:b2,isSeries:w2,mean:VH,range:Unt,Series:GH,shape:UH,stdev:HH,transpose:KH}=Et(),Hnt=Wi(),x2=class{constructor(){let e=this;e.means=[],e.stdevs=[],e.wasFittedOnAVector=!1,e.hasBeenFitted=!1}_getDataArrayAndShape(e){if(b2(e))return[e.values,e.shape];if(w2(e)){let r=KH([e.values]);return[r,UH(r)]}Km(Gnt(e),"`x` must be a 1- or 2-dimensional array, DataFrame, or Series!");let t=UH(e);return Km(t.length<3,"`x` must be a 1- or 2-dimensional array, DataFrame, or Series!"),t.length===1&&(t.push(1),e=KH([e])),[e,t]}fit(e){let t=this,r=t._getDataArrayAndShape(e);e=r[0];let a=r[1];return t.wasFittedOnAVector=a.indexOf(1)>-1,t.means=[],t.stdevs=[],Unt(0,a[1]).forEach(i=>{let o=e.map(s=>s[i]);if(Hnt.shouldIgnoreNaNValues){let s=Vnt(o);t.means.push(VH(s)),t.stdevs.push(HH(s))}else t.means.push(VH(o)),t.stdevs.push(HH(o))}),t.hasBeenFitted=!0,t}transform(e){let t=this;if(!t.hasBeenFitted)throw new Error("This `StandardScaler` instance hasn't been trained on any data yet! Please use the `fit` method to train it before calling the `transform` method.");if(b2(e)){let o=new qH(t.transform(e.values));return o.columns=e.columns,o.index=e.index,o}if(w2(e)){let o=new GH(t.transform(e.values));return o.name=e.name,o.index=e.index,o}let r=t._getDataArrayAndShape(e);e=r[0];let a=r[1];Km(a[1]===t.means.length,"The data you passed into the `transform` function doesn't have the same number of columns as the data set on which this StandardScaler was fitted!");let i=e.map(o=>o.map((s,u)=>(s-t.means[u])/t.stdevs[u]));return t.wasFittedOnAVector?WH(i):i}untransform(e){let t=this;if(!t.hasBeenFitted)throw new Error("This `StandardScaler` instance hasn't been trained on any data yet! Please use the `fit` method to train it before calling the `transform` method.");if(b2(e)){let o=new qH(t.untransform(e.values));return o.columns=e.columns,o.index=e.index,o}if(w2(e)){let o=new GH(t.untransform(e.values));return o.name=e.name,o.index=e.index,o}let r=t._getDataArrayAndShape(e);e=r[0];let a=r[1];Km(a[1]===t.means.length,"The data you passed into the `untransform` function doesn't have the same number of columns as the data set on which this StandardScaler was fitted!");let i=e.map(o=>o.map((s,u)=>s*t.stdevs[u]+t.means[u]));return t.wasFittedOnAVector?WH(i):i}};jH.exports=x2});var k2=Y((Qot,ZH)=>{var{MathError:Knt}=Et(),YH={clipOutliers:pU(),cohensD:Wk(),cohensd:Wk(),common:Wi(),containsOnlyNumbers:cl(),diagonalize:EU(),getCorrelationMatrix:Hk(),getHighlyCorrelatedColumns:PU(),getMagnitude:Xk(),getOneHotEncodings:Yk(),getPercentages:VU(),getPValueMatrix:a6(),IndexMatcher:c6(),isBinary:$k(),isCorrelationMatrix:Kk(),KMeans:F6(),normalize:d2(),orthonormalize:j6(),convertToNumerical:SH(),project:v2(),pValue:Jk(),rScore:RH(),sortCorrelationMatrix:LH(),standardize:$H(),StandardScaler:XH(),trainTestSplit:r2(),dump(){let n=this,e=typeof global<"u"?global:typeof window<"u"?window:null;if(!e)throw new Knt("Cannot dump functions into global scope because neither `global` nor `window` exist in the current context!");Object.keys(n).forEach(t=>{try{Object.defineProperty(e,t,{configurable:!1,enumerable:!0,writable:!1,value:n[t]})}catch{e[t]=n[t]}})}};try{window.JSDataScienceHelpers=YH}catch{}try{ZH.exports=YH}catch{}});var N2=Y((est,t5)=>{var{add:jnt,assert:Eu,isDataFrame:jm,isFunction:Xnt,isUndefined:JH,normal:Ynt,random:Znt,scale:Jnt,shape:QH}=Et(),{isMatrix:Xm,isTFTensor:pl}=sl(),{KMeansNaive:Qnt}=k2().KMeans,{sse:e5}=Lk(),vo=$h(),S2=class extends Qnt{initializeCentroids(e){return jm(e)&&(e=e.values),pl(e)&&(e=e.arraySync()),vo.tensor(super.initializeCentroids(e))}getFitStepFunction(e,t){let r=this;jm(e)&&(e=e.values),pl(e)&&(e=e.arraySync()),Eu(Xm(e),"`x` must be a matrix!"),JH(t)||Eu(Xnt(t),"If defined, `progress` must be a function!");let a=[],i=c=>(a.push(c),c),o=i(vo.tensor(e)),s=i(r.initializeCentroids(e)),u={currentRestart:0,currentIteration:0,currentCentroids:s,bestCentroids:s,bestScore:-1/0,isFinished:!1};return function(){try{let l=r.predict(o,u.currentCentroids),f=u.currentCentroids.arraySync(),h=[];for(let p=0;p<r.k;p++){let v=[];if(l.forEach((m,g)=>{m===p&&v.push(g)}),v.length===0)h.push(jnt(f[parseInt(Znt()*f.length)],Jnt(.01,Ynt(e[0].length))));else{let m=i(o.gather(v));h.push(i(m.mean(0)))}}if(h=i(vo.stack(h)),e5(u.currentCentroids,h)<r.tolerance&&(u.currentIteration=r.maxIterations-1),u.currentIteration++,u.currentIteration>=r.maxIterations){u.currentRestart++;let p=r.score(o,h);p>u.bestScore&&(u.bestScore=p,u.bestCentroids=i(h.clone())),u.currentIteration=0,u.currentRestart>=r.maxRestarts?u.isFinished=!0:u.currentCentroids=i(r.initializeCentroids(e))}else u.currentCentroids=i(h.clone());return u.isFinished?(r.centroids=u.bestCentroids.arraySync(),u={isFinished:!0},a.forEach(p=>{try{p.dispose()}catch{}}),t&&t(1,r)):t&&t((u.currentRestart+u.currentIteration/r.maxIterations)/r.maxRestarts,r),u}catch(l){throw a.forEach(f=>{try{f.dispose()}catch{}}),l}}}fit(e,t){let r=this,a=r.getFitStepFunction(e,t),i;for(;!i||!i.isFinished;)i=a();return r}predict(e,t){let r=this;return vo.tidy(()=>{pl(e)&&(e=e.arraySync()),jm(e)&&(e=e.values),Eu(Xm(e),"`x` must be a matrix!"),t=t||r.centroids,pl(t)||(t=vo.tensor(t)),Eu(QH(e)[1]===t.shape[1],"`x` and `centroids` must have the same number of columns!");let a=vo.tensor(e).expandDims(1),i=t.expandDims(0);return a.sub(i).pow(2).sum(2).argMin(1).arraySync()})}score(e,t){let r=this;return vo.tidy(()=>{pl(e)&&(e=e.arraySync()),jm(e)&&(e=e.values),Eu(Xm(e),"`x` must be a matrix!"),t=t||r.centroids,pl(t)||(t=vo.tensor(t)),Eu(Xm(t)||JH(t),"`centroids` must be a matrix or undefined!"),Eu(QH(e)[1]===t.shape[1],"`x` and `centroids` must have the same number of columns!");let a=vo.tensor(e),i=r.predict(a,t),o=t.gather(i).arraySync();return-e5(a,o)})}};t5.exports=S2});var I2=Y((tst,r5)=>{var{assert:ert,int:n5,random:T2}=Et(),{isMatrix:trt}=sl(),vl=$h(),nrt=N2(),E2=class extends nrt{initializeCentroids(e){ert(trt(e),"`x` must be a matrix!");let t=this;return vl.tidy(()=>{let r=vl.tensor(e),a=[n5(T2()*e.length)];for(;a.length<t.k;){let i=a.map(l=>e[l]),o=vl.tensor(t.predict(e,i),null,"int32"),s=vl.tidy(()=>vl.tensor(i).gather(o).sub(r).pow(2).sum(1)),u=s.div(s.max()).arraySync(),c=0;for(let l=0;l<1e4;l++){c=n5(T2()*u.length);let f=u[c];if(T2()<f)break}a.push(c)}return vl.tensor(a.map(i=>e[i]))})}};r5.exports=E2});var o5=Y((nst,i5)=>{var{assert:rrt,isEqual:art,shape:a5}=Et(),{KMeansMeta:irt}=k2().KMeans,{isTFTensor:ort}=sl(),srt=I2(),C2=class extends irt{constructor(e){super(e);let t=this;e=e||{},t.modelClass=e.modelClass||srt}get centroids(){let e=this;return e.fittedModel?e.fittedModel.centroids:e._fitState.bestCentroids}set centroids(e){let t=this;ort(e)&&(e=e.arraySync());let r=a5(e);if(t.centroids){let a=t.centroids,i=a5(a);rrt(art(r,i),`The new centroids must have the same shape as the old centroids! (expected: [${i.join(", ")}], received: [${r.join(", ")}])`)}t.fittedModel||(t.fittedModel=new t.modelClass({k:r[0],maxIterations:t.maxIterations,maxRestarts:t.maxRestarts,tolerance:t.tolerance})),t.fittedModel.centroids=e}};i5.exports=C2});var u5=Y((rst,s5)=>{s5.exports={TFKMeansMeta:o5(),TFKMeansNaive:N2(),TFKMeansPlusPlus:I2()}});var urt=Y((ast,A2)=>{var c5={helpers:sl(),metrics:Lk(),models:u5()};typeof A2<"u"&&(A2.exports=c5);typeof window<"u"&&(window.TFKMeans=c5)});urt();})();
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/** @license See the LICENSE file. */
