(()=>{var OK=Object.defineProperty;var PK=(r,e,t)=>e in r?OK(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var H2=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+r+'" is not supported')});var Y=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var ag=(r,e,t)=>(PK(r,typeof e!="symbol"?e+"":e,t),t);var Pu=Y((dot,K2)=>{var MK=new Function(`
  try {
    return this === window
  } catch(e) {}

  try {
    return typeof importScripts !== "undefined"
  } catch(e) {}

  return false
`),ig=class extends Error{constructor(e){MK()?super(e):super(`

\x1B[31m`+e+`
\x1B[0m`)}};K2.exports=ig});var qe=Y((vot,j2)=>{var BK=Pu();j2.exports=function(r,e){if(!r)throw new BK(e)}});var Ge=Y((mot,X2)=>{function LK(r){try{return r instanceof Array||typeof r.constructor<"u"&&r.constructor.name==="Array"}catch{return!1}}X2.exports=LK});var lt=Y((got,Y2)=>{function zK(r){try{return!!r._symbol&&r._symbol===Symbol.for("@jrc03c/js-math-tools/dataframe")}catch{return!1}}Y2.exports=zK});var In=Y((yot,Z2)=>{function $K(r){return typeof r=="function"}Z2.exports=$K});var rt=Y((bot,J2)=>{function qK(r){return typeof r=="number"&&!isNaN(r)}J2.exports=qK});var yt=Y((wot,Q2)=>{function WK(r){return r===null||typeof r>"u"}Q2.exports=WK});var xo=Y((xot,eS)=>{var VK=Ge(),UK=yt();function GK(r){return typeof r=="object"&&!UK(r)&&!VK(r)}eS.exports=GK});var ut=Y((kot,tS)=>{function HK(r){try{return!!r._symbol&&r._symbol===Symbol.for("@jrc03c/js-math-tools/series")}catch{return!1}}tS.exports=HK});var wl=Y((Sot,aS)=>{var KK=qe(),rS=Ge(),jK=lt(),XK=In(),og=rt(),nS=xo(),YK=ut();function sg(r,e){if(jK(r)){let i=sg(r.values,e);return i.length>0&&og(i[0])&&i[0]>=0&&i[0]<r.index.length&&(i[0]=r.index[i[0]]),i.length>1&&og(i[1])&&i[1]>=0&&i[1]<r.columns.length&&(i[1]=r.columns[i[1]]),i}if(YK(r)){let i=sg(r.values,e);return i.length>0&&og(i[0])&&i[0]>=0&&i[0]<r.index.length&&(i[0]=r.index[i[0]]),i}if(KK(nS(r)||rS(r),"You must pass (1) an object, array, Series, or DataFrame and (2) a function or value into the `indexOf` function!"),!XK(e)){let i=e;e=o=>o===i}function t(i,o,s){if(s=s||[],s.indexOf(i)>-1)return null;if(nS(i)){s.push(i);let u=Object.keys(i);for(let c=0;c<u.length;c++){let l=u[c],f=i[l];if(o(f))return[l];let h=t(f,o,s);if(h&&h.length>0)return[l].concat(h)}}else if(rS(i)){s.push(i);for(let u=0;u<i.length;u++){let c=i[u];if(o(c))return[u];let l=t(c,o,s);if(l&&l.length>0)return[u].concat(l)}}else if(o(i))return[];return null}function n(i){try{return e(i)}catch{return!1}}let a=t(r,n);return a&&a.length>0?a:null}aS.exports=sg});var Ei=Y((Not,cS)=>{var ZK=wl(),iS=Ge(),oS=lt(),sS=ut();function Mu(r){try{return structuredClone(r)}catch{if(typeof r=="object"){if(r===null)return null;if(iS(r))return r.map(n=>Mu(n));if(sS(r)){let n=r.copy();return n.values=Mu(n.values),n}if(oS(r)){let n=r.copy();return n.values=Mu(r.values),n}r=uS(r);let t={};return Object.keys(r).forEach(n=>{t[n]=Mu(r[n])}),t}else return r}}function uS(r){function e(a,i,o){if(i=i||[],o=o||"",i.indexOf(a)>-1){let s=o.split("/").slice(o.startsWith("/")?1:0);if(s.some((c,l)=>{let f=s.slice(0,s.length-l-1),h=t;return f.forEach(p=>{h=h[p]}),h===a}))return`<reference to "${t===a?"/":"/"+ZK(t,a).join("/")}">`}return typeof a=="object"?a===null?null:(i.push(a),iS(a)?a.map((s,u)=>e(s,i,o+"/"+u)):(Object.keys(a).forEach(s=>{a[s]=e(a[s],i,o+"/"+s)}),a)):a}let t=Mu(r),n=e(t);if(oS(r)){let a=r.copy();a._values=n.values,a._columns=n.columns,a._index=n.index,n=a}if(sS(r)){let a=r.copy();a.name=n.name,a._values=n.values,a._index=n.index,n=a}return n}cS.exports={copy:Mu,decycle:uS}});var vr=Y((Tot,hS)=>{var{copy:JK}=Ei(),QK=qe(),lS=Ge(),ej=lt(),tj=ut();function fS(r){if(ej(r)||tj(r))return fS(r.values);QK(lS(r),"The `flatten` function only works on arrays, Series, and DataFrames!");function e(t){let n=[];return JK(t).forEach(a=>{lS(a)?n=n.concat(e(a)):n.push(a)}),n}return e(r)}hS.exports=fS});var ri=Y((Eot,dS)=>{var{decycle:pS}=Ei();function rj(r,e){function t(n,a){let i=typeof n;if(i!==typeof a)return!1;if(i==="undefined")return!0;if(i==="boolean"||i==="symbol")return n===a;if(i==="number"||i==="bigint")return n.toString()==="NaN"&&a.toString()==="NaN"?!0:n===a;if(i==="string"||i==="function")return n===a;if(i==="object"){if(n===null||a===null)return n===null&&a===null;{let s=Object.keys(n),u=Object.keys(a);if(s.length!==u.length)return!1;for(let c=0;c<s.length;c++){let l=s[c];if(!t(n[l],a[l]))return!1}return!0}}}try{return r instanceof Date&&e instanceof Date?r.getTime()===e.getTime():t(r,e)}catch{return t(pS(r),pS(e))}}dS.exports=rj});var ni=Y((Iot,yS)=>{var nj=qe(),aj=vr(),ij=Ge(),vS=lt(),oj=In(),mS=ut(),sj=yt();function xl(r){let e="abcdefg1234567890",t="";for(;t.length<r;)t+=e[parseInt(Math.random()*e.length)];return t}var uj=xl(256),cj=xl(256),lj=xl(256),fj=xl(256),hj=xl(256);function gS(r){if(vS(r)||mS(r))return gS(r.values);nj(ij(r),"The `set` function only works on arrays, Series, and DataFrames!");let e=[],t={};return aj(r).forEach(n=>{let a=typeof n=="object"&&n===null?uj:sj(n)?cj:oj(n)?n.toString():typeof n=="symbol"?n.toString()+" - "+hj:n===1/0?lj:n===-1/0?fj:vS(n)?n.toJSONString():mS(n)?JSON.stringify(n.toObject()):JSON.stringify(n);t[a]||e.push(n),t[a]=!0}),e}yS.exports=gS});var kl=Y((Cot,xS)=>{var pj=qe(),ug=vr(),bS=Ge(),dj=lt(),wS=ri(),vj=In(),mj=ut(),gj=ni();function Xh(r,e){if(dj(r)||mj(r))return arguments.length>1?Xh(r.values,e):Xh(r.values,r.values);if(pj(bS(r),"The first argument to the `count` function must be an array, Series, or DataFrame!"),vj(e))return ug(r).filter(t=>e(t)).length;if(bS(e)){let t=ug(r);return gj(e).map(n=>({value:n,count:t.filter(a=>wS(a,n)).length}))}else return arguments.length>1?ug(r).filter(t=>wS(t,e)).length:Xh(r,r)}xS.exports=Xh});var Sl=Y((Aot,SS)=>{var yj=qe(),kS=Ge(),bj=lt(),wj=ut();function cg(r){if(bj(r)||wj(r))return cg(r.values);yj(kS(r),"The `isJagged` function only works on arrays, Series, and DataFrames!");let e=0,t=null;for(let n=0;n<r.length;n++)if(kS(r[n])){if(e++,cg(r[n]))return!0;if(t===null)t=r[n].length;else if(r[n].length!==t)return!0}return e>0&&e<r.length}SS.exports=cg});var Yh=Y((Dot,ES)=>{var xj=qe(),NS=Ge(),kj=lt(),Sj=ut();function TS(r){if(kj(r)||Sj(r))return TS(r.values);xj(NS(r),"The `isNested` function only works on arrays, Series, and DataFrames!");for(let e=0;e<r.length;e++)if(NS(r[e]))return!0;return!1}ES.exports=TS});var ko=Y((_ot,CS)=>{var ds=qe(),Nj=Ge(),Tj=Yh(),Ej=rt(),Ij=yt(),Bu="You must pass a natural number or a one-dimensional array of natural numbers into the `ndarray` function!";function IS(r){ds(!Ij(r),Bu),Nj(r)||(r=[r]),ds(!Tj(r),Bu),ds(r.length>0,Bu);let e=r[0];if(ds(Ej(e),Bu),ds(parseInt(e)===e,Bu),ds(e>=0,Bu),ds(e!==1/0,"We can't create an array containing an infinite number of values!"),r.length===1){let t=[];for(let n=0;n<e;n++)t.push(void 0);return t}else{let t=[];for(let n=0;n<e;n++)t.push(IS(r.slice(1)));return t}}CS.exports=IS});var Nl=Y((Fot,AS)=>{var Cj=qe(),Aj=Ge(),Dj=lt(),_j=ut();function lg(r){if(Dj(r)||_j(r)){let t=r.copy();return t.values=lg(t.values),t.index=lg(t.index),t}Cj(Aj(r),"The `reverse` function only works on arrays, Series, and DataFrames!");let e=[];for(let t=r.length-1;t>=0;t--)e.push(r[t]);return e}AS.exports=lg});var ha=Y((Rot,DS)=>{var fg=qe(),hg=rt(),pg=yt(),Fj=Nl();function Rj(r,e,t=1){fg(!pg(r)&&!pg(e)&&!pg(t),"You must pass two numbers and optionally a step value to the `range` function!"),fg(hg(r)&&hg(e)&&hg(t),"You must pass two numbers and optionally a step value to the `range` function!"),fg(t>0,"The step value must be greater than 0! (NOTE: The step value is a magnitude; it does not indicate direction.)");let n=!1;if(r>e){n=!0;let i=r;r=e+t,e=i+t}let a=[];for(let i=r;i<e;i+=t)a.push(i);return n&&(a=Fj(a)),a}DS.exports=Rj});var ir=Y((Oot,OS)=>{var Oj=qe(),_S=Ge(),Pj=lt(),Mj=ri(),Bj=ut(),Lj=yt();function FS(r){if(!_S(r))return;let e=[r.length],t=0,n=r.map(a=>{let i=FS(a);return Lj(i)?i:(t++,i.length===1?i[0]:i)});return t>0?t===r.length&&n.slice(0,-1).every((i,o)=>Mj(i,n[o+1]))?e.concat(n[0]):(e.push(n),e):e}function RS(r){return Pj(r)||Bj(r)?RS(r.values):(Oj(_S(r),"The `shape` function only works on arrays, Series, and DataFrames!"),FS(r))}OS.exports=RS});var $S=Y((Pot,zS)=>{var PS=qe(),zj=Ge(),$j=lt(),qj=Sl(),Wj=ut(),Vj=yt(),MS=Pu(),Zh=ko(),BS=ha(),Uj=ni(),Gj=ir();function LS(r,e,t){if(Vj(t)&&(t=0),PS(t===0||t===1||t==="vertical"||t==="horizontal",'The only valid axis values for use when appending data to a DataFrame are 0, 1, "vertical", and "horizontal". Note that 0 == "horizontal" and 1 == "vertical".'),zj(e)){PS(!qj(e),"The array of data you're trying to append to this DataFrame is jagged!");let n=Gj(e);if(n.length===1)if(t===0){let a=r.copy();a._values.push(e);let i=Math.max(r.shape[1],n[0]);for(a._values.forEach(o=>{for(;o.length<i;)o.push(void 0)});a._index.length<a._values.length;)a._index.push("row"+a._index.length);for(;a._columns.length<i;)a._columns.push("col"+a._columns.length);return a}else{let a=Math.max(r.shape[0],n[0]),i=r.copy();for(BS(0,a).forEach(o=>{o>=i._values.length&&i._values.push(Zh(r.shape[1])),i._values[o].push(e[o])});i._index.length<i._values.length;)i._index.push("row"+i._index.length);for(;i._columns.length<i._values[0].length;)i._columns.push("col"+i._columns.length);return i}else if(n.length===2)if(t===0){let a=Math.max(...e.map(o=>o.length).concat([r.shape[1]])),i=r.copy();for(i._values=i._values.concat(e).map(o=>{for(;o.length<a;)o.push(void 0);return o});i._index.length<i._values.length;)i._index.push("row"+i._index.length);for(;i._columns.length<a;)i._columns.push("col"+i._columns.length);return i}else{let a=Math.max(...e.map(s=>s.length))+r.shape[1],i=Math.max(r.shape[0],n[0]),o=r.copy();for(BS(0,i).forEach(s=>{for(s>=o._values.length&&o._values.push(Zh(r.shape[1])),o._values[s]=o._values[s].concat(e[s]);o._values[s].length<a;)o._values[s].push(void 0)});o._index.length<o._values.length;)o._index.push("row"+o._index.length);for(;o._columns.length<a;)o._columns.push("col"+o._columns.length);return o}else throw new MS("Only 1- and 2-dimensional arrays can be appended to a DataFrame!")}else if(Wj(e)){let n=LS(r,e.values,t);return t===0?n.index[n.index.length-1]=n.index.indexOf(e.name)>-1?e.name+" (2)":e.name:n.columns[n.columns.length-1]=n.columns.indexOf(e.name)>-1?e.name+" (2)":e.name,n}else if($j(e))if(t===0){let n=r.copy(),a=Uj(n._columns.concat(e._columns)).length;for(n._values.forEach(i=>{for(;i.length<a;)i.push(void 0)}),e.apply(i=>{let o=i.copy(),s=[];n._columns.forEach(u=>{let c=o._index.indexOf(u);c>-1?(s.push(o._values[c]),o._values.splice(c,1),o._index.splice(c,1)):s.push(void 0)}),n._values.push(s.concat(o._values))},1),n._columns=n._columns.concat(e._columns.filter(i=>n._columns.indexOf(i)<0));n._index.length<n._values.length;){let i="row"+n._index.length;n._index.push(i+(r._index.indexOf(i)>-1?" (2)":""))}return n}else{let n=r.copy();return n._index.forEach((a,i)=>{let o=e._index.indexOf(a);o>-1?n._values[i]=n._values[i].concat(e._values[o]):n._values[i]=n._values[i].concat(Zh(e.shape[1]))}),e._index.forEach((a,i)=>{n._index.indexOf(a)<0&&(n._index.push(a),n._values.push(Zh(n._columns.length).concat(e._values[i])))}),n._columns=n._columns.concat(e._columns.map(a=>a+(n._columns.indexOf(a)>-1?" (2)":""))),n}else throw new MS("Only 1- or 2-dimensional arrays, Series, and DataFrames can be appended to a DataFrame!")}zS.exports=LS});var GS=Y((Mot,US)=>{var qS=qe(),WS=Ge(),Hj=In(),VS=yt();function Kj(r,e,t,n,a){if(a=a||0,qS(Hj(n),"The first parameter to the `apply` method must be a function."),qS(a===0||a===1,"The second parameter to the `apply` method (the `axis`) must be 0 or 1."),a===0){let i={},o;if(t.columns.forEach((s,u)=>{let c=new e(t.values.map(f=>f[u]));c.name=s,c.index=t.index;let l=n(c,u,t);l instanceof e?i[s]=l.values:i[s]=l,VS(o)&&(o=l instanceof e||WS(l))}),o){let s=new r(i);return s.index=t.index,s}else{let s=new e(t.columns.map(u=>i[u]));return s.index=t.columns,s}}else if(a===1){let i,o=t.values.map((s,u)=>{let c=new e(s);c.name=t.index[u],c.index=t.columns;let l=n(c,u,t);return VS(i)&&(i=l instanceof e||WS(l)),l instanceof e?l.values:l});if(i){let s=new r(o);return s.index=t.index,s.columns=t.columns,s}else{let s=new e(o);return s.index=t.index,s}}}US.exports=Kj});var Wn=Y((Bot,HS)=>{function jj(r){return typeof r=="string"}HS.exports=jj});var XS=Y((Lot,jS)=>{var KS=qe(),Xj=Ge(),Yj=Sl(),Zj=xo(),Jj=Wn(),Qj=yt(),e8=Pu(),t8=ir();function r8(r,e,t,n,a){let i=s=>s instanceof r,o=s=>s instanceof e;if(Qj(a)){if(i(n))return t.append(n,1);if(o(n))return t.append(n,1);if(Zj(n)){let s=Math.max(...Object.keys(n).map(u=>n[u].length));return Object.keys(n).forEach(u=>{for(;n[u].length<s;)n[u].push(void 0)}),t.append(new r(n),1)}else throw new e8("You must pass a DataFrame, Series, or object into the `assign` method!")}else{KS(Jj(n),"If passing two arguments into the `assign` method, then the first argument must be a string name!"),KS(Xj(a)&&!Yj(a)&&t8(a).length===1,"If passing two arguments into the `assign` method, then the second argument must be a 1-dimensional array!");let s=t.append(a,1);return s.columns[s.columns.length-1]=n,s}}jS.exports=r8});var ZS=Y((zot,YS)=>{var{copy:n8}=Ei();function a8(r,e){if(e.isEmpty)return new r;let t=new r(n8(e.values));return t.columns=e.columns.slice(),t.index=e.index.slice(),t}YS.exports=a8});var aN=Y(($ot,nN)=>{var Jh=qe(),JS=Ge(),QS=rt(),eN=Wn(),tN=yt(),rN=ir();function i8(r,e,t,n,a){tN(n)&&(n=[]),tN(a)&&(a=[]),(eN(n)||QS(n))&&(n=[n]),(eN(a)||QS(a))&&(a=[a]),Jh(JS(n),"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings."),Jh(JS(a),"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings."),Jh(rN(n).length===1,"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings."),Jh(rN(a).length===1,"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings.");let i,o;t.index.forEach((u,c)=>{n.indexOf(u)<0&&n.indexOf(c)<0&&(i||(i=[]),i.push(u))}),t.columns.forEach((u,c)=>{a.indexOf(u)<0&&a.indexOf(c)<0&&(o||(o=[]),o.push(u))});let s=t.get(i,o);if(s instanceof e){let u=new r;u=u.assign(s),t.index.indexOf(s.name)>-1&&(u=u.transpose()),s=u}return s}nN.exports=i8});var Tl=Y((qot,iN)=>{var o8=rt();function s8(r){return o8(r)&&parseInt(r)===r}function u8(r){return s8(r)&&r>=0}iN.exports=u8});var sN=Y((Wot,oN)=>{var dg=qe(),c8=Wn(),Qh=yt(),l8=Tl(),f8=ir();function h8(r,e,t,n,a,i){n=n||0,dg(n===0||n===1,"The first parameter of the `dropMissing` method (the `axis`) must be 0 or 1."),i=i||0,dg(l8(i),"The third parameter of the `dropMissing` method (the `threshold`) should be a whole number (meaning that data should be dropped if it contains more than `threshold` null values)."),a=i>0?"none":a||"any",dg(a==="any"||a==="all"||a==="none","The second parameter of the `dropMissing` method (the `condition` parameter, which indicates the condition under which data should be dropped) should be 'any' or 'all' (meaning that if 'any' of the data contains null values, then it should be dropped; or that if 'all' of the data contains null values, then it should be dropped).");function o(c){if(i>0){let l=0;for(let f=0;f<c.length;f++){let h=c[f];if(Qh(h)&&l++,l>=i)return[]}}else if(a==="any")for(let l=0;l<c.length;l++){let f=c[l];if(Qh(f))return[]}else if(a==="all"){for(let l=0;l<c.length;l++){let f=c[l];if(!Qh(f))return c}return[]}return c}let s=t.copy(),u=Math.random().toString();if(n===0){s=s.assign(u,s.index);let c=s.values.map(o).filter(f=>f.length>0);if(f8(c).length<2)return new r;s.values=c;let l=s.get(null,u);if(Qh(l))return new r;c8(l)&&(l=[l]),l instanceof e&&(l=l.values),s.index=l,s=s.drop(null,u)}else if(n===1){let c={};if(s.columns.forEach((f,h)=>{let p=s.values.map(m=>m[h]),d=o(p);d.length>0&&(c[f]=d)}),Object.keys(c).length===0)return new r;let l=new r(c);return l.index=s.index,l}return s}oN.exports=h8});var vg=Y((Vot,cN)=>{var p8=qe(),d8=Ge(),v8=lt(),m8=rt(),g8=ut();function uN(r){if(v8(r)||g8(r))return r.dropNaN(...Object.values(arguments).slice(1));p8(d8(r),"The `dropNaN` function only works on arrays, Series, and DataFrames!");let e=[];return r.forEach(t=>{try{return e.push(uN(t))}catch{if(m8(t))return e.push(t)}}),e}cN.exports=uN});var fN=Y((Uot,lN)=>{var mg=qe(),y8=vg(),b8=Tl();function w8(r,e,t,n,a){t=t||0,mg(t===0||t===1,"The first parameter of the `dropNaN` method (the `axis`) must be 0 or 1."),a=a||0,mg(b8(a),"The third parameter of the `dropNaN` method (the `threshold`) should be a whole number (meaning that data should be dropped if it contains more than `threshold` NaN values)."),n=a>0?"none":n||"any",mg(n==="any"||n==="all"||n==="none","The second parameter of the `dropNaN` method (the `condition` parameter, which indicates the condition under which data should be dropped) should be 'any' or 'all' (meaning that if 'any' of the data contains NaN values, then it should be dropped; or that if 'all' of the data contains NaN values, then it should be dropped).");function i(s){let u=y8(s);return a>0?s.length-u.length<a:n==="any"?u.length===s.length:n==="all"?u.length>0:!0}let o=e.copy();if(t===0){let s=o.index.filter(u=>{let c=o.get(u,null).values;return i(c)});return s.length>0?o.get(s,null):new r}else if(t===1){let s=o.columns.filter(u=>{let c=o.get(null,u).values;return i(c)});return s.length>0?o.get(null,s):new r}return o}lN.exports=w8});var vN=Y((Got,dN)=>{var hN=qe(),El=vr(),x8=In(),k8=yt();function pN(r){let e={};return El(r).forEach((t,n)=>{e[t]=n}),e}function Lu(r){return Object.keys(r).sort((e,t)=>r[e]-r[t])}function S8(r,e,t,n,a){hN(x8(n),"The `filter` method takes a single parameter: a function that is used to filter the values."),k8(a)&&(a=0),hN(a===0||a===1,"The `axis` parameter to the `filter` method must be 0 or 1.");let i=t.copy();if(i.isEmpty)return i;let o=pN(i.index),s=pN(i.columns);if(a===0){let u=i.values.filter((c,l)=>{let f=new e(c);f.name=t.index[l],f.index=t.columns;let h=n(f,l,t);return h||delete o[i.index[l]],h});if(El(u).length===0)return new r;if(u.length===1){let c=new e(El(u));return c.name=Lu(o)[0],c.index=Lu(s),c}i.values=u,i.index=Lu(o)}else if(a===1){i=i.transpose();let u=i.values.filter((c,l)=>{let f=new e(c);f.name=t.columns[l],f.index=t.index;let h=n(f,l,t);return h||delete s[i.index[l]],h});if(El(u).length===0)return new r;if(u.length===1){let c=new e(El(u));return c.name=Lu(s)[0],c.index=Lu(o),c}i.values=u,i.index=Lu(s),i=i.transpose()}return i}dN.exports=S8});var yN=Y((Hot,gN)=>{var Ia=qe(),ep=rt(),tp=Wn(),mN=yt(),N8=ni();function T8(r,e,t){(tp(e)||ep(e))&&(e=[e]),(tp(t)||ep(t))&&(t=[t]);let n=N8((e||[]).concat(t||[]).map(a=>typeof a));return Ia(n.length<=2,"Only whole numbers and/or strings are allowed in `get` arrays!"),n.length===1&&Ia(n[0]==="string"||n[0]==="number","Only whole numbers and/or strings are allowed in `get` arrays!"),n.length===2&&(Ia(n.indexOf("string")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!"),Ia(n.indexOf("number")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!")),mN(e)||(e=e.map(a=>{if(tp(a))return Ia(r.index.indexOf(a)>-1,`Row "${a}" does not exist!`),a;if(ep(a))return Ia(a>=0,`Index ${a} is out of bounds!`),Ia(parseInt(a)===a,"Row numbers must be integers!"),Ia(a<r.index.length,`Index ${a} is out of bounds!`),r.index[a]})),mN(t)||(t=t.map(a=>{if(tp(a))return Ia(r.columns.indexOf(a)>-1,`Column "${a}" does not exist!`),a;if(ep(a))return Ia(a>=0,`Column ${a} is out of bounds!`),Ia(parseInt(a)===a,"Column numbers must be integers!"),Ia(a<r.columns.length,`Column ${a} is out of bounds!`),r.columns[a]})),r.getSubsetByNames(e,t)}gN.exports=T8});var So=Y((Kot,wN)=>{var bN=qe(),E8=Ge(),I8=lt(),C8=In(),A8=ut(),D8=yt();function _8(r,e){try{return r<e?-1:r>e?1:0}catch{return r=typeof r=="object"&&r!==null?JSON.stringify(r):r.toString(),e=typeof e=="object"&&e!==null?JSON.stringify(e):e.toString(),r<e?-1:r>e?1:0}}function F8(r,e){if(D8(e)&&(e=_8),I8(r)||A8(r))return r.sort(...Object.values(arguments).slice(1));bN(E8(r),"The `sort` function only works on arrays, Series, and DataFrames!"),bN(C8(e),"The second parameter of the `sort` function must be a comparison function!");let t=r.slice();return t.sort(e),t}wN.exports=F8});var NN=Y((jot,SN)=>{var xN=qe(),kN=Wn(),R8=yt(),O8=ni(),P8=So();function M8(r){let e=r.toLowerCase(),t="";for(let a=0;a<e.length;a++){let i=e[a];i.match(/[a-z0-9]/g)?t+=i:t+=" "}let n=t.split(" ").filter(a=>a.length>0);return n[0]+n.slice(1).map(a=>a[0].toUpperCase()+a.substring(1)).join("")}function B8(r,e,t){R8(t)?t=e.columns:kN(t)&&(t=[t]);let n={};t.forEach(i=>{xN(kN(i),"You must pass either a string or a one-dimensional array of strings into the `getDummies` (AKA `oneHotEncode`) method!");let o=e.columns.indexOf(i);xN(o>-1,`The given DataFrame does not have a column called "${i}"!`);let s=e.values.map(c=>c[o]),u=P8(O8(s));s.forEach(c=>{u.forEach(l=>{let f=i+"_"+M8(l.toString());n[f]||(n[f]=[]),c===l?n[f].push(1):n[f].push(0)})})});let a=new r(n);return a.index=e.index,a}SN.exports=B8});var FN=Y((Xot,_N)=>{var No=qe(),TN=Ge(),EN=rt(),IN=yt(),CN=Tl(),AN=ha(),DN=ir();function L8(r,e,t){let n=r.shape;IN(e)&&(e=AN(0,n[0])),IN(t)&&(t=AN(0,n[1])),EN(e)&&(e=[e]),EN(t)&&(t=[t]),No(TN(e)&&TN(t),"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),No(DN(e).length===1&&DN(t).length===1,"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),No(e.length>0,"The `rowIndices` array must contain at least one index."),No(t.length>0,"The `colIndices` array must contain at least one index."),e.forEach(o=>{No(CN(o),"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),No(o<r.index.length,`The row index ${o} is out of bounds.`)}),t.forEach(o=>{No(CN(o),"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),No(o<r.columns.length,`The column index ${o} is out of bounds.`)});let a=e.map(o=>r.index[o]),i=t.map(o=>r.columns[o]);return r.getSubsetByNames(a,i)}_N.exports=L8});var BN=Y((Yot,MN)=>{var To=qe(),gg=vr(),RN=Ge(),rp=Wn(),ON=yt(),PN=ir();function z8(r,e,t,n,a){ON(n)&&(n=t.index),ON(a)&&(a=t.columns),rp(n)&&(n=[n]),rp(a)&&(a=[a]),To(RN(n)&&RN(a),"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),To(PN(n).length===1&&PN(a).length===1,"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),To(n.length>0,"The `rows` array must contain at least one row name."),To(a.length>0,"The `cols` array must contain at least one column name."),n.forEach(s=>{To(rp(s),"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),To(t.index.indexOf(s)>-1,`The row name "${s}" does not exist in the list of rows.`)}),a.forEach(s=>{To(rp(s),"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),To(t.columns.indexOf(s)>-1,`The column name "${s}" does not exist in the list of columns.`)});let i=n.map(s=>a.map(u=>t.values[t.index.indexOf(s)][t.columns.indexOf(u)]));if(n.length===1&&a.length===1)return gg(i)[0];if(n.length===1){let s=new e(gg(i));return s.name=n[0],s.index=a,s}if(a.length===1){let s=new e(gg(i));return s.name=a[0],s.index=n,s}let o=new r(i);return o.columns=a,o.index=n,o}MN.exports=z8});var zN=Y((Zot,LN)=>{var $8=Wn(),Il=ha();function q8(r,e,t){function n(h,p){return $8(h)&&h.length>p?h.substring(0,p-3)+"...":h}if(t.isEmpty)return console.table({}),console.log("Shape:",[0,0],`
`),t;let a=typeof window>"u"?20:10,i=parseInt(a/2),o=typeof process>"u"?10:Math.floor(process.stdout.columns/24)-1,s=parseInt(o/2),u=a>t.index.length?null:Il(0,i).concat(Il(t.index.length-i,t.index.length)),c=o>t.columns.length?null:Il(0,s).concat(Il(t.columns.length-s,t.columns.length)),l=t.get(u,c);l instanceof e&&(t.shape[0]===1?(l=new r([l.values]),l.index=t.index,l.columns=new e(t.columns).get(c).values):t.shape[1]===1&&(l=new r([l.values]).transpose(),l.index=new e(t.index).get(u).values,l.columns=t.columns)),a<=t.index.length&&(l._index.splice(i,0,"..."),l._values.splice(i,0,Il(0,l.columns.length).map(()=>"..."))),o<=t.columns.length&&(l._columns.splice(s,0,"..."),l._values=l._values.map(h=>(h.splice(s,0,"..."),h)));let f=28;return l instanceof e?(l.values=l.values.map(h=>n(h,f)),l.name=n(l.name,f),l.index=l.index.map(h=>n(h,f))):(l.values=l.values.map(h=>h.map(p=>n(p,f))),l.columns=l.columns.map(h=>n(h,f)),l.index=l.index.map(h=>n(h,f))),console.table(l.toObject()),console.log("Shape:",t.shape,`
`),t}LN.exports=q8});var np=Y((Jot,$N)=>{var W8=qe(),V8=rt();function U8(r,e){W8(V8(r),"The `leftPad` function only works on numbers!");let t=r.toString();for(;t.length<e;)t="0"+t;return t}$N.exports=U8});var WN=Y((Qot,qN)=>{var G8=np(),H8=ha();function K8(r,e){let t=e?r:r.copy();return t.index=H8(0,r.shape[0]).map(n=>"row"+G8(n,(t.index.length-1).toString().length)),t}qN.exports=K8});var Cl=Y((est,UN)=>{var j8=qe(),X8=vr(),Y8=Ge(),Z8=lt(),J8=ut();function VN(r){if(Z8(r)||J8(r))return VN(r.values);j8(Y8(r),"The `product` function only works on arrays, Series, and DataFrames!");try{return r.length===0?NaN:X8(r).reduce((e,t)=>e*t,1)}catch{return NaN}}UN.exports=VN});var ap=Y((tst,jN)=>{var Al=qe(),GN=vr(),HN=Ge(),Q8=lt(),KN=rt(),e7=ut(),t7=Cl(),r7=ir();function yg(r,e){if(Q8(r)||e7(r))return yg(r.values,e);if(Al(HN(r),"The first argument passed into the `reshape` function must be an array!"),KN(e)&&(e=[e]),Al(HN(e),"The second argument passed into the `reshape` function must be a whole number or a one-dimensional array of whole numbers!"),Al(r7(e).length===1,"The first argument passed into the `reshape` function must be a whole number or a one-dimensional array of whole numbers!"),e.forEach(i=>{Al(KN(i)&&parseInt(i)===i&&i>0,"The first argument passed into the `reshape` function must be a whole number or a one-dimensional array of whole numbers!")}),e.length===0)return GN(r);let t=GN(r);if(e.length===1&&e[0]===t.length)return t;Al(t7(e)===t.length,"The new shape doesn't match the number of values available in `x` (the first argument passed into the `reshape` function)!");let n=[],a=parseInt(t.length/e[0]);for(let i=0;i<e[0];i++){let o=t.slice(i*a,(i+1)*a);n.push(yg(o,e.slice(1)))}return n}jN.exports=yg});var zu=Y((rst,tT)=>{var{copy:ZN}=Ei(),n7=qe(),a7=Ge(),i7=rt(),JN=yt(),o7=ko(),s7=Cl(),u7=ap(),QN=Math.pow(2,64),or=[];eT(parseInt(Math.random()*QN));function c7(r,e){r=gn(r);function t(){r+=gn("0x9e3779b97f4a7c15");let a=ZN(r);return a=(a^a>>BigInt(30))*gn("0xbf58476d1ce4e5b9"),a=(a^a>>BigInt(27))*gn("0x94d049bb133111eb"),a^a>>BigInt(31)}let n=[];for(let a=0;a<e;a++)n.push(t());return n}function gn(r){return BigInt.asUintN(64,BigInt(r))}function XN(r,e){return r=gn(r),e=BigInt(e),gn(gn(r<<e)|gn(r>>gn(BigInt(64)-e)))}function eT(r){if(JN(r))return ZN(or);{n7(i7(r),"If passing a value into the `seed` function, then that value must be an integer!");let e=c7(parseInt(r),4);or[0]=e[0],or[1]=e[1],or[2]=e[2],or[3]=e[3]}}function YN(){let r=gn(XN(or[0]+or[3],23)+or[0]),e=gn(or[1]<<BigInt(17));return or[2]=gn(or[2]^or[0]),or[3]=gn(or[3]^or[1]),or[1]=gn(or[1]^or[2]),or[0]=gn(or[0]^or[3]),or[2]=gn(or[2]^e),or[3]=XN(or[3],45),parseInt(r)/QN}function l7(r){return JN(r)?YN():(a7(r)||(r=[r]),u7(o7(s7(r)).map(YN),r))}tT.exports={random:l7,seed:eT}});var ip=Y((nst,rT)=>{var{random:f7}=zu(),h7=qe(),p7=Ge(),d7=lt(),v7=ut();function m7(r){if(d7(r)||v7(r))return r.shuffle(...Object.values(arguments).slice(1));h7(p7(r),"The `shuffle` function only works on arrays, Series, and DataFrames!");let e=[],t=r.slice();for(let n=0;n<r.length;n++){let a=parseInt(f7()*t.length);e.push(t.splice(a,1)[0])}return e}rT.exports=m7});var iT=Y((ast,aT)=>{var g7=qe(),y7=yt(),nT=ip();function b7(r,e){return y7(e)&&(e=0),g7(e===0||e===1,"The `axis` parameter to the `shuffle` must be 0, 1, or undefined."),r.get(e===0?nT(r.index):null,e===1?nT(r.columns):null)}aT.exports=b7});var op=Y((ist,oT)=>{function w7(r){return typeof r=="boolean"}oT.exports=w7});var fT=Y((ost,lT)=>{var{random:x7}=zu(),Vn=qe(),k7=vr(),sT=Ge(),bg=op(),cT=In(),sp=rt(),$u=Wn(),wg=yt(),S7=ha(),uT=ir(),xg=So();function N7(r,e,t){return cT(e)?T7(r,e,t):E7(r,e,t)}function T7(r,e,t){if(t=wg(t)?0:t,Vn(cT(e),"When sorting a DataFrame using a function, the first argument to the `sort` method must be a function!"),Vn(sp(t),"When sorting a DataFrame using a function, the second argument to the `sort` method must be null, undefined, 0, or 1 to indicate the axis along which the data should be sorted! An axis of 0 means that the rows will be sorted relative to each other, whereas an axis of 1 means that the columns will be sorted relative to each other."),t===0){let n=xg(r.index,(a,i)=>e(r.get(a,null),r.get(i,null)));return r.get(n,null)}else{let n=xg(r.columns,(a,i)=>e(r.get(null,a),r.get(null,i)));return r.get(null,n)}}function E7(r,e,t){let n=r.copy(),a=x7().toString();return n=n.assign(a,n.index),wg(e)&&(e=[a],t=[!0]),(sp(e)||$u(e))&&(e=[e],(bg(t)||$u(t))&&(t=[t])),Vn(sT(e),"The first parameter of the `sort` method must be (1) a string or index representing a column name or index, respectively; (2) a 1-dimensional array of strings and/or indices; or (3) null."),Vn(uT(e).length===1,"The first parameter of the `sort` method must be (1) a string or index representing a column name or index, respectively; (2) a 1-dimensional array of strings and/or indices; or (3) null."),wg(t)&&(t=S7(0,e.length).map(()=>!0)),Vn(sT(t),"The second parameter of the `sort` method must be (1) a string or boolean representing the sort direction ('ascending' / 'descending', or true / false); (2) a 1-dimensional array of strings and/or booleans; or (3) null."),Vn(uT(t).length===1,"The second parameter of the `sort` method must be (1) a string or boolean representing the sort direction ('ascending' / 'descending', or true / false); (2) a 1-dimensional array of strings and/or booleans; or (3) null."),Vn(e.length===t.length,"The arrays passed into the `sort` method must be equal in length."),e=e.map(i=>{if(Vn($u(i)||sp(i),"Column references can either be column names (as strings) or column indices (as whole numbers)."),$u(i)){let o=n.columns.indexOf(i);return Vn(o>-1,`The column "${i}" does not exist!`),o}if(sp(i))return Vn(parseInt(i)===i,"Column indices must be whole numbers!"),Vn(i>=0,`The column index ${i} is out of bounds!`),Vn(i<n.columns.length,`The index ${i} is out of bounds!`),i}),t=t.map(i=>{if(Vn($u(i)||bg(i),"Direction references can either be strings ('ascending' or 'descending') or booleans (true or false)."),$u(i)){let o=i.trim().toLowerCase();return Vn(o==="ascending"||o==="descending","Direction references can either be strings ('ascending' or 'descending') or booleans (true or false)."),o==="ascending"}if(bg(i))return i}),n.values=xg(n.values,(i,o)=>{let s=0;for(;i[e[s]]===o[e[s]]&&s<e.length;)s++;let u=t[s];if(i[e[s]]===o[e[s]])return 0;if(i[e[s]]<o[e[s]])return u?-1:1;if(i[e[s]]>o[e[s]])return u?1:-1}),n.index=k7(n.get(null,a).values),n=n.dropColumns(a),n}lT.exports=N7});var kg=Y((sst,hT)=>{function I7(r,e){return JSON.stringify(r.toObject(e))}hT.exports=I7});var pT=Y((ust,Ng)=>{var Sg=Pu(),C7=kg();function A7(r,e,t){let n=C7(r,t),a=!1,i=!1,o,s;try{let u=e;if(e.includes("/")){let l=e.split("/");u=l[l.length-1]}let c=document.createElement("a");c.href=`data:application/json;charset=utf-8,${encodeURIComponent(n)}`,c.download=u,c.dispatchEvent(new MouseEvent("click")),a=!0}catch(u){o=u}try{let u=H2("fs"),c=H2("path");u.writeFileSync(c.resolve(e),n,"utf8"),i=!0}catch(u){s=u}if(!a&&!i)throw typeof window<"u"?new Sg(o):typeof Ng<"u"?new Sg(s):new Sg("I don't know what's going wrong, but it doesn't seem like you're in Node or the browser, and we couldn't download and/or write the file to disk!");return r}Ng.exports=A7});var vT=Y((cst,dT)=>{var D7=qe(),_7=yt();function F7(r,e){_7(e)?e=0:D7(e===0||e===1,"The axis parameter of the `toObject` method must be undefined, 0, or 1. An axis of 0 indicates that the returned object should be organized first by rows and then by columns. An axis of 1 indicates that the returned object should be organized first by columns and then by rows.");let t={};return e===0?r.index.forEach((n,a)=>{let i={};r.columns.forEach((o,s)=>{i[o]=r.values[a][s]}),t[n]=i}):r.columns.forEach((n,a)=>{let i={};r.index.forEach((o,s)=>{i[o]=r.values[s][a]}),t[n]=i}),t}dT.exports=F7});var vs=Y((lst,yT)=>{var mT=qe(),R7=Ge(),O7=lt(),P7=ut(),M7=ko(),gT=Nl(),B7=ir();function L7(r){if(O7(r)||P7(r))return r.transpose();mT(R7(r),"The `transpose` function only works on arrays, Series, and DataFrames!");let e=B7(r);if(mT(e.length<=2,"I'm not smart enough to know how to transpose arrays that have more than 2 dimensions. Sorry for the inconvenience! Please only pass 1- or 2-dimensional arrays into the `transpose` function!"),e.length===1)return gT(r);if(e.length===2){let t=M7(gT(e));for(let n=0;n<e[0];n++)for(let a=0;a<e[1];a++)t[a][n]=r[n][a];return t}}yT.exports=L7});var kT=Y((fst,xT)=>{var bT=qe(),z7=Ge(),$7=lt(),q7=Yh(),W7=ut(),V7=ir();function wT(r,e,t){if(W7(t))return new r(e.values.concat(t.values));if(z7(t)){let n=V7(t);bT(n.length===1&&!q7(n),"Only vectors can be appended to Series!");let a=e.copy();return t.forEach((i,o)=>{a._values.push(i),a._index.push("item"+(e.values.length+o))}),a}return bT(!$7(t),"DataFrames cannot be appended to Series!"),wT(e,[t])}xT.exports=wT});var NT=Y((hst,ST)=>{var U7=qe(),G7=In();function H7(r,e){U7(G7(e),"The parameter to the `apply` method must be a function.");let t=r.copy();return t._values=t._values.map((n,a)=>e(n,a)),t}ST.exports=H7});var ET=Y((pst,TT)=>{var K7=yt();function j7(r){let e=r.copy(),t=[];return e._values=e.values.filter((n,a)=>K7(n)?!1:(t.push(e.index[a]),!0)),e._index=t,e}TT.exports=j7});var CT=Y((dst,IT)=>{var X7=rt();function Y7(r,e){let t=[],n=[];e.values.forEach((i,o)=>{X7(i)&&(n.push(i),t.push(e.index[o]))});let a=new r(n);return a.name=e.name,a.index=t,a}IT.exports=Y7});var DT=Y((vst,AT)=>{var{copy:Z7}=Ei();function J7(r,e,t){let n=e.copy(),a=Z7(n.index),i=[],o=n.values.filter((s,u)=>{let c=t(s,u,n.values);return c||i.push(n.index[u]),c});return i.forEach(s=>{a.splice(a.indexOf(s),1)}),o.length===0?(n=new r,n.name=e.name,n):(n.values=o,n.index=a,n)}AT.exports=J7});var FT=Y((mst,_T)=>{var Eo=qe(),Q7=rt(),eX=Wn(),tX=yt(),rX=ni();function nX(r,e){(eX(e)||Q7(e))&&(e=[e]);let t=rX((e||[]).map(n=>typeof n));return Eo(t.length<=2,"Only whole numbers and/or strings are allowed in `get` arrays!"),t.length===1&&Eo(t[0]==="string"||t[0]==="number","Only whole numbers and/or strings are allowed in `get` arrays!"),t.length===2&&(Eo(t.indexOf("string")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!"),Eo(t.indexOf("number")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!")),tX(e)||(e=e.map(n=>{if(typeof n=="string")return Eo(r.index.indexOf(n)>-1,`Index "${n}" does not exist!`),n;if(typeof n=="number")return Eo(n>=0,`Index ${n} is out of bounds!`),Eo(parseInt(n)===n,"Indices must be integers!"),Eo(n<r.index.length,`Index ${n} is out of bounds!`),r.index[n]})),r.getSubsetByNames(e)}_T.exports=nX});var OT=Y((gst,RT)=>{var Dl=qe(),aX=Ge(),iX=yt(),oX=Tl(),sX=ha(),uX=ir();function cX(r,e){let t=r.shape;iX(e)&&(e=sX(0,t[0])),Dl(aX(e),"The `indices` array must be 1-dimensional array of whole numbers."),Dl(uX(e).length===1,"The `indices` array must be a 1-dimensional array of whole numbers."),Dl(e.length>0,"The `indices` array must contain at least one index."),e.forEach(a=>{Dl(oX(a),"The `indices` array must be a 1-dimensional array of whole numbers."),Dl(a<r.index.length,`The row index ${a} is out of bounds.`)});let n=e.map(a=>r.index[a]);return r.getSubsetByNames(n)}RT.exports=cX});var MT=Y((yst,PT)=>{var _l=qe(),lX=Ge(),fX=Wn(),hX=yt(),pX=ir();function dX(r,e,t){hX(t)&&(t=e.index),_l(lX(t),"The `indices` array must be a 1-dimensional array of strings."),_l(pX(t).length===1,"The `indices` array must be a 1-dimensional array of strings."),_l(t.length>0,"The `indices` array must contain at least one index name."),t.forEach(i=>{_l(fX(i),"The `indices` array must contain only strings."),_l(e.index.indexOf(i)>-1,`The name "${i}" does not exist in the index.`)});let n=t.map(i=>e.values[e.index.indexOf(i)]);if(n.length===1)return n[0];let a=new r(n);return a.index=t,a.name=e.name,a}PT.exports=dX});var zT=Y((bst,LT)=>{var{copy:vX}=Ei(),BT=ha();function mX(r){let e=r.copy(),t=typeof window>"u"?20:10;if(e.index.length>t){e=e.get(BT(0,t/2).concat(BT(e.index.length-t/2,e.index.length)));let a=vX(e.index);a.splice(parseInt(a.length/2),0,"..."),e.values.push("..."),e.index.push("..."),e=e.get(a)}let n={};return e.values.forEach((a,i)=>{let o={};o[e.name]=a,n[e.index[i]]=o}),console.table(n),console.log("Shape:",r.shape,`
`),r}LT.exports=mX});var qT=Y((wst,$T)=>{var gX=ip();function yX(r){let e=r.copy();return e.get(gX(e.index))}$T.exports=yX});var VT=Y((xst,WT)=>{var bX=qe(),wX=In(),xX=yt(),kX=So(),SX=vs();function NX(r,e,t){t=t||((u,c)=>u<c?-1:1),bX(xX(t)||wX(t),"You must pass undefined, null, or a comparison function as the second argument to the `sort` method!");let n=SX([e.values,e.index]),a=kX(n,(u,c)=>t(u[0],c[0])),i=[],o=[];a.forEach(u=>{i.push(u[0]),o.push(u[1])});let s=new r;return s._values=i,s._index=o,s.name=e.name,s}WT.exports=NX});var HT=Y((kst,GT)=>{var TX=So(),UT=vs();function EX(r,e){let t=UT([e.values,e.index]);t=UT(TX(t,(a,i)=>{if(a[1]===i[1])return 0;if(a[1]<i[1])return-1;if(a[1]>i[1])return 1}));let n=new r(t[0]);return n.index=t[1],n.name=e.name,n}GT.exports=EX});var jT=Y((Sst,KT)=>{function IX(r){let e={};return e[r.name]={},r.index.forEach((t,n)=>{e[r.name][t]=r.values[n]}),e}KT.exports=IX});var QT=Y((Nst,JT)=>{var{copy:up}=Ei(),Xi=qe(),Tg=Ge(),CX=Wn(),AX=yt(),XT=np(),YT=ha(),cp=Nl(),DX=kT(),_X=NT(),FX=ET(),RX=CT(),OX=DT(),PX=FT(),MX=OT(),BX=MT(),LX=zT(),zX=qT(),$X=VT(),qX=HT(),WX=jT(),Fl=ir(),VX=vs(),ZT=Symbol.for("@jrc03c/js-math-tools/series");JT.exports=function(r){class e{static[Symbol.hasInstance](n){try{return!!n._symbol&&n._symbol===ZT}catch{return!1}}constructor(n){let a=this;if(a.name="data",Object.defineProperty(a,"_symbol",{configurable:!1,enumerable:!1,writable:!1,value:ZT}),Object.defineProperty(a,"_values",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(a,"values",{configurable:!0,enumerable:!0,get(){return a._values},set(i){Xi(Tg(i),"The new values must be a 1-dimensional array!");let o=Fl(i);Xi(o.length===1,"The new array of values must be 1-dimensional!"),o[0]<a._index.length?a._index=a._index.slice(0,o[0]):o[0]>a._index.length&&(a._index=a._index.concat(YT(a._index.length,o[0]).map(s=>"item"+XT(s,(i.length-1).toString().length)))),a._values=i}}),Object.defineProperty(a,"_index",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(a,"index",{configurable:!0,enumerable:!0,get(){return a._index},set(i){Xi(Tg(i),"The new index must be a 1-dimensional array of strings!"),Xi(i.length===a.shape[0],"The new index must be the same length as the old index!"),Xi(Fl(i).length===1,"The new index must be a 1-dimensional array of strings!"),i.forEach(o=>{Xi(CX(o),"All of the row names must be strings!")}),a._index=i}}),n){if(n instanceof e)a.name=n.name,a.values=up(n.values),a.index=up(n.index);else if(Tg(n)){let i=Fl(n);Xi(i.length===1,"When passing an array into the constructor of a Series, the array must be 1-dimensional!"),a.values=n}else if(n instanceof Object){let i=Object.keys(n);Xi(i.length===1,"When passing an object into the constructor of a Series, the object must have only 1 key-value pair, where the key is the name of the data and the value is the 1-dimensional array of values!");let o=i[0],s=n[o];Xi(Fl(s).length===1,"When passing an object into the constructor of a Series, the object must have only 1 key-value pair, where the key is the name of the data and the value is the 1-dimensional array of values!"),a.name=o,a.values=s.slice()}}}get shape(){return Fl(this.values)}get length(){return this.shape[0]}get isEmpty(){return this.values.filter(a=>!AX(a)).length===0}clear(){let a=this.copy();return a.values.forEach((i,o)=>{a.values[o]=void 0}),a}get(n){return PX(this,n)}getSubsetByNames(n){return BX(e,this,n)}getSubsetByIndices(n){return MX(this,n)}loc(n){return this.getSubsetByNames(n)}iloc(n){return this.getSubsetByIndices(n)}reverse(){let n=this,a=new e(cp(n.values));return a.index=cp(n.index),a.name=n.name,a}resetIndex(){let n=this,a=n.copy();return a.index=YT(0,n.shape[0]).map(i=>"item"+XT(i,(a.index.length-1).toString().length)),a}copy(){let n=this,a=new e;return a._values=up(n.values),a._index=up(n.index),a.name=n.name,a}append(n){return DX(e,this,n)}apply(n){return _X(this,n)}concat(n){return this.append(n)}dropMissing(n,a){return FX(this,n,a)}dropNaN(){return RX(e,this)}toObject(){return WX(this)}print(){return LX(this)}shuffle(){return zX(this)}sort(n){return $X(e,this,n)}sortByIndex(){return qX(e,this)}filter(n){return OX(e,this,n)}toDataFrame(){let n=this,a=new r(VX([n.values]));return a.columns=[n.name],a.index=n.index,a}transpose(){let a=this.copy();return a.values=cp(a.values),a.index=cp(a.index),a}getDummies(){return this.toDataFrame().getDummies()}oneHotEncode(){return this.getDummies()}}return e}});var Ol=Y((Tst,iE)=>{var{copy:Eg}=Ei(),Ii=qe(),eE=kl(),UX=$S(),GX=GS(),HX=XS(),KX=ZS(),jX=aN(),XX=sN(),YX=fN(),ZX=vN(),JX=yN(),tE=NN(),QX=FN(),e9=BN(),t9=zN(),r9=WN(),n9=iT(),a9=fT(),i9=pT(),o9=kg(),s9=vT(),u9=vr(),Rl=Ge(),c9=xo(),rE=yt(),Ig=np(),l9=ko(),Cg=ha(),qu=ir(),nE=vs(),aE=Symbol.for("@jrc03c/js-math-tools/dataframe");function lp(r){let e="abcdefghijklmnopqrstuvwxyz1234567890",t="";for(let n=0;n<r;n++)t+=e[parseInt(Math.random()*e.length)];return t}var Gr=class{static[Symbol.hasInstance](e){try{return!!e._symbol&&e._symbol===aE}catch{return!1}}constructor(e){let t=this;if(Object.defineProperty(t,"_symbol",{configurable:!1,enumerable:!1,writable:!1,value:aE}),Object.defineProperty(t,"_values",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(t,"values",{configurable:!0,enumerable:!0,get(){return t._values.length===0||!rE(t._values[0])&&t._values[0].length===0?[[]]:t._values},set(n){Ii(Rl(n),"The new values must be a 2-dimensional array!");let a=qu(n);Ii(a.length===2,"The new array of values must be 2-dimensional!"),a[0]<t._index.length?t._index=t._index.slice(0,a[0]):a[0]>t._index.length&&(t._index=t._index.concat(Cg(t._index.length,a[0]).map(i=>"row"+Ig(i,(a[0]-1).toString().length)))),a[1]<t._columns.length?t._columns=t._columns.slice(0,a[1]):a[1]>t._columns.length&&(t._columns=t._columns.concat(Cg(t._columns.length,a[1]).map(i=>"col"+Ig(i,(a[1]-1).toString().length)))),t._values=n}}),Object.defineProperty(t,"_columns",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(t,"columns",{configurable:!0,enumerable:!0,get(){return t._columns},set(n){Ii(Rl(n),"The new columns list must be a 1-dimensional array of strings!"),Ii(t.isEmpty||n.length===t.shape[1],"The new columns list must be the same length as the old columns list!"),Ii(qu(n).length===1,"The new columns list must be a 1-dimensional array of strings!"),n=n.map(i=>(typeof i!="string"&&(i=JSON.stringify(i)||i.toString()),i.trim().length===0?"untitled_"+lp(8):i.trim()));let a=(()=>{let i=eE(n),o={};return i.forEach(s=>{o[s.value]=s.count}),o})();n=n.map(i=>a[i]>1?i+"_"+lp(8):i),t._columns=n}}),Object.defineProperty(t,"_index",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(t,"index",{configurable:!0,enumerable:!0,get(){return t._index},set(n){Ii(Rl(n),"The new index must be a 1-dimensional array of strings!"),Ii(t.isEmpty||n.length===t.shape[0],"The new index must be the same length as the old index!"),Ii(qu(n).length===1,"The new index must be a 1-dimensional array of strings!"),n=n.map(i=>(typeof i!="string"&&(i=JSON.stringify(i)||i.toString()),i.trim().length===0?"untitled_"+lp(8):i.trim()));let a=(()=>{let i=eE(n),o={};return i.forEach(s=>{o[s.value]=s.count}),o})();n=n.map(i=>a[i]>1?i+"_"+lp(8):i),t._index=n}}),Ii(rE(e)||c9(e)||Rl(e),"The `data` passed into the constructor of a DataFrame must be either (1) an object where the key-value pairs are (respectively) column names and 1-dimensional arrays of values, or (2) a 2-dimensional array of values."),e)if(e instanceof Gr)t.values=Eg(e.values),t.columns=Eg(e.columns),t.index=Eg(e.index);else if(Rl(e)){let n=qu(e);Ii(n.length===2,"The `data` array passed into the constructor of a DataFrame must be 2-dimensional!"),t.values=e}else{t._columns=Object.keys(e);let n=[];t._columns.forEach(i=>{let o=e[i];n.push(o)}),t._values=nE(n);let a=qu(t.values);t._index=Cg(0,a[0]).map(i=>"row"+Ig(i,(a[0]-1).toString().length))}}get shape(){return qu(this.values)}get length(){return this.shape[0]}get width(){return this.shape[1]}get rows(){return this.index}set rows(e){let t=this;t.index=e}get isEmpty(){return u9(this.values).length===0}clear(){let e=this,t=new Gr(l9(e.shape));return t.columns=e.columns.slice(),t.index=e.index.slice(),t}get(e,t){let n=this;if(arguments.length===0)return n;if(arguments.length===1)try{return n.get(null,e)}catch{return n.get(e,null)}return JX(n,e,t)}getSubsetByNames(e,t){return e9(Gr,Io,this,e,t)}getSubsetByIndices(e,t){return QX(this,e,t)}getDummies(e){return tE(Gr,this,e)}oneHotEncode(e){return tE(Gr,this,e)}transpose(){let e=this,t=new Gr(nE(e.values));return t.columns=e.index.slice(),t.index=e.columns.slice(),t}get T(){return this.transpose()}resetIndex(e){return r9(this,e)}copy(){return KX(Gr,this)}assign(e,t){return HX(Gr,Io,this,e,t)}apply(e,t){return GX(Gr,Io,this,e,t)}dropMissing(e,t,n){return XX(Gr,Io,this,e,t,n)}dropNaN(e,t,n){return YX(Gr,this,e,t,n)}drop(e,t){return jX(Gr,Io,this,e,t)}dropColumns(e){return this.drop(null,e)}dropRows(e){return this.drop(e,null)}toObject(e){return s9(this,e)}toJSONString(e){return o9(this,e)}saveAsJSON(e,t){return i9(this,e,t)}print(){return t9(Gr,Io,this)}sort(e,t){return a9(this,e,t)}sortByIndex(){return this.sort()}filter(e,t){return ZX(Gr,Io,this,e,t)}shuffle(e){return n9(this,e)}append(e,t){return UX(this,e,t)}concat(e,t){return this.append(e,t)}join(e,t){return this.append(e,t)}toString(){let e=this;return JSON.stringify(e)}},Io=QT()(Gr);iE.exports={DataFrame:Gr,Series:Io}});var Wu=Y((Est,sE)=>{var f9=qe(),h9=vr(),p9=Ge(),d9=lt(),v9=ut();function oE(r){if(d9(r)||v9(r))return oE(r.values);f9(p9(r),"The `max` function only works on arrays, Series, and DataFrames!");try{return Math.max(...h9(r))}catch{return NaN}}sE.exports=oE});var zt=Y((Ist,hE)=>{var{DataFrame:uE,Series:cE}=Ol(),lE=qe(),Pl=Ge(),Ag=lt(),fE=ri(),m9=In(),Dg=ut(),g9=Wu(),y9=ha(),fp=ir();function b9(r){return Pl(r)||Dg(r)||Ag(r)}function w9(r){return lE(m9(r),"You must pass a function into the `vectorize` function!"),function e(){let t,n,a=[],i=[],o=Object.keys(arguments).filter(s=>{let u=arguments[s];return Pl(u)?!0:Dg(u)?(t=!0,a.push(u),!0):Ag(u)?(n=!0,i.push(u),!0):!1}).map(s=>arguments[s]);if(o.slice(0,-1).forEach((s,u)=>{lE(fE(Pl(s)?fp(s):s.shape,Pl(o[u+1])?fp(o[u+1]):o[u+1].shape),`When passing multiple arrays into the \`${r.name}\` function, all of the arrays must have the same shape!`)}),o.length>0){let s=g9(o.map(c=>c.length?c.length:c.values.length)),u=y9(0,s).map(c=>{let l=Object.keys(arguments).map(f=>{if(b9(arguments[f])){if(Pl(arguments[f]))return arguments[f][c];if(Dg(arguments[f]))return arguments[f].values[c];if(Ag(arguments[f]))return arguments[f].values[c]}else return arguments[f]});return e(...l)});if(n)try{if(i.length===1&&fE(fp(i[0]),fp(u))){let c=new uE(u);return c.index=i[0].index.slice(),c.columns=i[0].columns.slice(),c}else return new uE(u)}catch{return u}if(t)try{if(a.length===1&&a[0].length===u.length){let c=new cE(u);return c.name=a[0].name,c.index=a[0].index.slice(),c}else return new cE(u)}catch{return u}return u}else return r(...arguments)}}hE.exports=w9});var hp=Y((Cst,pE)=>{var x9=rt(),k9=zt();function S9(r){try{return x9(r)?Math.abs(r):NaN}catch{return NaN}}pE.exports=k9(S9)});var pp=Y((Ast,dE)=>{var N9=rt(),T9=zt();function E9(){try{let r=0,e=Object.values(arguments);for(let t=0;t<e.length;t++){if(!N9(e[t]))return NaN;r+=e[t]}return r}catch{return NaN}}dE.exports=T9(E9)});var Ml=Y((Dst,vE)=>{var I9=zt();function C9(r,e){try{return e(r)}catch{return NaN}}vE.exports=I9(C9)});var gE=Y((_st,mE)=>{var A9=rt(),D9=zt();function _9(r){try{return A9(r)?Math.acos(r):NaN}catch{return NaN}}mE.exports=D9(_9)});var bE=Y((Fst,yE)=>{var F9=rt(),R9=zt();function O9(r){try{return F9(r)?Math.asin(r):NaN}catch{return NaN}}yE.exports=R9(O9)});var xE=Y((Rst,wE)=>{var P9=rt(),M9=zt();function B9(r){try{return P9(r)?Math.atan(r):NaN}catch{return NaN}}wE.exports=M9(B9)});var SE=Y((Ost,kE)=>{var L9=qe(),z9=wl(),$9=Ge(),q9=lt(),W9=ut(),V9=Wu();function _g(r){if(q9(r)){let e=_g(r.values);return[r.index[e[0]],r.columns[e[1]]]}if(W9(r)){let e=_g(r.values);return[r.index[e]]}L9($9(r),"The `argmax` function only works on arrays, Series, and DataFrames!");try{let e=z9(r,V9(r));return e?e.length===0?void 0:e.length===1?e[0]:e:void 0}catch{return}}kE.exports=_g});var dp=Y((Pst,TE)=>{var U9=qe(),G9=vr(),H9=Ge(),K9=lt(),j9=ut();function NE(r){if(K9(r)||j9(r))return NE(r.values);U9(H9(r),"The `min` function only works on arrays, Series, and DataFrames!");try{return Math.min(...G9(r))}catch{return NaN}}TE.exports=NE});var IE=Y((Mst,EE)=>{var X9=qe(),Y9=wl(),Z9=Ge(),J9=lt(),Q9=ut(),eY=dp();function Fg(r){if(J9(r)){let e=Fg(r.values);return[r.index[e[0]],r.columns[e[1]]]}if(Q9(r)){let e=Fg(r.values);return[r.index[e]]}X9(Z9(r),"The `argmin` function only works on arrays, Series, and DataFrames!");try{let e=Y9(r,eY(r));return e?e.length===0?void 0:e.length===1?e[0]:e:void 0}catch{return}}EE.exports=Fg});var Pg=Y((Bst,DE)=>{var CE=Ge(),Rg=op(),tY=lt(),rY=ri(),AE=rt(),nY=xo(),aY=ut(),Og=yt();function Yi(r,e){if(tY(r)||aY(r))return r.apply(t=>Yi(t,e));if(CE(r))return r.map(t=>Yi(t,e));if(e==="null")return null;if(e==="number"){if(Og(r))return NaN;let t=Yi(r,"boolean");if(Rg(t))return t?1:0;try{JSON.parse(r)}catch{let i=Yi(r,"date");if(i instanceof Date)return i.getTime()}let n=parseFloat(r);return isNaN(n)?NaN:n}if(e==="boolean"){if(Rg(r))return r;if(AE(r))return r===0?!1:r===1?!0:null;try{let t=(typeof r=="object"?r.toString()==="null"?"false":JSON.stringify(r):r.toString()).trim().toLowerCase();return t==="true"||t==="yes"||t==="y"?!0:t==="false"||t==="no"||t==="n"?!1:null}catch{return null}}if(e==="date"){if(r instanceof Date)return r;if(Og(r))return null;let t=parseFloat(r);if(!isNaN(t)){let a=new Date(r);return a.toString()==="Invalid Date"?null:a}let n=Date.parse(r);return isNaN(n)?null:new Date(n)}if(e==="object"){if(nY(r))return r;let t=Yi(r,"boolean");if(Rg(t))return null;try{let a=Yi(r,"number");if(AE(a))return JSON.parse(r),null}catch{}let n=Yi(r,"date");if(n)return n;try{let a=JSON.parse(r);return CE(a)?a.map(i=>Yi(i,e)):a}catch{return null}}if(e==="string")return Og(r)?rY(r,void 0)?"undefined":"null":r instanceof Date?r.toJSON():(()=>typeof r=="object"?r===null?"null":JSON.stringify(r):r.toString())()}DE.exports=Yi});var FE=Y((Lst,_E)=>{var iY=rt(),oY=zt();function sY(r){try{return iY(r)?Math.ceil(r):NaN}catch{return NaN}}_E.exports=oY(sY)});var PE=Y((zst,OE)=>{var uY=hp(),RE=rt(),cY=yt(),lY=zt();function fY(r,e){try{if(!RE(r))return NaN;if(cY(e))e=1e-10;else if(!RE(e))return NaN;return uY(r)<e?0:r}catch{return NaN}}OE.exports=lY(fY)});var BE=Y(($st,ME)=>{var Mg=rt(),hY=zt();function pY(r,e,t){try{return Mg(r)?Mg(e)?Mg(t)?r<e?e:r>t?t:r:NaN:NaN:NaN}catch{return NaN}}ME.exports=hY(pY)});var zE=Y((qst,LE)=>{var Bg=qe(),dY=vr(),vY=Ge(),mY=lt(),gY=rt(),yY=ut();function Lg(r,e){if(mY(r)||yY(r))return Lg(r.values,e);if(Bg(vY(r),"The `combinations` function only works on arrays, Series, and DataFrames!"),Bg(gY(e),"`r` must be a whole number!"),r=dY(r),e>r.length)return[r];if(e<=0)return[[]];if(Bg(e===parseInt(e),"`r` must be a whole number!"),r.length<2)return r;let t=[];return r.forEach((n,a)=>{let i=r.slice(a+1);if(i.length<e-1)return;Lg(i,e-1).forEach(s=>{t.push([n].concat(s))})}),t}LE.exports=Lg});var vp=Y((Wst,qE)=>{var bY=qe(),wY=vr(),xY=Ge(),kY=lt(),SY=ut();function $E(r){if(kY(r)||SY(r))return $E(r.values);bY(xY(r),"The `mean` function only works on arrays, Series, and DataFrames!");try{let e=wY(r),t=0;return e.forEach(n=>{t+=n}),t/e.length}catch{return NaN}}qE.exports=$E});var $g=Y((Vst,KE)=>{var WE=qe(),VE=Ge(),mp=rt(),UE=ut(),GE=vp(),HE=ir();function zg(r,e){if(UE(r))return zg(r.values,e);if(UE(e))return zg(r,e.values);WE(VE(r)&&VE(e)&&HE(r).length===1&&HE(e).length===1,"The `covariance` function only works on 1-dimensional arrays and Series!"),WE(r.length===e.length,"The two arrays or Series passed into the `covariance` function must have the same length!");try{let t=GE(r),n=GE(e);if(!mp(t)||!mp(n))return NaN;let a=Math.max(r.length,e.length),i=0;for(let o=0;o<a;o++){if(!mp(r[o]))return NaN;if(!mp(e[o]))return NaN;i+=(r[o]-t)*(e[o]-n)}return i/r.length}catch{return NaN}}KE.exports=zg});var gp=Y((Ust,jE)=>{var NY=rt(),TY=zt();function EY(r){try{return NY(r)?Math.sqrt(r):NaN}catch{return NaN}}jE.exports=TY(EY)});var qg=Y((Gst,YE)=>{var IY=qe(),CY=vr(),AY=Ge(),DY=lt(),_Y=rt(),FY=ut(),RY=vp();function XE(r){if(DY(r)||FY(r))return XE(r.values);IY(AY(r),"The `variance` function only works on arrays, Series, and DataFrames!");try{let e=CY(r),t=RY(e),n=0;for(let a=0;a<e.length;a++){if(!_Y(e[a]))return NaN;n+=(e[a]-t)*(e[a]-t)}return n/e.length}catch{return NaN}}YE.exports=XE});var yp=Y((Hst,JE)=>{var OY=qe(),PY=Ge(),MY=lt(),BY=ut(),LY=gp(),zY=qg();function ZE(r){if(MY(r)||BY(r))return ZE(r.values);OY(PY(r),"The `std` function only works on arrays, Series, and DataFrames!");try{return LY(zY(r))}catch{return NaN}}JE.exports=ZE});var iI=Y((Kst,aI)=>{var QE=qe(),$Y=$g(),eI=Ge(),tI=ut(),rI=ir(),nI=yp();function Wg(r,e){if(tI(r))return Wg(r.values,e);if(tI(e))return Wg(r,e.values);QE(eI(r)&&eI(e)&&rI(r).length===1&&rI(e).length===1,"The `correl` function only works on 1-dimensional arrays and Series!"),QE(r.length===e.length,"The two arrays or Series passed into the `correl` function must have the same length!");try{return $Y(r,e)/(nI(r)*nI(e))}catch{return NaN}}aI.exports=Wg});var sI=Y((jst,oI)=>{var qY=rt(),WY=zt();function VY(r){try{return qY(r)?Math.cos(r):NaN}catch{return NaN}}oI.exports=WY(VY)});var cI=Y((Xst,uI)=>{uI.exports=Object.freeze({boolean:"boolean",date:"date",null:"null",number:"number",object:"object",string:"string"})});var vI=Y((Yst,dI)=>{var UY=qe(),lI=Ge(),fI=lt(),GY=ri(),hI=ut(),pI=ni();function Vg(r,e){if(fI(r)||hI(r))return Vg(r.values,e);if(fI(e)||hI(e))return Vg(r,e.values);UY(lI(r)&&lI(e),"The `diff` function only works on arrays, Series, and DataFrames!");let t=pI(r),n=pI(e),a=[];return t.forEach(i=>{n.findIndex(o=>GY(o,i))<0&&a.push(i)}),a}dI.exports=Vg});var bp=Y((Zst,gI)=>{var mI=rt(),HY=zt();function KY(r,e){try{return mI(r)?mI(e)?Math.pow(r,e):NaN:NaN}catch{return NaN}}gI.exports=HY(KY)});var Ug=Y((Jst,yI)=>{var jY=rt(),XY=zt();function YY(){try{let r=Object.values(arguments);if(r.length===0)return NaN;let e=1;for(let t=0;t<r.length;t++){if(!jY(r[t]))return NaN;e*=r[t]}return e}catch{return NaN}}yI.exports=XY(YY)});var Vu=Y((Qst,bI)=>{var ZY=Ug();function JY(){return ZY(...arguments)}bI.exports=JY});var Gg=Y((eut,wI)=>{var QY=pp(),eZ=Vu();function tZ(r,e){return QY(r,eZ(e,-1))}wI.exports=tZ});var wp=Y((tut,kI)=>{var rZ=qe(),nZ=vr(),aZ=Ge(),iZ=lt(),oZ=ut();function xI(r){if(iZ(r)||oZ(r))return xI(r.values);rZ(aZ(r),"The `sum` function only works on arrays, Series, and DataFrames!");try{return r.length===0?NaN:nZ(r).reduce((e,t)=>e+t,0)}catch{return NaN}}kI.exports=xI});var AI=Y((rut,CI)=>{var sZ=hp(),uZ=qe(),SI=Ge(),NI=lt(),cZ=ri(),TI=rt(),EI=ut(),lZ=bp(),II=ir(),fZ=gp(),hZ=Gg(),pZ=wp();function Hg(r,e){if(TI(r)&&TI(e))return sZ(r-e);if(NI(r)||EI(r))return Hg(r.values,e);if(NI(e)||EI(e))return Hg(r,e.values);SI(r)&&SI(e)&&uZ(cZ(II(r),II(e)),"If passing two arrays, Series, or DataFrames into the `distance` function, then those objects must have the same shape!");try{return fZ(pZ(lZ(hZ(r,e),2)))}catch{return NaN}}CI.exports=Hg});var _I=Y((nut,DI)=>{var dZ=bp(),vZ=Vu();function mZ(r,e){return vZ(r,dZ(e,-1))}DI.exports=mZ});var jg=Y((aut,BI)=>{var{DataFrame:FI,Series:RI}=Ol(),xp=qe(),OI=vr(),PI=Ge(),Kg=lt(),gZ=rt(),kp=ut(),yZ=Vu(),Sp=ir(),bZ=wp(),MI=vs();function Co(r,e){if(Kg(r)){let a=Co(r.values,e);if(Sp(a).length===1){let i=new RI(a);return i.name=kp(e)?e.name:i.name,i.index=r.index.slice(),i}else{let i=new FI(a);return i.index=r.index.slice(),Kg(e)&&(i.columns=e.columns.slice()),i}}if(Kg(e)){let a=Co(r,e.values);if(Sp(a).length===1){let i=new RI(a);return i.name=kp(r)?r.name:i.name,i.index=e.columns.slice(),i}else{let i=new FI(a);return i.columns=e.columns.slice(),i}}if(kp(r))return Co(r.values,e);if(kp(e))return Co(r,e.values);xp(PI(r)&&PI(e),"The `dot` function only works on arrays, Series, and DataFrames!"),OI(r).concat(OI(e)).forEach(a=>{xp(gZ(a),"One of the arrays you passed into the `dot` function contains non-numerical values!")});let t=Sp(r),n=Sp(e);if(xp(t.length<=2&&n.length<=2,"I'm not smart enough to know how to get the dot-product of arrays that have more than 2 dimensions. Sorry for the inconvenience! Please only pass 1- or 2-dimensional arrays into the `dot` function!"),xp(t[t.length-1]===n[0],`There's a dimension misalignment in the two arrays you passed into the \`dot\` function. (${t[t.length-1]} !== ${n[0]})`),t.length===1&&n.length===1)return bZ(yZ(r,e));if(t.length===1&&n.length===2)return MI(e).map(a=>Co(r,a));if(t.length===2&&n.length===1)return r.map(a=>Co(a,e));if(t.length===2&&n.length===2){let a=MI(e),i=[];for(let o=0;o<r.length;o++){let s=[];for(let u=0;u<a.length;u++)s.push(Co(r[o],a[u]));i.push(s)}return i}}BI.exports=Co});var Xg=Y((iut,zI)=>{var wZ=qe(),xZ=Ge(),kZ=lt(),SZ=ut(),NZ=yt();function LI(r){if(kZ(r)||SZ(r))return r.dropMissing(...Object.values(arguments).slice(1));wZ(xZ(r),"The `dropMissing` function only works on arrays, Series, and DataFrames!");let e=[];return r.forEach(t=>{try{return e.push(LI(t))}catch{NZ(t)||e.push(t)}}),e}zI.exports=LI});var KI=Y((out,HI)=>{var $I=qe(),qI=Ge(),WI=lt(),TZ=ri(),VI=ut(),UI=yt(),GI=ir();function Np(r,e){if(WI(r)||VI(r))return Np(r.values,e);if(WI(e)||VI(e))return Np(r,e.values);$I(qI(r)&&qI(e),"The `dropMissingPairwise` function only works on arrays, Series, and DataFrames!"),$I(TZ(GI(r),GI(e)),"The two arrays, Series, and/or DataFrames passed into the `dropMissingPairwise` function must have the same shape!");let t=[],n=[];for(let a=0;a<r.length;a++)try{let[i,o]=Np(r[a],e[a]);t.push(i),n.push(o)}catch{!UI(r[a])&&!UI(e[a])&&(t.push(r[a]),n.push(e[a]))}return[t,n]}HI.exports=Np});var tC=Y((sut,eC)=>{var jI=qe(),XI=Ge(),YI=lt(),EZ=ri(),ZI=rt(),JI=ut(),QI=ir();function Tp(r,e){if(YI(r)||JI(r))return Tp(r.values,e);if(YI(e)||JI(e))return Tp(r,e.values);jI(XI(r)&&XI(e),"The `dropNaNPairwise` only works on arrays, Series, and DataFrames!"),jI(EZ(QI(r),QI(e)),"The two arrays, Series, and/or DataFrames passed into the `dropNaNPairwise` must have the same shape!");let t=[],n=[];for(let a=0;a<r.length;a++)try{let[i,o]=Tp(r[a],e[a]);t.push(i),n.push(o)}catch{ZI(r[a])&&ZI(e[a])&&(t.push(r[a]),n.push(e[a]))}return[t,n]}eC.exports=Tp});var nC=Y((uut,rC)=>{var IZ=Xg();function CZ(r){return IZ(r)}rC.exports=CZ});var iC=Y((cut,aC)=>{var AZ=rt(),DZ=zt();function _Z(r){try{return AZ(r)?Math.exp(r):NaN}catch{return NaN}}aC.exports=DZ(_Z)});var uC=Y((lut,sC)=>{var FZ=zt();function oC(r){try{return r!==parseInt(r)?NaN:r<=1?1:r*oC(r-1)}catch{return NaN}}sC.exports=FZ(oC)});var hC=Y((fut,fC)=>{var RZ=qe(),OZ=vr(),cC=Ge(),PZ=lt(),MZ=In(),lC=xo(),BZ=ut();function Yg(r,e){if(PZ(r))return Yg(OZ(r.values),e);if(BZ(r))return Yg(r.values,e);if(RZ(lC(r)||cC(r),"You must pass (1) an object, array, Series, or DataFrame and (2) a function or value into the `find` function!"),!MZ(e)){let a=e;e=i=>i===a}function t(a,i,o){if(o=o||[],o.indexOf(a)>-1)return null;if(lC(a)){o.push(a);let s=Object.keys(a);for(let u=0;u<s.length;u++){let c=s[u],l=a[c];if(i(l))return l;let f=t(l,i,o);if(f)return f}}else if(cC(a)){o.push(a);for(let s=0;s<a.length;s++){let u=a[s];if(i(u))return u;let c=t(u,i,o);if(c)return c}}else if(i(a))return a;return null}function n(a){try{return e(a)}catch{return!1}}return t(r,n)}fC.exports=Yg});var mC=Y((hut,vC)=>{var LZ=qe(),zZ=vr(),pC=Ge(),$Z=lt(),qZ=In(),dC=xo(),WZ=ut();function Zg(r,e){if($Z(r))return Zg(zZ(r.values),e);if(WZ(r))return Zg(r.values,e);if(LZ(dC(r)||pC(r),"You must pass (1) an object, array, Series, or DataFrame and (2) a function or value into the `findAll` function!"),!qZ(e)){let i=e;e=o=>o===i}function t(i,o,s){if(s=s||[],s.indexOf(i)>-1)return null;if(dC(i)){s.push(i);let u=Object.keys(i),c=[];for(let l=0;l<u.length;l++){let f=u[l],h=i[f],p=!1;o(h)&&(c.push(h),p=!0);let d=t(h,o,s);d&&d.length>0&&d.slice(p?1:0).forEach(m=>c.push(m))}return c}else if(pC(i)){s.push(i);let u=[];for(let c=0;c<i.length;c++){let l=i[c],f=!1;o(l)&&(u.push(l),f=!0);let h=t(l,o,s);h&&h.length>0&&h.slice(f?1:0).forEach(p=>u.push(p))}return u}else if(o(i))return[i];return null}function n(i){try{return e(i)}catch{return!1}}let a=t(r,n);return a&&a.length>0?a:null}vC.exports=Zg});var yC=Y((put,gC)=>{var VZ=rt(),UZ=zt();function GZ(r){try{if(r==="Infinity")return 1/0;if(r==="-Infinity")return-1/0;let e=JSON.parse(r);return VZ(e)?e:NaN}catch{return NaN}}gC.exports=UZ(GZ)});var wC=Y((dut,bC)=>{var HZ=rt(),KZ=zt();function jZ(r){try{return HZ(r)?Math.floor(r):NaN}catch{return NaN}}bC.exports=KZ(jZ)});var Jg=Y((vut,xC)=>{var XZ=rt(),YZ=Cl(),ZZ=ap();function JZ(r){XZ(r)&&(r=[r]);let e=[],t=YZ(r);for(let n=0;n<t;n++)e.push(0);return ZZ(e,r)}xC.exports=JZ});var SC=Y((mut,kC)=>{var Ep=qe(),QZ=rt(),eJ=yt(),tJ=Jg();function rJ(r){Ep(!eJ(r),"You must pass an integer greater than 0 (representing the size) into the `identity` function!"),Ep(QZ(r),"You must pass an integer greater than 0 (representing the size) into the `identity` function!"),Ep(parseInt(r)===r,"You must pass an integer greater than 0 (representing the size) into the `identity` function!"),Ep(r>0,"You must pass an integer greater than 0 (representing the size) into the `identity` function!");let e=tJ([r,r]);for(let t=0;t<r;t++)e[t][t]=1;return e}kC.exports=rJ});var TC=Y((gut,NC)=>{NC.exports=["true","false","yes","no"]});var IC=Y((yut,EC)=>{EC.exports=["null","none","nan","na","n/a","","undefined"]});var _C=Y((but,DC)=>{var nJ=Ml(),aJ=qe(),iJ=TC(),oJ=Pg(),sJ=kl(),CC=vr(),Qg=Ge(),uJ=lt(),AC=rt(),cJ=ut(),lJ=Wn(),fJ=IC();function Ip(r){return r.type==="number"&&(typeof r.value<"u"?r.isInteger=parseInt(r.value)===r.value:r.isInteger=CC(r.values).every(e=>AC(e)?parseInt(e)===e:!0)),r}function Cp(r){if(uJ(r)){let a=r.copy(),i=Cp(r.values);return a.values=i.values,Ip({type:i.type,values:a})}if(cJ(r)){let a=r.copy(),i=Cp(r.values);return a.values=i.values,Ip({type:i.type,values:a})}if(!Qg(r)){let a=Cp([r]);return a.value=a.values[0],delete a.values,Ip(a)}aJ(Qg(r),"The `inferType` function only works on arrays, Series, and DataFrames!");let e=CC(r).map(a=>{if(a===void 0)return"null";try{if(typeof a=="object"){let s=new Date(a.toString());if(s instanceof Date&&s.toString()!=="Invalid Date")return"date"}}catch{}lJ(a)||(a=JSON.stringify(a));let o=a.toLowerCase().trim();if(fJ.indexOf(o)>-1)return"null";if(iJ.indexOf(o)>-1)return"boolean";try{let s=JSON.parse(a);return AC(s)?"number":typeof s=="object"?Qg(s)?"string":"object":"string"}catch{return new Date(a).toString()!=="Invalid Date"?"date":"string"}}),n=sJ(e).sort((a,i)=>i.count-a.count)[0].value;return Ip({type:n,values:nJ(r,a=>oJ(a,n))})}DC.exports=Cp});var RC=Y((wut,FC)=>{var hJ=rt(),pJ=zt();function dJ(r){try{let e=JSON.parse(r);return hJ(e)?parseInt(e):NaN}catch{return NaN}}FC.exports=pJ(dJ)});var PC=Y((xut,OC)=>{var vJ=qe(),mJ=Ge(),gJ=lt(),yJ=ri(),bJ=ut(),ey=ni();function wJ(){let r=Object.values(arguments).map(t=>gJ(t)||bJ(t)?ey(t.values):(vJ(mJ(t),"The `intersect` function only works on arrays, Series, and DataFrames!"),ey(t)));return ey(r).filter(t=>r.every(n=>n.findIndex(a=>yJ(a,t))>-1))}OC.exports=wJ});var zC=Y((kut,LC)=>{var MC=pp(),Ao=qe(),xJ=jg(),kJ=vr(),SJ=Ge(),NJ=lt(),ty=rt(),BC=Vu(),TJ=ir();function Ap(r){if(NJ(r)){let t=r.copy();return t.values=Ap(t.values),t}Ao(SJ(r),"The `inverse` function only works on square 2-dimensional arrays or DataFrames!"),kJ(r).forEach(t=>Ao(ty(t),"The array passed into the `inverse` function must contain only numbers!"));let e=TJ(r);if(Ao(e.length===2,"The array passed into the `inverse` function must be exactly two-dimensional and square!"),Ao(e[0]===e[1],"The array passed into the `inverse` function must be exactly two-dimensional and square!"),Ao(e[0]>=0,"The array passed into the `inverse` function must be exactly two-dimensional and square!"),e[0]===0)return r;if(e[0]===1)return Ao(r[0][0]!==0,"This matrix cannot be inverted!"),1/r[0][0];if(e[0]===2){let t=r[0][0],n=r[0][1],a=r[1][0],i=r[1][1],o=t*i-n*a;Ao(o!==0,"This matrix cannot be inverted!");let s=[[i,-n],[-a,t]];return BC(s,1/o)}else if(e[0]>1){let t=(n,a)=>ty(n)||ty(a)?BC(n,a):xJ(n,a);for(let n=1;n<e[0]-1;n++)try{let a=r.slice(0,n).map(m=>m.slice(0,n)),i=r.slice(0,n).map(m=>m.slice(n,e[0])),o=r.slice(n,e[0]).map(m=>m.slice(0,n)),s=r.slice(n,e[0]).map(m=>m.slice(n,e[0])),u=Ap(a),c=Ap(MC(s,t(-1,t(t(o,u),i)))),l=MC(u,t(t(t(t(u,i),c),o),u)),f=t(-1,t(t(u,i),c)),h=t(-1,t(t(c,o),u)),p=c;return l.map((m,v)=>m.concat(f[v])).concat(h.map((m,v)=>m.concat(p[v])))}catch{}Ao(!1,"This matrix cannot be inverted!")}}LC.exports=Ap});var qC=Y((Sut,$C)=>{var EJ=new Function(`
    try {
      return this === window
    } catch(e) {}

    try {
      return !!importScripts
    } catch(e){}

    return false
  `);$C.exports=EJ});var VC=Y((Nut,WC)=>{var ry=rt(),IJ=zt();function CJ(r,e,t){try{return ry(r)?ry(e)?ry(t)?t*(e-r)+r:NaN:NaN:NaN}catch{return NaN}}WC.exports=IJ(CJ)});var HC=Y((Tut,GC)=>{var UC=rt(),AJ=yt(),DJ=zt();function _J(r,e){try{return e=AJ(e)?Math.E:e,UC(r)?UC(e)?Math.log(r)/Math.log(e):NaN:NaN}catch{return NaN}}GC.exports=DJ(_J)});var XC=Y((Eut,jC)=>{var FJ=qe(),RJ=vr(),OJ=Ge(),PJ=lt(),MJ=ut(),BJ=So();function KC(r){if(PJ(r)||MJ(r))return KC(r.values);FJ(OJ(r),"The `median` function only works on arrays, Series, and DataFrames!");try{let e=BJ(RJ(r));return e.length===0?NaN:e.length%2===0?(e[e.length/2-1]+e[e.length/2])/2:e[parseInt(e.length/2)]}catch{return NaN}}jC.exports=KC});var JC=Y((Iut,ZC)=>{var YC=rt(),LJ=zt();function zJ(r,e){try{return YC(r)?YC(e)?r%e:NaN:NaN}catch{return NaN}}ZC.exports=LJ(zJ)});var rA=Y((Cut,tA)=>{var $J=qe(),qJ=kl(),WJ=vr(),VJ=Ge(),UJ=lt(),GJ=ut(),HJ=ni(),QC=So();function eA(r){if(UJ(r)||GJ(r))return eA(r.values);$J(VJ(r),"The `mode` function only works on arrays, Series, and DataFrames!");try{if(r.length===0)return NaN;let e=WJ(r);if(e.length===0)return NaN;let t={},n=HJ(e);n.forEach(s=>{t[s]=qJ(e,s)});let a=QC(n,(s,u)=>t[u]-t[s]),i=a[0];return QC(a.filter(s=>t[s]===t[i]))}catch{return NaN}}tA.exports=eA});var oA=Y((Aut,iA)=>{var{random:nA}=zu(),KJ=Ml(),jJ=yt(),XJ=ko();function aA(){let r=nA(),e=nA();return Math.sqrt(-2*Math.log(r))*Math.cos(2*Math.PI*e)}function YJ(r){return jJ(r)?aA():KJ(XJ(r),aA)}iA.exports=YJ});var uA=Y((Dut,sA)=>{var ZJ=Ml(),JJ=ko();function QJ(r){return ZJ(JJ(r),()=>1)}sA.exports=QJ});var lA=Y((_ut,cA)=>{var ny=qe(),eQ=vr(),tQ=Ge(),rQ=lt(),nQ=rt(),aQ=ut(),iQ=yt();function Dp(r,e){if(rQ(r)||aQ(r))return Dp(r.values,e);if(ny(tQ(r),"The `permutations` function only works on arrays, Series, and DataFrames!"),iQ(e)&&(e=r.length),ny(nQ(e),"`r` must be a whole number!"),r=eQ(r),e>r.length)return Dp(r);if(e<=0)return[[]];if(ny(e===parseInt(e),"`r` must be a whole number!"),r.length<2)return r;let t=[];return r.forEach((n,a)=>{let i=r.slice(0,a),o=r.slice(a+1),s=i.concat(o);Dp(s,e-1).forEach(c=>{t.push([n].concat(c))})}),t}cA.exports=Dp});var hA=Y((Fut,fA)=>{var{DataFrame:oQ,Series:sQ}=Ol(),uQ=Ge(),cQ=lt(),lQ=Sl(),fQ=ut(),hQ=ir();function pQ(){Object.keys(arguments).forEach(r=>{let e=arguments[r];if(uQ(e))if(lQ(e))console.log(e);else{let t=hQ(e);t.length===1?new sQ(e).print():t.length==2?new oQ(e).print():console.log(e)}else cQ(e)||fQ(e)?e.print():console.log(e)})}fA.exports=pQ});var vA=Y((Rut,dA)=>{var dQ=Ge(),vQ=rt(),pA=yt(),mQ=Wu(),gQ=dp(),yQ=zt(),bQ=yQ(function(r,e,t,n,a){try{return[r,e,t,n,a].every(i=>vQ(i))?t-e===0?NaN:(a-n)*(r-e)/(t-e)+n:NaN}catch{return NaN}});function wQ(r,e,t,n,a){return dQ(r)&&pA(n)&&pA(a)&&(n=e,a=t,e=gQ(r),t=mQ(r)),bQ(r,e,t,n,a)}dA.exports=wQ});var gA=Y((Out,mA)=>{var xQ=rt(),kQ=zt();function SQ(r){try{return xQ(r)?Math.round(r):NaN}catch{return NaN}}mA.exports=kQ(SQ)});var bA=Y((Put,yA)=>{var NQ=rt(),TQ=zt();function EQ(r){try{return NQ(r)?r<0?-1:r>0?1:0:NaN}catch{return NaN}}yA.exports=TQ(EQ)});var xA=Y((Mut,wA)=>{var IQ=rt(),CQ=zt();function AQ(r){try{return IQ(r)?Math.sin(r):NaN}catch{return NaN}}wA.exports=CQ(AQ)});var SA=Y((But,kA)=>{var DQ=yp();function _Q(r){return DQ(r)}kA.exports=_Q});var TA=Y((Lut,NA)=>{var FQ=rt(),RQ=zt();function OQ(r){try{return FQ(r)?Math.tan(r):NaN}catch{return NaN}}NA.exports=RQ(OQ)});var _p=Y((zut,CA)=>{var EA=qe(),IA=In();function PQ(r,e){EA(IA(r),"`fn` must be a function!");let t=new Date;return e?r(...e):r(),new Date-t}async function MQ(r,e){EA(IA(r),"`fn` must be a function!");let t=new Date;return e?await r(...e):await r(),new Date-t}CA.exports={timeSync:PQ,timeAsync:MQ}});var DA=Y(($ut,AA)=>{var BQ=Ge(),LQ=lt(),zQ=ut(),$Q=ni();function qQ(){return $Q([...arguments].map(r=>BQ(r)?r:LQ(r)||zQ(r)?r.values:[r]))}AA.exports=qQ});var FA=Y((qut,_A)=>{var WQ=qe(),VQ=Ge(),UQ=lt(),GQ=ut(),HQ=yt(),KQ=Wu(),jQ=ha();function XQ(){let r=[],e=Object.values(arguments).map(t=>((UQ(t)||GQ(t))&&(t=t.values),WQ(VQ(t),"The `zip` function only works on arrays, Series, and DataFrames!"),t));return jQ(0,KQ(e.map(t=>t.length))).forEach(t=>{let n=[];e.forEach(a=>{let i=a[t];n.push(HQ(i)?void 0:i)}),r.push(n)}),r}_A.exports=XQ});var It=Y((Wut,ay)=>{var{copy:YQ,decycle:ZQ}=Ei(),{DataFrame:JQ,Series:QQ}=Ol(),Uu={abs:hp(),add:pp(),apply:Ml(),arccos:gE(),arcsin:bE(),arctan:xE(),argmax:SE(),argmin:IE(),assert:qe(),cast:Pg(),ceil:FE(),chop:PE(),clamp:BE(),combinations:zE(),copy:YQ,correl:iI(),cos:sI(),count:kl(),covariance:$g(),DataFrame:JQ,dataTypes:cI(),decycle:ZQ,diff:vI(),distance:AI(),divide:_I(),dot:jg(),dropMissing:Xg(),dropMissingPairwise:KI(),dropNaN:vg(),dropNaNPairwise:tC(),dropUndefined:nC(),exp:iC(),factorial:uC(),find:hC(),findAll:mC(),flatten:vr(),float:yC(),floor:wC(),identity:SC(),indexOf:wl(),inferType:_C(),int:RC(),intersect:PC(),inverse:zC(),isArray:Ge(),isBoolean:op(),isBrowser:qC(),isDataFrame:lt(),isEqual:ri(),isFunction:In(),isJagged:Sl(),isNested:Yh(),isNumber:rt(),isObject:xo(),isSeries:ut(),isString:Wn(),isUndefined:yt(),lerp:VC(),log:HC(),MathError:Pu(),max:Wu(),mean:vp(),median:XC(),min:dp(),mod:JC(),mode:rA(),multiply:Ug(),ndarray:ko(),normal:oA(),ones:uA(),permutations:lA(),pow:bp(),print:hA(),product:Cl(),random:zu().random,range:ha(),remap:vA(),reshape:ap(),reverse:Nl(),round:gA(),scale:Vu(),seed:zu().seed,Series:QQ,set:ni(),shape:ir(),shuffle:ip(),sign:bA(),sin:xA(),sort:So(),sqrt:gp(),std:yp(),stdev:SA(),subtract:Gg(),sum:wp(),tan:TA(),time:_p().timeSync,timeSync:_p().timeSync,timeAsync:_p().timeAsync,transpose:vs(),union:DA(),variance:qg(),vectorize:zt(),zeros:Jg(),zip:FA(),dump:function(){let r=typeof global<"u"?global:window;if(!r)throw new Uu.MathError("Cannot dump functions into global scope because neither `global` nor `window` exist in the current context!");Object.keys(Uu).forEach(e=>{try{Object.defineProperty(r,e,{configurable:!1,enumerable:!0,writable:!1,value:Uu[e]})}catch{r[e]=Uu[e]}})}};typeof ay<"u"&&(ay.exports=Uu);typeof window<"u"&&(window.JSMathTools=Uu)});var RA=Y(()=>{});var OA=Y(()=>{});var Fp=Y(()=>{});var Rs=Y(A=>{"use strict";function eee(r,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){if(n!=="default"&&!(n in r)){var a=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,a.get?a:{enumerable:!0,get:function(){return t[n]}})}})}),r}var fy=function(r,e){return fy=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},fy(r,e)};function eo(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");fy(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function je(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(f){o(f)}}function u(l){try{c(n.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((n=n.apply(r,e||[])).next())})}function Xe(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function fn(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Se(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function wt(r,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}var tee=1e-7,ree=1e-4,nee=function(){function r(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return r.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},r.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},r.prototype.has=function(e){return this.data.has(e)},r.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},r.prototype.numDataIds=function(){return this.dataIdsCount},r}(),tD=function(){function r(){}return r.prototype.refCount=function(e){return Un("refCount")},r.prototype.incRef=function(e){return Un("incRef")},r.prototype.timerAvailable=function(){return!0},r.prototype.time=function(e){return Un("time")},r.prototype.read=function(e){return Un("read")},r.prototype.readSync=function(e){return Un("readSync")},r.prototype.readToGPU=function(e,t){return Un("readToGPU")},r.prototype.numDataIds=function(){return Un("numDataIds")},r.prototype.disposeData=function(e,t){return Un("disposeData")},r.prototype.write=function(e,t,n){return Un("write")},r.prototype.move=function(e,t,n,a,i){return Un("move")},r.prototype.createTensorFromGPUData=function(e,t,n){return Un("createTensorFromGPUData")},r.prototype.memory=function(){return Un("memory")},r.prototype.floatPrecision=function(){return Un("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?tee:ree},r.prototype.dispose=function(){return Un("dispose")},r}();function Un(r){throw new Error("'".concat(r,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function rD(r){for(var e=r.length,t=0;e>0;)t=Math.random()*e|0,e--,zp(r,e,t)}function aee(r,e){if(r.length!==e.length)throw new Error("Array sizes must match to be shuffled together "+"First array length was ".concat(r.length)+"Second array length was ".concat(e.length));for(var t=r.length,n=0;t>0;)n=Math.random()*t|0,t--,zp(r,t,n),zp(e,t,n)}function Vl(r,e,t){return Math.max(r,Math.min(e,t))}function iee(r){return r%2===0?r:r+1}function zp(r,e,t){var n=r[e];r[e]=r[t],r[t]=n}function oee(r){for(var e=0,t=0;t<r.length;t++)e+=r[t];return e}function see(r,e){var t=Math.random();return e*t+(1-t)*r}function uee(r,e){for(var t=0,n=0;n<r.length;n++){var a=Number(r[n])-Number(e[n]);t+=a*a}return t}function q(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function bn(r,e,t){t===void 0&&(t=""),q(to(r,e),function(){return t+" Shapes ".concat(r," and ").concat(e," must match")})}function As(r){q(r!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Ht(r){if(r.length===0)return 1;for(var e=r[0],t=1;t<r.length;t++)e*=r[t];return e}function cee(r){return r.length===0}function nD(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==null&&e[t]!==null&&r[t]!==e[t])return!1;return!0}function to(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function ec(r){return r%1===0}function lee(r){if(Math.tanh!=null)return Math.tanh(r);if(r===1/0)return 1;if(r===-1/0)return-1;var e=Math.exp(2*r);return(e-1)/(e+1)}function fee(r){var e=Math.ceil(Math.sqrt(r));return[e,Math.ceil(r/e)]}function hee(r){for(var e=new Uint32Array(r),t=0;t<r;++t)e[t]=t;return rD(e),e}function $l(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function pee(r,e,t,n){return e===void 0&&(e=function(a){return 0}),new Promise(function(a,i){var o=0,s=function(){if(r()){a();return}o++;var u=e(o);if(t!=null&&o>=t){i();return}n!=null?n(s,u):setTimeout(s,u)};s()})}function dee(r,e){for(var t=1,n=-1,a=0;a<r.length;++a)if(r[a]>=0)t*=r[a];else if(r[a]===-1){if(n!==-1)throw Error("Shapes can only have 1 implicit size. "+"Found -1 at dim ".concat(n," and dim ").concat(a));n=a}else if(r[a]<0)throw Error("Shapes can not be < 0. Found ".concat(r[a]," at dim ").concat(a));if(n===-1){if(e>0&&e!==t)throw Error("Size(".concat(e,") must match the product of shape ").concat(r));return r}if(t===0)throw Error("Cannot infer the missing size in [".concat(r,"] when ")+"there are 0 elements");if(e%t!==0)throw Error("The implicit shape can't be a fractional number. "+"Got ".concat(e," / ").concat(t));var i=r.slice();return i[n]=e/t,i}function nf(r,e){var t=e.length;return r=r==null?e.map(function(n,a){return a}):[].concat(r),q(r.every(function(n){return n>=-t&&n<t}),function(){return"All values in axis param must be in range [-".concat(t,", ").concat(t,") but ")+"got axis ".concat(r)}),q(r.every(function(n){return ec(n)}),function(){return"All values in axis param must be integers but "+"got axis ".concat(r)}),r.map(function(n){return n<0?t+n:n})}function aD(r,e){for(var t=[],n=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:nf(e,r).sort(),o=0,s=0;s<r.length;++s){if(i!=null){if(i[o]===s&&r[s]!==1)throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(r[s],"' is not 1"));(i[o]==null||i[o]>s)&&r[s]===1&&(t.push(r[s]),n.push(s)),i[o]<=s&&o++}r[s]!==1&&(t.push(r[s]),n.push(s))}return{newShape:t,keptDims:n}}function iD(r,e){return My(r,e)}function My(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else if(r==="string")t=new Array(e);else throw new Error("Unknown data type ".concat(r));return t}function oD(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type ".concat(e," being uploaded contains ").concat(n,"."))}}function sD(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function vee(r,e){return!(e==="complex64"||e==="float32"&&r!=="complex64"||e==="int32"&&r!=="float32"&&r!=="complex64"||e==="bool"&&r==="bool")}function $p(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype ".concat(r))}function uD(r){if(r==null)return 0;var e=0;return r.forEach(function(t){return e+=t.length}),e}function _o(r){return typeof r=="string"||r instanceof String}function cD(r){return typeof r=="boolean"}function lD(r){return typeof r=="number"}function af(r){return Array.isArray(r)?af(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":lD(r)?"float32":_o(r)?"string":cD(r)?"bool":"float32"}function Po(r){return!!(r&&r.constructor&&r.call&&r.apply)}function qp(r,e){for(var t=e;t<r;++t)if(r%t===0)return t;return r}function ac(r){var e=r.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=r[e-1];for(var n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function fD(r,e,t,n){n===void 0&&(n=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(n?2:1),o=0;o<i;o++)a[o]=t[r+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(l,f){return l*f})*(n?2:1),o=0;o<i;o++)a[o]=fD(r+o*u,s,t,n);return a}function ju(r,e,t){if(t===void 0&&(t=!1),r.length===0)return e[0];var n=r.reduce(function(a,i){return a*i})*(t?2:1);if(n===0)return[];if(n!==e.length)throw new Error("[".concat(r,"] does not match the input size ").concat(e.length).concat(t?" for a complex tensor":"","."));return fD(0,r,e,t)}function mee(r,e){if(Array.isArray(r))return r;if(e==="float32")return r instanceof Float32Array?r:new Float32Array(r);if(e==="int32")return r instanceof Int32Array?r:new Int32Array(r);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(r));throw new Error("Unknown dtype ".concat(e))}function By(r,e){for(var t=ed(r,e),n=0;n<t.length;n++)t[n]=1;return t}function ed(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error("Unknown data type ".concat(e))}function gee(r,e){var t=r.reduce(function(n,a){return n*a},1);if(e==null||e==="float32")return ju(r,new Float32Array(t));if(e==="int32")return ju(r,new Int32Array(t));if(e==="bool")return ju(r,new Uint8Array(t));throw new Error("Unknown data type ".concat(e))}function Kn(r){r.forEach(function(e){q(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(r,"].")})})}function yee(r,e,t){if(e===0)return 0;if(e===1)return r[0];for(var n=r[r.length-1],a=0;a<r.length-1;++a)n+=t[a]*r[a];return n}function bee(r,e,t){if(e===0)return[];if(e===1)return[r];for(var n=new Array(e),a=0;a<n.length-1;++a)n[a]=Math.floor(r/t[a]),r-=n[a]*t[a];return n[n.length-1]=r,n}function td(r){return r&&r.then&&typeof r.then=="function"}var PA="tfjsflags",hD=function(){function r(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=wee,this.populateURLFlags()}return r.prototype.setPlatform=function(e,t){this.platform!=null&&(dt().getBool("IS_TEST")||dt().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t},r.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){var a=this.urlFlags[e];dt().getBool("IS_TEST")||dt().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(a,".")),this.set(e,a)}},r.prototype.getAsync=function(e){return je(this,void 0,void 0,function(){var t,n;return Xe(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,n=e,[4,this.evaluateFlag(e)]);case 1:return t[n]=a.sent(),[2,this.flags[e]]}})})},r.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(td(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},r.prototype.getNumber=function(e){return this.get(e)},r.prototype.getBool=function(e){return this.get(e)},r.prototype.getString=function(e){return this.get(e)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!1,configurable:!0}),r.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},r.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()},r.prototype.setFlags=function(e){this.flags=Object.assign({},e)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if(PA in t){var n=t[PA].split(",");n.forEach(function(a){var i=Se(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=kee(o,s)})}}},r}();function wee(r){var e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];return xee(e,n[0],n[1]),n.join("=")}),e}function xee(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function kee(r,e){var t=e.toLowerCase();return t==="true"||t==="false"?t==="true":"".concat(+t)===t?+t:e}function dt(){return A.ENV}A.ENV=null;function See(r){A.ENV=r}var iy;function pD(){if(iy==null){var r=void 0;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");iy=r}return iy}function Nee(){var r=pD();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function Ly(r,e){var t=Nee();if(t.has(r))return t.get(r);var n=e();return t.set(r,n),t.get(r)}var dD="Abs",vD="Acos",mD="Acosh",zy="Add",gD="AddN",yD="All",bD="Any",wD="ArgMax",xD="ArgMin",kD="Asin",SD="Asinh",ND="Atan",TD="Atanh",ED="Atan2",ID="AvgPool",Tee="AvgPoolGrad",CD="AvgPool3D",Eee="AvgPool3DGrad",AD="BatchMatMul",DD="BatchToSpaceND",_D="Bincount",FD="BitwiseAnd",Iee="BroadcastTo",RD="BroadcastArgs",$y="Cast",OD="Ceil",PD="ClipByValue",MD="Complex",BD="ComplexAbs",LD="Concat",zD="Conv2D",$D="Conv2DBackpropFilter",qD="Conv2DBackpropInput",WD="Conv3D",Cee="Conv3DBackpropFilterV2",VD="Conv3DBackpropInputV2",UD="Cos",GD="Cosh",HD="Cumprod",KD="Cumsum",jD="CropAndResize",XD="DenseBincount",YD="DepthToSpace",ZD="DepthwiseConv2dNative",JD="DepthwiseConv2dNativeBackpropFilter",QD="DepthwiseConv2dNativeBackpropInput",e_="Diag",t_="Dilation2D",Aee="Dilation2DBackpropInput",Dee="Dilation2DBackpropFilter",r_="Draw",n_="RealDiv",a_="Einsum",i_="Elu",_ee="EluGrad",o_="Erf",s_="Equal",u_="Exp",c_="ExpandDims",l_="Expm1",f_="FFT",h_="Fill",p_="FlipLeftRight",d_="Floor",v_="FloorDiv",m_="FusedBatchNorm",g_="GatherV2",y_="GatherNd",b_="Greater",w_="GreaterEqual",qy="Identity",x_="IFFT",k_="Imag",S_="IsFinite",N_="IsInf",T_="IsNan",E_="LeakyRelu",I_="Less",C_="LessEqual",A_="LinSpace",D_="Log",__="Log1p",F_="LogicalAnd",R_="LogicalNot",O_="LogicalOr",Fee="LogicalXor",Ree="LogSoftmax",Oee="LowerBound",P_="LRN",Pee="LRNGrad",Mee="MatrixBandPart",M_="Max",B_="Maximum",L_="MaxPool",Bee="MaxPoolGrad",z_="MaxPool3D",Lee="MaxPool3DGrad",$_="MaxPoolWithArgmax",q_="Mean",W_="Min",V_="Minimum",U_="MirrorPad",G_="Mod",H_="Multinomial",K_="Multiply",j_="Neg",X_="NotEqual",Y_="NonMaxSuppressionV3",Z_="NonMaxSuppressionV4",J_="NonMaxSuppressionV5",Q_="OnesLike",e3="OneHot",t3="Pack",r3="PadV2",zee="Pool",n3="Pow",a3="Prelu",i3="Prod",o3="RaggedGather",s3="RaggedRange",u3="RaggedTensorToTensor",c3="Range",l3="Real",f3="Reciprocal",h3="Relu",p3="Reshape",d3="ResizeNearestNeighbor",$ee="ResizeNearestNeighborGrad",v3="ResizeBilinear",qee="ResizeBilinearGrad",m3="Relu6",g3="Reverse",y3="Round",b3="Rsqrt",w3="ScatterNd",x3="TensorScatterUpdate",k3="SearchSorted",S3="Select",N3="Selu",T3="Slice",E3="Sin",I3="Sinh",C3="Sign",A3="Sigmoid",D3="Softplus",_3="Sqrt",F3="Sum",R3="SpaceToBatchND",O3="SplitV",P3="Softmax",M3="SparseFillEmptyRows",B3="SparseReshape",L3="SparseSegmentMean",z3="SparseSegmentSum",$3="SparseToDense",q3="SquaredDifference",Wee="Square",W3="StaticRegexReplace",V3="StridedSlice",U3="StringNGrams",G3="StringSplit",H3="StringToHashBucketFast",K3="Sub",j3="Tan",X3="Tanh",Wy="Tile",Y3="TopK",Z3="Transform",Pp="Transpose",J3="Unique",Q3="Unpack",eF="UnsortedSegmentSum",Vee="UpperBound",tF="ZerosLike",rF="Step",hy="FromPixels",nF="RotateWithOffset",py="_FusedMatMul",dy="FusedConv2D",vy="FusedDepthwiseConv2D";function Do(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];dt().getBool("IS_TEST")||dt().getBool("PROD")||console.warn.apply(console,wt([],Se(r),!1))}function Uee(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];dt().getBool("IS_TEST")||dt().getBool("PROD")||console.log.apply(console,wt([],Se(r),!1))}var tc=Ly("kernelRegistry",function(){return new Map}),Ul=Ly("gradRegistry",function(){return new Map});function Wp(r,e){var t=Vy(r,e);return tc.get(t)}function my(r){return Ul.get(r)}function Vp(r){for(var e=tc.entries(),t=[];;){var n=e.next(),a=n.done,i=n.value;if(a)break;var o=Se(i,2),s=o[0],u=o[1],c=Se(s.split("_"),1),l=c[0];l===r&&t.push(u)}return t}function aF(r){var e=r.kernelName,t=r.backendName,n=Vy(e,t);tc.has(n)&&Do("The kernel '".concat(e,"' for backend ")+"'".concat(t,"' is already registered")),tc.set(n,r)}function Gee(r){var e=r.kernelName;Ul.has(e)&&dt().getBool("DEBUG")&&Do("Overriding the gradient for '".concat(e,"'")),Ul.set(e,r)}function Hee(r,e){var t=Vy(r,e);if(!tc.has(t))throw new Error("The kernel '".concat(r,"' for backend ")+"'".concat(e,"' is not registered"));tc.delete(t)}function Kee(r){if(!Ul.has(r))throw new Error("The gradient '".concat(r,"' for backend is not registered"));Ul.delete(r)}function jee(r,e){var t=Vp(r);t.forEach(function(n){var a=Object.assign({},n,{backendName:e});aF(a)})}function Vy(r,e){return"".concat(e,"_").concat(r)}function iF(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}var Ds=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Xee(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var oF=Kt,Ca=null;try{Ca=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Kt(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}Kt.prototype.__isLong__;Object.defineProperty(Kt.prototype,"__isLong__",{value:!0});function jn(r){return(r&&r.__isLong__)===!0}Kt.isLong=jn;var MA={},BA={};function _s(r,e){var t,n,a;return e?(r>>>=0,(a=0<=r&&r<256)&&(n=BA[r],n)?n:(t=jt(r,(r|0)<0?-1:0,!0),a&&(BA[r]=t),t)):(r|=0,(a=-128<=r&&r<128)&&(n=MA[r],n)?n:(t=jt(r,r<0?-1:0,!1),a&&(MA[r]=t),t))}Kt.fromInt=_s;function Aa(r,e){if(isNaN(r))return e?ws:Da;if(e){if(r<0)return ws;if(r>=sF)return lF}else{if(r<=-zA)return Gn;if(r+1>=zA)return cF}return r<0?Aa(-r,e).neg():jt(r%rc|0,r/rc|0,e)}Kt.fromNumber=Aa;function jt(r,e,t){return new Kt(r,e,t)}Kt.fromBits=jt;var Up=Math.pow;function Uy(r,e,t){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return Da;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return Uy(r.substring(1),e,t).neg();for(var a=Aa(Up(t,8)),i=Da,o=0;o<r.length;o+=8){var s=Math.min(8,r.length-o),u=parseInt(r.substring(o,o+s),t);if(s<8){var c=Aa(Up(t,s));i=i.mul(c).add(Aa(u))}else i=i.mul(a),i=i.add(Aa(u))}return i.unsigned=e,i}Kt.fromString=Uy;function si(r,e){return typeof r=="number"?Aa(r,e):typeof r=="string"?Uy(r,e):jt(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}Kt.fromValue=si;var LA=1<<16,Yee=1<<24,rc=LA*LA,sF=rc*rc,zA=sF/2,$A=_s(Yee),Da=_s(0);Kt.ZERO=Da;var ws=_s(0,!0);Kt.UZERO=ws;var Ku=_s(1);Kt.ONE=Ku;var uF=_s(1,!0);Kt.UONE=uF;var gy=_s(-1);Kt.NEG_ONE=gy;var cF=jt(-1,2147483647,!1);Kt.MAX_VALUE=cF;var lF=jt(-1,-1,!0);Kt.MAX_UNSIGNED_VALUE=lF;var Gn=jt(0,-2147483648,!1);Kt.MIN_VALUE=Gn;var _e=Kt.prototype;_e.toInt=function(){return this.unsigned?this.low>>>0:this.low};_e.toNumber=function(){return this.unsigned?(this.high>>>0)*rc+(this.low>>>0):this.high*rc+(this.low>>>0)};_e.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Gn)){var t=Aa(e),n=this.div(t),a=n.mul(t).sub(this);return n.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Aa(Up(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};_e.getHighBits=function(){return this.high};_e.getHighBitsUnsigned=function(){return this.high>>>0};_e.getLowBits=function(){return this.low};_e.getLowBitsUnsigned=function(){return this.low>>>0};_e.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Gn)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};_e.isZero=function(){return this.high===0&&this.low===0};_e.eqz=_e.isZero;_e.isNegative=function(){return!this.unsigned&&this.high<0};_e.isPositive=function(){return this.unsigned||this.high>=0};_e.isOdd=function(){return(this.low&1)===1};_e.isEven=function(){return(this.low&1)===0};_e.equals=function(e){return jn(e)||(e=si(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};_e.eq=_e.equals;_e.notEquals=function(e){return!this.eq(e)};_e.neq=_e.notEquals;_e.ne=_e.notEquals;_e.lessThan=function(e){return this.comp(e)<0};_e.lt=_e.lessThan;_e.lessThanOrEqual=function(e){return this.comp(e)<=0};_e.lte=_e.lessThanOrEqual;_e.le=_e.lessThanOrEqual;_e.greaterThan=function(e){return this.comp(e)>0};_e.gt=_e.greaterThan;_e.greaterThanOrEqual=function(e){return this.comp(e)>=0};_e.gte=_e.greaterThanOrEqual;_e.ge=_e.greaterThanOrEqual;_e.compare=function(e){if(jn(e)||(e=si(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};_e.comp=_e.compare;_e.negate=function(){return!this.unsigned&&this.eq(Gn)?Gn:this.not().add(Ku)};_e.neg=_e.negate;_e.add=function(e){jn(e)||(e=si(e));var t=this.high>>>16,n=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,p=0;return p+=i+c,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=n+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,jt(h<<16|p,l<<16|f,this.unsigned)};_e.subtract=function(e){return jn(e)||(e=si(e)),this.add(e.neg())};_e.sub=_e.subtract;_e.multiply=function(e){if(this.isZero())return Da;if(jn(e)||(e=si(e)),Ca){var t=Ca.mul(this.low,this.high,e.low,e.high);return jt(t,Ca.get_high(),this.unsigned)}if(e.isZero())return Da;if(this.eq(Gn))return e.isOdd()?Gn:Da;if(e.eq(Gn))return this.isOdd()?Gn:Da;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt($A)&&e.lt($A))return Aa(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*l,p+=d>>>16,d&=65535,p+=i*l,h+=p>>>16,p&=65535,p+=o*c,h+=p>>>16,p&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=n*l+a*c+i*u+o*s,f&=65535,jt(p<<16|d,f<<16|h,this.unsigned)};_e.mul=_e.multiply;_e.divide=function(e){if(jn(e)||(e=si(e)),e.isZero())throw Error("division by zero");if(Ca){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Ca.div_u:Ca.div_s)(this.low,this.high,e.low,e.high);return jt(t,Ca.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?ws:Da;var n,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return ws;if(e.gt(this.shru(1)))return uF;i=ws}else{if(this.eq(Gn)){if(e.eq(Ku)||e.eq(gy))return Gn;if(e.eq(Gn))return Ku;var o=this.shr(1);return n=o.div(e).shl(1),n.eq(Da)?e.isNegative()?Ku:gy:(a=this.sub(e.mul(n)),i=n.add(a.div(e)),i)}else if(e.eq(Gn))return this.unsigned?ws:Da;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Da}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:Up(2,s-48),c=Aa(n),l=c.mul(e);l.isNegative()||l.gt(a);)n-=u,c=Aa(n,this.unsigned),l=c.mul(e);c.isZero()&&(c=Ku),i=i.add(c),a=a.sub(l)}return i};_e.div=_e.divide;_e.modulo=function(e){if(jn(e)||(e=si(e)),Ca){var t=(this.unsigned?Ca.rem_u:Ca.rem_s)(this.low,this.high,e.low,e.high);return jt(t,Ca.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};_e.mod=_e.modulo;_e.rem=_e.modulo;_e.not=function(){return jt(~this.low,~this.high,this.unsigned)};_e.and=function(e){return jn(e)||(e=si(e)),jt(this.low&e.low,this.high&e.high,this.unsigned)};_e.or=function(e){return jn(e)||(e=si(e)),jt(this.low|e.low,this.high|e.high,this.unsigned)};_e.xor=function(e){return jn(e)||(e=si(e)),jt(this.low^e.low,this.high^e.high,this.unsigned)};_e.shiftLeft=function(e){return jn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?jt(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):jt(0,this.low<<e-32,this.unsigned)};_e.shl=_e.shiftLeft;_e.shiftRight=function(e){return jn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?jt(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):jt(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};_e.shr=_e.shiftRight;_e.shiftRightUnsigned=function(e){if(jn(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var n=this.low;return jt(n>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?jt(t,0,this.unsigned):jt(t>>>e-32,0,this.unsigned)};_e.shru=_e.shiftRightUnsigned;_e.shr_u=_e.shiftRightUnsigned;_e.toSigned=function(){return this.unsigned?jt(this.low,this.high,!1):this};_e.toUnsigned=function(){return this.unsigned?this:jt(this.low,this.high,!0)};_e.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};_e.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};_e.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};Kt.fromBytes=function(e,t,n){return n?Kt.fromBytesLE(e,t):Kt.fromBytesBE(e,t)};Kt.fromBytesLE=function(e,t){return new Kt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};Kt.fromBytesBE=function(e,t){return new Kt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var fF=Xee(oF),Zee=eee({__proto__:null,default:fF},[oF]),bs=fF||Zee;function of(r){return bs.fromString(r,!0,16)}var hF=of("c3a5c85c97cb3127"),gs=of("b492b66fbe98f273"),yn=of("9ae16a3b2f90404f");function yy(r){return r.xor(r.shru(47))}function pF(r,e,t){var n=r.slice(e,e+t);return bs.fromBytes(Array.from(n),!0,!0)}function Wt(r,e){return pF(r,e,8)}function qA(r,e){return pF(r,e,4)}function Hr(r,e){return e===0?r:r.shru(e).or(r.shl(64-e))}function Ro(r,e,t){t===void 0&&(t=of("9ddfea08eb382d69"));var n=r.xor(e).mul(t);n=n.xor(n.shru(47));var a=e.xor(n).mul(t);return a=a.xor(a.shru(47)),a=a.mul(t),a}function Jee(r,e,t,n,a,i){a=a.add(r),i=Hr(i.add(a).add(n),21);var o=a;return a=a.add(e),a=a.add(t),i=i.add(Hr(a,44)),[a.add(n),i.add(o)]}function Rp(r,e,t,n){return Jee(Wt(r,e),Wt(r,e+8),Wt(r,e+16),Wt(r,e+24),t,n)}function Qee(r,e){if(e===void 0&&(e=r.length),e>=8){var t=yn.add(e*2),n=Wt(r,0).add(yn),a=Wt(r,e-8),i=Hr(a,37).mul(t).add(n),o=Hr(n,25).add(a).mul(t);return Ro(i,o,t)}if(e>=4){var t=yn.add(e*2),n=qA(r,0);return Ro(n.shl(3).add(e),qA(r,e-4),t)}if(e>0){var n=r[0],a=r[e>>1],i=r[e-1],s=n+(a<<8),u=e+(i<<2);return yy(yn.mul(s).xor(hF.mul(u))).mul(yn)}return yn}function ete(r,e){e===void 0&&(e=r.length);var t=yn.add(e*2),n=Wt(r,0).mul(gs),a=Wt(r,8),i=Wt(r,e-8).mul(t),o=Wt(r,e-16).mul(yn);return Ro(Hr(n.add(a),43).add(Hr(i,30)).add(o),n.add(Hr(a.add(yn),18)).add(i),t)}function tte(r,e){e===void 0&&(e=r.length);var t=yn.add(e*2),n=Wt(r,0).mul(yn),a=Wt(r,8),i=Wt(r,e-8).mul(t),o=Wt(r,e-16).mul(yn),s=Hr(n.add(a),43).add(Hr(i,30)).add(o),u=Ro(s,n.add(Hr(a.add(yn),18)).add(i),t),c=Wt(r,16).mul(t),l=Wt(r,24),f=s.add(Wt(r,e-32)).mul(t),h=u.add(Wt(r,e-24)).mul(t);return Ro(Hr(c.add(l),43).add(Hr(f,30)).add(h),c.add(Hr(l.add(n),18)).add(f),t)}function rte(r,e){var t,n;e===void 0&&(e=r.length);var a=bs.fromNumber(81,!0);if(e<=32)return e<=16?Qee(r,e):ete(r,e);if(e<=64)return tte(r,e);var i=a,o=a.mul(gs).add(113),s=yy(o.mul(yn).add(113)).mul(yn),u=[bs.UZERO,bs.UZERO],c=[bs.UZERO,bs.UZERO];i=i.mul(yn).add(Wt(r,0));var l=0,f=(e-1>>6)*64,h=f+(e-1&63)-63;do i=Hr(i.add(o).add(u[0]).add(Wt(r,l+8)),37).mul(gs),o=Hr(o.add(u[1]).add(Wt(r,l+48)),42).mul(gs),i=i.xor(c[1]),o=o.add(u[0]).add(Wt(r,l+40)),s=Hr(s.add(c[0]),33).mul(gs),u=Rp(r,l,u[1].mul(gs),i.add(c[0])),c=Rp(r,l+32,s.add(c[1]),o.add(Wt(r,l+16))),t=Se([i,s],2),s=t[0],i=t[1],l+=64;while(l!==f);var p=gs.add(s.and(255).shl(1));return l=h,c[0]=c[0].add(e-1&63),u[0]=u[0].add(c[0]),c[0]=c[0].add(u[0]),i=Hr(i.add(o).add(u[0]).add(Wt(r,l+8)),37).mul(p),o=Hr(o.add(u[1]).add(Wt(r,l+48)),42).mul(p),i=i.xor(c[1].mul(9)),o=o.add(u[0].mul(9).add(Wt(r,l+40))),s=Hr(s.add(c[0]),33).mul(p),u=Rp(r,l,u[1].mul(p),i.add(c[0])),c=Rp(r,l+32,s.add(c[1]),o.add(Wt(r,l+16))),n=Se([i,s],2),s=n[0],i=n[1],Ro(Ro(u[0],c[0],p).add(yy(o).mul(hF)).add(s),Ro(u[1],c[1],p).add(i),p)}function nte(r,e){return e==="string"?sf(r):rd([r],e)}function ate(r,e){return r instanceof Float32Array&&e==="float32"||r instanceof Int32Array&&e==="int32"||r instanceof Uint8Array&&e==="bool"}function rd(r,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=Mo(r)),dt().getBool("DEBUG")&&oD(r,e),ate(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){for(var t=new Uint8Array(r.length),n=0;n<t.length;++n)Math.round(r[n])!==0&&(t[n]=1);return t}else throw new Error("Unknown data type ".concat(e))}function Gl(){return dt().platform.now()}function ite(r,e){return dt().platform.fetch(r,e)}function sf(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",dt().platform.encode(r,e)}function Gp(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",dt().platform.decode(r,e)}function Kr(r){return dt().platform.isTypedArray!=null?dt().platform.isTypedArray(r):iF(r)}function Mo(r,e,t){var n,a;if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),typeof r=="boolean"||typeof r=="number"||typeof r=="string"||td(r)||r==null||Kr(r)&&t)e.push(r);else if(Array.isArray(r)||Kr(r))for(var i=0;i<r.length;++i)Mo(r[i],e,t);else{var o=-1;try{for(var s=fn(Object.keys(r)),u=s.next();!u.done;u=s.next()){var c=u.value;/^([1-9]+[0-9]*|0)$/.test(c)&&(o=Math.max(o,Number(c)))}}catch(l){n={error:l}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}for(var i=0;i<=o;i++)Mo(r[i],e,t)}return e}var ote={__proto__:null,arraysEqual:to,arraysEqualWithNull:nD,assert:q,assertNonNegativeIntegerDimensions:Kn,assertNonNull:As,assertShapesMatch:bn,bytesFromStringArray:uD,bytesPerElement:$p,checkConversionForErrors:oD,clamp:Vl,computeStrides:ac,convertBackendValuesAndArrayBuffer:mee,createScalarValue:nte,createShuffledIndices:hee,decodeString:Gp,distSquared:uee,encodeString:sf,fetch:ite,fingerPrint64:rte,flatten:Mo,getArrayFromDType:My,getTypedArrayFromDType:iD,hasEncodingLoss:vee,hexToLong:of,indexToLoc:bee,inferDtype:af,inferFromImplicitShape:dee,isBoolean:cD,isFunction:Po,isInt:ec,isNumber:lD,isPromise:td,isScalarShape:cee,isString:_o,isTypedArray:Kr,isValidDtype:sD,locToIndex:yee,makeOnesTypedArray:By,makeZerosNestedTypedArray:gee,makeZerosTypedArray:ed,nearestDivisor:qp,nearestLargerEven:iee,now:Gl,parseAxisParam:nf,randUniform:see,repeatedTry:pee,rightPad:$l,shuffle:rD,shuffleCombo:aee,sizeFromShape:Ht,sizeToSquarishShape:fee,squeezeShape:aD,sum:oee,swap:zp,tanh:lee,toNestedArray:ju,toTypedArray:rd},ste=function(){function r(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new cte)}return r.prototype.profileKernel=function(e,t,n){var a,i,o,s=function(){o=n()},u,c=Gl();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var l=fn(o),f=l.next();!f.done;f=l.next()){var h=f.value;h.dataSync()}}catch(v){a={error:v}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:Gl()-c})}if(dt().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var p=function(v){var g=o[v];g.data().then(function(y){ute(y,g.dtype,e)})},d=0;d<o.length;d++)p(d);var m={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(v){return v.kernelMs}),extraInfo:u.then(function(v){return v.getExtraProfileInfo!=null?v.getExtraProfileInfo():""})};return m},r.prototype.logKernelProfile=function(e){var t=this,n=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(c){t.logger.logKernelProfile(n,u,c[0],c[1],o,c[2])})})},r}();function ute(r,e,t){if(e!=="float32")return!1;for(var n=0;n<r.length;n++){var a=r[n];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(t,"'")),!0}return!1}var cte=function(){function r(){}return r.prototype.logKernelProfile=function(e,t,n,a,i,o){var s=typeof a=="number"?$l("".concat(a,"ms"),9):a.error,u=$l(e,25),c=t.rank,l=t.size,f=$l(t.shape.toString(),14),h="";for(var p in i){var d=i[p];if(d!=null){var m=d.shape||t.shape,v=m.length;h+="".concat(p,": ").concat(v,"D ").concat(v>0?m:""," ")}}console.log("%c".concat(u,"	%c").concat(s,"	%c").concat(c,"D ").concat(f,"	%c").concat(l,"	%c").concat(h,"	%c").concat(o),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r}();function lte(r,e,t){for(var n={},a={},i=0;i<e.length;i++)n[e[i].id]=!0;for(var i=0;i<r.length;i++){var o=r[i],s=o.inputs;for(var u in s){for(var c=s[u],l=!1,f=0;f<e.length;f++)if(n[c.id]){o.outputs.forEach(function(w){return n[w.id]=!0}),l=!0,a[o.id]=!0;break}if(l)break}}var h={};h[t.id]=!0;for(var p={},i=r.length-1;i>=0;i--)for(var o=r[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,p[o.id]=!0;break}for(var d=[],i=0;i<r.length;i++){var o=r[i];if(a[o.id]&&p[o.id]){var m={};for(var u in o.inputs){var v=o.inputs[u];n[v.id]&&(m[u]=v)}var g=Object.assign({},o);g.inputs=m,g.outputs=o.outputs,d.push(g)}}return d}function fte(r,e,t,n){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var p=r[h.id];p!=null?u.push(p):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(s.kernelName,"."));var c=s.gradient(u),l=function(h){if(!(h in c))throw new Error("Cannot backprop through input ".concat(h,". ")+"Available gradients found: ".concat(Object.keys(c),"."));var p=t(function(){return c[h]()});if(p.dtype!=="float32")throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"".concat(h," must have 'float32' dtype, but has '").concat(p.dtype,"'"));var d=s.inputs[h];if(!to(p.shape,d.shape))throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"'".concat(h,"' has shape '").concat(p.shape,"', which does not match ")+"the shape of the input '".concat(d.shape,"'"));if(r[d.id]==null)r[d.id]=p;else{var m=r[d.id];r[d.id]=n(m,p),m.dispose()}};for(var f in s.inputs)l(f)},i=e.length-1;i>=0;i--)a(i)}var WA=20,Bl=3,oy=7;function hte(r,e,t,n){var a=ac(e),i=pte(r,e,t,a),o=e.length,s=Mp(r,e,t,a,i),u=["Tensor"];return n&&(u.push("  dtype: ".concat(t)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(e,"]")),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function pte(r,e,t,n){var a=Ht(e),i=n[n.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?zl(r):r;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,f=0;f<i;f++)o[f]=Math.max(o[f],Ll(u[l+f],0,t).length);return o}function Ll(r,e,t){var n;return Array.isArray(r)?n="".concat(parseFloat(r[0].toFixed(oy))," + ")+"".concat(parseFloat(r[1].toFixed(oy)),"j"):_o(r)?n="'".concat(r,"'"):t==="bool"?n=dF(r):n=parseFloat(r.toFixed(oy)).toString(),$l(n,e)}function dF(r){return r===0?"false":"true"}function Mp(r,e,t,n,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var c=zl(r);return[Ll(c[0],0,t)]}return t==="bool"?[dF(r[0])]:[r[0].toString()]}if(u===1){if(s>WA){var l=Bl*o,f=Array.from(r.slice(0,l)),h=Array.from(r.slice((s-Bl)*o,s*o));return t==="complex64"&&(f=zl(f),h=zl(h)),["["+f.map(function(T,E){return Ll(T,a[E],t)}).join(", ")+", ..., "+h.map(function(T,E){return Ll(T,a[s-Bl+E],t)}).join(", ")+"]"]}var p=t==="complex64"?zl(r):Array.from(r);return["["+p.map(function(T,E){return Ll(T,a[E],t)}).join(", ")+"]"]}var d=e.slice(1),m=n.slice(1),v=n[0]*o,g=[];if(s>WA){for(var y=0;y<Bl;y++){var w=y*v,b=w+v;g.push.apply(g,wt([],Se(Mp(r.slice(w,b),d,t,m,a,!1)),!1))}g.push("...");for(var y=s-Bl;y<s;y++){var w=y*v,b=w+v;g.push.apply(g,wt([],Se(Mp(r.slice(w,b),d,t,m,a,y===s-1)),!1))}}else for(var y=0;y<s;y++){var w=y*v,b=w+v;g.push.apply(g,wt([],Se(Mp(r.slice(w,b),d,t,m,a,y===s-1)),!1))}var x=u===2?",":"";g[0]="["+(s>0?g[0]+x:"");for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+x;for(var S=`,
`,y=2;y<u;y++)S+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":S),g}function zl(r){for(var e=[],t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var Hp=function(){function r(e,t,n){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=Ht(e),n!=null){var i=n.length;q(i===this.size,function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||My(t,this.size),this.strides=ac(e)}return r.prototype.set=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];n.length===0&&(n=[0]),q(n.length===this.rank,function(){return"The number of provided coordinates (".concat(n.length,") must ")+"match the rank (".concat(t.rank,")")});var i=this.locToIndex(n);this.values[i]=e},r.prototype.get=function(){for(var e,t,n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];n.length===0&&(n=[0]);var i=0;try{for(var o=fn(n),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var c="Requested out of range element at ".concat(n,". ")+"  Buffer shape=".concat(this.shape);throw new Error(c)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var l=n[n.length-1],f=0;f<n.length-1;++f)l+=this.strides[f]*n[f];return this.values[l]},r.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},r.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),r.prototype.toTensor=function(){return ai().makeTensor(this.values,this.shape,this.dtype)},r}(),ai=null,Gu=null;function dte(r){ai=r}function vte(r){Gu=r}var Ar=function(){function r(e,t,n,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Ht(e),this.strides=ac(e),this.dataId=n,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),r.prototype.buffer=function(){return je(this,void 0,void 0,function(){var e;return Xe(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Gu.buffer(this.shape,this.dtype,e)]}})})},r.prototype.bufferSync=function(){return Gu.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return je(this,void 0,void 0,function(){var e;return Xe(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,ju(this.shape,e,this.dtype==="complex64")]}})})},r.prototype.arraySync=function(){return ju(this.shape,this.dataSync(),this.dtype==="complex64")},r.prototype.data=function(){return je(this,void 0,void 0,function(){var e,t;return Xe(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=ai().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(a){return Gp(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}})})},r.prototype.dataToGPU=function(e){return this.throwIfDisposed(),ai().readToGPU(this.dataId,e)},r.prototype.dataSync=function(){this.throwIfDisposed();var e=ai().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return Gp(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},r.prototype.bytes=function(){return je(this,void 0,void 0,function(){var e;return Xe(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,ai().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(ai().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!1,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.print=function(e){return e===void 0&&(e=!1),Gu.print(this,e)},r.prototype.clone=function(){return this.throwIfDisposed(),Gu.clone(this)},r.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return hte(t,this.shape,this.dtype,e)},r.prototype.cast=function(e){return this.throwIfDisposed(),Gu.cast(this,e)},r.prototype.variable=function(e,t,n){return e===void 0&&(e=!0),this.throwIfDisposed(),ai().makeVariable(this,e,t,n)},r}();Object.defineProperty(Ar,Symbol.hasInstance,{value:function(r){return!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null}});function mte(){return Ly("Tensor",function(){return Ar})}mte();var Hl=function(r){eo(e,r);function e(t,n,a,i){var o=r.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=n,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(t.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!to(t.shape,this.shape))throw new Error("shape of the new value (".concat(t.shape,") and ")+"previous value (".concat(this.shape,") must match"));ai().disposeTensor(this),this.dataId=t.dataId,ai().incRef(this,null)},e.prototype.dispose=function(){ai().disposeVariable(this),this.isDisposedInternal=!0},e}(Ar);Object.defineProperty(Hl,Symbol.hasInstance,{value:function(r){return r instanceof Ar&&r.assign!=null&&r.assign instanceof Function}});A.Rank=void 0;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(A.Rank||(A.Rank={}));var by;(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(by||(by={}));var wy;(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(wy||(wy={}));var xy;(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(xy||(xy={}));var ky;(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(ky||(ky={}));var gte={float32:xy,int32:by,bool:wy,complex64:ky};function nd(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error("Can not upcast ".concat(r," with ").concat(e))}return gte[r][e]}function yte(r){return nd(r,"int32")}function vF(r){return r!=null&&typeof r=="object"&&"texture"in r&&r.texture instanceof WebGLTexture}function mF(r){return typeof GPUBuffer<"u"&&r!=null&&typeof r=="object"&&"buffer"in r&&r.buffer instanceof GPUBuffer}function gr(r,e){if(r.dtype===e.dtype)return[r,e];var t=nd(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function gF(r,e){q(r.dtype===e.dtype,function(){return"The dtypes of the first(".concat(r.dtype,") and")+" second(".concat(e.dtype,") input must match")})}function bte(r,e){return e.some(function(t){return t.id===r.id})}function Gy(r){var e=[],t=new Set;return yF(r,e,t),e}function yF(r,e,t){if(r!=null){if(r instanceof Ar){e.push(r);return}if(!!wte(r)){var n=r;for(var a in n){var i=n[a];t.has(i)||(t.add(i),yF(i,e,t))}}}}function wte(r){return Array.isArray(r)||typeof r=="object"}var xte={__proto__:null,assertTypesMatch:gF,getTensorsInContainer:Gy,isTensorInList:bte,makeTypesMatch:gr};function sy(r){return r.kernelName!=null}var VA=function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return r.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},r}(),Hy=function(){function r(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new VA}return r.prototype.ready=function(){return je(this,void 0,void 0,function(){var e,t,n,a;return Xe(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(n)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,n=e.asyncInit;if(n)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!1,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},r.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},r.prototype.registerBackend=function(e,t,n){return n===void 0&&(n=1),e in this.registryFactory?(Do("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},r.prototype.setBackend=function(e){return je(this,void 0,void 0,function(){var t,n,a,i,o;return Xe(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '".concat(e,"' not found in registry"));return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,a=t.asyncInit,a?[4,n]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=n,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new ste(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var e=this,t=Vp(this.backendName);t.forEach(function(n){n.setupFunc!=null&&n.setupFunc(e.backendInstance)})},r.prototype.disposeRegisteredKernels=function(e){var t=this,n=Vp(e);n.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},r.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(n==null)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var a=n.factory();if(a&&!(a instanceof tD)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,Do("Initialization of backend ".concat(e," failed")),Do(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return Do("Initialization of backend ".concat(e," failed")),Do(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],a=this.initializeBackend(n),i=a.success,o=a.asyncInit;if(o||i)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),a=n.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(e,t){var n=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return n.startScope(a)},function(){return n.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},r.prototype.scopedRun=function(e,t,n){e();try{var a=n();return t(),a}catch(i){throw t(),i}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(e){var t=H.runKernel(qy,{x:e}),n={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},c={dtype:s};return H.runKernel($y,u,c)}}},i=[];return this.addTapeNode(this.state.activeScope.name,n,[t],a,i,{}),t},r.prototype.runKernel=function(e,t,n){this.backendName==null&&this.backend;var a=Wp(e,this.backendName)!=null;if(!a)throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(e,t,n){var a=this.backend.numDataIds(),i=0;n.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(s," data ids) after running '").concat(e,"'"))},r.prototype.runKernelFunc=function(e){var t=this,n,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var c,l=sy(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(sy(e)){var f=e.kernelName,h=e.inputs,p=e.attrs;this.backendName==null&&this.backend;var d=Wp(f,this.backendName);q(d!=null,function(){return"Cannot find registered kernel '".concat(f,"' for backend '").concat(t.backendName,"'")}),u=function(){var x=t.backend.numDataIds();c=d.kernelFunc({inputs:h,attrs:p,backend:t.backend});var S=Array.isArray(c)?c:[c];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,x,S);var T=S.map(function(C){return C.rank!=null?C:t.makeTensorFromTensorInfo(C)});if(i){var E=t.getTensorsForGradient(f,h,T);a=t.saveTensorsForBackwardMode(E)}return T}}else{var m=e.forwardFunc,v=function(x){!i||(a=x.map(function(S){return t.keep(t.clone(S))}))};u=function(){var x=t.backend.numDataIds();c=t.tidy(function(){return m(t.backend,v)});var S=Array.isArray(c)?c:[c];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(l,x,S),S}}var g=e.inputs,y=e.attrs,w=sy(e)?null:e.backwardsFunc,b;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?n=u():(b=t.profiler.profileKernel(l,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(b),n=b.outputs)}),i&&this.addTapeNode(l,g,n,w,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(x){return g[x]!=null?g[x].shape:null}),outputShapes:n.map(function(x){return x.shape}),kernelTimeMs:b.timeMs,extraInfo:b.extraInfo}),Array.isArray(c)?n:n[0]},r.prototype.saveTensorsForBackwardMode=function(e){var t=this,n=e.map(function(a){return t.keep(t.clone(a))});return n},r.prototype.getTensorsForGradient=function(e,t,n){var a=my(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(q(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(c){return t[c]})):s=i.map(function(c){return t[c]});var u=n.filter(function(c,l){return o[l]});return s.concat(u)}return[]},r.prototype.makeTensor=function(e,t,n,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",a=a||this.backend;var i=e;n==="string"&&_o(e[0])&&(i=e.map(function(l){return sf(l)}));var o=a.write(i,t,n),s=new Ar(t,n,o,this.nextTensorId());if(this.trackTensor(s,a),n==="string"){var u=this.state.tensorInfo.get(o),c=uD(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},r.prototype.makeTensorFromDataId=function(e,t,n,a){n=n||"float32";var i={dataId:e,shape:t,dtype:n};return this.makeTensorFromTensorInfo(i,a)},r.prototype.makeTensorFromTensorInfo=function(e,t){var n=e.dataId,a=e.shape,i=e.dtype,o=new Ar(a,i,n,this.nextTensorId());return this.trackTensor(o,t),o},r.prototype.makeVariable=function(e,t,n,a){t===void 0&&(t=!0),n=n||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new Hl(e,t,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name ".concat(i.name," was already registered"));return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},r.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*$p(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof Hl||this.track(e)},r.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},r.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},r.prototype.disposeTensor=function(e){if(!!this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var n=e.size*$p(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},r.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},r.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},r.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},r.prototype.profile=function(e){return je(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h;return Xe(this,function(p){switch(p.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=p.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,wt([],Se(this.state.activeProfile.kernels.map(function(d){return d.totalBytesSnapshot})),!1)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,p.label=2;case 2:p.trys.push([2,8,9,10]),i=fn(this.state.activeProfile.kernels),o=i.next(),p.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=p.sent(),c=s,[4,s.extraInfo];case 5:c.extraInfo=p.sent(),p.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return l=p.sent(),f={error:l},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(e,t,n,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},c=my(e);c!=null&&(a=c.gradFunc),a!=null&&(u.gradient=function(l){return l=l.map(function(f,h){if(f==null){var p=n[h],d=ed(p.size,p.dtype);return s.makeTensor(d,p.shape,p.dtype)}return f}),a(l.length>1?l:l[0],i,o)}),this.state.activeTape.push(u)},r.prototype.keep=function(e){return e.kept=!0,e},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(e){for(var t=this,n=Gy(e),a=new Set(n.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},r.prototype.gradients=function(e,t,n,a){var i=this;if(a===void 0&&(a=!1),q(t.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});q(o instanceof Ar,function(){return"The result y returned by f() must be a tensor."});var s=lte(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=n??kte(o.shape),fte(u,s,function(l){return i.tidy(l)},Ste);var c=t.map(function(l){return u[l.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(l){var f,h;try{for(var p=fn(l.saved),d=p.next();!d.done;d=p.next()){var m=d.value;m.dispose()}}catch(v){f={error:v}}finally{try{d&&!d.done&&(h=p.return)&&h.call(p)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:c}})},r.prototype.customGrad=function(e){var t=this;return q(Po(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];q(n.every(function(c){return c instanceof Ar}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};n.forEach(function(c,l){o[l]=c});var s=function(c,l){return i=e.apply(void 0,wt([],Se(wt(wt([],Se(n),!1),[l],!1)),!1)),q(i.value instanceof Ar,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),q(Po(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(c,l){var f=i.gradFunc(c,l),h=Array.isArray(f)?f:[f];q(h.length===n.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),q(h.every(function(d){return d instanceof Ar}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return h.forEach(function(d,m){p[m]=function(){return d}}),p};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},r.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},r.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},r.prototype.readToGPU=function(e,t){var n=this.state.tensorInfo.get(e);return n.backend.readToGPU(e,t)},r.prototype.time=function(e){return je(this,void 0,void 0,function(){var t,n;return Xe(this,function(a){switch(a.label){case 0:return t=Gl(),[4,this.backend.time(e)];case 1:return n=a.sent(),n.wallMs=Gl()-t,[2,n]}})})},r.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!1,configurable:!0}),r.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new VA;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r}();Hy.nextTensorId=0;Hy.nextVariableId=0;function kte(r){var e=By(Ht(r),"float32");return H.makeTensor(e,r,"float32")}function bF(){var r=pD();if(r._tfengine==null){var e=new hD(r);r._tfengine=new Hy(e)}return See(r._tfengine.ENV),dte(function(){return r._tfengine}),r._tfengine}var H=bF();function Ste(r,e){var t={a:r,b:e};return H.runKernel(zy,t)}function Nte(){return typeof navigator<"u"&&navigator!=null}var Sy;function Tte(r){Sy=r}function Ete(r){if(Sy!==void 0)return Sy;if(r||Nte()){if(r||(r=navigator),r.product==="ReactNative")return!0;var e=r.userAgent||r.vendor||(typeof window<"u"?window.opera:"");if(!e){var t=r;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function wF(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Ite={__proto__:null,isBrowser:wF,isMobile:Ete,mockIsMobile:Tte};var An=dt();An.registerFlag("DEBUG",function(){return!1},function(r){r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});An.registerFlag("IS_BROWSER",function(){return wF()});An.registerFlag("IS_NODE",function(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"});An.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)});An.registerFlag("IS_SAFARI",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)});An.registerFlag("PROD",function(){return!1});An.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return An.getBool("DEBUG")});An.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0});An.registerFlag("IS_TEST",function(){return!1});An.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",function(){return An.getBool("DEBUG")});An.registerFlag("WRAP_TO_IMAGEBITMAP",function(){return!1});An.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",function(){return!1});An.registerFlag("USE_SETTIMEOUTCUSTOM",function(){return!1});function Di(r,e){var t=r;if(Kr(r))return e==="string"?[]:[r.length];if(vF(r)){var n=r.channels||"RGBA";return[r.height,r.width*n.length]}else if(mF(r))return[r.buffer.size/(e==null?4:$p(e))];if(!Array.isArray(r))return[];for(var a=[];Array.isArray(t)||Kr(t)&&e!=="string";)a.push(t.length),t=t[0];return Array.isArray(r)&&dt().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&xF(r,a,[]),a}function xF(r,e,t){if(t=t||[],!Array.isArray(r)&&!Kr(r)){q(e.length===0,function(){return"Element arr[".concat(t.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(e[0]," elements")});return}q(e.length>0,function(){return"Element arr[".concat(t.join("]["),"] should be a primitive, ")+"but is an array of ".concat(r.length," elements")}),q(r.length===e[0],function(){return"Element arr[".concat(t.join("]["),"] should have ").concat(e[0]," ")+"elements, but has ".concat(r.length," elements")});for(var n=e.slice(1),a=0;a<r.length;++a)xF(r[a],n,t.concat(a))}function UA(r,e,t,n){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==e||r==="numeric"&&e==="string")throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must ")+"be ".concat(r," tensor, but got ").concat(e," tensor"))}}function P(r,e,t,n){if(n===void 0&&(n="numeric"),r instanceof Ar)return UA(n,r.dtype,e,t),r;var a=af(r);if(a!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(a=n),UA(n,a,e,t),r==null||!Kr(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var i=r==null?"null":r.constructor.name;throw new Error("Argument '".concat(e,"' passed to '").concat(t,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=Di(r,a);!Kr(r)&&!Array.isArray(r)&&(r=[r]);var s=!0,u=a!=="string"?rd(r,a):Mo(r,[],s);return H.makeTensor(u,o,a)}function Kl(r,e,t,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument ".concat(e," passed to ").concat(t," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=r;return a.map(function(i,o){return P(i,"".concat(e,"[").concat(o,"]"),t,n)})}var kF="__op";function U(r){var e=Object.keys(r);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(e.length," keys."));var t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+kF;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];H.startScope(t);try{var s=n.apply(void 0,wt([],Se(i),!1));return td(s)&&console.error("Cannot return a Promise inside of tidy."),H.endScope(s),s}catch(u){throw H.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function Cte(r,e){var t=P(r,"real","complex"),n=P(e,"imag","complex");bn(t.shape,n.shape,"real and imag shapes, ".concat(t.shape," and ").concat(n.shape,", ")+"must match in call to tf.complex().");var a={real:t,imag:n};return H.runKernel(MD,a)}var Bo=U({complex_:Cte});function zo(r,e,t,n){if(n==null)n=af(r);else if(n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(mF(r)||vF(r)){if(n!=="float32"&&n!=="int32")throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(n,"."));return H.backend.createTensorFromGPUData(r,e||t,n)}if(!Kr(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Kn(e);var a=Ht(e),i=Ht(t);q(a===i,function(){return"Based on the provided shape, [".concat(e,"], the tensor should have ")+"".concat(a," values but has ").concat(i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==Ht(e.slice(o)):!0;q(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(t,") does not match the provided ")+"shape (".concat(e,"). ")})}}return!Kr(r)&&!Array.isArray(r)&&(r=[r]),e=e||t,r=n!=="string"?rd(r,n):Mo(r,[],!0),H.makeTensor(r,e,n)}function Xu(r,e,t){var n=Di(r,t);return zo(r,e,n,t)}var Ny={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},$o=function(){function r(e){if(this.shards=[],this.previousShardIndex=0,e!=null&&(e instanceof Array||(e=[e]),e=e.map(function(o){return Kr(o)?o.buffer:o}),e.length!==0)){this.bufferUniformSize=e[0].byteLength;for(var t=0,n=0;n<e.length;n++){var a=e[n];n!==e.length-1&&a.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);var i=t+a.byteLength;this.shards.push({buffer:a,start:t,end:i}),t=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}}return r.join=function(e){return new r(e).slice()},r.prototype.slice=function(e,t){if(e===void 0&&(e=0),t===void 0&&(t=this.byteLength),this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);var n=this.findShardForByte(e);if(n===-1)throw new Error("Could not find start shard for byte ".concat(e));for(var a=t-e,i=new ArrayBuffer(a),o=new Uint8Array(i),s=0,u=n;u<this.shards.length;u++){var c=this.shards[u],l=e+s,f=l-c.start,h=s,p=Math.min(t,c.end),d=p-c.start,m=new Uint8Array(c.buffer,f,d-f);if(o.set(m,h),s+=m.length,t<c.end)break}return i},r.prototype.findShardForByte=function(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(a){return e<a.start?-1:e>=a.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;var n=Ate(this.shards,t);return n===-1?-1:(this.previousShardIndex=n,this.previousShardIndex)},r}();function Ate(r,e){for(var t=0,n=r.length;t<=n;){var a=Math.floor((n-t)/2)+t,i=e(r[a]);if(i===0)return a;i<0?n=a:t=a+1}return-1}var Kp=4;function Dte(r,e){return je(this,void 0,void 0,function(){var t,n,a,i,o,s,u=this;return Xe(this,function(c){switch(c.label){case 0:for(t=[],n=[],a=Array.isArray(r)?r.map(function(l){return l.name}):Object.keys(r),i=function(l){var f=a[l],h=Array.isArray(r)?r[l].tensor:r[f];if(h.dtype!=="float32"&&h.dtype!=="int32"&&h.dtype!=="bool"&&h.dtype!=="string"&&h.dtype!=="complex64")throw new Error("Unsupported dtype in weight '".concat(f,"': ").concat(h.dtype));var p={name:f,shape:h.shape,dtype:h.dtype};if(h.dtype==="string"){var d=new Promise(function(m){return je(u,void 0,void 0,function(){var v,g,y,w,b,x,S;return Xe(this,function(T){switch(T.label){case 0:return[4,h.bytes()];case 1:for(v=T.sent(),g=v.reduce(function(E,C){return E+C.length},0)+Kp*v.length,y=new Uint8Array(g),w=0,b=0;b<v.length;b++)x=v[b],S=new Uint8Array(new Uint32Array([x.length]).buffer),y.set(S,w),w+=Kp,y.set(x,w),w+=x.length;return m(y),[2]}})})});n.push(d)}else n.push(h.data());e!=null&&(p.group=e),t.push(p)},o=0;o<a.length;++o)i(o);return[4,Promise.all(n)];case 1:return s=c.sent(),[2,{data:_te(s),specs:t}]}})})}function SF(r,e){var t,n,a=new $o(r),i={},o,s=0;try{for(var u=fn(e),c=u.next();!c.done;c=u.next()){var l=c.value,f=l.name,h=l.dtype,p=l.shape,d=Ht(p),m=void 0;if("quantization"in l){var v=l.quantization;if(v.dtype==="uint8"||v.dtype==="uint16"){if(!("min"in v&&"scale"in v))throw new Error("Weight ".concat(l.name," with quantization ").concat(v.dtype," ")+"doesn't have corresponding metadata min and scale.")}else if(v.dtype==="float16"){if(h!=="float32")throw new Error("Weight ".concat(l.name," is quantized with ").concat(v.dtype," ")+"which only supports weights of type float32 not ".concat(h,"."))}else throw new Error("Weight ".concat(l.name," has unknown ")+"quantization dtype ".concat(v.dtype,". ")+"Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.");var g=Ny[v.dtype],y=a.slice(s,s+d*g),w=v.dtype==="uint8"?new Uint8Array(y):new Uint16Array(y);if(h==="float32")if(v.dtype==="uint8"||v.dtype==="uint16"){m=new Float32Array(w.length);for(var b=0;b<w.length;b++){var x=w[b];m[b]=x*v.scale+v.min}}else if(v.dtype==="float16")o===void 0&&(o=Lte()),m=o(w);else throw new Error("Unsupported quantization type ".concat(v.dtype," ")+"for weight type float32.");else if(h==="int32"){if(v.dtype!=="uint8"&&v.dtype!=="uint16")throw new Error("Unsupported quantization type ".concat(v.dtype," ")+"for weight type int32.");m=new Int32Array(w.length);for(var b=0;b<w.length;b++){var x=w[b];m[b]=Math.round(x*v.scale+v.min)}}else throw new Error("Unsupported dtype in weight '".concat(f,"': ").concat(h));s+=d*g}else if(h==="string"){var S=Ht(l.shape);m=[];for(var b=0;b<S;b++){var T=new Uint32Array(a.slice(s,s+Kp))[0];s+=Kp;var E=new Uint8Array(a.slice(s,s+T));m.push(E),s+=T}}else{var C=Ny[h],y=a.slice(s,s+d*C);if(h==="float32")m=new Float32Array(y);else if(h==="int32")m=new Int32Array(y);else if(h==="bool")m=new Uint8Array(y);else if(h==="complex64"){m=new Float32Array(y);for(var R=new Float32Array(m.length/2),_=new Float32Array(m.length/2),b=0;b<R.length;b++)R[b]=m[b*2],_[b]=m[b*2+1];var O=Xu(R,p,"float32"),$=Xu(_,p,"float32");i[f]=Bo(O,$),O.dispose(),$.dispose()}else throw new Error("Unsupported dtype in weight '".concat(f,"': ").concat(h));s+=d*C}h!=="complex64"&&(i[f]=Xu(m,p,h))}}catch(z){t={error:z}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}return i}function _te(r){if(r===null)throw new Error("Invalid input value: ".concat(JSON.stringify(r)));var e=0,t=[];r.forEach(function(i){if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(i.constructor.name))});var n=new Uint8Array(e),a=0;return t.forEach(function(i){n.set(new Uint8Array(i.buffer),a),a+=i.byteLength}),n.buffer}var Ky=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function GA(r){return Ky?Buffer.byteLength(r,"utf8"):new Blob([r]).size}function Fte(r){if(Ky)return Buffer.from(r).toString("base64");for(var e=new Uint8Array(r),t="",n=0,a=e.length;n<a;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function Rte(r){if(Ky){var e=Buffer.from(r,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var t=atob(r),n=new Uint8Array(t.length),a=0;a<t.length;++a)n.set([t.charCodeAt(a)],a);return n.buffer}function Ote(r){return $o.join(r)}function HA(r){var e="/";for(r=r.trim();r.endsWith(e);)r=r.slice(0,r.length-1);var t=r.split(e);return t[t.length-1]}function NF(r,e){var t={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy,weightsManifest:e};return r.signature!=null&&(t.signature=r.signature),r.userDefinedMetadata!=null&&(t.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(t.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(t.initializerSignature=r.initializerSignature),r.trainingConfig!=null&&(t.trainingConfig=r.trainingConfig),t}function TF(r,e,t){var n={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy};if(r.trainingConfig!=null&&(n.trainingConfig=r.trainingConfig),r.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");n.weightSpecs=e,n.weightData=t}return r.signature!=null&&(n.signature=r.signature),r.userDefinedMetadata!=null&&(n.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(n.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(n.initializerSignature=r.initializerSignature),n}function jy(r,e){return je(this,void 0,void 0,function(){var t,n,a;return Xe(this,function(i){switch(i.label){case 0:return r.weightsManifest==null?[3,2]:[4,e(r.weightsManifest)];case 1:a=Se.apply(void 0,[i.sent(),2]),t=a[0],n=a[1],i.label=2;case 2:return[2,TF(r,t,n)]}})})}function uf(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:GA(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:GA(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:new $o(r.weightData).byteLength}}function EF(r){var e,t,n=[];try{for(var a=fn(r),i=a.next();!i.done;i=a.next()){var o=i.value;n.push.apply(n,wt([],Se(o.weights),!1))}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}function Pte(){var r=function(n){for(var a=n<<13,i=0;(a&8388608)===0;)i-=8388608,a<<=1;return a&=-8388609,i+=947912704,a|i},e=new Uint32Array(2048);e[0]=0;for(var t=1;t<1024;t++)e[t]=r(t);for(var t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function Mte(){var r=new Uint32Array(64);r[0]=0,r[31]=1199570944,r[32]=2147483648,r[63]=3347054592;for(var e=1;e<31;e++)r[e]=e<<23;for(var e=33;e<63;e++)r[e]=2147483648+(e-32<<23);return r}function Bte(){for(var r=new Uint32Array(64),e=0;e<64;e++)r[e]=1024;return r[0]=r[32]=0,r}function Lte(){var r=Pte(),e=Mte(),t=Bte();return function(n){for(var a=new ArrayBuffer(4*n.length),i=new Uint32Array(a),o=0;o<n.length;o++){var s=n[o],u=r[t[s>>10]+(s&1023)]+e[s>>10];i[o]=u}return new Float32Array(a)}}var va=function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerSaveRouter=function(e){r.getInstance().saveRouters.push(e)},r.registerLoadRouter=function(e){r.getInstance().loadRouters.push(e)},r.getSaveHandlers=function(e){return r.getHandlers(e,"save")},r.getLoadHandlers=function(e,t){return r.getHandlers(e,"load",t)},r.getHandlers=function(e,t,n){var a=[],i=t==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters;return i.forEach(function(o){var s=o(e,n);s!==null&&a.push(s)}),a},r}(),zte=function(r){return va.registerSaveRouter(r)},$te=function(r){return va.registerLoadRouter(r)},qte=function(r){return va.getSaveHandlers(r)},Wte=function(r,e){return va.getLoadHandlers(r,e)},Ty="tensorflowjs",Ey=1,xs="models_store",Fo="model_info_store";function IF(){if(!dt().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=typeof window>"u"?self:window,e=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Iy(r){var e=r.result;e.createObjectStore(xs,{keyPath:"modelPath"}),e.createObjectStore(Fo,{keyPath:"modelPath"})}var Ns=function(){function r(e){if(this.indexedDB=IF(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return r.prototype.save=function(e){return je(this,void 0,void 0,function(){return Xe(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},r.prototype.load=function(){return je(this,void 0,void 0,function(){return Xe(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},r.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(a,i){var o=n.indexedDB.open(Ty,Ey);o.onupgradeneeded=function(){return Iy(o)},o.onsuccess=function(){var s=o.result;if(t==null){var u=s.transaction(xs,"readonly"),c=u.objectStore(xs),l=c.get(n.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),i(new Error("Cannot find model with path '".concat(n.modelPath,"' ")+"in IndexedDB."));a(l.result.modelArtifacts)},l.onerror=function(v){return s.close(),i(l.error)},u.oncomplete=function(){return s.close()}}else{var f=uf(t),h=s.transaction(Fo,"readwrite"),p=h.objectStore(Fo),d;try{d=p.put({modelPath:n.modelPath,modelArtifactsInfo:f})}catch(v){return i(v)}var m;d.onsuccess=function(){m=s.transaction(xs,"readwrite");var v=m.objectStore(xs),g;try{g=v.put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:f})}catch(y){return i(y)}g.onsuccess=function(){return a({modelArtifactsInfo:f})},g.onerror=function(y){p=h.objectStore(Fo);var w=p.delete(n.modelPath);w.onsuccess=function(){return s.close(),i(g.error)},w.onerror=function(b){return s.close(),i(g.error)}}},d.onerror=function(v){return s.close(),i(d.error)},h.oncomplete=function(){m==null?s.close():m.oncomplete=function(){return s.close()}}}},o.onerror=function(s){return i(o.error)}})},r}();Ns.URL_SCHEME="indexeddb://";var CF=function(r){return dt().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Ns.URL_SCHEME)?Vte(r.slice(Ns.URL_SCHEME.length)):null};va.registerSaveRouter(CF);va.registerLoadRouter(CF);function Vte(r){return new Ns(r)}function Ute(r){return r.startsWith(Ns.URL_SCHEME)?r.slice(Ns.URL_SCHEME.length):r}var Gte=function(){function r(){this.indexedDB=IF()}return r.prototype.listModels=function(){return je(this,void 0,void 0,function(){var e=this;return Xe(this,function(t){return[2,new Promise(function(n,a){var i=e.indexedDB.open(Ty,Ey);i.onupgradeneeded=function(){return Iy(i)},i.onsuccess=function(){var o=i.result,s=o.transaction(Fo,"readonly"),u=s.objectStore(Fo),c=u.getAll();c.onsuccess=function(){var l,f,h={};try{for(var p=fn(c.result),d=p.next();!d.done;d=p.next()){var m=d.value;h[m.modelPath]=m.modelArtifactsInfo}}catch(v){l={error:v}}finally{try{d&&!d.done&&(f=p.return)&&f.call(p)}finally{if(l)throw l.error}}n(h)},c.onerror=function(l){return o.close(),a(c.error)},s.oncomplete=function(){return o.close()}},i.onerror=function(o){return a(i.error)}})]})})},r.prototype.removeModel=function(e){return je(this,void 0,void 0,function(){var t=this;return Xe(this,function(n){return e=Ute(e),[2,new Promise(function(a,i){var o=t.indexedDB.open(Ty,Ey);o.onupgradeneeded=function(){return Iy(o)},o.onsuccess=function(){var s=o.result,u=s.transaction(Fo,"readwrite"),c=u.objectStore(Fo),l=c.get(e),f;l.onsuccess=function(){if(l.result==null)return s.close(),i(new Error("Cannot find model with path '".concat(e,"' ")+"in IndexedDB."));var h=c.delete(e),p=function(){f=s.transaction(xs,"readwrite");var d=f.objectStore(xs),m=d.delete(e);m.onsuccess=function(){return a(l.result.modelArtifactsInfo)},m.onerror=function(v){return i(l.error)}};h.onsuccess=p,h.onerror=function(d){return p(),s.close(),i(l.error)}},l.onerror=function(h){return s.close(),i(l.error)},u.oncomplete=function(){f==null?s.close():f.oncomplete=function(){return s.close()}}},o.onerror=function(s){return i(o.error)}})]})})},r}(),Zi="/",Hu="tensorflowjs_models",AF="info",Hte="model_topology",Kte="weight_specs",jte="weight_data",Xte="model_metadata";function DF(r){return{info:[Hu,r,AF].join(Zi),topology:[Hu,r,Hte].join(Zi),weightSpecs:[Hu,r,Kte].join(Zi),weightData:[Hu,r,jte].join(Zi),modelMetadata:[Hu,r,Xte].join(Zi)}}function _F(r){var e,t;try{for(var n=fn(Object.values(r)),a=n.next();!a.done;a=n.next()){var i=a.value;window.localStorage.removeItem(i)}}catch(o){e={error:o}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}}function Yte(r){var e=r.split(Zi);if(e.length<3)throw new Error("Invalid key format: ".concat(r));return e.slice(1,e.length-1).join(Zi)}function Zte(r){return r.startsWith(Ts.URL_SCHEME)?r.slice(Ts.URL_SCHEME.length):r}var Ts=function(){function r(e){if(!dt().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=DF(this.modelPath)}return r.prototype.save=function(e){return je(this,void 0,void 0,function(){var t,n,a,i,o;return Xe(this,function(s){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),a=uf(e),i=$o.join(e.weightData);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,Fte(i)),o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),[2,{modelArtifactsInfo:a}]}catch{throw _F(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."))}return[2]})})},r.prototype.load=function(){return je(this,void 0,void 0,function(){var e,t,n,a,i,o,s;return Xe(this,function(u){if(e=JSON.parse(this.LS.getItem(this.keys.info)),e==null)throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},n=JSON.parse(this.LS.getItem(this.keys.topology)),n==null)throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");if(t.modelTopology=n,a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)),a==null)throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");if(t.weightSpecs=a,i=this.LS.getItem(this.keys.modelMetadata),i!=null&&(o=JSON.parse(i),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,o.signature!=null&&(t.signature=o.signature),o.userDefinedMetadata!=null&&(t.userDefinedMetadata=o.userDefinedMetadata),o.modelInitializer!=null&&(t.modelInitializer=o.modelInitializer),o.initializerSignature!=null&&(t.initializerSignature=o.initializerSignature),o.trainingConfig!=null&&(t.trainingConfig=o.trainingConfig)),s=this.LS.getItem(this.keys.weightData),s==null)throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));return t.weightData=Rte(s),[2,t]})})},r}();Ts.URL_SCHEME="localstorage://";var FF=function(r){return dt().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Ts.URL_SCHEME)?Jte(r.slice(Ts.URL_SCHEME.length)):null};va.registerSaveRouter(FF);va.registerLoadRouter(FF);function Jte(r){return new Ts(r)}var Qte=function(){function r(){q(dt().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),q(typeof window>"u"||typeof window.localStorage<"u",function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return r.prototype.listModels=function(){return je(this,void 0,void 0,function(){var e,t,n,a,i,o;return Xe(this,function(s){for(e={},t=Hu+Zi,n=Zi+AF,a=0;a<this.LS.length;++a)i=this.LS.key(a),i.startsWith(t)&&i.endsWith(n)&&(o=Yte(i),e[o]=JSON.parse(this.LS.getItem(i)));return[2,e]})})},r.prototype.removeModel=function(e){return je(this,void 0,void 0,function(){var t,n;return Xe(this,function(a){if(e=Zte(e),t=DF(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '".concat(e,"'"));return n=JSON.parse(this.LS.getItem(t.info)),_F(t),[2,n]})})},r}(),Yu="://",Lo=function(){function r(){this.managers={}}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerManager=function(e,t){q(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(Yu)&&(e=e.slice(0,e.indexOf(Yu))),q(e.length>0,function(){return"scheme must not be an empty string."});var n=r.getInstance();q(n.managers[e]==null,function(){return"A model store manager is already registered for scheme '".concat(e,"'.")}),n.managers[e]=t},r.getManager=function(e){var t=r.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '".concat(e,"'"));return t},r.getSchemes=function(){return Object.keys(r.getInstance().managers)},r}();function Bp(r){if(r.indexOf(Yu)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+"".concat(Lo.getSchemes().join(",")));return{scheme:r.split(Yu)[0],path:r.split(Yu)[1]}}function RF(r,e,t){return t===void 0&&(t=!1),je(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f;return Xe(this,function(h){switch(h.label){case 0:return q(r!==e,function(){return"Old path and new path are the same: '".concat(r,"'")}),n=va.getLoadHandlers(r),q(n.length>0,function(){return"Copying failed because no load handler is found for source URL ".concat(r,".")}),q(n.length<2,function(){return"Copying failed because more than one (".concat(n.length,") ")+"load handlers for source URL ".concat(r,".")}),a=n[0],i=va.getSaveHandlers(e),q(i.length>0,function(){return"Copying failed because no save handler is found for destination "+"URL ".concat(e,".")}),q(i.length<2,function(){return"Copying failed because more than one (".concat(n.length,") ")+"save handlers for destination URL ".concat(e,".")}),o=i[0],s=Bp(r).scheme,u=Bp(r).path,c=s===Bp(r).scheme,[4,a.load()];case 1:return l=h.sent(),t&&c?[4,Lo.getManager(s).removeModel(u)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[4,o.save(l)];case 4:return f=h.sent(),t&&!c?[4,Lo.getManager(s).removeModel(u)]:[3,6];case 5:h.sent(),h.label=6;case 6:return[2,f.modelArtifactsInfo]}})})}function ere(){return je(this,void 0,void 0,function(){var r,e,t,n,a,i,o,s,u,c,l;return Xe(this,function(f){switch(f.label){case 0:r=Lo.getSchemes(),e={},f.label=1;case 1:f.trys.push([1,6,7,8]),t=fn(r),n=t.next(),f.label=2;case 2:return n.done?[3,5]:(a=n.value,[4,Lo.getManager(a).listModels()]);case 3:i=f.sent();for(o in i)s=a+Yu+o,e[s]=i[o];f.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return u=f.sent(),c={error:u},[3,8];case 7:try{n&&!n.done&&(l=t.return)&&l.call(t)}finally{if(c)throw c.error}return[7];case 8:return[2,e]}})})}function tre(r){return je(this,void 0,void 0,function(){var e,t;return Xe(this,function(n){return e=Bp(r),t=Lo.getManager(e.scheme),[2,t.removeModel(e.path)]})})}function rre(r,e){return je(this,void 0,void 0,function(){var t;return Xe(this,function(n){return t=!1,[2,RF(r,e,t)]})})}function nre(r,e){return je(this,void 0,void 0,function(){var t;return Xe(this,function(n){return t=!0,[2,RF(r,e,t)]})})}var are=function(){function r(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}return r.prototype.fetch=function(e,t){return fetch(e,t)},r.prototype.now=function(){return performance.now()},r.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},r.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},r.prototype.setTimeoutCustom=function(e,t){var n=this;if(typeof window>"u"||!dt().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(function(){window.postMessage({name:n.messageName,index:n.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",function(a){if(a.source===window&&a.data.name===n.messageName){a.stopPropagation();var i=n.functionRefs[a.data.index];i(),n.handledMessageCount++,n.handledMessageCount===n.functionRefs.length&&(n.functionRefs=[],n.handledMessageCount=0)}},!0))},r.prototype.isTypedArray=function(e){return iF(e)},r}();if(dt().get("IS_BROWSER")){dt().setPlatform("browser",new are);try{Lo.registerManager(Ts.URL_SCHEME,new Qte)}catch{}try{Lo.registerManager(Ns.URL_SCHEME,new Gte)}catch{}}var ire={importFetch:function(){return RA()}},uy,ore=function(){function r(){this.util=OA(),this.textEncoder=new this.util.TextEncoder}return r.prototype.fetch=function(e,t){return dt().global.fetch!=null?dt().global.fetch(e,t):(uy==null&&(uy=ire.importFetch()),uy(e,t))},r.prototype.now=function(){var e=process.hrtime();return e[0]*1e3+e[1]/1e6},r.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)},r.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},r.prototype.isTypedArray=function(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)},r}();dt().get("IS_NODE")&&!dt().get("IS_BROWSER")&&dt().setPlatform("node",new ore);function Ji(r,e,t){return e===void 0&&(e="float32"),e=e||"float32",Kn(r),new Hp(r,e,t)}function sre(r,e){var t=P(r,"x","cast");if(!sD(e))throw new Error("Failed to cast to unknown dtype ".concat(e));if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var n={x:t},a={dtype:e};return H.runKernel($y,n,a)}var mr=U({cast_:sre});function ure(r){var e=P(r,"x","clone","string_or_numeric"),t={x:e};return H.runKernel(qy,t)}var Ss=U({clone_:ure});function OF(r,e){e===void 0&&(e=!1),console.log(r.toString(e))}bF();var cre={buffer:Ji,cast:mr,clone:Ss,print:OF};vte(cre);function lre(){dt().set("PROD",!0)}function fre(){dt().set("DEBUG",!0)}function hre(){dt().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function pre(r){dt().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function dre(){H.disposeVariables()}function vre(){return H}function mre(){return H.memory()}function gre(r){return H.profile(r)}function Mr(r,e){return H.tidy(r,e)}function Cn(r){var e=Gy(r);e.forEach(function(t){return t.dispose()})}function PF(r){return H.keep(r)}function yre(r){return H.time(r)}function bre(r){return H.setBackend(r)}function wre(){return H.ready()}function xre(){return H.backendName}function kre(r){H.removeBackend(r)}function Sre(r){return H.findBackend(r)}function Nre(r){return H.findBackendFactory(r)}function Tre(r,e,t){return t===void 0&&(t=1),H.registerBackend(r,e,t)}function Ere(){return H.backend}function Ire(r,e){dt().setPlatform(r,e)}function Cre(r,e){var t,n=P(r,"a","add"),a=P(e,"b","add");t=Se(gr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return H.runKernel(zy,i)}var ct=U({add_:Cre});function Are(r,e){var t,n=P(r,"a","floorDiv"),a=P(e,"b","floorDiv");t=Se(gr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return H.runKernel(v_,i)}var MF=U({floorDiv_:Are});function Dre(r,e){var t,n=P(r,"a","div"),a=P(e,"b","div");if(t=Se(gr(n,a),2),n=t[0],a=t[1],n.dtype==="int32"&&a.dtype==="int32")return MF(n,a);var i={a:n,b:a},o={};return H.runKernel(n_,i,o)}var Gt=U({div_:Dre});function _re(r,e){var t,n=P(r,"a","mul"),a=P(e,"b","mul");t=Se(gr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return H.runKernel(K_,i)}var Me=U({mul_:_re});function Fre(r){var e=P(r,"x","abs");if(e.dtype==="complex64"){var t={x:e};return H.runKernel(BD,t)}else{var t={x:e};return H.runKernel(dD,t)}}var pa=U({abs_:Fre});function Rre(r){var e=P(r,"x","acos"),t={x:e};return H.runKernel(vD,t)}var Ore=U({acos_:Rre});function Pre(r){var e=P(r,"x","acosh"),t={x:e};return H.runKernel(mD,t)}var Mre=U({acosh_:Pre});function Bre(r){q(Array.isArray(r),function(){return"The argument passed to tf.addN() must be a list of tensors"}),q(r.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+"".concat(r.length)});var e=r.map(function(a,i){return P(a,"tensors".concat(i),"addN")}),t=e[0];e.forEach(function(a){if(a.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(a){if(!to(a.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var n=e;return H.runKernel(gD,n)}var Lre=U({addN_:Bre});function zre(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=P(r,"x","all","bool"),a={x:n},i={axis:e,keepDims:t};return H.runKernel(yD,a,i)}var $re=U({all_:zre});function qre(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=P(r,"x","any","bool"),a={x:n},i={axis:e,keepDims:t};return H.runKernel(bD,a,i)}var Wre=U({any_:qre});function Vre(r,e){e===void 0&&(e=0);var t=P(r,"x","argMax"),n={x:t},a={axis:e};return H.runKernel(wD,n,a)}var Ure=U({argMax_:Vre});function Gre(r,e){e===void 0&&(e=0);var t=P(r,"x","argMin"),n={x:t},a={axis:e};return H.runKernel(xD,n,a)}var Hre=U({argMin_:Gre});function Kre(r){var e=P(r,"x","asin"),t={x:e};return H.runKernel(kD,t)}var jre=U({asin_:Kre});function Xre(r){var e=P(r,"x","asinh"),t={x:e};return H.runKernel(SD,t)}var Yre=U({asinh_:Xre});function Zre(r){var e=P(r,"x","atan"),t={x:e};return H.runKernel(ND,t)}var Jre=U({atan_:Zre});function Qre(r,e){var t,n=P(r,"a","atan2"),a=P(e,"b","atan2");t=Se(gr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return H.runKernel(ED,i)}var ene=U({atan2_:Qre});function tne(r){var e=P(r,"x","atanh"),t={x:e};return H.runKernel(TD,t)}var rne=U({atanh_:tne});function nne(r,e,t,n,a,i){a===void 0&&(a="NHWC");var o=r[3],s=wt(wt([],Se(e),!1),[o],!1),u=zF(a);return cf(r,s,t,i,n,null,null,u)}function BF(r,e,t,n,a,i,o){o===void 0&&(o="channelsLast");var s=Se(jl(e),2),u=s[0],c=s[1],l;if(o==="channelsLast")l=[u,c,r[3],r[3]];else if(o==="channelsFirst")l=[u,c,r[1],r[1]];else throw new Error("Unknown dataFormat ".concat(o));return cf(r,l,t,n,a,i,!1,o)}function ane(r,e,t,n,a,i,o){o===void 0&&(o="NDHWC");var s=Se(Cy(e),3),u=s[0],c=s[1],l=s[2],f,h;if(o==="NDHWC")h="channelsLast",f=[u,c,l,r[4],r[4]];else if(o==="NCDHW")h="channelsFirst",f=[u,c,l,r[1],r[1]];else throw new Error("Unknown dataFormat ".concat(o));return LF(r,f,t,n,a,!1,h,i)}function cf(r,e,t,n,a,i,o,s){var u,c;o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var l=Se([-1,-1,-1,-1],4),f=l[0],h=l[1],p=l[2],d=l[3];if(s==="channelsLast")u=Se(r,4),f=u[0],h=u[1],p=u[2],d=u[3];else if(s==="channelsFirst")c=Se(r,4),f=c[0],d=c[1],h=c[2],p=c[3];else throw new Error("Unknown dataFormat ".concat(s));var m=Se(e,4),v=m[0],g=m[1],y=m[3],w=Se(jl(t),2),b=w[0],x=w[1],S=Se(jl(n),2),T=S[0],E=S[1],C=Zu(v,T),R=Zu(g,E),_=sne(a,h,p,b,x,C,R,i,s),O=_.padInfo,$=_.outHeight,z=_.outWidth,L=o?y*d:y,B;return s==="channelsFirst"?B=[f,L,$,z]:s==="channelsLast"&&(B=[f,$,z,L]),{batchSize:f,dataFormat:s,inHeight:h,inWidth:p,inChannels:d,outHeight:$,outWidth:z,outChannels:L,padInfo:O,strideHeight:b,strideWidth:x,filterHeight:v,filterWidth:g,effectiveFilterHeight:C,effectiveFilterWidth:R,dilationHeight:T,dilationWidth:E,inShape:r,outShape:B,filterShape:e}}function LF(r,e,t,n,a,i,o,s){var u,c;i===void 0&&(i=!1),o===void 0&&(o="channelsLast");var l=Se([-1,-1,-1,-1,-1],5),f=l[0],h=l[1],p=l[2],d=l[3],m=l[4];if(o==="channelsLast")u=Se(r,5),f=u[0],h=u[1],p=u[2],d=u[3],m=u[4];else if(o==="channelsFirst")c=Se(r,5),f=c[0],m=c[1],h=c[2],p=c[3],d=c[4];else throw new Error("Unknown dataFormat ".concat(o));var v=Se(e,5),g=v[0],y=v[1],w=v[2],b=v[4],x=Se(Cy(t),3),S=x[0],T=x[1],E=x[2],C=Se(Cy(n),3),R=C[0],_=C[1],O=C[2],$=Zu(g,R),z=Zu(y,_),L=Zu(w,O),B=une(a,h,p,d,S,T,E,$,z,L,s),W=B.padInfo,X=B.outDepth,J=B.outHeight,V=B.outWidth,j=i?b*m:b,ne;return o==="channelsFirst"?ne=[f,j,X,J,V]:o==="channelsLast"&&(ne=[f,X,J,V,j]),{batchSize:f,dataFormat:o,inDepth:h,inHeight:p,inWidth:d,inChannels:m,outDepth:X,outHeight:J,outWidth:V,outChannels:j,padInfo:W,strideDepth:S,strideHeight:T,strideWidth:E,filterDepth:g,filterHeight:y,filterWidth:w,effectiveFilterDepth:$,effectiveFilterHeight:z,effectiveFilterWidth:L,dilationDepth:R,dilationHeight:_,dilationWidth:O,inShape:r,outShape:ne,filterShape:e}}function ine(r,e,t,n,a){n==null&&(n=Xy(r,e,t));var i=r[0],o=r[1],s=Xl((i-e+2*n)/t+1,a),u=Xl((o-e+2*n)/t+1,a);return[s,u]}function one(r,e,t,n,a,i){a==null&&(a=Xy(r,e[0],n[0]));for(var o=[0,0,0,t],s=0;s<3;s++)r[s]+2*a>=e[s]&&(o[s]=Xl((r[s]-e[s]+2*a)/n[s]+1,i));return o}function Xy(r,e,t,n){n===void 0&&(n=1);var a=Zu(e,n);return Math.floor((r[0]*(t-1)-t+a)/2)}function jl(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function Cy(r){return typeof r=="number"?[r,r,r]:r}function Zu(r,e){return e<=1?r:r+(r-1)*(e-1)}function sne(r,e,t,n,a,i,o,s,u){var c,l,f;if(typeof r=="number"){var h=r===0?"VALID":"NUMBER";c={top:r,bottom:r,left:r,right:r,type:h};var p=ine([e,t],i,n,r,s);l=p[0],f=p[1]}else if(r==="same"){l=Math.ceil(e/n),f=Math.ceil(t/a);var d=Math.max(0,(l-1)*n+i-e),m=Math.max(0,(f-1)*a+o-t),v=Math.floor(d/2),g=d-v,y=Math.floor(m/2),w=m-y;c={top:v,bottom:g,left:y,right:w,type:"SAME"}}else if(r==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-i+1)/n),f=Math.ceil((t-o+1)/a);else if(typeof r=="object"){var v=u==="channelsLast"?r[1][0]:r[2][0],g=u==="channelsLast"?r[1][1]:r[2][1],y=u==="channelsLast"?r[2][0]:r[3][0],w=u==="channelsLast"?r[2][1]:r[3][1],h=v===0&&g===0&&y===0&&w===0?"VALID":"EXPLICIT";c={top:v,bottom:g,left:y,right:w,type:h},l=Xl((e-i+v+g)/n+1,s),f=Xl((t-o+y+w)/a+1,s)}else throw Error("Unknown padding parameter: ".concat(r));return{padInfo:c,outHeight:l,outWidth:f}}function une(r,e,t,n,a,i,o,s,u,c,l){var f,h,p,d;if(r==="valid"&&(r=0),typeof r=="number"){var m=r===0?"VALID":"NUMBER";f={top:r,bottom:r,left:r,right:r,front:r,back:r,type:m};var v=one([e,t,n,1],[s,u,c],1,[a,i,o],r,l);h=v[0],p=v[1],d=v[2]}else if(r==="same"){h=Math.ceil(e/a),p=Math.ceil(t/i),d=Math.ceil(n/o);var g=(h-1)*a+s-e,y=(p-1)*i+u-t,w=(d-1)*o+c-n,b=Math.floor(g/2),x=g-b,S=Math.floor(y/2),T=y-S,E=Math.floor(w/2),C=w-E;f={top:S,bottom:T,left:E,right:C,front:b,back:x,type:"SAME"}}else throw Error("Unknown padding parameter: ".concat(r));return{padInfo:f,outDepth:h,outHeight:p,outWidth:d}}function Xl(r,e){if(!e)return Math.trunc(r);switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode ".concat(e))}}function Yl(r){var e=Se(jl(r),3),t=e[0],n=e[1],a=e[2];return t===1&&n===1&&a===1}function ro(r,e){return Yl(r)||Yl(e)}function Es(r){return jl(r).every(function(e){return e>0})}function zF(r){if(r==="NHWC")return"channelsLast";if(r==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat ".concat(r))}function _a(r,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,"."));if(typeof e=="number")q(ec(e),function(){return"Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,".")});else if(typeof e=="object")e.forEach(function(n){n.forEach(function(a){q(ec(a),function(){return"Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(a,".")})})});else throw Error("Error in ".concat(r,": Unknown padding parameter: ").concat(e))}}function cne(r,e){var t=P(r,"x","reshape","string_or_numeric"),n={x:t},a={shape:e};return H.runKernel(p3,n,a)}var me=U({reshape_:cne});function lne(r,e,t,n,a){var i=P(r,"x","avgPool","float32"),o=1;q(ro(t,o),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")});var s=i,u=!1;i.rank===3&&(u=!0,s=me(i,[1,i.shape[0],i.shape[1],i.shape[2]])),q(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(s.rank,".")}),_a("avgPool",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=H.runKernel(ID,c,l);return f=mr(f,i.dtype),u?me(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var $F=U({avgPool_:lne});function fne(r,e,t,n,a,i){i===void 0&&(i="NDHWC");var o=P(r,"x","avgPool3d","float32"),s=o,u=!1;o.rank===4&&(u=!0,s=me(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),q(s.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),q(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),q(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,function(){return"Error in avgPool3d: Stride must be > 0, but got '".concat(t,"'")}),_a("avgPool3d",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=H.runKernel(CD,c,l);return f=mr(f,s.dtype),u?me(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var hne=U({avgPool3d_:fne});function pne(r,e){e===void 0&&(e=0),q(r.length>=1,function(){return"Pass at least one tensor to concat"});var t=Kl(r,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `.concat(i.dtype,". "))}),t.length===1)return Ss(t[0]);var n=t,a={axis:e};return H.runKernel(LD,n,a)}var Hn=U({concat_:pne});function dne(r,e,t,n){var a;t===void 0&&(t=!1),n===void 0&&(n=!1);var i=P(r,"a","matMul"),o=P(e,"b","matMul");a=Se(gr(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:n};return H.runKernel(AD,s,u)}var Rt=U({matMul_:dne});function vne(r){var e=P(r,"x","sigmoid","float32"),t={x:e};return H.runKernel(A3,t)}var Ju=U({sigmoid_:vne});function mne(r,e,t){var n=P(r,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");var a={x:n},i={begin:e,size:t};return H.runKernel(T3,a,i)}var sr=U({slice_:mne});function gne(r){var e=P(r,"x","tanh","float32"),t={x:e};return H.runKernel(X3,t)}var Ay=U({tanh_:gne});function yne(r,e,t,n,a,i){var o=P(r,"forgetBias","basicLSTMCell"),s=P(e,"lstmKernel","basicLSTMCell"),u=P(t,"lstmBias","basicLSTMCell"),c=P(n,"data","basicLSTMCell"),l=P(a,"c","basicLSTMCell"),f=P(i,"h","basicLSTMCell"),h=Hn([c,f],1),p=Rt(h,s),d=ct(p,u),m=d.shape[0],v=d.shape[1]/4,g=[m,v],y=sr(d,[0,0],g),w=sr(d,[0,v],g),b=sr(d,[0,v*2],g),x=sr(d,[0,v*3],g),S=ct(Me(Ju(y),Ay(w)),Me(l,Ju(ct(o,b)))),T=Me(Ay(S),Ju(x));return[S,T]}var bne=U({basicLSTMCell_:yne});function wne(r,e,t){var n=P(r,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});q(n.rank>=1+e.length,function(){return"input rank is ".concat(n.rank," but should be > than blockShape.length ").concat(e.length)}),q(t.length===e.length,function(){return"crops.length is ".concat(t.length," but should be equal to blockShape.length  ").concat(e.length)}),q(n.shape[0]%a===0,function(){return"input tensor batch is ".concat(n.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(e.join(" * ")," === ").concat(a)});var i={x:n},o={blockShape:e,crops:t};return H.runKernel(DD,i,o)}var qF=U({batchToSpaceND_:wne});function xne(r){var e;return r.rank===0||r.rank===1?e=me(r,[1,1,1,r.size]):r.rank===2?e=me(r,[1,1,r.shape[0],r.shape[1]]):r.rank===3?e=me(r,[1,r.shape[0],r.shape[1],r.shape[2]]):e=r,e}function kne(r,e,t,n,a,i){i==null&&(i=.001);var o=P(r,"x","batchNorm"),s=P(e,"mean","batchNorm"),u=P(t,"variance","batchNorm"),c;a!=null&&(c=P(a,"scale","batchNorm"));var l;n!=null&&(l=P(n,"offset","batchNorm")),q(s.rank===u.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),q(l==null||s.rank===l.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),q(c==null||s.rank===c.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var f=xne(o),h={x:f,scale:c,offset:l,mean:s,variance:u},p={varianceEpsilon:i},d=H.runKernel(m_,h,p);return me(d,o.shape)}var ad=U({batchNorm_:kne});function Sne(r,e,t,n,a,i){var o=P(r,"x","batchNorm"),s=P(e,"mean","batchNorm"),u=P(t,"variance","batchNorm"),c;a!=null&&(c=P(a,"scale","batchNorm"));var l;return n!=null&&(l=P(n,"offset","batchNorm")),q(o.rank===2,function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(o.rank,".")}),q(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(s.rank,".")}),q(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&q(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&q(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(l.rank,".")}),ad(o,s,u,l,c,i)}var Nne=U({batchNorm2d_:Sne});function Tne(r,e,t,n,a,i){var o=P(r,"x","batchNorm"),s=P(e,"mean","batchNorm"),u=P(t,"variance","batchNorm"),c;a!=null&&(c=P(a,"scale","batchNorm"));var l;return n!=null&&(l=P(n,"offset","batchNorm")),q(o.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(o.rank,".")}),q(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(s.rank,".")}),q(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&q(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&q(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(l.rank,".")}),ad(o,s,u,l,c,i)}var Ene=U({batchNorm3d_:Tne});function Ine(r,e,t,n,a,i){var o=P(r,"x","batchNorm"),s=P(e,"mean","batchNorm"),u=P(t,"variance","batchNorm"),c;a!=null&&(c=P(a,"scale","batchNorm"));var l;return n!=null&&(l=P(n,"offset","batchNorm")),q(o.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(o.rank,".")}),q(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(s.rank,".")}),q(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&q(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&q(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(l.rank,".")}),ad(o,s,u,l,c,i)}var Cne=U({batchNorm4d_:Ine});function Ane(r,e,t){var n=P(r,"x","bincount"),a=P(e,"weights","bincount");q(n.dtype==="int32",function(){return"Error in bincount: input "+"dtype must be int32, but got ".concat(n.dtype)}),q(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),q(a.size===n.size||a.size===0,function(){return"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(n.shape,", weights shape: ")+"".concat(a.shape,".")});var i={x:n,weights:a},o={size:t};return H.runKernel(_D,i,o)}var WF=U({bincount_:Ane});function Dne(r,e){var t=P(r,"x","bitwiseAnd"),n=P(e,"y","bitwiseAnd");if(!to(t.shape,n.shape))throw new Error("BitwiseAnd: Tensors must have the same shape. x: ".concat(t.shape,", y: ").concat(n.shape));if(t.dtype!=="int32"||n.dtype!=="int32")throw new Error("BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ".concat(t.dtype," and type of y: ").concat(n.dtype));var a={a:t,b:n};return H.runKernel(FD,a)}var _ne=U({bitwiseAnd_:Dne});function Fne(r,e){var t=P(r,"s0","broadcastArgs","int32"),n=P(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error("broadcastArgs(): first input must be a vector (rank=1). "+"Has rank ".concat(t.rank));if(n.rank!==1)throw new Error("broadcastArgs(): second input must be a vector (rank=1). "+"Has rank ".concat(n.rank));var a={s0:t,s1:n};return H.runKernel(RD,a)}var Rne=U({broadcastArgs_:Fne});function One(r,e){var t=P(r,"broadcastTo","x"),n=t.shape;if(Kn(e),e.length<t.rank)throw new Error("broadcastTo(): shape.length=".concat(e.length," < input.rank=").concat(t.rank,"."));if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=me(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): [".concat(n,"] cannot be broadcast to [").concat(e,"]."));var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return Ss(t);var c={x:t},l={reps:o};return H.runKernel(Wy,c,l)}var Lp=U({broadcastTo_:One});function Pne(r){var e=P(r,"x","ceil","float32"),t={x:e};return H.runKernel(OD,t)}var Mne=U({ceil_:Pne});function lf(r,e,t){Kn(r),t=t||af(e);var n={shape:r,value:e,dtype:t};return H.runKernel(h_,{},n)}function Bne(r,e,t){var n=P(r,"x","clipByValue");if(q(e<=t,function(){return"Error in clip: min (".concat(e,") must be ")+"less than or equal to max (".concat(t,").")}),e===t)return lf(n.shape,e,n.dtype);var a={x:n},i={clipValueMin:e,clipValueMax:t};return H.runKernel(PD,a,i)}var Lne=U({clipByValue_:Bne});function zne(r){return Hn(r,0)}var $ne=U({concat1d_:zne});function qne(r,e){return Hn(r,e)}var Wne=U({concat2d_:qne});function Vne(r,e){return Hn(r,e)}var Une=U({concat3d_:Vne});function Gne(r,e){return Hn(r,e)}var Hne=U({concat4d_:Gne});function Kne(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=P(r,"x","conv2d","float32"),u=P(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=me(s,[1,s.shape[0],s.shape[1],s.shape[2]])),q(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")}),q(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")}),_a("conv2d",n,o);var f=a==="NHWC"?c.shape[3]:c.shape[1];q(f===u.shape[2],function(){return"Error in conv2d: depth of input (".concat(f,") must match ")+"input depth for filter ".concat(u.shape[2],".")}),q(ro(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),q(Es(i),function(){return"Error in conv2D: Dilated rates should be larger than 0."}),q(Es(t),function(){return"Error in conv2D: Strides should be larger than 0."});var h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=H.runKernel(zD,h,p);return l?me(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var id=U({conv2d_:Kne});function jne(r,e,t,n,a,i,o){a===void 0&&(a="NWC"),i===void 0&&(i=1);var s=P(r,"x","conv1d"),u=P(e,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=me(s,[1,s.shape[0],s.shape[1]])),q(c.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")}),q(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+"".concat(u.rank,".")}),_a("conv1d",n,o),q(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match ")+"input depth for filter ".concat(u.shape[1],".")}),q(ro(t,i),function(){return"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(t," and dilation '").concat(i,"'")}),q(Es(i),function(){return"Error in conv1D: Dilated rates should be larger than 0."}),q(Es(t),function(){return"Error in conv1D: Stride should be larger than 0."}),q(a==="NWC",function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")});var f=me(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=me(c,[c.shape[0],1,c.shape[1],c.shape[2]]),p=[1,t],d=[1,i],m="NHWC",v=id(h,f,p,n,m,d,o);return l?me(v,[v.shape[2],v.shape[3]]):me(v,[v.shape[0],v.shape[2],v.shape[3]])}var Xne=U({conv1d_:jne});function Yne(r,e,t,n,a,i,o){i===void 0&&(i="NHWC"),q(r.length===e.rank,function(){return"Length of inShape "+"(".concat(r.length,") and rank of dy (").concat(e.rank,") must match")});var s=r,u=e,c=!1;e.rank===3&&(c=!0,u=me(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,r[0],r[1],r[2]]),q(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")}),q(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)}),q(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(t.rank)});var l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];q(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(t.shape[2],".")}),q(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output (".concat(f,") must ")+"match output depth for filter ".concat(t.shape[3],".")}),_a("conv2dDerInput",a,o);var h={dy:u,filter:t},p={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=H.runKernel(qD,h,p);return c?me(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var VF=U({conv2DBackpropInput_:Yne});function Zne(r,e,t,n,a,i){var o=P(r,"x","conv2dTranspose"),s=P(e,"filter","conv2dTranspose");return VF(t,o,s,n,a,"NHWC",i)}var Jne=U({conv2dTranspose_:Zne});function Qne(r,e,t,n,a,i){a===void 0&&(a="NDHWC"),i===void 0&&(i=[1,1,1]);var o=P(r,"x","conv3d"),s=P(e,"filter","conv3d"),u=o,c=!1;o.rank===4&&(c=!0,u=me(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),q(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")}),q(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+"".concat(s.rank,".")}),q(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match ")+"input depth for filter ".concat(s.shape[3],".")}),q(ro(t,i),function(){return"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),q(a==="NDHWC",function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")}),q(Es(i),function(){return"Error in conv3D: Dilated rates should be larger than 0."}),q(Es(t),function(){return"Error in conv3D: Strides should be larger than 0."});var l={x:u,filter:s},f={strides:t,pad:n,dataFormat:a,dilations:i},h=H.runKernel(WD,l,f);return c?me(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var eae=U({conv3d_:Qne});function tae(r,e,t,n,a){q(r.length===e.rank,function(){return"Length of inShape "+"(".concat(r.length,") and rank of dy (").concat(e.rank,") must match")});var i=r,o=e,s=!1;e.rank===4&&(s=!0,o=me(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,r[0],r[1],r[2],r[3]]);var u=i[4],c=o.shape[4];q(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")}),q(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)}),q(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(t.rank)}),q(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(t.shape[3],".")}),q(c===t.shape[4],function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(t.shape[4],".")});var l={dy:o,filter:t},f={pad:a,strides:n,inputShape:i},h=H.runKernel(VD,l,f);return s?me(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var rae=U({conv3DBackpropInput_:tae});function nae(r,e,t,n,a){var i=P(r,"x","conv3dTranspose"),o=P(e,"filter","conv3dTranspose");return rae(t,i,o,n,a)}var aae=U({conv3dTranspose_:nae});function iae(r){var e=P(r,"x","cos","float32"),t={x:e};return H.runKernel(UD,t)}var oae=U({cos_:iae});function sae(r){var e=P(r,"x","cosh","float32"),t={x:e};return H.runKernel(GD,t)}var uae=U({cosh_:sae});function cae(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=P(r,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:n};return H.runKernel(HD,i,o)}var lae=U({cumprod_:cae});function fae(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=P(r,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:n};return H.runKernel(KD,i,o)}var hae=U({cumsum_:fae});function pae(r,e,t,n){n===void 0&&(n=!1);var a=P(r,"x","denseBincount"),i=P(e,"weights","denseBincount");q(a.dtype==="int32",function(){return"Error in denseBincount: input "+"dtype must be int32, but got ".concat(a.dtype)}),q(a.rank<=2,function(){return"Error in denseBincount: input must be at most rank 2, but got "+"rank ".concat(a.rank,".")}),q(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),q(i.size===a.size||i.size===0,function(){return"Error in denseBincount: weights must have the same shape as x or "+"0-length, but got x shape: ".concat(a.shape,", weights shape: ")+"".concat(i.shape,".")});var o={x:a,weights:i},s={size:t,binaryOutput:n};return H.runKernel(XD,o,s)}var dae=U({denseBincount_:pae});function vae(r,e,t){t===void 0&&(t="NHWC");var n=P(r,"x","depthToSpace","float32"),a=t==="NHWC"?n.shape[1]:n.shape[2],i=t==="NHWC"?n.shape[2]:n.shape[3],o=t==="NHWC"?n.shape[3]:n.shape[1];q(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(e)}),q(a*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(a," and ").concat(e,`  for depthToSpace with input shape
    `).concat(n.shape)}),q(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(i," and ").concat(e,` for depthToSpace with input shape
        `).concat(n.shape)}),q(o%(e*e)===0,function(){return"Dimension size must be evenly divisible by ".concat(e*e," but is ").concat(o," for depthToSpace with input shape ").concat(n.shape)});var s={x:n},u={blockSize:e,dataFormat:t};return H.runKernel(YD,s,u)}var mae=U({depthToSpace_:vae});function gae(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=P(r,"x","depthwiseConv2d","float32"),u=P(e,"filter","depthwiseConv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=me(s,[1,s.shape[0],s.shape[1],s.shape[2]])),q(c.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(c.rank,".")}),q(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")});var f=a==="NHWC"?c.shape[3]:c.shape[1];q(f===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels "+"(".concat(f,") must match the inChannels dimension in ")+"filter ".concat(u.shape[2],".")}),_a("depthwiseConv2d",n,o);var h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=H.runKernel(ZD,h,p);return l?me(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Yy=U({depthwiseConv2d_:gae});function yae(r){var e=P(r,"x","diag"),t={x:e};return H.runKernel(e_,t)}var bae=U({diag_:yae});function wae(r,e,t,n,a,i){a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC");var o=P(r,"x","dilation2d"),s=P(e,"filter","dilation2d");q(o.rank===3||o.rank===4,function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(o.rank,".")}),q(s.rank===3,function(){return"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(s.rank,".")}),q(i==="NHWC",function(){return"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(i)});var u=o,c=!1;o.rank===3&&(u=me(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),q(u.shape[3]===s.shape[2],function(){return"Error in dilation2d:  input and filter must have the same depth: ".concat(u.shape[3]," vs ").concat(s.shape[2])});var l={x:u,filter:s},f={strides:t,pad:n,dilations:a},h=H.runKernel(t_,l,f);return c?me(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var xae=U({dilation2d_:wae});function UF(r,e){for(var t=r.length,n=[],a=0;a<t;a++){var i=t-1-a,o=r[i]||1,s=e[e.length-1-a]||1;s>1&&o===1&&n.unshift(i)}return n}function Zy(r,e){for(var t=[],n=0;n<e.length;n++){var a=r[r.length-n-1],i=e.length-n-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function Br(r,e){for(var t=Math.max(r.length,e.length),n=new Array(t),a=0;a<t;a++){var i=r[r.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)n[t-a-1]=o;else if(o===1)n[t-a-1]=i;else if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(r," and ").concat(e,".");throw Error(s)}else n[t-a-1]=i}return n}var kae={__proto__:null,assertAndGetBroadcastShape:Br,getBroadcastDims:UF,getReductionAxes:Zy};function Sae(r,e){var t,n=P(r,"a","equal","string_or_numeric"),a=P(e,"b","equal","string_or_numeric");t=Se(gr(n,a),2),n=t[0],a=t[1],Br(n.shape,a.shape);var i={a:n,b:a};return H.runKernel(s_,i)}var GF=U({equal_:Sae});function Nae(r,e,t){var n=P(e,"a","where"),a=P(t,"b","where"),i=P(r,"condition","where","bool"),o=Br(Br(i.shape,n.shape),a.shape),s=Lp(i,o),u=Lp(n,o),c=Lp(a,o),l={condition:s,t:u,e:c};return H.runKernel(S3,l)}var Oo=U({where_:Nae});function Tae(r){var e=P(r,"x","zerosLike"),t={x:e};return H.runKernel(tF,t)}var da=U({zerosLike_:Tae});function Eae(r,e){var t,n=P(r,"a","div"),a=P(e,"b","div");t=Se(gr(n,a),2),n=t[0],a=t[1];var i=Gt(n,a),o=da(i),s=GF(a,o);return Oo(s,o,i)}var Iae=U({divNoNan_:Eae});function Cae(r,e){var t=P(r,"t1","dot"),n=P(e,"t2","dot");q((t.rank===1||t.rank===2)&&(n.rank===1||n.rank===2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(t.rank," and ").concat(n.rank,".")});var a=t.rank===1?t.size:t.shape[1],i=n.rank===1?n.size:n.shape[0];if(q(a===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+"".concat(a," and ").concat(i,".")}),t.rank===1&&n.rank===1){var o=me(t,[1,-1]),s=me(n,[-1,1]),u=Rt(o,s);return me(u,[])}else if(t.rank===1&&n.rank===2){var o=me(t,[1,-1]),s=me(n,[n.shape[0],n.shape[1]]),u=Rt(o,s);return me(u,[u.size])}else if(t.rank===2&&n.rank===1){var s=me(n,[-1,1]),u=Rt(t,s);return me(u,[u.size])}else{var s=me(n,[n.shape[0],n.shape[1]]),u=Rt(t,s);return u}}var Aae=U({dot_:Cae});function Dae(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var n=e.map(function(i,o){return P(i,"tensors".concat(o),"einsum")}),a={equation:r};return H.runKernel(a_,n,a)}var _ae=U({einsum_:Dae});function Fae(r){var e=P(r,"x","elu","float32"),t={x:e};return H.runKernel(i_,t)}var HF=U({elu_:Fae});function Rae(r,e){var t=P(r,"x","ensureShape","string_or_numeric");if(!nD(t.shape,e))throw new Error("EnsureShape: Shape of tensor ".concat(t.shape," is not compatible with expected shape ").concat(e));return r}var Oae=U({ensureShape_:Rae});function Pae(r){var e=P(r,"x","erf");q(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=mr(e,"float32"));var t={x:e};return H.runKernel(o_,t)}var Mae=U({erf_:Pae});function Jy(r,e){for(var t=0;t<r.length;++t)if(r[r.length-t-1]!==e-1-t)return!1;return!0}function KF(r,e,t){for(var n=r.length+e.length,a=[],i=0,o=0,s=0;s<n;s++)t.indexOf(s)===-1?a.push(r[i++]):a.push(e[o++]);return a}function Bae(r,e){for(var t=[],n=r.length,a=0;a<n;a++)e.indexOf(a)===-1&&t.push(r[a]);var i=e.map(function(o){return r[o]});return[t,i]}function ff(r,e){var t=e.map(function(n){return 1});return KF(r,t,e)}function Lae(r,e,t){q(Jy(e,t),function(){return"".concat(r," supports only inner-most axes for now. ")+"Got axes ".concat(e," and rank-").concat(t," input.")})}function zae(r,e){if(Jy(r,e))return null;for(var t=[],n=0;n<e;++n)r.indexOf(n)===-1&&t.push(n);return r.forEach(function(a){return t.push(a)}),t}function $ae(r){return r.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function qae(r,e){for(var t=[],n=e-r;n<e;++n)t.push(n);return t}function Wae(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=P(r,"x","max"),a={x:n},i={reductionIndices:e,keepDims:t};return H.runKernel(M_,a,i)}var Qu=U({max_:Wae});function Vae(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=P(r,"x","min"),a={x:n},i={axis:e,keepDims:t};return H.runKernel(W_,a,i)}var Dy=U({min_:Vae});function Uae(r,e){var t,n=P(r,"base","pow"),a=P(e,"exp","pow");t=Se(gr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return H.runKernel(n3,i)}var Zl=U({pow_:Uae});function $t(r,e){if((Kr(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Kr(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],n=[];return zo(r,t,n,e)}function Gae(r){var e=P(r,"x","sqrt","float32"),t={x:e};return H.runKernel(_3,t)}var Qi=U({sqrt_:Gae});function Hae(r){var e=P(r,"x","square"),t={};return H.runKernel("Square",{x:e},t)}var oi=U({square_:Hae});function Kae(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=P(r,"x","sum");n.dtype==="bool"&&(n=mr(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return H.runKernel(F3,a,i)}var Ut=U({sum_:Kae});function jae(r,e,t,n){e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1),r=P(r,"x","norm");var a=jF(r,e,t),i=a.shape;if(n){var o=nf(t,r.shape);i=ff(a.shape,o)}return me(a,i)}function jF(r,e,t){if(t===void 0&&(t=null),r.rank===0)return pa(r);if(r.rank!==1&&t===null)return jF(me(r,[-1]),e,t);if(r.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Ut(pa(r),t);if(e===1/0)return Qu(pa(r),t);if(e===-1/0)return Dy(pa(r),t);if(e==="euclidean"||e===2)return Qi(Ut(Zl(pa(r),$t(2,"int32")),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}if(Array.isArray(t)&&t.length===2){if(e===1)return Qu(Ut(pa(r),t[0]),t[1]-1);if(e===1/0)return Qu(Ut(pa(r),t[1]),t[0]);if(e===-1/0)return Dy(Ut(pa(r),t[1]),t[0]);if(e==="fro"||e==="euclidean")return Qi(Ut(oi(r),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}throw new Error("Error in norm: invalid axis: ".concat(t))}var od=U({norm_:jae});function Xae(r,e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),od(r,"euclidean",e,t)}var Yae=U({euclideanNorm_:Xae});function Zae(r){var e=P(r,"x","exp"),t={x:e};return H.runKernel(u_,t)}var Is=U({exp_:Zae});function Jae(r,e){e===void 0&&(e=0);var t=P(r,"x","expandDims","string_or_numeric");q(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var n={input:t},a={dim:e};return H.runKernel(c_,n,a)}var ys=U({expandDims_:Jae});function Qae(r){var e=P(r,"x","expm1"),t={x:e};return H.runKernel(l_,t)}var eie=U({expm1_:Qae});function tie(r,e){var t=P(r,"x","tile","string_or_numeric");q(t.rank===e.length,function(){return"Error in transpose: rank of input ".concat(t.rank," ")+"must match length of reps ".concat(e,".")});var n={x:t},a={reps:e};return H.runKernel(Wy,n,a)}var ql=U({tile_:tie});function rie(r,e,t,n){n===void 0&&(n="float32"),e==null&&(e=r);for(var a=Ji([r,e],n),i=r<=e?r:e,o=0;o<i;++o)a.set(1,o,o);var s=me(a.toTensor(),[r,e]);if(t==null)return s;if(t.length===1)return ql(ys(s,0),[t[0],1,1]);if(t.length===2)return ql(ys(ys(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return ql(ys(ys(ys(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(t.length,"D."))}var XF=U({eye_:rie});function nie(r){var e=P(r,"x","floor","float32"),t={x:e};return H.runKernel(d_,t)}var YF=U({floor_:nie});function aie(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=0);var a=P(r,"x","gather"),i=P(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:n};return H.runKernel(g_,o,s)}var ZF=U({gather_:aie});function iie(r,e){var t,n=P(r,"a","greater","string_or_numeric"),a=P(e,"b","greater","string_or_numeric");t=Se(gr(n,a),2),n=t[0],a=t[1],Br(n.shape,a.shape);var i={a:n,b:a};return H.runKernel(b_,i)}var sd=U({greater_:iie});function oie(r,e){var t,n=P(r,"a","greaterEqual","string_or_numeric"),a=P(e,"b","greaterEqual","string_or_numeric");t=Se(gr(n,a),2),n=t[0],a=t[1],Br(n.shape,a.shape);var i={a:n,b:a};return H.runKernel(w_,i)}var JF=U({greaterEqual_:oie});function sie(r){var e=P(r,"input","imag"),t={input:e};return H.runKernel(k_,t)}var ud=U({imag_:sie});function uie(r){var e=P(r,"x","isFinite"),t={x:e};return H.runKernel(S_,t)}var cie=U({isFinite_:uie});function lie(r){var e=P(r,"x","isInf"),t={x:e};return H.runKernel(N_,t)}var fie=U({isInf_:lie});function hie(r){var e=P(r,"x","isNaN"),t={x:e};return H.runKernel(T_,t)}var pie=U({isNaN_:hie});function die(r,e){e===void 0&&(e=.2);var t=P(r,"x","leakyRelu"),n={x:t},a={alpha:e};return H.runKernel(E_,n,a)}var QF=U({leakyRelu_:die});function vie(r,e){var t,n=P(r,"a","less","string_or_numeric"),a=P(e,"b","less","string_or_numeric");t=Se(gr(n,a),2),n=t[0],a=t[1],Br(n.shape,a.shape);var i={a:n,b:a};return H.runKernel(I_,i)}var _y=U({less_:vie});function mie(r,e){var t,n=P(r,"a","lessEqual","string_or_numeric"),a=P(e,"b","lessEqual","string_or_numeric");t=Se(gr(n,a),2),n=t[0],a=t[1],Br(n.shape,a.shape);var i={a:n,b:a};return H.runKernel(C_,i)}var Qy=U({lessEqual_:mie});function gie(r,e,t){if(t<=0)throw new Error("The number of values should be positive.");var n={start:r,stop:e,num:t};return H.runKernel(A_,{},n)}function yie(r,e,t,n,a){e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),a===void 0&&(a=.5);var i=P(r,"x","localResponseNormalization");q(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `.concat(i.rank,".")}),q(ec(e),function(){return"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(e,".")});var o=i,s=!1;i.rank===3&&(s=!0,o=me(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:e,bias:t,alpha:n,beta:a},l=H.runKernel(P_,u,c);return s?me(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var bie=U({localResponseNormalization_:yie});function wie(r){var e=P(r,"x","log","float32"),t={x:e};return H.runKernel(D_,t)}var Jl=U({log_:wie});function xie(r){var e=P(r,"x","log1p"),t={x:e};return H.runKernel(__,t)}var eR=U({log1p_:xie});function kie(r){return q(Po(r),function(){return"The f passed in grad(f) must be a function"}),function(e,t){var n=P(e,"x","tf.grad","string_or_numeric"),a=t!=null?P(t,"dy","tf.grad"):null;return H.tidy(function(){var i=H.gradients(function(){return r(n)},[n],a),o=i.value,s=i.grads;return a!=null&&bn(o.shape,a.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),cd(s),s[0]})}}function Sie(r){return q(Po(r),function(){return"The f passed in grads(f) must be a function"}),function(e,t){q(Array.isArray(e),function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"});var n=Kl(e,"args","tf.grads","string_or_numeric"),a=t!=null?P(t,"dy","tf.grads"):null;return H.tidy(function(){var i=H.gradients(function(){return r.apply(void 0,wt([],Se(n),!1))},n,a),o=i.value,s=i.grads;return a!=null&&bn(o.shape,a.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),cd(s),s})}}function Nie(r){return q(Po(r),function(){return"The f passed in valueAndGrad(f) must be a function"}),function(e,t){q(e instanceof Ar,function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"}),q(t==null||t instanceof Ar,function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"});var n=H.gradients(function(){return r(e)},[e],t),a=n.grads,i=n.value;return cd(a),{grad:a[0],value:i}}}function Tie(r){return q(Po(r),function(){return"The f passed in valueAndGrads(f) must be a function"}),function(e,t){q(Array.isArray(e)&&e.every(function(a){return a instanceof Ar}),function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"}),q(t==null||t instanceof Ar,function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"});var n=H.gradients(function(){return r.apply(void 0,wt([],Se(e),!1))},e,t);return t!=null&&bn(n.value.shape,t.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),cd(n.grads),n}}function tR(r,e){q(Po(r),function(){return"The f passed in variableGrads(f) must be a function"}),q(e==null||Array.isArray(e)&&e.every(function(f){return f instanceof Hl}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t){e=[];for(var n in H.registeredVariables)e.push(H.registeredVariables[n])}var a=t?e.filter(function(f){return!f.trainable}):null,i=e.length;e=e.filter(function(f){return f.trainable}),q(e.length>0,function(){return"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(i," variables is ")+"trainable."});var o=!0,s=H.gradients(r,e,null,o),u=s.value,c=s.grads;q(c.some(function(f){return f!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),q(u.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(u.rank," tensor")});var l={};return e.forEach(function(f,h){c[h]!=null&&(l[f.name]=c[h])}),a?.forEach(function(f){return l[f.name]=null}),{value:u,grads:l}}function _i(r){return H.customGrad(r)}function cd(r){var e=r.filter(function(t){return t==null}).length;if(e>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}function Eie(r){var e=P(r,"x","neg"),t={x:e};return H.runKernel(j_,t)}var Ai=U({neg_:Eie});function Iie(r){var e=P(r,"x","softplus"),t={x:e};return H.runKernel(D3,t)}var rR=U({softplus_:Iie});function Cie(r){var e=P(r,"x","logSigmoid"),t=_i(function(n){var a=Ai(rR(Ai(n))),i=function(o){var s=Me(o,Ju(Ai(n)));return s};return{value:a,gradFunc:i}});return t(e)}var Aie=U({logSigmoid_:Cie});function Die(r,e){var t,n=P(r,"a","sub"),a=P(e,"b","sub");t=Se(gr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return H.runKernel(K3,i)}var bt=U({sub_:Die});function _ie(r,e){e===void 0&&(e=-1);var t=P(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and axis was ").concat(e));var n=_i(function(a,i){var o=!0,s=Qu(a,e,!0),u=bt(a,s),c=bt(mr(u,"float32"),Jl(Ut(Is(u),e,o)));i([c]);var l=function(f,h){var p=Se(h,1),d=p[0],m=!0,v=Is(d);return bt(f,Me(Ut(f,e,m),v))};return{value:c,gradFunc:l}});return n(t)}var Fie=U({logSoftmax_:_ie});function Rie(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=P(r,"x","logSumExp"),a=nf(e,n.shape),i=Qu(n,a,!0),o=bt(n,i),s=Is(o),u=Ut(s,a),c=Jl(u),l=ct(me(i,c.shape),c);if(t){var f=ff(l.shape,a);return me(l,f)}return l}var nR=U({logSumExp_:Rie});function Oie(r,e){var t=P(r,"a","logicalAnd","bool"),n=P(e,"b","logicalAnd","bool");Br(t.shape,n.shape);var a={a:t,b:n};return H.runKernel(F_,a)}var jp=U({logicalAnd_:Oie});function Pie(r){var e=P(r,"x","logicalNot","bool"),t={x:e};return H.runKernel(R_,t)}var aR=U({logicalNot_:Pie});function Mie(r,e){var t=P(r,"a","logicalOr","bool"),n=P(e,"b","logicalOr","bool");Br(t.shape,n.shape);var a={a:t,b:n};return H.runKernel(O_,a)}var iR=U({logicalOr_:Mie});function Bie(r,e){var t=P(r,"a","logicalXor","bool"),n=P(e,"b","logicalXor","bool");return Br(t.shape,n.shape),jp(iR(r,e),aR(jp(r,e)))}var Lie=U({logicalXor_:Bie});var Op=2147483648;function zie(r,e,t){t===void 0&&(t="left");var n=P(r,"sortedSequence","searchSorted"),a=P(e,"values","searchSorted"),i=n.shape[n.shape.length-1],o=a.shape[a.shape.length-1],s=me(n,[-1,i]),u=me(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(Ht(u.shape)>=Op)throw new Error("values tensor size must less than ".concat(Op));if(s.shape[1]>=Op)throw new Error("trailing dim_size must less than ".concat(Op," for int32 output type, was ").concat(s.shape[1]));var c={sortedSequence:s,values:u},l={side:t};return H.runKernel(k3,c,l)}var e0=U({searchSorted_:zie});function $ie(r,e){return e0(r,e,"left")}function qie(r,e,t,n,a){var i=P(r,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=me(i,[1,i.shape[0],i.shape[1],i.shape[2]])),q(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(s.rank,".")}),q(ro(t,o),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")}),_a("maxPool",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=H.runKernel(L_,c,l);return u?me(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var oR=U({maxPool_:qie});function Wie(r,e,t,n,a,i){e===void 0&&(e=[1,1,1]),i===void 0&&(i="NDHWC");var o=P(r,"x","maxPool3d"),s=o,u=!1;o.rank===4&&(u=!0,s=me(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),q(s.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),q(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),_a("maxPool3d",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=H.runKernel(z_,c,l);return u?me(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var Vie=U({maxPool3d_:Wie});function Uie(r,e,t,n,a){a===void 0&&(a=!1);var i=P(r,"x","maxPoolWithArgmax"),o={x:i},s={filterSize:e,strides:t,pad:n,includeBatchInIndex:a},u=H.runKernel($_,o,s);return{result:u[0],indexes:u[1]}}var Gie=U({maxPoolWithArgmax_:Uie});function Hie(r,e){var t,n=P(r,"a","maximum"),a=P(e,"b","maximum");t=Se(gr(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=mr(n,"int32"),a=mr(a,"int32")),Br(n.shape,a.shape);var i={a:n,b:a};return H.runKernel(B_,i)}var sR=U({maximum_:Hie});function Kie(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=P(r,"x","mean"),a={x:n},i={axis:e,keepDims:t};return H.runKernel(q_,a,i)}var Xp=U({mean_:Kie});function nc(r,e){if(e===void 0&&(e="float32"),Kn(r),e==="complex64"){var t=nc(r,"float32"),n=nc(r,"float32");return Bo(t,n)}var a=ed(Ht(r),e);return H.makeTensor(a,r,e)}function ks(r,e){if(e===void 0&&(e="float32"),Kn(r),e==="complex64"){var t=ks(r,"float32"),n=nc(r,"float32");return Bo(t,n)}var a=By(Ht(r),e);return H.makeTensor(a,r,e)}function jie(r,e,t){var n=t===void 0?{}:t,a=n.indexing,i=a===void 0?"xy":a;if(i!=="xy"&&i!=="ij")throw new TypeError("".concat(i," is not a valid third argument to meshgrid"));if(r===void 0)return[];var o=P(r,"x","meshgrid",r instanceof Ar?r.dtype:"float32");if(e===void 0)return[o];var s=P(e,"y","meshgrid",e instanceof Ar?e.dtype:"float32"),u=Ht(o.shape),c=Ht(s.shape);return i==="xy"?(o=me(o,[1,-1]),s=me(s,[-1,1]),[Rt(ks([c,1],o.dtype),o),Rt(s,ks([1,u],s.dtype))]):(o=me(o,[-1,1]),s=me(s,[1,-1]),[Rt(o,ks([1,c],o.dtype)),Rt(ks([u,1],s.dtype),s)])}function Xie(r,e){var t,n=P(r,"a","minimum"),a=P(e,"b","minimum");t=Se(gr(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=mr(n,"int32"),a=mr(a,"int32")),Br(n.shape,a.shape);var i={a:n,b:a};return H.runKernel(V_,i)}var Yp=U({minimum_:Xie});function Yie(r,e,t){q(t==="reflect"||t==="symmetric",function(){return"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(t,".")});var n=P(r,"x","mirrorPad");if(n.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");q(e.length===n.rank,function(){return"Padding doesn't match input. Must be ".concat(n.rank,". ")+"Got ".concat(e.length,".")});for(var a=t==="reflect"?1:0,i=function(c){q(e[c].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),q(e[c][0]>=0&&e[c][0]<=n.shape[c]-a&&e[c][1]>=0&&e[c][1]<=n.shape[c]-a,function(){return"Padding in dimension ".concat(c," cannot be greater than or equal ")+"to ".concat(n.shape[c]-a," or less than 0 for input of ")+"shape ".concat(n.shape)})},o=0;o<n.rank;o++)i(o);var s={paddings:e,mode:t},u={x:n};return H.runKernel(U_,u,s)}var Zie=U({mirrorPad_:Yie});function Jie(r,e){var t,n=P(r,"a","mod"),a=P(e,"b","mod");t=Se(gr(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return H.runKernel(G_,i)}var Qie=U({mod_:Jie});function eoe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1),r=P(r,"x","moments");var n=nf(e,r.shape),a=Xp(r,n,t),i=a.shape;t||(i=ff(a.shape,n));var o=oi(bt(mr(r,"float32"),me(a,i))),s=Xp(o,n,t);return{mean:a,variance:s}}var toe=U({moments_:eoe});function roe(r,e,t,n){for(var a=P(e,"data","multiRNNCell"),i=Kl(t,"c","multiRNNCell"),o=Kl(n,"h","multiRNNCell"),s=a,u=[],c=0;c<r.length;c++){var l=r[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}for(var f=[],h=[],c=0;c<u.length;c+=2)f.push(u[c]),h.push(u[c+1]);return[f,h]}var noe=U({multiRNNCell_:roe});function aoe(r,e,t,n){n===void 0&&(n=!1);var a=P(r,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+"".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));t=t||Math.random();var s=o===1?me(a,[1,-1]):a,u={logits:s},c={numSamples:e,seed:t,normalized:n},l=H.runKernel(H_,u,c);return o===1?me(l,[l.size]):l}var ioe=U({multinomial_:aoe});function ooe(r,e){var t,n=P(r,"a","notEqual","string_or_numeric"),a=P(e,"b","notEqual","string_or_numeric");t=Se(gr(n,a),2),n=t[0],a=t[1],Br(n.shape,a.shape);var i={a:n,b:a};return H.runKernel(X_,i)}var uR=U({notEqual_:ooe});function soe(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n=0),a===void 0&&(a="int32"),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(e));var i=P(r,"indices","oneHot","int32"),o={indices:i},s={dtype:a,depth:e,onValue:t,offValue:n};return H.runKernel(e3,o,s)}var Fy=U({oneHot_:soe});function uoe(r){var e=P(r,"x","onesLike"),t={x:e};return H.runKernel(Q_,t)}var coe=U({onesLike_:uoe});function loe(r,e){var t=P(r,"v1","outerProduct"),n=P(e,"v2","outerProduct");q(t.rank===1&&n.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+"".concat(t.rank," and ").concat(n.rank,".")});var a=me(t,[-1,1]),i=me(n,[1,-1]);return Rt(a,i)}var foe=U({outerProduct_:loe});function hoe(r,e,t){t===void 0&&(t=0);var n=P(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:n};return H.runKernel(r3,i,a)}var hf=U({pad_:hoe});function poe(r,e,t){return t===void 0&&(t=0),q(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),hf(r,[e],t)}var doe=U({pad1d_:poe});function voe(r,e,t){return t===void 0&&(t=0),q(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),hf(r,e,t)}var moe=U({pad2d_:voe});function goe(r,e,t){return t===void 0&&(t=0),q(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),hf(r,e,t)}var yoe=U({pad3d_:goe});function boe(r,e,t){return t===void 0&&(t=0),q(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),hf(r,e,t)}var woe=U({pad4d_:boe});function xoe(r,e,t){var n=P(r,"x","spaceToBatchND");q(n.rank>=1+e.length,function(){return"input rank ".concat(n.rank," should be > than [blockShape] ").concat(e.length)}),q(t.length===e.length,function(){return"paddings.shape[0] ".concat(t.length," must be equal to [blockShape] ").concat(e.length)}),q(n.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions ".concat(n.shape.slice(1)," with paddings ").concat(t.toString()," must be divisible by blockShapes ").concat(e.toString())});var a={x:n},i={blockShape:e,paddings:t};return H.runKernel(R3,a,i)}var cR=U({spaceToBatchND_:xoe});function koe(r,e,t,n,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),n===0&&(n="valid");var s=P(r,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=me(s,[1,s.shape[0],s.shape[1],s.shape[2]])),q(ro(i,a),function(){return"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'")});var l=BF(u.shape,e,i,a,n),f=[l.dilationHeight,l.dilationWidth],h;n==="same"?h=Noe([l.filterHeight,l.filterWidth],f):h=[[0,0],[0,0]];var p=f[0]===1&&f[1]===1,d=Se(Soe([l.inHeight,l.inWidth],f,h),2),m=d[0],v=d[1],g=p?n:"valid",y=p?u:cR(u,f,m),w=t==="avg"?function(){return $F(y,e,i,g,o)}:function(){return oR(y,e,i,g,o)},b=w(),x=p?b:qF(b,f,v);return c?me(x,[x.shape[1],x.shape[2],x.shape[3]]):x}function Soe(r,e,t){var n=t.map(function(l){return l[0]}),a=t.map(function(l){return l[1]}),i=r.concat(n,a),o=e.map(function(l,f){return(l-i[f]%l)%l}),s=a.map(function(l,f){return l+o[f]}),u=e.map(function(l,f){return[n[f],s[f]]}),c=e.map(function(l,f){return[0,o[f]]});return[u,c]}function Noe(r,e){var t=r.map(function(o,s){return o+(o-1)*(e[s]-1)}),n=t.map(function(o){return o-1}),a=n.map(function(o){return Math.floor(o/2)}),i=n.map(function(o,s){return o-a[s]});return n.map(function(o,s){return[a[s],i[s]]})}var Toe=U({pool_:koe});function Eoe(r,e){var t=P(r,"x","prelu"),n=P(e,"alpha","prelu"),a={x:t,alpha:n};return H.runKernel(a3,a)}var lR=U({prelu_:Eoe});function Ioe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=P(r,"x","prod");n.dtype==="bool"&&(n=mr(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return H.runKernel(i3,a,i)}var Coe=U({prod_:Ioe});function Aoe(r,e,t,n){var a=r.map(function(l,f){return P(l,"tensors".concat(f),"raggedGather","int32")}),i=P(e,"paramsDenseValues","raggedGather"),o=P(t,"indices","raggedGather","int32"),s={paramsNestedSplits:a,paramsDenseValues:i,indices:o},u={outputRaggedRank:n},c=H.runKernel(o3,s,u);return{outputNestedSplits:c.slice(0,c.length-1),outputDenseValues:c[c.length-1]}}var Doe=U({raggedGather_:Aoe});function _oe(r,e,t){var n=P(r,"starts","raggedRange"),a=P(e,"limits","raggedRange",n.dtype),i=P(t,"deltas","raggedRange",n.dtype),o={starts:n,limits:a,deltas:i},s=H.runKernel(s3,o);return{rtNestedSplits:s[0],rtDenseValues:s[1]}}var Foe=U({raggedRange_:_oe});function Roe(r,e,t,n,a){var i=P(r,"shape","raggedTensorToTensor","int32"),o=P(e,"values","raggedTensorToTensor"),s=P(t,"defaultValue","raggedTensorToTensor",o.dtype),u=n.map(function(f,h){return P(f,"tensors".concat(h),"raggedTensorToTensor","int32")}),c={shape:i,values:o,defaultValue:s,rowPartitionTensors:u},l={rowPartitionTypes:a};return H.runKernel(u3,c,l)}var Ooe=U({raggedTensorToTensor_:Roe});function Poe(r,e,t){Kn(r);var n=Ht(r),a=null;if(t==null||t==="float32")a=new Float32Array(n);else if(t==="int32")a=new Int32Array(n);else if(t==="bool")a=new Uint8Array(n);else throw new Error("Unknown data type ".concat(t));for(var i=0;i<n;i++)a[i]=e();return H.makeTensor(a,r,t)}var Moe=U({rand_:Poe}),fR={exports:{}};(function(r){(function(e,t,n){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(Ds,r,!1)})(fR);var Boe=fR.exports,hR={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(Ds,r,!1)})(hR);var Loe=hR.exports,pR={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(Ds,r,!1)})(pR);var zoe=pR.exports,dR={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,p;return h=l[f],h^=h>>>7,p=h^h<<24,h=l[f+1&7],p^=h^h>>>10,h=l[f+3&7],p^=h^h>>>3,h=l[f+4&7],p^=h^h<<7,h=l[f+7&7],h=h^h<<13,p^=h^h<<9,l[f]=p,u.i=f+1&7,p};function c(l,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8?p[7]=-1:p[h],l.x=p,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(Ds,r,!1)})(dR);var $oe=dR.exports,vR={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,p,d;return u.w=l=l+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(l^l>>>16)|0};function c(l,f){var h,p,d,m,v,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,m=-32;m<y;++m)f&&(p^=f.charCodeAt((m+32)%f.length)),m===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(v=v+1640531527|0,h=g[m&127]^=p+v,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,m=4*128;m>0;--m)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;l.w=v,l.X=g,l.i=d}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(Ds,r,!1)})(vR);var qoe=vR.exports,mR={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(Ds,r,!1)})(mR);var Woe=mR.exports,gR={exports:{}};(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),c=n.pow(2,o),l=c*2,f=a-1,h;function p(b,x,S){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(v(x.entropy?[b,w(t)]:b??y(),3),T),C=new d(T),R=function(){for(var _=C.g(i),O=u,$=0;_<c;)_=(_+$)*a,O*=a,$=C.g(1);for(;_>=l;)_/=2,O/=2,$>>>=1;return(_+$)/O};return R.int32=function(){return C.g(4)|0},R.quick=function(){return C.g(4)/4294967296},R.double=R,g(w(C.S),t),(x.pass||S||function(_,O,$,z){return z&&(z.S&&m(z,C),_.state=function(){return m(C,{})}),$?(n[s]=_,O):_})(R,E,"global"in x?x.global:this==n,x.state)}function d(b){var x,S=b.length,T=this,E=0,C=T.i=T.j=0,R=T.S=[];for(S||(b=[S++]);E<a;)R[E]=E++;for(E=0;E<a;E++)R[E]=R[C=f&C+b[E%S]+(x=R[E])],R[C]=x;(T.g=function(_){for(var O,$=0,z=T.i,L=T.j,B=T.S;_--;)O=B[z=f&z+1],$=$*a+B[f&(B[z]=B[L=f&L+O])+(B[L]=O)];return T.i=z,T.j=L,$})(a)}function m(b,x){return x.i=b.i,x.j=b.j,x.S=b.S.slice(),x}function v(b,x){var S=[],T=typeof b,E;if(x&&T=="object")for(E in b)try{S.push(v(b[E],x-1))}catch{}return S.length?S:T=="string"?b:b+"\0"}function g(b,x){for(var S=b+"",T,E=0;E<S.length;)x[f&E]=f&(T^=x[f&E]*19)+S.charCodeAt(E++);return w(x)}function y(){try{var b;return h&&(b=h.randomBytes)?b=b(a):(b=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(b)),w(b)}catch{var x=e.navigator,S=x&&x.plugins;return[+new Date,e,S,e.screen,w(t)]}}function w(b){return String.fromCharCode.apply(0,b)}if(g(n.random(),t),r.exports){r.exports=p;try{h=Fp()}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:Ds,[],Math)})(gR);var Voe=gR.exports,Uoe=Boe,Goe=Loe,Hoe=zoe,Koe=$oe,joe=qoe,Xoe=Woe,Fs=Voe;Fs.alea=Uoe;Fs.xor128=Goe;Fs.xorwow=Hoe;Fs.xorshift7=Koe;Fs.xor4096=joe;Fs.tychei=Xoe;var t0=Fs,Yoe=.001,yR=.1;function Zoe(r,e,t){return t==null&&(t=r0()),Ry(r,e,function(n,a){return n0(n,a,t)})}function r0(){return H.backend.floatPrecision()===32?Yoe:yR}function Ry(r,e,t){var n=!0;if((Kr(r)||Kr(e))&&(n=!1),Kr(r)&&Kr(e)&&(n=!0),n){var a=r.constructor.name,i=e.constructor.name;if(a!==i)throw new Error("Arrays are of different type. Actual: ".concat(a,". ")+"Expected: ".concat(i))}if(Array.isArray(r)&&Array.isArray(e)){var o=Di(r),s=Di(e);if(!to(o,s))throw new Error("Arrays have different shapes. "+"Actual: [".concat(o,"]. Expected: [").concat(s,"]"))}var u=Kr(r)?r:Mo(r),c=Kr(e)?e:Mo(e);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: ".concat(u.length," vs ")+"expected: ".concat(c.length,`.
`)+"Actual:   ".concat(u,`.
`)+"Expected: ".concat(c,"."));for(var l=0;l<c.length;++l){var f=u[l],h=c[l];if(!t(f,h))throw new Error("Arrays differ: actual[".concat(l,"] = ").concat(f,", expected[").concat(l,"] = ").concat(h,`.
`)+"Actual:   ".concat(u,`.
`)+"Expected: ".concat(c,"."))}typeof expect<"u"&&expect().nothing()}function Joe(r,e){r().then(function(){return e.fail()},function(){return e()}),typeof expect<"u"&&expect().nothing()}function Qoe(r,e){var t=typeof e=="string"||typeof e=="number"||typeof e=="boolean"?[e]:e;return _o(r)||_o(r[0])||_o(e)||_o(e[0])?Ry(r,t,function(n,a){return n==a}):Ry(r,e,function(n,a){return n0(n,a,0)})}function ese(r,e,t){if(t==null&&(t=r0()),!n0(r,e,t))throw new Error("Numbers differ: actual === ".concat(r,", expected === ").concat(e));typeof expect<"u"&&expect().nothing()}function n0(r,e,t){return!isFinite(r)&&!isFinite(e)?!0:!(isNaN(r)||isNaN(e)||Math.abs(r-e)>t)}function tse(r,e,t){for(var n=0;n<r.length;n++)if(r[n]<e||r[n]>t)throw new Error("Value out of range:".concat(r[n]," low: ").concat(e,", high: ").concat(t))}function rse(r,e){var t=new Float32Array(r),n=new Float32Array(e);if(t.length!==n.length)throw new Error("Expected ArrayBuffer to be of length "+"".concat(n.length,", but it was ").concat(t.length));for(var a=0;a<n.length;a++)if(t[a]!==n[a])throw new Error("Expected ArrayBuffer value at ".concat(a," to be ")+"".concat(n[a]," but got ").concat(t[a]," instead"))}function bR(r){for(var e=0;e<r.length;e++){var t=r[e];Array.isArray(t)?bR(t):r[e]=sf(t)}return r}function nse(r){var e=document.createElement("video");return"playsInline"in e&&(e.playsInline=!0),e.muted=!0,e.loop=!0,e.style.position="fixed",e.style.left="0px",e.style.top="0px",e.preload="auto",e.appendChild(r),new Promise(function(t){e.addEventListener("loadeddata",function(n){return t(e)}),e.load()})}function ase(r){return je(this,void 0,void 0,function(){return Xe(this,function(e){switch(e.label){case 0:return[4,r.play()];case 1:return e.sent(),"requestVideoFrameCallback"in r?[4,new Promise(function(t){r.requestVideoFrameCallback(t)})]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})}var ise={__proto__:null,TEST_EPSILON_FLOAT16:yR,createVideoElement:nse,encodeStrings:bR,expectArrayBuffersEqual:rse,expectArraysClose:Zoe,expectArraysEqual:Qoe,expectNumbersClose:ese,expectPromiseToFail:Joe,expectValuesInRange:tse,play:ase,testEpsilon:r0};var a0=function(){function r(e,t,n,a,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);var o=i||Math.random();this.random=t0.alea(o.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,a=!1;!a;){var i=void 0,o=void 0,s=void 0;do i=2*this.random()-1,o=2*this.random()-1,s=i*i+o*o;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*i*u,n=this.mean+this.stdDev*o*u,(!this.truncated||this.isValidTruncated(t))&&(a=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)},r.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},r.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},r}(),ose=function(){function r(e,t,n,a){this.alpha=e,this.beta=1/t,this.dtype=n;var i=a||Math.random();this.randu=t0.alea(i.toString()),this.randn=new a0(0,1,n,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var e,t,n,a,i,o;;){do a=this.randn.nextValue(),o=1+this.c*a;while(o<=0);if(o*=o*o,e=a*a,t=1-.331*e*e,n=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<t||Math.log(i)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},r.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},r}(),sse=function(){function r(e,t,n,a){e===void 0&&(e=0),t===void 0&&(t=1);var i=this;if(this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=n,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(e," - ").concat(t," <= 1 and dtype is not float"));this.random=t0.alea(a)}return r.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r}();function use(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n="float32"),Kn(r),t==null&&(t=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error("Unsupported data type ".concat(n));for(var i=new ose(e,t,n,a),o=Ji(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var cse=U({randomGamma_:use});function lse(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),Kn(r),n!=null&&n==="bool")throw new Error("Unsupported data type ".concat(n));for(var i=new a0(e,t,n,!1,a),o=Ji(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var wR=U({randomNormal_:lse});function fse(r,e,t){if(e!=null&&e==="bool")throw new Error("Unsupported data type ".concat(e));return wR(r,0,1,e,t)}var hse=U({randomStandardNormal_:fse});function pse(r,e,t,n,a){e===void 0&&(e=0),t===void 0&&(t=1),n===void 0&&(n="float32"),Kn(r);for(var i=Ji(r,n),o=new sse(e,t,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}var i0=U({randomUniform_:pse});function dse(r,e,t,n){return i0(r,e,t,"int32",n)}var vse=U({randomUniformInt_:dse});function Ql(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t===0)throw new Error("Cannot have a step of zero");var a={start:r,stop:e,step:t,dtype:n};return H.runKernel(c3,{},a)}function mse(r){var e=P(r,"input","real"),t={input:e};return H.runKernel(l3,t)}var ef=U({real_:mse});function gse(r){var e=P(r,"x","reciprocal"),t={x:e};return H.runKernel(f3,t)}var yse=U({reciprocal_:gse});function bse(r){var e=P(r,"x","relu"),t={x:e};return H.runKernel(h3,t)}var ld=U({relu_:bse});function wse(r){var e=P(r,"x","relu6"),t={x:e};return H.runKernel(m3,t)}var xR=U({relu6_:wse});function xse(r,e){var t=P(r,"x","reverse"),n={x:t},a={dims:e};return H.runKernel(g3,n,a)}var Cs=U({reverse_:xse});function kse(r){var e=P(r,"x","reverse");return q(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(e.rank,".")}),Cs(e,0)}var Sse=U({reverse1d_:kse});function Nse(r,e){var t=P(r,"x","reverse");return q(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(t.rank,".")}),Cs(t,e)}var Tse=U({reverse2d_:Nse});function Ese(r,e){var t=P(r,"x","reverse");return q(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(t.rank,".")}),Cs(t,e)}var Ise=U({reverse3d_:Ese});function Cse(r,e){var t=P(r,"x","reverse");return q(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(t.rank,".")}),Cs(t,e)}var Ase=U({reverse4d_:Cse});function Dse(r){var e=P(r,"x","round"),t={x:e};return H.runKernel(y3,t)}var kR=U({round_:Dse});function _se(r){var e=P(r,"x","rsqrt","float32"),t={x:e};return H.runKernel(b3,t)}var Fse=U({rsqrt_:_se});function Rse(r){var e=P(r,"x","selu"),t={x:e};return H.runKernel(N3,t)}var Ose=U({selu_:Rse});function Pse(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC");var s=P(r,"x","separableConv2d"),u=P(e,"depthwiseFilter","separableConv2d"),c=P(t,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(s.rank===3&&(f=!0,l=me(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");q(l.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(l.rank,".")}),q(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),q(c.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),q(c.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(c.shape[0],".")}),q(c.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(c.shape[1],".")});var h=u.shape[2],p=u.shape[3];q(c.shape[2]===h*p,function(){return"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(h*p,", ")+"but got ".concat(c.shape[2],".")});var d=Yy(l,u,n,a,o,i),m=1,v=id(d,c,m,"valid",o);return f?me(v,[v.shape[1],v.shape[2],v.shape[3]]):v}var Mse=U({separableConv2d_:Pse});function Bse(r,e){return je(this,void 0,void 0,function(){var t,n,a,i,o,s,l,u,c,l,f;return Xe(this,function(h){switch(h.label){case 0:return t=P(r,"x","setdiff1d"),n=P(e,"y","setdiff1d"),q(t.dtype===n.dtype,function(){return"x and y should have the same dtype, but got x (".concat(t.dtype,") and y (").concat(n.dtype,").")}),q(t.rank===1,function(){return"x should be 1D tensor, but got x (".concat(t.shape,").")}),q(n.rank===1,function(){return"y should be 1D tensor, but got y (".concat(n.shape,").")}),[4,t.data()];case 1:return a=h.sent(),[4,n.data()];case 2:for(i=h.sent(),o=new Set(i),s=0,l=0;l<a.length;l++)o.has(a[l])||s++;for(u=new Hp([s],t.dtype),c=new Hp([s],"int32"),l=0,f=0;l<a.length;l++)o.has(a[l])||(u.values[f]=a[l],c.values[f]=l,f++);return[2,[u.toTensor(),c.toTensor()]]}})})}var Lse=Bse;function zse(r){var e=P(r,"x","sign"),t={x:e};return H.runKernel(C3,t)}var $se=U({sign_:zse});function qse(r){var e=P(r,"x","sin","float32"),t={x:e};return H.runKernel(E3,t)}var Wse=U({sin_:qse});function Vse(r){var e=P(r,"x","sinh"),t={x:e};return H.runKernel(I3,t)}var Use=U({sinh_:Vse});function Gse(r,e,t){var n=P(r,"x","slice1d");return q(n.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(n.rank," tensor")}),sr(n,[e],[t])}var Hse=U({slice1d_:Gse});function Kse(r,e,t){var n=P(r,"x","slice2d");return q(n.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(n.rank," tensor")}),sr(n,e,t)}var jse=U({slice2d_:Kse});function Xse(r,e,t){var n=P(r,"x","slice3d");return q(n.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(n.rank," tensor")}),sr(n,e,t)}var Yse=U({slice3d_:Xse});function Zse(r,e,t){var n=P(r,"x","slice4d");return q(n.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(n.rank," tensor")}),sr(n,e,t)}var Jse=U({slice4d_:Zse});function Qse(r,e){e===void 0&&(e=-1);var t=P(r,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and dim was ").concat(e));var n={logits:t},a={dim:e};return H.runKernel(P3,n,a)}var eue=U({softmax_:Qse});function tue(r){q(r.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(r.dtype,".")});var e={input:r};return H.runKernel(f_,e)}var o0=U({fft_:tue});function rue(r){q(r.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(r.dtype,".")});var e={input:r};return H.runKernel(x_,e)}var Zp=U({ifft_:rue});function nue(r){var e=r.shape[r.shape.length-1],t=r.size/e,n;if(e<=2){var a=me(r,[t,e]);n=Zp(a)}else{var i=[t,2*(e-1)],o=me(ef(r),[t,e]),s=me(ud(r),[t,e]),u=Cs(sr(o,[0,1],[t,e-2]),1),c=Me(Cs(sr(s,[0,1],[t,e-2]),1),$t(-1)),l=Hn([o,u],1),f=Hn([s,c],1),a=me(Bo(l,f),[i[0],i[1]]);n=Zp(a)}if(n=ef(n),r.rank===3&&r.shape[0]!==0){var h=n,p=r.shape[0];n=me(n,[p,n.shape[0]/p,n.shape[1]]),h.dispose()}return n}var SR=U({irfft_:nue});function aue(r,e,t){t===void 0&&(t=0);var n=P(r,"x","split"),a={x:n},i={numOrSizeSplits:e,axis:t};return H.runKernel(O3,a,i)}var tf=U({split_:aue});function iue(r,e){q(r.dtype==="float32",function(){return"The dtype for rfft() must be real value but got ".concat(r.dtype)});var t=r.shape[r.shape.length-1],n=r.size/t,a;if(e!=null&&e<t){var i=r.shape.map(function(g){return 0}),o=r.shape.map(function(g){return g});o[r.shape.length-1]=e,a=sr(r,i,o),t=e}else if(e!=null&&e>t){var s=r.shape.map(function(g){return g});s[r.shape.length-1]=e-t,a=Hn([r,nc(s)],r.shape.length-1),t=e}else a=r;var u=da(a),c=me(Bo(a,u),[n,t]),l=o0(c),f=Math.floor(t/2)+1,h=ef(l),p=ud(l),d=tf(h,[f,t-f],h.shape.length-1),m=tf(p,[f,t-f],p.shape.length-1),v=a.shape.slice();return v[a.shape.length-1]=f,me(Bo(d[0],m[0]),v)}var s0=U({rfft_:iue});function oue(r,e){var t,n=P(r,"a","squaredDifference"),a=P(e,"b","squaredDifference");t=Se(gr(n,a),2),n=t[0],a=t[1],Br(n.shape,a.shape);var i={a:n,b:a},o={};return H.runKernel(q3,i,o)}var NR=U({squaredDifference_:oue});function sue(r,e){var t=P(r,"x","squeeze","string_or_numeric");return me(t,aD(t.shape,e).newShape)}var u0=U({squeeze_:sue});function uue(r,e){e===void 0&&(e=0);var t=Kl(r,"tensors","stack","string_or_numeric");q(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&q(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var n=t,a={axis:e};return H.runKernel(t3,n,a)}var rf=U({stack_:uue});function cue(r,e){e===void 0&&(e=0);var t=P(r,"x","step"),n={x:t},a={alpha:e};return H.runKernel(rF,n,a)}var TR=U({step_:cue});function lue(r,e,t,n,a,i,o,s,u){a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),u===void 0&&(u=0);var c=P(r,"x","stridedSlice","string_or_numeric"),l={x:c},f={begin:e,end:t,strides:n,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return H.runKernel(V3,l,f)}var fue=U({stridedSlice_:lue});function hue(r){var e=P(r,"x","tan","float32"),t={x:e};return H.runKernel(j3,t)}var pue=U({tan_:hue});function ii(r,e){As(r);var t=Di(r,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");var n=null;return zo(r,n,t,e)}function Wl(r,e,t){if(As(r),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var n=Di(r,t);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return zo(r,e,n,t)}function ER(r,e,t){if(As(r),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var n=Di(r,t);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return zo(r,e,n,t)}function due(r,e,t){if(As(r),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var n=Di(r,t);if(n.length!==4&&n.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return zo(r,e,n,t)}function vue(r,e,t){if(As(r),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var n=Di(r,t);if(n.length!==5&&n.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return zo(r,e,n,t)}function mue(r,e,t){if(As(r),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var n=Di(r,t);if(n.length!==6&&n.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||n,zo(r,e,n,t)}function c0(r,e,t){var n=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(t.shape)+", indices.shape: ".concat(e.shape,", shape: ").concat(r)+", sliceDim: ".concat(n,", and batchDim: ").concat(a,".");if(t.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(r.length<n+(t.rank-a))throw new Error(i+" Output shape length < ".concat(n+(t.rank-a)));if(t.rank!==a+r.length-n)throw new Error(i+" update.rank != ".concat(a+r.length-n));for(var o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(t.shape[o],") != indices.shape[").concat(o,"] (").concat(e.shape[o],")."));for(var o=0;o<t.rank-a;++o)if(t.shape[o+a]!==r[o+n])throw new Error(i+" updates.shape[".concat(o+a,"] (").concat(t.shape[o+a],") != shape[").concat(o+a,"] (").concat(r[o+a],")"))}function fd(r,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(r.rank,"."));if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(e.dtype));if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(t));if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: ".concat(e.shape));if(r.size===0)throw new Error("Updates specified for empty output. updates shape: ".concat(r.shape))}c0(t,e,r)}function IR(r,e,t){for(var n=e.shape.length,a=n>1?e.shape[n-1]:1,i=t.length,o=1,s=a;s<i;++s)o*=t[s];var u=a<1?1:a,c=Ht(e.shape)/u,l=wt(wt([],Se(ac(t.slice(0,a))),!1),[1],!1),f=Ht(t);return{sliceRank:a,numUpdates:c,sliceSize:o,strides:l,outputSize:f}}var gue={__proto__:null,calculateShapes:IR,validateInput:fd,validateUpdateShape:c0};function yue(r,e,t){var n=P(r,"tensor","tensorScatterupdate"),a=P(e,"indices","tensorScatterupdate","int32"),i=P(t,"updates","tensorScatterupdate");if(fd(i,a,n.shape),n.dtype!==i.dtype)throw new Error("tensor and updates must have the same dtype, instead they are ".concat(n.dtype," and ").concat(i.dtype,"."));var o={tensor:n,indices:a,updates:i},s={};return H.runKernel(x3,o,s)}var bue=U({tensorScatterUpdate_:yue});function wue(r,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var n=P(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=n.shape[n.shape.length-1];if(e<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(e));if(e>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") ")+"but got ".concat(e));var i={x:n},o={k:e,sorted:t},s=Se(H.runKernel(Y3,i,o),2),u=s[0],c=s[1];return{values:u,indices:c}}var xue=U({topk_:wue});function kue(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),Kn(r),n!=null&&n==="bool")throw new Error("Unsupported data type $ { dtype }");for(var i=new a0(e,t,n,!0,a),o=Ji(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var Sue=U({truncatedNormal_:kue});function Nue(r,e){e===void 0&&(e=0);var t=P(r,"x","unique","string_or_numeric");q(t.rank>0,function(){return"The input tensor must be at least 1D"});var n={x:t},a={axis:e},i=Se(H.runKernel(J3,n,a),2),o=i[0],s=i[1];return{values:o,indices:s}}var Tue=U({unique_:Nue});function Eue(r,e,t){var n=P(r,"x","unsortedSegmentSum"),a=P(e,"segmentIds","unsortedSegmentSum","int32");q(ec(t),function(){return"numSegments must be of dtype int"});var i={x:n,segmentIds:a},o={numSegments:t};return H.runKernel(eF,i,o)}var Iue=U({unsortedSegmentSum_:Eue});function Cue(r,e){e===void 0&&(e=0);var t=P(r,"x","unstack","string_or_numeric");q(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = ".concat(e," is not in [-").concat(t.shape.length,", ").concat(t.shape.length,")")});var n={value:t},a={axis:e};return H.runKernel(Q3,n,a)}var l0=U({unstack_:Cue});function Aue(r,e){return e0(r,e,"right")}function Due(r,e,t,n){return e===void 0&&(e=!0),H.makeVariable(r,e,t,n)}function CR(r,e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(n);for(var a=Ji(r,"int32"),i=Ji([t.length,r.length],"int32"),n=0;n<t.length;n++){var o=a.indexToLoc(t[n]),s=n*r.length;i.values.set(o,s)}return i.toTensor()}function _ue(r){return je(this,void 0,void 0,function(){var e,t,n;return Xe(this,function(a){switch(a.label){case 0:return e=P(r,"condition","whereAsync","bool"),[4,e.data()];case 1:return t=a.sent(),n=CR(e.shape,t),r!==e&&e.dispose(),[2,n]}})})}var AR=_ue;function Fue(r,e,t){return je(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p,d,m;return Xe(this,function(v){switch(v.label){case 0:for(n=P(r,"tensor","boolMask"),a=P(e,"mask","boolMask","bool"),i=t??0,o=a.rank,s=n.shape,q(o>0,function(){return"mask cannot be scalar"}),bn(s.slice(i,i+o),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+o;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+o)),f=me(n,l),h=me(a,[-1]),[4,AR(h)];case 1:return p=v.sent(),d=u0(p,[1]),m=ZF(f,d,i),r!==n&&n.dispose(),e!==a&&a.dispose(),d.dispose(),f.dispose(),h.dispose(),p.dispose(),[2,m]}})})}var Rue=Fue;function Oue(r,e,t){var n=P(r,"x","transpose");if(e==null&&(e=n.shape.map(function(o,s){return s}).reverse()),q(n.rank===e.length,function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of perm ".concat(e,".")}),e.forEach(function(o){q(o>=0&&o<n.rank,function(){return"All entries in 'perm' must be between 0 and ".concat(n.rank-1)+" but got ".concat(e)})}),n.rank<=1)return n.clone();var a={x:n},i={perm:e};return n.dtype==="complex64"?Mr(function(){var o=ef(n),s=ud(n);return o=H.runKernel(Pp,{x:o},i),s=H.runKernel(Pp,{x:s},i),t&&(s=Ai(s)),Bo(o,s)}):H.runKernel(Pp,a,i)}var Jp=U({transpose_:Oue});function Pue(r,e,t,n,a){a===void 0&&(a=!0);var i=P(r,"v","movingAverage"),o=P(e,"x","movingAverage"),s=P(t,"decay","movingAverage");gF(i,o),q(to(i.shape,o.shape),function(){return"Shape mismatch in v and x"});var u=$t(1),c=bt(u,s),l=Me(bt(o,i),c);if(a){q(n!=null,function(){return"When using zeroDebias: true, step is required."});var f=P(n,"step","movingAverage");l=Gt(l,bt(u,Zl(s,f)))}return ct(i,l)}var Mue=U({movingAverage_:Pue});function Bue(r,e,t){Kn(t);var n=P(r,"indices","scatterND","int32"),a=P(e,"updates","scatterND");fd(a,n,t);var i={indices:n,updates:a},o={shape:t};return H.runKernel(w3,i,o)}var Lue=U({scatterND_:Bue});function zue(r,e,t,n){if(r.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+" but the dtype was ".concat(r.dtype,"."));if(r.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+" but got shape ".concat(r.shape,"."));var a=r.rank>0?r.shape[0]:1,i=r.rank>1?r.shape[1]:1;if(t.length!==i)throw new Error("outputShape has incorrect number of elements:,"+" ".concat(t.length,", should be: ").concat(i,"."));var o=e.size;if(!(e.rank===0||e.rank===1&&o===a))throw new Error("sparseValues has incorrect shape "+"".concat(e.shape,", should be [] or [").concat(a,"]"));if(e.dtype!==n.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function $ue(r,e,t,n){n===void 0&&(n=0),Kn(t);var a=P(r,"sparseIndices","sparseToDense","int32"),i=P(e,"sparseValues","sparseToDense","string_or_numeric"),o=P(n,"defaultValue","sparseToDense",i.dtype);zue(a,i,t,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:t};return H.runKernel($3,s,u)}var que=U({sparseToDense_:$ue});function Wue(r,e){var t=P(e,"indices","gatherND","int32"),n=P(r,"x","gatherND","string_or_numeric"),a={params:n,indices:t};return H.runKernel(y_,a)}var Vue=U({gatherND_:Wue});function Uue(r,e){if(e==null)return r.shape.slice();if(to(r.shape,e))return e;if(r.shape.length===e.length){for(var t=[],n=0;n<r.shape.length;n++)e[n]==null&&r.shape[n]!=null?t.push(r.shape[n]):t.push(e[n]);return t}return e}function Gue(r,e,t,n){var a=P(r,"x","dropout");if(q(a.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(a.dtype," tensor instead.")}),q(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got ".concat(e,".")}),e===0)return r instanceof Ar?a.clone():a;var i=Uue(a,t),o=1-e,s=Gt(YF(ct(i0(i,0,1,"float32",n),o)),o);return Me(a,s)}var Hue=U({dropout_:Gue});function DR(r){return Math.floor(Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))))}function f0(r,e,t){for(var n=1-r%2,a=new Float32Array(r),i=0;i<r;++i){var o=2*Math.PI*i/(r+n-1);a[i]=e-t*Math.cos(o)}return ii(a,"float32")}function Kue(r,e,t){return t===void 0&&(t=1),je(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p,d,m,v,v;return Xe(this,function(g){switch(g.label){case 0:return n=P(r,"predictions","inTopK"),a=P(e,"targets","inTopK"),q(n.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, "+"but got ".concat(n.rank)}),q(n.rank-1===a.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+"".concat(n.rank," and targets rank ").concat(a.rank)}),bn(n.shape.slice(0,n.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=n.shape[n.shape.length-1],q(t>0&&t<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last "+"dimension (".concat(i,"), but got ").concat(t)}),[4,n.data()];case 1:return o=g.sent(),[4,a.data()];case 2:for(s=g.sent(),u=Se([o.length/i,i],2),c=u[0],l=u[1],f=iD("bool",c),h=0;h<c;h++){for(p=h*l,d=o.subarray(p,p+l),m=[],v=0;v<d.length;v++)m.push({value:d[v],index:v});for(m.sort(function(y,w){return w.value-y.value}),f[h]=0,v=0;v<t;v++)if(m[v].index===s[h]){f[h]=1;break}}return r!==n&&n.dispose(),e!==a&&a.dispose(),[2,Xu(f,a.shape,"bool")]}})})}var jue=Kue;function Xue(r,e,t,n,a,i,o){i===void 0&&(i="NHWC");var s=r;r.rank===3&&(s=me(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=me(e,[1,e.shape[0],e.shape[1],e.shape[2]])),q(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")}),q(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")}),q(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(t,".")});var c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];q(c===t[2],function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(t[2],".")}),q(l===t[3],function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(t[3],").")}),_a("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return H.runKernel($D,f,h)}var Yue=U({conv2DBackpropFilter_:Xue});function hd(r,e,t){if(t==null||t==="linear")return r;if(t==="relu")return Me(r,TR(e));throw new Error("Cannot compute gradient for fused activation ".concat(t,"."))}function pd(r,e){var t=e,n=Zy(r.shape,e.shape);return n.length>0&&(t=Ut(t,n)),me(t,r.shape)}function dd(r,e,t,n){if(e==="linear")return r;if(e==="relu")return ld(r);if(e==="elu")return HF(r);if(e==="relu6")return xR(r);if(e==="prelu")return lR(r,t);if(e==="leakyrelu")return QF(r,n);if(e==="sigmoid")return Ju(r);throw new Error("Unknown fused activation ".concat(e,"."))}var vd=function(r,e){var t=r>0;return!t||e==="linear"};function Zue(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,c=u===void 0?[1,1]:u,l=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,m=r.leakyreluAlpha;if(p=p||"linear",vd(H.state.gradientDepth,p)===!1){q(s==="NHWC",function(){return"Error in fused conv2d: got dataFormat of ".concat(s," but ")+"only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."});var v=id(t,n,a,i,s,c,l);return f!=null&&(v=ct(v,f)),dd(v,p,d,m)}var g=P(t,"x","conv2d","float32"),y=P(n,"filter","conv2d","float32"),w=g,b=!1;g.rank===3&&(b=!0,w=me(g,[1,g.shape[0],g.shape[1],g.shape[2]])),q(w.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(w.rank,".")}),q(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(y.rank,".")}),_a("fused conv2d",i,l);var x=s==="NHWC"?w.shape[3]:w.shape[1];q(y.shape[2]===x,function(){return"Error in conv2d: depth of input (".concat(x,") must match ")+"input depth for filter ".concat(y.shape[2],".")}),q(ro(a,c),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(a," and dilations '").concat(c,"'")});var S=cf(w.shape,y.shape,a,c,i,l),T;f!=null&&(T=P(f,"bias","fused conv2d"),e=Se(gr(T,g),1),T=e[0],s==="NHWC"?Br(S.outShape,T.shape):(q(T.shape.length<=1,function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+"rank-".concat(T.shape.length,".")}),q(T.shape.length===0||T.shape[0]===S.outChannels||T.shape[0]===1,function(){return"Error in fused conv2d: bias shape (".concat(T.shape,") is not ")+"compatible with the number of output channels "+"(".concat(S.outChannels,")")})));var E;if(d!=null){var C=d.shape;if(q(C.length<=1||C.length===3,function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+"rank-".concat(C.length,".")}),C.length===1)q(C[0]===1||C[0]===S.outChannels,function(){return"Error in fused conv2d: PReLU activation weights "+"(".concat(C,") is not compatible with the number of output ")+"channels (".concat(S.outChannels,").")});else if(C.length===3)try{Br(C,S.outShape)}catch{var R="Error in fused conv2d: PReLU activation weights (".concat(C,") ")+"is not compatible with the output shape of the conv2d "+"(".concat(S.outShape,").");throw Error(R)}E=P(d,"prelu weights","fused conv2d")}var _=function(B,W){q(s==="NHWC",function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(s," but only NHWC is currently supported.")});var X=Se(W,4),J=X[0],V=X[1],j=X[2],ne=X[3],re=hd(B,j,p);q(Yl(c),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(c,"'")});var oe=VF(V.shape,re,J,a,i),le=Yue(V,re,J.shape,a,i),de=[oe,le];if(ne!=null){var ke=pd(ne,re);de.push(ke)}return de},O={x:w,filter:y,bias:T,preluActivationWeights:E},$={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:p,leakyreluAlpha:m};if(f==null){var z=_i(function(B,W,X){var J=H.runKernel(dy,O,$);return X([W,B,J]),b&&(J=me(J,[J.shape[1],J.shape[2],J.shape[3]])),{value:J,gradFunc:_}});return z(w,y)}else{var L=_i(function(B,W,X,J){var V=H.runKernel(dy,O,$);return J([W,B,V,X]),b&&(V=me(V,[V.shape[1],V.shape[2],V.shape[3]])),{value:V,gradFunc:_}});return L(w,y,T)}}var Jue=U({fusedConv2d_:Zue});function Que(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=r;r.rank===3&&(s=me(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=me(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={x:s,dy:u},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return H.runKernel(JD,c,l)}var ece=U({depthwiseConv2dNativeBackpropFilter_:Que});function tce(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=me(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={dy:s,filter:t},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,inputShape:r},f=H.runKernel(QD,c,l);return u?me(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var rce=U({depthwiseConv2dNativeBackpropInput_:tce});function nce(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,c=u===void 0?[1,1]:u,l=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,m=r.leakyreluAlpha;if(vd(H.state.gradientDepth,p)===!1){var v=Yy(t,n,a,i,s,c,l);return f!=null&&(v=ct(v,f)),dd(v,p,d,m)}var g=P(t,"x","depthwiseConv2d","float32"),y=P(n,"filter","depthwiseConv2d","float32"),w=g,b=!1;g.rank===3&&(b=!0,w=me(g,[1,g.shape[0],g.shape[1],g.shape[2]])),q(w.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(w.rank,".")}),q(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+"but got rank ".concat(y.rank,".")}),q(w.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels "+"(".concat(w.shape[3],") must match the inChannels dimension in ")+"filter ".concat(y.shape[2],".")}),c==null&&(c=[1,1]),q(ro(a,c),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+"be 1. Got strides ".concat(a," and dilations '").concat(c,"'")}),_a("fused depthwiseConv2d",i,l);var x=cf(w.shape,y.shape,a,c,i,l,!0),S;f!=null&&(S=P(f,"bias","fused conv2d"),e=Se(gr(S,g),1),S=e[0],Br(x.outShape,S.shape));var T;d!=null&&(T=P(d,"prelu weights","fused depthwiseConv2d"));var E=function($,z){q(Yl(c),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(c,"'")});var L=Se(z,4),B=L[0],W=L[1],X=L[2],J=L[3],V=hd($,X,p),j=rce(W.shape,V,B,a,i,c,l),ne=ece(W,V,B.shape,a,i,c,l);if(J!=null){var re=pd(S,V);return[j,ne,re]}return[j,ne]},C={x:w,filter:y,bias:S,preluActivationWeights:T},R={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:p,leakyreluAlpha:m};if(f==null){var _=_i(function($,z,L){var B=H.runKernel(vy,C,R);return L([z,$,B]),b&&(B=me(B,[B.shape[1],B.shape[2],B.shape[3]])),{value:B,gradFunc:E}});return _(w,y)}else{var O=_i(function($,z,L,B){var W=H.runKernel(vy,C,R);return B([z,$,W,L]),b&&(W=me(W,[W.shape[1],W.shape[2],W.shape[3]])),{value:W,gradFunc:E}});return O(w,y,S)}}var ace=U({fusedDepthwiseConv2d_:nce});function ice(r){var e,t,n=r.a,a=r.b,i=r.transposeA,o=i===void 0?!1:i,s=r.transposeB,u=s===void 0?!1:s,c=r.bias,l=r.activation,f=l===void 0?"linear":l,h=r.preluActivationWeights,p=r.leakyreluAlpha,d=p===void 0?.2:p;if(vd(H.state.gradientDepth,f)===!1){var m=Rt(n,a,o,u);return c!=null&&(m=ct(m,c)),dd(m,f,h,d)}var v=P(n,"a","fused matMul"),g=P(a,"b","fused matMul");e=Se(gr(v,g),2),v=e[0],g=e[1];var y=o?v.shape[v.rank-2]:v.shape[v.rank-1],w=u?g.shape[g.rank-1]:g.shape[g.rank-2],b=o?v.shape[v.rank-1]:v.shape[v.rank-2],x=u?g.shape[g.rank-2]:g.shape[g.rank-1],S=v.shape.slice(0,-2),T=g.shape.slice(0,-2),E=Ht(S),C=Ht(T);q(y===w,function(){return"Error in fused matMul: inner shapes (".concat(y,") and (")+"".concat(w,") of Tensors with shapes ").concat(v.shape," and ")+"".concat(g.shape," and transposeA=").concat(o)+" and transposeB=".concat(u," must match.")});var R=Br(v.shape.slice(0,-2),g.shape.slice(0,-2)),_=R.concat([b,x]),O=o?me(v,[E,y,b]):me(v,[E,b,y]),$=u?me(g,[C,x,w]):me(g,[C,w,x]),z;c!=null&&(z=P(c,"bias","fused matMul"),t=Se(gr(z,v),1),z=t[0],Br(_,z.shape));var L;h!=null&&(L=P(h,"prelu weights","fused matMul"));var B=function(j,ne){var re=Se(ne,4),oe=re[0],le=re[1],de=re[2],ke=re[3],he=hd(me(j,de.shape),de,f),ye,xe;if(!o&&!u?(ye=Rt(he,le,!1,!0),xe=Rt(oe,he,!0,!1)):!o&&u?(ye=Rt(he,le,!1,!1),xe=Rt(he,oe,!0,!1)):o&&!u?(ye=Rt(le,he,!1,!0),xe=Rt(oe,he,!1,!1)):(ye=Rt(le,he,!0,!0),xe=Rt(he,oe,!0,!0)),c!=null){var De=pd(ke,he);return[ye,xe,De]}else return[ye,xe]},W={a:O,b:$,bias:z,preluActivationWeights:L},X={transposeA:o,transposeB:u,activation:f,leakyreluAlpha:d};if(c==null){var J=_i(function(j,ne,re){var oe=H.runKernel(py,W,X);return re([j,ne,oe]),{value:me(oe,_),gradFunc:B}});return J(O,$)}else{var V=_i(function(j,ne,re,oe){var le=H.runKernel(py,W,X);return oe([j,ne,le,re]),{value:me(le,_),gradFunc:B}});return V(O,$,z)}}var oce=U({fusedMatMul_:ice});var sce={__proto__:null,conv2d:Jue,depthwiseConv2d:ace,matMul:oce};function uce(r){return f0(r,.54,.46)}var cce=U({hammingWindow_:uce});function lce(r){return f0(r,.5,.5)}var _R=U({hannWindow_:lce});function fce(r,e,t,n,a){n===void 0&&(n=!1),a===void 0&&(a=0);for(var i=0,o=[];i+e<=r.size;)o.push(sr(r,i,e)),i+=t;if(n)for(;i<r.size;){var s=i+e-r.size,u=Hn([sr(r,i,e-s),lf([s],a)]);o.push(u),i+=t}return o.length===0?Wl([],[0,e]):me(Hn(o),[o.length,e])}var FR=U({frame_:fce});function hce(r,e,t,n,a){a===void 0&&(a=_R),n==null&&(n=DR(e));var i=FR(r,e,t),o=Me(i,a(e));return s0(o,n)}var pce=U({stft_:hce});function dce(r,e,t,n,a,i){a===void 0&&(a="bilinear"),i===void 0&&(i=0);var o=P(r,"image","cropAndResize"),s=P(e,"boxes","cropAndResize","float32"),u=P(t,"boxInd","cropAndResize","int32"),c=s.shape[0];q(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),q(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] ")+"but had shape ".concat(s.shape,".")}),q(u.rank===1&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] ")+"but had shape ".concat(s.shape,".")}),q(n.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(n.length,".")}),q(n[0]>=1&&n[1]>=1,function(){return"cropSize must be atleast [1,1], but was ".concat(n)}),q(a==="bilinear"||a==="nearest",function(){return"method must be bilinear or nearest, but was ".concat(a)});var l={image:o,boxes:s,boxInd:u},f={method:a,extrapolationValue:i,cropSize:n},h=H.runKernel(jD,l,f);return h}var vce=U({cropAndResize_:dce});function mce(r){var e=P(r,"image","flipLeftRight","float32");q(e.rank===4,function(){return"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(e.rank,".")});var t={image:e},n=H.runKernel(p_,t,{});return n}var gce=U({flipLeftRight_:mce});function yce(r){var e=P(r,"image","grayscaleToRGB"),t=e.rank-1,n=e.shape[t];q(e.rank>=2,function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(e.rank,".")}),q(n===1,function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(n,".")});var a=new Array(e.rank);return a.fill(1,0,t),a[t]=3,ql(e,a)}var bce=U({grayscaleToRGB_:yce});function wce(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=.5);var a=P(r,"image","rotateWithOffset","float32");q(a.rank===4,function(){return"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,".")});var i={image:a},o={radians:e,fillValue:t,center:n},s=H.runKernel(nF,i,o);return s}var xce=U({rotateWithOffset_:wce});function ic(r,e,t,n,a,i){n==null&&(n=.5),a==null&&(a=Number.NEGATIVE_INFINITY),i==null&&(i=0);var o=r.shape[0];return t=Math.min(t,o),q(0<=n&&n<=1,function(){return"iouThreshold must be in [0, 1], but was '".concat(n,"'")}),q(r.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '".concat(r.rank,"'")}),q(r.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(r.shape[1])}),q(e.rank===1,function(){return"scores must be a 1D tensor"}),q(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(e.shape[0])}),q(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")}),{maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i}}function kce(r,e,t,n,a){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var i=P(r,"boxes","nonMaxSuppression","float32"),o=P(e,"scores","nonMaxSuppression","float32"),s=ic(i,o,t,n,a);t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:n,scoreThreshold:a};return H.runKernel(Y_,{boxes:i,scores:o},u)}var Sce=U({nonMaxSuppression_:kce});function Nce(r,e,t){var n=Tce(r,e,t),a=n<0?-(n+1):n;r.splice(a,0,e)}function Tce(r,e,t){return Ice(r,e,t||Ece)}function Ece(r,e){return r>e?1:r<e?-1:0}function Ice(r,e,t){for(var n=0,a=r.length,i=0,o=!1;n<a;){i=n+(a-n>>>1);var s=t(e,r[i]);s>0?n=i+1:(a=i,o=!s)}return o?n:-n-1}function RR(r,e,t,n,a){return h0(r,e,t,n,a,0)}function OR(r,e,t,n,a,i){return h0(r,e,t,n,a,0,!1,i,!0)}function PR(r,e,t,n,a,i){return h0(r,e,t,n,a,i,!0)}function h0(r,e,t,n,a,i,o,s,u){o===void 0&&(o=!1),s===void 0&&(s=!1),u===void 0&&(u=!1);for(var c=[],l=0;l<e.length;l++)e[l]>a&&c.push({score:e[l],boxIndex:l,suppressBeginIndex:0});c.sort(KA);for(var f=i>0?-.5/i:0,h=[],p=[];h.length<t&&c.length>0;){var d=c.pop(),m=d.score,v=d.boxIndex,g=d.suppressBeginIndex;if(m<a)break;for(var y=!1,w=h.length-1;w>=g;--w){var b=Cce(r,v,h[w]);if(b>=n){y=!0;break}if(d.score=d.score*Ace(n,f,b),d.score<=a)break}d.suppressBeginIndex=h.length,y||(d.score===m?(h.push(v),p.push(d.score)):d.score>a&&Nce(c,d,KA))}var x=h.length,S=t-x;s&&S>0&&(h.push.apply(h,wt([],Se(new Array(S).fill(0)),!1)),p.push.apply(p,wt([],Se(new Array(S).fill(0)),!1)));var T={selectedIndices:h};return o&&(T.selectedScores=p),u&&(T.validOutputs=x),T}function Cce(r,e,t){var n=r.subarray(e*4,e*4+4),a=r.subarray(t*4,t*4+4),i=Math.min(n[0],n[2]),o=Math.min(n[1],n[3]),s=Math.max(n[0],n[2]),u=Math.max(n[1],n[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),f=Math.max(a[0],a[2]),h=Math.max(a[1],a[3]),p=(s-i)*(u-o),d=(f-c)*(h-l);if(p<=0||d<=0)return 0;var m=Math.max(i,c),v=Math.max(o,l),g=Math.min(s,f),y=Math.min(u,h),w=Math.max(g-m,0)*Math.max(y-v,0);return w/(p+d-w)}function Ace(r,e,t){var n=Math.exp(e*t*t);return t<=r?n:0}function KA(r,e){return r.score-e.score||r.score===e.score&&e.boxIndex-r.boxIndex}function Dce(r,e,t,n,a){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),je(this,void 0,void 0,function(){var i,o,s,u,c,l,f;return Xe(this,function(h){switch(h.label){case 0:return i=P(r,"boxes","nonMaxSuppressionAsync"),o=P(e,"scores","nonMaxSuppressionAsync"),s=ic(i,o,t,n,a),t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold,[4,Promise.all([i.data(),o.data()])];case 1:return u=h.sent(),c=u[0],l=u[1],f=RR(c,l,t,n,a).selectedIndices,i!==r&&i.dispose(),o!==e&&o.dispose(),[2,ii(f,"int32")]}})})}var _ce=Dce;function Fce(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var o=P(r,"boxes","nonMaxSuppression"),s=P(e,"scores","nonMaxSuppression"),u=ic(o,s,t,n,a,i);t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma;var c={boxes:o,scores:s},l={maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i},f=H.runKernel(J_,c,l);return{selectedIndices:f[0],selectedScores:f[1]}}var Rce=U({nonMaxSuppressionWithScore_:Fce});function Oce(r,e,t,n,a,i){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),je(this,void 0,void 0,function(){var o,s,u,c,l,f,h,p,d;return Xe(this,function(m){switch(m.label){case 0:return o=P(r,"boxes","nonMaxSuppressionAsync"),s=P(e,"scores","nonMaxSuppressionAsync"),u=ic(o,s,t,n,a,i),t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return c=m.sent(),l=c[0],f=c[1],h=PR(l,f,t,n,a,i),p=h.selectedIndices,d=h.selectedScores,o!==r&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:ii(p,"int32"),selectedScores:ii(d)}]}})})}var Pce=Oce;function Mce(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1);var o=P(r,"boxes","nonMaxSuppression"),s=P(e,"scores","nonMaxSuppression"),u=ic(o,s,t,n,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,h={boxes:o,scores:s},p={maxOutputSize:c,iouThreshold:l,scoreThreshold:f,padToMaxOutputSize:i},d=H.runKernel(Z_,h,p);return{selectedIndices:d[0],validOutputs:d[1]}}var Bce=U({nonMaxSuppressionPadded_:Mce});function Lce(r,e,t,n,a,i){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1),je(this,void 0,void 0,function(){var o,s,u,c,l,f,h,p,d,m,v,g;return Xe(this,function(y){switch(y.label){case 0:return o=P(r,"boxes","nonMaxSuppressionAsync"),s=P(e,"scores","nonMaxSuppressionAsync"),u=ic(o,s,t,n,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,[4,Promise.all([o.data(),s.data()])];case 1:return h=Se.apply(void 0,[y.sent(),2]),p=h[0],d=h[1],m=OR(p,d,c,l,f,i),v=m.selectedIndices,g=m.validOutputs,o!==r&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:ii(v,"int32"),validOutputs:$t(g,"int32")}]}})})}var zce=Lce;function $ce(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=P(r,"images","resizeBilinear");q(a.rank===3||a.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),q(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(e,".")}),q(n===!1||t===!1,function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=me(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Se(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},c=H.runKernel(v3,s,u);return o?me(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var qce=U({resizeBilinear_:$ce});function Wce(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=P(r,"images","resizeNearestNeighbor");q(a.rank===3||a.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),q(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(e,".")}),q(a.dtype==="float32"||a.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"}),q(n===!1||t===!1,function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=me(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Se(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},c=H.runKernel(d3,s,u);return o?me(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var Vce=U({resizeNearestNeighbor_:Wce});function Uce(r,e,t,n){var a;e===void 0&&(e="binary"),t===void 0&&(t=!1),n===void 0&&(n=.5);var i=P(r,"image","threshold"),o=.2989,s=.587,u=.114,c=i.shape[0]*i.shape[1],l=Me(ii([n]),255),f,h,p,d;if(q(i.rank===3,function(){return"Error in threshold: image must be rank 3,"+"but got rank ".concat(i.rank,".")}),q(i.shape[2]===3||i.shape[2]===1,function(){return"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(i.shape[2],".")}),q(i.dtype==="int32"||i.dtype==="float32",function(){return"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(i.dtype,".")}),q(e==="otsu"||e==="binary",function(){return"Method must be binary or otsu, but was ".concat(e)}),i.shape[2]===3){a=Se(tf(i,[1,1,1],-1),3),f=a[0],h=a[1],p=a[2];var m=Me(f,o),v=Me(h,s),g=Me(p,u);d=ct(ct(m,v),g)}else d=r;if(e==="otsu"){var y=WF(mr(kR(d),"int32"),Xu([]),256);l=Gce(y,c)}var w=t?Qy(d,l):sd(d,l),b=mr(Me(w,255),"int32");return b}function Gce(r,e){for(var t=ii([-1]),n=ii([0]),a=ii([0]),i,o,s,u,c,l,f=0;f<r.size-1;f++){i=sr(r,0,f+1),o=sr(r,f+1),c=Gt(Ut(i),e),l=Gt(Ut(o),e);var h=Ut(Me(i,Ql(0,i.size)));s=Gt(h,Ut(i));var p=lf(o.shape,i.size),d=ct(Ql(0,o.size),p),m=Me(o,d);u=Gt(Ut(m),Ut(o));var v=bt(s,u),g=bt(s,u),y=Me(c,l);a=Me(Me(y,v),g);var w=sd(a,n);n=Oo(w,a,n),t=Oo(w,ii([f]),t)}return t}var Hce=U({threshold_:Uce});function Kce(r,e,t,n,a,i){t===void 0&&(t="nearest"),n===void 0&&(n="constant"),a===void 0&&(a=0);var o=P(r,"image","transform","float32"),s=P(e,"transforms","transform","float32");q(o.rank===4,function(){return"Error in transform: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),q(s.rank===2&&(s.shape[0]===o.shape[0]||s.shape[0]===1)&&s.shape[1]===8,function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"}),q(i==null||i.length===2,function(){return"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(i,".")});var u={image:o,transforms:s},c={interpolation:t,fillMode:n,fillValue:a,outputShape:i};return H.runKernel(Z3,u,c)}var jce=U({transform_:Kce});function Xce(r,e,t){var n=P(r,"a","bandPart");q(n.rank>=2,function(){return"bandPart(): Rank must be at least 2, got ".concat(n.rank,".")});var a=n.shape,i=Se(n.shape.slice(-2),2),o=i[0],s=i[1],u,c;typeof e=="number"?(q(e%1===0,function(){return"bandPart(): numLower must be an integer, got ".concat(e,".")}),q(e<=o,function(){return"bandPart(): numLower (".concat(e,")")+" must not be greater than the number of rows (".concat(o,").")}),u=P(e<0?o:e,"numLower","bandPart")):(q(e.dtype==="int32",function(){return"bandPart(): numLower's dtype must be an int32."}),u=Oo(_y(e,0),o,Yp(e,o))),typeof t=="number"?(q(t%1===0,function(){return"bandPart(): numUpper must be an integer, got ".concat(t,".")}),q(t<=s,function(){return"bandPart(): numUpper (".concat(t,")")+" must not be greater than the number of columns (".concat(s,").")}),c=P(t<0?s:t,"numUpper","bandPart")):(q(t.dtype==="int32",function(){return"bandPart(): numUpper's dtype must be an int32."}),c=Oo(_y(t,0),s,Yp(t,s)));var l=me(Ql(0,o,1,"int32"),[-1,1]),f=Ql(0,s,1,"int32"),h=bt(l,f),p=jp(Qy(h,u),JF(h,Ai(c))),d=nc([o,s],n.dtype);return me(rf(l0(me(n,[-1,o,s])).map(function(m){return Oo(p,m,d)})),a)}var Yce=U({bandPart_:Xce});function Zce(r){var e;if(Array.isArray(r)){e=!1,q(r!=null&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=r[0].shape[0],n=function(u){q(r[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(r[u].shape[0]," vs. ").concat(t,")")})},a=1;a<r.length;++a)n(a)}else e=!0,r=tf(r,r.shape[0],0).map(function(u){return u0(u,[0])});q(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors (".concat(r.length,") exceeds ")+"number of dimensions (".concat(r[0].shape[0],").")});for(var i=[],o=r,s=function(u){i.push(H.tidy(function(){var c=o[u];if(u>0)for(var l=0;l<u;++l){var f=Me(Ut(Me(i[l],c)),i[l]);c=bt(c,f)}return Gt(c,od(c,"euclidean"))}))},a=0;a<r.length;++a)s(a);return e?rf(i,0):i}var Jce=U({gramSchmidt_:Zce});function Qce(r,e){if(e===void 0&&(e=!1),q(r.rank>=2,function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(r.rank)}),r.rank===2)return jA(r,e);var t=r.shape.slice(0,r.shape.length-2).reduce(function(u,c){return u*c}),n=l0(me(r,[t,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),a=[],i=[];n.forEach(function(u){var c=Se(jA(u,e),2),l=c[0],f=c[1];a.push(l),i.push(f)});var o=me(rf(a,0),r.shape),s=me(rf(i,0),r.shape);return[o,s]}function jA(r,e){return e===void 0&&(e=!1),H.tidy(function(){q(r.shape.length===2,function(){return"qr2d() requires a 2D Tensor, but got a ".concat(r.shape.length,"D Tensor.")});for(var t=r.shape[0],n=r.shape[1],a=XF(t),i=Ss(r),o=Wl([[1]],[1,1]),s=Ss(o),u=t>=n?n:t,c=function(f){var h,p=i,d=s,m=a;h=Se(H.tidy(function(){var v=sr(i,[f,f],[t-f,1]),g=od(v),y=sr(i,[f,f],[1,1]),w=Oo(sd(y,0),Wl([[-1]]),Wl([[1]])),b=bt(y,Me(w,g)),x=Gt(v,b);x.shape[0]===1?s=Ss(o):s=Hn([o,sr(x,[1,0],[x.shape[0]-1,x.shape[1]])],0);var S=Ai(Gt(Rt(w,b),g)),T=sr(i,[f,0],[t-f,n]),E=Me(S,s),C=Jp(s);if(f===0)i=bt(T,Rt(E,Rt(C,T)));else{var R=bt(T,Rt(E,Rt(C,T)));i=Hn([sr(i,[0,0],[f,n]),R],0)}var _=Jp(E),O=sr(a,[0,f],[t,a.shape[1]-f]);if(f===0)a=bt(O,Rt(Rt(O,s),_));else{var $=bt(O,Rt(Rt(O,s),_));a=Hn([sr(a,[0,0],[t,f]),$],1)}return[s,i,a]}),3),s=h[0],i=h[1],a=h[2],Cn([p,d,m])},l=0;l<u;++l)c(l);return!e&&t>n&&(a=sr(a,[0,0],[t,n]),i=sr(i,[0,0],[n,n])),[a,i]})}var ele=U({qr_:Qce});A.Reduction=void 0;(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(A.Reduction||(A.Reduction={}));function tle(r,e,t){t===void 0&&(t=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var n=P(r,"losses","computeWeightedLoss"),a=null;e!=null&&(a=P(e,"weights","computeWeightedLoss"));var i=a==null?n:Me(n,a);if(t===A.Reduction.NONE)return i;if(t===A.Reduction.SUM)return Ut(i);if(t===A.Reduction.MEAN){if(a==null)return Xp(i);var o=n.size/a.size,s=Gt(Ut(i),Ut(a));return o>1?Gt(s,$t(o)):s}if(t===A.Reduction.SUM_BY_NONZERO_WEIGHTS){if(a==null)return Gt(Ut(i),$t(n.size));var u=Me(a,ks(n.shape)),c=mr(Ut(uR(u,$t(0))),"float32");return Gt(Ut(i),c)}throw Error("Unknown reduction: ".concat(t))}var no=U({computeWeightedLoss_:tle});function rle(r,e,t,n){n===void 0&&(n=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=P(r,"labels","absoluteDifference"),i=P(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=P(t,"weights","absoluteDifference")),bn(a.shape,i.shape,"Error in absoluteDifference: ");var s=pa(bt(a,i));return no(s,o,n)}var nle=U({absoluteDifference_:rle});function ale(r,e,t,n,a){a===void 0&&(a=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=P(r,"labels","cosineDistance"),o=P(e,"predictions","cosineDistance"),s=null;n!=null&&(s=P(n,"weights","cosineDistance")),bn(i.shape,o.shape,"Error in cosineDistance: ");var u=$t(1),c=bt(u,Ut(Me(i,o),t,!0));return no(c,s,a)}var ile=U({cosineDistance_:ale});function ole(r,e,t,n){n===void 0&&(n=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=P(r,"labels","hingeLoss"),i=P(e,"predictions","hingeLoss"),o=null;t!=null&&(o=P(t,"weights","hingeLoss")),bn(a.shape,i.shape,"Error in hingeLoss: ");var s=$t(1);a=bt(Me($t(2),a),s);var u=ld(bt(s,Me(a,i)));return no(u,o,n)}var sle=U({hingeLoss_:ole});function ule(r,e,t,n,a){n===void 0&&(n=1),a===void 0&&(a=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=P(r,"labels","huberLoss"),o=P(e,"predictions","huberLoss"),s=null;t!=null&&(s=P(t,"weights","huberLoss")),bn(i.shape,o.shape,"Error in huberLoss: ");var u=$t(n),c=pa(bt(o,i)),l=Yp(c,u),f=bt(c,l),h=ct(Me($t(.5),oi(l)),Me(u,f));return no(h,s,a)}var cle=U({huberLoss_:ule});function lle(r,e,t,n,a){n===void 0&&(n=1e-7),a===void 0&&(a=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=P(r,"labels","logLoss"),o=P(e,"predictions","logLoss"),s=null;t!=null&&(s=P(t,"weights","logLoss")),bn(i.shape,o.shape,"Error in logLoss: ");var u=$t(1),c=$t(n),l=Ai(Me(i,Jl(ct(o,c)))),f=Me(bt(u,i),Jl(ct(bt(u,o),c))),h=bt(l,f);return no(h,s,a)}var fle=U({logLoss_:lle});function hle(r,e,t,n){n===void 0&&(n=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=P(r,"labels","meanSquaredError"),i=P(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=P(t,"weights","meanSquaredError")),bn(a.shape,i.shape,"Error in meanSquaredError: ");var s=NR(a,i);return no(s,o,n)}var ple=U({meanSquaredError_:hle});function dle(r,e){var t=P(r,"labels","sigmoidCrossEntropyWithLogits"),n=P(e,"logits","sigmoidCrossEntropyWithLogits");bn(t.shape,n.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=ld(n),i=Me(n,t),o=eR(Is(Ai(pa(n))));return ct(bt(a,i),o)}function vle(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=P(r,"multiClassLabels","sigmoidCrossEntropy"),o=P(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=P(t,"weights","sigmoidCrossEntropy")),bn(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),n>0){var u=$t(n),c=$t(1),l=$t(.5);i=ct(Me(i,bt(c,u)),Me(l,u))}var f=dle(i,o);return no(f,s,a)}var mle=U({sigmoidCrossEntropy_:vle});function gle(r,e,t){if(t===void 0&&(t=-1),t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(e.rank," ")+"and dim was ".concat(t));var n=_i(function(a,i,o){var s=!0,u=nR(i,[t],s),c=bt(mr(i,"float32"),u);o([a,c]);var l=Ai(Me(c,a)),f=Ut(l,[t]),h=function(p,d){var m=Se(d,2),v=m[0],g=m[1],y=ff(p.shape,[t]);return[Me(me(p,y),bt(mr(v,"float32"),Is(g))),Me(me(p,y),bt(Is(g),mr(v,"float32")))]};return{value:f,gradFunc:h}});return n(r,e)}function yle(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=P(r,"onehotLabels","softmaxCrossEntropy"),o=P(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=P(t,"weights","softmaxCrossEntropy")),bn(i.shape,o.shape,"Error in softmaxCrossEntropy: "),n>0){var u=$t(n),c=$t(1),l=$t(i.shape[1]);i=ct(Me(i,bt(c,u)),Gt(u,l))}var f=gle(i,o);return no(f,s,a)}var ble=U({softmaxCrossEntropy_:yle});function wle(r,e,t,n){var a=P(r,"indices","sparseFillEmptyRows","int32"),i=P(e,"values","sparseFillEmptyRows"),o=P(t,"denseShape","sparseFillEmptyRows","int32"),s=P(n,"defaultValue","sparseFillEmptyRows",i.dtype);if(a.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        `.concat(a.shape));if(i.rank!==1)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(o.rank!==1)throw new Error("Dense shape should be Tensor1D but received shape ".concat(o.shape));if(s.rank!==0)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));var u={indices:a,values:i,denseShape:o,defaultValue:s},c=H.runKernel(M3,u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}var xle=U({sparseFillEmptyRows_:wle});function kle(r,e,t){var n=P(r,"inputIndices","sparseReshape","int32"),a=P(e,"inputShape","sparseReshape","int32"),i=P(t,"newShape","sparseReshape","int32");if(n.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        `.concat(n.shape));if(a.rank!==1)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(i.rank!==1)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));var o={inputIndices:n,inputShape:a,newShape:i},s=H.runKernel(B3,o);return{outputIndices:s[0],outputShape:s[1]}}var Sle=U({sparseReshape_:kle});function Nle(r,e,t){var n=P(r,"data","sparseSegmentMean"),a=P(e,"indices","sparseSegmentMean","int32"),i=P(t,"segmentIds","sparseSegmentMean","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          `.concat(i.shape));var o={data:n,indices:a,segmentIds:i};return H.runKernel(L3,o)}var Tle=U({sparseSegmentMean_:Nle});function Ele(r,e,t){var n=P(r,"data","sparseSegmentSum"),a=P(e,"indices","sparseSegmentSum","int32"),i=P(t,"segmentIds","sparseSegmentSum","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         `.concat(i.shape));var o={data:n,indices:a,segmentIds:i};return H.runKernel(z3,o)}var Ile=U({sparseSegmentSum_:Ele});function Cle(r,e,t,n,a,i,o,s){var u=P(r,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error("Data must be a vector, saw: ".concat(u.shape));var c=P(e,"dataSplits","stringNGrams");if(c.dtype!=="int32")throw new Error("Data splits must be of datatype int32");var l={separator:t,nGramWidths:n,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},f={data:u,dataSplits:c},h=H.runKernel(U3,f,l);return{nGrams:h[0],nGramsSplits:h[1]}}var Ale=U({stringNGrams_:Cle});function Dle(r,e,t){t===void 0&&(t=!0);var n=P(r,"input","stringSplit","string"),a=P(e,"delimiter","stringSplit","string");if(n.rank!==1)throw new Error("Input should be Tensor1D but received shape ".concat(n.shape));if(a.rank!==0)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));var i={skipEmpty:t},o={input:n,delimiter:a},s=H.runKernel(G3,o,i);return{indices:s[0],values:s[1],shape:s[2]}}var _le=U({stringSplit_:Dle});function Fle(r,e){var t=P(r,"input","stringToHashBucketFast","string"),n={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");var a={input:t};return H.runKernel(H3,a,n)}var Rle=U({stringToHashBucketFast_:Fle});function Ole(r,e,t,n){n===void 0&&(n=!0);var a=P(r,"input","staticRegexReplace","string"),i={pattern:e,rewrite:t,replaceGlobal:n};return H.runKernel(W3,{x:a},i)}var Ple=U({staticRegexReplace_:Ole});var Mle={fft:o0,ifft:Zp,rfft:s0,irfft:SR},Ble={hammingWindow:cce,hannWindow:_R,frame:FR,stft:pce},Lle={flipLeftRight:gce,grayscaleToRGB:bce,resizeNearestNeighbor:Vce,resizeBilinear:qce,rotateWithOffset:xce,cropAndResize:vce,nonMaxSuppression:Sce,nonMaxSuppressionAsync:_ce,nonMaxSuppressionWithScore:Rce,nonMaxSuppressionWithScoreAsync:Pce,nonMaxSuppressionPadded:Bce,nonMaxSuppressionPaddedAsync:zce,threshold:Hce,transform:jce},zle={bandPart:Yce,gramSchmidt:Jce,qr:ele},$le={absoluteDifference:nle,computeWeightedLoss:no,cosineDistance:ile,hingeLoss:sle,huberLoss:cle,logLoss:fle,meanSquaredError:ple,sigmoidCrossEntropy:mle,softmaxCrossEntropy:ble},qle={sparseFillEmptyRows:xle,sparseReshape:Sle,sparseSegmentMean:Tle,sparseSegmentSum:Ile},Wle={stringNGrams:Ale,stringSplit:_le,stringToHashBucketFast:Rle,staticRegexReplace:Ple};var MR=function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(e,t){return new e(t)},r}(),BR=function(){function r(){this.classNameMap={}}return r.getMap=function(){return r.instance==null&&(r.instance=new r),r.instance},r.register=function(e){r.getMap().classNameMap[e.className]=[e,e.fromConfig]},r}();function LR(r){q(r.className!=null,function(){return"Class being registered does not have the static className property defined."}),q(typeof r.className=="string",function(){return"className is required to be a string, but got type "+typeof r.className}),q(r.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),BR.register(r)}var Vle={__proto__:null,Serializable:MR,SerializationMap:BR,registerClass:LR},qo=function(r){eo(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.minimize=function(t,n,a){n===void 0&&(n=!1);var i=this.computeGradients(t,a),o=i.value,s=i.grads;if(a!=null){var u=a.map(function(c){return{name:c.name,tensor:s[c.name]}});this.applyGradients(u)}else this.applyGradients(s);return Cn(s),n?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!1,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,n){return tR(t,n)},e.prototype.dispose=function(){this.iterations_!=null&&Cn(this.iterations_)},e.prototype.saveIterations=function(){return je(this,void 0,void 0,function(){return Xe(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:$t(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){return Xe(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){return Xe(this,function(n){throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()))})})},e.prototype.extractIterations=function(t){return je(this,void 0,void 0,function(){var n;return Xe(this,function(a){switch(a.label){case 0:return n=this,[4,t[0].tensor.data()];case 1:return n.iterations_=a.sent()[0],[2,t.slice(1)]}})})},e}(MR);Object.defineProperty(qo,Symbol.hasInstance,{value:function(r){return r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null}});var p0=function(r){eo(e,r);function e(t,n,a){a===void 0&&(a=null);var i=r.call(this)||this;return i.learningRate=t,i.rho=n,i.epsilon=a,i.accumulatedGrads=[],i.accumulatedUpdates=[],a==null&&(i.epsilon=H.backend.epsilon()),i}return Object.defineProperty(e,"className",{get:function(){return"Adadelta"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=H.registeredVariables[i],u=!1;n.accumulatedGrads[o]==null&&(n.accumulatedGrads[o]={originalName:"".concat(i,"/accum_grad"),variable:Mr(function(){return da(s).variable(u)})}),n.accumulatedUpdates[o]==null&&(n.accumulatedUpdates[o]={originalName:"".concat(i,"/accum_var"),variable:Mr(function(){return da(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=n.accumulatedGrads[o].variable,f=n.accumulatedUpdates[o].variable;Mr(function(){var h=ct(Me(l,n.rho),Me(oi(c),1-n.rho)),p=Me(Gt(Qi(ct(f,n.epsilon)),Qi(ct(l,n.epsilon))),c),d=ct(Me(f,n.rho),Me(oi(p),1-n.rho));l.assign(h),f.assign(d);var m=ct(Me(p,-n.learningRate),s);s.assign(m)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Cn(this.accumulatedGrads.map(function(t){return t.variable})),Cn(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){var t;return Xe(this,function(n){switch(n.label){case 0:return t=wt(wt([],Se(this.accumulatedGrads),!1),Se(this.accumulatedUpdates),!1),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){var n,a;return Xe(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=t.length/2,a=!1,this.accumulatedGrads=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedUpdates=t.slice(n,n*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.rho,n.epsilon)},e}(qo),d0=function(r){eo(e,r);function e(t,n){n===void 0&&(n=.1);var a=r.call(this)||this;return a.learningRate=t,a.initialAccumulatorValue=n,a.accumulatedGrads=[],a}return Object.defineProperty(e,"className",{get:function(){return"Adagrad"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=H.registeredVariables[i];if(n.accumulatedGrads[o]==null){var u=!1;n.accumulatedGrads[o]={originalName:"".concat(i,"/accumulator"),variable:Mr(function(){return lf(s.shape,n.initialAccumulatorValue).variable(u)})}}var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=n.accumulatedGrads[o].variable;Mr(function(){var f=ct(l,oi(c));l.assign(f);var h=ct(Me(Gt(c,Qi(ct(f,H.backend.epsilon()))),-n.learningRate),s);s.assign(h)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&Cn(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){return Xe(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){var n;return Xe(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),n=!1,this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(n)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,n){return new t(n.learningRate,n.initialAccumulatorValue)},e}(qo),v0=function(r){eo(e,r);function e(t,n,a,i){i===void 0&&(i=null);var o=r.call(this)||this;return o.learningRate=t,o.beta1=n,o.beta2=a,o.epsilon=i,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],Mr(function(){o.accBeta1=$t(n).variable(),o.accBeta2=$t(a).variable()}),i==null&&(o.epsilon=H.backend.epsilon()),o}return Object.defineProperty(e,"className",{get:function(){return"Adam"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Mr(function(){var i=bt(1,n.accBeta1),o=bt(1,n.accBeta2);a.forEach(function(s,u){var c=H.registeredVariables[s],l=!1;n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:Mr(function(){return da(c).variable(l)})}),n.accumulatedSecondMoment[u]==null&&(n.accumulatedSecondMoment[u]={originalName:"".concat(s,"/v"),variable:Mr(function(){return da(c).variable(l)})});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=n.accumulatedFirstMoment[u].variable,p=n.accumulatedSecondMoment[u].variable,d=ct(Me(h,n.beta1),Me(f,1-n.beta1)),m=ct(Me(p,n.beta2),Me(oi(f),1-n.beta2)),v=Gt(d,i),g=Gt(m,o);h.assign(d),p.assign(m);var y=ct(Me(Gt(v,ct(Qi(g),n.epsilon)),-n.learningRate),c);c.assign(y)}}),n.accBeta1.assign(Me(n.accBeta1,n.beta1)),n.accBeta2.assign(Me(n.accBeta2,n.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Cn(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&Cn(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){var t;return Xe(this,function(n){switch(n.label){case 0:return t=wt(wt([],Se(this.accumulatedFirstMoment),!1),Se(this.accumulatedSecondMoment),!1),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){var n,a,i=this;return Xe(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),Mr(function(){i.accBeta1.assign(Zl(i.beta1,i.iterations_+1)),i.accBeta2.assign(Zl(i.beta2,i.iterations_+1))}),n=t.length/2,a=!1,this.accumulatedFirstMoment=t.slice(0,n).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),this.accumulatedSecondMoment=t.slice(n,n*2).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon)},e}(qo),m0=function(r){eo(e,r);function e(t,n,a,i,o){i===void 0&&(i=null),o===void 0&&(o=0);var s=r.call(this)||this;return s.learningRate=t,s.beta1=n,s.beta2=a,s.epsilon=i,s.decay=o,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],Mr(function(){s.iteration=$t(0).variable(),s.accBeta1=$t(n).variable()}),i==null&&(s.epsilon=H.backend.epsilon()),s}return Object.defineProperty(e,"className",{get:function(){return"Adamax"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Mr(function(){var i=bt(1,n.accBeta1),o=Gt(-n.learningRate,ct(Me(n.iteration,n.decay),1));a.forEach(function(s,u){var c=H.registeredVariables[s],l=!1;n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:da(c).variable(l)}),n.accumulatedWeightedInfNorm[u]==null&&(n.accumulatedWeightedInfNorm[u]={originalName:"".concat(s,"/v"),variable:da(c).variable(l)});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=n.accumulatedFirstMoment[u].variable,p=n.accumulatedWeightedInfNorm[u].variable,d=ct(Me(h,n.beta1),Me(f,1-n.beta1)),m=Me(p,n.beta2),v=pa(f),g=sR(m,v);h.assign(d),p.assign(g);var y=ct(Me(Gt(o,i),Gt(d,ct(g,n.epsilon))),c);c.assign(y)}}),n.iteration.assign(ct(n.iteration,1)),n.accBeta1.assign(Me(n.accBeta1,n.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Cn(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&Cn(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){return Xe(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){return Xe(this,function(n){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)},e}(qo),md=function(r){eo(e,r);function e(t){var n=r.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return Object.defineProperty(e,"className",{get:function(){return"SGD"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=H.registeredVariables[i];Mr(function(){var c=ct(Me(n.c,s),u);u.assign(c)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=PF($t(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){return Xe(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){return Xe(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:if(t=n.sent(),t.length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,n){return new t(n.learningRate)},e}(qo),g0=function(r){eo(e,r);function e(t,n,a){a===void 0&&(a=!1);var i=r.call(this,t)||this;return i.learningRate=t,i.momentum=n,i.useNesterov=a,i.accumulations=[],i.m=$t(i.momentum),i}return Object.defineProperty(e,"className",{get:function(){return"Momentum"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=H.registeredVariables[i];if(n.accumulations[o]==null){var u=!1;n.accumulations[o]={originalName:"".concat(i,"/momentum"),variable:Mr(function(){return da(s).variable(u)})}}var c=n.accumulations[o].variable,l=Array.isArray(t)?t[o].tensor:t[i];l!=null&&Mr(function(){var f,h=ct(Me(n.m,c),l);n.useNesterov?f=ct(Me(n.c,ct(l,Me(h,n.m))),s):f=ct(Me(n.c,h),s),c.assign(h),s.assign(f)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Cn(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){return Xe(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){var n;return Xe(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),n=!1,this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(n)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,n){return new t(n.learningRate,n.momentum,n.useNesterov)},e}(md),y0=function(r){eo(e,r);function e(t,n,a,i,o){n===void 0&&(n=.9),a===void 0&&(a=0),i===void 0&&(i=null),o===void 0&&(o=!1);var s=r.call(this)||this;if(s.learningRate=t,s.decay=n,s.momentum=a,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=o,i==null&&(s.epsilon=H.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return Object.defineProperty(e,"className",{get:function(){return"RMSProp"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=H.registeredVariables[i],u=!1;n.accumulatedMeanSquares[o]==null&&(n.accumulatedMeanSquares[o]={originalName:"".concat(i,"/rms"),variable:Mr(function(){return da(s).variable(u)})}),n.accumulatedMoments[o]==null&&(n.accumulatedMoments[o]={originalName:"".concat(i,"/momentum"),variable:Mr(function(){return da(s).variable(u)})}),n.accumulatedMeanGrads[o]==null&&n.centered&&(n.accumulatedMeanGrads[o]={originalName:"".concat(i,"/mg"),variable:Mr(function(){return da(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=n.accumulatedMeanSquares[o].variable,f=n.accumulatedMoments[o].variable;Mr(function(){var h=ct(Me(l,n.decay),Me(oi(c),1-n.decay));if(n.centered){var p=n.accumulatedMeanGrads[o].variable,d=ct(Me(p,n.decay),Me(c,1-n.decay)),m=Gt(Me(c,n.learningRate),Qi(bt(h,ct(oi(d),n.epsilon)))),v=ct(Me(f,n.momentum),m);l.assign(h),p.assign(d),f.assign(v);var g=bt(s,v);s.assign(g)}else{var y=ct(Me(l,n.decay),Me(oi(c),1-n.decay)),v=ct(Me(f,n.momentum),Gt(Me(c,n.learningRate),Qi(ct(y,n.epsilon))));l.assign(y),f.assign(v);var g=bt(s,v);s.assign(g)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Cn(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&Cn(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&Cn(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){var t;return Xe(this,function(n){switch(n.label){case 0:return t=wt(wt([],Se(this.accumulatedMeanSquares),!1),Se(this.accumulatedMoments),!1),this.centered&&t.push.apply(t,wt([],Se(this.accumulatedMeanGrads),!1)),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){var n,a;return Xe(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=this.centered?t.length/3:t.length/2,a=!1,this.accumulatedMeanSquares=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedMoments=t.slice(n,n*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(n*2,n*3).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,n){return new t(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)},e}(qo),Ule=[p0,d0,v0,m0,g0,y0,md];function Gle(){var r,e;try{for(var t=fn(Ule),n=t.next();!n.done;n=t.next()){var a=n.value;LR(a)}}catch(i){r={error:i}}finally{try{n&&!n.done&&(e=t.return)&&e.call(t)}finally{if(r)throw r.error}}}var Hle="model",Kle=".json",jle=".weights.bin";function XA(r){return new Promise(function(e){return setTimeout(e)}).then(r)}var Qp=function(){function r(e){if(!dt().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(r.URL_SCHEME)&&(e=e.slice(r.URL_SCHEME.length)),(e==null||e.length===0)&&(e=Hle),this.modelJsonFileName=e+Kle,this.weightDataFileName=e+jle}return r.prototype.save=function(e){return je(this,void 0,void 0,function(){var t,n,a,i,o,s,u;return Xe(this,function(c){switch(c.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=$o.join(e.weightData),n=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return a=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i=NF(e,a),o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),s=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor,s.download=this.modelJsonFileName,s.href=o,[4,XA(function(){return s.dispatchEvent(new MouseEvent("click"))})];case 2:return c.sent(),e.weightData==null?[3,4]:(u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor,u.download=this.weightDataFileName,u.href=n,[4,XA(function(){return u.dispatchEvent(new MouseEvent("click"))})]);case 3:c.sent(),c.label=4;case 4:return[2,{modelArtifactsInfo:uf(e)}]}})})},r}();Qp.URL_SCHEME="downloads://";var Xle=function(){function r(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, "+"but received ".concat(e));this.jsonFile=e[0],this.weightsFiles=e.slice(1)}return r.prototype.load=function(){return je(this,void 0,void 0,function(){var e=this;return Xe(this,function(t){return[2,new Promise(function(n,a){var i=new FileReader;i.onload=function(o){var s=JSON.parse(o.target.result),u=s.modelTopology;if(u==null){a(new Error("modelTopology field is missing from file ".concat(e.jsonFile.name)));return}var c=s.weightsManifest;if(c==null){a(new Error("weightManifest field is missing from file ".concat(e.jsonFile.name)));return}if(e.weightsFiles.length===0){n({modelTopology:u});return}var l=jy(s,function(f){return e.loadWeights(f)});n(l)},i.onerror=function(o){return a("Failed to read model topology and weights manifest JSON "+"from file '".concat(e.jsonFile.name,"'. BrowserFiles supports loading ")+"Keras-style tf.Model artifacts only.")},i.readAsText(e.jsonFile)})]})})},r.prototype.loadWeights=function(e){var t,n,a=this,i=[],o=[];try{for(var s=fn(e),u=s.next();!u.done;u=s.next()){var c=u.value;i.push.apply(i,wt([],Se(c.weights),!1)),o.push.apply(o,wt([],Se(c.paths),!1))}}catch(h){t={error:h}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}var l=this.checkManifestAndWeightFiles(e),f=o.map(function(h){return a.loadWeightsFile(h,l[h])});return Promise.all(f).then(function(h){return[i,h]})},r.prototype.loadWeightsFile=function(e,t){return new Promise(function(n,a){var i=new FileReader;i.onload=function(o){var s=o.target.result;n(s)},i.onerror=function(o){return a("Failed to weights data from file of path '".concat(e,"'."))},i.readAsArrayBuffer(t)})},r.prototype.checkManifestAndWeightFiles=function(e){var t,n,a=this,i=[],o=this.weightsFiles.map(function(f){return HA(f.name)}),s={};try{for(var u=fn(e),c=u.next();!c.done;c=u.next()){var l=c.value;l.paths.forEach(function(f){var h=HA(f);if(i.indexOf(h)!==-1)throw new Error("Duplicate file basename found in weights manifest: "+"'".concat(h,"'"));if(i.push(h),o.indexOf(h)===-1)throw new Error("Weight file with basename '".concat(h,"' is not provided."));s[f]=a.weightsFiles[o.indexOf(h)]})}}catch(f){t={error:f}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}if(i.length!==this.weightsFiles.length)throw new Error("Mismatch in the number of files in weights manifest "+"(".concat(i.length,") and the number of weight files provided ")+"(".concat(this.weightsFiles.length,")."));return s},r}(),Yle=function(r){return dt().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Qp.URL_SCHEME)?Zle(r.slice(Qp.URL_SCHEME.length)):null};va.registerSaveRouter(Yle);function Zle(r){return r===void 0&&(r="model"),new Qp(r)}function Jle(r){return new Xle(r)}function YA(r,e,t,n){o(r),t=t??0,n=n??1,s(t,n);var a=0,i=function(u){return u.then(function(c){var l=t+ ++a/r.length*(n-t);return e(l),c}),u};function o(u){q(u!=null&&Array.isArray(u)&&u.length>0,function(){return"promises must be a none empty array"})}function s(u,c){q(u>=0&&u<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(u)}),q(c>=0&&c<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(c)}),q(c>=u,function(){return"startFraction must be no more than endFraction, but "+"got startFraction ".concat(u," and endFraction ")+"".concat(c)})}return Promise.all(r.map(i))}function zR(r,e){return je(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h;return Xe(this,function(p){switch(p.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?dt().platform.fetch:e.fetchFunc,n=r.map(function(d){return t(d,e.requestInit,{isBinary:!0})}),a=0,i=.5,e.onProgress!=null?[3,2]:[4,Promise.all(n)];case 1:return s=p.sent(),[3,4];case 2:return[4,YA(n,e.onProgress,a,i)];case 3:s=p.sent(),p.label=4;case 4:return o=s,u=o.map(function(d){return d.arrayBuffer()}),c=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(u)];case 5:return h=p.sent(),[3,8];case 6:return[4,YA(u,e.onProgress,c,l)];case 7:h=p.sent(),p.label=8;case 8:return f=h,[2,f]}})})}function Qle(r,e,t,n){return e===void 0&&(e=""),je(this,void 0,void 0,function(){var a,i;return Xe(this,function(o){return a=function(s){return zR(s,{requestInit:n})},i=$R(a),[2,i(r,e,t)]})})}function $R(r){var e=this;return function(t,n,a){return n===void 0&&(n=""),je(e,void 0,void 0,function(){var i,o,s,u,c,l,f,h,p,d;return Xe(this,function(m){switch(m.label){case 0:if(i=t.map(function(){return!1}),o={},s=a!=null?a.map(function(){return!1}):[],u=[],t.forEach(function(v,g){var y=0;v.weights.forEach(function(w){var b="quantization"in w?w.quantization.dtype:w.dtype,x=Ny[b]*Ht(w.shape),S=function(){i[g]=!0,o[g]==null&&(o[g]=[]),o[g].push({manifestEntry:w,groupOffset:y,sizeBytes:x})};a!=null?a.forEach(function(T,E){T===w.name&&(S(),s[E]=!0)}):S(),u.push(w.name),y+=x})}),!s.every(function(v){return v}))throw c=a.filter(function(v,g){return!s[g]}),new Error("Could not find weights in manifest with names: "+"".concat(c.join(", "),`. 
`)+"Manifest JSON has weights with names: "+"".concat(u.join(", "),"."));return l=i.reduce(function(v,g,y){return g&&v.push(y),v},[]),f=[],l.forEach(function(v){t[v].paths.forEach(function(g){var y=n+(n.endsWith("/")?"":"/")+g;f.push(y)})}),[4,r(f)];case 1:return h=m.sent(),p={},d=0,l.forEach(function(v){var g=t[v].paths.length,y=new $o(h.slice(d,d+g)),w=o[v];w.forEach(function(b){var x=y.slice(b.groupOffset,b.groupOffset+b.sizeBytes),S=SF(x,[b.manifestEntry]);for(var T in S)p[T]=S[T]}),d+=g}),[2,p]}})})}}var efe="application/octet-stream",tfe="application/json",b0=function(){function r(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(q(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=dt().platform.fetch,q(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&q(e.length===2,function(){return"URL paths for http must have a length of 2, "+"(actual length is ".concat(e.length,").")}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return r.prototype.save=function(e){return je(this,void 0,void 0,function(){var t,n,a,i,o;return Xe(this,function(s){switch(s.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit),t.body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=NF(e,n),t.body.append("model.json",new Blob([JSON.stringify(a)],{type:tfe}),"model.json"),e.weightData!=null&&(i=$o.join(e.weightData),t.body.append("model.weights.bin",new Blob([i],{type:efe}),"model.weights.bin")),[4,this.fetch(this.path,t)];case 1:if(o=s.sent(),o.ok)return[2,{modelArtifactsInfo:uf(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(o.status,"."))}})})},r.prototype.load=function(){return je(this,void 0,void 0,function(){var e,t,n,a,i,o=this;return Xe(this,function(s){switch(s.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(e=s.sent(),!e.ok)throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(e.status,". Please verify this URL points to ")+"the model JSON of the model to load.");s.label=2;case 2:return s.trys.push([2,4,,5]),[4,e.json()];case 3:return t=s.sent(),[3,5];case 4:throw s.sent(),n="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(a=t.modelTopology,i=t.weightsManifest,a==null&&i==null)throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");return[2,jy(t,function(u){return o.loadWeights(u)})]}})})},r.prototype.loadWeights=function(e){return je(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S,T,E;return Xe(this,function(C){switch(C.label){case 0:t=Array.isArray(this.path)?this.path[1]:this.path,n=Se(rfe(t),2),a=n[0],i=n[1],o=this.weightPathPrefix||a,s=EF(e),u=[],c=[];try{for(l=fn(e),f=l.next();!f.done;f=l.next()){h=f.value;try{for(p=(T=void 0,fn(h.paths)),d=p.next();!d.done;d=p.next())m=d.value,this.weightUrlConverter!=null?c.push(this.weightUrlConverter(m)):u.push(o+m+i)}catch(R){T={error:R}}finally{try{d&&!d.done&&(E=p.return)&&E.call(p)}finally{if(T)throw T.error}}}}catch(R){x={error:R}}finally{try{f&&!f.done&&(S=l.return)&&S.call(l)}finally{if(x)throw x.error}}return this.weightUrlConverter?(g=(v=u.push).apply,y=[u],w=[[]],[4,Promise.all(c)]):[3,2];case 1:g.apply(v,y.concat([wt.apply(void 0,w.concat([Se.apply(void 0,[C.sent()]),!1]))])),C.label=2;case 2:return[4,zR(u,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 3:return b=C.sent(),[2,[s,b]]}})})},r}();b0.URL_SCHEME_REGEX=/^https?:\/\//;function rfe(r){var e=r.lastIndexOf("/"),t=r.lastIndexOf("?"),n=r.substring(0,e),a=t>e?r.substring(t):"";return[n+"/",a]}function Oy(r){return r.match(b0.URL_SCHEME_REGEX)!=null}var qR=function(r,e){if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;var t=!0;return Array.isArray(r)?t=r.every(function(n){return Oy(n)}):t=Oy(r),t?w0(r,e):null};va.registerSaveRouter(qR);va.registerLoadRouter(qR);function w0(r,e){return new b0(r,e)}function nfe(r,e){return w0(r,e)}var cy=function(){function r(e){this.modelArtifacts=e}return r.prototype.load=function(){return this.modelArtifacts},r}(),WR=function(){function r(e){this.saveHandler=e}return r.prototype.save=function(e){return this.saveHandler(e)},r}(),afe=function(){function r(e){e.load&&(this.load=function(){return Promise.resolve(e.load())}),e.save&&(this.save=function(t){return Promise.resolve(e.save(t))})}return r}();function ife(r,e,t,n){var a=arguments;return new afe(VR.apply(void 0,wt([],Se(a),!1)))}function VR(r,e,t,n){if(arguments.length===1){var a=r.modelTopology!=null||r.weightSpecs!=null;return a?new cy(r):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new cy({modelTopology:r}))}else return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new cy({modelTopology:r,weightSpecs:e,weightData:t,trainingConfig:n})}function ofe(r){return new WR(r)}function sfe(r){return new WR(r)}var ufe={__proto__:null,CompositeArrayBuffer:$o,browserFiles:Jle,browserHTTPRequest:nfe,concatenateArrayBuffers:Ote,copyModel:rre,decodeWeights:SF,encodeWeights:Dte,fromMemory:ife,fromMemorySync:VR,getLoadHandlers:Wte,getModelArtifactsForJSON:jy,getModelArtifactsForJSONSync:TF,getModelArtifactsInfoForJSON:uf,getSaveHandlers:qte,getWeightSpecs:EF,http:w0,isHTTPScheme:Oy,listModels:ere,loadWeights:Qle,moveModel:nre,registerLoadRouter:$te,registerSaveRouter:zte,removeModel:tre,weightsLoaderFactory:$R,withSaveHandler:ofe,withSaveHandlerSync:sfe};function cfe(r,e,t){var n=P(r,"labels","confusionMatrix"),a=P(e,"predictions","confusionMatrix");q(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, "+"but got ".concat(t)}),q(n.rank===1,function(){return"Expected the rank of labels to be 1, but got ".concat(n.rank)}),q(a.rank===1,function(){return"Expected the rank of predictions to be 1, "+"but got ".concat(a.rank)}),q(n.shape[0]===a.shape[0],function(){return"Mismatch in the number of examples: "+"".concat(n.shape[0]," vs. ").concat(a.shape[0],". ")+"Labels and predictions should have the same number of elements."}),q(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+"".concat(t)});var i=Fy(mr(n,"int32"),t),o=Fy(mr(a,"int32"),t),s=Jp(i),u=Rt(s,o);return mr(u,"int32")}var lfe=U({confusionMatrix_:cfe});var ffe={__proto__:null,confusionMatrix:lfe},ms,ZA=!1;function UR(r,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(r==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,n=!1,a=!1,i=!1,o=!1,s=!1;if(r.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&r instanceof ImageData)n=!0;else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)a=!0;else if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)i=!0;else if(r.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&r instanceof ImageBitmap)s=!0;else throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, "+"but was ".concat(r.constructor.name));var u=Wp(hy,H.backendName);if(u!=null){var c={pixels:r},l={numChannels:e};return H.runKernel(hy,c,l)}var f=Se(a?[r.videoWidth,r.videoHeight]:[r.width,r.height],2),h=f[0],p=f[1],d;if(o)d=r.getContext("2d").getImageData(0,0,h,p).data;else if(n||t)d=r.data;else if(i||a||s){if(ms==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")ms=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else ms=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});ms.canvas.width=h,ms.canvas.height=p,ms.drawImage(r,0,0,h,p),d=ms.getImageData(0,0,h,p).data}var m;if(e===4)m=new Int32Array(d);else{var v=h*p;m=new Int32Array(v*e);for(var g=0;g<v;g++)for(var y=0;y<e;++y)m[g*e+y]=d[g*4+y]}var w=[p,h,e];return ER(m,w,"int32")}function hfe(r){return r!=null&&r.data instanceof Uint8Array}function pfe(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function dfe(r){return r!=null&&r.width!==0&&r.height!==0}function vfe(r){return pfe()&&!(r instanceof ImageBitmap)&&dfe(r)&&!hfe(r)}function mfe(r,e){return e===void 0&&(e=3),je(this,void 0,void 0,function(){var t,n;return Xe(this,function(a){switch(a.label){case 0:if(t=null,!(dt().getBool("WRAP_TO_IMAGEBITMAP")&&vfe(r)))return[3,5];n=void 0,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,createImageBitmap(r,{premultiplyAlpha:"none"})];case 2:return n=a.sent(),[3,4];case 3:return a.sent(),n=null,[3,4];case 4:return n!=null&&n.width===r.width&&n.height===r.height?t=n:t=r,[3,6];case 5:t=r,a.label=6;case 6:return[2,UR(t,e)]}})})}function GR(r){if(r.rank!==2&&r.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank ".concat(r.rank,"."));var e=r.rank===2?1:r.shape[2];if(e>4||e===2)throw new Error("toPixels only supports depth of size "+"1, 3 or 4 but got ".concat(e));if(r.dtype!=="float32"&&r.dtype!=="int32")throw new Error("Unsupported type for toPixels: ".concat(r.dtype,".")+" Please use float32 or int32 tensors.")}function gfe(r){var e=r?.alpha||1;if(e>1||e<0)throw new Error("Alpha value ".concat(e," is suppoed to be in range [0 - 1]."))}function yfe(r,e){return je(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h,p,d,m,v,g;return Xe(this,function(y){switch(y.label){case 0:return t=P(r,"img","toPixels"),r instanceof Ar||(n=t,t=mr(n,"int32"),n.dispose()),GR(t),a=Se(t.shape.slice(0,2),2),i=a[0],o=a[1],s=t.rank===2?1:t.shape[2],[4,t.data()];case 1:for(u=y.sent(),c=t.dtype==="float32"?255:1,l=new Uint8ClampedArray(o*i*4),f=0;f<i*o;++f){for(h=[0,0,0,255],p=0;p<s;p++){if(d=u[f*s+p],t.dtype==="float32"){if(d<0||d>1)throw new Error("Tensor values for a float32 Tensor must be in the "+"range [0 - 1] but encountered ".concat(d,"."))}else if(t.dtype==="int32"&&(d<0||d>255))throw new Error("Tensor values for a int32 Tensor must be in the "+"range [0 - 255] but encountered ".concat(d,"."));s===1?(h[0]=d*c,h[1]=d*c,h[2]=d*c):h[p]=d*c}m=f*4,l[m+0]=Math.round(h[0]),l[m+1]=Math.round(h[1]),l[m+2]=Math.round(h[2]),l[m+3]=Math.round(h[3])}return e!=null&&(ZA||(console.warn("tf.browser.toPixels is not efficient to draw tensor on canvas. Please try tf.browser.draw instead."),ZA=!0),e.width=o,e.height=i,v=e.getContext("2d"),g=new ImageData(l,o,i),v.putImageData(g,0,0)),t!==r&&t.dispose(),[2,l]}})})}function bfe(r,e,t){var n=P(r,"img","draw");if(!(r instanceof Ar)){var a=n;n=mr(a,"int32"),a.dispose()}GR(n),gfe(t?.imageOptions);var i={image:n},o={canvas:e,options:t};H.runKernel(r_,i,o)}var wfe=U({fromPixels_:UR}),xfe={__proto__:null,draw:bfe,fromPixels:wfe,fromPixelsAsync:mfe,toPixels:yfe};function HR(r,e){var t=r.shape.length,n=e.shape.length;if(t<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+" but the rank was ".concat(t,"."));if(n<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(n,"."));if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type,"+" but the dtype was ".concat(e.dtype,"."));if(e.shape[n-1]>t)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+"".concat(e.shape[n-1]," vs. ").concat(t));if(Ht(r.shape)===0)throw new Error("Requested more than 0 entries, but input is empty."+" Input shape: ".concat(r.shape,"."));for(var a=e.shape,i=a[a.length-1],o=1,s=0;s<a.length-1;++s)o*=a[s];var u=r.shape,c=a.slice();c.pop();for(var l=1,s=i;s<t;++s)l*=u[s],c.push(u[s]);var f=wt(wt([],Se(ac(r.shape).map(function(h){return h/l})),!1),[1],!1).slice(0,i);return[c,o,l,f]}var kfe={__proto__:null,prepareAndValidate:HR},Py=-2,Sfe=-1;function Nfe(r,e,t){var n=r.shape.length;q(n===e.length,function(){return"Error in slice".concat(n,"D: Length of begin ").concat(e," must ")+"match the rank of the array (".concat(n,").")}),q(n===t.length,function(){return"Error in slice".concat(n,"D: Length of size ").concat(t," must ")+"match the rank of the array (".concat(n,").")});for(var a=function(o){q(e[o]+t[o]<=r.shape[o],function(){return"Error in slice".concat(n,"D: begin[").concat(o,"] + size[").concat(o,"] ")+"(".concat(e[o]+t[o],") would overflow input.shape[").concat(o,"] (").concat(r.shape[o],")")})},i=0;i<n;++i)a(i)}function Tfe(r){for(var e=[],t=0;r>0;)r&1&&e.push(t),r/=2,t++;return e}function Efe(r,e,t){for(var n=[],a=0;a<r.length;a++)n[a]=Math.ceil((e[a]-r[a])/t[a]);return n}function KR(r,e,t,n){for(var a=wt([],Se(r),!1),i=a.length;i<n.length;i++)a.push(1);for(var i=0;i<t;i++)i===0?a[e]=1:(a.splice(e,0,1),a.pop());return a}function jR(r,e,t){return t<=r?t:t-(e-1)}function XR(r,e){for(var t=[],n=0;n<r;n++)t.push(e+n);return t}function Ife(r,e,t,n,a,i,o,s,u){var c=r.length,l=new Array(c),f=new Array(c),h=new Array(c);if(e.length&&t>0){var p=e[0],d=t+1;l=YR(o,p,d,n,r),f=ZR(s,p,d,a,r),h=KR(i,p,d,r)}else for(var m=0;m<c;m++)l[m]=QR(o,n,i,r,m,u),f[m]=eO(s,a,i,r,m,u),h[m]=JR(i,m,u);return{begin:l,end:f,strides:h}}function YR(r,e,t,n,a){for(var i=wt([],Se(a),!1),o=XR(t,e),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=0;else{var u=jR(e,t,s),c=n[u];r&1<<u&&(c=0),i[s]=c}return i}function ZR(r,e,t,n,a){for(var i=wt([],Se(a),!1),o=XR(t,e),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=Number.MAX_SAFE_INTEGER;else{var u=jR(e,t,s),c=n[u];r&1<<u&&(c=Number.MAX_SAFE_INTEGER),i[s]=c}for(var l=0;l<i.length;l++){var f=a[l];i[l]<0&&(i[l]+=f),i[l]=Vl(0,i[l],a[l])}return i}function JR(r,e,t){var n=r[e];return(t&1<<e||n==null)&&(n=1),n}function QR(r,e,t,n,a,i){var o=e[a],s=t[a]||1;(r&1<<a||i&1<<a||o==null)&&(s>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);var u=n[a];return o<0&&(o+=u),o=Vl(0,o,u-1),o}function eO(r,e,t,n,a,i){var o=e[a],s=t[a]||1;(r&1<<a||i&1<<a||o==null)&&(s>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);var u=n[a];return o<0&&(o+=u),s>0?o=Vl(0,o,u):o=Vl(-1,o,u-1),o}function Cfe(r,e,t){for(var n=t.length,a=0;a<t.length;a++)if(t[a]>1){n=a;break}for(var a=n+1;a<t.length;a++)if(e[a]>0||t[a]!==r[a])return!1;return!0}function Afe(r,e){for(var t=r.length>0?r[r.length-1]:1,n=0;n<r.length-1;n++)t+=r[n]*e[n];return t}function Dfe(r,e,t){var n,a=r.shape.length;typeof e=="number"?n=wt([e],Se(new Array(a-1).fill(0)),!1):e.length<a?n=e.concat(new Array(a-e.length).fill(0)):n=e.slice(),n.forEach(function(o){q(o!==-1,function(){return"slice() does not support negative begin indexing."})});var i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=wt([t],Se(new Array(a-1).fill(-1)),!1):t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map(function(o,s){return o>=0?o:(q(o===-1,function(){return"Negative size values should be exactly -1 but got "+"".concat(o," for the slice() size at index ").concat(s,".")}),r.shape[s]-n[s])}),[n,i]}function _fe(r,e,t,n,a,i,o,s,u){var c;if(n==null?(c=new Array(e.length),c.fill(1)):c=n,o!=null&&(o&o-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");for(var l=!1,f={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:c.slice(),beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u},h=0;h<f.dims;h++)l&&(1<<h&s)!==0&&f.numAddAxisAfterEllipsis++,1<<h&o&&(l=!0);l||(f.ellipsisMask|=1<<f.dims,f.dims++);var p={dims:r.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};Ffe(f,p);for(var d=!0,m=!0,v=!0,g=[],y=[],h=0;h<r.length;++h){if(p.strides[h]===0)throw Error("strides[".concat(h,"] must be non-zero"));var w=!!(p.shrinkAxisMask&1<<h),b=r[h];if(b===-1){g.push(w?1:-1);continue}var x=[p.beginMask&1<<h,p.endMask&1<<h],S=[p.strides[h]>0?0:-1,p.strides[h]>0?b:b-1];if(w&&p.strides[h]<=0)throw Error("only stride 1 allowed on non-range indexing.");v=v&&p.strides[h]===1;var T=!!(p.beginMask&1<<h&&p.endMask&1<<h);if(p.beginValid&&p.endValid){if(w){var E=p.begin[h]<0?b+p.begin[h]:p.begin[h];if(p.begin[h]=E,p.end[h]=p.begin[h]+1,E<0||E>=b)throw Error("slice index ".concat(p.begin[h]," of dimension ").concat(h," out of bounds."))}else p.begin[h]=JA(p.begin[h],0,p.strides[h],b,x,S),p.end[h]=JA(p.end[h],1,p.strides[h],b,x,S);var C=p.strides[h]===1&&p.begin[h]===0&&p.end[h]===b;d=d&&C,m=m&&(h===0&&p.strides[h]===1||C)}else d=d&&p.strides[h]===1&&T,m=m&&(h===0&&p.strides[h]===1||T);var R=void 0,_=!1;if(p.beginValid&&p.endValid?(R=p.end[h]-p.begin[h],_=!0):w?(R=1,_=!0):T&&b>=0&&(p.strides[h]<0?R=-b:R=b,_=!0),_){var O=void 0;R===0||R<0!=p.strides[h]<0?O=0:O=Math.trunc(R/p.strides[h])+(R%p.strides[h]!==0?1:0),g.push(O)}else g.push(-1)}for(var $=0;$<p.finalShapeGatherIndices.length;++$){var z=p.finalShapeGatherIndices[$];z>=0?y.push(g[z]):z===Py&&y.push(1)}var L=y.filter(function(B,W){return p.finalShapeGatherIndices[W]!==Py});return{finalShapeSparse:L,finalShape:y,isIdentity:d,sliceDim0:m,isSimpleSlice:v,begin:p.begin,end:p.end,strides:p.strides}}function Ffe(r,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;var t=0;e.beginValid=r.begin!=null,e.endValid=r.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(var n=0;n<r.dims;n++)if(1<<n&r.ellipsisMask)for(var a=Math.min(e.dims-(r.dims-n)+1+r.numAddAxisAfterEllipsis,e.dims);t<a;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=n;else if(1<<n&r.newAxisMask)e.finalShapeGatherIndices.push(Py),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error("Index out of range using input dim ".concat(t,"; input ")+"has only ".concat(e.dims," dims, ").concat(e.begin.length,"."));r.begin!=null&&(e.begin[t]=r.begin[n]),r.end!=null&&(e.end[t]=r.end[n]),e.strides[t]=r.strides[n],r.beginMask&1<<n&&(e.beginMask|=1<<t),r.endMask&1<<n&&(e.endMask|=1<<t),r.shrinkAxisMask&1<<n?(e.finalShapeGatherIndices.push(Sfe),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(n)),e.inputShapeGatherIndicesSparse[t]=n,t++}}function JA(r,e,t,n,a,i){if(a[e])return t>0?i[e]:i[e+1&1];var o=r<0?n+r:r;return o<i[0]?i[0]:o>i[1]?i[1]:o}var tO={__proto__:null,assertParamsValid:Nfe,computeFlatOffset:Afe,computeOutShape:Efe,getNormalizedAxes:Ife,isSliceContinous:Cfe,maskToAxes:Tfe,parseSliceParams:Dfe,sliceInfo:_fe,startForAxis:QR,startIndicesWithElidedDims:YR,stopForAxis:eO,stopIndicesWithElidedDims:ZR,stridesForAxis:JR,stridesWithElidedDims:KR};var Rfe="4.6.0";var rO=function(){function r(){}return r.sgd=function(e){return new md(e)},r.momentum=function(e,t,n){return n===void 0&&(n=!1),new g0(e,t,n)},r.rmsprop=function(e,t,n,a,i){return t===void 0&&(t=.9),n===void 0&&(n=0),a===void 0&&(a=null),i===void 0&&(i=!1),new y0(e,t,n,a,i)},r.adam=function(e,t,n,a){return e===void 0&&(e=.001),t===void 0&&(t=.9),n===void 0&&(n=.999),a===void 0&&(a=null),new v0(e,t,n,a)},r.adadelta=function(e,t,n){return e===void 0&&(e=.001),t===void 0&&(t=.95),n===void 0&&(n=null),new p0(e,t,n)},r.adamax=function(e,t,n,a,i){return e===void 0&&(e=.002),t===void 0&&(t=.9),n===void 0&&(n=.999),a===void 0&&(a=null),i===void 0&&(i=0),new m0(e,t,n,a,i)},r.adagrad=function(e,t){return t===void 0&&(t=.1),new d0(e,t)},r}();var Ofe=rO;var Pfe=function(){return typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:function(r){return r()}}();function Mfe(){return new Promise(function(r){return Pfe(function(){return r()})})}function Bfe(r,e){var t=r[0].length;r.forEach(function(a,i){q(a.length===t,function(){return"Error in concat".concat(t,"D: rank of tensors[").concat(i,"] must be the same ")+"as the rank of the rest (".concat(t,")")})}),q(e>=0&&e<t,function(){return"Error in concat".concat(t,"D: axis must be between 0 and ").concat(t-1,".")});var n=r[0];r.forEach(function(a,i){for(var o=0;o<t;o++)q(o===e||a[o]===n[o],function(){return"Error in concat".concat(t,"D: Shape of tensors[").concat(i,"] (").concat(a,") ")+"does not match the shape of the rest (".concat(n,") ")+"along the non-concatenated axis ".concat(i,".")})})}function Lfe(r,e){for(var t=r[0].slice(),n=1;n<r.length;n++)t[e]+=r[n][e];return t}var Ci;(function(r){r[r.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",r[r.VALUE_ROWIDS=1]="VALUE_ROWIDS",r[r.ROW_LENGTHS=2]="ROW_LENGTHS",r[r.ROW_SPLITS=3]="ROW_SPLITS",r[r.ROW_LIMITS=4]="ROW_LIMITS",r[r.ROW_STARTS=5]="ROW_STARTS"})(Ci||(Ci={}));function zfe(r,e,t){var n=new Array;if(t==null&&e==null)return n;if(e==null)for(;n.length<r+t.length;)n.push(-1);else n=e.slice();if(t==null)return n;if(r+t.length!==n.length)throw new Error("rt input.shape and shape=".concat(e," are incompatible: rt input.rank = ").concat(r+t.length,", but shape.rank = ").concat(n.length));for(var a=1;a<t.length;++a){var i=t[a],o=n[n.length-t.length+a],s=n[o];if(i>=0)if(s>=0){if(s!==i)throw new Error("rt input.shape and shape=".concat(e," are incompatible: rt input.shape[").concat(a+r,"] = ").concat(i," but shape[").concat(a+r,"] = ").concat(s))}else n[o]=i}return n}function $fe(r){var e,t,n={FIRST_DIM_SIZE:Ci.FIRST_DIM_SIZE,VALUE_ROWIDS:Ci.VALUE_ROWIDS,ROW_LENGTHS:Ci.ROW_LENGTHS,ROW_SPLITS:Ci.ROW_SPLITS,ROW_LIMITS:Ci.ROW_LIMITS,ROW_STARTS:Ci.ROW_STARTS},a=[];try{for(var i=fn(r),o=i.next();!o.done;o=i.next()){var s=o.value;if(s in n)a.push(n[s]);else break}}catch(u){e={error:u}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return a}function qfe(r){return r.length===0?0:r[0]===Ci.FIRST_DIM_SIZE?r.length-1:r.length}function Wfe(r,e){if(!(r==null||e==null)){var t=r.length,n=e.length;if(t>=n)throw new Error("defaultValue.shape=".concat(r," and ragged tensor flatValues.shape=").concat(e,", are incompatible: defaultValue.rank = ").concat(t," must be less than ragged tensor input flatValues.rank = ").concat(n,")"));for(var a=0;a<Math.min(t,n-1);++a){var i=r[a],o=e[a+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error("defaultValue.shape=".concat(r,", and ragged tensor input flatValues.shape=").concat(e," are incompatible: defaultValue.shape[").concat(a-r.length,"] = ").concat(i," but ragged tensor input.flatValues.shape[").concat(a-r.length,"] = ").concat(o))}}}var x0=30;function Vfe(r){return r<=x0?r:qp(r,Math.floor(Math.sqrt(r)))}function Ufe(r,e,t){var n=t*(typeof r=="number"?r:r[0]),a=e*(typeof r=="number"?r:r[1]);return[n,a]}function Gfe(r,e,t,n){n===void 0&&(n=!0);var a=[];if(n)a=a.concat(e.slice(0)),a.push(r[0]/t),a=a.concat(r.slice(1));else{a=a.concat(r[0]);for(var i=e.length,o=0;o<i;++o)a=a.concat([r[o+1]/e[o],e[o]]);a=a.concat(r.slice(i+1))}return a}function Hfe(r,e,t){t===void 0&&(t=!0);var n=[];if(t){n.push(e);for(var a=e+1;a<r;++a)a<=2*e?(n.push(a),n.push(a-(e+1))):n.push(a)}else{for(var i=[],o=[],a=1;a<r;++a)a>=e*2+1||a%2===1?o.push(a):i.push(a);n.push.apply(n,wt([],Se(i),!1)),n.push(0),n.push.apply(n,wt([],Se(o),!1))}return n}function Kfe(r,e,t,n){n===void 0&&(n=!0);var a=[];n?a.push(r[0]/t):a.push(r[0]*t);for(var i=1;i<r.length;++i)i<=e.length?n?a.push(e[i-1]*r[i]):a.push(r[i]/e[i-1]):a.push(r[i]);return a}function jfe(r,e){for(var t=[0],n=0;n<e;++n)t.push(r[n][0]);return t}function Xfe(r,e,t){for(var n=r.slice(0,1),a=0;a<t;++a)n.push(r[a+1]-e[a][0]-e[a][1]);return n}var Yfe=1.7580993408473768,Zfe=1.0507009873554805;var Jfe=.3275911,Qfe=.254829592,ehe=-.284496736,the=1.421413741,rhe=-1.453152027,nhe=1.061405429;function ahe(r,e){if(r.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+"".concat(r.length,", imag: ").concat(e.length,"."));for(var t=new Float32Array(r.length*2),n=0;n<t.length;n+=2)t[n]=r[n/2],t[n+1]=e[n/2];return t}function ihe(r){for(var e=new Float32Array(r.length/2),t=new Float32Array(r.length/2),n=0;n<r.length;n+=2)e[n/2]=r[n],t[n/2]=r[n+1];return{real:e,imag:t}}function ohe(r){for(var e=Math.ceil(r.length/4),t=new Float32Array(e),n=new Float32Array(e),a=0;a<r.length;a+=4)t[Math.floor(a/4)]=r[a],n[Math.floor(a/4)]=r[a+1];return{real:t,imag:n}}function she(r){for(var e=Math.floor(r.length/4),t=new Float32Array(e),n=new Float32Array(e),a=2;a<r.length;a+=4)t[Math.floor(a/4)]=r[a],n[Math.floor(a/4)]=r[a+1];return{real:t,imag:n}}function uhe(r,e){var t=r[e*2],n=r[e*2+1];return{real:t,imag:n}}function che(r,e,t,n){r[n*2]=e,r[n*2+1]=t}function lhe(r,e){for(var t=new Float32Array(r/2),n=new Float32Array(r/2),a=0;a<Math.ceil(r/2);a++){var i=(e?2:-2)*Math.PI*(a/r);t[a]=Math.cos(i),n[a]=Math.sin(i)}return{real:t,imag:n}}function fhe(r,e,t){var n=(t?2:-2)*Math.PI*(r/e),a=Math.cos(n),i=Math.sin(n);return{real:a,imag:i}}var ly="->",hhe=/->/g,QA=",",eD="...";function phe(r,e){r=r.replace(/\s/g,"");var t=(r.length-r.replace(hhe,"").length)/ly.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error('Equation must contain exactly one arrow ("'.concat(ly,'").'));var n=Se(r.split(ly),2),a=n[0],i=n[1];q(a.indexOf(eD)===-1,function(){return'The ellipsis notation ("'.concat(eD,'") is not supported yet.')});var o=a.split(QA),s=o.length;if(e!==s)throw new Error("Expected ".concat(s," input tensors, received ").concat(e));if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");for(var u=[],c=function(g){var y=i[g];if(!o.some(function(w){return w.indexOf(y)!==-1}))throw new Error("Output subscripts contain the label ".concat(y," ")+"not present in the input subscripts.");u.indexOf(y)===-1&&u.push(y)},l=0;l<i.length;++l)c(l);for(var l=0;l<a.length;++l){var f=a[l];u.indexOf(f)===-1&&f!==QA&&u.push(f)}for(var h=new Array(o.length),l=0;l<s;++l){if(new Set(o[l].split("")).size!==o[l].length)throw new Error("Found duplicate axes in input component ".concat(o[l],". ")+"Support for duplicate axes in input is not implemented yet.");h[l]=[];for(var p=0;p<o[l].length;++p)h[l].push(u.indexOf(o[l][p]))}for(var d=u.length,m=i.length,v=[],l=m;l<d;++l)v.push(l);return{allDims:u,summedDims:v,idDims:h}}function dhe(r,e){var t=new Array(r);t.fill(-1);for(var n=0;n<e.length;++n)t[e[n]]=n;for(var a=[],n=0;n<r;++n)t[n]===-1&&a.push(n);return t=t.filter(function(i){return i!==-1}),{permutationIndices:t,expandDims:a}}function vhe(r,e,t){for(var n=new Array(r),a=function(o){for(var s=t[o].shape,u=function(l){n[e[o][l]]===void 0?n[e[o][l]]=s[l]:q(n[e[o][l]]===s[l],function(){return"Expected dimension ".concat(n[e[o][l]]," at axis ").concat(l," ")+"of input shaped ".concat(JSON.stringify(s),", ")+"but got dimension ".concat(s[l])})},c=0;c<e[o].length;++c)u(c)},i=0;i<t.length;++i)a(i)}function mhe(r,e){var t,n,a=r,i=[],o=0;r.length===0&&a.push(-1),o=r.length+1;for(var s=0;s<o;++s)i.push([]);for(var u=[],s=0;s<a.length;++s){var c=a[s],l=yhe(e,c);try{for(var f=(t=void 0,fn(l)),h=f.next();!h.done;h=f.next()){var p=h.value;u.indexOf(p)===-1&&(i[s].push(p),u.push(p))}}catch(m){t={error:m}}finally{try{h&&!h.done&&(n=f.return)&&n.call(f)}finally{if(t)throw t.error}}}return{path:a,steps:i}}function ghe(r){return r.every(function(e,t){return e===t})}function yhe(r,e){for(var t=[],n=0;n<r.length;++n)(r[n].length===0||r[n].indexOf(e)!==-1||e===-1)&&t.push(n);return t}function bhe(r,e,t){t===void 0&&(t=0);var n=[];if(typeof e=="number")q(r.shape[t]%e===0,function(){return"Number of splits must evenly divide the axis."}),n=new Array(e).fill(r.shape[t]/e);else{var a=e.reduce(function(s,u){return u===-1&&(s+=1),s},0);q(a<=1,function(){return"There should be only one negative value in split array."});var i=e.indexOf(-1);if(i!==-1){var o=e.reduce(function(s,u){return u>0?s+u:s});e[i]=r.shape[t]-o}q(r.shape[t]===e.reduce(function(s,u){return s+u}),function(){return"The sum of sizes must match the size of the axis dimension."}),n=e}return n}function whe(r){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = `.concat(r)}function xhe(r,e){return"indices(".concat(r,", 0) is invalid: ").concat(e," < 0")}function khe(r,e,t){return"indices(".concat(r,", 0) is invalid: ").concat(e," >= ").concat(t)}function She(r,e){return"only one output dimension may be -1, not both ".concat(r," and ").concat(e)}function Nhe(r,e){return"size ".concat(r," must be non-negative, not ").concat(e)}function The(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function Ehe(r,e){var t=Ht(r),n=Ht(e);return"Input to reshape is a SparseTensor with ".concat(t,`
  dense values, but the requested shape requires a multiple of `).concat(n,". inputShape=").concat(r," outputShape= ").concat(e)}function Ihe(r,e){var t=Ht(r),n=Ht(e);return"Input to reshape is a tensor with ".concat(t," dense values, but the requested shape has ").concat(n,". inputShape=").concat(r," outputShape=").concat(e)}function Che(){return"segment ids must be >= 0"}function Ahe(){return"segment ids are not increasing"}function Dhe(r,e){return"Segment id ".concat(r," out of range [0, ").concat(e,"), possibly because segmentIds input is not sorted.")}function _he(r,e,t){return"Bad: indices[".concat(r,"] == ").concat(e," out of range [0, ").concat(t,")")}function Fhe(r,e){var t=!1,n;for(r<=x0?(n=r,t=!0):n=qp(r,Math.floor(Math.sqrt(r)));!t;)n>e||n===r?t=!0:n=qp(r,n+1);return n}function Rhe(r,e,t){for(var n=[],a=r.length,i=0;i<a;i++)i!==e?n.push(r[i]):n.push(t);return n}function Ohe(r,e,t,n){var a=e.shape.length,i=r.shape.length;if(n!==0&&(n<-a||n>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(n));if(n<0&&(n+=a),n>i)throw new Error("batchDims (".concat(n,`) must be less than rank(x) (
    `).concat(i,")."));if(t<n)throw new Error("batchDims (".concat(n,") must be less than or equal to axis (").concat(t,")."));for(var o=0;o<n;++o)if(r.shape[o]!==e.shape[o])throw new Error("x.shape[".concat(o,"]: ").concat(r.shape[o]," should be equal to indices.shape[").concat(o,"]: ").concat(e.shape[o],"."));for(var s=r.shape[t],u=[],c=1,l=1,f=1,o=0;o<n;++o)u.push(r.shape[o]),c*=r.shape[o];for(var o=n;o<t;o++)u.push(r.shape[o]),l*=r.shape[o];for(var o=n;o<a;o++)u.push(e.shape[o]);for(var o=t+1;o<i;o++)u.push(r.shape[o]),f*=r.shape[o];return{batchSize:c,sliceSize:f,outerSize:l,dimSize:s,outputShape:u}}var Phe={__proto__:null,collectGatherOpShapeInfo:Ohe,computeOutShape:Rhe,segOpComputeOptimalWindowSize:Fhe};function Mhe(r){try{return r.map(function(e){return Gp(e)})}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(e))}}function Bhe(r){return r.map(function(e){return sf(e)})}var Lhe={__proto__:null,ERF_A1:Qfe,ERF_A2:ehe,ERF_A3:the,ERF_A4:rhe,ERF_A5:nhe,ERF_P:Jfe,PARALLELIZE_THRESHOLD:x0,get RowPartitionType(){return Ci},SELU_SCALE:Zfe,SELU_SCALEALPHA:Yfe,applyActivation:dd,assertAndGetBroadcastShape:Br,assertAxesAreInnerMostDims:Lae,assertParamsConsistent:Bfe,assignToTypedArray:che,axesAreInnerMostDims:Jy,calculateShapes:IR,checkEinsumDimSizes:vhe,checkPadOnDimRoundingMode:_a,combineLocations:KF,combineRaggedTensorToTensorShapes:zfe,complexWithEvenIndex:ohe,complexWithOddIndex:she,computeConv2DInfo:cf,computeConv3DInfo:LF,computeDefaultPad:Xy,computeDilation2DInfo:nne,computeOptimalWindowSize:Vfe,computeOutAndReduceShapes:Bae,computeOutShape:Lfe,computePool2DInfo:BF,computePool3DInfo:ane,convertConv2DDataFormat:zF,decodeEinsumEquation:phe,eitherStridesOrDilationsAreOne:ro,expandShapeToKeepDim:ff,exponent:fhe,exponents:lhe,fromStringArrayToUint8:Bhe,fromUint8ToStringArray:Mhe,getAxesPermutation:zae,getBroadcastDims:UF,getComplexWithIndex:uhe,getEinsumComputePath:mhe,getEinsumPermutation:dhe,getFusedBiasGradient:pd,getFusedDyActivation:hd,getImageCenter:Ufe,getInnerMostAxes:qae,getPermuted:Hfe,getRaggedRank:qfe,getReductionAxes:Zy,getReshaped:Gfe,getReshapedPermuted:Kfe,getRowPartitionTypesHelper:$fe,getSliceBeginCoords:jfe,getSliceSize:Xfe,getSparseFillEmptyRowsIndicesDenseShapeMismatch:whe,getSparseFillEmptyRowsNegativeIndexErrorMessage:xhe,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:khe,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:The,getSparseReshapeInputOutputMismatchErrorMessage:Ihe,getSparseReshapeInputOutputMultipleErrorMessage:Ehe,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:She,getSparseReshapeNegativeOutputDimErrorMessage:Nhe,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:_he,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Che,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:Ahe,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:Dhe,getUndoAxesPermutation:$ae,isIdentityPermutation:ghe,log:Uee,mergeRealAndImagArrays:ahe,prepareAndValidate:HR,prepareSplitSize:bhe,segment_util:Phe,shouldFuse:vd,slice_util:tO,splitRealAndImagArrays:ihe,stridesOrDilationsArePositive:Es,tupleValuesAreOne:Yl,upcastType:nd,validateDefaultValueShape:Wfe,validateInput:fd,validateUpdateShape:c0,warn:Do};var zhe={__proto__:null,nonMaxSuppressionV3Impl:RR,nonMaxSuppressionV4Impl:OR,nonMaxSuppressionV5Impl:PR,whereImpl:CR};Gle();A.Abs=dD;A.Acos=vD;A.Acosh=mD;A.AdadeltaOptimizer=p0;A.AdagradOptimizer=d0;A.AdamOptimizer=v0;A.AdamaxOptimizer=m0;A.Add=zy;A.AddN=gD;A.All=yD;A.Any=bD;A.ArgMax=wD;A.ArgMin=xD;A.Asin=kD;A.Asinh=SD;A.Atan=ND;A.Atan2=ED;A.Atanh=TD;A.AvgPool=ID;A.AvgPool3D=CD;A.AvgPool3DGrad=Eee;A.AvgPoolGrad=Tee;A.BatchMatMul=AD;A.BatchToSpaceND=DD;A.Bincount=_D;A.BitwiseAnd=FD;A.BroadcastArgs=RD;A.BroadcastTo=Iee;A.Cast=$y;A.Ceil=OD;A.ClipByValue=PD;A.Complex=MD;A.ComplexAbs=BD;A.Concat=LD;A.Conv2D=zD;A.Conv2DBackpropFilter=$D;A.Conv2DBackpropInput=qD;A.Conv3D=WD;A.Conv3DBackpropFilterV2=Cee;A.Conv3DBackpropInputV2=VD;A.Cos=UD;A.Cosh=GD;A.CropAndResize=jD;A.Cumprod=HD;A.Cumsum=KD;A.DataStorage=nee;A.DenseBincount=XD;A.DepthToSpace=YD;A.DepthwiseConv2dNative=ZD;A.DepthwiseConv2dNativeBackpropFilter=JD;A.DepthwiseConv2dNativeBackpropInput=QD;A.Diag=e_;A.Dilation2D=t_;A.Dilation2DBackpropFilter=Dee;A.Dilation2DBackpropInput=Aee;A.Draw=r_;A.Einsum=a_;A.Elu=i_;A.EluGrad=_ee;A.Environment=hD;A.Equal=s_;A.Erf=o_;A.Exp=u_;A.ExpandDims=c_;A.Expm1=l_;A.FFT=f_;A.Fill=h_;A.FlipLeftRight=p_;A.Floor=d_;A.FloorDiv=v_;A.FromPixels=hy;A.FusedBatchNorm=m_;A.FusedConv2D=dy;A.FusedDepthwiseConv2D=vy;A.GatherNd=y_;A.GatherV2=g_;A.Greater=b_;A.GreaterEqual=w_;A.IFFT=x_;A.Identity=qy;A.Imag=k_;A.IsFinite=S_;A.IsInf=N_;A.IsNan=T_;A.KernelBackend=tD;A.LRN=P_;A.LRNGrad=Pee;A.LeakyRelu=E_;A.Less=I_;A.LessEqual=C_;A.LinSpace=A_;A.Log=D_;A.Log1p=__;A.LogSoftmax=Ree;A.LogicalAnd=F_;A.LogicalNot=R_;A.LogicalOr=O_;A.LogicalXor=Fee;A.LowerBound=Oee;A.MatrixBandPart=Mee;A.Max=M_;A.MaxPool=L_;A.MaxPool3D=z_;A.MaxPool3DGrad=Lee;A.MaxPoolGrad=Bee;A.MaxPoolWithArgmax=$_;A.Maximum=B_;A.Mean=q_;A.Min=W_;A.Minimum=V_;A.MirrorPad=U_;A.Mod=G_;A.MomentumOptimizer=g0;A.Multinomial=H_;A.Multiply=K_;A.Neg=j_;A.NonMaxSuppressionV3=Y_;A.NonMaxSuppressionV4=Z_;A.NonMaxSuppressionV5=J_;A.NotEqual=X_;A.OP_SCOPE_SUFFIX=kF;A.OneHot=e3;A.OnesLike=Q_;A.Optimizer=qo;A.OptimizerConstructors=rO;A.Pack=t3;A.PadV2=r3;A.Pool=zee;A.Pow=n3;A.Prelu=a3;A.Prod=i3;A.RMSPropOptimizer=y0;A.RaggedGather=o3;A.RaggedRange=s3;A.RaggedTensorToTensor=u3;A.Range=c3;A.Real=l3;A.RealDiv=n_;A.Reciprocal=f3;A.Relu=h3;A.Relu6=m3;A.Reshape=p3;A.ResizeBilinear=v3;A.ResizeBilinearGrad=qee;A.ResizeNearestNeighbor=d3;A.ResizeNearestNeighborGrad=$ee;A.Reverse=g3;A.RotateWithOffset=nF;A.Round=y3;A.Rsqrt=b3;A.SGDOptimizer=md;A.ScatterNd=w3;A.SearchSorted=k3;A.Select=S3;A.Selu=N3;A.Sigmoid=A3;A.Sign=C3;A.Sin=E3;A.Sinh=I3;A.Slice=T3;A.Softmax=P3;A.Softplus=D3;A.SpaceToBatchND=R3;A.SparseFillEmptyRows=M3;A.SparseReshape=B3;A.SparseSegmentMean=L3;A.SparseSegmentSum=z3;A.SparseToDense=$3;A.SplitV=O3;A.Sqrt=_3;A.Square=Wee;A.SquaredDifference=q3;A.StaticRegexReplace=W3;A.Step=rF;A.StridedSlice=V3;A.StringNGrams=U3;A.StringSplit=G3;A.StringToHashBucketFast=H3;A.Sub=K3;A.Sum=F3;A.Tan=j3;A.Tanh=X3;A.Tensor=Ar;A.TensorBuffer=Hp;A.TensorScatterUpdate=x3;A.Tile=Wy;A.TopK=Y3;A.Transform=Z3;A.Transpose=Pp;A.Unique=J3;A.Unpack=Q3;A.UnsortedSegmentSum=eF;A.UpperBound=Vee;A.Variable=Hl;A.ZerosLike=tF;A._FusedMatMul=py;A.abs=pa;A.acos=Ore;A.acosh=Mre;A.add=ct;A.addN=Lre;A.all=$re;A.any=Wre;A.argMax=Ure;A.argMin=Hre;A.asin=jre;A.asinh=Yre;A.atan=Jre;A.atan2=ene;A.atanh=rne;A.avgPool=$F;A.avgPool3d=hne;A.backend=Ere;A.backend_util=Lhe;A.basicLSTMCell=bne;A.batchNorm=ad;A.batchNorm2d=Nne;A.batchNorm3d=Ene;A.batchNorm4d=Cne;A.batchToSpaceND=qF;A.bincount=WF;A.bitwiseAnd=_ne;A.booleanMaskAsync=Rue;A.broadcastArgs=Rne;A.broadcastTo=Lp;A.broadcast_util=kae;A.browser=xfe;A.buffer=Ji;A.cast=mr;A.ceil=Mne;A.clipByValue=Lne;A.clone=Ss;A.complex=Bo;A.concat=Hn;A.concat1d=$ne;A.concat2d=Wne;A.concat3d=Une;A.concat4d=Hne;A.conv1d=Xne;A.conv2d=id;A.conv2dTranspose=Jne;A.conv3d=eae;A.conv3dTranspose=aae;A.copyRegisteredKernels=jee;A.cos=oae;A.cosh=uae;A.cosineWindow=f0;A.cumprod=lae;A.cumsum=hae;A.customGrad=_i;A.denseBincount=dae;A.deprecationWarn=pre;A.depthToSpace=mae;A.depthwiseConv2d=Yy;A.device_util=Ite;A.diag=bae;A.dilation2d=xae;A.disableDeprecationWarnings=hre;A.dispose=Cn;A.disposeVariables=dre;A.div=Gt;A.divNoNan=Iae;A.dot=Aae;A.dropout=Hue;A.einsum=_ae;A.elu=HF;A.enableDebugMode=fre;A.enableProdMode=lre;A.enclosingPowerOfTwo=DR;A.engine=vre;A.ensureShape=Oae;A.env=dt;A.equal=GF;A.erf=Mae;A.euclideanNorm=Yae;A.exp=Is;A.expandDims=ys;A.expm1=eie;A.eye=XF;A.fft=o0;A.fill=lf;A.findBackend=Sre;A.findBackendFactory=Nre;A.floor=YF;A.floorDiv=MF;A.fused=sce;A.gather=ZF;A.gatherND=Vue;A.gather_util=kfe;A.getBackend=xre;A.getGradient=my;A.getKernel=Wp;A.getKernelsForBackend=Vp;A.grad=kie;A.grads=Sie;A.greater=sd;A.greaterEqual=JF;A.ifft=Zp;A.imag=ud;A.image=Lle;A.inTopKAsync=jue;A.io=ufe;A.irfft=SR;A.isFinite=cie;A.isInf=fie;A.isNaN=pie;A.keep=PF;A.kernel_impls=zhe;A.leakyRelu=QF;A.less=_y;A.lessEqual=Qy;A.linalg=zle;A.linspace=gie;A.localResponseNormalization=bie;A.log=Jl;A.log1p=eR;A.logSigmoid=Aie;A.logSoftmax=Fie;A.logSumExp=nR;A.logicalAnd=jp;A.logicalNot=aR;A.logicalOr=iR;A.logicalXor=Lie;A.losses=$le;A.lowerBound=$ie;A.matMul=Rt;A.math=ffe;A.max=Qu;A.maxPool=oR;A.maxPool3d=Vie;A.maxPoolWithArgmax=Gie;A.maximum=sR;A.mean=Xp;A.memory=mre;A.meshgrid=jie;A.min=Dy;A.minimum=Yp;A.mirrorPad=Zie;A.mod=Qie;A.moments=toe;A.movingAverage=Mue;A.mul=Me;A.multiRNNCell=noe;A.multinomial=ioe;A.neg=Ai;A.nextFrame=Mfe;A.norm=od;A.notEqual=uR;A.oneHot=Fy;A.ones=ks;A.onesLike=coe;A.op=U;A.outerProduct=foe;A.pad=hf;A.pad1d=doe;A.pad2d=moe;A.pad3d=yoe;A.pad4d=woe;A.pool=Toe;A.pow=Zl;A.prelu=lR;A.print=OF;A.prod=Coe;A.profile=gre;A.raggedGather=Doe;A.raggedRange=Foe;A.raggedTensorToTensor=Ooe;A.rand=Moe;A.randomGamma=cse;A.randomNormal=wR;A.randomStandardNormal=hse;A.randomUniform=i0;A.randomUniformInt=vse;A.range=Ql;A.ready=wre;A.real=ef;A.reciprocal=yse;A.registerBackend=Tre;A.registerGradient=Gee;A.registerKernel=aF;A.relu=ld;A.relu6=xR;A.removeBackend=kre;A.reshape=me;A.reverse=Cs;A.reverse1d=Sse;A.reverse2d=Tse;A.reverse3d=Ise;A.reverse4d=Ase;A.rfft=s0;A.round=kR;A.rsqrt=Fse;A.scalar=$t;A.scatterND=Lue;A.scatter_util=gue;A.searchSorted=e0;A.selu=Ose;A.separableConv2d=Mse;A.serialization=Vle;A.setBackend=bre;A.setPlatform=Ire;A.setdiff1dAsync=Lse;A.sigmoid=Ju;A.sign=$se;A.signal=Ble;A.sin=Wse;A.sinh=Use;A.slice=sr;A.slice1d=Hse;A.slice2d=jse;A.slice3d=Yse;A.slice4d=Jse;A.slice_util=tO;A.softmax=eue;A.softplus=rR;A.spaceToBatchND=cR;A.sparse=qle;A.sparseToDense=que;A.spectral=Mle;A.split=tf;A.sqrt=Qi;A.square=oi;A.squaredDifference=NR;A.squeeze=u0;A.stack=rf;A.step=TR;A.stridedSlice=fue;A.string=Wle;A.sub=bt;A.sum=Ut;A.sumOutType=yte;A.tan=pue;A.tanh=Ay;A.tensor=Xu;A.tensor1d=ii;A.tensor2d=Wl;A.tensor3d=ER;A.tensor4d=due;A.tensor5d=vue;A.tensor6d=mue;A.tensorScatterUpdate=bue;A.tensor_util=xte;A.test_util=ise;A.tidy=Mr;A.tile=ql;A.time=yre;A.topk=xue;A.train=Ofe;A.transpose=Jp;A.truncatedNormal=Sue;A.unique=Tue;A.unregisterGradient=Kee;A.unregisterKernel=Hee;A.unsortedSegmentSum=Iue;A.unstack=l0;A.upcastType=nd;A.upperBound=Aue;A.util=ote;A.valueAndGrad=Nie;A.valueAndGrads=Tie;A.variable=Due;A.variableGrads=tR;A.version_core=Rfe;A.where=Oo;A.whereAsync=AR;A.zeros=nc;A.zerosLike=da});var pO=Y((Yut,hO)=>{hO.exports=Xt;var Fa=null;try{Fa=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Xt(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}Xt.prototype.__isLong__;Object.defineProperty(Xt.prototype,"__isLong__",{value:!0});function Yn(r){return(r&&r.__isLong__)===!0}Xt.isLong=Yn;var nO={},aO={};function Ps(r,e){var t,n,a;return e?(r>>>=0,(a=0<=r&&r<256)&&(n=aO[r],n)?n:(t=Yt(r,(r|0)<0?-1:0,!0),a&&(aO[r]=t),t)):(r|=0,(a=-128<=r&&r<128)&&(n=nO[r],n)?n:(t=Yt(r,r<0?-1:0,!1),a&&(nO[r]=t),t))}Xt.fromInt=Ps;function Ra(r,e){if(isNaN(r))return e?Os:Oa;if(e){if(r<0)return Os;if(r>=uO)return fO}else{if(r<=-oO)return Xn;if(r+1>=oO)return lO}return r<0?Ra(-r,e).neg():Yt(r%sc|0,r/sc|0,e)}Xt.fromNumber=Ra;function Yt(r,e,t){return new Xt(r,e,t)}Xt.fromBits=Yt;var gd=Math.pow;function S0(r,e,t){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return Oa;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return S0(r.substring(1),e,t).neg();for(var a=Ra(gd(t,8)),i=Oa,o=0;o<r.length;o+=8){var s=Math.min(8,r.length-o),u=parseInt(r.substring(o,o+s),t);if(s<8){var c=Ra(gd(t,s));i=i.mul(c).add(Ra(u))}else i=i.mul(a),i=i.add(Ra(u))}return i.unsigned=e,i}Xt.fromString=S0;function ui(r,e){return typeof r=="number"?Ra(r,e):typeof r=="string"?S0(r,e):Yt(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}Xt.fromValue=ui;var iO=1<<16,$he=1<<24,sc=iO*iO,uO=sc*sc,oO=uO/2,sO=Ps($he),Oa=Ps(0);Xt.ZERO=Oa;var Os=Ps(0,!0);Xt.UZERO=Os;var oc=Ps(1);Xt.ONE=oc;var cO=Ps(1,!0);Xt.UONE=cO;var k0=Ps(-1);Xt.NEG_ONE=k0;var lO=Yt(-1,2147483647,!1);Xt.MAX_VALUE=lO;var fO=Yt(-1,-1,!0);Xt.MAX_UNSIGNED_VALUE=fO;var Xn=Yt(0,-2147483648,!1);Xt.MIN_VALUE=Xn;var Fe=Xt.prototype;Fe.toInt=function(){return this.unsigned?this.low>>>0:this.low};Fe.toNumber=function(){return this.unsigned?(this.high>>>0)*sc+(this.low>>>0):this.high*sc+(this.low>>>0)};Fe.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Xn)){var t=Ra(e),n=this.div(t),a=n.mul(t).sub(this);return n.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Ra(gd(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};Fe.getHighBits=function(){return this.high};Fe.getHighBitsUnsigned=function(){return this.high>>>0};Fe.getLowBits=function(){return this.low};Fe.getLowBitsUnsigned=function(){return this.low>>>0};Fe.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Xn)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};Fe.isZero=function(){return this.high===0&&this.low===0};Fe.eqz=Fe.isZero;Fe.isNegative=function(){return!this.unsigned&&this.high<0};Fe.isPositive=function(){return this.unsigned||this.high>=0};Fe.isOdd=function(){return(this.low&1)===1};Fe.isEven=function(){return(this.low&1)===0};Fe.equals=function(e){return Yn(e)||(e=ui(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Fe.eq=Fe.equals;Fe.notEquals=function(e){return!this.eq(e)};Fe.neq=Fe.notEquals;Fe.ne=Fe.notEquals;Fe.lessThan=function(e){return this.comp(e)<0};Fe.lt=Fe.lessThan;Fe.lessThanOrEqual=function(e){return this.comp(e)<=0};Fe.lte=Fe.lessThanOrEqual;Fe.le=Fe.lessThanOrEqual;Fe.greaterThan=function(e){return this.comp(e)>0};Fe.gt=Fe.greaterThan;Fe.greaterThanOrEqual=function(e){return this.comp(e)>=0};Fe.gte=Fe.greaterThanOrEqual;Fe.ge=Fe.greaterThanOrEqual;Fe.compare=function(e){if(Yn(e)||(e=ui(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Fe.comp=Fe.compare;Fe.negate=function(){return!this.unsigned&&this.eq(Xn)?Xn:this.not().add(oc)};Fe.neg=Fe.negate;Fe.add=function(e){Yn(e)||(e=ui(e));var t=this.high>>>16,n=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,p=0;return p+=i+c,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=n+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,Yt(h<<16|p,l<<16|f,this.unsigned)};Fe.subtract=function(e){return Yn(e)||(e=ui(e)),this.add(e.neg())};Fe.sub=Fe.subtract;Fe.multiply=function(e){if(this.isZero())return Oa;if(Yn(e)||(e=ui(e)),Fa){var t=Fa.mul(this.low,this.high,e.low,e.high);return Yt(t,Fa.get_high(),this.unsigned)}if(e.isZero())return Oa;if(this.eq(Xn))return e.isOdd()?Xn:Oa;if(e.eq(Xn))return this.isOdd()?Xn:Oa;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(sO)&&e.lt(sO))return Ra(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*l,p+=d>>>16,d&=65535,p+=i*l,h+=p>>>16,p&=65535,p+=o*c,h+=p>>>16,p&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=n*l+a*c+i*u+o*s,f&=65535,Yt(p<<16|d,f<<16|h,this.unsigned)};Fe.mul=Fe.multiply;Fe.divide=function(e){if(Yn(e)||(e=ui(e)),e.isZero())throw Error("division by zero");if(Fa){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Fa.div_u:Fa.div_s)(this.low,this.high,e.low,e.high);return Yt(t,Fa.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Os:Oa;var n,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Os;if(e.gt(this.shru(1)))return cO;i=Os}else{if(this.eq(Xn)){if(e.eq(oc)||e.eq(k0))return Xn;if(e.eq(Xn))return oc;var o=this.shr(1);return n=o.div(e).shl(1),n.eq(Oa)?e.isNegative()?oc:k0:(a=this.sub(e.mul(n)),i=n.add(a.div(e)),i)}else if(e.eq(Xn))return this.unsigned?Os:Oa;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Oa}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:gd(2,s-48),c=Ra(n),l=c.mul(e);l.isNegative()||l.gt(a);)n-=u,c=Ra(n,this.unsigned),l=c.mul(e);c.isZero()&&(c=oc),i=i.add(c),a=a.sub(l)}return i};Fe.div=Fe.divide;Fe.modulo=function(e){if(Yn(e)||(e=ui(e)),Fa){var t=(this.unsigned?Fa.rem_u:Fa.rem_s)(this.low,this.high,e.low,e.high);return Yt(t,Fa.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Fe.mod=Fe.modulo;Fe.rem=Fe.modulo;Fe.not=function(){return Yt(~this.low,~this.high,this.unsigned)};Fe.and=function(e){return Yn(e)||(e=ui(e)),Yt(this.low&e.low,this.high&e.high,this.unsigned)};Fe.or=function(e){return Yn(e)||(e=ui(e)),Yt(this.low|e.low,this.high|e.high,this.unsigned)};Fe.xor=function(e){return Yn(e)||(e=ui(e)),Yt(this.low^e.low,this.high^e.high,this.unsigned)};Fe.shiftLeft=function(e){return Yn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Yt(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Yt(0,this.low<<e-32,this.unsigned)};Fe.shl=Fe.shiftLeft;Fe.shiftRight=function(e){return Yn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Yt(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Yt(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Fe.shr=Fe.shiftRight;Fe.shiftRightUnsigned=function(e){if(Yn(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var n=this.low;return Yt(n>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?Yt(t,0,this.unsigned):Yt(t>>>e-32,0,this.unsigned)};Fe.shru=Fe.shiftRightUnsigned;Fe.shr_u=Fe.shiftRightUnsigned;Fe.toSigned=function(){return this.unsigned?Yt(this.low,this.high,!1):this};Fe.toUnsigned=function(){return this.unsigned?this:Yt(this.low,this.high,!0)};Fe.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Fe.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Fe.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};Xt.fromBytes=function(e,t,n){return n?Xt.fromBytesLE(e,t):Xt.fromBytesBE(e,t)};Xt.fromBytesLE=function(e,t){return new Xt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};Xt.fromBytesBE=function(e,t){return new Xt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}});var eB=Y(lr=>{"use strict";var F=Rs();function qhe(r){var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}function Whe(r,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){if(n!=="default"&&!(n in r)){var a=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,a.get?a:{enumerable:!0,get:function(){return t[n]}})}})}),r}var D=qhe(F),P0=function(r,e){return P0=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},P0(r,e)};function se(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");P0(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Ce(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(f){o(f)}}function u(l){try{c(n.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((n=n.apply(r,e||[])).next())})}function Ie(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function fe(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function te(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function Je(r,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}var Uo=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e}(Error),Oi=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e}(Error),Z=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e}(Error),vt=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e}(Error),Vhe=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e}(Error);(function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return Object.setPrototypeOf(n,e.prototype),n}return e})(Error);var vP=function(){function r(e){this.maxEntries=e||100,this.cache=new Map}return r.prototype.get=function(e){var t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t},r.prototype.put=function(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){var n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,t)},r.prototype.getMaxEntries=function(){return this.maxEntries},r.prototype.setMaxEntries=function(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got ".concat(e,"."));if(this.maxEntries>e)for(var t=0;t<this.maxEntries-e;t++){var n=this.cache.keys().next().value;this.cache.delete(n)}this.maxEntries=e},r}();function $s(r,e){if(Array.isArray(r)){for(var t=[],n=0;n<e;n++)t=t.concat(r);return t}else{var t=new Array(e);return t.fill(r),t}}function Fi(r,e){if(!r)throw new Vhe(e)}function dO(r,e){var t,n,a=0;try{for(var i=fe(r),o=i.next();!o.done;o=i.next()){var s=o.value;s===e&&a++}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a}function Dn(r){return r.length===1?r[0]:r}function Zt(r){return Array.isArray(r)?r:[r]}function ao(r){var e=r.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2"),t=e.replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function Ms(r){return r.length<=1||r.indexOf("_")===-1?r:r.replace(/[_]+(\w|$)/g,function(e,t){return t.toUpperCase()})}var Pa={};function Q0(r){if(r==null)return null;var e={};return e.className=r.getClassName(),e.config=r.getConfig(),e}function M0(r){var e,t;if(!(r==null||typeof r!="object"))if(Array.isArray(r))r.forEach(function(u){return M0(u)});else{var n=Object.keys(r);try{for(var a=fe(n),i=a.next();!i.done;i=a.next()){var o=i.value,s=r[o];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?r[o]=s.value:M0(s))}}catch(u){e={error:u}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}}}function Df(r,e,t,n,a){var i,o,s,u,c,l,f,h,p,d,m;if(e===void 0&&(e={}),t===void 0&&(t={}),n===void 0&&(n="object"),a===void 0&&(a=!1),typeof r=="string"){var v=r,g=void 0;if(v in t)g=t[v];else if(v in Pa)g=Pa[v];else if(g=e[v],g==null)throw new Z("Unknown ".concat(n,": ").concat(r,". ")+`This may be due to one of the following reasons:
`+"1. The ".concat(n," is defined in Python, in which ")+`case it needs to be ported to TensorFlow.js or your JavaScript code.
`+"2. The custom ".concat(n," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");return g}else{var y=r;if(y.className==null||y.config==null)throw new Z("".concat(n,": Improper config format: ")+"".concat(JSON.stringify(y),`.
`)+"'className' and 'config' must set.");var w=y.className,b=void 0,x=void 0;if(w in t?(i=te(t[w],2),b=i[0],x=i[1]):w in Pa?(o=te(Pa.className,2),b=o[0],x=o[1]):w in e&&(s=te(e[w],2),b=s[0],x=s[1]),b==null)throw new Z("Unknown ".concat(n,": ").concat(w,". ")+`This may be due to one of the following reasons:
`+"1. The ".concat(n," is defined in Python, in which ")+`case it needs to be ported to TensorFlow.js or your JavaScript code.
`+"2. The custom ".concat(n," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");if(x!=null){var S={};try{for(var T=fe(Object.keys(Pa)),E=T.next();!E.done;E=T.next()){var C=E.value;S[C]=Pa[C]}}catch(J){u={error:J}}finally{try{E&&!E.done&&(c=T.return)&&c.call(T)}finally{if(u)throw u.error}}try{for(var R=fe(Object.keys(t)),_=R.next();!_.done;_=R.next()){var C=_.value;S[C]=t[C]}}catch(J){l={error:J}}finally{try{_&&!_.done&&(f=R.return)&&f.call(R)}finally{if(l)throw l.error}}var O=y.config;O.customObjects=S;var $=Object.assign({},Pa);try{for(var z=fe(Object.keys(t)),L=z.next();!L.done;L=z.next()){var C=L.value;Pa[C]=t[C]}}catch(J){h={error:J}}finally{try{L&&!L.done&&(p=z.return)&&p.call(z)}finally{if(h)throw h.error}}M0(y.config);var B=x(b,y.config,t,a);return Pa=Object.assign({},$),B}else{var $=Object.assign({},Pa);try{for(var W=fe(Object.keys(t)),X=W.next();!X.done;X=W.next()){var C=X.value;Pa[C]=t[C]}}catch(j){d={error:j}}finally{try{X&&!X.done&&(m=W.return)&&m.call(W)}finally{if(d)throw d.error}}var B=new b(y.config);return Pa=Object.assign({},$),B}}}function Uhe(r,e){return r<e?-1:r>e?1:0}function yd(r,e){return-1*Uhe(r,e)}function Go(r){var e,t;if(r==null)return r;var n=[];try{for(var a=fe(r),i=a.next();!i.done;i=a.next()){var o=i.value;n.indexOf(o)===-1&&n.push(o)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}function Ghe(r){if(r==null)throw new Z("Invalid value in obj: ".concat(JSON.stringify(r)));for(var e in r)if(r.hasOwnProperty(e))return!1;return!0}function Ws(r,e,t){if(t!=null&&r.indexOf(t)<0)throw new Z("".concat(t," is not a valid ").concat(e,".  Valid values are ").concat(r," or null/undefined."))}function eb(r,e,t,n){return t===void 0&&(t=0),n===void 0&&(n=1/0),Fi(t>=0),Fi(n>=t),Array.isArray(r)&&r.length>=t&&r.length<=n&&r.every(function(a){return typeof a===e})}function jr(r,e){Array.isArray(r)?(F.util.assert(r.length>0,function(){return"".concat(e," is unexpectedly an empty array.")}),r.forEach(function(t,n){return jr(t,"element ".concat(n+1," of ").concat(e))})):F.util.assert(Number.isInteger(r)&&r>0,function(){return"Expected ".concat(e," to be a positive integer, but got ")+"".concat(mP(r),".")})}function mP(r){return r===null?"null":Array.isArray(r)?"["+r.map(function(e){return mP(e)}).join(",")+"]":typeof r=="string"?'"'.concat(r,'"'):"".concat(r)}function Hhe(r,e,t){var n=t!=null?t():F.util.now(),a,i=function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var u=t!=null?t():F.util.now();return u-n<e||(n=u,a=r.apply(void 0,Je([],te(o),!1))),a};return i}function gP(r){return r==="relu"?"relu":r==="linear"?"linear":r==="elu"?"elu":null}var Khe=0;function yP(){return Khe++}var bd={};function Gd(r){return r===void 0&&(r=""),r in bd||(bd[r]=0),bd[r]+=1,r+bd[r].toString()}var jhe=["channelsFirst","channelsLast"],Xhe=["nearest","bilinear"],Yhe=["valid","same","causal"],Zhe=["max","avg"],Jhe=["sum","mul","concat","ave"];var uc=new Map;function Dr(r){Ws(jhe,"DataFormat",r)}function Qhe(r){Ws(Xhe,"InterpolationFormat",r)}function ga(r){Ws(Yhe,"PaddingMode",r)}function bP(r){Ws(Zhe,"PoolMode",r)}var Nf=[],vO="/";function Ls(r,e){Nf.push(r);try{var t=e();return Nf.pop(),t}catch(n){throw Nf.pop(),n}}function epe(){return Nf.length===0?"":Nf.join(vO)+vO}function wP(r){if(!kP(r))throw new Error("Not a valid tensor name: '"+r+"'");return epe()+r}function xP(r){if(!kP(r))throw new Error("Not a valid tensor name: '"+r+"'");uc.has(r)||uc.set(r,0);var e=uc.get(r);if(uc.set(r,uc.get(r)+1),e>0){var t="".concat(r,"_").concat(e);return uc.set(t,1),t}else return r}var tpe=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function kP(r){return!!r.match(tpe)}function rpe(r){return r===parseInt(r.toString(),10)}function Ho(r,e,t){e==null&&(e=0),t==null&&(t=r.length);for(var n=1,a=e;a<t;++a)n*=r[a];return n}function vc(r){if(r.length===0)return Number.NaN;for(var e=Number.POSITIVE_INFINITY,t=0;t<r.length;t++){var n=r[t];n<e&&(e=n)}return e}function Ko(r){if(r.length===0)return Number.NaN;for(var e=Number.NEGATIVE_INFINITY,t=0;t<r.length;t++){var n=r[t];n>e&&(e=n)}return e}function di(r,e){if(e<r)throw new Z("end (".concat(e,") < begin (").concat(r,") is forbidden."));for(var t=[],n=r;n<e;++n)t.push(n);return t}var N0;function $r(){return N0==null&&(N0=F.backend().epsilon()),N0}function vi(){return"channelsLast"}function Pi(r,e){return D.cast(r,e)}function _f(r,e){e===void 0&&(e=-1);var t=r.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),D.reshape(r,t)}function npe(r,e){return F.tidy(function(){if(r.shape.length!==2)throw new Z("repeat() expects a rank-2 tensor, but received a "+"rank-".concat(r.shape.length," tensor."));var t=_f(r,1);return B0(t,[1,e,1])})}function ape(r){var e=[Ho(r.shape)];return D.reshape(r,e)}function ipe(r){if(r.rank<=1)throw new Z("batchFlatten requires a minimum rank of 2. Got rank: ".concat(r.rank,"."));var e=[r.shape[0],Ho(r.shape,1)];return D.reshape(r,e)}function zs(r,e,t){return F.tidy(function(){switch(r.rank){case 1:return D.slice1d(r,e,t);case 2:return D.slice2d(r,[e,0],[t,r.shape[1]]);case 3:return D.slice3d(r,[e,0,0],[t,r.shape[1],r.shape[2]]);case 4:return D.slice4d(r,[e,0,0,0],[t,r.shape[1],r.shape[2],r.shape[3]]);case 5:return D.slice(r,[e,0,0,0,0],[t,r.shape[1],r.shape[2],r.shape[3],r.shape[4]]);case 6:return D.slice(r,[e,0,0,0,0,0],[t,r.shape[1],r.shape[2],r.shape[3],r.shape[4],r.shape[5]]);default:throw new Z("sliceAlongFirstAxis() received an unsupported tensor rank: "+"".concat(r.rank))}})}function T0(r,e,t){return F.tidy(function(){switch(r.rank){case 1:return D.slice1d(r,e,t);case 2:return D.slice2d(r,[0,e],[r.shape[0],t]);case 3:return D.slice3d(r,[0,0,e],[r.shape[0],r.shape[1],t]);case 4:return D.slice4d(r,[0,0,0,e],[r.shape[0],r.shape[1],r.shape[2],t]);default:throw new Z("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(r.rank))}})}function wd(r,e,t,n){return F.tidy(function(){switch(r.rank){case 1:return D.slice1d(r,e,t);case 2:switch(n){case 1:return zs(r,e,t);case 2:return T0(r,e,t);default:throw new Z("The axis is not within the rank of the tensor "+"".concat(n))}case 3:switch(n){case 1:return zs(r,e,t);case 2:return D.slice3d(r,[0,e,0],[r.shape[0],t,r.shape[2]]);case 3:return T0(r,e,t);default:throw new Z("The axis is not within the rank of the tensor "+"".concat(n))}case 4:switch(n){case 1:return zs(r,e,t);case 2:return D.slice4d(r,[0,e,0,0],[r.shape[0],t,r.shape[2],r.shape[3]]);case 3:return D.slice4d(r,[0,0,e,0],[r.shape[0],r.shape[1],t,r.shape[3]]);case 4:return T0(r,e,t);default:throw new Z("The axis is not within the rank of the tensor "+"".concat(n))}default:throw new Z("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(r.rank))}})}function tb(r,e){e===void 0&&(e=-1);var t;return e<0&&(t=r[0].rank,t!==0?e=t:e=0),e===r[0].rank&&(e=-1),D.concat(r,e)}function mO(r,e){switch(r.rank){case 1:return D.concat1d([r,e]);case 2:return D.concat2d([r,e],0);case 3:return D.concat3d([r,e],0);case 4:return D.concat4d([r,e],0);default:throw new Z("concatAlongFirstAxis() received an unsupported "+"tensor rank: ".concat(r.rank))}}function B0(r,e){if(Array.isArray(e)||(e=[e]),r.rank!==e.length)throw new Z("The length of input n (".concat(e.length,") does not match ")+"the number of dimensions in input x (".concat(r.rank,")"));return D.tile(r,e)}function Hd(r,e,t,n,a){return e===void 0&&(e=0),t===void 0&&(t=1),D.randomNormal(r,e,t,n,a)}function Mi(r,e,t,n){if(r.rank<2||e.rank<2)throw new vt("dot requires both inputs to be rank >= 2"+" but got x shape = ".concat(r.shape," and y shape = ").concat(e.shape));if(e.rank>=3){var a=r.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(a!==i)throw new vt("If rank y >= 3, then the second last dim"+" of y must equal the last dim of x but got x shape = ".concat(r.shape," and ")+" y shape = ".concat(e.shape))}if(r.rank===2&&e.rank===2){var o=!1,s=!1;return D.fused.matMul({a:r,b:e,transposeA:o,transposeB:s,bias:n?L0(r.rank,n,vi()):null,activation:t})}else{var u=r.shape.slice(),c=u.pop();r=D.reshape(r,[-1,c]);var l=e.shape.slice(),f=l.pop(),i=l.pop(),h=Je(Je([],te(l),!1),[f],!1),p=Array.from({length:e.rank},function(y,w){return w===0?e.rank-2:w<=e.rank-2?w-1:w});e=D.reshape(D.transpose(e,p),[i,-1]);var d=Je(Je([],te(u),!1),te(h),!1),o=!1,s=!1;return D.reshape(D.fused.matMul({a:r,b:e,transposeA:o,transposeB:s,bias:n?L0(r.rank,n,vi()):null,activation:t}),d)}}function SP(r,e,t){return F.tidy(function(){return Array.isArray(e)?e=F.tensor1d(e,"int32"):e=D.cast(e,"int32"),D.gather(r,e,t)})}function Ff(r){return D.mul(r,r)}function L0(r,e,t){var n=e.shape;if(e.rank!==1&&e.rank!==r)throw new Z("Unexpected bias dimensions: ".concat(e.rank)+"; expected it to be 1 or ".concat(r));if(r===5){if(t==="channelsFirst")return n.length===1?D.reshape(e,[1,n[0],1,1,1]):D.reshape(e,[1,n[3],n[0],n[1],n[2]]);if(t==="channelsLast")return n.length===1?D.reshape(e,[1,1,1,1,n[0]]):D.reshape(e,[1].concat(n))}else if(r===4){if(t==="channelsFirst")return n.length===1?D.reshape(e,[1,n[0],1,1]):D.reshape(e,[1,n[2],n[0],n[1]]);if(t==="channelsLast")return n.length===1?D.reshape(e,[1,1,1,n[0]]):D.reshape(e,[1].concat(n))}else if(r===3){if(t==="channelsFirst")return n.length===1?D.reshape(e,[1,n[0],1]):D.reshape(e,[1,n[1],n[0]]);if(t==="channelsLast")return n.length===1?D.reshape(e,[1,1,n[0]]):D.reshape(e,[1].concat(n))}else if(r<3)return e;throw new Z("Unsupported input rank by biasAdd: ".concat(e.rank))}function gi(r,e,t){return F.tidy(function(){return t==null&&(t=vi()),Dr(t),D.add(r,L0(r.rank,e,t))})}function ope(r,e){if(e===void 0&&(e=1),e!==1)throw new vt("Support for alpha values other than 1 (".concat(e,") is not implemented ")+"yet.");return D.elu(r)}function spe(r){return F.tidy(function(){return D.div(r,D.add(D.abs(r),1))})}function NP(r,e,t,n){return F.tidy(function(){return D.dropout(r,e,t,n)})}function upe(r){return F.tidy(function(){var e=D.add(.5,D.mul(.2,r));return D.clipByValue(e,0,1)})}function Rf(r,e,t){return t===void 0&&(t=!1),t?r():e()}var cpe=["fanIn","fanOut","fanAvg"],lpe=["normal","uniform","truncatedNormal"];function fpe(r){Ws(cpe,"FanMode",r)}function hpe(r){Ws(lpe,"Distribution",r)}var qa=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.fromConfigUsesCustomObjects=function(){return!1},e.prototype.getConfig=function(){return{}},e}(F.serialization.Serializable),rb=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return F.zeros(t,n)},e}(qa);rb.className="Zeros";F.serialization.registerClass(rb);var Kd=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return F.ones(t,n)},e}(qa);Kd.className="Ones";F.serialization.registerClass(Kd);var nb=function(r){se(e,r);function e(t){var n=r.call(this)||this;if(typeof t!="object")throw new Z("Expected argument of type ConstantConfig but got ".concat(t));if(t.value===void 0)throw new Z("config must have value set but got ".concat(t));return n.value=t.value,n}return e.prototype.apply=function(t,n){var a=this;return F.tidy(function(){return F.mul(F.scalar(a.value),F.ones(t,n))})},e.prototype.getConfig=function(){return{value:this.value}},e}(qa);nb.className="Constant";F.serialization.registerClass(nb);var ab=function(r){se(e,r);function e(t){var n=r.call(this)||this;return n.DEFAULT_MINVAL=-.05,n.DEFAULT_MAXVAL=.05,n.minval=t.minval||n.DEFAULT_MINVAL,n.maxval=t.maxval||n.DEFAULT_MAXVAL,n.seed=t.seed,n}return e.prototype.apply=function(t,n){return F.randomUniform(t,this.minval,this.maxval,n,this.seed)},e.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},e}(qa);ab.className="RandomUniform";F.serialization.registerClass(ab);var ib=function(r){se(e,r);function e(t){var n=r.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=t.mean||n.DEFAULT_MEAN,n.stddev=t.stddev||n.DEFAULT_STDDEV,n.seed=t.seed,n}return e.prototype.apply=function(t,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new vt("randomNormal does not support dType ".concat(n,"."));return Hd(t,this.mean,this.stddev,n,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e}(qa);ib.className="RandomNormal";F.serialization.registerClass(ib);var ob=function(r){se(e,r);function e(t){var n=r.call(this)||this;return n.DEFAULT_MEAN=0,n.DEFAULT_STDDEV=.05,n.mean=t.mean||n.DEFAULT_MEAN,n.stddev=t.stddev||n.DEFAULT_STDDEV,n.seed=t.seed,n}return e.prototype.apply=function(t,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new vt("truncatedNormal does not support dType ".concat(n,"."));return F.truncatedNormal(t,this.mean,this.stddev,n,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e}(qa);ob.className="TruncatedNormal";F.serialization.registerClass(ob);var sb=function(r){se(e,r);function e(t){var n=r.call(this)||this;return n.gain=t.gain!=null?t.gain:1,n}return e.prototype.apply=function(t,n){var a=this;return F.tidy(function(){if(t.length!==2||t[0]!==t[1])throw new Z("Identity matrix initializer can only be used for 2D square matrices.");return F.mul(a.gain,F.eye(t[0]))})},e.prototype.getConfig=function(){return{gain:this.gain}},e}(qa);sb.className="Identity";F.serialization.registerClass(sb);function ppe(r,e){e===void 0&&(e="channelsLast");var t,n;if(Dr(e),r.length===2)t=r[0],n=r[1];else if([3,4,5].indexOf(r.length)!==-1){if(e==="channelsFirst"){var a=Ho(r,2);t=r[1]*a,n=r[0]*a}else if(e==="channelsLast"){var a=Ho(r,0,r.length-2);t=r[r.length-2]*a,n=r[r.length-1]*a}}else{var i=Ho(r);t=Math.sqrt(i),n=Math.sqrt(i)}return[t,n]}var _n=function(r){se(e,r);function e(t){var n=r.call(this)||this;if(t.scale<0)throw new Z("scale must be a positive float. Got: ".concat(t.scale));return n.scale=t.scale==null?1:t.scale,n.mode=t.mode==null?"fanIn":t.mode,fpe(n.mode),n.distribution=t.distribution==null?"normal":t.distribution,hpe(n.distribution),n.seed=t.seed,n}return e.prototype.apply=function(t,n){var a=ppe(t),i=a[0],o=a[1],s=this.scale;if(this.mode==="fanIn"?s/=Math.max(1,i):this.mode==="fanOut"?s/=Math.max(1,o):s/=Math.max(1,(i+o)/2),this.distribution==="normal"){var u=Math.sqrt(s);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new vt("".concat(this.getClassName()," does not support dType ").concat(n,"."));return F.truncatedNormal(t,0,u,n,this.seed)}else{var c=Math.sqrt(3*s);return F.randomUniform(t,-c,c,n,this.seed)}},e.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},e}(qa);_n.className="VarianceScaling";F.serialization.registerClass(_n);var jd=function(r){se(e,r);function e(t){return r.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return _n.className},e}(_n);jd.className="GlorotUniform";F.serialization.registerClass(jd);var Xd=function(r){se(e,r);function e(t){return r.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return _n.className},e}(_n);Xd.className="GlorotNormal";F.serialization.registerClass(Xd);var Yd=function(r){se(e,r);function e(t){return r.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return _n.className},e}(_n);Yd.className="HeNormal";F.serialization.registerClass(Yd);var Zd=function(r){se(e,r);function e(t){return r.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return _n.className},e}(_n);Zd.className="HeUniform";F.serialization.registerClass(Zd);var Jd=function(r){se(e,r);function e(t){return r.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return _n.className},e}(_n);Jd.className="LeCunNormal";F.serialization.registerClass(Jd);var Qd=function(r){se(e,r);function e(t){return r.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return _n.className},e}(_n);Qd.className="LeCunUniform";F.serialization.registerClass(Qd);var ub=function(r){se(e,r);function e(t){var n=r.call(this)||this;return n.DEFAULT_GAIN=1,n.ELEMENTS_WARN_SLOW=2e3,n.gain=t.gain==null?n.DEFAULT_GAIN:t.gain,n.seed=t.seed,n}return e.prototype.apply=function(t,n){var a=this;return F.tidy(function(){if(t.length<2)throw new vt("Shape must be at least 2D.");if(n!=="int32"&&n!=="float32"&&n!==void 0)throw new TypeError("Unsupported data type ".concat(n,"."));n=n;var i=F.util.sizeFromShape(t.slice(0,-1)),o=t[t.length-1],s=i*o;s>a.ELEMENTS_WARN_SLOW&&console.warn("Orthogonal initializer is being called on a matrix with more "+"than ".concat(a.ELEMENTS_WARN_SLOW," (").concat(s,") elements: ")+"Slowness may result.");var u=[Math.max(o,i),Math.min(o,i)],c=Hd(u,0,1,n,a.seed),l=F.linalg.qr(c,!1),f=l[0],h=l[1],p=h.flatten().stridedSlice([0],[Math.min(o,i)*Math.min(o,i)],[Math.min(o,i)+1]);return f=F.mul(f,p.sign()),i<o&&(f=f.transpose()),F.mul(F.scalar(a.gain),f.reshape(t))})},e.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},e}(qa);ub.className="Orthogonal";F.serialization.registerClass(ub);var gO={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function yO(r,e){return e===void 0&&(e={}),Df(r,F.serialization.SerializationMap.getMap().classNameMap,e,"initializer")}function yr(r){return Q0(r)}function ur(r){if(typeof r=="string"){var e=r in gO?gO[r]:r;if(e==="GlorotNormal")return new Xd;if(e==="GlorotUniform")return new jd;if(e==="HeNormal")return new Yd;if(e==="HeUniform")return new Zd;if(e==="LeCunNormal")return new Jd;if(e==="LeCunUniform")return new Qd;var t={};return t.className=e,t.config={},yO(t)}else return r instanceof qa?r:yO(r)}function z0(r){return Array.isArray(r)&&Array.isArray(r[0])}function Id(r){return r.length===0?[]:Array.isArray(r[0])?r:[r]}function it(r){var e;if(Array.isArray(r)){if(r.length!==1)throw new Z("Expected Tensor length to be 1; got ".concat(r.length));e=r[0]}else e=r;return e}function Tt(r){if(Array.isArray(r)&&Array.isArray(r[0])){if(r.length===1)return r=r,r[0];throw new Z("Expected exactly 1 Shape; got ".concat(r.length))}else return r}function Cd(r){var e,t,n=0;try{for(var a=fe(r),i=a.next();!i.done;i=a.next()){var o=i.value;o.shape.length===0?n+=1:n+=o.shape.reduce(function(s,u){return s*u})}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}var bO="Variable",TP=function(){function r(e,t,n,a,i){t===void 0&&(t="float32"),n===void 0&&(n=bO),a===void 0&&(a=!0),i===void 0&&(i=null),this.dtype=t??"float32",this.shape=e.shape,this.id=yP(),n=n??bO,this.originalName=wP(n),this.name=xP(this.originalName),this.trainable_=a,this.constraint=i,this.val=D.variable(e,this.trainable_,this.name,this.dtype)}return r.prototype.read=function(){return this.assertNotDisposed(),this.val},r.prototype.write=function(e){return this.assertNotDisposed(),dpe(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this},r.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},r.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))},Object.defineProperty(r.prototype,"trainable",{get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e},enumerable:!1,configurable:!0}),r}();function dpe(r,e){if(r.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(r.shape)+" vs. "+JSON.stringify(e.shape))}function $0(r){return r.map(function(e){return e.read()})}function cb(r){r.forEach(function(e){var t=e[0];t.write(e[1])})}var Lr=function(){function r(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}return r}(),fi=function(){function r(e,t,n,a,i,o,s){this.dtype=e,this.shape=t,this.sourceLayer=n,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=yP(),o!=null&&(this.originalName=wP(o),this.name=xP(this.originalName)),this.rank=t.length}return r}(),vpe=0,ev=function(){function r(e,t){var n,a;this.callArgs=t,this.id=vpe++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;try{for(var i=fe(e.inboundLayers),o=i.next();!o.done;o=i.next()){var s=o.value;s?.outboundNodes.push(this)}}catch(u){n={error:u}}finally{try{o&&!o.done&&(a=i.return)&&a.call(i)}finally{if(n)throw n.error}}e.outboundLayer.inboundNodes.push(this)}return r.prototype.getConfig=function(){var e,t,n=[];try{for(var a=fe(this.inboundLayers),i=a.next();!i.done;i=a.next()){var o=i.value;o!=null?n.push(o.name):n.push(null)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:n,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},r}(),mpe=0,mt=function(r){se(e,r);function e(t){t===void 0&&(t={});var n=r.call(this)||this;n._callHook=null,n._addedWeightNames=[],n._stateful=!1,n.id=mpe++,n.activityRegularizer=null,n.inputSpec=null,n.supportsMasking=!1,n._trainableWeights=[],n._nonTrainableWeights=[],n._losses=[],n._updates=[],n._built=!1,n.inboundNodes=[],n.outboundNodes=[];var a=t.name;if(!a){var i=n.getClassName();a=ao(i)+"_"+Gd(i)}if(n.name=a,n.trainable_=t.trainable==null?!0:t.trainable,t.inputShape!=null||t.batchInputShape!=null){var o=void 0;if(t.batchInputShape!=null)o=t.batchInputShape;else if(t.inputShape!=null){var s=null;t.batchSize!=null&&(s=t.batchSize),o=[s].concat(t.inputShape)}n.batchInputShape=o;var u=t.dtype;u==null&&(u=t.inputDType),u==null&&(u="float32"),n.dtype=u}return t.weights!=null?n.initialWeights=t.weights:n.initialWeights=null,n._refCount=null,n.fastWeightInitDuringBuild=!1,n}return e.nodeKey=function(t,n){return t.name+"_ib-"+n.toString()},e.prototype.getNodeAtIndex=function(t,n){if(this.inboundNodes.length===0)throw new Oi("The layer has never been called "+"and thus has no defined ".concat(n,"."));if(this.inboundNodes.length<=t)throw new Z("Asked to get ".concat(n," at node ").concat(t,", ")+"but the layer has only ".concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[t]},e.prototype.getInputAt=function(t){return Dn(this.getNodeAtIndex(t,"input").inputTensors)},e.prototype.getOutputAt=function(t){return Dn(this.getNodeAtIndex(t,"output").outputTensors)},Object.defineProperty(e.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new Uo("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(this.inboundNodes.length===0)throw new Uo("Layer ".concat(this.name)+" is not connected, no input to return.");return Dn(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){if(this.inboundNodes.length===0)throw new Uo("Layer ".concat(this.name)+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new Uo("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return Dn(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this._losses},enumerable:!1,configurable:!0}),e.prototype.calculateLosses=function(){return this.losses.map(function(t){return t()})},Object.defineProperty(e.prototype,"updates",{get:function(){return this._updates},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"built",{get:function(){return this._built},set:function(t){this._built=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this._trainableWeights.forEach(function(n){return n.trainable=t}),this.trainable_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable_?this._trainableWeights.filter(function(t){return t.trainable}):[]},set:function(t){this._trainableWeights=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._trainableWeights.filter(function(t){return!t.trainable}).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(t){this._nonTrainableWeights=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stateful",{get:function(){return this._stateful},enumerable:!1,configurable:!0}),e.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},e.prototype.assertInputCompatibility=function(t){if(t=Zt(t),!(this.inputSpec==null||this.inputSpec.length===0)){var n=Zt(this.inputSpec);if(t.length!==n.length)throw new Z("Layer ".concat(this.name," expects ").concat(n.length," inputs, ")+"but it received ".concat(t.length," input tensors. ")+"Input received: ".concat(t));for(var a=0;a<t.length;a++){var i=t[a],o=n[a];if(o!=null){var s=i.rank;if(o.ndim!=null&&s!==o.ndim)throw new Z("Input ".concat(a," is incompatible with layer ").concat(this.name,": ")+"expected ndim=".concat(o.ndim,", found ndim=").concat(s));if(o.maxNDim!=null&&s>o.maxNDim)throw new Z("Input ".concat(a," is incompatible with layer ").concat(this.name)+": expected max_ndim=".concat(o.maxNDim,", found ndim=").concat(s));if(o.minNDim!=null&&s<o.minNDim)throw new Z("Input ".concat(a," is incompatible with layer ").concat(this.name)+": expected min_ndim=".concat(o.minNDim,", found ndim=").concat(s,"."));if(o.dtype!=null&&i.dtype!==o.dtype)throw new Z("Input ".concat(a," is incompatible with layer ").concat(this.name," ")+": expected dtype=".concat(o.dtype,", found dtype=").concat(i.dtype,"."));if(o.axes){var u=i.shape;for(var c in o.axes){var l=Number(c),f=o.axes[c],h=l>=0?u[l]:u[u.length+l];if(f!=null&&[f,null].indexOf(h)===-1)throw new Z("Input ".concat(a," is incompatible with layer ")+"".concat(this.name,": expected axis ").concat(l," of input shape to ")+"have value ".concat(f," but got shape ").concat(u,"."))}}if(o.shape!=null)for(var p=0;p<o.shape.length;++p){var d=o.shape[p],m=i.shape[p];if(d!=null&&m!=null&&d!==m)throw new Z("Input ".concat(a," is incompatible with layer ")+"".concat(this.name,": expected shape=").concat(o.shape,", ")+"found shape=".concat(i.shape,"."))}}}}},e.prototype.call=function(t,n){return t},e.prototype.invokeCallHook=function(t,n){this._callHook!=null&&this._callHook(t,n)},e.prototype.setCallHook=function(t){this._callHook=t},e.prototype.clearCallHook=function(){this._callHook=null},e.prototype.apply=function(t,n){var a,i,o,s,u=this;n=n||{},this.assertNotDisposed();var c=Zt(t),l=!0;try{for(var f=fe(c),h=f.next();!h.done;h=f.next()){var p=h.value;if(!(p instanceof fi)){l=!1;break}}}catch(g){a={error:g}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}var d=!0;try{for(var m=fe(c),v=m.next();!v.done;v=m.next()){var p=v.value;if(p instanceof fi){d=!1;break}}}catch(g){o={error:g}}finally{try{v&&!v.done&&(s=m.return)&&s.call(m)}finally{if(o)throw o.error}}if(l===d)throw new Z("Arguments to apply() must be all SymbolicTensors or all Tensors");return Ls(this.name,function(){var g,y,w,b;if(!u.built){u.assertInputCompatibility(t);var x=[];try{for(var S=fe(Zt(t)),T=S.next();!T.done;T=S.next()){var E=T.value;x.push(E.shape)}}catch(X){g={error:X}}finally{try{T&&!T.done&&(y=S.return)&&y.call(S)}finally{if(g)throw g.error}}u.build(Dn(x)),u.built=!0,u.initialWeights&&u.setWeights(u.initialWeights),u._refCount===null&&d&&(u._refCount=1)}if(u.assertInputCompatibility(t),d){var C=u.call(t,n),R=Zt(C),_=[];try{for(var O=fe(R),$=O.next();!$.done;$=O.next()){var z=$.value;c.indexOf(z)!==-1&&(z=z.clone()),_.push(z)}}catch(X){w={error:X}}finally{try{$&&!$.done&&(b=O.return)&&b.call(O)}finally{if(w)throw w.error}}if(C=Dn(_),u.activityRegularizer!=null)throw new vt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return C}else{var L=gpe(t),B=u.computeOutputShape(L),C=void 0,W=ype(t);if(u.warnOnIncompatibleInputShape(Array.isArray(t)?L[0]:L),B!=null&&B.length>0&&Array.isArray(B[0])?C=B.map(function(J,V){return new fi(W,J,u,Zt(t),n,u.name,V)}):C=new fi(W,B,u,Zt(t),n,u.name),u.addInboundNode(t,C,null,null,L,B,n),u._refCount++,u.activityRegularizer!=null)throw new vt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return C}})},e.prototype.warnOnIncompatibleInputShape=function(t){if(this.batchInputShape!=null)if(t.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+"".concat(JSON.stringify(t),") does not match that of the ")+"batchInputShape (".concat(JSON.stringify(this.batchInputShape),") ")+"of the layer ".concat(this.name));else{var n=!1;this.batchInputShape.forEach(function(a,i){a!=null&&t[i]!=null&&t[i]!==a&&(n=!0)}),n&&console.warn("The shape of the input tensor "+"(".concat(JSON.stringify(t),") does not ")+"match the expectation of layer ".concat(this.name,": ")+"".concat(JSON.stringify(this.batchInputShape)))}},Object.defineProperty(e.prototype,"outputShape",{get:function(){var t,n;if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Uo("The layer ".concat(this.name," has never been called and thus has no ")+"defined output shape.");var a=[];try{for(var i=fe(this.inboundNodes),o=i.next();!o.done;o=i.next()){var s=o.value,u=JSON.stringify(s.outputShapes);a.indexOf(u)===-1&&a.push(u)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}if(a.length===1){var c=this.inboundNodes[0].outputShapes;return Array.isArray(c)&&Array.isArray(c[0])&&c.length===1?c[0]:c}else throw new Uo("The layer ".concat(this.name," has multiple inbound nodes with different ")+'output shapes. Hence the notion of "output shape" is ill-defined for the layer.')},enumerable:!1,configurable:!0}),e.prototype.countParams=function(){if(!this.built)throw new Oi("You tried to call countParams() on ".concat(this.name,", ")+"but the layer is not built yet. Build it first by calling build(batchInputShape).");return Cd(this.weights)},e.prototype.build=function(t){this.built=!0},e.prototype.getWeights=function(t){return t===void 0&&(t=!1),$0(t?this.trainableWeights:this.weights)},e.prototype.setWeights=function(t){var n=this;F.tidy(function(){var a=n.weights;if(a.length!==t.length)throw new Z('You called setWeights(weights) on layer "'.concat(n.name,'" ')+"with a weight list of length ".concat(t.length,", ")+"but the layer was expecting ".concat(a.length," weights. ")+"Provided weights: ".concat(t,"..."));if(a.length!==0){for(var i=[],o=$0(a),s=0;s<o.length;++s){var u=o[s],c=a[s],l=t[s];if(!F.util.arraysEqual(u.shape,l.shape))throw new Z("Layer weight shape ".concat(u.shape," ")+"not compatible with provided weight shape ".concat(l.shape));i.push([c,l])}cb(i)}})},e.prototype.addWeight=function(t,n,a,i,o,s,u,c){if(this._addedWeightNames.indexOf(t)!==-1)throw new Z("Duplicate weight name ".concat(t," for layer ").concat(this.name));this._addedWeightNames.push(t),a==null&&(a="float32"),this.fastWeightInitDuringBuild&&(i=c!=null?c():ur("zeros"));var l=i.apply(n,a),f=new TP(l,a,t,s,u);return l.dispose(),o!=null&&this.addLoss(function(){return o.apply(f.read())}),s==null&&(s=!0),s?this._trainableWeights.push(f):this._nonTrainableWeights.push(f),f},e.prototype.setFastWeightInitDuringBuild=function(t){this.fastWeightInitDuringBuild=t},e.prototype.addLoss=function(t){var n;t==null||Array.isArray(t)&&t.length===0||(t=Zt(t),this._losses!==void 0&&this._losses!==null&&(n=this.losses).push.apply(n,Je([],te(t),!1)))},e.prototype.computeOutputShape=function(t){return t},e.prototype.computeMask=function(t,n){var a=this;if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(function(i){if(i!=null)throw new TypeError("Layer ".concat(a.name," does not support masking, ")+"but was passed an inputMask.")});else throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.");return null}return n},e.prototype.addInboundNode=function(t,n,a,i,o,s,u){var c,l;u===void 0&&(u=null);var f=Zt(t);n=Zt(n),a=Zt(a),i=Zt(i),o=Id(o),s=Id(s);var h=[],p=[],d=[];try{for(var m=fe(f),v=m.next();!v.done;v=m.next()){var g=v.value;h.push(g.sourceLayer),p.push(g.nodeIndex),d.push(g.tensorIndex)}}catch(w){c={error:w}}finally{try{v&&!v.done&&(l=m.return)&&l.call(m)}finally{if(c)throw c.error}}new ev({outboundLayer:this,inboundLayers:h,nodeIndices:p,tensorIndices:d,inputTensors:f,outputTensors:n,inputMasks:a,outputMasks:i,inputShapes:o,outputShapes:s},u);for(var y=0;y<n.length;y++)n[y].sourceLayer=this,n[y].nodeIndex=this.inboundNodes.length-1,n[y].tensorIndex=y},e.prototype.getConfig=function(){var t={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(t.batchInputShape=this.batchInputShape),this.dtype!=null&&(t.dtype=this.dtype),t},e.prototype.disposeWeights=function(){return this.weights.forEach(function(t){return t.dispose()}),this.weights.length},e.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Layer '".concat(this.name,"' is already disposed."))},e.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been ")+"built yet.");if(this._refCount===null)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used ")+"yet.");this.assertNotDisposed();var t=0;return--this._refCount===0&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}},e}(F.serialization.Serializable);function gpe(r){var e,t;r=Zt(r);var n=[];try{for(var a=fe(r),i=a.next();!i.done;i=a.next()){var o=i.value;n.push(o.shape)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return Dn(n)}function ype(r){return"float32"}function EP(r,e,t){var n,a;if((e==null||t!=null&&t>0)&&(e=r.sourceLayer,t=r.nodeIndex),e.inboundNodes.length===0)return[r];var i=e.inboundNodes[t];if(i.inboundLayers.length===0)return i.inputTensors;for(var o=[],s=0;s<i.inboundLayers.length;s++){var u=i.inputTensors[s],c=i.inboundLayers[s],l=i.nodeIndices[s],f=EP(u,c,l);try{for(var h=(n=void 0,fe(f)),p=h.next();!p.done;p=h.next()){var d=p.value;o.indexOf(d)===-1&&o.push(d)}}catch(m){n={error:m}}finally{try{p&&!p.done&&(a=h.return)&&a.call(h)}finally{if(n)throw n.error}}}return o}var bc=function(r){se(e,r);function e(t){var n=r.call(this,{dtype:t.dtype,name:t.name!=null?t.name:Gd("input").toString()})||this;if(t.batchSize==null&&(t.batchSize=null),t.sparse==null&&(t.sparse=!1),n.trainable=!1,n.built=!0,n.sparse=t.sparse,t.inputShape!=null&&t.batchInputShape!=null)throw new Z("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=t.batchInputShape;if(a==null){if(t.inputShape==null)throw new Z("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[t.batchSize].concat(t.inputShape)}else if(t.batchSize!=null)throw new Z("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=t.dtype||"float32";n.batchInputShape=a,n.dtype=i,n.inputSpec=[{shape:a}];var o=new fi(n.dtype,n.batchInputShape,n,[],{},n.name);return o.nodeIndex=0,o.tensorIndex=0,new ev({outboundLayer:n,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),n}return e.prototype.apply=function(t,n){throw new Z("Cannot pass any input to an "+"InputLayer's apply() method. InputLayer name: ".concat(this.name))},e.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},e.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},e}(mt);bc.className="InputLayer";F.serialization.registerClass(bc);function IP(r){if(r.batchShape==null&&r.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(r.batchShape!=null&&r.shape!=null)throw new Z("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var e=r.batchShape;r.shape!=null&&e==null&&(e=[null].concat(r.shape));var t=r.dtype;t==null&&(t="float32");var n=new bc({batchInputShape:e,name:r.name,dtype:t,sparse:r.sparse}),a=n.inboundNodes[0].outputTensors;return a[0]}function bpe(r,e){if(r.dtype==null||r.dtype===e.dtype)return e;try{return F.cast(e,r.dtype)}catch{throw new Z("The dtype of the feed (".concat(e.dtype,") can not be cast to the dtype ")+"of the key '".concat(r.name,"' (").concat(r.dtype,")."))}}var fc=function(){function r(e){var t,n;if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof r)for(var a in e.id2Value)this.id2Value[a]=e.id2Value[a],a in e.id2Mask&&(this.id2Mask[a]=e.id2Mask[a]);else{if(e==null)return;try{for(var i=fe(e),o=i.next();!o.done;o=i.next()){var s=o.value;this.add(s.key,s.value)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}}return r.prototype.add=function(e,t,n){if(this.id2Value[e.id]==null)this.id2Value[e.id]=bpe(e,t),this.name2Id[e.name]=e.id,n!=null&&(this.id2Mask[e.id]=n);else throw new Z("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this},r.prototype.addFeed=function(e){this.add(e.key,e.value)},r.prototype.hasKey=function(e){return this.id2Value[e.id]!=null},r.prototype.names=function(){return Object.keys(this.name2Id)},r.prototype.getValue=function(e){if(e instanceof fi){if(this.id2Value[e.id]==null)throw new Z("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}else{var t=this.name2Id[e];if(t==null)throw new Z("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}},r.prototype.getMask=function(e){if(e instanceof fi){if(this.id2Value[e.id]==null)throw new Z("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}else{var t=this.name2Id[e];if(t==null)throw new Z("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}},r.prototype.disposeMasks=function(){this.id2Mask!=null&&F.dispose(this.id2Mask)},r}(),Ad=new vP,Dd=new vP;function wpe(r){Ad?.setMaxEntries(r),Dd?.setMaxEntries(r)}function wf(r,e,t,n){var a,i,o,s,u=t==null?!1:t.training,c=Array.isArray(r),l=c?r:[r],f=l.map(function(le){return le.name}),h=[],p=e.names();try{for(var d=fe(f),m=d.next();!m.done;m=d.next()){var v=m.value;p.indexOf(v)!==-1?h.push(e.getValue(v)):h.push(null)}}catch(le){a={error:le}}finally{try{m&&!m.done&&(i=d.return)&&i.call(d)}finally{if(a)throw a.error}}n!=null&&(n.maxNumTensors=-1/0,n.minNumTensors=1/0);var g=f.join(",")+"|"+e.names().sort().join(","),y=Ad.get(g),w;if(y==null){var b=xpe(l,e);y=b.sorted,w=b.recipientCounts,Ad.put(g,y),Dd.put(g,w)}w={},u||Object.assign(w,Dd.get(g));for(var x=new fc(e),S=0;S<y.length;++S){if(n!=null){var T=F.memory().numTensors;T>n.maxNumTensors&&(n.maxNumTensors=T),T<n.minNumTensors&&(n.minNumTensors=T)}var E=y[S],C=E.sourceLayer;if(!(C instanceof bc)){var R=[],_=[],O=[],$=!1;try{for(var z=(o=void 0,fe(E.inputs)),L=z.next();!L.done;L=z.next()){var B=L.value,W=x.getValue(B),X=x.getMask(B);R.push(W),_.push(X),X!=null&&($=!0),u||(w[B.name]--,w[B.name]===0&&!e.hasKey(B)&&f.indexOf(B.name)===-1&&!W.isDisposed&&B.sourceLayer.stateful!==!0&&O.push(W))}}catch(le){o={error:le}}finally{try{L&&!L.done&&(s=z.return)&&s.call(z)}finally{if(o)throw o.error}}$&&(t=t||{},t.mask=_[0]);var J=Zt(C.apply(R,t)),V=null;C.supportsMasking&&(V=C.computeMask(R,_));for(var j=Spe(E),ne=Array.isArray(j)?j:[j],re=0;re<ne.length;++re){x.hasKey(ne[re])||x.add(ne[re],J[re],Array.isArray(V)?V[0]:V);var oe=f.indexOf(ne[re].name);oe!==-1&&(h[oe]=J[re])}u||F.dispose(O)}}return x.disposeMasks(),c?h:h[0]}function xpe(r,e){var t,n,a,i;F.util.assert(r!=null&&r.length>0,function(){return"Expected at least one fetch, got none"});var o=[],s={};if(r.length===1){var u=wO(r[0],e);o=u.sorted,s=u.recipientMap}else{var c=new Set;try{for(var l=fe(r),f=l.next();!f.done;f=l.next()){var h=f.value,p=wO(h,e),d=p.sorted,m=p.recipientMap;try{for(var v=(a=void 0,fe(d)),g=v.next();!g.done;g=v.next()){var y=g.value;c.has(y.name)||(o.push(y),c.add(y.name))}}catch(x){a={error:x}}finally{try{g&&!g.done&&(i=v.return)&&i.call(v)}finally{if(a)throw a.error}}var w=function(x){s[x]==null&&(s[x]=new Set),m[x].forEach(function(S){return s[x].add(S)})};for(var b in m)w(b)}}catch(x){t={error:x}}finally{try{f&&!f.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}}return{sorted:o,recipientCounts:kpe(s)}}function kpe(r){var e={};for(var t in r)e[t]=r[t].size;return e}function wO(r,e){var t,n,a,i,o=new Set,s=[],u={};try{for(var c=fe(e.names()),l=c.next();!l.done;l=c.next()){var f=l.value;o.add(f)}}catch(w){t={error:w}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}var h=[],p=[];for(h.push(r);h.length>0;){var d=h[h.length-1];if(o.has(d.name)){h.pop();continue}var m=p[p.length-1]===h.length-1;if(d.inputs.length===0||m)h.pop(),s.push(d),o.add(d.name),m&&p.pop();else{p.push(h.length-1);try{for(var v=(a=void 0,fe(d.inputs)),g=v.next();!g.done;g=v.next()){var y=g.value;u[y.name]==null&&(u[y.name]=new Set),u[y.name].add(d.name),!o.has(y.name)&&h.push(y)}}catch(w){a={error:w}}finally{try{g&&!g.done&&(i=v.return)&&i.call(v)}finally{if(a)throw a.error}}}}return{sorted:s,recipientMap:u}}function Spe(r){var e,t,n;if(r.sourceLayer.inboundNodes.length===1)n=r.sourceLayer.output;else{for(var a=null,i=0;i<r.sourceLayer.inboundNodes.length;++i)try{for(var o=(e=void 0,fe(r.sourceLayer.inboundNodes[i].outputTensors)),s=o.next();!s.done;s=o.next()){var u=s.value;if(u.id===r.id){a=i;break}}}catch(c){e={error:c}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}n=r.sourceLayer.getOutputAt(a)}return n}var Npe=F.env();Npe.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",function(){return 100},wpe);var CP="Abs",Tpe="Acos",Epe="Acosh",lb="Add",Ipe="AddN",Cpe="ArgMax",Ape="ArgMin",Dpe="Asin",_pe="Asinh",Fpe="Atan",Rpe="Atanh",Ope="Atan2",Ppe="AvgPool",Mpe="AvgPoolGrad",Bpe="AvgPool3D",Lpe="AvgPool3DGrad",AP="BatchMatMul",DP="BatchToSpaceND",zpe="BroadcastTo",fb="Cast",$pe="Ceil",qpe="ClipByValue",Wpe="Complex",_P="ComplexAbs",FP="Concat",RP="Conv2D",Vpe="Conv2DBackpropFilter",OP="Conv2DBackpropInput",Upe="Conv3D",Gpe="Conv3DBackpropFilterV2",Hpe="Conv3DBackpropInputV2",PP="Cos",MP="Cosh",Kpe="Cumprod",BP="Cumsum",jpe="DepthwiseConv2dNative",Xpe="DepthwiseConv2dNativeBackpropFilter",Ype="DepthwiseConv2dNativeBackpropInput",Zpe="Dilation2D",Jpe="Dilation2DBackpropInput",Qpe="Dilation2DBackpropFilter",LP="RealDiv",ede="Elu",tde="EluGrad",rde="Erf",nde="Equal",zP="Exp",$P="ExpandDims",ade="Expm1",ide="Fill",qP="Floor",WP="FloorDiv",ode="FusedBatchNorm",VP="GatherV2",sde="Greater",UP="GreaterEqual",hb="Identity",ude="Imag",cde="IsFinite",lde="IsInf",fde="IsNan",hde="LeakyRelu",pde="Less",dde="LessEqual",GP="Log",vde="Log1p",mde="LogicalAnd",gde="LogicalNot",yde="LogSoftmax",bde="LRN",wde="LRNGrad",xde="Max",HP="Maximum",kde="MaxPool",Sde="MaxPoolGrad",Nde="MaxPool3D",Tde="MaxPool3DGrad",Ede="Mean",Ide="Min",Cde="Minimum",Ade="MirrorPad",Dde="Mod",KP="Multiply",jP="Neg",_de="OnesLike",Fde="OneHot",XP="Pack",YP="PadV2",ZP="Pow",Rde="Prelu",Ode="Prod",Pde="Real",Mde="Reciprocal",Bde="Relu",JP="Reshape",Lde="ResizeNearestNeighbor",zde="ResizeNearestNeighborGrad",$de="ResizeBilinear",qde="ResizeBilinearGrad",Wde="Relu6",QP="Reverse",Vde="Round",eM="Rsqrt",Ude="TensorScatterUpdate",tM="Select",Gde="Selu",rM="Slice",nM="Sin",aM="Sinh",Hde="Sign",iM="Sigmoid",Kde="Softplus",oM="Sqrt",sM="Sum",uM="SpaceToBatchND",cM="SplitV",jde="Softmax",Xde="SquaredDifference",Yde="Square",lM="Sub",Zde="Tan",Jde="Tanh",pb="Tile",Sd="Transpose",fM="Unpack",hM="UnsortedSegmentSum",pM="ZerosLike",dM="Step";var Qde=1e-7,eve=1e-4,tve=function(){function r(){}return r.prototype.refCount=function(e){return Zn("refCount")},r.prototype.incRef=function(e){return Zn("incRef")},r.prototype.timerAvailable=function(){return!0},r.prototype.time=function(e){return Zn("time")},r.prototype.read=function(e){return Zn("read")},r.prototype.readSync=function(e){return Zn("readSync")},r.prototype.readToGPU=function(e,t){return Zn("readToGPU")},r.prototype.numDataIds=function(){return Zn("numDataIds")},r.prototype.disposeData=function(e,t){return Zn("disposeData")},r.prototype.write=function(e,t,n){return Zn("write")},r.prototype.move=function(e,t,n,a,i){return Zn("move")},r.prototype.createTensorFromGPUData=function(e,t,n){return Zn("createTensorFromGPUData")},r.prototype.memory=function(){return Zn("memory")},r.prototype.floatPrecision=function(){return Zn("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?Qde:eve},r.prototype.dispose=function(){return Zn("dispose")},r}();function Zn(r){throw new Error("'".concat(r,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function Ne(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function rve(r,e,t){t===void 0&&(t=""),Ne(db(r,e),function(){return t+" Shapes ".concat(r," and ").concat(e," must match")})}function Bi(r){if(r.length===0)return 1;for(var e=r[0],t=1;t<r.length;t++)e*=r[t];return e}function db(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function _d(r){return r%1===0}function Nd(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function Vs(r,e){var t=e.length;return r=r==null?e.map(function(n,a){return a}):[].concat(r),Ne(r.every(function(n){return n>=-t&&n<t}),function(){return"All values in axis param must be in range [-".concat(t,", ").concat(t,") but ")+"got axis ".concat(r)}),Ne(r.every(function(n){return _d(n)}),function(){return"All values in axis param must be integers but "+"got axis ".concat(r)}),r.map(function(n){return n<0?t+n:n})}function nve(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else if(r==="string")t=new Array(e);else throw new Error("Unknown data type ".concat(r));return t}function ave(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type ".concat(e," being uploaded contains ").concat(n,"."))}}function ive(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function q0(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype ".concat(r))}function ove(r){if(r==null)return 0;var e=0;return r.forEach(function(t){return e+=t.length}),e}function vb(r){return typeof r=="string"||r instanceof String}function sve(r){return typeof r=="boolean"}function uve(r){return typeof r=="number"}function tv(r){return Array.isArray(r)?tv(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":uve(r)?"float32":vb(r)?"string":sve(r)?"bool":"float32"}function W0(r){return!!(r&&r.constructor&&r.call&&r.apply)}function mb(r){var e=r.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=r[e-1];for(var n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function vM(r,e,t,n){n===void 0&&(n=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(n?2:1),o=0;o<i;o++)a[o]=t[r+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(l,f){return l*f})*(n?2:1),o=0;o<i;o++)a[o]=vM(r+o*u,s,t,n);return a}function xO(r,e,t){if(t===void 0&&(t=!1),r.length===0)return e[0];var n=r.reduce(function(a,i){return a*i})*(t?2:1);if(n===0)return[];if(n!==e.length)throw new Error("[".concat(r,"] does not match the input size ").concat(e.length).concat(t?" for a complex tensor":"","."));return vM(0,r,e,t)}function mM(r,e){for(var t=gb(r,e),n=0;n<t.length;n++)t[n]=1;return t}function gb(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error("Unknown data type ".concat(e))}function Of(r){r.forEach(function(e){Ne(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(r,"].")})})}function yb(r){return r&&r.then&&typeof r.then=="function"}var kO="tfjsflags",cve=function(){function r(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=lve,this.populateURLFlags()}return r.prototype.setPlatform=function(e,t){this.platform!=null&&(br().getBool("IS_TEST")||br().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t},r.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){var a=this.urlFlags[e];br().getBool("IS_TEST")||br().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(a,".")),this.set(e,a)}},r.prototype.getAsync=function(e){return Ce(this,void 0,void 0,function(){var t,n;return Ie(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,n=e,[4,this.evaluateFlag(e)]);case 1:return t[n]=a.sent(),[2,this.flags[e]]}})})},r.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(yb(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},r.prototype.getNumber=function(e){return this.get(e)},r.prototype.getBool=function(e){return this.get(e)},r.prototype.getString=function(e){return this.get(e)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!1,configurable:!0}),r.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},r.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()},r.prototype.setFlags=function(e){this.flags=Object.assign({},e)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if(kO in t){var n=t[kO].split(",");n.forEach(function(a){var i=te(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=hve(o,s)})}}},r}();function lve(r){var e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];return fve(e,n[0],n[1]),n.join("=")}),e}function fve(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function hve(r,e){var t=e.toLowerCase();return t==="true"||t==="false"?t==="true":"".concat(+t)===t?+t:e}function br(){return gM}var gM=null;function pve(r){gM=r}var E0;function yM(){if(E0==null){var r=void 0;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");E0=r}return E0}function dve(){var r=yM();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function bb(r,e){var t=dve();if(t.has(r))return t.get(r);var n=e();return t.set(r,n),t.get(r)}function lc(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];br().getBool("IS_TEST")||br().getBool("PROD")||console.warn.apply(console,Je([],te(r),!1))}var bM=bb("kernelRegistry",function(){return new Map}),V0=bb("gradRegistry",function(){return new Map});function SO(r,e){var t=mve(r,e);return bM.get(t)}function NO(r){return V0.get(r)}function TO(r){for(var e=bM.entries(),t=[];;){var n=e.next(),a=n.done,i=n.value;if(a)break;var o=te(i,2),s=o[0],u=o[1],c=te(s.split("_"),1),l=c[0];l===r&&t.push(u)}return t}function vve(r){var e=r.kernelName;V0.has(e)&&br().getBool("DEBUG")&&lc("Overriding the gradient for '".concat(e,"'")),V0.set(e,r)}function mve(r,e){return"".concat(e,"_").concat(r)}function gve(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}var Us=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function yve(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function bve(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){if(this instanceof n){var a=[null];a.push.apply(a,arguments);var i=Function.bind.apply(e,a);return new i}return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var a=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,a.get?a:{enumerable:!0,get:function(){return r[n]}})}),t}var wM=Jt,Ba=null;try{Ba=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Jt(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}Jt.prototype.__isLong__;Object.defineProperty(Jt.prototype,"__isLong__",{value:!0});function Qn(r){return(r&&r.__isLong__)===!0}Jt.isLong=Qn;var EO={},IO={};function Gs(r,e){var t,n,a;return e?(r>>>=0,(a=0<=r&&r<256)&&(n=IO[r],n)?n:(t=Qt(r,(r|0)<0?-1:0,!0),a&&(IO[r]=t),t)):(r|=0,(a=-128<=r&&r<128)&&(n=EO[r],n)?n:(t=Qt(r,r<0?-1:0,!1),a&&(EO[r]=t),t))}Jt.fromInt=Gs;function La(r,e){if(isNaN(r))return e?Bs:za;if(e){if(r<0)return Bs;if(r>=xM)return NM}else{if(r<=-AO)return Jn;if(r+1>=AO)return SM}return r<0?La(-r,e).neg():Qt(r%mc|0,r/mc|0,e)}Jt.fromNumber=La;function Qt(r,e,t){return new Jt(r,e,t)}Jt.fromBits=Qt;var Fd=Math.pow;function wb(r,e,t){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return za;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return wb(r.substring(1),e,t).neg();for(var a=La(Fd(t,8)),i=za,o=0;o<r.length;o+=8){var s=Math.min(8,r.length-o),u=parseInt(r.substring(o,o+s),t);if(s<8){var c=La(Fd(t,s));i=i.mul(c).add(La(u))}else i=i.mul(a),i=i.add(La(u))}return i.unsigned=e,i}Jt.fromString=wb;function yi(r,e){return typeof r=="number"?La(r,e):typeof r=="string"?wb(r,e):Qt(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}Jt.fromValue=yi;var CO=1<<16,wve=1<<24,mc=CO*CO,xM=mc*mc,AO=xM/2,DO=Gs(wve),za=Gs(0);Jt.ZERO=za;var Bs=Gs(0,!0);Jt.UZERO=Bs;var hc=Gs(1);Jt.ONE=hc;var kM=Gs(1,!0);Jt.UONE=kM;var U0=Gs(-1);Jt.NEG_ONE=U0;var SM=Qt(-1,2147483647,!1);Jt.MAX_VALUE=SM;var NM=Qt(-1,-1,!0);Jt.MAX_UNSIGNED_VALUE=NM;var Jn=Qt(0,-2147483648,!1);Jt.MIN_VALUE=Jn;var Re=Jt.prototype;Re.toInt=function(){return this.unsigned?this.low>>>0:this.low};Re.toNumber=function(){return this.unsigned?(this.high>>>0)*mc+(this.low>>>0):this.high*mc+(this.low>>>0)};Re.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Jn)){var t=La(e),n=this.div(t),a=n.mul(t).sub(this);return n.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=La(Fd(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};Re.getHighBits=function(){return this.high};Re.getHighBitsUnsigned=function(){return this.high>>>0};Re.getLowBits=function(){return this.low};Re.getLowBitsUnsigned=function(){return this.low>>>0};Re.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Jn)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};Re.isZero=function(){return this.high===0&&this.low===0};Re.eqz=Re.isZero;Re.isNegative=function(){return!this.unsigned&&this.high<0};Re.isPositive=function(){return this.unsigned||this.high>=0};Re.isOdd=function(){return(this.low&1)===1};Re.isEven=function(){return(this.low&1)===0};Re.equals=function(e){return Qn(e)||(e=yi(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Re.eq=Re.equals;Re.notEquals=function(e){return!this.eq(e)};Re.neq=Re.notEquals;Re.ne=Re.notEquals;Re.lessThan=function(e){return this.comp(e)<0};Re.lt=Re.lessThan;Re.lessThanOrEqual=function(e){return this.comp(e)<=0};Re.lte=Re.lessThanOrEqual;Re.le=Re.lessThanOrEqual;Re.greaterThan=function(e){return this.comp(e)>0};Re.gt=Re.greaterThan;Re.greaterThanOrEqual=function(e){return this.comp(e)>=0};Re.gte=Re.greaterThanOrEqual;Re.ge=Re.greaterThanOrEqual;Re.compare=function(e){if(Qn(e)||(e=yi(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Re.comp=Re.compare;Re.negate=function(){return!this.unsigned&&this.eq(Jn)?Jn:this.not().add(hc)};Re.neg=Re.negate;Re.add=function(e){Qn(e)||(e=yi(e));var t=this.high>>>16,n=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,p=0;return p+=i+c,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=n+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,Qt(h<<16|p,l<<16|f,this.unsigned)};Re.subtract=function(e){return Qn(e)||(e=yi(e)),this.add(e.neg())};Re.sub=Re.subtract;Re.multiply=function(e){if(this.isZero())return za;if(Qn(e)||(e=yi(e)),Ba){var t=Ba.mul(this.low,this.high,e.low,e.high);return Qt(t,Ba.get_high(),this.unsigned)}if(e.isZero())return za;if(this.eq(Jn))return e.isOdd()?Jn:za;if(e.eq(Jn))return this.isOdd()?Jn:za;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(DO)&&e.lt(DO))return La(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*l,p+=d>>>16,d&=65535,p+=i*l,h+=p>>>16,p&=65535,p+=o*c,h+=p>>>16,p&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=n*l+a*c+i*u+o*s,f&=65535,Qt(p<<16|d,f<<16|h,this.unsigned)};Re.mul=Re.multiply;Re.divide=function(e){if(Qn(e)||(e=yi(e)),e.isZero())throw Error("division by zero");if(Ba){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Ba.div_u:Ba.div_s)(this.low,this.high,e.low,e.high);return Qt(t,Ba.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Bs:za;var n,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Bs;if(e.gt(this.shru(1)))return kM;i=Bs}else{if(this.eq(Jn)){if(e.eq(hc)||e.eq(U0))return Jn;if(e.eq(Jn))return hc;var o=this.shr(1);return n=o.div(e).shl(1),n.eq(za)?e.isNegative()?hc:U0:(a=this.sub(e.mul(n)),i=n.add(a.div(e)),i)}else if(e.eq(Jn))return this.unsigned?Bs:za;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=za}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:Fd(2,s-48),c=La(n),l=c.mul(e);l.isNegative()||l.gt(a);)n-=u,c=La(n,this.unsigned),l=c.mul(e);c.isZero()&&(c=hc),i=i.add(c),a=a.sub(l)}return i};Re.div=Re.divide;Re.modulo=function(e){if(Qn(e)||(e=yi(e)),Ba){var t=(this.unsigned?Ba.rem_u:Ba.rem_s)(this.low,this.high,e.low,e.high);return Qt(t,Ba.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Re.mod=Re.modulo;Re.rem=Re.modulo;Re.not=function(){return Qt(~this.low,~this.high,this.unsigned)};Re.and=function(e){return Qn(e)||(e=yi(e)),Qt(this.low&e.low,this.high&e.high,this.unsigned)};Re.or=function(e){return Qn(e)||(e=yi(e)),Qt(this.low|e.low,this.high|e.high,this.unsigned)};Re.xor=function(e){return Qn(e)||(e=yi(e)),Qt(this.low^e.low,this.high^e.high,this.unsigned)};Re.shiftLeft=function(e){return Qn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Qt(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Qt(0,this.low<<e-32,this.unsigned)};Re.shl=Re.shiftLeft;Re.shiftRight=function(e){return Qn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Qt(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Qt(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Re.shr=Re.shiftRight;Re.shiftRightUnsigned=function(e){if(Qn(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var n=this.low;return Qt(n>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?Qt(t,0,this.unsigned):Qt(t>>>e-32,0,this.unsigned)};Re.shru=Re.shiftRightUnsigned;Re.shr_u=Re.shiftRightUnsigned;Re.toSigned=function(){return this.unsigned?Qt(this.low,this.high,!1):this};Re.toUnsigned=function(){return this.unsigned?this:Qt(this.low,this.high,!0)};Re.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Re.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Re.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};Jt.fromBytes=function(e,t,n){return n?Jt.fromBytesLE(e,t):Jt.fromBytesBE(e,t)};Jt.fromBytesLE=function(e,t){return new Jt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};Jt.fromBytesBE=function(e,t){return new Jt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var TM=yve(wM),xve=Whe({__proto__:null,default:TM},[wM]),kve=TM||xve;function xb(r){return kve.fromString(r,!0,16)}xb("c3a5c85c97cb3127");xb("b492b66fbe98f273");xb("9ae16a3b2f90404f");function Sve(r,e){return r instanceof Float32Array&&e==="float32"||r instanceof Int32Array&&e==="int32"||r instanceof Uint8Array&&e==="bool"}function EM(r,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=Tf(r)),br().getBool("DEBUG")&&ave(r,e),Sve(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){for(var t=new Uint8Array(r.length),n=0;n<t.length;++n)Math.round(r[n])!==0&&(t[n]=1);return t}else throw new Error("Unknown data type ".concat(e))}function Rd(){return br().platform.now()}function Nve(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",br().platform.encode(r,e)}function _O(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",br().platform.decode(r,e)}function $a(r){return br().platform.isTypedArray!=null?br().platform.isTypedArray(r):gve(r)}function Tf(r,e,t){var n,a;if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),typeof r=="boolean"||typeof r=="number"||typeof r=="string"||yb(r)||r==null||$a(r)&&t)e.push(r);else if(Array.isArray(r)||$a(r))for(var i=0;i<r.length;++i)Tf(r[i],e,t);else{var o=-1;try{for(var s=fe(Object.keys(r)),u=s.next();!u.done;u=s.next()){var c=u.value;/^([1-9]+[0-9]*|0)$/.test(c)&&(o=Math.max(o,Number(c)))}}catch(l){n={error:l}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}for(var i=0;i<=o;i++)Tf(r[i],e,t)}return e}var Tve=function(){function r(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new Ive)}return r.prototype.profileKernel=function(e,t,n){var a,i,o,s=function(){o=n()},u,c=Rd();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var l=fe(o),f=l.next();!f.done;f=l.next()){var h=f.value;h.dataSync()}}catch(v){a={error:v}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:Rd()-c})}if(br().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var p=function(v){var g=o[v];g.data().then(function(y){Eve(y,g.dtype,e)})},d=0;d<o.length;d++)p(d);var m={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(v){return v.kernelMs}),extraInfo:u.then(function(v){return v.getExtraProfileInfo!=null?v.getExtraProfileInfo():""})};return m},r.prototype.logKernelProfile=function(e){var t=this,n=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(c){t.logger.logKernelProfile(n,u,c[0],c[1],o,c[2])})})},r}();function Eve(r,e,t){if(e!=="float32")return!1;for(var n=0;n<r.length;n++){var a=r[n];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(t,"'")),!0}return!1}var Ive=function(){function r(){}return r.prototype.logKernelProfile=function(e,t,n,a,i,o){var s=typeof a=="number"?Nd("".concat(a,"ms"),9):a.error,u=Nd(e,25),c=t.rank,l=t.size,f=Nd(t.shape.toString(),14),h="";for(var p in i){var d=i[p];if(d!=null){var m=d.shape||t.shape,v=m.length;h+="".concat(p,": ").concat(v,"D ").concat(v>0?m:""," ")}}console.log("%c".concat(u,"	%c").concat(s,"	%c").concat(c,"D ").concat(f,"	%c").concat(l,"	%c").concat(h,"	%c").concat(o),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r}();function Cve(r,e,t){for(var n={},a={},i=0;i<e.length;i++)n[e[i].id]=!0;for(var i=0;i<r.length;i++){var o=r[i],s=o.inputs;for(var u in s){for(var c=s[u],l=!1,f=0;f<e.length;f++)if(n[c.id]){o.outputs.forEach(function(w){return n[w.id]=!0}),l=!0,a[o.id]=!0;break}if(l)break}}var h={};h[t.id]=!0;for(var p={},i=r.length-1;i>=0;i--)for(var o=r[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,p[o.id]=!0;break}for(var d=[],i=0;i<r.length;i++){var o=r[i];if(a[o.id]&&p[o.id]){var m={};for(var u in o.inputs){var v=o.inputs[u];n[v.id]&&(m[u]=v)}var g=Object.assign({},o);g.inputs=m,g.outputs=o.outputs,d.push(g)}}return d}function Ave(r,e,t,n){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var p=r[h.id];p!=null?u.push(p):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(s.kernelName,"."));var c=s.gradient(u),l=function(h){if(!(h in c))throw new Error("Cannot backprop through input ".concat(h,". ")+"Available gradients found: ".concat(Object.keys(c),"."));var p=t(function(){return c[h]()});if(p.dtype!=="float32")throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"".concat(h," must have 'float32' dtype, but has '").concat(p.dtype,"'"));var d=s.inputs[h];if(!db(p.shape,d.shape))throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"'".concat(h,"' has shape '").concat(p.shape,"', which does not match ")+"the shape of the input '".concat(d.shape,"'"));if(r[d.id]==null)r[d.id]=p;else{var m=r[d.id];r[d.id]=n(m,p),m.dispose()}};for(var f in s.inputs)l(f)},i=e.length-1;i>=0;i--)a(i)}var FO=20,pf=3,I0=7;function Dve(r,e,t,n){var a=mb(e),i=_ve(r,e,t,a),o=e.length,s=Td(r,e,t,a,i),u=["Tensor"];return n&&(u.push("  dtype: ".concat(t)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(e,"]")),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function _ve(r,e,t,n){var a=Bi(e),i=n[n.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?kf(r):r;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,f=0;f<i;f++)o[f]=Math.max(o[f],xf(u[l+f],0,t).length);return o}function xf(r,e,t){var n;return Array.isArray(r)?n="".concat(parseFloat(r[0].toFixed(I0))," + ")+"".concat(parseFloat(r[1].toFixed(I0)),"j"):vb(r)?n="'".concat(r,"'"):t==="bool"?n=IM(r):n=parseFloat(r.toFixed(I0)).toString(),Nd(n,e)}function IM(r){return r===0?"false":"true"}function Td(r,e,t,n,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var c=kf(r);return[xf(c[0],0,t)]}return t==="bool"?[IM(r[0])]:[r[0].toString()]}if(u===1){if(s>FO){var l=pf*o,f=Array.from(r.slice(0,l)),h=Array.from(r.slice((s-pf)*o,s*o));return t==="complex64"&&(f=kf(f),h=kf(h)),["["+f.map(function(T,E){return xf(T,a[E],t)}).join(", ")+", ..., "+h.map(function(T,E){return xf(T,a[s-pf+E],t)}).join(", ")+"]"]}var p=t==="complex64"?kf(r):Array.from(r);return["["+p.map(function(T,E){return xf(T,a[E],t)}).join(", ")+"]"]}var d=e.slice(1),m=n.slice(1),v=n[0]*o,g=[];if(s>FO){for(var y=0;y<pf;y++){var w=y*v,b=w+v;g.push.apply(g,Je([],te(Td(r.slice(w,b),d,t,m,a,!1)),!1))}g.push("...");for(var y=s-pf;y<s;y++){var w=y*v,b=w+v;g.push.apply(g,Je([],te(Td(r.slice(w,b),d,t,m,a,y===s-1)),!1))}}else for(var y=0;y<s;y++){var w=y*v,b=w+v;g.push.apply(g,Je([],te(Td(r.slice(w,b),d,t,m,a,y===s-1)),!1))}var x=u===2?",":"";g[0]="["+(s>0?g[0]+x:"");for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+x;for(var S=`,
`,y=2;y<u;y++)S+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":S),g}function kf(r){for(var e=[],t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}(function(){function r(e,t,n){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=Bi(e),n!=null){var i=n.length;Ne(i===this.size,function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||nve(t,this.size),this.strides=mb(e)}return r.prototype.set=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];n.length===0&&(n=[0]),Ne(n.length===this.rank,function(){return"The number of provided coordinates (".concat(n.length,") must ")+"match the rank (".concat(t.rank,")")});var i=this.locToIndex(n);this.values[i]=e},r.prototype.get=function(){for(var e,t,n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];n.length===0&&(n=[0]);var i=0;try{for(var o=fe(n),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var c="Requested out of range element at ".concat(n,". ")+"  Buffer shape=".concat(this.shape);throw new Error(c)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var l=n[n.length-1],f=0;f<n.length-1;++f)l+=this.strides[f]*n[f];return this.values[l]},r.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},r.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),r.prototype.toTensor=function(){return li().makeTensor(this.values,this.shape,this.dtype)},r})();var li=null,df=null;function Fve(r){li=r}var Ma=function(){function r(e,t,n,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Bi(e),this.strides=mb(e),this.dataId=n,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),r.prototype.buffer=function(){return Ce(this,void 0,void 0,function(){var e;return Ie(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,df.buffer(this.shape,this.dtype,e)]}})})},r.prototype.bufferSync=function(){return df.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return Ce(this,void 0,void 0,function(){var e;return Ie(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,xO(this.shape,e,this.dtype==="complex64")]}})})},r.prototype.arraySync=function(){return xO(this.shape,this.dataSync(),this.dtype==="complex64")},r.prototype.data=function(){return Ce(this,void 0,void 0,function(){var e,t;return Ie(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=li().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(a){return _O(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}})})},r.prototype.dataToGPU=function(e){return this.throwIfDisposed(),li().readToGPU(this.dataId,e)},r.prototype.dataSync=function(){this.throwIfDisposed();var e=li().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return _O(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},r.prototype.bytes=function(){return Ce(this,void 0,void 0,function(){var e;return Ie(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,li().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(li().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!1,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.print=function(e){return e===void 0&&(e=!1),df.print(this,e)},r.prototype.clone=function(){return this.throwIfDisposed(),df.clone(this)},r.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return Dve(t,this.shape,this.dtype,e)},r.prototype.cast=function(e){return this.throwIfDisposed(),df.cast(this,e)},r.prototype.variable=function(e,t,n){return e===void 0&&(e=!0),this.throwIfDisposed(),li().makeVariable(this,e,t,n)},r}();Object.defineProperty(Ma,Symbol.hasInstance,{value:function(r){return!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null}});function Rve(){return bb("Tensor",function(){return Ma})}Rve();var Od=function(r){se(e,r);function e(t,n,a,i){var o=r.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=n,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(t.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!db(t.shape,this.shape))throw new Error("shape of the new value (".concat(t.shape,") and ")+"previous value (".concat(this.shape,") must match"));li().disposeTensor(this),this.dataId=t.dataId,li().incRef(this,null)},e.prototype.dispose=function(){li().disposeVariable(this),this.isDisposedInternal=!0},e}(Ma);Object.defineProperty(Od,Symbol.hasInstance,{value:function(r){return r instanceof Ma&&r.assign!=null&&r.assign instanceof Function}});var RO;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(RO||(RO={}));var G0;(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(G0||(G0={}));var H0;(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(H0||(H0={}));var K0;(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(K0||(K0={}));var j0;(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(j0||(j0={}));var Ove={float32:K0,int32:G0,bool:H0,complex64:j0};function Pve(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error("Can not upcast ".concat(r," with ").concat(e))}return Ove[r][e]}function CM(r){return r!=null&&typeof r=="object"&&"texture"in r&&r.texture instanceof WebGLTexture}function AM(r){return typeof GPUBuffer<"u"&&r!=null&&typeof r=="object"&&"buffer"in r&&r.buffer instanceof GPUBuffer}function ya(r,e){if(r.dtype===e.dtype)return[r,e];var t=Pve(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function DM(r){var e=[],t=new Set;return _M(r,e,t),e}function _M(r,e,t){if(r!=null){if(r instanceof Ma){e.push(r);return}if(!!Mve(r)){var n=r;for(var a in n){var i=n[a];t.has(i)||(t.add(i),_M(i,e,t))}}}}function Mve(r){return Array.isArray(r)||typeof r=="object"}function C0(r){return r.kernelName!=null}var OO=function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return r.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},r}(),kb=function(){function r(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new OO}return r.prototype.ready=function(){return Ce(this,void 0,void 0,function(){var e,t,n,a;return Ie(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(n)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,n=e.asyncInit;if(n)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!1,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},r.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},r.prototype.registerBackend=function(e,t,n){return n===void 0&&(n=1),e in this.registryFactory?(lc("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},r.prototype.setBackend=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o;return Ie(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '".concat(e,"' not found in registry"));return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,a=t.asyncInit,a?[4,n]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=n,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Tve(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var e=this,t=TO(this.backendName);t.forEach(function(n){n.setupFunc!=null&&n.setupFunc(e.backendInstance)})},r.prototype.disposeRegisteredKernels=function(e){var t=this,n=TO(e);n.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},r.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(n==null)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var a=n.factory();if(a&&!(a instanceof tve)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,lc("Initialization of backend ".concat(e," failed")),lc(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return lc("Initialization of backend ".concat(e," failed")),lc(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],a=this.initializeBackend(n),i=a.success,o=a.asyncInit;if(o||i)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),a=n.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(e,t){var n=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return n.startScope(a)},function(){return n.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},r.prototype.scopedRun=function(e,t,n){e();try{var a=n();return t(),a}catch(i){throw t(),i}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(e){var t=ve.runKernel(hb,{x:e}),n={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},c={dtype:s};return ve.runKernel(fb,u,c)}}},i=[];return this.addTapeNode(this.state.activeScope.name,n,[t],a,i,{}),t},r.prototype.runKernel=function(e,t,n){this.backendName==null&&this.backend;var a=SO(e,this.backendName)!=null;if(!a)throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(e,t,n){var a=this.backend.numDataIds(),i=0;n.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(s," data ids) after running '").concat(e,"'"))},r.prototype.runKernelFunc=function(e){var t=this,n,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var c,l=C0(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(C0(e)){var f=e.kernelName,h=e.inputs,p=e.attrs;this.backendName==null&&this.backend;var d=SO(f,this.backendName);Ne(d!=null,function(){return"Cannot find registered kernel '".concat(f,"' for backend '").concat(t.backendName,"'")}),u=function(){var x=t.backend.numDataIds();c=d.kernelFunc({inputs:h,attrs:p,backend:t.backend});var S=Array.isArray(c)?c:[c];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,x,S);var T=S.map(function(C){return C.rank!=null?C:t.makeTensorFromTensorInfo(C)});if(i){var E=t.getTensorsForGradient(f,h,T);a=t.saveTensorsForBackwardMode(E)}return T}}else{var m=e.forwardFunc,v=function(x){!i||(a=x.map(function(S){return t.keep(t.clone(S))}))};u=function(){var x=t.backend.numDataIds();c=t.tidy(function(){return m(t.backend,v)});var S=Array.isArray(c)?c:[c];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(l,x,S),S}}var g=e.inputs,y=e.attrs,w=C0(e)?null:e.backwardsFunc,b;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?n=u():(b=t.profiler.profileKernel(l,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(b),n=b.outputs)}),i&&this.addTapeNode(l,g,n,w,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(x){return g[x]!=null?g[x].shape:null}),outputShapes:n.map(function(x){return x.shape}),kernelTimeMs:b.timeMs,extraInfo:b.extraInfo}),Array.isArray(c)?n:n[0]},r.prototype.saveTensorsForBackwardMode=function(e){var t=this,n=e.map(function(a){return t.keep(t.clone(a))});return n},r.prototype.getTensorsForGradient=function(e,t,n){var a=NO(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(Ne(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(c){return t[c]})):s=i.map(function(c){return t[c]});var u=n.filter(function(c,l){return o[l]});return s.concat(u)}return[]},r.prototype.makeTensor=function(e,t,n,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",a=a||this.backend;var i=e;n==="string"&&vb(e[0])&&(i=e.map(function(l){return Nve(l)}));var o=a.write(i,t,n),s=new Ma(t,n,o,this.nextTensorId());if(this.trackTensor(s,a),n==="string"){var u=this.state.tensorInfo.get(o),c=ove(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},r.prototype.makeTensorFromDataId=function(e,t,n,a){n=n||"float32";var i={dataId:e,shape:t,dtype:n};return this.makeTensorFromTensorInfo(i,a)},r.prototype.makeTensorFromTensorInfo=function(e,t){var n=e.dataId,a=e.shape,i=e.dtype,o=new Ma(a,i,n,this.nextTensorId());return this.trackTensor(o,t),o},r.prototype.makeVariable=function(e,t,n,a){t===void 0&&(t=!0),n=n||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new Od(e,t,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name ".concat(i.name," was already registered"));return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},r.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*q0(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof Od||this.track(e)},r.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},r.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},r.prototype.disposeTensor=function(e){if(!!this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var n=e.size*q0(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},r.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},r.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},r.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},r.prototype.profile=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h;return Ie(this,function(p){switch(p.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=p.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,Je([],te(this.state.activeProfile.kernels.map(function(d){return d.totalBytesSnapshot})),!1)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,p.label=2;case 2:p.trys.push([2,8,9,10]),i=fe(this.state.activeProfile.kernels),o=i.next(),p.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=p.sent(),c=s,[4,s.extraInfo];case 5:c.extraInfo=p.sent(),p.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return l=p.sent(),f={error:l},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(e,t,n,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},c=NO(e);c!=null&&(a=c.gradFunc),a!=null&&(u.gradient=function(l){return l=l.map(function(f,h){if(f==null){var p=n[h],d=gb(p.size,p.dtype);return s.makeTensor(d,p.shape,p.dtype)}return f}),a(l.length>1?l:l[0],i,o)}),this.state.activeTape.push(u)},r.prototype.keep=function(e){return e.kept=!0,e},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(e){for(var t=this,n=DM(e),a=new Set(n.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},r.prototype.gradients=function(e,t,n,a){var i=this;if(a===void 0&&(a=!1),Ne(t.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});Ne(o instanceof Ma,function(){return"The result y returned by f() must be a tensor."});var s=Cve(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=n??Bve(o.shape),Ave(u,s,function(l){return i.tidy(l)},zve);var c=t.map(function(l){return u[l.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(l){var f,h;try{for(var p=fe(l.saved),d=p.next();!d.done;d=p.next()){var m=d.value;m.dispose()}}catch(v){f={error:v}}finally{try{d&&!d.done&&(h=p.return)&&h.call(p)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:c}})},r.prototype.customGrad=function(e){var t=this;return Ne(W0(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];Ne(n.every(function(c){return c instanceof Ma}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};n.forEach(function(c,l){o[l]=c});var s=function(c,l){return i=e.apply(void 0,Je([],te(Je(Je([],te(n),!1),[l],!1)),!1)),Ne(i.value instanceof Ma,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),Ne(W0(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(c,l){var f=i.gradFunc(c,l),h=Array.isArray(f)?f:[f];Ne(h.length===n.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),Ne(h.every(function(d){return d instanceof Ma}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return h.forEach(function(d,m){p[m]=function(){return d}}),p};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},r.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},r.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},r.prototype.readToGPU=function(e,t){var n=this.state.tensorInfo.get(e);return n.backend.readToGPU(e,t)},r.prototype.time=function(e){return Ce(this,void 0,void 0,function(){var t,n;return Ie(this,function(a){switch(a.label){case 0:return t=Rd(),[4,this.backend.time(e)];case 1:return n=a.sent(),n.wallMs=Rd()-t,[2,n]}})})},r.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!1,configurable:!0}),r.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new OO;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r}();kb.nextTensorId=0;kb.nextVariableId=0;function Bve(r){var e=mM(Bi(r),"float32");return ve.makeTensor(e,r,"float32")}function Lve(){var r=yM();if(r._tfengine==null){var e=new cve(r);r._tfengine=new kb(e)}return pve(r._tfengine.ENV),Fve(function(){return r._tfengine}),r._tfengine}var ve=Lve();function zve(r,e){var t={a:r,b:e};return ve.runKernel(lb,t)}function $ve(r,e){var t=r;if($a(r))return e==="string"?[]:[r.length];if(CM(r)){var n=r.channels||"RGBA";return[r.height,r.width*n.length]}else if(AM(r))return[r.buffer.size/(e==null?4:q0(e))];if(!Array.isArray(r))return[];for(var a=[];Array.isArray(t)||$a(t)&&e!=="string";)a.push(t.length),t=t[0];return Array.isArray(r)&&br().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&FM(r,a,[]),a}function FM(r,e,t){if(t=t||[],!Array.isArray(r)&&!$a(r)){Ne(e.length===0,function(){return"Element arr[".concat(t.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(e[0]," elements")});return}Ne(e.length>0,function(){return"Element arr[".concat(t.join("]["),"] should be a primitive, ")+"but is an array of ".concat(r.length," elements")}),Ne(r.length===e[0],function(){return"Element arr[".concat(t.join("]["),"] should have ").concat(e[0]," ")+"elements, but has ".concat(r.length," elements")});for(var n=e.slice(1),a=0;a<r.length;++a)FM(r[a],n,t.concat(a))}function PO(r,e,t,n){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==e||r==="numeric"&&e==="string")throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must ")+"be ".concat(r," tensor, but got ").concat(e," tensor"))}}function Ee(r,e,t,n){if(n===void 0&&(n="numeric"),r instanceof Ma)return PO(n,r.dtype,e,t),r;var a=tv(r);if(a!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(a=n),PO(n,a,e,t),r==null||!$a(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var i=r==null?"null":r.constructor.name;throw new Error("Argument '".concat(e,"' passed to '").concat(t,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=$ve(r,a);!$a(r)&&!Array.isArray(r)&&(r=[r]);var s=!0,u=a!=="string"?EM(r,a):Tf(r,[],s);return ve.makeTensor(u,o,a)}function RM(r,e,t,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument ".concat(e," passed to ").concat(t," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=r;return a.map(function(i,o){return Ee(i,"".concat(e,"[").concat(o,"]"),t,n)})}var qve="__op";function Ve(r){var e=Object.keys(r);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(e.length," keys."));var t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+qve;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];ve.startScope(t);try{var s=n.apply(void 0,Je([],te(i),!1));return yb(s)&&console.error("Cannot return a Promise inside of tidy."),ve.endScope(s),s}catch(u){throw ve.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function Wve(r,e){var t=Ee(r,"x","cast");if(!ive(e))throw new Error("Failed to cast to unknown dtype ".concat(e));if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var n={x:t},a={dtype:e};return ve.runKernel(fb,n,a)}var St=Ve({cast_:Wve});function Vve(r,e){var t,n=Ee(r,"a","mul"),a=Ee(e,"b","mul");t=te(ya(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ve.runKernel(KP,i)}var be=Ve({mul_:Vve});function Uve(r,e){e===void 0&&(e=0);var t=Ee(r,"x","step"),n={x:t},a={alpha:e};return ve.runKernel(dM,n,a)}var Sb=Ve({step_:Uve}),OM={kernelName:CP,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(r,Sb(St(n,"float32"),-1))}}}};function Gve(r,e){var t,n=Ee(r,"a","floorDiv"),a=Ee(e,"b","floorDiv");t=te(ya(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ve.runKernel(WP,i)}var Hve=Ve({floorDiv_:Gve});function Kve(r,e){var t,n=Ee(r,"a","div"),a=Ee(e,"b","div");if(t=te(ya(n,a),2),n=t[0],a=t[1],n.dtype==="int32"&&a.dtype==="int32")return Hve(n,a);var i={a:n,b:a},o={};return ve.runKernel(LP,i,o)}var Ot=Ve({div_:Kve});function jve(r){var e=Ee(r,"x","neg"),t={x:e};return ve.runKernel(jP,t)}var Wa=Ve({neg_:jve});function Xve(r,e,t,n){if(n==null)n=tv(r);else if(n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(AM(r)||CM(r)){if(n!=="float32"&&n!=="int32")throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(n,"."));return ve.backend.createTensorFromGPUData(r,e||t,n)}if(!$a(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Of(e);var a=Bi(e),i=Bi(t);Ne(a===i,function(){return"Based on the provided shape, [".concat(e,"], the tensor should have ")+"".concat(a," values but has ").concat(i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==Bi(e.slice(o)):!0;Ne(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(t,") does not match the provided ")+"shape (".concat(e,"). ")})}}return!$a(r)&&!Array.isArray(r)&&(r=[r]),e=e||t,r=n!=="string"?EM(r,n):Tf(r,[],!0),ve.makeTensor(r,e,n)}function Nr(r,e){if(($a(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&$a(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],n=[];return Xve(r,t,n,e)}function Yve(r){var e=Ee(r,"x","sqrt","float32"),t={x:e};return ve.runKernel(oM,t)}var mi=Ve({sqrt_:Yve});function Zve(r){var e=Ee(r,"x","square"),t={};return ve.runKernel("Square",{x:e},t)}var Tr=Ve({square_:Zve});function Jve(r,e){var t,n=Ee(r,"a","sub"),a=Ee(e,"b","sub");t=te(ya(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ve.runKernel(lM,i)}var tn=Ve({sub_:Jve}),Qve={kernelName:Tpe,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){var a=Tr(St(n,"float32")),i=mi(tn(Nr(1),a));return Wa(Ot(r,i))}}}},eme={kernelName:Epe,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){var a=mi(tn(Tr(St(n,"float32")),1));return Ot(r,a)}}}};function rn(r,e){for(var t=[],n=0;n<e.length;n++){var a=r[r.length-n-1],i=e.length-n-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function hn(r,e){for(var t=Math.max(r.length,e.length),n=new Array(t),a=0;a<t;a++){var i=r[r.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)n[t-a-1]=o;else if(o===1)n[t-a-1]=i;else if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(r," and ").concat(e,".");throw Error(s)}else n[t-a-1]=i}return n}function tme(r,e){var t=Ee(r,"x","reshape","string_or_numeric"),n={x:t},a={shape:e};return ve.runKernel(JP,n,a)}var Qe=Ve({reshape_:tme});function rme(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=Ee(r,"x","sum");n.dtype==="bool"&&(n=St(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return ve.runKernel(sM,a,i)}var wr=Ve({sum_:rme}),nme={kernelName:lb,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=hn(n.shape,a.shape),o=function(){var u=r,c=rn(n.shape,i);return c.length>0&&(u=wr(u,c)),Qe(u,n.shape)},s=function(){var u=r,c=rn(a.shape,i);return c.length>0&&(u=wr(u,c)),Qe(u,a.shape)};return{a:o,b:s}}};var ame={kernelName:Ipe,saveAllInputs:!0,gradFunc:function(r,e){var t={};return e.forEach(function(n,a){t[a]=function(){return r.clone()}}),t}};function ime(r){var e=Ee(r,"x","zerosLike"),t={x:e};return ve.runKernel(pM,t)}var At=Ve({zerosLike_:ime}),ome={kernelName:Cpe,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return At(n)}}}},sme={kernelName:Ape,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return At(n)}}}},ume={kernelName:Dpe,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Ot(r,mi(tn(Nr(1),Tr(St(n,"float32")))))}}}};function cme(r,e){var t,n=Ee(r,"a","add"),a=Ee(e,"b","add");t=te(ya(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ve.runKernel(lb,i)}var xt=Ve({add_:cme}),lme={kernelName:_pe,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){var a=mi(xt(Nr(1),Tr(St(n,"float32"))));return Ot(r,a)}}}},fme={kernelName:Ope,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=hn(n.shape,a.shape),o=function(){var u=xt(Tr(n),Tr(a)),c=be(r,Ot(a,u)),l=rn(n.shape,i);return l.length>0&&(c=wr(c,l)),Qe(c,n.shape)},s=function(){var u=xt(Tr(n),Tr(a)),c=Wa(be(r,Ot(n,u))),l=rn(a.shape,i);return l.length>0&&(c=wr(c,l)),Qe(c,a.shape)};return{a:o,b:s}}},hme={kernelName:Fpe,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Ot(r,xt(Tr(St(n,"float32")),1))}}}},pme={kernelName:Rpe,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Ot(r,tn(Nr(1),Tr(St(n,"float32"))))}}}};function PM(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function Ef(r){var e=te(PM(r),3),t=e[0],n=e[1],a=e[2];return t===1&&n===1&&a===1}function MM(r,e){return Ef(r)||Ef(e)}function MO(r){return PM(r).every(function(e){return e>0})}function Hs(r,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,"."));if(typeof e=="number")Ne(_d(e),function(){return"Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,".")});else if(typeof e=="object")e.forEach(function(n){n.forEach(function(a){Ne(_d(a),function(){return"Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(a,".")})})});else throw Error("Error in ".concat(r,": Unknown padding parameter: ").concat(e))}}function dme(r,e,t,n,a,i){var o=Ee(r,"dy","avgPool3dGrad"),s=Ee(e,"input","avgPool3dGrad"),u=o,c=s,l=!1;s.rank===4&&(l=!0,u=Qe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=Qe(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),Ne(u.rank===5,function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank "+"".concat(u.rank,".")}),Ne(c.rank===5,function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank "+"".concat(c.rank,".")}),Hs("avgPool3dGrad",a,i);var f={dy:u,input:c},h={filterSize:t,strides:n,pad:a,dimRoundingMode:i},p=ve.runKernel(Lpe,f,h);return l?Qe(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var vme=Ve({avgPool3dGrad_:dme}),mme={kernelName:Bpe,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.filterSize,o=t.strides,s=t.pad,u=t.dimRoundingMode;return{x:function(){return vme(r,a,i,o,s,u)}}}};function gme(r,e,t,n,a){var i=Ee(r,"dy","avgPoolGrad"),o=Ee(e,"input","avgPoolGrad");Ne(o.rank===i.rank,function(){return"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")});var s=o,u=i,c=!1;o.rank===3&&(c=!0,s=Qe(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=Qe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Ne(u.rank===4,function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank "+"".concat(u.rank,".")}),Ne(s.rank===4,function(){return"Error in avgPoolGrad: input must be rank 4 but got rank "+"".concat(s.rank,".")});var l={dy:u,input:s},f={filterSize:t,strides:n,pad:a},h=ve.runKernel(Mpe,l,f);return c?Qe(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var yme=Ve({avgPoolGrad_:gme}),bme={kernelName:Ppe,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.filterSize,o=t.strides,s=t.pad;return{x:function(){return yme(r,a,i,o,s)}}}};function wme(r,e,t,n){var a;t===void 0&&(t=!1),n===void 0&&(n=!1);var i=Ee(r,"a","matMul"),o=Ee(e,"b","matMul");a=te(ya(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:n};return ve.runKernel(AP,s,u)}var Wo=Ve({matMul_:wme}),xme={kernelName:AP,inputsToSave:["a","b"],gradFunc:function(r,e,t){var n=te(e,2),a=n[0],i=n[1],o=t.transposeA,s=t.transposeB;return!o&&!s?{a:function(){return Wo(r,i,!1,!0)},b:function(){return Wo(a,r,!0,!1)}}:!o&&s?{a:function(){return Wo(r,i,!1,!1)},b:function(){return Wo(r,a,!0,!1)}}:o&&!s?{a:function(){return Wo(i,r,!1,!0)},b:function(){return Wo(a,r,!1,!1)}}:{a:function(){return Wo(i,r,!0,!0)},b:function(){return Wo(r,a,!0,!0)}}}};function kme(r,e,t){var n=Ee(r,"x","spaceToBatchND");Ne(n.rank>=1+e.length,function(){return"input rank ".concat(n.rank," should be > than [blockShape] ").concat(e.length)}),Ne(t.length===e.length,function(){return"paddings.shape[0] ".concat(t.length," must be equal to [blockShape] ").concat(e.length)}),Ne(n.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions ".concat(n.shape.slice(1)," with paddings ").concat(t.toString()," must be divisible by blockShapes ").concat(e.toString())});var a={x:n},i={blockShape:e,paddings:t};return ve.runKernel(uM,a,i)}var Sme=Ve({spaceToBatchND_:kme});var Nme={kernelName:DP,gradFunc:function(r,e,t){var n=t.blockShape,a=t.crops;return{x:function(){return Sme(r,n,a)}}}};var Tme={kernelName:zpe,gradFunc:function(r,e,t){for(var n=t,a=n.inputShape,i=n.shape,o=Array.from(i),s=a.length-1;s>=0;s--)if(a[s]===i[s])o[s]=1;else if(a[s]!==1)throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(i,"]."));for(var u=[],s=0;s<o.length;s++)o[s]>1&&u.push(s);return{x:function(){return wr(r,u,!0)}}}};var Eme={kernelName:fb,gradFunc:function(r){return{x:function(){return r.clone()}}}};var Ime={kernelName:$pe,gradFunc:function(r){return{x:function(){return At(r)}}}};function Cme(r,e){var t,n=Ee(r,"a","greaterEqual","string_or_numeric"),a=Ee(e,"b","greaterEqual","string_or_numeric");t=te(ya(n,a),2),n=t[0],a=t[1],hn(n.shape,a.shape);var i={a:n,b:a};return ve.runKernel(UP,i)}var Nb=Ve({greaterEqual_:Cme});function Ame(r,e){var t,n=Ee(r,"a","lessEqual","string_or_numeric"),a=Ee(e,"b","lessEqual","string_or_numeric");t=te(ya(n,a),2),n=t[0],a=t[1],hn(n.shape,a.shape);var i={a:n,b:a};return ve.runKernel(dde,i)}var Tb=Ve({lessEqual_:Ame});function Dme(r,e){var t=Ee(r,"a","logicalAnd","bool"),n=Ee(e,"b","logicalAnd","bool");hn(t.shape,n.shape);var a={a:t,b:n};return ve.runKernel(mde,a)}var BM=Ve({logicalAnd_:Dme});function _me(r){var e=Ee(r,"x","clone","string_or_numeric"),t={x:e};return ve.runKernel(hb,t)}var LM=Ve({clone_:_me});function Fme(r,e){var t=Ee(r,"broadcastTo","x"),n=t.shape;if(Of(e),e.length<t.rank)throw new Error("broadcastTo(): shape.length=".concat(e.length," < input.rank=").concat(t.rank,"."));if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=Qe(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): [".concat(n,"] cannot be broadcast to [").concat(e,"]."));var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return LM(t);var c={x:t},l={reps:o};return ve.runKernel(pb,c,l)}var A0=Ve({broadcastTo_:Fme});function Rme(r,e,t){var n=Ee(e,"a","where"),a=Ee(t,"b","where"),i=Ee(r,"condition","where","bool"),o=hn(hn(i.shape,n.shape),a.shape),s=A0(i,o),u=A0(n,o),c=A0(a,o),l={condition:s,t:u,e:c};return ve.runKernel(tM,l)}var qs=Ve({where_:Rme}),Ome={kernelName:qpe,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.clipValueMin,o=t.clipValueMax;return{x:function(){return qs(BM(Nb(a,i),Tb(a,o)),r,At(r))}}}};var Pme={kernelName:_P,inputsToSave:["x"],gradFunc:OM.gradFunc};function Mme(r,e,t){t===void 0&&(t=0);var n=Ee(r,"x","split"),a={x:n},i={numOrSizeSplits:e,axis:t};return ve.runKernel(cM,a,i)}var Bme=Ve({split_:Mme});var Lme={kernelName:FP,saveAllInputs:!0,gradFunc:function(r,e,t){var n=e.map(function(u){return u.shape}),a=t.axis,i=Vs(a,e[0].shape)[0],o=n.map(function(u){return u[i]}),s=Bme(r,o,i);return s.map(function(u){return function(){return u}})}};function zme(r,e,t,n,a,i,o){i===void 0&&(i="NHWC");var s=r;r.rank===3&&(s=Qe(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=Qe(e,[1,e.shape[0],e.shape[1],e.shape[2]])),Ne(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")}),Ne(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")}),Ne(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(t,".")});var c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];Ne(c===t[2],function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(t[2],".")}),Ne(l===t[3],function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(t[3],").")}),Hs("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return ve.runKernel(Vpe,f,h)}var zM=Ve({conv2DBackpropFilter_:zme});function $me(r,e,t,n,a,i,o){i===void 0&&(i="NHWC"),Ne(r.length===e.rank,function(){return"Length of inShape "+"(".concat(r.length,") and rank of dy (").concat(e.rank,") must match")});var s=r,u=e,c=!1;e.rank===3&&(c=!0,u=Qe(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,r[0],r[1],r[2]]),Ne(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")}),Ne(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)}),Ne(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(t.rank)});var l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];Ne(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(t.shape[2],".")}),Ne(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output (".concat(f,") must ")+"match output depth for filter ".concat(t.shape[3],".")}),Hs("conv2dDerInput",a,o);var h={dy:u,filter:t},p={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=ve.runKernel(OP,h,p);return c?Qe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var qme=Ve({conv2DBackpropInput_:$me}),Wme={kernelName:RP,inputsToSave:["x","filter"],gradFunc:function(r,e,t){var n=te(e,2),a=n[0],i=n[1],o=t.dilations,s=t.strides,u=t.pad,c=t.dataFormat;return Ne(Ef(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(o,"'")}),{x:function(){return qme(a.shape,r,i,s,u,c)},filter:function(){return zM(a,r,i.shape,s,u,c)}}}};function Vme(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=Ee(r,"x","conv2d","float32"),u=Ee(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=Qe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Ne(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")}),Ne(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")}),Hs("conv2d",n,o);var f=a==="NHWC"?c.shape[3]:c.shape[1];Ne(f===u.shape[2],function(){return"Error in conv2d: depth of input (".concat(f,") must match ")+"input depth for filter ".concat(u.shape[2],".")}),Ne(MM(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),Ne(MO(i),function(){return"Error in conv2D: Dilated rates should be larger than 0."}),Ne(MO(t),function(){return"Error in conv2D: Strides should be larger than 0."});var h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=ve.runKernel(RP,h,p);return l?Qe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Ume=Ve({conv2d_:Vme}),Gme={kernelName:OP,inputsToSave:["dy","filter"],gradFunc:function(r,e,t){var n=te(e,2),a=n[0],i=n[1],o=t.strides,s=t.pad,u=t.dataFormat,c=t.dimRoundingMode;return{dy:function(){return Ume(r,i,o,s,u,1,c)},filter:function(){return zM(r,a,i.shape,o,s,u,c)}}}};function Hme(r,e,t,n,a){var i=r;r.rank===4&&(i=Qe(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));var o=e;o.rank===4&&(o=Qe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),Ne(i.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+"".concat(i.shape,".")}),Ne(o.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+"".concat(o.shape,".")}),Ne(t.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+"".concat(t,".")}),Ne(i.shape[4]===t[3],function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must ")+"match input depth in filter (".concat(t[3],".")}),Ne(o.shape[4]===t[4],function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must ")+"match output depth for filter (".concat(t[4],").")});var s={x:i,dy:o},u={strides:n,pad:a,filterShape:t};return ve.runKernel(Gpe,s,u)}var Kme=Ve({conv3DBackpropFilter_:Hme});function jme(r,e,t,n,a){Ne(r.length===e.rank,function(){return"Length of inShape "+"(".concat(r.length,") and rank of dy (").concat(e.rank,") must match")});var i=r,o=e,s=!1;e.rank===4&&(s=!0,o=Qe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,r[0],r[1],r[2],r[3]]);var u=i[4],c=o.shape[4];Ne(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")}),Ne(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)}),Ne(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(t.rank)}),Ne(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(t.shape[3],".")}),Ne(c===t.shape[4],function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(t.shape[4],".")});var l={dy:o,filter:t},f={pad:a,strides:n,inputShape:i},h=ve.runKernel(Hpe,l,f);return s?Qe(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var Xme=Ve({conv3DBackpropInput_:jme}),Yme={kernelName:Upe,inputsToSave:["x","filter"],gradFunc:function(r,e,t){var n=t.dilations,a=t.strides,i=t.pad;Ne(Ef(n),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are "+"not yet supported in gradients. Got dilations '".concat(n,"'")});var o=te(e,2),s=o[0],u=o[1];return{x:function(){return Xme(s.shape,r,u,a,i)},filter:function(){return Kme(s,r,u.shape,a,i)}}}};function Zme(r){var e=Ee(r,"x","sin","float32"),t={x:e};return ve.runKernel(nM,t)}var Jme=Ve({sin_:Zme}),Qme={kernelName:PP,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(Wa(Jme(St(n,"float32"))),r)}}}};function ege(r){var e=Ee(r,"x","sinh"),t={x:e};return ve.runKernel(aM,t)}var tge=Ve({sinh_:ege}),rge={kernelName:MP,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(tge(St(n,"float32")),r)}}}};function nge(r,e){for(var t=0;t<r.length;++t)if(r[r.length-t-1]!==e-1-t)return!1;return!0}function age(r,e,t){for(var n=r.length+e.length,a=[],i=0,o=0,s=0;s<n;s++)t.indexOf(s)===-1?a.push(r[i++]):a.push(e[o++]);return a}function ige(r,e){for(var t=[],n=r.length,a=0;a<n;a++)e.indexOf(a)===-1&&t.push(r[a]);var i=e.map(function(o){return r[o]});return[t,i]}function BO(r,e){var t=e.map(function(n){return 1});return age(r,t,e)}function $M(r,e){if(nge(r,e))return null;for(var t=[],n=0;n<e;++n)r.indexOf(n)===-1&&t.push(n);return r.forEach(function(a){return t.push(a)}),t}function Eb(r){return r.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function oge(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=Ee(r,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:n};return ve.runKernel(BP,i,o)}var sge=Ve({cumsum_:oge});function zr(r,e){return ve.tidy(r,e)}function ma(r){var e=DM(r);e.forEach(function(t){return t.dispose()})}function uge(r){return ve.keep(r)}function cge(r,e){var t=Ee(r,"real","complex"),n=Ee(e,"imag","complex");rve(t.shape,n.shape,"real and imag shapes, ".concat(t.shape," and ").concat(n.shape,", ")+"must match in call to tf.complex().");var a={real:t,imag:n};return ve.runKernel(Wpe,a)}var Ib=Ve({complex_:cge});function lge(r){var e=Ee(r,"input","imag"),t={input:e};return ve.runKernel(ude,t)}var fge=Ve({imag_:lge});function hge(r){var e=Ee(r,"input","real"),t={input:e};return ve.runKernel(Pde,t)}var pge=Ve({real_:hge});function dge(r,e,t){var n=Ee(r,"x","transpose");if(e==null&&(e=n.shape.map(function(o,s){return s}).reverse()),Ne(n.rank===e.length,function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of perm ".concat(e,".")}),e.forEach(function(o){Ne(o>=0&&o<n.rank,function(){return"All entries in 'perm' must be between 0 and ".concat(n.rank-1)+" but got ".concat(e)})}),n.rank<=1)return n.clone();var a={x:n},i={perm:e};return n.dtype==="complex64"?zr(function(){var o=pge(n),s=fge(n);return o=ve.runKernel(Sd,{x:o},i),s=ve.runKernel(Sd,{x:s},i),t&&(s=Wa(s)),Ib(o,s)}):ve.runKernel(Sd,a,i)}var gc=Ve({transpose_:dge}),vge={kernelName:BP,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.axis,o=t.exclusive,s=t.reverse;return{x:function(){var u=$M([i],a.rank),c=sge(r,i,o,!s);return u!=null&&(c=gc(c,u)),c}}}};function mge(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=r;r.rank===3&&(s=Qe(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=Qe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={x:s,dy:u},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return ve.runKernel(Xpe,c,l)}var gge=Ve({depthwiseConv2dNativeBackpropFilter_:mge});function yge(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=Qe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={dy:s,filter:t},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,inputShape:r},f=ve.runKernel(Ype,c,l);return u?Qe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var bge=Ve({depthwiseConv2dNativeBackpropInput_:yge}),wge={kernelName:jpe,inputsToSave:["x","filter"],gradFunc:function(r,e,t){var n=t.dilations,a=t.strides,i=t.pad,o=t.dimRoundingMode,s=n??[1,1];Ne(Ef(s),function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(s,"'")});var u=te(e,2),c=u[0],l=u[1];return Ne(c.rank===4,function(){return"Error in gradient of depthwiseConv2dNative: input must be "+"rank 4, but got rank ".concat(c.rank,".")}),Ne(l.rank===4,function(){return"Error in gradient of depthwiseConv2dNative: filter must be "+"rank 4, but got rank ".concat(l.rank,".")}),Ne(c.shape[3]===l.shape[2],function(){return"Error in gradient of depthwiseConv2d: number of input "+"channels (".concat(c.shape[3],") must match the inChannels dimension ")+"in filter ".concat(l.shape[2],".")}),Ne(MM(a,s),function(){return"Error in gradient of depthwiseConv2d: Either strides or "+"dilations must be  1. Got strides ".concat(a," and dilations ")+"'".concat(s,"'.")}),Hs("depthwiseConv2d",i,o),{x:function(){return bge(c.shape,r,l,a,i,s,o)},filter:function(){return gge(c,r,l.shape,a,i,s,o)}}}},xge={kernelName:Zpe,inputsToSave:["x","filter"],gradFunc:function(r,e,t){var n=te(e,2),a=n[0],i=n[1],o={x:a,filter:i,dy:r},s={x:a,filter:i,dy:r};return{x:function(){return ve.runKernel(Jpe,o,t)},filter:function(){return ve.runKernel(Qpe,s,t)}}}},kge={kernelName:ede,outputsToSave:[!0],gradFunc:function(r,e){var t=te(e,1),n=t[0],a={dy:r,y:n};return{x:function(){return ve.runKernel(tde,a)}}}};function Sge(r){var e=Ee(r,"x","exp"),t={x:e};return ve.runKernel(zP,t)}var rv=Ve({exp_:Sge}),Nge={kernelName:rde,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0],a=be(rv(Wa(Tr(n))),2/Math.sqrt(Math.PI));return{x:function(){return be(r,a)}}}},Tge={kernelName:zP,outputsToSave:[!0],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(r,n)}}}},Ege={kernelName:$P,inputsToSave:["input"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{input:function(){return Qe(r,n.shape)}}}},Ige={kernelName:ade,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(r,rv(n))}}}};var Cge={kernelName:qP,gradFunc:function(r){return{x:function(){return At(r)}}}},Age={kernelName:WP,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=hn(n.shape,a.shape),o=function(){var u=Ot(r,St(a,"float32")),c=rn(n.shape,i);return c.length>0?Qe(wr(u,c),n.shape):u},s=function(){var u=be(r,St(n,"float32")),c=rn(a.shape,i);c.length>0&&(u=Qe(wr(u,c),a.shape));var l=Tr(a);return Wa(Ot(u,St(l,"float32")))};return{a:o,b:s}}};function Dge(r){var e=Ee(r,"x","rsqrt","float32"),t={x:e};return ve.runKernel(eM,t)}var _ge=Ve({rsqrt_:Dge});function Fge(r,e){var t=Ee(r,"x","tile","string_or_numeric");Ne(t.rank===e.length,function(){return"Error in transpose: rank of input ".concat(t.rank," ")+"must match length of reps ".concat(e,".")});var n={x:t},a={reps:e};return ve.runKernel(pb,n,a)}var Rge=Ve({tile_:Fge}),Oge={kernelName:ode,inputsToSave:["x","mean","variance","scale"],gradFunc:function(r,e,t){var n=t.varianceEpsilon,a=te(e,4),i=a[0],o=a[1],s=a[2],u=a[3],c=u??Nr(1),l=rn(o.shape,i.shape),f=[];if(o.rank===1){for(var h=0;h<i.shape.length-1;++h)f.push(i.shape[h]);f.push(1)}var p=tn(i,o),d=be(r,c),m=_ge(xt(s,Nr(n))),v=be(be(be(m,m),m),Nr(-.5)),g=function(){return o.rank===1?Qe(be(be(r,Rge(Qe(m,[1,1,1,o.shape[0]]),f)),c),i.shape):Qe(be(be(r,m),c),i.shape)},y=function(){var S=be(be(m,Nr(-1)),d);return o.rank===1&&(S=wr(S,l)),Qe(S,o.shape)},w=function(){var S=be(be(v,p),d);return o.rank===1&&(S=wr(S,l)),Qe(S,o.shape)},b=function(){var S=be(p,m),T=be(r,S);return o.rank===1&&(T=wr(T,l)),Qe(T,o.shape)},x=function(){var S=r;return o.rank===1&&(S=wr(S,l)),Qe(S,o.shape)};return{x:g,mean:y,variance:w,scale:b,offset:x}}};function Pge(r,e,t){var n=Ee(r,"x","unsortedSegmentSum"),a=Ee(e,"segmentIds","unsortedSegmentSum","int32");Ne(_d(t),function(){return"numSegments must be of dtype int"});var i={x:n,segmentIds:a},o={numSegments:t};return ve.runKernel(hM,i,o)}var Mge=Ve({unsortedSegmentSum_:Pge}),Bge={kernelName:VP,inputsToSave:["x","indices"],gradFunc:function(r,e,t){var n=te(e,2),a=n[0],i=n[1],o=t.axis,s=Vs(o,a.shape)[0],u=function(){var c=a.shape,l=i.size,f=c.slice(0,s),h=f.length,p=c.slice(o,c.length).slice(1),d=p.length,m=LO(0,h),v=LO(h+1,h+1+d),g=zO([f,[l],p]),y=Qe(r,g),w=Qe(i,[l]),b=zO([[h],m,v]),x=gc(y,b),S=Mge(x,w,a.shape[s]),T=Eb(b);return S=gc(S,T),S};return{x:u,indices:function(){return i}}}};function LO(r,e){for(var t=[],n=r;n<e;++n)t.push(n);return t}function zO(r){for(var e=[],t=0;t<r.length;++t)for(var n=0;n<r[t].length;++n)e.push(r[t][n]);return e}var Lge={kernelName:UP,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1];return{a:function(){return At(n)},b:function(){return At(a)}}}};var zge={kernelName:hb,gradFunc:function(r){return{x:function(){return St(r,"float32")}}}};var $ge={kernelName:cde,gradFunc:function(r){return{x:function(){return At(r)}}}};var qge={kernelName:lde,gradFunc:function(r){return{x:function(){return At(r)}}}};var Wge={kernelName:fde,gradFunc:function(r){return{x:function(){return At(r)}}}};function Vge(r,e){var t,n=Ee(r,"a","greater","string_or_numeric"),a=Ee(e,"b","greater","string_or_numeric");t=te(ya(n,a),2),n=t[0],a=t[1],hn(n.shape,a.shape);var i={a:n,b:a};return ve.runKernel(sde,i)}var Pf=Ve({greater_:Vge}),Uge={kernelName:hde,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.alpha,o=Pf(a,0);return{x:function(){return qs(o,r,be(r,i))}}}},Gge={kernelName:vde,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Ot(r,xt(n,1))}}}},Hge={kernelName:GP,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Ot(r,St(n,"float32"))}}}},Kge={kernelName:yde,inputsToSave:[],outputsToSave:[!0],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.axis;return{logits:function(){var o=!0,s=rv(a);return tn(r,be(wr(r,i,o),s))}}}};function jge(r,e,t,n,a,i,o){n===void 0&&(n=5),a===void 0&&(a=1),i===void 0&&(i=1),o===void 0&&(o=.5);var s={x:r,y:e,dy:t},u={depthRadius:n,bias:a,alpha:i,beta:o};return ve.runKernel(wde,s,u)}var Xge=Ve({localResponseNormalizationBackprop_:jge}),Yge={kernelName:bde,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=te(e,2),a=n[0],i=n[1],o=t.depthRadius,s=t.bias,u=t.alpha,c=t.beta;return{x:function(){return Xge(a,i,r,o,s,u,c)}}}};function Zge(r,e){var t,n=Ee(r,"a","equal","string_or_numeric"),a=Ee(e,"b","equal","string_or_numeric");t=te(ya(n,a),2),n=t[0],a=t[1],hn(n.shape,a.shape);var i={a:n,b:a};return ve.runKernel(nde,i)}var Jge=Ve({equal_:Zge});function qM(r,e,t,n){return e.rank<t.rank&&(e=Qe(e,BO(e.shape,n))),r.rank<t.rank&&(r=Qe(r,BO(r.shape,n))),{x:function(){var a=be(r,St(Jge(t,e),r.dtype));return a}}}var $O={kernelName:xde,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=t,a=n.reductionIndices,i=e[0],o=e[1],s=Vs(a,i.shape),u=qM(r,o,i,s);return{x:function(){return u.x()}}}};function Qge(r,e){var t,n=Ee(r,"a","less","string_or_numeric"),a=Ee(e,"b","less","string_or_numeric");t=te(ya(n,a),2),n=t[0],a=t[1],hn(n.shape,a.shape);var i={a:n,b:a};return ve.runKernel(pde,i)}var eye=Ve({less_:Qge}),tye={kernelName:HP,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=function(){return be(r,St(Nb(n,a),"float32"))},o=function(){return be(r,St(eye(n,a),"float32"))};return{a:i,b:o}}};function rye(r,e,t,n,a,i,o){var s=Ee(r,"dy","maxPool3dGrad"),u=Ee(e,"input","maxPool3dGrad"),c=Ee(t,"output","maxPool3dGrad"),l=s,f=u,h=c,p=!1;u.rank===4&&(p=!0,l=Qe(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),f=Qe(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=Qe(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),Ne(l.rank===5,function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank "+"".concat(l.rank,".")}),Ne(f.rank===5,function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank "+"".concat(f.rank,".")}),Ne(h.rank===5,function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank "+"".concat(h.rank,".")}),Hs("maxPool3dGrad",i,o);var d={dy:l,input:f,output:h},m={filterSize:n,strides:a,pad:i,dimRoundingMode:o},v=ve.runKernel(Tde,d,m);return p?Qe(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}var nye=Ve({maxPool3dGrad_:rye}),aye={kernelName:Nde,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=te(e,2),a=n[0],i=n[1],o=t.filterSize,s=t.strides,u=t.pad,c=t.dimRoundingMode;return{x:function(){return nye(r,a,i,o,s,u,c)}}}};function iye(r,e,t,n,a,i,o){var s=Ee(r,"dy","maxPoolGrad"),u=Ee(e,"input","maxPoolGrad"),c=Ee(t,"output","maxPoolGrad");Ne(u.rank===s.rank,function(){return"Rank of input (".concat(u.rank,") does not match rank of dy ")+"(".concat(s.rank,")")}),Ne(s.rank===4,function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank "+"".concat(s.rank,".")}),Ne(u.rank===4,function(){return"Error in maxPoolGrad: input must be rank 4 but got rank "+"".concat(u.rank,".")}),Hs("maxPoolGrad",i,o);var l={dy:s,input:u,output:c},f={filterSize:n,strides:a,pad:i,dimRoundingMode:o};return ve.runKernel(Sde,l,f)}var oye=Ve({maxPoolGrad_:iye}),sye={kernelName:kde,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=te(e,2),a=n[0],i=n[1],o=t.filterSize,s=t.strides,u=t.pad;return{x:function(){return oye(r,a,i,o,s,u)}}}};function Pd(r,e){if(e===void 0&&(e="float32"),Of(r),e==="complex64"){var t=Pd(r,"float32"),n=Pd(r,"float32");return Ib(t,n)}var a=gb(Bi(r),e);return ve.makeTensor(a,r,e)}function nv(r,e){if(e===void 0&&(e="float32"),Of(r),e==="complex64"){var t=nv(r,"float32"),n=Pd(r,"float32");return Ib(t,n)}var a=mM(Bi(r),e);return ve.makeTensor(a,r,e)}var uye={kernelName:Ede,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.axis,o=Vs(i,a.shape),s=ige(a.shape,o),u=s[1],c=Bi(u),l=function(){var f=a.shape.slice();o.forEach(function(d){f[d]=1});var h=Qe(r,f),p=Ot(be(h,nv(a.shape,"float32")),c);return p};return{x:l}}},cye={kernelName:Ide,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(r,e,t){var n=t,a=n.axis,i=te(e,2),o=i[0],s=i[1],u=Vs(a,o.shape),c=qM(r,s,o,u);return{x:function(){return c.x()}}}},lye={kernelName:Cde,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=function(){return be(r,St(Tb(n,a),"float32"))},o=function(){return be(r,St(Pf(n,a),"float32"))};return{a:i,b:o}}};function fye(r,e,t){var n=Ee(r,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");var a={x:n},i={begin:e,size:t};return ve.runKernel(rM,a,i)}var pc=Ve({slice_:fye});var hye={kernelName:Ade,inputsToSave:["x"],gradFunc:function(r,e,t){var n=e[0],a=t.paddings,i=a.map(function(o){return o[0]});return{x:function(){return pc(r,i,n.shape)}}}};function pye(r){var e=Ee(r,"x","floor","float32"),t={x:e};return ve.runKernel(qP,t)}var dye=Ve({floor_:pye}),vye={kernelName:Dde,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=hn(n.shape,a.shape),o=function(){var u=rn(n.shape,i);return u.length>0?Qe(wr(r,u),n.shape):r},s=function(){var u=be(r,Wa(dye(Ot(n,a)))),c=rn(a.shape,i);return c.length>0?Qe(wr(u,c),a.shape):u};return{a:o,b:s}}},mye={kernelName:KP,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=hn(n.shape,a.shape),o=function(){var u=be(r,St(a,"float32")),c=rn(n.shape,i);return c.length>0?Qe(wr(u,c),n.shape):u},s=function(){var u=be(r,St(n,"float32")),c=rn(a.shape,i);return c.length>0?Qe(wr(u,c),a.shape):u};return{a:o,b:s}}};var gye={kernelName:jP,gradFunc:function(r){return{x:function(){return Wa(r)}}}};var yye={kernelName:Fde,inputsToSave:["indices"],gradFunc:function(r,e){var t=e[0];return{indices:function(){return Pd(t.shape,"float32")}}}};var bye={kernelName:_de,gradFunc:function(r){return{x:function(){return At(r)}}}};function wye(r,e){e===void 0&&(e=0);var t=Ee(r,"x","unstack","string_or_numeric");Ne(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = ".concat(e," is not in [-").concat(t.shape.length,", ").concat(t.shape.length,")")});var n={value:t},a={axis:e};return ve.runKernel(fM,n,a)}var xye=Ve({unstack_:wye});var kye={kernelName:XP,saveAllInputs:!0,gradFunc:function(r,e,t){var n=t.axis,a=xye(r,n);return a.map(function(i){return function(){return i}})}};var qO={kernelName:YP,inputsToSave:["x"],gradFunc:function(r,e,t){var n=e[0],a=t.paddings,i=a.map(function(o){return o[0]});return{x:function(){return pc(r,i,n.shape)}}}};function Sye(r){var e=Ee(r,"x","log","float32"),t={x:e};return ve.runKernel(GP,t)}var Nye=Ve({log_:Sye});function Tye(r,e){var t,n=Ee(r,"base","pow"),a=Ee(e,"exp","pow");t=te(ya(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return ve.runKernel(ZP,i)}var Md=Ve({pow_:Tye}),Eye={kernelName:ZP,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(r,e){var t=te(e,3),n=t[0],a=t[1],i=t[2],o=n,s=a,u=hn(o.shape,s.shape),c=function(){var f=St(s,"float32"),h=be(r,be(f,Md(o,tn(f,Nr(1))))),p=rn(o.shape,u);return p.length>0&&(h=wr(h,p)),Qe(h,o.shape)},l=function(){var f=Pf(o,0),h=qs(f,Nye(o),At(o)),p=be(r,be(i,h)),d=rn(s.shape,u);return d.length>0&&(p=wr(p,d)),Qe(p,s.shape)};return{a:c,b:l}}},Iye={kernelName:Rde,inputsToSave:["x","alpha"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=Pf(n,0);return{x:function(){return qs(i,r,be(r,a))},alpha:function(){var o=qs(i,At(r),be(r,n)),s=rn(a.shape,r.shape);return s.length>0&&(o=wr(o,s)),Qe(o,a.shape)}}}};function Cye(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Fn=br();Fn.registerFlag("DEBUG",function(){return!1},function(r){r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Fn.registerFlag("IS_BROWSER",function(){return Cye()});Fn.registerFlag("IS_NODE",function(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"});Fn.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)});Fn.registerFlag("IS_SAFARI",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor)});Fn.registerFlag("PROD",function(){return!1});Fn.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return Fn.getBool("DEBUG")});Fn.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0});Fn.registerFlag("IS_TEST",function(){return!1});Fn.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",function(){return Fn.getBool("DEBUG")});Fn.registerFlag("WRAP_TO_IMAGEBITMAP",function(){return!1});Fn.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",function(){return!1});Fn.registerFlag("USE_SETTIMEOUTCUSTOM",function(){return!1});var av=function(){function r(e){if(this.shards=[],this.previousShardIndex=0,e!=null&&(e instanceof Array||(e=[e]),e=e.map(function(o){return $a(o)?o.buffer:o}),e.length!==0)){this.bufferUniformSize=e[0].byteLength;for(var t=0,n=0;n<e.length;n++){var a=e[n];n!==e.length-1&&a.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);var i=t+a.byteLength;this.shards.push({buffer:a,start:t,end:i}),t=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}}return r.join=function(e){return new r(e).slice()},r.prototype.slice=function(e,t){if(e===void 0&&(e=0),t===void 0&&(t=this.byteLength),this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);var n=this.findShardForByte(e);if(n===-1)throw new Error("Could not find start shard for byte ".concat(e));for(var a=t-e,i=new ArrayBuffer(a),o=new Uint8Array(i),s=0,u=n;u<this.shards.length;u++){var c=this.shards[u],l=e+s,f=l-c.start,h=s,p=Math.min(t,c.end),d=p-c.start,m=new Uint8Array(c.buffer,f,d-f);if(o.set(m,h),s+=m.length,t<c.end)break}return i},r.prototype.findShardForByte=function(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(a){return e<a.start?-1:e>=a.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;var n=Aye(this.shards,t);return n===-1?-1:(this.previousShardIndex=n,this.previousShardIndex)},r}();function Aye(r,e){for(var t=0,n=r.length;t<=n;){var a=Math.floor((n-t)/2)+t,i=e(r[a]);if(i===0)return a;i<0?n=a:t=a+1}return-1}var Cb=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function WO(r){return Cb?Buffer.byteLength(r,"utf8"):new Blob([r]).size}function Dye(r){if(Cb)return Buffer.from(r).toString("base64");for(var e=new Uint8Array(r),t="",n=0,a=e.length;n<a;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function _ye(r){if(Cb){var e=Buffer.from(r,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var t=atob(r),n=new Uint8Array(t.length),a=0;a<t.length;++a)n.set([t.charCodeAt(a)],a);return n.buffer}function WM(r,e){var t={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy,weightsManifest:e};return r.signature!=null&&(t.signature=r.signature),r.userDefinedMetadata!=null&&(t.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(t.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(t.initializerSignature=r.initializerSignature),r.trainingConfig!=null&&(t.trainingConfig=r.trainingConfig),t}function Fye(r,e,t){var n={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy};if(r.trainingConfig!=null&&(n.trainingConfig=r.trainingConfig),r.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");n.weightSpecs=e,n.weightData=t}return r.signature!=null&&(n.signature=r.signature),r.userDefinedMetadata!=null&&(n.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(n.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(n.initializerSignature=r.initializerSignature),n}function Rye(r,e){return Ce(this,void 0,void 0,function(){var t,n,a;return Ie(this,function(i){switch(i.label){case 0:return r.weightsManifest==null?[3,2]:[4,e(r.weightsManifest)];case 1:a=te.apply(void 0,[i.sent(),2]),t=a[0],n=a[1],i.label=2;case 2:return[2,Fye(r,t,n)]}})})}function iv(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:WO(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:WO(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:new av(r.weightData).byteLength}}function Oye(r){var e,t,n=[];try{for(var a=fe(r),i=a.next();!i.done;i=a.next()){var o=i.value;n.push.apply(n,Je([],te(o.weights),!1))}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return n}var Ks=function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerSaveRouter=function(e){r.getInstance().saveRouters.push(e)},r.registerLoadRouter=function(e){r.getInstance().loadRouters.push(e)},r.getSaveHandlers=function(e){return r.getHandlers(e,"save")},r.getLoadHandlers=function(e,t){return r.getHandlers(e,"load",t)},r.getHandlers=function(e,t,n){var a=[],i=t==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters;return i.forEach(function(o){var s=o(e,n);s!==null&&a.push(s)}),a},r}(),Pye="tensorflowjs",Mye=1,Sf="models_store",Ed="model_info_store";function Bye(){if(!br().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=typeof window>"u"?self:window,e=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Lye(r){var e=r.result;e.createObjectStore(Sf,{keyPath:"modelPath"}),e.createObjectStore(Ed,{keyPath:"modelPath"})}var Bd=function(){function r(e){if(this.indexedDB=Bye(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return r.prototype.save=function(e){return Ce(this,void 0,void 0,function(){return Ie(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},r.prototype.load=function(){return Ce(this,void 0,void 0,function(){return Ie(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},r.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(a,i){var o=n.indexedDB.open(Pye,Mye);o.onupgradeneeded=function(){return Lye(o)},o.onsuccess=function(){var s=o.result;if(t==null){var u=s.transaction(Sf,"readonly"),c=u.objectStore(Sf),l=c.get(n.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),i(new Error("Cannot find model with path '".concat(n.modelPath,"' ")+"in IndexedDB."));a(l.result.modelArtifacts)},l.onerror=function(v){return s.close(),i(l.error)},u.oncomplete=function(){return s.close()}}else{var f=iv(t),h=s.transaction(Ed,"readwrite"),p=h.objectStore(Ed),d;try{d=p.put({modelPath:n.modelPath,modelArtifactsInfo:f})}catch(v){return i(v)}var m;d.onsuccess=function(){m=s.transaction(Sf,"readwrite");var v=m.objectStore(Sf),g;try{g=v.put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:f})}catch(y){return i(y)}g.onsuccess=function(){return a({modelArtifactsInfo:f})},g.onerror=function(y){p=h.objectStore(Ed);var w=p.delete(n.modelPath);w.onsuccess=function(){return s.close(),i(g.error)},w.onerror=function(b){return s.close(),i(g.error)}}},d.onerror=function(v){return s.close(),i(d.error)},h.oncomplete=function(){m==null?s.close():m.oncomplete=function(){return s.close()}}}},o.onerror=function(s){return i(o.error)}})},r}();Bd.URL_SCHEME="indexeddb://";var VM=function(r){return br().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Bd.URL_SCHEME)?zye(r.slice(Bd.URL_SCHEME.length)):null};Ks.registerSaveRouter(VM);Ks.registerLoadRouter(VM);function zye(r){return new Bd(r)}var vf="/",mf="tensorflowjs_models",$ye="info",qye="model_topology",Wye="weight_specs",Vye="weight_data",Uye="model_metadata";function Gye(r){return{info:[mf,r,$ye].join(vf),topology:[mf,r,qye].join(vf),weightSpecs:[mf,r,Wye].join(vf),weightData:[mf,r,Vye].join(vf),modelMetadata:[mf,r,Uye].join(vf)}}function Hye(r){var e,t;try{for(var n=fe(Object.values(r)),a=n.next();!a.done;a=n.next()){var i=a.value;window.localStorage.removeItem(i)}}catch(o){e={error:o}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}}var Ld=function(){function r(e){if(!br().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Gye(this.modelPath)}return r.prototype.save=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o;return Ie(this,function(s){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),a=iv(e),i=av.join(e.weightData);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,Dye(i)),o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),[2,{modelArtifactsInfo:a}]}catch{throw Hye(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."))}return[2]})})},r.prototype.load=function(){return Ce(this,void 0,void 0,function(){var e,t,n,a,i,o,s;return Ie(this,function(u){if(e=JSON.parse(this.LS.getItem(this.keys.info)),e==null)throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},n=JSON.parse(this.LS.getItem(this.keys.topology)),n==null)throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");if(t.modelTopology=n,a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)),a==null)throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");if(t.weightSpecs=a,i=this.LS.getItem(this.keys.modelMetadata),i!=null&&(o=JSON.parse(i),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,o.signature!=null&&(t.signature=o.signature),o.userDefinedMetadata!=null&&(t.userDefinedMetadata=o.userDefinedMetadata),o.modelInitializer!=null&&(t.modelInitializer=o.modelInitializer),o.initializerSignature!=null&&(t.initializerSignature=o.initializerSignature),o.trainingConfig!=null&&(t.trainingConfig=o.trainingConfig)),s=this.LS.getItem(this.keys.weightData),s==null)throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));return t.weightData=_ye(s),[2,t]})})},r}();Ld.URL_SCHEME="localstorage://";var UM=function(r){return br().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Ld.URL_SCHEME)?Kye(r.slice(Ld.URL_SCHEME.length)):null};Ks.registerSaveRouter(UM);Ks.registerLoadRouter(UM);function Kye(r){return new Ld(r)}var jye="model",Xye=".json",Yye=".weights.bin";function VO(r){return new Promise(function(e){return setTimeout(e)}).then(r)}var zd=function(){function r(e){if(!br().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(r.URL_SCHEME)&&(e=e.slice(r.URL_SCHEME.length)),(e==null||e.length===0)&&(e=jye),this.modelJsonFileName=e+Xye,this.weightDataFileName=e+Yye}return r.prototype.save=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s,u;return Ie(this,function(c){switch(c.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=av.join(e.weightData),n=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return a=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i=WM(e,a),o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),s=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor,s.download=this.modelJsonFileName,s.href=o,[4,VO(function(){return s.dispatchEvent(new MouseEvent("click"))})];case 2:return c.sent(),e.weightData==null?[3,4]:(u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor,u.download=this.weightDataFileName,u.href=n,[4,VO(function(){return u.dispatchEvent(new MouseEvent("click"))})]);case 3:c.sent(),c.label=4;case 4:return[2,{modelArtifactsInfo:iv(e)}]}})})},r}();zd.URL_SCHEME="downloads://";var Zye=function(r){return br().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(zd.URL_SCHEME)?Jye(r.slice(zd.URL_SCHEME.length)):null};Ks.registerSaveRouter(Zye);function Jye(r){return r===void 0&&(r="model"),new zd(r)}function UO(r,e,t,n){o(r),t=t??0,n=n??1,s(t,n);var a=0,i=function(u){return u.then(function(c){var l=t+ ++a/r.length*(n-t);return e(l),c}),u};function o(u){Ne(u!=null&&Array.isArray(u)&&u.length>0,function(){return"promises must be a none empty array"})}function s(u,c){Ne(u>=0&&u<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(u)}),Ne(c>=0&&c<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(c)}),Ne(c>=u,function(){return"startFraction must be no more than endFraction, but "+"got startFraction ".concat(u," and endFraction ")+"".concat(c)})}return Promise.all(r.map(i))}function Qye(r,e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h;return Ie(this,function(p){switch(p.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?br().platform.fetch:e.fetchFunc,n=r.map(function(d){return t(d,e.requestInit,{isBinary:!0})}),a=0,i=.5,e.onProgress!=null?[3,2]:[4,Promise.all(n)];case 1:return s=p.sent(),[3,4];case 2:return[4,UO(n,e.onProgress,a,i)];case 3:s=p.sent(),p.label=4;case 4:return o=s,u=o.map(function(d){return d.arrayBuffer()}),c=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(u)];case 5:return h=p.sent(),[3,8];case 6:return[4,UO(u,e.onProgress,c,l)];case 7:h=p.sent(),p.label=8;case 8:return f=h,[2,f]}})})}var e0e="application/octet-stream",t0e="application/json",Ab=function(){function r(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(Ne(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=br().platform.fetch,Ne(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&Ne(e.length===2,function(){return"URL paths for http must have a length of 2, "+"(actual length is ".concat(e.length,").")}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return r.prototype.save=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o;return Ie(this,function(s){switch(s.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit),t.body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=WM(e,n),t.body.append("model.json",new Blob([JSON.stringify(a)],{type:t0e}),"model.json"),e.weightData!=null&&(i=av.join(e.weightData),t.body.append("model.weights.bin",new Blob([i],{type:e0e}),"model.weights.bin")),[4,this.fetch(this.path,t)];case 1:if(o=s.sent(),o.ok)return[2,{modelArtifactsInfo:iv(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(o.status,"."))}})})},r.prototype.load=function(){return Ce(this,void 0,void 0,function(){var e,t,n,a,i,o=this;return Ie(this,function(s){switch(s.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(e=s.sent(),!e.ok)throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(e.status,". Please verify this URL points to ")+"the model JSON of the model to load.");s.label=2;case 2:return s.trys.push([2,4,,5]),[4,e.json()];case 3:return t=s.sent(),[3,5];case 4:throw s.sent(),n="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(a=t.modelTopology,i=t.weightsManifest,a==null&&i==null)throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");return[2,Rye(t,function(u){return o.loadWeights(u)})]}})})},r.prototype.loadWeights=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S,T,E;return Ie(this,function(C){switch(C.label){case 0:t=Array.isArray(this.path)?this.path[1]:this.path,n=te(r0e(t),2),a=n[0],i=n[1],o=this.weightPathPrefix||a,s=Oye(e),u=[],c=[];try{for(l=fe(e),f=l.next();!f.done;f=l.next()){h=f.value;try{for(p=(T=void 0,fe(h.paths)),d=p.next();!d.done;d=p.next())m=d.value,this.weightUrlConverter!=null?c.push(this.weightUrlConverter(m)):u.push(o+m+i)}catch(R){T={error:R}}finally{try{d&&!d.done&&(E=p.return)&&E.call(p)}finally{if(T)throw T.error}}}}catch(R){x={error:R}}finally{try{f&&!f.done&&(S=l.return)&&S.call(l)}finally{if(x)throw x.error}}return this.weightUrlConverter?(g=(v=u.push).apply,y=[u],w=[[]],[4,Promise.all(c)]):[3,2];case 1:g.apply(v,y.concat([Je.apply(void 0,w.concat([te.apply(void 0,[C.sent()]),!1]))])),C.label=2;case 2:return[4,Qye(u,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 3:return b=C.sent(),[2,[s,b]]}})})},r}();Ab.URL_SCHEME_REGEX=/^https?:\/\//;function r0e(r){var e=r.lastIndexOf("/"),t=r.lastIndexOf("?"),n=r.substring(0,e),a=t>e?r.substring(t):"";return[n+"/",a]}function GO(r){return r.match(Ab.URL_SCHEME_REGEX)!=null}var GM=function(r,e){if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;var t=!0;return Array.isArray(r)?t=r.every(function(n){return GO(n)}):t=GO(r),t?n0e(r,e):null};Ks.registerSaveRouter(GM);Ks.registerLoadRouter(GM);function n0e(r,e){return new Ab(r,e)}function a0e(r,e,t){var n=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(t.shape)+", indices.shape: ".concat(e.shape,", shape: ").concat(r)+", sliceDim: ".concat(n,", and batchDim: ").concat(a,".");if(t.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(r.length<n+(t.rank-a))throw new Error(i+" Output shape length < ".concat(n+(t.rank-a)));if(t.rank!==a+r.length-n)throw new Error(i+" update.rank != ".concat(a+r.length-n));for(var o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(t.shape[o],") != indices.shape[").concat(o,"] (").concat(e.shape[o],")."));for(var o=0;o<t.rank-a;++o)if(t.shape[o+a]!==r[o+n])throw new Error(i+" updates.shape[".concat(o+a,"] (").concat(t.shape[o+a],") != shape[").concat(o+a,"] (").concat(r[o+a],")"))}function i0e(r,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(r.rank,"."));if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(e.dtype));if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(t));if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: ".concat(e.shape));if(r.size===0)throw new Error("Updates specified for empty output. updates shape: ".concat(r.shape))}a0e(t,e,r)}function o0e(r,e,t){var n,a=r.shape.length;typeof e=="number"?n=Je([e],te(new Array(a-1).fill(0)),!1):e.length<a?n=e.concat(new Array(a-e.length).fill(0)):n=e.slice(),n.forEach(function(o){Ne(o!==-1,function(){return"slice() does not support negative begin indexing."})});var i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=Je([t],te(new Array(a-1).fill(-1)),!1):t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map(function(o,s){return o>=0?o:(Ne(o===-1,function(){return"Negative size values should be exactly -1 but got "+"".concat(o," for the slice() size at index ").concat(s,".")}),r.shape[s]-n[s])}),[n,i]}var s0e=function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(e,t){return new e(t)},r}();function u0e(r){var e=Ee(r,"x","abs");if(e.dtype==="complex64"){var t={x:e};return ve.runKernel(_P,t)}else{var t={x:e};return ve.runKernel(CP,t)}}var c0e=Ve({abs_:u0e});function l0e(r,e){e===void 0&&(e=0),Ne(r.length>=1,function(){return"Pass at least one tensor to concat"});var t=RM(r,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `.concat(i.dtype,". "))}),t.length===1)return LM(t[0]);var n=t,a={axis:e};return ve.runKernel(FP,n,a)}var f0e=Ve({concat_:l0e});function h0e(r){var e=Ee(r,"x","sigmoid","float32"),t={x:e};return ve.runKernel(iM,t)}var p0e=Ve({sigmoid_:h0e});function d0e(r,e,t){var n=Ee(r,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});Ne(n.rank>=1+e.length,function(){return"input rank is ".concat(n.rank," but should be > than blockShape.length ").concat(e.length)}),Ne(t.length===e.length,function(){return"crops.length is ".concat(t.length," but should be equal to blockShape.length  ").concat(e.length)}),Ne(n.shape[0]%a===0,function(){return"input tensor batch is ".concat(n.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(e.join(" * ")," === ").concat(a)});var i={x:n},o={blockShape:e,crops:t};return ve.runKernel(DP,i,o)}var v0e=Ve({batchToSpaceND_:d0e});function m0e(r,e,t){Of(r),t=t||tv(e);var n={shape:r,value:e,dtype:t};return ve.runKernel(ide,{},n)}function g0e(r){var e=Ee(r,"x","cos","float32"),t={x:e};return ve.runKernel(PP,t)}var HM=Ve({cos_:g0e});function y0e(r){var e=Ee(r,"x","cosh","float32"),t={x:e};return ve.runKernel(MP,t)}var b0e=Ve({cosh_:y0e});function w0e(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=Ee(r,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:n};return ve.runKernel(Kpe,i,o)}var HO=Ve({cumprod_:w0e});function x0e(r,e){e===void 0&&(e=0);var t=Ee(r,"x","expandDims","string_or_numeric");Ne(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var n={input:t},a={dim:e};return ve.runKernel($P,n,a)}var k0e=Ve({expandDims_:x0e});function S0e(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=0);var a=Ee(r,"x","gather"),i=Ee(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:n};return ve.runKernel(VP,o,s)}var N0e=Ve({gather_:S0e});function T0e(r,e){Ne(W0(r),function(){return"The f passed in variableGrads(f) must be a function"}),Ne(e==null||Array.isArray(e)&&e.every(function(f){return f instanceof Od}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t){e=[];for(var n in ve.registeredVariables)e.push(ve.registeredVariables[n])}var a=t?e.filter(function(f){return!f.trainable}):null,i=e.length;e=e.filter(function(f){return f.trainable}),Ne(e.length>0,function(){return"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(i," variables is ")+"trainable."});var o=!0,s=ve.gradients(r,e,null,o),u=s.value,c=s.grads;Ne(c.some(function(f){return f!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),Ne(u.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(u.rank," tensor")});var l={};return e.forEach(function(f,h){c[h]!=null&&(l[f.name]=c[h])}),a?.forEach(function(f){return l[f.name]=null}),{value:u,grads:l}}function E0e(r){var e=Ee(r,"x","logicalNot","bool"),t={x:e};return ve.runKernel(gde,t)}var I0e=Ve({logicalNot_:E0e});function C0e(r,e){var t,n=Ee(r,"a","maximum"),a=Ee(e,"b","maximum");t=te(ya(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=St(n,"int32"),a=St(a,"int32")),hn(n.shape,a.shape);var i={a:n,b:a};return ve.runKernel(HP,i)}var KM=Ve({maximum_:C0e});function A0e(r,e,t){t===void 0&&(t=0);var n=Ee(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:n};return ve.runKernel(YP,i,a)}var D0e=Ve({pad_:A0e}),jM={exports:{}};(function(r){(function(e,t,n){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(Us,r,!1)})(jM);var _0e=jM.exports,XM={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(Us,r,!1)})(XM);var F0e=XM.exports,YM={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(Us,r,!1)})(YM);var R0e=YM.exports,ZM={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,p;return h=l[f],h^=h>>>7,p=h^h<<24,h=l[f+1&7],p^=h^h>>>10,h=l[f+3&7],p^=h^h>>>3,h=l[f+4&7],p^=h^h<<7,h=l[f+7&7],h=h^h<<13,p^=h^h<<9,l[f]=p,u.i=f+1&7,p};function c(l,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8?p[7]=-1:p[h],l.x=p,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(Us,r,!1)})(ZM);var O0e=ZM.exports,JM={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,p,d;return u.w=l=l+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(l^l>>>16)|0};function c(l,f){var h,p,d,m,v,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,m=-32;m<y;++m)f&&(p^=f.charCodeAt((m+32)%f.length)),m===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(v=v+1640531527|0,h=g[m&127]^=p+v,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,m=4*128;m>0;--m)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;l.w=v,l.X=g,l.i=d}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(Us,r,!1)})(JM);var P0e=JM.exports,QM={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(Us,r,!1)})(QM);var M0e=QM.exports,e4={exports:{}},B0e={},L0e={__proto__:null,default:B0e},z0e=bve(L0e);(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),c=n.pow(2,o),l=c*2,f=a-1,h;function p(b,x,S){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(v(x.entropy?[b,w(t)]:b??y(),3),T),C=new d(T),R=function(){for(var _=C.g(i),O=u,$=0;_<c;)_=(_+$)*a,O*=a,$=C.g(1);for(;_>=l;)_/=2,O/=2,$>>>=1;return(_+$)/O};return R.int32=function(){return C.g(4)|0},R.quick=function(){return C.g(4)/4294967296},R.double=R,g(w(C.S),t),(x.pass||S||function(_,O,$,z){return z&&(z.S&&m(z,C),_.state=function(){return m(C,{})}),$?(n[s]=_,O):_})(R,E,"global"in x?x.global:this==n,x.state)}function d(b){var x,S=b.length,T=this,E=0,C=T.i=T.j=0,R=T.S=[];for(S||(b=[S++]);E<a;)R[E]=E++;for(E=0;E<a;E++)R[E]=R[C=f&C+b[E%S]+(x=R[E])],R[C]=x;(T.g=function(_){for(var O,$=0,z=T.i,L=T.j,B=T.S;_--;)O=B[z=f&z+1],$=$*a+B[f&(B[z]=B[L=f&L+O])+(B[L]=O)];return T.i=z,T.j=L,$})(a)}function m(b,x){return x.i=b.i,x.j=b.j,x.S=b.S.slice(),x}function v(b,x){var S=[],T=typeof b,E;if(x&&T=="object")for(E in b)try{S.push(v(b[E],x-1))}catch{}return S.length?S:T=="string"?b:b+"\0"}function g(b,x){for(var S=b+"",T,E=0;E<S.length;)x[f&E]=f&(T^=x[f&E]*19)+S.charCodeAt(E++);return w(x)}function y(){try{var b;return h&&(b=h.randomBytes)?b=b(a):(b=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(b)),w(b)}catch{var x=e.navigator,S=x&&x.plugins;return[+new Date,e,S,e.screen,w(t)]}}function w(b){return String.fromCharCode.apply(0,b)}if(g(n.random(),t),r.exports){r.exports=p;try{h=z0e}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:Us,[],Math)})(e4);var $0e=e4.exports,q0e=_0e,W0e=F0e,V0e=R0e,U0e=O0e,G0e=P0e,H0e=M0e,wc=$0e;wc.alea=q0e;wc.xor128=W0e;wc.xorwow=V0e;wc.xorshift7=U0e;wc.xor4096=G0e;wc.tychei=H0e;function K0e(r,e){var t=Ee(r,"x","reverse"),n={x:t},a={dims:e};return ve.runKernel(QP,n,a)}var j0e=Ve({reverse_:K0e});function X0e(r,e){e===void 0&&(e=0);var t=RM(r,"tensors","stack","string_or_numeric");Ne(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&Ne(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var n=t,a={axis:e};return ve.runKernel(XP,n,a)}var Y0e=Ve({stack_:X0e});function Z0e(r,e,t){var n=Ee(r,"tensor","tensorScatterupdate"),a=Ee(e,"indices","tensorScatterupdate","int32"),i=Ee(t,"updates","tensorScatterupdate");if(i0e(i,a,n.shape),n.dtype!==i.dtype)throw new Error("tensor and updates must have the same dtype, instead they are ".concat(n.dtype," and ").concat(i.dtype,"."));var o={tensor:n,indices:a,updates:i},s={};return ve.runKernel(Ude,o,s)}Ve({tensorScatterUpdate_:Z0e});var KO;(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(KO||(KO={}));var js=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.minimize=function(t,n,a){n===void 0&&(n=!1);var i=this.computeGradients(t,a),o=i.value,s=i.grads;if(a!=null){var u=a.map(function(c){return{name:c.name,tensor:s[c.name]}});this.applyGradients(u)}else this.applyGradients(s);return ma(s),n?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!1,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,n){return T0e(t,n)},e.prototype.dispose=function(){this.iterations_!=null&&ma(this.iterations_)},e.prototype.saveIterations=function(){return Ce(this,void 0,void 0,function(){return Ie(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Nr(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ie(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){return Ie(this,function(n){throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()))})})},e.prototype.extractIterations=function(t){return Ce(this,void 0,void 0,function(){var n;return Ie(this,function(a){switch(a.label){case 0:return n=this,[4,t[0].tensor.data()];case 1:return n.iterations_=a.sent()[0],[2,t.slice(1)]}})})},e}(s0e);Object.defineProperty(js,Symbol.hasInstance,{value:function(r){return r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null}});(function(r){se(e,r);function e(t,n,a){a===void 0&&(a=null);var i=r.call(this)||this;return i.learningRate=t,i.rho=n,i.epsilon=a,i.accumulatedGrads=[],i.accumulatedUpdates=[],a==null&&(i.epsilon=ve.backend.epsilon()),i}return Object.defineProperty(e,"className",{get:function(){return"Adadelta"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=ve.registeredVariables[i],u=!1;n.accumulatedGrads[o]==null&&(n.accumulatedGrads[o]={originalName:"".concat(i,"/accum_grad"),variable:zr(function(){return At(s).variable(u)})}),n.accumulatedUpdates[o]==null&&(n.accumulatedUpdates[o]={originalName:"".concat(i,"/accum_var"),variable:zr(function(){return At(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=n.accumulatedGrads[o].variable,f=n.accumulatedUpdates[o].variable;zr(function(){var h=xt(be(l,n.rho),be(Tr(c),1-n.rho)),p=be(Ot(mi(xt(f,n.epsilon)),mi(xt(l,n.epsilon))),c),d=xt(be(f,n.rho),be(Tr(p),1-n.rho));l.assign(h),f.assign(d);var m=xt(be(p,-n.learningRate),s);s.assign(m)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(ma(this.accumulatedGrads.map(function(t){return t.variable})),ma(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){var t;return Ie(this,function(n){switch(n.label){case 0:return t=Je(Je([],te(this.accumulatedGrads),!1),te(this.accumulatedUpdates),!1),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var n,a;return Ie(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=t.length/2,a=!1,this.accumulatedGrads=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedUpdates=t.slice(n,n*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.rho,n.epsilon)},e})(js);(function(r){se(e,r);function e(t,n){n===void 0&&(n=.1);var a=r.call(this)||this;return a.learningRate=t,a.initialAccumulatorValue=n,a.accumulatedGrads=[],a}return Object.defineProperty(e,"className",{get:function(){return"Adagrad"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=ve.registeredVariables[i];if(n.accumulatedGrads[o]==null){var u=!1;n.accumulatedGrads[o]={originalName:"".concat(i,"/accumulator"),variable:zr(function(){return m0e(s.shape,n.initialAccumulatorValue).variable(u)})}}var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=n.accumulatedGrads[o].variable;zr(function(){var f=xt(l,Tr(c));l.assign(f);var h=xt(be(Ot(c,mi(xt(f,ve.backend.epsilon()))),-n.learningRate),s);s.assign(h)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&ma(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ie(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var n;return Ie(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),n=!1,this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(n)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,n){return new t(n.learningRate,n.initialAccumulatorValue)},e})(js);(function(r){se(e,r);function e(t,n,a,i){i===void 0&&(i=null);var o=r.call(this)||this;return o.learningRate=t,o.beta1=n,o.beta2=a,o.epsilon=i,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],zr(function(){o.accBeta1=Nr(n).variable(),o.accBeta2=Nr(a).variable()}),i==null&&(o.epsilon=ve.backend.epsilon()),o}return Object.defineProperty(e,"className",{get:function(){return"Adam"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);zr(function(){var i=tn(1,n.accBeta1),o=tn(1,n.accBeta2);a.forEach(function(s,u){var c=ve.registeredVariables[s],l=!1;n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:zr(function(){return At(c).variable(l)})}),n.accumulatedSecondMoment[u]==null&&(n.accumulatedSecondMoment[u]={originalName:"".concat(s,"/v"),variable:zr(function(){return At(c).variable(l)})});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=n.accumulatedFirstMoment[u].variable,p=n.accumulatedSecondMoment[u].variable,d=xt(be(h,n.beta1),be(f,1-n.beta1)),m=xt(be(p,n.beta2),be(Tr(f),1-n.beta2)),v=Ot(d,i),g=Ot(m,o);h.assign(d),p.assign(m);var y=xt(be(Ot(v,xt(mi(g),n.epsilon)),-n.learningRate),c);c.assign(y)}}),n.accBeta1.assign(be(n.accBeta1,n.beta1)),n.accBeta2.assign(be(n.accBeta2,n.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&ma(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&ma(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){var t;return Ie(this,function(n){switch(n.label){case 0:return t=Je(Je([],te(this.accumulatedFirstMoment),!1),te(this.accumulatedSecondMoment),!1),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var n,a,i=this;return Ie(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),zr(function(){i.accBeta1.assign(Md(i.beta1,i.iterations_+1)),i.accBeta2.assign(Md(i.beta2,i.iterations_+1))}),n=t.length/2,a=!1,this.accumulatedFirstMoment=t.slice(0,n).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),this.accumulatedSecondMoment=t.slice(n,n*2).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon)},e})(js);(function(r){se(e,r);function e(t,n,a,i,o){i===void 0&&(i=null),o===void 0&&(o=0);var s=r.call(this)||this;return s.learningRate=t,s.beta1=n,s.beta2=a,s.epsilon=i,s.decay=o,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],zr(function(){s.iteration=Nr(0).variable(),s.accBeta1=Nr(n).variable()}),i==null&&(s.epsilon=ve.backend.epsilon()),s}return Object.defineProperty(e,"className",{get:function(){return"Adamax"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);zr(function(){var i=tn(1,n.accBeta1),o=Ot(-n.learningRate,xt(be(n.iteration,n.decay),1));a.forEach(function(s,u){var c=ve.registeredVariables[s],l=!1;n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:At(c).variable(l)}),n.accumulatedWeightedInfNorm[u]==null&&(n.accumulatedWeightedInfNorm[u]={originalName:"".concat(s,"/v"),variable:At(c).variable(l)});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=n.accumulatedFirstMoment[u].variable,p=n.accumulatedWeightedInfNorm[u].variable,d=xt(be(h,n.beta1),be(f,1-n.beta1)),m=be(p,n.beta2),v=c0e(f),g=KM(m,v);h.assign(d),p.assign(g);var y=xt(be(Ot(o,i),Ot(d,xt(g,n.epsilon))),c);c.assign(y)}}),n.iteration.assign(xt(n.iteration,1)),n.accBeta1.assign(be(n.accBeta1,n.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&ma(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&ma(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ie(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){return Ie(this,function(n){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)},e})(js);var J0e=function(r){se(e,r);function e(t){var n=r.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return Object.defineProperty(e,"className",{get:function(){return"SGD"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=ve.registeredVariables[i];zr(function(){var c=xt(be(n.c,s),u);u.assign(c)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=uge(Nr(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ie(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){return Ie(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:if(t=n.sent(),t.length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,n){return new t(n.learningRate)},e}(js);(function(r){se(e,r);function e(t,n,a){a===void 0&&(a=!1);var i=r.call(this,t)||this;return i.learningRate=t,i.momentum=n,i.useNesterov=a,i.accumulations=[],i.m=Nr(i.momentum),i}return Object.defineProperty(e,"className",{get:function(){return"Momentum"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=ve.registeredVariables[i];if(n.accumulations[o]==null){var u=!1;n.accumulations[o]={originalName:"".concat(i,"/momentum"),variable:zr(function(){return At(s).variable(u)})}}var c=n.accumulations[o].variable,l=Array.isArray(t)?t[o].tensor:t[i];l!=null&&zr(function(){var f,h=xt(be(n.m,c),l);n.useNesterov?f=xt(be(n.c,xt(l,be(h,n.m))),s):f=xt(be(n.c,h),s),c.assign(h),s.assign(f)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&ma(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ie(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var n;return Ie(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),n=!1,this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(n)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,n){return new t(n.learningRate,n.momentum,n.useNesterov)},e})(J0e);(function(r){se(e,r);function e(t,n,a,i,o){n===void 0&&(n=.9),a===void 0&&(a=0),i===void 0&&(i=null),o===void 0&&(o=!1);var s=r.call(this)||this;if(s.learningRate=t,s.decay=n,s.momentum=a,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=o,i==null&&(s.epsilon=ve.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return Object.defineProperty(e,"className",{get:function(){return"RMSProp"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var n=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=ve.registeredVariables[i],u=!1;n.accumulatedMeanSquares[o]==null&&(n.accumulatedMeanSquares[o]={originalName:"".concat(i,"/rms"),variable:zr(function(){return At(s).variable(u)})}),n.accumulatedMoments[o]==null&&(n.accumulatedMoments[o]={originalName:"".concat(i,"/momentum"),variable:zr(function(){return At(s).variable(u)})}),n.accumulatedMeanGrads[o]==null&&n.centered&&(n.accumulatedMeanGrads[o]={originalName:"".concat(i,"/mg"),variable:zr(function(){return At(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=n.accumulatedMeanSquares[o].variable,f=n.accumulatedMoments[o].variable;zr(function(){var h=xt(be(l,n.decay),be(Tr(c),1-n.decay));if(n.centered){var p=n.accumulatedMeanGrads[o].variable,d=xt(be(p,n.decay),be(c,1-n.decay)),m=Ot(be(c,n.learningRate),mi(tn(h,xt(Tr(d),n.epsilon)))),v=xt(be(f,n.momentum),m);l.assign(h),p.assign(d),f.assign(v);var g=tn(s,v);s.assign(g)}else{var y=xt(be(l,n.decay),be(Tr(c),1-n.decay)),v=xt(be(f,n.momentum),Ot(be(c,n.learningRate),mi(xt(y,n.epsilon))));l.assign(y),f.assign(v);var g=tn(s,v);s.assign(g)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&ma(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&ma(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&ma(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){var t;return Ie(this,function(n){switch(n.label){case 0:return t=Je(Je([],te(this.accumulatedMeanSquares),!1),te(this.accumulatedMoments),!1),this.centered&&t.push.apply(t,Je([],te(this.accumulatedMeanGrads),!1)),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var n,a;return Ie(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=this.centered?t.length/3:t.length/2,a=!1,this.accumulatedMeanSquares=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedMoments=t.slice(n,n*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(n*2,n*3).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,n){return new t(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)},e})(js);(function(){return typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:function(r){return r()}})();var jO;(function(r){r[r.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",r[r.VALUE_ROWIDS=1]="VALUE_ROWIDS",r[r.ROW_LENGTHS=2]="ROW_LENGTHS",r[r.ROW_SPLITS=3]="ROW_SPLITS",r[r.ROW_LIMITS=4]="ROW_LIMITS",r[r.ROW_STARTS=5]="ROW_STARTS"})(jO||(jO={}));var Q0e=1.7580993408473768,ebe=1.0507009873554805;function tbe(r,e,t){var n=r.shape.slice();n[t]=1;var a=Qe(e,n),i=HO(r,t,!0,!1),o=HO(r,t,!0,!0),s=be(i,o);return be(a,s)}function rbe(r,e,t){var n=r.shape.length,a=n-t.length,i=$M(t,n),o=r;i!=null&&(o=gc(r,i));var s=o.shape.slice(),u=s.splice(n-t.length,t.length),c=u.reduce(function(p,d){return p*d},1);s.push(c);var l=o.reshape(s),f=tbe(l,e,a);if(f=f.reshape(o.shape),i!=null){var h=Eb(i);f=gc(f,h)}return f}var nbe={kernelName:Ode,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.axis,o=[];return i==null?o=a.shape.map(function(s,u){return u}):typeof i=="number"?o=[i]:o=i,{x:function(){return rbe(a,r,o)}}}},abe={kernelName:LP,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=hn(n.shape,a.shape),o=function(){var u=Ot(r,St(a,"float32")),c=rn(n.shape,i);return c.length>0?Qe(wr(u,c),n.shape):u},s=function(){var u=be(r,St(n,"float32")),c=rn(a.shape,i);c.length>0&&(u=Qe(wr(u,c),a.shape));var l=Tr(a);return Wa(Ot(u,St(l,"float32")))};return{a:o,b:s}}},ibe={kernelName:Mde,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Ot(r,Wa(Tr(n)))}}}},obe={kernelName:Wde,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0],a=be(Tb(n,6),Sb(n));return{x:function(){return be(r,St(a,"float32"))}}}},sbe={kernelName:Bde,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(r,St(Sb(n),"float32"))}}}},ube={kernelName:JP,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Qe(r,n.shape)}}}},cbe={kernelName:$de,inputsToSave:["images"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i={dy:r,images:a},o=function(){return ve.runKernel(qde,i,t)};return{images:o}}},lbe={kernelName:Lde,inputsToSave:["images"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i={dy:r,images:a},o=function(){return ve.runKernel(zde,i,t)};return{images:o}}};var fbe={kernelName:QP,gradFunc:function(r,e,t){var n=t.dims,a=Vs(n,r.shape);return{x:function(){return j0e(r,a)}}}};var hbe={kernelName:Vde,gradFunc:function(r){return{x:function(){return At(r)}}}},pbe={kernelName:eM,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Wa(Ot(r,be(Md(n,1.5),2)))}}}},dbe={kernelName:tM,inputsToSave:["condition"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{condition:function(){return St(At(n),"float32")},t:function(){return be(r,St(n,r.dtype))},e:function(){return be(r,St(I0e(n),r.dtype))}}}},vbe={kernelName:Gde,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){var a=Pf(n,Nr(0)),i=Nr(Q0e),o=Nr(ebe),s=be(r,o),u=be(be(r,i),rv(St(n,"float32")));return qs(a,s,u)}}}},mbe={kernelName:iM,outputsToSave:[!0],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(r,be(n,tn(Nr(1),n)))}}}};var gbe={kernelName:Hde,gradFunc:function(r){return{x:function(){return At(r)}}}},ybe={kernelName:nM,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(HM(St(n,"float32")),r)}}}},bbe={kernelName:aM,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(b0e(St(n,"float32")),r)}}}},wbe={kernelName:rM,inputsToSave:["x"],gradFunc:function(r,e,t){for(var n=te(e,1),a=n[0],i=t.begin,o=t.size,s=a.shape,u=te(o0e(a,i,o),2),c=u[0],l=u[1],f=[],h=0;h<r.rank;h++)f.push([c[h],s[h]-c[h]-l[h]]);return{x:function(){return D0e(r,f)}}}},xbe={kernelName:jde,outputsToSave:[!0],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.dim,o=!0,s=be(r,a);return{logits:function(){return tn(s,be(wr(s,[i],o),a))}}}},kbe={kernelName:Kde,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(r,p0e(n))}}}};var XO={kernelName:uM,gradFunc:function(r,e,t){var n=t.blockShape,a=t.paddings;return{x:function(){return v0e(r,n,a)}}}};var YO={kernelName:cM,gradFunc:function(r,e,t){var n=t.axis;return{x:function(){return f0e(r,n)}}}},Sbe={kernelName:oM,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Ot(r,be(mi(St(n,"float32")),2))}}}},Nbe={kernelName:Yde,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(r,be(St(n,"float32"),2))}}}},Tbe={kernelName:Xde,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=Nr(2),o=function(){return be(r,be(i,tn(n,a)))},s=function(){return be(r,be(i,tn(a,n)))};return{a:o,b:s}}};var Ebe={kernelName:dM,gradFunc:function(r){return{x:function(){return At(r)}}}},Ibe={kernelName:lM,inputsToSave:["a","b"],gradFunc:function(r,e){var t=te(e,2),n=t[0],a=t[1],i=hn(n.shape,a.shape),o=function(){var u=r,c=rn(n.shape,i);return c.length>0&&(u=wr(u,c)),Qe(u,n.shape)},s=function(){var u=r,c=rn(a.shape,i);return c.length>0&&(u=wr(u,c)),Qe(Wa(u),a.shape)};return{a:o,b:s}}},Cbe={kernelName:sM,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=a.shape.slice(),o=t.axis,s=Vs(o,a.shape);s.forEach(function(l){i[l]=1});var u=Qe(r,i),c=be(u,nv(a.shape,"float32"));return{x:function(){return c}}}},Abe={kernelName:Zde,inputsToSave:["x"],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return Ot(r,Tr(HM(n)))}}}},Dbe={kernelName:Jde,outputsToSave:[!0],gradFunc:function(r,e){var t=te(e,1),n=t[0];return{x:function(){return be(tn(Nr(1),Tr(n)),r)}}}},_be={kernelName:pb,inputsToSave:["x"],gradFunc:function(r,e,t){var n=te(e,1),a=n[0],i=t.reps,o=function(){var s=At(a);if(a.rank===1)for(var u=0;u<i[0];++u)s=xt(s,pc(r,[u*a.shape[0]],[a.shape[0]]));else if(a.rank===2)for(var u=0;u<i[0];++u)for(var c=0;c<i[1];++c)s=xt(s,pc(r,[u*a.shape[0],c*a.shape[1]],[a.shape[0],a.shape[1]]));else if(a.rank===3)for(var u=0;u<i[0];++u)for(var c=0;c<i[1];++c)for(var l=0;l<i[2];++l)s=xt(s,pc(r,[u*a.shape[0],c*a.shape[1],l*a.shape[2]],[a.shape[0],a.shape[1],a.shape[2]]));else if(a.rank===4)for(var u=0;u<i[0];++u)for(var c=0;c<i[1];++c)for(var l=0;l<i[2];++l)for(var f=0;f<i[3];++f)s=xt(s,pc(r,[u*a.shape[0],c*a.shape[1],l*a.shape[2],f*a.shape[3]],[a.shape[0],a.shape[1],a.shape[2],a.shape[3]]));else throw new Error("Gradient for tile operation is not implemented for rank-"+"".concat(a.rank," tensors yet."));return s};return{x:o}}};var Fbe={kernelName:Sd,gradFunc:function(r,e,t){var n=t,a=n.perm,i=Eb(a);return{x:function(){return gc(r,i)}}}};var Rbe={kernelName:fM,gradFunc:function(r,e,t){var n=t,a=n.axis;return{value:function(){return Y0e(r,a)}}}},Obe={kernelName:hM,inputsToSave:["segmentIds"],gradFunc:function(r,e){var t=te(e,1),n=t[0],a=function(){return Pbe(r,n)};return{x:a}}};function Pbe(r,e){for(var t=KM(e,At(e)),n=N0e(r,t),a=Nb(e,Nr(0,"int32")),i=n.rank-a.rank,o=0;o<i;++o)a=k0e(a,o+1);a=BM(a,nv(n.shape,"bool"));var s=At(n);return qs(a,n,s)}var Mbe={kernelName:pM,gradFunc:function(r){return{x:function(){return At(r)}}}},D0,ZO,Bbe=[OM,Qve,eme,nme,ame,ome,sme,ume,lme,fme,hme,pme,mme,bme,xme,Nme,Tme,Eme,Ime,Ome,Pme,Lme,Gme,Wme,Yme,Qme,rge,vge,wge,xge,abe,kge,Nge,Tge,Ege,Ige,Age,Cge,Oge,Bge,Lge,zge,$ge,qge,Wge,Uge,Gge,Hge,Kge,Yge,$O,$O,tye,aye,sye,uye,cye,lye,hye,vye,mye,gye,yye,bye,kye,qO,qO,Eye,Iye,nbe,ibe,obe,sbe,ube,cbe,lbe,fbe,hbe,pbe,dbe,vbe,mbe,gbe,ybe,bbe,wbe,xbe,kbe,XO,XO,YO,YO,Sbe,Tbe,Nbe,Ebe,Ibe,Cbe,Abe,Dbe,_be,Fbe,Rbe,Obe,Mbe];try{for(gf=fe(Bbe),cc=gf.next();!cc.done;cc=gf.next())JO=cc.value,vve(JO)}catch(r){D0={error:r}}finally{try{cc&&!cc.done&&(ZO=gf.return)&&ZO.call(gf)}finally{if(D0)throw D0.error}}var JO,gf,cc;function Db(r,e){return F.tidy(function(){return D.sqrt(D.sum(D.mul(r,r),e,!0))})}var Mf=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getConfig=function(){return{}},e}(F.serialization.Serializable),_b=function(r){se(e,r);function e(t){var n=r.call(this)||this;return n.defaultMaxValue=2,n.defaultAxis=0,n.maxValue=t.maxValue!=null?t.maxValue:n.defaultMaxValue,n.axis=t.axis!=null?t.axis:n.defaultAxis,n}return e.prototype.apply=function(t){var n=this;return F.tidy(function(){var a=Db(t,n.axis),i=D.clipByValue(a,0,n.maxValue);return D.mul(t,D.div(i,D.add($r(),a)))})},e.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},e}(Mf);_b.className="MaxNorm";F.serialization.registerClass(_b);var Fb=function(r){se(e,r);function e(t){var n=r.call(this)||this;return n.defaultAxis=0,n.axis=t.axis!=null?t.axis:n.defaultAxis,n}return e.prototype.apply=function(t){var n=this;return F.tidy(function(){return D.div(t,D.add($r(),Db(t,n.axis)))})},e.prototype.getConfig=function(){return{axis:this.axis}},e}(Mf);Fb.className="UnitNorm";F.serialization.registerClass(Fb);var Rb=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return D.relu(t)},e}(Mf);Rb.className="NonNeg";F.serialization.registerClass(Rb);var Ob=function(r){se(e,r);function e(t){var n=r.call(this)||this;return n.defaultMinValue=0,n.defaultMaxValue=1,n.defaultRate=1,n.defaultAxis=0,n.minValue=t.minValue!=null?t.minValue:n.defaultMinValue,n.maxValue=t.maxValue!=null?t.maxValue:n.defaultMaxValue,n.rate=t.rate!=null?t.rate:n.defaultRate,n.axis=t.axis!=null?t.axis:n.defaultAxis,n}return e.prototype.apply=function(t){var n=this;return F.tidy(function(){var a=Db(t,n.axis),i=D.add(D.mul(n.rate,D.clipByValue(a,n.minValue,n.maxValue)),D.mul(1-n.rate,a));return D.mul(t,D.div(i,D.add($r(),a)))})},e.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},e}(Mf);Ob.className="MinMaxNorm";F.serialization.registerClass(Ob);var QO={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function qr(r){return Q0(r)}function eP(r,e){return e===void 0&&(e={}),Df(r,F.serialization.SerializationMap.getMap().classNameMap,e,"constraint")}function Wr(r){if(r==null)return null;if(typeof r=="string"){var e=r in QO?QO[r]:r,t={className:e,config:{}};return eP(t)}else return r instanceof Mf?r:eP(r)}function Lbe(r){return new _b(r)}function zbe(r){return new Fb(r)}function $be(){return new Rb}function qbe(r){return new Ob(r)}var Wbe={__proto__:null,maxNorm:Lbe,minMaxNorm:qbe,nonNeg:$be,unitNorm:zbe};function Vbe(){return new rb}function Ube(){return new Kd}function Gbe(r){return new nb(r)}function Hbe(r){return new ab(r)}function Kbe(r){return new ib(r)}function jbe(r){return new ob(r)}function Xbe(r){return new sb(r)}function Ybe(r){return new _n(r)}function Zbe(r){return new jd(r)}function Jbe(r){return new Xd(r)}function Qbe(r){return new Yd(r)}function ewe(r){return new Zd(r)}function twe(r){return new Jd(r)}function rwe(r){return new Qd(r)}function nwe(r){return new ub(r)}var awe={__proto__:null,constant:Gbe,glorotNormal:Jbe,glorotUniform:Zbe,heNormal:Qbe,heUniform:ewe,identity:Xbe,leCunNormal:twe,leCunUniform:rwe,ones:Ube,orthogonal:nwe,randomNormal:Kbe,randomUniform:Hbe,truncatedNormal:jbe,varianceScaling:Ybe,zeros:Vbe};function Vo(r){return Ce(this,void 0,void 0,function(){var e,t,n,a,i,o,s,u;return Ie(this,function(c){switch(c.label){case 0:if(r==null)return[2];e=[],t=[],n=[];for(a in r)i=r[a],typeof i!="number"&&(o=i,e.push(o.data()),t.push(a),n.push(o));return e.length>0?[4,Promise.all(e)]:[3,2];case 1:for(s=c.sent(),u=0;u<s.length;++u)r[t[u]]=s[u][0];F.dispose(n),c.label=2;case 2:return[2]}})})}function t4(r){if(r!=null)for(var e in r){var t=r[e];typeof t!="number"&&t.dispose()}}var tP;(function(r){r[r.SILENT=0]="SILENT",r[r.VERBOSE=1]="VERBOSE"})(tP||(tP={}));var iwe=125,yc=function(){function r(){this.validationData=null}return r.prototype.setParams=function(e){this.params=e},r.prototype.onEpochBegin=function(e,t){return Ce(this,void 0,void 0,function(){return Ie(this,function(n){return[2]})})},r.prototype.onEpochEnd=function(e,t){return Ce(this,void 0,void 0,function(){return Ie(this,function(n){return[2]})})},r.prototype.onBatchBegin=function(e,t){return Ce(this,void 0,void 0,function(){return Ie(this,function(n){return[2]})})},r.prototype.onBatchEnd=function(e,t){return Ce(this,void 0,void 0,function(){return Ie(this,function(n){return[2]})})},r.prototype.onTrainBegin=function(e){return Ce(this,void 0,void 0,function(){return Ie(this,function(t){return[2]})})},r.prototype.onTrainEnd=function(e){return Ce(this,void 0,void 0,function(){return Ie(this,function(t){return[2]})})},r.prototype.setModel=function(e){},r}(),r4=function(){function r(e,t){t===void 0&&(t=10),e==null&&(e=[]),this.callbacks=e,this.queueLength=t}return r.prototype.append=function(e){this.callbacks.push(e)},r.prototype.setParams=function(e){var t,n;try{for(var a=fe(this.callbacks),i=a.next();!i.done;i=a.next()){var o=i.value;o.setParams(e)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},r.prototype.setModel=function(e){var t,n;try{for(var a=fe(this.callbacks),i=a.next();!i.done;i=a.next()){var o=i.value;o.setModel(e)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},r.prototype.onEpochBegin=function(e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u;return Ie(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),n=fe(this.callbacks),a=n.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onEpochBegin(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},r.prototype.onEpochEnd=function(e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u;return Ie(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),n=fe(this.callbacks),a=n.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onEpochEnd(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},r.prototype.onBatchBegin=function(e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u;return Ie(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),n=fe(this.callbacks),a=n.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onBatchBegin(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},r.prototype.onBatchEnd=function(e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u;return Ie(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),n=fe(this.callbacks),a=n.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onBatchEnd(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=n.return)&&u.call(n)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},r.prototype.onTrainBegin=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s;return Ie(this,function(u){switch(u.label){case 0:e==null&&(e={}),u.label=1;case 1:u.trys.push([1,6,7,8]),t=fe(this.callbacks),n=t.next(),u.label=2;case 2:return n.done?[3,5]:(a=n.value,[4,a.onTrainBegin(e)]);case 3:u.sent(),u.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return i=u.sent(),o={error:i},[3,8];case 7:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},r.prototype.onTrainEnd=function(e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s;return Ie(this,function(u){switch(u.label){case 0:e==null&&(e={}),u.label=1;case 1:u.trys.push([1,6,7,8]),t=fe(this.callbacks),n=t.next(),u.label=2;case 2:return n.done?[3,5]:(a=n.value,[4,a.onTrainEnd(e)]);case 3:u.sent(),u.label=4;case 4:return n=t.next(),[3,2];case 5:return[3,8];case 6:return i=u.sent(),o={error:i},[3,8];case 7:try{n&&!n.done&&(s=t.return)&&s.call(t)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},r}(),owe=function(r){se(e,r);function e(){return r.call(this)||this}return e.prototype.onEpochBegin=function(t){return Ce(this,void 0,void 0,function(){return Ie(this,function(n){return this.seen=0,this.totals={},[2]})})},e.prototype.onBatchEnd=function(t,n){return Ce(this,void 0,void 0,function(){var a,i,o,s,u=this;return Ie(this,function(c){n==null&&(n={}),a=n.size==null?0:n.size,this.seen+=a,i=function(l){var f=n[l];if(typeof f=="number")o.totals.hasOwnProperty(l)||(o.totals[l]=0),o.totals[l]=o.totals[l]+f*a;else{var h=void 0;l in o.totals?h=o.totals[l]:o.totals[l]=0;var p=F.tidy(function(){return F.add(u.totals[l],F.mul(f,a))});o.totals[l]=p,h?.dispose()}},o=this;for(s in n)i(s);return[2]})})},e.prototype.onEpochEnd=function(t,n){return Ce(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f=this;return Ie(this,function(h){if(n!=null){a=function(p){if(i.totals[p]==null)return"continue";typeof i.totals[p]=="number"?n[p]=i.totals[p]/i.seen:F.tidy(function(){var d=F.mul(F.div(1,f.seen),f.totals[p]);n[p]=d,f.totals[p].dispose(),F.keep(n[p])})},i=this;try{for(o=fe(this.params.metrics),s=o.next();!s.done;s=o.next())u=s.value,a(u)}catch(p){c={error:p}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}}return[2]})})},e}(yc),n4=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.onTrainBegin=function(t){return Ce(this,void 0,void 0,function(){return Ie(this,function(n){return this.epoch=[],this.history={},[2]})})},e.prototype.onEpochEnd=function(t,n){return Ce(this,void 0,void 0,function(){var a;return Ie(this,function(i){n==null&&(n={}),this.epoch.push(t);for(a in n)this.history[a]==null&&(this.history[a]=[]),this.history[a].push(n[a]);return[2]})})},e.prototype.syncData=function(){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f;return Ie(this,function(h){switch(h.label){case 0:t=[],n=[],a=[];for(i in this.history)for(o=this.history[i],s=0;s<o.length;++s)typeof o[s]!="number"&&(u=o[s],t.push(u.data()),n.push(i),a.push(s));return[4,Promise.all(t)];case 1:for(c=h.sent(),l=0;l<c.length;++l)f=this.history[n[l]][a[l]],f.dispose(),this.history[n[l]][a[l]]=c[l][0];return[2]}})})},e}(yc),a4=function(r){se(e,r);function e(t,n){var a=r.call(this)||this;if(a.currentEpoch=0,a.nowFunc=t.nowFunc,a.nextFrameFunc=t.nextFrameFunc||F.nextFrame,a.yieldEvery=n||"auto",a.yieldEvery==="auto"&&(a.yieldEvery=iwe),a.yieldEvery==="never"&&t.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return F.util.isNumber(a.yieldEvery)&&(a.maybeWait=Hhe(a.maybeWait.bind(a),a.yieldEvery,a.nowFunc)),a.trainBegin=t.onTrainBegin,a.trainEnd=t.onTrainEnd,a.epochBegin=t.onEpochBegin,a.epochEnd=t.onEpochEnd,a.batchBegin=t.onBatchBegin,a.batchEnd=t.onBatchEnd,a.yield=t.onYield,a}return e.prototype.maybeWait=function(t,n,a){return Ce(this,void 0,void 0,function(){var i;return Ie(this,function(o){switch(o.label){case 0:return i=[],this.yield==null?[3,2]:[4,Vo(a)];case 1:o.sent(),i.push(this.yield(t,n,a)),o.label=2;case 2:return i.push(this.nextFrameFunc()),[4,Promise.all(i)];case 3:return o.sent(),[2]}})})},e.prototype.onEpochBegin=function(t,n){return Ce(this,void 0,void 0,function(){return Ie(this,function(a){switch(a.label){case 0:return this.currentEpoch=t,this.epochBegin==null?[3,3]:[4,Vo(n)];case 1:return a.sent(),[4,this.epochBegin(t,n)];case 2:a.sent(),a.label=3;case 3:return[2]}})})},e.prototype.onEpochEnd=function(t,n){return Ce(this,void 0,void 0,function(){var a;return Ie(this,function(i){switch(i.label){case 0:return a=[],this.epochEnd==null?[3,2]:[4,Vo(n)];case 1:i.sent(),a.push(this.epochEnd(t,n)),i.label=2;case 2:return this.yieldEvery==="epoch"&&a.push(this.nextFrameFunc()),[4,Promise.all(a)];case 3:return i.sent(),[2]}})})},e.prototype.onBatchBegin=function(t,n){return Ce(this,void 0,void 0,function(){return Ie(this,function(a){switch(a.label){case 0:return this.batchBegin==null?[3,3]:[4,Vo(n)];case 1:return a.sent(),[4,this.batchBegin(t,n)];case 2:a.sent(),a.label=3;case 3:return[2]}})})},e.prototype.onBatchEnd=function(t,n){return Ce(this,void 0,void 0,function(){var a;return Ie(this,function(i){switch(i.label){case 0:return a=[],this.batchEnd==null?[3,2]:[4,Vo(n)];case 1:i.sent(),a.push(this.batchEnd(t,n)),i.label=2;case 2:return this.yieldEvery==="batch"?a.push(this.nextFrameFunc()):F.util.isNumber(this.yieldEvery)&&a.push(this.maybeWait(this.currentEpoch,t,n)),[4,Promise.all(a)];case 3:return i.sent(),[2]}})})},e.prototype.onTrainBegin=function(t){return Ce(this,void 0,void 0,function(){return Ie(this,function(n){switch(n.label){case 0:return this.trainBegin==null?[3,3]:[4,Vo(t)];case 1:return n.sent(),[4,this.trainBegin(t)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e.prototype.onTrainEnd=function(t){return Ce(this,void 0,void 0,function(){return Ie(this,function(n){switch(n.label){case 0:return this.trainEnd==null?[3,3]:[4,Vo(t)];case 1:return n.sent(),[4,this.trainEnd(t)];case 2:n.sent(),n.label=3;case 3:return[2]}})})},e}(yc);function i4(r,e){if(r==null&&(r={}),r instanceof yc)return[r];if(Array.isArray(r)&&r[0]instanceof yc)return r;var t=Zt(r);return t.map(function(n){return new a4(n,e)})}var Pb=function(){function r(){}return r.registerCallbackConstructor=function(e,t){F.util.assert(e>=0&&Number.isInteger(e),function(){return"Verbosity level is expected to be an integer >= 0, "+"but got ".concat(e)}),r.checkForDuplicate(t),r.constructors[e]==null&&(r.constructors[e]=[]),r.constructors[e].push(t)},r.checkForDuplicate=function(e){for(var t in r.constructors){var n=r.constructors[+t];n.forEach(function(a){if(a===e)throw new Z("Duplicate callback constructor.")})}},r.clear=function(){r.constructors={}},r.createCallbacks=function(e){var t=[];for(var n in r.constructors){var a=+n;e>=a&&t.push.apply(t,Je([],te(r.constructors[a]),!1))}return t.map(function(i){return new i})},r}();Pb.constructors={};function o4(r,e,t,n,a,i,o,s,u){var c=new n4,l=Je([new owe],te(Pb.createCallbacks(e)),!1);r!=null&&l.push.apply(l,Je([],te(r),!1)),l.push(c);var f=new r4(l);return f.setParams({epochs:t,initialEpoch:n,samples:a,steps:i,batchSize:o,verbose:e,doValidation:s,metrics:u}),{callbackList:f,history:c}}function hi(r,e,t){return e===void 0&&(e={}),t===void 0&&(t=!1),Df(r,F.serialization.SerializationMap.getMap().classNameMap,e,"layer",t)}function $d(r,e){return F.tidy(function(){r.dtype!=="float32"&&(r=D.cast(r,"float32"));var t=D.sum(Ff(r),e,!0),n=D.fill(t.shape,$r()),a=D.sqrt(D.maximum(t,n));return D.div(r,a)})}function Xs(r,e){return F.tidy(function(){return D.mean(Ff(D.sub(e,r)),-1)})}function ov(r,e){return F.tidy(function(){return D.mean(D.abs(D.sub(e,r)),-1)})}function xc(r,e){return F.tidy(function(){var t=D.sub(r,e),n=D.clipByValue(D.abs(r),$r(),Number.MAX_VALUE),a=D.abs(D.div(t,n));return D.mul(100,D.mean(a,-1))})}function swe(r,e){return F.tidy(function(){var t=D.clipByValue(e,$r(),Number.MAX_VALUE),n=D.log(D.add(1,t)),a=D.clipByValue(r,$r(),Number.MAX_VALUE),i=D.log(D.add(1,a));return D.mean(Ff(D.sub(n,i)),-1)})}function uwe(r,e){return F.tidy(function(){var t=D.maximum(0,D.sub(1,D.mul(r,e)));return D.mean(Ff(t),-1)})}function cwe(r,e){return F.tidy(function(){var t=D.maximum(0,D.sub(1,D.mul(r,e)));return D.mean(t,-1)})}function lwe(r,e){return F.tidy(function(){var t=D.sum(D.mul(r,e),-1),n=D.max(D.mul(D.sub(1,r),e),-1);return D.maximum(0,D.add(1,D.sub(n,t)))})}function fwe(r,e){return F.tidy(function(){var t=Math.log(2),n=D.sub(e,r),a=D.sub(D.add(n,D.softplus(D.mul(-2,n))),t);return D.mean(a,-1)})}function If(r,e,t){return t===void 0&&(t=!1),F.tidy(function(){if(t)e=D.softmax(e);else{var n=D.sum(e,e.shape.length-1,!0);e=D.div(e,n)}return e=D.clipByValue(e,$r(),1-$r()),D.neg(D.sum(D.mul(D.cast(r,"float32"),D.log(e)),e.shape.length-1))})}function qd(r,e,t){return t===void 0&&(t=!1),F.tidy(function(){var n=D.cast(D.floor(ape(r)),"int32");e=D.clipByValue(e,$r(),1-$r());var a=e.shape,i=D.reshape(D.oneHot(n,a[a.length-1]),a);return If(i,e,t)})}function hwe(r,e){if(!F.util.arraysEqual(r.shape,e.shape))throw new Z("logits and labels must have the same shape, but got shapes "+"".concat(JSON.stringify(r.shape)," and ").concat(JSON.stringify(e.shape)));return F.tidy(function(){var t=D.relu(e),n=D.neg(D.abs(e));return D.add(D.sub(t,D.mul(e,r)),D.log1p(D.exp(n)))})}function sv(r,e){return F.tidy(function(){var t;return t=D.clipByValue(e,$r(),1-$r()),t=D.log(D.div(t,D.sub(1,t))),D.mean(hwe(r,t),-1)})}function pwe(r,e){return F.tidy(function(){var t=D.clipByValue(r,$r(),1),n=D.clipByValue(e,$r(),1);return D.sum(D.mul(r,D.log(D.div(t,n))),-1)})}function dwe(r,e){return F.tidy(function(){var t=D.log(D.add($r(),e));return D.mean(D.sub(e,D.mul(r,t)),-1)})}function Mb(r,e){return F.tidy(function(){var t=$d(r,-1),n=$d(e,-1),a=D.mul(t,n);return D.neg(D.sum(a,-1))})}var Wd={meanSquaredError:Xs,meanAbsoluteError:ov,meanAbsolutePercentageError:xc,meanSquaredLogarithmicError:swe,squaredHinge:uwe,hinge:cwe,categoricalHinge:lwe,logcosh:fwe,categoricalCrossentropy:If,sparseCategoricalCrossentropy:qd,binaryCrossentropy:sv,kullbackLeiblerDivergence:pwe,poisson:dwe,cosineProximity:Mb};function _0(r){if(typeof r=="string"){if(r in Wd)return Wd[r];var e="Unknown loss ".concat(r);throw r.toLowerCase().includes("softmaxcrossentropy")&&(e="Unknown loss ".concat(r,". ")+'Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new Z(e)}else return r}function Bb(r,e){return F.tidy(function(){var t=D.mul(.5,D.onesLike(e)),n=Pi(D.greater(e,t),r.dtype);return D.mean(D.equal(r,n),-1)})}function Lb(r,e){return F.tidy(function(){return Pi(D.equal(D.argMax(r,-1),D.argMax(e,-1)),"float32")})}function s4(r,e){return F.tidy(function(){return D.cast(D.sum(D.logicalAnd(D.equal(r,1),D.equal(e,1))),"float32")})}function vwe(r,e){return F.tidy(function(){return D.cast(D.sum(D.logicalAnd(D.equal(r,1),D.equal(e,0))),"float32")})}function mwe(r,e){return F.tidy(function(){return D.cast(D.sum(D.logicalAnd(D.equal(r,0),D.equal(e,1))),"float32")})}function u4(r,e){return F.tidy(function(){var t=s4(r,e),n=mwe(r,e),a=D.add(t,n);return D.cast(D.where(D.greater(a,0),D.div(t,a),0),"float32")})}function gwe(r,e){return F.tidy(function(){var t=s4(r,e),n=vwe(r,e),a=D.add(t,n);return D.cast(D.where(D.greater(a,0),D.div(t,a),0),"float32")})}function c4(r,e){return sv(r,e)}function l4(r,e){return r.rank===e.rank&&(r=D.squeeze(r,[r.rank-1])),e=D.argMax(e,-1),e.dtype!==r.dtype&&(e=D.cast(e,r.dtype)),D.cast(D.equal(r,e),"float32")}var ywe=Xs,bwe=Xs,wwe=ov,xwe=ov,kwe=xc,Swe=xc,zb=If,Nwe=Mb,f4=qd,Vd={binaryAccuracy:Bb,categoricalAccuracy:Lb,precision:u4,categoricalCrossentropy:zb,sparseCategoricalCrossentropy:f4,mse:ywe,MSE:bwe,mae:wwe,MAE:xwe,mape:kwe,MAPE:Swe,cosine:Nwe};function Twe(r){if(typeof r=="string"&&r in Vd)return Vd[r];if(typeof r!="string"&&r!=null)return r;throw new Z("Unknown metric ".concat(r))}function xd(r){var e,t,n,a;if(Fi(r!==null,"Unknown LossOrMetricFn ".concat(r)),typeof r=="string")return r;var i=void 0;try{for(var o=fe(Object.keys(Wd)),s=o.next();!s.done;s=o.next()){var u=s.value;if(Wd[u]===r){i=u;break}}}catch(f){e={error:f}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}if(i!==void 0)return i;try{for(var c=fe(Object.keys(Vd)),l=c.next();!l.done;l=c.next()){var u=l.value;if(Vd[u]===r){i=u;break}}}catch(f){n={error:f}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}return i!==void 0?i:r.name}function Ewe(r){var e={Adagrad:function(){return F.train.adagrad(.01)},Adadelta:function(){return F.train.adadelta(1,.95,$r())},Adam:function(){return F.train.adam(.001,.9,.999,$r())},Adamax:function(){return F.train.adamax(.002,.9,.999,$r(),0)},RMSProp:function(){return F.train.rmsprop(.001,.9,0,$r())},SGD:function(){return F.train.sgd(.01)}};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,r in e)return e[r]();throw new Z("Unknown Optimizer ".concat(r))}var rP=1*1024*1024;function nP(r,e,t){if(t===void 0&&(t=!1),r==null||typeof r!="object"||Object.getPrototypeOf(r)!==Object.prototype||!X0(r))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){var n=JSON.stringify(r);n.length>rP&&console.warn('User-defined metadata of model "'.concat(e,'" is too large in ')+"size (length=".concat(n.length," when serialized). It is not ")+"recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+"".concat(rP,"."))}}function X0(r){var e,t,n,a;if(r===null)return!0;if(typeof r=="object")if(Object.getPrototypeOf(r)===Object.prototype){var i=Object.keys(r);try{for(var o=fe(i),s=o.next();!s.done;s=o.next()){var u=s.value;if(typeof u!="string"||!X0(r[u]))return!1}}catch(p){e={error:p}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return!0}else if(Array.isArray(r)){try{for(var c=fe(r),l=c.next();!l.done;l=c.next()){var f=l.value;if(!X0(f))return!1}}catch(p){n={error:p}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}return!0}else return!1;else{var h=typeof r;return h==="string"||h==="number"||h==="boolean"}}function Iwe(r,e,t,n){n===void 0&&(n=console.log);var a=Awe(r),i=["Layer (type)","Input Shape","Output shape","Param #"];a?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(function(h){return Math.floor(e*h)}));var o;if(!a){i.push("Receives inputs"),o=[];for(var s in r.nodesByDepth)o.push.apply(o,Je([],te(r.nodesByDepth[s]),!1))}n("_".repeat(e)),Ud(i,t,n),n("=".repeat(e));for(var u=r.layers,c=0;c<u.length;++c)a?Dwe(u[c],t,n):_we(u[c],t,o,n),n((c===u.length-1?"=":"_").repeat(e));r.checkTrainableWeightsConsistency();var l=Cwe(r),f=Cd(r.nonTrainableWeights);n("Total params: ".concat(l+f)),n("Trainable params: ".concat(l)),n("Non-trainable params: ".concat(f)),n("_".repeat(e))}function Cwe(r){var e;return r.collectedTrainableWeights!=null?e=Cd(r.collectedTrainableWeights):e=Cd(r.trainableWeights),e}function Awe(r){var e,t,n,a,i,o,s=!0,u=[],c=[];for(var l in r.nodesByDepth)u.push(r.nodesByDepth[l]);try{for(var f=fe(u),h=f.next();!h.done;h=f.next()){var p=h.value;if(p.length>1||p.length===1&&p[0].inboundLayers.length>1){s=!1;break}c.push.apply(c,Je([],te(p),!1))}}catch(x){e={error:x}}finally{try{h&&!h.done&&(t=f.return)&&t.call(f)}finally{if(e)throw e.error}}if(s)try{for(var d=fe(r.layers),m=d.next();!m.done;m=d.next()){var v=m.value,g=!1;try{for(var y=(i=void 0,fe(v.inboundNodes)),w=y.next();!w.done;w=y.next()){var b=w.value;if(c.indexOf(b)!==-1)if(g){s=!1;break}else g=!0}}catch(x){i={error:x}}finally{try{w&&!w.done&&(o=y.return)&&o.call(y)}finally{if(i)throw i.error}}if(!s)break}}catch(x){n={error:x}}finally{try{m&&!m.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}return s}function Ud(r,e,t){t===void 0&&(t=console.log);for(var n="",a=0;a<r.length;++a)a>0&&(n=n.slice(0,n.length-1)+" "),n+=r[a],n=n.slice(0,e[a]),n+=" ".repeat(e[a]-n.length);t(n)}function Dwe(r,e,t){var n,a;try{a=r.inboundNodes.map(function(u){return JSON.stringify(u.inputShapes)}).join(",")}catch{a="multiple"}try{n=JSON.stringify(r.outputShape)}catch{n="multiple"}var i=r.name,o=r.getClassName(),s=["".concat(i," (").concat(o,")"),a,n,r.countParams().toString()];Ud(s,e,t)}function _we(r,e,t,n){var a,i,o,s;try{s=r.inboundNodes.map(function(b){return JSON.stringify(b.inputShapes)}).join(",")}catch{s="multiple"}try{o=JSON.stringify(r.outputShape)}catch{o="multiple"}var u=[];try{for(var c=fe(r.inboundNodes),l=c.next();!l.done;l=c.next()){var f=l.value;if(!(t!=null&&t.length>0&&t.indexOf(f)===-1))for(var h=0;h<f.inboundLayers.length;++h){var p=f.inboundLayers[h].name,d=f.nodeIndices[h],m=f.tensorIndices[h];u.push("".concat(p,"[").concat(d,"][").concat(m,"]"))}}}catch(b){a={error:b}}finally{try{l&&!l.done&&(i=c.return)&&i.call(c)}finally{if(a)throw a.error}}var v=r.name,g=r.getClassName(),y=u.length===0?"":u[0],w=["".concat(v," (").concat(g,")"),s,o,r.countParams().toString(),y];Ud(w,e,n);for(var h=1;h<u.length;++h)Ud(["","","","",u[h]],e,n)}function h4(r,e,t){return(r==="inboundNodes"||r==="outputLayers"||r==="inputLayers")&&e===0&&typeof t=="string"}function Cf(r,e){var t,n;if(r===null)return null;if(typeof r=="string")return Ms(r);if(typeof r=="number"||typeof r=="boolean")return r;if(r instanceof Array){for(var a=[],i=r.length,o=0;o<i;++o){var s=r[o];h4(e,o,s)?a.push(s):a.push(Cf(s,e))}return a}else{var u={};try{for(var c=fe(Object.keys(r)),l=c.next();!l.done;l=c.next()){var f=l.value,h=r[f];if(f==="name"&&typeof h=="string")u[f]=h;else{var p=Ms(f);u[p]=Cf(h,p)}}}catch(d){t={error:d}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}return u}}function Y0(r,e){var t,n;if(r==null)return null;if(typeof r=="string")return ao(r);if(typeof r=="number"||typeof r=="boolean")return r;if(r instanceof Array){for(var a=[],i=r.length,o=0;o<i;++o){var s=r[o];h4(e,o,s)?a.push(s):a.push(Y0(s,e))}return a}else{var u={};try{for(var c=fe(Object.keys(r)),l=c.next();!l.done;l=c.next()){var f=l.value,h=r[f],p=ao(f);(f==="name"||f==="className")&&typeof h=="string"?u[p]=h:u[p]=Y0(h,f)}}catch(d){t={error:d}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}return u}}var $b="4.6.0",Fwe=function(r){se(e,r);function e(t){var n,a,i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S,T,E,C,R,_=r.call(this,{})||this;if(_.containerNodes=new Set,_.name=t.name,_.name==null){var O=_.getClassName().toLowerCase();_.name=Gd(O)}if(_.supportsMasking=!1,_.trainable_=!0,Array.isArray(t.inputs)?_.inputs=t.inputs.slice():_.inputs=[t.inputs],Array.isArray(t.outputs)?_.outputs=t.outputs.slice():_.outputs=[t.outputs],Go(_.inputs).length!==_.inputs.length)throw new Z("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+"".concat(_.inputs.map(function(pt){return pt.name})));Go(_.outputs).length!==_.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+"".concat(_.outputs.map(function(pt){return pt.name}))),_.inputLayers=[],_.inputLayersNodeIndices=[],_.inputLayersTensorIndices=[],_.outputLayers=[],_.outputLayersNodeIndices=[],_.outputLayersTensorIndices=[],_.layers=[],_.internalContainerRefs=[];try{for(var $=fe(_.outputs),z=$.next();!z.done;z=$.next()){var L=z.value,B=L.sourceLayer,W=L.nodeIndex,X=L.tensorIndex;_.outputLayers.push(B),_.outputLayersNodeIndices.push(W),_.outputLayersTensorIndices.push(X)}}catch(pt){n={error:pt}}finally{try{z&&!z.done&&(a=$.return)&&a.call($)}finally{if(n)throw n.error}}try{for(var J=fe(_.inputs),V=J.next();!V.done;V=J.next()){var L=V.value,B=L.sourceLayer,W=L.nodeIndex,X=L.tensorIndex;Fi(W===0,"input layer has >1 nodes"),Fi(X===0,"input layer has >1 tensors"),_.inputLayers.push(B),_.inputLayersNodeIndices.push(W),_.inputLayersTensorIndices.push(X)}}catch(pt){i={error:pt}}finally{try{V&&!V.done&&(o=J.return)&&o.call(J)}finally{if(i)throw i.error}}_.inputNames=[],_.outputNames=[],_.feedInputShapes=[],_.feedInputNames=[],_.feedOutputNames=[];for(var j=0;j<_.inputLayers.length;j++){var B=_.inputLayers[j];if(!(B instanceof bc))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. "+"Received inputs: ".concat(t.inputs,". ")+"Input ".concat(j," (0-based) originates ")+"from layer type ".concat(B.getClassName(),"."));_.inputNames.push(B.name),_.feedInputShapes.push(B.batchInputShape),_.feedInputNames.push(B.name)}try{for(var ne=fe(_.outputLayers),re=ne.next();!re.done;re=ne.next()){var B=re.value;_.outputNames.push(B.name)}}catch(pt){s={error:pt}}finally{try{re&&!re.done&&(u=ne.return)&&u.call(ne)}finally{if(s)throw s.error}}_.internalInputShapes=_.inputs.map(function(pt){return pt.shape}),_.internalOutputShapes=_.outputs.map(function(pt){return pt.shape});var oe={},le={},de={},ke={},he={},ye=[],xe=function(pt,Ea,ti,qn,ps,G2){(qn==null||ps==null||G2==null)&&(qn=pt.sourceLayer,ps=pt.nodeIndex,G2=pt.tensorIndex);var fa=qn.inboundNodes[ps];if(ti.indexOf(fa)!==-1)throw new Oi("The tensor ".concat(pt.name,' at layer "').concat(qn.name,'" ')+"is part of a cycle.");if(Ea.indexOf(fa)===-1){_.containerNodes.add(e.nodeKey(qn,ps)),qn.id in he||(he[qn.id]=Object.keys(he).length),ti.indexOf(fa)===-1&&ti.push(fa);for(var AK=fa.inboundLayers.length,Ou=0;Ou<AK;Ou++){var DK=fa.inputTensors[Ou],_K=fa.inboundLayers[Ou],FK=fa.nodeIndices[Ou],RK=fa.tensorIndices[Ou];xe(DK,Ea,ti,_K,FK,RK)}for(Ea.push(fa);ti.indexOf(fa)>=0;)ti.splice(ti.indexOf(fa),1);ye.push(fa)}},De=[],Ye=[];try{for(var ht=fe(_.outputs),at=ht.next();!at.done;at=ht.next()){var L=at.value;xe(L,De,Ye)}}catch(pt){c={error:pt}}finally{try{at&&!at.done&&(l=ht.return)&&l.call(ht)}finally{if(c)throw c.error}}var nt=ye.slice().reverse();try{for(var ft=fe(nt),st=ft.next();!st.done;st=ft.next()){var Ze=st.value;le[Ze.id]=Ze,Ze.id in oe||(oe[Ze.id]=0);var tt=oe[Ze.id],et=de[Ze.outboundLayer.id]==null?0:de[Ze.outboundLayer.id];tt=Math.max(tt,et),de[Ze.outboundLayer.id]=tt,ke[Ze.outboundLayer.id]=Ze.outboundLayer,oe[Ze.id]=tt;for(var j=0;j<Ze.inboundLayers.length;j++){var nr=Ze.inboundLayers[j],W=Ze.nodeIndices[j],He=nr.inboundNodes[W],kt=oe[He.id]==null?0:oe[He.id];oe[He.id]=Math.max(tt+1,kt),le[He.id]=He}}}catch(pt){f={error:pt}}finally{try{st&&!st.done&&(h=ft.return)&&h.call(ft)}finally{if(f)throw f.error}}var Ir={};for(var vn in oe){var tt=oe[vn];tt in Ir||(Ir[tt]=[]),Ir[tt].push(le[vn])}var Pr={};for(var Cr in de){var tt=de[Cr];tt in Pr||(Pr[tt]=[]),Pr[tt].push(ke[Cr])}var ar=Object.keys(Pr).map(function(pt){return parseInt(pt,10)}).sort(yd);_.layers=[];try{for(var zn=fe(ar),mn=zn.next();!mn.done;mn=zn.next()){var tt=mn.value,$n=Pr[tt];$n.sort(function(Ea,ti){var qn=he[Ea.id],ps=he[ti.id];return qn<ps?-1:qn>ps?1:0});try{for(var Sr=(m=void 0,fe($n)),Ki=Sr.next();!Ki.done;Ki=Sr.next()){var B=Ki.value;B instanceof e&&_.internalContainerRefs.push(B),_.layers.push(B)}}catch(Ea){m={error:Ea}}finally{try{Ki&&!Ki.done&&(v=Sr.return)&&v.call(Sr)}finally{if(m)throw m.error}}}}catch(pt){p={error:pt}}finally{try{mn&&!mn.done&&(d=zn.return)&&d.call(zn)}finally{if(p)throw p.error}}_.layersByDepth=Pr,ar=Object.keys(Ir).map(function(pt){return parseInt(pt,10)}).sort(yd);var Fu=_.inputs.slice(),Gh=[];try{for(var ji=fe(ar),hs=ji.next();!hs.done;hs=ji.next()){var tt=hs.value;try{for(var Ru=(w=void 0,fe(Ir[tt])),ml=Ru.next();!ml.done;ml=Ru.next()){var Ze=ml.value,B=Ze.outboundLayer;if(B!=null){try{for(var Hh=(x=void 0,fe(Ze.inputTensors)),gl=Hh.next();!gl.done;gl=Hh.next()){var L=gl.value;if(Fu.indexOf(L)===-1)throw new Oi("Graph disconnected: cannot obtain value for tensor ".concat(L)+' at layer "'.concat(B.name,'". ')+"The following previous layers were accessed without "+"issue: ".concat(Gh))}}catch(qn){x={error:qn}}finally{try{gl&&!gl.done&&(S=Hh.return)&&S.call(Hh)}finally{if(x)throw x.error}}try{for(var Kh=(T=void 0,fe(Ze.outputTensors)),yl=Kh.next();!yl.done;yl=Kh.next()){var L=yl.value;Fu.push(L)}}catch(qn){T={error:qn}}finally{try{yl&&!yl.done&&(E=Kh.return)&&E.call(Kh)}finally{if(T)throw T.error}}Gh.push(B.name)}}}catch(Ea){w={error:Ea}}finally{try{ml&&!ml.done&&(b=Ru.return)&&b.call(Ru)}finally{if(w)throw w.error}}}}catch(pt){g={error:pt}}finally{try{hs&&!hs.done&&(y=ji.return)&&y.call(ji)}finally{if(g)throw g.error}}_.nodesByDepth=Ir;var ng=_.layers.map(function(pt){return pt.name}),IK=function(pt){var Ea=ng.filter(function(ti){return ti===pt}).length;if(Ea!==1)throw new Oi('The name "'.concat(pt,'" is used ').concat(Ea," times ")+"in the model. All layer names should be unique. Layer names: "+JSON.stringify(ng))};try{for(var jh=fe(ng),bl=jh.next();!bl.done;bl=jh.next()){var CK=bl.value;IK(CK)}}catch(pt){C={error:pt}}finally{try{bl&&!bl.done&&(R=jh.return)&&R.call(jh)}finally{if(C)throw C.error}}return _.outboundNodes=[],_.inboundNodes=[],new ev({outboundLayer:_,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:_.inputs,outputTensors:_.outputs,inputMasks:_.inputs.map(function(pt){return null}),outputMasks:_.outputs.map(function(pt){return null}),inputShapes:_.inputs.map(function(pt){return pt.shape}),outputShapes:_.outputs.map(function(pt){return pt.shape})}),_.built=!0,_._refCount=1,_}return e.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Container '".concat(this.name,"' is already disposed."))},e.prototype.dispose=function(){var t,n,a,i;this.assertNotDisposed();var o={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){var c=u.value;o.numDisposedVariables+=c.dispose().numDisposedVariables}}catch(p){t={error:p}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}try{for(var l=fe(this.internalContainerRefs),f=l.next();!f.done;f=l.next()){var h=f.value;o.numDisposedVariables+=h.dispose().numDisposedVariables}}catch(p){a={error:p}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}}return o.refCountAfterDispose=this._refCount,o},Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this.layers.forEach(function(n){n._trainableWeights.forEach(function(a){return a.trainable=t})}),this.trainable_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){var t,n;if(this._trainableWeights.length>0)throw new Z("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var a=[];try{for(var i=fe(this.layers),o=i.next();!o.done;o=i.next()){var s=o.value;a=a.concat(s.trainableWeights)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){var t,n,a,i,o=[];try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){var c=u.value;o.push.apply(o,Je([],te(c.nonTrainableWeights),!1))}}catch(p){t={error:p}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}if(!this.trainable){var l=[];try{for(var f=fe(this.layers),h=f.next();!h.done;h=f.next()){var c=h.value;l.push.apply(l,Je([],te(c.trainableWeights),!1))}}catch(p){a={error:p}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}return l.concat(o)}return o},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!1,configurable:!0}),e.prototype.loadWeights=function(t,n){var a,i,o,s;n===void 0&&(n=!0);var u={},c=0;try{for(var l=fe(this.layers),f=l.next();!f.done;f=l.next()){var h=f.value;try{for(var p=(o=void 0,fe(h.weights)),d=p.next();!d.done;d=p.next()){var m=d.value;if(u[m.originalName]!=null)throw new Z("Duplicate weight name: ".concat(m.originalName));u[m.originalName]=m,c++}}catch(S){o={error:S}}finally{try{d&&!d.done&&(s=p.return)&&s.call(p)}finally{if(o)throw o.error}}}}catch(S){a={error:S}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}var v=[];for(var g in t){var y=g;if(u[g]==null){var w=g.split("/"),b=w.slice(0,-2).concat([w[w.length-1]]);y=b.join("/")}if(u[y]!=null)v.push([u[y],t[g]]);else if(n)throw new Z("Provided weight data has no target variable: ".concat(g));delete u[y]}if(n){var x=[];for(var g in u)x.push(g);if(x.length>0)throw new Z("".concat(x.length," of ").concat(c," weights are not set: ")+"".concat(x))}cb(v)},e.prototype.updatedConfig=function(){var t=this.getConfig(),n={};return n.className=this.getClassName(),n.config=t,n.kerasVersion="tfjs-layers ".concat($b),n.backend="TensorFlow.js",n},e.prototype.toJSON=function(t,n){n===void 0&&(n=!0);var a=Y0(this.updatedConfig());return n?JSON.stringify(a):a},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){t=Zt(t);for(var i=new fc,o=0;o<a.inputs.length;++o)i.add(a.inputs[o],t[o]);return wf(a.outputs,i,n)})},e.prototype.computeMask=function(t,n){var a=this;return F.tidy(function(){t=Zt(t);var i;return n==null?i=$s(null,t.length):i=Zt(n),a.runInternalGraph(t,i)[1]})},e.prototype.computeOutputShape=function(t){var n,a,i,o,s=Id(t);if(s.length!==this.inputLayers.length)throw new Z("Invalid inputShape argument ".concat(t,": ")+"model has ".concat(this.inputLayers.length," tensor inputs."));for(var u={},c=0;c<s.length;c++){var l=this.inputLayers[c],f=s[c],h=l.name+"_0_0";u[h]=f}var p=Object.keys(this.nodesByDepth).map(function(W){return parseInt(W,10)}).sort(yd);if(p.length>1)try{for(var d=fe(p),m=d.next();!m.done;m=d.next()){var v=m.value,g=this.nodesByDepth[v];try{for(var y=(i=void 0,fe(g)),w=y.next();!w.done;w=y.next()){var b=w.value,l=b.outboundLayer;if(this.inputLayers.map(function(X){return X.id}).indexOf(l.id)===-1){for(var x=[],S=0;S<b.inboundLayers.length;S++){var T=b.inboundLayers[S],E=b.nodeIndices[S],C=b.tensorIndices[S],h="".concat(T.name,"_").concat(E,"_").concat(C),R=u[h];x.push(R)}for(var _=l.computeOutputShape(Dn(x)),O=Id(_),$=l.inboundNodes.indexOf(b),S=0;S<O.length;S++){var h="".concat(l.name,"_").concat($,"_").concat(S);u[h]=O[S]}}}}catch(W){i={error:W}}finally{try{w&&!w.done&&(o=y.return)&&o.call(y)}finally{if(i)throw i.error}}}}catch(W){n={error:W}}finally{try{m&&!m.done&&(a=d.return)&&a.call(d)}finally{if(n)throw n.error}}for(var z=[],L=[],c=0;c<this.outputLayers.length;c++){var l=this.outputLayers[c],$=this.outputLayersNodeIndices[c],C=this.outputLayersTensorIndices[c],h="".concat(l.name,"_").concat($,"_").concat(C);L.push(h)}for(var c=0;c<L.length;c++){var B=L[c];Fi(B in u),z.push(u[B])}return Dn(z)},e.prototype.runInternalGraph=function(t,n){var a,i,o,s,u,c,l,f;n==null&&(n=$s(null,t.length));for(var h={},p=0;p<this.inputs.length;++p){var d=this.inputs[p],m=t[p],v=n[p];h[d.id]=[m,v]}var g=Object.keys(this.nodesByDepth).map(function(xe){return parseInt(xe,10)}).sort(yd);try{for(var y=fe(g),w=y.next();!w.done;w=y.next()){var b=w.value,x=this.nodesByDepth[b];try{for(var S=(o=void 0,fe(x)),T=S.next();!T.done;T=S.next()){var E=T.value,C=E.outboundLayer,R=E.inputTensors,_=E.outputTensors,O=new Array;try{for(var $=(u=void 0,fe(R)),z=$.next();!z.done;z=$.next()){var d=z.value;d.id in h&&O.push(h[d.id])}}catch(xe){u={error:xe}}finally{try{z&&!z.done&&(c=$.return)&&c.call($)}finally{if(u)throw u.error}}if(O.length===R.length){var L={},B=void 0,W=void 0,X=void 0,J=void 0;if(E.callArgs!=null&&(L=E.callArgs),O.length===1){var V=te(O[0],2),j=V[0],ne=V[1];L.mask==null&&(L.mask=ne),X=Zt(C.call(j,L)),J=Zt(C.computeMask(j,ne)),B=[j],W=[ne]}else B=O.map(function(xe){return xe[0]}),W=O.map(function(xe){return xe[1]}),L.mask==null&&(L.mask=W),X=Zt(C.call(B,L)),J=Zt(C.computeMask(B,W));if(C.activityRegularizer)throw new vt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var p=0;p<_.length;++p){var d=_[p],m=X[p],v=J[p];h[d.id]=[m,v]}}}}catch(xe){o={error:xe}}finally{try{T&&!T.done&&(s=S.return)&&s.call(S)}finally{if(o)throw o.error}}}}catch(xe){a={error:xe}}finally{try{w&&!w.done&&(i=y.return)&&i.call(y)}finally{if(a)throw a.error}}var re=[],oe=[],le=[];try{for(var de=fe(this.outputs),ke=de.next();!ke.done;ke=de.next()){var d=ke.value;Fi(d.id in h,"Could not compute output ".concat(d.name," : ").concat(d.id));var he=te(h[d.id],2),ye=he[0],v=he[1];le.push(ye.shape),re.push(ye),oe.push(v)}}catch(xe){l={error:xe}}finally{try{ke&&!ke.done&&(f=de.return)&&f.call(de)}finally{if(l)throw l.error}}return[re,oe,le]},e.prototype.buildNodeConversionMap=function(t){var n,a,i={},o;try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){var c=u.value;o=c instanceof e?1:0;for(var l=0;l<c.inboundNodes.length;l++){var f=e.nodeKey(c,l);this.containerNodes.has(f)&&(i[f]=o,o+=1)}}}catch(h){n={error:h}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}return i},e.prototype.getLayer=function(t,n){var a,i;if(n!=null){if(this.layers.length<=n)throw new Z("Was asked to retrieve layer at index ".concat(n,", but model only ")+"has ".concat(this.layers.length," layer(s)."));return this.layers[n]}else if(t==null)throw new Z("Provide either a layer name or layer index");try{for(var o=fe(this.layers),s=o.next();!s.done;s=o.next()){var u=s.value;if(u.name===t)return u}}catch(c){a={error:c}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(a)throw a.error}}throw new Z("No such layer: ".concat(t))},e.prototype.calculateLosses=function(){var t=this;return F.tidy(function(){var n,a,i=[];try{for(var o=fe(t.layers),s=o.next();!s.done;s=o.next())for(var u=s.value,c=0;c<u.inboundNodes.length;++c){var l=e.nodeKey(u,c);t.containerNodes.has(l)&&i.push.apply(i,Je([],te(u.calculateLosses()),!1))}}catch(f){n={error:f}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}return i})},e.prototype.getConfig=function(){var t,n,a={name:this.name},i=this.buildNodeConversionMap(this.layers),o=[];try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){for(var c=u.value,l=c.getClassName(),f=c.getConfig(),h=[],p=0;p<c.inboundNodes.length;p++){var d=c.inboundNodes[p],m=e.nodeKey(c,p),v={};if(this.containerNodes.has(m)){if(d.callArgs)try{JSON.stringify(d.callArgs),v=d.callArgs}catch{console.warn("Layer ".concat(c.name," was passed ")+"non-serializable keyword arguments: "+"".concat(d.callArgs,". They will not be included ")+"in the serialized model (and thus will be missing at deserialization time)."),v={}}if(d.inboundLayers.length>0){for(var g=[],y=0;y<d.inboundLayers.length;y++){var w=d.inboundLayers[y],b=d.nodeIndices[y],x=d.tensorIndices[y],S=e.nodeKey(w,b),T=i[S];T==null&&(T=0),g.push([w.name,T,x,v])}h.push(g)}}}var E={};E.name=c.name,E.className=l,E.config=f,E.inboundNodes=h,o.push(E)}}catch(_){t={error:_}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}a.layers=o;for(var C=[],y=0;y<this.inputLayers.length;y++){var c=this.inputLayers[y],b=this.inputLayersNodeIndices[y],m=e.nodeKey(c,b);if(!!this.containerNodes.has(m)){var T=i[m];T==null&&(T=0);var x=this.inputLayersTensorIndices[y];C.push([c.name,T,x])}}a.inputLayers=C;for(var R=[],y=0;y<this.outputLayers.length;y++){var c=this.outputLayers[y],b=this.outputLayersNodeIndices[y],m=e.nodeKey(c,b);if(!!this.containerNodes.has(m)){var T=i[m];T==null&&(T=0);var x=this.outputLayersTensorIndices[y];R.push([c.name,T,x])}}return a.outputLayers=R,a},e.fromConfig=function(t,n,a,i){var o,s,u,c,l,f,h,p,d,m;i===void 0&&(i=!1);var v={},g={};function y(ye,xe){ye.name in g?g[ye.name].push(xe):g[ye.name]=[xe]}function w(ye,xe){var De,Ye,ht=[],at;try{for(var nt=fe(xe),ft=nt.next();!ft.done;ft=nt.next()){var st=ft.value,Ze=st[0],tt=st[1],et=st[2];if(at=st[3]==null?{}:st[3],!(Ze in v)){y(ye,xe);return}var nr=v[Ze];if(nr.inboundNodes.length<=tt){y(ye,xe);return}var He=nr.inboundNodes[tt];ht.push(He.outputTensors[et])}}catch(kt){De={error:kt}}finally{try{ft&&!ft.done&&(Ye=nt.return)&&Ye.call(nt)}finally{if(De)throw De.error}}ht.length>0&&ye.apply(Dn(ht),at)}function b(ye){var xe=ye.name,De=hi(ye,n.customObjects!=null?n.customObjects:{});De.setFastWeightInitDuringBuild(i),v[xe]=De;var Ye=ye.inboundNodes;Ye.forEach(function(ht){if(!(ht instanceof Array))throw new Z("Corrupted configuration, expected array for nodeData: ".concat(ht));y(De,ht)})}var x=n.name,S=n.layers;try{for(var T=fe(S),E=T.next();!E.done;E=T.next()){var C=E.value;b(C)}}catch(ye){o={error:ye}}finally{try{E&&!E.done&&(s=T.return)&&s.call(T)}finally{if(o)throw o.error}}for(;!Ghe(g);)try{for(var R=(u=void 0,fe(S)),_=R.next();!_.done;_=R.next()){var C=_.value,O=v[C.name];if(O.name in g){var $=g[O.name];delete g[O.name];try{for(var z=(l=void 0,fe($)),L=z.next();!L.done;L=z.next()){var B=L.value;w(O,B)}}catch(xe){l={error:xe}}finally{try{L&&!L.done&&(f=z.return)&&f.call(z)}finally{if(l)throw l.error}}}}}catch(ye){u={error:ye}}finally{try{_&&!_.done&&(c=R.return)&&c.call(R)}finally{if(u)throw u.error}}var W=[],X=[],J=n.inputLayers;try{for(var V=fe(J),j=V.next();!j.done;j=V.next()){var C=j.value,ne=C[0],re=C[1],oe=C[2];Fi(ne in v);var O=v[ne],le=O.inboundNodes[re].outputTensors;W.push(le[oe])}}catch(ye){h={error:ye}}finally{try{j&&!j.done&&(p=V.return)&&p.call(V)}finally{if(h)throw h.error}}var de=n.outputLayers;try{for(var ke=fe(de),he=ke.next();!he.done;he=ke.next()){var C=he.value,ne=C[0],re=C[1],oe=C[2];Fi(ne in v);var O=v[ne],le=O.inboundNodes[re].outputTensors;X.push(le[oe])}}catch(ye){d={error:ye}}finally{try{he&&!he.done&&(m=ke.return)&&m.call(ke)}finally{if(d)throw d.error}}return new t({inputs:W,outputs:X,name:x})},Object.defineProperty(e.prototype,"stateful",{get:function(){var t,n;if(this._stateful)throw new Z("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");try{for(var a=fe(this.layers),i=a.next();!i.done;i=a.next()){var o=i.value;if(o.stateful)return!0}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return!1},enumerable:!1,configurable:!0}),e.prototype.resetStates=function(){var t=this;F.tidy(function(){t.layers.forEach(function(n){n.stateful&&n.resetStates()})})},e}(mt);function Rwe(r,e,t){var n=e.length;if(r==null||Array.isArray(r)&&r.length===0)return e.map(function(i){return null});if(n===1)return Array.isArray(r)&&r.length===1?r:typeof r=="object"&&e[0]in r?[r[e[0]]]:[r];if(Array.isArray(r)){if(r.length!==n)throw new Error("Provided ".concat(t," is an array of ").concat(r.length," ")+"element(s), but the model has ".concat(n," outputs. ")+"Make sure a set of weights is provided for each model output.");return r}else if(typeof r=="object"&&Object.keys(r).length>0&&typeof r[Object.keys(r)[0]]=="object"){var a=[];return e.forEach(function(i){i in r?a.push(r[i]):a.push(null)}),a}else throw new Error("The model has multiple (".concat(n,") outputs, ")+"so ".concat(t," must be either an array with ")+"".concat(n," elements or an object with ").concat(e," keys. ")+"Provided ".concat(t," not understood: ").concat(JSON.stringify(r)))}function p4(r,e){return Rwe(r,e,"classWeight")}function d4(r,e,t,n){return Ce(this,void 0,void 0,function(){var a,i,o,s,u;return Ie(this,function(c){switch(c.label){case 0:if(e!=null||n!=null)throw new Error("Support sampleWeight is not implemented yet");return t==null?[3,2]:(a=F.tidy(function(){if(r.shape.length===1)return F.clone(r);if(r.shape.length===2)if(r.shape[1]>1){var l=1;return F.argMax(r,l)}else{if(r.shape[1]===1)return F.reshape(r,[r.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(r.shape[1],") ")+"during handling of class weights. The size is expected to be >= 1.")}else throw new Error("Unexpected rank of target (y) tensor (".concat(r.rank,") during ")+"handling of class weights. The rank is expected to be 1 or 2.")}),s=(o=Array).from,[4,a.data()]);case 1:return i=s.apply(o,[c.sent()]),F.dispose(a),u=[],i.forEach(function(l){if(t[l]==null)throw new Error("classWeight must contain all classes in the training data. "+"The class ".concat(l," exists in the data but not in ")+"classWeight");u.push(t[l])}),[2,F.tensor1d(u,"float32")];case 2:return[2,null]}})})}function Owe(r,e){return F.mul(r,e)}var Pwe=32;function v4(r,e){var t,n,a=e;t=a.xs,n=a.ys,D.util.assert(t!=null&&n!=null,function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+"".concat(e)});var i=aP("input",r.inputNames,t),o=aP("output",r.outputNames,n),s=i[0].shape[0];D.util.assert(i.length===r.inputs.length,function(){return"LayersModel has ".concat(r.inputs.length," inputs, but the dataset ")+"provides ".concat(i.length," inputs.  (Expected input keys: ")+"".concat(JSON.stringify(r.inputNames),")")}),D.util.assert(o.length===r.outputs.length,function(){return"LayersModel has ".concat(r.outputs.length," outputs, but the dataset ")+"provides ".concat(o.length," outputs.  (Expected output keys: ")+"".concat(JSON.stringify(r.outputNames),")")});for(var u=function(h){D.util.assert(i[h].shape[0]===s,function(){return"Batch size mismatch: input "+"".concat(r.inputNames[h]," has ").concat(i[h].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(r.inputNames[0],".")})},c=0;c<i.length;c++)u(c);for(var l=function(h){D.util.assert(o[h].shape[0]===s,function(){return"Batch size mismatch: output "+"".concat(r.outputNames[h]," has ").concat(o[h].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(r.inputNames[0],".")})},f=0;f<o.length;f++)l(f);return{xs:i,ys:o}}function aP(r,e,t){var n,a;if(t instanceof D.Tensor)return[t];if(Array.isArray(t))return D.util.assert(t.length===e.length,function(){return"Received an array of ".concat(t.length," Tensors, but expected ").concat(e.length," to match the ").concat(r," keys ").concat(e,".")}),t;var i=[];try{for(var o=fe(e),s=o.next();!s.done;s=o.next()){var u=s.value;if(t[u]==null)throw new Z("The feature data generated by the dataset lacks the required "+"".concat(r," key '").concat(u,"'."));i.push(t[u])}}catch(c){n={error:c}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}return i}function Mwe(r){if(r.length===3)throw new vt("Validation with sample weights is not implemented yet.");return{xs:r[0],ys:r[1]}}function Bwe(r,e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S,T,E,C,R,_,V,O,$,z,L,V,B,W,X,J,V;return Ie(this,function(j){switch(j.label){case 0:if(n=t.batchesPerEpoch!=null,D.util.assert(r.optimizer!=null,function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."}),D.util.assert(t!=null,function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."}),D.util.assert(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),function(){return"For fitDataset(), config.epochs is expected to be a positive "+"integer, but got ".concat(t.epochs)}),D.util.assert(!n||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a "+"positive integer if specified, but got ".concat(t.batchesPerEpoch)}),D.util.assert(t.validationSplit==null,function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."}),r.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");r.isTraining=!0,j.label=1;case 1:return j.trys.push([1,,26,27]),a=t.validationData!=null,i=void 0,o=void 0,a&&(iP(t.validationData)?D.util.assert(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, "+"but got ".concat(t.validationBatches)}):(s=Mwe(t.validationData),i=s.xs,o=s.ys)),u=r.makeTrainFunction(),c=r.getDedupedMetricsNames(),l=void 0,a?l=c.slice().concat(c.map(function(ne){return"val_"+ne})):l=c.slice(),f=i4(t.callbacks,t.yieldEvery),h=t.verbose==null?1:t.verbose,p=o4(f,h,t.epochs,null,null,Lwe(e,t),null,a,l),d=p.callbackList,m=p.history,d.setModel(r),r.history=m,[4,d.onTrainBegin()];case 2:return j.sent(),r.stopTraining_=!1,v=t.initialEpoch==null?0:t.initialEpoch,[4,e.iterator()];case 3:g=j.sent(),j.label=4;case 4:return v<t.epochs?(y={},[4,d.onEpochBegin(v)]):[3,23];case 5:return j.sent(),w=0,b=0,n?[3,7]:[4,e.iterator()];case 6:g=j.sent(),j.label=7;case 7:return!n||w<t.batchesPerEpoch?[4,g.next()]:[3,21];case 8:return x=j.sent(),n&&x.done?(console.warn("You provided `batchesPerEpoch` as "+"".concat(t.batchesPerEpoch,", ")+"but your dataset iterator ran out of data after "+"".concat(w," batches; ")+"interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+"".concat(t.batchesPerEpoch*t.epochs," batches). ")+"You may need to use the repeat() function when building your dataset."),[3,21]):x.value==null?[3,15]:(S=v4(r,x.value),T=S.xs,E=S.ys,C={},C.batch=b,C.size=T[0].shape[0],[4,d.onBatchBegin(b,C)]);case 9:if(j.sent(),R=[],t.classWeight==null)return[3,13];_=p4(t.classWeight,r.outputNames),V=0,j.label=10;case 10:return V<_.length?($=(O=R).push,[4,d4(E[V],null,_[V])]):[3,13];case 11:$.apply(O,[j.sent()]),j.label=12;case 12:return++V,[3,10];case 13:for(z=T.concat(E).concat(R),L=u(z),D.dispose(z),V=0;V<c.length;++V)B=c[V],W=L[V],C[B]=W,D.keep(W);return[4,d.onBatchEnd(b,C)];case 14:j.sent(),t4(C),b++,w++,j.label=15;case 15:return(n?w>=t.batchesPerEpoch:x.done)?a?(X=void 0,iP(t.validationData)?(J=Zt,[4,r.evaluateDataset(t.validationData,{batches:t.validationBatches})]):[3,17]):[3,19]:[3,20];case 16:return X=J.apply(void 0,[j.sent()]),[3,18];case 17:X=Zt(r.evaluate(i,o,{batchSize:t.validationBatchSize==null?Pwe:t.validationBatchSize,verbose:0})),j.label=18;case 18:for(V=0;V<r.metricsNames.length;++V)y["val_".concat(r.metricsNames[V])]=X[V];j.label=19;case 19:return[3,21];case 20:return r.stopTraining_?[3,21]:[3,7];case 21:return[4,d.onEpochEnd(v,y)];case 22:return j.sent(),v++,r.stopTraining_?[3,23]:[3,4];case 23:return[4,d.onTrainEnd()];case 24:return j.sent(),[4,r.history.syncData()];case 25:return j.sent(),[2,r.history];case 26:return r.isTraining=!1,[7];case 27:return[2]}})})}function Lwe(r,e){var t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(r.size)&&(t=r.size),t}function iP(r){return typeof r.iterator=="function"}function zwe(r){return typeof r.next=="function"}function $we(r,e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p;return Ie(this,function(d){switch(d.label){case 0:if(t=t||{},n=t.batches!=null,a=r.testFunction,i=[],t.verbose>0)throw new vt("Verbose mode is not implemented yet.");return D.util.assert(!n||t.batches>0&&Number.isInteger(t.batches),function(){return"Test loop expects `batches` to be a positive integer, but "+"received ".concat(JSON.stringify(t.batches))}),zwe(e)?(s=e,[3,3]):[3,1];case 1:return[4,e.iterator()];case 2:s=d.sent(),d.label=3;case 3:o=s,u=0,c=0,l=function(){var m;return Ie(this,function(v){switch(v.label){case 0:return[4,o.next()];case 1:return m=v.sent(),i=D.tidy(function(){if(m.value){var g=v4(r,m.value),y=g.xs,w=g.ys,b=y.concat(w),x=D.tidy(function(){return a(b)});if(D.dispose(b),c===0)for(var S=0;S<x.length;++S)i.push(F.scalar(0));for(var T=b[0].shape[0],E=function(C){var R=x[C],_=i[C];i[C]=D.tidy(function(){return D.add(i[C],D.mul(T,R))}),c>0&&D.dispose(_)},S=0;S<x.length;++S)E(S);D.dispose(x),u+=T,++c}return i}),m.done?(n&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` "+"batches (in this case, ".concat(t.batches," batches). ")+"You may need to use the repeat() function when building your dataset."),[2,"break"]):[2]}})},d.label=4;case 4:return!n||c<t.batches?[5,l()]:[3,6];case 5:return f=d.sent(),f==="break"?[3,6]:[3,4];case 6:for(h=0;h<i.length;++h)p=i[h],i[h]=D.div(i[h],u),D.dispose(p);return[2,Dn(i)]}})})}function F0(r){D.util.assert(r>0&&Number.isInteger(r),function(){return"batchSize is required to be a positive integer, but got ".concat(r)})}function yf(r,e,t){return r==null?[null]:Array.isArray(r)?r.map(function(n){return zs(n,e,t-e)}):zs(r,e,t-e)}function Z0(r,e){return D.tidy(function(){return r==null?null:Array.isArray(r)?r.map(function(t){return Z0(t,e)}):SP(r,e.dtype==="int32"?e:D.cast(e,"int32"))})}function R0(r,e){for(var t=[],n=0,a=null;n<r;)a=n+e,a>=r&&(a=r),t.push([n,a]),n=a;return t}function m4(r){var e=[];r instanceof F.Tensor&&(r=[r]);for(var t=0;t<r.length;++t){var n=r[t];if(n.rank===1)e.push(_f(n,1));else{if(n.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(n)}}return e}function ci(r,e){if(r!=null){var t=[];if(e instanceof F.Tensor)t.push(e.id);else if(Array.isArray(e))e.forEach(function(s){return t.push(s.id)});else if(e!=null)for(var n in e){var a=e[n];t.push(a.id)}var i=[];if(r instanceof F.Tensor)t.indexOf(r.id)===-1&&i.push(r);else if(Array.isArray(r))r.forEach(function(s){t.indexOf(s.id)===-1&&i.push(s)});else if(r!=null)for(var n in r){var o=r[n];t.indexOf(o.id)===-1&&i.push(o)}i.forEach(function(s){s.isDisposed||s.dispose()})}}function qwe(r){return r instanceof F.Tensor}function J0(r){return Array.isArray(r)}function oP(r){return!qwe(r)&&!J0(r)}function sP(r,e,t,n,a){var i,o;if(n===void 0&&(n=!0),a===void 0&&(a=""),e==null||e.length===0){if(r!=null){var s=!1;if(J0(r)&&r.length>0)s=!0;else if(oP(r)){for(var u in r)if(r.hasOwnProperty(u)){s=!0;break}}else s=!0;if(s)throw new Z("Error when checking model ".concat(a," expected no data, ")+"but got ".concat(r))}return[]}if(r==null)return e.map(function(y){return null});var c;if(oP(r)){r=r,c=[];try{for(var l=fe(e),f=l.next();!f.done;f=l.next()){var h=f.value;if(r[h]==null)throw new Z('No data provided for "'.concat(h,'". Need data for each key in: ')+"".concat(e));c.push(r[h])}}catch(y){i={error:y}}finally{try{f&&!f.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}}else if(J0(r)){if(r=r,r.length!==e.length)throw new Z("Error when checking model ".concat(a,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"model expected. Expected to see ".concat(e.length," Tensor(s), but ")+"instead got the following list of Tensor(s): ".concat(r));c=r}else{if(r=r,e.length>1)throw new Z("The model ".concat(a," expects ").concat(e.length," Tensor(s), ")+"but only received one Tensor. Found: Tensor with shape ".concat(r.shape));c=[r]}if(c=m4(c),t!=null){for(var p=0;p<e.length;++p)if(t[p]!=null){var d=c[p];if(d.shape.length!==t[p].length)throw new Z("Error when checking ".concat(a,": expected ").concat(e[p]," ")+"to have ".concat(t[p].length," dimension(s). but got array with ")+"shape ".concat(d.shape));for(var m=0;m<t[p].length;++m)if(!(m===0&&!n)){var v=d.shape[m],g=t[p][m];if(g!=null&&g>=0&&v!==g)throw new Z("".concat(a," expected a batch of elements where each ")+"example has shape [".concat(t[p].slice(1,t[p].length),"] ")+"(i.e.,tensor shape [*,".concat(t[p].slice(1,t[p].length),"])")+" but the ".concat(a," received an input with ").concat(d.shape[0])+" examples, each with shape [".concat(d.shape.slice(1,d.shape.length),"]")+" (tensor shape [".concat(d.shape,"])"))}}}return c}function Wwe(r,e,t){var n=Go(r.map(function(i){return i.shape[0]}));n.sort();var a=Go(e.map(function(i){return i.shape[0]}));if(a.sort(),n.length>1)throw new Z("All input Tensors (x) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(r.map(function(i){return i.shape}))));if(a.length>1)throw new Z("All target Tensors (y) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(e.map(function(i){return i.shape}))));if(n.length>0&&a.length>0&&!F.util.arraysEqual(n,a))throw new Z("Input Tensors should have the same number of samples as target "+"Tensors. Found ".concat(n[0]," input sample(s) and ").concat(a[0]," target ")+"sample(s).")}function Vwe(r,e,t){for(var n=[Xs,sv,If],a=0;a<r.length;++a){var i=r[a],o=e[a],s=t[a];if(o!=null){if(o===If&&i.shape[i.shape.length-1]===1)throw new Z("You are passing a target array of shape ".concat(i.shape," while using ")+"a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(n.indexOf(o)!==-1)for(var u=i.shape.slice(1),c=s.slice(1),l=0;l<u.length;++l){var f=u[l],h=c[l];if(h!=null&&f!==h)throw new Z("A target Tensor with shape ".concat(i.shape," was passed for an ")+"output of shape ".concat(s,", while using a loss function that ")+"expects targets to have the same shape as the output.")}}}}function uP(r,e,t,n,a){n===void 0&&(n=!0),a===void 0&&(a="");var i;if(Array.isArray(r)){if(r.length!==e.length)throw new Z("Error when checking model ".concat(a,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"the model expected. Expected to see ".concat(e.length," Tensor(s),")+" but instead got ".concat(r.length," Tensors(s)."));i=r}else{if(e.length>1)throw new Z("The model expects ".concat(e.length," ").concat(a," Tensors, ")+"but only received one Tensor. Found: array with shape "+"".concat(JSON.stringify(r.shape),"."));i=[r]}if(t!=null){for(var o=0;o<e.length;++o)if(t[o]!=null){var s=i[o];if(s.shape.length!==t[o].length)throw new Z("Error when checking ".concat(a,": expected ").concat(e[o]," ")+"to have ".concat(t[o].length," dimension(s), but got array with ")+"shape ".concat(JSON.stringify(s.shape)));for(var u=0;u<t[o].length;++u)if(!(u===0&&!n)){var c=s.shape[u],l=t[o][u];if(l!=null&&l!==c)throw new Z("Error when checking ".concat(a,": expected ")+"".concat(e[o]," to have shape ").concat(JSON.stringify(t[o])," but ")+"got array with shape ".concat(JSON.stringify(s.shape),"."))}}}}function Uwe(r,e){var t,n;if(r==null||Array.isArray(r)&&r.length===0)return e.map(function(l){return[]});var a;if(typeof r=="string"||typeof r=="function")a=[r];else if(Array.isArray(r)||typeof r=="object")a=r;else throw new TypeError("Type of metrics argument not understood. Expected an string,"+"function, Array, or Object, found: ".concat(r));if(Array.isArray(a))return e.map(function(l){return a});var i=[];try{for(var o=fe(e),s=o.next();!s.done;s=o.next()){var u=s.value,c=a.hasOwnProperty(u)?a[u]:[];Array.isArray(c)||(c=[c]),i.push(c)}}catch(l){t={error:l}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i}var Gwe="layers-model",io=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return n.isTraining=!1,n}return e.prototype.summary=function(t,n,a){if(a===void 0&&(a=console.log),!this.built)throw new Z("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Iwe(this,t,n,a)},e.prototype.compile=function(t){var n,a,i=this;if(t.loss==null&&(t.loss=[]),this.loss=t.loss,typeof t.optimizer=="string")this.optimizer_=Ewe(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof F.Optimizer))throw new Z("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}var o=[];if(!Array.isArray(t.loss)&&typeof t.loss!="string"&&typeof t.loss!="function"){t.loss=t.loss;for(var s in t.loss)if(this.outputNames.indexOf(s)===-1)throw new Z('Unknown entry in loss dictionary: "'.concat(s,'". ')+"Only expected the following keys: ".concat(this.outputNames));try{for(var u=fe(this.outputNames),c=u.next();!c.done;c=u.next()){var s=c.value;t.loss[s]==null&&console.warn('Output "'.concat(s,'" is missing from loss dictionary. We assume ')+"this was done on purpose, and we will not be expecting data "+"to be passed to ".concat(s," during training")),o.push(_0(t.loss[s]))}}catch(g){n={error:g}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}}else if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new Z("When passing an Array as loss, it should have one entry per "+"model output. The model has ".concat(this.outputs.length," output(s), ")+"but you passed loss=".concat(t.loss,"."));var l=t.loss;o=l.map(function(g){return _0(g)})}else{var f=_0(t.loss);this.outputs.forEach(function(g){o.push(f)})}this.lossFunctions=o,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var h=0;h<this.outputs.length;++h){var p=this.internalOutputShapes[h],s=this.outputNames[h];this.feedOutputNames.push(s),this.feedOutputShapes.push(p),this.feedLossFns.push(this.lossFunctions[h])}var d=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Ls("loss",function(){for(var g=0;g<i.outputs.length;++g)if(d.indexOf(g)===-1){var y=i.lossFunctions[g];i.outputs.length>1&&(i.metricsTensors.push([y,g]),i.metricsNames.push(i.outputNames[g]+"_loss"))}});var m=Uwe(t.metrics,this.outputNames),v=function(g,y,w){i.outputNames.length>1&&(y=i.outputNames[g]+"_"+y),i.metricsNames.push(y),i.metricsTensors.push([w,g])};Ls("metric",function(){for(var g=function(w){if(d.indexOf(w)!==-1)return"continue";var b=m[w],x=function(S){var T,E,C="",R,_,O,$=function(W){if(typeof W=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(W)!==-1){var X=i.internalOutputShapes[w];X[X.length-1]===1||i.lossFunctions[w]===sv?["accuracy","acc"].indexOf(W)!==-1?_=Bb:["crossentropy","ce"].indexOf(W)!==-1&&(_=c4):i.lossFunctions[w]===qd?["accuracy","acc"].indexOf(W)!==-1?_=l4:["crossentropy","ce"].indexOf(W)!==-1&&(_=f4):["accuracy","acc"].indexOf(W)!==-1?_=Lb:["crossentropy","ce"].indexOf(W)!==-1&&(_=zb);var J=void 0;["accuracy","acc"].indexOf(W)!==-1?J="acc":["crossentropy","ce"].indexOf(W)!==-1&&(J="ce"),O=_,R=C+J}else{var V=Twe(W);O=V,R=C+xd(W)}var j;Ls(R,function(){j=O}),v(w,R,j)};try{for(var z=(T=void 0,fe(S)),L=z.next();!L.done;L=z.next()){var B=L.value;$(B)}}catch(W){T={error:W}}finally{try{L&&!L.done&&(E=z.return)&&E.call(z)}finally{if(T)throw T.error}}};x(b)},y=0;y<i.outputs.length;++y)g(y)}),this.collectedTrainableWeights=this.trainableWeights},e.prototype.checkTrainableWeightsConsistency=function(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},e.prototype.evaluate=function(t,n,a){a===void 0&&(a={});var i=a.batchSize==null?32:a.batchSize;F0(i);var o=!0,s=this.standardizeUserDataXY(t,n,o,i);try{var u=s[0].concat(s[1]);this.makeTestFunction();var c=this.testFunction,l=this.testLoop(c,u,i,a.verbose,a.steps);return Dn(l)}finally{ci(s[0],t),ci(s[1],n)}},e.prototype.evaluateDataset=function(t,n){return Ce(this,void 0,void 0,function(){return Ie(this,function(a){return this.makeTestFunction(),[2,$we(this,t,n)]})})},e.prototype.checkNumSamples=function(t,n,a,i){i===void 0&&(i="steps");var o;if(a!=null){if(o=null,n!=null)throw new Z("If ".concat(i," is set, batchSize must be null or undefined.")+"Got batchSize = ".concat(n))}else if(t!=null)Array.isArray(t)?o=t[0].shape[0]:o=t.shape[0];else throw new Z("Either the input data should have a defined shape, or "+"".concat(i," shoud be specified."));return o},e.prototype.execute=function(t,n){var a,i;if(Array.isArray(n)&&n.length===0)throw new Z("`outputs` is an empty Array, which is not allowed.");var o=Array.isArray(n),s=o?n:[n],u=this.retrieveSymbolicTensors(s),c=new fc;if(t instanceof F.Tensor&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new Z("The number of inputs provided (".concat(t.length,") ")+"does not match the number of inputs of this model "+"(".concat(this.inputs.length,")."));for(var l=0;l<this.inputs.length;++l)c.add(this.inputs[l],t[l])}else try{for(var f=fe(this.inputs),h=f.next();!h.done;h=f.next()){var p=h.value,d=t[p.name];if(d==null)throw new Z("No value is provided for the model's input ".concat(p.name));c.add(p,d)}}catch(v){a={error:v}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}var m=wf(u,c);return o?m:m[0]},e.prototype.retrieveSymbolicTensors=function(t){var n,a,i=$s(null,t.length),o=t.length;try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){for(var c=u.value,l=Array.isArray(c.output)?c.output:[c.output],f=l.map(function(m){return m.name}),h=0;h<t.length;++h){var p=f.indexOf(t[h]);if(p!==-1&&(i[h]=l[p],o--),o===0)break}if(o===0)break}}catch(m){n={error:m}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}if(o>0){var d=[];throw i.forEach(function(m,v){m==null&&d.push(t[v])}),new Z("Cannot find SymbolicTensors for output name(s): "+"".concat(JSON.stringify(d)))}return i},e.prototype.predictLoop=function(t,n,a){var i=this;return n===void 0&&(n=32),a===void 0&&(a=!1),D.tidy(function(){var o=i.checkNumSamples(t);if(a)throw new vt("Verbose predictLoop() is not implemented yet.");for(var s=R0(o,n),u=i.outputs.map(function(f){return[]}),c=function(f){var h=D.tidy(function(){var p=s[f][0],d=s[f][1],m=yf(t,p,d),v=[];if(Array.isArray(m))for(var g=0;g<m.length;++g)v.push({key:i.inputs[g],value:m[g]});else v.push({key:i.inputs[0],value:m});var y=new fc(v);return wf(i.outputs,y)});h.forEach(function(p,d){return u[d].push(p)})},l=0;l<s.length;++l)c(l);return Dn(u.map(function(f){return D.concat(f,0)}))})},e.prototype.predict=function(t,n){n===void 0&&(n={});var a=m4(t);uP(a,this.inputNames,this.feedInputShapes,!1);try{var i=n.batchSize==null?32:n.batchSize;return F0(i),this.predictLoop(a,i)}finally{ci(a,t)}},e.prototype.predictOnBatch=function(t){uP(t,this.inputNames,this.feedInputShapes,!0);var n=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,n)},e.prototype.standardizeUserDataXY=function(t,n,a,i){if(this.optimizer_==null)throw new Oi("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var o=[],s=0;s<this.feedOutputShapes.length;++s){var u=this.feedOutputShapes[s],c=this.feedLossFns[s];c===qd?o.push(u.slice(0,u.length-1).concat([1])):o.push(u)}if(t=sP(t,this.feedInputNames,this.feedInputShapes,!1,"input"),n=sP(n,this.feedOutputNames,o,!1,"target"),Wwe(t,n),Vwe(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&i!=null&&i>0&&t[0].shape[0]%i!==0)throw new Z("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+"".concat(i,". Found: ").concat(t[0].shape[0]," sample(s)."));return[t,n]},e.prototype.standardizeUserData=function(t,n,a,i,o,s){return o===void 0&&(o=!0),Ce(this,void 0,void 0,function(){var u,c,l,f,h,p,d,m;return Ie(this,function(v){switch(v.label){case 0:if(u=te(this.standardizeUserDataXY(t,n,o,s),2),c=u[0],l=u[1],a!=null)throw new Error("sample weight is not supported yet.");if(f=null,i==null)return[3,4];h=p4(i,this.outputNames),f=[],p=0,v.label=1;case 1:return p<h.length?(m=(d=f).push,[4,d4(l[p],null,h[p])]):[3,4];case 2:m.apply(d,[v.sent()]),v.label=3;case 3:return++p,[3,1];case 4:return[2,[c,l,f]]}})})},e.prototype.testLoop=function(t,n,a,i,o){var s=this;return i===void 0&&(i=0),D.tidy(function(){var u=s.checkNumSamples(n,a,o,"steps"),c=[];if(i>0)throw new vt("Verbose mode is not implemented yet.");if(o!=null)throw new vt("steps mode in testLoop() is not implemented yet");for(var l=R0(u,a),f=F.tensor1d(di(0,u)),h=0;h<l.length;++h){var p=l[h][0],d=l[h][1],m=zs(f,p,d-p),v=Z0(n,m),g=t(v);if(h===0)for(var y=0;y<g.length;++y)c.push(F.scalar(0));for(var y=0;y<g.length;++y){var w=g[y];c[y]=D.add(c[y],D.mul(d-p,w))}}for(var y=0;y<c.length;++y)c[y]=D.div(c[y],u);return c})},e.prototype.getDedupedMetricsNames=function(){for(var t=this.metricsNames,n=[],a=0;a<t.length;++a){var i=t[a],o=i;if(dO(t,i)>1){var s=dO(t.slice(0,a),i);o+="_".concat(s)}n.push(o)}return n},e.prototype.makeTrainFunction=function(){var t=this;return function(n){var a=[],i=n.slice(0,t.inputs.length),o=n.slice(t.inputs.length,t.inputs.length+t.outputs.length),s=n.slice(t.inputs.length+t.outputs.length,t.inputs.length+t.outputs.length*2),u=[],c=function(){for(var p=[],d=0;d<t.inputs.length;++d)p.push({key:t.inputs[d],value:i[d]});for(var m=new fc(p),v=wf(t.outputs,m,{training:!0}),g,d=0;d<t.lossFunctions.length;++d){var y=t.lossFunctions[d],w=y(o[d],v[d]);s[d]!=null&&(w=Owe(w,s[d]));var b=D.mean(w);a.push(b),d===0?g=w:g=D.add(g,w)}for(var d=0;d<t.metricsTensors.length;++d){var x=void 0;if(t.outputs.length>1&&d<t.outputs.length)x=a[d];else{var S=t.metricsTensors[d][0],T=t.metricsTensors[d][1];x=D.mean(S(o[T],v[T]))}D.keep(x),u.push(x)}return g=D.mean(g),t.calculateLosses().forEach(function(E){g=D.add(g,E)}),g},l=t.collectedTrainableWeights.map(function(p){return p.read()}),f=!0,h=t.optimizer_.minimize(c,f,l);return[h].concat(u)}},e.prototype.makeTestFunction=function(){var t=this;this.testFunction=function(n){return D.tidy(function(){for(var a=[],i,o=n.slice(0,t.inputs.length),s=n.slice(t.inputs.length,t.inputs.length+t.outputs.length),u=[],c=0;c<t.inputs.length;++c)u.push({key:t.inputs[c],value:o[c]});for(var l=new fc(u),f=wf(t.outputs,l),c=0;c<t.lossFunctions.length;++c){var h=t.lossFunctions[c],p=D.mean(h(s[c],f[c]));c===0?i=p:i=D.add(i,p),a.push(i)}for(var c=0;c<t.metricsTensors.length;++c){var d=t.metricsTensors[c][0],m=t.metricsTensors[c][1],v=D.mean(d(s[m],f[m]));a.push(v)}return a})}},e.prototype.fit=function(t,n,a){return a===void 0&&(a={}),Ce(this,void 0,void 0,function(){var i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S,T,E,C,R,_,O,$;return Ie(this,function(z){switch(z.label){case 0:if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0,z.label=1;case 1:return z.trys.push([1,,7,8]),d=a.batchSize==null?32:a.batchSize,F0(d),m=!1,[4,this.standardizeUserData(t,n,a.sampleWeight,a.classWeight,m,d)];case 2:if(v=z.sent(),i=v[0],o=v[1],p=v[2],g=!1,y=void 0,!(a.validationData!=null&&a.validationData.length>0))return[3,4];if(g=!0,a.validationData.length===2)c=a.validationData[0],l=a.validationData[1];else throw a.validationData.length===3?new vt("validationData including sample weights is not supported yet."):new Z("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+"".concat(a.validationData," is invalid."));return w=!0,[4,this.standardizeUserData(c,l,null,null,w,d)];case 3:return b=z.sent(),f=b[0],h=b[1],y=f.concat(h),[3,5];case 4:a.validationSplit!=null&&a.validationSplit>0&&a.validationSplit<1?(g=!0,x=Math.floor(i[0].shape[0]*(1-a.validationSplit)),S=i[0].shape[0],f=yf(i,x,S),s=i,i=yf(i,0,x),h=yf(o,x,S),u=o,o=yf(o,0,x),y=f.concat(h)):a.validationSteps!=null&&(g=!0),z.label=5;case 5:return T=i.concat(o).concat(p),this.checkTrainableWeightsConsistency(),E=this.makeTrainFunction(),C=this.getDedupedMetricsNames(),R=void 0,_=void 0,g?(this.makeTestFunction(),R=this.testFunction,_=C.slice().concat(C.map(function(L){return"val_"+L}))):(R=null,y=[],_=C.slice()),O=i4(a.callbacks,a.yieldEvery),[4,this.fitLoop(E,T,C,d,a.epochs,a.verbose,O,R,y,a.shuffle,_,a.initialEpoch,null,null)];case 6:return $=z.sent(),[2,$];case 7:return this.isTraining=!1,ci(i,t),ci(o,n),ci(s,t),ci(u,n),ci(f,c),ci(h,l),p!=null&&D.dispose(p),[7];case 8:return[2]}})})},e.prototype.fitLoop=function(t,n,a,i,o,s,u,c,l,f,h,p,d,m){return Ce(this,void 0,void 0,function(){var v,g,y,w,b,x,S,T,E,C,R=this;return Ie(this,function(_){switch(_.label){case 0:if(i==null&&(i=32),o==null&&(o=1),f==null&&(f=!0),p==null&&(p=0),v=!1,c!=null&&l!=null&&(v=!0),m!=null&&(v=!0,d==null))throw new Z("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");return g=this.checkNumSamples(n,i,d,"steps_per_epoch"),g!=null&&(y=di(0,g)),s==null&&(s=1),w=o4(u,s,o,p,g,d,i,v,h),b=w.callbackList,x=w.history,b.setModel(this),this.history=x,[4,b.onTrainBegin()];case 1:_.sent(),this.stopTraining_=!1,S=function(O){var $,z,L,B,W,X;return Ie(this,function(J){switch(J.label){case 0:return[4,b.onEpochBegin(O)];case 1:if(J.sent(),$={},d==null)return[3,2];throw new vt("stepsPerEpoch mode is not implemented yet.");case 2:if(f==="batch")throw new vt("batch shuffling is not implemneted yet");f&&F.util.shuffle(y),z=F.tensor1d(y),L=R0(g,i),B=function(V){var j;return Ie(this,function(ne){switch(ne.label){case 0:return j={},[4,b.onBatchBegin(V,j)];case 1:return ne.sent(),D.tidy(function(){var re=L[V][0],oe=L[V][1],le=zs(z,re,oe-re);j.batch=V,j.size=oe-re;for(var de=Z0(n,le),ke=t(de),he=0;he<a.length;++he){var ye=a[he],xe=ke[he];j[ye]=xe,D.keep(xe)}if(V===L.length-1&&v)for(var De=R.testLoop(c,l,i),he=0;he<a.length;++he){var ye=a[he],xe=De[he];D.keep(xe),$["val_"+ye]=xe}}),[4,b.onBatchEnd(V,j)];case 2:return ne.sent(),t4(j),T.stopTraining_?[2,"break"]:[2]}})},W=0,J.label=3;case 3:return W<L.length?[5,B(W)]:[3,6];case 4:if(X=J.sent(),X==="break")return[3,6];J.label=5;case 5:return++W,[3,3];case 6:z.dispose(),J.label=7;case 7:return[4,b.onEpochEnd(O,$)];case 8:return J.sent(),T.stopTraining_?[2,"break"]:[2]}})},T=this,E=p,_.label=2;case 2:return E<o?[5,S(E)]:[3,5];case 3:if(C=_.sent(),C==="break")return[3,5];_.label=4;case 4:return++E,[3,2];case 5:return[4,b.onTrainEnd()];case 6:return _.sent(),[4,this.history.syncData()];case 7:return _.sent(),[2,this.history]}})})},e.prototype.fitDataset=function(t,n){return Ce(this,void 0,void 0,function(){return Ie(this,function(a){return[2,Bwe(this,t,n)]})})},e.prototype.trainOnBatch=function(t,n){return Ce(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f,h,p,d,m,v;return Ie(this,function(g){switch(g.label){case 0:return[4,this.standardizeUserData(t,n)];case 1:a=g.sent(),i=a[0],o=a[1],s=this.makeTrainFunction(),u=s(i.concat(o)),c=[],g.label=2;case 2:g.trys.push([2,7,8,9]),l=fe(u),f=l.next(),g.label=3;case 3:return f.done?[3,6]:(h=f.value,[4,h.data()]);case 4:p=g.sent(),c.push(p[0]),g.label=5;case 5:return f=l.next(),[3,3];case 6:return[3,9];case 7:return d=g.sent(),m={error:d},[3,9];case 8:try{f&&!f.done&&(v=l.return)&&v.call(l)}finally{if(m)throw m.error}return[7];case 9:return D.dispose(u),ci(a[0],t),ci(a[1],n),[2,Dn(c)]}})})},e.prototype.getNamedWeights=function(t){for(var n=[],a=t!=null&&t.trainableOnly,i=a?this.trainableWeights:this.weights,o=this.getWeights(a),s=0;s<i.length;++s)a&&!i[s].trainable||n.push({name:i[s].originalName,tensor:o[s]});return n},Object.defineProperty(e.prototype,"stopTraining",{get:function(){return this.stopTraining_},set:function(t){this.stopTraining_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"optimizer",{get:function(){return this.optimizer_},set:function(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){var t=r.prototype.dispose.call(this);if(t.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){var n=D.memory().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=n-D.memory().numTensors}return t},e.prototype.getLossIdentifiers=function(){var t,n,a,i,o;if(typeof this.loss=="string")o=ao(this.loss);else if(Array.isArray(this.loss)){try{for(var s=fe(this.loss),u=s.next();!u.done;u=s.next()){var c=u.value;if(typeof c!="string")throw new Error("Serialization of non-string loss is not supported.")}}catch(m){t={error:m}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}o=this.loss.map(function(m){return ao(m)})}else{var l=Object.keys(this.loss);o={};var f=this.loss;try{for(var h=fe(l),p=h.next();!p.done;p=h.next()){var d=p.value;if(typeof f[d]=="string")o[d]=ao(f[d]);else throw new Error("Serialization of non-string loss is not supported.")}}catch(m){a={error:m}}finally{try{p&&!p.done&&(i=h.return)&&i.call(h)}finally{if(a)throw a.error}}}return o},e.prototype.getMetricIdentifiers=function(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[ao(xd(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(function(a){return ao(xd(a))});var t={};for(var n in this.metrics)t[n]=ao(xd(this.metrics[n]));return t},e.prototype.getTrainingConfig=function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}},e.prototype.loadTrainingConfig=function(t){if(t.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(t.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(t.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");var n=Cf(t.optimizer_config),a=hi(n),i;if(typeof t.loss=="string")i=Ms(t.loss);else if(Array.isArray(t.loss))i=t.loss.map(function(u){return Ms(u)});else if(t.loss!=null){i={};for(var o in t.loss)i[o]=Ms(t.loss[o])}var s;if(Array.isArray(t.metrics))s=t.metrics.map(function(u){return Ms(u)});else if(t.metrics!=null){s={};for(var o in t.metrics)s[o]=Ms(t.metrics[o])}this.compile({loss:i,metrics:s,optimizer:a})},e.prototype.save=function(t,n){return Ce(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f,h,p,d,m,v,g,y;return Ie(this,function(w){switch(w.label){case 0:if(typeof t=="string"){if(a=F.io.getSaveHandlers(t),a.length===0)throw new Z("Cannot find any save handlers for URL '".concat(t,"'"));if(a.length>1)throw new Z("Found more than one (".concat(a.length,") save handlers for ")+"URL '".concat(t,"'"));t=a[0]}if(t.save==null)throw new Z("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,F.io.encodeWeights(this.getNamedWeights(n))];case 1:return i=w.sent(),o=!1,s=null,u=this.toJSON(s,o),c={modelTopology:u,format:Gwe,generatedBy:"TensorFlow.js tfjs-layers v".concat($b),convertedBy:null},l=n==null?!1:n.includeOptimizer,l&&this.optimizer!=null?(c.trainingConfig=this.getTrainingConfig(),f="optimizer",v=(m=F.io).encodeWeights,[4,this.optimizer.getWeights()]):[3,4];case 2:return[4,v.apply(m,[w.sent(),f])];case 3:h=w.sent(),p=h.data,d=h.specs,(y=i.specs).push.apply(y,Je([],te(d),!1)),i.data=F.io.concatenateArrayBuffers([i.data,p]),w.label=4;case 4:return this.userDefinedMetadata!=null&&(g=!0,nP(this.userDefinedMetadata,this.name,g),c.userDefinedMetadata=this.userDefinedMetadata),c.weightData=i.data,c.weightSpecs=i.specs,[2,t.save(c)]}})})},e.prototype.setUserDefinedMetadata=function(t){nP(t,this.name),this.userDefinedMetadata=t},e.prototype.getUserDefinedMetadata=function(){return this.userDefinedMetadata},e}(Fwe);io.className="Model";F.serialization.registerClass(io);var g4=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(io);g4.className="Functional";F.serialization.registerClass(g4);function Hwe(r,e){return Ce(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f;return Ie(this,function(h){switch(h.label){case 0:return"modelTopology"in r||(r={modelTopology:r}),r=r,t=r.modelTopology,t.model_config!=null&&(t=t.model_config),n=Cf(t),a=hi(n,e),r.weightsManifest==null?[3,2]:[4,F.io.loadWeights(r.weightsManifest,r.pathPrefix,a.weights.map(function(p){return p.originalName}))];case 1:i=h.sent(),o={};try{for(s=fe(a.weights),u=s.next();!u.done;u=s.next())c=u.value,o[c.originalName]=i[c.originalName]}catch(p){l={error:p}}finally{try{u&&!u.done&&(f=s.return)&&f.call(s)}finally{if(l)throw l.error}}a.loadWeights(o),F.dispose(i),h.label=2;case 2:return[2,a]}})})}function Kwe(r,e){return Ce(this,void 0,void 0,function(){var t;return Ie(this,function(n){if(e==null&&(e={}),typeof r=="string"){if(t=F.io.getLoadHandlers(r,e),t.length===0)t.push(F.io.browserHTTPRequest(r,e));else if(t.length>1)throw new Z("Found more than one (".concat(t.length,") load handlers for ")+"URL '".concat(r,"'"));r=t[0]}return[2,jwe(r,void 0,e)]})})}function jwe(r,e,t){return Ce(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f;return Ie(this,function(h){switch(h.label){case 0:if(t==null&&(t={}),r.load==null)throw new Z("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,r.load()];case 1:if(n=h.sent(),a=n.modelTopology,a.model_config!=null&&(a=a.model_config),i=t.strict==null?!0:t.strict,o=n.weightData!=null&&n.weightSpecs!=null&&i,s=hi(Cf(a),e,o),u=n.trainingConfig,u!=null&&s.loadTrainingConfig(u),n.userDefinedMetadata!=null&&s.setUserDefinedMetadata(n.userDefinedMetadata),n.weightData==null)return[3,4];if(n.weightSpecs==null)throw new Z("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");return c=Xwe(n.weightData,n.weightSpecs),l=c.modelWeights,f=c.optimizerWeights,s.loadWeights(l,i),s.optimizer!=null&&f.length>0?[4,s.optimizer.setWeights(f)]:[3,3];case 2:h.sent(),h.label=3;case 3:F.dispose(l),F.dispose(f.map(function(p){return p.tensor})),h.label=4;case 4:return[2,s]}})})}function Xwe(r,e){var t=F.io.decodeWeights(r,e),n={},a=[];return e.forEach(function(i){i.group==="optimizer"?a.push({name:i.name,tensor:t[i.name]}):n[i.name]=t[i.name]}),{modelWeights:n,optimizerWeights:a}}var uv=function(r){se(e,r);function e(t){var n,a,i=r.call(this,{inputs:[],outputs:[]})||this;if(t=t||{},i.trainable=!0,i.built=!1,i.name=t.name!=null?t.name:Gd("sequential_"),t.layers!=null)try{for(var o=fe(t.layers),s=o.next();!s.done;s=o.next()){var u=s.value;i.add(u)}}catch(c){n={error:c}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}return i}return e.prototype.checkShape=function(t){var n=t.inboundNodes[0].outputTensors[0].shape;if(n.some(function(a){return a<0}))throw new Z("Negative dimension size caused by adding layer "+"".concat(t.name," with input shape [")+"".concat(t.inboundNodes[0].inputTensors[0].shape,"]"))},e.prototype.add=function(t){var n=t instanceof e||t instanceof io,a;if(n){if(a=t,a.outputs.length!==1)throw new Z("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(a.inputs.length!==1)throw new Z("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new Z("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var i=IP({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(i)}if(n)this.outputs=a.outputs,this.inputs=a.inputs;else{if(t.inboundNodes.length!==1)throw new Z("A layer added to a Sequential model must not already be "+"connected somewhere else. LayersModel received layer ".concat(t.name," ")+"which has ".concat(t.inboundNodes.length," pre-existing inbound ")+"connections.");if(t.inboundNodes[0].outputTensors.length!==1)throw new Z("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=EP(this.outputs[0])}this.inboundNodes=[],new ev({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:$s(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(function(s){return s.shape}),outputShapes:this.outputs[0].shape})}else{var o=t.apply(this.outputs[0]);if(Array.isArray(o))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[o],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1},e.prototype.pop=function(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},e.prototype.call=function(t,n){return this.model==null&&this.build(),this.model.call(t,n)},e.prototype.build=function(t){if(Tt(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new io({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},e.prototype.countParams=function(){return this.built||this.build(),r.prototype.countParams.call(this)},e.prototype.summary=function(t,n,a){a===void 0&&(a=console.log),this.built||this.build(),r.prototype.summary.call(this,t,n,a)},e.prototype.setWeights=function(t){this.model==null&&this.build(),this.model.setWeights(t)},e.prototype.evaluate=function(t,n,a){if(a===void 0&&(a={}),!this.built)throw new Oi("The model needs to be compiled before being used.");return this.model.evaluate(t,n,a)},e.prototype.evaluateDataset=function(t,n){return Ce(this,void 0,void 0,function(){return Ie(this,function(a){if(!this.built)throw new Oi("The model needs to be compiled before being used.");return[2,this.model.evaluateDataset(t,n)]})})},e.prototype.predict=function(t,n){return n===void 0&&(n={}),this.model==null&&this.build(),this.model.predict(t,n)},e.prototype.predictOnBatch=function(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)},e.prototype.compile=function(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},Object.defineProperty(e.prototype,"optimizer",{get:function(){return this.model==null?void 0:this.model.optimizer},set:function(t){this.model.optimizer=t},enumerable:!1,configurable:!0}),e.prototype.fit=function(t,n,a){return a===void 0&&(a={}),Ce(this,void 0,void 0,function(){return Ie(this,function(i){if(!this.built)throw new Oi("The model needs to be compiled before being used.");return[2,this.model.fit(t,n,a)]})})},e.prototype.fitDataset=function(t,n){return Ce(this,void 0,void 0,function(){return Ie(this,function(a){if(!this.built)throw new Oi("The model needs to be compiled before being used.");return[2,this.model.fitDataset(t,n)]})})},e.prototype.trainOnBatch=function(t,n){return Ce(this,void 0,void 0,function(){return Ie(this,function(a){return[2,this.model.trainOnBatch(t,n)]})})},e.fromConfig=function(t,n,a,i){var o,s;i===void 0&&(i=!1);var u,c={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new Z("Legacy serialization format not supported yet.");u=n}else F.util.assert(n.layers!=null,function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."}),u=n.layers,delete n.layers,c=n;var l=new t(c);if(!(l instanceof e))throw new vt("Sequential.fromConfig called on non-Sequential input: ".concat(l));try{for(var f=fe(u),h=f.next();!h.done;h=f.next()){var p=h.value,d=void 0,m=hi(p,d,i);i&&m.setFastWeightInitDuringBuild(!0),l.add(m)}}catch(v){o={error:v}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}return l},Object.defineProperty(e.prototype,"stopTraining",{get:function(){if(this.model==null)throw new Z("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(t){if(this.model==null)throw new Z("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t},enumerable:!1,configurable:!0}),e.prototype.getConfig=function(){var t,n,a=[];try{for(var i=fe(this.layers),o=i.next();!o.done;o=i.next()){var s=o.value,u={};u.className=s.getClassName(),u.config=s.getConfig(),a.push(u)}}catch(c){t={error:c}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return{name:this.name,layers:a}},e}(io);uv.className="Sequential";F.serialization.registerClass(uv);function Ywe(r){return new io(r)}function Zwe(r){return new uv(r)}function y4(r){return IP(r)}function Jwe(r,e){Pb.registerCallbackConstructor(r,e)}var Rn=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getConfig=function(){return{}},e}(F.serialization.Serializable),b4=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return n===void 0&&(n=1),ope(t,n)},e}(Rn);b4.className="elu";F.serialization.registerClass(b4);var w4=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return D.selu(t)},e}(Rn);w4.className="selu";F.serialization.registerClass(w4);var x4=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return D.relu(t)},e}(Rn);x4.className="relu";F.serialization.registerClass(x4);var k4=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return F.tidy(function(){return D.minimum(6,D.relu(t))})},e}(Rn);k4.className="relu6";F.serialization.registerClass(k4);var S4=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return t},e}(Rn);S4.className="linear";F.serialization.registerClass(S4);var N4=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return D.sigmoid(t)},e}(Rn);N4.className="sigmoid";F.serialization.registerClass(N4);var T4=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return upe(t)},e}(Rn);T4.className="hardSigmoid";F.serialization.registerClass(T4);var E4=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return D.softplus(t)},e}(Rn);E4.className="softplus";F.serialization.registerClass(E4);var I4=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return spe(t)},e}(Rn);I4.className="softsign";F.serialization.registerClass(I4);var C4=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return D.tanh(t)},e}(Rn);C4.className="tanh";F.serialization.registerClass(C4);var qb=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return n===void 0&&(n=-1),D.softmax(t,n)},e}(Rn);qb.className="softmax";F.serialization.registerClass(qb);var A4=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return n===void 0&&(n=-1),D.logSoftmax(t,n)},e}(Rn);A4.className="logSoftmax";F.serialization.registerClass(A4);var D4=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t,n){return n===void 0&&(n=1),F.tidy(function(){return D.mul(D.sigmoid(D.mul(t,n)),t)})},e}(Rn);D4.className="swish";F.serialization.registerClass(D4);var _4=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.apply=function(t){return F.tidy(function(){return D.mul(t,D.tanh(D.softplus(t)))})},e}(Rn);_4.className="mish";F.serialization.registerClass(_4);function jo(r){return r.getClassName()}function O0(r,e){return e===void 0&&(e={}),Df(r,F.serialization.SerializationMap.getMap().classNameMap,e,"activation")}function Xo(r){if(r==null){var e={};return e.className="linear",e.config={},O0(e)}if(typeof r=="string"){var e={};return e.className=r,e.config={},O0(e)}else return r instanceof Rn?r:O0(r)}function Wb(r){if(r!=null&&typeof r!="object")throw new Error("Argument to L1L2 regularizer's constructor is expected to be an "+"object, but received: ".concat(r))}var F4=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(F.serialization.Serializable),Bf=function(r){se(e,r);function e(t){var n=r.call(this)||this;return Wb(t),n.l1=t==null||t.l1==null?.01:t.l1,n.l2=t==null||t.l2==null?.01:t.l2,n.hasL1=n.l1!==0,n.hasL2=n.l2!==0,n}return e.prototype.apply=function(t){var n=this;return F.tidy(function(){var a=F.zeros([1]);return n.hasL1&&(a=F.add(a,F.sum(D.mul(n.l1,F.abs(t))))),n.hasL2&&(a=F.add(a,F.sum(D.mul(n.l2,Ff(t))))),D.reshape(a,[])})},e.prototype.getConfig=function(){return{l1:this.l1,l2:this.l2}},e.fromConfig=function(t,n){return new t({l1:n.l1,l2:n.l2})},e}(F4);Bf.className="L1L2";F.serialization.registerClass(Bf);function Qwe(r){return Wb(r),new Bf({l1:r!=null?r.l1:null,l2:0})}function e1e(r){return Wb(r),new Bf({l2:r!=null?r.l2:null,l1:0})}var cP={l1l2:"L1L2"};function qt(r){return Q0(r)}function lP(r,e){return e===void 0&&(e={}),Df(r,F.serialization.SerializationMap.getMap().classNameMap,e,"regularizer")}function cr(r){if(r==null)return null;if(typeof r=="string"){var e=r in cP?cP[r]:r,t={className:e,config:{}};return lP(t)}else return r instanceof F4?r:lP(r)}var Vb=function(r){se(e,r);function e(t){var n=r.call(this,t??{})||this;return n.supportsMasking=!0,t!=null&&(n.maxValue=t.maxValue),n}return e.prototype.call=function(t,n){t=it(t);var a=F.relu(t);return this.maxValue!=null&&(a=F.clipByValue(a,0,this.maxValue)),a},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={maxValue:this.maxValue},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);Vb.className="ReLU";F.serialization.registerClass(Vb);var Ub=function(r){se(e,r);function e(t){var n=r.call(this,t??{})||this;return n.DEFAULT_ALPHA=.3,t==null&&(t={}),n.alpha=t.alpha==null?n.DEFAULT_ALPHA:t.alpha,n}return e.prototype.call=function(t,n){var a=it(t);return F.leakyRelu(a,this.alpha)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={alpha:this.alpha},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);Ub.className="LeakyReLU";F.serialization.registerClass(Ub);var Gb=function(r){se(e,r);function e(t){var n=r.call(this,t??{})||this;if(n.DEFAULT_ALPHA_INITIALIZER="zeros",t==null&&(t={}),n.supportsMasking=!0,n.alphaInitializer=ur(t.alphaInitializer||n.DEFAULT_ALPHA_INITIALIZER),n.alphaRegularizer=cr(t.alphaRegularizer),n.alphaConstraint=Wr(t.alphaConstraint),t.sharedAxes==null)n.sharedAxes=null;else if(Array.isArray(t.sharedAxes))n.sharedAxes=t.sharedAxes;else if(typeof t.sharedAxes=="number")n.sharedAxes=[t.sharedAxes];else throw new Z("Expected sharedAxes to be a number or an array of numbers, "+"but got ".concat(t.sharedAxes));return n}return e.prototype.build=function(t){var n,a;t=Tt(t);var i=t.slice(1);if(this.sharedAxes!=null)try{for(var o=fe(this.sharedAxes),s=o.next();!s.done;s=o.next()){var u=s.value;i[u-1]=1}}catch(l){n={error:l}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}this.alpha=this.addWeight("alpha",i,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var c={};if(this.sharedAxes!=null)for(var u=1;u<t.length;++u)c[u]=t[u];this.inputSpec=[new Lr({ndim:t.length,axes:c})],this.built=!0},e.prototype.call=function(t,n){return t=it(t),F.prelu(t,this.alpha.read())},e.prototype.getConfig=function(){var t={alphaInitializer:yr(this.alphaInitializer),alphaRegularizer:qt(this.alphaRegularizer),alphaConstraint:qr(this.alphaConstraint),sharedAxes:this.sharedAxes},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);Gb.className="PReLU";F.serialization.registerClass(Gb);var Hb=function(r){se(e,r);function e(t){var n=r.call(this,t??{})||this;if(n.DEFAULT_ALPHA=1,t==null&&(t={}),t.alpha!=null&&t.alpha!==n.DEFAULT_ALPHA)throw new vt("Non-default alpha value (".concat(t.alpha,") is not supported by the ")+"ELU layer yet.");return n.alpha=t.alpha==null?n.DEFAULT_ALPHA:t.alpha,n}return e.prototype.call=function(t,n){var a=it(t);return F.elu(a)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={alpha:this.alpha},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);Hb.className="ELU";F.serialization.registerClass(Hb);var Kb=function(r){se(e,r);function e(t){var n=r.call(this,t??{})||this;return n.DEFAULT_THETA=1,t==null&&(t={}),n.theta=t.theta==null?n.DEFAULT_THETA:t.theta,n}return e.prototype.call=function(t,n){var a=it(t);return F.mul(a,F.cast(F.greater(a,this.theta),"float32"))},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={theta:this.theta},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);Kb.className="ThresholdedReLU";F.serialization.registerClass(Kb);var jb=function(r){se(e,r);function e(t){var n=r.call(this,t??{})||this;return n.DEFAULT_AXIS=1,t==null&&(t={}),n.softmax=new qb().apply,n.axis=t.axis==null?n.DEFAULT_AXIS:t.axis,n}return e.prototype.call=function(t,n){var a=it(t);return this.softmax(a,this.axis)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={axis:this.axis},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);jb.className="Softmax";F.serialization.registerClass(jb);function dc(r,e,t){if(typeof r=="number")return $s(r,e);if(r.length!==e)throw new Z("The ".concat(t," argument must be an integer or tuple of ").concat(e," integers.")+" Received: ".concat(r.length," elements."));for(var n=0;n<e;++n){var a=r[n];if(!rpe(a))throw new Z("The ".concat(t," argument must be an integer or tuple of ").concat(e)+" integers. Received: ".concat(JSON.stringify(r)," including a")+" non-integer number ".concat(a))}return r}function pi(r,e,t,n,a){if(a===void 0&&(a=1),r==null)return r;var i=e+(e-1)*(a-1),o;return t==="same"?o=r:o=r-i+1,Math.floor((o+n-1)/n)}function Ri(r,e,t,n){if(r==null)return null;if(n==="valid")r=r*e+Ko([t-e,0]);else if(n==="same")r=r*e;else throw new Z("Unsupport padding mode: ".concat(n,"."));return r}function Xb(r,e){return F.tidy(function(){return Dr(e),e==="channelsFirst"?D.transpose(r,[0,2,3,1]):r})}function R4(r,e){return F.tidy(function(){return Dr(e),e==="channelsFirst"?D.transpose(r,[0,2,3,4,1]):r})}function t1e(r,e,t,n,a,i,o){return n===void 0&&(n=1),a===void 0&&(a="valid"),o===void 0&&(o=1),F.tidy(function(){if(i==null&&(i=vi()),Dr(i),r.shape.length!==3)throw new Z("The input of a conv1dWithBias operation should be 3, but is "+"".concat(r.shape.length," instead."));if(e.shape.length!==3)throw new Z("The kernel for a conv1dWithBias operation should be 3, but is "+"".concat(e.shape.length," instead"));if(t!=null&&t.shape.length!==1)throw new Z("The bias for a conv1dWithBias operation should be 1, but is "+"".concat(e.shape.length," instead"));if(i==="channelsFirst"&&(r=D.transpose(r,[0,2,1])),a==="causal")throw new vt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=D.conv1d(r,e,n,a==="same"?"same":"valid","NWC",o);return t!=null&&(s=gi(s,t)),s})}function fP(r,e,t,n,a,i,o,s){return n===void 0&&(n=[1,1]),a===void 0&&(a="valid"),s===void 0&&(s=null),F.tidy(function(){if(i==null&&(i=vi()),Dr(i),r.rank!==3&&r.rank!==4)throw new Z("conv2dWithBiasActivation expects input to be of rank 3 or 4, "+"but received ".concat(r.rank,"."));if(e.rank!==3&&e.rank!==4)throw new Z("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, "+"but received ".concat(r.rank,"."));var u=Xb(r,i);if(a==="causal")throw new vt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=D.fused.conv2d({x:u,filter:e,strides:n,pad:a==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:t,activation:s}),i==="channelsFirst"&&(u=D.transpose(u,[0,3,1,2])),u})}function r1e(r,e,t,n,a,i,o){return n===void 0&&(n=[1,1,1]),a===void 0&&(a="valid"),F.tidy(function(){if(i==null&&(i=vi()),Dr(i),r.rank!==4&&r.rank!==5)throw new Z("conv3dWithBias expects input to be of rank 4 or 5, but received "+"".concat(r.rank,"."));if(e.rank!==4&&e.rank!==5)throw new Z("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+"".concat(r.rank,"."));var s=R4(r,i);if(a==="causal")throw new vt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=D.conv3d(s,e,n,a==="same"?"same":"valid","NDHWC",o),t!=null&&(s=gi(s,t)),i==="channelsFirst"&&(s=D.transpose(s,[0,4,1,2,3])),s})}var O4=function(r){se(e,r);function e(t,n){var a=r.call(this,n)||this;if(a.bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",e.verifyArgs(n),a.rank=t,jr(a.rank,"rank"),a.rank!==1&&a.rank!==2&&a.rank!==3)throw new vt("Convolution layer for rank other than 1, 2, or 3 (".concat(a.rank,") is ")+"not implemented yet.");if(a.kernelSize=dc(n.kernelSize,t,"kernelSize"),a.strides=dc(n.strides==null?1:n.strides,t,"strides"),a.padding=n.padding==null?"valid":n.padding,ga(a.padding),a.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Dr(a.dataFormat),a.activation=Xo(n.activation),a.useBias=n.useBias==null?!0:n.useBias,a.biasInitializer=ur(n.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=Wr(n.biasConstraint),a.biasRegularizer=cr(n.biasRegularizer),a.activityRegularizer=cr(n.activityRegularizer),a.dilationRate=dc(n.dilationRate==null?1:n.dilationRate,t,"dilationRate"),a.rank===1&&Array.isArray(a.dilationRate)&&a.dilationRate.length!==1)throw new Z("dilationRate must be a number or an array of a single number for 1D convolution, but received "+"".concat(JSON.stringify(a.dilationRate)));if(a.rank===2){if(typeof a.dilationRate=="number")a.dilationRate=[a.dilationRate,a.dilationRate];else if(a.dilationRate.length!==2)throw new Z("dilationRate must be a number or array of two numbers for 2D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)))}else if(a.rank===3){if(typeof a.dilationRate=="number")a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(a.dilationRate.length!==3)throw new Z("dilationRate must be a number or array of three numbers for 3D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)))}return a}return e.verifyArgs=function(t){if(Fi("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!eb(t.kernelSize,"number",1,3))throw new Z("BaseConv expects config.kernelSize to be number or number[] with "+"length 1, 2, or 3, but received ".concat(JSON.stringify(t.kernelSize),"."))},e.prototype.getConfig=function(){var t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:jo(this.activation),useBias:this.useBias,biasInitializer:yr(this.biasInitializer),biasRegularizer:qt(this.biasRegularizer),activityRegularizer:qt(this.activityRegularizer),biasConstraint:qr(this.biasConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt),cv=function(r){se(e,r);function e(t,n){var a=r.call(this,t,n)||this;return a.kernel=null,e.verifyArgs(n),a.filters=n.filters,jr(a.filters,"filters"),a.kernelInitializer=ur(n.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=Wr(n.kernelConstraint),a.kernelRegularizer=cr(n.kernelRegularizer),a}return e.prototype.build=function(t){var n;t=Tt(t);var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new Z("The channel dimension of the input should be defined. "+"Found ".concat(t[a]));var i=t[a],o=this.kernelSize.concat([i,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(n={},n[a]=i,n)}],this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){t=it(t);var i,o=a.bias==null?null:a.bias.read(),s=gP(a.activation.getClassName());if(s!=null&&a.rank===2)i=fP(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate,s);else{if(a.rank===1)i=t1e(t,a.kernel.read(),o,a.strides[0],a.padding,a.dataFormat,a.dilationRate[0]);else if(a.rank===2)i=fP(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate);else if(a.rank===3)i=r1e(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate);else throw new vt("convolutions greater than 3D are not implemented yet.");a.activation!=null&&(i=a.activation.apply(i))}return i})},e.prototype.computeOutputShape=function(t){t=Tt(t);for(var n=[],a=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2),i=0;i<a.length;++i){var o=pi(a[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);n.push(o)}var s=[t[0]];return this.dataFormat==="channelsLast"?(s=s.concat(n),s.push(this.filters)):(s.push(this.filters),s=s.concat(n)),s},e.prototype.getConfig=function(){var t={filters:this.filters,kernelInitializer:yr(this.kernelInitializer),kernelRegularizer:qt(this.kernelRegularizer),kernelConstraint:qr(this.kernelConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.verifyArgs=function(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new Z("Convolution layer expected config.filters to be a 'number' > 0 "+"but got ".concat(JSON.stringify(t.filters)))},e}(O4),lv=function(r){se(e,r);function e(t){var n=r.call(this,2,t)||this;return e.verifyArgs(t),n}return e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!eb(t.kernelSize,"number",1,2))throw new Z("Conv2D expects config.kernelSize to be number or number[] with "+"length 1 or 2, but received ".concat(JSON.stringify(t.kernelSize),"."))},e}(cv);lv.className="Conv2D";F.serialization.registerClass(lv);var fv=function(r){se(e,r);function e(t){var n=r.call(this,3,t)||this;return e.verifyArgs(t),n}return e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!(Array.isArray(t.kernelSize)&&(t.kernelSize.length===1||t.kernelSize.length===3)))throw new Z("Conv3D expects config.kernelSize to be number or"+" [number, number, number], but received ".concat(JSON.stringify(t.kernelSize),"."))},e}(cv);fv.className="Conv3D";F.serialization.registerClass(fv);var Yb=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;if(n.inputSpec=[new Lr({ndim:4})],n.padding!=="same"&&n.padding!=="valid")throw new Z("Conv2DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(n.padding));return n}return e.prototype.build=function(t){var n;if(t=Tt(t),t.length!==4)throw new Z("Input should have rank 4; Received input shape: "+JSON.stringify(t));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new Z("The channel dimension of the inputs should be defined. Found `None`.");var i=t[a],o=this.kernelSize.concat([this.filters,i]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Lr({ndim:4,axes:(n={},n[a]=i,n)})],this.built=!0},e.prototype.call=function(t,n){var a=this;return D.tidy(function(){var i=it(t);if(i.shape.length!==4)throw new Z("Conv2DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(i.shape.length));var o=i.shape,s=o[0],u,c;a.dataFormat==="channelsFirst"?(u=2,c=3):(u=1,c=2);var l=o[u],f=o[c],h=a.kernelSize[0],p=a.kernelSize[1],d=a.strides[0],m=a.strides[1],v=Ri(l,d,h,a.padding),g=Ri(f,m,p,a.padding),y=[s,v,g,a.filters];a.dataFormat!=="channelsLast"&&(i=D.transpose(i,[0,2,3,1]));var w=D.conv2dTranspose(i,a.kernel.read(),y,a.strides,a.padding);return a.dataFormat!=="channelsLast"&&(w=D.transpose(w,[0,3,1,2])),a.bias!=null&&(w=gi(w,a.bias.read(),a.dataFormat)),a.activation!=null&&(w=a.activation.apply(w)),w})},e.prototype.computeOutputShape=function(t){t=Tt(t);var n=t.slice(),a,i,o;this.dataFormat==="channelsFirst"?(a=1,i=2,o=3):(a=3,i=1,o=2);var s=this.kernelSize[0],u=this.kernelSize[1],c=this.strides[0],l=this.strides[1];return n[a]=this.filters,n[i]=Ri(n[i],c,s,this.padding),n[o]=Ri(n[o],l,u,this.padding),n},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.dilationRate,t},e}(lv);Yb.className="Conv2DTranspose";F.serialization.registerClass(Yb);var Zb=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;if(n.inputSpec=[new Lr({ndim:5})],n.padding!=="same"&&n.padding!=="valid")throw new Z("Conv3DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(n.padding));return n}return e.prototype.build=function(t){var n;if(t=Tt(t),t.length!==5)throw new Z("Input should have rank 5; Received input shape: "+JSON.stringify(t));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new Z("The channel dimension of the inputs should be defined. Found `None`.");var i=t[a],o=this.kernelSize.concat([this.filters,i]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Lr({ndim:5,axes:(n={},n[a]=i,n)})],this.built=!0},e.prototype.call=function(t,n){var a=this;return D.tidy(function(){var i=it(t);if(i.shape.length!==5)throw new Z("Conv3DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(i.shape.length));var o=i.shape,s=o[0],u,c,l;a.dataFormat==="channelsFirst"?(l=2,u=3,c=4):(l=1,u=2,c=3);var f=o[l],h=o[u],p=o[c],d=a.kernelSize[0],m=a.kernelSize[1],v=a.kernelSize[2],g=a.strides[0],y=a.strides[1],w=a.strides[2],b=Ri(f,g,d,a.padding),x=Ri(h,y,m,a.padding),S=Ri(p,w,v,a.padding),T=[s,b,x,S,a.filters];a.dataFormat!=="channelsLast"&&(i=D.transpose(i,[0,2,3,4,1]));var E=D.conv3dTranspose(i,a.kernel.read(),T,a.strides,a.padding);return a.dataFormat!=="channelsLast"&&(E=D.transpose(E,[0,4,1,2,3])),a.bias!==null&&(E=gi(E,a.bias.read(),a.dataFormat)),a.activation!==null&&(E=a.activation.apply(E)),E})},e.prototype.computeOutputShape=function(t){t=Tt(t);var n=t.slice(),a,i,o,s;this.dataFormat==="channelsFirst"?(a=1,i=2,o=3,s=4):(a=4,i=1,o=2,s=3);var u=this.kernelSize[0],c=this.kernelSize[1],l=this.kernelSize[2],f=this.strides[0],h=this.strides[1],p=this.strides[2];return n[a]=this.filters,n[i]=Ri(n[i],f,u,this.padding),n[o]=Ri(n[o],h,c,this.padding),n[s]=Ri(n[s],p,l,this.padding),n},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.dilationRate,t},e}(fv);Zb.className="Conv3DTranspose";F.serialization.registerClass(Zb);var P4=function(r){se(e,r);function e(t,n){var a=r.call(this,t,n)||this;if(a.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,n.filters==null)throw new Z("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new Z("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new Z("SeparableConv".concat(a.rank,"D supports only padding modes: ")+"'same' and 'valid', but received ".concat(JSON.stringify(n.padding)));return a.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,a.depthwiseInitializer=ur(n.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=cr(n.depthwiseRegularizer),a.depthwiseConstraint=Wr(n.depthwiseConstraint),a.pointwiseInitializer=ur(n.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=cr(n.pointwiseRegularizer),a.pointwiseConstraint=Wr(n.pointwiseConstraint),a}return e.prototype.build=function(t){var n;if(t=Tt(t),t.length<this.rank+2)throw new Z("Inputs to SeparableConv".concat(this.rank,"D should have rank ")+"".concat(this.rank+2,", but received input shape: ")+"".concat(JSON.stringify(t)));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null||t[a]<0)throw new Z("The channel dimension of the inputs should be defined, "+"but found ".concat(JSON.stringify(t[a])));for(var i=t[a],o=this.kernelSize.concat([i,this.depthMultiplier]),s=[],u=0;u<this.rank;++u)s.push(1);s.push(i*this.depthMultiplier,this.filters);var c=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",o,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,c,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",s,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,c,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,c,this.biasConstraint):this.bias=null,this.inputSpec=[new Lr({ndim:this.rank+2,axes:(n={},n[a]=i,n)})],this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){t=it(t);var i;if(a.rank===1)throw new vt("1D separable convolution is not implemented yet.");return a.rank===2&&(a.dataFormat==="channelsFirst"&&(t=D.transpose(t,[0,2,3,1])),i=D.separableConv2d(t,a.depthwiseKernel.read(),a.pointwiseKernel.read(),a.strides,a.padding,a.dilationRate,"NHWC")),a.useBias&&(i=gi(i,a.bias.read(),a.dataFormat)),a.activation!=null&&(i=a.activation.apply(i)),a.dataFormat==="channelsFirst"&&(i=D.transpose(i,[0,3,1,2])),i})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=yr(this.depthwiseInitializer),t.pointwiseInitializer=yr(this.pointwiseInitializer),t.depthwiseRegularizer=qt(this.depthwiseRegularizer),t.pointwiseRegularizer=qt(this.pointwiseRegularizer),t.depthwiseConstraint=qr(this.depthwiseConstraint),t.pointwiseConstraint=qr(this.pointwiseConstraint),t},e}(cv);P4.className="SeparableConv";var Jb=function(r){se(e,r);function e(t){return r.call(this,2,t)||this}return e}(P4);Jb.className="SeparableConv2D";F.serialization.registerClass(Jb);var Qb=function(r){se(e,r);function e(t){var n=r.call(this,1,t)||this;return e.verifyArgs(t),n.inputSpec=[{ndim:3}],n}return e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return delete t.rank,delete t.dataFormat,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!eb(t.kernelSize,"number",1,1))throw new Z("Conv1D expects config.kernelSize to be number or number[] with "+"length 1, but received ".concat(JSON.stringify(t.kernelSize),"."))},e}(cv);Qb.className="Conv1D";F.serialization.registerClass(Qb);var ew=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return typeof t.cropping=="number"?n.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:typeof t.cropping[0]=="number"?n.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:n.cropping=t.cropping,n.dataFormat=t.dataFormat===void 0?"channelsLast":t.dataFormat,n.inputSpec=[{ndim:4}],n}return e.prototype.computeOutputShape=function(t){return this.dataFormat==="channelsFirst"?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){if(t=it(t),a.dataFormat==="channelsLast"){var i=wd(t,a.cropping[0][0],t.shape[1]-a.cropping[0][0]-a.cropping[0][1],2);return wd(i,a.cropping[1][0],t.shape[2]-a.cropping[1][1]-a.cropping[1][0],3)}else{var i=wd(t,a.cropping[0][0],t.shape[2]-a.cropping[0][0]-a.cropping[0][1],3);return wd(i,a.cropping[1][0],t.shape[3]-a.cropping[1][1]-a.cropping[1][0],4)}})},e.prototype.getConfig=function(){var t={cropping:this.cropping,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);ew.className="Cropping2D";F.serialization.registerClass(ew);var tw=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return n.DEFAULT_SIZE=[2,2],n.inputSpec=[{ndim:4}],n.size=t.size==null?n.DEFAULT_SIZE:t.size,n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Dr(n.dataFormat),n.interpolation=t.interpolation==null?"nearest":t.interpolation,Qhe(n.interpolation),n}return e.prototype.computeOutputShape=function(t){if(this.dataFormat==="channelsFirst"){var n=t[2]==null?null:this.size[0]*t[2],a=t[3]==null?null:this.size[1]*t[3];return[t[0],t[1],n,a]}else{var n=t[1]==null?null:this.size[0]*t[1],a=t[2]==null?null:this.size[1]*t[2];return[t[0],n,a,t[3]]}},e.prototype.call=function(t,n){var a=this;return D.tidy(function(){var i=it(t),o=i.shape;if(a.dataFormat==="channelsFirst"){i=D.transpose(i,[0,2,3,1]);var s=a.size[0]*o[2],u=a.size[1]*o[3],c=a.interpolation==="nearest"?D.image.resizeNearestNeighbor(i,[s,u]):D.image.resizeBilinear(i,[s,u]);return D.transpose(c,[0,3,1,2])}else{var s=a.size[0]*o[1],u=a.size[1]*o[2];return a.interpolation==="nearest"?D.image.resizeNearestNeighbor(i,[s,u]):D.image.resizeBilinear(i,[s,u])}})},e.prototype.getConfig=function(){var t={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);tw.className="UpSampling2D";F.serialization.registerClass(tw);function n1e(r,e,t,n,a,i){return t===void 0&&(t=[1,1]),n===void 0&&(n="valid"),F.tidy(function(){a==null&&(a=vi()),Dr(a);var o=Xb(r,a);if(r.rank!==4)throw new Z("Input for depthwiseConv2d is required to be 4-D, but is instead "+"".concat(r.rank,"-D"));if(e.rank!==4)throw new Z("depthwiseKernel is required to be 4-D, but is instead "+"".concat(e.rank,"-D"));return o=D.depthwiseConv2d(o,e,t,n==="same"?"same":"valid","NHWC",i),a==="channelsFirst"&&(o=D.transpose(o,[0,3,1,2])),o})}var rw=function(r){se(e,r);function e(t){var n=r.call(this,2,t)||this;return n.depthwiseKernel=null,n.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,n.depthwiseInitializer=ur(t.depthwiseInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.depthwiseConstraint=Wr(t.depthwiseConstraint),n.depthwiseRegularizer=cr(t.depthwiseRegularizer),n}return e.prototype.build=function(t){if(t=Tt(t),t.length<4)throw new Z("Inputs to DepthwiseConv2D should have rank 4. "+"Received input shape: ".concat(JSON.stringify(t),"."));var n=this.dataFormat==="channelsFirst"?1:3;if(t[n]==null||t[n]<0)throw new Z("The channel dimension of the inputs to DepthwiseConv2D should "+"be defined, but is not (".concat(t[n],")."));var a=t[n],i=[this.kernelSize[0],this.kernelSize[1],a,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[a*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){t=it(t);var i=n1e(t,a.depthwiseKernel.read(),a.strides,a.padding,a.dataFormat,null);return a.useBias&&(i=gi(i,a.bias.read(),a.dataFormat)),a.activation!=null&&(i=a.activation.apply(i)),i})},e.prototype.computeOutputShape=function(t){t=Tt(t);var n=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,o=pi(n,this.kernelSize[0],this.padding,this.strides[0]),s=pi(a,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[t[0],i,o,s]:[t[0],o,s,i]},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=yr(this.depthwiseInitializer),t.depthwiseRegularizer=qt(this.depthwiseRegularizer),t.depthwiseConstraint=qr(this.depthwiseRegularizer),t},e}(O4);rw.className="DepthwiseConv2D";F.serialization.registerClass(rw);function M4(r,e,t,n){if(Array.isArray(r)){if(e!=null||t!=null)throw new Z("When inputs is an array, neither initialState or constants should be provided");n!=null&&(t=r.slice(r.length-n,r.length),r=r.slice(0,r.length-n)),r.length>1&&(e=r.slice(1,r.length)),r=r[0]}function a(i){return i==null||Array.isArray(i)?i:[i]}return e=a(e),t=a(t),{inputs:r,initialState:e,constants:t}}function B4(r,e,t,n,a,i,o,s){return n===void 0&&(n=!1),o===void 0&&(o=!1),s===void 0&&(s=!1),D.tidy(function(){var u=e.shape.length;if(u<3)throw new Z("Input should be at least 3D, but is ".concat(u,"D."));var c=[1,0].concat(di(2,u));if(e=D.transpose(e,c),i!=null)throw new vt("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),a!=null&&(a=D.cast(D.cast(a,"bool"),"float32"),a.rank===u-1&&(a=D.expandDims(a,-1)),a=D.transpose(a,c)),n&&(e=D.reverse(e,0),a!=null&&(a=D.reverse(a,0)));var l=[],f,h=t,p=e.shape[0],d=D.unstack(e),m;a!=null&&(m=D.unstack(a));for(var v=function(b){var x=d[b],S=D.tidy(function(){return r(x,h)});if(a==null)f=S[0],h=S[1];else{var T=D.tidy(function(){var E=m[b],C=D.sub(D.onesLike(E),E),R=D.add(D.mul(S[0],E),D.mul(h[0],C)),_=h.map(function(O,$){return D.add(D.mul(S[1][$],E),D.mul(O,C))});return{output:R,newStates:_}});f=T.output,h=T.newStates}s&&l.push(f)},g=0;g<p;++g)v(g);var y;if(s){var w=1;y=D.stack(l,w)}return[f,y,h]})}var oo=function(r){se(e,r);function e(t){var n=r.call(this,t)||this,a;if(t.cell==null)throw new Z("cell property is missing for the constructor of RNN.");if(Array.isArray(t.cell)?a=new dv({cells:t.cell}):a=t.cell,a.stateSize==null)throw new Z("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return n.cell=a,n.returnSequences=t.returnSequences==null?!1:t.returnSequences,n.returnState=t.returnState==null?!1:t.returnState,n.goBackwards=t.goBackwards==null?!1:t.goBackwards,n._stateful=t.stateful==null?!1:t.stateful,n.unroll=t.unroll==null?!1:t.unroll,n.supportsMasking=!0,n.inputSpec=[new Lr({ndim:3})],n.stateSpec=null,n.states_=null,n.numConstants=null,n.keptStates=[],n}return e.prototype.getStates=function(){if(this.states_==null){var t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return di(0,t).map(function(n){return null})}else return this.states_},e.prototype.setStates=function(t){this.states_=t},e.prototype.computeOutputShape=function(t){var n,a;z0(t)&&(t=t[0]),t=t;var i=this.cell.stateSize;Array.isArray(i)||(i=[i]);var o=i[0],s;if(this.returnSequences?s=[t[0],t[1],o]:s=[t[0],o],this.returnState){var u=[];try{for(var c=fe(i),l=c.next();!l.done;l=c.next()){var f=l.value;u.push([t[0],f])}}catch(h){n={error:h}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}return[s].concat(u)}else return s},e.prototype.computeMask=function(t,n){var a=this;return D.tidy(function(){Array.isArray(n)&&(n=n[0]);var i=a.returnSequences?n:null;if(a.returnState){var o=a.states.map(function(s){return null});return[i].concat(o)}else return i})},Object.defineProperty(e.prototype,"states",{get:function(){if(this.states_==null){for(var t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[],a=0;a<t;++a)n.push(null);return n}else return this.states_},set:function(t){this.states_=t},enumerable:!1,configurable:!0}),e.prototype.build=function(t){if(this.numConstants!=null)throw new vt("Constants support is not implemented in RNN yet.");z0(t)&&(t=t[0]),t=t;var n=this.stateful?t[0]:null,a=t.slice(2);this.inputSpec[0]=new Lr({shape:Je([n,null],te(a),!1)});var i=[t[0]].concat(t.slice(2));this.cell.build(i);var o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!F.util.arraysEqual(this.stateSpec.map(function(s){return s.shape[s.shape.length-1]}),o))throw new Z("An initialState was passed that is not compatible with "+"cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; ")+"However cell.stateSize is ".concat(this.cell.stateSize))}else this.stateSpec=o.map(function(s){return new Lr({shape:[null,s]})});this.stateful&&this.resetStates()},e.prototype.resetStates=function(t,n){var a=this;n===void 0&&(n=!1),F.tidy(function(){if(!a.stateful)throw new Uo("Cannot call resetStates() on an RNN Layer that is not stateful.");var i=a.inputSpec[0].shape[0];if(i==null)throw new Z("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(a.states_==null)Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(l){return D.zeros([i,l])}):a.states_=[D.zeros([i,a.cell.stateSize])];else if(t==null)D.dispose(a.states_),a.keptStates!=null&&(D.dispose(a.keptStates),a.keptStates=[]),Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(l){return D.zeros([i,l])}):a.states_[0]=D.zeros([i,a.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==a.states_.length)throw new Z("Layer ".concat(a.name," expects ").concat(a.states_.length," state(s), ")+"but it received ".concat(t.length," state value(s). Input ")+"received: ".concat(t));n===!0?a.keptStates.push(a.states_.slice()):D.dispose(a.states_);for(var o=0;o<a.states_.length;++o){var s=t[o],u=Array.isArray(a.cell.stateSize)?a.cell.stateSize[o]:a.cell.stateSize,c=[i,u];if(!F.util.arraysEqual(s.shape,c))throw new Z("State ".concat(o," is incompatible with layer ").concat(a.name,": ")+"expected shape=".concat(c,", received shape=").concat(s.shape));a.states_[o]=s}}a.states_=a.states_.map(function(l){return D.keep(l.clone())})})},e.prototype.apply=function(t,n){var a,i,o=n==null?null:n.initialState,s=n==null?null:n.constants;n==null&&(n={});var u=M4(t,o,s,this.numConstants);t=u.inputs,o=u.initialState,s=u.constants;var c=[],l=[];if(o!=null){n.initialState=o,c=c.concat(o),this.stateSpec=[];try{for(var f=fe(o),h=f.next();!h.done;h=f.next()){var p=h.value;this.stateSpec.push(new Lr({shape:p.shape}))}}catch(w){a={error:w}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}l=l.concat(this.stateSpec)}s!=null&&(n.constants=s,c=c.concat(s),this.numConstants=s.length);var d=c[0]instanceof fi;if(d){var m=[t].concat(c),v=this.inputSpec.concat(l),g=this.inputSpec;this.inputSpec=v;var y=r.prototype.apply.call(this,m,n);return this.inputSpec=g,y}else return r.prototype.apply.call(this,t,n)},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;t=it(t),s==null&&(a.stateful?s=a.states_:s=a.getInitialState(t));var u=Array.isArray(a.cell.stateSize)?a.cell.stateSize.length:1;if(s.length!==u)throw new Z("RNN Layer has ".concat(u," state(s) but was passed ")+"".concat(s.length," initial state(s)."));a.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var c={training:o},l=function(v,g){var y=a.cell.call([v].concat(g),c);return[y[0],y.slice(1)]},f=B4(l,t,s,a.goBackwards,i,null,a.unroll,a.returnSequences),h=f[0],p=f[1],d=f[2];a.stateful&&a.resetStates(d,o);var m=a.returnSequences?p:h;return a.returnState?[m].concat(d):m})},e.prototype.getInitialState=function(t){var n=this;return F.tidy(function(){var a=D.zeros(t.shape);return a=D.sum(a,[1,2]),a=_f(a),Array.isArray(n.cell.stateSize)?n.cell.stateSize.map(function(i){return i>1?B0(a,[1,i]):a}):n.cell.stateSize>1?[B0(a,[1,n.cell.stateSize])]:[a]})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!1,configurable:!0}),e.prototype.setFastWeightInitDuringBuild=function(t){r.prototype.setFastWeightInitDuringBuild.call(this,t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);var a=this.cell.getConfig();return this.getClassName()===e.className&&(n.cell={className:this.cell.getClassName(),config:a}),Object.assign(Object.assign(Object.assign({},a),t),n)},e.fromConfig=function(t,n,a){a===void 0&&(a={});var i=n.cell,o=hi(i,a);return new t(Object.assign(n,{cell:o}))},e}(mt);oo.className="RNN";F.serialization.registerClass(oo);var kc=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(mt),hv=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,jr(n.units,"units"),n.activation=Xo(t.activation==null?n.DEFAULT_ACTIVATION:t.activation),n.useBias=t.useBias==null?!0:t.useBias,n.kernelInitializer=ur(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=ur(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=ur(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=cr(t.kernelRegularizer),n.recurrentRegularizer=cr(t.recurrentRegularizer),n.biasRegularizer=cr(t.biasRegularizer),n.kernelConstraint=Wr(t.kernelConstraint),n.recurrentConstraint=Wr(t.recurrentConstraint),n.biasConstraint=Wr(t.biasConstraint),n.dropout=vc([1,Ko([0,t.dropout==null?0:t.dropout])]),n.recurrentDropout=vc([1,Ko([0,t.recurrentDropout==null?0:t.recurrentDropout])]),n.dropoutFunc=t.dropoutFunc,n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return e.prototype.build=function(t){t=Tt(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){if(t=t,t.length!==2)throw new Z("SimpleRNNCell expects 2 input Tensors, got ".concat(t.length,"."));var i=t[1];t=t[0];var o=n.training==null?!1:n.training;0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=Yo({ones:function(){return D.onesLike(t)},rate:a.dropout,training:o,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=Yo({ones:function(){return D.onesLike(i)},rate:a.recurrentDropout,training:o,dropoutFunc:a.dropoutFunc}));var s,u=a.dropoutMask,c=a.recurrentDropoutMask;u!=null?s=Mi(D.mul(t,u),a.kernel.read()):s=Mi(t,a.kernel.read()),a.bias!=null&&(s=gi(s,a.bias.read())),c!=null&&(i=D.mul(i,c));var l=D.add(s,Mi(i,a.recurrentKernel.read()));return a.activation!=null&&(l=a.activation.apply(l)),[l,l]})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={units:this.units,activation:jo(this.activation),useBias:this.useBias,kernelInitializer:yr(this.kernelInitializer),recurrentInitializer:yr(this.recurrentInitializer),biasInitializer:yr(this.biasInitializer),kernelRegularizer:qt(this.kernelRegularizer),recurrentRegularizer:qt(this.recurrentRegularizer),biasRegularizer:qt(this.biasRegularizer),activityRegularizer:qt(this.activityRegularizer),kernelConstraint:qr(this.kernelConstraint),recurrentConstraint:qr(this.recurrentConstraint),biasConstraint:qr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},t),n)},e}(kc);hv.className="SimpleRNNCell";F.serialization.registerClass(hv);var nw=function(r){se(e,r);function e(t){return t.cell=new hv(t),r.call(this,t)||this}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.cell.dropoutMask!=null&&(D.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(D.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,n){return new t(n)},e}(oo);nw.className="SimpleRNN";F.serialization.registerClass(nw);var pv=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;if(n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new Z("GRUCell does not support reset_after parameter set to true.");return n.units=t.units,jr(n.units,"units"),n.activation=Xo(t.activation===void 0?n.DEFAULT_ACTIVATION:t.activation),n.recurrentActivation=Xo(t.recurrentActivation===void 0?n.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),n.useBias=t.useBias==null?!0:t.useBias,n.kernelInitializer=ur(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=ur(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=ur(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelRegularizer=cr(t.kernelRegularizer),n.recurrentRegularizer=cr(t.recurrentRegularizer),n.biasRegularizer=cr(t.biasRegularizer),n.kernelConstraint=Wr(t.kernelConstraint),n.recurrentConstraint=Wr(t.recurrentConstraint),n.biasConstraint=Wr(t.biasConstraint),n.dropout=vc([1,Ko([0,t.dropout==null?0:t.dropout])]),n.recurrentDropout=vc([1,Ko([0,t.recurrentDropout==null?0:t.recurrentDropout])]),n.dropoutFunc=t.dropoutFunc,n.implementation=t.implementation,n.stateSize=n.units,n.dropoutMask=null,n.recurrentDropoutMask=null,n}return e.prototype.build=function(t){t=Tt(t);var n=t[t.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){if(t=t,t.length!==2)throw new Z("GRUCell expects 2 input Tensors (inputs, h, c), got "+"".concat(t.length,"."));var i=n.training==null?!1:n.training,o=t[1];t=t[0],0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=Yo({ones:function(){return D.onesLike(t)},rate:a.dropout,training:i,count:3,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=Yo({ones:function(){return D.onesLike(o)},rate:a.recurrentDropout,training:i,count:3,dropoutFunc:a.dropoutFunc}));var s=a.dropoutMask,u=a.recurrentDropoutMask,c,l,f;0<a.dropout&&a.dropout<1&&(t=D.mul(t,s[0]));var h=Mi(t,a.kernel.read());a.useBias&&(h=gi(h,a.bias.read())),0<a.recurrentDropout&&a.recurrentDropout<1&&(o=D.mul(o,u[0]));var p=a.recurrentKernel.read(),d=te(D.split(p,[2*a.units,a.units],p.rank-1),2),m=d[0],v=d[1],g=Mi(o,m),y=te(D.split(h,3,h.rank-1),3),w=y[0],b=y[1],x=y[2],S=te(D.split(g,2,g.rank-1),2),T=S[0],E=S[1];c=a.recurrentActivation.apply(D.add(w,T)),l=a.recurrentActivation.apply(D.add(b,E));var C=Mi(D.mul(l,o),v);f=a.activation.apply(D.add(x,C));var R=D.add(D.mul(c,o),D.mul(D.add(1,D.neg(c)),f));return[R,R]})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={units:this.units,activation:jo(this.activation),recurrentActivation:jo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:yr(this.kernelInitializer),recurrentInitializer:yr(this.recurrentInitializer),biasInitializer:yr(this.biasInitializer),kernelRegularizer:qt(this.kernelRegularizer),recurrentRegularizer:qt(this.recurrentRegularizer),biasRegularizer:qt(this.biasRegularizer),activityRegularizer:qt(this.activityRegularizer),kernelConstraint:qr(this.kernelConstraint),recurrentConstraint:qr(this.recurrentConstraint),biasConstraint:qr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},t),n)},e}(kc);pv.className="GRUCell";F.serialization.registerClass(pv);var aw=function(r){se(e,r);function e(t){return t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new pv(t),r.call(this,t)||this}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.cell.dropoutMask!=null&&(D.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(D.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)},e}(oo);aw.className="GRU";F.serialization.registerClass(aw);var Lf=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return n.DEFAULT_ACTIVATION="tanh",n.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_RECURRENT_INITIALIZER="orthogonal",n.DEFAULT_BIAS_INITIALIZER="zeros",n.units=t.units,jr(n.units,"units"),n.activation=Xo(t.activation===void 0?n.DEFAULT_ACTIVATION:t.activation),n.recurrentActivation=Xo(t.recurrentActivation===void 0?n.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),n.useBias=t.useBias==null?!0:t.useBias,n.kernelInitializer=ur(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.recurrentInitializer=ur(t.recurrentInitializer||n.DEFAULT_RECURRENT_INITIALIZER),n.biasInitializer=ur(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.unitForgetBias=t.unitForgetBias,n.kernelRegularizer=cr(t.kernelRegularizer),n.recurrentRegularizer=cr(t.recurrentRegularizer),n.biasRegularizer=cr(t.biasRegularizer),n.kernelConstraint=Wr(t.kernelConstraint),n.recurrentConstraint=Wr(t.recurrentConstraint),n.biasConstraint=Wr(t.biasConstraint),n.dropout=vc([1,Ko([0,t.dropout==null?0:t.dropout])]),n.recurrentDropout=vc([1,Ko([0,t.recurrentDropout==null?0:t.recurrentDropout])]),n.dropoutFunc=t.dropoutFunc,n.implementation=t.implementation,n.stateSize=[n.units,n.units],n.dropoutMask=null,n.recurrentDropoutMask=null,n}return e.prototype.build=function(t){var n;t=Tt(t);var a=t[t.length-1];this.kernel=this.addWeight("kernel",[a,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);var i;if(this.useBias){if(this.unitForgetBias){var o=this.biasInitializer,s=this.units;i=new(n=function(u){se(c,u);function c(){return u!==null&&u.apply(this,arguments)||this}return c.prototype.apply=function(l,f){var h=o.apply([s]),p=new Kd().apply([s]),d=o.apply([s*2]);return mO(mO(h,p),d)},c}(qa),n.className="CustomInit",n)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=n.training==null?!1:n.training;if(t=t,t.length!==3)throw new Z("LSTMCell expects 3 input Tensors (inputs, h, c), got "+"".concat(t.length,"."));var o=t[1],s=t[2];t=t[0],0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=Yo({ones:function(){return D.onesLike(t)},rate:a.dropout,training:i,count:4,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=Yo({ones:function(){return D.onesLike(o)},rate:a.recurrentDropout,training:i,count:4,dropoutFunc:a.dropoutFunc}));var u=a.dropoutMask,c=a.recurrentDropoutMask,l,f,h,p;0<a.dropout&&a.dropout<1&&(t=D.mul(t,u[0]));var d=Mi(t,a.kernel.read());0<a.recurrentDropout&&a.recurrentDropout<1&&(o=D.mul(o,c[0])),d=D.add(d,Mi(o,a.recurrentKernel.read())),a.useBias&&(d=gi(d,a.bias.read()));var m=te(D.split(d,4,d.rank-1),4),v=m[0],g=m[1],y=m[2],w=m[3];l=a.recurrentActivation.apply(v),f=a.recurrentActivation.apply(g),h=D.add(D.mul(f,s),D.mul(l,a.activation.apply(y))),p=a.recurrentActivation.apply(w);var b=D.mul(p,a.activation.apply(h));return[b,b,h]})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={units:this.units,activation:jo(this.activation),recurrentActivation:jo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:yr(this.kernelInitializer),recurrentInitializer:yr(this.recurrentInitializer),biasInitializer:yr(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:qt(this.kernelRegularizer),recurrentRegularizer:qt(this.recurrentRegularizer),biasRegularizer:qt(this.biasRegularizer),activityRegularizer:qt(this.activityRegularizer),kernelConstraint:qr(this.kernelConstraint),recurrentConstraint:qr(this.recurrentConstraint),biasConstraint:qr(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},t),n)},e}(kc);Lf.className="LSTMCell";F.serialization.registerClass(Lf);var iw=function(r){se(e,r);function e(t){return t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Lf(t),r.call(this,t)||this}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.cell.dropoutMask!=null&&(D.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(D.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,n){return n.implmentation===0&&(n.implementation=1),new t(n)},e}(oo);iw.className="LSTM";F.serialization.registerClass(iw);var dv=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return n.cells=t.cells,n}return Object.defineProperty(e.prototype,"stateSize",{get:function(){var t,n,a=[];try{for(var i=fe(this.cells.slice().reverse()),o=i.next();!o.done;o=i.next()){var s=o.value;Array.isArray(s.stateSize)?a.push.apply(a,Je([],te(s.stateSize),!1)):a.push(s.stateSize)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a},enumerable:!1,configurable:!0}),e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i,o,s,u;t=t;var c=t.slice(1),l=[];try{for(var f=fe(a.cells.slice().reverse()),h=f.next();!h.done;h=f.next()){var p=h.value;Array.isArray(p.stateSize)?l.push(c.splice(0,p.stateSize.length)):l.push(c.splice(0,1))}}catch(b){i={error:b}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}l.reverse();for(var d=[],m,v=0;v<a.cells.length;++v){var p=a.cells[v];c=l[v],v===0?m=[t[0]].concat(c):m=[m[0]].concat(c),m=p.call(m,n),d.push(m.slice(1))}c=[];try{for(var g=fe(d.slice().reverse()),y=g.next();!y.done;y=g.next()){var w=y.value;c.push.apply(c,Je([],te(w),!1))}}catch(b){s={error:b}}finally{try{y&&!y.done&&(u=g.return)&&u.call(g)}finally{if(s)throw s.error}}return[m[0]].concat(c)})},e.prototype.build=function(t){z0(t)&&(t=t[0]),t=t;var n;this.cells.forEach(function(a,i){Ls("RNNCell_".concat(i),function(){a.build(t),Array.isArray(a.stateSize)?n=a.stateSize[0]:n=a.stateSize,t=[t[0],n]})}),this.built=!0},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n=function(o){return{className:o.getClassName(),config:o.getConfig()}},a=this.cells.map(n),i={cells:a};return Object.assign(Object.assign({},t),i)},e.fromConfig=function(t,n,a){var i,o;a===void 0&&(a={});var s=[];try{for(var u=fe(n.cells),c=u.next();!c.done;c=u.next()){var l=c.value;s.push(hi(l,a))}}catch(f){i={error:f}}finally{try{c&&!c.done&&(o=u.return)&&o.call(u)}finally{if(i)throw i.error}}return new t({cells:s})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){var t,n;if(!this.trainable)return[];var a=[];try{for(var i=fe(this.cells),o=i.next();!o.done;o=i.next()){var s=o.value;a.push.apply(a,Je([],te(s.trainableWeights),!1))}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){var t,n,a,i,o=[];try{for(var s=fe(this.cells),u=s.next();!u.done;u=s.next()){var c=u.value;o.push.apply(o,Je([],te(c.nonTrainableWeights),!1))}}catch(p){t={error:p}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}if(!this.trainable){var l=[];try{for(var f=fe(this.cells),h=f.next();!h.done;h=f.next()){var c=h.value;l.push.apply(l,Je([],te(c.trainableWeights),!1))}}catch(p){a={error:p}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}return l.concat(o)}return o},enumerable:!1,configurable:!0}),e.prototype.getWeights=function(){var t,n,a=[];try{for(var i=fe(this.cells),o=i.next();!o.done;o=i.next()){var s=o.value;a.push.apply(a,Je([],te(s.weights),!1))}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return $0(a)},e.prototype.setWeights=function(t){var n,a,i=[];try{for(var o=fe(this.cells),s=o.next();!s.done;s=o.next())for(var u=s.value,c=u.weights.length,l=t.splice(c),f=0;f<u.weights.length;++f)i.push([u.weights[f],l[f]])}catch(h){n={error:h}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}cb(i)},e}(kc);dv.className="StackedRNNCells";F.serialization.registerClass(dv);function Yo(r){var e=r.ones,t=r.rate,n=r.training,a=n===void 0?!1:n,i=r.count,o=i===void 0?1:i,s=r.dropoutFunc,u=function(){return s!=null?s(e(),t):NP(e(),t)},c=function(){return Rf(u,e,a)};if(!o||o<=1)return D.keep(c().clone());var l=Array(o).fill(void 0).map(c);return l.map(function(f){return D.keep(f.clone())})}var a1e=function(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,n=Object.getOwnPropertySymbols(r);a<n.length;a++)e.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(r,n[a])&&(t[n[a]]=r[n[a]]);return t};(function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(kc);var L4=function(r){se(e,r);function e(t){var n=this;if(t.unroll)throw new vt("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new vt("It is not possible at the moment to stack convolutional cells.");return n=r.call(this,t)||this,n.inputSpec=[new Lr({ndim:5})],n}return e.prototype.call=function(t,n){var a=this;return D.tidy(function(){if(a.cell.dropoutMask!=null&&(D.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(D.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null),n&&n.constants)throw new Z("ConvRNN2D cell does not support constants");var i=n==null?null:n.mask,o=n==null?null:n.training,s=n==null?null:n.initialState;return r.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.prototype.computeOutputShape=function(t){var n=this.computeSingleOutputShape(t);return this.returnSequences||(n=Je([n[0]],te(n.slice(2)),!1)),this.returnState&&(n=Je([n],te(Array(2).fill(Je([t[0]],te(n.slice(-3)),!1))),!1)),n},e.prototype.getInitialState=function(t){var n=this;return D.tidy(function(){var a=n.cell.stateSize,i=t.shape,o=n.computeSingleOutputShape(i),s=Je([o[0]],te(o.slice(2)),!1),u=D.zeros(s);return Array.isArray(a)?Array(a.length).fill(u):[u]})},e.prototype.resetStates=function(t,n){var a=this;n===void 0&&(n=!1),D.tidy(function(){if(!a.stateful)throw new Uo("Cannot call resetStates() on an RNN Layer that is not stateful.");var i=a.inputSpec[0].shape,o=a.computeSingleOutputShape(i),s=Je([o[0]],te(o.slice(2)),!1),u=i[0];if(u==null)throw new Z("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(a.getStates()==null)Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(){return D.zeros(s)}):a.states_=[D.zeros(s)];else if(t==null)D.dispose(a.states_),a.keptStates!=null&&(D.dispose(a.keptStates),a.keptStates=[]),Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(){return D.zeros(s)}):a.states_[0]=D.zeros(s);else{if(Array.isArray(t)||(t=[t]),t.length!==a.states_.length)throw new Z("Layer ".concat(a.name," expects ").concat(a.states_.length," state(s), ")+"but it received ".concat(t.length," state value(s). Input ")+"received: ".concat(t));n?a.keptStates.push(a.states_.slice()):D.dispose(a.states_);for(var c=0;c<a.states_.length;++c){var l=t[c],f=s;if(!F.util.arraysEqual(l.shape,f))throw new Z("State ".concat(c," is incompatible with layer ").concat(a.name,": ")+"expected shape=".concat(f,", received shape=").concat(l.shape));a.states_[c]=l}}a.states_=a.states_.map(function(h){return D.keep(h.clone())})})},e.prototype.computeSingleOutputShape=function(t){var n=this.cell,a=n.dataFormat,i=n.filters,o=n.kernelSize,s=n.padding,u=n.strides,c=n.dilationRate,l=a==="channelsFirst",f=t[l?3:2],h=t[l?4:3],p=pi(f,o[0],s,u[0],c[0]),d=pi(h,o[1],s,u[1],c[1]),m=Je(Je([],te(t.slice(0,2)),!1),te(l?[i,p,d]:[p,d,i]),!1);return m},e}(oo);L4.className="ConvRNN2D";var vv=function(r){se(e,r);function e(t){var n=this,a=t.filters,i=t.kernelSize,o=t.strides,s=t.padding,u=t.dataFormat,c=t.dilationRate;return n=r.call(this,Object.assign(Object.assign({},t),{units:a}))||this,n.filters=a,jr(n.filters,"filters"),n.kernelSize=dc(i,2,"kernelSize"),n.kernelSize.forEach(function(l){return jr(l,"kernelSize")}),n.strides=dc(o||1,2,"strides"),n.strides.forEach(function(l){return jr(l,"strides")}),n.padding=s||"valid",ga(n.padding),n.dataFormat=u||"channelsLast",Dr(n.dataFormat),n.dilationRate=dc(c||1,2,"dilationRate"),n.dilationRate.forEach(function(l){return jr(l,"dilationRate")}),n}return e.prototype.build=function(t){var n;t=Tt(t);var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new Z("The channel dimension of the input should be defined. "+"Found ".concat(t[a]));var i=t[a],o=4,s=this.kernelSize.concat([i,this.filters*o]);this.kernel=this.addWeight("kernel",s,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var u=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",u,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var c=void 0;if(this.unitForgetBias){var l=this.biasInitializer,f=this.filters;c=new(n=function(h){se(p,h);function p(){return h!==null&&h.apply(this,arguments)||this}return p.prototype.apply=function(d,m){var v=l.apply([f]),g=D.ones([f]),y=l.apply([f*2]);return tb([v,g,y])},p}(qa),n.className="CustomInit",n)}else c=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,c,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0},e.prototype.call=function(t,n){var a=this;return D.tidy(function(){if(t.length!==3)throw new Z("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+"".concat(t.length,"."));var i=n.training||!1,o=t[0],s=t[1],u=t[2],c=4;0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=Yo({ones:function(){return D.onesLike(o)},rate:a.dropout,training:i,count:c,dropoutFunc:a.dropoutFunc}));var l=a.dropoutMask,f=function(le,de,ke){return!de||!de[ke]?le:D.mul(de[ke],le)},h=f(o,l,0),p=f(o,l,1),d=f(o,l,2),m=f(o,l,3);0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=Yo({ones:function(){return D.onesLike(s)},rate:a.recurrentDropout,training:i,count:c,dropoutFunc:a.dropoutFunc}));var v=a.recurrentDropoutMask,g=f(s,v,0),y=f(s,v,1),w=f(s,v,2),b=f(s,v,3),x=3,S=te(D.split(a.kernel.read(),c,x),4),T=S[0],E=S[1],C=S[2],R=S[3],_=te(a.useBias?D.split(a.bias.read(),c):[null,null,null,null],4),O=_[0],$=_[1],z=_[2],L=_[3];h=a.inputConv(h,T,O,a.padding),p=a.inputConv(p,E,$,a.padding),d=a.inputConv(d,C,z,a.padding),m=a.inputConv(m,R,L,a.padding);var B=te(D.split(a.recurrentKernel.read(),c,x),4),W=B[0],X=B[1],J=B[2],V=B[3];g=a.recurrentConv(g,W),y=a.recurrentConv(y,X),w=a.recurrentConv(w,J),b=a.recurrentConv(b,V);var j=a.recurrentActivation.apply(D.add(h,g)),ne=a.recurrentActivation.apply(D.add(p,y)),re=D.add(D.mul(ne,u),D.mul(j,a.activation.apply(D.add(d,w)))),oe=D.mul(a.recurrentActivation.apply(D.add(m,b)),a.activation.apply(re));return[oe,oe,re]})},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this);t.units;var n=a1e(t,["units"]),a={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),a)},e.prototype.inputConv=function(t,n,a,i){var o=D.conv2d(t,n,this.strides,i||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return a?gi(o,a,this.dataFormat):o},e.prototype.recurrentConv=function(t,n){var a=1;return D.conv2d(t,n,a,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")},e}(Lf);vv.className="ConvLSTM2DCell";D.serialization.registerClass(vv);var ow=function(r){se(e,r);function e(t){var n=new vv(t);return r.call(this,Object.assign(Object.assign({},t),{cell:n}))||this}return e.fromConfig=function(t,n){return new t(n)},e}(L4);ow.className="ConvLSTM2D";D.serialization.registerClass(ow);var mv=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return n.rate=Math.max(Math.min(t.rate,1),0),n.noiseShape=t.noiseShape,n.seed=t.seed,n.supportsMasking=!0,n}return e.prototype.getNoiseShape=function(t){if(this.noiseShape==null)return this.noiseShape;for(var n=t.shape,a=[],i=0;i<this.noiseShape.length;++i)a.push(this.noiseShape[i]==null?n[i]:this.noiseShape[i]);return a},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=it(t);if(0<a.rate&&a.rate<1){var o=n.training==null?!1:n.training,s=a.getNoiseShape(i),u=Rf(function(){return NP(i,a.rate,s,a.seed)},function(){return i},o);return u}return t})},e.prototype.getConfig=function(){var t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.dispose=function(){return r.prototype.dispose.call(this)},e}(mt);mv.className="Dropout";F.serialization.registerClass(mv);var sw=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return n.inputSpec=[{ndim:3}],n}return e.prototype.getNoiseShape=function(t){var n=t.shape;return[n[0],1,n[2]]},e}(mv);sw.className="SpatialDropout1D";F.serialization.registerClass(sw);var uw=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;if(n.activation=null,n.useBias=!0,n.kernel=null,n.bias=null,n.DEFAULT_KERNEL_INITIALIZER="glorotNormal",n.DEFAULT_BIAS_INITIALIZER="zeros",t.batchInputShape==null&&t.inputShape==null&&t.inputDim!=null){var a=null;t.batchSize!=null&&(a=t.batchSize),n.batchInputShape=[a,t.inputDim]}return n.units=t.units,jr(n.units,"units"),n.activation=Xo(t.activation),t.useBias!=null&&(n.useBias=t.useBias),n.kernelInitializer=ur(t.kernelInitializer||n.DEFAULT_KERNEL_INITIALIZER),n.biasInitializer=ur(t.biasInitializer||n.DEFAULT_BIAS_INITIALIZER),n.kernelConstraint=Wr(t.kernelConstraint),n.biasConstraint=Wr(t.biasConstraint),n.kernelRegularizer=cr(t.kernelRegularizer),n.biasRegularizer=cr(t.biasRegularizer),n.activityRegularizer=cr(t.activityRegularizer),n.supportsMasking=!0,n.inputSpec=[{minNDim:2}],n}return e.prototype.build=function(t){var n;t=Tt(t);var a=t[t.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[a,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(n={},n[-1]=a,n)}],this.built=!0},e.prototype.computeOutputShape=function(t){t=Tt(t);var n=t.slice();return n[n.length-1]=this.units,n},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=it(t),o=gP(a.activation.getClassName()),s;return o!=null?s=Mi(i,a.kernel.read(),o,a.bias?a.bias.read():null):(s=Mi(i,a.kernel.read()),a.bias!=null&&(s=gi(s,a.bias.read())),a.activation!=null&&(s=a.activation.apply(s))),s})},e.prototype.getConfig=function(){var t={units:this.units,activation:jo(this.activation),useBias:this.useBias,kernelInitializer:yr(this.kernelInitializer),biasInitializer:yr(this.biasInitializer),kernelRegularizer:qt(this.kernelRegularizer),biasRegularizer:qt(this.biasRegularizer),activityRegularizer:qt(this.activityRegularizer),kernelConstraint:qr(this.kernelConstraint),biasConstraint:qr(this.biasConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);uw.className="Dense";F.serialization.registerClass(uw);var cw=function(r){se(e,r);function e(t){var n=this;return t=t||{},n=r.call(this,t)||this,n.inputSpec=[{minNDim:3}],n.dataFormat=t.dataFormat,n}return e.prototype.computeOutputShape=function(t){var n,a;t=Tt(t);try{for(var i=fe(t.slice(1)),o=i.next();!o.done;o=i.next()){var s=o.value;if(s==null)throw new Z('The shape of the input to "Flatten" is not fully defined '+"(got ".concat(t.slice(1),"). Make sure to pass a complete ")+'"input_shape" or "batch_input_shape" argument to the first layer in your model.')}}catch(u){n={error:u}}finally{try{o&&!o.done&&(a=i.return)&&a.call(i)}finally{if(n)throw n.error}}return[t[0],Ho(t,1)]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=it(t);if(a.dataFormat==="channelsFirst"&&i.rank>1){for(var o=[0],s=2;s<i.rank;++s)o.push(s);o.push(1),i=F.transpose(i,o)}return ipe(i)})},e.prototype.getConfig=function(){var t={};this.dataFormat!=null&&(t.dataFormat=this.dataFormat);var n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);cw.className="Flatten";F.serialization.registerClass(cw);var lw=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.activation=Xo(t.activation),n}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=it(t);return a.activation.apply(i)})},e.prototype.getConfig=function(){var t={activation:jo(this.activation)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);lw.className="Activation";F.serialization.registerClass(lw);var fw=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return n.n=t.n,n.inputSpec=[{ndim:2}],n}return e.prototype.computeOutputShape=function(t){return[t[0],this.n,t[1]]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){return t=it(t),npe(t,a.n)})},e.prototype.getConfig=function(){var t={n:this.n},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);fw.className="RepeatVector";F.serialization.registerClass(fw);var hw=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;n.targetShape=t.targetShape;for(var a=0;a<n.targetShape.length;++a)n.isUnknown(n.targetShape[a])&&(n.targetShape[a]=null);return n}return e.prototype.isUnknown=function(t){return t<0||t==null},e.prototype.fixUnknownDimension=function(t,n){for(var a="Total size of new array must be unchanged.",i=n.slice(),o=1,s=null,u=0;u<i.length;++u){var c=i[u];if(this.isUnknown(c))if(s===null)s=u;else throw new Z("Can only specifiy one unknown dimension.");else o*=c}var l=Ho(t);if(s!==null){if(o===0||l%o!==0)throw new Z(a);i[s]=l/o}else if(l!==o)throw new Z(a);return i},e.prototype.computeOutputShape=function(t){for(var n=!1,a=0;a<t.length;++a)if(this.isUnknown(t[a])){n=!0;break}return n?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=it(t),o=i.shape,s=o.slice(0,1).concat(a.fixUnknownDimension(o.slice(1),a.targetShape));return F.reshape(i,s)})},e.prototype.getConfig=function(){var t={targetShape:this.targetShape},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);hw.className="Reshape";F.serialization.registerClass(hw);var pw=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;if(t.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+"".concat(t.dims," instead."));var a=di(1,t.dims.length+1);if(!F.util.arraysEqual(t.dims.slice().sort(),a))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");return n.dims=t.dims,n.dimsIncludingBatch=[0].concat(n.dims),n.inputSpec=[new Lr({ndim:n.dims.length+1})],n}return e.prototype.computeOutputShape=function(t){t=Tt(t);var n=t.slice();return this.dims.forEach(function(a,i){n[i+1]=t[a]}),n},e.prototype.call=function(t,n){return F.transpose(it(t),this.dimsIncludingBatch)},e.prototype.getConfig=function(){var t={dims:this.dims},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);pw.className="Permute";F.serialization.registerClass(pw);var dw=function(r){se(e,r);function e(t){var n=r.call(this,t??{})||this;return n.supportsMasking=!0,t!=null?n.maskValue=t.maskValue==null?0:t.maskValue:n.maskValue=0,n}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={maskValue:this.maskValue};return Object.assign(n,t),n},e.prototype.computeMask=function(t,n){var a=it(t),i=-1;return F.any(F.notEqual(a,this.maskValue),i)},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=it(t),o=-1,s=!0,u=F.any(F.notEqual(i,a.maskValue),o,s),c=F.mul(i,F.cast(u,i.dtype));return c})},e}(mt);dw.className="Masking";F.serialization.registerClass(dw);var vw=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;if(n.embeddings=null,n.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",t.batchInputShape==null&&t.inputShape==null){var a=null;t.batchSize!=null&&(a=t.batchSize),t.inputLength==null?n.batchInputShape=[a,null]:n.batchInputShape=[a].concat(Zt(t.inputLength))}return n.inputDim=t.inputDim,jr(n.inputDim,"inputDim"),n.outputDim=t.outputDim,jr(n.outputDim,"outputDim"),n.embeddingsInitializer=ur(t.embeddingsInitializer||n.DEFAULT_EMBEDDINGS_INITIALIZER),n.embeddingsRegularizer=cr(t.embeddingsRegularizer),n.activityRegularizer=cr(t.activityRegularizer),n.embeddingsConstraint=Wr(t.embeddingsConstraint),n.maskZero=t.maskZero,n.supportsMasking=t.maskZero,n.inputLength=t.inputLength,n}return e.prototype.build=function(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},e.prototype.warnOnIncompatibleInputShape=function(t){},e.prototype.computeMask=function(t,n){var a=this;return F.tidy(function(){return a.maskZero?(t=it(t),F.notEqual(t,F.zerosLike(t))):null})},e.prototype.computeOutputShape=function(t){if(t=Tt(t),this.inputLength==null)return Je(Je([],te(t),!1),[this.outputDim],!1);var n=Zt(this.inputLength);if(n.length!==t.length-1)throw new Z('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(t));for(var a=0,i=0;i<n.length;++i){var o=n[i],s=t[i+1];if(o!=null&&s!=null&&o!==s)throw new Z('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(t));o==null&&(n[a]=s),a++}return Je(Je([t[0]],te(n),!1),[this.outputDim],!1)},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=it(t);i.dtype!=="int32"&&(i=Pi(i,"int32"));var o=SP(a.embeddings.read(),F.reshape(i,[i.size]));return F.reshape(o,Tt(a.computeOutputShape(i.shape)))})},e.prototype.getConfig=function(){var t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:yr(this.embeddingsInitializer),embeddingsRegularizer:qt(this.embeddingsRegularizer),activityRegularizer:qt(this.activityRegularizer),embeddingsConstraint:qr(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);vw.className="Embedding";F.serialization.registerClass(vw);var Ys=function(r){se(e,r);function e(t){var n=r.call(this,t||{})||this;return n.supportsMasking=!0,n}return e.prototype.mergeFunction=function(t){throw new vt},e.prototype.computeElementwiseOpOutputShape=function(t,n){if(t==null||n==null)return null;if(t.length<n.length)return this.computeElementwiseOpOutputShape(n,t);if(n.length===0)return t;for(var a=t.slice(0,t.length-n.length),i=0;i<n.length;++i){var o=t[t.length-n.length+i],s=n[i];if(o==null||s==null||o<0||s<0)a.push(null);else if(o===1)a.push(s);else if(s===1)a.push(o);else{if(o!==s)throw new Z("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(n));a.push(o)}}return a},e.prototype.build=function(t){var n,a;if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[Tt(t)]),t=t,t.length<2)throw new Z("A merge layer should be called on an Array of at least 2 inputs."+" Got ".concat(t.length," input(s)."));var i=[];try{for(var o=fe(t),s=o.next();!s.done;s=o.next()){var u=s.value;u!=null&&u[0]!==null&&i.push(u[0])}}catch(h){n={error:h}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}if(i=Go(i),i.length>1)throw new Z("Can not merge tensors with different batch sizes. "+"Got tensors with shapes: ".concat(JSON.stringify(t),"."));for(var c=t[0]==null?null:t[0].slice(1),l=1;l<t.length;++l){var u=t[l]==null?null:t[l].slice(1);c=this.computeElementwiseOpOutputShape(c,u)}var f=t.map(function(h){return h.length});t.indexOf(null)===-1&&Go(f).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i,o,s,u;if(t=t,a.reshapeRequired){var c=[],l=t.map(function($){return $.rank});if(l.indexOf(null)===-1){var f=Ko(l);try{for(var h=fe(t),p=h.next();!p.done;p=h.next()){for(var d=p.value,m=d.rank,v=0;v<f-m;++v)d=_f(d,1);c.push(d)}}catch($){i={error:$}}finally{try{p&&!p.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}return a.mergeFunction(c)}else{var g=!1;try{for(var y=fe(t),w=y.next();!w.done;w=y.next()){var d=w.value,m=d.rank;if(m==null){var b=d.shape,x=b[0],S=b.slice(1).concat([x]),T=D.reshape(d,[x].concat(Ho(b.slice(1))));T=D.transpose(T,[1,0]),T=D.reshape(T,S),c.push(T),g=!0}else if(m>1){var E=di(1,m).concat([0]);c.push(D.transpose(d,E)),g=!0}else c.push(d)}}catch($){s={error:$}}finally{try{w&&!w.done&&(u=y.return)&&u.call(y)}finally{if(s)throw s.error}}var C=a.mergeFunction(c),R=C.rank;if(g){if(R==null){var _=C.shape,O=_.length,x=_[O-1],S=[x].concat(_.slice(0,_.length-1));C=D.reshape(D.transpose(D.reshape(C,[-1,x]),[1,0]),S)}else if(R>1){var E=[R-1].concat(di(0,R-1));C=D.transpose(C,E)}}return C}}else return a.mergeFunction(t)})},e.prototype.computeOutputShape=function(t){var n,a;t=t;var i;t[0]==null?i=null:i=t[0].slice(1);for(var o=1;o<t.length;++o){var s=t[o]==null?null:t[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}var u=[];try{for(var c=fe(t),l=c.next();!l.done;l=c.next()){var s=l.value;s!=null&&s[0]!==null&&u.push(s[0])}}catch(f){n={error:f}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(n)throw n.error}}return u=Go(u),u.length===1?i=u.concat(i):i=[null].concat(i),i},e.prototype.computeMask=function(t,n){return D.tidy(function(){if(n==null)return null;if(!Array.isArray(n))throw new Z("`mask` should be an Array");if(!Array.isArray(t))throw new Z("`inputs` should be an Array");if(n.length!==t.length)throw new Z("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths "+"(".concat(t.length," vs ").concat(n.length,")"));if(n.every(function(o){return o==null}))return null;n=n.map(function(o){return o==null?o:D.expandDims(o,0)});for(var a=n[0],i=1;i<n.length-1;++i)a=D.logicalAnd(a,n[i]);return a})},e}(mt),mw=function(r){se(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return F.tidy(function(){for(var n=t[0].clone(),a=1;a<t.length;++a)n=D.add(n,t[a]);return n})},e}(Ys);mw.className="Add";F.serialization.registerClass(mw);var gw=function(r){se(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return F.tidy(function(){for(var n=t[0].clone(),a=1;a<t.length;++a)n=D.mul(n,t[a]);return n})},e}(Ys);gw.className="Multiply";F.serialization.registerClass(gw);var yw=function(r){se(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return F.tidy(function(){for(var n=t[0].clone(),a=1;a<t.length;++a)n=D.add(n,t[a]);return D.mul(1/t.length,n)})},e}(Ys);yw.className="Average";F.serialization.registerClass(yw);var bw=function(r){se(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return F.tidy(function(){for(var n=t[0],a=1;a<t.length;++a)n=D.maximum(n,t[a]);return n})},e}(Ys);bw.className="Maximum";F.serialization.registerClass(bw);var ww=function(r){se(e,r);function e(t){return r.call(this,t)||this}return e.prototype.mergeFunction=function(t){return F.tidy(function(){for(var n=t[0],a=1;a<t.length;++a)n=D.minimum(n,t[a]);return n})},e}(Ys);ww.className="Minimum";F.serialization.registerClass(ww);var xw=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return n.DEFAULT_AXIS=-1,t==null&&(t={}),n.axis=t.axis==null?n.DEFAULT_AXIS:t.axis,n.supportsMasking=!0,n.reshapeRequired=!1,n}return e.prototype.build=function(t){var n,a,i,o;if(!(Array.isArray(t)&&Array.isArray(t[0]))||t.length===1)throw new Z("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;var s=!0;try{for(var u=fe(t),c=u.next();!c.done;c=u.next()){var l=c.value;if(l!=null){s=!1;break}}}catch(g){n={error:g}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}if(!s){for(var f=[],h=0;h<t.length;++h){var p=t[h].slice();p.splice(this.axis,1);var d=!1;try{for(var m=(i=void 0,fe(f)),v=m.next();!v.done;v=m.next()){var l=v.value;if(F.util.arraysEqual(l,p)){d=!0;break}}}catch(g){i={error:g}}finally{try{v&&!v.done&&(o=m.return)&&o.call(m)}finally{if(i)throw i.error}}d||f.push(p)}if(f.length>1)throw new Z("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}},e.prototype.mergeFunction=function(t){var n=this;return F.tidy(function(){return tb(t,n.axis)})},e.prototype.computeOutputShape=function(t){var n,a;if(!(Array.isArray(t)&&Array.isArray(t[0])))throw new Z("A `Concatenate` layer should be called on a list of inputs.");var i=t,o=i[0].slice(),s=this.axis<0?o.length+this.axis:this.axis;try{for(var u=fe(i.slice(1)),c=u.next();!c.done;c=u.next()){var l=c.value;if(o[s]==null||l[s]==null){o[s]=null;break}o[s]+=l[s]}}catch(f){n={error:f}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(n)throw n.error}}return o},e.prototype.computeMask=function(t,n){var a=this;if(n==null)return null;if(!Array.isArray(n))throw new Z("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new Z("`inputs` should be an array for Concatenate");if(n.length!==t.length)throw new Z("Mismatch in the length of mask (".concat(n.length,") ")+"and the legnth of inputs (".concat(t.length,")"));return D.tidy(function(){var i=!0;if(n.forEach(function(c){if(c!=null){i=!1;return}}),i)return null;for(var o=[],s=0;s<t.length;++s)n[s]==null?o.push(D.cast(D.onesLike(t[s]),"bool")):n[s].rank<t[s].rank?o.push(D.expandDims(n[s],-1)):o.push(n[s]);var u=D.concat(o,a.axis);return D.all(u,-1,!1)})},e.prototype.getConfig=function(){var t={axis:this.axis},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Ys);xw.className="Concatenate";F.serialization.registerClass(xw);function bf(r,e){for(;r<0;)r+=e;return r}function i1e(r,e,t){if(r.shape.length>3||e.shape.length>3)throw new vt("batchDot is not implemented for tensors of 4D or higher rank yet");if(D.util.assert(r.shape.length>=2,function(){return"batchDot requires the rank of x to be >= 2, "+"but got ".concat(r.shape.length)}),D.util.assert(r.shape.length>=2,function(){return"batchDot requires the rank of y to be >= 2, "+"but got ".concat(e.shape.length)}),typeof t=="number"&&(t=[t,t]),r.dtype==="complex64"||e.dtype==="complex64")throw new vt("batchDot is not implemented for complex64-type Tensors yet.");var n=r.shape.length,a=e.shape.length;t==null&&(t=[n-1,a-2]);var i=t;return D.tidy(function(){var o;if(n>a){o=n-a;for(var s=[],u=0;u<o;++u)s.push(1);e=D.reshape(e,e.shape.concat(s))}else if(a>n){o=a-n;for(var s=[],u=0;u<o;++u)s.push(1);r=D.reshape(r,r.shape.concat(s))}else o=0;var c;if(r.shape.length===2&&e.shape.length===2)i[0]===i[1]?c=D.sum(D.mul(r,e),i[0]):c=D.sum(D.mul(D.transpose(r,[1,0]),e),i[1]);else{var l=i[0]!==r.shape.length-1,f=i[1]===e.shape.length-1;c=D.matMul(r,e,l,f)}if(o>0){var h=void 0;n>a?h=n+a-3:h=n-1;for(var p=[],u=h;u<h+o;++u)p.push(u);c=D.squeeze(c,p)}return c.shape.length===1&&(c=D.expandDims(c,1)),c})}var kw=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return n.axes=t.axes,n.normalize=t.normalize==null?!1:t.normalize,n.supportsMasking=!0,n.reshapeRequired=!1,n}return e.prototype.build=function(t){D.util.assert(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var n=t[0],a=t[1];if(n.length>3||a.length>3)throw new vt("Dot layer does not support tensors of 4D or higher rank yet.");var i=this.interpretAxes(n,a);if(n[i[0]]!==a[i[1]])throw new Z("Dimension incompatibility: "+"".concat(n[i[0]]," !== ").concat(a[i[1]]))},e.prototype.mergeFunction=function(t){if(t.length!==2)throw new Z("A `Dot` layer must be called on exactly 2 inputs, "+"but received ".concat(t.length," input(s)."));var n=t[0],a=t[1],i;return Array.isArray(this.axes)?i=this.axes.map(function(o,s){return bf(o,t[s].shape.length)}):i=[bf(this.axes,n.shape.length),bf(this.axes,a.shape.length)],this.normalize&&(n=$d(n,i[0]),a=$d(a,i[1])),i1e(n,a,i)},e.prototype.interpretAxes=function(t,n){var a;return Array.isArray(this.axes)?a=this.axes:a=[bf(this.axes,t.length),bf(this.axes,n.length)],a},e.prototype.computeOutputShape=function(t){D.util.assert(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var n=t[0].slice(),a=t[1].slice();if(n.length>3||a.length>3)throw new vt("Dot layer does not support tensors of 4D or higher rank yet.");var i=this.interpretAxes(n,a);n.splice(i[0],1),a.splice(i[1],1),a.splice(0,1);var o=n.concat(a);return o.length===1&&o.push(1),o},e.prototype.computeMask=function(t,n){return null},e.prototype.getConfig=function(){var t={axes:this.axes,normalize:this.normalize},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(Ys);kw.className="Dot";F.serialization.registerClass(kw);var Sw=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.stddev=t.stddev,n}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={stddev:this.stddev};return Object.assign(n,t),n},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=it(t),o=function(){return F.add(Hd(i.shape,0,a.stddev),i)},s=Rf(o,function(){return i},n.training||!1);return s})},e}(mt);Sw.className="GaussianNoise";F.serialization.registerClass(Sw);var Nw=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.rate=t.rate,n}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={rate:this.rate};return Object.assign(n,t),n},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n);var i=it(t);if(a.rate>0&&a.rate<1){var o=function(){var s=Math.sqrt(a.rate/(1-a.rate));return F.mul(i,Hd(i.shape,1,s))};return Rf(o,function(){return i},n.training||!1)}return i})},e}(mt);Nw.className="GaussianDropout";F.serialization.registerClass(Nw);var Tw=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n.rate=t.rate,n.noiseShape=t.noiseShape,n}return e.prototype._getNoiseShape=function(t){return this.noiseShape||it(t).shape},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=r.prototype.getConfig.call(this),n={rate:this.rate};return Object.assign(n,t),n},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){if(a.rate<1&&a.rate>0){var i=a._getNoiseShape(t),o=function(){var s=it(t),u=1.6732632423543772,c=1.0507009873554805,l=-u*c,f=F.greaterEqual(F.randomUniform(i),a.rate);f=Pi(f,"float32");var h=Math.pow((1-a.rate)*(1+a.rate*Math.pow(l,2)),-.5),p=-h*l*a.rate,d=F.add(F.mul(s,f),F.mul(F.add(f,-1),l));return F.add(F.mul(d,h),p)};return Rf(o,function(){return it(t)},n.training||!1)}return t})},e}(mt);Tw.className="AlphaDropout";F.serialization.registerClass(Tw);function Af(r,e,t,n,a,i){i===void 0&&(i=.001);var o;if(r.rank===2)o=D.batchNorm2d(r,e,t,n,a,i);else if(r.rank===3)o=D.batchNorm3d(r,e,t,n,a,i);else if(r.rank===4)o=D.batchNorm4d(r,e,t,n,a,i);else throw new vt("batchNormalization is not implemented for array of rank ".concat(r.rank," ")+"yet");return o}function o1e(r,e,t,n,a){return a===void 0&&(a=.001),F.tidy(function(){var i=D.moments(r,n),o=i.mean,s=i.variance,u=Af(r,o,s,t,e,a);return[u,o,s]})}function s1e(r,e,t,n,a){return a===void 0&&(a=.001),F.tidy(function(){var i,o,s=D.moments(r,n),u=s.mean,c=s.variance,l=[];try{for(var f=fe(di(0,r.rank)),h=f.next();!h.done;h=f.next()){var p=h.value;n.indexOf(p)!==-1?l.push(1):l.push(r.shape[p])}}catch(w){i={error:w}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}var d=F.reshape(u,l),m=F.reshape(c,l),v=e==null?null:F.reshape(e,l),g=t==null?null:F.reshape(t,l),y=Af(r,d,m,g,v,a);return[y,u,c]})}function u1e(r,e,t,n,a){return a===void 0&&(a=.001),F.util.arraysEqual(n.slice().sort(),di(0,r.rank-1))?o1e(r,e,t,n,a):s1e(r,e,t,n,a)}var Ew=function(r){se(e,r);function e(t){var n=this;return t==null&&(t={}),n=r.call(this,t)||this,n.supportsMasking=!0,n.axis=t.axis==null?-1:t.axis,n.momentum=t.momentum==null?.99:t.momentum,n.epsilon=t.epsilon==null?.001:t.epsilon,n.center=t.center==null?!0:t.center,n.scale=t.scale==null?!0:t.scale,n.betaInitializer=ur(t.betaInitializer||"zeros"),n.gammaInitializer=ur(t.gammaInitializer||"ones"),n.movingMeanInitializer=ur(t.movingMeanInitializer||"zeros"),n.movingVarianceInitializer=ur(t.movingVarianceInitializer||"ones"),n.betaConstraint=Wr(t.betaConstraint),n.gammaConstraint=Wr(t.gammaConstraint),n.betaRegularizer=cr(t.betaRegularizer),n.gammaRegularizer=cr(t.gammaRegularizer),n}return e.prototype.build=function(t){var n;t=Tt(t);var a=this.axis>=0?this.axis:this.axis+t.length,i=t[a];if(i==null)throw new Z("Axis ".concat(a," of input tensor should have a defined dimension but ")+"the layer received an input with shape "+"".concat(JSON.stringify(t),"."));this.inputSpec=[new Lr({ndim:t.length,axes:(n={},n[a]=i,n)})];var o=[i];this.scale&&(this.gamma=this.addWeight("gamma",o,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",o,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",o,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",o,null,this.movingVarianceInitializer,null,!1),this.built=!0},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=n.training==null?!1:n.training,o=it(t),s=o.shape,u=s.length,c=di(0,u),l=a.axis>=0?a.axis:a.axis+u;c.splice(l,1);var f=$s(1,u);f[l]=s[l];var h=c.slice();h.sort();var p=!F.util.arraysEqual(h,di(0,u).slice(0,u-1)),d=function(){if(p){var x=F.reshape(a.movingMean.read(),f),S=F.reshape(a.movingVariance.read(),f),T=a.center?F.reshape(a.beta.read(),f):null,E=a.scale?F.reshape(a.gamma.read(),f):null;return Af(o,x,S,T,E,a.epsilon)}else return Af(o,a.movingMean.read(),a.movingVariance.read(),a.beta==null?null:a.beta.read(),a.gamma==null?null:a.gamma.read(),a.epsilon)};if(!i)return d();var m=te(u1e(o,a.gamma.read(),a.beta.read(),c,a.epsilon),3),v=m[0],g=m[1],y=m[2],w=function(x,S,T){D.tidy(function(){var E=1-T,C=x.read(),R=D.mul(D.sub(C,S),E);x.write(D.sub(C,R))})},b=function(){w(a.movingMean,g,a.momentum),w(a.movingVariance,y,a.momentum)};return b(),v})},e.prototype.getConfig=function(){var t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:yr(this.betaInitializer),gammaInitializer:yr(this.gammaInitializer),movingMeanInitializer:yr(this.movingMeanInitializer),movingVarianceInitializer:yr(this.movingVarianceInitializer),betaRegularizer:qt(this.betaRegularizer),gammaRegularizer:qt(this.gammaRegularizer),betaConstraint:qr(this.betaConstraint),gammaConstraint:qr(this.gammaConstraint)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);Ew.className="BatchNormalization";F.serialization.registerClass(Ew);var Iw=function(r){se(e,r);function e(t){var n,a,i=this;if(t==null&&(t={}),i=r.call(this,t)||this,i.axis=t.axis==null?-1:t.axis,typeof i.axis=="number"){if(!Number.isInteger(i.axis))throw new Error("Expected axis to be an integer, but received ".concat(i.axis))}else if(Array.isArray(i.axis))try{for(var o=fe(i.axis),s=o.next();!s.done;s=o.next()){var u=s.value;if(!Number.isInteger(u))throw new Error("Expected axis to be an array of integers, "+"but received ".concat(JSON.stringify(i.axis)))}}catch(c){n={error:c}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(n)throw n.error}}else throw new Error("Expected axis to be an integer or an array of integers, "+"but received ".concat(JSON.stringify(i.axis)));return i.epsilon=t.epsilon==null?.001:t.epsilon,i.center=t.center==null?!0:t.center,i.scale=t.scale==null?!0:t.scale,i.betaInitializer=ur(t.betaInitializer||"zeros"),i.gammaInitializer=ur(t.gammaInitializer||"ones"),i.betaRegularizer=cr(t.betaRegularizer),i.gammaRegularizer=cr(t.gammaRegularizer),i.supportsMasking=!0,i}return e.prototype.build=function(t){var n,a;t=Tt(t);var i=t.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(var o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=i);try{for(var s=fe(this.axis),u=s.next();!u.done;u=s.next()){var c=u.value;if(c<0||c>=i)throw new Error("Invalid axis: ".concat(c))}}catch(h){n={error:h}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}if(this.axis.length!==Go(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));var l=this.axis.map(function(h){return t[h]}),f=!0;this.scale?this.gamma=this.addWeight("gamma",l,"float32",this.gammaInitializer,this.gammaRegularizer,f):this.gamma=null,this.center?this.beta=this.addWeight("beta",l,"float32",this.betaInitializer,this.betaRegularizer,f):this.beta=null,this.built=!0},e.prototype.call=function(t,n){var a=this,i=it(t),o=i.shape,s=o.length;return F.tidy(function(){var u,c,l=!0,f=F.moments(i,a.axis,l),h=f.mean,p=f.variance,d=$s(1,s);try{for(var m=fe(a.axis),v=m.next();!v.done;v=m.next()){var g=v.value;d[g]=o[g]}}catch(E){u={error:E}}finally{try{v&&!v.done&&(c=m.return)&&c.call(m)}finally{if(u)throw u.error}}for(var y=function(E){return E!=null&&E.shape.length!==s?D.reshape(E,d):E},w=a.scale?y(a.gamma.read()):null,b=a.center?y(a.beta.read()):null,x=[],S=[],T=0;T<s;++T)a.axis.indexOf(T)!==-1?(x.push(o[T]),S.push(1)):(x.push(1),S.push(o[T]));return h=D.tile(h,x),p=D.tile(p,x),w!=null&&(w=D.tile(w,S)),b!=null&&(b=D.tile(b,S)),Af(i,h,p,b,w,a.epsilon)})},e.prototype.getConfig=function(){var t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:yr(this.betaInitializer),gammaInitializer:yr(this.gammaInitializer),betaRegularizer:qt(this.betaRegularizer),gammaRegularizer:qt(this.gammaRegularizer)},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);Iw.className="LayerNormalization";F.serialization.registerClass(Iw);function c1e(r,e,t){return F.tidy(function(){if(r.rank!==4)throw new Z("temporalPadding expects input tensor to be 4-D, but received a "+"".concat(r.rank,"-D tensor."));if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new Z("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=vi()),t!=="channelsLast"&&t!=="channelsFirst")throw new Z("Unknown data format: ".concat(t,". ")+"Supported data formats are 'channelsLast' and 'channelsFirst.");var n;return t==="channelsFirst"?n=[[0,0],[0,0],e[0],e[1]]:n=[[0,0],e[0],e[1],[0,0]],D.pad(r,n)})}var Cw=function(r){se(e,r);function e(t){var n=this;if(t==null&&(t={}),n=r.call(this,t)||this,n.dataFormat=t.dataFormat==null?vi():t.dataFormat,t.padding==null)n.padding=[[1,1],[1,1]];else if(typeof t.padding=="number")n.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,t.padding.length!==2)throw new Z("ZeroPadding2D expects padding to be a length-2 array, but "+"received a length-".concat(t.padding.length," array."));var a=void 0,i=void 0;if(typeof t.padding[0]=="number")a=[t.padding[0],t.padding[0]],i=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,t.padding[0].length!==2)throw new Z("ZeroPadding2D expects height padding to be a length-2 array, "+"but received a length-".concat(t.padding[0].length," array."));if(a=t.padding[0],t.padding[1].length!==2)throw new Z("ZeroPadding2D expects width padding to be a length-2 array, "+"but received a length-".concat(t.padding[1].length," array."));i=t.padding[1]}n.padding=[a,i]}return n.inputSpec=[new Lr({ndim:4})],n}return e.prototype.computeOutputShape=function(t){t=Tt(t);var n,a;return this.dataFormat==="channelsFirst"?(t[2]!=null&&t[2]>=0?n=t[2]+this.padding[0][0]+this.padding[0][1]:n=null,t[3]!=null&&t[3]>=0?a=t[3]+this.padding[1][0]+this.padding[1][1]:a=null,[t[0],t[1],n,a]):(t[1]!=null&&t[1]>=0?n=t[1]+this.padding[0][0]+this.padding[0][1]:n=null,t[2]!=null&&t[2]>=0?a=t[2]+this.padding[1][0]+this.padding[1][1]:a=null,[t[0],n,a,t[3]])},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){return c1e(it(t),a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={padding:this.padding,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);Cw.className="ZeroPadding2D";F.serialization.registerClass(Cw);function gv(r,e,t,n,a,i){return F.tidy(function(){Dr(a),bP(i),ga(n),t==null&&(t=[1,1]),n==null&&(n="valid"),a==null&&(a=vi()),i==null&&(i="max"),r=Xb(r,a);var o,s=n==="same"?"same":"valid";return i==="max"?o=D.maxPool(r,e,t,s):o=D.avgPool(r,e,t,s),a==="channelsFirst"&&(o=D.transpose(o,[0,3,1,2])),o})}function z4(r,e,t,n,a,i){return F.tidy(function(){Dr(a),bP(i),ga(n),t==null&&(t=[1,1,1]),n==null&&(n="valid"),a==null&&(a=vi()),i==null&&(i="max"),r=R4(r,a);var o,s=n==="same"?"same":"valid";return i==="max"?o=D.maxPool3d(r,e,t,s):o=D.avgPool3d(r,e,t,s),a==="channelsFirst"&&(o=D.transpose(o,[0,4,1,2,3])),o})}var $4=function(r){se(e,r);function e(t){var n=this;if(t.poolSize==null&&(t.poolSize=2),n=r.call(this,t)||this,typeof t.poolSize=="number")n.poolSize=[t.poolSize];else if(Array.isArray(t.poolSize)&&t.poolSize.length===1&&typeof t.poolSize[0]=="number")n.poolSize=t.poolSize;else throw new Z("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(t.poolSize)));if(jr(n.poolSize,"poolSize"),t.strides==null)n.strides=n.poolSize;else if(typeof t.strides=="number")n.strides=[t.strides];else if(Array.isArray(t.strides)&&t.strides.length===1&&typeof t.strides[0]=="number")n.strides=t.strides;else throw new Z("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(t.strides)));return jr(n.strides,"strides"),n.padding=t.padding==null?"valid":t.padding,ga(n.padding),n.inputSpec=[new Lr({ndim:3})],n}return e.prototype.computeOutputShape=function(t){t=Tt(t);var n=pi(t[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],n,t[2]]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){a.invokeCallHook(t,n),t=_f(it(t),2);var i=a.poolingFunction(it(t),[a.poolSize[0],1],[a.strides[0],1],a.padding,"channelsLast");return D.squeeze(i,[2])})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt),Aw=function(r){se(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return Dr(o),ga(i),gv(t,n,a,i,o,"max")},e}($4);Aw.className="MaxPooling1D";F.serialization.registerClass(Aw);var Dw=function(r){se(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return Dr(o),ga(i),gv(t,n,a,i,o,"avg")},e}($4);Dw.className="AveragePooling1D";F.serialization.registerClass(Dw);var q4=function(r){se(e,r);function e(t){var n=this;if(t.poolSize==null&&(t.poolSize=[2,2]),n=r.call(this,t)||this,n.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],t.strides==null)n.strides=n.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==2)throw new Z("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+"".concat(t.strides.length,"."));n.strides=t.strides}else n.strides=[t.strides,t.strides];return jr(n.poolSize,"poolSize"),jr(n.strides,"strides"),n.padding=t.padding==null?"valid":t.padding,n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Dr(n.dataFormat),ga(n.padding),n.inputSpec=[new Lr({ndim:4})],n}return e.prototype.computeOutputShape=function(t){t=Tt(t);var n=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2];return n=pi(n,this.poolSize[0],this.padding,this.strides[0]),a=pi(a,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,a]:[t[0],n,a,t[3]]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){return a.invokeCallHook(t,n),a.poolingFunction(it(t),a.poolSize,a.strides,a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt),_w=function(r){se(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return Dr(o),ga(i),gv(t,n,a,i,o,"max")},e}(q4);_w.className="MaxPooling2D";F.serialization.registerClass(_w);var Fw=function(r){se(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return Dr(o),ga(i),gv(t,n,a,i,o,"avg")},e}(q4);Fw.className="AveragePooling2D";F.serialization.registerClass(Fw);var W4=function(r){se(e,r);function e(t){var n=this;if(t.poolSize==null&&(t.poolSize=[2,2,2]),n=r.call(this,t)||this,n.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],t.strides==null)n.strides=n.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==3)throw new Z("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+"".concat(t.strides.length,"."));n.strides=t.strides}else n.strides=[t.strides,t.strides,t.strides];return jr(n.poolSize,"poolSize"),jr(n.strides,"strides"),n.padding=t.padding==null?"valid":t.padding,n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Dr(n.dataFormat),ga(n.padding),n.inputSpec=[new Lr({ndim:5})],n}return e.prototype.computeOutputShape=function(t){t=Tt(t);var n=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[4]:t[3];return n=pi(n,this.poolSize[0],this.padding,this.strides[0]),a=pi(a,this.poolSize[1],this.padding,this.strides[1]),i=pi(i,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[t[0],t[1],n,a,i]:[t[0],n,a,i,t[4]]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){return a.invokeCallHook(t,n),a.poolingFunction(it(t),a.poolSize,a.strides,a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt),Rw=function(r){se(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return Dr(o),ga(i),z4(t,n,a,i,o,"max")},e}(W4);Rw.className="MaxPooling3D";F.serialization.registerClass(Rw);var Ow=function(r){se(e,r);function e(t){return r.call(this,t)||this}return e.prototype.poolingFunction=function(t,n,a,i,o){return Dr(o),ga(i),z4(t,n,a,i,o,"avg")},e}(W4);Ow.className="AveragePooling3D";F.serialization.registerClass(Ow);var V4=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return n.inputSpec=[new Lr({ndim:3})],n}return e.prototype.computeOutputShape=function(t){return[t[0],t[2]]},e.prototype.call=function(t,n){throw new vt},e}(mt),Pw=function(r){se(e,r);function e(t){return r.call(this,t||{})||this}return e.prototype.call=function(t,n){return F.tidy(function(){var a=it(t);return D.mean(a,1)})},e}(V4);Pw.className="GlobalAveragePooling1D";F.serialization.registerClass(Pw);var Mw=function(r){se(e,r);function e(t){return r.call(this,t||{})||this}return e.prototype.call=function(t,n){return F.tidy(function(){var a=it(t);return D.max(a,1)})},e}(V4);Mw.className="GlobalMaxPooling1D";F.serialization.registerClass(Mw);var U4=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return n.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Dr(n.dataFormat),n.inputSpec=[new Lr({ndim:4})],n}return e.prototype.computeOutputShape=function(t){return t=t,this.dataFormat==="channelsLast"?[t[0],t[3]]:[t[0],t[1]]},e.prototype.call=function(t,n){throw new vt},e.prototype.getConfig=function(){var t={dataFormat:this.dataFormat},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt),Bw=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=it(t);return a.dataFormat==="channelsLast"?D.mean(i,[1,2]):D.mean(i,[2,3])})},e}(U4);Bw.className="GlobalAveragePooling2D";F.serialization.registerClass(Bw);var Lw=function(r){se(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=it(t);return a.dataFormat==="channelsLast"?D.max(i,[1,2]):D.max(i,[2,3])})},e}(U4);Lw.className="GlobalMaxPooling2D";F.serialization.registerClass(Lw);var G4=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return n.layer=t.layer,n}return e.prototype.build=function(t){this.built=!0},Object.defineProperty(e.prototype,"trainable",{get:function(){return this.layer!=null?this.layer.trainable:!1},set:function(t){this.layer!=null&&(this.layer.trainable=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!1,configurable:!0}),e.prototype.getWeights=function(){return this.layer.getWeights()},e.prototype.setWeights=function(t){this.layer.setWeights(t)},e.prototype.getConfig=function(){var t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.setFastWeightInitDuringBuild=function(t){r.prototype.setFastWeightInitDuringBuild.call(this,t),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(t)},e.fromConfig=function(t,n,a){a===void 0&&(a={});var i=n.layer,o=hi(i,a);delete n.layer;var s={layer:o};return Object.assign(s,n),new t(s)},e}(mt),zw=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return n.supportsMasking=!0,n}return e.prototype.build=function(t){if(t=Tt(t),t.length<3)throw new Z("TimeDistributed layer expects an input shape >= 3D, but received "+"input shape ".concat(JSON.stringify(t)));this.inputSpec=[{shape:t}];var n=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),r.prototype.build.call(this,t)},e.prototype.computeOutputShape=function(t){t=Tt(t);var n=[t[0]].concat(t.slice(2)),a=this.layer.computeOutputShape(n),i=t[1];return[a[0],i].concat(a.slice(1))},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){t=it(t);var i=function(u,c){var l=it(a.layer.call(u,n));return[l,[]]},o=B4(i,t,[],!1,null,null,!1,!0),s=o[1];return s})},e}(G4);zw.className="TimeDistributed";F.serialization.registerClass(zw);function l1e(r){Ws(Jhe,"BidirectionalMergeMode",r)}var f1e="concat",$w=function(r){se(e,r);function e(t){var n=r.call(this,t)||this,a=t.layer.getConfig(),i={};i.className=t.layer.getClassName(),i.config=a,n.forwardLayer=hi(i),a.goBackwards=a.goBackwards!==!0;var o={};if(o.className=t.layer.getClassName(),o.config=a,n.backwardLayer=hi(o),n.forwardLayer.name="forward_"+n.forwardLayer.name,n.backwardLayer.name="backward_"+n.backwardLayer.name,n.mergeMode=t.mergeMode===void 0?f1e:t.mergeMode,l1e(n.mergeMode),t.weights)throw new vt("weights support is not implemented for Bidirectional layer yet.");return n._stateful=t.layer.stateful,n.returnSequences=t.layer.returnSequences,n.returnState=t.layer.returnState,n.supportsMasking=!0,n._trainable=!0,n.inputSpec=t.layer.inputSpec,n.numConstants=null,n}return Object.defineProperty(e.prototype,"trainable",{get:function(){return this._trainable},set:function(t){this._trainable=t,this.forwardLayer!=null&&(this.forwardLayer.trainable=t),this.backwardLayer!=null&&(this.backwardLayer.trainable=t)},enumerable:!1,configurable:!0}),e.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},e.prototype.setWeights=function(t){var n=t.length,a=Math.floor(n/2);this.forwardLayer.setWeights(t.slice(0,a)),this.backwardLayer.setWeights(t.slice(a))},e.prototype.computeOutputShape=function(t){var n=this.forwardLayer.computeOutputShape(t);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;var a,i,o;return this.returnState&&(o=n.slice(1)),a=n[0],a=a,this.mergeMode==="concat"?(a[a.length-1]*=2,i=[a]):this.mergeMode==null?i=[a,a.slice()]:i=[a],this.returnState?this.mergeMode==null?i.concat(o).concat(o.slice()):[a].concat(o).concat(o.slice()):Dn(i)},e.prototype.apply=function(t,n){var a,i,o=n==null?null:n.initialState,s=n==null?null:n.constants;n==null&&(n={});var u=M4(t,o,s,this.numConstants);if(t=u.inputs,o=u.initialState,s=u.constants,Array.isArray(t)&&(o=t.slice(1),t=t[0]),(o==null||o.length===0)&&s==null)return r.prototype.apply.call(this,t,n);var c=[],l=[];if(o!=null){var f=o.length;if(f%2>0)throw new Z("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=o,c.push.apply(c,Je([],te(o),!1));var h=o.map(function(x){return new Lr({shape:x.shape})});this.forwardLayer.stateSpec=h.slice(0,f/2),this.backwardLayer.stateSpec=h.slice(f/2),l.push.apply(l,Je([],te(h),!1))}if(s!=null)throw new vt("Support for constants in Bidirectional layers is not implemented yet.");var p=c[0]instanceof fi;try{for(var d=fe(c),m=d.next();!m.done;m=d.next()){var v=m.value;if(v instanceof fi!==p)throw new Z("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}}catch(x){a={error:x}}finally{try{m&&!m.done&&(i=d.return)&&i.call(d)}finally{if(a)throw a.error}}if(p){var g=[t].concat(c),y=this.inputSpec.concat(l),w=this.inputSpec;this.inputSpec=y;var b=r.prototype.apply.call(this,g,n);return this.inputSpec=w,b}else return r.prototype.apply.call(this,t,n)},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=n.initialState,o,s;if(i==null)o=a.forwardLayer.call(t,n),s=a.backwardLayer.call(t,n);else{var u=i.slice(0,i.length/2),c=i.slice(i.length/2);o=a.forwardLayer.call(t,Object.assign(n,{initialState:u})),s=a.backwardLayer.call(t,Object.assign(n,{initialState:c}))}var l;a.returnState&&(Array.isArray(o)&&(l=o.slice(1).concat(s.slice(1))),o=o[0],s=s[0]),a.returnSequences&&(s=D.reverse(s,1));var f;return a.mergeMode==="concat"?f=tb([o,s]):a.mergeMode==="sum"?f=D.add(o,s):a.mergeMode==="ave"?f=D.mul(.5,D.add(o,s)):a.mergeMode==="mul"?f=D.mul(o,s):a.mergeMode==null&&(f=[o,s]),a.returnState?a.mergeMode==null?f.concat(l):[f].concat(l):f})},e.prototype.resetStates=function(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},e.prototype.build=function(t){var n=this;Ls(this.forwardLayer.name,function(){n.forwardLayer.build(t)}),Ls(this.backwardLayer.name,function(){n.backwardLayer.build(t)}),this.built=!0},e.prototype.computeMask=function(t,n){Array.isArray(n)&&(n=n[0]);var a;if(this.returnSequences?this.mergeMode==null?a=[n,n]:a=n:this.mergeMode==null?a=[null,null]:a=null,this.returnState){var i=this.forwardLayer.states,o=i.map(function(s){return null});return Array.isArray(a)?a.concat(o).concat(o):[a].concat(o).concat(o)}else return a},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!1,configurable:!0}),e.prototype.setFastWeightInitDuringBuild=function(t){r.prototype.setFastWeightInitDuringBuild.call(this,t),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(t),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(t)},e.prototype.getConfig=function(){var t={mergeMode:this.mergeMode},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.fromConfig=function(t,n){var a=hi(n.layer);if(delete n.layer,n.numConstants!=null)throw new vt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var i=n;return i.layer=a,new t(i)},e}(G4);$w.className="Bidirectional";F.serialization.registerClass($w);var qw=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return n.scale=t.scale,t.offset?n.offset=t.offset:n.offset=0,n}return e.prototype.getConfig=function(){var t={scale:this.scale,offset:this.offset},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){return t=it(t),t.dtype!=="float32"&&(t=Pi(t,"float32")),F.add(F.mul(t,a.scale),a.offset)})},e}(mt);qw.className="Rescaling";F.serialization.registerClass(qw);var h1e=F.image.resizeBilinear,p1e=F.image.cropAndResize,Ww=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return n.height=t.height,n.width=t.width,n}return e.prototype.centerCrop=function(t,n,a,i,o,s,u,c){return F.tidy(function(){var l,f=!1,h=n/s,p=a/u,d=(i+n)/s,m=(o+a)/u,v=[h,p,d,m],g=[];t.rank===3?(f=!0,l=F.stack([t])):l=t;for(var y=0;y<l.shape[0];y++)g.push(v);var w=F.tensor(g,[g.length,4]),b=F.range(0,g.length,1,"int32"),x=[i,o],S=p1e(l,w,b,x,"nearest");return Pi(f?it(F.unstack(S)):S,c)})},e.prototype.upsize=function(t,n,a,i){return F.tidy(function(){var o=h1e(t,[n,a]);return Pi(o,i)})},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=it(t),o=i.dtype,s=i.shape,u=s[s.length-3],c=s[s.length-2],l=0;u!==a.height&&(l=Math.floor((u-a.height)/2));var f=0;return c!==a.width&&(f=Math.floor((c-a.width)/2),f===0&&(f=1)),l>=0&&f>=0?a.centerCrop(i,l,f,a.height,a.width,u,c,o):a.upsize(t,a.height,a.width,o)})},e.prototype.getConfig=function(){var t={height:this.height,width:this.width},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.computeOutputShape=function(t){t=Tt(t);var n=t.length-3,a=t.length-2;return t[n]=this.height,t[a]=this.width,t},e}(mt);Ww.className="CenterCrop";F.serialization.registerClass(Ww);function d1e(r,e,t,n){var a=it(r);if(a.dtype!=="int32"&&(a=Pi(a,"int32")),e==="int")return a;var i=a.shape;if(a.rank===0&&(a=F.expandDims(a,-1)),e==="oneHot"&&a.shape[a.shape.length-1]!==1&&(a=F.expandDims(a,-1)),a.rank>2)throw new Z("When outputMode is not int, maximum output rank is 2"+" Received outputMode ".concat(e," and input shape ").concat(i)+" which would result in output rank ".concat(a.rank,"."));var o=["multiHot","oneHot"].includes(e),s=a,u;if(typeof n<"u"&&e==="count"?u=F.denseBincount(s,n,t,o):u=F.denseBincount(s,[],t,o),e!=="tfIdf")return u;if(n)return F.mul(u,n);throw new Z("When outputMode is 'tfIdf', weights must be provided.")}var Vw=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return n.numTokens=t.numTokens,t.outputMode?n.outputMode=t.outputMode:n.outputMode="multiHot",n}return e.prototype.getConfig=function(){var t={numTokens:this.numTokens,outputMode:this.outputMode},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.computeOutputShape=function(t){return t=Tt(t),t==null?[this.numTokens]:this.outputMode==="oneHot"&&t[t.length-1]!==1?(t.push(this.numTokens),t):(t[t.length-1]=this.numTokens,t)},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){t=it(t),t.dtype!=="int32"&&(t=Pi(t,"int32"));var i;if(typeof n.countWeights<"u"){if(a.outputMode!=="count")throw new Z(`countWeights is not used when outputMode !== count.
              Received countWeights=`.concat(n.countWeights));i=it(n.countWeights)}var o=F.max(t),s=F.min(t),u=F.greater(a.numTokens,o).bufferSync().get(0),c=F.greaterEqual(s,0).bufferSync().get(0);if(!(u&&c))throw new Z("Input values must be between 0 < values <="+" numTokens with numTokens=".concat(a.numTokens));return d1e(t,a.outputMode,a.numTokens,i)})},e}(mt);Vw.className="CategoryEncoding";F.serialization.registerClass(Vw);var v1e=["bilinear","nearest"],hP=new Set(v1e),Uw=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;if(n.height=t.height,n.width=t.width,t.interpolation)if(hP.has(t.interpolation))n.interpolation=t.interpolation;else throw new Z("Invalid interpolation parameter: ".concat(t.interpolation," is not implemented"));else n.interpolation="bilinear";return n.cropToAspectRatio=Boolean(t.cropToAspectRatio),n}return e.prototype.computeOutputShape=function(t){t=Tt(t);var n=t[2];return[this.height,this.width,n]},e.prototype.getConfig=function(){var t={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=[a.height,a.width];if(a.interpolation==="bilinear")return F.image.resizeBilinear(t,i,!a.cropToAspectRatio);if(a.interpolation==="nearest")return F.image.resizeNearestNeighbor(t,i,!a.cropToAspectRatio);throw new Error("Interpolation is ".concat(a.interpolation," but only ").concat(Je([],te(hP),!1)," are supported"))})},e}(mt);Uw.className="Resizing";F.serialization.registerClass(Uw);var H4=function(){function r(e){this.seed=e}return r.prototype.next=function(){if(this.seed!==void 0)return this.seed++},r}();H4.className="RandomSeed";var K4=function(r){se(e,r);function e(t){var n=r.call(this,t)||this;return n.randomGenerator=new H4(t.seed),n}return e.prototype.getConfig=function(){var t={seed:this.randomGenerator.seed},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e}(mt);K4.className="BaseRandomLayer";var m1e=["bilinear","nearest"],pP=new Set(m1e),Gw=function(r){se(e,r);function e(t){var n=r.call(this,t)||this,a=t.factor,i=t.interpolation,o=i===void 0?"bilinear":i;if(n.factor=a,Array.isArray(n.factor)&&n.factor.length===2)n.widthLower=n.factor[0],n.widthUpper=n.factor[1];else if(!Array.isArray(n.factor)&&n.factor>0)n.widthLower=-n.factor,n.widthUpper=n.factor;else throw new Z("Invalid factor: ".concat(n.factor,". Must be positive number or tuple of 2 numbers"));if(n.widthLower<-1||n.widthUpper<-1)throw new Z("factor must have values larger than -1. Got: ".concat(n.factor));if(n.widthUpper<n.widthLower)throw new Z(`factor cannot have upper bound less than lower bound.
        Got upper bound: `.concat(n.widthUpper,`.
        Got lower bound: `).concat(n.widthLower,`
      `));if(o)if(pP.has(o))n.interpolation=o;else throw new Z("Invalid interpolation parameter: ".concat(o," is not implemented"));return n}return e.prototype.getConfig=function(){var t={factor:this.factor,interpolation:this.interpolation},n=r.prototype.getConfig.call(this);return Object.assign(t,n),t},e.prototype.computeOutputShape=function(t){t=Tt(t);var n=t[2];return[this.imgHeight,-1,n]},e.prototype.call=function(t,n){var a=this;return F.tidy(function(){var i=it(t);a.imgHeight=i.shape[i.shape.length-3];var o=i.shape[i.shape.length-2];a.widthFactor=F.randomUniform([1],1+a.widthLower,1+a.widthUpper,"float32",a.randomGenerator.next());var s=a.widthFactor.dataSync()[0]*o;s=Math.round(s);var u=[a.imgHeight,s];switch(a.interpolation){case"bilinear":return F.image.resizeBilinear(t,u);case"nearest":return F.image.resizeNearestNeighbor(t,u);default:throw new Error("Interpolation is ".concat(a.interpolation,`
          but only `).concat(Je([],te(pP),!1)," are supported"))}})},e}(K4);Gw.className="RandomWidth";F.serialization.registerClass(Gw);function g1e(r){return new bc(r)}function y1e(r){return new Hb(r)}function b1e(r){return new Vb(r)}function w1e(r){return new Ub(r)}function x1e(r){return new Gb(r)}function k1e(r){return new jb(r)}function S1e(r){return new Kb(r)}function N1e(r){return new Qb(r)}function T1e(r){return new lv(r)}function E1e(r){return new Yb(r)}function I1e(r){return new fv(r)}function C1e(r){return new Zb(r)}function A1e(r){return new Jb(r)}function D1e(r){return new ew(r)}function _1e(r){return new tw(r)}function F1e(r){return new rw(r)}function R1e(r){return new lw(r)}function O1e(r){return new uw(r)}function P1e(r){return new mv(r)}function M1e(r){return new sw(r)}function B1e(r){return new cw(r)}function L1e(r){return new fw(r)}function z1e(r){return new hw(r)}function $1e(r){return new pw(r)}function q1e(r){return new vw(r)}function W1e(r){return new mw(r)}function V1e(r){return new yw(r)}function U1e(r){return new xw(r)}function G1e(r){return new bw(r)}function H1e(r){return new ww(r)}function K1e(r){return new gw(r)}function j1e(r){return new kw(r)}function X1e(r){return new Ew(r)}function Y1e(r){return new Iw(r)}function Z1e(r){return new Cw(r)}function Hw(r){return new Dw(r)}function J1e(r){return Hw(r)}function Q1e(r){return Hw(r)}function Kw(r){return new Fw(r)}function exe(r){return Kw(r)}function txe(r){return Kw(r)}function jw(r){return new Ow(r)}function rxe(r){return jw(r)}function nxe(r){return jw(r)}function axe(r){return new Pw(r)}function ixe(r){return new Bw(r)}function j4(r){return new Mw(r)}function X4(r){return new Lw(r)}function Y4(r){return new Aw(r)}function Z4(r){return new _w(r)}function oxe(r){return new Rw(r)}function sxe(r){return new aw(r)}function uxe(r){return new pv(r)}function cxe(r){return new iw(r)}function lxe(r){return new Lf(r)}function fxe(r){return new nw(r)}function hxe(r){return new hv(r)}function pxe(r){return new ow(r)}function dxe(r){return new vv(r)}function vxe(r){return new oo(r)}function mxe(r){return new dv(r)}function gxe(r){return new $w(r)}function yxe(r){return new zw(r)}var bxe=j4,wxe=X4,xxe=Y4,kxe=Z4;function Sxe(r){return new Sw(r)}function Nxe(r){return new Nw(r)}function Txe(r){return new Tw(r)}function Exe(r){return new dw(r)}function Ixe(r){return new qw(r)}function Cxe(r){return new Ww(r)}function Axe(r){return new Uw(r)}function Dxe(r){return new Vw(r)}function _xe(r){return new Gw(r)}var Fxe={__proto__:null,Layer:mt,RNN:oo,RNNCell:kc,activation:R1e,add:W1e,alphaDropout:Txe,average:V1e,averagePooling1d:Hw,averagePooling2d:Kw,averagePooling3d:jw,avgPool1d:J1e,avgPool2d:exe,avgPool3d:rxe,avgPooling1d:Q1e,avgPooling2d:txe,avgPooling3d:nxe,batchNormalization:X1e,bidirectional:gxe,categoryEncoding:Dxe,centerCrop:Cxe,concatenate:U1e,conv1d:N1e,conv2d:T1e,conv2dTranspose:E1e,conv3d:I1e,conv3dTranspose:C1e,convLstm2d:pxe,convLstm2dCell:dxe,cropping2D:D1e,dense:O1e,depthwiseConv2d:F1e,dot:j1e,dropout:P1e,elu:y1e,embedding:q1e,flatten:B1e,gaussianDropout:Nxe,gaussianNoise:Sxe,globalAveragePooling1d:axe,globalAveragePooling2d:ixe,globalMaxPool1d:bxe,globalMaxPool2d:wxe,globalMaxPooling1d:j4,globalMaxPooling2d:X4,gru:sxe,gruCell:uxe,input:y4,inputLayer:g1e,layerNormalization:Y1e,leakyReLU:w1e,lstm:cxe,lstmCell:lxe,masking:Exe,maxPool1d:xxe,maxPool2d:kxe,maxPooling1d:Y4,maxPooling2d:Z4,maxPooling3d:oxe,maximum:G1e,minimum:H1e,multiply:K1e,permute:$1e,prelu:x1e,randomWidth:_xe,reLU:b1e,repeatVector:L1e,rescaling:Ixe,reshape:z1e,resizing:Axe,rnn:vxe,separableConv2d:A1e,simpleRNN:fxe,simpleRNNCell:hxe,softmax:k1e,spatialDropout1d:M1e,stackedRNNCells:mxe,thresholdedReLU:S1e,timeDistributed:yxe,upSampling2d:_1e,zeroPadding2d:Z1e};function Rxe(r,e){return Bb(r,e)}function Oxe(r,e){return c4(r,e)}function Pxe(r,e){return l4(r,e)}function Mxe(r,e){return Lb(r,e)}function Bxe(r,e){return zb(r,e)}function Lxe(r,e){return u4(r,e)}function zxe(r,e){return gwe(r,e)}function $xe(r,e){return Mb(r,e)}function qxe(r,e){return ov(r,e)}function Wxe(r,e){return xc(r,e)}function Vxe(r,e){return xc(r,e)}function Uxe(r,e){return xc(r,e)}function Gxe(r,e){return Xs(r,e)}function Hxe(r,e){return Xs(r,e)}function Kxe(r,e){return Xs(r,e)}var jxe={__proto__:null,MAPE:Vxe,MSE:Hxe,binaryAccuracy:Rxe,binaryCrossentropy:Oxe,categoricalAccuracy:Mxe,categoricalCrossentropy:Bxe,cosineProximity:$xe,mape:Uxe,meanAbsoluteError:qxe,meanAbsolutePercentageError:Wxe,meanSquaredError:Gxe,mse:Kxe,precision:Lxe,recall:zxe,sparseCategoricalAccuracy:Pxe};var Xxe={__proto__:null,modelFromJSON:Hwe};function Yxe(r){return new Bf(r)}function Zxe(r){return Qwe(r)}function Jxe(r){return e1e(r)}var Qxe={__proto__:null,l1:Zxe,l1l2:Yxe,l2:Jxe},J4=function(r){se(e,r);function e(){var t=r.apply(this,Je([],te(arguments),!1))||this;return t.model=null,t}return e.prototype.setModel=function(t){if(!(t instanceof io))throw new Error("model must be a LayersModel, not some other Container");this.model=t},e}(yc);function kd(r,e){return r<e}function dP(r,e){return r>e}var Q4=function(r){se(e,r);function e(t){var n=r.call(this)||this;if(t==null&&(t={}),t.restoreBestWeights)throw new vt("restoreBestWeights = True is not implemented in EarlyStopping yet.");return n.monitor=t.monitor||"val_loss",n.minDelta=Math.abs(t.minDelta||0),n.patience=t.patience||0,n.verbose=t.verbose||0,n.mode=t.mode||"auto",n.baseline=t.baseline,["auto","min","max"].indexOf(n.mode)===-1&&(console.warn("EarlyStopping mode '".concat(n.mode,"' is invalid. ")+"Falling back to mode 'auto'."),n.mode="auto"),n.mode==="min"?n.monitorFunc=kd:n.mode==="max"||n.monitor.indexOf("acc")!==-1?n.monitorFunc=dP:n.monitorFunc=kd,n.monitorFunc===kd&&(n.minDelta*=-1),n}return e.prototype.onTrainBegin=function(t){return Ce(this,void 0,void 0,function(){return Ie(this,function(n){return this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===kd?1/0:-1/0,[2]})})},e.prototype.onEpochEnd=function(t,n){return Ce(this,void 0,void 0,function(){var a;return Ie(this,function(i){switch(i.label){case 0:return[4,Vo(n)];case 1:return i.sent(),a=this.getMonitorValue(n),a==null?[2]:(this.monitorFunc(a-this.minDelta,this.best)?(this.best=a,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=t,this.model.stopTraining=!0)),[2])}})})},e.prototype.onTrainEnd=function(t){return Ce(this,void 0,void 0,function(){return Ie(this,function(n){return this.stoppedEpoch>0&&this.verbose&&console.log("Epoch ".concat(this.stoppedEpoch,": early stopping.")),[2]})})},e.prototype.getMonitorValue=function(t){t==null&&(t={});var n=t[this.monitor];return n==null&&console.warn("Metric for EarlyStopping ".concat(this.monitor," is not available. ")+"Available metrics are: ".concat(Object.keys(t))),n},e}(J4);function eke(r){return new Q4(r)}var tke={earlyStopping:eke};lr.Callback=J4;lr.CallbackList=r4;lr.CustomCallback=a4;lr.EarlyStopping=Q4;lr.History=n4;lr.InputSpec=Lr;lr.LayerVariable=TP;lr.LayersModel=io;lr.RNN=oo;lr.Sequential=uv;lr.SymbolicTensor=fi;lr.callbacks=tke;lr.constraints=Wbe;lr.initializers=awe;lr.input=y4;lr.layers=Fxe;lr.loadLayersModel=Kwe;lr.metrics=jxe;lr.model=Ywe;lr.models=Xxe;lr.registerCallbackConstructor=Jwe;lr.regularizers=Qxe;lr.sequential=Zwe;lr.version_layers=$b});var KL=Y(uu=>{"use strict";var Be=Rs();function rke(r){var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}function nke(r,e){return e.forEach(function(t){t&&typeof t!="string"&&!Array.isArray(t)&&Object.keys(t).forEach(function(n){if(n!=="default"&&!(n in r)){var a=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(r,n,a.get?a:{enumerable:!0,get:function(){return t[n]}})}})}),r}var tB=rke(Be);var ake=Be.env();ake.registerFlag("KEEP_INTERMEDIATE_TENSORS",function(){return!1},function(r){r&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});var e1=function(r,e){return e1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},e1(r,e)};function RB(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");e1(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Pt(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(f){o(f)}}function u(l){try{c(n.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((n=n.apply(r,e||[])).next())})}function _t(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Xr(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function we(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function Dt(r,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}var Va;(function(r){r[r.DT_INVALID=0]="DT_INVALID",r[r.DT_FLOAT=1]="DT_FLOAT",r[r.DT_DOUBLE=2]="DT_DOUBLE",r[r.DT_INT32=3]="DT_INT32",r[r.DT_UINT8=4]="DT_UINT8",r[r.DT_INT16=5]="DT_INT16",r[r.DT_INT8=6]="DT_INT8",r[r.DT_STRING=7]="DT_STRING",r[r.DT_COMPLEX64=8]="DT_COMPLEX64",r[r.DT_INT64=9]="DT_INT64",r[r.DT_BOOL=10]="DT_BOOL",r[r.DT_QINT8=11]="DT_QINT8",r[r.DT_QUINT8=12]="DT_QUINT8",r[r.DT_QINT32=13]="DT_QINT32",r[r.DT_BFLOAT16=14]="DT_BFLOAT16",r[r.DT_QINT16=15]="DT_QINT16",r[r.DT_QUINT16=16]="DT_QUINT16",r[r.DT_UINT16=17]="DT_UINT16",r[r.DT_COMPLEX128=18]="DT_COMPLEX128",r[r.DT_HALF=19]="DT_HALF",r[r.DT_RESOURCE=20]="DT_RESOURCE",r[r.DT_VARIANT=21]="DT_VARIANT",r[r.DT_UINT32=22]="DT_UINT32",r[r.DT_UINT64=23]="DT_UINT64",r[r.DT_FLOAT_REF=101]="DT_FLOAT_REF",r[r.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",r[r.DT_INT32_REF=103]="DT_INT32_REF",r[r.DT_UINT8_REF=104]="DT_UINT8_REF",r[r.DT_INT16_REF=105]="DT_INT16_REF",r[r.DT_INT8_REF=106]="DT_INT8_REF",r[r.DT_STRING_REF=107]="DT_STRING_REF",r[r.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",r[r.DT_INT64_REF=109]="DT_INT64_REF",r[r.DT_BOOL_REF=110]="DT_BOOL_REF",r[r.DT_QINT8_REF=111]="DT_QINT8_REF",r[r.DT_QUINT8_REF=112]="DT_QUINT8_REF",r[r.DT_QINT32_REF=113]="DT_QINT32_REF",r[r.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",r[r.DT_QINT16_REF=115]="DT_QINT16_REF",r[r.DT_QUINT16_REF=116]="DT_QUINT16_REF",r[r.DT_UINT16_REF=117]="DT_UINT16_REF",r[r.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",r[r.DT_HALF_REF=119]="DT_HALF_REF",r[r.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",r[r.DT_VARIANT_REF=121]="DT_VARIANT_REF",r[r.DT_UINT32_REF=122]="DT_UINT32_REF",r[r.DT_UINT64_REF=123]="DT_UINT64_REF"})(Va||(Va={}));var rB;(function(r){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(r.CheckpointFormatVersion||(r.CheckpointFormatVersion={}))})(rB||(rB={}));var E1={};function ike(r,e){var t={tfOpName:r,category:"custom",inputs:[],attrs:[],customExecutor:e};E1[r]=t}function OB(r){return E1[r]}function oke(r){delete E1[r]}function I(r,e,t,n,a){var i=e.inputParams[r];if(i&&i.inputIndexStart!==void 0){var o=i.inputIndexStart,s=i.inputIndexEnd===0?void 0:i.inputIndexEnd===void 0?o+1:i.inputIndexEnd,u=o<0?e.inputNames.length+o:o;if(i.type==="tensor")return nn(e.inputNames[u],t,n,a);if(i.type==="tensors"){var c=e.inputs.slice(o,s),l=e.inputNames.slice(o,s).filter(function(d,m){var v;return((v=c[m])===null||v===void 0?void 0:v.op)!=="NoOp"});return l.map(function(d){return nn(d,t,n,a)})}var f=nn(e.inputNames[u],t,n,a),h=f.dataSync();return i.type==="number"?h[0]:Be.util.toNestedArray(f.shape,h)}var p=e.attrParams[r];return p&&p.value}function nn(r,e,t,n){var a=we(ta(r,t),2),i=a[0],o=a[1];if(n!=null){var s=n.getHashTableHandleByName(i);if(s!=null)return s}var u=t.currentContextIds.find(function(c){return!!e[Nv(i,c)]});return u!==void 0?e[Nv(i,u)][o]:void 0}function nB(r,e,t){return e[Nv(r,t.currentContextId)]}function so(r,e){var t=we(ta(r,e),3),n=t[0],a=t[1],i=t[2];return[Nv(n,e&&e.currentContextId),a,i]}function Nv(r,e){return e?"".concat(r,"-").concat(e):r}function ta(r,e){if(r==="")return["",0,void 0];var t=e!=null&&e.parseNodeNameCache!=null;if(t){var n=e.parseNodeNameCache.get(r);if(n!=null)return n}var a=r.split(":"),i;if(a.length===1)i=[r,0,void 0];else{var o=a[0],s=a.length===3?a[1]:void 0,u=Number(a[a.length-1]);i=[o,u,s]}return t&&e.parseNodeNameCache.set(r,i),i}function wv(r,e,t){var n=I("pad",r,e,t);if(n==="explicit"){n=I("explicitPaddings",r,e,t);for(var a=[[0,0],[0,0],[0,0],[0,0]],i=0;i<4;i++)a[i][0]=n[i*2],a[i][1]=n[i*2+1];return a}return n}function uo(r){return r.kept?r:Be.clone(r)}var ske=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],uke={__proto__:null,json:ske};var cke=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsFinite",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsInf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],lke={__proto__:null,json:cke};var fke=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],hke={__proto__:null,json:fke};var pke=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],dke={__proto__:null,json:pke};var vke=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniformInt",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number"},{tfName:"maxval",name:"maxval",type:"number"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],mke={__proto__:null,json:vke};var gke=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],yke={__proto__:null,json:gke};var bke=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],wke={__proto__:null,json:bke};var xke=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],kke={__proto__:null,json:xke};var Ske=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],Nke={__proto__:null,json:Ske};var Tke=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],Eke={__proto__:null,json:Tke};var Ike=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BitwiseAnd",category:"logical",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}]}],Cke={__proto__:null,json:Ike};var Ake=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"MatrixBandPart",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"numLower",type:"tensor"},{start:1,name:"numUpper",type:"tensor"}]}],Dke={__proto__:null,json:Ake};var _ke=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]}],Fke={__proto__:null,json:_ke};var Rke=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],Oke={__proto__:null,json:Rke};var Pke=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]},{tfOpName:"TensorScatterUpdate",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],Mke={__proto__:null,json:Pke};var Bke=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],Lke={__proto__:null,json:Bke};var zke=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],$ke={__proto__:null,json:zke};var qke=[{tfOpName:"StaticRegexReplace",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"pattern",name:"pattern",type:"string"},{tfName:"rewrite",name:"rewrite",type:"string"},{tfName:"replace_global",name:"replaceGlobal",type:"bool"}]},{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],Wke={__proto__:null,json:qke};var Vke=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"EnsureShape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],Uke={__proto__:null,json:Vke},aB=function(){function r(){var e=[uke,lke,hke,dke,mke,yke,wke,kke,Nke,Eke,Cke,Dke,Fke,Oke,Mke,Lke,$ke,Wke,Uke],t=[].concat.apply([],Dt([],we(e.map(function(n){return n.json})),!1));this.opMappers=t.reduce(function(n,a){return n[a.tfOpName]=a,n},{})}return Object.defineProperty(r,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!1,configurable:!0}),r.prototype.transformGraph=function(e,t){var n=this;t===void 0&&(t={});var a=e.node,i=[],o=[],s=[],u=a.reduce(function(v,g){return v[g.name]=n.mapNode(g),g.op.startsWith("Placeholder")?i.push(v[g.name]):g.op==="Const"?o.push(v[g.name]):(g.input==null||g.input.length===0)&&s.push(v[g.name]),v},{}),c=[],l=[],f={},h={};t!=null&&(f=this.mapSignatureEntries(t.inputs),h=this.mapSignatureEntries(t.outputs));var p=Object.keys(u);p.forEach(function(v){var g=u[v];g.inputNames.forEach(function(y,w){var b=we(so(y),3),x=b[0],S=b[2],T=u[x];if(T.outputs!=null){var E=T.outputs.indexOf(S);if(E!==-1){var C="".concat(x,":").concat(E);g.inputNames[w]=C}}g.inputs.push(T),T.children.push(g)})}),Object.keys(h).length===0?p.forEach(function(v){var g=u[v];g.children.length===0&&l.push(g)}):Object.keys(h).forEach(function(v){var g=we(so(v),1),y=g[0],w=u[y];w!=null&&(w.signatureKey=h[v],l.push(w))}),Object.keys(f).length>0?Object.keys(f).forEach(function(v){var g=we(so(v),1),y=g[0],w=u[y];w&&(w.signatureKey=f[v],c.push(w))}):c=i;var d={};e.library!=null&&e.library.function!=null&&(d=e.library.function.reduce(function(v,g){return v[g.signature.name]=n.mapFunction(g),v},{}));var m={nodes:u,inputs:c,outputs:l,weights:o,placeholders:i,signature:t,functions:d};return s.length>0&&(m.initNodes=s),m},r.prototype.mapSignatureEntries=function(e){return Object.keys(e||{}).reduce(function(t,n){return t[e[n].name]=n,t},{})},r.prototype.mapNode=function(e){var t=OB(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});var n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(function(a){return a.startsWith("^")?a.slice(1):a}),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return t.inputs!=null&&(n.inputParams=t.inputs.reduce(function(a,i){return a[i.name]={type:i.type,inputIndexStart:i.start,inputIndexEnd:i.end},a},{})),t.attrs!=null&&(n.attrParams=t.attrs.reduce(function(a,i){var o=i.type,s=void 0;switch(i.type){case"string":s=t1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=t1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"string[]":s=u1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=u1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number":s=n1(e.attr,i.tfName,i.defaultValue||0),s===void 0&&!!i.tfDeprecatedName&&(s=n1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number[]":s=s1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=s1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool":s=r1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=r1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool[]":s=l1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=l1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape":s=o1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=o1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape[]":s=c1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=c1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype":s=a1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=a1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype[]":s=i1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=i1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"func":s=iB(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=iB(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: ".concat(i.type," for op: ").concat(e.op))}return a[i.name]={value:s,type:o},a},{})),n},r.prototype.mapFunction=function(e){var t=this,n=e.nodeDef,a=[],i=[],o={};n!=null&&(o=n.reduce(function(h,p){return h[p.name]=t.mapNode(p),p.op==="Const"&&i.push(h[p.name]),h},{}));var s=[],u=[];e.signature.inputArg.forEach(function(h){var p=we(so(h.name),1),d=p[0],m={name:d,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:I1(h.type),type:"dtype"}},children:[]};m.signatureKey=h.name,s.push(m),o[d]=m});var c=Object.keys(o);c.forEach(function(h){var p=o[h];p.inputNames.forEach(function(d,m){var v=we(so(d),3),g=v[0],y=v[2],w=o[g];if(w.outputs!=null){var b=w.outputs.indexOf(y);if(b!==-1){var x="".concat(g,":").concat(b);p.inputNames[m]=x}}p.inputs.push(w),w.children.push(p)})});var l=e.ret;e.signature.outputArg.forEach(function(h){var p=we(so(l[h.name]),2),d=p[0],m=p[1],v=o[d];v!=null&&(v.defaultOutput=m,u.push(v))});var f=this.mapArgsToSignature(e);return{nodes:o,inputs:s,outputs:u,weights:i,placeholders:a,signature:f}},r.prototype.mapArgsToSignature=function(e){var t=this;return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce(function(n,a){return n[a.name]=t.mapArgToTensorInfo(a),n},{}),outputs:e.signature.outputArg.reduce(function(n,a){return n[a.name]=t.mapArgToTensorInfo(a,e.ret),n},{})}},r.prototype.mapArgToTensorInfo=function(e,t){var n=e.name;return t!=null&&(n=t[n]),{name:n,dtype:e.type}},r}();function Gke(r){var e=Be.env().global;if(typeof e.atob<"u")return e.atob(r);if(typeof Buffer<"u")return new Buffer(r,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function PB(r,e){var t=Array.isArray(r)?String.fromCharCode.apply(null,r):Gke(r);return e?t:t.toLowerCase()}function t1(r,e,t,n){n===void 0&&(n=!1);var a=r[e];return a!=null?PB(a.s,n):t}function r1(r,e,t){var n=r[e];return n?n.b:t}function n1(r,e,t){var n=r[e]||{},a=n.i!=null?n.i:n.f!=null?n.f:t;return typeof a=="number"?a:parseInt(a,10)}function I1(r){switch(typeof r=="string"&&(r=Va[r]),r){case Va.DT_FLOAT:case Va.DT_HALF:return"float32";case Va.DT_INT32:case Va.DT_INT64:case Va.DT_INT8:case Va.DT_UINT8:return"int32";case Va.DT_BOOL:return"bool";case Va.DT_DOUBLE:return"float32";case Va.DT_STRING:return"string";default:return null}}function iB(r,e,t){var n=r[e];return n&&n.func?n.func.name:t}function a1(r,e,t){var n=r[e];return n&&n.type?I1(n.type):t}function i1(r,e,t){var n=r[e];return n&&n.list&&n.list.type?n.list.type.map(function(a){return I1(a)}):t}function MB(r){if(!r.unknownRank)return r.dim!=null?r.dim.map(function(e){return typeof e.size=="number"?e.size:parseInt(e.size,10)}):[]}function o1(r,e,t){var n=r[e];return n&&n.shape?MB(n.shape):t}function s1(r,e,t){var n=r[e];return n?((n.list.f&&n.list.f.length?n.list.f:n.list.i)||[]).map(function(a){return typeof a=="number"?a:parseInt(a,10)}):t}function u1(r,e,t,n){n===void 0&&(n=!1);var a=r[e];return a&&a.list&&a.list.s?a.list.s.map(function(i){return PB(i,n)}):t}function c1(r,e,t){var n=r[e];return n&&n.list&&n.list.shape?n.list.shape.map(function(a){return MB(a)}):t}function l1(r,e,t){var n=r[e];return n&&n.list&&n.list.b?n.list.b:t}var Hke=function(){function r(e,t,n){var a=this;this.node=e,this.tensorMap=t,this.context=n,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(function(i){return a.getInput(i)}),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce(function(i,o){return i[o]=a.getAttr(o),i},{}))}return r.prototype.getInput=function(e){return nn(e,this.tensorMap,this.context)},r.prototype.getAttr=function(e,t){var n=this.node.rawAttrs[e];if(n.tensor!=null)return nn(e,this.tensorMap,this.context);if(n.i!=null||n.f!=null)return n1(this.node.rawAttrs,e,t);if(n.s!=null)return t1(this.node.rawAttrs,e,t);if(n.b!=null)return r1(this.node.rawAttrs,e,t);if(n.shape!=null)return o1(this.node.rawAttrs,e,t);if(n.type!=null)return a1(this.node.rawAttrs,e,t);if(n.list!=null){if(n.list.i!=null||n.list.f!=null)return s1(this.node.rawAttrs,e,t);if(n.list.s!=null)return u1(this.node.rawAttrs,e,t);if(n.list.shape!=null)return c1(this.node.rawAttrs,e,t);if(n.list.b!=null)return l1(this.node.rawAttrs,e,t);if(n.list.type!=null)return i1(this.node.rawAttrs,e,t)}return t},r}();var Kke=1e-7,jke=1e-4,Xke=function(){function r(){}return r.prototype.refCount=function(e){return ea("refCount")},r.prototype.incRef=function(e){return ea("incRef")},r.prototype.timerAvailable=function(){return!0},r.prototype.time=function(e){return ea("time")},r.prototype.read=function(e){return ea("read")},r.prototype.readSync=function(e){return ea("readSync")},r.prototype.readToGPU=function(e,t){return ea("readToGPU")},r.prototype.numDataIds=function(){return ea("numDataIds")},r.prototype.disposeData=function(e,t){return ea("disposeData")},r.prototype.write=function(e,t,n){return ea("write")},r.prototype.move=function(e,t,n,a,i){return ea("move")},r.prototype.createTensorFromGPUData=function(e,t,n){return ea("createTensorFromGPUData")},r.prototype.memory=function(){return ea("memory")},r.prototype.floatPrecision=function(){return ea("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?Kke:jke},r.prototype.dispose=function(){return ea("dispose")},r}();function ea(r){throw new Error("'".concat(r,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function G(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function Xa(r,e,t){t===void 0&&(t=""),G(au(r,e),function(){return t+" Shapes ".concat(r," and ").concat(e," must match")})}function Dc(r){G(r!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Mn(r){if(r.length===0)return 1;for(var e=r[0],t=1;t<r.length;t++)e*=r[t];return e}function Yke(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==null&&e[t]!==null&&r[t]!==e[t])return!1;return!0}function au(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function Kf(r){return r%1===0}function xv(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function Ov(r,e){var t=e.length;return r=r==null?e.map(function(n,a){return a}):[].concat(r),G(r.every(function(n){return n>=-t&&n<t}),function(){return"All values in axis param must be in range [-".concat(t,", ").concat(t,") but ")+"got axis ".concat(r)}),G(r.every(function(n){return Kf(n)}),function(){return"All values in axis param must be integers but "+"got axis ".concat(r)}),r.map(function(n){return n<0?t+n:n})}function Zke(r,e){for(var t=[],n=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:Ov(e,r).sort(),o=0,s=0;s<r.length;++s){if(i!=null){if(i[o]===s&&r[s]!==1)throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(r[s],"' is not 1"));(i[o]==null||i[o]>s)&&r[s]===1&&(t.push(r[s]),n.push(s)),i[o]<=s&&o++}r[s]!==1&&(t.push(r[s]),n.push(s))}return{newShape:t,keptDims:n}}function Jke(r,e){return BB(r,e)}function BB(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else if(r==="string")t=new Array(e);else throw new Error("Unknown data type ".concat(r));return t}function Qke(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type ".concat(e," being uploaded contains ").concat(n,"."))}}function e2e(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function f1(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype ".concat(r))}function t2e(r){if(r==null)return 0;var e=0;return r.forEach(function(t){return e+=t.length}),e}function C1(r){return typeof r=="string"||r instanceof String}function r2e(r){return typeof r=="boolean"}function n2e(r){return typeof r=="number"}function Pv(r){return Array.isArray(r)?Pv(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":n2e(r)?"float32":C1(r)?"string":r2e(r)?"bool":"float32"}function oB(r){return!!(r&&r.constructor&&r.call&&r.apply)}function A1(r){var e=r.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=r[e-1];for(var n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function LB(r,e,t,n){n===void 0&&(n=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(n?2:1),o=0;o<i;o++)a[o]=t[r+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(l,f){return l*f})*(n?2:1),o=0;o<i;o++)a[o]=LB(r+o*u,s,t,n);return a}function sB(r,e,t){if(t===void 0&&(t=!1),r.length===0)return e[0];var n=r.reduce(function(a,i){return a*i})*(t?2:1);if(n===0)return[];if(n!==e.length)throw new Error("[".concat(r,"] does not match the input size ").concat(e.length).concat(t?" for a complex tensor":"","."));return LB(0,r,e,t)}function zB(r,e){for(var t=D1(r,e),n=0;n<t.length;n++)t[n]=1;return t}function D1(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error("Unknown data type ".concat(e))}function ba(r){r.forEach(function(e){G(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(r,"].")})})}function _1(r){return r&&r.then&&typeof r.then=="function"}var uB="tfjsflags",a2e=function(){function r(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=i2e,this.populateURLFlags()}return r.prototype.setPlatform=function(e,t){this.platform!=null&&(ra().getBool("IS_TEST")||ra().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t},r.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){var a=this.urlFlags[e];ra().getBool("IS_TEST")||ra().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(a,".")),this.set(e,a)}},r.prototype.getAsync=function(e){return Pt(this,void 0,void 0,function(){var t,n;return _t(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,n=e,[4,this.evaluateFlag(e)]);case 1:return t[n]=a.sent(),[2,this.flags[e]]}})})},r.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(_1(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},r.prototype.getNumber=function(e){return this.get(e)},r.prototype.getBool=function(e){return this.get(e)},r.prototype.getString=function(e){return this.get(e)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!1,configurable:!0}),r.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},r.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()},r.prototype.setFlags=function(e){this.flags=Object.assign({},e)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if(uB in t){var n=t[uB].split(",");n.forEach(function(a){var i=we(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=s2e(o,s)})}}},r}();function i2e(r){var e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];return o2e(e,n[0],n[1]),n.join("=")}),e}function o2e(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function s2e(r,e){var t=e.toLowerCase();return t==="true"||t==="false"?t==="true":"".concat(+t)===t?+t:e}function ra(){return $B}var $B=null;function u2e(r){$B=r}var Xw;function qB(){if(Xw==null){var r=void 0;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");Xw=r}return Xw}function c2e(){var r=qB();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function F1(r,e){var t=c2e();if(t.has(r))return t.get(r);var n=e();return t.set(r,n),t.get(r)}var l2e="Abs",f2e="Acos",h2e="Acosh",WB="Add",p2e="AddN",d2e="All",v2e="Any",m2e="ArgMax",g2e="ArgMin",y2e="Asin",b2e="Asinh",w2e="Atan",x2e="Atanh",k2e="Atan2",S2e="AvgPool",N2e="AvgPool3D",T2e="BatchMatMul",E2e="BatchToSpaceND",I2e="Bincount",C2e="BitwiseAnd",A2e="BroadcastArgs",VB="Cast",D2e="Ceil",_2e="ClipByValue",F2e="Complex",R2e="ComplexAbs",O2e="Concat",P2e="Conv2D",M2e="Conv2DBackpropFilter",B2e="Conv2DBackpropInput",L2e="Conv3D",z2e="Conv3DBackpropInputV2",$2e="Cos",q2e="Cosh",W2e="Cumprod",V2e="Cumsum",U2e="CropAndResize",G2e="DenseBincount",H2e="DepthToSpace",K2e="DepthwiseConv2dNative",j2e="DepthwiseConv2dNativeBackpropFilter",X2e="DepthwiseConv2dNativeBackpropInput",Y2e="Diag",Z2e="Dilation2D",J2e="RealDiv",Q2e="Einsum",eSe="Elu",tSe="Erf",rSe="Equal",nSe="Exp",aSe="ExpandDims",iSe="Expm1",oSe="FFT",sSe="Fill",uSe="FlipLeftRight",cSe="Floor",lSe="FloorDiv",fSe="FusedBatchNorm",hSe="GatherV2",pSe="GatherNd",dSe="Greater",vSe="GreaterEqual",UB="Identity",mSe="IFFT",gSe="Imag",ySe="IsFinite",bSe="IsInf",wSe="IsNan",xSe="LeakyRelu",kSe="Less",SSe="LessEqual",NSe="LinSpace",TSe="Log",ESe="Log1p",ISe="LogicalAnd",CSe="LogicalNot",ASe="LogicalOr",DSe="LRN",_Se="Max",FSe="Maximum",RSe="MaxPool",OSe="MaxPool3D",PSe="MaxPoolWithArgmax",MSe="Mean",BSe="Min",LSe="Minimum",zSe="MirrorPad",$Se="Mod",qSe="Multinomial",WSe="Multiply",VSe="Neg",USe="NotEqual",GSe="NonMaxSuppressionV3",HSe="NonMaxSuppressionV4",KSe="NonMaxSuppressionV5",jSe="OnesLike",XSe="OneHot",YSe="Pack",ZSe="PadV2",JSe="Pow",QSe="Prelu",eNe="Prod",tNe="RaggedGather",rNe="RaggedRange",nNe="RaggedTensorToTensor",aNe="Range",iNe="Real",oNe="Reciprocal",sNe="Relu",uNe="Reshape",cNe="ResizeNearestNeighbor",lNe="ResizeBilinear",fNe="Relu6",hNe="Reverse",pNe="Round",dNe="Rsqrt",vNe="ScatterNd",mNe="TensorScatterUpdate",gNe="SearchSorted",yNe="Select",bNe="Selu",wNe="Slice",xNe="Sin",kNe="Sinh",SNe="Sign",NNe="Sigmoid",TNe="Softplus",ENe="Sqrt",INe="Sum",CNe="SpaceToBatchND",ANe="SplitV",DNe="Softmax",_Ne="SparseFillEmptyRows",FNe="SparseReshape",RNe="SparseSegmentMean",ONe="SparseSegmentSum",PNe="SparseToDense",MNe="SquaredDifference",BNe="StaticRegexReplace",LNe="StridedSlice",zNe="StringNGrams",$Ne="StringSplit",qNe="StringToHashBucketFast",WNe="Sub",VNe="Tan",UNe="Tanh",GB="Tile",GNe="TopK",HNe="Transform",Yw="Transpose",KNe="Unique",jNe="Unpack",XNe="UnsortedSegmentSum",YNe="ZerosLike",ZNe="Step",JNe="RotateWithOffset",cB="_FusedMatMul",lB="FusedConv2D",fB="FusedDepthwiseConv2D";function zf(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];ra().getBool("IS_TEST")||ra().getBool("PROD")||console.warn.apply(console,Dt([],we(r),!1))}var HB=F1("kernelRegistry",function(){return new Map}),QNe=F1("gradRegistry",function(){return new Map});function hB(r,e){var t=eTe(r,e);return HB.get(t)}function pB(r){return QNe.get(r)}function dB(r){for(var e=HB.entries(),t=[];;){var n=e.next(),a=n.done,i=n.value;if(a)break;var o=we(i,2),s=o[0],u=o[1],c=we(s.split("_"),1),l=c[0];l===r&&t.push(u)}return t}function eTe(r,e){return"".concat(e,"_").concat(r)}function tTe(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}var iu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function rTe(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function nTe(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){if(this instanceof n){var a=[null];a.push.apply(a,arguments);var i=Function.bind.apply(e,a);return new i}return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var a=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,a.get?a:{enumerable:!0,get:function(){return r[n]}})}),t}var KB=tr,Ha=null;try{Ha=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function tr(r,e,t){this.low=r|0,this.high=e|0,this.unsigned=!!t}tr.prototype.__isLong__;Object.defineProperty(tr.prototype,"__isLong__",{value:!0});function ia(r){return(r&&r.__isLong__)===!0}tr.isLong=ia;var vB={},mB={};function ou(r,e){var t,n,a;return e?(r>>>=0,(a=0<=r&&r<256)&&(n=mB[r],n)?n:(t=rr(r,(r|0)<0?-1:0,!0),a&&(mB[r]=t),t)):(r|=0,(a=-128<=r&&r<128)&&(n=vB[r],n)?n:(t=rr(r,r<0?-1:0,!1),a&&(vB[r]=t),t))}tr.fromInt=ou;function Ka(r,e){if(isNaN(r))return e?Qs:ja;if(e){if(r<0)return Qs;if(r>=jB)return ZB}else{if(r<=-yB)return na;if(r+1>=yB)return YB}return r<0?Ka(-r,e).neg():rr(r%Ic|0,r/Ic|0,e)}tr.fromNumber=Ka;function rr(r,e,t){return new tr(r,e,t)}tr.fromBits=rr;var Tv=Math.pow;function R1(r,e,t){if(r.length===0)throw Error("empty string");if(r==="NaN"||r==="Infinity"||r==="+Infinity"||r==="-Infinity")return ja;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var n;if((n=r.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return R1(r.substring(1),e,t).neg();for(var a=Ka(Tv(t,8)),i=ja,o=0;o<r.length;o+=8){var s=Math.min(8,r.length-o),u=parseInt(r.substring(o,o+s),t);if(s<8){var c=Ka(Tv(t,s));i=i.mul(c).add(Ka(u))}else i=i.mul(a),i=i.add(Ka(u))}return i.unsigned=e,i}tr.fromString=R1;function ki(r,e){return typeof r=="number"?Ka(r,e):typeof r=="string"?R1(r,e):rr(r.low,r.high,typeof e=="boolean"?e:r.unsigned)}tr.fromValue=ki;var gB=1<<16,aTe=1<<24,Ic=gB*gB,jB=Ic*Ic,yB=jB/2,bB=ou(aTe),ja=ou(0);tr.ZERO=ja;var Qs=ou(0,!0);tr.UZERO=Qs;var Sc=ou(1);tr.ONE=Sc;var XB=ou(1,!0);tr.UONE=XB;var h1=ou(-1);tr.NEG_ONE=h1;var YB=rr(-1,2147483647,!1);tr.MAX_VALUE=YB;var ZB=rr(-1,-1,!0);tr.MAX_UNSIGNED_VALUE=ZB;var na=rr(0,-2147483648,!1);tr.MIN_VALUE=na;var Oe=tr.prototype;Oe.toInt=function(){return this.unsigned?this.low>>>0:this.low};Oe.toNumber=function(){return this.unsigned?(this.high>>>0)*Ic+(this.low>>>0):this.high*Ic+(this.low>>>0)};Oe.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(na)){var t=Ka(e),n=this.div(t),a=n.mul(t).sub(this);return n.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Ka(Tv(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};Oe.getHighBits=function(){return this.high};Oe.getHighBitsUnsigned=function(){return this.high>>>0};Oe.getLowBits=function(){return this.low};Oe.getLowBitsUnsigned=function(){return this.low>>>0};Oe.getNumBitsAbs=function(){if(this.isNegative())return this.eq(na)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};Oe.isZero=function(){return this.high===0&&this.low===0};Oe.eqz=Oe.isZero;Oe.isNegative=function(){return!this.unsigned&&this.high<0};Oe.isPositive=function(){return this.unsigned||this.high>=0};Oe.isOdd=function(){return(this.low&1)===1};Oe.isEven=function(){return(this.low&1)===0};Oe.equals=function(e){return ia(e)||(e=ki(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Oe.eq=Oe.equals;Oe.notEquals=function(e){return!this.eq(e)};Oe.neq=Oe.notEquals;Oe.ne=Oe.notEquals;Oe.lessThan=function(e){return this.comp(e)<0};Oe.lt=Oe.lessThan;Oe.lessThanOrEqual=function(e){return this.comp(e)<=0};Oe.lte=Oe.lessThanOrEqual;Oe.le=Oe.lessThanOrEqual;Oe.greaterThan=function(e){return this.comp(e)>0};Oe.gt=Oe.greaterThan;Oe.greaterThanOrEqual=function(e){return this.comp(e)>=0};Oe.gte=Oe.greaterThanOrEqual;Oe.ge=Oe.greaterThanOrEqual;Oe.compare=function(e){if(ia(e)||(e=ki(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Oe.comp=Oe.compare;Oe.negate=function(){return!this.unsigned&&this.eq(na)?na:this.not().add(Sc)};Oe.neg=Oe.negate;Oe.add=function(e){ia(e)||(e=ki(e));var t=this.high>>>16,n=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,p=0;return p+=i+c,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=n+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,rr(h<<16|p,l<<16|f,this.unsigned)};Oe.subtract=function(e){return ia(e)||(e=ki(e)),this.add(e.neg())};Oe.sub=Oe.subtract;Oe.multiply=function(e){if(this.isZero())return ja;if(ia(e)||(e=ki(e)),Ha){var t=Ha.mul(this.low,this.high,e.low,e.high);return rr(t,Ha.get_high(),this.unsigned)}if(e.isZero())return ja;if(this.eq(na))return e.isOdd()?na:ja;if(e.eq(na))return this.isOdd()?na:ja;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(bB)&&e.lt(bB))return Ka(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*l,p+=d>>>16,d&=65535,p+=i*l,h+=p>>>16,p&=65535,p+=o*c,h+=p>>>16,p&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=n*l+a*c+i*u+o*s,f&=65535,rr(p<<16|d,f<<16|h,this.unsigned)};Oe.mul=Oe.multiply;Oe.divide=function(e){if(ia(e)||(e=ki(e)),e.isZero())throw Error("division by zero");if(Ha){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Ha.div_u:Ha.div_s)(this.low,this.high,e.low,e.high);return rr(t,Ha.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Qs:ja;var n,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Qs;if(e.gt(this.shru(1)))return XB;i=Qs}else{if(this.eq(na)){if(e.eq(Sc)||e.eq(h1))return na;if(e.eq(na))return Sc;var o=this.shr(1);return n=o.div(e).shl(1),n.eq(ja)?e.isNegative()?Sc:h1:(a=this.sub(e.mul(n)),i=n.add(a.div(e)),i)}else if(e.eq(na))return this.unsigned?Qs:ja;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=ja}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),u=s<=48?1:Tv(2,s-48),c=Ka(n),l=c.mul(e);l.isNegative()||l.gt(a);)n-=u,c=Ka(n,this.unsigned),l=c.mul(e);c.isZero()&&(c=Sc),i=i.add(c),a=a.sub(l)}return i};Oe.div=Oe.divide;Oe.modulo=function(e){if(ia(e)||(e=ki(e)),Ha){var t=(this.unsigned?Ha.rem_u:Ha.rem_s)(this.low,this.high,e.low,e.high);return rr(t,Ha.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Oe.mod=Oe.modulo;Oe.rem=Oe.modulo;Oe.not=function(){return rr(~this.low,~this.high,this.unsigned)};Oe.and=function(e){return ia(e)||(e=ki(e)),rr(this.low&e.low,this.high&e.high,this.unsigned)};Oe.or=function(e){return ia(e)||(e=ki(e)),rr(this.low|e.low,this.high|e.high,this.unsigned)};Oe.xor=function(e){return ia(e)||(e=ki(e)),rr(this.low^e.low,this.high^e.high,this.unsigned)};Oe.shiftLeft=function(e){return ia(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?rr(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):rr(0,this.low<<e-32,this.unsigned)};Oe.shl=Oe.shiftLeft;Oe.shiftRight=function(e){return ia(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?rr(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):rr(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Oe.shr=Oe.shiftRight;Oe.shiftRightUnsigned=function(e){if(ia(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var n=this.low;return rr(n>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?rr(t,0,this.unsigned):rr(t>>>e-32,0,this.unsigned)};Oe.shru=Oe.shiftRightUnsigned;Oe.shr_u=Oe.shiftRightUnsigned;Oe.toSigned=function(){return this.unsigned?rr(this.low,this.high,!1):this};Oe.toUnsigned=function(){return this.unsigned?this:rr(this.low,this.high,!0)};Oe.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Oe.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Oe.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};tr.fromBytes=function(e,t,n){return n?tr.fromBytesLE(e,t):tr.fromBytesBE(e,t)};tr.fromBytesLE=function(e,t){return new tr(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};tr.fromBytesBE=function(e,t){return new tr(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var JB=rTe(KB),iTe=nke({__proto__:null,default:JB},[KB]),oTe=JB||iTe;function O1(r){return oTe.fromString(r,!0,16)}O1("c3a5c85c97cb3127");O1("b492b66fbe98f273");O1("9ae16a3b2f90404f");function sTe(r,e){return r instanceof Float32Array&&e==="float32"||r instanceof Int32Array&&e==="int32"||r instanceof Uint8Array&&e==="bool"}function QB(r,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=jf(r)),ra().getBool("DEBUG")&&Qke(r,e),sTe(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){for(var t=new Uint8Array(r.length),n=0;n<t.length;++n)Math.round(r[n])!==0&&(t[n]=1);return t}else throw new Error("Unknown data type ".concat(e))}function Ev(){return ra().platform.now()}function uTe(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",ra().platform.encode(r,e)}function wB(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",ra().platform.decode(r,e)}function xi(r){return ra().platform.isTypedArray!=null?ra().platform.isTypedArray(r):tTe(r)}function jf(r,e,t){var n,a;if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),typeof r=="boolean"||typeof r=="number"||typeof r=="string"||_1(r)||r==null||xi(r)&&t)e.push(r);else if(Array.isArray(r)||xi(r))for(var i=0;i<r.length;++i)jf(r[i],e,t);else{var o=-1;try{for(var s=Xr(Object.keys(r)),u=s.next();!u.done;u=s.next()){var c=u.value;/^([1-9]+[0-9]*|0)$/.test(c)&&(o=Math.max(o,Number(c)))}}catch(l){n={error:l}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(n)throw n.error}}for(var i=0;i<=o;i++)jf(r[i],e,t)}return e}var cTe=function(){function r(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new fTe)}return r.prototype.profileKernel=function(e,t,n){var a,i,o,s=function(){o=n()},u,c=Ev();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var l=Xr(o),f=l.next();!f.done;f=l.next()){var h=f.value;h.dataSync()}}catch(v){a={error:v}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:Ev()-c})}if(ra().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var p=function(v){var g=o[v];g.data().then(function(y){lTe(y,g.dtype,e)})},d=0;d<o.length;d++)p(d);var m={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(v){return v.kernelMs}),extraInfo:u.then(function(v){return v.getExtraProfileInfo!=null?v.getExtraProfileInfo():""})};return m},r.prototype.logKernelProfile=function(e){var t=this,n=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(c){t.logger.logKernelProfile(n,u,c[0],c[1],o,c[2])})})},r}();function lTe(r,e,t){if(e!=="float32")return!1;for(var n=0;n<r.length;n++){var a=r[n];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(t,"'")),!0}return!1}var fTe=function(){function r(){}return r.prototype.logKernelProfile=function(e,t,n,a,i,o){var s=typeof a=="number"?xv("".concat(a,"ms"),9):a.error,u=xv(e,25),c=t.rank,l=t.size,f=xv(t.shape.toString(),14),h="";for(var p in i){var d=i[p];if(d!=null){var m=d.shape||t.shape,v=m.length;h+="".concat(p,": ").concat(v,"D ").concat(v>0?m:""," ")}}console.log("%c".concat(u,"	%c").concat(s,"	%c").concat(c,"D ").concat(f,"	%c").concat(l,"	%c").concat(h,"	%c").concat(o),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r}();function hTe(r,e,t){for(var n={},a={},i=0;i<e.length;i++)n[e[i].id]=!0;for(var i=0;i<r.length;i++){var o=r[i],s=o.inputs;for(var u in s){for(var c=s[u],l=!1,f=0;f<e.length;f++)if(n[c.id]){o.outputs.forEach(function(w){return n[w.id]=!0}),l=!0,a[o.id]=!0;break}if(l)break}}var h={};h[t.id]=!0;for(var p={},i=r.length-1;i>=0;i--)for(var o=r[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,p[o.id]=!0;break}for(var d=[],i=0;i<r.length;i++){var o=r[i];if(a[o.id]&&p[o.id]){var m={};for(var u in o.inputs){var v=o.inputs[u];n[v.id]&&(m[u]=v)}var g=Object.assign({},o);g.inputs=m,g.outputs=o.outputs,d.push(g)}}return d}function pTe(r,e,t,n){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var p=r[h.id];p!=null?u.push(p):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(s.kernelName,"."));var c=s.gradient(u),l=function(h){if(!(h in c))throw new Error("Cannot backprop through input ".concat(h,". ")+"Available gradients found: ".concat(Object.keys(c),"."));var p=t(function(){return c[h]()});if(p.dtype!=="float32")throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"".concat(h," must have 'float32' dtype, but has '").concat(p.dtype,"'"));var d=s.inputs[h];if(!au(p.shape,d.shape))throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"'".concat(h,"' has shape '").concat(p.shape,"', which does not match ")+"the shape of the input '".concat(d.shape,"'"));if(r[d.id]==null)r[d.id]=p;else{var m=r[d.id];r[d.id]=n(m,p),m.dispose()}};for(var f in s.inputs)l(f)},i=e.length-1;i>=0;i--)a(i)}var xB=20,$f=3,Zw=7;function dTe(r,e,t,n){var a=A1(e),i=vTe(r,e,t,a),o=e.length,s=kv(r,e,t,a,i),u=["Tensor"];return n&&(u.push("  dtype: ".concat(t)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(e,"]")),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function vTe(r,e,t,n){var a=Mn(e),i=n[n.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?Uf(r):r;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,f=0;f<i;f++)o[f]=Math.max(o[f],Vf(u[l+f],0,t).length);return o}function Vf(r,e,t){var n;return Array.isArray(r)?n="".concat(parseFloat(r[0].toFixed(Zw))," + ")+"".concat(parseFloat(r[1].toFixed(Zw)),"j"):C1(r)?n="'".concat(r,"'"):t==="bool"?n=eL(r):n=parseFloat(r.toFixed(Zw)).toString(),xv(n,e)}function eL(r){return r===0?"false":"true"}function kv(r,e,t,n,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var c=Uf(r);return[Vf(c[0],0,t)]}return t==="bool"?[eL(r[0])]:[r[0].toString()]}if(u===1){if(s>xB){var l=$f*o,f=Array.from(r.slice(0,l)),h=Array.from(r.slice((s-$f)*o,s*o));return t==="complex64"&&(f=Uf(f),h=Uf(h)),["["+f.map(function(T,E){return Vf(T,a[E],t)}).join(", ")+", ..., "+h.map(function(T,E){return Vf(T,a[s-$f+E],t)}).join(", ")+"]"]}var p=t==="complex64"?Uf(r):Array.from(r);return["["+p.map(function(T,E){return Vf(T,a[E],t)}).join(", ")+"]"]}var d=e.slice(1),m=n.slice(1),v=n[0]*o,g=[];if(s>xB){for(var y=0;y<$f;y++){var w=y*v,b=w+v;g.push.apply(g,Dt([],we(kv(r.slice(w,b),d,t,m,a,!1)),!1))}g.push("...");for(var y=s-$f;y<s;y++){var w=y*v,b=w+v;g.push.apply(g,Dt([],we(kv(r.slice(w,b),d,t,m,a,y===s-1)),!1))}}else for(var y=0;y<s;y++){var w=y*v,b=w+v;g.push.apply(g,Dt([],we(kv(r.slice(w,b),d,t,m,a,y===s-1)),!1))}var x=u===2?",":"";g[0]="["+(s>0?g[0]+x:"");for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+x;for(var S=`,
`,y=2;y<u;y++)S+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":S),g}function Uf(r){for(var e=[],t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var p1=function(){function r(e,t,n){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=Mn(e),n!=null){var i=n.length;G(i===this.size,function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||BB(t,this.size),this.strides=A1(e)}return r.prototype.set=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];n.length===0&&(n=[0]),G(n.length===this.rank,function(){return"The number of provided coordinates (".concat(n.length,") must ")+"match the rank (".concat(t.rank,")")});var i=this.locToIndex(n);this.values[i]=e},r.prototype.get=function(){for(var e,t,n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];n.length===0&&(n=[0]);var i=0;try{for(var o=Xr(n),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var c="Requested out of range element at ".concat(n,". ")+"  Buffer shape=".concat(this.shape);throw new Error(c)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var l=n[n.length-1],f=0;f<n.length-1;++f)l+=this.strides[f]*n[f];return this.values[l]},r.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},r.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),r.prototype.toTensor=function(){return bi().makeTensor(this.values,this.shape,this.dtype)},r}(),bi=null,qf=null;function mTe(r){bi=r}var On=function(){function r(e,t,n,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Mn(e),this.strides=A1(e),this.dataId=n,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),r.prototype.buffer=function(){return Pt(this,void 0,void 0,function(){var e;return _t(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,qf.buffer(this.shape,this.dtype,e)]}})})},r.prototype.bufferSync=function(){return qf.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return Pt(this,void 0,void 0,function(){var e;return _t(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,sB(this.shape,e,this.dtype==="complex64")]}})})},r.prototype.arraySync=function(){return sB(this.shape,this.dataSync(),this.dtype==="complex64")},r.prototype.data=function(){return Pt(this,void 0,void 0,function(){var e,t;return _t(this,function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=bi().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map(function(a){return wB(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}})})},r.prototype.dataToGPU=function(e){return this.throwIfDisposed(),bi().readToGPU(this.dataId,e)},r.prototype.dataSync=function(){this.throwIfDisposed();var e=bi().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return wB(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},r.prototype.bytes=function(){return Pt(this,void 0,void 0,function(){var e;return _t(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,bi().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},r.prototype.dispose=function(){this.isDisposed||(bi().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!1,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.print=function(e){return e===void 0&&(e=!1),qf.print(this,e)},r.prototype.clone=function(){return this.throwIfDisposed(),qf.clone(this)},r.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return dTe(t,this.shape,this.dtype,e)},r.prototype.cast=function(e){return this.throwIfDisposed(),qf.cast(this,e)},r.prototype.variable=function(e,t,n){return e===void 0&&(e=!0),this.throwIfDisposed(),bi().makeVariable(this,e,t,n)},r}();Object.defineProperty(On,Symbol.hasInstance,{value:function(r){return!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null}});function gTe(){return F1("Tensor",function(){return On})}gTe();var d1=function(r){RB(e,r);function e(t,n,a,i){var o=r.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=n,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(t.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!au(t.shape,this.shape))throw new Error("shape of the new value (".concat(t.shape,") and ")+"previous value (".concat(this.shape,") must match"));bi().disposeTensor(this),this.dataId=t.dataId,bi().incRef(this,null)},e.prototype.dispose=function(){bi().disposeVariable(this),this.isDisposedInternal=!0},e}(On);Object.defineProperty(d1,Symbol.hasInstance,{value:function(r){return r instanceof On&&r.assign!=null&&r.assign instanceof Function}});var kB;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(kB||(kB={}));var v1;(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(v1||(v1={}));var m1;(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(m1||(m1={}));var g1;(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(g1||(g1={}));var y1;(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(y1||(y1={}));var yTe={float32:g1,int32:v1,bool:m1,complex64:y1};function bTe(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error("Can not upcast ".concat(r," with ").concat(e))}return yTe[r][e]}function tL(r){return r!=null&&typeof r=="object"&&"texture"in r&&r.texture instanceof WebGLTexture}function rL(r){return typeof GPUBuffer<"u"&&r!=null&&typeof r=="object"&&"buffer"in r&&r.buffer instanceof GPUBuffer}function Er(r,e){if(r.dtype===e.dtype)return[r,e];var t=bTe(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function wTe(r,e){G(r.dtype===e.dtype,function(){return"The dtypes of the first(".concat(r.dtype,") and")+" second(".concat(e.dtype,") input must match")})}function nL(r){var e=[],t=new Set;return aL(r,e,t),e}function aL(r,e,t){if(r!=null){if(r instanceof On){e.push(r);return}if(!!xTe(r)){var n=r;for(var a in n){var i=n[a];t.has(i)||(t.add(i),aL(i,e,t))}}}}function xTe(r){return Array.isArray(r)||typeof r=="object"}function Jw(r){return r.kernelName!=null}var SB=function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return r.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},r}(),P1=function(){function r(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new SB}return r.prototype.ready=function(){return Pt(this,void 0,void 0,function(){var e,t,n,a;return _t(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(n)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,n=e.asyncInit;if(n)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!1,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},r.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},r.prototype.registerBackend=function(e,t,n){return n===void 0&&(n=1),e in this.registryFactory?(zf("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},r.prototype.setBackend=function(e){return Pt(this,void 0,void 0,function(){var t,n,a,i,o;return _t(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '".concat(e,"' not found in registry"));return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,a=t.asyncInit,a?[4,n]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=n,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new cTe(this.backendInstance),[2,!0]}})})},r.prototype.setupRegisteredKernels=function(){var e=this,t=dB(this.backendName);t.forEach(function(n){n.setupFunc!=null&&n.setupFunc(e.backendInstance)})},r.prototype.disposeRegisteredKernels=function(e){var t=this,n=dB(e);n.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},r.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(n==null)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var a=n.factory();if(a&&!(a instanceof Xke)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,zf("Initialization of backend ".concat(e," failed")),zf(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return zf("Initialization of backend ".concat(e," failed")),zf(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],a=this.initializeBackend(n),i=a.success,o=a.asyncInit;if(o||i)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),a=n.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(e,t){var n=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return n.startScope(a)},function(){return n.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},r.prototype.scopedRun=function(e,t,n){e();try{var a=n();return t(),a}catch(i){throw t(),i}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(e){var t=Q.runKernel(UB,{x:e}),n={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},c={dtype:s};return Q.runKernel(VB,u,c)}}},i=[];return this.addTapeNode(this.state.activeScope.name,n,[t],a,i,{}),t},r.prototype.runKernel=function(e,t,n){this.backendName==null&&this.backend;var a=hB(e,this.backendName)!=null;if(!a)throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(e,t,n){var a=this.backend.numDataIds(),i=0;n.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(s," data ids) after running '").concat(e,"'"))},r.prototype.runKernelFunc=function(e){var t=this,n,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var c,l=Jw(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Jw(e)){var f=e.kernelName,h=e.inputs,p=e.attrs;this.backendName==null&&this.backend;var d=hB(f,this.backendName);G(d!=null,function(){return"Cannot find registered kernel '".concat(f,"' for backend '").concat(t.backendName,"'")}),u=function(){var x=t.backend.numDataIds();c=d.kernelFunc({inputs:h,attrs:p,backend:t.backend});var S=Array.isArray(c)?c:[c];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,x,S);var T=S.map(function(C){return C.rank!=null?C:t.makeTensorFromTensorInfo(C)});if(i){var E=t.getTensorsForGradient(f,h,T);a=t.saveTensorsForBackwardMode(E)}return T}}else{var m=e.forwardFunc,v=function(x){!i||(a=x.map(function(S){return t.keep(t.clone(S))}))};u=function(){var x=t.backend.numDataIds();c=t.tidy(function(){return m(t.backend,v)});var S=Array.isArray(c)?c:[c];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(l,x,S),S}}var g=e.inputs,y=e.attrs,w=Jw(e)?null:e.backwardsFunc,b;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?n=u():(b=t.profiler.profileKernel(l,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(b),n=b.outputs)}),i&&this.addTapeNode(l,g,n,w,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(x){return g[x]!=null?g[x].shape:null}),outputShapes:n.map(function(x){return x.shape}),kernelTimeMs:b.timeMs,extraInfo:b.extraInfo}),Array.isArray(c)?n:n[0]},r.prototype.saveTensorsForBackwardMode=function(e){var t=this,n=e.map(function(a){return t.keep(t.clone(a))});return n},r.prototype.getTensorsForGradient=function(e,t,n){var a=pB(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(G(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(c){return t[c]})):s=i.map(function(c){return t[c]});var u=n.filter(function(c,l){return o[l]});return s.concat(u)}return[]},r.prototype.makeTensor=function(e,t,n,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",a=a||this.backend;var i=e;n==="string"&&C1(e[0])&&(i=e.map(function(l){return uTe(l)}));var o=a.write(i,t,n),s=new On(t,n,o,this.nextTensorId());if(this.trackTensor(s,a),n==="string"){var u=this.state.tensorInfo.get(o),c=t2e(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},r.prototype.makeTensorFromDataId=function(e,t,n,a){n=n||"float32";var i={dataId:e,shape:t,dtype:n};return this.makeTensorFromTensorInfo(i,a)},r.prototype.makeTensorFromTensorInfo=function(e,t){var n=e.dataId,a=e.shape,i=e.dtype,o=new On(a,i,n,this.nextTensorId());return this.trackTensor(o,t),o},r.prototype.makeVariable=function(e,t,n,a){t===void 0&&(t=!0),n=n||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new d1(e,t,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name ".concat(i.name," was already registered"));return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},r.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*f1(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof d1||this.track(e)},r.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},r.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},r.prototype.disposeTensor=function(e){if(!!this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var n=e.size*f1(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},r.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},r.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},r.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},r.prototype.profile=function(e){return Pt(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f,h;return _t(this,function(p){switch(p.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=p.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,Dt([],we(this.state.activeProfile.kernels.map(function(d){return d.totalBytesSnapshot})),!1)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,p.label=2;case 2:p.trys.push([2,8,9,10]),i=Xr(this.state.activeProfile.kernels),o=i.next(),p.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=p.sent(),c=s,[4,s.extraInfo];case 5:c.extraInfo=p.sent(),p.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return l=p.sent(),f={error:l},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(e,t,n,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},c=pB(e);c!=null&&(a=c.gradFunc),a!=null&&(u.gradient=function(l){return l=l.map(function(f,h){if(f==null){var p=n[h],d=D1(p.size,p.dtype);return s.makeTensor(d,p.shape,p.dtype)}return f}),a(l.length>1?l:l[0],i,o)}),this.state.activeTape.push(u)},r.prototype.keep=function(e){return e.kept=!0,e},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(e){for(var t=this,n=nL(e),a=new Set(n.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},r.prototype.gradients=function(e,t,n,a){var i=this;if(a===void 0&&(a=!1),G(t.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});G(o instanceof On,function(){return"The result y returned by f() must be a tensor."});var s=hTe(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=n??kTe(o.shape),pTe(u,s,function(l){return i.tidy(l)},NTe);var c=t.map(function(l){return u[l.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(l){var f,h;try{for(var p=Xr(l.saved),d=p.next();!d.done;d=p.next()){var m=d.value;m.dispose()}}catch(v){f={error:v}}finally{try{d&&!d.done&&(h=p.return)&&h.call(p)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:c}})},r.prototype.customGrad=function(e){var t=this;return G(oB(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n=[],a=0;a<arguments.length;a++)n[a]=arguments[a];G(n.every(function(c){return c instanceof On}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};n.forEach(function(c,l){o[l]=c});var s=function(c,l){return i=e.apply(void 0,Dt([],we(Dt(Dt([],we(n),!1),[l],!1)),!1)),G(i.value instanceof On,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),G(oB(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(c,l){var f=i.gradFunc(c,l),h=Array.isArray(f)?f:[f];G(h.length===n.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),G(h.every(function(d){return d instanceof On}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return h.forEach(function(d,m){p[m]=function(){return d}}),p};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},r.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},r.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},r.prototype.readToGPU=function(e,t){var n=this.state.tensorInfo.get(e);return n.backend.readToGPU(e,t)},r.prototype.time=function(e){return Pt(this,void 0,void 0,function(){var t,n;return _t(this,function(a){switch(a.label){case 0:return t=Ev(),[4,this.backend.time(e)];case 1:return n=a.sent(),n.wallMs=Ev()-t,[2,n]}})})},r.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!1,configurable:!0}),r.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new SB;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r}();P1.nextTensorId=0;P1.nextVariableId=0;function kTe(r){var e=zB(Mn(r),"float32");return Q.makeTensor(e,r,"float32")}function STe(){var r=qB();if(r._tfengine==null){var e=new a2e(r);r._tfengine=new P1(e)}return u2e(r._tfengine.ENV),mTe(function(){return r._tfengine}),r._tfengine}var Q=STe();function NTe(r,e){var t={a:r,b:e};return Q.runKernel(WB,t)}function Qo(r,e){var t=r;if(xi(r))return e==="string"?[]:[r.length];if(tL(r)){var n=r.channels||"RGBA";return[r.height,r.width*n.length]}else if(rL(r))return[r.buffer.size/(e==null?4:f1(e))];if(!Array.isArray(r))return[];for(var a=[];Array.isArray(t)||xi(t)&&e!=="string";)a.push(t.length),t=t[0];return Array.isArray(r)&&ra().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&iL(r,a,[]),a}function iL(r,e,t){if(t=t||[],!Array.isArray(r)&&!xi(r)){G(e.length===0,function(){return"Element arr[".concat(t.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(e[0]," elements")});return}G(e.length>0,function(){return"Element arr[".concat(t.join("]["),"] should be a primitive, ")+"but is an array of ".concat(r.length," elements")}),G(r.length===e[0],function(){return"Element arr[".concat(t.join("]["),"] should have ").concat(e[0]," ")+"elements, but has ".concat(r.length," elements")});for(var n=e.slice(1),a=0;a<r.length;++a)iL(r[a],n,t.concat(a))}function NB(r,e,t,n){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==e||r==="numeric"&&e==="string")throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must ")+"be ".concat(r," tensor, but got ").concat(e," tensor"))}}function M(r,e,t,n){if(n===void 0&&(n="numeric"),r instanceof On)return NB(n,r.dtype,e,t),r;var a=Pv(r);if(a!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(a=n),NB(n,a,e,t),r==null||!xi(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var i=r==null?"null":r.constructor.name;throw new Error("Argument '".concat(e,"' passed to '").concat(t,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=Qo(r,a);!xi(r)&&!Array.isArray(r)&&(r=[r]);var s=!0,u=a!=="string"?QB(r,a):jf(r,[],s);return Q.makeTensor(u,o,a)}function Iv(r,e,t,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument ".concat(e," passed to ").concat(t," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=r;return a.map(function(i,o){return M(i,"".concat(e,"[").concat(o,"]"),t,n)})}var oL="__op";function K(r){var e=Object.keys(r);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(e.length," keys."));var t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+oL;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];Q.startScope(t);try{var s=n.apply(void 0,Dt([],we(i),!1));return _1(s)&&console.error("Cannot return a Promise inside of tidy."),Q.endScope(s),s}catch(u){throw Q.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function TTe(r){var e=M(r,"x","abs");if(e.dtype==="complex64"){var t={x:e};return Q.runKernel(R2e,t)}else{var t={x:e};return Q.runKernel(l2e,t)}}var Ua=K({abs_:TTe});function ETe(r){var e=M(r,"x","acos"),t={x:e};return Q.runKernel(f2e,t)}var ITe=K({acos_:ETe});function CTe(r){var e=M(r,"x","acosh"),t={x:e};return Q.runKernel(h2e,t)}var ATe=K({acosh_:CTe});function DTe(r,e){var t,n=M(r,"a","add"),a=M(e,"b","add");t=we(Er(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(WB,i)}var Yr=K({add_:DTe});function _Te(r){G(Array.isArray(r),function(){return"The argument passed to tf.addN() must be a list of tensors"}),G(r.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+"".concat(r.length)});var e=r.map(function(a,i){return M(a,"tensors".concat(i),"addN")}),t=e[0];e.forEach(function(a){if(a.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(a){if(!au(a.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var n=e;return Q.runKernel(p2e,n)}var FTe=K({addN_:_Te});function RTe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=M(r,"x","all","bool"),a={x:n},i={axis:e,keepDims:t};return Q.runKernel(d2e,a,i)}var OTe=K({all_:RTe});function PTe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=M(r,"x","any","bool"),a={x:n},i={axis:e,keepDims:t};return Q.runKernel(v2e,a,i)}var MTe=K({any_:PTe});function BTe(r,e){e===void 0&&(e=0);var t=M(r,"x","argMax"),n={x:t},a={axis:e};return Q.runKernel(m2e,n,a)}var LTe=K({argMax_:BTe});function zTe(r,e){e===void 0&&(e=0);var t=M(r,"x","argMin"),n={x:t},a={axis:e};return Q.runKernel(g2e,n,a)}var $Te=K({argMin_:zTe});function qTe(r){var e=M(r,"x","asin"),t={x:e};return Q.runKernel(y2e,t)}var WTe=K({asin_:qTe});function VTe(r){var e=M(r,"x","asinh"),t={x:e};return Q.runKernel(b2e,t)}var UTe=K({asinh_:VTe});function GTe(r){var e=M(r,"x","atan"),t={x:e};return Q.runKernel(w2e,t)}var HTe=K({atan_:GTe});function KTe(r,e){var t,n=M(r,"a","atan2"),a=M(e,"b","atan2");t=we(Er(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(k2e,i)}var jTe=K({atan2_:KTe});function XTe(r){var e=M(r,"x","atanh"),t={x:e};return Q.runKernel(x2e,t)}var YTe=K({atanh_:XTe});function ZTe(r,e){var t=M(r,"x","cast");if(!e2e(e))throw new Error("Failed to cast to unknown dtype ".concat(e));if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var n={x:t},a={dtype:e};return Q.runKernel(VB,n,a)}var an=K({cast_:ZTe});function JTe(r,e,t,n,a,i,o){o===void 0&&(o="channelsLast");var s=we(Xf(e),2),u=s[0],c=s[1],l;if(o==="channelsLast")l=[u,c,r[3],r[3]];else if(o==="channelsFirst")l=[u,c,r[1],r[1]];else throw new Error("Unknown dataFormat ".concat(o));return M1(r,l,t,n,a,i,!1,o)}function M1(r,e,t,n,a,i,o,s){var u,c;o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var l=we([-1,-1,-1,-1],4),f=l[0],h=l[1],p=l[2],d=l[3];if(s==="channelsLast")u=we(r,4),f=u[0],h=u[1],p=u[2],d=u[3];else if(s==="channelsFirst")c=we(r,4),f=c[0],d=c[1],h=c[2],p=c[3];else throw new Error("Unknown dataFormat ".concat(s));var m=we(e,4),v=m[0],g=m[1],y=m[3],w=we(Xf(t),2),b=w[0],x=w[1],S=we(Xf(n),2),T=S[0],E=S[1],C=b1(v,T),R=b1(g,E),_=tEe(a,h,p,b,x,C,R,i,s),O=_.padInfo,$=_.outHeight,z=_.outWidth,L=o?y*d:y,B;return s==="channelsFirst"?B=[f,L,$,z]:s==="channelsLast"&&(B=[f,$,z,L]),{batchSize:f,dataFormat:s,inHeight:h,inWidth:p,inChannels:d,outHeight:$,outWidth:z,outChannels:L,padInfo:O,strideHeight:b,strideWidth:x,filterHeight:v,filterWidth:g,effectiveFilterHeight:C,effectiveFilterWidth:R,dilationHeight:T,dilationWidth:E,inShape:r,outShape:B,filterShape:e}}function QTe(r,e,t,n,a){n==null&&(n=eEe(r,e,t));var i=r[0],o=r[1],s=Cv((i-e+2*n)/t+1,a),u=Cv((o-e+2*n)/t+1,a);return[s,u]}function eEe(r,e,t,n){n===void 0&&(n=1);var a=b1(e,n);return Math.floor((r[0]*(t-1)-t+a)/2)}function Xf(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function b1(r,e){return e<=1?r:r+(r-1)*(e-1)}function tEe(r,e,t,n,a,i,o,s,u){var c,l,f;if(typeof r=="number"){var h=r===0?"VALID":"NUMBER";c={top:r,bottom:r,left:r,right:r,type:h};var p=QTe([e,t],i,n,r,s);l=p[0],f=p[1]}else if(r==="same"){l=Math.ceil(e/n),f=Math.ceil(t/a);var d=Math.max(0,(l-1)*n+i-e),m=Math.max(0,(f-1)*a+o-t),v=Math.floor(d/2),g=d-v,y=Math.floor(m/2),w=m-y;c={top:v,bottom:g,left:y,right:w,type:"SAME"}}else if(r==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-i+1)/n),f=Math.ceil((t-o+1)/a);else if(typeof r=="object"){var v=u==="channelsLast"?r[1][0]:r[2][0],g=u==="channelsLast"?r[1][1]:r[2][1],y=u==="channelsLast"?r[2][0]:r[3][0],w=u==="channelsLast"?r[2][1]:r[3][1],h=v===0&&g===0&&y===0&&w===0?"VALID":"EXPLICIT";c={top:v,bottom:g,left:y,right:w,type:h},l=Cv((e-i+v+g)/n+1,s),f=Cv((t-o+y+w)/a+1,s)}else throw Error("Unknown padding parameter: ".concat(r));return{padInfo:c,outHeight:l,outWidth:f}}function Cv(r,e){if(!e)return Math.trunc(r);switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode ".concat(e))}}function Av(r){var e=we(Xf(r),3),t=e[0],n=e[1],a=e[2];return t===1&&n===1&&a===1}function es(r,e){return Av(r)||Av(e)}function Cc(r){return Xf(r).every(function(e){return e>0})}function Si(r,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,"."));if(typeof e=="number")G(Kf(e),function(){return"Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,".")});else if(typeof e=="object")e.forEach(function(n){n.forEach(function(a){G(Kf(a),function(){return"Error in ".concat(r,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(a,".")})})});else throw Error("Error in ".concat(r,": Unknown padding parameter: ").concat(e))}}function rEe(r,e){var t=M(r,"x","reshape","string_or_numeric"),n={x:t},a={shape:e};return Q.runKernel(uNe,n,a)}var ge=K({reshape_:rEe});function nEe(r,e,t,n,a){var i=M(r,"x","avgPool","float32"),o=1;G(es(t,o),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")});var s=i,u=!1;i.rank===3&&(u=!0,s=ge(i,[1,i.shape[0],i.shape[1],i.shape[2]])),G(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(s.rank,".")}),Si("avgPool",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=Q.runKernel(S2e,c,l);return f=an(f,i.dtype),u?ge(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var sL=K({avgPool_:nEe});function aEe(r,e,t,n,a,i){i===void 0&&(i="NDHWC");var o=M(r,"x","avgPool3d","float32"),s=o,u=!1;o.rank===4&&(u=!0,s=ge(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),G(s.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),G(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),G(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,function(){return"Error in avgPool3d: Stride must be > 0, but got '".concat(t,"'")}),Si("avgPool3d",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=Q.runKernel(N2e,c,l);return f=an(f,s.dtype),u?ge(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var iEe=K({avgPool3d_:aEe});function oEe(r){var e=M(r,"x","clone","string_or_numeric"),t={x:e};return Q.runKernel(UB,t)}var Nc=K({clone_:oEe});function sEe(r,e){e===void 0&&(e=0),G(r.length>=1,function(){return"Pass at least one tensor to concat"});var t=Iv(r,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `.concat(i.dtype,". "))}),t.length===1)return Nc(t[0]);var n=t,a={axis:e};return Q.runKernel(O2e,n,a)}var aa=K({concat_:sEe});function uEe(r,e,t,n){var a;t===void 0&&(t=!1),n===void 0&&(n=!1);var i=M(r,"a","matMul"),o=M(e,"b","matMul");a=we(Er(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:n};return Q.runKernel(T2e,s,u)}var Bt=K({matMul_:uEe});function cEe(r,e){var t,n=M(r,"a","mul"),a=M(e,"b","mul");t=we(Er(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(WSe,i)}var gt=K({mul_:cEe});function lEe(r){var e=M(r,"x","sigmoid","float32"),t={x:e};return Q.runKernel(NNe,t)}var Tc=K({sigmoid_:lEe});function fEe(r,e,t){var n=M(r,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");var a={x:n},i={begin:e,size:t};return Q.runKernel(wNe,a,i)}var fr=K({slice_:fEe});function hEe(r){var e=M(r,"x","tanh","float32"),t={x:e};return Q.runKernel(UNe,t)}var w1=K({tanh_:hEe});function pEe(r,e,t,n,a,i){var o=M(r,"forgetBias","basicLSTMCell"),s=M(e,"lstmKernel","basicLSTMCell"),u=M(t,"lstmBias","basicLSTMCell"),c=M(n,"data","basicLSTMCell"),l=M(a,"c","basicLSTMCell"),f=M(i,"h","basicLSTMCell"),h=aa([c,f],1),p=Bt(h,s),d=Yr(p,u),m=d.shape[0],v=d.shape[1]/4,g=[m,v],y=fr(d,[0,0],g),w=fr(d,[0,v],g),b=fr(d,[0,v*2],g),x=fr(d,[0,v*3],g),S=Yr(gt(Tc(y),w1(w)),gt(l,Tc(Yr(o,b)))),T=gt(w1(S),Tc(x));return[S,T]}var dEe=K({basicLSTMCell_:pEe});function vEe(r,e,t){var n=M(r,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});G(n.rank>=1+e.length,function(){return"input rank is ".concat(n.rank," but should be > than blockShape.length ").concat(e.length)}),G(t.length===e.length,function(){return"crops.length is ".concat(t.length," but should be equal to blockShape.length  ").concat(e.length)}),G(n.shape[0]%a===0,function(){return"input tensor batch is ".concat(n.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(e.join(" * ")," === ").concat(a)});var i={x:n},o={blockShape:e,crops:t};return Q.runKernel(E2e,i,o)}var uL=K({batchToSpaceND_:vEe});function mEe(r){var e;return r.rank===0||r.rank===1?e=ge(r,[1,1,1,r.size]):r.rank===2?e=ge(r,[1,1,r.shape[0],r.shape[1]]):r.rank===3?e=ge(r,[1,r.shape[0],r.shape[1],r.shape[2]]):e=r,e}function gEe(r,e,t,n,a,i){i==null&&(i=.001);var o=M(r,"x","batchNorm"),s=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm"),c;a!=null&&(c=M(a,"scale","batchNorm"));var l;n!=null&&(l=M(n,"offset","batchNorm")),G(s.rank===u.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),G(l==null||s.rank===l.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),G(c==null||s.rank===c.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var f=mEe(o),h={x:f,scale:c,offset:l,mean:s,variance:u},p={varianceEpsilon:i},d=Q.runKernel(fSe,h,p);return ge(d,o.shape)}var Mv=K({batchNorm_:gEe});function yEe(r,e,t,n,a,i){var o=M(r,"x","batchNorm"),s=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm"),c;a!=null&&(c=M(a,"scale","batchNorm"));var l;return n!=null&&(l=M(n,"offset","batchNorm")),G(o.rank===2,function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(o.rank,".")}),G(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(s.rank,".")}),G(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&G(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&G(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(l.rank,".")}),Mv(o,s,u,l,c,i)}var bEe=K({batchNorm2d_:yEe});function wEe(r,e,t,n,a,i){var o=M(r,"x","batchNorm"),s=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm"),c;a!=null&&(c=M(a,"scale","batchNorm"));var l;return n!=null&&(l=M(n,"offset","batchNorm")),G(o.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(o.rank,".")}),G(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(s.rank,".")}),G(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&G(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&G(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(l.rank,".")}),Mv(o,s,u,l,c,i)}var xEe=K({batchNorm3d_:wEe});function kEe(r,e,t,n,a,i){var o=M(r,"x","batchNorm"),s=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm"),c;a!=null&&(c=M(a,"scale","batchNorm"));var l;return n!=null&&(l=M(n,"offset","batchNorm")),G(o.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(o.rank,".")}),G(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(s.rank,".")}),G(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&G(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&G(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(l.rank,".")}),Mv(o,s,u,l,c,i)}var SEe=K({batchNorm4d_:kEe});function NEe(r,e,t){var n=M(r,"x","bincount"),a=M(e,"weights","bincount");G(n.dtype==="int32",function(){return"Error in bincount: input "+"dtype must be int32, but got ".concat(n.dtype)}),G(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),G(a.size===n.size||a.size===0,function(){return"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(n.shape,", weights shape: ")+"".concat(a.shape,".")});var i={x:n,weights:a},o={size:t};return Q.runKernel(I2e,i,o)}var cL=K({bincount_:NEe});function TEe(r,e){var t=M(r,"x","bitwiseAnd"),n=M(e,"y","bitwiseAnd");if(!au(t.shape,n.shape))throw new Error("BitwiseAnd: Tensors must have the same shape. x: ".concat(t.shape,", y: ").concat(n.shape));if(t.dtype!=="int32"||n.dtype!=="int32")throw new Error("BitwiseAnd: Only supports 'int32' values in tensor, found type of x: ".concat(t.dtype," and type of y: ").concat(n.dtype));var a={a:t,b:n};return Q.runKernel(C2e,a)}var EEe=K({bitwiseAnd_:TEe});function IEe(r,e){var t=M(r,"s0","broadcastArgs","int32"),n=M(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error("broadcastArgs(): first input must be a vector (rank=1). "+"Has rank ".concat(t.rank));if(n.rank!==1)throw new Error("broadcastArgs(): second input must be a vector (rank=1). "+"Has rank ".concat(n.rank));var a={s0:t,s1:n};return Q.runKernel(A2e,a)}var CEe=K({broadcastArgs_:IEe});function AEe(r,e){var t=M(r,"broadcastTo","x"),n=t.shape;if(ba(e),e.length<t.rank)throw new Error("broadcastTo(): shape.length=".concat(e.length," < input.rank=").concat(t.rank,"."));if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=ge(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): [".concat(n,"] cannot be broadcast to [").concat(e,"]."));var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return Nc(t);var c={x:t},l={reps:o};return Q.runKernel(GB,c,l)}var Sv=K({broadcastTo_:AEe});function Jo(r,e,t){return e===void 0&&(e="float32"),e=e||"float32",ba(r),new p1(r,e,t)}function DEe(r){var e=M(r,"x","ceil","float32"),t={x:e};return Q.runKernel(D2e,t)}var _Ee=K({ceil_:DEe});function Bv(r,e,t){ba(r),t=t||Pv(e);var n={shape:r,value:e,dtype:t};return Q.runKernel(sSe,{},n)}function FEe(r,e,t){var n=M(r,"x","clipByValue");if(G(e<=t,function(){return"Error in clip: min (".concat(e,") must be ")+"less than or equal to max (".concat(t,").")}),e===t)return Bv(n.shape,e,n.dtype);var a={x:n},i={clipValueMin:e,clipValueMax:t};return Q.runKernel(_2e,a,i)}var REe=K({clipByValue_:FEe});function OEe(r,e){var t=M(r,"real","complex"),n=M(e,"imag","complex");Xa(t.shape,n.shape,"real and imag shapes, ".concat(t.shape," and ").concat(n.shape,", ")+"must match in call to tf.complex().");var a={real:t,imag:n};return Q.runKernel(F2e,a)}var tu=K({complex_:OEe});function PEe(r){return aa(r,0)}var MEe=K({concat1d_:PEe});function BEe(r,e){return aa(r,e)}var LEe=K({concat2d_:BEe});function zEe(r,e){return aa(r,e)}var $Ee=K({concat3d_:zEe});function qEe(r,e){return aa(r,e)}var WEe=K({concat4d_:qEe});function VEe(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=M(r,"x","conv2d","float32"),u=M(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),G(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")}),G(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")}),Si("conv2d",n,o);var f=a==="NHWC"?c.shape[3]:c.shape[1];G(f===u.shape[2],function(){return"Error in conv2d: depth of input (".concat(f,") must match ")+"input depth for filter ".concat(u.shape[2],".")}),G(es(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),G(Cc(i),function(){return"Error in conv2D: Dilated rates should be larger than 0."}),G(Cc(t),function(){return"Error in conv2D: Strides should be larger than 0."});var h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=Q.runKernel(P2e,h,p);return l?ge(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Lv=K({conv2d_:VEe});function UEe(r,e,t,n,a,i,o){a===void 0&&(a="NWC"),i===void 0&&(i=1);var s=M(r,"x","conv1d"),u=M(e,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=ge(s,[1,s.shape[0],s.shape[1]])),G(c.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")}),G(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+"".concat(u.rank,".")}),Si("conv1d",n,o),G(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match ")+"input depth for filter ".concat(u.shape[1],".")}),G(es(t,i),function(){return"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(t," and dilation '").concat(i,"'")}),G(Cc(i),function(){return"Error in conv1D: Dilated rates should be larger than 0."}),G(Cc(t),function(){return"Error in conv1D: Stride should be larger than 0."}),G(a==="NWC",function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")});var f=ge(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=ge(c,[c.shape[0],1,c.shape[1],c.shape[2]]),p=[1,t],d=[1,i],m="NHWC",v=Lv(h,f,p,n,m,d,o);return l?ge(v,[v.shape[2],v.shape[3]]):ge(v,[v.shape[0],v.shape[2],v.shape[3]])}var GEe=K({conv1d_:UEe});function HEe(r,e,t,n,a,i,o){i===void 0&&(i="NHWC"),G(r.length===e.rank,function(){return"Length of inShape "+"(".concat(r.length,") and rank of dy (").concat(e.rank,") must match")});var s=r,u=e,c=!1;e.rank===3&&(c=!0,u=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,r[0],r[1],r[2]]),G(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")}),G(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)}),G(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(t.rank)});var l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];G(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(t.shape[2],".")}),G(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output (".concat(f,") must ")+"match output depth for filter ".concat(t.shape[3],".")}),Si("conv2dDerInput",a,o);var h={dy:u,filter:t},p={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=Q.runKernel(B2e,h,p);return c?ge(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var lL=K({conv2DBackpropInput_:HEe});function KEe(r,e,t,n,a,i){var o=M(r,"x","conv2dTranspose"),s=M(e,"filter","conv2dTranspose");return lL(t,o,s,n,a,"NHWC",i)}var jEe=K({conv2dTranspose_:KEe});function XEe(r,e,t,n,a,i){a===void 0&&(a="NDHWC"),i===void 0&&(i=[1,1,1]);var o=M(r,"x","conv3d"),s=M(e,"filter","conv3d"),u=o,c=!1;o.rank===4&&(c=!0,u=ge(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),G(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")}),G(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+"".concat(s.rank,".")}),G(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match ")+"input depth for filter ".concat(s.shape[3],".")}),G(es(t,i),function(){return"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),G(a==="NDHWC",function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")}),G(Cc(i),function(){return"Error in conv3D: Dilated rates should be larger than 0."}),G(Cc(t),function(){return"Error in conv3D: Strides should be larger than 0."});var l={x:u,filter:s},f={strides:t,pad:n,dataFormat:a,dilations:i},h=Q.runKernel(L2e,l,f);return c?ge(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var YEe=K({conv3d_:XEe});function ZEe(r,e,t,n,a){G(r.length===e.rank,function(){return"Length of inShape "+"(".concat(r.length,") and rank of dy (").concat(e.rank,") must match")});var i=r,o=e,s=!1;e.rank===4&&(s=!0,o=ge(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,r[0],r[1],r[2],r[3]]);var u=i[4],c=o.shape[4];G(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")}),G(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)}),G(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(t.rank)}),G(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(t.shape[3],".")}),G(c===t.shape[4],function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(t.shape[4],".")});var l={dy:o,filter:t},f={pad:a,strides:n,inputShape:i},h=Q.runKernel(z2e,l,f);return s?ge(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var JEe=K({conv3DBackpropInput_:ZEe});function QEe(r,e,t,n,a){var i=M(r,"x","conv3dTranspose"),o=M(e,"filter","conv3dTranspose");return JEe(t,i,o,n,a)}var eIe=K({conv3dTranspose_:QEe});function tIe(r){var e=M(r,"x","cos","float32"),t={x:e};return Q.runKernel($2e,t)}var rIe=K({cos_:tIe});function nIe(r){var e=M(r,"x","cosh","float32"),t={x:e};return Q.runKernel(q2e,t)}var aIe=K({cosh_:nIe});function iIe(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=M(r,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:n};return Q.runKernel(W2e,i,o)}var oIe=K({cumprod_:iIe});function sIe(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var a=M(r,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:n};return Q.runKernel(V2e,i,o)}var uIe=K({cumsum_:sIe});function cIe(r,e,t,n){n===void 0&&(n=!1);var a=M(r,"x","denseBincount"),i=M(e,"weights","denseBincount");G(a.dtype==="int32",function(){return"Error in denseBincount: input "+"dtype must be int32, but got ".concat(a.dtype)}),G(a.rank<=2,function(){return"Error in denseBincount: input must be at most rank 2, but got "+"rank ".concat(a.rank,".")}),G(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),G(i.size===a.size||i.size===0,function(){return"Error in denseBincount: weights must have the same shape as x or "+"0-length, but got x shape: ".concat(a.shape,", weights shape: ")+"".concat(i.shape,".")});var o={x:a,weights:i},s={size:t,binaryOutput:n};return Q.runKernel(G2e,o,s)}var lIe=K({denseBincount_:cIe});function fIe(r,e,t){t===void 0&&(t="NHWC");var n=M(r,"x","depthToSpace","float32"),a=t==="NHWC"?n.shape[1]:n.shape[2],i=t==="NHWC"?n.shape[2]:n.shape[3],o=t==="NHWC"?n.shape[3]:n.shape[1];G(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(e)}),G(a*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(a," and ").concat(e,`  for depthToSpace with input shape
    `).concat(n.shape)}),G(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(i," and ").concat(e,` for depthToSpace with input shape
        `).concat(n.shape)}),G(o%(e*e)===0,function(){return"Dimension size must be evenly divisible by ".concat(e*e," but is ").concat(o," for depthToSpace with input shape ").concat(n.shape)});var s={x:n},u={blockSize:e,dataFormat:t};return Q.runKernel(H2e,s,u)}var hIe=K({depthToSpace_:fIe});function pIe(r,e,t,n,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=M(r,"x","depthwiseConv2d","float32"),u=M(e,"filter","depthwiseConv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),G(c.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(c.rank,".")}),G(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")});var f=a==="NHWC"?c.shape[3]:c.shape[1];G(f===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels "+"(".concat(f,") must match the inChannels dimension in ")+"filter ".concat(u.shape[2],".")}),Si("depthwiseConv2d",n,o);var h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=Q.runKernel(K2e,h,p);return l?ge(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var B1=K({depthwiseConv2d_:pIe});function dIe(r){var e=M(r,"x","diag"),t={x:e};return Q.runKernel(Y2e,t)}var vIe=K({diag_:dIe});function mIe(r,e,t,n,a,i){a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC");var o=M(r,"x","dilation2d"),s=M(e,"filter","dilation2d");G(o.rank===3||o.rank===4,function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(o.rank,".")}),G(s.rank===3,function(){return"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(s.rank,".")}),G(i==="NHWC",function(){return"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(i)});var u=o,c=!1;o.rank===3&&(u=ge(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),G(u.shape[3]===s.shape[2],function(){return"Error in dilation2d:  input and filter must have the same depth: ".concat(u.shape[3]," vs ").concat(s.shape[2])});var l={x:u,filter:s},f={strides:t,pad:n,dilations:a},h=Q.runKernel(Z2e,l,f);return c?ge(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var gIe=K({dilation2d_:mIe});function yIe(r,e){var t,n=M(r,"a","floorDiv"),a=M(e,"b","floorDiv");t=we(Er(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(lSe,i)}var fL=K({floorDiv_:yIe});function bIe(r,e){var t,n=M(r,"a","div"),a=M(e,"b","div");if(t=we(Er(n,a),2),n=t[0],a=t[1],n.dtype==="int32"&&a.dtype==="int32")return fL(n,a);var i={a:n,b:a},o={};return Q.runKernel(J2e,i,o)}var wn=K({div_:bIe});function wIe(r,e){for(var t=[],n=0;n<e.length;n++){var a=r[r.length-n-1],i=e.length-n-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function Zr(r,e){for(var t=Math.max(r.length,e.length),n=new Array(t),a=0;a<t;a++){var i=r[r.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)n[t-a-1]=o;else if(o===1)n[t-a-1]=i;else if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(r," and ").concat(e,".");throw Error(s)}else n[t-a-1]=i}return n}function xIe(r,e){var t,n=M(r,"a","equal","string_or_numeric"),a=M(e,"b","equal","string_or_numeric");t=we(Er(n,a),2),n=t[0],a=t[1],Zr(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(rSe,i)}var hL=K({equal_:xIe});function kIe(r,e,t){var n=M(e,"a","where"),a=M(t,"b","where"),i=M(r,"condition","where","bool"),o=Zr(Zr(i.shape,n.shape),a.shape),s=Sv(i,o),u=Sv(n,o),c=Sv(a,o),l={condition:s,t:u,e:c};return Q.runKernel(yNe,l)}var Zo=K({where_:kIe});function SIe(r){var e=M(r,"x","zerosLike"),t={x:e};return Q.runKernel(YNe,t)}var L1=K({zerosLike_:SIe});function NIe(r,e){var t,n=M(r,"a","div"),a=M(e,"b","div");t=we(Er(n,a),2),n=t[0],a=t[1];var i=wn(n,a),o=L1(i),s=hL(a,o);return Zo(s,o,i)}var TIe=K({divNoNan_:NIe});function EIe(r,e){var t=M(r,"t1","dot"),n=M(e,"t2","dot");G((t.rank===1||t.rank===2)&&(n.rank===1||n.rank===2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(t.rank," and ").concat(n.rank,".")});var a=t.rank===1?t.size:t.shape[1],i=n.rank===1?n.size:n.shape[0];if(G(a===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+"".concat(a," and ").concat(i,".")}),t.rank===1&&n.rank===1){var o=ge(t,[1,-1]),s=ge(n,[-1,1]),u=Bt(o,s);return ge(u,[])}else if(t.rank===1&&n.rank===2){var o=ge(t,[1,-1]),s=ge(n,[n.shape[0],n.shape[1]]),u=Bt(o,s);return ge(u,[u.size])}else if(t.rank===2&&n.rank===1){var s=ge(n,[-1,1]),u=Bt(t,s);return ge(u,[u.size])}else{var s=ge(n,[n.shape[0],n.shape[1]]),u=Bt(t,s);return u}}var IIe=K({dot_:EIe});function CIe(r){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var n=e.map(function(i,o){return M(i,"tensors".concat(o),"einsum")}),a={equation:r};return Q.runKernel(Q2e,n,a)}var AIe=K({einsum_:CIe});function DIe(r){var e=M(r,"x","elu","float32"),t={x:e};return Q.runKernel(eSe,t)}var pL=K({elu_:DIe});function _Ie(r,e){var t=M(r,"x","ensureShape","string_or_numeric");if(!Yke(t.shape,e))throw new Error("EnsureShape: Shape of tensor ".concat(t.shape," is not compatible with expected shape ").concat(e));return r}var FIe=K({ensureShape_:_Ie});function RIe(r){var e=M(r,"x","erf");G(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=an(e,"float32"));var t={x:e};return Q.runKernel(tSe,t)}var OIe=K({erf_:RIe});function PIe(r,e,t){for(var n=r.length+e.length,a=[],i=0,o=0,s=0;s<n;s++)t.indexOf(s)===-1?a.push(r[i++]):a.push(e[o++]);return a}function zv(r,e){var t=e.map(function(n){return 1});return PIe(r,t,e)}function MIe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=M(r,"x","max"),a={x:n},i={reductionIndices:e,keepDims:t};return Q.runKernel(_Se,a,i)}var Ec=K({max_:MIe});function BIe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=M(r,"x","min"),a={x:n},i={axis:e,keepDims:t};return Q.runKernel(BSe,a,i)}var x1=K({min_:BIe});function LIe(r,e){var t,n=M(r,"base","pow"),a=M(e,"exp","pow");t=we(Er(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(JSe,i)}var z1=K({pow_:LIe});function ts(r,e,t,n){if(n==null)n=Pv(r);else if(n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(rL(r)||tL(r)){if(n!=="float32"&&n!=="int32")throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(n,"."));return Q.backend.createTensorFromGPUData(r,e||t,n)}if(!xi(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){ba(e);var a=Mn(e),i=Mn(t);G(a===i,function(){return"Based on the provided shape, [".concat(e,"], the tensor should have ")+"".concat(a," values but has ").concat(i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==Mn(e.slice(o)):!0;G(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(t,") does not match the provided ")+"shape (".concat(e,"). ")})}}return!xi(r)&&!Array.isArray(r)&&(r=[r]),e=e||t,r=n!=="string"?QB(r,n):jf(r,[],!0),Q.makeTensor(r,e,n)}function _r(r,e){if((xi(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&xi(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],n=[];return ts(r,t,n,e)}function zIe(r){var e=M(r,"x","sqrt","float32"),t={x:e};return Q.runKernel(ENe,t)}var k1=K({sqrt_:zIe});function $Ie(r){var e=M(r,"x","square"),t={};return Q.runKernel("Square",{x:e},t)}var $v=K({square_:$Ie});function qIe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=M(r,"x","sum");n.dtype==="bool"&&(n=an(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return Q.runKernel(INe,a,i)}var er=K({sum_:qIe});function WIe(r,e,t,n){e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1),r=M(r,"x","norm");var a=dL(r,e,t),i=a.shape;if(n){var o=Ov(t,r.shape);i=zv(a.shape,o)}return ge(a,i)}function dL(r,e,t){if(t===void 0&&(t=null),r.rank===0)return Ua(r);if(r.rank!==1&&t===null)return dL(ge(r,[-1]),e,t);if(r.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return er(Ua(r),t);if(e===1/0)return Ec(Ua(r),t);if(e===-1/0)return x1(Ua(r),t);if(e==="euclidean"||e===2)return k1(er(z1(Ua(r),_r(2,"int32")),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}if(Array.isArray(t)&&t.length===2){if(e===1)return Ec(er(Ua(r),t[0]),t[1]-1);if(e===1/0)return Ec(er(Ua(r),t[1]),t[0]);if(e===-1/0)return x1(er(Ua(r),t[1]),t[0]);if(e==="fro"||e==="euclidean")return k1(er($v(r),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}throw new Error("Error in norm: invalid axis: ".concat(t))}var qv=K({norm_:WIe});function VIe(r,e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),qv(r,"euclidean",e,t)}var UIe=K({euclideanNorm_:VIe});function GIe(r){var e=M(r,"x","exp"),t={x:e};return Q.runKernel(nSe,t)}var ru=K({exp_:GIe});function HIe(r,e){e===void 0&&(e=0);var t=M(r,"x","expandDims","string_or_numeric");G(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var n={input:t},a={dim:e};return Q.runKernel(aSe,n,a)}var Zs=K({expandDims_:HIe});function KIe(r){var e=M(r,"x","expm1"),t={x:e};return Q.runKernel(iSe,t)}var jIe=K({expm1_:KIe});function XIe(r,e){var t=M(r,"x","tile","string_or_numeric");G(t.rank===e.length,function(){return"Error in transpose: rank of input ".concat(t.rank," ")+"must match length of reps ".concat(e,".")});var n={x:t},a={reps:e};return Q.runKernel(GB,n,a)}var Gf=K({tile_:XIe});function YIe(r,e,t,n){n===void 0&&(n="float32"),e==null&&(e=r);for(var a=Jo([r,e],n),i=r<=e?r:e,o=0;o<i;++o)a.set(1,o,o);var s=ge(a.toTensor(),[r,e]);if(t==null)return s;if(t.length===1)return Gf(Zs(s,0),[t[0],1,1]);if(t.length===2)return Gf(Zs(Zs(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return Gf(Zs(Zs(Zs(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(t.length,"D."))}var vL=K({eye_:YIe});function ZIe(r){var e=M(r,"x","floor","float32"),t={x:e};return Q.runKernel(cSe,t)}var mL=K({floor_:ZIe});function JIe(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=0);var a=M(r,"x","gather"),i=M(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:n};return Q.runKernel(hSe,o,s)}var gL=K({gather_:JIe});function QIe(r,e){var t,n=M(r,"a","greater","string_or_numeric"),a=M(e,"b","greater","string_or_numeric");t=we(Er(n,a),2),n=t[0],a=t[1],Zr(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(dSe,i)}var Wv=K({greater_:QIe});function eCe(r,e){var t,n=M(r,"a","greaterEqual","string_or_numeric"),a=M(e,"b","greaterEqual","string_or_numeric");t=we(Er(n,a),2),n=t[0],a=t[1],Zr(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(vSe,i)}var yL=K({greaterEqual_:eCe});function tCe(r){var e=M(r,"input","imag"),t={input:e};return Q.runKernel(gSe,t)}var Vv=K({imag_:tCe});function rCe(r){var e=M(r,"x","isFinite"),t={x:e};return Q.runKernel(ySe,t)}var nCe=K({isFinite_:rCe});function aCe(r){var e=M(r,"x","isInf"),t={x:e};return Q.runKernel(bSe,t)}var iCe=K({isInf_:aCe});function oCe(r){var e=M(r,"x","isNaN"),t={x:e};return Q.runKernel(wSe,t)}var sCe=K({isNaN_:oCe});function uCe(r,e){e===void 0&&(e=.2);var t=M(r,"x","leakyRelu"),n={x:t},a={alpha:e};return Q.runKernel(xSe,n,a)}var bL=K({leakyRelu_:uCe});function cCe(r,e){var t,n=M(r,"a","less","string_or_numeric"),a=M(e,"b","less","string_or_numeric");t=we(Er(n,a),2),n=t[0],a=t[1],Zr(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(kSe,i)}var S1=K({less_:cCe});function lCe(r,e){var t,n=M(r,"a","lessEqual","string_or_numeric"),a=M(e,"b","lessEqual","string_or_numeric");t=we(Er(n,a),2),n=t[0],a=t[1],Zr(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(SSe,i)}var $1=K({lessEqual_:lCe});function fCe(r,e,t){if(t<=0)throw new Error("The number of values should be positive.");var n={start:r,stop:e,num:t};return Q.runKernel(NSe,{},n)}function hCe(r,e,t,n,a){e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),a===void 0&&(a=.5);var i=M(r,"x","localResponseNormalization");G(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `.concat(i.rank,".")}),G(Kf(e),function(){return"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(e,".")});var o=i,s=!1;i.rank===3&&(s=!0,o=ge(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:e,bias:t,alpha:n,beta:a},l=Q.runKernel(DSe,u,c);return s?ge(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var pCe=K({localResponseNormalization_:hCe});function dCe(r){var e=M(r,"x","log","float32"),t={x:e};return Q.runKernel(TSe,t)}var Yf=K({log_:dCe});function vCe(r){var e=M(r,"x","log1p"),t={x:e};return Q.runKernel(ESe,t)}var wL=K({log1p_:vCe});function co(r){return Q.customGrad(r)}function mCe(r){var e=M(r,"x","neg"),t={x:e};return Q.runKernel(VSe,t)}var Li=K({neg_:mCe});function gCe(r){var e=M(r,"x","softplus"),t={x:e};return Q.runKernel(TNe,t)}var xL=K({softplus_:gCe});function yCe(r){var e=M(r,"x","logSigmoid"),t=co(function(n){var a=Li(xL(Li(n))),i=function(o){var s=gt(o,Tc(Li(n)));return s};return{value:a,gradFunc:i}});return t(e)}var bCe=K({logSigmoid_:yCe});function wCe(r,e){var t,n=M(r,"a","sub"),a=M(e,"b","sub");t=we(Er(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel(WNe,i)}var Ct=K({sub_:wCe});function xCe(r,e){e===void 0&&(e=-1);var t=M(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and axis was ").concat(e));var n=co(function(a,i){var o=!0,s=Ec(a,e,!0),u=Ct(a,s),c=Ct(an(u,"float32"),Yf(er(ru(u),e,o)));i([c]);var l=function(f,h){var p=we(h,1),d=p[0],m=!0,v=ru(d);return Ct(f,gt(er(f,e,m),v))};return{value:c,gradFunc:l}});return n(t)}var kCe=K({logSoftmax_:xCe});function SCe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=M(r,"x","logSumExp"),a=Ov(e,n.shape),i=Ec(n,a,!0),o=Ct(n,i),s=ru(o),u=er(s,a),c=Yf(u),l=Yr(ge(i,c.shape),c);if(t){var f=zv(l.shape,a);return ge(l,f)}return l}var kL=K({logSumExp_:SCe});function NCe(r,e){var t=M(r,"a","logicalAnd","bool"),n=M(e,"b","logicalAnd","bool");Zr(t.shape,n.shape);var a={a:t,b:n};return Q.runKernel(ISe,a)}var Dv=K({logicalAnd_:NCe});function TCe(r){var e=M(r,"x","logicalNot","bool"),t={x:e};return Q.runKernel(CSe,t)}var SL=K({logicalNot_:TCe});function ECe(r,e){var t=M(r,"a","logicalOr","bool"),n=M(e,"b","logicalOr","bool");Zr(t.shape,n.shape);var a={a:t,b:n};return Q.runKernel(ASe,a)}var NL=K({logicalOr_:ECe});function ICe(r,e){var t=M(r,"a","logicalXor","bool"),n=M(e,"b","logicalXor","bool");return Zr(t.shape,n.shape),Dv(NL(r,e),SL(Dv(r,e)))}var CCe=K({logicalXor_:ICe});var yv=2147483648;function ACe(r,e,t){t===void 0&&(t="left");var n=M(r,"sortedSequence","searchSorted"),a=M(e,"values","searchSorted"),i=n.shape[n.shape.length-1],o=a.shape[a.shape.length-1],s=ge(n,[-1,i]),u=ge(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(Mn(u.shape)>=yv)throw new Error("values tensor size must less than ".concat(yv));if(s.shape[1]>=yv)throw new Error("trailing dim_size must less than ".concat(yv," for int32 output type, was ").concat(s.shape[1]));var c={sortedSequence:s,values:u},l={side:t};return Q.runKernel(gNe,c,l)}var q1=K({searchSorted_:ACe});function DCe(r,e){return q1(r,e,"left")}function _Ce(r,e,t,n,a){var i=M(r,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=ge(i,[1,i.shape[0],i.shape[1],i.shape[2]])),G(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(s.rank,".")}),G(es(t,o),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")}),Si("maxPool",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=Q.runKernel(RSe,c,l);return u?ge(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var TL=K({maxPool_:_Ce});function FCe(r,e,t,n,a,i){e===void 0&&(e=[1,1,1]),i===void 0&&(i="NDHWC");var o=M(r,"x","maxPool3d"),s=o,u=!1;o.rank===4&&(u=!0,s=ge(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),G(s.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),G(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),Si("maxPool3d",n,a);var c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a,dataFormat:i},f=Q.runKernel(OSe,c,l);return u?ge(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var RCe=K({maxPool3d_:FCe});function OCe(r,e,t,n,a){a===void 0&&(a=!1);var i=M(r,"x","maxPoolWithArgmax"),o={x:i},s={filterSize:e,strides:t,pad:n,includeBatchInIndex:a},u=Q.runKernel(PSe,o,s);return{result:u[0],indexes:u[1]}}var PCe=K({maxPoolWithArgmax_:OCe});function MCe(r,e){var t,n=M(r,"a","maximum"),a=M(e,"b","maximum");t=we(Er(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=an(n,"int32"),a=an(a,"int32")),Zr(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(FSe,i)}var BCe=K({maximum_:MCe});function LCe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=M(r,"x","mean"),a={x:n},i={axis:e,keepDims:t};return Q.runKernel(MSe,a,i)}var _v=K({mean_:LCe});function Ac(r,e){if(e===void 0&&(e="float32"),ba(r),e==="complex64"){var t=Ac(r,"float32"),n=Ac(r,"float32");return tu(t,n)}var a=D1(Mn(r),e);return Q.makeTensor(a,r,e)}function eu(r,e){if(e===void 0&&(e="float32"),ba(r),e==="complex64"){var t=eu(r,"float32"),n=Ac(r,"float32");return tu(t,n)}var a=zB(Mn(r),e);return Q.makeTensor(a,r,e)}function zCe(r,e,t){var n=t===void 0?{}:t,a=n.indexing,i=a===void 0?"xy":a;if(i!=="xy"&&i!=="ij")throw new TypeError("".concat(i," is not a valid third argument to meshgrid"));if(r===void 0)return[];var o=M(r,"x","meshgrid",r instanceof On?r.dtype:"float32");if(e===void 0)return[o];var s=M(e,"y","meshgrid",e instanceof On?e.dtype:"float32"),u=Mn(o.shape),c=Mn(s.shape);return i==="xy"?(o=ge(o,[1,-1]),s=ge(s,[-1,1]),[Bt(eu([c,1],o.dtype),o),Bt(s,eu([1,u],s.dtype))]):(o=ge(o,[-1,1]),s=ge(s,[1,-1]),[Bt(o,eu([1,c],o.dtype)),Bt(eu([u,1],s.dtype),s)])}function $Ce(r,e){var t,n=M(r,"a","minimum"),a=M(e,"b","minimum");t=we(Er(n,a),2),n=t[0],a=t[1],n.dtype==="bool"&&(n=an(n,"int32"),a=an(a,"int32")),Zr(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(LSe,i)}var Fv=K({minimum_:$Ce});function qCe(r,e,t){G(t==="reflect"||t==="symmetric",function(){return"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(t,".")});var n=M(r,"x","mirrorPad");if(n.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");G(e.length===n.rank,function(){return"Padding doesn't match input. Must be ".concat(n.rank,". ")+"Got ".concat(e.length,".")});for(var a=t==="reflect"?1:0,i=function(c){G(e[c].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),G(e[c][0]>=0&&e[c][0]<=n.shape[c]-a&&e[c][1]>=0&&e[c][1]<=n.shape[c]-a,function(){return"Padding in dimension ".concat(c," cannot be greater than or equal ")+"to ".concat(n.shape[c]-a," or less than 0 for input of ")+"shape ".concat(n.shape)})},o=0;o<n.rank;o++)i(o);var s={paddings:e,mode:t},u={x:n};return Q.runKernel(zSe,u,s)}var WCe=K({mirrorPad_:qCe});function VCe(r,e){var t,n=M(r,"a","mod"),a=M(e,"b","mod");t=we(Er(n,a),2),n=t[0],a=t[1];var i={a:n,b:a};return Q.runKernel($Se,i)}var UCe=K({mod_:VCe});function GCe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1),r=M(r,"x","moments");var n=Ov(e,r.shape),a=_v(r,n,t),i=a.shape;t||(i=zv(a.shape,n));var o=$v(Ct(an(r,"float32"),ge(a,i))),s=_v(o,n,t);return{mean:a,variance:s}}var HCe=K({moments_:GCe});function KCe(r,e,t,n){for(var a=M(e,"data","multiRNNCell"),i=Iv(t,"c","multiRNNCell"),o=Iv(n,"h","multiRNNCell"),s=a,u=[],c=0;c<r.length;c++){var l=r[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}for(var f=[],h=[],c=0;c<u.length;c+=2)f.push(u[c]),h.push(u[c+1]);return[f,h]}var jCe=K({multiRNNCell_:KCe});function XCe(r,e,t,n){n===void 0&&(n=!1);var a=M(r,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+"".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));t=t||Math.random();var s=o===1?ge(a,[1,-1]):a,u={logits:s},c={numSamples:e,seed:t,normalized:n},l=Q.runKernel(qSe,u,c);return o===1?ge(l,[l.size]):l}var YCe=K({multinomial_:XCe});function ZCe(r,e){var t,n=M(r,"a","notEqual","string_or_numeric"),a=M(e,"b","notEqual","string_or_numeric");t=we(Er(n,a),2),n=t[0],a=t[1],Zr(n.shape,a.shape);var i={a:n,b:a};return Q.runKernel(USe,i)}var EL=K({notEqual_:ZCe});function JCe(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n=0),a===void 0&&(a="int32"),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(e));var i=M(r,"indices","oneHot","int32"),o={indices:i},s={dtype:a,depth:e,onValue:t,offValue:n};return Q.runKernel(XSe,o,s)}var QCe=K({oneHot_:JCe});function eAe(r){var e=M(r,"x","onesLike"),t={x:e};return Q.runKernel(jSe,t)}var tAe=K({onesLike_:eAe});function rAe(r,e){var t=M(r,"v1","outerProduct"),n=M(e,"v2","outerProduct");G(t.rank===1&&n.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+"".concat(t.rank," and ").concat(n.rank,".")});var a=ge(t,[-1,1]),i=ge(n,[1,-1]);return Bt(a,i)}var nAe=K({outerProduct_:rAe});function aAe(r,e,t){t===void 0&&(t=0);var n=M(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:n};return Q.runKernel(ZSe,i,a)}var th=K({pad_:aAe});function iAe(r,e,t){return t===void 0&&(t=0),G(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),th(r,[e],t)}var oAe=K({pad1d_:iAe});function sAe(r,e,t){return t===void 0&&(t=0),G(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),th(r,e,t)}var uAe=K({pad2d_:sAe});function cAe(r,e,t){return t===void 0&&(t=0),G(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),th(r,e,t)}var lAe=K({pad3d_:cAe});function fAe(r,e,t){return t===void 0&&(t=0),G(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),th(r,e,t)}var hAe=K({pad4d_:fAe});function pAe(r,e,t){var n=M(r,"x","spaceToBatchND");G(n.rank>=1+e.length,function(){return"input rank ".concat(n.rank," should be > than [blockShape] ").concat(e.length)}),G(t.length===e.length,function(){return"paddings.shape[0] ".concat(t.length," must be equal to [blockShape] ").concat(e.length)}),G(n.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions ".concat(n.shape.slice(1)," with paddings ").concat(t.toString()," must be divisible by blockShapes ").concat(e.toString())});var a={x:n},i={blockShape:e,paddings:t};return Q.runKernel(CNe,a,i)}var IL=K({spaceToBatchND_:pAe});function dAe(r,e,t,n,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),n===0&&(n="valid");var s=M(r,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),G(es(i,a),function(){return"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'")});var l=JTe(u.shape,e,i,a,n),f=[l.dilationHeight,l.dilationWidth],h;n==="same"?h=mAe([l.filterHeight,l.filterWidth],f):h=[[0,0],[0,0]];var p=f[0]===1&&f[1]===1,d=we(vAe([l.inHeight,l.inWidth],f,h),2),m=d[0],v=d[1],g=p?n:"valid",y=p?u:IL(u,f,m),w=t==="avg"?function(){return sL(y,e,i,g,o)}:function(){return TL(y,e,i,g,o)},b=w(),x=p?b:uL(b,f,v);return c?ge(x,[x.shape[1],x.shape[2],x.shape[3]]):x}function vAe(r,e,t){var n=t.map(function(l){return l[0]}),a=t.map(function(l){return l[1]}),i=r.concat(n,a),o=e.map(function(l,f){return(l-i[f]%l)%l}),s=a.map(function(l,f){return l+o[f]}),u=e.map(function(l,f){return[n[f],s[f]]}),c=e.map(function(l,f){return[0,o[f]]});return[u,c]}function mAe(r,e){var t=r.map(function(o,s){return o+(o-1)*(e[s]-1)}),n=t.map(function(o){return o-1}),a=n.map(function(o){return Math.floor(o/2)}),i=n.map(function(o,s){return o-a[s]});return n.map(function(o,s){return[a[s],i[s]]})}var gAe=K({pool_:dAe});function yAe(r,e){var t=M(r,"x","prelu"),n=M(e,"alpha","prelu"),a={x:t,alpha:n};return Q.runKernel(QSe,a)}var CL=K({prelu_:yAe});function bAe(r,e){e===void 0&&(e=!1),console.log(r.toString(e))}function wAe(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=M(r,"x","prod");n.dtype==="bool"&&(n=an(n,"int32"));var a={x:n},i={axis:e,keepDims:t};return Q.runKernel(eNe,a,i)}var xAe=K({prod_:wAe});function kAe(r,e,t,n){var a=r.map(function(l,f){return M(l,"tensors".concat(f),"raggedGather","int32")}),i=M(e,"paramsDenseValues","raggedGather"),o=M(t,"indices","raggedGather","int32"),s={paramsNestedSplits:a,paramsDenseValues:i,indices:o},u={outputRaggedRank:n},c=Q.runKernel(tNe,s,u);return{outputNestedSplits:c.slice(0,c.length-1),outputDenseValues:c[c.length-1]}}var SAe=K({raggedGather_:kAe});function NAe(r,e,t){var n=M(r,"starts","raggedRange"),a=M(e,"limits","raggedRange",n.dtype),i=M(t,"deltas","raggedRange",n.dtype),o={starts:n,limits:a,deltas:i},s=Q.runKernel(rNe,o);return{rtNestedSplits:s[0],rtDenseValues:s[1]}}var TAe=K({raggedRange_:NAe});function EAe(r,e,t,n,a){var i=M(r,"shape","raggedTensorToTensor","int32"),o=M(e,"values","raggedTensorToTensor"),s=M(t,"defaultValue","raggedTensorToTensor",o.dtype),u=n.map(function(f,h){return M(f,"tensors".concat(h),"raggedTensorToTensor","int32")}),c={shape:i,values:o,defaultValue:s,rowPartitionTensors:u},l={rowPartitionTypes:a};return Q.runKernel(nNe,c,l)}var IAe=K({raggedTensorToTensor_:EAe});function CAe(r,e,t){ba(r);var n=Mn(r),a=null;if(t==null||t==="float32")a=new Float32Array(n);else if(t==="int32")a=new Int32Array(n);else if(t==="bool")a=new Uint8Array(n);else throw new Error("Unknown data type ".concat(t));for(var i=0;i<n;i++)a[i]=e();return Q.makeTensor(a,r,t)}var AAe=K({rand_:CAe}),AL={exports:{}};(function(r){(function(e,t,n){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(iu,r,!1)})(AL);var DAe=AL.exports,DL={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(iu,r,!1)})(DL);var _Ae=DL.exports,_L={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(iu,r,!1)})(_L);var FAe=_L.exports,FL={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,p;return h=l[f],h^=h>>>7,p=h^h<<24,h=l[f+1&7],p^=h^h>>>10,h=l[f+3&7],p^=h^h>>>3,h=l[f+4&7],p^=h^h<<7,h=l[f+7&7],h=h^h<<13,p^=h^h<<9,l[f]=p,u.i=f+1&7,p};function c(l,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8?p[7]=-1:p[h],l.x=p,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(iu,r,!1)})(FL);var RAe=FL.exports,RL={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,p,d;return u.w=l=l+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(l^l>>>16)|0};function c(l,f){var h,p,d,m,v,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,m=-32;m<y;++m)f&&(p^=f.charCodeAt((m+32)%f.length)),m===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(v=v+1640531527|0,h=g[m&127]^=p+v,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,m=4*128;m>0;--m)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;l.w=v,l.X=g,l.i=d}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(iu,r,!1)})(RL);var OAe=RL.exports,OL={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(iu,r,!1)})(OL);var PAe=OL.exports,PL={exports:{}},MAe={},BAe={__proto__:null,default:MAe},LAe=nTe(BAe);(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),c=n.pow(2,o),l=c*2,f=a-1,h;function p(b,x,S){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(v(x.entropy?[b,w(t)]:b??y(),3),T),C=new d(T),R=function(){for(var _=C.g(i),O=u,$=0;_<c;)_=(_+$)*a,O*=a,$=C.g(1);for(;_>=l;)_/=2,O/=2,$>>>=1;return(_+$)/O};return R.int32=function(){return C.g(4)|0},R.quick=function(){return C.g(4)/4294967296},R.double=R,g(w(C.S),t),(x.pass||S||function(_,O,$,z){return z&&(z.S&&m(z,C),_.state=function(){return m(C,{})}),$?(n[s]=_,O):_})(R,E,"global"in x?x.global:this==n,x.state)}function d(b){var x,S=b.length,T=this,E=0,C=T.i=T.j=0,R=T.S=[];for(S||(b=[S++]);E<a;)R[E]=E++;for(E=0;E<a;E++)R[E]=R[C=f&C+b[E%S]+(x=R[E])],R[C]=x;(T.g=function(_){for(var O,$=0,z=T.i,L=T.j,B=T.S;_--;)O=B[z=f&z+1],$=$*a+B[f&(B[z]=B[L=f&L+O])+(B[L]=O)];return T.i=z,T.j=L,$})(a)}function m(b,x){return x.i=b.i,x.j=b.j,x.S=b.S.slice(),x}function v(b,x){var S=[],T=typeof b,E;if(x&&T=="object")for(E in b)try{S.push(v(b[E],x-1))}catch{}return S.length?S:T=="string"?b:b+"\0"}function g(b,x){for(var S=b+"",T,E=0;E<S.length;)x[f&E]=f&(T^=x[f&E]*19)+S.charCodeAt(E++);return w(x)}function y(){try{var b;return h&&(b=h.randomBytes)?b=b(a):(b=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(b)),w(b)}catch{var x=e.navigator,S=x&&x.plugins;return[+new Date,e,S,e.screen,w(t)]}}function w(b){return String.fromCharCode.apply(0,b)}if(g(n.random(),t),r.exports){r.exports=p;try{h=LAe}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:iu,[],Math)})(PL);var zAe=PL.exports,$Ae=DAe,qAe=_Ae,WAe=FAe,VAe=RAe,UAe=OAe,GAe=PAe,su=zAe;su.alea=$Ae;su.xor128=qAe;su.xorwow=WAe;su.xorshift7=VAe;su.xor4096=UAe;su.tychei=GAe;var W1=su;var V1=function(){function r(e,t,n,a,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);var o=i||Math.random();this.random=W1.alea(o.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,a=!1;!a;){var i=void 0,o=void 0,s=void 0;do i=2*this.random()-1,o=2*this.random()-1,s=i*i+o*o;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*i*u,n=this.mean+this.stdDev*o*u,(!this.truncated||this.isValidTruncated(t))&&(a=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(t)},r.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},r.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},r}(),HAe=function(){function r(e,t,n,a){this.alpha=e,this.beta=1/t,this.dtype=n;var i=a||Math.random();this.randu=W1.alea(i.toString()),this.randn=new V1(0,1,n,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var e,t,n,a,i,o;;){do a=this.randn.nextValue(),o=1+this.c*a;while(o<=0);if(o*=o*o,e=a*a,t=1-.331*e*e,n=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<t||Math.log(i)<n)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},r.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},r}(),KAe=function(){function r(e,t,n,a){e===void 0&&(e=0),t===void 0&&(t=1);var i=this;if(this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=n,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(e," - ").concat(t," <= 1 and dtype is not float"));this.random=W1.alea(a)}return r.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r}();function jAe(r,e,t,n,a){if(t===void 0&&(t=1),n===void 0&&(n="float32"),ba(r),t==null&&(t=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error("Unsupported data type ".concat(n));for(var i=new HAe(e,t,n,a),o=Jo(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var XAe=K({randomGamma_:jAe});function YAe(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),ba(r),n!=null&&n==="bool")throw new Error("Unsupported data type ".concat(n));for(var i=new V1(e,t,n,!1,a),o=Jo(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var ML=K({randomNormal_:YAe});function ZAe(r,e,t){if(e!=null&&e==="bool")throw new Error("Unsupported data type ".concat(e));return ML(r,0,1,e,t)}var JAe=K({randomStandardNormal_:ZAe});function QAe(r,e,t,n,a){e===void 0&&(e=0),t===void 0&&(t=1),n===void 0&&(n="float32"),ba(r);for(var i=Jo(r,n),o=new KAe(e,t,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}var U1=K({randomUniform_:QAe});function eDe(r,e,t,n){return U1(r,e,t,"int32",n)}var tDe=K({randomUniformInt_:eDe});function Zf(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t===0)throw new Error("Cannot have a step of zero");var a={start:r,stop:e,step:t,dtype:n};return Q.runKernel(aNe,{},a)}function rDe(r){var e=M(r,"input","real"),t={input:e};return Q.runKernel(iNe,t)}var Jf=K({real_:rDe});function nDe(r){var e=M(r,"x","reciprocal"),t={x:e};return Q.runKernel(oNe,t)}var aDe=K({reciprocal_:nDe});function iDe(r){var e=M(r,"x","relu"),t={x:e};return Q.runKernel(sNe,t)}var Uv=K({relu_:iDe});function oDe(r){var e=M(r,"x","relu6"),t={x:e};return Q.runKernel(fNe,t)}var BL=K({relu6_:oDe});function sDe(r,e){var t=M(r,"x","reverse"),n={x:t},a={dims:e};return Q.runKernel(hNe,n,a)}var nu=K({reverse_:sDe});function uDe(r){var e=M(r,"x","reverse");return G(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(e.rank,".")}),nu(e,0)}var cDe=K({reverse1d_:uDe});function lDe(r,e){var t=M(r,"x","reverse");return G(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(t.rank,".")}),nu(t,e)}var fDe=K({reverse2d_:lDe});function hDe(r,e){var t=M(r,"x","reverse");return G(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(t.rank,".")}),nu(t,e)}var pDe=K({reverse3d_:hDe});function dDe(r,e){var t=M(r,"x","reverse");return G(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(t.rank,".")}),nu(t,e)}var vDe=K({reverse4d_:dDe});function mDe(r){var e=M(r,"x","round"),t={x:e};return Q.runKernel(pNe,t)}var LL=K({round_:mDe});function gDe(r){var e=M(r,"x","rsqrt","float32"),t={x:e};return Q.runKernel(dNe,t)}var yDe=K({rsqrt_:gDe});function bDe(r){var e=M(r,"x","selu"),t={x:e};return Q.runKernel(bNe,t)}var wDe=K({selu_:bDe});function xDe(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC");var s=M(r,"x","separableConv2d"),u=M(e,"depthwiseFilter","separableConv2d"),c=M(t,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(s.rank===3&&(f=!0,l=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");G(l.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(l.rank,".")}),G(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),G(c.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),G(c.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(c.shape[0],".")}),G(c.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(c.shape[1],".")});var h=u.shape[2],p=u.shape[3];G(c.shape[2]===h*p,function(){return"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(h*p,", ")+"but got ".concat(c.shape[2],".")});var d=B1(l,u,n,a,o,i),m=1,v=Lv(d,c,m,"valid",o);return f?ge(v,[v.shape[1],v.shape[2],v.shape[3]]):v}var kDe=K({separableConv2d_:xDe});function SDe(r,e){return Pt(this,void 0,void 0,function(){var t,n,a,i,o,s,l,u,c,l,f;return _t(this,function(h){switch(h.label){case 0:return t=M(r,"x","setdiff1d"),n=M(e,"y","setdiff1d"),G(t.dtype===n.dtype,function(){return"x and y should have the same dtype, but got x (".concat(t.dtype,") and y (").concat(n.dtype,").")}),G(t.rank===1,function(){return"x should be 1D tensor, but got x (".concat(t.shape,").")}),G(n.rank===1,function(){return"y should be 1D tensor, but got y (".concat(n.shape,").")}),[4,t.data()];case 1:return a=h.sent(),[4,n.data()];case 2:for(i=h.sent(),o=new Set(i),s=0,l=0;l<a.length;l++)o.has(a[l])||s++;for(u=new p1([s],t.dtype),c=new p1([s],"int32"),l=0,f=0;l<a.length;l++)o.has(a[l])||(u.values[f]=a[l],c.values[f]=l,f++);return[2,[u.toTensor(),c.toTensor()]]}})})}var NDe=SDe;function TDe(r){var e=M(r,"x","sign"),t={x:e};return Q.runKernel(SNe,t)}var EDe=K({sign_:TDe});function IDe(r){var e=M(r,"x","sin","float32"),t={x:e};return Q.runKernel(xNe,t)}var CDe=K({sin_:IDe});function ADe(r){var e=M(r,"x","sinh"),t={x:e};return Q.runKernel(kNe,t)}var DDe=K({sinh_:ADe});function _De(r,e,t){var n=M(r,"x","slice1d");return G(n.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(n.rank," tensor")}),fr(n,[e],[t])}var FDe=K({slice1d_:_De});function RDe(r,e,t){var n=M(r,"x","slice2d");return G(n.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(n.rank," tensor")}),fr(n,e,t)}var ODe=K({slice2d_:RDe});function PDe(r,e,t){var n=M(r,"x","slice3d");return G(n.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(n.rank," tensor")}),fr(n,e,t)}var MDe=K({slice3d_:PDe});function BDe(r,e,t){var n=M(r,"x","slice4d");return G(n.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(n.rank," tensor")}),fr(n,e,t)}var LDe=K({slice4d_:BDe});function zDe(r,e){e===void 0&&(e=-1);var t=M(r,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and dim was ").concat(e));var n={logits:t},a={dim:e};return Q.runKernel(DNe,n,a)}var $De=K({softmax_:zDe});function qDe(r){G(r.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(r.dtype,".")});var e={input:r};return Q.runKernel(oSe,e)}var G1=K({fft_:qDe});function WDe(r){G(r.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(r.dtype,".")});var e={input:r};return Q.runKernel(mSe,e)}var Rv=K({ifft_:WDe});function VDe(r){var e=r.shape[r.shape.length-1],t=r.size/e,n;if(e<=2){var a=ge(r,[t,e]);n=Rv(a)}else{var i=[t,2*(e-1)],o=ge(Jf(r),[t,e]),s=ge(Vv(r),[t,e]),u=nu(fr(o,[0,1],[t,e-2]),1),c=gt(nu(fr(s,[0,1],[t,e-2]),1),_r(-1)),l=aa([o,u],1),f=aa([s,c],1),a=ge(tu(l,f),[i[0],i[1]]);n=Rv(a)}if(n=Jf(n),r.rank===3&&r.shape[0]!==0){var h=n,p=r.shape[0];n=ge(n,[p,n.shape[0]/p,n.shape[1]]),h.dispose()}return n}var zL=K({irfft_:VDe});function UDe(r,e,t){t===void 0&&(t=0);var n=M(r,"x","split"),a={x:n},i={numOrSizeSplits:e,axis:t};return Q.runKernel(ANe,a,i)}var Qf=K({split_:UDe});function GDe(r,e){G(r.dtype==="float32",function(){return"The dtype for rfft() must be real value but got ".concat(r.dtype)});var t=r.shape[r.shape.length-1],n=r.size/t,a;if(e!=null&&e<t){var i=r.shape.map(function(g){return 0}),o=r.shape.map(function(g){return g});o[r.shape.length-1]=e,a=fr(r,i,o),t=e}else if(e!=null&&e>t){var s=r.shape.map(function(g){return g});s[r.shape.length-1]=e-t,a=aa([r,Ac(s)],r.shape.length-1),t=e}else a=r;var u=L1(a),c=ge(tu(a,u),[n,t]),l=G1(c),f=Math.floor(t/2)+1,h=Jf(l),p=Vv(l),d=Qf(h,[f,t-f],h.shape.length-1),m=Qf(p,[f,t-f],p.shape.length-1),v=a.shape.slice();return v[a.shape.length-1]=f,ge(tu(d[0],m[0]),v)}var H1=K({rfft_:GDe});function HDe(r,e){var t,n=M(r,"a","squaredDifference"),a=M(e,"b","squaredDifference");t=we(Er(n,a),2),n=t[0],a=t[1],Zr(n.shape,a.shape);var i={a:n,b:a},o={};return Q.runKernel(MNe,i,o)}var $L=K({squaredDifference_:HDe});function KDe(r,e){var t=M(r,"x","squeeze","string_or_numeric");return ge(t,Zke(t.shape,e).newShape)}var K1=K({squeeze_:KDe});function jDe(r,e){e===void 0&&(e=0);var t=Iv(r,"tensors","stack","string_or_numeric");G(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&G(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var n=t,a={axis:e};return Q.runKernel(YSe,n,a)}var eh=K({stack_:jDe});function XDe(r,e){e===void 0&&(e=0);var t=M(r,"x","step"),n={x:t},a={alpha:e};return Q.runKernel(ZNe,n,a)}var qL=K({step_:XDe});function YDe(r,e,t,n,a,i,o,s,u){a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),u===void 0&&(u=0);var c=M(r,"x","stridedSlice","string_or_numeric"),l={x:c},f={begin:e,end:t,strides:n,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return Q.runKernel(LNe,l,f)}var ZDe=K({stridedSlice_:YDe});function JDe(r){var e=M(r,"x","tan","float32"),t={x:e};return Q.runKernel(VNe,t)}var QDe=K({tan_:JDe});function j1(r,e,t){var n=Qo(r,t);return ts(r,e,n,t)}function wi(r,e){Dc(r);var t=Qo(r,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");var n=null;return ts(r,n,t,e)}function Hf(r,e,t){if(Dc(r),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var n=Qo(r,t);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return ts(r,e,n,t)}function e_e(r,e,t){if(Dc(r),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var n=Qo(r,t);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return ts(r,e,n,t)}function t_e(r,e,t){if(Dc(r),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var n=Qo(r,t);if(n.length!==4&&n.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return ts(r,e,n,t)}function r_e(r,e,t){if(Dc(r),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var n=Qo(r,t);if(n.length!==5&&n.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return ts(r,e,n,t)}function n_e(r,e,t){if(Dc(r),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var n=Qo(r,t);if(n.length!==6&&n.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||n,ts(r,e,n,t)}function a_e(r,e,t){var n=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(t.shape)+", indices.shape: ".concat(e.shape,", shape: ").concat(r)+", sliceDim: ".concat(n,", and batchDim: ").concat(a,".");if(t.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(r.length<n+(t.rank-a))throw new Error(i+" Output shape length < ".concat(n+(t.rank-a)));if(t.rank!==a+r.length-n)throw new Error(i+" update.rank != ".concat(a+r.length-n));for(var o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(t.shape[o],") != indices.shape[").concat(o,"] (").concat(e.shape[o],")."));for(var o=0;o<t.rank-a;++o)if(t.shape[o+a]!==r[o+n])throw new Error(i+" updates.shape[".concat(o+a,"] (").concat(t.shape[o+a],") != shape[").concat(o+a,"] (").concat(r[o+a],")"))}function WL(r,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(r.rank,"."));if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(e.dtype));if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(t));if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: ".concat(e.shape));if(r.size===0)throw new Error("Updates specified for empty output. updates shape: ".concat(r.shape))}a_e(t,e,r)}function i_e(r,e,t){var n=M(r,"tensor","tensorScatterupdate"),a=M(e,"indices","tensorScatterupdate","int32"),i=M(t,"updates","tensorScatterupdate");if(WL(i,a,n.shape),n.dtype!==i.dtype)throw new Error("tensor and updates must have the same dtype, instead they are ".concat(n.dtype," and ").concat(i.dtype,"."));var o={tensor:n,indices:a,updates:i},s={};return Q.runKernel(mNe,o,s)}var o_e=K({tensorScatterUpdate_:i_e});function s_e(r,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var n=M(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=n.shape[n.shape.length-1];if(e<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(e));if(e>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") ")+"but got ".concat(e));var i={x:n},o={k:e,sorted:t},s=we(Q.runKernel(GNe,i,o),2),u=s[0],c=s[1];return{values:u,indices:c}}var u_e=K({topk_:s_e});function c_e(r,e,t,n,a){if(e===void 0&&(e=0),t===void 0&&(t=1),ba(r),n!=null&&n==="bool")throw new Error("Unsupported data type $ { dtype }");for(var i=new V1(e,t,n,!0,a),o=Jo(r,n),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var l_e=K({truncatedNormal_:c_e});function f_e(r,e){e===void 0&&(e=0);var t=M(r,"x","unique","string_or_numeric");G(t.rank>0,function(){return"The input tensor must be at least 1D"});var n={x:t},a={axis:e},i=we(Q.runKernel(KNe,n,a),2),o=i[0],s=i[1];return{values:o,indices:s}}var h_e=K({unique_:f_e});function p_e(r,e,t){var n=M(r,"x","unsortedSegmentSum"),a=M(e,"segmentIds","unsortedSegmentSum","int32");G(Kf(t),function(){return"numSegments must be of dtype int"});var i={x:n,segmentIds:a},o={numSegments:t};return Q.runKernel(XNe,i,o)}var d_e=K({unsortedSegmentSum_:p_e});function v_e(r,e){e===void 0&&(e=0);var t=M(r,"x","unstack","string_or_numeric");G(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = ".concat(e," is not in [-").concat(t.shape.length,", ").concat(t.shape.length,")")});var n={value:t},a={axis:e};return Q.runKernel(jNe,n,a)}var X1=K({unstack_:v_e});function m_e(r,e){return q1(r,e,"right")}function g_e(r,e,t,n){return e===void 0&&(e=!0),Q.makeVariable(r,e,t,n)}function y_e(r,e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(n);for(var a=Jo(r,"int32"),i=Jo([t.length,r.length],"int32"),n=0;n<t.length;n++){var o=a.indexToLoc(t[n]),s=n*r.length;i.values.set(o,s)}return i.toTensor()}function b_e(r){return Pt(this,void 0,void 0,function(){var e,t,n;return _t(this,function(a){switch(a.label){case 0:return e=M(r,"condition","whereAsync","bool"),[4,e.data()];case 1:return t=a.sent(),n=y_e(e.shape,t),r!==e&&e.dispose(),[2,n]}})})}var VL=b_e;function w_e(r,e,t){return Pt(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p,d,m;return _t(this,function(v){switch(v.label){case 0:for(n=M(r,"tensor","boolMask"),a=M(e,"mask","boolMask","bool"),i=t??0,o=a.rank,s=n.shape,G(o>0,function(){return"mask cannot be scalar"}),Xa(s.slice(i,i+o),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+o;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+o)),f=ge(n,l),h=ge(a,[-1]),[4,VL(h)];case 1:return p=v.sent(),d=K1(p,[1]),m=gL(f,d,i),r!==n&&n.dispose(),e!==a&&a.dispose(),d.dispose(),f.dispose(),h.dispose(),p.dispose(),[2,m]}})})}var x_e=w_e;function k_e(r,e){return Q.tidy(r,e)}function S_e(r){var e=nL(r);e.forEach(function(t){return t.dispose()})}function N_e(r,e,t){var n=M(r,"x","transpose");if(e==null&&(e=n.shape.map(function(o,s){return s}).reverse()),G(n.rank===e.length,function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of perm ".concat(e,".")}),e.forEach(function(o){G(o>=0&&o<n.rank,function(){return"All entries in 'perm' must be between 0 and ".concat(n.rank-1)+" but got ".concat(e)})}),n.rank<=1)return n.clone();var a={x:n},i={perm:e};return n.dtype==="complex64"?k_e(function(){var o=Jf(n),s=Vv(n);return o=Q.runKernel(Yw,{x:o},i),s=Q.runKernel(Yw,{x:s},i),t&&(s=Li(s)),tu(o,s)}):Q.runKernel(Yw,a,i)}var N1=K({transpose_:N_e});function T_e(r,e,t,n,a){a===void 0&&(a=!0);var i=M(r,"v","movingAverage"),o=M(e,"x","movingAverage"),s=M(t,"decay","movingAverage");wTe(i,o),G(au(i.shape,o.shape),function(){return"Shape mismatch in v and x"});var u=_r(1),c=Ct(u,s),l=gt(Ct(o,i),c);if(a){G(n!=null,function(){return"When using zeroDebias: true, step is required."});var f=M(n,"step","movingAverage");l=wn(l,Ct(u,z1(s,f)))}return Yr(i,l)}var E_e=K({movingAverage_:T_e});function I_e(r,e,t){ba(t);var n=M(r,"indices","scatterND","int32"),a=M(e,"updates","scatterND");WL(a,n,t);var i={indices:n,updates:a},o={shape:t};return Q.runKernel(vNe,i,o)}var C_e=K({scatterND_:I_e});function A_e(r,e,t,n){if(r.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+" but the dtype was ".concat(r.dtype,"."));if(r.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+" but got shape ".concat(r.shape,"."));var a=r.rank>0?r.shape[0]:1,i=r.rank>1?r.shape[1]:1;if(t.length!==i)throw new Error("outputShape has incorrect number of elements:,"+" ".concat(t.length,", should be: ").concat(i,"."));var o=e.size;if(!(e.rank===0||e.rank===1&&o===a))throw new Error("sparseValues has incorrect shape "+"".concat(e.shape,", should be [] or [").concat(a,"]"));if(e.dtype!==n.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function D_e(r,e,t,n){n===void 0&&(n=0),ba(t);var a=M(r,"sparseIndices","sparseToDense","int32"),i=M(e,"sparseValues","sparseToDense","string_or_numeric"),o=M(n,"defaultValue","sparseToDense",i.dtype);A_e(a,i,t,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:t};return Q.runKernel(PNe,s,u)}var __e=K({sparseToDense_:D_e});function F_e(r,e){var t=M(e,"indices","gatherND","int32"),n=M(r,"x","gatherND","string_or_numeric"),a={params:n,indices:t};return Q.runKernel(pSe,a)}var R_e=K({gatherND_:F_e});function O_e(r,e){if(e==null)return r.shape.slice();if(au(r.shape,e))return e;if(r.shape.length===e.length){for(var t=[],n=0;n<r.shape.length;n++)e[n]==null&&r.shape[n]!=null?t.push(r.shape[n]):t.push(e[n]);return t}return e}function P_e(r,e,t,n){var a=M(r,"x","dropout");if(G(a.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(a.dtype," tensor instead.")}),G(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got ".concat(e,".")}),e===0)return r instanceof On?a.clone():a;var i=O_e(a,t),o=1-e,s=wn(mL(Yr(U1(i,0,1,"float32",n),o)),o);return gt(a,s)}var M_e=K({dropout_:P_e});function UL(r){return Math.floor(Math.pow(2,Math.ceil(Math.log(r)/Math.log(2))))}function Y1(r,e,t){for(var n=1-r%2,a=new Float32Array(r),i=0;i<r;++i){var o=2*Math.PI*i/(r+n-1);a[i]=e-t*Math.cos(o)}return wi(a,"float32")}function B_e(r,e,t){return t===void 0&&(t=1),Pt(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p,d,m,v,v;return _t(this,function(g){switch(g.label){case 0:return n=M(r,"predictions","inTopK"),a=M(e,"targets","inTopK"),G(n.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, "+"but got ".concat(n.rank)}),G(n.rank-1===a.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+"".concat(n.rank," and targets rank ").concat(a.rank)}),Xa(n.shape.slice(0,n.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=n.shape[n.shape.length-1],G(t>0&&t<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last "+"dimension (".concat(i,"), but got ").concat(t)}),[4,n.data()];case 1:return o=g.sent(),[4,a.data()];case 2:for(s=g.sent(),u=we([o.length/i,i],2),c=u[0],l=u[1],f=Jke("bool",c),h=0;h<c;h++){for(p=h*l,d=o.subarray(p,p+l),m=[],v=0;v<d.length;v++)m.push({value:d[v],index:v});for(m.sort(function(y,w){return w.value-y.value}),f[h]=0,v=0;v<t;v++)if(m[v].index===s[h]){f[h]=1;break}}return r!==n&&n.dispose(),e!==a&&a.dispose(),[2,j1(f,a.shape,"bool")]}})})}var L_e=B_e;function z_e(r,e,t,n,a,i,o){i===void 0&&(i="NHWC");var s=r;r.rank===3&&(s=ge(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]])),G(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")}),G(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")}),G(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(t,".")});var c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];G(c===t[2],function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(t[2],".")}),G(l===t[3],function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(t[3],").")}),Si("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return Q.runKernel(M2e,f,h)}var $_e=K({conv2DBackpropFilter_:z_e});function Z1(r,e,t){if(t==null||t==="linear")return r;if(t==="relu")return gt(r,qL(e));throw new Error("Cannot compute gradient for fused activation ".concat(t,"."))}function J1(r,e){var t=e,n=wIe(r.shape,e.shape);return n.length>0&&(t=er(t,n)),ge(t,r.shape)}function Q1(r,e,t,n){if(e==="linear")return r;if(e==="relu")return Uv(r);if(e==="elu")return pL(r);if(e==="relu6")return BL(r);if(e==="prelu")return CL(r,t);if(e==="leakyrelu")return bL(r,n);if(e==="sigmoid")return Tc(r);throw new Error("Unknown fused activation ".concat(e,"."))}var ex=function(r,e){var t=r>0;return!t||e==="linear"};function q_e(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,c=u===void 0?[1,1]:u,l=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,m=r.leakyreluAlpha;if(p=p||"linear",ex(Q.state.gradientDepth,p)===!1){G(s==="NHWC",function(){return"Error in fused conv2d: got dataFormat of ".concat(s," but ")+"only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."});var v=Lv(t,n,a,i,s,c,l);return f!=null&&(v=Yr(v,f)),Q1(v,p,d,m)}var g=M(t,"x","conv2d","float32"),y=M(n,"filter","conv2d","float32"),w=g,b=!1;g.rank===3&&(b=!0,w=ge(g,[1,g.shape[0],g.shape[1],g.shape[2]])),G(w.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(w.rank,".")}),G(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(y.rank,".")}),Si("fused conv2d",i,l);var x=s==="NHWC"?w.shape[3]:w.shape[1];G(y.shape[2]===x,function(){return"Error in conv2d: depth of input (".concat(x,") must match ")+"input depth for filter ".concat(y.shape[2],".")}),G(es(a,c),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(a," and dilations '").concat(c,"'")});var S=M1(w.shape,y.shape,a,c,i,l),T;f!=null&&(T=M(f,"bias","fused conv2d"),e=we(Er(T,g),1),T=e[0],s==="NHWC"?Zr(S.outShape,T.shape):(G(T.shape.length<=1,function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+"rank-".concat(T.shape.length,".")}),G(T.shape.length===0||T.shape[0]===S.outChannels||T.shape[0]===1,function(){return"Error in fused conv2d: bias shape (".concat(T.shape,") is not ")+"compatible with the number of output channels "+"(".concat(S.outChannels,")")})));var E;if(d!=null){var C=d.shape;if(G(C.length<=1||C.length===3,function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+"rank-".concat(C.length,".")}),C.length===1)G(C[0]===1||C[0]===S.outChannels,function(){return"Error in fused conv2d: PReLU activation weights "+"(".concat(C,") is not compatible with the number of output ")+"channels (".concat(S.outChannels,").")});else if(C.length===3)try{Zr(C,S.outShape)}catch{var R="Error in fused conv2d: PReLU activation weights (".concat(C,") ")+"is not compatible with the output shape of the conv2d "+"(".concat(S.outShape,").");throw Error(R)}E=M(d,"prelu weights","fused conv2d")}var _=function(B,W){G(s==="NHWC",function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(s," but only NHWC is currently supported.")});var X=we(W,4),J=X[0],V=X[1],j=X[2],ne=X[3],re=Z1(B,j,p);G(Av(c),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(c,"'")});var oe=lL(V.shape,re,J,a,i),le=$_e(V,re,J.shape,a,i),de=[oe,le];if(ne!=null){var ke=J1(ne,re);de.push(ke)}return de},O={x:w,filter:y,bias:T,preluActivationWeights:E},$={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:p,leakyreluAlpha:m};if(f==null){var z=co(function(B,W,X){var J=Q.runKernel(lB,O,$);return X([W,B,J]),b&&(J=ge(J,[J.shape[1],J.shape[2],J.shape[3]])),{value:J,gradFunc:_}});return z(w,y)}else{var L=co(function(B,W,X,J){var V=Q.runKernel(lB,O,$);return J([W,B,V,X]),b&&(V=ge(V,[V.shape[1],V.shape[2],V.shape[3]])),{value:V,gradFunc:_}});return L(w,y,T)}}var W_e=K({fusedConv2d_:q_e});function V_e(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=r;r.rank===3&&(s=ge(r,[1,r.shape[0],r.shape[1],r.shape[2]]));var u=e;u.rank===3&&(u=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={x:s,dy:u},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return Q.runKernel(j2e,c,l)}var U_e=K({depthwiseConv2dNativeBackpropFilter_:V_e});function G_e(r,e,t,n,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={dy:s,filter:t},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,inputShape:r},f=Q.runKernel(X2e,c,l);return u?ge(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var H_e=K({depthwiseConv2dNativeBackpropInput_:G_e});function K_e(r){var e,t=r.x,n=r.filter,a=r.strides,i=r.pad,o=r.dataFormat,s=o===void 0?"NHWC":o,u=r.dilations,c=u===void 0?[1,1]:u,l=r.dimRoundingMode,f=r.bias,h=r.activation,p=h===void 0?"linear":h,d=r.preluActivationWeights,m=r.leakyreluAlpha;if(ex(Q.state.gradientDepth,p)===!1){var v=B1(t,n,a,i,s,c,l);return f!=null&&(v=Yr(v,f)),Q1(v,p,d,m)}var g=M(t,"x","depthwiseConv2d","float32"),y=M(n,"filter","depthwiseConv2d","float32"),w=g,b=!1;g.rank===3&&(b=!0,w=ge(g,[1,g.shape[0],g.shape[1],g.shape[2]])),G(w.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(w.rank,".")}),G(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+"but got rank ".concat(y.rank,".")}),G(w.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels "+"(".concat(w.shape[3],") must match the inChannels dimension in ")+"filter ".concat(y.shape[2],".")}),c==null&&(c=[1,1]),G(es(a,c),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+"be 1. Got strides ".concat(a," and dilations '").concat(c,"'")}),Si("fused depthwiseConv2d",i,l);var x=M1(w.shape,y.shape,a,c,i,l,!0),S;f!=null&&(S=M(f,"bias","fused conv2d"),e=we(Er(S,g),1),S=e[0],Zr(x.outShape,S.shape));var T;d!=null&&(T=M(d,"prelu weights","fused depthwiseConv2d"));var E=function($,z){G(Av(c),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(c,"'")});var L=we(z,4),B=L[0],W=L[1],X=L[2],J=L[3],V=Z1($,X,p),j=H_e(W.shape,V,B,a,i,c,l),ne=U_e(W,V,B.shape,a,i,c,l);if(J!=null){var re=J1(S,V);return[j,ne,re]}return[j,ne]},C={x:w,filter:y,bias:S,preluActivationWeights:T},R={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:p,leakyreluAlpha:m};if(f==null){var _=co(function($,z,L){var B=Q.runKernel(fB,C,R);return L([z,$,B]),b&&(B=ge(B,[B.shape[1],B.shape[2],B.shape[3]])),{value:B,gradFunc:E}});return _(w,y)}else{var O=co(function($,z,L,B){var W=Q.runKernel(fB,C,R);return B([z,$,W,L]),b&&(W=ge(W,[W.shape[1],W.shape[2],W.shape[3]])),{value:W,gradFunc:E}});return O(w,y,S)}}var j_e=K({fusedDepthwiseConv2d_:K_e});function X_e(r){var e,t,n=r.a,a=r.b,i=r.transposeA,o=i===void 0?!1:i,s=r.transposeB,u=s===void 0?!1:s,c=r.bias,l=r.activation,f=l===void 0?"linear":l,h=r.preluActivationWeights,p=r.leakyreluAlpha,d=p===void 0?.2:p;if(ex(Q.state.gradientDepth,f)===!1){var m=Bt(n,a,o,u);return c!=null&&(m=Yr(m,c)),Q1(m,f,h,d)}var v=M(n,"a","fused matMul"),g=M(a,"b","fused matMul");e=we(Er(v,g),2),v=e[0],g=e[1];var y=o?v.shape[v.rank-2]:v.shape[v.rank-1],w=u?g.shape[g.rank-1]:g.shape[g.rank-2],b=o?v.shape[v.rank-1]:v.shape[v.rank-2],x=u?g.shape[g.rank-2]:g.shape[g.rank-1],S=v.shape.slice(0,-2),T=g.shape.slice(0,-2),E=Mn(S),C=Mn(T);G(y===w,function(){return"Error in fused matMul: inner shapes (".concat(y,") and (")+"".concat(w,") of Tensors with shapes ").concat(v.shape," and ")+"".concat(g.shape," and transposeA=").concat(o)+" and transposeB=".concat(u," must match.")});var R=Zr(v.shape.slice(0,-2),g.shape.slice(0,-2)),_=R.concat([b,x]),O=o?ge(v,[E,y,b]):ge(v,[E,b,y]),$=u?ge(g,[C,x,w]):ge(g,[C,w,x]),z;c!=null&&(z=M(c,"bias","fused matMul"),t=we(Er(z,v),1),z=t[0],Zr(_,z.shape));var L;h!=null&&(L=M(h,"prelu weights","fused matMul"));var B=function(j,ne){var re=we(ne,4),oe=re[0],le=re[1],de=re[2],ke=re[3],he=Z1(ge(j,de.shape),de,f),ye,xe;if(!o&&!u?(ye=Bt(he,le,!1,!0),xe=Bt(oe,he,!0,!1)):!o&&u?(ye=Bt(he,le,!1,!1),xe=Bt(he,oe,!0,!1)):o&&!u?(ye=Bt(le,he,!1,!0),xe=Bt(oe,he,!1,!1)):(ye=Bt(le,he,!0,!0),xe=Bt(he,oe,!0,!0)),c!=null){var De=J1(ke,he);return[ye,xe,De]}else return[ye,xe]},W={a:O,b:$,bias:z,preluActivationWeights:L},X={transposeA:o,transposeB:u,activation:f,leakyreluAlpha:d};if(c==null){var J=co(function(j,ne,re){var oe=Q.runKernel(cB,W,X);return re([j,ne,oe]),{value:ge(oe,_),gradFunc:B}});return J(O,$)}else{var V=co(function(j,ne,re,oe){var le=Q.runKernel(cB,W,X);return oe([j,ne,le,re]),{value:ge(le,_),gradFunc:B}});return V(O,$,z)}}var Y_e=K({fusedMatMul_:X_e});var Z_e={__proto__:null,conv2d:W_e,depthwiseConv2d:j_e,matMul:Y_e};function J_e(r){return Y1(r,.54,.46)}var Q_e=K({hammingWindow_:J_e});function e3e(r){return Y1(r,.5,.5)}var GL=K({hannWindow_:e3e});function t3e(r,e,t,n,a){n===void 0&&(n=!1),a===void 0&&(a=0);for(var i=0,o=[];i+e<=r.size;)o.push(fr(r,i,e)),i+=t;if(n)for(;i<r.size;){var s=i+e-r.size,u=aa([fr(r,i,e-s),Bv([s],a)]);o.push(u),i+=t}return o.length===0?Hf([],[0,e]):ge(aa(o),[o.length,e])}var HL=K({frame_:t3e});function r3e(r,e,t,n,a){a===void 0&&(a=GL),n==null&&(n=UL(e));var i=HL(r,e,t),o=gt(i,a(e));return H1(o,n)}var n3e=K({stft_:r3e});function a3e(r,e,t,n,a,i){a===void 0&&(a="bilinear"),i===void 0&&(i=0);var o=M(r,"image","cropAndResize"),s=M(e,"boxes","cropAndResize","float32"),u=M(t,"boxInd","cropAndResize","int32"),c=s.shape[0];G(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),G(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] ")+"but had shape ".concat(s.shape,".")}),G(u.rank===1&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] ")+"but had shape ".concat(s.shape,".")}),G(n.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(n.length,".")}),G(n[0]>=1&&n[1]>=1,function(){return"cropSize must be atleast [1,1], but was ".concat(n)}),G(a==="bilinear"||a==="nearest",function(){return"method must be bilinear or nearest, but was ".concat(a)});var l={image:o,boxes:s,boxInd:u},f={method:a,extrapolationValue:i,cropSize:n},h=Q.runKernel(U2e,l,f);return h}var i3e=K({cropAndResize_:a3e});function o3e(r){var e=M(r,"image","flipLeftRight","float32");G(e.rank===4,function(){return"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(e.rank,".")});var t={image:e},n=Q.runKernel(uSe,t,{});return n}var s3e=K({flipLeftRight_:o3e});function u3e(r){var e=M(r,"image","grayscaleToRGB"),t=e.rank-1,n=e.shape[t];G(e.rank>=2,function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(e.rank,".")}),G(n===1,function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(n,".")});var a=new Array(e.rank);return a.fill(1,0,t),a[t]=3,Gf(e,a)}var c3e=K({grayscaleToRGB_:u3e});function l3e(r,e,t,n){t===void 0&&(t=0),n===void 0&&(n=.5);var a=M(r,"image","rotateWithOffset","float32");G(a.rank===4,function(){return"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,".")});var i={image:a},o={radians:e,fillValue:t,center:n},s=Q.runKernel(JNe,i,o);return s}var f3e=K({rotateWithOffset_:l3e});function _c(r,e,t,n,a,i){n==null&&(n=.5),a==null&&(a=Number.NEGATIVE_INFINITY),i==null&&(i=0);var o=r.shape[0];return t=Math.min(t,o),G(0<=n&&n<=1,function(){return"iouThreshold must be in [0, 1], but was '".concat(n,"'")}),G(r.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '".concat(r.rank,"'")}),G(r.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(r.shape[1])}),G(e.rank===1,function(){return"scores must be a 1D tensor"}),G(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(e.shape[0])}),G(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")}),{maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i}}function h3e(r,e,t,n,a){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var i=M(r,"boxes","nonMaxSuppression","float32"),o=M(e,"scores","nonMaxSuppression","float32"),s=_c(i,o,t,n,a);t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:n,scoreThreshold:a};return Q.runKernel(GSe,{boxes:i,scores:o},u)}var p3e=K({nonMaxSuppression_:h3e});function d3e(r,e,t){var n=v3e(r,e,t),a=n<0?-(n+1):n;r.splice(a,0,e)}function v3e(r,e,t){return g3e(r,e,t||m3e)}function m3e(r,e){return r>e?1:r<e?-1:0}function g3e(r,e,t){for(var n=0,a=r.length,i=0,o=!1;n<a;){i=n+(a-n>>>1);var s=t(e,r[i]);s>0?n=i+1:(a=i,o=!s)}return o?n:-n-1}function y3e(r,e,t,n,a){return tx(r,e,t,n,a,0)}function b3e(r,e,t,n,a,i){return tx(r,e,t,n,a,0,!1,i,!0)}function w3e(r,e,t,n,a,i){return tx(r,e,t,n,a,i,!0)}function tx(r,e,t,n,a,i,o,s,u){o===void 0&&(o=!1),s===void 0&&(s=!1),u===void 0&&(u=!1);for(var c=[],l=0;l<e.length;l++)e[l]>a&&c.push({score:e[l],boxIndex:l,suppressBeginIndex:0});c.sort(TB);for(var f=i>0?-.5/i:0,h=[],p=[];h.length<t&&c.length>0;){var d=c.pop(),m=d.score,v=d.boxIndex,g=d.suppressBeginIndex;if(m<a)break;for(var y=!1,w=h.length-1;w>=g;--w){var b=x3e(r,v,h[w]);if(b>=n){y=!0;break}if(d.score=d.score*k3e(n,f,b),d.score<=a)break}d.suppressBeginIndex=h.length,y||(d.score===m?(h.push(v),p.push(d.score)):d.score>a&&d3e(c,d,TB))}var x=h.length,S=t-x;s&&S>0&&(h.push.apply(h,Dt([],we(new Array(S).fill(0)),!1)),p.push.apply(p,Dt([],we(new Array(S).fill(0)),!1)));var T={selectedIndices:h};return o&&(T.selectedScores=p),u&&(T.validOutputs=x),T}function x3e(r,e,t){var n=r.subarray(e*4,e*4+4),a=r.subarray(t*4,t*4+4),i=Math.min(n[0],n[2]),o=Math.min(n[1],n[3]),s=Math.max(n[0],n[2]),u=Math.max(n[1],n[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),f=Math.max(a[0],a[2]),h=Math.max(a[1],a[3]),p=(s-i)*(u-o),d=(f-c)*(h-l);if(p<=0||d<=0)return 0;var m=Math.max(i,c),v=Math.max(o,l),g=Math.min(s,f),y=Math.min(u,h),w=Math.max(g-m,0)*Math.max(y-v,0);return w/(p+d-w)}function k3e(r,e,t){var n=Math.exp(e*t*t);return t<=r?n:0}function TB(r,e){return r.score-e.score||r.score===e.score&&e.boxIndex-r.boxIndex}function S3e(r,e,t,n,a){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),Pt(this,void 0,void 0,function(){var i,o,s,u,c,l,f;return _t(this,function(h){switch(h.label){case 0:return i=M(r,"boxes","nonMaxSuppressionAsync"),o=M(e,"scores","nonMaxSuppressionAsync"),s=_c(i,o,t,n,a),t=s.maxOutputSize,n=s.iouThreshold,a=s.scoreThreshold,[4,Promise.all([i.data(),o.data()])];case 1:return u=h.sent(),c=u[0],l=u[1],f=y3e(c,l,t,n,a).selectedIndices,i!==r&&i.dispose(),o!==e&&o.dispose(),[2,wi(f,"int32")]}})})}var N3e=S3e;function T3e(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var o=M(r,"boxes","nonMaxSuppression"),s=M(e,"scores","nonMaxSuppression"),u=_c(o,s,t,n,a,i);t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma;var c={boxes:o,scores:s},l={maxOutputSize:t,iouThreshold:n,scoreThreshold:a,softNmsSigma:i},f=Q.runKernel(KSe,c,l);return{selectedIndices:f[0],selectedScores:f[1]}}var E3e=K({nonMaxSuppressionWithScore_:T3e});function I3e(r,e,t,n,a,i){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),Pt(this,void 0,void 0,function(){var o,s,u,c,l,f,h,p,d;return _t(this,function(m){switch(m.label){case 0:return o=M(r,"boxes","nonMaxSuppressionAsync"),s=M(e,"scores","nonMaxSuppressionAsync"),u=_c(o,s,t,n,a,i),t=u.maxOutputSize,n=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return c=m.sent(),l=c[0],f=c[1],h=w3e(l,f,t,n,a,i),p=h.selectedIndices,d=h.selectedScores,o!==r&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:wi(p,"int32"),selectedScores:wi(d)}]}})})}var C3e=I3e;function A3e(r,e,t,n,a,i){n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1);var o=M(r,"boxes","nonMaxSuppression"),s=M(e,"scores","nonMaxSuppression"),u=_c(o,s,t,n,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,h={boxes:o,scores:s},p={maxOutputSize:c,iouThreshold:l,scoreThreshold:f,padToMaxOutputSize:i},d=Q.runKernel(HSe,h,p);return{selectedIndices:d[0],validOutputs:d[1]}}var D3e=K({nonMaxSuppressionPadded_:A3e});function _3e(r,e,t,n,a,i){return n===void 0&&(n=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1),Pt(this,void 0,void 0,function(){var o,s,u,c,l,f,h,p,d,m,v,g;return _t(this,function(y){switch(y.label){case 0:return o=M(r,"boxes","nonMaxSuppressionAsync"),s=M(e,"scores","nonMaxSuppressionAsync"),u=_c(o,s,t,n,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,[4,Promise.all([o.data(),s.data()])];case 1:return h=we.apply(void 0,[y.sent(),2]),p=h[0],d=h[1],m=b3e(p,d,c,l,f,i),v=m.selectedIndices,g=m.validOutputs,o!==r&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:wi(v,"int32"),validOutputs:_r(g,"int32")}]}})})}var F3e=_3e;function R3e(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=M(r,"images","resizeBilinear");G(a.rank===3||a.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),G(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(e,".")}),G(n===!1||t===!1,function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=ge(a,[1,a.shape[0],a.shape[1],a.shape[2]])),we(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},c=Q.runKernel(lNe,s,u);return o?ge(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var O3e=K({resizeBilinear_:R3e});function P3e(r,e,t,n){t===void 0&&(t=!1),n===void 0&&(n=!1);var a=M(r,"images","resizeNearestNeighbor");G(a.rank===3||a.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),G(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(e,".")}),G(a.dtype==="float32"||a.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"}),G(n===!1||t===!1,function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=ge(a,[1,a.shape[0],a.shape[1],a.shape[2]])),we(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},c=Q.runKernel(cNe,s,u);return o?ge(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var M3e=K({resizeNearestNeighbor_:P3e});function B3e(r,e,t,n){var a;e===void 0&&(e="binary"),t===void 0&&(t=!1),n===void 0&&(n=.5);var i=M(r,"image","threshold"),o=.2989,s=.587,u=.114,c=i.shape[0]*i.shape[1],l=gt(wi([n]),255),f,h,p,d;if(G(i.rank===3,function(){return"Error in threshold: image must be rank 3,"+"but got rank ".concat(i.rank,".")}),G(i.shape[2]===3||i.shape[2]===1,function(){return"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(i.shape[2],".")}),G(i.dtype==="int32"||i.dtype==="float32",function(){return"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(i.dtype,".")}),G(e==="otsu"||e==="binary",function(){return"Method must be binary or otsu, but was ".concat(e)}),i.shape[2]===3){a=we(Qf(i,[1,1,1],-1),3),f=a[0],h=a[1],p=a[2];var m=gt(f,o),v=gt(h,s),g=gt(p,u);d=Yr(Yr(m,v),g)}else d=r;if(e==="otsu"){var y=cL(an(LL(d),"int32"),j1([]),256);l=L3e(y,c)}var w=t?$1(d,l):Wv(d,l),b=an(gt(w,255),"int32");return b}function L3e(r,e){for(var t=wi([-1]),n=wi([0]),a=wi([0]),i,o,s,u,c,l,f=0;f<r.size-1;f++){i=fr(r,0,f+1),o=fr(r,f+1),c=wn(er(i),e),l=wn(er(o),e);var h=er(gt(i,Zf(0,i.size)));s=wn(h,er(i));var p=Bv(o.shape,i.size),d=Yr(Zf(0,o.size),p),m=gt(o,d);u=wn(er(m),er(o));var v=Ct(s,u),g=Ct(s,u),y=gt(c,l);a=gt(gt(y,v),g);var w=Wv(a,n);n=Zo(w,a,n),t=Zo(w,wi([f]),t)}return t}var z3e=K({threshold_:B3e});function $3e(r,e,t,n,a,i){t===void 0&&(t="nearest"),n===void 0&&(n="constant"),a===void 0&&(a=0);var o=M(r,"image","transform","float32"),s=M(e,"transforms","transform","float32");G(o.rank===4,function(){return"Error in transform: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),G(s.rank===2&&(s.shape[0]===o.shape[0]||s.shape[0]===1)&&s.shape[1]===8,function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"}),G(i==null||i.length===2,function(){return"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(i,".")});var u={image:o,transforms:s},c={interpolation:t,fillMode:n,fillValue:a,outputShape:i};return Q.runKernel(HNe,u,c)}var q3e=K({transform_:$3e});function W3e(r,e,t){var n=M(r,"a","bandPart");G(n.rank>=2,function(){return"bandPart(): Rank must be at least 2, got ".concat(n.rank,".")});var a=n.shape,i=we(n.shape.slice(-2),2),o=i[0],s=i[1],u,c;typeof e=="number"?(G(e%1===0,function(){return"bandPart(): numLower must be an integer, got ".concat(e,".")}),G(e<=o,function(){return"bandPart(): numLower (".concat(e,")")+" must not be greater than the number of rows (".concat(o,").")}),u=M(e<0?o:e,"numLower","bandPart")):(G(e.dtype==="int32",function(){return"bandPart(): numLower's dtype must be an int32."}),u=Zo(S1(e,0),o,Fv(e,o))),typeof t=="number"?(G(t%1===0,function(){return"bandPart(): numUpper must be an integer, got ".concat(t,".")}),G(t<=s,function(){return"bandPart(): numUpper (".concat(t,")")+" must not be greater than the number of columns (".concat(s,").")}),c=M(t<0?s:t,"numUpper","bandPart")):(G(t.dtype==="int32",function(){return"bandPart(): numUpper's dtype must be an int32."}),c=Zo(S1(t,0),s,Fv(t,s)));var l=ge(Zf(0,o,1,"int32"),[-1,1]),f=Zf(0,s,1,"int32"),h=Ct(l,f),p=Dv($1(h,u),yL(h,Li(c))),d=Ac([o,s],n.dtype);return ge(eh(X1(ge(n,[-1,o,s])).map(function(m){return Zo(p,m,d)})),a)}var V3e=K({bandPart_:W3e});function U3e(r){var e;if(Array.isArray(r)){e=!1,G(r!=null&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=r[0].shape[0],n=function(u){G(r[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(r[u].shape[0]," vs. ").concat(t,")")})},a=1;a<r.length;++a)n(a)}else e=!0,r=Qf(r,r.shape[0],0).map(function(u){return K1(u,[0])});G(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors (".concat(r.length,") exceeds ")+"number of dimensions (".concat(r[0].shape[0],").")});for(var i=[],o=r,s=function(u){i.push(Q.tidy(function(){var c=o[u];if(u>0)for(var l=0;l<u;++l){var f=gt(er(gt(i[l],c)),i[l]);c=Ct(c,f)}return wn(c,qv(c,"euclidean"))}))},a=0;a<r.length;++a)s(a);return e?eh(i,0):i}var G3e=K({gramSchmidt_:U3e});function H3e(r,e){if(e===void 0&&(e=!1),G(r.rank>=2,function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(r.rank)}),r.rank===2)return EB(r,e);var t=r.shape.slice(0,r.shape.length-2).reduce(function(u,c){return u*c}),n=X1(ge(r,[t,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),a=[],i=[];n.forEach(function(u){var c=we(EB(u,e),2),l=c[0],f=c[1];a.push(l),i.push(f)});var o=ge(eh(a,0),r.shape),s=ge(eh(i,0),r.shape);return[o,s]}function EB(r,e){return e===void 0&&(e=!1),Q.tidy(function(){G(r.shape.length===2,function(){return"qr2d() requires a 2D Tensor, but got a ".concat(r.shape.length,"D Tensor.")});for(var t=r.shape[0],n=r.shape[1],a=vL(t),i=Nc(r),o=Hf([[1]],[1,1]),s=Nc(o),u=t>=n?n:t,c=function(f){var h,p=i,d=s,m=a;h=we(Q.tidy(function(){var v=fr(i,[f,f],[t-f,1]),g=qv(v),y=fr(i,[f,f],[1,1]),w=Zo(Wv(y,0),Hf([[-1]]),Hf([[1]])),b=Ct(y,gt(w,g)),x=wn(v,b);x.shape[0]===1?s=Nc(o):s=aa([o,fr(x,[1,0],[x.shape[0]-1,x.shape[1]])],0);var S=Li(wn(Bt(w,b),g)),T=fr(i,[f,0],[t-f,n]),E=gt(S,s),C=N1(s);if(f===0)i=Ct(T,Bt(E,Bt(C,T)));else{var R=Ct(T,Bt(E,Bt(C,T)));i=aa([fr(i,[0,0],[f,n]),R],0)}var _=N1(E),O=fr(a,[0,f],[t,a.shape[1]-f]);if(f===0)a=Ct(O,Bt(Bt(O,s),_));else{var $=Ct(O,Bt(Bt(O,s),_));a=aa([fr(a,[0,0],[t,f]),$],1)}return[s,i,a]}),3),s=h[0],i=h[1],a=h[2],S_e([p,d,m])},l=0;l<u;++l)c(l);return!e&&t>n&&(a=fr(a,[0,0],[t,n]),i=fr(i,[0,0],[n,n])),[a,i]})}var K3e=K({qr_:H3e});var Pn;(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Pn||(Pn={}));function j3e(r,e,t){t===void 0&&(t=Pn.SUM_BY_NONZERO_WEIGHTS);var n=M(r,"losses","computeWeightedLoss"),a=null;e!=null&&(a=M(e,"weights","computeWeightedLoss"));var i=a==null?n:gt(n,a);if(t===Pn.NONE)return i;if(t===Pn.SUM)return er(i);if(t===Pn.MEAN){if(a==null)return _v(i);var o=n.size/a.size,s=wn(er(i),er(a));return o>1?wn(s,_r(o)):s}if(t===Pn.SUM_BY_NONZERO_WEIGHTS){if(a==null)return wn(er(i),_r(n.size));var u=gt(a,eu(n.shape)),c=an(er(EL(u,_r(0))),"float32");return wn(er(i),c)}throw Error("Unknown reduction: ".concat(t))}var lo=K({computeWeightedLoss_:j3e});function X3e(r,e,t,n){n===void 0&&(n=Pn.SUM_BY_NONZERO_WEIGHTS);var a=M(r,"labels","absoluteDifference"),i=M(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=M(t,"weights","absoluteDifference")),Xa(a.shape,i.shape,"Error in absoluteDifference: ");var s=Ua(Ct(a,i));return lo(s,o,n)}var Y3e=K({absoluteDifference_:X3e});function Z3e(r,e,t,n,a){a===void 0&&(a=Pn.SUM_BY_NONZERO_WEIGHTS);var i=M(r,"labels","cosineDistance"),o=M(e,"predictions","cosineDistance"),s=null;n!=null&&(s=M(n,"weights","cosineDistance")),Xa(i.shape,o.shape,"Error in cosineDistance: ");var u=_r(1),c=Ct(u,er(gt(i,o),t,!0));return lo(c,s,a)}var J3e=K({cosineDistance_:Z3e});function Q3e(r,e,t,n){n===void 0&&(n=Pn.SUM_BY_NONZERO_WEIGHTS);var a=M(r,"labels","hingeLoss"),i=M(e,"predictions","hingeLoss"),o=null;t!=null&&(o=M(t,"weights","hingeLoss")),Xa(a.shape,i.shape,"Error in hingeLoss: ");var s=_r(1);a=Ct(gt(_r(2),a),s);var u=Uv(Ct(s,gt(a,i)));return lo(u,o,n)}var eFe=K({hingeLoss_:Q3e});function tFe(r,e,t,n,a){n===void 0&&(n=1),a===void 0&&(a=Pn.SUM_BY_NONZERO_WEIGHTS);var i=M(r,"labels","huberLoss"),o=M(e,"predictions","huberLoss"),s=null;t!=null&&(s=M(t,"weights","huberLoss")),Xa(i.shape,o.shape,"Error in huberLoss: ");var u=_r(n),c=Ua(Ct(o,i)),l=Fv(c,u),f=Ct(c,l),h=Yr(gt(_r(.5),$v(l)),gt(u,f));return lo(h,s,a)}var rFe=K({huberLoss_:tFe});function nFe(r,e,t,n,a){n===void 0&&(n=1e-7),a===void 0&&(a=Pn.SUM_BY_NONZERO_WEIGHTS);var i=M(r,"labels","logLoss"),o=M(e,"predictions","logLoss"),s=null;t!=null&&(s=M(t,"weights","logLoss")),Xa(i.shape,o.shape,"Error in logLoss: ");var u=_r(1),c=_r(n),l=Li(gt(i,Yf(Yr(o,c)))),f=gt(Ct(u,i),Yf(Yr(Ct(u,o),c))),h=Ct(l,f);return lo(h,s,a)}var aFe=K({logLoss_:nFe});function iFe(r,e,t,n){n===void 0&&(n=Pn.SUM_BY_NONZERO_WEIGHTS);var a=M(r,"labels","meanSquaredError"),i=M(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=M(t,"weights","meanSquaredError")),Xa(a.shape,i.shape,"Error in meanSquaredError: ");var s=$L(a,i);return lo(s,o,n)}var oFe=K({meanSquaredError_:iFe});function sFe(r,e){var t=M(r,"labels","sigmoidCrossEntropyWithLogits"),n=M(e,"logits","sigmoidCrossEntropyWithLogits");Xa(t.shape,n.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=Uv(n),i=gt(n,t),o=wL(ru(Li(Ua(n))));return Yr(Ct(a,i),o)}function uFe(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=Pn.SUM_BY_NONZERO_WEIGHTS);var i=M(r,"multiClassLabels","sigmoidCrossEntropy"),o=M(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=M(t,"weights","sigmoidCrossEntropy")),Xa(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),n>0){var u=_r(n),c=_r(1),l=_r(.5);i=Yr(gt(i,Ct(c,u)),gt(l,u))}var f=sFe(i,o);return lo(f,s,a)}var cFe=K({sigmoidCrossEntropy_:uFe});function lFe(r,e,t){if(t===void 0&&(t=-1),t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(e.rank," ")+"and dim was ".concat(t));var n=co(function(a,i,o){var s=!0,u=kL(i,[t],s),c=Ct(an(i,"float32"),u);o([a,c]);var l=Li(gt(c,a)),f=er(l,[t]),h=function(p,d){var m=we(d,2),v=m[0],g=m[1],y=zv(p.shape,[t]);return[gt(ge(p,y),Ct(an(v,"float32"),ru(g))),gt(ge(p,y),Ct(ru(g),an(v,"float32")))]};return{value:f,gradFunc:h}});return n(r,e)}function fFe(r,e,t,n,a){n===void 0&&(n=0),a===void 0&&(a=Pn.SUM_BY_NONZERO_WEIGHTS);var i=M(r,"onehotLabels","softmaxCrossEntropy"),o=M(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=M(t,"weights","softmaxCrossEntropy")),Xa(i.shape,o.shape,"Error in softmaxCrossEntropy: "),n>0){var u=_r(n),c=_r(1),l=_r(i.shape[1]);i=Yr(gt(i,Ct(c,u)),wn(u,l))}var f=lFe(i,o);return lo(f,s,a)}var hFe=K({softmaxCrossEntropy_:fFe});function pFe(r,e,t,n){var a=M(r,"indices","sparseFillEmptyRows","int32"),i=M(e,"values","sparseFillEmptyRows"),o=M(t,"denseShape","sparseFillEmptyRows","int32"),s=M(n,"defaultValue","sparseFillEmptyRows",i.dtype);if(a.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        `.concat(a.shape));if(i.rank!==1)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(o.rank!==1)throw new Error("Dense shape should be Tensor1D but received shape ".concat(o.shape));if(s.rank!==0)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));var u={indices:a,values:i,denseShape:o,defaultValue:s},c=Q.runKernel(_Ne,u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}var dFe=K({sparseFillEmptyRows_:pFe});function vFe(r,e,t){var n=M(r,"inputIndices","sparseReshape","int32"),a=M(e,"inputShape","sparseReshape","int32"),i=M(t,"newShape","sparseReshape","int32");if(n.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        `.concat(n.shape));if(a.rank!==1)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(i.rank!==1)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));var o={inputIndices:n,inputShape:a,newShape:i},s=Q.runKernel(FNe,o);return{outputIndices:s[0],outputShape:s[1]}}var mFe=K({sparseReshape_:vFe});function gFe(r,e,t){var n=M(r,"data","sparseSegmentMean"),a=M(e,"indices","sparseSegmentMean","int32"),i=M(t,"segmentIds","sparseSegmentMean","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          `.concat(i.shape));var o={data:n,indices:a,segmentIds:i};return Q.runKernel(RNe,o)}var yFe=K({sparseSegmentMean_:gFe});function bFe(r,e,t){var n=M(r,"data","sparseSegmentSum"),a=M(e,"indices","sparseSegmentSum","int32"),i=M(t,"segmentIds","sparseSegmentSum","int32");if(n.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         `.concat(i.shape));var o={data:n,indices:a,segmentIds:i};return Q.runKernel(ONe,o)}var wFe=K({sparseSegmentSum_:bFe});function xFe(r,e,t,n,a,i,o,s){var u=M(r,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error("Data must be a vector, saw: ".concat(u.shape));var c=M(e,"dataSplits","stringNGrams");if(c.dtype!=="int32")throw new Error("Data splits must be of datatype int32");var l={separator:t,nGramWidths:n,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},f={data:u,dataSplits:c},h=Q.runKernel(zNe,f,l);return{nGrams:h[0],nGramsSplits:h[1]}}var kFe=K({stringNGrams_:xFe});function SFe(r,e,t){t===void 0&&(t=!0);var n=M(r,"input","stringSplit","string"),a=M(e,"delimiter","stringSplit","string");if(n.rank!==1)throw new Error("Input should be Tensor1D but received shape ".concat(n.shape));if(a.rank!==0)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));var i={skipEmpty:t},o={input:n,delimiter:a},s=Q.runKernel($Ne,o,i);return{indices:s[0],values:s[1],shape:s[2]}}var NFe=K({stringSplit_:SFe});function TFe(r,e){var t=M(r,"input","stringToHashBucketFast","string"),n={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");var a={input:t};return Q.runKernel(qNe,a,n)}var EFe=K({stringToHashBucketFast_:TFe});function IFe(r,e,t,n){n===void 0&&(n=!0);var a=M(r,"input","staticRegexReplace","string"),i={pattern:e,rewrite:t,replaceGlobal:n};return Q.runKernel(BNe,{x:a},i)}var CFe=K({staticRegexReplace_:IFe});var AFe={fft:G1,ifft:Rv,rfft:H1,irfft:zL},DFe={hammingWindow:Q_e,hannWindow:GL,frame:HL,stft:n3e},_Fe={flipLeftRight:s3e,grayscaleToRGB:c3e,resizeNearestNeighbor:M3e,resizeBilinear:O3e,rotateWithOffset:f3e,cropAndResize:i3e,nonMaxSuppression:p3e,nonMaxSuppressionAsync:N3e,nonMaxSuppressionWithScore:E3e,nonMaxSuppressionWithScoreAsync:C3e,nonMaxSuppressionPadded:D3e,nonMaxSuppressionPaddedAsync:F3e,threshold:z3e,transform:q3e},FFe={bandPart:V3e,gramSchmidt:G3e,qr:K3e},RFe={absoluteDifference:Y3e,computeWeightedLoss:lo,cosineDistance:J3e,hingeLoss:eFe,huberLoss:rFe,logLoss:aFe,meanSquaredError:oFe,sigmoidCrossEntropy:cFe,softmaxCrossEntropy:hFe},OFe={sparseFillEmptyRows:dFe,sparseReshape:mFe,sparseSegmentMean:yFe,sparseSegmentSum:wFe},PFe={stringNGrams:kFe,stringSplit:NFe,stringToHashBucketFast:EFe,staticRegexReplace:CFe};var on={__proto__:null,OP_SCOPE_SUFFIX:oL,abs:Ua,acos:ITe,acosh:ATe,add:Yr,addN:FTe,all:OTe,any:MTe,argMax:LTe,argMin:$Te,asin:WTe,asinh:UTe,atan:HTe,atan2:jTe,atanh:YTe,avgPool:sL,avgPool3d:iEe,basicLSTMCell:dEe,batchNorm:Mv,batchNorm2d:bEe,batchNorm3d:xEe,batchNorm4d:SEe,batchToSpaceND:uL,bincount:cL,bitwiseAnd:EEe,booleanMaskAsync:x_e,broadcastArgs:CEe,broadcastTo:Sv,buffer:Jo,cast:an,ceil:_Ee,clipByValue:REe,clone:Nc,complex:tu,concat:aa,concat1d:MEe,concat2d:LEe,concat3d:$Ee,concat4d:WEe,conv1d:GEe,conv2d:Lv,conv2dTranspose:jEe,conv3d:YEe,conv3dTranspose:eIe,cos:rIe,cosh:aIe,cosineWindow:Y1,cumprod:oIe,cumsum:uIe,denseBincount:lIe,depthToSpace:hIe,depthwiseConv2d:B1,diag:vIe,dilation2d:gIe,div:wn,divNoNan:TIe,dot:IIe,dropout:M_e,einsum:AIe,elu:pL,enclosingPowerOfTwo:UL,ensureShape:FIe,equal:hL,erf:OIe,euclideanNorm:UIe,exp:ru,expandDims:Zs,expm1:jIe,eye:vL,fft:G1,fill:Bv,floor:mL,floorDiv:fL,fused:Z_e,gather:gL,gatherND:R_e,greater:Wv,greaterEqual:yL,ifft:Rv,imag:Vv,image:_Fe,inTopKAsync:L_e,irfft:zL,isFinite:nCe,isInf:iCe,isNaN:sCe,leakyRelu:bL,less:S1,lessEqual:$1,linalg:FFe,linspace:fCe,localResponseNormalization:pCe,log:Yf,log1p:wL,logSigmoid:bCe,logSoftmax:kCe,logSumExp:kL,logicalAnd:Dv,logicalNot:SL,logicalOr:NL,logicalXor:CCe,losses:RFe,lowerBound:DCe,matMul:Bt,max:Ec,maxPool:TL,maxPool3d:RCe,maxPoolWithArgmax:PCe,maximum:BCe,mean:_v,meshgrid:zCe,min:x1,minimum:Fv,mirrorPad:WCe,mod:UCe,moments:HCe,movingAverage:E_e,mul:gt,multiRNNCell:jCe,multinomial:YCe,neg:Li,norm:qv,notEqual:EL,oneHot:QCe,ones:eu,onesLike:tAe,op:K,outerProduct:nAe,pad:th,pad1d:oAe,pad2d:uAe,pad3d:lAe,pad4d:hAe,pool:gAe,pow:z1,prelu:CL,print:bAe,prod:xAe,raggedGather:SAe,raggedRange:TAe,raggedTensorToTensor:IAe,rand:AAe,randomGamma:XAe,randomNormal:ML,randomStandardNormal:JAe,randomUniform:U1,randomUniformInt:tDe,range:Zf,real:Jf,reciprocal:aDe,relu:Uv,relu6:BL,reshape:ge,reverse:nu,reverse1d:cDe,reverse2d:fDe,reverse3d:pDe,reverse4d:vDe,rfft:H1,round:LL,rsqrt:yDe,scalar:_r,scatterND:C_e,searchSorted:q1,selu:wDe,separableConv2d:kDe,setdiff1dAsync:NDe,sigmoid:Tc,sign:EDe,signal:DFe,sin:CDe,sinh:DDe,slice:fr,slice1d:FDe,slice2d:ODe,slice3d:MDe,slice4d:LDe,softmax:$De,softplus:xL,spaceToBatchND:IL,sparse:OFe,sparseToDense:__e,spectral:AFe,split:Qf,sqrt:k1,square:$v,squaredDifference:$L,squeeze:K1,stack:eh,step:qL,stridedSlice:ZDe,string:PFe,sub:Ct,sum:er,tan:QDe,tanh:w1,tensor:j1,tensor1d:wi,tensor2d:Hf,tensor3d:e_e,tensor4d:t_e,tensor5d:r_e,tensor6d:n_e,tensorScatterUpdate:o_e,tile:Gf,topk:u_e,transpose:N1,truncatedNormal:l_e,unique:h_e,unsortedSegmentSum:d_e,unstack:X1,upperBound:m_e,variable:g_e,where:Zo,whereAsync:VL,zeros:Ac,zerosLike:L1};var MFe=function(r,e,t,n){switch(n===void 0&&(n=on),r.op){case"BiasAdd":case"AddV2":case"Add":return[n.add(I("a",r,e,t),I("b",r,e,t))];case"AddN":return[n.addN(I("tensors",r,e,t))];case"FloorMod":case"Mod":return[n.mod(I("a",r,e,t),I("b",r,e,t))];case"Mul":return[n.mul(I("a",r,e,t),I("b",r,e,t))];case"RealDiv":case"Div":return[n.div(I("a",r,e,t),I("b",r,e,t))];case"DivNoNan":return[n.divNoNan(I("a",r,e,t),I("b",r,e,t))];case"FloorDiv":return[n.floorDiv(I("a",r,e,t),I("b",r,e,t))];case"Sub":return[n.sub(I("a",r,e,t),I("b",r,e,t))];case"Minimum":return[n.minimum(I("a",r,e,t),I("b",r,e,t))];case"Maximum":return[n.maximum(I("a",r,e,t),I("b",r,e,t))];case"Pow":return[n.pow(I("a",r,e,t),I("b",r,e,t))];case"SquaredDifference":return[n.squaredDifference(I("a",r,e,t),I("b",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var BFe=function(r,e,t,n){switch(n===void 0&&(n=on),r.op){case"Abs":case"ComplexAbs":return[n.abs(I("x",r,e,t))];case"Acos":return[n.acos(I("x",r,e,t))];case"Acosh":return[n.acosh(I("x",r,e,t))];case"Asin":return[n.asin(I("x",r,e,t))];case"Asinh":return[n.asinh(I("x",r,e,t))];case"Atan":return[n.atan(I("x",r,e,t))];case"Atan2":return[n.atan2(I("x",r,e,t),I("y",r,e,t))];case"Atanh":return[n.atanh(I("x",r,e,t))];case"Ceil":return[n.ceil(I("x",r,e,t))];case"Complex":return[n.complex(I("real",r,e,t),I("imag",r,e,t))];case"Cos":return[n.cos(I("x",r,e,t))];case"Cosh":return[n.cosh(I("x",r,e,t))];case"Elu":return[n.elu(I("x",r,e,t))];case"Erf":return[n.erf(I("x",r,e,t))];case"Exp":return[n.exp(I("x",r,e,t))];case"Expm1":return[n.expm1(I("x",r,e,t))];case"Floor":return[n.floor(I("x",r,e,t))];case"Log":return[n.log(I("x",r,e,t))];case"Log1p":return[n.log1p(I("x",r,e,t))];case"Imag":return[n.imag(I("x",r,e,t))];case"Neg":return[n.neg(I("x",r,e,t))];case"Reciprocal":return[n.reciprocal(I("x",r,e,t))];case"Real":return[n.real(I("x",r,e,t))];case"Relu":return[n.relu(I("x",r,e,t))];case"Round":return[n.round(I("x",r,e,t))];case"Selu":return[n.selu(I("x",r,e,t))];case"Sigmoid":return[n.sigmoid(I("x",r,e,t))];case"Sin":return[n.sin(I("x",r,e,t))];case"Sign":return[n.sign(I("x",r,e,t))];case"Sinh":return[n.sinh(I("x",r,e,t))];case"Softplus":return[n.softplus(I("x",r,e,t))];case"Sqrt":return[n.sqrt(I("x",r,e,t))];case"Square":return[n.square(I("x",r,e,t))];case"Tanh":return[n.tanh(I("x",r,e,t))];case"Tan":return[n.tan(I("x",r,e,t))];case"ClipByValue":return[n.clipByValue(I("x",r,e,t),I("clipValueMin",r,e,t),I("clipValueMax",r,e,t))];case"Relu6":return[n.relu6(I("x",r,e,t))];case"Rsqrt":return[n.rsqrt(nn(r.inputNames[0],e,t))];case"LeakyRelu":return[n.leakyRelu(I("x",r,e,t),I("alpha",r,e,t))];case"Prelu":return[n.prelu(I("x",r,e,t),I("alpha",r,e,t))];case"IsNan":return[n.isNaN(nn(r.inputNames[0],e,t))];case"IsInf":return[n.isInf(nn(r.inputNames[0],e,t))];case"IsFinite":return[n.isFinite(nn(r.inputNames[0],e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};function Ga(r,e,t){if(t===void 0&&(t=""),!(typeof r=="number"||typeof e=="number")){Be.util.assert(r.length===e.length,function(){return t+" Shapes ".concat(r," and ").concat(e," must match")});for(var n=0;n<r.length;n++){var a=r[n],i=e[n];Be.util.assert(a<0||i<0||a===i,function(){return t+" Shapes ".concat(r," and ").concat(e," must match")})}}}function IB(r){return!(typeof r=="number"||r.some(function(e){return e<0}))}function Wf(r,e,t){var n=T1(r,t),a=!IB(n);if(a&&e.length===0)throw new Error("Tried to calculate elements of an empty list"+" with non-fully-defined elementShape: ".concat(n));if(a&&e.forEach(function(i){n=T1(i.shape,n)}),!IB(n))throw new Error("Non-fully-defined elementShape: ".concat(n));return n}function T1(r,e){if(typeof r=="number")return e;if(typeof e=="number")return r;if(r.length!==e.length)throw new Error("Incompatible ranks during merge: ".concat(r," vs. ").concat(e));for(var t=[],n=0;n<r.length;++n){var a=r[n],i=e[n];if(a>=0&&i>=0&&a!==i)throw new Error("Incompatible shape during merge: ".concat(r," vs. ").concat(e));t[n]=a>=0?a:i}return t}var LFe=function(){function r(e,t,n,a,i,o,s){this.name=e,this.dtype=t,this.maxSize=n,this.elementShape=a,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=Be.scalar(0),Be.keep(this.idTensor)}return Object.defineProperty(r.prototype,"id",{get:function(){return this.idTensor.id},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"closed",{get:function(){return this.closed_},enumerable:!1,configurable:!0}),r.prototype.clearAndClose=function(e){this.tensors.forEach(function(t){(e==null||!e.has(t.tensor.id))&&t.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()},r.prototype.size=function(){return this.tensors.length},r.prototype.read=function(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read ")+"(perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor},r.prototype.readMany=function(e){var t=this;return e.map(function(n){return t.read(n)})},r.prototype.write=function(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,`,
          because the value dtype is `).concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=t.shape),Ga(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),n.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(n.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));n.tensor=t,Be.keep(t),n.written=!0,this.tensors[e]=n},r.prototype.writeMany=function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,")+"because the index size: ".concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach(function(a,i){return n.write(a,t[i])})},r.prototype.gather=function(e,t){if(!!t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(var n=0;n<this.size();n++)e.push(n)}if(e.length===0)return Be.tensor([],[0].concat(this.elementShape));var a=this.readMany(e);return Ga(this.elementShape,a[0].shape,"TensorArray shape mismatch: "),Be.stack(a,0)},r.prototype.concat=function(e){if(!!e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(this.size()===0)return Be.tensor([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var a=this.readMany(t);return Ga(this.elementShape,a[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(a[0].shape,")")),Be.concat(a,0)},r.prototype.scatter=function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));var n=Math.max.apply(Math,Dt([],we(e),!1));if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size (".concat(n,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,Be.unstack(t,0))},r.prototype.split=function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));var a=0,i=e.map(function(l){return a+=l,a});if(a!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        `.concat(a,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), ")+"and the TensorArray is not marked as dynamically resizeable");var o=a===0?0:t.size/a,s=[];Be.tidy(function(){t=Be.reshape(t,[1,a,o]);for(var l=0;l<e.length;++l){var f=l===0?0:i[l-1],h=[0,f,0],p=[1,e[l],o];s[l]=Be.reshape(Be.slice(t,h,p),n.elementShape)}return s});for(var u=[],c=0;c<e.length;c++)u[c]=c;this.writeMany(u,s)},r}(),Gv=function(){function r(e,t,n,a){a===void 0&&(a=-1),this.tensors=e,this.elementShape=t,this.elementDtype=n,e?.forEach(function(i){if(n!==i.dtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(i.dtype));Ga(t,i.shape,"TensorList shape mismatch: "),Be.keep(i)}),this.idTensor=Be.scalar(0),this.maxNumElements=a,Be.keep(this.idTensor)}return Object.defineProperty(r.prototype,"id",{get:function(){return this.idTensor.id},enumerable:!1,configurable:!0}),r.prototype.copy=function(){return new r(Dt([],we(this.tensors),!1),this.elementShape,this.elementDtype)},r.prototype.clearAndClose=function(e){this.tensors.forEach(function(t){(e==null||!e.has(t.id))&&t.dispose()}),this.tensors.length=0,this.idTensor.dispose()},r.prototype.size=function(){return this.tensors.length},r.prototype.stack=function(e,t,n){var a=this;if(n===void 0&&(n=-1),t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(n!==-1&&this.tensors.length!==n)throw new Error("Operation expected a list with ".concat(n," elements but got a list with ").concat(this.tensors.length," elements."));Ga(e,this.elementShape,"TensorList shape mismatch: ");var i=Wf(this.elementShape,this.tensors,e);return Be.tidy(function(){var o=a.tensors.map(function(s){return Be.reshape(s,i)});return Be.stack(o,0)})},r.prototype.popBack=function(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(this.size()===0)throw new Error("Trying to pop from an empty list.");var n=Wf(this.elementShape,this.tensors,e),a=this.tensors.pop();return a.kept=!1,Ga(a.shape,e,"TensorList shape mismatch: "),Be.reshape(a,n)},r.prototype.pushBack=function(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(this.elementDtype));if(Ga(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Be.keep(e),this.tensors.push(e)},r.prototype.resize=function(e){if(e<0)throw new Error("TensorListResize expects size to be non-negative. Got: ".concat(e));if(this.maxNumElements!==-1&&e>this.maxNumElements)throw new Error("TensorListResize input size ".concat(e," is greater maxNumElement ").concat(this.maxNumElements,"."));var t=new r([],this.elementShape,this.elementDtype,this.maxNumElements);t.tensors.length=e;for(var n=0;n<Math.min(this.tensors.length,e);++n)t.tensors[n]=this.tensors[n];return t},r.prototype.getItem=function(e,t,n){if(n!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(this.elementDtype));if(e<0||e>this.tensors.length)throw new Error("Trying to access element ".concat(e," in a list with ").concat(this.tensors.length," elements."));if(this.tensors[e]==null)throw new Error("element at index ".concat(e," is null."));Ga(this.tensors[e].shape,t,"TensorList shape mismatch: ");var a=Wf(this.elementShape,this.tensors,t);return Be.reshape(this.tensors[e],a)},r.prototype.setItem=function(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t.dtype,", but list elements ").concat(this.elementDtype));if(e<0||this.maxNumElements!==-1&&e>=this.maxNumElements)throw new Error("Trying to set element ".concat(e," in a list with max ").concat(this.maxNumElements," elements."));Ga(this.elementShape,t.shape,"TensorList shape mismatch: "),Be.keep(t),this.tensors[e]!=null&&(this.tensors[e].kept=!1),this.tensors[e]=t},r.prototype.gather=function(e,t,n){var a=this;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));Ga(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());var i=Wf(this.elementShape,this.tensors,n);return e.length===0?Be.tensor([],[0].concat(i)):Be.tidy(function(){var o=e.map(function(s){return Be.reshape(a.tensors[s],i)});return Be.stack(o,0)})},r.prototype.concat=function(e,t){var n=this;if(!!e&&e!==this.elementDtype)throw new Error("TensorList dtype is ".concat(this.elementDtype," but concat requested dtype ").concat(e));Ga(this.elementShape,t,"TensorList shape mismatch: ");var a=Wf(this.elementShape,this.tensors,t);return this.size()===0?Be.tensor([],[0].concat(a)):Be.tidy(function(){var i=n.tensors.map(function(o){return Be.reshape(o,a)});return Be.concat(i,0)})},r}();function zFe(r,e,t){var n=r.dtype;if(r.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: ".concat(r.shape));if(r.dtype!==t)throw new Error("Invalid data types; op elements ".concat(r.dtype,", but list elements ").concat(t));var a=r.shape.slice(1);Ga(a,e,"TensorList shape mismatch: ");var i=Be.unstack(r);return new Gv(i,e,n)}function $Fe(r,e,t,n){return new Gv([],r,e,n)}function qFe(r,e,t,n){if(e.length!==r.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(r.shape[0]));var a=Math.max.apply(Math,Dt([],we(e),!1));if(n!=null&&n!==-1&&a>=n)throw new Error("Max index must be < array size (".concat(a,"  vs. ").concat(n,")"));var i=new Gv([],t,r.dtype,n),o=Be.unstack(r,0);return e.forEach(function(s,u){i.setItem(s,o[u])}),i}function WFe(r,e,t){var n=0,a=e.map(function(f){return n+=f,n});if(n!==r.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        `.concat(n,", and tensor's shape is: ").concat(r.shape));for(var i=r.shape.slice(1),o=T1(i,t),s=n===0?0:r.size/n,u=Be.tidy(function(){var f=[];r=Be.reshape(r,[1,n,s]);for(var h=0;h<e.length;++h){var p=h===0?0:a[h-1],d=[0,p,0],m=[1,e[h],s];f[h]=Be.reshape(Be.slice(r,d,m),o)}return r.dispose(),f}),c=new Gv([],t,r.dtype,e.length),l=0;l<u.length;l++)c.setItem(l,u[l]);return c}var VFe=function(r,e,t){return Pt(void 0,void 0,void 0,function(){var n,a,i,o,c,h,s,u,c,l,f,h,p,d,m,m,y,v,y,g,y,y,y,Ir,w,et,b,x,S,T,E,C,oe,st,R,_,le,O,xe,De,$,z,L,de,ke,B,nt,W,ft,X,tt,nr,J,V,j,ne,re,kt,oe,st,He,kt,le,et,Ze,He,de,ke,et,Ye,He,et,at,he,Ye,ye,He,xe,De,et,at,He,kt,et,at,Ye,He,ht,et,at,He,nt,He,ft,et,kt,st,He,kt,et,Ze,He,tt,et,nr,He,kt,He,kt,Ir,vn,Pr;return _t(this,function(Cr){switch(Cr.label){case 0:switch(n=r.op,n){case"If":return[3,1];case"StatelessIf":return[3,1];case"While":return[3,3];case"StatelessWhile":return[3,3];case"LoopCond":return[3,9];case"Switch":return[3,10];case"Merge":return[3,12];case"Enter":return[3,13];case"Exit":return[3,14];case"NextIteration":return[3,15];case"TensorArrayV3":return[3,16];case"TensorArrayWriteV3":return[3,17];case"TensorArrayReadV3":return[3,18];case"TensorArrayGatherV3":return[3,19];case"TensorArrayScatterV3":return[3,20];case"TensorArrayConcatV3":return[3,21];case"TensorArraySplitV3":return[3,22];case"TensorArraySizeV3":return[3,23];case"TensorArrayCloseV3":return[3,24];case"TensorListSetItem":return[3,25];case"TensorListGetItem":return[3,26];case"TensorListScatterV2":return[3,27];case"TensorListScatter":return[3,27];case"TensorListReserve":return[3,28];case"EmptyTensorList":return[3,28];case"TensorListGather":return[3,29];case"TensorListStack":return[3,30];case"TensorListFromTensor":return[3,31];case"TensorListConcat":return[3,32];case"TensorListConcatV2":return[3,32];case"TensorListPushBack":return[3,33];case"TensorListPopBack":return[3,34];case"TensorListSplit":return[3,35];case"TensorListLength":return[3,36];case"TensorListResize":return[3,37]}return[3,38];case 1:return a=I("thenBranch",r,e,t),i=I("elseBranch",r,e,t),o=I("cond",r,e,t),c=I("args",r,e,t),[4,o.data()];case 2:return h=Cr.sent(),h[0]?[2,t.functionMap[a].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap)]:[2,t.functionMap[i].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap)];case 3:return s=I("body",r,e,t),u=I("cond",r,e,t),c=I("args",r,e,t),[4,t.functionMap[u].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap)];case 4:return l=Cr.sent(),f=c.map(function(ar){return ar.id}),[4,l[0].data()];case 5:h=Cr.sent(),l.forEach(function(ar){!ar.kept&&f.indexOf(ar.id)===-1&&ar.dispose()}),p=c,d=function(){var ar,zn,mn;return _t(this,function($n){switch($n.label){case 0:return ar=p,[4,t.functionMap[s].executeFunctionAsync(p,t.tensorArrayMap,t.tensorListMap)];case 1:return p=$n.sent(),zn=p.map(function(Sr){return Sr.id}),ar.forEach(function(Sr){!Sr.kept&&f.indexOf(Sr.id)===-1&&zn.indexOf(Sr.id)===-1&&Sr.dispose()}),[4,t.functionMap[u].executeFunctionAsync(p,t.tensorArrayMap,t.tensorListMap)];case 2:return mn=$n.sent(),[4,mn[0].data()];case 3:return h=$n.sent(),mn.forEach(function(Sr){!Sr.kept&&f.indexOf(Sr.id)===-1&&zn.indexOf(Sr.id)===-1&&Sr.dispose()}),[2]}})},Cr.label=6;case 6:return h[0]?[5,d()]:[3,8];case 7:return Cr.sent(),[3,6];case 8:return[2,p];case 9:return m=I("pred",r,e,t),[2,[uo(m)]];case 10:return m=I("pred",r,e,t),y=I("data",r,e,t),y.kept||(y=uo(y)),[4,m.data()];case 11:return[2,Cr.sent()[0]?[void 0,y]:[y,void 0]];case 12:return v=r.inputNames.find(function(ar){return nn(ar,e,t)!==void 0}),v?(y=nn(v,e,t),[2,[uo(y)]]):[2,void 0];case 13:return g=I("frameName",r,e,t),y=I("tensor",r,e,t),t.enterFrame(g),[2,[uo(y)]];case 14:return y=I("tensor",r,e,t),t.exitFrame(),[2,[uo(y)]];case 15:return y=I("tensor",r,e,t),t.nextIteration(),[2,[uo(y)]];case 16:return Ir=I("size",r,e,t),w=I("dtype",r,e,t),et=I("elementShape",r,e,t),b=I("dynamicSize",r,e,t),x=I("clearAfterRead",r,e,t),S=I("identicalElementShapes",r,e,t),T=I("name",r,e,t),E=new LFe(T,w,Ir,et,S,b,x),t.addTensorArray(E),[2,[E.idTensor,Be.scalar(1)]];case 17:return C=I("tensorArrayId",r,e,t),oe=I("index",r,e,t),st=I("tensor",r,e,t),R=t.getTensorArray(C.id),R.write(oe,st),[2,[R.idTensor]];case 18:return _=I("tensorArrayId",r,e,t),le=I("index",r,e,t),O=t.getTensorArray(_.id),[2,[O.read(le)]];case 19:return xe=I("tensorArrayId",r,e,t),De=I("indices",r,e,t),$=I("dtype",r,e,t),z=t.getTensorArray(xe.id),[2,[z.gather(De,$)]];case 20:return L=I("tensorArrayId",r,e,t),de=I("indices",r,e,t),ke=I("tensor",r,e,t),B=t.getTensorArray(L.id),B.scatter(de,ke),[2,[B.idTensor]];case 21:return nt=I("tensorArrayId",r,e,t),W=t.getTensorArray(nt.id),ft=I("dtype",r,e,t),[2,[W.concat(ft)]];case 22:return X=I("tensorArrayId",r,e,t),tt=I("tensor",r,e,t),nr=I("lengths",r,e,t),J=t.getTensorArray(X.id),J.split(nr,tt),[2,[J.idTensor]];case 23:return V=I("tensorArrayId",r,e,t),j=t.getTensorArray(V.id),[2,[Be.scalar(j.size(),"int32")]];case 24:return ne=I("tensorArrayId",r,e,t),re=t.getTensorArray(ne.id),re.clearAndClose(),[2,[re.idTensor]];case 25:return kt=I("tensorListId",r,e,t),oe=I("index",r,e,t),st=I("tensor",r,e,t),He=t.getTensorList(kt.id),He.setItem(oe,st),[2,[He.idTensor]];case 26:return kt=I("tensorListId",r,e,t),le=I("index",r,e,t),et=I("elementShape",r,e,t),Ze=I("elementDType",r,e,t),He=t.getTensorList(kt.id),[2,[He.getItem(le,et,Ze)]];case 27:return de=I("indices",r,e,t),ke=I("tensor",r,e,t),et=I("elementShape",r,e,t),Ye=I("numElements",r,e,t),He=qFe(ke,de,et,Ye),t.addTensorList(He),[2,[He.idTensor]];case 28:return et=I("elementShape",r,e,t),at=I("elementDType",r,e,t),he=void 0,r.op==="TensorListReserve"?he="numElements":he="maxNumElements",Ye=I(he,r,e,t),ye=r.op==="TensorListReserve"?-1:Ye,He=$Fe(et,at,Ye,ye),t.addTensorList(He),[2,[He.idTensor]];case 29:return xe=I("tensorListId",r,e,t),De=I("indices",r,e,t),et=I("elementShape",r,e,t),at=I("elementDType",r,e,t),He=t.getTensorList(xe.id),[2,[He.gather(De,at,et)]];case 30:return kt=I("tensorListId",r,e,t),et=I("elementShape",r,e,t),at=I("elementDType",r,e,t),Ye=I("numElements",r,e,t),He=t.getTensorList(kt.id),[2,[He.stack(et,at,Ye)]];case 31:return ht=I("tensor",r,e,t),et=I("elementShape",r,e,t),at=I("elementDType",r,e,t),He=zFe(ht,et,at),t.addTensorList(He),[2,[He.idTensor]];case 32:return nt=I("tensorListId",r,e,t),He=t.getTensorList(nt.id),ft=I("dtype",r,e,t),et=I("elementShape",r,e,t),[2,[He.concat(ft,et)]];case 33:return kt=I("tensorListId",r,e,t),st=I("tensor",r,e,t),He=t.getTensorList(kt.id),He.pushBack(st),[2,[He.idTensor]];case 34:return kt=I("tensorListId",r,e,t),et=I("elementShape",r,e,t),Ze=I("elementDType",r,e,t),He=t.getTensorList(kt.id),[2,[He.popBack(et,Ze)]];case 35:return tt=I("tensor",r,e,t),et=I("elementShape",r,e,t),nr=I("lengths",r,e,t),He=WFe(tt,nr,et),t.addTensorList(He),[2,[He.idTensor]];case 36:return kt=I("tensorListId",r,e,t),He=t.getTensorList(kt.id),[2,[Be.scalar(He.size(),"int32")]];case 37:return kt=I("tensorListId",r,e,t),Ir=I("size",r,e,t),vn=t.getTensorList(kt.id),Pr=vn.resize(Ir),t.addTensorList(Pr),[2,[Pr.idTensor]];case 38:throw TypeError("Node type ".concat(r.op," is not implemented"))}})})};function CB(r,e,t){var n=we(I("fusedOps",r,e,t),2),a=n[0],i=n[1],o=a==="biasadd",s=!o,u=i==="prelu",c=a==="fusedbatchnorm",l=I("numArgs",r,e,t);if(o){if(u&&l!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!u&&o&&l!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(c)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");var f=I("strides",r,e,t),h=wv(r,e,t),p=I("dataFormat",r,e,t).toUpperCase(),d=I("dilations",r,e,t),m=we(I("args",r,e,t),2),v=m[0],g=m[1];s&&(g=v,v=void 0);var y=I("leakyreluAlpha",r,e,t);return{stride:f,pad:h,dataFormat:p,dilations:d,biasArg:v,preluArg:g,activationFunc:i,leakyreluAlpha:y}}var UFe=function(r,e,t,n){switch(n===void 0&&(n=on),r.op){case"Conv1D":{var a=I("stride",r,e,t),i=I("pad",r,e,t),o=I("dataFormat",r,e,t).toUpperCase(),s=I("dilation",r,e,t);return[n.conv1d(I("x",r,e,t),I("filter",r,e,t),a,i,o,s)]}case"Conv2D":{var a=I("strides",r,e,t),i=wv(r,e,t),o=I("dataFormat",r,e,t).toUpperCase(),u=I("dilations",r,e,t);return[n.conv2d(I("x",r,e,t),I("filter",r,e,t),[a[1],a[2]],i,o,[u[1],u[2]])]}case"_FusedConv2D":{var c=CB(r,e,t),a=c.stride,i=c.pad,o=c.dataFormat,u=c.dilations,l=c.biasArg,f=c.preluArg,h=c.activationFunc,p=c.leakyreluAlpha;return[n.fused.conv2d({x:I("x",r,e,t),filter:I("filter",r,e,t),strides:[a[1],a[2]],pad:i,dataFormat:o,dilations:[u[1],u[2]],bias:l,activation:h,preluActivationWeights:f,leakyreluAlpha:p})]}case"FusedDepthwiseConv2dNative":{var d=CB(r,e,t),a=d.stride,i=d.pad,o=d.dataFormat,u=d.dilations,l=d.biasArg,f=d.preluArg,h=d.activationFunc,p=d.leakyreluAlpha;return[n.fused.depthwiseConv2d({x:I("x",r,e,t),filter:I("filter",r,e,t),strides:[a[1],a[2]],pad:i,dataFormat:o,dilations:[u[1],u[2]],bias:l,activation:h,preluActivationWeights:f,leakyreluAlpha:p})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{var m=I("outputShape",r,e,t),a=I("strides",r,e,t),i=wv(r,e,t);return[n.conv2dTranspose(I("x",r,e,t),I("filter",r,e,t),m,[a[1],a[2]],i)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{var a=I("strides",r,e,t),i=wv(r,e,t),u=I("dilations",r,e,t),o=I("dataFormat",r,e,t).toUpperCase();return[n.depthwiseConv2d(I("input",r,e,t),I("filter",r,e,t),[a[1],a[2]],i,o,[u[1],u[2]])]}case"Conv3D":{var a=I("strides",r,e,t),i=I("pad",r,e,t),o=I("dataFormat",r,e,t).toUpperCase(),u=I("dilations",r,e,t);return[n.conv3d(I("x",r,e,t),I("filter",r,e,t),[a[1],a[2],a[3]],i,o,[u[1],u[2],u[3]])]}case"AvgPool":{var a=I("strides",r,e,t),i=I("pad",r,e,t),v=I("kernelSize",r,e,t);return[n.avgPool(I("x",r,e,t),[v[1],v[2]],[a[1],a[2]],i)]}case"MaxPool":{var a=I("strides",r,e,t),i=I("pad",r,e,t),v=I("kernelSize",r,e,t);return[n.maxPool(I("x",r,e,t),[v[1],v[2]],[a[1],a[2]],i)]}case"MaxPoolWithArgmax":{var a=I("strides",r,e,t),i=I("pad",r,e,t),v=I("kernelSize",r,e,t),g=I("includeBatchInIndex",r,e,t),y=n.maxPoolWithArgmax(I("x",r,e,t),[v[1],v[2]],[a[1],a[2]],i,g),w=y.result,b=y.indexes;return[w,b]}case"AvgPool3D":{var a=I("strides",r,e,t),i=I("pad",r,e,t),v=I("kernelSize",r,e,t);return[n.avgPool3d(I("x",r,e,t),[v[1],v[2],v[3]],[a[1],a[2],a[3]],i)]}case"MaxPool3D":{var a=I("strides",r,e,t),i=I("pad",r,e,t),v=I("kernelSize",r,e,t);return[n.maxPool3d(I("x",r,e,t),[v[1],v[2],v[3]],[a[1],a[2],a[3]],i)]}case"Dilation2D":{var x=I("strides",r,e,t),i=I("pad",r,e,t),u=I("dilations",r,e,t),S=x[1],T=x[2],E=u[1],C=u[2];return[n.dilation2d(I("x",r,e,t),I("filter",r,e,t),[S,T],i,[E,C],"NHWC")]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var GFe=function(r,e,t,n){switch(n===void 0&&(n=on),r.op){case"Fill":{var a=I("shape",r,e,t),i=I("dtype",r,e,t),o=I("value",r,e,t);return[n.fill(a,o,i)]}case"LinSpace":{var s=I("start",r,e,t),u=I("stop",r,e,t),c=I("num",r,e,t);return[n.linspace(s,u,c)]}case"Multinomial":{var l=I("logits",r,e,t),f=I("numSamples",r,e,t),h=I("seed",r,e,t);return[n.multinomial(l,f,h)]}case"OneHot":{var p=I("indices",r,e,t),d=I("depth",r,e,t),m=I("onValue",r,e,t),v=I("offValue",r,e,t),i=I("dtype",r,e,t);return[n.oneHot(p,d,m,v,i)]}case"Ones":return[n.ones(I("shape",r,e,t),I("dtype",r,e,t))];case"OnesLike":return[n.onesLike(I("x",r,e,t))];case"RandomStandardNormal":return[n.randomStandardNormal(I("shape",r,e,t),I("dtype",r,e,t),I("seed",r,e,t))];case"RandomUniform":return[n.randomUniform(I("shape",r,e,t),I("minval",r,e,t),I("maxval",r,e,t),I("dtype",r,e,t))];case"RandomUniformInt":return[n.randomUniformInt(I("shape",r,e,t),I("minval",r,e,t),I("maxval",r,e,t),I("seed",r,e,t))];case"Range":{var s=I("start",r,e,t),u=I("stop",r,e,t),g=I("step",r,e,t);return[n.range(s,u,g,I("dtype",r,e,t))]}case"TruncatedNormal":{var a=I("shape",r,e,t),y=I("mean",r,e,t),w=I("stdDev",r,e,t),h=I("seed",r,e,t);return[n.truncatedNormal(a,y,w,I("dtype",r,e,t),h)]}case"Zeros":return[n.zeros(I("shape",r,e,t),I("dtype",r,e,t))];case"ZerosLike":return[n.zerosLike(I("x",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};function Qw(r,e,t){var n=I("boxes",r,e,t),a=I("scores",r,e,t),i=I("maxOutputSize",r,e,t),o=I("iouThreshold",r,e,t),s=I("scoreThreshold",r,e,t),u=I("softNmsSigma",r,e,t);return{boxes:n,scores:a,maxOutputSize:i,iouThreshold:o,scoreThreshold:s,softNmsSigma:u}}var HFe=function(r,e,t,n,a){return a===void 0&&(a=on),Pt(void 0,void 0,void 0,function(){var i,o,f,h,p,d,m,s,g,u,f,h,p,d,m,c,g,l,f,h,p,d,m,v,g;return _t(this,function(y){switch(y.label){case 0:switch(i=r.op,i){case"NonMaxSuppressionV5":return[3,1];case"NonMaxSuppressionV4":return[3,3];case"NonMaxSuppressionV3":return[3,5];case"NonMaxSuppressionV2":return[3,5];case"Where":return[3,7];case"ListDiff":return[3,9]}return[3,10];case 1:return o=Qw(r,e,t),f=o.boxes,h=o.scores,p=o.maxOutputSize,d=o.iouThreshold,m=o.scoreThreshold,s=o.softNmsSigma,[4,a.image.nonMaxSuppressionWithScoreAsync(f,h,p,d,m,s)];case 2:return g=y.sent(),[2,[g.selectedIndices,g.selectedScores]];case 3:return u=Qw(r,e,t),f=u.boxes,h=u.scores,p=u.maxOutputSize,d=u.iouThreshold,m=u.scoreThreshold,c=I("padToMaxOutputSize",r,e,t),[4,a.image.nonMaxSuppressionPaddedAsync(f,h,p,d,m,c)];case 4:return g=y.sent(),[2,[g.selectedIndices,g.validOutputs]];case 5:return l=Qw(r,e,t),f=l.boxes,h=l.scores,p=l.maxOutputSize,d=l.iouThreshold,m=l.scoreThreshold,[4,a.image.nonMaxSuppressionAsync(f,h,p,d,m)];case 6:return[2,[y.sent()]];case 7:return v=a.cast(I("condition",r,e,t),"bool"),[4,a.whereAsync(v)];case 8:return g=[y.sent()],v.dispose(),[2,g];case 9:return[2,a.setdiff1dAsync(I("x",r,e,t),I("y",r,e,t))];case 10:throw TypeError("Node type ".concat(r.op," is not implemented"))}})})};var KFe=function(r,e,t,n){switch(n===void 0&&(n=on),r.op){case"LowerBound":{var a=I("sortedSequence",r,e,t),i=I("values",r,e,t);return[n.lowerBound(a,i)]}case"TopKV2":{var o=I("x",r,e,t),s=I("k",r,e,t),u=I("sorted",r,e,t),c=n.topk(o,s,u);return[c.values,c.indices]}case"UpperBound":{var a=I("sortedSequence",r,e,t),i=I("values",r,e,t);return[n.upperBound(a,i)]}case"Unique":{var o=I("x",r,e,t),c=n.unique(o);return[c.values,c.indices]}case"UniqueV2":{var o=I("x",r,e,t),l=I("axis",r,e,t),c=n.unique(o,l);return[c.values,c.indices]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var jFe=function(r,e,t,n){switch(n===void 0&&(n=on),r.op){case"Const":return e[r.name];case"PlaceholderWithDefault":var a=I("default",r,e,t);return[nn(r.name,e,t)||a];case"Placeholder":return[nn(r.name,e,t)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{var i=I("x",r,e,t);return[uo(i)]}case"IdentityN":return I("x",r,e,t).map(function(h){return uo(h)});case"Snapshot":var o=I("x",r,e,t);return[uo(o)];case"Shape":return[n.tensor1d(I("x",r,e,t).shape,"int32")];case"ShapeN":return I("x",r,e,t).map(function(h){return n.tensor1d(h.shape)});case"Size":return[n.scalar(I("x",r,e,t).size,"int32")];case"Rank":return[n.scalar(I("x",r,e,t).rank,"int32")];case"NoOp":return[n.scalar(1)];case"Print":var s=I("x",r,e,t),u=I("data",r,e,t),c=I("message",r,e,t),l=I("summarize",r,e,t);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(c);for(var f=0;f<u.length;f++)console.log(Array.prototype.slice.call(u[f].dataSync()).slice(0,l));return[s];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}},XFe=function(){function r(e,t){this.keyDType=e,this.valueDType=t,this.handle=Be.scalar(0),this.tensorMap=new Map,Be.keep(this.handle)}return Object.defineProperty(r.prototype,"id",{get:function(){return this.handle.id},enumerable:!1,configurable:!0}),r.prototype.clearAndClose=function(){this.tensorMap.forEach(function(e){return e.dispose()}),this.tensorMap.clear(),this.handle.dispose()},r.prototype.size=function(){return this.tensorMap.size},r.prototype.tensorSize=function(){return _r(this.size(),"int32")},r.prototype.import=function(e,t){return Pt(this,void 0,void 0,function(){var n,a=this;return _t(this,function(i){switch(i.label){case 0:return this.checkKeyAndValueTensor(e,t),[4,e.data()];case 1:return n=i.sent(),this.tensorMap.forEach(function(o){return o.dispose()}),this.tensorMap.clear(),[2,Be.tidy(function(){var o=Be.unstack(t),s=n.length,u=o.length;Be.util.assert(s===u,function(){return"The number of elements doesn't match, keys has "+"".concat(s," elements, the values has ").concat(u," ")+"elements."});for(var c=0;c<s;c++){var l=n[c],f=o[c];Be.keep(f),a.tensorMap.set(l,f)}return a.handle})]}})})},r.prototype.find=function(e,t){return Pt(this,void 0,void 0,function(){var n,a=this;return _t(this,function(i){switch(i.label){case 0:return this.checkKeyAndValueTensor(e,t),[4,e.data()];case 1:return n=i.sent(),[2,Be.tidy(function(){for(var o=[],s=0;s<n.length;s++){var u=n[s],c=a.findWithDefault(u,t);o.push(c)}return Be.stack(o)})]}})})},r.prototype.findWithDefault=function(e,t){var n=this.tensorMap.get(e);return n??t},r.prototype.checkKeyAndValueTensor=function(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype ".concat(this.keyDType,", but got ")+"".concat(e.dtype));if(t.dtype!==this.valueDType)throw new Error("Expect value dtype ".concat(this.valueDType,", but got ")+"".concat(t.dtype))},r}(),YFe=function(r,e,t,n){return Pt(void 0,void 0,void 0,function(){var a,i,o,s,h,f,c,u,h,f,c,l,h,f,h;return _t(this,function(p){switch(p.label){case 0:switch(a=r.op,a){case"HashTable":return[3,1];case"HashTableV2":return[3,1];case"InitializeTable":return[3,2];case"InitializeTableV2":return[3,2];case"LookupTableImport":return[3,2];case"LookupTableImportV2":return[3,2];case"LookupTableFind":return[3,4];case"LookupTableFindV2":return[3,4];case"LookupTableSize":return[3,6];case"LookupTableSizeV2":return[3,6]}return[3,7];case 1:return i=n.getHashTableHandleByName(r.name),i!=null?[2,[i]]:(o=I("keyDType",r,e,t),s=I("valueDType",r,e,t),h=new XFe(o,s),n.addHashTable(r.name,h),[2,[h.handle]]);case 2:return f=I("tableHandle",r,e,t,n),c=I("keys",r,e,t),u=I("values",r,e,t),h=n.getHashTableById(f.id),[4,h.import(c,u)];case 3:return[2,[p.sent()]];case 4:return f=I("tableHandle",r,e,t,n),c=I("keys",r,e,t),l=I("defaultValue",r,e,t),h=n.getHashTableById(f.id),[4,h.find(c,l)];case 5:return[2,[p.sent()]];case 6:return f=I("tableHandle",r,e,t,n),h=n.getHashTableById(f.id),[2,[h.tensorSize()]];case 7:throw TypeError("Node type ".concat(r.op," is not implemented"))}})})};var ZFe=function(r,e,t,n){switch(n===void 0&&(n=on),r.op){case"ResizeBilinear":{var a=I("images",r,e,t),i=I("size",r,e,t),o=I("alignCorners",r,e,t),s=I("halfPixelCenters",r,e,t);return[n.image.resizeBilinear(a,[i[0],i[1]],o,s)]}case"ResizeNearestNeighbor":{var a=I("images",r,e,t),i=I("size",r,e,t),o=I("alignCorners",r,e,t),s=I("halfPixelCenters",r,e,t);return[n.image.resizeNearestNeighbor(a,[i[0],i[1]],o,s)]}case"CropAndResize":{var u=I("image",r,e,t),c=I("boxes",r,e,t),l=I("boxInd",r,e,t),f=I("cropSize",r,e,t),h=I("method",r,e,t),p=I("extrapolationValue",r,e,t);return[n.image.cropAndResize(u,c,l,f,h,p)]}case"ImageProjectiveTransformV3":{var a=I("images",r,e,t),d=I("transforms",r,e,t),m=I("outputShape",r,e,t),v=I("fillValue",r,e,t),g=I("interpolation",r,e,t),y=I("fillMode",r,e,t);return[n.image.transform(a,d,g.toLowerCase(),y.toLowerCase(),v,m)]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var JFe=function(r,e,t,n){switch(n===void 0&&(n=on),r.op){case"Equal":return[n.equal(I("a",r,e,t),I("b",r,e,t))];case"NotEqual":return[n.notEqual(I("a",r,e,t),I("b",r,e,t))];case"Greater":return[n.greater(I("a",r,e,t),I("b",r,e,t))];case"GreaterEqual":return[n.greaterEqual(I("a",r,e,t),I("b",r,e,t))];case"Less":return[n.less(I("a",r,e,t),I("b",r,e,t))];case"LessEqual":return[n.lessEqual(I("a",r,e,t),I("b",r,e,t))];case"LogicalAnd":return[n.logicalAnd(I("a",r,e,t),I("b",r,e,t))];case"LogicalNot":return[n.logicalNot(I("a",r,e,t))];case"LogicalOr":return[n.logicalOr(I("a",r,e,t),I("b",r,e,t))];case"Select":case"SelectV2":return[n.where(I("condition",r,e,t),I("a",r,e,t),I("b",r,e,t))];case"BitwiseAnd":return[n.bitwiseAnd(I("a",r,e,t),I("b",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}},QFe=function(r,e,t,n){switch(n===void 0&&(n=on),r.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[n.matMul(I("a",r,e,t),I("b",r,e,t),I("transposeA",r,e,t),I("transposeB",r,e,t))];case"Einsum":return[n.einsum.apply(n,Dt([I("equation",r,e,t)],we(I("tensors",r,e,t)),!1))];case"Transpose":return[n.transpose(I("x",r,e,t),I("perm",r,e,t))];case"_FusedMatMul":var a=we(I("fusedOps",r,e,t),2),i=a[0],o=a[1],s=i==="biasadd",u=o==="prelu",c=I("numArgs",r,e,t),l=I("leakyreluAlpha",r,e,t);if(s){if(u&&c!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!u&&c!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var f=we(I("args",r,e,t),2),h=f[0],p=f[1];return[n.fused.matMul({a:I("a",r,e,t),b:I("b",r,e,t),transposeA:I("transposeA",r,e,t),transposeB:I("transposeB",r,e,t),bias:h,activation:o,preluActivationWeights:p,leakyreluAlpha:l})];case"MatrixBandPart":return[n.linalg.bandPart(I("a",r,e,t),I("numLower",r,e,t),I("numUpper",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var eRe=function(r,e,t,n){switch(n===void 0&&(n=on),r.op){case"EuclideanNorm":return[n.euclideanNorm(I("x",r,e,t),I("axis",r,e,t),I("keepDims",r,e,t))];case"FusedBatchNorm":case"FusedBatchNormV2":return[n.batchNorm(I("x",r,e,t),I("mean",r,e,t),I("variance",r,e,t),I("offset",r,e,t),I("scale",r,e,t),I("epsilon",r,e,t))];case"FusedBatchNormV3":return[n.batchNorm(I("x",r,e,t),I("mean",r,e,t),I("variance",r,e,t),I("offset",r,e,t),I("scale",r,e,t),I("epsilon",r,e,t))];case"LRN":return[n.localResponseNormalization(I("x",r,e,t),I("radius",r,e,t),I("bias",r,e,t),I("alpha",r,e,t),I("beta",r,e,t))];case"Softmax":return[n.softmax(I("x",r,e,t))];case"LogSoftmax":return[n.logSoftmax(I("x",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var tRe=function(r,e,t,n){switch(n===void 0&&(n=on),r.op){case"RaggedGather":{var a=n.raggedGather(I("paramsNestedSplits",r,e,t),I("paramsDenseValues",r,e,t),I("indices",r,e,t),I("outputRaggedRank",r,e,t)),i=a.outputNestedSplits,o=a.outputDenseValues;return i.concat(o)}case"RaggedRange":{var s=n.raggedRange(I("starts",r,e,t),I("limits",r,e,t),I("splits",r,e,t)),u=s.rtNestedSplits,c=s.rtDenseValues;return[u,c]}case"RaggedTensorToTensor":return[n.raggedTensorToTensor(I("shape",r,e,t),I("values",r,e,t),I("defaultValue",r,e,t),I("rowPartitionTensors",r,e,t),I("rowPartitionTypes",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var rRe=function(r,e,t,n){switch(n===void 0&&(n=on),r.op){case"Max":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.max(I("x",r,e,t),a,i)]}case"Mean":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.mean(I("x",r,e,t),a,i)]}case"Min":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.min(I("x",r,e,t),a,i)]}case"Sum":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.sum(I("x",r,e,t),a,i)]}case"All":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.all(I("x",r,e,t),a,i)]}case"Any":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.any(I("x",r,e,t),a,i)]}case"ArgMax":{var a=I("axis",r,e,t);return[n.argMax(I("x",r,e,t),a)]}case"ArgMin":{var a=I("axis",r,e,t);return[n.argMin(I("x",r,e,t),a)]}case"Prod":{var a=I("axis",r,e,t),i=I("keepDims",r,e,t);return[n.prod(I("x",r,e,t),a,i)]}case"Cumprod":{var a=I("axis",r,e,t),o=I("exclusive",r,e,t),s=I("reverse",r,e,t);return[n.cumprod(I("x",r,e,t),a,o,s)]}case"Cumsum":{var a=I("axis",r,e,t),o=I("exclusive",r,e,t),s=I("reverse",r,e,t);return[n.cumsum(I("x",r,e,t),a,o,s)]}case"Bincount":var u=I("x",r,e,t),c=I("weights",r,e,t),l=I("size",r,e,t);return[n.bincount(u,c,l)];case"DenseBincount":{var f=I("x",r,e,t),h=I("weights",r,e,t),p=I("size",r,e,t),d=I("binaryOutput",r,e,t);return[n.denseBincount(f,h,p,d)]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var nRe=function(r,e,t,n){switch(n===void 0&&(n=on),r.op){case"ConcatV2":case"Concat":{var a=I("n",r,e,t),i=I("axis",r,e,t),o=I("tensors",r,e,t);return o=o.slice(0,a),[n.concat(o,i)]}case"Gather":{var s=I("x",r,e,t),u=I("indices",r,e,t);return[n.gather(s,n.cast(u,"int32"),0)]}case"GatherV2":{var i=I("axis",r,e,t),c=I("batchDims",r,e,t),s=I("x",r,e,t),u=I("indices",r,e,t);return[n.gather(s,n.cast(u,"int32"),i,c)]}case"Reverse":{for(var l=I("dims",r,e,t),i=[],f=0;f<l.length;f++)l[f]&&i.push(f);var s=I("x",r,e,t);return[n.reverse(s,i)]}case"ReverseV2":{var i=I("axis",r,e,t),s=I("x",r,e,t);return[n.reverse(s,i)]}case"Slice":{var h=I("begin",r,e,t),p=I("size",r,e,t);return[n.slice(I("x",r,e,t),h,p)]}case"StridedSlice":{var h=I("begin",r,e,t),d=I("end",r,e,t),m=I("strides",r,e,t),v=I("beginMask",r,e,t),g=I("endMask",r,e,t),y=I("ellipsisMask",r,e,t),w=I("newAxisMask",r,e,t),b=I("shrinkAxisMask",r,e,t),x=I("x",r,e,t);return[n.stridedSlice(x,h,d,m,v,g,y,w,b)]}case"Pack":return Be.tidy(function(){var $=I("axis",r,e,t),z=I("tensors",r,e,t),L=z[0].shape,B=n.squeeze(z[0]).shape,W=z.map(function(X){var J=Be.util.arraysEqual(X.shape,L);if(!J&&!Be.util.arraysEqual(n.squeeze(X).shape,B))throw new Error("the input tensors shape does not match");return J?X:n.reshape(X,L)});return[n.stack(W,$)]});case"Unpack":{var i=I("axis",r,e,t),x=I("tensor",r,e,t);return n.unstack(x,i)}case"Tile":{var S=I("reps",r,e,t);return[n.tile(I("x",r,e,t),S)]}case"Split":case"SplitV":{var i=I("axis",r,e,t),T=I("numOrSizeSplits",r,e,t),x=I("x",r,e,t);return n.split(x,T,i)}case"ScatterNd":{var u=I("indices",r,e,t),E=I("values",r,e,t),C=I("shape",r,e,t);return[n.scatterND(u,E,C)]}case"GatherNd":{var R=I("x",r,e,t),u=I("indices",r,e,t);return[n.gatherND(R,u)]}case"SparseToDense":{var u=I("sparseIndices",r,e,t),C=I("outputShape",r,e,t),_=I("sparseValues",r,e,t),O=I("defaultValue",r,e,t);return[n.sparseToDense(u,_,C,_.dtype===O.dtype?O:n.cast(O,_.dtype))]}case"TensorScatterUpdate":{var u=I("indices",r,e,t),E=I("values",r,e,t),x=I("tensor",r,e,t);return[n.tensorScatterUpdate(x,u,E)]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var aRe=function(r,e,t,n){switch(n===void 0&&(n=on),r.op){case"SparseFillEmptyRows":{var a=n.sparse.sparseFillEmptyRows(I("indices",r,e,t),I("values",r,e,t),I("denseShape",r,e,t),I("defaultValue",r,e,t)),i=a.outputIndices,o=a.outputValues,s=a.emptyRowIndicator,u=a.reverseIndexMap;return[i,o,s,u]}case"SparseReshape":{var c=n.sparse.sparseReshape(I("inputIndices",r,e,t),I("inputShape",r,e,t),I("newShape",r,e,t)),i=c.outputIndices,l=c.outputShape;return[i,l]}case"SparseSegmentMean":{var f=n.sparse.sparseSegmentMean(I("data",r,e,t),I("indices",r,e,t),I("segmentIds",r,e,t));return[f]}case"SparseSegmentSum":{var f=n.sparse.sparseSegmentSum(I("data",r,e,t),I("indices",r,e,t),I("segmentIds",r,e,t));return[f]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var iRe=function(r,e,t,n){switch(n===void 0&&(n=on),r.op){case"FFT":return[n.fft(I("x",r,e,t))];case"IFFT":return[n.ifft(I("x",r,e,t))];case"RFFT":return[n.rfft(I("x",r,e,t))];case"IRFFT":return[n.irfft(I("x",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var oRe=function(r,e,t,n){switch(n===void 0&&(n=on),r.op){case"StaticRegexReplace":return[n.string.staticRegexReplace(I("input",r,e,t),I("pattern",r,e,t),I("rewrite",r,e,t),I("replaceGlobal",r,e,t))];case"StringNGrams":{var a=n.string.stringNGrams(I("data",r,e,t),I("dataSplits",r,e,t),I("separator",r,e,t),I("nGramWidths",r,e,t),I("leftPad",r,e,t),I("rightPad",r,e,t),I("padWidth",r,e,t),I("preserveShortSequences",r,e,t)),i=a.nGrams,o=a.nGramsSplits;return[i,o]}case"StringSplit":{var s=n.string.stringSplit(I("input",r,e,t),I("delimiter",r,e,t),I("skipEmpty",r,e,t)),u=s.indices,c=s.values,l=s.shape;return[u,c,l]}case"StringToHashBucketFast":{var f=n.string.stringToHashBucketFast(I("input",r,e,t),I("numBuckets",r,e,t));return[f]}default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};var sRe=function(r,e,t,n){switch(n===void 0&&(n=on),r.op){case"Cast":return[n.cast(I("x",r,e,t),I("dtype",r,e,t))];case"ExpandDims":{var a=I("axis",r,e,t);return[n.expandDims(I("x",r,e,t),a)]}case"Squeeze":{var a=I("axis",r,e,t);return[n.squeeze(I("x",r,e,t),a)]}case"Reshape":return[n.reshape(I("x",r,e,t),I("shape",r,e,t))];case"EnsureShape":return[n.ensureShape(I("x",r,e,t),I("shape",r,e,t))];case"MirrorPad":return[n.mirrorPad(I("x",r,e,t),I("padding",r,e,t),I("mode",r,e,t))];case"PadV2":case"Pad":return[n.pad(I("x",r,e,t),I("padding",r,e,t),I("constantValue",r,e,t))];case"SpaceToBatchND":{var i=I("blockShape",r,e,t),o=I("paddings",r,e,t);return[n.spaceToBatchND(I("x",r,e,t),i,o)]}case"BatchToSpaceND":{var i=I("blockShape",r,e,t),s=I("crops",r,e,t);return[n.batchToSpaceND(I("x",r,e,t),i,s)]}case"DepthToSpace":{var u=I("blockSize",r,e,t),c=I("dataFormat",r,e,t).toUpperCase();return[n.depthToSpace(I("x",r,e,t),u,c)]}case"BroadcastTo":return[n.broadcastTo(I("x",r,e,t),I("shape",r,e,t))];case"BroadcastArgs":return[n.broadcastArgs(I("s0",r,e,t),I("s1",r,e,t))];default:throw TypeError("Node type ".concat(r.op," is not implemented"))}};function AB(r,e,t,n,a){a===void 0&&(a=tB.tidy);var i=function(o,s,u){switch(o.category){case"arithmetic":return a(function(){return MFe(o,s,u)});case"basic_math":return a(function(){return BFe(o,s,u)});case"control":return VFe(o,s,u);case"convolution":return a(function(){return UFe(o,s,u)});case"creation":return a(function(){return GFe(o,s,u)});case"dynamic":return HFe(o,s,u);case"evaluation":return a(function(){return KFe(o,s,u)});case"image":return a(function(){return ZFe(o,s,u)});case"graph":return a(function(){return jFe(o,s,u)});case"logical":return a(function(){return JFe(o,s,u)});case"matrices":return a(function(){return QFe(o,s,u)});case"normalization":return a(function(){return eRe(o,s,u)});case"ragged":return a(function(){return tRe(o,s,u)});case"reduction":return a(function(){return rRe(o,s,u)});case"slice_join":return a(function(){return nRe(o,s,u)});case"sparse":return a(function(){return aRe(o,s,u)});case"spectral":return a(function(){return iRe(o,s,u)});case"string":return a(function(){return oRe(o,s,u)});case"transformation":return a(function(){return sRe(o,s,u)});case"hash_table":return YFe(o,s,u,n);case"custom":var c=OB(o.op);if(c&&c.customExecutor)return c.customExecutor(new Hke(o,s,u));throw TypeError("Custom op ".concat(o.op," is not registered."));default:throw TypeError("Unknown op '".concat(o.op,"'. File an issue at ")+"https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(r,e,t);return tB.util.isPromise(i)?i.then(function(o){return[].concat(o)}):[].concat(i)}var DB=function(){function r(e,t,n,a,i){e===void 0&&(e={}),t===void 0&&(t={}),n===void 0&&(n={}),a===void 0&&(a={}),this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=n,this.functionMap=a,this.parseNodeNameCache=i,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return r.prototype.newFrame=function(e,t){return{id:e,frameName:t,iterationId:0}},Object.defineProperty(r.prototype,"currentContext",{get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!1,configurable:!0}),r.prototype.generateCurrentContextIds=function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e},r.prototype.contextIdforContexts=function(e){return e?e.map(function(t){return t.id===0&&t.iterationId===0?"":"".concat(t.frameName,"-").concat(t.iterationId)}).join("/"):""},r.prototype.enterFrame=function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},r.prototype.exitFrame=function(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")},r.prototype.nextIteration=function(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")},r.prototype.getWeight=function(e){return this.weightMap[e]},r.prototype.addTensorArray=function(e){this.tensorArrayMap[e.id]=e},r.prototype.getTensorArray=function(e){return this.tensorArrayMap[e]},r.prototype.addTensorList=function(e){this.tensorListMap[e.id]=e},r.prototype.getTensorList=function(e){return this.tensorListMap[e]},r.prototype.dispose=function(e){for(var t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(var t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)},r}();function _B(r,e,t,n){var a=new Set,i=[],o=null,s=null,u=new Set,c=new Set(Object.keys(r).map(function(p){return ta(p)[0]}));n=n||[];for(var l=new Set(n.map(function(p){return ta(p.name)[0]})),f=Dt([],we(e),!1);f.length>0;){var h=f.pop();if((Js(h)||vRe(h)||mRe(h))&&o==null&&(o=h,s=o.children.map(function(p){return p.name}).filter(function(p){return a.has(p)})),a.add(h.name),t[h.name]==null&&!c.has(h.name)&&!l.has(h.name)){if(h.inputs.length===0){i.push(h.name);continue}h.inputs.forEach(function(p){u.has(p.name)||(u.add(p.name),f.push(p))})}}return{inputs:r,outputs:e,usedNodes:a,missingInputs:i,dynamicNode:o,syncInputs:s}}function uRe(r,e){var t,n,a,i,o,s,u=e.usedNodes,c=e.inputs,l=Object.keys(c).map(function(L){return ta(L)[0]}).map(function(L){return r.nodes[L]}),f=r.initNodes||[],h=function(L){return u.has(typeof L=="string"?L:L.name)};function p(L){return Dt([],we(new Map(L.map(function(B){return[B.name,B]})).values()),!1)}var d=p(Dt(Dt(Dt([],we(l),!1),we(r.weights),!1),we(f),!1)).filter(h),m=p(Dt(Dt([],we(d),!1),we(Object.values(r.nodes)),!1)).filter(h),v=new Map(m.map(function(L){return[L.name,L]})),g={};try{for(var y=Xr(m),w=y.next();!w.done;w=y.next()){var b=w.value;g[b.name]=g[b.name]||0;try{for(var x=(a=void 0,Xr(b.children)),S=x.next();!S.done;S=x.next()){var T=S.value;h(T)||(g[T.name]=Number.POSITIVE_INFINITY),g[T.name]=(g[T.name]||0)+1}}catch(L){a={error:L}}finally{try{S&&!S.done&&(i=x.return)&&i.call(x)}finally{if(a)throw a.error}}}}catch(L){t={error:L}}finally{try{w&&!w.done&&(n=y.return)&&n.call(y)}finally{if(t)throw t.error}}for(var E=Object.entries(g).filter(function(L){var B=we(L,2),W=B[1];return W===0}).map(function(L){var B=we(L,1),W=B[0];return W}),C=Dt([],we(E),!1);E.length>0;){var R=E.pop(),b=v.get(R);try{for(var _=(o=void 0,Xr(b.children.filter(h))),O=_.next();!O.done;O=_.next()){var T=O.value;--g[T.name]===0&&(C.push(T.name),E.push(T.name))}}catch(B){o={error:B}}finally{try{O&&!O.done&&(s=_.return)&&s.call(_)}finally{if(o)throw o.error}}}var $=C.map(function(L){return v.get(L)}),z=cRe($,d);return lRe(z,d),z}function cRe(r,e){for(var t,n,a=new Map(r.map(function(p){return[p.name,p]})),i=e.map(function(p){return p.name}),o=new Set(i);i.length>0;){var s=i.pop(),u=a.get(s);try{for(var c=(t=void 0,Xr(u.children)),l=c.next();!l.done;l=c.next()){var f=l.value;!a.has(f.name)||o.has(f.name)||(o.add(f.name),i.push(f.name))}}catch(p){t={error:p}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}}var h=r.filter(function(p){return o.has(p.name)});return h}var bv=function(r){RB(e,r);function e(t){return r.call(this,"NodesExecutionOrderError: ".concat(t))||this}return e}(Error);function lRe(r,e){var t,n,a,i,o,s,u=new Map(r.map(function(S,T){return[S.name,T]})),c=new Set(e.map(function(S){return S.name})),l=function(S){return c.has(typeof S=="string"?S:S.name)},f=new Set(r.map(function(S){return S.name})),h=function(S){return f.has(typeof S=="string"?S:S.name)};try{for(var p=Xr(r),d=p.next();!d.done;d=p.next()){var m=d.value;try{for(var v=(a=void 0,Xr(m.children.filter(h))),g=v.next();!g.done;g=v.next()){var y=g.value;if(!u.has(y.name))throw new bv("Child ".concat(y.name," of node ").concat(m.name," is unreachable."));if(u.get(m.name)>u.get(y.name))throw new bv("Node ".concat(m.name," is scheduled to run after its child ").concat(y.name,"."))}}catch(S){a={error:S}}finally{try{g&&!g.done&&(i=v.return)&&i.call(v)}finally{if(a)throw a.error}}if(!l(m))try{for(var w=(o=void 0,Xr(m.inputs)),b=w.next();!b.done;b=w.next()){var x=b.value;if(!u.has(x.name))throw new bv("Input ".concat(x.name," of node ").concat(m.name," is unreachable."));if(u.get(x.name)>u.get(m.name))throw new bv("Node ".concat(m.name," is scheduled to run before its input ").concat(x.name,"."))}}catch(S){o={error:S}}finally{try{b&&!b.done&&(s=w.return)&&s.call(w)}finally{if(o)throw o.error}}}}catch(S){t={error:S}}finally{try{d&&!d.done&&(n=p.return)&&n.call(p)}finally{if(t)throw t.error}}}function fRe(r){for(var e=new Map(r.map(function(f,h){return[f.name,h]})),t=Number.MAX_SAFE_INTEGER,n=r.map(function(f,h){return Js(f)?t:h}),a=function(f){var h=n[e.get(f.name)];return h??-1},i=r.map(function(f,h){return f.children.map(a).reduce(function(p,d){return Math.max(p,d)},n[h])}),o=new Map,s=0;s<r.length;++s){var u=i[s];if(u!==t){var c=r[s],l=r[u];o.has(l.name)||o.set(l.name,[]),o.get(l.name).push(c)}}return o}var hRe=new Set(["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"]),pRe=new Set(["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"]),dRe=new Set(["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"]);function Js(r){return hRe.has(r.op)}function vRe(r){return pRe.has(r.op)}function mRe(r){return dRe.has(r.op)}var FB=function(){function r(e,t){var n=this;this.graph=e,this.parent=t,this.compiledMap=new Map,this.parseNodeNameCache=new Map,this._weightMap={},this.SEPARATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,e.functions!=null&&Object.keys(e.functions).forEach(function(a){n._functionExecutorMap[a]=new r(e.functions[a],n)})}return Object.defineProperty(r.prototype,"weightIds",{get:function(){return this.parent?this.parent.weightIds:this._weightIds},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"functionExecutorMap",{get:function(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"weightMap",{get:function(){return this.parent?this.parent.weightMap:this._weightMap},set:function(e){var t=Object.keys(e).map(function(n){return e[n].map(function(a){return a.id})});this._weightIds=[].concat.apply([],Dt([],we(t),!1)),this._weightMap=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"resourceManager",{set:function(e){this._resourceManager=e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputs",{get:function(){return this._inputs.map(function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"outputs",{get:function(){return this._outputs.map(function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputNodes",{get:function(){return this._inputs.map(function(e){return e.signatureKey||e.name})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"outputNodes",{get:function(){return this._outputs.map(function(e){var t=e.signatureKey||e.name;return e.defaultOutput?"".concat(t,":").concat(e.defaultOutput):t})},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"functions",{get:function(){var e=this;return Object.keys(this._functions).reduce(function(t,n){return t[n]=e._functions[n].signature,t},{})},enumerable:!1,configurable:!0}),r.prototype.getCompilationKey=function(e,t){var n=e.map(function(i){return i.name}).sort(),a=t.map(function(i){return i.name}).sort();return n.join(this.SEPARATOR)+"--"+a.join(this.SEPARATOR)},r.prototype.compile=function(e,t){var n=_B(e,t,this.weightMap,this._initNodes),a=n.missingInputs,i=n.dynamicNode,o=n.syncInputs;if(i!=null)throw new Error("This execution contains the node '".concat(i.name,"', which has ")+"the dynamic op '".concat(i.op,"'. Please use ")+"model.executeAsync() instead. Alternatively, to avoid the "+"dynamic ops, specify the inputs [".concat(o,"]"));if(a.length>0){var s=t.map(function(f){return f.name}),u=Object.keys(e);throw new Error("Cannot compute the outputs [".concat(s,"] from the provided inputs ")+"[".concat(u,"]. Missing the following inputs: [").concat(a,"]"))}var c=uRe(this.graph,n),l=fRe(c);return{orderedNodes:c,nodeLiveUntilMap:l}},r.prototype.cloneAndKeepTensor=function(e){if(e==null)return null;var t=e.clone();return Be.keep(t),t},r.prototype.cloneTensorList=function(e){var t=this;if(!e)return null;var n=e.map(function(a){return t.cloneAndKeepTensor(a)});return n},r.prototype.cloneTensorMap=function(e){var t=this;return Object.fromEntries(Object.entries(e).map(function(n){var a=we(n,2),i=a[0],o=a[1];return[i,t.cloneTensorList(o)]}))},r.prototype.execute=function(e,t){var n=this;this.disposeIntermediateTensors(),e=this.mapInputs(e);var a=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var i=a.map(function(p){return n.graph.nodes[ta(p)[0]]}),o=t.map(function(p){return ta(p)[0]}),s=new Set(o),u=o.map(function(p){return n.graph.nodes[p]});u.length===0&&(u=this._outputs);var c=this.getCompilationKey(i,u),l=this.compiledMap.get(c);l==null&&(l=this.compile(e,u),this.compiledMap.set(c,l));try{this.keepIntermediateTensors=Be.env().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(p){this.keepIntermediateTensors=!1,console.warn(p.message)}var f={},h={};return Be.tidy(function(){var p,d,m=new DB(n.weightMap,f,h,n.functionExecutorMap,n.parseNodeNameCache),v=Object.assign({},n.weightMap);n.keepIntermediateTensors&&(n.clonedTensorsMap=n.cloneTensorMap(n.weightMap)),Object.keys(e).forEach(function(E){var C=we(ta(E,m),2),R=C[0],_=C[1],O=[];O[_]=e[E],v[R]=O,n.keepIntermediateTensors&&(n.clonedTensorsMap[R]=n.cloneTensorList(O))});var g=n.getFrozenTensorIds(v),y=l.orderedNodes,w=l.nodeLiveUntilMap;try{for(var b=Xr(y),x=b.next();!x.done;x=b.next()){var S=x.value;if(!v[S.name]){var T=AB(S,v,m,n._resourceManager);if(Be.util.isPromise(T))throw new Error("The execution of the op '".concat(S.op,"' returned a promise. ")+"Please use model.executeAsync() instead.");v[S.name]=T,n.keepIntermediateTensors&&(n.clonedTensorsMap[S.name]=n.cloneTensorList(T)),n.checkTensorForDisposalWithNodeLiveUntilInfo(S,v,m,g,s,w.get(S.name))}}}catch(E){p={error:E}}finally{try{x&&!x.done&&(d=b.return)&&d.call(b)}finally{if(p)throw p.error}}return n.parent==null&&m.dispose(g),t.map(function(E){return nn(E,v,m)})})},r.prototype.getFrozenTensorIds=function(e){var t=[].concat.apply([],Object.keys(e).map(function(n){return e[n]}).map(function(n){return n.map(function(a){return a.id})}));return new Set(t)},r.prototype.checkTensorForDisposal=function(e,t,n,a,i,o,s){var u,c,l,f,h,p;if(!(Js(t)||o.has(e))){try{for(var d=Xr(n[e]),m=d.next();!m.done;m=d.next()){var v=m.value;v!=null&&(s[v.id]=(s[v.id]||0)+t.children.length)}}catch(E){u={error:E}}finally{try{m&&!m.done&&(c=d.return)&&c.call(d)}finally{if(u)throw u.error}}try{for(var g=Xr(t.inputs),y=g.next();!y.done;y=g.next()){var w=y.value;if(!Js(w)){var b=nB(w.name,n,a);if(b!=null)try{for(var x=(h=void 0,Xr(b)),S=x.next();!S.done;S=x.next()){var v=S.value;if(!(!v||v.kept||i.has(v.id))){var T=s[v.id];T===1?(v.dispose(),delete s[v.id]):T!=null&&s[v.id]--}}}catch(E){h={error:E}}finally{try{S&&!S.done&&(p=x.return)&&p.call(x)}finally{if(h)throw h.error}}}}}catch(E){l={error:E}}finally{try{y&&!y.done&&(f=g.return)&&f.call(g)}finally{if(l)throw l.error}}}},r.prototype.checkTensorForDisposalWithNodeLiveUntilInfo=function(e,t,n,a,i,o){var s,u,c,l;function f(w){return Js(w)||i.has(w.name)}if(!(Js(e)||o==null))try{for(var h=Xr(o),p=h.next();!p.done;p=h.next()){var d=p.value;if(!f(d)){var m=nB(d.name,t,n);try{for(var v=(c=void 0,Xr(m)),g=v.next();!g.done;g=v.next()){var y=g.value;!y||y.kept||a.has(y.id)||y.dispose()}}catch(w){c={error:w}}finally{try{g&&!g.done&&(l=v.return)&&l.call(v)}finally{if(c)throw c.error}}}}}catch(w){s={error:w}}finally{try{p&&!p.done&&(u=h.return)&&u.call(h)}finally{if(s)throw s.error}}},r.prototype.executeAsync=function(e,t){return Pt(this,void 0,void 0,function(){return _t(this,function(n){return[2,this._executeAsync(e,t)]})})},r.prototype.disposeIntermediateTensors=function(){!this.clonedTensorsMap||(Object.values(this.clonedTensorsMap).forEach(function(e){var t,n;try{for(var a=Xr(e),i=a.next();!i.done;i=a.next()){var o=i.value;o&&!o.isDisposed&&o.dispose()}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}}),this.clonedTensorsMap=null)},r.prototype.getIntermediateTensors=function(){return this.clonedTensorsMap},r.prototype._executeAsync=function(e,t,n,a,i){return n===void 0&&(n=!1),a===void 0&&(a={}),i===void 0&&(i={}),Pt(this,void 0,void 0,function(){var o,s,u,c,l,f;return _t(this,function(h){switch(h.label){case 0:this.disposeIntermediateTensors(),n||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t));try{this.keepIntermediateTensors=Be.env().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(p){this.keepIntermediateTensors=!1,console.warn(p.message)}return o=new DB(this.weightMap,a,i,this.functionExecutorMap,this.parseNodeNameCache),this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),[4,this.executeWithControlFlow(e,o,t,n)];case 1:return s=h.sent(),u=t.map(function(p){return nn(p,s,o)}),c=u.map(function(p){return p.id}),l=Object.keys(e).map(function(p){return e[p].id}),f=new Set(Dt(Dt(Dt([],we(c),!1),we(l),!1),we(this.weightIds),!1)),Object.values(s).forEach(function(p){p.forEach(function(d){d&&!d.isDisposed&&!f.has(d.id)&&d.dispose()})}),this.parent==null&&o.dispose(f),[2,u]}})})},r.prototype.executeFunctionAsync=function(e,t,n){return Pt(this,void 0,void 0,function(){var a,i=this;return _t(this,function(o){return a=e.reduce(function(s,u,c){return s[i.inputs[c].name]=u,s},{}),[2,this._executeAsync(a,this.outputNodes,!0,t,n)]})})},r.prototype.executeWithControlFlow=function(e,t,n,a){return Pt(this,void 0,void 0,function(){var i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S,T=this;return _t(this,function(E){switch(E.label){case 0:i=Object.keys(e),o=i.map(function(C){return T.graph.nodes[ta(C)[0]]}),s=n.map(function(C){return ta(C)[0]}),u=new Set(s),c=s.map(function(C){return T.graph.nodes[C]}),c.length===0&&(c=this._outputs),l=_B(e,c,this.weightMap,this._initNodes),f=l.usedNodes,h=l.missingInputs,p=l.dynamicNode,d=l.syncInputs,m=Dt(Dt(Dt([],we(o),!1),we(this.graph.weights),!1),we(this._initNodes||[]),!1).map(function(C){return{node:C,contexts:t.currentContext}}),v=Object.assign({},this.weightMap),Object.keys(e).forEach(function(C){var R=we(ta(C),2),_=R[0],O=R[1],$=[];$[O]=e[C],v[_]=$}),g={},y=this.getFrozenTensorIds(v),w={},E.label=1;case 1:return m.length>0?(b=this.processStack(o,m,t,v,w,y,u,g,f),[4,Promise.all(b)]):[3,3];case 2:return E.sent(),[3,1];case 3:if(p==null&&!a&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),x=c.filter(function(C){return!Js(C)&&!nn(C.name,v,t)}).map(function(C){return C.name}),x.length>0)throw S="",p!=null&&(S="Alternatively, to avoid the dynamic ops, use model.execute() "+"and specify the inputs [".concat(d,"]")),new Error("Cannot compute the outputs [".concat(x,"] from the provided ")+"inputs [".concat(i,"]. Consider providing the following inputs: ")+"[".concat(h,"]. ").concat(S));return[2,v]}})})},r.prototype.processStack=function(e,t,n,a,i,o,s,u,c){for(var l=this,f=[],h=function(){var d,m,v=t.pop();n.currentContext=v.contexts;var g="";if(v.node.op==="Enter"&&I("isConstant",v.node,a,n)&&(d=we(so(v.node.name,n),1),g=d[0]),a[v.node.name]==null){var y=AB(v.node,a,n,p._resourceManager);g||(m=we(so(v.node.name,n),1),g=m[0]);var w=n.currentContext;Be.util.isPromise(y)?f.push(y.then(function(b){return a[g]=b,l.keepIntermediateTensors&&(l.clonedTensorsMap[g]=l.cloneTensorList(b)),n.currentContext=w,l.checkTensorForDisposal(g,v.node,a,n,o,s,u),l.processChildNodes(v.node,t,n,a,i,c),b})):(a[g]=y,p.keepIntermediateTensors&&(p.clonedTensorsMap[g]=p.cloneTensorList(y)),p.checkTensorForDisposal(g,v.node,a,n,o,s,u),p.processChildNodes(v.node,t,n,a,i,c))}else p.processChildNodes(v.node,t,n,a,i,c)},p=this;t.length>0;)h();return f},r.prototype.processChildNodes=function(e,t,n,a,i,o){e.children.forEach(function(s){var u=we(so(s.name,n),1),c=u[0];i[c]||!o.has(s.name)||(s.op==="Merge"?s.inputNames.some(function(l){return!!nn(l,a,n)})&&(i[c]=!0,t.push({contexts:n.currentContext,node:s})):s.inputNames.every(function(l){return!!nn(l,a,n)})&&(i[c]=!0,t.push({contexts:n.currentContext,node:s})))})},r.prototype.dispose=function(){var e=this;Object.keys(this.weightMap).forEach(function(t){return e.weightMap[t].forEach(function(n){return n.dispose()})})},r.prototype.checkInputShapeAndType=function(e){var t=this;Object.keys(e).forEach(function(n){var a=e[n],i=we(ta(n),1),o=i[0],s=t.graph.nodes[o];if(s.attrParams.shape&&s.attrParams.shape.value){var u=s.attrParams.shape.value,c=u.length===a.shape.length&&a.shape.every(function(l,f){return u[f]===-1||u[f]===l});Be.util.assert(c,function(){return"The shape of dict['".concat(s.name,"'] provided in ")+"model.execute(dict) must be [".concat(u,"], but was ")+"[".concat(a.shape,"]")})}s.attrParams.dtype&&s.attrParams.dtype.value&&Be.util.assert(a.dtype===s.attrParams.dtype.value,function(){return"The dtype of dict['".concat(s.name,"'] provided in ")+"model.execute(dict) must be "+"".concat(s.attrParams.dtype.value,", but was ").concat(a.dtype)})})},r.prototype.mapInputs=function(e){var t,n,a={};for(var i in e){var o=(n=(t=this._signature)===null||t===void 0?void 0:t.inputs)===null||n===void 0?void 0:n[i];o!=null?a[o.name]=e[i]:a[i]=e[i]}return a},r.prototype.checkInputs=function(e){var t=this,n=Object.keys(e).filter(function(a){var i=we(ta(a),1),o=i[0];return t.graph.nodes[o]==null});if(n.length>0)throw new Error("The dict provided in model.execute(dict) has "+"keys: [".concat(n,"] that are not part of graph"))},r.prototype.mapOutputs=function(e){var t=this;return e.map(function(n){var a,i,o=(i=(a=t._signature)===null||a===void 0?void 0:a.outputs)===null||i===void 0?void 0:i[n];return o!=null?o.name:n},{})},r.prototype.checkOutputs=function(e){var t=this;e.forEach(function(n){var a=we(ta(n),1),i=a[0];if(!t.graph.nodes[i])throw new Error("The output '".concat(n,"' is not found in the graph"))})},r}(),gRe=function(){function r(e,t){e===void 0&&(e={}),t===void 0&&(t={}),this.hashTableNameToHandle=e,this.hashTableMap=t}return r.prototype.addHashTable=function(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t},r.prototype.getHashTableHandleByName=function(e){return this.hashTableNameToHandle[e]},r.prototype.getHashTableById=function(e){return this.hashTableMap[e]},r.prototype.dispose=function(){for(var e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(var t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]},r}(),yRe="?tfjs-format=file",bRe="model.json",rx=function(){function r(e,t,n){t===void 0&&(t={}),n===void 0&&(n=Be.io),this.modelUrl=e,this.loadOptions=t,this.version="n/a",this.io=n,t==null&&(this.loadOptions={}),this.resourceManager=new gRe}return Object.defineProperty(r.prototype,"modelVersion",{get:function(){return this.version},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"metadata",{get:function(){return this.artifacts.userDefinedMetadata},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"modelSignature",{get:function(){return this.signature},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"modelStructuredOutputKeys",{get:function(){return this.structuredOutputKeys},enumerable:!1,configurable:!0}),r.prototype.findIOHandler=function(){var e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{var t=this.io.getLoadHandlers(e,this.loadOptions);if(t.length===0)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one (".concat(t.length,") load handlers for ")+"URL '".concat([e],"'"));this.handler=t[0]}},r.prototype.load=function(){var e=this;if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");var t=this.handler.load();return Be.util.isPromise(t)?t.then(function(n){return e.loadSync(n)}):this.loadSync(t)},r.prototype.loadSync=function(e){this.artifacts=e;var t=this.artifacts.modelTopology,n=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){var a=this.artifacts.userDefinedMetadata;a.signature!=null&&(n=a.signature),a.structuredOutputKeys!=null&&(this.structuredOutputKeys=a.structuredOutputKeys)}this.signature=n,this.version="".concat(t.versions.producer,".").concat(t.versions.minConsumer);var i=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new FB(aB.Instance.transformGraph(t,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(i),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){var o=aB.Instance.transformGraph(e.modelInitializer);this.initializer=new FB(o),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0},r.prototype.save=function(e,t){return Pt(this,void 0,void 0,function(){var n;return _t(this,function(a){if(typeof e=="string"){if(n=this.io.getSaveHandlers(e),n.length===0)throw new Error("Cannot find any save handlers for URL '".concat(e,"'"));if(n.length>1)throw new Error("Found more than one (".concat(n.length,") save handlers for ")+"URL '".concat(e,"'"));e=n[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[2,e.save(this.artifacts)]})})},r.prototype.addStructuredOutputNames=function(e){var t=this;if(this.structuredOutputKeys){var n=e instanceof Be.Tensor?[e]:e,a={};return n.forEach(function(i,o){return a[t.structuredOutputKeys[o]]=i}),a}return e},r.prototype.predict=function(e,t){var n=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(n)},r.prototype.predictAsync=function(e,t){return Pt(this,void 0,void 0,function(){var n;return _t(this,function(a){switch(a.label){case 0:return[4,this.executeAsync(e,this.outputNodes)];case 1:return n=a.sent(),[2,this.addStructuredOutputNames(n)]}})})},r.prototype.normalizeInputs=function(e){var t=this,n;if(!(e instanceof Be.Tensor)&&!Array.isArray(e)){var a=(n=this.signature)===null||n===void 0?void 0:n.inputs;if(a!=null)for(var i in a){var o=a[i];o.resourceId!=null&&(e[i]=this.resourceIdToCapturedInput[o.resourceId])}return e}e=Array.isArray(e)?e:[e];var s=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+s!==this.inputNodes.length)throw new Error("Input tensor count mismatch, the graph model has ".concat(this.inputNodes.length-s," non-resource placeholders, while there are ").concat(e.length," input tensors provided."));var u=0;return this.inputNodes.reduce(function(c,l){var f,h,p,d=(p=(h=(f=t.signature)===null||f===void 0?void 0:f.inputs)===null||h===void 0?void 0:h[l])===null||p===void 0?void 0:p.resourceId;return d!=null?c[l]=t.resourceIdToCapturedInput[d]:c[l]=e[u++],c},{})},r.prototype.normalizeOutputs=function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]},r.prototype.executeInitializerGraph=function(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))},r.prototype.executeInitializerGraphAsync=function(){return Pt(this,void 0,void 0,function(){return _t(this,function(e){return this.initializer==null?[2,[]]:this.initializerSignature==null?[2,this.initializer.executeAsync({},[])]:[2,this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))]})})},r.prototype.setResourceIdToCapturedInput=function(e){if(this.resourceIdToCapturedInput={},this.initializerSignature)for(var t=this.initializerSignature.outputs,n=Object.keys(t),a=0;a<n.length;a++){var i=n[a],o=t[i];this.resourceIdToCapturedInput[o.resourceId]=e[a]}},r.prototype.execute=function(e,t){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var n=this.executor.execute(e,t);return n.length>1?n:n[0]},r.prototype.executeAsync=function(e,t){return Pt(this,void 0,void 0,function(){var n,a;return _t(this,function(i){switch(i.label){case 0:return this.resourceIdToCapturedInput!=null?[3,2]:(n=this.setResourceIdToCapturedInput,[4,this.executeInitializerGraphAsync()]);case 1:n.apply(this,[i.sent()]),i.label=2;case 2:return e=this.normalizeInputs(e),t=this.normalizeOutputs(t),[4,this.executor.executeAsync(e,t)];case 3:return a=i.sent(),[2,a.length>1?a:a[0]]}})})},r.prototype.getIntermediateTensors=function(){return this.executor.getIntermediateTensors()},r.prototype.disposeIntermediateTensors=function(){this.executor.disposeIntermediateTensors()},r.prototype.convertTensorMapToTensorsMap=function(e){return Object.keys(e).reduce(function(t,n){return t[n]=[e[n]],t},{})},r.prototype.dispose=function(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&Be.dispose(this.resourceIdToCapturedInput)),this.resourceManager.dispose()},r}();function wRe(r,e,t){return e===void 0&&(e={}),t===void 0&&(t=Be.io),Pt(this,void 0,void 0,function(){var n;return _t(this,function(a){switch(a.label){case 0:if(r==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");return e==null&&(e={}),e.fromTFHub&&typeof r=="string"&&(r=kRe(r)),n=new rx(r,e,t),[4,n.load()];case 1:return a.sent(),[2,n]}})})}function xRe(r){if(r==null)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");var e;if(r instanceof Array){var t=we(r,2),n=t[0],a=t[1];if(!n)throw new Error("modelJSON must be the first element of the array");if(!a||!(a instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in n))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in n))throw new Error("Model JSON is missing 'weightsManifest'");var i=Be.io.getWeightSpecs(n.weightsManifest),o=Be.io.getModelArtifactsForJSONSync(n,i,a);e=Be.io.fromMemorySync(o)}else if("load"in r)e=r;else if("modelTopology"in r&&"weightSpecs"in r&&"weightData"in r)e=Be.io.fromMemorySync(r);else throw new Error("Unknown model format");var s=new rx(e);return s.load(),s}function kRe(r){return r.endsWith("/")||(r=r+"/"),"".concat(r).concat(bRe).concat(yRe)}var SRe="4.6.0";uu.GraphModel=rx;uu.deregisterOp=oke;uu.loadGraphModel=wRe;uu.loadGraphModelSync=xRe;uu.registerOp=ike;uu.version_converter=SRe});var nx=Y(()=>{});var jL=Y(()=>{});var kz=Y(sa=>{"use strict";var xr=Rs();function NRe(r){var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var hr=NRe(xr),ix=function(r,e){return ix=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},ix(r,e)};function Ft(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");ix(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Le(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(f){o(f)}}function u(l){try{c(n.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((n=n.apply(r,e||[])).next())})}function ze(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function cu(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function TRe(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function ERe(r,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}var lu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function IRe(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){if(this instanceof n){var a=[null];a.push.apply(a,arguments);var i=Function.bind.apply(e,a);return new i}return e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var a=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,a.get?a:{enumerable:!0,get:function(){return r[n]}})}),t}var JL={exports:{}};(function(r){(function(e,t,n){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(lu,r,!1)})(JL);var CRe=JL.exports,QL={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(lu,r,!1)})(QL);var ARe=QL.exports,ez={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(lu,r,!1)})(ez);var DRe=ez.exports,tz={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,p;return h=l[f],h^=h>>>7,p=h^h<<24,h=l[f+1&7],p^=h^h>>>10,h=l[f+3&7],p^=h^h>>>3,h=l[f+4&7],p^=h^h<<7,h=l[f+7&7],h=h^h<<13,p^=h^h<<9,l[f]=p,u.i=f+1&7,p};function c(l,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8?p[7]=-1:p[h],l.x=p,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(lu,r,!1)})(tz);var _Re=tz.exports,rz={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,p,d;return u.w=l=l+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(l^l>>>16)|0};function c(l,f){var h,p,d,m,v,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,m=-32;m<y;++m)f&&(p^=f.charCodeAt((m+32)%f.length)),m===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(v=v+1640531527|0,h=g[m&127]^=p+v,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,m=4*128;m>0;--m)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;l.w=v,l.X=g,l.i=d}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(lu,r,!1)})(rz);var FRe=rz.exports,nz={exports:{}};(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(lu,r,!1)})(nz);var RRe=nz.exports,az={exports:{}},ORe={},PRe={__proto__:null,default:ORe},MRe=IRe(PRe);(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),c=n.pow(2,o),l=c*2,f=a-1,h;function p(b,x,S){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(v(x.entropy?[b,w(t)]:b??y(),3),T),C=new d(T),R=function(){for(var _=C.g(i),O=u,$=0;_<c;)_=(_+$)*a,O*=a,$=C.g(1);for(;_>=l;)_/=2,O/=2,$>>>=1;return(_+$)/O};return R.int32=function(){return C.g(4)|0},R.quick=function(){return C.g(4)/4294967296},R.double=R,g(w(C.S),t),(x.pass||S||function(_,O,$,z){return z&&(z.S&&m(z,C),_.state=function(){return m(C,{})}),$?(n[s]=_,O):_})(R,E,"global"in x?x.global:this==n,x.state)}function d(b){var x,S=b.length,T=this,E=0,C=T.i=T.j=0,R=T.S=[];for(S||(b=[S++]);E<a;)R[E]=E++;for(E=0;E<a;E++)R[E]=R[C=f&C+b[E%S]+(x=R[E])],R[C]=x;(T.g=function(_){for(var O,$=0,z=T.i,L=T.j,B=T.S;_--;)O=B[z=f&z+1],$=$*a+B[f&(B[z]=B[L=f&L+O])+(B[L]=O)];return T.i=z,T.j=L,$})(a)}function m(b,x){return x.i=b.i,x.j=b.j,x.S=b.S.slice(),x}function v(b,x){var S=[],T=typeof b,E;if(x&&T=="object")for(E in b)try{S.push(v(b[E],x-1))}catch{}return S.length?S:T=="string"?b:b+"\0"}function g(b,x){for(var S=b+"",T,E=0;E<S.length;)x[f&E]=f&(T^=x[f&E]*19)+S.charCodeAt(E++);return w(x)}function y(){try{var b;return h&&(b=h.randomBytes)?b=b(a):(b=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(b)),w(b)}catch{var x=e.navigator,S=x&&x.plugins;return[+new Date,e,S,e.screen,w(t)]}}function w(b){return String.fromCharCode.apply(0,b)}if(g(n.random(),t),r.exports){r.exports=p;try{h=MRe}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:lu,[],Math)})(az);var BRe=az.exports,LRe=CRe,zRe=ARe,$Re=DRe,qRe=_Re,WRe=FRe,VRe=RRe,fu=BRe;fu.alea=LRe;fu.xor128=zRe;fu.xorwow=$Re;fu.xorshift7=qRe;fu.xor4096=WRe;fu.tychei=VRe;var iz=fu;function URe(r,e){return jv(r,e)}function jv(r,e,t,n){if(t===void 0&&(t=new Map),n===void 0&&(n=new Set),r==null)return null;if(typeof Blob=="function"&&r instanceof Blob)return r.slice();if(n.has(r))throw new Error("Circular references are not supported.");if(t.has(r))return t.get(r);var a=e(r);if(a.recurse&&a.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse)if(Fc(r)){var i=Array.isArray(r)?[]:{};n.add(r);for(var o in r){var s=r[o],u=jv(s,e,t,n);i[o]=u}return n.delete(r),r.__proto__&&(i.__proto__=r.__proto__),i}else throw new Error("Can't recurse into non-iterable type: ".concat(r));else return t.set(r,a.value),a.value}function GRe(r,e){return e===void 0&&(e=sz),oz(r,e)}function oz(r,e,t){t===void 0&&(t=new Set);var n=r[0];if(t.has(n))throw new Error("Circular references are not supported.");var a=e(r);if(a.recurse&&a.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse)if(Fc(n)){var i=Array.isArray(n)?[]:{};t.add(n);var o=function(u){var c=r.map(function(f){return f[u]}),l=oz(c,e,t);i[u]=l};for(var s in n)o(s);return t.delete(n),i}else throw new Error("Can't recurse into non-iterable type: ".concat(n));else return a.value}function sz(r){return r===null?null:Fc(r[0])?{value:null,recurse:!0}:{value:r,recurse:!1}}function uz(r,e){return Le(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f;return ze(this,function(h){switch(h.label){case 0:t=new Map,jv(r,e,t),h.label=1;case 1:h.trys.push([1,6,7,8]),n=cu(Array.from(t.keys())),a=n.next(),h.label=2;case 2:return a.done?[3,5]:(i=a.value,o=t.get(i),hr.util.isPromise(o)?[4,o]:[3,4]);case 3:s=h.sent(),t.set(i,s),h.label=4;case 4:return a=n.next(),[3,2];case 5:return[3,8];case 6:return u=h.sent(),l={error:u},[3,8];case 7:try{a&&!a.done&&(f=n.return)&&f.call(n)}finally{if(l)throw l.error}return[7];case 8:return c=jv(r,e,t),[2,c]}})})}function Fc(r){var e=!1;if(hr.env().get("IS_BROWSER"))e=r instanceof TextDecoder;else{var t=nx().StringDecoder;e=r instanceof t}return r!=null&&!ArrayBuffer.isView(r)&&(Array.isArray(r)||typeof r=="object"&&!(r instanceof hr.Tensor)&&!(r instanceof Promise)&&!e)}function HRe(r){return r==null||KRe(r)||Array.isArray(r)||typeof r=="object"&&r instanceof hr.Tensor||hr.util.isTypedArray(r)}function KRe(r){return r===null||typeof r!="object"&&typeof r!="function"}function jRe(r){return URe(r,XRe)}function XRe(r){return r instanceof hr.Tensor?{value:r.clone(),recurse:!1}:Fc(r)?{value:null,recurse:!0}:{value:r,recurse:!1}}var cz=function(){function r(e){if(this.capacity=e,this.begin=0,this.end=0,e==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}return r.prototype.wrap=function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity},r.prototype.get=function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]},r.prototype.set=function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t},r.prototype.length=function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e},r.prototype.isFull=function(){return this.length()===this.capacity},r.prototype.isEmpty=function(){return this.length()===0},r.prototype.push=function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)},r.prototype.pushAll=function(e){var t,n;try{for(var a=cu(e),i=a.next();!i.done;i=a.next()){var o=i.value;this.push(o)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},r.prototype.pop=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e},r.prototype.unshift=function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)},r.prototype.shift=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e},r.prototype.shuffleExcise=function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n},r}(),lz=function(r){Ft(e,r);function e(){return r.call(this,e.INITIAL_CAPACITY)||this}return e.prototype.isFull=function(){return!1},e.prototype.push=function(t){r.prototype.isFull.call(this)&&this.expand(),r.prototype.push.call(this,t)},e.prototype.unshift=function(t){r.prototype.isFull.call(this)&&this.expand(),r.prototype.unshift.call(this,t)},e.prototype.expand=function(){for(var t=this.capacity*2,n=new Array(t),a=this.length(),i=0;i<a;i++)n[i]=this.get(this.wrap(this.begin+i));this.data=n,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=a},e}(cz);lz.INITIAL_CAPACITY=32;function fz(r){return new JRe(r)}function ox(r){return new QRe(r)}function YRe(r,e){return new hz(r,e)}function ZRe(r,e){return e===void 0&&(e=rs.FAIL),new uOe(r,e)}var Jr=function(){function r(){}return r.prototype.toArray=function(){return Le(this,void 0,void 0,function(){var e,t;return ze(this,function(n){switch(n.label){case 0:return e=[],[4,this.next()];case 1:t=n.sent(),n.label=2;case 2:return t.done?[3,4]:(e.push(t.value),[4,this.next()]);case 3:return t=n.sent(),[3,2];case 4:return[2,e]}})})},r.prototype.toArrayForTest=function(){return Le(this,void 0,void 0,function(){var e,t,n;return ze(this,function(a){switch(a.label){case 0:return e=this.prefetch(100),t=[],[4,e.next()];case 1:n=a.sent(),a.label=2;case 2:return n.done?[3,4]:(t.push(n.value),[4,e.next()]);case 3:return n=a.sent(),[3,2];case 4:return[2,t]}})})},r.prototype.resolveFully=function(){return Le(this,void 0,void 0,function(){var e;return ze(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:e=t.sent(),t.label=2;case 2:return e.done?[3,4]:[4,this.next()];case 3:return e=t.sent(),[3,2];case 4:return[2]}})})},r.prototype.resolveWhile=function(e){return Le(this,void 0,void 0,function(){var t,n;return ze(this,function(a){switch(a.label){case 0:return[4,this.next()];case 1:t=a.sent(),n=e(t.value),a.label=2;case 2:return!t.done&&n?[4,this.next()]:[3,4];case 3:return t=a.sent(),n=e(t.value),[3,2];case 4:return[2]}})})},r.prototype.handleErrors=function(e){return new oOe(this,e)},r.prototype.filter=function(e){return new aOe(this,e)},r.prototype.map=function(e){return new iOe(this,e)},r.prototype.mapAsync=function(e){return new XL(this,e)},r.prototype.serialMapAsync=function(e){return new XL(this,e).serial()},r.prototype.flatmap=function(e){return new sOe(this,e)},r.prototype.forEachAsync=function(e){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,this.map(e).resolveFully()]})})},r.prototype.serialForEach=function(e){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,this.serialMapAsync(e).resolveWhile(function(n){return n===!0})]})})},r.prototype.rowMajorBatch=function(e,t){return t===void 0&&(t=!0),new nOe(this,e,t)},r.prototype.columnMajorBatch=function(e,t,n){t===void 0&&(t=!0),n===void 0&&(n=sz);var a=this.rowMajorBatch(e,t);return a.map(function(i){return GRe(i,n)})},r.prototype.concatenate=function(e,t){return new hz(fz([this,e]),t)},r.prototype.take=function(e){return e<0||e==null?this:new rOe(this,e)},r.prototype.skip=function(e){return e<0||e==null?this:new tOe(this,e)},r.prototype.prefetch=function(e){return new pz(this,e)},r.prototype.shuffle=function(e,t){return new cOe(this,e,t)},r.prototype.serial=function(){return new eOe(this)},r}(),JRe=function(r){Ft(e,r);function e(t){var n=r.call(this)||this;return n.items=t,n.trav=0,n}return e.prototype.summary=function(){return"Array of ".concat(this.items.length," items")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(n){return this.trav>=this.items.length?[2,{value:null,done:!0}]:(t=this.items[this.trav],this.trav++,[2,{value:jRe(t),done:!1}])})})},e}(Jr),QRe=function(r){Ft(e,r);function e(t){var n=r.call(this)||this;return n.nextFn=t,n}return e.prototype.summary=function(){return"Function call"},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){try{return[2,this.nextFn()]}catch(n){throw n.message="Error thrown while iterating through a dataset: ".concat(n.message),n}return[2]})})},e}(Jr),eOe=function(r){Ft(e,r);function e(t){var n=r.call(this)||this;return n.upstream=t,n.lastRead=Promise.resolve({value:null,done:!1}),n}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Serial")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,this.upstream.next()]})})},e}(Jr),tOe=function(r){Ft(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.maxCount=n,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Skip")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(n){switch(n.label){case 0:return this.count++<this.maxCount?[4,this.upstream.next()]:[3,2];case 1:return t=n.sent(),t.done?[2,t]:(hr.dispose(t.value),[3,0]);case 2:return[2,this.upstream.next()]}})})},e}(Jr),rOe=function(r){Ft(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.maxCount=n,a.count=0,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Take")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return this.count++>=this.maxCount?[2,{value:null,done:!0}]:[2,this.upstream.next()]})})},e}(Jr),nOe=function(r){Ft(e,r);function e(t,n,a){a===void 0&&(a=!0);var i=r.call(this)||this;return i.upstream=t,i.batchSize=n,i.enableSmallLastBatch=a,i.lastRead=Promise.resolve({value:null,done:!1}),i}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> RowMajorBatch")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t,n;return ze(this,function(a){switch(a.label){case 0:t=[],a.label=1;case 1:return t.length<this.batchSize?[4,this.upstream.next()]:[3,3];case 2:return n=a.sent(),n.done?this.enableSmallLastBatch&&t.length>0?[2,{value:t,done:!1}]:[2,{value:null,done:!0}]:(t.push(n.value),[3,1]);case 3:return[2,{value:t,done:!1}]}})})},e}(Jr),aOe=function(r){Ft(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.predicate=n,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Filter")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(n){switch(n.label){case 0:return[4,this.upstream.next()];case 1:return t=n.sent(),t.done||this.predicate(t.value)?[2,t]:(hr.dispose(t.value),[3,0]);case 2:return[2]}})})},e}(Jr),iOe=function(r){Ft(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.transform=n,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Map")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l;return ze(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:if(t=f.sent(),t.done)return[2,{value:null,done:!0}];n=hr.tensor_util.getTensorsInContainer(t.value),a=this.transform(t.value),i=hr.tensor_util.getTensorsInContainer(a);try{for(o=cu(n),s=o.next();!s.done;s=o.next())u=s.value,hr.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){c={error:h}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}return[2,{value:a,done:!1}]}})})},e}(Jr),oOe=function(r){Ft(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.handler=n,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> handleErrors")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(n){switch(n.label){case 0:n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.upstream.next()];case 2:return[2,n.sent()];case 3:return t=n.sent(),this.handler(t)?[3,4]:[2,{value:null,done:!0}];case 4:return[3,0];case 5:return[2]}})})},e}(Jr),XL=function(r){Ft(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.transform=n,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> AsyncMap")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l;return ze(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:return t=f.sent(),t.done?[2,{value:null,done:!0}]:(n=hr.tensor_util.getTensorsInContainer(t.value),[4,this.transform(t.value)]);case 2:a=f.sent(),i=hr.tensor_util.getTensorsInContainer(a);try{for(o=cu(n),s=o.next();!s.done;s=o.next())u=s.value,hr.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){c={error:h}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}return[2,{value:a,done:!1}]}})})},e}(Jr),sx=function(r){Ft(e,r);function e(){var t=r.call(this)||this;return t.outputQueue=new lz,t.lastRead=Promise.resolve({value:null,done:!1}),t}return e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){switch(t.label){case 0:return this.outputQueue.length()!==0?[3,2]:[4,this.pump()];case 1:return t.sent()?[3,0]:[2,{value:null,done:!0}];case 2:return[2,{value:this.outputQueue.shift(),done:!1}]}})})},e}(Jr),sOe=function(r){Ft(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.transform=n,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Flatmap")},e.prototype.pump=function(){return Le(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l;return ze(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:if(t=f.sent(),t.done)return[2,!1];n=hr.tensor_util.getTensorsInContainer(t.value),a=this.transform(t.value),i=hr.tensor_util.getTensorsInContainer(a),this.outputQueue.pushAll(a);try{for(o=cu(n),s=o.next();!s.done;s=o.next())u=s.value,hr.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){c={error:h}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}return[2,!0]}})})},e}(sx),hz=function(r){Ft(e,r);function e(t,n){var a=r.call(this)||this;return a.baseErrorHandler=n,a.lastRead=null,a.iterator=null,a.moreIterators=t,a}return e.prototype.summary=function(){var t="TODO: fill in upstream of chained summaries";return"".concat(t," -> Chained")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return this.lastRead=this.readFromChain(this.lastRead),[2,this.lastRead]})})},e.prototype.readFromChain=function(t){return Le(this,void 0,void 0,function(){var n,a;return ze(this,function(i){switch(i.label){case 0:return[4,t];case 1:return i.sent(),this.iterator!=null?[3,3]:[4,this.moreIterators.next()];case 2:if(n=i.sent(),n.done)return[2,{value:null,done:!0}];this.iterator=n.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler)),i.label=3;case 3:return[4,this.iterator.next()];case 4:return a=i.sent(),a.done?(this.iterator=null,[2,this.readFromChain(t)]):[2,a]}})})},e}(Jr),rs;(function(r){r[r.FAIL=0]="FAIL",r[r.SHORTEST=1]="SHORTEST",r[r.LONGEST=2]="LONGEST"})(rs||(rs={}));var uOe=function(r){Ft(e,r);function e(t,n){n===void 0&&(n=rs.FAIL);var a=r.call(this)||this;return a.iterators=t,a.mismatchMode=n,a.count=0,a.currentPromise=null,a}return e.prototype.summary=function(){var t="TODO: fill in upstream of zip summaries";return"{".concat(t,"} -> Zip")},e.prototype.nextState=function(t){return Le(this,void 0,void 0,function(){function n(s){if(s instanceof Jr){var u=s.next();return{value:u.then(function(c){return a++,c.done&&i++,c.value}),recurse:!1}}else return{value:null,recurse:!0}}var a,i,o;return ze(this,function(s){switch(s.label){case 0:return[4,t];case 1:return s.sent(),a=0,i=0,[4,uz(this.iterators,n)];case 2:if(o=s.sent(),a===i)return[2,{value:null,done:!0}];if(i>0)switch(this.mismatchMode){case rs.FAIL:throw new Error("Zipped streams should have the same length. "+"Mismatched at element ".concat(this.count,"."));case rs.SHORTEST:return[2,{value:null,done:!0}];case rs.LONGEST:}return this.count++,[2,{value:o,done:!1}]}})})},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return this.currentPromise=this.nextState(this.currentPromise),[2,this.currentPromise]})})},e}(Jr),pz=function(r){Ft(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.bufferSize=n,a.buffer=new cz(n),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Prefetch")},e.prototype.refill=function(){for(;!this.buffer.isFull();){var t=this.upstream.next();this.buffer.push(t)}},e.prototype.next=function(){return this.refill(),this.buffer.shift()},e}(Jr),cOe=function(r){Ft(e,r);function e(t,n,a){var i=r.call(this,t,n)||this;return i.upstream=t,i.windowSize=n,i.upstreamExhausted=!1,i.random=iz.alea(a||hr.util.now().toString()),i.lastRead=Promise.resolve({value:null,done:!1}),i}return e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(n){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.randomInt=function(t){return Math.floor(this.random()*t)},e.prototype.chooseIndex=function(){return this.randomInt(this.buffer.length())},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t,n;return ze(this,function(a){switch(a.label){case 0:this.upstreamExhausted||this.refill(),a.label=1;case 1:return this.buffer.isEmpty()?[3,3]:(t=this.chooseIndex(),[4,this.buffer.shuffleExcise(t)]);case 2:if(n=a.sent(),n.done)this.upstreamExhausted=!0;else return this.refill(),[2,n];return[3,1];case 3:return[2,{value:null,done:!0}]}})})},e}(pz),Rc=function(){function r(){this.size=null}return r.prototype.batch=function(e,t){var n=this;t===void 0&&(t=!0);var a=this;hr.util.assert(e>0,function(){return`batchSize needs to be positive, but it is
      `.concat(e)});var i;return this.size===1/0||this.size==null?i=this.size:t?i=Math.ceil(this.size/e):i=Math.floor(this.size/e),oa(function(){return Le(n,void 0,void 0,function(){return ze(this,function(o){switch(o.label){case 0:return[4,a.iterator()];case 1:return[2,o.sent().columnMajorBatch(e,t,hOe)]}})})},i)},r.prototype.concatenate=function(e){var t=this,n=this,a;return this.size===1/0||e.size===1/0?a=1/0:this.size!=null&&e.size!=null?a=this.size+e.size:a=null,oa(function(){return Le(t,void 0,void 0,function(){var i,o;return ze(this,function(s){switch(s.label){case 0:return[4,n.iterator()];case 1:return o=(i=s.sent()).concatenate,[4,e.iterator()];case 2:return[2,o.apply(i,[s.sent()])]}})})},a)},r.prototype.filter=function(e){var t=this,n=this,a;return this.size===1/0?a=1/0:a=null,oa(function(){return Le(t,void 0,void 0,function(){return ze(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().filter(function(o){return hr.tidy(function(){return e(o)})})]}})})},a)},r.prototype.forEachAsync=function(e){return Le(this,void 0,void 0,function(){return ze(this,function(t){switch(t.label){case 0:return[4,this.iterator()];case 1:return[2,t.sent().forEachAsync(e)]}})})},r.prototype.map=function(e){var t=this,n=this;return oa(function(){return Le(t,void 0,void 0,function(){return ze(this,function(a){switch(a.label){case 0:return[4,n.iterator()];case 1:return[2,a.sent().map(function(i){return hr.tidy(function(){return e(i)})})]}})})},this.size)},r.prototype.mapAsync=function(e){var t=this,n=this;return oa(function(){return Le(t,void 0,void 0,function(){return ze(this,function(a){switch(a.label){case 0:return[4,n.iterator()];case 1:return[2,a.sent().mapAsync(e)]}})})},this.size)},r.prototype.prefetch=function(e){var t=this;if(e==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var n=this;return oa(function(){return Le(t,void 0,void 0,function(){return ze(this,function(a){switch(a.label){case 0:return[4,n.iterator()];case 1:return[2,a.sent().prefetch(e)]}})})},this.size)},r.prototype.repeat=function(e){var t=this,n=this,a;return this.size!=null&&e>0?a=this.size*e:e===0?a=0:this.size!=null&&(e===void 0||e<0)?a=1/0:a=null,oa(function(){return Le(t,void 0,void 0,function(){var i,o=this;return ze(this,function(s){return i=ox(function(){return Le(o,void 0,void 0,function(){var u;return ze(this,function(c){switch(c.label){case 0:return u={},[4,n.iterator()];case 1:return[2,(u.value=c.sent(),u.done=!1,u)]}})})}),[2,YRe(i.take(e))]})})},a)},r.prototype.skip=function(e){var t=this,n=this,a;return this.size!=null&&e>=0&&this.size>=e?a=this.size-e:this.size!=null&&(this.size<e||e===void 0||e<0)?a=0:a=null,oa(function(){return Le(t,void 0,void 0,function(){return ze(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().skip(e)]}})})},a)},r.prototype.shuffle=function(e,t,n){var a=this;if(n===void 0&&(n=!0),e==null||e<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting "+"bufferSize to the dataset size (".concat(this.size," elements)"));var i=this,o=iz.alea(t||hr.util.now().toString());return oa(function(){return Le(a,void 0,void 0,function(){var s;return ze(this,function(u){switch(u.label){case 0:return s=o.int32(),n&&(s+=o.int32()),[4,i.iterator()];case 1:return[2,u.sent().shuffle(e,s.toString())]}})})},this.size)},r.prototype.take=function(e){var t=this,n=this,a;return this.size!=null&&this.size>e?a=e:this.size!=null&&this.size<=e?a=this.size:a=null,oa(function(){return Le(t,void 0,void 0,function(){return ze(this,function(i){switch(i.label){case 0:return[4,n.iterator()];case 1:return[2,i.sent().take(e)]}})})},a)},r.prototype.toArray=function(){return Le(this,void 0,void 0,function(){return ze(this,function(e){switch(e.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,e.sent().toArray()]}})})},r.prototype.toArrayForTest=function(){return Le(this,void 0,void 0,function(){return ze(this,function(e){switch(e.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,e.sent().toArrayForTest()]}})})},r}();Rc.MAX_BUFFER_SIZE=1e4;function oa(r,e){return e===void 0&&(e=null),new(function(t){Ft(n,t);function n(){var a=t.apply(this,ERe([],TRe(arguments),!1))||this;return a.size=e,a}return n.prototype.iterator=function(){return Le(this,void 0,void 0,function(){return ze(this,function(a){return[2,r()]})})},n}(Rc))}function lOe(r){var e=this;return oa(function(){return Le(e,void 0,void 0,function(){return ze(this,function(t){return[2,fz(r)]})})},r.length)}function fOe(r){var e=this;if(!Fc(r))throw new Error("The argument to zip() must be an object or array.");var t;if(Array.isArray(r))for(var n=0;n<r.length;n++)t=t==null?r[n].size:Math.min(t,r[n].size);else if(r instanceof Object)for(var a in r)t=t==null?r[a].size:Math.min(t,r[a].size);return oa(function(){return Le(e,void 0,void 0,function(){var i;return ze(this,function(o){switch(o.label){case 0:return[4,uz(r,function(s){if(s instanceof Rc)return{value:s.iterator(),recurse:!1};if(Fc(s))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")})];case 1:return i=o.sent(),[2,ZRe(i,rs.SHORTEST)]}})})},t)}function hOe(r){if(r===null)return null;var e=r[0];if(HRe(e)){var t=pOe(r);return{value:t,recurse:!1}}return{value:null,recurse:!0}}function pOe(r){if(r.length===0)throw new Error("Can't make a batch of zero elements.");return r[0]instanceof hr.Tensor?hr.stack(r):hr.tensor(r)}var dz=function(r){Ft(e,r);function e(t){var n=r.call(this)||this;return n.input=t,n}return e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){var t,n,a;return ze(this,function(i){switch(i.label){case 0:return[4,this.input.iterator()];case 1:return t=i.sent(),n=t.decodeUTF8(),a=n.split(`
`).map(function(o){return o.endsWith("\r")&&(o=o.slice(0,-1)),o}),[2,a]}})})},e}(Rc),Hv='"',rh=Symbol("out"),YL=Symbol("field"),Kv=Symbol("quote"),ax=Symbol("quoteafterquote"),ZL=Symbol("quoteinquote"),vz=function(r){Ft(e,r);function e(t,n){var a=r.call(this)||this;return a.input=t,a.hasHeader=!0,a.fullColumnNames=null,a.columnNamesValidated=!1,a.columnConfigs=null,a.configuredColumnsOnly=!1,a.delimiter=",",a.delimWhitespace=!1,a.base=new dz(t),n||(n={}),a.hasHeader=n.hasHeader!==!1,a.fullColumnNames=n.columnNames,a.columnConfigs=n.columnConfigs,a.configuredColumnsOnly=n.configuredColumnsOnly,n.delimWhitespace?(xr.util.assert(n.delimiter==null,function(){return"Delimiter should not be provided when delimWhitespace is true."}),a.delimWhitespace=!0,a.delimiter=" "):a.delimiter=n.delimiter?n.delimiter:",",a}return e.prototype.columnNames=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){switch(t.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:t.sent(),t.label=2;case 2:return[2,this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames]}})})},e.prototype.setColumnNames=function(){return Le(this,void 0,void 0,function(){var t,n,a,i,o,s,u,c,l,f=this;return ze(this,function(h){switch(h.label){case 0:return[4,this.maybeReadHeaderLine()];case 1:if(t=h.sent(),!this.fullColumnNames&&!t)throw new Error("Column names must be provided if there is no header line.");if(this.fullColumnNames&&t&&xr.util.assert(t.length===this.fullColumnNames.length,function(){return"The length of provided columnNames ("+f.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+")."}),this.fullColumnNames||(this.fullColumnNames=t),n=this.fullColumnNames.reduce(function(p,d){return p[d]=p[d]+1||1,p},{}),a=Object.keys(n).filter(function(p){return n[p]>1}),xr.util.assert(a.length===0,function(){return"Duplicate column names found: "+a.toString()}),this.columnConfigs)try{for(i=cu(Object.keys(this.columnConfigs)),o=i.next();!o.done;o=i.next())if(s=o.value,u=this.fullColumnNames.indexOf(s),u===-1)throw new Error('The key "'+s+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}catch(p){c={error:p}}finally{try{o&&!o.done&&(l=i.return)&&l.call(i)}finally{if(c)throw c.error}}return this.columnNamesValidated=!0,[2]}})})},e.prototype.maybeReadHeaderLine=function(){return Le(this,void 0,void 0,function(){var t,n,a,i;return ze(this,function(o){switch(o.label){case 0:return this.hasHeader?[4,this.base.iterator()]:[3,3];case 1:return t=o.sent(),[4,t.next()];case 2:if(n=o.sent(),n.done)throw new Error("No data was found for CSV parsing.");return a=n.value,i=this.parseRow(a,!1),[2,i];case 3:return[2,null]}})})},e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){var t,n=this;return ze(this,function(a){switch(a.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:a.sent(),a.label=2;case 2:return[4,this.base.iterator()];case 3:return t=a.sent(),this.hasHeader&&(t=t.skip(1)),[2,t.map(function(i){return n.makeDataElement(i)})]}})})},e.prototype.makeDataElement=function(t){for(var n=this.parseRow(t),a={},i={},o=0;o<this.fullColumnNames.length;o++){var s=this.fullColumnNames[o],u=this.columnConfigs?this.columnConfigs[s]:null;if(!(this.configuredColumnsOnly&&!u)){var c=n[o],l=null;if(c==="")if(u&&u.default!==void 0)l=u.default;else{if(u&&(u.required||u.isLabel))throw new Error("Required column ".concat(s," is empty in this line: ").concat(t));l=void 0}else{var f=Number(c);if(isNaN(f))u&&u.dtype==="bool"?l=this.getBoolean(c):l=c;else if(!u||!u.dtype)l=f;else switch(u.dtype){case"float32":l=f;break;case"int32":l=Math.floor(f);break;case"bool":l=this.getBoolean(c);break;default:l=f}}u&&u.isLabel?i[s]=l:a[s]=l}}return Object.keys(i).length===0?a:{xs:a,ys:i}},e.prototype.getBoolean=function(t){return t==="1"||t.toLowerCase()==="true"?1:0},e.prototype.parseRow=function(t,n){n===void 0&&(n=!0);for(var a=[],i=0,o=t.length,s=rh,u=0;u<o;u++)switch(s){case rh:switch(t.charAt(u)){case Hv:i=u+1,s=Kv;break;case this.delimiter:if(i=u+1,this.delimiter===" "&&this.delimWhitespace)break;a.push(""),s=rh;break;default:s=YL,i=u;break}break;case YL:switch(t.charAt(u)){case this.delimiter:a.push(t.substring(i,u)),s=rh,i=u+1;break}break;case Kv:switch(t.charAt(u)){case Hv:s=ax;break}break;case ax:switch(t.charAt(u)){case this.delimiter:a.push(t.substring(i,u-1)),s=rh,i=u+1;break;case Hv:s=Kv;break;default:s=ZL;break}break;case ZL:switch(t.charAt(u)){case Hv:s=Kv;break}break}if(s===ax?a.push(t.substring(i,o-1)):a.push(t.substring(i)),n&&a.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have ".concat(this.fullColumnNames.length," elements in a row, but got ").concat(a));return a},e}(Rc),dOe=function(r){Ft(e,r);function e(t){var n=r.call(this)||this;n.microphoneConfig=t,n.isClosed=!1,n.fftSize=t.fftSize||1024;var a=Math.log2(n.fftSize);if(n.fftSize<0||a<4||a>14||!Number.isInteger(a))throw new Error("Invalid fftSize: it must be a power of 2 between "+"2 to 4 and 2 to 14, but got ".concat(n.fftSize));if(n.numFrames=t.numFramesPerSpectrogram||43,n.sampleRateHz=t.sampleRateHz,n.columnTruncateLength=t.columnTruncateLength||n.fftSize,n.audioTrackConstraints=t.audioTrackConstraints,n.smoothingTimeConstant=t.smoothingTimeConstant||0,n.includeSpectrogram=t.includeSpectrogram!==!1,n.includeWaveform=t.includeWaveform===!0,!n.includeSpectrogram&&!n.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return n}return e.prototype.summary=function(){return"microphone"},e.create=function(t){return t===void 0&&(t={}),Le(this,void 0,void 0,function(){var n;return ze(this,function(a){switch(a.label){case 0:if(!xr.env().get("IS_BROWSER"))throw new Error("microphone API is only supported in browser environment.");return n=new e(t),[4,n.start()];case 1:return a.sent(),[2,n]}})})},e.prototype.start=function(){return Le(this,void 0,void 0,function(){var t,n,a,i;return ze(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),t=this,[4,navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null?!0:this.audioTrackConstraints,video:!1})];case 1:return t.stream=o.sent(),[3,3];case 2:throw n=o.sent(),new Error("Error thrown while initializing video stream: ".concat(n.message));case 3:if(!this.stream)throw new Error("Could not obtain audio from microphone.");if(a=window.AudioContext||window.webkitAudioContext,this.audioContext=new a,!this.sampleRateHz)this.sampleRateHz=this.audioContext.sampleRate;else if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error("Mismatch in sampling rate: "+"Expected: ".concat(this.sampleRateHz,"; ")+"Actual: ".concat(this.audioContext.sampleRate));return i=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.fftSize*2,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,i.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize),[2]}})})},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,n,a,i,o;return ze(this,function(s){switch(s.label){case 0:return this.isClosed?[2,{value:null,done:!0}]:[4,this.getAudioData()];case 1:return a=s.sent(),this.includeSpectrogram&&(i=this.flattenQueue(a.freqDataQueue),t=this.getTensorFromAudioDataArray(i,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(o=this.flattenQueue(a.timeDataQueue),n=this.getTensorFromAudioDataArray(o,[this.numFrames*this.fftSize,1])),[2,{value:{spectrogram:t,waveform:n},done:!1}]}})})},e.prototype.capture=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:return[2,t.sent().value]}})})},e.prototype.getAudioData=function(){return Le(this,void 0,void 0,function(){var t,n,a,i=this;return ze(this,function(o){return t=[],n=[],a=0,[2,new Promise(function(s){var u=setInterval(function(){i.includeSpectrogram&&(i.analyser.getFloatFrequencyData(i.freqData),i.freqData[0]===-1/0&&s({freqDataQueue:t,timeDataQueue:n}),t.push(i.freqData.slice(0,i.columnTruncateLength))),i.includeWaveform&&(i.analyser.getFloatTimeDomainData(i.timeData),n.push(i.timeData.slice())),++a===i.numFrames&&(clearInterval(u),s({freqDataQueue:t,timeDataQueue:n}))},i.fftSize/i.sampleRateHz*1e3)})]})})},e.prototype.stop=function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())},e.prototype.toArray=function(){throw new Error("Can not convert infinite audio stream to array.")},e.prototype.getSampleRate=function(){return this.sampleRateHz},e.prototype.flattenQueue=function(t){var n=t[0].length,a=new Float32Array(t.length*n);return t.forEach(function(i,o){return a.set(i,o*n)}),a},e.prototype.getTensorFromAudioDataArray=function(t,n){var a=new Float32Array(xr.util.sizeFromShape(n));return a.set(t,a.length-t.length),xr.tensor(a,n)},e}(Jr),vOe=function(r){Ft(e,r);function e(t,n){var a=r.call(this)||this;if(a.webcamVideoElement=t,a.webcamConfig=n,a.isClosed=!0,a.resize=!1,a.needToResize())if(a.resize=!0,a.cropSize=[a.webcamConfig.resizeHeight,a.webcamConfig.resizeWidth],a.cropBoxInd=xr.tensor1d([0],"int32"),a.webcamConfig.centerCrop){var i=a.webcamConfig.resizeWidth*1/a.webcamVideoElement.width,o=a.webcamConfig.resizeHeight*1/a.webcamVideoElement.height,s=(1-i)/2,u=(1-o)/2,c=s+i,l=o+u;a.cropBox=xr.tensor2d([u,s,l,c],[1,4])}else a.cropBox=xr.tensor2d([0,0,1,1],[1,4]);return a}return e.prototype.summary=function(){return"webcam"},e.create=function(t,n){return n===void 0&&(n={}),Le(this,void 0,void 0,function(){var a;return ze(this,function(i){switch(i.label){case 0:if(!xr.env().get("IS_BROWSER"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!t){if(t=document.createElement("video"),!n.resizeWidth||!n.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");t.width=n.resizeWidth,t.height=n.resizeHeight}return a=new e(t,n),[4,a.start()];case 1:return i.sent(),[2,a]}})})},e.prototype.start=function(){return Le(this,void 0,void 0,function(){var t,n,a=this;return ze(this,function(i){switch(i.label){case 0:this.webcamConfig.facingMode&&xr.util.assert(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",function(){return"Invalid webcam facing mode: ".concat(a.webcamConfig.facingMode,". ")+"Please provide 'user' or 'environment'"}),i.label=1;case 1:return i.trys.push([1,3,,4]),t=this,[4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})];case 2:return t.stream=i.sent(),[3,4];case 3:throw n=i.sent(),n.message="Error thrown while initializing video stream: ".concat(n.message),n;case 4:if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(o){console.log(o),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,[2,new Promise(function(o){a.webcamVideoElement.onloadedmetadata=function(){o()}})]}})})},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(n){if(this.isClosed)return[2,{value:null,done:!0}];try{t=xr.browser.fromPixels(this.webcamVideoElement)}catch(a){throw new Error("Error thrown converting video to pixels: ".concat(JSON.stringify(a)))}if(this.resize)try{return[2,{value:this.cropAndResizeFrame(t),done:!1}]}catch(a){throw new Error("Error thrown cropping the video: ".concat(a.message))}finally{t.dispose()}else return[2,{value:t,done:!1}];return[2]})})},e.prototype.needToResize=function(){return!!(this.webcamConfig.resizeWidth&&this.webcamConfig.resizeHeight&&(this.webcamVideoElement.width!==this.webcamConfig.resizeWidth||this.webcamVideoElement.height!==this.webcamConfig.resizeHeight))},e.prototype.cropAndResizeFrame=function(t){var n=this;return xr.tidy(function(){var a=xr.expandDims(xr.cast(t,"float32"),0),i;i=xr.image.cropAndResize(a,n.cropBox,n.cropBoxInd,n.cropSize,"bilinear");var o=i.shape;return xr.reshape(i,o.slice(1))})},e.prototype.capture=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:return[2,t.sent().value]}})})},e.prototype.stop=function(){var t=this.stream.getTracks();t.forEach(function(n){return n.stop()});try{this.webcamVideoElement.srcObject=null}catch(n){console.log(n),this.webcamVideoElement.src=null}this.isClosed=!0},e.prototype.toArray=function(){throw new Error("Can not convert infinite video stream to array.")},e}(Jr);var mz=function(){function r(){}return r}(),gz=function(r){Ft(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.split=function(t){return new mOe(this,t)},e}(Jr),mOe=function(r){Ft(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.impl=new gOe(t,n),a}return e.prototype.summary=function(){return this.impl.summary()},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,this.impl.next()]})})},e}(gz),gOe=function(r){Ft(e,r);function e(t,n){var a=r.call(this)||this;return a.upstream=t,a.separator=n,a.carryover="",a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Split('").concat(this.separator,"')")},e.prototype.pump=function(){return Le(this,void 0,void 0,function(){var t,n,a,i,o,s,u;return ze(this,function(c){switch(c.label){case 0:return[4,this.upstream.next()];case 1:if(t=c.sent(),t.done)return this.carryover===""?[2,!1]:(this.outputQueue.push(this.carryover),this.carryover="",[2,!0]);n=t.value.split(this.separator),n[0]=this.carryover+n[0];try{for(a=cu(n.slice(0,-1)),i=a.next();!i.done;i=a.next())o=i.value,this.outputQueue.push(o)}catch(l){s={error:l}}finally{try{i&&!i.done&&(u=a.return)&&u.call(a)}finally{if(s)throw s.error}}return this.carryover=n[n.length-1],[2,!0]}})})},e}(sx),yOe=function(r){Ft(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.decodeUTF8=function(){return new bOe(this)},e}(Jr),bOe=function(r){Ft(e,r);function e(t){var n=r.call(this)||this;return n.upstream=t,n.impl=new wOe(t),n}return e.prototype.summary=function(){return this.impl.summary()},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,this.impl.next()]})})},e}(gz),wOe=function(r){Ft(e,r);function e(t){var n=r.call(this)||this;if(n.upstream=t,xr.env().get("IS_BROWSER"))n.decoder=new TextDecoder("utf-8");else{var a=nx().StringDecoder;n.decoder=new a("utf8")}return n}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Utf8")},e.prototype.pump=function(){return Le(this,void 0,void 0,function(){var t,n,a;return ze(this,function(i){switch(i.label){case 0:return[4,this.upstream.next()];case 1:return t=i.sent(),t.done?[2,!1]:(n=t.value,xr.env().get("IS_BROWSER")?a=this.decoder.decode(n,{stream:!0}):a=this.decoder.write(Buffer.from(n.buffer)),this.outputQueue.push(a),[2,!0])}})})},e}(sx),yz=function(r){Ft(e,r);function e(t,n){n===void 0&&(n={});var a=r.call(this)||this;return a.file=t,a.options=n,xr.util.assert(t instanceof Uint8Array||(xr.env().get("IS_BROWSER")?t instanceof File||t instanceof Blob:!1),function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."}),a.offset=n.offset||0,a.chunkSize=n.chunkSize||1024*1024,a}return e.prototype.summary=function(){return"FileChunks ".concat(this.file)},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,n,a=this;return ze(this,function(i){switch(i.label){case 0:return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?[2,{value:null,done:!0}]:(t=new Promise(function(o,s){var u=a.offset+a.chunkSize;if(a.file instanceof Uint8Array)o(new Uint8Array(a.file.slice(a.offset,u)));else{var c=new FileReader;c.onload=function(f){var h=c.result;if(h instanceof ArrayBuffer&&(h=new Uint8Array(h)),!(h instanceof Uint8Array))return s(new TypeError("FileReader returned unknown type."));o(h)},c.onabort=function(f){return s(new Error("Aborted"))},c.onerror=function(f){return s(new Error(f.type))};var l=a.file.slice(a.offset,u);c.readAsArrayBuffer(l)}a.offset=u}),n={},[4,t]);case 1:return[2,(n.value=i.sent(),n.done=!1,n)]}})})},e}(yOe);function xOe(r,e,t){return e===void 0&&(e={}),Le(this,void 0,void 0,function(){var n,a,i,o,s;return ze(this,function(u){switch(u.label){case 0:return typeof r=="string"?n=r:(n=r.url,a=kOe(r)),[4,(t||xr.util.fetch)(n,a)];case 1:return i=u.sent(),i.ok?(s=Uint8Array.bind,[4,i.arrayBuffer()]):[3,3];case 2:return o=new(s.apply(Uint8Array,[void 0,u.sent()])),[2,new yz(o,e)];case 3:throw new Error(i.statusText)}})})}var kOe=function(r){var e={method:r.method,headers:r.headers,body:r.body,mode:r.mode,credentials:r.credentials,cache:r.cache,redirect:r.redirect,referrer:r.referrer,integrity:r.integrity};return e};function bz(r){return typeof r=="string"&&r.slice(0,7)==="file://"}var wz=function(r){Ft(e,r);function e(t,n){n===void 0&&(n={});var a=r.call(this)||this;return a.input=t,a.options=n,a}return e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(n){return bz(this.input)&&xr.env().get("IS_NODE")&&(t=jL(),this.input=t.readFileSync(this.input.slice(7))),[2,new yz(this.input,this.options)]})})},e}(mz),xz=function(r){Ft(e,r);function e(t,n){n===void 0&&(n={});var a=r.call(this)||this;return a.url=t,a.fileOptions=n,a}return e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return bz(this.url)?[2,new wz(this.url,this.fileOptions).iterator()]:[2,xOe(this.url,this.fileOptions)]})})},e}(mz);function SOe(r,e){return e===void 0&&(e={}),new vz(new xz(r),e)}function NOe(r){var e=this,t=ox(r);return oa(function(){return Le(e,void 0,void 0,function(){return ze(this,function(n){return[2,t]})})})}function TOe(r){var e=this;return oa(function(){return Le(e,void 0,void 0,function(){var t;return ze(this,function(n){switch(n.label){case 0:return[4,r()];case 1:return t=n.sent(),[2,ox(function(){return t.next()})]}})})})}function EOe(r,e){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,vOe.create(r,e)]})})}function IOe(r){return Le(this,void 0,void 0,function(){return ze(this,function(e){return[2,dOe.create(r)]})})}var COe="4.6.0";sa.CSVDataset=vz;sa.Dataset=Rc;sa.FileDataSource=wz;sa.TextLineDataset=dz;sa.URLDataSource=xz;sa.array=lOe;sa.csv=SOe;sa.func=NOe;sa.generator=TOe;sa.microphone=IOe;sa.version_data=COe;sa.webcam=EOe;sa.zip=fOe});var Nz=Y((Sz,ux)=>{(function(r,e,t){function n(s){var u=this,c=o();u.next=function(){var l=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=l-(u.c=l|0)},u.c=1,u.s0=c(" "),u.s1=c(" "),u.s2=c(" "),u.s0-=c(s),u.s0<0&&(u.s0+=1),u.s1-=c(s),u.s1<0&&(u.s1+=1),u.s2-=c(s),u.s2<0&&(u.s2+=1),c=null}function a(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function i(s,u){var c=new n(s),l=u&&u.state,f=c.next;return f.int32=function(){return c.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,l&&(typeof l=="object"&&a(l,c),f.state=function(){return a(c,{})}),f}function o(){var s=4022871197,u=function(c){c=String(c);for(var l=0;l<c.length;l++){s+=c.charCodeAt(l);var f=.02519603282416938*s;s=f>>>0,f-=s,f*=s,s=f>>>0,f-=s,s+=f*4294967296}return(s>>>0)*23283064365386963e-26};return u}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.alea=i})(Sz,typeof ux=="object"&&ux,typeof define=="function"&&define)});var Ez=Y((Tz,cx)=>{(function(r,e,t){function n(o){var s=this,u="";s.x=0,s.y=0,s.z=0,s.w=0,s.next=function(){var l=s.x^s.x<<11;return s.x=s.y,s.y=s.z,s.z=s.w,s.w^=s.w>>>19^l^l>>>8},o===(o|0)?s.x=o:u+=o;for(var c=0;c<u.length+64;c++)s.x^=u.charCodeAt(c)|0,s.next()}function a(o,s){return s.x=o.x,s.y=o.y,s.z=o.z,s.w=o.w,s}function i(o,s){var u=new n(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},l.int32=u.next,l.quick=l,c&&(typeof c=="object"&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xor128=i})(Tz,typeof cx=="object"&&cx,typeof define=="function"&&define)});var Cz=Y((Iz,lx)=>{(function(r,e,t){function n(o){var s=this,u="";s.next=function(){var l=s.x^s.x>>>2;return s.x=s.y,s.y=s.z,s.z=s.w,s.w=s.v,(s.d=s.d+362437|0)+(s.v=s.v^s.v<<4^(l^l<<1))|0},s.x=0,s.y=0,s.z=0,s.w=0,s.v=0,o===(o|0)?s.x=o:u+=o;for(var c=0;c<u.length+64;c++)s.x^=u.charCodeAt(c)|0,c==u.length&&(s.d=s.x<<10^s.x>>>4),s.next()}function a(o,s){return s.x=o.x,s.y=o.y,s.z=o.z,s.w=o.w,s.v=o.v,s.d=o.d,s}function i(o,s){var u=new n(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},l.int32=u.next,l.quick=l,c&&(typeof c=="object"&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xorwow=i})(Iz,typeof lx=="object"&&lx,typeof define=="function"&&define)});var Dz=Y((Az,fx)=>{(function(r,e,t){function n(o){var s=this;s.next=function(){var c=s.x,l=s.i,f,h,p;return f=c[l],f^=f>>>7,h=f^f<<24,f=c[l+1&7],h^=f^f>>>10,f=c[l+3&7],h^=f^f>>>3,f=c[l+4&7],h^=f^f<<7,f=c[l+7&7],f=f^f<<13,h^=f^f<<9,c[l]=h,s.i=l+1&7,h};function u(c,l){var f,h,p=[];if(l===(l|0))h=p[0]=l;else for(l=""+l,f=0;f<l.length;++f)p[f&7]=p[f&7]<<15^l.charCodeAt(f)+p[f+1&7]<<13;for(;p.length<8;)p.push(0);for(f=0;f<8&&p[f]===0;++f);for(f==8?h=p[7]=-1:h=p[f],c.x=p,c.i=0,f=256;f>0;--f)c.next()}u(s,o)}function a(o,s){return s.x=o.x.slice(),s.i=o.i,s}function i(o,s){o==null&&(o=+new Date);var u=new n(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},l.int32=u.next,l.quick=l,c&&(c.x&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xorshift7=i})(Az,typeof fx=="object"&&fx,typeof define=="function"&&define)});var Fz=Y((_z,hx)=>{(function(r,e,t){function n(o){var s=this;s.next=function(){var c=s.w,l=s.X,f=s.i,h,p;return s.w=c=c+1640531527|0,p=l[f+34&127],h=l[f=f+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,p=l[f]=p^h,s.i=f,p+(c^c>>>16)|0};function u(c,l){var f,h,p,d,m,v=[],g=128;for(l===(l|0)?(h=l,l=null):(l=l+"\0",h=0,g=Math.max(g,l.length)),p=0,d=-32;d<g;++d)l&&(h^=l.charCodeAt((d+32)%l.length)),d===0&&(m=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,d>=0&&(m=m+1640531527|0,f=v[d&127]^=h+m,p=f==0?p+1:0);for(p>=128&&(v[(l&&l.length||0)&127]=-1),p=127,d=4*128;d>0;--d)h=v[p+34&127],f=v[p=p+1&127],h^=h<<13,f^=f<<17,h^=h>>>15,f^=f>>>12,v[p]=h^f;c.w=m,c.X=v,c.i=p}u(s,o)}function a(o,s){return s.i=o.i,s.w=o.w,s.X=o.X.slice(),s}function i(o,s){o==null&&(o=+new Date);var u=new n(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},l.int32=u.next,l.quick=l,c&&(c.X&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xor4096=i})(_z,typeof hx=="object"&&hx,typeof define=="function"&&define)});var Oz=Y((Rz,px)=>{(function(r,e,t){function n(o){var s=this,u="";s.next=function(){var l=s.b,f=s.c,h=s.d,p=s.a;return l=l<<25^l>>>7^f,f=f-h|0,h=h<<24^h>>>8^p,p=p-l|0,s.b=l=l<<20^l>>>12^f,s.c=f=f-h|0,s.d=h<<16^f>>>16^p,s.a=p-l|0},s.a=0,s.b=0,s.c=-1640531527,s.d=1367130551,o===Math.floor(o)?(s.a=o/4294967296|0,s.b=o|0):u+=o;for(var c=0;c<u.length+20;c++)s.b^=u.charCodeAt(c)|0,s.next()}function a(o,s){return s.a=o.a,s.b=o.b,s.c=o.c,s.d=o.d,s}function i(o,s){var u=new n(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},l.int32=u.next,l.quick=l,c&&(typeof c=="object"&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.tychei=i})(Rz,typeof px=="object"&&px,typeof define=="function"&&define)});var Mz=Y((Pz,Xv)=>{(function(r,e,t){var n=256,a=6,i=52,o="random",s=t.pow(n,a),u=t.pow(2,i),c=u*2,l=n-1,f;function h(w,b,x){var S=[];b=b==!0?{entropy:!0}:b||{};var T=v(m(b.entropy?[w,y(e)]:w??g(),3),S),E=new p(S),C=function(){for(var R=E.g(a),_=s,O=0;R<u;)R=(R+O)*n,_*=n,O=E.g(1);for(;R>=c;)R/=2,_/=2,O>>>=1;return(R+O)/_};return C.int32=function(){return E.g(4)|0},C.quick=function(){return E.g(4)/4294967296},C.double=C,v(y(E.S),e),(b.pass||x||function(R,_,O,$){return $&&($.S&&d($,E),R.state=function(){return d(E,{})}),O?(t[o]=R,_):R})(C,T,"global"in b?b.global:this==t,b.state)}function p(w){var b,x=w.length,S=this,T=0,E=S.i=S.j=0,C=S.S=[];for(x||(w=[x++]);T<n;)C[T]=T++;for(T=0;T<n;T++)C[T]=C[E=l&E+w[T%x]+(b=C[T])],C[E]=b;(S.g=function(R){for(var _,O=0,$=S.i,z=S.j,L=S.S;R--;)_=L[$=l&$+1],O=O*n+L[l&(L[$]=L[z=l&z+_])+(L[z]=_)];return S.i=$,S.j=z,O})(n)}function d(w,b){return b.i=w.i,b.j=w.j,b.S=w.S.slice(),b}function m(w,b){var x=[],S=typeof w,T;if(b&&S=="object")for(T in w)try{x.push(m(w[T],b-1))}catch{}return x.length?x:S=="string"?w:w+"\0"}function v(w,b){for(var x=w+"",S,T=0;T<x.length;)b[l&T]=l&(S^=b[l&T]*19)+x.charCodeAt(T++);return y(b)}function g(){try{var w;return f&&(w=f.randomBytes)?w=w(n):(w=new Uint8Array(n),(r.crypto||r.msCrypto).getRandomValues(w)),y(w)}catch{var b=r.navigator,x=b&&b.plugins;return[+new Date,r,x,r.screen,y(e)]}}function y(w){return String.fromCharCode.apply(0,w)}if(v(t.random(),e),typeof Xv=="object"&&Xv.exports){Xv.exports=h;try{f=Fp()}catch{}}else typeof define=="function"&&define.amd?define(function(){return h}):t["seed"+o]=h})(typeof self<"u"?self:Pz,[],Math)});var Lz=Y((act,Bz)=>{var AOe=Nz(),DOe=Ez(),_Oe=Cz(),FOe=Dz(),ROe=Fz(),OOe=Oz(),hu=Mz();hu.alea=AOe;hu.xor128=DOe;hu.xorwow=_Oe;hu.xorshift7=FOe;hu.xor4096=ROe;hu.tychei=OOe;Bz.exports=hu});var iq=Y(tm=>{"use strict";var N=Rs(),POe=Lz();function MOe(r){var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var BOe=MOe(POe),vx=function(r,e){return vx=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},vx(r,e)};function LOe(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");vx(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function zz(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(f){o(f)}}function u(l){try{c(n.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((n=n.apply(r,e||[])).next())})}function $z(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Pc(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function We(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function wa(r,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}function Ue(r,e){Array.isArray(r)||(r=[r]),r.forEach(function(t){t!=null&&N.util.assert(t.dtype!=="complex64",function(){return"".concat(e," does not support complex64 tensors in the CPU backend.")})})}var zOe=N.kernel_impls.whereImpl,yx=function(r){LOe(e,r);function e(){var t=r.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new N.DataStorage(t,N.engine()),t}return e.prototype.nextDataId=function(){return e.nextDataId++},e.prototype.write=function(t,n,a){this.firstUse&&(this.firstUse=!1,N.env().get("IS_NODE")&&N.backend_util.warn(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));var i={id:this.nextDataId()};return this.data.set(i,{values:t,dtype:a,refCount:1}),i},e.prototype.makeTensorInfo=function(t,n,a){var i;if(n==="string"&&a!=null&&a.length>0&&N.util.isString(a[0])){var o=a.map(function(s){return N.util.encodeString(s)});i=this.write(o,t,n)}else i=this.write(a,t,n);return{dataId:i,shape:t,dtype:n}},e.prototype.refCount=function(t){if(this.data.has(t)){var n=this.data.get(t);return n.refCount}return 0},e.prototype.incRef=function(t){var n=this.data.get(t);n.refCount++},e.prototype.decRef=function(t){if(this.data.has(t)){var n=this.data.get(t);n.refCount--}},e.prototype.move=function(t,n,a,i,o){this.data.set(t,{values:n,dtype:i,refCount:o})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return zz(this,void 0,void 0,function(){return $z(this,function(n){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var n=this.data.get(t),a=n.dtype,i=n.complexTensorInfos;if(a==="complex64"){var o=this.readSync(i.real.dataId),s=this.readSync(i.imag.dataId);return N.backend_util.mergeRealAndImagArrays(o,s)}return N.util.convertBackendValuesAndArrayBuffer(this.data.get(t).values,a)},e.prototype.bufferSync=function(t){var n=this.readSync(t.dataId);if(t.dtype==="string")try{var a=n.map(function(i){return N.util.decodeString(i)});return N.buffer(t.shape,t.dtype,a)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return N.buffer(t.shape,t.dtype,n)},e.prototype.makeOutput=function(t,n,a){return N.engine().makeTensorFromTensorInfo(this.makeTensorInfo(n,a,t),this)},e.prototype.disposeData=function(t,n){if(n===void 0&&(n=!1),this.data.has(t)){if(this.data.get(t).refCount--,!n&&this.data.get(t).refCount>0)return!1;var a=this.data.get(t).complexTensorInfos;a!=null&&(this.disposeData(a.real.dataId,!0),this.disposeData(a.imag.dataId,!0)),this.data.delete(t)}return!0},e.prototype.disposeIntermediateTensorInfo=function(t){this.disposeData(t.dataId)},e.prototype.time=function(t){return zz(this,void 0,void 0,function(){var n,a;return $z(this,function(i){return n=N.util.now(),t(),a=N.util.now()-n,[2,{kernelMs:a}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.where=function(t){Ue([t],"where");var n=this.readSync(t.dataId);return zOe(t.shape,n)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return r.prototype.epsilon.call(this)},e}(N.KernelBackend);yx.nextDataId=0;function Xz(r){for(var e=new Float32Array(r.length),t=0;t<r.length;++t)e[t]=Math.abs(r[t]);return e}var $Oe=function(r){var e=r.inputs.x,t=r.backend;Ue(e,"abs");var n=new Float32Array(N.util.sizeFromShape(e.shape)),a=t.data.get(e.dataId).values;return n=Xz(a),t.makeOutput(n,e.shape,e.dtype)},qOe={kernelName:N.Abs,backendName:"cpu",kernelFunc:$Oe};function Fr(r){return function(e,t,n,a,i){var o=N.backend_util.assertAndGetBroadcastShape(e,t),s=o.length,u=N.util.computeStrides(o),c=N.util.sizeFromShape(o),l=N.util.getTypedArrayFromDType(i,c),f=e.length,h=t.length,p=N.util.computeStrides(e),d=N.util.computeStrides(t),m=N.backend_util.getBroadcastDims(e,o),v=N.backend_util.getBroadcastDims(t,o);if(m.length+v.length===0)for(var g=0;g<l.length;++g)l[g]=r(n[g%n.length],a[g%a.length]);else for(var y=function(w){var b=N.util.indexToLoc(w,s,u),x=b.slice(-f);m.forEach(function(C){return x[C]=0});var S=N.util.locToIndex(x,f,p),T=b.slice(-h);v.forEach(function(C){return T[C]=0});var E=N.util.locToIndex(T,h,d);l[w]=r(n[S],a[E])},g=0;g<l.length;++g)y(g);return[l,o]}}function ua(r){var e=r.inputs,t=r.backend,n=e.real,a=e.imag,i=t.data.get(n.dataId).values,o=t.data.get(a.dataId).values,s=t.makeTensorInfo(n.shape,"complex64"),u=t.data.get(s.dataId);return u.complexTensorInfos={real:t.makeTensorInfo(n.shape,"float32",i),imag:t.makeTensorInfo(a.shape,"float32",o)},s}var WOe={kernelName:N.Complex,backendName:"cpu",kernelFunc:ua};function Yv(r,e,t){if(t===void 0&&(t="float32"),t==="complex64"){var n=Yv(r,e,"float32"),a=Yv(r,e,"float32");return ua({inputs:{real:n,imag:a},backend:r})}var i=N.util.makeZerosTypedArray(N.util.sizeFromShape(e),t);return r.makeTensorInfo(e,t,i)}function zi(r){var e=r.inputs,t=r.backend,n=e.x;return t.incRef(n.dataId),{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}var VOe={kernelName:N.Identity,backendName:"cpu",kernelFunc:zi};function du(r){var e=r.inputs,t=r.backend,n=e.input,a=t.data.get(n.dataId).complexTensorInfos.real,i=t.data.get(a.dataId).values;return t.makeTensorInfo(a.shape,a.dtype,i)}var UOe={kernelName:N.Real,backendName:"cpu",kernelFunc:du};function Yz(r,e,t,n){if(n==="int32"){var a=Int32Array.from(r);return[e,"int32",a]}if(n==="bool"){var i=N.util.toTypedArray([0],t),o=We(Fr(function(c,l){return c!==l?1:0})(e,[],r,i,"bool"),2),s=o[0],u=o[1];return[u,"bool",s]}throw new Error("Error in Cast: failed to cast ".concat(t," to ").concat(n))}function ns(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.dtype;if(i==="complex64"){if(a.dtype==="complex64")return zi({inputs:{x:a},backend:t});var o=Yv(t,a.shape,a.dtype),s=ns({inputs:{x:a},backend:t,attrs:{dtype:"float32"}}),u=ua({inputs:{real:s,imag:o},backend:t});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}if(a.dtype==="complex64"){var c=du({inputs:{input:a},backend:t}),u=ns({inputs:{x:c},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(c),u}if(!N.util.hasEncodingLoss(a.dtype,i)){var u=zi({inputs:{x:a},backend:t});return{dataId:u.dataId,shape:u.shape,dtype:i}}var l=t.data.get(a.dataId).values,f=We(Yz(l,a.shape,a.dtype,i),3),h=f[0],p=f[1],d=f[2];return t.makeTensorInfo(h,p,d)}var GOe={kernelName:N.Cast,backendName:"cpu",kernelFunc:ns};function Vr(r,e,t,n){return t==null?function(a){var i=a.inputs,o=a.backend,s=i.a,u=i.b,c=o;Ue([s,u],r);var l=c.data.get(s.dataId).values,f=c.data.get(u.dataId).values,h=s.dtype==="string"?N.backend_util.fromUint8ToStringArray(l):l,p=s.dtype==="string"?N.backend_util.fromUint8ToStringArray(f):f,d=n||s.dtype,m=We(e(s.shape,u.shape,h,p,d),2),v=m[0],g=m[1];return c.makeTensorInfo(g,d,v)}:function(a){var i=a.inputs,o=a.backend,s=i.a,u=i.b,c=o;if(s.dtype==="complex64"||u.dtype==="complex64"){var l=ns({inputs:{x:s},backend:c,attrs:{dtype:"complex64"}}),f=c.data.get(l.dataId),h=f.complexTensorInfos.real,p=f.complexTensorInfos.imag,d=c.data.get(h.dataId).values,m=c.data.get(p.dataId).values,v=ns({inputs:{x:u},backend:c,attrs:{dtype:"complex64"}}),g=c.data.get(v.dataId),y=g.complexTensorInfos.real,w=g.complexTensorInfos.imag,b=c.data.get(y.dataId).values,x=c.data.get(w.dataId).values,S=We(t(s.shape,u.shape,d,m,b,x),3),T=S[0],E=S[1],C=S[2],R=c.makeTensorInfo(C,"float32",T),_=c.makeTensorInfo(C,"float32",E),O=ua({inputs:{real:R,imag:_},backend:c});return c.disposeIntermediateTensorInfo(l),c.disposeIntermediateTensorInfo(v),c.disposeIntermediateTensorInfo(R),c.disposeIntermediateTensorInfo(_),O}else{var $=c.data.get(s.dataId).values,z=c.data.get(u.dataId).values,L=n||s.dtype,B=We(e(s.shape,u.shape,$,z,L),2),W=B[0],C=B[1];return c.makeTensorInfo(C,L,W)}}}function bx(r){return function(e,t,n,a,i,o){var s=N.backend_util.assertAndGetBroadcastShape(e,t),u=N.util.sizeFromShape(s),c=s.length,l=N.util.computeStrides(s),f=N.util.getTypedArrayFromDType("float32",u),h=N.util.getTypedArrayFromDType("float32",u),p=N.backend_util.getBroadcastDims(e,s),d=N.backend_util.getBroadcastDims(t,s),m=N.backend_util.mergeRealAndImagArrays(n,a),v=N.backend_util.mergeRealAndImagArrays(i,o),g=e.length,y=N.util.computeStrides(e),w=t.length,b=N.util.computeStrides(t);if(p.length+d.length===0)for(var x=0;x<f.length;x++){var S=x%m.length,T=x%v.length,E=r(m[S*2],m[S*2+1],v[T*2],v[T*2+1]);f[x]=E.real,h[x]=E.imag}else for(var C=function(R){var _=N.util.indexToLoc(R,c,l),O=_.slice(-g);p.forEach(function(W){return O[W]=0});var $=N.util.locToIndex(O,g,y),z=_.slice(-w);d.forEach(function(W){return z[W]=0});var L=N.util.locToIndex(z,w,b),B=r(m[$*2],m[$*2+1],v[L*2],v[L*2+1]);f[R]=B.real,h[R]=B.imag},x=0;x<f.length;x++)C(x);return[f,h,s]}}var Zz=Fr(function(r,e){return r+e}),HOe=bx(function(r,e,t,n){return{real:r+t,imag:e+n}}),Mc=Vr(N.Add,Zz,HOe),KOe={kernelName:N.Add,backendName:"cpu",kernelFunc:Mc};function wx(r,e,t,n,a){for(var i=N.util.sizeFromShape(n),o=N.util.makeZerosTypedArray(a,t),s=0;s<r.length;s++){var u=r[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(i>0?o[u]+=e[s]:o[u]+=1)}return o}function Jz(r,e,t,n){n===void 0&&(n=!1);for(var a=r.shape[0],i=r.shape[1],o=N.buffer([a,t],e.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=r.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=t||(n?o.set(1,s,c):e.size>0?o.set(o.get(s,c)+e.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o}var Qz=Fr(function(r,e){return r&e}),jOe=Vr(N.BitwiseAnd,Qz),XOe={kernelName:N.BitwiseAnd,backendName:"cpu",kernelFunc:jOe};function $i(r){return function(e,t,n){for(var a=N.util.getArrayFromDType(t,e.length),i=0;i<e.length;++i)a[i]=r(e[i],n);return a}}function Mt(r,e,t){var n=$i(e);return as(r,n,t)}function as(r,e,t){return function(n){var a=n.inputs,i=n.attrs,o=n.backend,s=a.x;Ue(s,r);var u=o,c=u.data.get(s.dataId).values,l;if(s.dtype==="string"){if(!Array.isArray(c))throw new Error("String tensor's value was not an instance of Array");l=N.backend_util.fromUint8ToStringArray(c)}else l=c;var f=t||s.dtype,h=e(l,f,i);return u.makeTensorInfo(s.shape,f,h)}}var e$=$i(function(r){return Math.ceil(r)}),YOe=as(N.Ceil,e$),ZOe={kernelName:N.Ceil,backendName:"cpu",kernelFunc:YOe};function t$(r,e,t,n){var a=N.util.getArrayFromDType(t,N.util.sizeFromShape(e));if(n&&t!=="string"){var i=0;r.forEach(function(s){var u=N.util.sizeFromShape(s.shape);a.set(s.vals,i),i+=u})}else{var o=0;r.forEach(function(s){for(var u=t==="string"?N.backend_util.fromUint8ToStringArray(s.vals):s.vals,c=0,l=0;l<s.shape[0];++l)for(var f=l*e[1]+o,h=0;h<s.shape[1];++h)a[f+h]=u[c++];o+=s.shape[1]})}return a}var r$=Fr(function(r,e){return r===e?1:0}),n$=Vr(N.Equal,r$,null,"bool"),JOe={kernelName:N.Equal,backendName:"cpu",kernelFunc:n$};var a$=$i(function(r){return Math.exp(r)}),i$=as(N.Exp,a$,"float32"),QOe={kernelName:N.Exp,backendName:"cpu",kernelFunc:i$};var o$=$i(function(r){return Math.expm1(r)}),ePe=as(N.Expm1,o$),tPe={kernelName:N.Expm1,backendName:"cpu",kernelFunc:ePe};var s$=$i(function(r){return Math.floor(r)}),rPe=as(N.Floor,s$),nPe={kernelName:N.Floor,backendName:"cpu",kernelFunc:rPe};var u$=Fr(function(r,e){return Math.floor(r/e)}),aPe=Vr(N.FloorDiv,u$,null,"int32"),iPe={kernelName:N.FloorDiv,backendName:"cpu",kernelFunc:aPe};function c$(r,e,t,n,a,i,o,s,u){for(var c=N.buffer([n,i],t),l=0;l<n;l++){for(var f=[],h=0,p=0;p<a;p++){var d=r[l*a+p];h+=d*o[p],f.push(d)}if(h<0||h>=u/i)throw new Error("Invalid indices: ".concat(f," does not index into ").concat(s));for(var m=0;m<i;m++)c.values[l*i+m]=e.get.apply(e,wa([],We(e.indexToLoc(h*i+m)),!1))}return c}function l$(r,e,t){for(var n=N.buffer(t,r.dtype),a=0;a<n.size;++a){var i=n.indexToLoc(a),o=i.slice(),s=o[0],u=o[2],c=e.locToIndex([s,u]);o[2]=e.values[c];var l=r.locToIndex(o);0<=l&&l<r.values.length&&(n.values[a]=r.values[l])}return n}var f$=Fr(function(r,e){return r>e?1:0}),oPe=Vr(N.Greater,f$,null,"bool"),sPe={kernelName:N.Greater,backendName:"cpu",kernelFunc:oPe};var h$=Fr(function(r,e){return r>=e?1:0}),uPe=Vr(N.GreaterEqual,h$,null,"bool"),cPe={kernelName:N.GreaterEqual,backendName:"cpu",kernelFunc:uPe};var p$=Fr(function(r,e){return r<e?1:0}),lPe=Vr(N.Less,p$,null,"bool"),fPe={kernelName:N.Less,backendName:"cpu",kernelFunc:lPe};var d$=Fr(function(r,e){return r<=e?1:0}),hPe=Vr(N.LessEqual,d$,null,"bool"),pPe={kernelName:N.LessEqual,backendName:"cpu",kernelFunc:hPe};function v$(r,e,t){var n=(e-r)/(t-1),a=N.util.makeZerosTypedArray(t,"float32");a[0]=r;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return a}var m$=$i(function(r){return Math.log(r)}),dPe=as(N.Log,m$),vPe={kernelName:N.Log,backendName:"cpu",kernelFunc:dPe};function g$(r,e,t,n){for(var a=N.util.getTypedArrayFromDType(n,N.util.sizeFromShape(t)),i=0;i<a.length;++i){for(var o=i*e,s=r[o],u=0;u<e;++u){var c=r[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a}var y$=Fr(function(r,e){return Math.max(r,e)}),mPe=Vr(N.Maximum,y$),gPe={kernelName:N.Maximum,backendName:"cpu",kernelFunc:mPe};var b$=Fr(function(r,e){return Math.min(r,e)}),yPe=Vr(N.Minimum,b$),bPe={kernelName:N.Minimum,backendName:"cpu",kernelFunc:yPe};var xx=Fr(function(r,e){return r*e}),wPe=bx(function(r,e,t,n){return{real:r*t-e*n,imag:r*n+e*t}}),em=Vr(N.Multiply,xx,wPe),xPe={kernelName:N.Multiply,backendName:"cpu",kernelFunc:em};function w$(r,e,t){var n=N.util.createScalarValue(-1,t);return xx([],e,n,r,t)}function kPe(r){var e=r.inputs,t=r.backend,n=e.x;Ue(n,"neg");var a=t.data.get(n.dataId).values,i=We(w$(a,n.shape,n.dtype),2),o=i[0],s=i[1];return t.makeTensorInfo(s,n.dtype,o)}var SPe={kernelName:N.Neg,backendName:"cpu",kernelFunc:kPe};var x$=Fr(function(r,e){return r!==e?1:0}),NPe=Vr(N.NotEqual,x$,null,"bool"),TPe={kernelName:N.NotEqual,backendName:"cpu",kernelFunc:NPe};function kx(r,e,t,n,a){for(var i=e.length,o=N.util.sizeFromShape(e),s=N.util.computeStrides(e),u=N.util.computeStrides(a),c=N.util.getTypedArrayFromDType(t,N.util.sizeFromShape(a)),l=0;l<o;++l){for(var f=N.util.indexToLoc(l,i,s),h=new Array(f.length),p=0;p<h.length;p++)h[p]=f[n[p]];var d=N.util.locToIndex(h,i,u);c[d]=r[l]}return c}function Bn(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.x,i=t.perm;Ue(a,"transpose");for(var o=a.shape.length,s=new Array(o),u=0;u<s.length;u++)s[u]=a.shape[i[u]];var c=n.data.get(a.dataId).values,l=kx(c,a.shape,a.dtype,i,s),f=n.write(l,s,a.dtype);return{dataId:f,shape:s,dtype:a.dtype}}var EPe={kernelName:N.Transpose,backendName:"cpu",kernelFunc:Bn};function k$(r,e,t,n){for(var a=We(N.backend_util.computeOutAndReduceShapes(r,n),2),i=a[0],o=a[1],s=N.upcastType(e,"int32"),u=N.util.makeZerosTypedArray(N.util.sizeFromShape(i),s),c=N.util.sizeFromShape(o),l=0;l<u.length;++l){for(var f=l*c,h=1,p=0;p<c;++p)h*=t[f+p];u[l]=h}return{outVals:u,outShape:i,outDtype:s}}function IPe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;Ue(a,"prod");var s=a.shape.length,u=N.util.parseAxisParam(i,a.shape),c=N.backend_util.getAxesPermutation(u,s),l=u,f=a,h=[];c!=null&&(f=Bn({inputs:{x:a},backend:t,attrs:{perm:c}}),h.push(f),l=N.backend_util.getInnerMostAxes(l.length,s));var p=t.data.get(f.dataId).values,d=k$(f.shape,f.dtype,p,l),m=d.outVals,v=d.outShape,g=d.outDtype,y=v;return o&&(y=N.backend_util.expandShapeToKeepDim(v,u)),h.forEach(function(w){return t.disposeIntermediateTensorInfo(w)}),t.makeTensorInfo(y,g,m)}var CPe={kernelName:N.Prod,backendName:"cpu",kernelFunc:IPe};function APe(r,e,t){r.forEach(function(n,a){if(n<0||n>=t){var i=N.util.indexToLoc(a,e.length,N.util.computeStrides(e)).join(",");throw new Error("indices[".concat(i,"] = ").concat(n," is not in [0, ").concat(t,")"))}})}function DPe(r,e){for(var t=0;t<r.length;++t){var n=r[t],a=t===r.length-1?e:r[t+1].length;if(n.length===0)throw new Error("Ragged splits may not be empty");if(n[0]<0)throw new Error("Ragged splits must be non-negative");if(n[n.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<n.length;++i)if(n[i-1]>n[i])throw new Error("Ragged splits must be sorted in ascending order")}}function _Pe(r,e,t,n){var a=[],i=0,o=e.length-1+t.length,s=new Array(o).fill(null).map(function(){return[0]});DPe(t,n);for(var u=1,c=0;c<e.length-1;++c){u*=e[c];for(var l=e[c+1],f=1;f<u+1;++f)s[c].push(f*l)}for(var f=0;f<r.length;++f){for(var h=r[f],p=r[f]+1,c=0;c<t.length;++c){var d=t[c],m=c+e.length-1;if(m>=0)for(var v=s[m],g=v[v.length-1]-d[h],y=h;y<p;++y)s[m].push(d[y+1]+g);h=d[h],p=d[p]}p!==h&&(a.push([h,p]),i+=p-h)}return{outSplits:s,valueSlices:a,numValues:i}}function FPe(r){for(var e=[],t=function(a){var i=r[a].length,o=N.util.getArrayFromDType("int32",i);e.push(o),r[a].forEach(function(s,u){return o[u]=s})},n=0;n<r.length;++n)t(n);return e}function qz(r,e){for(var t=r.slice(0,e);t.length<e;)t.push(1);for(var n=e;n<r.length;n++)t[e-1]*=r[n];return t}function RPe(r,e,t,n,a,i){var o,s,u=qz(e,2)[1],c=qz(i,2)[1],l=0;try{for(var f=Pc(t),h=f.next();!h.done;h=f.next())for(var p=h.value,d=p[0];d<p[1];++d){for(var m=0;m<n;++m)a[l*c+m]=r[d*u+m];++l}}catch(v){o={error:v}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}}function OPe(r,e,t,n,a){var i=e.slice();i[0]=a;var o=N.util.getArrayFromDType(t,N.util.sizeFromShape(i)),s=r.length,u=s===0?0:s/e[0];return RPe(r,e,n,u,o,i),[o,i]}function S$(r,e,t,n,a,i,o,s){if(r.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");var u=e[0][0]-1;if(APe(i,o,u),n.length===0)throw new Error("params.rank must be nonzero");var c=n[0],l=_Pe(i,o,r,c),f=l.outSplits,h=l.valueSlices,p=l.numValues,d=FPe(f),m=OPe(t,n,a,h,p);return[d,m[0],m[1]]}var Wz=2147483647;function N$(r,e,t,n,a,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");var s=e.length===0,u=a.length===0,c=o.length===0,l=[];s||l.push(e[0]),u||l.push(a[0]),c||l.push(o[0]);for(var f=1;f<l.length;++f)if(l[f]!==l[f-1])throw new Error("starts, limits, and deltas must have the same shape");var h=l.length===0?1:l[0],p=N.util.getArrayFromDType("int32",h+1);p[0]=0;for(var d=0;d<h;++d){var m=s?r[0]:r[d],v=u?n[0]:n[d],g=c?i[0]:i[d];if(g===0)throw new Error("Requires delta != 0");var y=void 0;if(g>0&&v<m||g<0&&v>m)y=0;else if(y=Math.ceil(Math.abs((v-m)/g)),y>Wz)throw new Error("Requires ((limit - start) / delta) <= ".concat(Wz));p[d+1]=p[d]+y}for(var w=p[h],b=N.util.getArrayFromDType(t,w),x=0,d=0;d<h;++d)for(var S=p[d+1]-p[d],T=s?r[0]:r[d],g=c?i[0]:i[d],f=0;f<S;++f)b[x++]=T,T+=g;return[p,b]}var Ya=N.backend_util.RowPartitionType,PPe=function(){function r(e,t,n,a,i,o,s,u,c,l){this.shape=e,this.shapeShape=t,this.values=n,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=N.backend_util.getRowPartitionTypesHelper(l),this.raggedRank=N.backend_util.getRaggedRank(this.rowPartitionTypes)}return r.prototype.getRowPartitionTypeByDimension=function(e){return this.rowPartitionTypes[0]===Ya.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]},r.prototype.getRowPartitionTensor=function(e){return this.rowPartitionTypes[0]===Ya.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]},r.prototype.getMaxWidth=function(e){var t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Ya.VALUE_ROWIDS:return r.getMaxWidthValueRowID(t);case Ya.ROW_SPLITS:return r.getMaxWidthRowSplit(t);default:throw new Error("Cannot handle partition type ".concat(Ya[this.getRowPartitionTypeByDimension(e-1)]))}},r.getMaxWidthRowSplit=function(e){var t=e.length;if(t===0||t===1)return 0;for(var n=0,a=0;a<t-1;++a){var i=e[a+1]-e[a];i>n&&(n=i)}return n},r.getMaxWidthValueRowID=function(e){var t=e.length;if(t===0)return 0;for(var n=0,a=e[0],i=0,o=1;o<t;++o){var s=e[o];s!==a&&(a=s,i=Math.max(o-n,i),n=o)}return Math.max(t-n,i)},r.prototype.tensorShapeFromTensor=function(e,t,n){if(n===void 0&&(n=!0),t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return Uz(e,n)},r.prototype.calculateOutputSize=function(e){var t=this.valuesShape,n=this.defaultValueShape;N.backend_util.validateDefaultValueShape(n,t);var a=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=N.backend_util.combineRaggedTensorToTensorShapes(this.raggedRank,a,t),o=i;o[0]<0&&(o[0]=e);for(var s=1;s<=this.raggedRank;++s)o[s]<0&&(o[s]=this.getMaxWidth(s));return o},r.prototype.calculateFirstParentOutputIndex=function(e,t,n){for(var a=Math.min(e,n),i=[],o=0,s=0;s<a;++s,o+=t)i.push(o);for(var s=a;s<e;++s)i.push(-1);return N.util.assert(i.length===e,function(){return"Final length of result must be equal to firstDimension."}),i},r.prototype.calculateOutputIndexRowSplit=function(e,t,n,a){for(var i=e.length,o=[],s=0;s<i-1;++s){var u=e[s+1]-e[s],c=Math.min(a,u),l=t[s];l===-1&&(c=0);for(var f=0;f<c;++f)o.push(l),l+=n;for(var f=0;f<u-c;++f)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o},r.prototype.calculateOutputIndexValueRowID=function(e,t,n,a){var i=e.length,o=[];if(i===0)return[];var s=0,u=e[0];if(u>=t.length)throw new Error("Got currentValueRowId=".concat(u,", which is not less than ").concat(t.length));var c=t[u];o.push(c);for(var l=1;l<i;++l){var f=e[l];if(f===u)c>=0&&(++s,s<a?c+=n:c=-1);else{if(s=0,u=f,f>=t.length)throw new Error("Got nextValueRowId=".concat(f," which is not less than ").concat(t.length));c=t[f]}o.push(c)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o},r.prototype.calculateOutputIndex=function(e,t,n,a){var i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case Ya.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,n,a);case Ya.ROW_SPLITS:if(i.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(i.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(i,t,n,a);default:throw new Error("Unsupported partition type: ".concat(Ya[o]))}},r.prototype.getFirstDimensionSize=function(){var e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case Ya.FIRST_DIM_SIZE:return e[0];case Ya.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Ya.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(Ya[t]))}},r.prototype.compute=function(){var e=this.rowPartitionValues[0];if(e.length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var t=this.getFirstDimensionSize(),n=this.calculateOutputSize(t),a=new Array(this.raggedRank+1);a[a.length-1]=1;for(var i=a.length-2;i>=0;--i)a[i]=a[i+1]*n[i+1];var o=Uz(n,!1),s=N.util.getArrayFromDType(this.valuesDType,N.util.sizeFromShape(o)),u=a[0]*n[0];if(u>0){for(var c=this.calculateFirstParentOutputIndex(t,a[0],n[0]),i=1;i<=this.raggedRank;++i){var l=this.calculateOutputIndex(i-1,c,a[i],n[i]);c=l}this.setOutput(this.raggedRank,c,s,o)}return[o,s]},r.prototype.setOutput=function(e,t,n,a){if(n.length!==0){var i=this.values,o=n,s=a.slice();s=s.slice(e+1);var u=N.util.sizeFromShape(s),c=t.length,l=this.defaultValue;if(l.length!==u&&l.length!==1){var f=this.defaultValueShape;N.tidy(function(){var x=N.reshape(l,f),S=N.broadcastTo(x,s);l=S.dataSync()})}for(var h=0,p=0,d=0,m=0;m<=c;++m){var v=m<c?t[m]:-1;if(v===d){++d;continue}if(p<d){var g=i.subarray(h*u),y=o.subarray(p*u),w=(d-p)*u;Vz(y,g,w)}if(m>=c){var b=n.length;v=Math.floor(b/u)}if(v>d)if(this.defaultValue.length===1)o.subarray(d*u,v*u).fill(this.defaultValue[0]),d=v;else for(;v>d;){var y=o.slice(d*u);Vz(y,l,u),++d}v<0?(h=m+1,p=d):(h=m,p=d,d=p+1)}}},r}();function Vz(r,e,t){for(var n=0;n<t;n++)r[n]=e[n]}function Uz(r,e){var t,n,a=[];try{for(var i=Pc(r),o=i.next();!o.done;o=i.next()){var s=o.value;if(s<0){if(!e)throw new Error("Dimension ".concat(s," must be >= 0"));if(s<-1)throw new Error("Dimension ".concat(s," must be >= -1"));s=-1}a.push(s)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a}function T$(r,e,t,n,a,i,o,s,u,c){return new PPe(r,e,t,n,a,i,o,s,u,c).compute()}function E$(r,e,t,n){var a=r===e,i=r<e&&t<0,o=e<r&&t>1;if(a||i||o)return N.util.makeZerosTypedArray(0,n);var s=Math.abs(Math.ceil((e-r)/t)),u=N.util.makeZerosTypedArray(s,n);e<r&&t===1&&(t=-1),u[0]=r;for(var c=1;c<u.length;c++)u[c]=u[c-1]+t;return u}var I$=$i(function(r){return 1/Math.sqrt(r)}),MPe=as(N.Rsqrt,I$),BPe={kernelName:N.Rsqrt,backendName:"cpu",kernelFunc:MPe};function pu(r,e,t,n,a,i,o,s,u,c){var l=[n/a,a],f=r.values,h=e.values;if(n===0)return N.buffer(t,e.dtype);var p=u instanceof N.TensorBuffer?u:N.buffer(l,e.dtype);typeof u=="string"||typeof u=="number"?p.values.fill(u):typeof u=="boolean"&&p.values.fill(+u);for(var d=0;d<i;d++){for(var m=[],v=0,g=0;g<o;g++){var y=f[d*o+g];m.push(y),v+=y*s[g]}if(v<0||v>=n/a)throw new Error("Invalid indices: ".concat(m," does not index into ").concat(t));for(var w=0;w<a;w++)c?p.values[v*a+w]+=h[d*a+w]:p.values[v*a+w]=e.rank===0?h[0]:h[d*a+w]}return p}var LPe=$i(function(r){return 1/(1+Math.exp(-r))}),C$=Mt(N.Sigmoid,function(r){return 1/(1+Math.exp(-r))}),zPe={kernelName:N.Sigmoid,backendName:"cpu",kernelFunc:C$};function A$(r,e,t,n,a){var i=N.slice_util.isSliceContinous(n,e,t),o=N.util.sizeFromShape(t),s=N.util.computeStrides(n);if(i){var u=N.slice_util.computeFlatOffset(e,s);return a==="string"?r.slice(u,u+o):r.subarray(u,u+o)}for(var c=a==="string"?N.backend_util.fromUint8ToStringArray(r):r,l=N.buffer(n,a,c),f=N.buffer(t,a),h=0;h<f.size;++h){var p=f.indexToLoc(h),d=p.map(function(m,v){return m+e[v]});f.set.apply(f,wa([l.get.apply(l,wa([],We(d),!1))],We(p),!1))}return a==="string"?N.backend_util.fromStringArrayToUint8(f.values):f.values}function vu(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.begin,o=n.size;Ue(a,"slice");var s=We(N.slice_util.parseSliceParams(a,i,o),2),u=s[0],c=s[1];N.slice_util.assertParamsValid(a,u,c);var l=t.data.get(a.dataId).values,f=A$(l,u,c,a.shape,a.dtype);return t.makeTensorInfo(c,a.dtype,f)}var $Pe={kernelName:N.Slice,backendName:"cpu",kernelFunc:vu};function D$(r,e,t,n,a,i,o){var s=e[0],u=i[0],c=new Array(u),l=new Array(s),f=e[1];if(u===0){if(s!==0)throw new Error(N.backend_util.getSparseFillEmptyRowsIndicesDenseShapeMismatch(s));var h=N.util.getArrayFromDType(t,0),p=N.util.getArrayFromDType(a,0);return[h,[0,f],p,c,l]}for(var d=!0,m=0,v=new Array(u).fill(0),g=0;g<s;++g){var y=r[g*f];if(y<0)throw new Error(N.backend_util.getSparseFillEmptyRowsNegativeIndexErrorMessage(g,y));if(y>=u)throw new Error(N.backend_util.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(g,y,u));++v[y],d=d&&y>=m,m=y}for(var w=!0,y=0;y<u;++y){var b=v[y]===0;c[y]=b,w=w&&!b,v[y]=Math.max(v[y],1),y>0&&(v[y]+=v[y-1])}if(w&&d){for(var h=r,p=n,g=0;g<s;++g)l[g]=g;return[h,[s,f],p,c,l]}else{for(var x=v[u-1],h=N.util.getArrayFromDType(t,x*f),p=N.util.getArrayFromDType(a,x),S=new Array(u).fill(0),g=0;g<s;++g){var y=r[g*f],T=S[y],E=(y===0?0:v[y-1])+T;S[y]++;for(var C=0;C<f;++C)h[E*f+C]=r[g*f+C];p[E]=n[g],l[g]=E}for(var y=0;y<u;++y){var R=S[y];if(R===0){var _=y===0?0:v[y-1];h[_*f+0]=y;for(var O=1;O<f;++O)h[_*f+O]=0;p[_]=o}}return[h,[x,f],p,c,l]}}function _$(r,e,t,n,a){for(var i=N.util.sizeFromShape(n),o=e[0],s=a.length,u=[],c=1,l=-1,f=0;f<s;++f){var h=a[f];if(h===-1){if(l!==-1)throw new Error(N.backend_util.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(l,f));l=f,u.push(1)}else{if(h<0)throw new Error(N.backend_util.getSparseReshapeNegativeOutputDimErrorMessage(f,h));c*=h,u.push(h)}}if(l!==-1){if(c<=0)throw new Error(N.backend_util.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());var p=Math.trunc(i/c);if(c*p!==i)throw new Error(N.backend_util.getSparseReshapeInputOutputMultipleErrorMessage(n,u));u[l]=p}var d=N.util.sizeFromShape(u);if(d!==i)throw new Error(N.backend_util.getSparseReshapeInputOutputMismatchErrorMessage(n,u));var m=n.length,v=[];if(m>0){v[m-1]=1;for(var f=m-2;f>=0;--f)v[f]=v[f+1]*n[f+1]}var g=[];if(s>0){g[s-1]=1;for(var f=s-2;f>=0;--f)g[f]=g[f+1]*u[f+1]}for(var y=N.util.getArrayFromDType(t,o*s),w=0;w<o;++w){for(var b=0,x=0;x<m;++x)b+=r[w*m+x]*v[x];for(var x=0;x<s;++x)y[w*s+x]=Math.trunc(b/g[x]),b%=g[x]}return[y,[o,s],u]}function Sx(r,e,t,n,a,i,o){i===void 0&&(i=!1),o===void 0&&(o=0);var s=n.length,u=[e[0],r.length/e[0]],c=u[1],l=s>0?a[s-1]+1:0,f=l;if(f<0)throw new Error(N.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var h=e.slice();h[0]=f;var p=h.reduce(function(T,E){return T*E},1),d=N.util.getArrayFromDType(t,p);if(s===0)return f>0&&d.fill(o),[d,h];if(f<=0)throw new Error(N.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());for(var m=0,v=1,g=0,y=a[m];;){var w=0;if(v<s){if(w=a[v],y===w){++v;continue}if(y>=w)throw new Error(N.backend_util.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=f)throw new Error(N.backend_util.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,f));y>g&&d.fill(o,g*c,y*c);for(var b=m;b<v;++b){var x=n[b];if(x<0||x>=u[0])throw new Error(N.backend_util.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(b,n[b],u[0]));for(var S=0;S<c;S++)d[y*c+S]+=r[x*c+S]}if(i)for(var S=0;S<c;S++)d[y*c+S]/=v-m;if(m=v,++v,g=y+1,y=w,v>s)break}return g<f&&d.fill(o,g*c,f*c),[d,h]}var qPe=$i(function(r){return Math.sqrt(r)}),WPe=Mt(N.Sqrt,function(r){return Math.sqrt(r)}),VPe={kernelName:N.Sqrt,backendName:"cpu",kernelFunc:WPe};var F$=Fr(function(r,e){var t=r-e;return t*t}),UPe=Vr(N.SquaredDifference,F$),GPe={kernelName:N.SquaredDifference,backendName:"cpu",kernelFunc:UPe};var R$=$i(function(r,e){var t=e.pattern,n=e.replaceGlobal,a=e.rewrite;return r.replace(new RegExp(t,n?"g":""),a)}),HPe=as(N.StaticRegexReplace,R$),KPe={kernelName:N.StaticRegexReplace,backendName:"cpu",kernelFunc:HPe};function O$(r,e,t,n){for(var a=N.buffer(r,e.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*t[u]+n[u];a.set.apply(a,wa([e.get.apply(e,wa([],We(s),!1))],We(o),!1))}return a}var jPe=function(){function r(e,t,n,a,i,o){this.separator=N.util.encodeString(e),this.nGramWidths=t,this.leftPad=N.util.encodeString(n),this.rightPad=N.util.encodeString(a),this.padWidth=i,this.preserveShort=o}return r.prototype.getPadWidth=function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)},r.prototype.getNumNGrams=function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)},r.prototype.createNGrams=function(e,t,n,a,i,o){for(var s=function(l){var f=u.getPadWidth(o),h=Math.max(0,f-l),p=Math.max(0,f-(i-(l+1))),d=o-(h+p),m=t+(h>0?0:l-f),v=0;v+=h*u.leftPad.length;for(var g=0;g<d;++g)v+=e[m+g].length;v+=p*u.rightPad.length;var y=h+p+d-1;v+=y*u.separator.length,n[a+l]=new Uint8Array(v);for(var w=n[a+l],b=0,x=function(S){return S.forEach(function(T){return w[b++]=T})},g=0;g<h;++g)x(u.leftPad),x(u.separator);for(var g=0;g<d-1;++g)x(e[m+g]),x(u.separator);if(d>0){x(e[m+d-1]);for(var g=0;g<p;++g)x(u.separator),x(u.rightPad)}else{for(var g=0;g<p-1;++g)x(u.rightPad),x(u.separator);x(u.rightPad)}},u=this,c=0;c<i;++c)s(c)},r.prototype.compute=function(e,t){var n=this,a=e.length,i=t.length;if(i>0){var o=t[0];if(o!==0)throw new Error("First split value must be 0, got ".concat(o));for(var s=1;s<i;++s){var u=t[s]>=o;if(u=u&&t[s]<=a,!u)throw new Error("Invalid split value ".concat(t[s],", must be in [").concat(o,", ").concat(a,"]"));o=t[s]}if(o!==a)throw new Error("Last split value must be data size. Expected ".concat(a,", got ").concat(o))}var c=i-1,l=N.util.getArrayFromDType("int32",i);if(a===0||i===0){for(var f=new Array(a),s=0;s<=c;++s)l[s]=0;return[f,l]}l[0]=0;for(var h=function(g){var y=t[g]-t[g-1],w=0;p.nGramWidths.forEach(function(b){w+=n.getNumNGrams(y,b)}),p.preserveShort&&y>0&&w===0&&(w=1),l[g]=l[g-1]+w},p=this,s=1;s<=c;++s)h(s);for(var d=new Array(l[c]),m=function(g){var y=t[g],w=l[g];if(v.nGramWidths.forEach(function(T){var E=t[g+1]-t[g],C=n.getNumNGrams(E,T);n.createNGrams(e,y,d,w,C,T),w+=C}),v.preserveShort&&w===l[g]){var b=t[g+1]-t[g];if(b===0)return"continue";var x=b+2*v.padWidth,S=1;v.createNGrams(e,y,d,w,S,x)}},v=this,s=0;s<c;++s)m(s);return[d,l]},r}();function P$(r,e,t,n,a,i,o,s){return new jPe(t,n,a,i,o,s).compute(r,e)}function XPe(r,e,t,n){if(!!r.length){if(e.length===0){for(var a=0;a<r.length;++a)n.push(r.subarray(a,a+1));return}if(e.length===1){for(var i=e[0],o=r.indexOf(i);o!==-1;){var s=r.subarray(0,o);(!t||s.length!==0)&&n.push(s),r=r.subarray(o+1),o=r.indexOf(i)}(!t||r.length!==0)&&n.push(r);return}for(var u=0,a=0;a<r.length+1;a++)if(a===r.length||e.indexOf(r[a])!==-1){var s=r.subarray(u,a);(!t||s.length!==0)&&n.push(s),u=a+1}}}function M$(r,e,t){for(var n=r.length,a=[],i=0,o=0,s=new Array(n),u=0;u<n;++u){var c=a.length;XPe(r[u],e,t,a);var l=a.length-c;s[u]=l,i+=l,o=Math.max(o,l)}for(var f=N.util.getArrayFromDType("int32",i*2),h=new Array(i),p=[n,o],d=0,u=0;u<n;++u)for(var m=0;m<s[u];++m)f[d*2]=u,f[d*2+1]=m,h[d]=a[d],++d;return[f,h,p]}function B$(r,e){for(var t=N.util.getArrayFromDType("int32",r.length),n=0;n<r.length;++n)t[n]=N.util.fingerPrint64(r[n]).modulo(e).getLowBitsUnsigned();return t}var L$=Fr(function(r,e){return r-e}),YPe=bx(function(r,e,t,n){return{real:r-t,imag:e-n}}),Nx=Vr(N.Sub,L$,YPe),ZPe={kernelName:N.Sub,backendName:"cpu",kernelFunc:Nx};function z$(r,e){for(var t=new Array(r.rank),n=0;n<t.length;n++)t[n]=r.shape[n]*e[n];for(var a=N.buffer(t,r.dtype),n=0;n<a.values.length;++n){for(var i=a.indexToLoc(n),o=new Array(r.rank),s=0;s<o.length;s++)o[s]=i[s]%r.shape[s];var u=r.locToIndex(o);a.values[n]=r.values[u]}return a}var ah=function(r,e){var t=e.value-r.value;return t===0?r.index-e.index:t};function $$(r,e,t,n){for(t===void 0&&(t=0),n===void 0&&(n=r.length-1);n>t;){if(n-t>600){var a=n-t+1,i=e-t+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2),c=Math.max(t,Math.floor(e-i*s/a+u)),l=Math.min(n,Math.floor(e+(a-i)*s/a+u));$$(r,e,c,l)}var f=r[e],h=t,p=n;for(N.util.swap(r,t,e),ah(r[n],f)>0&&N.util.swap(r,t,n);h<p;){for(N.util.swap(r,h,p),h++,p--;ah(r[h],f)<0;)h=h+1;for(;ah(r[p],f)>0;)p=p-1}ah(r[t],f)===0?N.util.swap(r,t,p):(p=p+1,N.util.swap(r,p,n)),p<=e&&(t=p+1),e<=p&&(n=p-1)}}function q$(r,e,t,n,a){for(var i=e[e.length-1],o=We([r.length/i,i],2),s=o[0],u=o[1],c=N.util.getTypedArrayFromDType(t,s*n),l=N.util.getTypedArrayFromDType("int32",s*n),f=function(d){var m=d*u,v=r.subarray(m,m+u),g=new Array(v.length);v.forEach(function(S,T){return g[T]={value:S,index:T}}),n<g.length&&($$(g,n),g=g.slice(0,n)),a&&g.sort(ah);for(var y=d*n,w=c.subarray(y,y+n),b=l.subarray(y,y+n),x=0;x<n;x++)w[x]=g[x].value,b[x]=g[x].index},h=0;h<s;h++)f(h);var p=e.slice();return p[p.length-1]=n,[N.buffer(p,t,c),N.buffer(p,"int32",l)]}function W$(r,e,t,n){for(var a=N.util.parseAxisParam(e,t)[0],i=[1,t[0],1],o=0;o<a;o++)i[0]*=t[o];i[1]=t[a];for(var o=a+1;o<t.length;o++)i[2]*=t[o];for(var s=new Map,u=new Int32Array(t[a]),c=new N.TensorBuffer(i,n,r),l=[],f=i[0]===1&&i[2]===1,o=0;o<t[a];o++){var h=void 0;if(f)h=r[o].toString();else{for(var p=[],d=0;d<i[0];d++)for(var m=0;m<i[2];m++)p.push(c.get(d,o,m));h=p.join(",")}var v=s.get(h);if(v!=null)u[o]=v;else{var g=s.size;s.set(h,g),u[o]=g,l.push(o)}}var y=i.slice();y[1]=s.size;var w=new N.TensorBuffer(y,n);l.forEach(function(x,S){for(var T=0;T<i[0];T++)for(var E=0;E<i[2];E++)w.set(c.get(T,x,E),T,S,E)});var b=t.slice();return b[a]=y[1],{outputValues:w.values,outputShape:b,indices:u}}var JPe={__proto__:null,addImpl:Zz,bincountImpl:wx,bincountReduceImpl:Jz,bitwiseAndImpl:Qz,castImpl:Yz,ceilImpl:e$,concatImpl:t$,equalImpl:r$,expImpl:a$,expm1Impl:o$,floorDivImpl:u$,floorImpl:s$,gatherNdImpl:c$,gatherV2Impl:l$,greaterEqualImpl:h$,greaterImpl:f$,lessEqualImpl:d$,lessImpl:p$,linSpaceImpl:v$,logImpl:m$,maxImpl:g$,maximumImpl:y$,minimumImpl:b$,multiplyImpl:xx,negImpl:w$,notEqualImpl:x$,prodImpl:k$,raggedGatherImpl:S$,raggedRangeImpl:N$,raggedTensorToTensorImpl:T$,rangeImpl:E$,rsqrtImpl:I$,scatterImpl:pu,sigmoidImpl:LPe,simpleAbsImpl:Xz,sliceImpl:A$,sparseFillEmptyRowsImpl:D$,sparseReshapeImpl:_$,sparseSegmentReductionImpl:Sx,sqrtImpl:qPe,squaredDifferenceImpl:F$,staticRegexReplaceImpl:R$,stridedSliceImpl:O$,stringNGramsImpl:P$,stringSplitImpl:M$,stringToHashBucketFastImpl:B$,subImpl:L$,tileImpl:z$,topKImpl:q$,transposeImpl:kx,uniqueImpl:W$};var QPe="4.6.0";N.registerBackend("cpu",function(){return new yx},1);var V$=Mt(N.Elu,function(r){return r>=0?r:Math.exp(r)-1}),eMe={kernelName:N.Elu,backendName:"cpu",kernelFunc:V$};function U$(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.alpha;Ue([a],"leakyRelu");for(var o=N.util.sizeFromShape(a.shape),s=t.data.get(a.dataId).values,u=N.util.getTypedArrayFromDType("float32",o),c=0;c<s.length;c++)u[c]=s[c]<0?i*s[c]:s[c];return t.makeTensorInfo(a.shape,"float32",u)}var tMe={kernelName:N.LeakyRelu,backendName:"cpu",kernelFunc:U$},rMe=Fr(function(r,e){return r<0?e*r:r});function G$(r){var e=r.inputs,t=r.backend,n=e.x,a=e.alpha;Ue([n,a],"prelu");var i=t.data.get(n.dataId).values,o=t.data.get(a.dataId).values,s=We(rMe(n.shape,a.shape,i,o,"float32"),2),u=s[0],c=s[1];return t.makeTensorInfo(c,"float32",u)}var nMe={kernelName:N.Prelu,backendName:"cpu",kernelFunc:G$};var H$=Mt(N.Relu,function(r){return Math.max(0,r)}),aMe={kernelName:N.Relu,backendName:"cpu",kernelFunc:H$};var K$=Mt(N.Relu6,function(r){return Math.min(Math.max(0,r),6)}),iMe={kernelName:N.Relu6,backendName:"cpu",kernelFunc:K$};function Zv(r,e,t,n,a){if(t==="linear")return zi({inputs:{x:e},backend:r});if(t==="relu")return H$({inputs:{x:e},backend:r});if(t==="elu")return V$({inputs:{x:e},backend:r});if(t==="relu6")return K$({inputs:{x:e},backend:r});if(t==="prelu")return G$({inputs:{x:e,alpha:n},backend:r});if(t==="leakyrelu")return U$({inputs:{x:e},backend:r,attrs:{alpha:a}});if(t==="sigmoid")return C$({inputs:{x:e},backend:r});throw new Error("Activation ".concat(t," has not been implemented for the CPU backend."))}function Vt(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.shape,o=N.util.sizeFromShape(a.shape),s=N.util.inferFromImplicitShape(i,o),u=N.util.sizeFromShape(s);N.util.assert(o===u,function(){return"The new shape (".concat(s,") has ").concat(u," elements and the old ")+"shape (".concat(a.shape,") has ").concat(o," elements. The new shape and old ")+"shape must have the same number of elements."}),t.incRef(a.dataId);var c=t.data.get(a.dataId);if(c.complexTensorInfos!=null){var l=c.complexTensorInfos.real,f=c.complexTensorInfos.imag;l.shape=s,f.shape=s}return{dataId:a.dataId,shape:s,dtype:a.dtype}}var oMe={kernelName:N.Reshape,backendName:"cpu",kernelFunc:Vt};function j$(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.a,i=e.b,o=n.transposeA,s=n.transposeB;Ue([a,i],"matMul");var u=a.shape.length,c=i.shape.length,l=o?a.shape[u-2]:a.shape[u-1],f=s?i.shape[c-1]:i.shape[c-2],h=o?a.shape[u-1]:a.shape[u-2],p=s?i.shape[c-2]:i.shape[c-1],d=a.shape.slice(0,-2),m=i.shape.slice(0,-2),v=N.util.sizeFromShape(d),g=N.util.sizeFromShape(m),y=N.broadcast_util.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)),w=y.concat([h,p]);N.util.assert(l===f,function(){return"Error in matMul: inner shapes (".concat(l,") and (")+"".concat(f,") of Tensors with shapes ").concat(a.shape," and ")+"".concat(i.shape," and transposeA=").concat(o)+" and transposeB=".concat(s," must match.")});for(var b=o?[v,l,h]:[v,h,l],x=s?[g,p,f]:[g,f,p],S=Vt({inputs:{x:a},backend:t,attrs:{shape:b}}),T=Vt({inputs:{x:i},backend:t,attrs:{shape:x}}),E=o?S.shape[1]:S.shape[2],C=o?S.shape[2]:S.shape[1],R=s?T.shape[1]:T.shape[2],_=Math.max(v,g),O=t.data.get(S.dataId).values,$=t.data.get(T.dataId).values,z=N.util.computeStrides(S.shape),L=N.util.computeStrides(T.shape),B=We(o?[z[0],1,z[1]]:[z[0],z[1],1],3),W=B[0],X=B[1],J=B[2],V=We(s?[1,L[1],L[0]]:[L[1],1,L[0]],3),j=V[0],ne=V[1],re=V[2],oe=C*R,le=N.buffer([_,C,R],S.dtype),de=le.values,ke=t.blockSize,he=0;he<_;he++)for(var ye=he%v,xe=he%g,De=0;De<C;De+=ke)for(var Ye=Math.min(De+ke,C),ht=0;ht<R;ht+=ke)for(var at=Math.min(ht+ke,R),nt=0;nt<E;nt+=ke)for(var ft=Math.min(nt+ke,E),st=De;st<Ye;st++)for(var Ze=ht;Ze<at;Ze++){for(var tt=0,et=nt;et<ft;et++){var nr=O[ye*W+st*X+et*J],He=$[et*j+Ze*ne+xe*re];tt+=nr*He}de[he*oe+(st*R+Ze)]+=tt}return t.disposeIntermediateTensorInfo(S),t.disposeIntermediateTensorInfo(T),t.makeTensorInfo(w,le.dtype,le.values)}var sMe={kernelName:N.BatchMatMul,backendName:"cpu",kernelFunc:j$};function uMe(r){var e,t,n=r.inputs,a=r.backend,i=r.attrs,o=n.a,s=n.b,u=n.bias,c=n.preluActivationWeights,l=i.transposeA,f=i.transposeB,h=i.activation,p=i.leakyreluAlpha,d,m,v,g=[],y=j$({inputs:{a:o,b:s},attrs:{transposeA:l,transposeB:f},backend:a});d=y,u&&(m=Mc({inputs:{a:d,b:u},backend:a}),g.push(d),d=m),h&&(v=Zv(a,d,h,c,p),g.push(d),d=v);try{for(var w=Pc(g),b=w.next();!b.done;b=w.next()){var x=b.value;a.disposeIntermediateTensorInfo(x)}}catch(S){e={error:S}}finally{try{b&&!b.done&&(t=w.return)&&t.call(w)}finally{if(e)throw e.error}}return d}var cMe={kernelName:N._FusedMatMul,backendName:"cpu",kernelFunc:uMe};var lMe=Mt(N.Acos,function(r){return Math.acos(r)}),fMe={kernelName:N.Acos,backendName:"cpu",kernelFunc:lMe};var hMe=Mt(N.Acosh,function(r){return Math.acosh(r)}),pMe={kernelName:N.Acosh,backendName:"cpu",kernelFunc:hMe};function dMe(r){var e=r.inputs,t=r.backend,n=e;Ue(e,"addN");for(var a=n.map(function(l){return t.data.get(l.dataId).values}),i=N.buffer(n[0].shape,n[0].dtype),o=i.values,s=0;s<n.length;s++)for(var u=a[s],c=0;c<o.length;c++)o[c]+=u[c];return t.makeTensorInfo(i.shape,i.dtype,i.values)}var vMe={kernelName:N.AddN,backendName:"cpu",kernelFunc:dMe};function mMe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;Ue(a,"all");var s=N.util.parseAxisParam(i,a.shape),u=s,c=N.backend_util.getAxesPermutation(u,a.shape.length),l=a;c!=null&&(l=Bn({inputs:{x:a},backend:t,attrs:{perm:c}}),u=N.backend_util.getInnerMostAxes(u.length,a.shape.length)),N.backend_util.assertAxesAreInnerMostDims("all",u,l.shape.length);for(var f=We(N.backend_util.computeOutAndReduceShapes(l.shape,u),2),h=f[0],p=f[1],d=N.util.sizeFromShape(p),m=N.util.makeZerosTypedArray(N.util.sizeFromShape(h),l.dtype),v=t.data.get(l.dataId).values,g=0;g<m.length;++g){for(var y=g*d,w=v[y],b=0;b<d;++b){var x=v[y+b];w=w&&x}m[g]=w}c!=null&&t.disposeIntermediateTensorInfo(l);var S=t.makeTensorInfo(h,l.dtype,m);if(o){var T=N.backend_util.expandShapeToKeepDim(h,s),E=Vt({inputs:{x:S},backend:t,attrs:{shape:T}});return t.disposeIntermediateTensorInfo(S),E}return S}var gMe={kernelName:N.All,backendName:"cpu",kernelFunc:mMe};function yMe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;Ue(a,"any");var s=N.util.parseAxisParam(i,a.shape),u=s,c=N.backend_util.getAxesPermutation(u,a.shape.length),l=a;c!=null&&(l=Bn({inputs:{x:a},backend:t,attrs:{perm:c}}),u=N.backend_util.getInnerMostAxes(u.length,a.shape.length)),N.backend_util.assertAxesAreInnerMostDims("any",u,l.shape.length);for(var f=We(N.backend_util.computeOutAndReduceShapes(l.shape,u),2),h=f[0],p=f[1],d=N.util.sizeFromShape(p),m=N.util.makeZerosTypedArray(N.util.sizeFromShape(h),l.dtype),v=t.data.get(l.dataId).values,g=0;g<m.length;++g){for(var y=g*d,w=v[y],b=0;b<d;++b){var x=v[y+b];w=w||x}m[g]=w}c!=null&&t.disposeIntermediateTensorInfo(l);var S=t.makeTensorInfo(h,l.dtype,m);if(o){var T=N.backend_util.expandShapeToKeepDim(h,s),E=Vt({inputs:{x:S},backend:t,attrs:{shape:T}});return t.disposeIntermediateTensorInfo(S),E}return S}var bMe={kernelName:N.Any,backendName:"cpu",kernelFunc:yMe};function wMe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis;Ue(a,"argMax");var o=N.util.parseAxisParam(i,a.shape),s=N.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=Bn({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=N.backend_util.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],N.backend_util.assertAxesAreInnerMostDims("argMax",o,u.shape.length);for(var l=We(N.backend_util.computeOutAndReduceShapes(u.shape,o),2),f=l[0],h=l[1],p=N.util.sizeFromShape(f),d=N.util.makeZerosTypedArray(p,"int32"),m=N.util.sizeFromShape(h),v=t.data.get(u.dataId).values,g=0;g<d.length;++g){for(var y=g*m,w=v[y],b=0,x=0;x<m;++x){var S=v[y+x];S>w&&(w=S,b=x)}d[g]=b}return c.forEach(function(T){return t.disposeIntermediateTensorInfo(T)}),t.makeTensorInfo(f,"int32",d)}var xMe={kernelName:N.ArgMax,backendName:"cpu",kernelFunc:wMe};function kMe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis;Ue(a,"argMin");var o=N.util.parseAxisParam(i,a.shape),s=N.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=Bn({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=N.backend_util.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],N.backend_util.assertAxesAreInnerMostDims("argMin",o,u.shape.length);for(var l=We(N.backend_util.computeOutAndReduceShapes(u.shape,o),2),f=l[0],h=l[1],p=N.util.sizeFromShape(f),d=N.util.makeZerosTypedArray(p,"int32"),m=N.util.sizeFromShape(h),v=t.data.get(u.dataId).values,g=0;g<d.length;++g){for(var y=g*m,w=v[y],b=0,x=0;x<m;++x){var S=v[y+x];S<w&&(w=S,b=x)}d[g]=b}return c.forEach(function(T){return t.disposeIntermediateTensorInfo(T)}),t.makeTensorInfo(f,"int32",d)}var SMe={kernelName:N.ArgMin,backendName:"cpu",kernelFunc:kMe};var NMe=Mt(N.Asin,function(r){return Math.asin(r)}),TMe={kernelName:N.Asin,backendName:"cpu",kernelFunc:NMe};var EMe=Mt(N.Asinh,function(r){return Math.asinh(r)}),IMe={kernelName:N.Asinh,backendName:"cpu",kernelFunc:EMe};var CMe=Mt(N.Atan,function(r){return Math.atan(r)}),AMe={kernelName:N.Atan,backendName:"cpu",kernelFunc:CMe};var DMe=Fr(function(r,e){return Math.atan2(r,e)}),_Me=Vr(N.Atan2,DMe),FMe={kernelName:N.Atan2,backendName:"cpu",kernelFunc:_Me};var RMe=Mt(N.Atanh,function(r){return Math.atanh(r)}),OMe={kernelName:N.Atanh,backendName:"cpu",kernelFunc:RMe};function Tx(r,e,t,n,a,i){for(var o=a.strideHeight,s=a.strideWidth,u=a.dilationHeight,c=a.dilationWidth,l=a.effectiveFilterHeight,f=a.effectiveFilterWidth,h=a.padInfo.top,p=a.padInfo.left,d=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=N.buffer(a.outShape,t),v=m.values,g=a.outShape[1]*a.outShape[2]*a.outShape[3],y=a.outShape[2]*a.outShape[3],w=a.outShape[3],b=0;b<a.batchSize;++b)for(var x=b*g,S=b*n[0],T=0;T<a.inChannels;++T)for(var E=0;E<a.outHeight;++E)for(var C=E*o-h,R=Math.max(0,C),_=Math.min(a.inHeight,l+C),O=x+E*y,$=0;$<a.outWidth;++$){for(var z=$*s-p,L=Math.max(0,z),B=Math.min(a.inWidth,f+z),W=d,X=0,J=0,V=R;V<_;V+=u){for(var j=S+V*n[1],ne=L;ne<B;ne+=c){var re=j+ne*n[2],oe=r[re+T];i==="max"&&oe>W?W=oe:i==="avg"&&(X+=oe,J++)}if(isNaN(W))break}var le=O+$*w+T;v[le]=i==="avg"?X/J:W}return m}function X$(r,e,t,n,a,i){a===void 0&&(a=!1),i===void 0&&(i=!1);for(var o=N.buffer(n.outShape,"int32"),s=n.strideHeight,u=n.strideWidth,c=n.dilationHeight,l=n.dilationWidth,f=n.effectiveFilterHeight,h=n.effectiveFilterWidth,p=n.padInfo.top,d=n.padInfo.left,m=N.buffer(e,t,r),v=0;v<n.batchSize;++v)for(var g=0;g<n.inChannels;++g)for(var y=0;y<n.outHeight;++y){for(var w=y*s-p,b=w;b<0;)b+=c;for(var x=Math.min(n.inHeight,f+w),S=0;S<n.outWidth;++S){for(var T=S*u-d,E=T;E<0;)E+=l;for(var C=Math.min(n.inWidth,h+T),R=Number.NEGATIVE_INFINITY,_=-1,O=b;O<x;O+=c)for(var $=O-w,z=E;z<C;z+=l){var L=z-T,B=m.get(v,O,z,g);B>R&&(R=B,a?_=i?((v*n.inHeight+O)*n.inWidth+z)*n.inChannels+g:(O*n.inWidth+z)*n.inChannels+g:_=$*h+L)}o.set(_,v,y,S,g)}}return o}function Y$(r,e,t,n,a,i){for(var o=a.strideDepth,s=a.strideHeight,u=a.strideWidth,c=a.dilationDepth,l=a.dilationHeight,f=a.dilationWidth,h=a.effectiveFilterDepth,p=a.effectiveFilterHeight,d=a.effectiveFilterWidth,m=a.padInfo.front,v=a.padInfo.top,g=a.padInfo.left,y=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=N.buffer(a.outShape,t),b=w.values,x=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],S=a.outShape[2]*a.outShape[3]*a.outShape[4],T=a.outShape[3]*a.outShape[4],E=a.outShape[4],C=0;C<a.batchSize;++C)for(var R=C*x,_=C*n[0],O=0;O<a.inChannels;++O)for(var $=0;$<a.outDepth;++$){for(var z=$*o-m,L=z;L<0;)L+=c;for(var B=Math.min(a.inDepth,h+z),W=R+$*S,X=0;X<a.outHeight;++X){for(var J=X*s-v,V=J;V<0;)V+=l;for(var j=Math.min(a.inHeight,p+J),ne=W+X*T,re=0;re<a.outWidth;++re){for(var oe=re*u-g,le=oe;le<0;)le+=f;for(var de=Math.min(a.inWidth,d+oe),ke=ne+re*E,he=y,ye=0,xe=0,De=L;De<B;De+=c){for(var Ye=_+De*n[1],ht=V;ht<j;ht+=l){for(var at=Ye+ht*n[2],nt=le;nt<de;nt+=f){var ft=at+nt*n[3],st=r[ft+O];if(i==="max"&&st>he?he=st:i==="avg"&&(ye+=st,xe++),isNaN(he))break}if(isNaN(he))break}if(isNaN(he))break}var Ze=ke+O;b[Ze]=i==="avg"?ye/Math.max(xe,1):he}}}return w}function PMe(r,e){for(var t=N.buffer(e.outShape,"int32"),n=e.strideDepth,a=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,s=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterDepth,l=e.effectiveFilterHeight,f=e.effectiveFilterWidth,h=e.padInfo.front,p=e.padInfo.top,d=e.padInfo.left,m=0;m<e.batchSize;++m)for(var v=0;v<e.inChannels;++v)for(var g=0;g<e.outDepth;++g){for(var y=g*n-h,w=y;w<0;)w+=o;for(var b=Math.min(e.inDepth,c+y),x=0;x<e.outHeight;++x){for(var S=x*a-p,T=S;T<0;)T+=s;for(var E=Math.min(e.inHeight,l+S),C=0;C<e.outWidth;++C){for(var R=C*i-d,_=R;_<0;)_+=u;for(var O=Math.min(e.inWidth,f+R),$=Number.NEGATIVE_INFINITY,z=-1,L=w;L<b;L+=o)for(var B=L-y,W=T;W<E;W+=s)for(var X=W-S,J=_;J<O;J+=u){var V=J-R,j=r.get(m,L,W,J,v);j>=$&&($=j,z=B*l*f+X*l+V)}t.set(z,m,g,x,C,v)}}}return t}function MMe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;Ue(a,"avgPool");var i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=1;N.util.assert(N.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=N.backend_util.computePool2DInfo(a.shape,i,o,c,s,u),f;if(l.filterWidth===1&&l.filterHeight===1&&N.util.arraysEqual(l.inShape,l.outShape))f=zi({inputs:{x:a},backend:t});else{var h=t.data.get(a.dataId).values,p=N.util.computeStrides(a.shape),d=Tx(h,a.shape,a.dtype,p,l,"avg");f=t.makeTensorInfo(l.outShape,a.dtype,d.values)}return f}var BMe={kernelName:N.AvgPool,backendName:"cpu",kernelFunc:MMe};function LMe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=n.dataFormat;Ue(a,"avgPool3d");var l=N.backend_util.computePool3DInfo(a.shape,i,o,1,s,u,c),f=t.data.get(a.dataId).values,h=Y$(f,a.shape,a.dtype,N.util.computeStrides(a.shape),l,"avg");return t.makeTensorInfo(h.shape,"float32",h.values)}var zMe={kernelName:N.AvgPool3D,backendName:"cpu",kernelFunc:LMe};function $Me(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode;Ue([a,i],"avgPool3DGrad");for(var l=N.backend_util.computePool3DInfo(i.shape,o,s,1,u,c),f=l.strideDepth,h=l.strideHeight,p=l.strideWidth,d=l.filterDepth,m=l.filterHeight,v=l.filterWidth,g=l.dilationDepth,y=l.dilationHeight,w=l.dilationWidth,b=l.effectiveFilterDepth,x=l.effectiveFilterHeight,S=l.effectiveFilterWidth,T=b-1-l.padInfo.front,E=S-1-l.padInfo.left,C=x-1-l.padInfo.top,R=N.buffer(i.shape,"float32"),_=1/(d*m*v),O=t.bufferSync(a),$=0;$<l.batchSize;++$)for(var z=0;z<l.inChannels;++z)for(var L=0;L<l.inDepth;++L)for(var B=0;B<l.inHeight;++B)for(var W=0;W<l.inWidth;++W){for(var X=L-T,J=B-C,V=W-E,j=0,ne=0;ne<b;ne+=g){var re=(X+ne)/f;if(!(re<0||re>=l.outDepth||Math.floor(re)!==re))for(var oe=0;oe<x;oe+=y){var le=(J+oe)/h;if(!(le<0||le>=l.outHeight||Math.floor(le)!==le))for(var de=0;de<S;de+=w){var ke=(V+de)/p;if(!(ke<0||ke>=l.outWidth||Math.floor(ke)!==ke)){var he=O.get($,re,le,ke,z);j+=he}}}}R.set(j*_,$,L,B,W,z)}return t.makeTensorInfo(R.shape,R.dtype,R.values)}var qMe={kernelName:N.AvgPool3DGrad,backendName:"cpu",kernelFunc:$Me};function WMe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=i;Ue([a,i],"avgPoolGrad");for(var s=n.filterSize,u=n.strides,c=n.pad,l=N.backend_util.computePool2DInfo(o.shape,s,u,1,c),f=l.strideHeight,h=l.strideWidth,p=l.filterHeight,d=l.filterWidth,m=l.dilationHeight,v=l.dilationWidth,g=l.effectiveFilterHeight,y=l.effectiveFilterWidth,w=y-1-l.padInfo.left,b=g-1-l.padInfo.top,x=N.buffer(o.shape,"float32"),S=1/(p*d),T=t.data.get(a.dataId).values,E=N.buffer(a.shape,"float32",T),C=0;C<l.batchSize;++C)for(var R=0;R<l.inChannels;++R)for(var _=0;_<l.inHeight;++_)for(var O=0;O<l.inWidth;++O){for(var $=_-b,z=O-w,L=0,B=0;B<g;B+=m){var W=($+B)/f;if(!(W<0||W>=l.outHeight||Math.floor(W)!==W))for(var X=0;X<y;X+=v){var J=(z+X)/h;if(!(J<0||J>=l.outWidth||Math.floor(J)!==J)){var V=E.get(C,W,J,R);L+=V}}}x.set(L*S,C,_,O,R)}return t.makeTensorInfo(x.shape,x.dtype,x.values)}var VMe={kernelName:N.AvgPoolGrad,backendName:"cpu",kernelFunc:WMe};function UMe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.scale,o=e.offset,s=e.mean,u=e.variance;N.util.assert(s.shape.length===u.shape.length,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),N.util.assert(o==null||s.shape.length===o.shape.length,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),N.util.assert(i==null||s.shape.length===i.shape.length,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),Ue([a,s,u,i,o],"batchNorm");var c=n.varianceEpsilon;c==null&&(c=.001);for(var l=t.data.get(a.dataId).values,f=t.data.get(s.dataId).values,h=t.data.get(u.dataId).values,p=i?t.data.get(i.dataId).values:new Float32Array([1]),d=o?t.data.get(o.dataId).values:new Float32Array([0]),m=new Float32Array(l.length),v=d.length,g=p.length,y=h.length,w=f.length,b=0,x=0,S=0,T=0,E=0;E<l.length;++E)m[E]=d[b++]+(l[E]-f[x++])*p[S++]/Math.sqrt(h[T++]+c),b>=v&&(b=0),x>=w&&(x=0),S>=g&&(S=0),T>=y&&(T=0);return t.makeTensorInfo(a.shape,a.dtype,m)}var GMe={kernelName:N.FusedBatchNorm,backendName:"cpu",kernelFunc:UMe};function HMe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockShape,o=n.crops;Ue([a],"batchToSpaceND");var s=i.reduce(function(g,y){return g*y}),u=N.backend_util.getReshaped(a.shape,i,s),c=N.backend_util.getPermuted(u.length,i.length),l=N.backend_util.getReshapedPermuted(a.shape,i,s),f=N.backend_util.getSliceBeginCoords(o,i.length),h=N.backend_util.getSliceSize(l,o,i.length),p=Vt({inputs:{x:a},backend:t,attrs:{shape:u}}),d=Bn({inputs:{x:p},backend:t,attrs:{perm:c}}),m=Vt({inputs:{x:d},backend:t,attrs:{shape:l}}),v=vu({inputs:{x:m},backend:t,attrs:{begin:f,size:h}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(m),v}var KMe={kernelName:N.BatchToSpaceND,backendName:"cpu",kernelFunc:HMe};function jMe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.weights,o=n.size,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=wx(s,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,c)}var XMe={kernelName:N.Bincount,backendName:"cpu",kernelFunc:jMe};function YMe(r){var e=r.inputs,t=r.backend,n=e.s0,a=e.s1,i=t.data.get(n.dataId).values,o=t.data.get(a.dataId).values,s=N.backend_util.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return t.makeTensorInfo([s.length],"int32",Int32Array.from(s))}var ZMe={kernelName:N.BroadcastArgs,backendName:"cpu",kernelFunc:YMe};var JMe=Mt(N.ClipByValue,function(r,e){var t=e;return r>t.clipValueMax?t.clipValueMax:r<t.clipValueMin?t.clipValueMin:r}),QMe={kernelName:N.ClipByValue,backendName:"cpu",kernelFunc:JMe};var e4e=function(r){for(var e=r.inputs.x,t=r.backend,n=new Float32Array(N.util.sizeFromShape(e.shape)),a=t.data.get(e.dataId),i=a.complexTensorInfos.real,o=a.complexTensorInfos.imag,s=t.data.get(i.dataId).values,u=t.data.get(o.dataId).values,c=0;c<s.length;c++){var l=s[c],f=u[c];n[c]=Math.hypot(l,f)}return t.makeOutput(n,e.shape,"float32")},t4e={kernelName:N.ComplexAbs,backendName:"cpu",kernelFunc:e4e};function Bc(r){var e=r.inputs,t=r.backend,n=e.input,a=t.data.get(n.dataId).complexTensorInfos.imag,i=t.data.get(a.dataId).values;return t.makeTensorInfo(a.shape,a.dtype,i)}var r4e={kernelName:N.Imag,backendName:"cpu",kernelFunc:Bc};function Lc(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.axis,i=N.util.parseAxisParam(a,e[0].shape)[0],o=e.map(function(b){return b.shape});N.backend_util.assertParamsConsistent(o,i);var s=N.backend_util.computeOutShape(e.map(function(b){return b.shape}),i);if(N.util.sizeFromShape(s)===0)return t.makeTensorInfo(s,e[0].dtype,[]);var u=e.filter(function(b){return N.util.sizeFromShape(b.shape)>0});if(u.length===1)return zi({inputs:{x:u[0]},backend:t});if(u[0].dtype==="complex64"){var c=u.map(function(b){return du({inputs:{input:b},backend:t})}),l=u.map(function(b){return Bc({inputs:{input:b},backend:t})}),f=Lc({inputs:c,backend:t,attrs:{axis:i}}),h=Lc({inputs:l,backend:t,attrs:{axis:i}}),p=ua({inputs:{real:f,imag:h},backend:t});return c.forEach(function(b){return t.disposeIntermediateTensorInfo(b)}),l.forEach(function(b){return t.disposeIntermediateTensorInfo(b)}),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),p}var d=u.map(function(b){var x=N.util.sizeFromShape(b.shape.slice(i)),S=[-1,x];return Vt({inputs:{x:b},backend:t,attrs:{shape:S}})}),m=d.map(function(b){return{vals:t.data.get(b.dataId).values,shape:b.shape}});s=N.backend_util.computeOutShape(d.map(function(b){return b.shape}),1);var v=d[0].shape[0]===1,g=t$(m,s,e[0].dtype,v),y=N.backend_util.computeOutShape(u.map(function(b){return b.shape}),i),w=t.makeTensorInfo(y,e[0].dtype,g);return d.forEach(function(b){return t.disposeIntermediateTensorInfo(b)}),w}var n4e={kernelName:N.Concat,backendName:"cpu",kernelFunc:Lc};function Z$(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dataFormat,c=n.dilations,l=n.dimRoundingMode;Ue([a,i],"conv2d");for(var f=N.backend_util.convertConv2DDataFormat(u),h=N.backend_util.computeConv2DInfo(a.shape,i.shape,o,c,s,l,!1,f),p=h.filterHeight,d=h.filterWidth,m=h.dilationHeight,v=h.dilationWidth,g=h.padInfo.left,y=h.padInfo.top,w=h.dataFormat==="channelsLast",b=new N.TensorBuffer(h.outShape,a.dtype),x=N.util.computeStrides(a.shape),S=N.util.computeStrides(i.shape),T=x[0],E=w?x[1]:x[2],C=w?x[2]:1,R=w?1:x[1],_=b.strides[0],O=w?b.strides[1]:b.strides[2],$=w?b.strides[2]:1,z=w?1:b.strides[1],L=t.data.get(a.dataId).values,B=t.data.get(i.dataId).values,W=b.values,X=0;X<h.batchSize;++X)for(var J=X*T,V=X*_,j=0;j<h.outHeight;++j)for(var ne=V+j*O,re=j*h.strideHeight-y,oe=0;oe<p;++oe){var le=re+oe*m;if(!(le<0||le>=h.inHeight))for(var de=oe*S[0],ke=J+le*E,he=0;he<h.outWidth;++he)for(var ye=ne+he*$,xe=he*h.strideWidth-g,De=0;De<d;++De){var Ye=xe+De*v;if(!(Ye<0||Ye>=h.inWidth))for(var ht=de+De*S[1],at=ke+Ye*C,nt=ht,ft=0;ft<h.inChannels;++ft){for(var st=L[at+ft*R],Ze=0;Ze<h.outChannels;++Ze)W[ye+Ze*z]+=st*B[nt+Ze];nt+=h.outChannels}}}return t.makeTensorInfo(b.shape,b.dtype,W)}var a4e={kernelName:N.Conv2D,backendName:"cpu",kernelFunc:Z$};function i4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode,l=n.filterShape;Ue([a,i],"conv2dBackpropFilter");for(var f=N.backend_util.convertConv2DDataFormat(u),h=N.backend_util.computeConv2DInfo(a.shape,l,o,1,s,c,!1,f),p=h.strideHeight,d=h.strideWidth,m=h.filterHeight,v=h.filterWidth,g=h.dataFormat==="channelsLast",y=new N.TensorBuffer(h.filterShape,"float32"),w=h.padInfo.left,b=h.padInfo.top,x=t.data.get(a.dataId).values,S=t.data.get(i.dataId).values,T=new N.TensorBuffer(a.shape,a.dtype,x),E=new N.TensorBuffer(i.shape,i.dtype,S),C=0;C<m;++C)for(var R=Math.max(0,Math.ceil((b-C)/p)),_=Math.min(h.outHeight,(h.inHeight+b-C)/p),O=0;O<v;++O)for(var $=Math.max(0,Math.ceil((w-O)/d)),z=Math.min(h.outWidth,(h.inWidth+w-O)/d),L=0;L<h.inChannels;++L)for(var B=0;B<h.outChannels;++B){for(var W=0,X=0;X<h.batchSize;++X)for(var J=R;J<_;++J)for(var V=C+J*p-b,j=$;j<z;++j){var ne=O+j*d-w;g?W+=T.get(X,V,ne,L)*E.get(X,J,j,B):W+=T.get(X,L,V,ne)*E.get(X,B,J,j)}y.set(W,C,O,L,B)}return t.makeTensorInfo(y.shape,y.dtype,y.values)}var o4e={kernelName:N.Conv2DBackpropFilter,backendName:"cpu",kernelFunc:i4e};function s4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.inputShape,s=n.strides,u=n.pad,c=n.dataFormat,l=n.dimRoundingMode;Ue([a,i],"conv2dBackpropInput");var f=N.util.computeStrides(i.shape),h=N.util.computeStrides(a.shape),p=N.backend_util.convertConv2DDataFormat(c),d=N.backend_util.computeConv2DInfo(o,i.shape,s,1,u,l,!1,p),m=new N.TensorBuffer(d.inShape,"float32"),v=m.values,g=t.data.get(a.dataId).values,y=t.data.get(i.dataId).values,w=We(f,3),b=w[0],x=w[1],S=w[2],T=d.batchSize,E=d.filterHeight,C=d.filterWidth,R=d.inChannels,_=d.inHeight,O=d.inWidth,$=d.outChannels,z=d.outHeight,L=d.outWidth,B=d.strideHeight,W=d.strideWidth;p=d.dataFormat;for(var X=E-1-d.padInfo.top,J=C-1-d.padInfo.left,V=p==="channelsLast",j=m.strides[0],ne=V?m.strides[1]:m.strides[2],re=V?m.strides[2]:1,oe=V?1:m.strides[1],le=h[0],de=V?h[1]:h[2],ke=V?h[2]:1,he=V?1:h[1],ye=0;ye<T;++ye)for(var xe=0;xe<R;++xe)for(var De=0;De<_;++De)for(var Ye=De-X,ht=Math.max(0,Math.ceil(Ye/B)),at=Math.min(z,(E+Ye)/B),nt=0;nt<O;++nt){for(var ft=nt-J,st=Math.max(0,Math.ceil(ft/W)),Ze=Math.min(L,(C+ft)/W),tt=0,et=ht;et<at;++et)for(var nr=et*B-Ye,He=st;He<Ze;++He)for(var kt=He*W-ft,Ir=le*ye+de*et+ke*He,vn=b*(E-1-nr)+x*(C-1-kt)+S*xe,Pr=0;Pr<$;++Pr){var Cr=g[Ir+he*Pr],ar=y[vn+Pr];tt+=Cr*ar}var zn=j*ye+ne*De+re*nt+oe*xe;v[zn]=tt}return t.makeTensorInfo(m.shape,m.dtype,m.values)}var u4e={kernelName:N.Conv2DBackpropInput,backendName:"cpu",kernelFunc:s4e};function c4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations;Ue([a,i],"conv3d");for(var c=N.backend_util.computeConv3DInfo(a.shape,i.shape,o,u,s),l=c.filterDepth,f=c.filterHeight,h=c.filterWidth,p=c.dilationDepth,d=c.dilationHeight,m=c.dilationWidth,v=c.padInfo,g=v.front,y=v.left,w=v.top,b=new N.TensorBuffer(c.outShape,a.dtype),x=t.data.get(a.dataId).values,S=t.data.get(i.dataId).values,T=b.values,E=N.util.computeStrides(a.shape),C=N.util.computeStrides(i.shape),R=0;R<c.batchSize;++R)for(var _=R*E[0],O=R*b.strides[0],$=0;$<c.outDepth;++$)for(var z=O+$*b.strides[1],L=$*c.strideDepth-g,B=0;B<l;++B){var W=L+B*p;if(!(W<0||W>=c.inDepth))for(var X=B*C[0],J=_+W*E[1],V=0;V<c.outHeight;++V)for(var j=z+V*b.strides[2],ne=V*c.strideHeight-w,re=0;re<f;++re){var oe=ne+re*d;if(!(oe<0||oe>=c.inHeight))for(var le=X+re*C[1],de=J+oe*E[2],ke=0;ke<c.outWidth;++ke)for(var he=j+ke*c.outChannels,ye=ke*c.strideWidth-y,xe=0;xe<h;++xe){var De=ye+xe*m;if(!(De<0||De>=c.inWidth))for(var Ye=le+xe*C[2],ht=de+De*c.inChannels,at=Ye,nt=0;nt<c.inChannels;++nt){for(var ft=x[ht+nt],st=0;st<c.outChannels;++st)T[he+st]+=ft*S[at+st];at+=c.outChannels}}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}var l4e={kernelName:N.Conv3D,backendName:"cpu",kernelFunc:c4e};function f4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.pad,u=n.filterShape;Ue([a,i],"conv3dBackpropFilterV2");for(var c=N.util.computeStrides(a.shape),l=N.util.computeStrides(i.shape),f=N.backend_util.computeConv3DInfo(a.shape,u,o,1,s),h=f.strideDepth,p=f.strideHeight,d=f.strideWidth,m=f.filterDepth,v=f.filterHeight,g=f.filterWidth,y=new N.TensorBuffer(f.filterShape,"float32"),w=y.values,b=We(y.strides,4),x=b[0],S=b[1],T=b[2],E=b[3],C=t.data.get(i.dataId).values,R=We(l,4),_=R[0],O=R[1],$=R[2],z=R[3],L=t.data.get(a.dataId).values,B=We(c,4),W=B[0],X=B[1],J=B[2],V=B[3],j=f.padInfo.front,ne=f.padInfo.left,re=f.padInfo.top,oe=0;oe<m;++oe)for(var le=Math.max(0,Math.ceil((j-oe)/h)),de=Math.min(f.outDepth,(f.inDepth+j-oe)/h),ke=oe*x,he=0;he<v;++he)for(var ye=Math.max(0,Math.ceil((re-he)/p)),xe=Math.min(f.outHeight,(f.inHeight+re-he)/p),De=he*S+ke,Ye=0;Ye<g;++Ye)for(var ht=Math.max(0,Math.ceil((ne-Ye)/d)),at=Math.min(f.outWidth,(f.inWidth+ne-Ye)/d),nt=Ye*T+De,ft=0;ft<f.inChannels;++ft)for(var st=ft*E+nt,Ze=0;Ze<f.outChannels;++Ze){for(var tt=0,et=0;et<f.batchSize;++et)for(var nr=et*W,He=et*_,kt=le;kt<de;++kt)for(var Ir=oe+kt*h-j,vn=Ir*X+nr,Pr=kt*O+He,Cr=ye;Cr<xe;++Cr)for(var ar=he+Cr*p-re,zn=ar*J+vn,mn=Cr*$+Pr,$n=ht;$n<at;++$n){var Sr=Ye+$n*d-ne,Ki=Sr*V+zn,Fu=$n*z+mn;tt+=L[Ki+ft]*C[Fu+Ze]}w[st+Ze]=tt}return t.makeTensorInfo(y.shape,y.dtype,y.values)}var h4e={kernelName:N.Conv3DBackpropFilterV2,backendName:"cpu",kernelFunc:f4e};function p4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.pad,s=n.strides,u=n.inputShape;Ue([a],"conv3dBackpropInputV2");for(var c=N.util.computeStrides(a.shape),l=N.util.computeStrides(i.shape),f=N.backend_util.computeConv3DInfo(u,i.shape,s,1,o),h=new N.TensorBuffer(f.inShape,"float32"),p=h.values,d=We(h.strides,4),m=d[0],v=d[1],g=d[2],y=d[3],w=t.data.get(a.dataId).values,b=We(c,4),x=b[0],S=b[1],T=b[2],E=b[3],C=t.data.get(i.dataId).values,R=We(l,4),_=R[0],O=R[1],$=R[2],z=R[3],L=f.batchSize,B=f.filterDepth,W=f.filterHeight,X=f.filterWidth,J=f.inChannels,V=f.inDepth,j=f.inHeight,ne=f.inWidth,re=f.outChannels,oe=f.outDepth,le=f.outHeight,de=f.outWidth,ke=f.strideDepth,he=f.strideHeight,ye=f.strideWidth,xe=B-1-f.padInfo.front,De=W-1-f.padInfo.top,Ye=X-1-f.padInfo.left,ht=0;ht<L;++ht)for(var at=0;at<J;++at)for(var nt=0;nt<V;++nt)for(var ft=nt-xe,st=Math.max(0,Math.ceil(ft/ke)),Ze=Math.min(oe,(B+ft)/ke),tt=0;tt<j;++tt)for(var et=tt-De,nr=Math.max(0,Math.ceil(et/he)),He=Math.min(le,(W+et)/he),kt=0;kt<ne;++kt){for(var Ir=kt-Ye,vn=Math.max(0,Math.ceil(Ir/ye)),Pr=Math.min(de,(X+Ir)/ye),Cr=0,ar=st;ar<Ze;++ar)for(var zn=ar*ke-ft,mn=nr;mn<He;++mn)for(var $n=mn*he-et,Sr=vn;Sr<Pr;++Sr)for(var Ki=Sr*ye-Ir,Fu=x*ht+S*ar+T*mn+E*Sr,Gh=_*(B-1-zn)+O*(W-1-$n)+$*(X-1-Ki)+z*at,ji=0;ji<re;++ji){var hs=w[Fu+ji],Ru=C[Gh+ji];Cr+=hs*Ru}p[m*ht+v*nt+g*tt+y*kt+at]=Cr}return t.makeTensorInfo(h.shape,h.dtype,h.values)}var d4e={kernelName:N.Conv3DBackpropInputV2,backendName:"cpu",kernelFunc:p4e};var v4e=Mt(N.Cos,function(r){return Math.cos(r)}),m4e={kernelName:N.Cos,backendName:"cpu",kernelFunc:v4e};var g4e=Mt(N.Cosh,function(r){return Math.cosh(r)}),y4e={kernelName:N.Cosh,backendName:"cpu",kernelFunc:g4e};function b4e(r){for(var e=r.inputs,t=r.backend,n=r.attrs,a=e.image,i=e.boxes,o=e.boxInd,s=n.cropSize,u=n.method,c=n.extrapolationValue,l=We(a.shape,4),f=l[0],h=l[1],p=l[2],d=l[3],m=i.shape[0],v=We(s,2),g=v[0],y=v[1],w=N.buffer([m,g,y,d],"float32"),b=t.data.get(i.dataId).values,x=t.data.get(o.dataId).values,S=t.data.get(a.dataId).values,T=N.util.computeStrides(a.shape),E=N.util.computeStrides(w.shape),C=0;C<m;C++){var R=C*4,_=b[R],O=b[R+1],$=b[R+2],z=b[R+3],L=x[C];if(!(L>=f))for(var B=g>1?($-_)*(h-1)/(g-1):0,W=y>1?(z-O)*(p-1)/(y-1):0,X=0;X<g;X++){var J=g>1?_*(h-1)+X*B:.5*(_+$)*(h-1);if(J<0||J>h-1){for(var V=0;V<y;V++)for(var j=0;j<d;j++){var ne=j+V*E[2]+X*E[1]+C*E[0];w.values[ne]=c}continue}if(u==="bilinear")for(var re=Math.floor(J),oe=Math.ceil(J),le=J-re,V=0;V<y;V++){var de=y>1?O*(p-1)+V*W:.5*(O+z)*(p-1);if(de<0||de>p-1){for(var j=0;j<d;j++){var ne=j+V*E[2]+X*E[1]+C*E[0];w.values[ne]=c}continue}for(var ke=Math.floor(de),he=Math.ceil(de),ye=de-ke,j=0;j<d;j++){var ne=j+ke*T[2]+re*T[1]+L*T[0],xe=S[ne];ne=j+he*T[2]+re*T[1]+L*T[0];var De=S[ne];ne=j+ke*T[2]+oe*T[1]+L*T[0];var Ye=S[ne];ne=j+he*T[2]+oe*T[1]+L*T[0];var ht=S[ne],at=xe+(De-xe)*ye,nt=Ye+(ht-Ye)*ye;ne=j+V*E[2]+X*E[1]+C*E[0],w.values[ne]=at+(nt-at)*le}}else for(var V=0;V<y;++V){var de=y>1?O*(p-1)+V*W:.5*(O+z)*(p-1);if(de<0||de>p-1){for(var j=0;j<d;j++){var ne=j+V*E[2]+X*E[1]+C*E[0];w.values[ne]=c}continue}for(var ft=Math.round(de),st=Math.round(J),j=0;j<d;j++){var Ze=j+ft*T[2]+st*T[1]+L*T[0],tt=j+V*E[2]+X*E[1]+C*E[0];w.values[tt]=S[Ze]}}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}var w4e={kernelName:N.CropAndResize,backendName:"cpu",kernelFunc:b4e};function x4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.exclusive,s=n.reverse;Ue(a,"cumprod");var u=N.backend_util.getAxesPermutation([i],a.shape.length),c=a;u!=null&&(c=Bn({inputs:{x:a},backend:t,attrs:{perm:u}}));var l=N.backend_util.getInnerMostAxes(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var f=N.upcastType(c.dtype,"int32"),h=N.util.makeOnesTypedArray(N.util.sizeFromShape(c.shape),f),p=t.data.get(c.dataId).values,d=c.shape[c.shape.length-1],m=s?function(T,E){return T+d-E-1}:function(T,E){return T+E},v=0;v<p.length;v+=d)for(var g=0;g<d;g++){var y=m(v,g);if(g===0)h[y]=o?1:p[y];else{var w=m(v,g-1);h[y]=o?p[w]*h[w]:p[y]*h[w]}}var b=t.makeTensorInfo(c.shape,f,h);if(u!=null){var x=N.backend_util.getUndoAxesPermutation(u),S=Bn({inputs:{x:b},backend:t,attrs:{perm:x}});return t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(c),S}return b}var k4e={kernelName:N.Cumprod,backendName:"cpu",kernelFunc:x4e};function S4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.exclusive,s=n.reverse;Ue(a,"cumsum");var u=N.backend_util.getAxesPermutation([i],a.shape.length),c=a;u!=null&&(c=Bn({inputs:{x:a},backend:t,attrs:{perm:u}}));var l=N.backend_util.getInnerMostAxes(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var f=N.upcastType(c.dtype,"int32"),h=N.util.makeZerosTypedArray(N.util.sizeFromShape(c.shape),f),p=t.data.get(c.dataId).values,d=c.shape[c.shape.length-1],m=s?function(T,E){return T+d-E-1}:function(T,E){return T+E},v=0;v<p.length;v+=d)for(var g=0;g<d;g++){var y=m(v,g);if(g===0)h[y]=o?0:p[y];else{var w=m(v,g-1);h[y]=o?p[w]+h[w]:p[y]+h[w]}}var b=t.makeTensorInfo(c.shape,f,h);if(u!=null){var x=N.backend_util.getUndoAxesPermutation(u),S=Bn({inputs:{x:b},backend:t,attrs:{perm:x}});return t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(c),S}return b}var N4e={kernelName:N.Cumsum,backendName:"cpu",kernelFunc:S4e};function T4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.weights,o=n.size,s=n.binaryOutput;if(a.shape.length===1){var u=t.data.get(a.dataId).values,c=t.data.get(i.dataId).values,l=wx(u,c,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,l)}else if(a.shape.length===2){var f=t.bufferSync(a),h=t.bufferSync(i),p=Jz(f,h,o,s);return t.makeTensorInfo(p.shape,i.dtype,p.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}var E4e={kernelName:N.DenseBincount,backendName:"cpu",kernelFunc:T4e};function I4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockSize,o=n.dataFormat;N.util.assert(o==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(o)});for(var s=a.shape[0],u=a.shape[1],c=a.shape[2],l=a.shape[3],f=u*i,h=c*i,p=l/(i*i),d=t.data.get(a.dataId).values,m=new Float32Array(s*f*h*p),v=0,g=0;g<s;++g)for(var y=0;y<f;++y)for(var w=Math.floor(y/i),b=y%i,x=0;x<h;++x)for(var S=Math.floor(x/i),T=x%i,E=(b*i+T)*p,C=0;C<p;++C){var R=C+E,_=R+l*(S+c*(w+u*g));m[v++]=d[_]}return t.makeTensorInfo([s,f,h,p],a.dtype,m)}var C4e={kernelName:N.DepthToSpace,backendName:"cpu",kernelFunc:I4e};function J$(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,c=n.dimRoundingMode;Ue([a,i],"depthwiseConv2DNative");var l=N.util.computeStrides(a.shape),f=N.util.computeStrides(i.shape),h=u;h==null&&(h=[1,1]),N.util.assert(N.backend_util.eitherStridesOrDilationsAreOne(o,h),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(h,"'")});for(var p=N.backend_util.computeConv2DInfo(a.shape,i.shape,o,h,s,c,!0),d=p.filterHeight,m=p.filterWidth,v=p.dilationHeight,g=p.dilationWidth,y=p.padInfo,w=y.left,b=y.top,x=p.outChannels/p.inChannels,S=new N.TensorBuffer(p.outShape,a.dtype),T=t.data.get(a.dataId).values,E=t.data.get(i.dataId).values,C=S.values,R=0;R<p.batchSize;++R)for(var _=R*l[0],O=R*S.strides[0],$=0;$<p.outHeight;++$)for(var z=O+$*S.strides[1],L=$*p.strideHeight-b,B=0;B<d;++B){var W=L+B*v;if(!(W<0||W>=p.inHeight))for(var X=B*f[0],J=_+W*l[1],V=0;V<p.outWidth;++V)for(var j=z+V*S.strides[2],ne=V*p.strideWidth-w,re=0;re<m;++re){var oe=ne+re*g;if(!(oe<0||oe>=p.inWidth))for(var le=X+re*f[1],de=J+oe*p.inChannels,ke=j,he=le,ye=0;ye<p.inChannels;++ye){for(var xe=T[de+ye],De=0;De<x;++De)C[ke+De]+=xe*E[he+De];ke+=x,he+=x}}}return t.makeTensorInfo(S.shape,S.dtype,S.values)}var A4e={kernelName:N.DepthwiseConv2dNative,backendName:"cpu",kernelFunc:J$};function D4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.dilations,u=n.pad,c=n.dimRoundingMode,l=n.filterShape;Ue([a,i],"depthwiseConv2dNativeBackpropFilter");for(var f=N.backend_util.computeConv2DInfo(a.shape,l,o,s,u,c,!0),h=f.strideHeight,p=f.strideWidth,d=f.filterHeight,m=f.filterWidth,v=new N.TensorBuffer(f.filterShape,"float32"),g=f.padInfo.left,y=f.padInfo.top,w=f.outChannels/f.inChannels,b=t.data.get(a.dataId).values,x=new N.TensorBuffer(a.shape,a.dtype,b),S=t.data.get(i.dataId).values,T=new N.TensorBuffer(i.shape,i.dtype,S),E=0;E<d;++E)for(var C=Math.max(0,Math.ceil((y-E)/h)),R=Math.min(f.outHeight,(f.inHeight+y-E)/h),_=0;_<m;++_)for(var O=Math.max(0,Math.ceil((g-_)/p)),$=Math.min(f.outWidth,(f.inWidth+g-_)/p),z=0;z<f.outChannels;++z){for(var L=Math.trunc(z/w),B=z%w,W=0,X=0;X<f.batchSize;++X)for(var J=C;J<R;++J)for(var V=E+J*h-y,j=O;j<$;++j){var ne=_+j*p-g;W+=x.get(X,V,ne,L)*T.get(X,J,j,z)}v.set(W,E,_,L,B)}return t.makeTensorInfo(v.shape,v.dtype,v.values)}var _4e={kernelName:N.DepthwiseConv2dNativeBackpropFilter,backendName:"cpu",kernelFunc:D4e};function F4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.strides,s=n.dilations,u=n.pad,c=n.dimRoundingMode,l=n.inputShape;Ue([a,i],"depthwiseConv2DNativeBackpropInput");for(var f=N.util.computeStrides(a.shape),h=N.util.computeStrides(i.shape),p=N.backend_util.computeConv2DInfo(l,i.shape,o,s,u,c,!0),d=new N.TensorBuffer(p.inShape,"float32"),m=d.values,v=We(d.strides,3),g=v[0],y=v[1],w=v[2],b=t.data.get(a.dataId).values,x=We(f,3),S=x[0],T=x[1],E=x[2],C=t.data.get(i.dataId).values,R=We(h,3),_=R[0],O=R[1],$=R[2],z=p.batchSize,L=p.filterHeight,B=p.filterWidth,W=p.inChannels,X=p.inHeight,J=p.inWidth,V=p.outChannels,j=p.outHeight,ne=p.outWidth,re=p.strideHeight,oe=p.strideWidth,le=L-1-p.padInfo.top,de=B-1-p.padInfo.left,ke=V/W,he=0;he<z;++he)for(var ye=0;ye<W;++ye)for(var xe=0;xe<X;++xe)for(var De=xe-le,Ye=Math.max(0,Math.ceil(De/re)),ht=Math.min(j,(L+De)/re),at=0;at<J;++at){for(var nt=at-de,ft=Math.max(0,Math.ceil(nt/oe)),st=Math.min(ne,(B+nt)/oe),Ze=0,tt=Ye;tt<ht;++tt)for(var et=tt*re-De,nr=ft;nr<st;++nr)for(var He=nr*oe-nt,kt=S*he+T*tt+E*nr,Ir=_*(L-1-et)+O*(B-1-He)+$*ye,vn=0;vn<ke;++vn){var Pr=ye*ke+vn,Cr=b[kt+Pr],ar=C[Ir+vn];Ze+=Cr*ar}m[g*he+y*xe+w*at+ye]=Ze}return t.makeTensorInfo(d.shape,d.dtype,d.values)}var R4e={kernelName:N.DepthwiseConv2dNativeBackpropInput,backendName:"cpu",kernelFunc:F4e};function O4e(r){for(var e=r.inputs,t=r.backend,n=e.x,a=N.util.sizeFromShape(n.shape),i=t.data.get(n.dataId).values,o=N.buffer([a,a],n.dtype),s=o.values,u=0;u<i.length;u++)s[u*a+u]=i[u];var c=wa(wa([],We(n.shape),!1),We(n.shape),!1);return t.makeTensorInfo(c,o.dtype,o.values)}var P4e={kernelName:N.Diag,backendName:"cpu",kernelFunc:O4e};var M4e={kernelName:N.Dilation2D,backendName:"cpu",kernelFunc:function(r){for(var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,c=t,l=c.data.get(a.dataId).values,f=a.shape.length,h=c.data.get(i.dataId).values,p=i.shape.length,d=N.backend_util.computeDilation2DInfo(a.shape,i.shape,o,s,"NHWC",u),m=d.batchSize,v=d.inHeight,g=d.inWidth,y=d.inChannels,w=d.outHeight,b=d.outWidth,x=d.padInfo,S=d.strideHeight,T=d.strideWidth,E=d.filterHeight,C=d.filterWidth,R=d.dilationHeight,_=d.dilationWidth,O=d.outShape,$=N.util.sizeFromShape(O),z=O.length,L=N.util.getArrayFromDType(a.dtype,$),B=0;B<m;++B)for(var W=0;W<w;++W)for(var X=W*S-x.top,J=0;J<b;++J)for(var V=J*T-x.left,j=0;j<y;++j){for(var ne=Number.MIN_SAFE_INTEGER,re=0;re<E;++re){var oe=X+re*R;if(oe>=0&&oe<v)for(var le=0;le<C;++le){var de=V+le*_;if(de>=0&&de<g){var ke=N.util.locToIndex([B,oe,de,j],f,N.util.computeStrides(a.shape)),he=N.util.locToIndex([re,le,j],p,N.util.computeStrides(i.shape)),ye=l[ke]+h[he];ye>ne&&(ne=ye)}}}var xe=N.util.locToIndex([B,W,J,j],z,N.util.computeStrides(O));L[xe]=ne}var De=c.write(N.util.toTypedArray(L,a.dtype),O,a.dtype);return{dataId:De,shape:O,dtype:a.dtype}}};var B4e={kernelName:N.Dilation2DBackpropFilter,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.dy,s=n.strides,u=n.pad,c=n.dilations,l=t,f=N.util.toNestedArray(a.shape,l.data.get(a.dataId).values),h=N.util.toNestedArray(i.shape,l.data.get(i.dataId).values),p=N.backend_util.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),d=p.batchSize,m=p.inHeight,v=p.inWidth,g=p.inChannels,y=p.outHeight,w=p.outWidth,b=p.padInfo,x=p.strideHeight,S=p.strideWidth,T=p.filterHeight,E=p.filterWidth,C=p.dilationHeight,R=p.dilationWidth,_=p.outShape;N.util.assert(o.rank===_.length,function(){return"Error in ".concat(N.Dilation2DBackpropFilter,", dy ")+"must have the same rank as output ".concat(_.length,", but got ")+"".concat(o.rank)});for(var O=N.util.toNestedArray(_,l.data.get(o.dataId).values),$=N.util.makeZerosNestedTypedArray(i.shape,i.dtype),z=0;z<d;++z)for(var L=0;L<y;++L)for(var B=L*x-b.top,W=0;W<w;++W)for(var X=W*S-b.left,J=0;J<g;++J){for(var V=Number.MIN_SAFE_INTEGER,j=0,ne=0,re=0;re<T;++re){var oe=B+re*C;if(oe>=0&&oe<m)for(var le=0;le<E;++le){var de=X+le*R;if(de>=0&&de<v){var ke=f[z][oe][de][J]+h[re][le][J];ke>V&&(V=ke,j=re,ne=le)}}}$[j][ne][J]+=O[z][L][W][J]}var he=l.write(N.util.toTypedArray($,a.dtype),i.shape,i.dtype);return{dataId:he,shape:i.shape,dtype:i.dtype}}};var L4e={kernelName:N.Dilation2DBackpropInput,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.dy,s=n.strides,u=n.pad,c=n.dilations,l=t,f=N.util.toNestedArray(a.shape,l.data.get(a.dataId).values),h=N.util.toNestedArray(i.shape,l.data.get(i.dataId).values),p=N.backend_util.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),d=p.batchSize,m=p.inHeight,v=p.inWidth,g=p.inChannels,y=p.outHeight,w=p.outWidth,b=p.padInfo,x=p.strideHeight,S=p.strideWidth,T=p.filterHeight,E=p.filterWidth,C=p.dilationHeight,R=p.dilationWidth,_=p.outShape;N.util.assert(o.rank===_.length,function(){return"Error in ".concat(N.Dilation2DBackpropInput,", dy ")+"must have the same rank as output ".concat(_.length,", but got ")+"".concat(o.rank)});for(var O=N.util.toNestedArray(_,l.data.get(o.dataId).values),$=N.util.makeZerosNestedTypedArray(a.shape,a.dtype),z=0;z<d;++z)for(var L=0;L<y;++L)for(var B=L*x-b.top,W=0;W<w;++W)for(var X=W*S-b.left,J=0;J<g;++J){for(var V=Number.MIN_SAFE_INTEGER,j=B<0?0:B,ne=X<0?0:X,re=0;re<T;++re){var oe=B+re*C;if(oe>=0&&oe<m)for(var le=0;le<E;++le){var de=X+le*R;if(de>=0&&de<v){var ke=f[z][oe][de][J]+h[re][le][J];ke>V&&(V=ke,j=oe,ne=de)}}}$[z][j][ne][J]+=O[z][L][W][J]}var he=l.write(N.util.toTypedArray($,a.dtype),a.shape,a.dtype);return{dataId:he,shape:a.shape,dtype:a.dtype}}};function z4e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.image,i=n.canvas,o=n.options,s=o||{},u=s.contextOptions,c=s.imageOptions,l=c?.alpha||1,f=u?.contextType||"2d";if(f!=="2d")throw new Error("Context type ".concat(u.contextType," is not supported by the CPU backend."));var h=i.getContext(f,u?.contextAttributes||{});if(h==null)throw new Error("Could not get the context with ".concat(f," type."));for(var p=We(a.shape.slice(0,2),2),d=p[0],m=p[1],v=a.shape.length===2?1:a.shape[2],g=t.data.get(a.dataId).values,y=a.dtype==="float32"?255:1,w=new Uint8ClampedArray(m*d*4),b=0;b<d*m;++b){for(var x=[0,0,0,255*l],S=0;S<v;S++){var T=g[b*v+S];if(a.dtype==="float32"){if(T<0||T>1)throw new Error("Tensor values for a float32 Tensor must be in the "+"range [0 - 1] but encountered ".concat(T,"."))}else if(a.dtype==="int32"&&(T<0||T>255))throw new Error("Tensor values for a int32 Tensor must be in the "+"range [0 - 255] but encountered ".concat(T,"."));v===1?(x[0]=T*y,x[1]=T*y,x[2]=T*y):x[S]=T*y}var E=b*4;w[E+0]=Math.round(x[0]),w[E+1]=Math.round(x[1]),w[E+2]=Math.round(x[2]),w[E+3]=Math.round(x[3])}i.width=m,i.height=d;var C=new ImageData(w,m,d);return h.putImageData(C,0,0),a}var $4e={kernelName:N.Draw,backendName:"cpu",kernelFunc:z4e};function oh(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;Ue(a,"sum");var s;a.dtype==="bool"?s=ns({inputs:{x:a},backend:t,attrs:{dtype:"int32"}}):s=zi({inputs:{x:a},backend:t});var u=s.shape.length,c=N.util.parseAxisParam(i,s.shape),l=N.backend_util.getAxesPermutation(c,u),f=c,h=s;l!=null&&(h=Bn({inputs:{x:s},backend:t,attrs:{perm:l}}),f=N.backend_util.getInnerMostAxes(f.length,u)),N.backend_util.assertAxesAreInnerMostDims("sum",f,h.shape.length);for(var p=We(N.backend_util.computeOutAndReduceShapes(h.shape,f),2),d=p[0],m=p[1],v=N.backend_util.upcastType(h.dtype,"int32"),g=Yv(t,d,v),y=N.util.sizeFromShape(m),w=t.data.get(g.dataId).values,b=t.data.get(h.dataId).values,x=0;x<w.length;++x){for(var S=x*y,T=0,E=0;E<y;++E)T+=b[S+E];w[x]=T}if(o){var C=N.backend_util.expandShapeToKeepDim(g.shape,c),R=g;g=Vt({inputs:{x:g},backend:t,attrs:{shape:C}}),t.disposeIntermediateTensorInfo(R)}return t.disposeIntermediateTensorInfo(s),l!=null&&t.disposeIntermediateTensorInfo(h),g}var q4e={kernelName:N.Sum,backendName:"cpu",kernelFunc:oh};function W4e(r){var e,t,n,a,i=r.inputs,o=r.backend,s=r.attrs,u=s.equation,c=i,l=N.backend_util.decodeEinsumEquation(u,c.length),f=l.allDims,h=l.summedDims,p=l.idDims;N.backend_util.checkEinsumDimSizes(f.length,p,c);for(var d=N.backend_util.getEinsumComputePath(h,p),m=d.path,v=d.steps,g=v.length,y=null,w=f.length,b=[],x=0;x<g;++x){try{for(var S=(e=void 0,Pc(v[x])),T=S.next();!T.done;T=S.next()){var E=T.value,C=N.backend_util.getEinsumPermutation(w,p[E]),R=C.permutationIndices,_=C.expandDims,O=void 0;N.backend_util.isIdentityPermutation(R)?O=c[E]:(O=Bn({inputs:{x:c[E]},backend:o,attrs:{perm:R}}),b.push(O));for(var $=O.shape.slice(),z=0;z<_.length;++z)$.splice(_[z],0,1);N.util.arraysEqual(O.shape,$)||(O=Vt({inputs:{x:O},backend:o,attrs:{shape:$}}),b.push(O)),y===null?y=O:(y=em({inputs:{a:O,b:y},backend:o}),b.push(y))}}catch(X){e={error:X}}finally{try{T&&!T.done&&(t=S.return)&&t.call(S)}finally{if(e)throw e.error}}x<g-1&&(m[x]>=0&&(y=oh({inputs:{x:y},backend:o,attrs:{axis:m[x]-(f.length-w),keepDims:!1}}),b.push(y)),w--)}try{for(var L=Pc(b),B=L.next();!B.done;B=L.next()){var W=B.value;W!==y&&o.disposeIntermediateTensorInfo(W)}}catch(X){n={error:X}}finally{try{B&&!B.done&&(a=L.return)&&a.call(L)}finally{if(n)throw n.error}}return y}var V4e={kernelName:N.Einsum,backendName:"cpu",kernelFunc:W4e};function U4e(r){var e=r.inputs,t=r.backend,n=e.dy,a=e.y;Ue([n,a],"eluGrad");for(var i=new Float32Array(N.util.sizeFromShape(a.shape)),o=t.data.get(a.dataId).values,s=t.data.get(n.dataId).values,u=0;u<o.length;++u){var c=o[u];c>=0?i[u]=s[u]:i[u]=s[u]*(c+1)}return t.makeTensorInfo(a.shape,"float32",i)}var G4e={kernelName:N.EluGrad,backendName:"cpu",kernelFunc:U4e};var H4e=N.backend_util.ERF_P,K4e=N.backend_util.ERF_A1,j4e=N.backend_util.ERF_A2,X4e=N.backend_util.ERF_A3,Y4e=N.backend_util.ERF_A4,Z4e=N.backend_util.ERF_A5,J4e=Mt(N.Erf,function(r){var e=Math.sign(r),t=Math.abs(r),n=1/(1+H4e*t);return e*(1-((((Z4e*n+Y4e)*n+X4e)*n+j4e)*n+K4e)*n*Math.exp(-t*t))}),Q4e={kernelName:N.Erf,backendName:"cpu",kernelFunc:J4e};function Jv(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.input,i=n.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(N.util.assert(-(o+1)<=i,function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")}),u=o+i+1),s.splice(u,0,1),Vt({inputs:{x:a},backend:t,attrs:{shape:s}})}var eBe={kernelName:N.ExpandDims,backendName:"cpu",kernelFunc:Jv};var tBe=Fr(function(r,e){return r/e}),Ex=Vr(N.RealDiv,tBe),mx={kernelName:N.RealDiv,backendName:"cpu",kernelFunc:Ex};function Q$(r,e,t){for(var n=r.shape,a=n[0],i=n[1],o=t.data.get(r.dataId),s=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,c=[a,i],l=N.util.sizeFromShape(c),f=N.util.getTypedArrayFromDType("float32",l),h=N.util.getTypedArrayFromDType("float32",l),p=0;p<a;p++){for(var d=vu({inputs:{x:s},backend:t,attrs:{begin:[p,0],size:[1,i]}}),m=vu({inputs:{x:u},backend:t,attrs:{begin:[p,0],size:[1,i]}}),v=ua({inputs:{real:d,imag:m},backend:t}),g=rBe(v,e,t),y=g.real,w=g.imag,b=N.backend_util.mergeRealAndImagArrays(y,w),x=0;x<i;x++){var S=N.backend_util.getComplexWithIndex(b,x);f[p*i+x]=S.real,h[p*i+x]=S.imag}t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(v)}var T=t.makeTensorInfo(c,"float32",f),E=t.makeTensorInfo(c,"float32",h),C=ua({inputs:{real:T,imag:E},backend:t});return t.disposeIntermediateTensorInfo(T),t.disposeIntermediateTensorInfo(E),C}function rBe(r,e,t){var n=N.util.sizeFromShape(r.shape),a=t.data.get(r.dataId),i=t.data.get(a.complexTensorInfos.real.dataId).values,o=t.data.get(a.complexTensorInfos.imag.dataId).values;if(nBe(n)){var s=gx(i,o,n,e,t),u=[r.shape[0],r.shape[1]];if(e){var c=t.makeTensorInfo(u,"float32",s.real),l=t.makeTensorInfo(u,"float32",s.imag),f=t.makeTensorInfo([],"float32",N.util.createScalarValue(n,"float32")),h=zi({inputs:{x:f},backend:t}),p=mx.kernelFunc({inputs:{a:c,b:f},backend:t}),d=mx.kernelFunc({inputs:{a:l,b:h},backend:t}),m=t.data.get(p.dataId).values,v=t.data.get(d.dataId).values;return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),{real:m,imag:v}}return s}else{var g=N.backend_util.mergeRealAndImagArrays(i,o),y=aBe(g,n,e);return N.backend_util.splitRealAndImagArrays(y)}}function nBe(r){return(r&r-1)===0}function gx(r,e,t,n,a){if(t===1)return{real:r,imag:e};var i=N.backend_util.mergeRealAndImagArrays(r,e),o=t/2,s=N.backend_util.complexWithEvenIndex(i),u=s.real,c=s.imag,l=[u.length],f=a.makeTensorInfo(l,"float32",u),h=a.makeTensorInfo(l,"float32",c),p=ua({inputs:{real:f,imag:h},backend:a}),d=N.backend_util.complexWithOddIndex(i),m=d.real,v=d.imag,g=[m.length],y=a.makeTensorInfo(g,"float32",m),w=a.makeTensorInfo(g,"float32",v),b=ua({inputs:{real:y,imag:w},backend:a}),x=gx(u,c,o,n,a),S=x.real,T=x.imag,E=[S.length],C=a.makeTensorInfo(E,"float32",S),R=a.makeTensorInfo(E,"float32",T),_=ua({inputs:{real:C,imag:R},backend:a}),O=gx(m,v,o,n,a),$=O.real,z=O.imag,L=[$.length],B=a.makeTensorInfo(L,"float32",$),W=a.makeTensorInfo(L,"float32",z),X=ua({inputs:{real:B,imag:W},backend:a}),J=N.backend_util.exponents(t,n),V=[J.real.length],j=a.makeTensorInfo(V,"float32",J.real),ne=a.makeTensorInfo(V,"float32",J.imag),re=ua({inputs:{real:j,imag:ne},backend:a}),oe=em({inputs:{a:re,b:X},backend:a}),le=Mc({inputs:{a:_,b:oe},backend:a}),de=Nx({inputs:{a:_,b:oe},backend:a}),ke=du({inputs:{input:le},backend:a}),he=du({inputs:{input:de},backend:a}),ye=Bc({inputs:{input:le},backend:a}),xe=Bc({inputs:{input:de},backend:a}),De=Lc({inputs:[ke,he],backend:a,attrs:{axis:0}}),Ye=Lc({inputs:[ye,xe],backend:a,attrs:{axis:0}}),ht=a.data.get(De.dataId).values,at=a.data.get(Ye.dataId).values;return a.disposeIntermediateTensorInfo(f),a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(y),a.disposeIntermediateTensorInfo(w),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(C),a.disposeIntermediateTensorInfo(R),a.disposeIntermediateTensorInfo(_),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(X),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(ne),a.disposeIntermediateTensorInfo(re),a.disposeIntermediateTensorInfo(oe),a.disposeIntermediateTensorInfo(le),a.disposeIntermediateTensorInfo(de),a.disposeIntermediateTensorInfo(ke),a.disposeIntermediateTensorInfo(ye),a.disposeIntermediateTensorInfo(he),a.disposeIntermediateTensorInfo(xe),a.disposeIntermediateTensorInfo(De),a.disposeIntermediateTensorInfo(Ye),{real:ht,imag:at}}function aBe(r,e,t){for(var n=new Float32Array(e*2),a=0;a<e;a++){for(var i=0,o=0,s=0;s<e;s++){var u=N.backend_util.exponent(a*s,e,t),c=N.backend_util.getComplexWithIndex(r,s);i+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}t&&(i/=e,o/=e),N.backend_util.assignToTypedArray(n,i,o,a)}return n}function iBe(r){var e=r.inputs,t=r.backend,n=e.input,a=N.util.sizeFromShape(n.shape),i=n.shape[n.shape.length-1],o=a/i,s=Vt({inputs:{x:n},backend:t,attrs:{shape:[o,i]}}),u=Q$(s,!1,t),c=Vt({inputs:{x:u},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(u),c}var oBe={kernelName:N.FFT,backendName:"cpu",kernelFunc:iBe};function Ix(r){var e=r.backend,t=r.attrs,n=t.shape,a=t.value,i=t.dtype,o=i||N.util.inferDtype(a),s=N.util.getArrayFromDType(o,N.util.sizeFromShape(n));return uBe(s,a,o),e.makeTensorInfo(n,o,s)}var sBe={kernelName:N.Fill,backendName:"cpu",kernelFunc:Ix};function uBe(r,e,t){r.fill(e)}var cBe={kernelName:N.FlipLeftRight,backendName:"cpu",kernelFunc:function(r){var e=r.inputs;r.attrs;for(var t=r.backend,n=e.image,a=t,i=N.util.getTypedArrayFromDType(n.dtype,N.util.sizeFromShape(n.shape)),o=We(n.shape,4),s=o[0],u=o[1],c=o[2],l=o[3],f=a.data.get(n.dataId).values,h=0;h<s;h++)for(var p=h*c*u*l,d=0;d<u;d++)for(var m=d*(c*l),v=0;v<c;v++)for(var g=v*l,y=0;y<l;y++){var w=Math.round(c-v-1),b=p+m+g+y,x=f[b];if(w>=0&&w<c){var S=w*l,T=p+m+S+y;x=f[T]}i[b]=x}var E=a.write(i,n.shape,n.dtype);return{dataId:E,shape:n.shape,dtype:n.dtype}}};function lBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=n.strides,c=n.pad,l=n.dataFormat,f=n.dilations,h=n.dimRoundingMode,p=n.activation,d=n.leakyreluAlpha,m=Z$({inputs:{x:a,filter:i},backend:t,attrs:{strides:u,pad:c,dataFormat:l,dilations:f,dimRoundingMode:h}});if(o){var v=m;if(l==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){var g=Vt({inputs:{x:o},backend:t,attrs:{shape:[o.shape[0],1,1]}});m=Mc({inputs:{a:m,b:g},backend:t}),t.disposeIntermediateTensorInfo(g)}else m=Mc({inputs:{a:m,b:o},backend:t});t.disposeIntermediateTensorInfo(v)}if(p){var v=m;if(l==="NCHW"&&p==="prelu"&&s.shape.length===1&&s.shape[0]!==1){var y=Vt({inputs:{x:s},backend:t,attrs:{shape:[s.shape[0],1,1]}});m=Zv(t,m,p,y,d),t.disposeIntermediateTensorInfo(y)}else m=Zv(t,m,p,s,d);t.disposeIntermediateTensorInfo(v)}return m}var fBe={kernelName:N.FusedConv2D,backendName:"cpu",kernelFunc:lBe};function hBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=n.strides,c=n.pad,l=n.dataFormat,f=n.dilations,h=n.dimRoundingMode,p=n.activation,d=n.leakyreluAlpha,m=J$({inputs:{x:a,filter:i},backend:t,attrs:{strides:u,pad:c,dataFormat:l,dilations:f,dimRoundingMode:h}});if(o){var v=m;m=Mc({inputs:{a:m,b:o},backend:t}),t.disposeIntermediateTensorInfo(v)}if(p){var v=m;m=Zv(t,m,p,s,d),t.disposeIntermediateTensorInfo(v)}return m}var pBe={kernelName:N.FusedDepthwiseConv2D,backendName:"cpu",kernelFunc:hBe};function dBe(r){var e=r.inputs,t=r.backend,n=e.params,a=e.indices,i=N.util.sizeFromShape(n.shape),o=a.shape,s=o[o.length-1],u=We(N.backend_util.prepareAndValidate(n,a),4),c=u[0],l=u[1],f=u[2],h=u[3];if(l===0)return t.makeTensorInfo(c,n.dtype,[]);var p=t.data.get(a.dataId).values,d=t.bufferSync(n),m=c$(p,d,n.dtype,l,s,f,h,n.shape,i);return t.makeTensorInfo(c,n.dtype,m.values)}var vBe={kernelName:N.GatherNd,backendName:"cpu",kernelFunc:dBe};function mBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.indices,o=n.axis,s=n.batchDims;Ue([a,i],"gatherV2");for(var u=N.util.parseAxisParam(o,a.shape)[0],c=t.data.get(i.dataId).values,l=a.shape[u],f=function(S){var T=c[S];N.util.assert(T<=l-1&&T>=0,function(){return"GatherV2: the index value ".concat(T," is not in [0, ").concat(l-1,"]")})},h=0;h<c.length;++h)f(h);var p=s;s==null&&(p=0);var d=N.util.sizeFromShape(i.shape),m=N.backend_util.segment_util.collectGatherOpShapeInfo(a,i,u,p),v=Vt({inputs:{x:a},backend:t,attrs:{shape:[m.batchSize,m.outerSize,m.dimSize,m.sliceSize]}}),g=Vt({inputs:{x:i},backend:t,attrs:{shape:[m.batchSize,d/m.batchSize]}}),y=[m.batchSize,m.outerSize,d/m.batchSize,m.sliceSize],w=t.bufferSync(g),b=t.bufferSync(v),x=l$(b,w,y);return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(g),t.makeTensorInfo(m.outputShape,x.dtype,x.values)}var gBe={kernelName:N.GatherV2,backendName:"cpu",kernelFunc:mBe};function yBe(r){var e=r.inputs,t=r.backend,n=e.input,a=N.util.sizeFromShape(n.shape),i=n.shape[n.shape.length-1],o=a/i,s=Vt({inputs:{x:n},backend:t,attrs:{shape:[o,i]}}),u=Q$(s,!0,t),c=Vt({inputs:{x:u},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(u),c}var bBe={kernelName:N.IFFT,backendName:"cpu",kernelFunc:yBe};var wBe=Mt(N.IsFinite,function(r){return Number.isFinite(r)?1:0},"bool"),xBe={kernelName:N.IsFinite,backendName:"cpu",kernelFunc:wBe};var kBe=Mt(N.IsInf,function(r){return Math.abs(r)===1/0?1:0},"bool"),SBe={kernelName:N.IsInf,backendName:"cpu",kernelFunc:kBe};var NBe=Mt(N.IsNan,function(r){return Number.isNaN(r)?1:0},"bool"),TBe={kernelName:N.IsNan,backendName:"cpu",kernelFunc:NBe};function EBe(r){var e=r.backend,t=r.attrs,n=t.start,a=t.stop,i=t.num,o=v$(n,a,i);return e.makeTensorInfo([o.length],"float32",o)}var IBe={kernelName:N.LinSpace,backendName:"cpu",kernelFunc:EBe};var CBe=Mt(N.Log1p,function(r){return Math.log1p(r)}),ABe={kernelName:N.Log1p,backendName:"cpu",kernelFunc:CBe};var DBe=Fr(function(r,e){return r&&e}),_Be=Vr(N.LogicalAnd,DBe,null,"bool"),FBe={kernelName:N.LogicalAnd,backendName:"cpu",kernelFunc:_Be};var RBe=Mt(N.LogicalNot,function(r){return r?0:1},"bool"),OBe={kernelName:N.LogicalNot,backendName:"cpu",kernelFunc:RBe};var PBe=Fr(function(r,e){return r||e}),MBe=Vr(N.LogicalOr,PBe,null,"bool"),BBe={kernelName:N.LogicalOr,backendName:"cpu",kernelFunc:MBe};function LBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.depthRadius,o=n.bias,s=n.alpha,u=n.beta;Ue(a,"LRN");var c=a.shape[3],l=c-1,f=t.data.get(a.dataId).values,h=N.util.sizeFromShape(a.shape),p=new Float32Array(h);function d(y){for(var w=y%c,b=y-w+Math.max(0,w-i),x=y-w+Math.min(w+i,l),S=0;b<=x;b++){var T=f[b];S+=T*T}return S}for(var m=0;m<h;m++){var v=d(m),g=f[m]*Math.pow(o+s*v,-u);p[m]=g}return t.makeTensorInfo(a.shape,a.dtype,p)}var zBe={kernelName:N.LRN,backendName:"cpu",kernelFunc:LBe};function $Be(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.y,o=e.dy,s=n.depthRadius,u=n.bias,c=n.alpha,l=n.beta;Ue(o,"LRNGrad");for(var f=N.util.sizeFromShape(o.shape),h=o.shape[3],p=t.data.get(o.dataId).values,d=t.data.get(a.dataId).values,m=t.data.get(i.dataId).values,v=new Float32Array(f),g=f,y=0;y<g;y++){for(var w=y%h,b=y-w+Math.max(0,w-s),x=y-w+Math.min(h,w+s+1),S=0,T=b;T<x;T++)S+=Math.pow(d[T],2);S=c*S+u;for(var T=b;T<x;T++){var E=-2*c*l*d[T]*m[y]/S;y===T&&(E+=Math.pow(S,-l)),E*=p[y],v[T]+=E}}return t.makeTensorInfo(o.shape,a.dtype,v)}var qBe={kernelName:N.LRNGrad,backendName:"cpu",kernelFunc:$Be};function eq(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.reductionIndices,o=n.keepDims,s=t,u=a.shape,c=u.length,l=N.util.parseAxisParam(i,u),f=l,h=N.backend_util.getAxesPermutation(f,c),p=s.data.get(a.dataId).values;if(h!=null){for(var d=new Array(c),m=0;m<d.length;m++)d[m]=u[h[m]];p=kx(p,u,a.dtype,h,d),f=N.backend_util.getInnerMostAxes(f.length,c),u=d}Ue(a,"max"),N.backend_util.assertAxesAreInnerMostDims("max",f,c);var v=We(N.backend_util.computeOutAndReduceShapes(u,f),2),g=v[0],y=v[1],w=N.util.sizeFromShape(y),b=g$(p,w,g,a.dtype),x=s.write(b,g,a.dtype),S=g;if(o){var d=N.backend_util.expandShapeToKeepDim(g,l);S=d}return{dataId:x,shape:S,dtype:a.dtype}}var WBe={kernelName:N.Max,backendName:"cpu",kernelFunc:eq};function VBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;Ue(a,"maxPool");var i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=1;N.util.assert(N.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=N.backend_util.computePool2DInfo(a.shape,i,o,c,s,u),f;if(l.filterWidth===1&&l.filterHeight===1&&N.util.arraysEqual(l.inShape,l.outShape))f=zi({inputs:{x:a},backend:t});else{var h=t.data.get(a.dataId).values,p=N.util.computeStrides(a.shape),d=Tx(h,a.shape,a.dtype,p,l,"max");f=t.makeTensorInfo(l.outShape,a.dtype,d.values)}return f}var UBe={kernelName:N.MaxPool,backendName:"cpu",kernelFunc:VBe};function GBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=n.dataFormat;Ue(a,"maxPool3d");var l=N.backend_util.computePool3DInfo(a.shape,i,o,1,s,u,c),f=t.data.get(a.dataId).values,h=Y$(f,a.shape,a.dtype,N.util.computeStrides(a.shape),l,"max");return t.makeTensorInfo(h.shape,"float32",h.values)}var HBe={kernelName:N.MaxPool3D,backendName:"cpu",kernelFunc:GBe};function KBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode;Ue([a,i],"maxPool3DGrad");for(var l=N.backend_util.computePool3DInfo(i.shape,o,s,1,u,c),f=t.bufferSync(i),h=PMe(f,l),p=l.strideDepth,d=l.strideHeight,m=l.strideWidth,v=l.dilationDepth,g=l.dilationHeight,y=l.dilationWidth,w=l.effectiveFilterDepth,b=l.effectiveFilterHeight,x=l.effectiveFilterWidth,S=w-1-l.padInfo.front,T=x-1-l.padInfo.left,E=b-1-l.padInfo.top,C=N.buffer(i.shape,"float32"),R=t.bufferSync(a),_=0;_<l.batchSize;++_)for(var O=0;O<l.inChannels;++O)for(var $=0;$<l.inDepth;++$)for(var z=0;z<l.inHeight;++z)for(var L=0;L<l.inWidth;++L){for(var B=$-S,W=z-E,X=L-T,J=0,V=0;V<w;V+=v){var j=(B+V)/p;if(!(j<0||j>=l.outDepth||Math.floor(j)!==j))for(var ne=0;ne<b;ne+=g){var re=(W+ne)/d;if(!(re<0||re>=l.outHeight||Math.floor(re)!==re))for(var oe=0;oe<x;oe+=y){var le=(X+oe)/m;if(!(le<0||le>=l.outWidth||Math.floor(le)!==le)){var de=w*b*x-1-h.get(_,j,re,le,O),ke=V*b*x+ne*x+oe,he=de===ke?1:0;if(he!==0){var ye=R.get(_,j,re,le,O);J+=ye*he}}}}}C.set(J,_,$,z,L,O)}return t.makeTensorInfo(C.shape,C.dtype,C.values)}var jBe={kernelName:N.MaxPool3DGrad,backendName:"cpu",kernelFunc:KBe};function XBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=e.output,s=i;Ue([i,o],"maxPoolGrad");for(var u=n.filterSize,c=n.strides,l=n.pad,f=n.dimRoundingMode,h=N.backend_util.computePool2DInfo(s.shape,u,c,1,l,f),p=t.data.get(s.dataId).values,d=N.buffer(h.outShape,s.dtype,X$(p,s.shape,s.dtype,h).values),m=h.strideHeight,v=h.strideWidth,g=h.dilationHeight,y=h.dilationWidth,w=h.effectiveFilterHeight,b=h.effectiveFilterWidth,x=b-1-h.padInfo.left,S=w-1-h.padInfo.top,T=N.buffer(s.shape,"float32"),E=t.data.get(a.dataId).values,C=N.buffer(a.shape,"float32",E),R=0;R<h.batchSize;++R)for(var _=0;_<h.inChannels;++_)for(var O=0;O<h.inHeight;++O)for(var $=0;$<h.inWidth;++$){for(var z=O-S,L=$-x,B=0,W=0;W<w;W+=g){var X=(z+W)/m;if(!(X<0||X>=h.outHeight||Math.floor(X)!==X))for(var J=0;J<b;J+=y){var V=(L+J)/v;if(!(V<0||V>=h.outWidth||Math.floor(V)!==V)){var j=w*b-1-d.get(R,X,V,_),ne=W*b+J,re=j===ne?1:0;if(re!==0){var oe=C.get(R,X,V,_);B+=oe*re}}}}T.set(B,R,O,$,_)}return t.makeTensorInfo(T.shape,T.dtype,T.values)}var YBe={kernelName:N.MaxPoolGrad,backendName:"cpu",kernelFunc:XBe};function ZBe(r,e,t,n,a){var i=N.util.computeStrides(e),o=Tx(r,e,t,i,a,"max"),s=X$(r,e,t,a,!0,n);return[o.values,s.values]}var JBe={kernelName:N.MaxPoolWithArgmax,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.x,i=t.filterSize,o=t.strides,s=t.pad,u=t.includeBatchInIndex,c=n;Ue(a,"MaxPoolWithArgmax");var l=c.data.get(a.dataId).values,f=N.backend_util.computePool2DInfo(a.shape,i,o,[1,1],s),h=We(ZBe(l,a.shape,a.dtype,u,f),2),p=h[0],d=h[1],m=c.write(p,f.outShape,a.dtype),v=c.write(d,f.outShape,a.dtype);return[{dataId:m,shape:f.outShape,dtype:a.dtype},{dataId:v,shape:f.outShape,dtype:"int32"}]}};function QBe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=N.util.parseAxisParam(i,a.shape),u=N.backend_util.computeOutAndReduceShapes(a.shape,s),c=u[1],l=N.util.sizeFromShape(c),f=[],h=t.makeTensorInfo([],"float32",new Float32Array([l]));f.push(h);var p=ns({inputs:{x:a},backend:t,attrs:{dtype:"float32"}});f.push(p);var d=Ex({inputs:{a:p,b:h},backend:t});f.push(d);var m=oh({inputs:{x:d},backend:t,attrs:{axis:i,keepDims:o}});return f.forEach(function(v){return t.disposeIntermediateTensorInfo(v)}),m}var eLe={kernelName:N.Mean,backendName:"cpu",kernelFunc:QBe};function tLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;Ue(a,"min");var s=N.util.parseAxisParam(i,a.shape),u=s,c=N.backend_util.getAxesPermutation(u,a.shape.length),l=a;c!=null&&(l=Bn({inputs:{x:a},backend:t,attrs:{perm:c}}),u=N.backend_util.getInnerMostAxes(u.length,a.shape.length)),N.backend_util.assertAxesAreInnerMostDims("min",u,l.shape.length);for(var f=We(N.backend_util.computeOutAndReduceShapes(l.shape,u),2),h=f[0],p=f[1],d=N.util.sizeFromShape(p),m=N.util.makeZerosTypedArray(N.util.sizeFromShape(h),l.dtype),v=t.data.get(l.dataId).values,g=0;g<m.length;++g){for(var y=g*d,w=v[y],b=0;b<d;++b){var x=v[y+b];(Number.isNaN(x)||x<w)&&(w=x)}m[g]=w}c!=null&&t.disposeIntermediateTensorInfo(l);var S=t.makeTensorInfo(h,l.dtype,m);if(o){var T=N.backend_util.expandShapeToKeepDim(h,s),E=Vt({inputs:{x:S},backend:t,attrs:{shape:T}});return t.disposeIntermediateTensorInfo(S),E}return S}var rLe={kernelName:N.Min,backendName:"cpu",kernelFunc:tLe};function nLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.paddings,o=n.mode;Ue(a,"mirrorPad");for(var s=i.map(function(T,E){return T[0]+a.shape[E]+T[1]}),u=i.map(function(T){return T[0]}),c=i.map(function(T,E){return T[0]+a.shape[E]}),l=o==="reflect"?0:1,f=t.data.get(a.dataId).values,h=a.shape.length,p=N.util.computeStrides(a.shape),d=N.util.sizeFromShape(s),m=s.length,v=N.util.computeStrides(s),g=N.util.getTypedArrayFromDType(a.dtype,d),y=0;y<d;y++){for(var w=N.util.indexToLoc(y,m,v),b=0;b<m;b++)w[b]<u[b]?w[b]=u[b]*2-w[b]-l:w[b]>=c[b]&&(w[b]=(c[b]-1)*2-w[b]+l);w=w.map(function(T,E){return T-u[E]});var x=N.util.locToIndex(w,h,p);g[y]=f[x]}var S=t.write(g,s,a.dtype);return{dataId:S,shape:s,dtype:a.dtype}}var aLe={kernelName:N.MirrorPad,backendName:"cpu",kernelFunc:nLe};var iLe=Fr(function(r,e){var t=r%e;return r<0&&e<0||r>=0&&e>=0?t:(t+e)%e}),oLe=Vr(N.Mod,iLe),sLe={kernelName:N.Mod,backendName:"cpu",kernelFunc:oLe};function tq(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.logits,i=n.dim,o=a.shape.length,s=i;if(s===-1&&(s=o-1),s!==o-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(o," and dim was ").concat(s));var u=N.util.parseAxisParam([s],a.shape),c=eq({inputs:{x:a},backend:t,attrs:{reductionIndices:u,keepDims:!1}}),l=N.backend_util.expandShapeToKeepDim(c.shape,u),f=Vt({inputs:{x:c},backend:t,attrs:{shape:l}}),h=Nx({inputs:{a,b:f},backend:t}),p=i$({inputs:{x:h},backend:t}),d=oh({inputs:{x:p},backend:t,attrs:{axis:u,keepDims:!1}}),m=Vt({inputs:{x:d},backend:t,attrs:{shape:l}}),v=Ex({inputs:{a:p,b:m},backend:t});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(m),v}var uLe={kernelName:N.Softmax,backendName:"cpu",kernelFunc:tq};function cLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.logits,i=n.numSamples,o=n.seed,s=n.normalized;Ue(a,"multinomial");for(var u=s?a:tq({inputs:{logits:a},backend:t,attrs:{dim:-1}}),c=u.shape[0],l=u.shape[1],f=t.data.get(u.dataId).values,h=[c,i],p=N.util.makeZerosTypedArray(N.util.sizeFromShape(h),"int32"),d=0;d<c;++d){var m=d*l,v=new Float32Array(l-1);v[0]=f[m];for(var g=1;g<v.length;++g)v[g]=v[g-1]+f[m+g];for(var y=BOe.alea(o.toString()),w=d*i,b=0;b<i;++b){var x=y();p[w+b]=v.length;for(var g=0;g<v.length;g++)if(x<v[g]){p[w+b]=g;break}}}return s||t.disposeIntermediateTensorInfo(u),t.makeTensorInfo(h,"int32",p)}var lLe={kernelName:N.Multinomial,backendName:"cpu",kernelFunc:cLe};var fLe=N.kernel_impls.nonMaxSuppressionV3Impl;function hLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold;Ue(a,"NonMaxSuppression");var c=t.data.get(a.dataId).values,l=t.data.get(i.dataId).values,f=fLe(c,l,o,s,u).selectedIndices;return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}var pLe={kernelName:N.NonMaxSuppressionV3,backendName:"cpu",kernelFunc:hLe};var dLe=N.kernel_impls.nonMaxSuppressionV4Impl;function vLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,c=n.padToMaxOutputSize;Ue(a,"NonMaxSuppressionPadded");var l=t.data.get(a.dataId).values,f=t.data.get(i.dataId).values,h=dLe(l,f,o,s,u,c),p=h.selectedIndices,d=h.validOutputs;return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([d]))]}var mLe={kernelName:N.NonMaxSuppressionV4,backendName:"cpu",kernelFunc:vLe};var gLe=N.kernel_impls.nonMaxSuppressionV5Impl;function yLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,c=n.softNmsSigma;Ue(a,"NonMaxSuppressionWithScore");var l=t.data.get(a.dataId).values,f=t.data.get(i.dataId).values,h=o,p=s,d=u,m=c,v=gLe(l,f,h,p,d,m),g=v.selectedIndices,y=v.selectedScores;return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var bLe={kernelName:N.NonMaxSuppressionV5,backendName:"cpu",kernelFunc:yLe};function wLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.indices,i=n.dtype,o=n.depth,s=n.onValue,u=n.offValue;Ue(a,"oneHot");var c=N.util.sizeFromShape(a.shape),l=new Float32Array(c*o);l.fill(u);for(var f=t.data.get(a.dataId).values,h=0;h<c;++h)f[h]>=0&&f[h]<o&&(l[h*o+f[h]]=s);return t.makeTensorInfo(wa(wa([],We(a.shape),!1),[o],!1),i,l)}var xLe={kernelName:N.OneHot,backendName:"cpu",kernelFunc:wLe};function Qv(r){var e=r.inputs,t=r.backend,n=e.x;if(n.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(n.dtype==="complex64"){var a=du({inputs:{input:n},backend:t}),i=Qv({inputs:{x:a},backend:t}),o=Bc({inputs:{input:n},backend:t}),s=Qv({inputs:{x:o},backend:t}),u=ua({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return Ix({backend:t,attrs:{shape:n.shape,value:0,dtype:n.dtype}})}var kLe={kernelName:N.ZerosLike,backendName:"cpu",kernelFunc:Qv};function rq(r){var e=r.inputs,t=r.backend,n=e.x;if(n.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(n.dtype==="complex64"){var a=du({inputs:{input:n},backend:t}),i=rq({inputs:{x:a},backend:t}),o=Bc({inputs:{input:n},backend:t}),s=Qv({inputs:{x:o},backend:t}),u=ua({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return Ix({backend:t,attrs:{shape:n.shape,value:1,dtype:n.dtype}})}var SLe={kernelName:N.OnesLike,backendName:"cpu",kernelFunc:rq};function nq(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.axis;if(e.length===1)return Jv({inputs:{input:e[0]},backend:t,attrs:{dim:a}});var i=e[0].shape,o=e[0].dtype;e.forEach(function(l){N.util.assertShapesMatch(i,l.shape,"All tensors passed to stack must have matching shapes"),N.util.assert(o===l.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=[],u=e.map(function(l){var f=Jv({inputs:{input:l},backend:t,attrs:{dim:a}});return s.push(f),f}),c=Lc({inputs:u,backend:t,attrs:{axis:a}});return s.forEach(function(l){return t.disposeIntermediateTensorInfo(l)}),c}var NLe={kernelName:N.Pack,backendName:"cpu",kernelFunc:nq};function TLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.paddings,o=n.constantValue;Ue(a,"pad");var s=i.map(function(S,T){return S[0]+a.shape[T]+S[1]}),u=i.map(function(S){return S[0]}),c=t.data.get(a.dataId).values,l=N.util.sizeFromShape(a.shape),f=a.shape.length,h=N.util.computeStrides(a.shape),p=N.util.sizeFromShape(s),d=s.length,m=N.util.computeStrides(s),v=N.util.getTypedArrayFromDType(a.dtype,p);o!==0&&v.fill(o);for(var g=0;g<l;g++){var y=N.util.indexToLoc(g,f,h),w=y.map(function(S,T){return S+u[T]}),b=N.util.locToIndex(w,d,m);v[b]=c[g]}var x=t.write(v,s,a.dtype);return{dataId:x,shape:s,dtype:a.dtype}}var aq={kernelName:N.PadV2,backendName:"cpu",kernelFunc:TLe};var ELe=Fr(function(r,e){return Math.pow(r,e)}),ILe=Vr(N.Pow,ELe),CLe={kernelName:N.Pow,backendName:"cpu",kernelFunc:ILe};function ALe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.paramsNestedSplits,i=e.paramsDenseValues,o=e.indices;n.outputRaggedRank;var s=a.map(function(g){return t.data.get(g.dataId).values}),u=a.map(function(g){return g.shape}),c=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values,f=We(S$(s,u,c,i.shape,i.dtype,l,o.shape),3),h=f[0],p=f[1],d=f[2],m=h.map(function(g){return t.makeTensorInfo([g.length],"int32",g)}),v=t.makeTensorInfo(d,i.dtype,p);return m.concat([v])}var DLe={kernelName:N.RaggedGather,backendName:"cpu",kernelFunc:ALe};function _Le(r){var e=r.inputs,t=r.backend,n=e.starts,a=e.limits,i=e.deltas,o=t.data.get(n.dataId).values,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=We(N$(o,n.shape,n.dtype,s,a.shape,u,i.shape),2),l=c[0],f=c[1],h=t.makeTensorInfo([l.length],"int32",l),p=t.makeTensorInfo([f.length],n.dtype,f);return[h,p]}var FLe={kernelName:N.RaggedRange,backendName:"cpu",kernelFunc:_Le};function RLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.shape,i=e.values,o=e.defaultValue,s=e.rowPartitionTensors,u=n.rowPartitionTypes,c=t.data.get(a.dataId).values,l=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,h=s.map(function(g){return t.data.get(g.dataId).values}),p=s.map(function(g){return g.shape}),d=We(T$(c,a.shape,l,i.shape,i.dtype,f,o.shape,h,p,u),2),m=d[0],v=d[1];return t.makeTensorInfo(m,i.dtype,v)}var OLe={kernelName:N.RaggedTensorToTensor,backendName:"cpu",kernelFunc:RLe};function PLe(r){var e=r.backend,t=r.attrs,n=t.start,a=t.stop,i=t.dtype,o=t.step,s=E$(n,a,o,i);return e.makeTensorInfo([s.length],i,s)}var MLe={kernelName:N.Range,backendName:"cpu",kernelFunc:PLe};var BLe=Mt(N.Reciprocal,function(r){return 1/r}),LLe={kernelName:N.Reciprocal,backendName:"cpu",kernelFunc:BLe};function zLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=n.alignCorners,o=n.halfPixelCenters,s=n.size;Ue(a,"resizeBilinear");for(var u=N.util.computeStrides(a.shape),c=We(s,2),l=c[0],f=c[1],h=We(a.shape,4),p=h[0],d=h[1],m=h[2],v=h[3],g=t.data.get(a.dataId).values,y=new Float32Array(N.util.sizeFromShape([p,l,f,v])),w=[i&&l>1?d-1:d,i&&f>1?m-1:m],b=[i&&l>1?l-1:l,i&&f>1?f-1:f],x=0,S=w[0]/b[0],T=w[1]/b[1],E=0;E<p;E++)for(var C=0;C<l;C++){var R=void 0;o?R=S*(C+.5)-.5:R=S*C;for(var _=Math.max(0,Math.floor(R)),O=R-_,$=Math.min(d-1,Math.ceil(R)),z=E*u[0]+_*u[1],L=E*u[0]+$*u[1],B=0;B<f;B++){var W=void 0;o?W=T*(B+.5)-.5:W=T*B;for(var X=Math.max(0,Math.floor(W)),J=W-X,V=Math.min(m-1,Math.ceil(W)),j=z+X*u[2],ne=L+X*u[2],re=z+V*u[2],oe=L+V*u[2],le=0;le<v;le++){var de=g[j+le],ke=g[ne+le],he=g[re+le],ye=g[oe+le],xe=de+(he-de)*J,De=ke+(ye-ke)*J,Ye=xe+(De-xe)*O;y[x++]=Ye}}}return t.makeTensorInfo([p,l,f,v],"float32",y)}var $Le={kernelName:N.ResizeBilinear,backendName:"cpu",kernelFunc:zLe};function qLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=e.dy,o=n.alignCorners;Ue([i,a],"resizeBilinearGrad");for(var s=N.util.computeStrides(a.shape),u=We(a.shape,4),c=u[0],l=u[1],f=u[2],h=u[3],p=We(i.shape,3),d=p[1],m=p[2],v=new Float32Array(c*l*f*h),g=[o&&d>1?l-1:l,o&&m>1?f-1:f],y=[o&&d>1?d-1:d,o&&m>1?m-1:m],w=g[0]/y[0],b=g[1]/y[1],x=t.data.get(i.dataId).values,S=0,T=0;T<c;T++)for(var E=T*s[0],C=0;C<d;C++)for(var R=C*w,_=Math.floor(R),O=Math.min(Math.ceil(R),l-1),$=E+_*s[1],z=E+O*s[1],L=R-_,B=1-L,W=0;W<m;W++)for(var X=W*b,J=Math.floor(X),V=Math.min(Math.ceil(X),f-1),j=X-J,ne=1-j,re=$+J*s[2],oe=$+V*s[2],le=z+J*s[2],de=z+V*s[2],ke=B*ne,he=B*j,ye=L*ne,xe=L*j,De=0;De<h;De++){var Ye=x[S++];v[re+De]+=Ye*ke,v[oe+De]+=Ye*he,v[le+De]+=Ye*ye,v[de+De]+=Ye*xe}return t.makeTensorInfo([c,f,l,h],"float32",v)}var WLe={kernelName:N.ResizeBilinearGrad,backendName:"cpu",kernelFunc:qLe};function VLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=n.alignCorners,o=n.halfPixelCenters,s=n.size;Ue(a,"resizeNearestNeighbor");for(var u=N.util.computeStrides(a.shape),c=We(s,2),l=c[0],f=c[1],h=We(a.shape,4),p=h[0],d=h[1],m=h[2],v=h[3],g=t.data.get(a.dataId).values,y=new Float32Array(p*l*f*v),w=[i&&l>1?d-1:d,i&&f>1?m-1:m],b=[i&&l>1?l-1:l,i&&f>1?f-1:f],x=w[0]/b[0],S=w[1]/b[1],T=0,E=0;E<p;E++)for(var C=E*u[0],R=0;R<l;R++){var _=o?x*(R+.5):x*R,O=Math.min(d-1,i?Math.round(_):Math.floor(_));o&&(O=Math.max(0,O));for(var $=C+O*u[1],z=0;z<f;z++){var L=o?S*(z+.5):S*z,B=Math.min(m-1,i?Math.round(L):Math.floor(L));o&&(B=Math.max(0,B));for(var W=$+B*u[2],X=0;X<v;X++){var J=g[W+X];y[T++]=J}}}return t.makeTensorInfo([p,l,f,v],a.dtype,y)}var ULe={kernelName:N.ResizeNearestNeighbor,backendName:"cpu",kernelFunc:VLe};function GLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=e.dy,o=n.alignCorners;Ue([i,a],"resizeNearestNeighborGrad");for(var s=N.util.computeStrides(a.shape),u=N.util.computeStrides(i.shape),c=We(a.shape,4),l=c[0],f=c[1],h=c[2],p=c[3],d=We(i.shape,3),m=d[1],v=d[2],g=new Float32Array(l*f*h*p),y=t.data.get(i.dataId).values,w=[o&&m>1?f-1:f,o&&v>1?h-1:h],b=[o&&m>1?m-1:m,o&&v>1?v-1:v],x=w[0]/b[0],S=w[1]/b[1],T=1/x,E=1/S,C=Math.ceil(T)*2+2,R=Math.ceil(E)*2+2,_=0;_<l;_++)for(var O=_*s[0],$=0;$<f;$++)for(var z=O+$*s[1],L=Math.floor($*T),B=Math.floor(L-C/2),W=0;W<h;W++)for(var X=z+W*s[2],J=Math.floor(W*E),V=Math.floor(J-R/2),j=0;j<p;j++){for(var ne=0,re=0;re<C;re++){var oe=re+B;if(!(oe<0||oe>=m)){var le=O+oe*u[1],de=oe*x,ke=Math.min(f-1,o?Math.round(de):Math.floor(de));if($===ke)for(var he=0;he<R;he++){var ye=he+V;if(!(ye<0||ye>=v)){var xe=le+ye*u[2],De=ye*S,Ye=Math.min(h-1,o?Math.round(De):Math.floor(De));W===Ye&&(ne+=y[xe+j])}}}}g[X+j]=ne}return t.makeTensorInfo(a.shape,a.dtype,g)}var HLe={kernelName:N.ResizeNearestNeighborGrad,backendName:"cpu",kernelFunc:GLe};function KLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.dims;Ue(a,"reverse");var o=a.shape.length,s=N.util.parseAxisParam(i,a.shape);if(o===0)return zi({inputs:{x:a},backend:t});for(var u=new N.TensorBuffer(a.shape,a.dtype),c=t.bufferSync(a),l=function(h){var p=u.indexToLoc(h),d=p.slice();s.forEach(function(m){return d[m]=a.shape[m]-1-d[m]}),u.set.apply(u,wa([c.get.apply(c,wa([],We(d),!1))],We(p),!1))},f=0;f<u.size;f++)l(f);return t.makeTensorInfo(u.shape,u.dtype,u.values)}var jLe={kernelName:N.Reverse,backendName:"cpu",kernelFunc:KLe},XLe={kernelName:N.RotateWithOffset,backendName:"cpu",kernelFunc:function(r){for(var e=r.inputs,t=r.attrs,n=r.backend,a=e.image,i=t.radians,o=t.fillValue,s=t.center,u=n,c=N.util.getTypedArrayFromDType(a.dtype,N.util.sizeFromShape(a.shape)),l=We(a.shape,4),f=l[0],h=l[1],p=l[2],d=l[3],m=We(N.backend_util.getImageCenter(s,h,p),2),v=m[0],g=m[1],y=255,w=Math.sin(i),b=Math.cos(i),x=u.data.get(a.dataId).values,S=0;S<f;S++)for(var T=S*p*h*d,E=0;E<h;E++)for(var C=E*(p*d),R=0;R<p;R++)for(var _=R*d,O=0;O<d;O++){var $=[f,E,R,O],z=$[2],L=$[1],B=(z-v)*b-(L-g)*w,W=(z-v)*w+(L-g)*b;B=Math.round(B+v),W=Math.round(W+g);var X=o;if(typeof o!="number"&&(O===3?X=y:X=o[O]),B>=0&&B<p&&W>=0&&W<h){var J=W*(p*d),V=B*d,j=T+J+V+O;X=x[j]}var ne=T+C+_+O;c[ne]=X}var re=u.write(c,a.shape,a.dtype);return{dataId:re,shape:a.shape,dtype:a.dtype}}};var YLe=Mt(N.Round,function(r){var e=Math.floor(r);return r-e<.5?Math.floor(r):r-e>.5?Math.ceil(r):e%2===0?e:e+1}),ZLe={kernelName:N.Round,backendName:"cpu",kernelFunc:YLe};function JLe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.indices,i=e.updates,o=n.shape,s=N.backend_util.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,f=s.strides,h=s.outputSize,p=!0,d=t.bufferSync(a),m=t.bufferSync(i),v=pu(d,m,o,h,l,c,u,f,0,p);return t.makeTensorInfo(o,v.dtype,v.values)}var QLe={kernelName:N.ScatterNd,backendName:"cpu",kernelFunc:JLe};function eze(r,e){for(var t=0,n=r.length,a=0;t<n;)a=Math.floor((t+n)/2),r[a]<e?t=a+1:n=a;return n}function tze(r,e){for(var t=0,n=r.length,a=0;t<n;)a=Math.floor((t+n)/2),r[a]<=e?t=a+1:n=a;return n}function rze(r,e,t,n,a,i){for(var o=N.util.getArrayFromDType("int32",t*a),s=0;s<t;++s)for(var u=r.slice(s*n,(s+1)*n),c=s*a,l=0;l<a;++l)o[c+l]=i==="left"?eze(u,e[l+c]):tze(u,e[l+c]);return o}function nze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.sortedSequence,i=e.values,o=n.side,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=rze(s,u,a.shape[0],a.shape[1],i.shape[1],o);return t.makeTensorInfo(i.shape,"int32",c)}var aze={kernelName:N.SearchSorted,backendName:"cpu",kernelFunc:nze};function ize(r){var e=r.inputs,t=r.backend,n=e.condition,a=e.t,i=e.e;Ue([n,a,i],"select");for(var o=n.shape.length,s=t.data.get(n.dataId).values,u=t.data.get(a.dataId).values,c=t.data.get(i.dataId).values,l=N.upcastType(a.dtype,i.dtype),f=N.util.makeZerosTypedArray(N.util.sizeFromShape(a.shape),l),h=0,p=o===0||o>1||a.shape.length===1?1:N.util.sizeFromShape(a.shape.slice(1)),d=0;d<s.length;d++)for(var m=0;m<p;m++)s[d]===1?f[h++]=u[d]:f[h++]=c[d];return t.makeTensorInfo(a.shape,l,f)}var oze={kernelName:N.Select,backendName:"cpu",kernelFunc:ize};var sze=N.backend_util.SELU_SCALEALPHA,uze=N.backend_util.SELU_SCALE,cze=Mt(N.Selu,function(r){return r>=0?uze*r:sze*(Math.exp(r)-1)}),lze={kernelName:N.Selu,backendName:"cpu",kernelFunc:cze};var fze=Mt(N.Sign,function(r){return r<0?-1:r>0?1:0}),hze={kernelName:N.Sign,backendName:"cpu",kernelFunc:fze};var pze=Mt(N.Sin,function(r){return Math.sin(r)}),dze={kernelName:N.Sin,backendName:"cpu",kernelFunc:pze};var vze=Mt(N.Sinh,function(r){return Math.sinh(r)}),mze={kernelName:N.Sinh,backendName:"cpu",kernelFunc:vze};var gze=11920928955078125e-23,Gz=Math.log(gze)+2,yze=Mt(N.Softplus,function(r){var e=r>-Gz,t=r<Gz,n=Math.exp(r),a;return t?a=n:e?a=r:a=Math.log(1+n),a}),bze={kernelName:N.Softplus,backendName:"cpu",kernelFunc:yze};function wze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockShape,o=n.paddings;Ue([a],"spaceToBatchND");var s=N.util.sizeFromShape(i),u=[[0,0]];u.push.apply(u,wa([],We(o),!1));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=aq.kernelFunc({inputs:{x:a},backend:t,attrs:{paddings:u,constantValue:0}}),f=N.backend_util.getReshaped(l.shape,i,s,!1),h=N.backend_util.getPermuted(f.length,i.length,!1),p=N.backend_util.getReshapedPermuted(l.shape,i,s,!1),d={x:l},m={shape:f},v=Vt({inputs:d,backend:t,attrs:m}),g={x:v},y={perm:h},w=Bn({inputs:g,backend:t,attrs:y}),b={x:w},x={shape:p},S=Vt({inputs:b,backend:t,attrs:x});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(w),S}var xze={kernelName:N.SpaceToBatchND,backendName:"cpu",kernelFunc:wze};function kze(r){var e=r.inputs,t=r.backend,n=e.indices,a=e.values,i=e.denseShape,o=e.defaultValue;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        `.concat(i.shape));if(n.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        `.concat(n.shape));if(a.shape.length!==1)throw new Error(`Values must be a vector, saw:
        `.concat(a.shape));if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        `.concat(o.shape));var s=t.data.get(n.dataId).values,u=t.data.get(a.dataId).values,c=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values[0],f=We(D$(s,n.shape,n.dtype,u,a.dtype,c,l),5),h=f[0],p=f[1],d=f[2],m=f[3],v=f[4];return[t.makeTensorInfo(p,n.dtype,h),t.makeTensorInfo([p[0]],a.dtype,d),t.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(function(g){return Number(g)}))),t.makeTensorInfo([v.length],n.dtype,new Int32Array(v))]}var Sze={kernelName:N.SparseFillEmptyRows,backendName:"cpu",kernelFunc:kze};function Nze(r){var e=r.inputs,t=r.backend,n=e.inputIndices,a=e.inputShape,i=e.newShape;if(n.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        `.concat(n.shape));if(a.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        `.concat(a.shape));if(i.shape.length!==1)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(t.data.get(a.dataId).values),s=t.data.get(n.dataId).values,u=Array.from(t.data.get(i.dataId).values),c=We(_$(s,n.shape,n.dtype,o,u),3),l=c[0],f=c[1],h=c[2];return[t.makeTensorInfo(f,n.dtype,l),t.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}var Tze={kernelName:N.SparseReshape,backendName:"cpu",kernelFunc:Nze};function Eze(r){var e=r.inputs,t=r.backend,n=e.data,a=e.indices,i=e.segmentIds;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          `.concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=t.data.get(n.dataId).values,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=We(Sx(o,n.shape,n.dtype,s,u,!0),2),l=c[0],f=c[1];return t.makeTensorInfo(f,n.dtype,l)}var Ize={kernelName:N.SparseSegmentMean,backendName:"cpu",kernelFunc:Eze};function Cze(r){var e=r.inputs,t=r.backend,n=e.data,a=e.indices,i=e.segmentIds;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         `.concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=t.data.get(n.dataId).values,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=We(Sx(o,n.shape,n.dtype,s,u),2),l=c[0],f=c[1];return t.makeTensorInfo(f,n.dtype,l)}var Aze={kernelName:N.SparseSegmentSum,backendName:"cpu",kernelFunc:Cze};function Dze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.sparseIndices,i=e.sparseValues,o=e.defaultValue,s=n.outputShape,u=N.backend_util.calculateShapes(i,a,s),c=u.sliceRank,l=u.numUpdates,f=u.sliceSize,h=u.strides,p=u.outputSize,d=!1,m=t.bufferSync(a),v;switch(i.dtype){case"bool":{var g=t.bufferSync(i),y=Boolean(t.data.get(o.dataId).values[0]);v=pu(m,g,s,p,f,l,c,h,y,d);break}case"float32":{var g=t.bufferSync(i),y=t.data.get(o.dataId).values[0];v=pu(m,g,s,p,f,l,c,h,y,d);break}case"int32":{var g=t.bufferSync(i),y=t.data.get(o.dataId).values[0];v=pu(m,g,s,p,f,l,c,h,y,d);break}case"string":{var g=t.bufferSync(i),y=N.util.decodeString(t.data.get(o.dataId).values[0]);v=pu(m,g,s,p,f,l,c,h,y,d);break}default:throw new Error("Unsupported type ".concat(i.dtype))}return t.makeTensorInfo(s,v.dtype,v.values)}var _ze={kernelName:N.SparseToDense,backendName:"cpu",kernelFunc:Dze};function Fze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.numOrSizeSplits,o=n.axis,s=N.util.parseAxisParam(o,a.shape)[0],u=N.backend_util.prepareSplitSize(a,i,s),c=new Array(a.shape.length).fill(0),l=a.shape.slice();return u.map(function(f){var h=wa([],We(l),!1);h[s]=f;var p=vu({inputs:{x:a},backend:t,attrs:{begin:c,size:h}});return c[s]+=f,p})}var Rze={kernelName:N.SplitV,backendName:"cpu",kernelFunc:Fze};var Oze={kernelName:N.Square,backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e.x,a=t;Ue(n,"square");for(var i=a.data.get(n.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}var c=a.write(o,n.shape,n.dtype);return{dataId:c,shape:n.shape,dtype:n.dtype}}};var Pze=Mt(N.Step,function(r,e){var t=e;return isNaN(r)?NaN:r>0?1:t.alpha}),Mze={kernelName:N.Step,backendName:"cpu",kernelFunc:Pze};function Bze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.begin,o=n.end,s=n.strides,u=n.beginMask,c=n.endMask,l=n.ellipsisMask,f=n.newAxisMask,h=n.shrinkAxisMask;Ue(a,"stridedSlice");var p=N.slice_util.sliceInfo(a.shape,i,o,s,u,c,l,f,h),d=p.finalShapeSparse,m=p.finalShape,v=p.isIdentity,g=p.sliceDim0,y=p.isSimpleSlice,w=p.begin,b=p.end,x=p.strides,S;if(v)S=Vt({inputs:{x:a},backend:t,attrs:{shape:m}});else if(g||y){N.util.assert(a.shape.length>=1,function(){return"Input must have rank at least 1, got: ".concat(a.shape.length)});var T=N.slice_util.computeOutShape(w,b,x),E=vu({inputs:{x:a},backend:t,attrs:{begin:w,size:T}});S=Vt({inputs:{x:E},backend:t,attrs:{shape:m}}),t.disposeIntermediateTensorInfo(E)}else{var C=t.bufferSync(a),R=O$(d,C,x,w);S=t.makeTensorInfo(m,R.dtype,R.values)}return S}var Lze={kernelName:N.StridedSlice,backendName:"cpu",kernelFunc:Bze};function zze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.separator,i=n.nGramWidths,o=n.leftPad,s=n.rightPad,u=n.padWidth,c=n.preserveShortSequences,l=e.data,f=e.dataSplits,h=t.data.get(l.dataId).values,p=t.data.get(f.dataId).values,d=We(P$(h,p,a,i,o,s,u,c),2),m=d[0],v=d[1];return[t.makeTensorInfo([m.length],"string",m),t.makeTensorInfo(f.shape,"int32",v)]}var $ze={kernelName:N.StringNGrams,backendName:"cpu",kernelFunc:zze};function qze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.skipEmpty,i=e.input,o=e.delimiter;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error("Input must be a vector, got shape: ".concat(i.shape));if(o.shape.length!==0)throw new Error("Delimiter must be a scalar, got shape: ".concat(o.shape));var s=t.data.get(i.dataId).values,u=t.data.get(o.dataId).values[0],c=We(M$(s,u,a),3),l=c[0],f=c[1],h=c[2],p=f.length;return[t.makeTensorInfo([p,2],"int32",l),t.makeTensorInfo([p],"string",f),t.makeTensorInfo([2],"int32",new Int32Array(h))]}var Wze={kernelName:N.StringSplit,backendName:"cpu",kernelFunc:qze};function Vze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.numBuckets,i=e.input;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");var o=t.data.get(i.dataId).values,s=B$(o,a);return t.makeTensorInfo(i.shape,"int32",s)}var Uze={kernelName:N.StringToHashBucketFast,backendName:"cpu",kernelFunc:Vze};var Gze=Mt(N.Tan,function(r){return Math.tan(r)}),Hze={kernelName:N.Tan,backendName:"cpu",kernelFunc:Gze};var Kze=Mt(N.Tanh,function(r){return Math.tanh(r)}),jze={kernelName:N.Tanh,backendName:"cpu",kernelFunc:Kze};function Xze(r){var e=r.inputs,t=r.backend,n=e.tensor,a=e.indices,i=e.updates,o=N.backend_util.calculateShapes(i,a,n.shape),s=o.sliceRank,u=o.numUpdates,c=o.sliceSize,l=o.strides,f=o.outputSize,h=!1,p=t.bufferSync(a),d=t.bufferSync(i),m=t.bufferSync(n),v=pu(p,d,n.shape,f,c,u,s,l,m,h);return t.makeTensorInfo(n.shape,v.dtype,v.values)}var Yze={kernelName:N.TensorScatterUpdate,backendName:"cpu",kernelFunc:Xze};function Zze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.reps;Ue(a,"tile");var o=z$(t.bufferSync(a),i);return t.makeTensorInfo(o.shape,o.dtype,o.values)}var Jze={kernelName:N.Tile,backendName:"cpu",kernelFunc:Zze};function Qze(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.k,o=n.sorted;Ue(a,"topk");var s=t.data.get(a.dataId).values,u=We(q$(s,a.shape,a.dtype,i,o),2),c=u[0],l=u[1];return[t.makeTensorInfo(c.shape,c.dtype,c.values),t.makeTensorInfo(l.shape,l.dtype,l.values)]}var e$e={kernelName:N.TopK,backendName:"cpu",kernelFunc:Qze};function t$e(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.image,i=e.transforms,o=t.interpolation,s=t.fillMode,u=t.fillValue,c=t.outputShape,l=We(a.shape,4),f=l[0],h=l[1],p=l[2],d=l[3],m=We(c??[h,p],2),v=m[0],g=m[1],y=[f,v,g,d],w=N.util.computeStrides(a.shape),b=w[0],x=w[1],S=w[2],T=N.util.computeStrides(y),E=T[0],C=T[1],R=T[2],_=N.util.getTypedArrayFromDType(a.dtype,N.util.sizeFromShape(y));_.fill(u);for(var O=n.data.get(a.dataId).values,$=n.data.get(i.dataId).values,z=0;z<f;++z){for(var L=i.shape[0]===1?$:$.subarray(z*8,z*8+8),B=0;B<v;++B)for(var W=0;W<g;++W)for(var X=0;X<d;++X){var J=void 0,V=L[6]*W+L[7]*B+1;if(V!==0){var j=(L[0]*W+L[1]*B+L[2])/V,ne=(L[3]*W+L[4]*B+L[5])/V,re=Hz(j,p,s),oe=Hz(ne,h,s);switch(o){case"nearest":J=s$e(O,h,p,b,x,S,z,oe,re,X,u);break;case"bilinear":J=u$e(O,h,p,b,x,S,z,oe,re,X,u);break;default:throw new Error("Error in Transform: Expect 'nearest' or "+"'bilinear', but got ".concat(o))}var le=z*E+B*C+W*R+X;_[le]=J}}return n.makeTensorInfo(y,a.dtype,_)}var de=n.write(_,y,a.dtype);return{dataId:de,shape:a.shape,dtype:a.dtype}}var r$e={kernelName:N.Transform,backendName:"cpu",kernelFunc:t$e};function Hz(r,e,t){switch(t){case"reflect":return n$e(r,e);case"wrap":return a$e(r,e);case"nearest":return o$e(r,e);case"constant":default:return i$e(r)}}function n$e(r,e){var t=r;if(t<0)if(e<=1)t=0;else{var n=2*e;t<n&&(t=n*Math.trunc(-t/n)+t),t=t<-e?t+n:-t-1}else if(t>e-1)if(e<=1)t=0;else{var n=2*e;t-=n*Math.trunc(t/n),t>=e&&(t=n-t-1)}return N.util.clamp(0,t,e-1)}function a$e(r,e){var t=r;if(t<0)if(e<=1)t=0;else{var n=e-1;t+=e*(Math.trunc(-t/n)+1)}else if(t>e-1)if(e<=1)t=0;else{var n=e-1;t-=e*Math.trunc(t/n)}return N.util.clamp(0,t,e-1)}function i$e(r,e){return r}function o$e(r,e){return N.util.clamp(0,r,e-1)}function ih(r,e,t,n,a,i,o,s,u,c,l){var f=o*n+s*a+u*i+c;return 0<=s&&s<e&&0<=u&&u<t?r[f]:l}function s$e(r,e,t,n,a,i,o,s,u,c,l){var f=Math.round(s),h=Math.round(u);return ih(r,e,t,n,a,i,o,f,h,c,l)}function u$e(r,e,t,n,a,i,o,s,u,c,l){var f=Math.floor(s),h=Math.floor(u),p=f+1,d=h+1,m=(d-u)*ih(r,e,t,n,a,i,o,f,h,c,l)+(u-h)*ih(r,e,t,n,a,i,o,f,d,c,l),v=(d-u)*ih(r,e,t,n,a,i,o,p,h,c,l)+(u-h)*ih(r,e,t,n,a,i,o,p,d,c,l);return(p-s)*m+(s-f)*v}function c$e(r){var e=r.inputs,t=r.attrs,n=r.backend,a=t.axis,i=e.x;Ue(i,"unique");var o=n.data.get(i.dataId).values,s=W$(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[n.makeTensorInfo(c,i.dtype,u),n.makeTensorInfo([l.length],"int32",l)]}var l$e={kernelName:N.Unique,backendName:"cpu",kernelFunc:c$e};function f$e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.value,i=n.axis;i<0&&(i+=a.shape.length);for(var o=a.shape.length,s=a.shape[i],u=new Array(o-1),c=0,l=0;l<o;l++)l!==i&&(u[c++]=a.shape[l]);var f=new Array(o).fill(0),h=a.shape.slice();h[i]=1;for(var p=new Array(s),l=0;l<p.length;l++){f[i]=l;var d=vu({inputs:{x:a},backend:t,attrs:{begin:f,size:h}});p[l]=Vt({inputs:{x:d},backend:t,attrs:{shape:u}}),t.disposeIntermediateTensorInfo(d)}return p}var h$e={kernelName:N.Unpack,backendName:"cpu",kernelFunc:f$e};function p$e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.segmentIds,o=n.numSegments;Ue(a,"unsortedSegmentSum");for(var s=a.shape.length,u=i.shape.length,c=[],l=[],f=s-u,h=i,p=0;p<f;++p){var d=Jv({inputs:{input:h},backend:t,attrs:{dim:p+1}});h=d,l.push(d)}for(var p=0;p<o;++p){var m=N.util.createScalarValue(p,"int32"),v=t.makeTensorInfo([],"int32",m),g=n$({inputs:{a:v,b:h},backend:t}),y=ns({inputs:{x:g},backend:t,attrs:{dtype:"float32"}}),w=em({inputs:{a:y,b:a},backend:t}),b=oh({inputs:{x:w},backend:t,attrs:{axis:0,keepDims:!1}});c.push(b),l.push(v),l.push(g),l.push(y),l.push(w),l.push(b)}var x=nq({inputs:c,backend:t,attrs:{axis:0}});return l.forEach(function(S){return t.disposeIntermediateTensorInfo(S)}),x}var d$e={kernelName:N.UnsortedSegmentSum,backendName:"cpu",kernelFunc:p$e},dx,Kz,v$e=[cMe,qOe,fMe,pMe,KOe,vMe,gMe,bMe,xMe,SMe,TMe,IMe,AMe,FMe,OMe,BMe,zMe,qMe,VMe,sMe,GMe,KMe,XMe,XOe,ZMe,GOe,ZOe,QMe,WOe,t4e,n4e,a4e,o4e,u4e,l4e,h4e,d4e,m4e,y4e,w4e,k4e,N4e,E4e,C4e,A4e,_4e,R4e,P4e,M4e,B4e,L4e,$4e,V4e,eMe,G4e,JOe,Q4e,QOe,eBe,tPe,oBe,sBe,cBe,nPe,iPe,fBe,pBe,vBe,gBe,sPe,cPe,VOe,bBe,r4e,xBe,SBe,TBe,tMe,fPe,pPe,IBe,vPe,ABe,FBe,OBe,BBe,zBe,qBe,WBe,gPe,UBe,HBe,jBe,YBe,JBe,eLe,rLe,bPe,aLe,sLe,lLe,xPe,SPe,pLe,mLe,bLe,TPe,xLe,SLe,NLe,aq,CLe,nMe,CPe,DLe,FLe,OLe,MLe,UOe,mx,LLe,aMe,iMe,oMe,$Le,WLe,ULe,HLe,jLe,XLe,ZLe,BPe,QLe,aze,oze,lze,zPe,hze,dze,mze,$Pe,uLe,bze,xze,Sze,Tze,Ize,Aze,_ze,Rze,VPe,Oze,GPe,KPe,Mze,Lze,$ze,Wze,Uze,ZPe,q4e,Hze,jze,Yze,Jze,e$e,r$e,EPe,l$e,h$e,d$e,kLe];try{for(nh=Pc(v$e),Oc=nh.next();!Oc.done;Oc=nh.next())jz=Oc.value,N.registerKernel(jz)}catch(r){dx={error:r}}finally{try{Oc&&!Oc.done&&(Kz=nh.return)&&Kz.call(nh)}finally{if(dx)throw dx.error}}var jz,nh,Oc;tm.MathBackendCPU=yx;tm.shared=JPe;tm.version_cpu=QPe});var fV=Y(po=>{"use strict";var k=Rs();function m$e(r){var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var g$e=m$e(k),Dx=function(r,e){return Dx=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])},Dx(r,e)};function y$e(r,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Dx(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function qc(r,e,t,n){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(n.next(l))}catch(f){o(f)}}function u(l){try{c(n.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((n=n.apply(r,e||[])).next())})}function Wc(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(r,t)}catch(l){c=[6,l],a=0}finally{n=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function kn(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Te(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function pr(r,e,t){if(t||arguments.length===2)for(var n=0,a=e.length,i;n<a;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))}var gu={},rm={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Mq(r,e){gu[r]=e}function Ni(r,e){if(!(r in gu)||e!=null){var t=w$e(r,e);if(t!==null)gu[r]=t;else return console.log("Could not get context for WebGL version",r),null}var n=gu[r];return n==null||n.isContextLost()?(delete gu[r],Ni(r)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),gu[r])}function b$e(r){if(!k.env().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&r===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function w$e(r,e){if(r!==1&&r!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=e??b$e(r);return t.addEventListener("webglcontextlost",function(n){n.preventDefault(),delete gu[r]},!1),k.env().getBool("SOFTWARE_WEBGL_ENABLED")&&(rm.failIfMajorPerformanceCaveat=!1),r===1?t.getContext("webgl",rm)||t.getContext("experimental-webgl",rm):t.getContext("webgl2",rm)}var ph;(function(r){r[r.DENSE=0]="DENSE",r[r.SHARED_BATCH=1]="SHARED_BATCH"})(ph||(ph={}));var xa;(function(r){r[r.RENDER=0]="RENDER",r[r.UPLOAD=1]="UPLOAD",r[r.PIXELS=2]="PIXELS",r[r.DOWNLOAD=3]="DOWNLOAD"})(xa||(xa={}));var sn;(function(r){r[r.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",r[r.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",r[r.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",r[r.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",r[r.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(sn||(sn={}));function yh(r,e){return[e,r]}function x$e(r,e){return r*e}function nm(r){var e=k.util.sizeFromShape(r),t=Math.ceil(e/4);return k.util.sizeToSquarishShape(t)}function Vc(r,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(r/2))]}function k$e(r,e){var t=Te(Vc(r,e),2),n=t[0],a=t[1];return n*a*4}function Lx(r,e){var t=r,n,a,i,o,s,u,c,l,f,h;return k.env().getNumber("WEBGL_VERSION")===2?(n=t.R32F,a=t.R16F,i=t.RGBA16F,o=t.RGBA32F,s=t.RED,c=4,l=1,f=t.HALF_FLOAT,h=t.FLOAT,u=t.RGBA8):(n=r.RGBA,a=r.RGBA,i=r.RGBA,o=t.RGBA,s=r.RGBA,c=4,l=4,f=e!=null?e.HALF_FLOAT_OES:null,h=r.FLOAT,u=r.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:a,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:s,downloadTextureFormat:u,downloadUnpackNumChannels:c,defaultNumChannels:l,textureTypeHalfFloat:f,textureTypeFloat:h}}function Pe(r,e){var t=e();return k.env().getBool("DEBUG")&&S$e(r),t}function S$e(r){var e=r.getError();if(e!==r.NO_ERROR)throw new Error("WebGL Error: "+Lq(r,e))}var N$e=596e-10,T$e=65504;function Bq(r){return!!(k.env().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||r===0||N$e<Math.abs(r)&&Math.abs(r)<T$e)}function Lq(r,e){switch(e){case r.NO_ERROR:return"NO_ERROR";case r.INVALID_ENUM:return"INVALID_ENUM";case r.INVALID_VALUE:return"INVALID_VALUE";case r.INVALID_OPERATION:return"INVALID_OPERATION";case r.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case r.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case r.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(e)}}function uh(r,e){return fo(r,function(){return r.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function zq(r,e){var t=fo(r,function(){return r.createShader(r.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Pe(r,function(){return r.shaderSource(t,e)}),Pe(r,function(){return r.compileShader(t)}),r.getShaderParameter(t,r.COMPILE_STATUS)===!1)throw console.log(r.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function $q(r,e){var t=fo(r,function(){return r.createShader(r.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Pe(r,function(){return r.shaderSource(t,e)}),Pe(r,function(){return r.compileShader(t)}),k.env().get("ENGINE_COMPILE_ONLY"))return t;if(r.getShaderParameter(t,r.COMPILE_STATUS)===!1)throw zx(e,r.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}var E$e=/ERROR: [0-9]+:([0-9]+):/g;function zx(r,e){var t=E$e.exec(e);if(t==null){console.log("Couldn't parse line number in error: ".concat(e)),console.log(r);return}for(var n=+t[1],a=r.split(`
`),i=a.length.toString().length+2,o=a.map(function(h,p){return k.util.rightPad((p+1).toString(),i)+h}),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var c=o.slice(0,n-1),l=o.slice(n-1,n),f=o.slice(n);console.log(c.join(`
`)),console.log(e.split(`
`)[0]),console.log("%c ".concat(k.util.rightPad(l[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join(`
`))}function qq(r){return fo(r,function(){return r.createProgram()},"Unable to create WebGLProgram.")}function Wq(r,e){if(Pe(r,function(){return r.linkProgram(e)}),!k.env().get("ENGINE_COMPILE_ONLY")&&r.getProgramParameter(e,r.LINK_STATUS)===!1)throw console.log(r.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function sm(r,e){if(Pe(r,function(){return r.validateProgram(e)}),r.getProgramParameter(e,r.VALIDATE_STATUS)===!1)throw console.log(r.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function Vq(r,e){var t=fo(r,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return Pe(r,function(){return r.bindBuffer(r.ARRAY_BUFFER,t)}),Pe(r,function(){return r.bufferData(r.ARRAY_BUFFER,e,r.STATIC_DRAW)}),t}function Uq(r,e){var t=fo(r,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return Pe(r,function(){return r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t)}),Pe(r,function(){return r.bufferData(r.ELEMENT_ARRAY_BUFFER,e,r.STATIC_DRAW)}),t}function I$e(){return k.env().getNumber("WEBGL_VERSION")===2?1:4}function Gq(r){return fo(r,function(){return r.createTexture()},"Unable to create WebGLTexture.")}function Hq(r,e){var t=k.env().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(r<=0||e<=0){var n="[".concat(r,"x").concat(e,"]");throw new Error("Requested texture size "+n+" is invalid.")}if(r>t||e>t){var n="[".concat(r,"x").concat(e,"]"),a="[".concat(t,"x").concat(t,"]");throw new Error("Requested texture size "+n+" greater than WebGL maximum on this browser / GPU "+a+".")}}function Kq(r){return fo(r,function(){return r.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function _x(r,e,t,n,a,i,o){var s=r.getAttribLocation(e,t);return s===-1?!1:(Pe(r,function(){return r.bindBuffer(r.ARRAY_BUFFER,n)}),Pe(r,function(){return r.vertexAttribPointer(s,a,r.FLOAT,!1,i,o)}),Pe(r,function(){return r.enableVertexAttribArray(s)}),!0)}function jq(r,e,t){Qq(r,t),Pe(r,function(){return r.activeTexture(r.TEXTURE0+t)}),Pe(r,function(){return r.bindTexture(r.TEXTURE_2D,e)})}function C$e(r,e){Qq(r,e),Pe(r,function(){return r.activeTexture(r.TEXTURE0+e)}),Pe(r,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function Xq(r,e,t){return fo(r,function(){return r.getUniformLocation(e,t)},'uniform "'+t+'" not present in program.')}function Yq(r,e,t){return r.getUniformLocation(e,t)}function Zq(r,e,t,n){Pe(r,function(){return jq(r,e,n)}),Pe(r,function(){return r.uniform1i(t,n)})}function A$e(r){Pe(r,function(){return r.bindFramebuffer(r.FRAMEBUFFER,null)}),Pe(r,function(){return r.viewport(0,0,r.canvas.width,r.canvas.height)}),Pe(r,function(){return r.scissor(0,0,r.canvas.width,r.canvas.height)})}function um(r,e,t){Pe(r,function(){return r.bindFramebuffer(r.FRAMEBUFFER,t)}),Pe(r,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0)})}function Fx(r,e){Pe(r,function(){return r.bindFramebuffer(r.FRAMEBUFFER,e)}),Pe(r,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0)})}function ch(r){var e=r.checkFramebufferStatus(r.FRAMEBUFFER);if(e!==r.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Jq(r,e))}function Jq(r,e){switch(e){case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case r.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(e)}}function fo(r,e,t){var n=Pe(r,function(){return e()});if(n==null)throw new Error(t);return n}function Qq(r,e){var t=r.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=e+r.TEXTURE0;if(n<r.TEXTURE0||n>t){var a="[gl.TEXTURE0, gl.TEXTURE".concat(t,"]");throw new Error("textureUnit must be in ".concat(a,"."))}}function yu(r,e){return e===void 0&&(e=2),k.util.sizeFromShape(r.slice(0,r.length-e))}function bu(r){if(r.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[r.length>1?r[r.length-2]:1,r[r.length-1]]}function lh(r){var e=[1,1,1],t=r.length===0||r.length===1&&r[0]===1;return t||(e=pr([yu(r)],Te(bu(r)),!1)),e}function eW(r,e){var t;e===void 0&&(e=!1);var n=k.env().getNumber("WEBGL_MAX_TEXTURE_SIZE"),a=k.env().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");if(a===1/0&&k.env().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(a=n/2),e&&(n=n*2,a=a*2,r=r.map(function(h,p){return p>=r.length-2?k.util.nearestLargerEven(r[p]):r[p]}),r.length===1&&(r=[2,r[0]])),r.length!==2){var i=k.util.squeezeShape(r);r=i.newShape}var o=k.util.sizeFromShape(r),s=null;r.length<=1&&o<=n?s=[1,o]:r.length===2&&r[0]<=n&&r[1]<=n?s=r:r.length===3&&r[0]*r[1]<=n&&r[2]<=n?s=[r[0]*r[1],r[2]]:r.length===3&&r[0]<=n&&r[1]*r[2]<=n?s=[r[0],r[1]*r[2]]:r.length===4&&r[0]*r[1]*r[2]<=n&&r[3]<=n?s=[r[0]*r[1]*r[2],r[3]]:r.length===4&&r[0]<=n&&r[1]*r[2]*r[3]<=n&&(s=[r[0],r[1]*r[2]*r[3]]);var u=s!=null&&Math.max.apply(Math,pr([],Te(s),!1))>a&&Math.min.apply(Math,pr([],Te(s),!1))<=(e?2:1)&&Math.min.apply(Math,pr([],Te(s),!1))>0;if(s==null||u)if(e){var c=yu(r),l=2,f=2;r.length&&(t=Te(bu(r),2),l=t[0],f=t[1]),o=c*(l/2)*(f/2),s=k.util.sizeToSquarishShape(o).map(function(h){return h*2})}else s=k.util.sizeToSquarishShape(o);return s}function am(r){return r%2===0}function dh(r,e){if(r=r.slice(-2),e=e.slice(-2),k.util.arraysEqual(r,e)||!r.length||!e.length||r[0]===0||r[1]===0||e[0]===0||e[1]===0)return!0;if(r.length!==e.length){var t=r[r.length-1],n=e[e.length-1];if(t===n||am(t)&&am(n)&&(r[0]===1||e[0]===1))return!0}return r[1]===e[1]&&am(r[0])&&am(e[0])}var cm,lm;function tW(r){if(cm==null){var e=Ni(r);cm=e.getParameter(e.MAX_TEXTURE_SIZE)}return cm}function D$e(){cm=null}function _$e(){lm=null}function rW(r){if(lm==null){var e=Ni(r);lm=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,lm)}function nW(r){if(r===0)return 0;var e,t=Ni(r);return ka(t,"EXT_disjoint_timer_query_webgl2")&&r===2?e=2:ka(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function ka(r,e){var t=r.getExtension(e);return t!=null}function Rx(r){try{var e=Ni(r);if(e!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function aW(r){if(r===0)return!1;var e=Ni(r);if(r===1){if(!ka(e,"OES_texture_float"))return!1}else if(!ka(e,"EXT_color_buffer_float"))return!1;var t=Ox(e);return t}function iW(r){if(r===0)return!1;var e=Ni(r);if(r===1){if(!ka(e,"OES_texture_float")||!ka(e,"WEBGL_color_buffer_float"))return!1}else{if(ka(e,"EXT_color_buffer_float"))return Ox(e);var t="EXT_color_buffer_half_float";if(ka(e,t)){var n=e.getExtension(t);return F$e(e,n)}return!1}var a=Ox(e);return a}function Ox(r){var e=Lx(r),t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t);var n=1,a=1;r.texImage2D(r.TEXTURE_2D,0,e.internalFormatFloat,n,a,0,e.textureFormatFloat,e.textureTypeFloat,null);var i=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,i),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0);var o=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(t),r.deleteFramebuffer(i),o}function F$e(r,e){var t=Lx(r,e),n=r.createTexture();r.bindTexture(r.TEXTURE_2D,n);var a=1,i=1;r.texImage2D(r.TEXTURE_2D,0,t.internalFormatHalfFloat,a,i,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);var o=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,o),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,n,0);var s=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(n),r.deleteFramebuffer(o),s}function oW(r){if(r!==2)return!1;var e=Ni(r),t=e.fenceSync!=null;return t}function Uc(r,e){Array.isArray(r)||(r=[r]),r.forEach(function(t){t!=null&&k.util.assert(t.dtype!=="complex64",function(){return"".concat(e," does not support complex64 tensors ")+"in the WebGL backend."})})}var R$e={__proto__:null,assertNotComplex:Uc,bindCanvasToFramebuffer:A$e,bindColorTextureToFramebuffer:um,bindTextureToProgramUniformSampler:Zq,bindTextureUnit:jq,bindVertexBufferToProgramAttribute:_x,callAndCheck:Pe,canBeRepresented:Bq,createFragmentShader:$q,createFramebuffer:Kq,createProgram:qq,createStaticIndexBuffer:Uq,createStaticVertexBuffer:Vq,createTexture:Gq,createVertexShader:zq,getBatchDim:yu,getExtensionOrThrow:uh,getFramebufferErrorMessage:Jq,getMaxTexturesInShader:rW,getNumChannels:I$e,getProgramUniformLocation:Yq,getProgramUniformLocationOrThrow:Xq,getRowsCols:bu,getShapeAs3D:lh,getTextureShapeFromLogicalShape:eW,getWebGLDisjointQueryTimerVersion:nW,getWebGLErrorMessage:Lq,getWebGLMaxTextureSize:tW,hasExtension:ka,isCapableOfRenderingToFloatTexture:aW,isDownloadFloatTextureEnabled:iW,isReshapeFree:dh,isWebGLFenceEnabled:oW,isWebGLVersionEnabled:Rx,linkProgram:Wq,logShaderSourceAndInfoLog:zx,resetMaxTextureSize:D$e,resetMaxTexturesInShader:_$e,unbindColorTextureFromFramebuffer:Fx,unbindTextureUnit:C$e,validateFramebuffer:ch,validateProgram:sm,validateTextureSize:Hq};var Ke=k.env();Ke.registerFlag("HAS_WEBGL",function(){return Ke.getNumber("WEBGL_VERSION")>0});Ke.registerFlag("WEBGL_VERSION",function(){return Rx(2)?2:Rx(1)?1:0});Ke.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",function(){return!1});Ke.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return Ke.get("WEBGL_VERSION")===2});Ke.registerFlag("WEBGL_CPU_FORWARD",function(){return!0});Ke.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1});Ke.registerFlag("WEBGL_PACK",function(){return Ke.getBool("HAS_WEBGL")});Ke.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_CLIP",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_REDUCE",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_LAZILY_UNPACK",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_CONV_IM2COL",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return tW(Ke.getNumber("WEBGL_VERSION"))});Ke.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return rW(Ke.getNumber("WEBGL_VERSION"))});Ke.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var r=Ke.getNumber("WEBGL_VERSION");return r===0?0:nW(r)});Ke.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return Ke.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!k.device_util.isMobile()});Ke.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return aW(Ke.getNumber("WEBGL_VERSION"))});Ke.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return Ke.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Ke.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")});Ke.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return iW(Ke.getNumber("WEBGL_VERSION"))});Ke.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return oW(Ke.getNumber("WEBGL_VERSION"))});Ke.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){var r=Ke.getBool("WEBGL_RENDER_FLOAT32_ENABLED");return r?4:0});Ke.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",function(){return-1},function(r){if(r<0&&r!==-1)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never "+"delete) or at least 0, but got ".concat(r,"."))});Ke.registerFlag("WEBGL_FLUSH_THRESHOLD",function(){return k.device_util.isMobile()?1:-1},function(r){if(r<0&&r!==-1)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never "+"manual flush) or at least 0, but got ".concat(r,"."))});Ke.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",function(){return 128});Ke.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",function(){return!1});Ke.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",function(){return 1e5});Ke.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",function(){return 128});Ke.registerFlag("WEBGL_EXP_CONV",function(){return!1});Ke.registerFlag("SOFTWARE_WEBGL_ENABLED",function(){return Ke.getBool("IS_TEST")});Ke.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",function(){return 1/0});Ke.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",function(){return!1});Ke.registerFlag("WEBGL2_ISNAN_CUSTOM",function(){return!1});Ke.registerFlag("ENGINE_COMPILE_ONLY",function(){return!1});function Nn(){var r,e,t,n,a,i,o,s,u,c;return k.env().getNumber("WEBGL_VERSION")===2?(r="#version 300 es",e="in",t="out",n="in",a="texture",i="outputColor",o="out vec4 outputColor;",s=k.env().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",u="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(r="",e="attribute",t="varying",n="varying",a="texture2D",i="gl_FragColor",o="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:r,attribute:e,varyingVs:t,varyingFs:n,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function xu(r,e,t){t===void 0&&(t="index");var n=k.util.computeStrides(e);return n.map(function(a,i){var o="int ".concat(r[i]," = ").concat(t," / ").concat(a),s=i===n.length-1?"int ".concat(r[i+1]," = ").concat(t," - ").concat(r[i]," * ").concat(a):"index -= ".concat(r[i]," * ").concat(a);return"".concat(o,"; ").concat(s,";")}).join("")}function mm(r,e,t){t===void 0&&(t="index");var n=k.util.computeStrides(e);return n.map(function(a,i){var o="int ".concat(r[i]," = ").concat(t," / outShapeStrides[").concat(i,"]"),s=i===n.length-1?"int ".concat(r[i+1]," = ").concat(t," - ").concat(r[i]," * outShapeStrides[").concat(i,"]"):"index -= ".concat(r[i]," * outShapeStrides[").concat(i,"]");return"".concat(o,"; ").concat(s,";")}).join("")}function O$e(r,e){var t=r.length,n=r.map(function(o){return"".concat(e,"[").concat(o,"]")}),a=new Array(t-1);a[t-2]=n[t-1];for(var i=t-3;i>=0;--i)a[i]="(".concat(a[i+1]," * ").concat(n[i+1],")");return a}function P$e(r,e,t){t===void 0&&(t="index");var n=r.map(function(i,o){return o}),a=O$e(n,e);return a.map(function(i,o){var s="int ".concat(r[o]," = ").concat(t," / ").concat(a[o]),u=o===a.length-1?"int ".concat(r[o+1]," = ").concat(t," - ").concat(r[o]," * ").concat(a[o]):"index -= ".concat(r[o]," * ").concat(a[o]);return"".concat(s,"; ").concat(u,";")}).join("")}function $x(r){var e=k.util.computeStrides(r).map(function(t){return t.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `.concat(e[0]," + coords.y * ").concat(e[1],` + coords.z;
  }
`)}function qx(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}var sW=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`,uW=k.backend_util.getBroadcastDims;function M$e(r,e,t){var n=[];if(r.forEach(function(p){var d=k.util.sizeFromShape(p.shapeInfo.logicalShape);if(p.shapeInfo.isUniform?n.push("uniform float ".concat(p.name).concat(d>1?"[".concat(d,"]"):"",";")):(n.push("uniform sampler2D ".concat(p.name,";")),n.push("uniform int offset".concat(p.name,";"))),t.enableShapeUniforms){var m=Wx(t.packedInputs,p.shapeInfo.logicalShape,p.shapeInfo.texShape).uniformShape;switch(m.length){case 1:n.push("uniform int ".concat(p.name,"Shape;"));break;case 2:n.push("uniform ivec2 ".concat(p.name,"Shape;"));break;case 3:n.push("uniform ivec3 ".concat(p.name,"Shape;"));break;case 4:n.push("uniform ivec4 ".concat(p.name,"Shape;"));break}n.push("uniform ivec2 ".concat(p.name,"TexShape;"))}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:n.push("uniform int outShape;");break;case 2:n.push("uniform ivec2 outShape;"),n.push("uniform int outShapeStrides;");break;case 3:n.push("uniform ivec3 outShape;"),n.push("uniform ivec2 outShapeStrides;");break;case 4:n.push("uniform ivec4 outShape;"),n.push("uniform ivec3 outShapeStrides;");break}n.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(function(p){n.push("uniform ".concat(p.type," ").concat(p.name).concat(p.arrayIndex?"[".concat(p.arrayIndex,"]"):"",";"))});var a=n.join(`
`),i=r.map(function(p){return B$e(p,e,t.packedInputs,t.enableShapeUniforms)}).join(`
`),o=e.texShape,s=Nn(),u=$$e(s),c,l,f=V$e(s);e.isPacked?(c=L$e(e.logicalShape,o,t.enableShapeUniforms),l=W$e(s)):(c=z$e(e.logicalShape,o,t.enableShapeUniforms),l=q$e(s)),t.packedInputs&&(f+=K$e);var h=[f,u,l,a,c,i,t.userCode].join(`
`);return h}function Gc(r,e){e===void 0&&(e=!1);var t=r.shapeInfo.logicalShape;switch(t.length){case 0:return iqe(r,e);case 1:return sqe(r,e);case 2:return cqe(r,e);case 3:return fqe(r,e);case 4:return pqe(r,e);case 5:return dqe(r);case 6:return vqe(r);default:throw new Error("".concat(t.length,"-D input sampling")+" is not yet supported")}}function cW(r,e){var t=r.shapeInfo.logicalShape;switch(t.length){case 0:return aqe(r);case 1:return oqe(r,e);case 2:return uqe(r,e);case 3:return lqe(r,e);default:return hqe(r,e)}}function B$e(r,e,t,n){t===void 0&&(t=!1);var a="";t?a+=cW(r,n):a+=Gc(r,n);var i=r.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(t?a+=mqe(r,e):a+=gqe(r,e)),a}function L$e(r,e,t){switch(r.length){case 0:return lW();case 1:return j$e(r,e,t);case 2:return rqe(r,e,t);case 3:return Y$e(r,e,t);default:return J$e(r,e,t)}}function z$e(r,e,t){switch(r.length){case 0:return lW();case 1:return X$e(r,e,t);case 2:return nqe(r,e,t);case 3:return Z$e(r,e,t);case 4:return Q$e(r,e,t);case 5:return eqe(r,e);case 6:return tqe(r,e);default:throw new Error("".concat(r.length,"-D output sampling is not yet supported"))}}function $$e(r){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `.concat(r.texture2D,`(textureSampler, uv).r;
    }
  `)}function q$e(r){return`
    void setOutput(float val) {
      `.concat(r.output,` = vec4(val, 0, 0, 0);
    }
  `)}function W$e(r){return`
    void setOutput(vec4 val) {
      `.concat(r.output,` = val;
    }
  `)}function V$e(r){var e="".concat(r.version,`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `).concat(r.varyingFs,` vec2 resultUV;
    `).concat(r.defineOutput,`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `).concat(r.defineSpecialNaN,`
    `).concat(r.defineSpecialInf,`
    `).concat(r.defineRound,`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `).concat(U$e,`
    `).concat(G$e,`
    `).concat(H$e,`
  `);return e}var U$e=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,G$e=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,H$e=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,K$e=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function lW(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function j$e(r,e,t){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return n[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `.concat(n[1],`.0);
      }
    `):n[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `.concat(n[0],`.0);
      }
    `):t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(n[0],", ").concat(n[1],`));
      return 2 * (resTexRC.x * `).concat(n[1],` + resTexRC.y);
    }
  `)}function X$e(r,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * `.concat(e[1],`.0);
      }
    `):e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * `.concat(e[0],`.0);
      }
    `):t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(e[0],", ").concat(e[1],`));
      return resTexRC.x * `).concat(e[1],` + resTexRC.y;
    }
  `)}function Y$e(r,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],a=Math.ceil(r[2]/2),i=a*Math.ceil(r[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(n[0],", ").concat(n[1],`));
      int index = resTexRC.x * `).concat(n[1],` + resTexRC.y;

      int b = index / `).concat(i,`;
      index -= b * `).concat(i,`;

      int r = 2 * (index / `).concat(a,`);
      int c = imod(index, `).concat(a,`) * 2;

      return ivec3(b, r, c);
    }
  `)}function Z$e(r,e,t){if(t){var n=mm(["r","c","d"],r);return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    `.concat(n,`
    return ivec3(r, c, d);
  }
`)}var a=xu(["r","c","d"],r);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
      `).concat(a,`
      return ivec3(r, c, d);
    }
  `)}function J$e(r,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;for(var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],a=Math.ceil(r[r.length-1]/2),i=a*Math.ceil(r[r.length-2]/2),o=i,s="",u="b, r, c",c=2;c<r.length-1;c++)o*=r[r.length-c-1],s=`
      int b`.concat(c," = index / ").concat(o,`;
      index -= b`).concat(c," * ").concat(o,`;
    `)+s,u="b".concat(c,", ")+u;return`
    ivec`.concat(r.length,` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`).concat(n[0],", ").concat(n[1],`));
      int index = resTexRC.x * `).concat(n[1],` + resTexRC.y;

      `).concat(s,`

      int b = index / `).concat(i,`;
      index -= b * `).concat(i,`;

      int r = 2 * (index / `).concat(a,`);
      int c = imod(index, `).concat(a,`) * 2;

      return ivec`).concat(r.length,"(").concat(u,`);
    }
  `)}function Q$e(r,e,t){if(t){var n=mm(["r","c","d","d2"],r);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      `.concat(n,`
      return ivec4(r, c, d, d2);
    }
  `)}var a=xu(["r","c","d","d2"],r);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
      `).concat(a,`
      return ivec4(r, c, d, d2);
    }
  `)}function eqe(r,e){var t=xu(["r","c","d","d2","d3"],r);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`.concat(e[0],`,
                             `).concat(e[1],`));

      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;

      `).concat(t,`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `)}function tqe(r,e){var t=xu(["r","c","d","d2","d3","d4"],r);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;

      `).concat(t,`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `)}function rqe(r,e,t){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(k.util.arraysEqual(r,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`.concat(n[0],", ").concat(n[1],`));
      }
    `);var a=Math.ceil(r[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(n[0],", ").concat(n[1],`));

      int index = resTexRC.x * `).concat(n[1],` + resTexRC.y;
      int r = 2 * (index / `).concat(a,`);
      int c = imod(index, `).concat(a,`) * 2;

      return ivec2(r, c);
    }
  `)}function nqe(r,e,t){return k.util.arraysEqual(r,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`.concat(e[0],", ").concat(e[1],`));
      }
    `):r[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`.concat(e[0],", ").concat(e[1],`));
        int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
        return ivec2(index, 0);
      }
    `):r[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`.concat(e[0],", ").concat(e[1],`));
        int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
        return ivec2(0, index);
      }
    `):t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
      int r = index / `).concat(r[1],`;
      int c = index - r * `).concat(r[1],`;
      return ivec2(r, c);
    }
  `)}function ku(r){return"offset".concat(r)}function aqe(r){var e=r.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),n=Nn();return`
    vec4 `.concat(t,`() {
      return `).concat(n.texture2D,"(").concat(e,`, halfCR);
    }
  `)}function iqe(r,e){var t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(r.shapeInfo.isUniform)return"float ".concat(n,"() {return ").concat(t,";}");var a=Te(r.shapeInfo.texShape,2),i=a[0],o=a[1];if(i===1&&o===1)return`
      float `.concat(n,`() {
        return sampleTexture(`).concat(t,`, halfCR);
      }
    `);var s=ku(t);if(e)return`
    float `.concat(n,`() {
      vec2 uv = uvFromFlat(`).concat(t,"TexShape[0], ").concat(t,"TexShape[1], ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `);var u=Te(r.shapeInfo.texShape,2),c=u[0],l=u[1];return`
    float `.concat(n,`() {
      vec2 uv = uvFromFlat(`).concat(c,", ").concat(l,", ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function oqe(r,e){var t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),a=r.shapeInfo.texShape,i=Nn();if(e)return`
    vec4 `.concat(n,`(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(t,"TexShape[0]) / 2.0), ceil(float(").concat(t,`TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return `).concat(i.texture2D,"(").concat(t,`, uv);
    }
  `);var o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return`
    vec4 `.concat(n,`(int index) {
      vec2 uv = packedUVfrom1D(
        `).concat(o[0],", ").concat(o[1],`, index);
      return `).concat(i.texture2D,"(").concat(t,`, uv);
    }
  `)}function sqe(r,e){var t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(r.shapeInfo.isUniform)return`
      float `.concat(n,`(int index) {
        `).concat(Hc(r),`
      }
    `);var a=r.shapeInfo.texShape,i=a[0],o=a[1];if(o===1&&i===1)return`
      float `.concat(n,`(int index) {
        return sampleTexture(`).concat(t,`, halfCR);
      }
    `);var s=ku(t);return o===1?e?`
      float `.concat(n,`(int index) {
        vec2 uv = vec2(0.5, (float(index + `).concat(s,") + 0.5) / float(").concat(t,`TexShape[0]));
        return sampleTexture(`).concat(t,`, uv);
      }
    `):`
      float `.concat(n,`(int index) {
        vec2 uv = vec2(0.5, (float(index + `).concat(s,") + 0.5) / ").concat(i,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `):i===1?e?`
      float `.concat(n,`(int index) {
        vec2 uv = vec2((float(index + `).concat(s,") + 0.5) / float(").concat(t,`TexShape[1]), 0.5);
        return sampleTexture(`).concat(t,`, uv);
      }
    `):`
      float `.concat(n,`(int index) {
        vec2 uv = vec2((float(index + `).concat(s,") + 0.5) / ").concat(o,`.0, 0.5);
        return sampleTexture(`).concat(t,`, uv);
      }
    `):e?`
    float `.concat(n,`(int index) {
      vec2 uv = uvFromFlat(`).concat(t,"TexShape[0], ").concat(t,"TexShape[1], index + ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `):`
    float `.concat(n,`(int index) {
      vec2 uv = uvFromFlat(`).concat(i,", ").concat(o,", index + ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function uqe(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=r.shapeInfo.texShape,o=i[0],s=i[1],u=Nn();if(i!=null&&k.util.arraysEqual(t,i))return e?`
      vec4 `.concat(a,`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(n,"TexShape[1], ").concat(n,`TexShape[0]);

        return `).concat(u.texture2D,"(").concat(n,`, uv);
      }
    `):`
      vec4 `.concat(a,`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(s,".0, ").concat(o,`.0);

        return `).concat(u.texture2D,"(").concat(n,`, uv);
      }
    `);if(e)return`
    vec4 `.concat(a,`(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,`TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(`).concat(n,`Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return `).concat(u.texture2D,"(").concat(n,`, uv);
    }
  `);var c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],l=Math.ceil(t[1]/2);return`
    vec4 `.concat(a,`(int row, int col) {
      vec2 uv = packedUVfrom2D(`).concat(l,", ").concat(c[0],", ").concat(c[1],`, row, col);
      return `).concat(u.texture2D,"(").concat(n,`, uv);
    }
  `)}function cqe(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=r.shapeInfo.texShape;if(i!=null&&k.util.arraysEqual(t,i)){if(e)return`
      float `.concat(a,`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(n,"TexShape[1], ").concat(n,`TexShape[0]);
        return sampleTexture(`).concat(n,`, uv);
      }
    `);var o=i[0],s=i[1];return`
    float `.concat(a,`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(s,".0, ").concat(o,`.0);
      return sampleTexture(`).concat(n,`, uv);
    }
  `)}var u=k.util.squeezeShape(t),c=u.newShape,l=u.keptDims,f=c;if(f.length<t.length){var h=Kc(r,f),p=["row","col"];return`
      `.concat(Gc(h,e),`
      float `).concat(a,`(int row, int col) {
        return `).concat(a,"(").concat(jc(p,l),`);
      }
    `)}if(r.shapeInfo.isUniform)return`
      float `.concat(a,`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`).concat(t[1],`, 1)));
        `).concat(Hc(r),`
      }
    `);var d=i[0],m=i[1],v=ku(n);return m===1?e?`
      float `.concat(a,`(int row, int col) {
        float index = dot(vec3(row, col, `).concat(v,"), vec3(").concat(n,`Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(`).concat(n,`TexShape[0]));
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
    float `.concat(a,`(int row, int col) {
      float index = dot(vec3(row, col, `).concat(v,"), vec3(").concat(t[1],`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `).concat(d,`.0);
      return sampleTexture(`).concat(n,`, uv);
    }
  `):d===1?e?`
      float `.concat(a,`(int row, int col) {
        float index = dot(vec3(row, col, `).concat(v,"), vec3(").concat(n,`Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(`).concat(n,`TexShape[1]), 0.5);
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
    float `.concat(a,`(int row, int col) {
      float index = dot(vec3(row, col, `).concat(v,"), vec3(").concat(t[1],`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `).concat(m,`.0, 0.5);
      return sampleTexture(`).concat(n,`, uv);
    }
  `):e?`
      float `.concat(a,`(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `).concat(n,"Shape[1] + col + ").concat(v,`;
        vec2 uv = uvFromFlat(`).concat(n,"TexShape[0], ").concat(n,`TexShape[1], index);
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
  float `.concat(a,`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `).concat(t[1]," + col + ").concat(v,`;
    vec2 uv = uvFromFlat(`).concat(d,", ").concat(m,`, index);
    return sampleTexture(`).concat(n,`, uv);
  }
`)}function lqe(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=r.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(t[0]===1){var s=t.slice(1),u=[1,2],c=Kc(r,s),l=["b","row","col"];return`
        `.concat(cW(c,e),`
        vec4 `).concat(a,`(int b, int row, int col) {
          return `).concat(a,"(").concat(jc(l,u),`);
        }
      `)}var f=Nn();if(e)return`
    vec4 `.concat(a,`(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,`TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(`).concat(n,`Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(`).concat(n,`Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return `).concat(f.texture2D,"(").concat(n,`, uv);
    }
  `);var h=o[0],p=o[1],d=Math.ceil(t[2]/2),m=d*Math.ceil(t[1]/2);return`
    vec4 `.concat(a,`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `).concat(h,", ").concat(p,", ").concat(m,", ").concat(d,`, b, row, col);
      return `).concat(f.texture2D,"(").concat(n,`, uv);
    }
  `)}function fqe(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[1]*t[2],o=t[2],s=k.util.squeezeShape(t),u=s.newShape,c=s.keptDims,l=u;if(l.length<t.length){var f=Kc(r,l),h=["row","col","depth"];return`
        `.concat(Gc(f,e),`
        float `).concat(a,`(int row, int col, int depth) {
          return `).concat(a,"(").concat(jc(h,c),`);
        }
      `)}if(r.shapeInfo.isUniform)return`
      float `.concat(a,`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`).concat(i,", ").concat(o,`, 1)));
        `).concat(Hc(r),`
      }
    `);var p=r.shapeInfo.texShape,d=p[0],m=p[1],v=r.shapeInfo.flatOffset;if(m===i&&v==null)return e?`
      float `.concat(a,`(int row, int col, int depth) {
        int stride1 = `).concat(n,`Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(n,"TexShape[1], ").concat(n,`TexShape[0]);
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
        float `.concat(a,`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`).concat(o,`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`).concat(m,".0, ").concat(d,`.0);
          return sampleTexture(`).concat(n,`, uv);
        }
      `);if(m===o&&v==null)return e?`
      float `.concat(a,`(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(`).concat(n,`Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`).concat(n,"TexShape[1], ").concat(n,`TexShape[0]);
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
    float `.concat(a,`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`).concat(t[1],`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`).concat(m,".0, ").concat(d,`.0);
      return sampleTexture(`).concat(n,`, uv);
    }
  `);var g=ku(n);return e?`
    float `.concat(a,`(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = `).concat(n,"Shape[1] * ").concat(n,`Shape[2];
      int stride1 = `).concat(n,`Shape[2];
      int index = row * stride0 + col * stride1 + depth + `).concat(g,`;
      vec2 uv = uvFromFlat(`).concat(n,"TexShape[0], ").concat(n,`TexShape[1], index);
      return sampleTexture(`).concat(n,`, uv);
    }
    `):`
      float `.concat(a,`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `).concat(i," + col * ").concat(o," + depth + ").concat(g,`;
        vec2 uv = uvFromFlat(`).concat(d,", ").concat(m,`, index);
        return sampleTexture(`).concat(n,`, uv);
      }
  `)}function hqe(r,e){var t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),a=Nn();if(e)return`
    vec4 `.concat(n,`(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(`).concat(t,`Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(`).concat(t,`Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= `).concat(t,`Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(t,"TexShape[0]) / 2.0), ceil(float(").concat(t,`TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return `).concat(a.texture2D,"(").concat(t,`, uv);
    }
  `);for(var i=r.shapeInfo.logicalShape,o=i.length,s=r.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=u[0],l=u[1],f=Math.ceil(i[o-1]/2),h=f*Math.ceil(i[o-2]/2),p="int b, int row, int col",d="b * ".concat(h," + (row / 2) * ").concat(f," + (col / 2)"),m=2;m<o-1;m++)p="int b".concat(m,", ")+p,h*=i[o-m-1],d="b".concat(m," * ").concat(h," + ")+d;return`
    vec4 `.concat(n,"(").concat(p,`) {
      int index = `).concat(d,`;
      int texR = index / `).concat(l,`;
      int texC = index - texR * `).concat(l,`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`).concat(l,", ").concat(c,`);
      return `).concat(a.texture2D,"(").concat(t,`, uv);
    }
  `)}function pqe(r,e){var t=r.shapeInfo.logicalShape,n=r.name,a="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t[3],o=t[2]*i,s=t[1]*o,u=k.util.squeezeShape(t),c=u.newShape,l=u.keptDims;if(c.length<t.length){var f=Kc(r,c),h=["row","col","depth","depth2"];return`
      `.concat(Gc(f,e),`
      float `).concat(a,`(int row, int col, int depth, int depth2) {
        return `).concat(a,"(").concat(jc(h,l),`);
      }
    `)}if(r.shapeInfo.isUniform)return`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`).concat(s,", ").concat(o,", ").concat(i,`, 1)));
        `).concat(Hc(r),`
      }
    `);var p=r.shapeInfo.flatOffset,d=r.shapeInfo.texShape,m=d[0],v=d[1],g="int stride2 = ".concat(n,"Shape[3];"),y="int stride1 = ".concat(n,"Shape[2] * stride2;"),w="int stride0 = ".concat(n,"Shape[1] * stride1;");if(v===s&&p==null)return e?`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        `).concat(g,`
        `).concat(y,`
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(n,"TexShape[1], ").concat(n,`TexShape[0]);
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`).concat(o,", ").concat(i,`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(v,".0, ").concat(m,`.0);
        return sampleTexture(`).concat(n,`, uv);
      }
    `);if(v===i&&p==null)return e?`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`).concat(n,"Shape[1] * ").concat(n,"Shape[2], ").concat(n,`Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(n,"TexShape[1], ").concat(n,`TexShape[0]);
        return sampleTexture(`).concat(n,`, uv);
      }
    `):`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`).concat(t[1]*t[2],", ").concat(t[2],`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(v,".0, ").concat(m,`.0);
        return sampleTexture(`).concat(n,`, uv);
      }
    `);var b=ku(n);return e?`
    float `.concat(a,`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      `).concat(g,`
      `).concat(y,`
      `).concat(w,`
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(`).concat(n,"TexShape[0], ").concat(n,"TexShape[1], index + ").concat(b,`);
      return sampleTexture(`).concat(n,`, uv);
    }
  `):`
    float `.concat(a,`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `).concat(s," + col * ").concat(o,` +
          depth * `).concat(i,` + depth2;
      vec2 uv = uvFromFlat(`).concat(m,", ").concat(v,", index + ").concat(b,`);
      return sampleTexture(`).concat(n,`, uv);
    }
  `)}function dqe(r){var e=r.shapeInfo.logicalShape,t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),a=e[4],i=e[3]*a,o=e[2]*i,s=e[1]*o,u=k.util.squeezeShape(e),c=u.newShape,l=u.keptDims;if(c.length<e.length){var f=Kc(r,c),h=["row","col","depth","depth2","depth3"];return`
      `.concat(Gc(f),`
      float `).concat(n,`(int row, int col, int depth, int depth2, int depth3) {
        return `).concat(n,"(").concat(jc(h,l),`);
      }
    `)}if(r.shapeInfo.isUniform)return`
      float `.concat(n,`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`).concat(s,", ").concat(o,", ").concat(i,", ").concat(a,`)) +
          depth3;
        `).concat(Hc(r),`
      }
    `);var p=r.shapeInfo.flatOffset,d=r.shapeInfo.texShape,m=d[0],v=d[1];if(v===s&&p==null)return`
      float `.concat(n,`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`).concat(o,", ").concat(i,", ").concat(a,`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(v,".0, ").concat(m,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);if(v===a&&p==null)return`
      float `.concat(n,`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`).concat(e[1]*e[2]*e[3],`,
               `).concat(e[2]*e[3],", ").concat(e[3],`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(v,".0, ").concat(m,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);var g=ku(t);return`
    float `.concat(n,`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `).concat(s," + col * ").concat(o," + depth * ").concat(i,` +
          depth2 * `).concat(a," + depth3 + ").concat(g,`;
      vec2 uv = uvFromFlat(`).concat(m,", ").concat(v,`, index);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function vqe(r){var e=r.shapeInfo.logicalShape,t=r.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),a=k.util.squeezeShape(e),i=a.newShape,o=a.keptDims;if(i.length<e.length){var s=Kc(r,i),u=["row","col","depth","depth2","depth3","depth4"];return`
      `.concat(Gc(s),`
      float `).concat(n,`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `).concat(n,"(").concat(jc(u,o),`);
      }
    `)}var c=e[5],l=e[4]*c,f=e[3]*l,h=e[2]*f,p=e[1]*h;if(r.shapeInfo.isUniform)return`
      float `.concat(n,`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`).concat(p,", ").concat(h,", ").concat(f,", ").concat(l,`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`).concat(c,`, 1)));
        `).concat(Hc(r),`
      }
    `);var d=r.shapeInfo.flatOffset,m=r.shapeInfo.texShape,v=m[0],g=m[1];if(g===p&&d==null)return`
      float `.concat(n,`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`).concat(h,", ").concat(f,", ").concat(l,", ").concat(c,`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(g,".0, ").concat(v,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);if(g===c&&d==null)return`
      float `.concat(n,`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`).concat(e[1]*e[2]*e[3]*e[4],`,
               `).concat(e[2]*e[3]*e[4],`,
               `).concat(e[3]*e[4],`,
               `).concat(e[4],`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(g,".0, ").concat(v,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);var y=ku(t);return`
    float `.concat(n,`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `).concat(p," + col * ").concat(h," + depth * ").concat(f,` +
          depth2 * `).concat(l," + depth3 * ").concat(c," + depth4 + ").concat(y,`;
      vec2 uv = uvFromFlat(`).concat(v,", ").concat(g,`, index);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function Hc(r){var e=r.name,t=k.util.sizeFromShape(r.shapeInfo.logicalShape);return t<2?"return ".concat(e,";"):`
    for (int i = 0; i < `.concat(t,`; i++) {
      if (i == index) {
        return `).concat(e,`[i];
      }
    }
  `)}function mqe(r,e){var t=r.name,n=t.charAt(0).toUpperCase()+t.slice(1),a="get"+n+"AtOutCoords",i=r.shapeInfo.logicalShape.length,o=e.logicalShape.length,s=uW(r.shapeInfo.logicalShape,e.logicalShape),u=Lt(o),c=o-i,l,f=["x","y","z","w","u","v"];i===0?l="":o<2&&s.length>=1?l="coords = 0;":l=s.map(function(b){return"coords.".concat(f[b+c]," = 0;")}).join(`
`);var h="";o<2&&i>0?h="coords":h=r.shapeInfo.logicalShape.map(function(b,x){return"coords.".concat(f[x+c])}).join(", ");var p="return outputValue;",d=k.util.sizeFromShape(r.shapeInfo.logicalShape),m=d===1,v=k.util.sizeFromShape(e.logicalShape),g=v===1;if(i===1&&!m&&!g)p=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(m&&!g)o===1?p=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:p=`
        return vec4(outputValue.x);
      `;else if(s.length){var y=i-2,w=i-1;s.indexOf(y)>-1&&s.indexOf(w)>-1?p="return vec4(outputValue.x);":s.indexOf(y)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":s.indexOf(w)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 `.concat(a,`() {
      `).concat(u,` coords = getOutputCoords();
      `).concat(l,`
      vec4 outputValue = get`).concat(n,"(").concat(h,`);
      `).concat(p,`
    }
  `)}function gqe(r,e){var t=r.name,n=t.charAt(0).toUpperCase()+t.slice(1),a="get"+n+"AtOutCoords",i=e.texShape,o=r.shapeInfo.texShape,s=r.shapeInfo.logicalShape.length,u=e.logicalShape.length;if(!r.shapeInfo.isUniform&&s===u&&r.shapeInfo.flatOffset==null&&k.util.arraysEqual(o,i))return`
      float `.concat(a,`() {
        return sampleTexture(`).concat(t,`, resultUV);
      }
    `);var c=Lt(u),l=uW(r.shapeInfo.logicalShape,e.logicalShape),f=u-s,h,p=["x","y","z","w","u","v"];s===0?h="":u<2&&l.length>=1?h="coords = 0;":h=l.map(function(m){return"coords.".concat(p[m+f]," = 0;")}).join(`
`);var d="";return u<2&&s>0?d="coords":d=r.shapeInfo.logicalShape.map(function(m,v){return"coords.".concat(p[v+f])}).join(", "),`
    float `.concat(a,`() {
      `).concat(c,` coords = getOutputCoords();
      `).concat(h,`
      return get`).concat(n,"(").concat(d,`);
    }
  `)}function Lt(r){if(r<=1)return"int";if(r===2)return"ivec2";if(r===3)return"ivec3";if(r===4)return"ivec4";if(r===5)return"ivec5";if(r===6)return"ivec6";throw Error("GPU for rank ".concat(r," is not yet supported"))}function Wx(r,e,t){var n=k.util.squeezeShape(e),a=n.newShape,i=n.keptDims,o=e.length,s=r&&o===3&&e[0]===1,u=s?e.slice(1):a,c=!r&&o>1&&!k.util.arraysEqual(e,t)&&a.length<o||s,l=c?u:e;return{useSqueezeShape:c,uniformShape:l,keptDims:i}}function Kc(r,e){var t=JSON.parse(JSON.stringify(r));return t.shapeInfo.logicalShape=e,t}function jc(r,e){return e.map(function(t){return r[t]}).join(", ")}function yqe(r,e,t,n){var a=t.map(function(l,f){var h={logicalShape:l.shape,texShape:l.isUniform?null:l.texData.texShape,isUniform:l.isUniform,isPacked:l.isUniform?!1:l.texData.isPacked,flatOffset:null};return l.texData!=null&&l.texData.slice!=null&&l.texData.slice.flatOffset>0&&(h.flatOffset=l.texData.slice.flatOffset),{name:e.variableNames[f],shapeInfo:h}}),i=a.map(function(l){return l.shapeInfo}),o={logicalShape:n.shape,texShape:n.texData.texShape,isUniform:!1,isPacked:n.texData.isPacked,flatOffset:null},s=M$e(a,o,e),u=$q(r.gl,s),c=r.createProgram(u);return k.env().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(r.buildVao(c),Object.assign({program:e,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o},fW(r,e,c)))}function fW(r,e,t){var n,a,i,o,s=[],u=[],c,l,f,h=null,p=null;p=r.getUniformLocation(t,"NAN",!1),k.env().getNumber("WEBGL_VERSION")===1&&(h=r.getUniformLocation(t,"INFINITY",!1));var d=!1;try{for(var m=kn(e.variableNames),v=m.next();!v.done;v=m.next()){var g=v.value,y={name:g,uniform:r.getUniformLocation(t,g,d),offset:r.getUniformLocation(t,"offset".concat(g),d)};e.enableShapeUniforms&&(y.shape=r.getUniformLocation(t,"".concat(g,"Shape"),d),y.texShape=r.getUniformLocation(t,"".concat(g,"TexShape"),d)),s.push(y)}}catch(S){n={error:S}}finally{try{v&&!v.done&&(a=m.return)&&a.call(m)}finally{if(n)throw n.error}}if(e.enableShapeUniforms&&(c=r.getUniformLocation(t,"outShape",d),f=r.getUniformLocation(t,"outShapeStrides",d),l=r.getUniformLocation(t,"outTexShape",d)),e.customUniforms)try{for(var w=kn(e.customUniforms),b=w.next();!b.done;b=w.next()){var x=b.value;u.push(r.getUniformLocation(t,x.name,d))}}catch(S){i={error:S}}finally{try{b&&!b.done&&(o=w.return)&&o.call(w)}finally{if(i)throw i.error}}return{variablesLocations:s,customUniformLocations:u,infLoc:h,nanLoc:p,outShapeLocation:c,outShapeStridesLocation:f,outTexShapeLocation:l}}function oq(r,e){if(r.length!==e.length)throw Error("Binary was compiled with ".concat(r.length," inputs, but ")+"was executed with ".concat(e.length," inputs"));r.forEach(function(t,n){var a=t.logicalShape,i=e[n],o=i.shape;if(!k.util.arraysEqual(a,o))throw Error("Binary was compiled with different shapes than "+"the current args. Shapes ".concat(a," and ").concat(o," must match"));if(!(t.isUniform&&i.isUniform)){var s=t.texShape,u=i.isUniform?null:i.texData.texShape;if(!k.util.arraysEqual(s,u))throw Error("Binary was compiled with different texture shapes than the"+" current args. Shape ".concat(s," and ").concat(u," must match"))}})}function bqe(r,e,t,n,a){e.program.enableShapeUniforms||(oq(e.inShapeInfos,t),oq([e.outShapeInfo],[n]));var i=n.texData.texture,o=n.texData.texShape;n.texData.isPacked?r.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):r.setOutputMatrixTexture(i.texture,o[0],o[1]),r.setProgram(e.webGLProgram),r.bindVertexArray(e.webGLProgram.vao),k.env().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&r.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&r.gl.uniform1f(e.nanLoc,NaN);for(var s=0;s<t.length;++s){var u=t[s],c=e.variablesLocations[s],l=c.uniform,f=c.offset,h=c.shape,p=c.texShape;if(h){var d=Wx(e.program.packedInputs,u.shape,u.texData.texShape).uniformShape;switch(d.length){case 1:r.gl.uniform1iv(h,new Int32Array(d));break;case 2:r.gl.uniform2iv(h,new Int32Array(d));break;case 3:r.gl.uniform3iv(h,new Int32Array(d));break;case 4:r.gl.uniform4iv(h,new Int32Array(d));break}}if(p&&r.gl.uniform2i(p,u.texData.texShape[0],u.texData.texShape[1]),l!=null){if(u.isUniform){if(k.util.sizeFromShape(u.shape)<2)r.gl.uniform1f(l,u.uniformValues[0]);else{var m=u.uniformValues;m instanceof Float32Array||(m=new Float32Array(m)),r.gl.uniform1fv(l,m)}continue}u.texData.slice!=null&&f!=null&&r.gl.uniform1i(f,u.texData.slice.flatOffset),r.setInputMatrixTexture(u.texData.texture.texture,l,s)}}var v=e.outShapeLocation;if(v)switch(n.shape.length){case 1:r.gl.uniform1iv(v,new Int32Array(n.shape));break;case 2:r.gl.uniform2iv(v,new Int32Array(n.shape));break;case 3:r.gl.uniform3iv(v,new Int32Array(n.shape));break;case 4:r.gl.uniform4iv(v,new Int32Array(n.shape));break}if(e.outShapeStridesLocation){var g=k.util.computeStrides(n.shape);switch(n.shape.length){case 2:r.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(g));break;case 3:r.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(g));break;case 4:r.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(g));break}}if(e.outTexShapeLocation&&r.gl.uniform2i(e.outTexShapeLocation,n.texData.texShape[0],n.texData.texShape[1]),e.program.customUniforms&&a)for(var s=0;s<e.program.customUniforms.length;++s){var y=e.program.customUniforms[s],w=e.customUniformLocations[s],b=a[s];if(y.type==="float")r.gl.uniform1fv(w,b);else if(y.type==="vec2")r.gl.uniform2fv(w,b);else if(y.type==="vec3")r.gl.uniform3fv(w,b);else if(y.type==="vec4")r.gl.uniform4fv(w,b);else if(y.type==="int")r.gl.uniform1iv(w,b);else if(y.type==="ivec2")r.gl.uniform2iv(w,b);else if(y.type==="ivec3")r.gl.uniform3iv(w,b);else if(y.type==="ivec4")r.gl.uniform4iv(w,b);else throw Error("uniform type ".concat(y.type," is not supported yet."))}r.executeProgram()}function wqe(r,e,t){var n="";e.concat(t).forEach(function(o){var s=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(r.enableShapeUniforms&&!o.isUniform){var u=o.texData.texShape,c=Wx(r.packedInputs,o.shape,u),l=c.useSqueezeShape,f=c.uniformShape,h=c.keptDims,p="",d="",m="";if(f.length===1&&r.packedInputs){var v=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];p="".concat(v[0]>1,"_").concat(v[1]>1)}else if(f.length===2&&!r.packedInputs)d="".concat(f[0]>1,"_").concat(f[1]>1);else if(f.length>2&&!r.packedInputs){var g=k.util.computeStrides(f);m="".concat(g[0]===u[1],"_").concat(g[g.length-1]===u[1])}var y=o.shape.length,w=f.length===2&&k.util.arraysEqual(o.shape,u),b=k.util.sizeFromShape(o.shape)===1,x=k.backend_util.getBroadcastDims(o.shape,t.shape),S=!r.packedInputs&&y===t.shape.length&&k.util.arraysEqual(u,t.texData.texShape),T=r.packedInputs||f.length>2?"":"".concat(u[0]>1,"_").concat(u[1]>1);n+="".concat(y,"_").concat(S,"_").concat(l?h:"","_").concat(f.length,"_").concat(b,"_").concat(x,"_").concat(w,"_").concat(p,"_").concat(d,"_").concat(m,"_").concat(T,"_").concat(s)}else{var E=o.isUniform?"uniform":o.texData.texShape;n+="".concat(o.shape,"_").concat(E,"_").concat(s)}});var a=r.userCode,i=r.constructor.name;return i+="_"+n+"_"+a+"".concat(k.env().getNumber("WEBGL_VERSION")),i}function pn(r){return k.env().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&r<=4}var xqe=function(){function r(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=ph.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var t=Nn();this.outputShape=e,this.enableShapeUniforms=pn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `.concat(this.enableShapeUniforms?mm(["r","c","d"],e):xu(["r","c","d"],e),`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `).concat(t.output,` = result;
      }
    `)}return r}();var kqe=function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=ph.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var t=Nn();this.outputShape=e,this.enableShapeUniforms=pn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `.concat(this.enableShapeUniforms?mm(["r","c","d"],e):xu(["r","c","d"],e),`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `).concat(t.output,` = result;
      }
    `)}return r}();var Sqe=function(){function r(e){this.variableNames=["A"],this.outTexUsage=xa.DOWNLOAD;var t=Nn();this.outputShape=e,this.userCode=`
      `.concat(sW,`

      void main() {
        float x = getAAtOutCoords();
        `).concat(t.output,` = encode_float(x);
      }
    `)}return r}();var Nqe=function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=xa.DOWNLOAD;var t=Nn();this.outputShape=e,this.userCode=`
      `.concat(sW,`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `).concat(t.output,` = encode_float(x);
      }
    `)}return r}();var Tqe={R:0,G:1,B:2,A:3},sq=function(){function r(e,t,n){t===void 0&&(t=!1),n===void 0&&(n="RGBA"),this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];var a=Nn();this.outputShape=e,this.enableShapeUniforms=pn(this.outputShape.length);var i="result";t&&(i="floor(result * 255. + 0.5)");for(var o="",s=0;s<n.length;s++){var u=n[s];o+=`
          if(offset == `.concat(s,`) {
            result = values[`).concat(Tqe[u],`];
          }`)}this.userCode=`
      `.concat(this.enableShapeUniforms?qx():$x(e),`

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, `).concat(n.length,`);

        flatIndex = idiv(flatIndex, `).concat(n.length,`, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = `).concat(a.texture2D,`(A, uv);
          `).concat(o,`
        }
        `).concat(a.output," = vec4(").concat(i,`, 0., 0., 0.);
      }
    `)}return r}();var Eqe=function(){function r(e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=Nn();this.outputShape=e,this.enableShapeUniforms=pn(this.outputShape.length);var a="",i="result";t&&(i="floor(result * 255. + 0.5)");for(var o=0;o<=1;o++)for(var s=0;s<=1;s++){var u=o*2+s;a+=`
          localCoords = coords;
          if(localCoords[2] + `.concat(s," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(e[2]),`) {
          localCoords[2] += `).concat(s,`;
          if (localCoords[1] + `).concat(o," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(e[1]),`) {
            localCoords[1] += `).concat(o,`;

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = `).concat(n.texture2D,`(A, uv);

            if (offset == 0) {
              result[`).concat(u,`] = values[0];
            } else if (offset == 1) {
              result[`).concat(u,`] = values[1];
            } else if (offset == 2) {
              result[`).concat(u,`] = values[2];
            } else {
              result[`).concat(u,`] = values[3];
            }
          }
        }
        `)}this.userCode=`
        `.concat(this.enableShapeUniforms?qx():$x(e),`

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          `).concat(a,`

          `).concat(n.output," = ").concat(i,`;
        }
    `)}return r}();function hW(r){var e=Nn(),t="".concat(e.version,`
    precision highp float;
    `).concat(e.attribute,` vec3 clipSpacePos;
    `).concat(e.attribute,` vec2 uv;
    `).concat(e.varyingVs,` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`);return zq(r,t)}function pW(r){var e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return Vq(r,e)}function dW(r){var e=new Uint16Array([0,1,2,2,1,3]);return Uq(r,e)}function bh(r,e,t,n,a,i){Hq(e,t);var o=Gq(r),s=r.TEXTURE_2D;return Pe(r,function(){return r.bindTexture(s,o)}),Pe(r,function(){return r.texParameteri(s,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE)}),Pe(r,function(){return r.texParameteri(s,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)}),Pe(r,function(){return r.texParameteri(s,r.TEXTURE_MIN_FILTER,r.NEAREST)}),Pe(r,function(){return r.texParameteri(s,r.TEXTURE_MAG_FILTER,r.NEAREST)}),k.env().getNumber("WEBGL_VERSION")===1?Pe(r,function(){return r.texImage2D(s,0,n,e,t,0,a,i,null)}):Pe(r,function(){return r.texStorage2D(s,1,n,e,t)}),Pe(r,function(){return r.bindTexture(r.TEXTURE_2D,null)}),{texture:o,texShape:[t,e]}}function Vx(r){return r.internalFormatFloat}function vW(r,e,t,n){var a=Te(yh(e,t),2),i=a[0],o=a[1];return bh(r,i,o,Vx(n),n.textureFormatFloat,r.FLOAT)}function Ux(r){return r.internalFormatHalfFloat}function mW(r,e,t,n){var a=Te(yh(e,t),2),i=a[0],o=a[1];return bh(r,i,o,Ux(n),n.textureFormatFloat,n.textureTypeHalfFloat)}function Gx(r){return r.downloadTextureFormat}function gW(r,e,t,n){var a=Te(yh(e,t),2),i=a[0],o=a[1];return bh(r,i,o,Gx(n),r.RGBA,r.UNSIGNED_BYTE)}function Hx(r){return r.internalFormatPackedFloat}function yW(r,e,t,n){var a=Te(Vc(e,t),2),i=a[0],o=a[1];return bh(r,i,o,Hx(n),r.RGBA,r.FLOAT)}function Kx(r){return r.internalFormatPackedHalfFloat}function bW(r,e,t,n){var a=Te(Vc(e,t),2),i=a[0],o=a[1];return bh(r,i,o,Kx(n),r.RGBA,n.textureTypeHalfFloat)}function wW(r,e,t){var n=0,a=3*4,i=3*4+2*4;Pe(r,function(){return r.bindBuffer(r.ARRAY_BUFFER,t)});var o=_x(r,e,"clipSpacePos",t,3,i,n);return o&&_x(r,e,"uv",t,2,i,a)}function xW(r,e,t,n,a,i){Pe(r,function(){return r.bindTexture(r.TEXTURE_2D,e)});var o,s,u;a instanceof Uint8Array?(o=new Uint8Array(t*n*4),s=r.UNSIGNED_BYTE,u=r.RGBA):(o=new Float32Array(t*n*4),s=r.FLOAT,u=i.internalFormatPackedFloat),o.set(a),k.env().getNumber("WEBGL_VERSION")===2?Pe(r,function(){return r.texSubImage2D(r.TEXTURE_2D,0,0,0,t,n,r.RGBA,s,o)}):Pe(r,function(){return r.texImage2D(r.TEXTURE_2D,0,u,t,n,0,r.RGBA,s,o)}),Pe(r,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function kW(r,e,t){Pe(r,function(){return r.bindTexture(r.TEXTURE_2D,e)}),t.data instanceof Uint8Array?k.env().getNumber("WEBGL_VERSION")===2?Pe(r,function(){return r.texSubImage2D(r.TEXTURE_2D,0,0,0,t.width,t.height,r.RGBA,r.UNSIGNED_BYTE,t.data)}):Pe(r,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,t.width,t.height,0,r.RGBA,r.UNSIGNED_BYTE,t.data)}):k.env().getNumber("WEBGL_VERSION")===2?Pe(r,function(){return r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,t)}):Pe(r,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t)}),Pe(r,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function SW(r,e,t,n){var a=r.createBuffer();Pe(r,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,a)});var i=4,o=4,s=i*o*e*t;return Pe(r,function(){return r.bufferData(r.PIXEL_PACK_BUFFER,s,r.STREAM_READ)}),Pe(r,function(){return r.readPixels(0,0,t,e,r.RGBA,r.FLOAT,0)}),Pe(r,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,null)}),a}function NW(r,e,t){var n=r,a=new Float32Array(t);return n.bindBuffer(n.PIXEL_PACK_BUFFER,e),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,a),n.bindBuffer(n.PIXEL_PACK_BUFFER,null),a}function TW(r,e,t,n){var a=Te(yh(e,t),2),i=a[0],o=a[1],s=4,u=new Uint8Array(x$e(e*t,s));return Pe(r,function(){return r.readPixels(0,0,i,o,n.downloadTextureFormat,r.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function EW(r,e,t,n,a,i,o,s){var u=r,c=new Float32Array(k$e(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function IW(r,e,t){var n=new Float32Array(e*t*4);return Pe(r,function(){return r.readPixels(0,0,t,e,r.RGBA,r.FLOAT,n)}),n}var Iqe={__proto__:null,bindVertexProgramAttributeStreams:wW,createBufferFromOutputTexture:SW,createFloat16MatrixTexture:mW,createFloat16PackedMatrixTexture:bW,createFloat32MatrixTexture:vW,createIndexBuffer:dW,createPackedMatrixTexture:yW,createUnsignedBytesMatrixTexture:gW,createVertexBuffer:pW,createVertexShader:hW,downloadByteEncodedFloatMatrixFromOutputTexture:TW,downloadFloat32MatrixFromBuffer:NW,downloadMatrixFromPackedOutputTexture:IW,downloadPackedMatrixFromBuffer:EW,getInternalFormatForFloat16MatrixTexture:Ux,getInternalFormatForFloat16PackedMatrixTexture:Kx,getInternalFormatForFloat32MatrixTexture:Vx,getInternalFormatForPackedMatrixTexture:Hx,getInternalFormatForUnsignedBytesMatrixTexture:Gx,uploadDenseMatrixToTexture:xW,uploadPixelDataToTexture:kW},fm=function(){function r(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];var t=k.env().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,Mq(t,e)):this.gl=Ni(t),e=this.gl,k.env().getNumber("WEBGL_VERSION")===2){var n=e;this.createVertexArray=function(){return Pe(n,function(){return n.createVertexArray()})},this.bindVertexArray=function(c){return Pe(n,function(){return n.bindVertexArray(c)})},this.deleteVertexArray=function(c){return Pe(n,function(){return n.deleteVertexArray(c)})},this.getVertexArray=function(){return Pe(n,function(){return n.getParameter(n.VERTEX_ARRAY_BINDING)})}}else if(e!=null){var a=e.getExtension("OES_vertex_array_object");if(a==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=function(){return Pe(e,function(){return a.createVertexArrayOES()})},this.bindVertexArray=function(c){return Pe(e,function(){return a.bindVertexArrayOES(c)})},this.deleteVertexArray=function(c){return Pe(e,function(){return a.deleteVertexArrayOES(c)})},this.getVertexArray=function(){return Pe(e,function(){return e.getParameter(a.VERTEX_ARRAY_BINDING_OES)})}}var i="WEBGL_color_buffer_float",o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),k.env().getNumber("WEBGL_VERSION")===1){var s="OES_texture_float",u="OES_texture_half_float";if(this.textureFloatExtension=uh(this.gl,s),ka(this.gl,u))this.textureHalfFloatExtension=uh(this.gl,u);else if(k.env().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(i),ka(this.gl,o))this.colorBufferHalfFloatExtension=uh(this.gl,o);else if(k.env().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(i="EXT_color_buffer_float",ka(this.gl,i))this.colorBufferFloatExtension=this.gl.getExtension(i);else if(ka(this.gl,o))this.colorBufferHalfFloatExtension=this.gl.getExtension(o);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=pW(this.gl),this.indexBuffer=dW(this.gl),this.framebuffer=Kq(this.gl),this.textureConfig=Lx(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(r.prototype,"debug",{get:function(){return k.env().getBool("DEBUG")},enumerable:!1,configurable:!0}),r.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Pe(t,function(){return t.finish()}),Pe(t,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Pe(t,function(){return t.deleteFramebuffer(e.framebuffer)}),Pe(t,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),Pe(t,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),Pe(t,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},r.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),vW(this.gl,e,t,this.textureConfig)},r.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),mW(this.gl,e,t,this.textureConfig)},r.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),gW(this.gl,e,t,this.textureConfig)},r.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),kW(this.gl,e,t)},r.prototype.uploadDenseMatrixToTexture=function(e,t,n,a){this.throwIfDisposed(),xW(this.gl,e,t,n,a,this.textureConfig)},r.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),bW(this.gl,e,t,this.textureConfig)},r.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),yW(this.gl,e,t,this.textureConfig)},r.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(Fx(this.gl,this.framebuffer),this.outputTexture=null),Pe(this.gl,function(){return t.gl.deleteTexture(e)})},r.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var a=this;return this.downloadMatrixDriver(e,function(){return TW(a.gl,t,n,a.textureConfig)})},r.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,a,i,o){return EW(this.gl,e,t,n,a,i,o,this.textureConfig)},r.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return NW(this.gl,e,t)},r.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var a=SW(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),a},r.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},r.prototype.createFence=function(e){var t=this,n,a;if(k.env().getBool("WEBGL_FENCE_API_ENABLED")){var i=e,o=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),a=function(){var s=i.clientWaitSync(o,0,0);return s===i.ALREADY_SIGNALED||s===i.CONDITION_SATISFIED},n=o}else k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),a=function(){return t.isQueryAvailable(n,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):a=function(){return!0};return{query:n,isFencePassed:a}},r.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var a=this;return this.downloadMatrixDriver(e,function(){return IW(a.gl,t,n)})},r.prototype.createProgram=function(e){var t=this;this.throwIfDisposed();var n=this.gl;this.vertexShader==null&&(this.vertexShader=hW(n));var a=qq(n);Pe(n,function(){return n.attachShader(a,t.vertexShader)}),Pe(n,function(){return n.attachShader(a,e)}),Wq(n,a);var i=Object.assign(a,{vao:this.createVertexArray()});return this.debug&&sm(n,i),i},r.prototype.buildVao=function(e){var t=this;this.setProgram(e),this.bindVertexArray(e.vao);var n=this.gl;Pe(n,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.indexBuffer)}),wW(n,e,this.vertexBuffer)},r.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Pe(this.gl,function(){return t.gl.deleteProgram(e)}),this.deleteVertexArray(e.vao))},r.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&sm(this.gl,this.program),Pe(this.gl,function(){return t.gl.useProgram(e)})},r.prototype.getUniformLocation=function(e,t,n){return n===void 0&&(n=!0),this.throwIfDisposed(),n?Xq(this.gl,e,t):Yq(this.gl,e,t)},r.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),Pe(this.gl,function(){return n.gl.getAttribLocation(e,t)})},r.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},r.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),Zq(this.gl,e,t,n)},r.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},r.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var a=Te(Vc(t,n),2),i=a[0],o=a[1];this.setOutputMatrixTextureDriver(e,i,o)},r.prototype.setOutputMatrixWriteRegion=function(e,t,n,a){this.setOutputMatrixWriteRegionDriver(n,e,a,t)},r.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,a){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},r.prototype.debugValidate=function(){this.program!=null&&sm(this.gl,this.program),ch(this.gl)},r.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;if(this.debug){var t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Pe(e,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},r.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Pe(this.gl,function(){return e.gl.finish()})},r.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=uh(this.gl,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},r.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},r.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},r.prototype.beginQuery=function(){if(k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var a=this.getQueryTimerExtensionWebGL1(),i=a.createQueryEXT();return a.beginQueryEXT(a.TIME_ELAPSED_EXT,i),i},r.prototype.endQuery=function(){if(k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2();e.endQuery(t.TIME_ELAPSED_EXT);return}var n=this.getQueryTimerExtensionWebGL1();n.endQueryEXT(n.TIME_ELAPSED_EXT)},r.prototype.waitForQueryAndGetTime=function(e){return qc(this,void 0,void 0,function(){var t=this;return Wc(this,function(n){switch(n.label){case 0:return[4,k.util.repeatedTry(function(){return t.disposed||t.isQueryAvailable(e,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(e,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},r.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var n=this.gl,a=n.getQueryParameter(e,n.QUERY_RESULT);return a/1e6}else{var i=this.getQueryTimerExtensionWebGL1(),a=i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT);return a/1e6}},r.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var n=this.gl,a=this.getQueryTimerExtensionWebGL2(),i=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{var a=this.getQueryTimerExtensionWebGL1(),i=a.getQueryObjectEXT(e,a.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),i&&!this.disjoint}},r.prototype.pollFence=function(e){var t=this;return new Promise(function(n){t.addItemToPoll(function(){return e.isFencePassed()},function(){return n()})})},r.prototype.pollItems=function(){for(var e=Cqe(this.itemsToPoll.map(function(a){return a.isDoneFn})),t=0;t<=e;++t){var n=this.itemsToPoll[t].resolveFn;n()}this.itemsToPoll=this.itemsToPoll.slice(e+1)},r.prototype.addItemToPoll=function(e,t){var n=this;if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),!(this.itemsToPoll.length>1)){var a=void 0;"setTimeoutCustom"in k.env().platform&&(a=k.env().platform.setTimeoutCustom.bind(k.env().platform)),k.util.repeatedTry(function(){return n.pollItems(),n.itemsToPoll.length===0},function(){return 0},null,a)}},r.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),um(this.gl,e,this.framebuffer),this.debug&&ch(this.gl)},r.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(um(this.gl,this.outputTexture,this.framebuffer),this.debug&&ch(this.gl)):Fx(this.gl,this.framebuffer)},r.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},r.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var a=this.gl;um(a,e,this.framebuffer),this.debug&&ch(a),this.outputTexture=e,Pe(a,function(){return a.viewport(0,0,t,n)}),Pe(a,function(){return a.scissor(0,0,t,n)})},r.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,a){var i=this;this.throwIfDisposed(),Pe(this.gl,function(){return i.gl.scissor(e,t,n,a)})},r.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},r.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},r}();function Cqe(r){for(var e=0;e<r.length;++e){var t=r[e]();if(!t)break}return e-1}function Aqe(r){for(var e=new Float32Array(r.length),t=0;t<r.length;++t)e[t]=Math.abs(r[t]);return e}function Sa(r){return function(e,t,n,a,i){var o=k.backend_util.assertAndGetBroadcastShape(e,t),s=o.length,u=k.util.computeStrides(o),c=k.util.sizeFromShape(o),l=k.util.getTypedArrayFromDType(i,c),f=e.length,h=t.length,p=k.util.computeStrides(e),d=k.util.computeStrides(t),m=k.backend_util.getBroadcastDims(e,o),v=k.backend_util.getBroadcastDims(t,o);if(m.length+v.length===0)for(var g=0;g<l.length;++g)l[g]=r(n[g%n.length],a[g%a.length]);else for(var y=function(w){var b=k.util.indexToLoc(w,s,u),x=b.slice(-f);m.forEach(function(C){return x[C]=0});var S=k.util.locToIndex(x,f,p),T=b.slice(-h);v.forEach(function(C){return T[C]=0});var E=k.util.locToIndex(T,h,d);l[w]=r(n[S],a[E])},g=0;g<l.length;++g)y(g);return[l,o]}}function Dqe(r,e,t,n){if(n==="int32"){var a=Int32Array.from(r);return[e,"int32",a]}if(n==="bool"){var i=k.util.toTypedArray([0],t),o=Te(Sa(function(c,l){return c!==l?1:0})(e,[],r,i,"bool"),2),s=o[0],u=o[1];return[u,"bool",s]}throw new Error("Error in Cast: failed to cast ".concat(t," to ").concat(n))}var _qe=Sa(function(r,e){return r+e});function Fqe(r,e,t,n,a){for(var i=k.util.sizeFromShape(n),o=k.util.makeZerosTypedArray(a,t),s=0;s<r.length;s++){var u=r[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(i>0?o[u]+=e[s]:o[u]+=1)}return o}function Rqe(r,e,t,n){n===void 0&&(n=!1);for(var a=r.shape[0],i=r.shape[1],o=k.buffer([a,t],e.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=r.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=t||(n?o.set(1,s,c):e.size>0?o.set(o.get(s,c)+e.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o}var Oqe=Sa(function(r,e){return r&e});function ho(r){return function(e,t,n){for(var a=k.util.getArrayFromDType(t,e.length),i=0;i<e.length;++i)a[i]=r(e[i],n);return a}}var Pqe=ho(function(r){return Math.ceil(r)});function Mqe(r,e,t,n){var a=k.util.getArrayFromDType(t,k.util.sizeFromShape(e));if(n&&t!=="string"){var i=0;r.forEach(function(s){var u=k.util.sizeFromShape(s.shape);a.set(s.vals,i),i+=u})}else{var o=0;r.forEach(function(s){for(var u=t==="string"?k.backend_util.fromUint8ToStringArray(s.vals):s.vals,c=0,l=0;l<s.shape[0];++l)for(var f=l*e[1]+o,h=0;h<s.shape[1];++h)a[f+h]=u[c++];o+=s.shape[1]})}return a}var Bqe=Sa(function(r,e){return r===e?1:0});var Lqe=ho(function(r){return Math.exp(r)});var zqe=ho(function(r){return Math.expm1(r)});var $qe=ho(function(r){return Math.floor(r)});function qqe(r,e,t,n,a,i,o,s,u){for(var c=k.buffer([n,i],t),l=0;l<n;l++){for(var f=[],h=0,p=0;p<a;p++){var d=r[l*a+p];h+=d*o[p],f.push(d)}if(h<0||h>=u/i)throw new Error("Invalid indices: ".concat(f," does not index into ").concat(s));for(var m=0;m<i;m++)c.values[l*i+m]=e.get.apply(e,pr([],Te(e.indexToLoc(h*i+m)),!1))}return c}function Wqe(r,e,t){for(var n=k.buffer(t,r.dtype),a=0;a<n.size;++a){var i=n.indexToLoc(a),o=i.slice(),s=o[0],u=o[2],c=e.locToIndex([s,u]);o[2]=e.values[c];var l=r.locToIndex(o);0<=l&&l<r.values.length&&(n.values[a]=r.values[l])}return n}var Vqe=Sa(function(r,e){return r>e?1:0});var Uqe=Sa(function(r,e){return r>=e?1:0});var Gqe=Sa(function(r,e){return r<e?1:0});var Hqe=Sa(function(r,e){return r<=e?1:0});function Kqe(r,e,t){var n=(e-r)/(t-1),a=k.util.makeZerosTypedArray(t,"float32");a[0]=r;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return a}var jqe=ho(function(r){return Math.log(r)});function Xqe(r,e,t,n){for(var a=k.util.getTypedArrayFromDType(n,k.util.sizeFromShape(t)),i=0;i<a.length;++i){for(var o=i*e,s=r[o],u=0;u<e;++u){var c=r[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a}var Yqe=Sa(function(r,e){return Math.max(r,e)});var Zqe=Sa(function(r,e){return Math.min(r,e)});var CW=Sa(function(r,e){return r*e});function Jqe(r,e,t){var n=k.util.createScalarValue(-1,t);return CW([],e,n,r,t)}var Qqe=Sa(function(r,e){return r!==e?1:0});function eWe(r,e,t,n,a){for(var i=e.length,o=k.util.sizeFromShape(e),s=k.util.computeStrides(e),u=k.util.computeStrides(a),c=k.util.getTypedArrayFromDType(t,k.util.sizeFromShape(a)),l=0;l<o;++l){for(var f=k.util.indexToLoc(l,i,s),h=new Array(f.length),p=0;p<h.length;p++)h[p]=f[n[p]];var d=k.util.locToIndex(h,i,u);c[d]=r[l]}return c}function tWe(r,e,t,n){for(var a=Te(k.backend_util.computeOutAndReduceShapes(r,n),2),i=a[0],o=a[1],s=k.upcastType(e,"int32"),u=k.util.makeZerosTypedArray(k.util.sizeFromShape(i),s),c=k.util.sizeFromShape(o),l=0;l<u.length;++l){for(var f=l*c,h=1,p=0;p<c;++p)h*=t[f+p];u[l]=h}return{outVals:u,outShape:i,outDtype:s}}function rWe(r,e,t){r.forEach(function(n,a){if(n<0||n>=t){var i=k.util.indexToLoc(a,e.length,k.util.computeStrides(e)).join(",");throw new Error("indices[".concat(i,"] = ").concat(n," is not in [0, ").concat(t,")"))}})}function nWe(r,e){for(var t=0;t<r.length;++t){var n=r[t],a=t===r.length-1?e:r[t+1].length;if(n.length===0)throw new Error("Ragged splits may not be empty");if(n[0]<0)throw new Error("Ragged splits must be non-negative");if(n[n.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<n.length;++i)if(n[i-1]>n[i])throw new Error("Ragged splits must be sorted in ascending order")}}function aWe(r,e,t,n){var a=[],i=0,o=e.length-1+t.length,s=new Array(o).fill(null).map(function(){return[0]});nWe(t,n);for(var u=1,c=0;c<e.length-1;++c){u*=e[c];for(var l=e[c+1],f=1;f<u+1;++f)s[c].push(f*l)}for(var f=0;f<r.length;++f){for(var h=r[f],p=r[f]+1,c=0;c<t.length;++c){var d=t[c],m=c+e.length-1;if(m>=0)for(var v=s[m],g=v[v.length-1]-d[h],y=h;y<p;++y)s[m].push(d[y+1]+g);h=d[h],p=d[p]}p!==h&&(a.push([h,p]),i+=p-h)}return{outSplits:s,valueSlices:a,numValues:i}}function iWe(r){for(var e=[],t=function(a){var i=r[a].length,o=k.util.getArrayFromDType("int32",i);e.push(o),r[a].forEach(function(s,u){return o[u]=s})},n=0;n<r.length;++n)t(n);return e}function uq(r,e){for(var t=r.slice(0,e);t.length<e;)t.push(1);for(var n=e;n<r.length;n++)t[e-1]*=r[n];return t}function oWe(r,e,t,n,a,i){var o,s,u=uq(e,2)[1],c=uq(i,2)[1],l=0;try{for(var f=kn(t),h=f.next();!h.done;h=f.next())for(var p=h.value,d=p[0];d<p[1];++d){for(var m=0;m<n;++m)a[l*c+m]=r[d*u+m];++l}}catch(v){o={error:v}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}}function sWe(r,e,t,n,a){var i=e.slice();i[0]=a;var o=k.util.getArrayFromDType(t,k.util.sizeFromShape(i)),s=r.length,u=s===0?0:s/e[0];return oWe(r,e,n,u,o,i),[o,i]}function uWe(r,e,t,n,a,i,o,s){if(r.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");var u=e[0][0]-1;if(rWe(i,o,u),n.length===0)throw new Error("params.rank must be nonzero");var c=n[0],l=aWe(i,o,r,c),f=l.outSplits,h=l.valueSlices,p=l.numValues,d=iWe(f),m=sWe(t,n,a,h,p);return[d,m[0],m[1]]}var cq=2147483647;function cWe(r,e,t,n,a,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");var s=e.length===0,u=a.length===0,c=o.length===0,l=[];s||l.push(e[0]),u||l.push(a[0]),c||l.push(o[0]);for(var f=1;f<l.length;++f)if(l[f]!==l[f-1])throw new Error("starts, limits, and deltas must have the same shape");var h=l.length===0?1:l[0],p=k.util.getArrayFromDType("int32",h+1);p[0]=0;for(var d=0;d<h;++d){var m=s?r[0]:r[d],v=u?n[0]:n[d],g=c?i[0]:i[d];if(g===0)throw new Error("Requires delta != 0");var y=void 0;if(g>0&&v<m||g<0&&v>m)y=0;else if(y=Math.ceil(Math.abs((v-m)/g)),y>cq)throw new Error("Requires ((limit - start) / delta) <= ".concat(cq));p[d+1]=p[d]+y}for(var w=p[h],b=k.util.getArrayFromDType(t,w),x=0,d=0;d<h;++d)for(var S=p[d+1]-p[d],T=s?r[0]:r[d],g=c?i[0]:i[d],f=0;f<S;++f)b[x++]=T,T+=g;return[p,b]}var Za=k.backend_util.RowPartitionType,lWe=function(){function r(e,t,n,a,i,o,s,u,c,l){this.shape=e,this.shapeShape=t,this.values=n,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=k.backend_util.getRowPartitionTypesHelper(l),this.raggedRank=k.backend_util.getRaggedRank(this.rowPartitionTypes)}return r.prototype.getRowPartitionTypeByDimension=function(e){return this.rowPartitionTypes[0]===Za.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]},r.prototype.getRowPartitionTensor=function(e){return this.rowPartitionTypes[0]===Za.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]},r.prototype.getMaxWidth=function(e){var t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Za.VALUE_ROWIDS:return r.getMaxWidthValueRowID(t);case Za.ROW_SPLITS:return r.getMaxWidthRowSplit(t);default:throw new Error("Cannot handle partition type ".concat(Za[this.getRowPartitionTypeByDimension(e-1)]))}},r.getMaxWidthRowSplit=function(e){var t=e.length;if(t===0||t===1)return 0;for(var n=0,a=0;a<t-1;++a){var i=e[a+1]-e[a];i>n&&(n=i)}return n},r.getMaxWidthValueRowID=function(e){var t=e.length;if(t===0)return 0;for(var n=0,a=e[0],i=0,o=1;o<t;++o){var s=e[o];s!==a&&(a=s,i=Math.max(o-n,i),n=o)}return Math.max(t-n,i)},r.prototype.tensorShapeFromTensor=function(e,t,n){if(n===void 0&&(n=!0),t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return fq(e,n)},r.prototype.calculateOutputSize=function(e){var t=this.valuesShape,n=this.defaultValueShape;k.backend_util.validateDefaultValueShape(n,t);var a=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=k.backend_util.combineRaggedTensorToTensorShapes(this.raggedRank,a,t),o=i;o[0]<0&&(o[0]=e);for(var s=1;s<=this.raggedRank;++s)o[s]<0&&(o[s]=this.getMaxWidth(s));return o},r.prototype.calculateFirstParentOutputIndex=function(e,t,n){for(var a=Math.min(e,n),i=[],o=0,s=0;s<a;++s,o+=t)i.push(o);for(var s=a;s<e;++s)i.push(-1);return k.util.assert(i.length===e,function(){return"Final length of result must be equal to firstDimension."}),i},r.prototype.calculateOutputIndexRowSplit=function(e,t,n,a){for(var i=e.length,o=[],s=0;s<i-1;++s){var u=e[s+1]-e[s],c=Math.min(a,u),l=t[s];l===-1&&(c=0);for(var f=0;f<c;++f)o.push(l),l+=n;for(var f=0;f<u-c;++f)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o},r.prototype.calculateOutputIndexValueRowID=function(e,t,n,a){var i=e.length,o=[];if(i===0)return[];var s=0,u=e[0];if(u>=t.length)throw new Error("Got currentValueRowId=".concat(u,", which is not less than ").concat(t.length));var c=t[u];o.push(c);for(var l=1;l<i;++l){var f=e[l];if(f===u)c>=0&&(++s,s<a?c+=n:c=-1);else{if(s=0,u=f,f>=t.length)throw new Error("Got nextValueRowId=".concat(f," which is not less than ").concat(t.length));c=t[f]}o.push(c)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o},r.prototype.calculateOutputIndex=function(e,t,n,a){var i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case Za.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,n,a);case Za.ROW_SPLITS:if(i.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(i.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(i,t,n,a);default:throw new Error("Unsupported partition type: ".concat(Za[o]))}},r.prototype.getFirstDimensionSize=function(){var e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case Za.FIRST_DIM_SIZE:return e[0];case Za.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Za.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(Za[t]))}},r.prototype.compute=function(){var e=this.rowPartitionValues[0];if(e.length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var t=this.getFirstDimensionSize(),n=this.calculateOutputSize(t),a=new Array(this.raggedRank+1);a[a.length-1]=1;for(var i=a.length-2;i>=0;--i)a[i]=a[i+1]*n[i+1];var o=fq(n,!1),s=k.util.getArrayFromDType(this.valuesDType,k.util.sizeFromShape(o)),u=a[0]*n[0];if(u>0){for(var c=this.calculateFirstParentOutputIndex(t,a[0],n[0]),i=1;i<=this.raggedRank;++i){var l=this.calculateOutputIndex(i-1,c,a[i],n[i]);c=l}this.setOutput(this.raggedRank,c,s,o)}return[o,s]},r.prototype.setOutput=function(e,t,n,a){if(n.length!==0){var i=this.values,o=n,s=a.slice();s=s.slice(e+1);var u=k.util.sizeFromShape(s),c=t.length,l=this.defaultValue;if(l.length!==u&&l.length!==1){var f=this.defaultValueShape;k.tidy(function(){var x=k.reshape(l,f),S=k.broadcastTo(x,s);l=S.dataSync()})}for(var h=0,p=0,d=0,m=0;m<=c;++m){var v=m<c?t[m]:-1;if(v===d){++d;continue}if(p<d){var g=i.subarray(h*u),y=o.subarray(p*u),w=(d-p)*u;lq(y,g,w)}if(m>=c){var b=n.length;v=Math.floor(b/u)}if(v>d)if(this.defaultValue.length===1)o.subarray(d*u,v*u).fill(this.defaultValue[0]),d=v;else for(;v>d;){var y=o.slice(d*u);lq(y,l,u),++d}v<0?(h=m+1,p=d):(h=m,p=d,d=p+1)}}},r}();function lq(r,e,t){for(var n=0;n<t;n++)r[n]=e[n]}function fq(r,e){var t,n,a=[];try{for(var i=kn(r),o=i.next();!o.done;o=i.next()){var s=o.value;if(s<0){if(!e)throw new Error("Dimension ".concat(s," must be >= 0"));if(s<-1)throw new Error("Dimension ".concat(s," must be >= -1"));s=-1}a.push(s)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return a}function fWe(r,e,t,n,a,i,o,s,u,c){return new lWe(r,e,t,n,a,i,o,s,u,c).compute()}function hWe(r,e,t,n){var a=r===e,i=r<e&&t<0,o=e<r&&t>1;if(a||i||o)return k.util.makeZerosTypedArray(0,n);var s=Math.abs(Math.ceil((e-r)/t)),u=k.util.makeZerosTypedArray(s,n);e<r&&t===1&&(t=-1),u[0]=r;for(var c=1;c<u.length;c++)u[c]=u[c-1]+t;return u}var pWe=ho(function(r){return 1/Math.sqrt(r)});function dWe(r,e,t,n,a,i,o,s,u,c){var l=[n/a,a],f=r.values,h=e.values;if(n===0)return k.buffer(t,e.dtype);var p=u instanceof k.TensorBuffer?u:k.buffer(l,e.dtype);typeof u=="string"||typeof u=="number"?p.values.fill(u):typeof u=="boolean"&&p.values.fill(+u);for(var d=0;d<i;d++){for(var m=[],v=0,g=0;g<o;g++){var y=f[d*o+g];m.push(y),v+=y*s[g]}if(v<0||v>=n/a)throw new Error("Invalid indices: ".concat(m," does not index into ").concat(t));for(var w=0;w<a;w++)c?p.values[v*a+w]+=h[d*a+w]:p.values[v*a+w]=e.rank===0?h[0]:h[d*a+w]}return p}var vWe=ho(function(r){return 1/(1+Math.exp(-r))});function mWe(r,e,t,n,a){var i=k.slice_util.isSliceContinous(n,e,t),o=k.util.sizeFromShape(t),s=k.util.computeStrides(n);if(i){var u=k.slice_util.computeFlatOffset(e,s);return a==="string"?r.slice(u,u+o):r.subarray(u,u+o)}for(var c=a==="string"?k.backend_util.fromUint8ToStringArray(r):r,l=k.buffer(n,a,c),f=k.buffer(t,a),h=0;h<f.size;++h){var p=f.indexToLoc(h),d=p.map(function(m,v){return m+e[v]});f.set.apply(f,pr([l.get.apply(l,pr([],Te(d),!1))],Te(p),!1))}return a==="string"?k.backend_util.fromStringArrayToUint8(f.values):f.values}function gWe(r,e,t,n,a,i,o){var s=e[0],u=i[0],c=new Array(u),l=new Array(s),f=e[1];if(u===0){if(s!==0)throw new Error(k.backend_util.getSparseFillEmptyRowsIndicesDenseShapeMismatch(s));var h=k.util.getArrayFromDType(t,0),p=k.util.getArrayFromDType(a,0);return[h,[0,f],p,c,l]}for(var d=!0,m=0,v=new Array(u).fill(0),g=0;g<s;++g){var y=r[g*f];if(y<0)throw new Error(k.backend_util.getSparseFillEmptyRowsNegativeIndexErrorMessage(g,y));if(y>=u)throw new Error(k.backend_util.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(g,y,u));++v[y],d=d&&y>=m,m=y}for(var w=!0,y=0;y<u;++y){var b=v[y]===0;c[y]=b,w=w&&!b,v[y]=Math.max(v[y],1),y>0&&(v[y]+=v[y-1])}if(w&&d){for(var h=r,p=n,g=0;g<s;++g)l[g]=g;return[h,[s,f],p,c,l]}else{for(var x=v[u-1],h=k.util.getArrayFromDType(t,x*f),p=k.util.getArrayFromDType(a,x),S=new Array(u).fill(0),g=0;g<s;++g){var y=r[g*f],T=S[y],E=(y===0?0:v[y-1])+T;S[y]++;for(var C=0;C<f;++C)h[E*f+C]=r[g*f+C];p[E]=n[g],l[g]=E}for(var y=0;y<u;++y){var R=S[y];if(R===0){var _=y===0?0:v[y-1];h[_*f+0]=y;for(var O=1;O<f;++O)h[_*f+O]=0;p[_]=o}}return[h,[x,f],p,c,l]}}function yWe(r,e,t,n,a){for(var i=k.util.sizeFromShape(n),o=e[0],s=a.length,u=[],c=1,l=-1,f=0;f<s;++f){var h=a[f];if(h===-1){if(l!==-1)throw new Error(k.backend_util.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(l,f));l=f,u.push(1)}else{if(h<0)throw new Error(k.backend_util.getSparseReshapeNegativeOutputDimErrorMessage(f,h));c*=h,u.push(h)}}if(l!==-1){if(c<=0)throw new Error(k.backend_util.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());var p=Math.trunc(i/c);if(c*p!==i)throw new Error(k.backend_util.getSparseReshapeInputOutputMultipleErrorMessage(n,u));u[l]=p}var d=k.util.sizeFromShape(u);if(d!==i)throw new Error(k.backend_util.getSparseReshapeInputOutputMismatchErrorMessage(n,u));var m=n.length,v=[];if(m>0){v[m-1]=1;for(var f=m-2;f>=0;--f)v[f]=v[f+1]*n[f+1]}var g=[];if(s>0){g[s-1]=1;for(var f=s-2;f>=0;--f)g[f]=g[f+1]*u[f+1]}for(var y=k.util.getArrayFromDType(t,o*s),w=0;w<o;++w){for(var b=0,x=0;x<m;++x)b+=r[w*m+x]*v[x];for(var x=0;x<s;++x)y[w*s+x]=Math.trunc(b/g[x]),b%=g[x]}return[y,[o,s],u]}function bWe(r,e,t,n,a,i,o){i===void 0&&(i=!1),o===void 0&&(o=0);var s=n.length,u=[e[0],r.length/e[0]],c=u[1],l=s>0?a[s-1]+1:0,f=l;if(f<0)throw new Error(k.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var h=e.slice();h[0]=f;var p=h.reduce(function(T,E){return T*E},1),d=k.util.getArrayFromDType(t,p);if(s===0)return f>0&&d.fill(o),[d,h];if(f<=0)throw new Error(k.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());for(var m=0,v=1,g=0,y=a[m];;){var w=0;if(v<s){if(w=a[v],y===w){++v;continue}if(y>=w)throw new Error(k.backend_util.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=f)throw new Error(k.backend_util.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,f));y>g&&d.fill(o,g*c,y*c);for(var b=m;b<v;++b){var x=n[b];if(x<0||x>=u[0])throw new Error(k.backend_util.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(b,n[b],u[0]));for(var S=0;S<c;S++)d[y*c+S]+=r[x*c+S]}if(i)for(var S=0;S<c;S++)d[y*c+S]/=v-m;if(m=v,++v,g=y+1,y=w,v>s)break}return g<f&&d.fill(o,g*c,f*c),[d,h]}var wWe=ho(function(r){return Math.sqrt(r)});var xWe=ho(function(r,e){var t=e.pattern,n=e.replaceGlobal,a=e.rewrite;return r.replace(new RegExp(t,n?"g":""),a)});function kWe(r,e,t,n){for(var a=k.buffer(r,e.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*t[u]+n[u];a.set.apply(a,pr([e.get.apply(e,pr([],Te(s),!1))],Te(o),!1))}return a}var SWe=function(){function r(e,t,n,a,i,o){this.separator=k.util.encodeString(e),this.nGramWidths=t,this.leftPad=k.util.encodeString(n),this.rightPad=k.util.encodeString(a),this.padWidth=i,this.preserveShort=o}return r.prototype.getPadWidth=function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)},r.prototype.getNumNGrams=function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)},r.prototype.createNGrams=function(e,t,n,a,i,o){for(var s=function(l){var f=u.getPadWidth(o),h=Math.max(0,f-l),p=Math.max(0,f-(i-(l+1))),d=o-(h+p),m=t+(h>0?0:l-f),v=0;v+=h*u.leftPad.length;for(var g=0;g<d;++g)v+=e[m+g].length;v+=p*u.rightPad.length;var y=h+p+d-1;v+=y*u.separator.length,n[a+l]=new Uint8Array(v);for(var w=n[a+l],b=0,x=function(S){return S.forEach(function(T){return w[b++]=T})},g=0;g<h;++g)x(u.leftPad),x(u.separator);for(var g=0;g<d-1;++g)x(e[m+g]),x(u.separator);if(d>0){x(e[m+d-1]);for(var g=0;g<p;++g)x(u.separator),x(u.rightPad)}else{for(var g=0;g<p-1;++g)x(u.rightPad),x(u.separator);x(u.rightPad)}},u=this,c=0;c<i;++c)s(c)},r.prototype.compute=function(e,t){var n=this,a=e.length,i=t.length;if(i>0){var o=t[0];if(o!==0)throw new Error("First split value must be 0, got ".concat(o));for(var s=1;s<i;++s){var u=t[s]>=o;if(u=u&&t[s]<=a,!u)throw new Error("Invalid split value ".concat(t[s],", must be in [").concat(o,", ").concat(a,"]"));o=t[s]}if(o!==a)throw new Error("Last split value must be data size. Expected ".concat(a,", got ").concat(o))}var c=i-1,l=k.util.getArrayFromDType("int32",i);if(a===0||i===0){for(var f=new Array(a),s=0;s<=c;++s)l[s]=0;return[f,l]}l[0]=0;for(var h=function(g){var y=t[g]-t[g-1],w=0;p.nGramWidths.forEach(function(b){w+=n.getNumNGrams(y,b)}),p.preserveShort&&y>0&&w===0&&(w=1),l[g]=l[g-1]+w},p=this,s=1;s<=c;++s)h(s);for(var d=new Array(l[c]),m=function(g){var y=t[g],w=l[g];if(v.nGramWidths.forEach(function(T){var E=t[g+1]-t[g],C=n.getNumNGrams(E,T);n.createNGrams(e,y,d,w,C,T),w+=C}),v.preserveShort&&w===l[g]){var b=t[g+1]-t[g];if(b===0)return"continue";var x=b+2*v.padWidth,S=1;v.createNGrams(e,y,d,w,S,x)}},v=this,s=0;s<c;++s)m(s);return[d,l]},r}();function NWe(r,e,t,n,a,i,o,s){return new SWe(t,n,a,i,o,s).compute(r,e)}function TWe(r,e,t,n){if(!!r.length){if(e.length===0){for(var a=0;a<r.length;++a)n.push(r.subarray(a,a+1));return}if(e.length===1){for(var i=e[0],o=r.indexOf(i);o!==-1;){var s=r.subarray(0,o);(!t||s.length!==0)&&n.push(s),r=r.subarray(o+1),o=r.indexOf(i)}(!t||r.length!==0)&&n.push(r);return}for(var u=0,a=0;a<r.length+1;a++)if(a===r.length||e.indexOf(r[a])!==-1){var s=r.subarray(u,a);(!t||s.length!==0)&&n.push(s),u=a+1}}}function EWe(r,e,t){for(var n=r.length,a=[],i=0,o=0,s=new Array(n),u=0;u<n;++u){var c=a.length;TWe(r[u],e,t,a);var l=a.length-c;s[u]=l,i+=l,o=Math.max(o,l)}for(var f=k.util.getArrayFromDType("int32",i*2),h=new Array(i),p=[n,o],d=0,u=0;u<n;++u)for(var m=0;m<s[u];++m)f[d*2]=u,f[d*2+1]=m,h[d]=a[d],++d;return[f,h,p]}function IWe(r,e){for(var t=k.util.getArrayFromDType("int32",r.length),n=0;n<r.length;++n)t[n]=k.util.fingerPrint64(r[n]).modulo(e).getLowBitsUnsigned();return t}var CWe=Sa(function(r,e){return r-e});function AWe(r,e){for(var t=new Array(r.rank),n=0;n<t.length;n++)t[n]=r.shape[n]*e[n];for(var a=k.buffer(t,r.dtype),n=0;n<a.values.length;++n){for(var i=a.indexToLoc(n),o=new Array(r.rank),s=0;s<o.length;s++)o[s]=i[s]%r.shape[s];var u=r.locToIndex(o);a.values[n]=r.values[u]}return a}var fh=function(r,e){var t=e.value-r.value;return t===0?r.index-e.index:t};function AW(r,e,t,n){for(t===void 0&&(t=0),n===void 0&&(n=r.length-1);n>t;){if(n-t>600){var a=n-t+1,i=e-t+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2),c=Math.max(t,Math.floor(e-i*s/a+u)),l=Math.min(n,Math.floor(e+(a-i)*s/a+u));AW(r,e,c,l)}var f=r[e],h=t,p=n;for(k.util.swap(r,t,e),fh(r[n],f)>0&&k.util.swap(r,t,n);h<p;){for(k.util.swap(r,h,p),h++,p--;fh(r[h],f)<0;)h=h+1;for(;fh(r[p],f)>0;)p=p-1}fh(r[t],f)===0?k.util.swap(r,t,p):(p=p+1,k.util.swap(r,p,n)),p<=e&&(t=p+1),e<=p&&(n=p-1)}}function DWe(r,e,t,n,a){for(var i=e[e.length-1],o=Te([r.length/i,i],2),s=o[0],u=o[1],c=k.util.getTypedArrayFromDType(t,s*n),l=k.util.getTypedArrayFromDType("int32",s*n),f=function(d){var m=d*u,v=r.subarray(m,m+u),g=new Array(v.length);v.forEach(function(S,T){return g[T]={value:S,index:T}}),n<g.length&&(AW(g,n),g=g.slice(0,n)),a&&g.sort(fh);for(var y=d*n,w=c.subarray(y,y+n),b=l.subarray(y,y+n),x=0;x<n;x++)w[x]=g[x].value,b[x]=g[x].index},h=0;h<s;h++)f(h);var p=e.slice();return p[p.length-1]=n,[k.buffer(p,t,c),k.buffer(p,"int32",l)]}function _We(r,e,t,n){for(var a=k.util.parseAxisParam(e,t)[0],i=[1,t[0],1],o=0;o<a;o++)i[0]*=t[o];i[1]=t[a];for(var o=a+1;o<t.length;o++)i[2]*=t[o];for(var s=new Map,u=new Int32Array(t[a]),c=new k.TensorBuffer(i,n,r),l=[],f=i[0]===1&&i[2]===1,o=0;o<t[a];o++){var h=void 0;if(f)h=r[o].toString();else{for(var p=[],d=0;d<i[0];d++)for(var m=0;m<i[2];m++)p.push(c.get(d,o,m));h=p.join(",")}var v=s.get(h);if(v!=null)u[o]=v;else{var g=s.size;s.set(h,g),u[o]=g,l.push(o)}}var y=i.slice();y[1]=s.size;var w=new k.TensorBuffer(y,n);l.forEach(function(x,S){for(var T=0;T<i[0];T++)for(var E=0;E<i[2];E++)w.set(c.get(T,x,E),T,S,E)});var b=t.slice();return b[a]=y[1],{outputValues:w.values,outputShape:b,indices:u}}var FWe=_qe,DW=Fqe,RWe=Rqe,OWe=Oqe,PWe=Dqe,MWe=Pqe,BWe=Mqe,LWe=Bqe,zWe=Lqe,$We=zqe,qWe=$qe,WWe=qqe,VWe=Wqe,UWe=Vqe,GWe=Uqe,HWe=Gqe,KWe=Hqe,jWe=Kqe,XWe=jqe,YWe=Xqe,ZWe=Yqe,JWe=Zqe,QWe=CW,eVe=Jqe,tVe=Qqe,rVe=tWe,nVe=uWe,aVe=cWe,iVe=fWe,oVe=hWe,sVe=pWe,uVe=dWe,cVe=vWe,_W=Aqe,lVe=mWe,fVe=gWe,hVe=yWe,FW=bWe,pVe=wWe,dVe=xWe,vVe=kWe,mVe=NWe,gVe=EWe,yVe=IWe,bVe=CWe,wVe=AWe,xVe=DWe,jx=eWe,kVe=_We;function RW(r,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return"".concat(r,".").concat(t)})}function xn(r,e){return e===1?[r]:RW(r,e)}function SVe(r,e){if(r===1)return"rc";for(var t="",n=0;n<r;n++)t+=e[n],n<r-1&&(t+=",");return t}var NVe=function(){function r(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=pn(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=xn("rc",this.rank),n=Lt(this.rank),a=this.getOutOfBoundsCondition(t),i=this.getSetup(t),o=this.getOutput(t);this.userCode=`
        void main() {
          `.concat(n,` rc = getOutputCoords();

          if(`).concat(a,`) {
            setOutput(vec4(0));
          } else {
            `).concat(i,`

            setOutput(vec4(`).concat(o,`));
          }
        }
      `)}}return r.prototype.getSourceCoordsArr=function(e){for(var t=[],n=0;n<=1;n++)for(var a=0;a<=1;a++){for(var i="".concat(n===0?"r":"rp1",", ").concat(a===0?"c":"cp1"),o=2;o<this.rank;o++)i="".concat(e[e.length-1-o],",")+i;t.push(i)}return t},r.prototype.getOutOfBoundsCondition=function(e){if(this.rank===1)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);for(var t="",n=this.rank-2;n<this.rank;n++)t+="".concat(e[n]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(n,"]"):this.outputShape[n]),n<this.rank-1&&(t+="||");return t},r.prototype.getSetup=function(e){if(this.rank===1)return"";var t=e.slice(-2),n=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],a=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return`
      int r = `.concat(t[0],`;
      int c = `).concat(t[1],`;
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= `).concat(n,`;
      bool rEdge = rp1 >= `).concat(a,`;
    `)},r.prototype.getOutput=function(e){var t=this.getSourceCoordsArr(e);if(this.rank===1){var n=this.enableShapeUniforms?"outShape":this.outputShape[0];return"getA(rc), (rc + 1 >= ".concat(n," ? 0. : getA(rc + 1)), 0, 0")}return"getA(".concat(t[0],`),
            cEdge ? 0. : getA(`).concat(t[1],`),
            rEdge ? 0. : getA(`).concat(t[2],`),
            rEdge || cEdge ? 0. : getA(`).concat(t[3],")")},r}();var OW=function(){function r(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=pn(this.outputShape.length);for(var n="",a=0;a<4;a++){var i="thisRC = rc;";a%2===1&&(i+="thisRC.z += 1;"),a>1&&(i+="thisRC.y += 1;"),n+=`
        `.concat(i,`
        `).concat(a>0?"if(thisRC.y < rows && thisRC.z < cols){":"",`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`).concat(a,`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `).concat(a>0?"}":"",`
      `)}this.userCode=`
      `.concat(TVe(t,this.enableShapeUniforms),`
      `).concat(this.enableShapeUniforms?qx():$x(e),`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `).concat(this.enableShapeUniforms?"outShape[1]":e[1],`;
        int cols = `).concat(this.enableShapeUniforms?"outShape[2]":e[2],`;

        `).concat(n,`

        setOutput(result);
      }
    `)}return r}();function TVe(r,e){var t=e?P$e(["r","c","d"],"inputShape"):xu(["r","c","d"],r);return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `.concat(t,`
      return ivec3(r, c, d);
    }
  `)}var EVe=function(){function r(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}return r.prototype.acquireTexture=function(e,t,n){var a=pq(t,n),i=dq(e,a,n);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);var o=hq(e,a,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[i].pop();return this.usedTextures[i].push(s),s}var u;return a===sn.PACKED_2X2_FLOAT32?u=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):a===sn.PACKED_2X2_FLOAT16?u=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):a===sn.UNPACKED_FLOAT32?u=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):a===sn.UNPACKED_FLOAT16?u=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):a===sn.PACKED_4X1_UNSIGNED_BYTE&&(u=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(u),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),u},r.prototype.releaseTexture=function(e,t,n,a){if(this.freeTextures!=null){var i=pq(n,a),o=dq(t,i,a);o in this.freeTextures||(this.freeTextures[o]=[]);var s=hq(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,a),u=k.env().get("WEBGL_DELETE_TEXTURE_THRESHOLD");u!==-1&&this._numBytesAllocated>u?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=s):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=s),this.numUsedTextures--;var c=this.usedTextures[o],l=c&&c.indexOf(e);if(l==null||l<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c[l]=c[c.length-1],c.pop(),this.log()}},r.prototype.log=function(){if(!!this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}},Object.defineProperty(r.prototype,"numBytesAllocated",{get:function(){return this._numBytesAllocated},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"numBytesFree",{get:function(){return this._numBytesFree},enumerable:!1,configurable:!0}),r.prototype.getNumUsedTextures=function(){return this.numUsedTextures},r.prototype.getNumFreeTextures=function(){return this.numFreeTextures},r.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(n){e.gpgpu.deleteMatrixTexture(n.texture)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(a){e.gpgpu.deleteMatrixTexture(a.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}},r}();function IVe(r,e){var t=r;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===r.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error("Unknown internal format ".concat(e))}function hq(r,e,t,n,a){var i=CVe(e,n),o;if(a){var s=Te(Vc(r[0],r[1]),2),u=s[0],c=s[1];o=u*c}else{var l=Te(yh(r[0],r[1]),2),f=l[0],h=l[1];o=f*h}var p=IVe(t,i);return o*p}function CVe(r,e){switch(r){case sn.PACKED_2X2_FLOAT32:return Hx(e);case sn.PACKED_2X2_FLOAT16:return Kx(e);case sn.UNPACKED_FLOAT32:return Vx(e);case sn.UNPACKED_FLOAT16:return Ux(e);case sn.PACKED_4X1_UNSIGNED_BYTE:return Gx(e);default:throw new Error("Unknown physical texture type ".concat(r))}}function AVe(r){return k.env().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?r?sn.PACKED_2X2_FLOAT32:sn.UNPACKED_FLOAT32:r?sn.PACKED_2X2_FLOAT16:sn.UNPACKED_FLOAT16}function pq(r,e){if(r===xa.UPLOAD)return sn.PACKED_2X2_FLOAT32;if(r===xa.RENDER||r==null)return AVe(e);if(r===xa.DOWNLOAD||r===xa.PIXELS)return sn.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(r))}function dq(r,e,t){return"".concat(r[0],"_").concat(r[1],"_").concat(e,"_").concat(t)}var qi=function(){function r(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=pn(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        `.concat(t,`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `)}return r}(),Ja="if (isnan(x)) return x;",DVe="return x;",vq="return abs(x);",_Ve="return (x >= 0.0) ? x : (exp(x) - 1.0);",FVe=Ja+`
  return (x < 0.0) ? 0.0 : x;
`,RVe=Ja+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,is="return x;",OVe="return 1.0 / (1.0 + exp(-1.0 * x));";var PVe="return x;",MVe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,BVe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,LVe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,zVe="return 1.0 / (1.0 + exp(-1.0 * x));",os=function(){function r(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=pn(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `.concat(t,`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `)}return r}();var $Ve=function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=pn(this.outputShape.length);var t=e.length,n=xn("rc",t),a=Lt(t),i=SVe(t,n),o=n.slice(-2),s=t<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode=`
      void main() {
        `.concat(a,` rc = getOutputCoords();
        vec4 packedInput = getA(`).concat(i,`);

        setOutput(getChannel(packedInput, `).concat(s,`));
      }
    `)}return r}(),qVe=k.kernel_impls.whereImpl,WVe=1e-7,VVe=1e-4,im={};function UVe(r){return r in im||(im[r]={}),im[r]}var GVe=k.env().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),HVe=600;function KVe(){return k.env().global.screen==null?1024:k.env().global.screen.height*k.env().global.screen.width*window.devicePixelRatio*HVe/1024/1024}var Xx=function(r){y$e(e,r);function e(t){var n=r.call(this)||this;if(n.pendingRead=new WeakMap,n.pendingDisposal=new WeakSet,n.dataRefCount=new WeakMap,n.numBytesInGPU=0,n.uploadWaitMs=0,n.downloadWaitMs=0,n.lastGlFlushTime=0,n.warnedAboutMemory=!1,n.pendingDeletes=0,n.disposed=!1,!k.env().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");var a;if(t!=null){if(t instanceof fm)a=t;else{var i=Ni(k.env().getNumber("WEBGL_VERSION"),t);a=new fm(i)}n.binaryCache={},n.gpgpuCreatedLocally=!1}else{var i=Ni(k.env().getNumber("WEBGL_VERSION"));a=new fm(i),n.binaryCache=UVe(k.env().getNumber("WEBGL_VERSION")),n.gpgpuCreatedLocally=!0}return n.gpgpu=a,n.canvas=n.gpgpu.gl.canvas,n.textureManager=new EVe(n.gpgpu),n.numMBBeforeWarning=KVe(),n.texData=new k.DataStorage(n,k.engine()),n}return e.prototype.nextDataId=function(){return e.nextDataId++},e.prototype.numDataIds=function(){return this.texData.numDataIds()-this.pendingDeletes},e.prototype.writeTexture=function(t,n,a,i,o,s){var u=this.makeTensorInfo(n,a),c=this.texData.get(u.dataId);c.isPacked=!1,c.texture={texture:t,texShape:[i,o]},c.texShape=[i,o];var l=lh(n),f=new sq(l,!1,s),h=this.runWebGLProgram(f,[u],a,[[i,o]]);return h.shape=n,c.texture=null,this.disposeIntermediateTensorInfo(u),h.dataId},e.prototype.write=function(t,n,a){if((k.env().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||k.env().getBool("DEBUG"))&&this.checkNumericalProblems(t),a==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var i={id:this.nextDataId()};return this.texData.set(i,{shape:n,dtype:a,values:t,usage:xa.UPLOAD,refCount:1}),i},e.prototype.refCount=function(t){if(this.texData.has(t)){var n=this.texData.get(t);return n.refCount}return 0},e.prototype.incRef=function(t){var n=this.texData.get(t);n.refCount++},e.prototype.decRef=function(t){if(this.texData.has(t)){var n=this.texData.get(t);n.refCount--}},e.prototype.move=function(t,n,a,i,o){if(k.env().getBool("DEBUG")&&this.checkNumericalProblems(n),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:a,dtype:i,values:n,usage:xa.UPLOAD,refCount:o})},e.prototype.disposeIntermediateTensorInfo=function(t){this.disposeData(t.dataId)},e.prototype.readSync=function(t){var n=this.texData.get(t),a=n.values,i=n.dtype,o=n.complexTensorInfos,s=n.slice,u=n.shape,c=n.isPacked;if(s!=null){var l=void 0;c?l=new os(u,is):l=new qi(u,is);var f=this.runWebGLProgram(l,[{dataId:t,shape:u,dtype:i}],i),h=this.readSync(f.dataId);return this.disposeIntermediateTensorInfo(f),h}if(a!=null)return this.convertAndCacheOnCPU(t);if(i==="string")return a;var p=this.activeTimers!=null,d;p&&(d=k.util.now());var m;if(i==="complex64"){var v=this.readSync(o.real.dataId),g=this.readSync(o.imag.dataId);m=k.backend_util.mergeRealAndImagArrays(v,g)}else m=this.getValuesFromTexture(t);return p&&(this.downloadWaitMs+=k.util.now()-d),this.convertAndCacheOnCPU(t,m)},e.prototype.read=function(t){return qc(this,void 0,void 0,function(){var n,a,i,o,s,u,c,l,f,h,p,d,m,v,g,y,w,b,x,S,T,E,C;return Wc(this,function(R){switch(R.label){case 0:if(this.pendingRead.has(t))return n=this.pendingRead.get(t),[2,new Promise(function(_){return n.push(_)})];if(a=this.texData.get(t),i=a.values,o=a.shape,s=a.slice,u=a.dtype,c=a.complexTensorInfos,l=a.isPacked,s!=null)return f=void 0,l?f=new os(o,is):f=new qi(o,is),h=this.runWebGLProgram(f,[{dataId:t,shape:o,dtype:u}],u),p=this.read(h.dataId),this.disposeIntermediateTensorInfo(h),[2,p];if(i!=null)return[2,this.convertAndCacheOnCPU(t)];if(k.env().getBool("DEBUG")&&!k.env().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&k.env().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return d=null,u!=="complex64"&&k.env().get("WEBGL_BUFFER_SUPPORTED")&&(m=this.decode(t),v=this.texData.get(m.dataId),d=(C=this.gpgpu).createBufferFromTexture.apply(C,pr([v.texture.texture],Te(nm(o)),!1))),this.pendingRead.set(t,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:R.sent(),R.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([this.read(c.real.dataId),this.read(c.imag.dataId)])];case 3:return y=R.sent(),w=y[0],b=y[1],g=k.backend_util.mergeRealAndImagArrays(w,b),[3,5];case 4:d==null?g=this.getValuesFromTexture(t):(x=k.util.sizeFromShape(o),g=this.gpgpu.downloadFloat32MatrixFromBuffer(d,x)),R.label=5;case 5:return m!=null&&this.disposeIntermediateTensorInfo(m),d!=null&&(S=this.gpgpu.gl,Pe(S,function(){return S.deleteBuffer(d)})),T=this.convertAndCacheOnCPU(t,g),E=this.pendingRead.get(t),this.pendingRead.delete(t),E.forEach(function(_){return _(T)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&k.engine().removeDataId(t,this),this.pendingDeletes--),[2,T]}})})},e.prototype.readToGPU=function(t,n){n===void 0&&(n={});var a=this.texData.get(t),i=a.values,o=a.shape,s=a.slice,u=a.dtype,c=a.isPacked,l=a.texture;if(u==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(s!=null){var f=void 0;c?f=new os(o,is):f=new qi(o,is);var h=this.runWebGLProgram(f,[{dataId:t,shape:o,dtype:u}],u),p=this.readToGPU(h,n);return this.disposeIntermediateTensorInfo(h),p}if(l==null)throw i!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");var d=this.decode(t,n.customTexShape),m=k.engine().makeTensorFromTensorInfo(d),v=this.texData.get(d.dataId);return Object.assign({tensorRef:m},v.texture)},e.prototype.bufferSync=function(t){var n=this.readSync(t.dataId);if(t.dtype==="string")try{var a=n.map(function(i){return k.util.decodeString(i)});return k.buffer(t.shape,t.dtype,a)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return k.buffer(t.shape,t.dtype,n)},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var n=0;n<t.length;n++){var a=t[n];if(!Bq(a))throw k.env().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value ".concat(a," cannot be represented with your ")+"current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value ".concat(a," cannot be represented on this device."))}},e.prototype.getValuesFromTexture=function(t){var n,a=this.texData.get(t),i=a.shape,o=a.dtype,s=a.isPacked,u=k.util.sizeFromShape(i);if(k.env().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var c=this.decode(t),l=this.texData.get(c.dataId),f=(n=this.gpgpu).downloadMatrixFromPackedTexture.apply(n,pr([l.texture.texture],Te(nm(i)),!1)).subarray(0,u);return this.disposeIntermediateTensorInfo(c),f}var h=k.env().getBool("WEBGL_PACK")&&s===!0,p=h?lh(i):i,d=h?new Nqe(p):new Sqe(p),m=this.runWebGLProgram(d,[{shape:p,dtype:o,dataId:t}],"float32"),v=this.texData.get(m.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(v.texture.texture,v.texShape[0],v.texShape[1]).subarray(0,u);return this.disposeIntermediateTensorInfo(m),g},e.prototype.timerAvailable=function(){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0},e.prototype.time=function(t){var n=this,a=this.activeTimers,i=[],o=!1;this.programTimersStack==null?(this.programTimersStack=i,o=!0):this.activeTimers.push(i),this.activeTimers=i,t();var s=k.util.flatten(this.activeTimers.map(function(l){return l.query})).filter(function(l){return l!=null}),u=k.util.flatten(this.activeTimers.map(function(l){return l.name})).filter(function(l){return l!=null});this.activeTimers=a,o&&(this.programTimersStack=null);var c={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return function(){return qc(n,void 0,void 0,function(){var l;return Wc(this,function(f){switch(f.label){case 0:return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(s)]:[3,2];case 1:return l=f.sent(),c.kernelMs=k.util.sum(l),c.getExtraProfileInfo=function(){return l.map(function(h,p){return{name:u[p],ms:h}}).map(function(h){return"".concat(h.name,": ").concat(h.ms)}).join(", ")},[3,3];case 2:c.kernelMs={error:"WebGL query timers are not supported in this environment."},f.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,c]}})})}()},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}},e.prototype.startTimer=function(){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:k.util.now(),endMs:null}},e.prototype.endTimer=function(t){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=k.util.now(),t)},e.prototype.getQueryTime=function(t){return qc(this,void 0,void 0,function(){var n;return Wc(this,function(a){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:(n=t,[2,n.endMs-n.startMs])})})},e.prototype.disposeData=function(t,n){if(n===void 0&&(n=!1),this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(n?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!n&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);var a=this.texData.get(t).complexTensorInfos;return a!=null&&(this.disposeData(a.real.dataId,n),this.disposeData(a.imag.dataId,n)),this.texData.delete(t),!0},e.prototype.releaseGPUData=function(t){var n=this.texData.get(t),a=n.texture,i=n.dtype,o=n.texShape,s=n.usage,u=n.isPacked,c=n.slice,l=c&&c.origDataId||t,f=this.dataRefCount.get(l);f>1?this.dataRefCount.set(l,f-1):(this.dataRefCount.delete(l),a!=null&&(this.numBytesInGPU-=this.computeBytes(o,i),this.textureManager.releaseTexture(a,o,s,u)));var h=this.texData.get(t);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.shouldExecuteOnCPU=function(t,n){var a=this;return n===void 0&&(n=GVe),k.env().getBool("WEBGL_CPU_FORWARD")&&t.every(function(i){return a.texData.get(i.dataId).texture==null&&k.util.sizeFromShape(i.shape)<n})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.where=function(t){k.backend_util.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var n=t.dataSync();return qVe(t.shape,n)},e.prototype.packedUnaryOp=function(t,n,a){var i=new os(t.shape,n),o=this.compileAndRun(i,[t],a);return k.engine().makeTensorFromTensorInfo(o)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t])&&t.dtype!=="complex64"){var n=_W(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,n)}if(k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,vq,t.dtype);var a=new qi(t.shape,vq),i=this.compileAndRun(a,[t]);return k.engine().makeTensorFromTensorInfo(i)},e.prototype.makeTensorInfo=function(t,n,a){var i;if(n==="string"&&a!=null&&a.length>0&&k.util.isString(a[0])){var o=a.map(function(s){return k.util.encodeString(s)});i=this.write(o,t,n)}else i=this.write(a,t,n);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:n}},e.prototype.makeOutput=function(t,n,a){return k.engine().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,a),this)},e.prototype.unpackTensor=function(t){var n=new $Ve(t.shape);return this.runWebGLProgram(n,[t],t.dtype)},e.prototype.packTensor=function(t){var n=new NVe(t.shape),a=!0;return this.runWebGLProgram(n,[t],t.dtype,null,a)},e.prototype.packedReshape=function(t,n){var a=pr([yu(t.shape)],Te(bu(t.shape)),!1),i={dtype:t.dtype,shape:a,dataId:t.dataId},o=pr([yu(n)],Te(bu(n)),!1),s=new OW(o,a),u=!0,c=[a],l=this.runWebGLProgram(s,[i],t.dtype,c,u);return{dataId:l.dataId,shape:n,dtype:l.dtype}},e.prototype.decode=function(t,n){var a=this.texData.get(t),i=a.isPacked,o=a.shape,s=a.dtype;if(n!=null){var u=k.util.sizeFromShape(o),c=n[0]*n[1]*4;k.util.assert(u<=c,function(){return"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."})}var l=lh(o),f;i?f=new kqe(l):f=new xqe(l);var h=!0,p=[n??nm(l)],d=this.runWebGLProgram(f,[{shape:l,dtype:s,dataId:t}],s,p,h,n);return{dtype:s,shape:o,dataId:d.dataId}},e.prototype.runWebGLProgram=function(t,n,a,i,o,s){var u=this;o===void 0&&(o=!1);var c=this.makeTensorInfo(t.outputShape,a),l=this.texData.get(c.dataId);if(t.packedOutput&&(l.isPacked=!0),t.outPackingScheme===ph.DENSE){var f=s??nm(t.outputShape);l.texShape=f.map(function(S){return S*2})}if(t.outTexUsage!=null&&(l.usage=t.outTexUsage),k.util.sizeFromShape(c.shape)===0)return l.values=k.util.getTypedArrayFromDType(c.dtype,0),c;var h=[],p=n.map(function(S){if(S.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var T=u.texData.get(S.dataId);if(T.texture==null){if(!t.packedInputs&&k.util.sizeFromShape(S.shape)<=k.env().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:S.shape,texData:null,isUniform:!0,uniformValues:T.values};t.packedInputs&&(T.isPacked=!0,T.shape=S.shape)}if(u.uploadToGPU(S.dataId),!!T.isPacked!=!!t.packedInputs)S=T.isPacked?u.unpackTensor(S):u.packTensor(S),h.push(S),T=u.texData.get(S.dataId);else if(T.isPacked&&!dh(T.shape,S.shape)){var E=S,C=S.shape;S.shape=T.shape,S=u.packedReshape(S,C),h.push(S),T=u.texData.get(S.dataId),E.shape=C}return{shape:S.shape,texData:T,isUniform:!1}});this.uploadToGPU(c.dataId);var d={shape:c.shape,texData:l,isUniform:!1},m=wqe(t,p,d),v=this.getAndSaveBinary(m,function(){return yqe(u.gpgpu,t,p,d)}),g=this.activeTimers!=null,y;g&&(y=this.startTimer()),k.env().get("ENGINE_COMPILE_ONLY")||bqe(this.gpgpu,v,p,d,i),h.forEach(function(S){return u.disposeIntermediateTensorInfo(S)}),g&&(y=this.endTimer(y),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(y)}));var w=k.env().get("WEBGL_FLUSH_THRESHOLD");if(w>0){var b=k.util.now();b-this.lastGlFlushTime>w&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=b)}if(!k.env().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&o===!1){var x=this.unpackTensor(c);return this.disposeIntermediateTensorInfo(c),x}return c},e.prototype.compileAndRun=function(t,n,a,i,o){o===void 0&&(o=!1),a=a||n[0].dtype;var s=this.runWebGLProgram(t,n,a,i,o);return s},e.prototype.getAndSaveBinary=function(t,n){return t in this.binaryCache||(this.binaryCache[t]=n()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;if(!this.disposed){if(!k.env().getBool("IS_TEST")){var n=Object.keys(this.binaryCache);n.forEach(function(a){t.gpgpu.deleteProgram(t.binaryCache[a].webGLProgram),delete t.binaryCache[a]})}this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=k.tidy(function(){if(!k.env().get("WEBGL_RENDER_FLOAT32_ENABLED")){var n=k.env().getBool("DEBUG");k.env().set("DEBUG",!1);var a=t.abs(k.scalar(1e-8)).dataSync()[0];if(k.env().set("DEBUG",n),a>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?WVe:VVe},e.prototype.uploadToGPU=function(t){var n,a=this.texData.get(t),i=a.shape,o=a.dtype,s=a.values,u=a.texture,c=a.usage,l=a.isPacked;if(u==null){var f=this.activeTimers!=null,h;f&&(h=k.util.now());var p=a.texShape;if(p==null&&(p=eW(i,l),a.texShape=p),s!=null){var d=lh(i),m=void 0,v=p[1],g=p[0],y=s instanceof Uint8Array||s instanceof Uint8ClampedArray;(l||!y)&&(n=Te(Vc(p[0],p[1]),2),v=n[0],g=n[1]),l?m=new Eqe(d,y):m=new sq(d,y);var w=y?[g,v]:p,b=this.makeTensorInfo(w,o),x=this.texData.get(b.dataId);y?x.usage=xa.PIXELS:x.usage=xa.UPLOAD,x.texShape=w,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),v,g,s);var S=[[g,v]],T=!0,E=this.runWebGLProgram(m,[b],o,S,T),C=this.texData.get(E.dataId);a.texShape=C.texShape,a.isPacked=C.isPacked,a.usage=C.usage,k.env().get("ENGINE_COMPILE_ONLY")?this.disposeData(E.dataId):(a.texture=C.texture,a.values=null,this.texData.delete(E.dataId)),this.disposeIntermediateTensorInfo(b),f&&(this.uploadWaitMs+=k.util.now()-h)}else{var R=this.acquireTexture(p,c,o,l);a.texture=R}}},e.prototype.convertAndCacheOnCPU=function(t,n){var a=this.texData.get(t),i=a.dtype;return n!=null&&(a.values=jVe(n,i)),a.values},e.prototype.acquireTexture=function(t,n,a,i){if(this.numBytesInGPU+=this.computeBytes(t,a),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(o," MB, ")+"most likely due to a memory leak")}return this.textureManager.acquireTexture(t,n,i)},e.prototype.computeBytes=function(t,n){return t[0]*t[1]*k.util.bytesPerElement(n)},e.prototype.checkCompileCompletion=function(){var t,n;try{for(var a=kn(Object.entries(this.binaryCache)),i=a.next();!i.done;i=a.next()){var o=Te(i.value,2),s=o[1];this.checkCompletion_(s)}}catch(u){t={error:u}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},e.prototype.checkCompileCompletionAsync=function(){return qc(this,void 0,void 0,function(){var t,n,a,i,l,o,s,u,c,l,f,h,p,d,m=this;return Wc(this,function(v){if(t=[],this.gpgpu.parallelCompilationExtension){try{for(n=kn(Object.entries(this.binaryCache)),a=n.next();!a.done;a=n.next())i=Te(a.value,2),l=i[1],t.push(this.checkCompletionAsync_(l))}catch(g){f={error:g}}finally{try{a&&!a.done&&(h=n.return)&&h.call(n)}finally{if(f)throw f.error}}return[2,Promise.all(t)]}else{o=function(g){var y=new Promise(function(w){try{m.checkCompletion_(g),w(!0)}catch(b){throw b}});t.push(y)};try{for(s=kn(Object.entries(this.binaryCache)),u=s.next();!u.done;u=s.next())c=Te(u.value,2),l=c[1],o(l)}catch(g){p={error:g}}finally{try{u&&!u.done&&(d=s.return)&&d.call(s)}finally{if(p)throw p.error}}return[2,Promise.all(t)]}})})},e.prototype.checkCompletionAsync_=function(t){return qc(this,void 0,void 0,function(){return Wc(this,function(n){switch(n.label){case 0:return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?[2,this.checkCompletion_(t)]:[3,1];case 1:return[4,k.nextFrame()];case 2:return n.sent(),[2,this.checkCompletionAsync_(t)]}})})},e.prototype.checkCompletion_=function(t){if(this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(zx(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0},e.prototype.getUniformLocations=function(){var t,n;try{for(var a=kn(Object.values(this.binaryCache)),i=a.next();!i.done;i=a.next()){var o=i.value;this.gpgpu.buildVao(o.webGLProgram);var s=fW(this.gpgpu,o.program,o.webGLProgram),u=s.variablesLocations,c=s.customUniformLocations,l=s.infLoc,f=s.nanLoc,h=s.outShapeLocation,p=s.outShapeStridesLocation,d=s.outTexShapeLocation;o.variablesLocations=u,o.customUniformLocations=c,o.infLoc=l,o.nanLoc=f,o.outShapeLocation=h,o.outShapeStridesLocation=p,o.outTexShapeLocation=d}}catch(m){t={error:m}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}},e.prototype.createTensorFromGPUData=function(t,n,a){t.channels=t.channels||"RGBA";var i=t.texture,o=t.height,s=t.width,u=t.channels,c=k.engine().backend;if(!c.gpgpu.gl.isTexture(i))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");var l=c.writeTexture(i,n,a,o,s,u);return k.engine().makeTensorFromDataId(l,n,a,c)},e}(k.KernelBackend);Xx.nextDataId=0;function jVe(r,e){if(e==="float32"||e==="complex64")return r;if(e==="int32"||e==="bool"){for(var t=e==="int32"?new Int32Array(r.length):new Uint8Array(r.length),n=0;n<t.length;++n)t[n]=Math.round(r[n]);return t}else throw new Error("Unknown dtype ".concat(e))}var XVe="4.6.0";function PW(){k.env().set("WEBGL_FORCE_F16_TEXTURES",!0)}k.device_util.isBrowser()&&k.registerBackend("webgl",function(){return new Xx},2);var YVe={forceHalfFloat:PW};var Yx=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`,wu=function(){function r(e,t,n){this.variableNames=["A","B"],this.outputShape=k.backend_util.assertAndGetBroadcastShape(t,n),this.enableShapeUniforms=pn(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        `.concat(e,`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `)}return r}();var Su=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`,Xc=function(){function r(e,t,n,a){a===void 0&&(a=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=k.backend_util.assertAndGetBroadcastShape(t,n);var i=this.outputShape.length;this.enableShapeUniforms=pn(i);var o="";if(a)if(i===0||k.util.sizeFromShape(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else{var s=Lt(i);if(o=`
          `.concat(s,` coords = getOutputCoords();
        `),i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= `.concat(this.outputShape[0],` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `);else{var u=xn("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (`.concat(u[i-2]," + 1) >= outShape[").concat(i,` - 2];
            bool nextColOutOfBounds =
              (`).concat(u[i-1]," + 1) >= outShape[").concat(i,` - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `):o+=`
            bool nextRowOutOfBounds =
              (`.concat(u[i-2]," + 1) >= ").concat(this.outputShape[i-2],`;
            bool nextColOutOfBounds =
              (`).concat(u[i-1]," + 1) >= ").concat(this.outputShape[i-1],`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `)}}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `.concat(e,`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `).concat(o,`

        setOutput(result);
      }
    `)}return r}();function ca(r){var e=r.inputs,t=r.backend,n=e.x;return t.incRef(n.dataId),{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}var ZVe={kernelName:k.Identity,backendName:"webgl",kernelFunc:ca};function ss(r){var e=r.inputs,t=r.backend,n=e.real,a=e.imag,i=t.makeTensorInfo(n.shape,"complex64"),o=t.texData.get(i.dataId),s=ca({inputs:{x:n},backend:t}),u=ca({inputs:{x:a},backend:t});return o.complexTensorInfos={real:s,imag:u},i}var JVe={kernelName:k.Complex,backendName:"webgl",kernelFunc:ss};var MW="return (a < 0.) ? b * a : a;",BW=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function QVe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.alpha,o=t.makeTensorInfo([],"float32",k.util.createScalarValue(i,"float32")),s=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xc(BW,a.shape,o.shape):new wu(MW,a.shape,o.shape),u=t.runWebGLProgram(s,[a,o],"float32");return t.disposeIntermediateTensorInfo(o),u}var eUe={kernelName:k.LeakyRelu,backendName:"webgl",kernelFunc:QVe};var LW="return (a < 0.) ? b * a : a;",zW=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function tUe(r){var e=r.inputs,t=r.backend,n=e.x,a=e.alpha,i=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xc(zW,n.shape,a.shape):new wu(LW,n.shape,a.shape);return t.runWebGLProgram(i,[n,a],"float32")}var rUe={kernelName:k.Prelu,backendName:"webgl",kernelFunc:tUe},Yc="if (isnan(x)) return x;";function Nt(r){var e=r.opSnippet,t=r.packedOpSnippet,n=r.cpuKernelImpl,a=r.dtype;return function(i){var o=i.inputs,s=i.backend,u=o.x,c=s,l=a||u.dtype;if(c.shouldExecuteOnCPU([u])&&n!=null){var f=c.texData.get(u.dataId),h=n(f.values,l);return c.makeTensorInfo(u.shape,l,h)}var p=k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null,d;return p?d=new os(u.shape,t):d=new qi(u.shape,e),c.runWebGLProgram(d,[u],l)}}function un(r){var e=r.opSnippet,t=r.packedOpSnippet,n=r.checkOutOfBounds,a=n===void 0?!1:n,i=r.supportsComplex,o=i===void 0?!1:i,s=r.cpuKernelImpl,u=r.dtype;return function(c){var l=c.inputs,f=c.backend,h=l.a,p=l.b,d=f;if(o&&h.dtype==="complex64"){var m=d.texData.get(h.dataId),v=d.texData.get(p.dataId),g=Te([[m.complexTensorInfos.real,v.complexTensorInfos.real],[m.complexTensorInfos.imag,v.complexTensorInfos.imag]].map(function(W){var X=Te(W,2),J=X[0],V=X[1],j={dataId:J.dataId,dtype:J.dtype,shape:h.shape},ne={dataId:V.dataId,dtype:V.dtype,shape:p.shape},re=new wu(e,h.shape,p.shape);return d.runWebGLProgram(re,[j,ne],k.upcastType(J.dtype,V.dtype))}),2),y=g[0],w=g[1],b=ss({inputs:{real:y,imag:w},backend:d});return d.disposeIntermediateTensorInfo(y),d.disposeIntermediateTensorInfo(w),b}var x=u||k.upcastType(h.dtype,p.dtype);if((h.dtype==="string"||p.dtype==="string"||d.shouldExecuteOnCPU([h,p]))&&s!=null){var S=d.texData.get(h.dataId).values,T=d.texData.get(p.dataId).values,E=h.dtype==="string"?k.backend_util.fromUint8ToStringArray(S):S,C=h.dtype==="string"?k.backend_util.fromUint8ToStringArray(T):T,R=Te(s(h.shape,p.shape,E,C,x),2),_=R[0],O=R[1],$=d.makeTensorInfo(O,x),z=d.texData.get($.dataId);return z.values=_,$}var L=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null,B;return L?B=new Xc(t,h.shape,p.shape,a):B=new wu(e,h.shape,p.shape),d.runWebGLProgram(B,[h,p],x)}}function vh(r,e){if(e===void 0&&(e=!1),r==="linear")return e?PVe:DVe;if(r==="relu")return e?BVe:FVe;if(r==="elu")return e?MVe:_Ve;if(r==="relu6")return e?LVe:RVe;if(r==="prelu")return e?zW:LW;if(r==="leakyrelu")return e?BW:MW;if(r==="sigmoid")return e?zVe:OVe;throw new Error("Activation ".concat(r," has not been implemented for the WebGL backend."))}var $W=function(){function r(e,t,n,a,i,o,s,u,c){a===void 0&&(a=!1),i===void 0&&(i=!1),o===void 0&&(o=!1),s===void 0&&(s=null),u===void 0&&(u=!1),c===void 0&&(c=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=pn(this.outputShape.length);var l=a?e[1]:e[2],f=Math.ceil(l/2),h=a?"i * 2, rc.y":"rc.y, i * 2",p=i?"rc.z, i * 2":"i * 2, rc.z",d=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],v="",g="";s&&(u?v=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `.concat(s,`
        }`):c?v=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          `.concat(s,`
        }`):v=`vec4 activation(vec4 x) {
          `.concat(s,`
        }`),g="result = activation(result);");var y=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");var w="rc.x",b="rc.x";e[0]<t[0]?w="imod(rc.x, ".concat(e[0],")"):t[0]<e[0]&&(b="imod(rc.x, ".concat(t[0],")")),this.userCode=`
      `.concat(v,`
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = `).concat(f,`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = `).concat(w,`;
        int batchB = `).concat(b,`;
        for (int i = 0; i < `).concat(f,`; i++) {
          vec4 a = getMatrixA(batchA, `).concat(h,`);
          vec4 b = getMatrixB(batchB, `).concat(p,`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`).concat(d[0]," * ").concat(m[0],`);
          result += (`).concat(d[1]," * ").concat(m[1],`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `).concat(y,`

        `).concat(g,`

        setOutput(result);
      }
    `)}return r}();var mq={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},gq=function(){function r(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=k.backend_util.assertAndGetBroadcastShape(t,n),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `.concat(e,`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `)}return r}(),yq="return a * b;";function Zx(r){var e=r.inputs,t=r.backend,n=e.a,a=e.b,i=k.backend_util.upcastType(n.dtype,a.dtype);if(n.dtype==="complex64"){var o=t.texData.get(n.dataId),s=t.texData.get(a.dataId),u=new gq(mq.REAL,n.shape,a.shape),c=new gq(mq.IMAG,n.shape,a.shape),l=[{dataId:o.complexTensorInfos.real.dataId,dtype:o.complexTensorInfos.real.dtype,shape:n.shape},{dataId:o.complexTensorInfos.imag.dataId,dtype:o.complexTensorInfos.imag.dtype,shape:n.shape},{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:a.shape},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:a.shape}],f=t.runWebGLProgram(u,l,"float32"),h=t.runWebGLProgram(c,l,"float32"),p=ss({inputs:{real:f,imag:h},backend:t});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),p}if(t.shouldExecuteOnCPU([n,a])){var o=t.texData.get(n.dataId),s=t.texData.get(a.dataId),d=Te(QWe(n.shape,a.shape,o.values,s.values,i),2),m=d[0],v=d[1],g=t.makeTensorInfo(v,i),y=t.texData.get(g.dataId);return y.values=m,g}var w;return k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?w=new Xc(yq,n.shape,a.shape):w=new wu(yq,n.shape,a.shape),t.runWebGLProgram(w,[n,a],i)}var nUe={kernelName:k.Multiply,backendName:"webgl",kernelFunc:Zx};function aUe(r,e,t){var n=pr([yu(r.shape)],Te(bu(r.shape)),!1),a={dtype:r.dtype,shape:n,dataId:r.dataId},i=pr([yu(e)],Te(bu(e)),!1),o=new OW(i,n),s=!0,u=[n],c=t.runWebGLProgram(o,[a],r.dtype,u,s);return{dataId:c.dataId,shape:e,dtype:c.dtype}}function Ae(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.shape,o=t,s=k.util.sizeFromShape(a.shape),u=k.util.inferFromImplicitShape(i,s),c=k.util.sizeFromShape(u);k.util.assert(s===c,function(){return"The new shape (".concat(u,") has ").concat(c," elements and the old ")+"shape (".concat(a.shape,") has ").concat(s," elements. The new shape and old ")+"shape must have the same number of elements."});var l=o.texData.get(a.dataId);return l.isPacked&&!dh(a.shape,u)&&!(l.texture!==null&&dh(l.shape,u))?aUe(a,u,o):(o.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype})}var iUe={kernelName:k.Reshape,backendName:"webgl",kernelFunc:Ae};var bq=function(){function r(e,t){this.variableNames=["x"];var n=e.windowSize,a=e.batchSize,i=e.inSize,o=e.outSize;this.outputShape=[a,o];var s=Math.floor(n/4)*4,u=n%4,c="sumValue += dot(values, ones);";if(t!=null){var l=1/t;c="sumValue += dot(values * ".concat(k.util.isInt(l)?l.toPrecision(2):l,", ones);")}var f="";i%n>0&&(f=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return 0.0;
        }
      `)),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `.concat(f,`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `).concat(n,`;

        float sumValue = 0.0;

        for (int i = 0; i < `).concat(s,`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `).concat(c,`
        }

        int inIdx = inOffset + `).concat(s,`;
        if (`).concat(u===1,`) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          `).concat(c,`
        } else if (`).concat(u===2,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          `).concat(c,`
        } else if (`).concat(u===3,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          `).concat(c,`
        }
        setOutput(sumValue);
      }
    `)}return r}();var oUe=function(){function r(e,t){this.variableNames=["x"];var n=e.windowSize,a=e.batchSize,i=e.inSize,o=e.outSize;this.outputShape=[a,o];var s="0.0",u="";t==="prod"?s="1.0":t==="min"?(s="1.0 / 1e-20",u="min"):t==="max"&&(s="-1.0 / 1e-20",u="max");var c="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="sum"?c="sumValue":t==="prod"?c="prodValue":t==="all"?c="allValue":t==="any"&&(c="anyValue");var l=Math.floor(n/4)*4,f=n%4,h=`
      if (`.concat(t==="sum",`) {
        sumValue += dot(values, ones);
      } else if (`).concat(t==="prod",`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `).concat(u,`(values, minMaxValue);
        if (`).concat(t==="min"," || ").concat(t==="max",`) {
          minMaxValue = `).concat(u,`(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `),p="vec4";t==="all"?(s="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,p="bvec4"):t==="any"&&(s="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,p="bvec4");var d="";i%n>0&&(d=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return initializationValue;
        }
      `)),this.userCode=`
      const float initializationValue = `.concat(s,`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `).concat(d,`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `).concat(n,`;

        vec4 minMaxValue = vec4(`).concat(s,`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `).concat(l,`; i += 4) {
          int inIdx = inOffset + i;
          `).concat(p," values = ").concat(p,`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `).concat(h,`
        }

        int inIdx = inOffset + `).concat(l,`;
        if (`).concat(f===1,`) {
          `).concat(p," values = ").concat(p,`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `).concat(h,`
        } else if (`).concat(f===2,`) {
          `).concat(p," values = ").concat(p,`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `).concat(h,`
        } else if (`).concat(f===3,`) {
          `).concat(p," values = ").concat(p,`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `).concat(h,`
        }
        setOutput(`).concat(c,`);
      }
    `)}return r}();function sUe(r){for(var e=[];e.length===0||e[e.length-1].outSize!==1;){var t=e.length?e[e.length-1].outSize:r[1],n=k.backend_util.computeOptimalWindowSize(t);e.push({inSize:t,windowSize:n,outSize:Math.ceil(t/n)})}return e}function Nu(r,e,t,n){for(var a=sUe(r.shape),i=r,o=0;o<a.length;o++){var s=a[o],u=s.inSize,c=s.windowSize,l=s.outSize,f=void 0,h=void 0;t==="mean"?f=o===0?new bq({windowSize:c,inSize:u,batchSize:r.shape[0],outSize:l},u):new bq({windowSize:c,inSize:u,batchSize:r.shape[0],outSize:l}):f=new oUe({windowSize:c,inSize:u,batchSize:r.shape[0],outSize:l},t),h=i,i=n.runWebGLProgram(f,[i],e),h.dataId!==r.dataId&&n.disposeIntermediateTensorInfo(h)}return i}var uUe=function(){function r(e,t){this.variableNames=["A"];for(var n=new Array(e.length),a=0;a<n.length;a++)n[a]=e[t[a]];this.outputShape=n,this.rank=n.length;var i=Lt(this.rank),o=cUe(t);this.userCode=`
    void main() {
      `.concat(i,` resRC = getOutputCoords();
      setOutput(getA(`).concat(o,`));
    }
    `)}return r}();function cUe(r){var e=r.length;if(e>6)throw Error("Transpose for rank ".concat(e," is not yet supported"));for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],n=new Array(e),a=0;a<r.length;a++)n[r[a]]=t[a];return n.join()}var lUe=function(){function r(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),a=0;a<n.length;a++)n[a]=e[t[a]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=Lt(this.rank),o=RW("rc",this.rank),s=new Array(this.rank),a=0;a<t.length;a++)s[t[a]]=o[a];var u="vec2(".concat(s.slice(-2).join(),")"),c="++".concat(o[this.rank-1]," < ").concat(n[this.rank-1]),l="getChannel(getA(".concat(s.join(),"), ").concat(u,")");this.userCode=`
    void main() {
      `.concat(i,` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `).concat(l,`;
      if(`).concat(c,`) {
        result[1] = `).concat(l,`;
      }
      --`).concat(o[this.rank-1],`;
      if(++`).concat(o[this.rank-2]," < ").concat(n[this.rank-2],`) {
        result[2] = `).concat(l,`;
        if(`).concat(c,`) {
          result[3] = `).concat(l,`;
        }
      }
      setOutput(result);
    }
    `)}return r}();function gm(r,e,t){var n=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new lUe(r.shape,e):new uUe(r.shape,e);return t.runWebGLProgram(n,[r],r.dtype)}function fUe(r,e,t,n){var a=e,i=r.shape.length,o=k.util.parseAxisParam(a,r.shape),s=o,u=k.backend_util.getAxesPermutation(s,i),c=u!=null,l=r;c&&(l=gm(r,u,n),s=k.backend_util.getInnerMostAxes(s.length,i)),k.backend_util.assertAxesAreInnerMostDims("sum",s,i);var f=Te(k.backend_util.computeOutAndReduceShapes(l.shape,s),2),h=f[0],p=f[1],d=h;t&&(d=k.backend_util.expandShapeToKeepDim(h,o));var m=k.util.sizeFromShape(p),v=k.util.sizeFromShape(r.shape),g=v/m,y=Ae({inputs:{x:l},attrs:{shape:[g,m]},backend:n}),w=k.sumOutType(r.dtype),b=Nu(y,w,"sum",n),x=Ae({inputs:{x:b},attrs:{shape:d},backend:n});return n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),c&&n.disposeIntermediateTensorInfo(l),x}function ym(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims;return fUe(a,i,o,t)}var hUe={kernelName:k.Sum,backendName:"webgl",kernelFunc:ym};function Sn(r){for(var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.perm,o=t,s=a.shape.length,u=new Array(s),c=0;c<u.length;c++)u[c]=a.shape[i[c]];var l;if(o.shouldExecuteOnCPU([a])){var f=o.texData.get(a.dataId),h=f.values,p=jx(h,a.shape,a.dtype,i,u);l=o.makeTensorInfo(u,a.dtype);var d=o.texData.get(l.dataId);d.values=p}else l=gm(a,i,o);return l}var pUe={kernelName:k.Transpose,backendName:"webgl",kernelFunc:Sn},qW=1e3;function pm(r){var e,t,n=r.a,a=r.b,i=r.transposeA,o=r.transposeB,s=r.backend,u=r.bias,c=u===void 0?null:u,l=r.preluActivationWeights,f=l===void 0?null:l,h=r.leakyreluAlpha,p=h===void 0?0:h,d=r.activation,m=d===void 0?null:d,v=n.shape.length,g=a.shape.length,y=i?n.shape[v-2]:n.shape[v-1],w=o?a.shape[g-1]:a.shape[g-2],b=i?n.shape[v-1]:n.shape[v-2],x=o?a.shape[g-2]:a.shape[g-1],S=n.shape.slice(0,-2),T=a.shape.slice(0,-2),E=k.util.sizeFromShape(S),C=k.util.sizeFromShape(T),R=k.broadcast_util.assertAndGetBroadcastShape(n.shape.slice(0,-2),a.shape.slice(0,-2)),_=R.concat([b,x]);k.util.assert(y===w,function(){return"Error in matMul: inner shapes (".concat(y,") and (")+"".concat(w,") of Tensors with shapes ").concat(n.shape," and ")+"".concat(a.shape," and transposeA=").concat(i)+" and transposeB=".concat(o," must match.")});var O=i?[E,y,b]:[E,b,y],$=o?[C,x,w]:[C,w,x],z=Ae({inputs:{x:n},backend:s,attrs:{shape:O}}),L=Ae({inputs:{x:a},backend:s,attrs:{shape:$}}),B=[z,L],W=Math.max(E,C),X=i?z.shape[1]:z.shape[2],J=c!=null,V=f!=null,j=m==="leakyrelu",ne=m!=null?vh(m,!0):null,re=J||V||j||ne!=null,oe;if((b===1||x===1)&&X>qW&&re===!1){var le=z,de=L;i&&(le=Sn({inputs:{x:z},backend:s,attrs:{perm:[0,2,1]}}),B.push(le)),o&&(de=Sn({inputs:{x:L},backend:s,attrs:{perm:[0,2,1]}}),B.push(de));var ke=x!==1,he=x===1,ye=le;ke&&(ye=Ae({inputs:{x:le},backend:s,attrs:{shape:[W,X,1]}}),B.push(ye));var xe=x===1?2:1,De=de;he&&(De=Ae({inputs:{x:de},backend:s,attrs:{shape:[W,1,X]}}),B.push(De));var Ye=Zx({inputs:{a:ye,b:De},backend:s});oe=ym({inputs:{x:Ye},backend:s,attrs:{axis:xe,keepDims:!0}}),B.push(Ye)}else{var ht=k.upcastType(n.dtype,a.dtype),at=new $W(O,$,[W,b,x],i,o,J,ne,V,j),nt=[z,L];if(c!=null&&nt.push(c),V&&nt.push(f),j){var ft=s.makeTensorInfo([],"float32",k.util.createScalarValue(p,"float32"));nt.push(ft),B.push(ft)}oe=s.runWebGLProgram(at,nt,ht)}var st=Ae({inputs:{x:oe},backend:s,attrs:{shape:_}});B.push(oe);try{for(var Ze=kn(B),tt=Ze.next();!tt.done;tt=Ze.next()){var et=tt.value;s.disposeIntermediateTensorInfo(et)}}catch(nr){e={error:nr}}finally{try{tt&&!tt.done&&(t=Ze.return)&&t.call(Ze)}finally{if(e)throw e.error}}return st}function dUe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.a,i=e.b,o=e.bias,s=e.preluActivationWeights,u=n.transposeA,c=n.transposeB,l=n.activation,f=n.leakyreluAlpha;return pm({a,b:i,transposeA:u,transposeB:c,backend:t,bias:o,preluActivationWeights:s,leakyreluAlpha:f,activation:l})}var vUe={kernelName:k._FusedMatMul,backendName:"webgl",kernelFunc:dUe};var wq="return abs(x);";function mUe(r){var e=r.inputs,t=r.backend,n=e.x;if(t.shouldExecuteOnCPU([n])&&n.dtype!=="complex64"){var a=t.texData.get(n.dataId),i=_W(a.values);return t.makeTensorInfo(n.shape,n.dtype,i)}var o;return k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new os(n.shape,wq):o=new qi(n.shape,wq),t.runWebGLProgram(o,[n],n.dtype)}var gUe={kernelName:k.Abs,backendName:"webgl",kernelFunc:mUe};var yUe=Ja+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,bUe=Nt({opSnippet:yUe}),wUe={kernelName:k.Acos,backendName:"webgl",kernelFunc:bUe};var xUe=Ja+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,kUe=Nt({opSnippet:xUe}),SUe={kernelName:k.Acosh,backendName:"webgl",kernelFunc:kUe};var xq="return a + b;",NUe=un({opSnippet:xq,packedOpSnippet:xq,supportsComplex:!0,cpuKernelImpl:FWe}),TUe={kernelName:k.Add,backendName:"webgl",kernelFunc:NUe};var EUe=function(){function r(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(function(i,o){return"T".concat(o)});var n=[];this.variableNames.forEach(function(i){n.push("float v".concat(i," = get").concat(i,"AtOutCoords();"))});var a=this.variableNames.map(function(i){return"v".concat(i)}).join(" + ");this.userCode=`
      void main() {
        `.concat(n.join(`
        `),`

        float result = `).concat(a,`;
        setOutput(result);
      }
    `)}return r}();var IUe=function(){function r(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(function(i,o){return"T".concat(o)});var n=[];this.variableNames.forEach(function(i){n.push("vec4 v".concat(i," = get").concat(i,"AtOutCoords();"))});var a=this.variableNames.map(function(i){return"v".concat(i)}).join(" + ");this.userCode=`
      void main() {
        `.concat(n.join(`
        `),`

        vec4 result = `).concat(a,`;
        setOutput(result);
      }
    `)}return r}();function hm(r){var e=r.inputs,t=r.backend,n=e;if(n.length===1)return ca({inputs:{x:n[0]},backend:t});if(n.length>k.env().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(n.length/2),i=hm({inputs:n.slice(0,a),backend:t}),o=hm({inputs:n.slice(a),backend:t});return hm({inputs:[i,o],backend:t})}var s=n.map(function(f){return f.dtype}).reduce(function(f,h){return k.upcastType(f,h)}),u=n.map(function(f){return f.shape}),c=k.env().getBool("WEBGL_PACK"),l=c?new IUe(n[0].shape,u):new EUe(n[0].shape,u);return t.runWebGLProgram(l,n,s)}var CUe={kernelName:k.AddN,backendName:"webgl",kernelFunc:hm};function AUe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=a;l!=null&&(f=Sn({inputs:{x:a},backend:t,attrs:{perm:l}}),c=k.backend_util.getInnerMostAxes(c.length,s)),k.backend_util.assertAxesAreInnerMostDims("all",c,s);var h=Te(k.backend_util.computeOutAndReduceShapes(f.shape,c),2),p=h[0],d=h[1],m=k.util.sizeFromShape(d),v=Ae({inputs:{x:f},backend:t,attrs:{shape:[-1,m]}}),g=Nu(v,v.dtype,"all",t),y;if(o){var w=k.backend_util.expandShapeToKeepDim(p,u);y=Ae({inputs:{x:g},backend:t,attrs:{shape:w}})}else y=Ae({inputs:{x:g},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(g),l!=null&&t.disposeIntermediateTensorInfo(f),y}var DUe={kernelName:k.All,backendName:"webgl",kernelFunc:AUe};function _Ue(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=a;l!=null&&(f=Sn({inputs:{x:a},backend:t,attrs:{perm:l}}),c=k.backend_util.getInnerMostAxes(c.length,s)),k.backend_util.assertAxesAreInnerMostDims("any",c,s);var h=Te(k.backend_util.computeOutAndReduceShapes(f.shape,c),2),p=h[0],d=h[1],m=k.util.sizeFromShape(d),v=Ae({inputs:{x:f},backend:t,attrs:{shape:[-1,m]}}),g=Nu(v,v.dtype,"any",t),y;if(o){var w=k.backend_util.expandShapeToKeepDim(p,u);y=Ae({inputs:{x:g},backend:t,attrs:{shape:w}})}else y=Ae({inputs:{x:g},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(g),l!=null&&t.disposeIntermediateTensorInfo(f),y}var FUe={kernelName:k.Any,backendName:"webgl",kernelFunc:_Ue};var RUe=function(){function r(e,t,n){this.variableNames=["A"];var a=e.windowSize,i=e.batchSize,o=e.outSize;n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s=t==="max"?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `.concat(a,`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `).concat(a,`; i++) {
          int inIdx = `).concat(u,`;
          float candidate = getA(batch, inIdx);
          if (candidate `).concat(s,` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `)}return r}();var OUe=function(){function r(e,t,n,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,k.util.assert(e.length>2,function(){return"Packed arg".concat(n.charAt(0).toUpperCase()+n.slice(1)," supports only inputs with rank above 2.")});var i=e[e.length-1],o=Math.ceil(i/t);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),a||this.variableNames.push("bestIndicesA");var s=this.outputShape,u=s.length,c=Lt(u),l=xn("coords",u),f,h;if(o===1){h=u+1;var p=Lt(h);f=`
        `.concat(p," sourceLocR = ").concat(p,"(").concat(l.join(),`, 0);
        ++`).concat(l[u-1],`;
        `).concat(p," sourceLocG = ").concat(p,"(").concat(l.join(),`, 0);
        ++`).concat(l[u-2],`;
        `).concat(p," sourceLocA = ").concat(p,"(").concat(l.join(),`, 0);
        --`).concat(l[u-1],`;
        `).concat(p," sourceLocB = ").concat(p,"(").concat(l.join(),`, 0);
        --`).concat(l[u-2],";")}else h=u,f=`
        `.concat(c,` sourceLocR = coords;
        ++`).concat(l[u-1],`;
        `).concat(c,` sourceLocG = coords;
        ++`).concat(l[u-2],`;
        `).concat(c,` sourceLocA = coords;
        --`).concat(l[u-1],`;
        `).concat(c,` sourceLocB = coords;
        --`).concat(l[u-2],";");var d=["x","y","z","w","u","v"].slice(0,h),m="."+d[h-1],v=d.map(function(C){return"int "+C}),g=xn("sourceLocR",h-1).concat("inIdx.r"),y=xn("sourceLocG",h-1).concat("inIdx.g"),w=xn("sourceLocB",h-1).concat("inIdx.b"),b=xn("sourceLocA",h-1).concat("inIdx.a"),x=n==="max"?"greaterThan":"lessThan",S=a?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`.concat(g.join(),`),
                             getBestIndicesAChannel(`).concat(y.join(),`),
                             getBestIndicesAChannel(`).concat(w.join(),`),
                             getBestIndicesAChannel(`).concat(b.join(),")));"),T=`vec4(
            getAChannel(`.concat(g.join(),`),
            hasNextCol ? getAChannel(`).concat(y.join(),`) : 0.,
            hasNextRow ? getAChannel(`).concat(w.join(),`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`).concat(b.join(),") : 0.)"),E=a?"":`
      float getBestIndicesAChannel(`.concat(v.join(),`) {
        return getChannel(getBestIndicesA(`).concat(d.join(),`),
                                          vec2(`).concat(d.slice(-2).join(),`));
      }`);this.userCode=`
      float getAChannel(`.concat(v.join(),`) {
        return getChannel(getA(`).concat(d.join(),`),
                               vec2(`).concat(d.slice(-2).join(),`));
      }
      `).concat(E,`
      void main() {
        `).concat(c,` coords = getOutputCoords();
        bool hasNextCol = `).concat(l[u-1]," < ").concat(s[u-1]-1,`;
        bool hasNextRow = `).concat(l[u-2]," < ").concat(s[u-2]-1,`;
        `).concat(f,`
        ivec4 srcIdx = ivec4(sourceLocR`).concat(m,", sourceLocG").concat(m,`,
          sourceLocB`).concat(m,", sourceLocA").concat(m,") * ").concat(t,`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `).concat(T,`;

        for (int i = 0; i < `).concat(t,`; i++) {
          inIdx = srcIdx;
          `).concat(S,`
          vec4 candidate = `).concat(T,`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`).concat(x,`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `)}return r}();function WW(r,e,t,n){n===void 0&&(n=null);var a=e.shape[0],i=e.shape[1];n!=null&&(a=n.shape[0],i=n.shape[1]);var o=k.backend_util.computeOptimalWindowSize(i),s={windowSize:o,inSize:i,batchSize:a,outSize:Math.ceil(i/o)},u=new RUe(s,t,n==null),c=[e];n!=null&&c.push(n);var l=r.runWebGLProgram(u,c,"int32");if(l.shape[1]===1)return l;var f=WW(r,e,t,l);return r.disposeIntermediateTensorInfo(l),f}function VW(r,e,t,n){n===void 0&&(n=null);var a=n!=null?n.shape:e.shape,i=a[a.length-1],o=k.backend_util.computeOptimalWindowSize(i),s=new OUe(a,o,t,n==null),u=n==null?[e]:[e,n],c=r.runWebGLProgram(s,u,"int32");if(c.shape.length===e.shape.length){var l=VW(r,e,t,c);return r.disposeIntermediateTensorInfo(c),l}return c}function UW(r,e,t,n){var a=[t];if(k.backend_util.assertAxesAreInnerMostDims("arg"+n.charAt(0).toUpperCase()+n.slice(1),a,e.shape.length),!k.env().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){var i=[],o=r.texData.get(e.dataId),s=o!==null&&o.isPacked,u=e;s&&(u=r.unpackTensor(e),i.push(u));var c=Te(k.backend_util.computeOutAndReduceShapes(u.shape,a),2),l=c[0],f=c[1],h=k.util.sizeFromShape(f),p=Ae({inputs:{x:u},backend:r,attrs:{shape:[-1,h]}});i.push(p);var d=WW(r,p,n);i.push(d);var m=Ae({inputs:{x:d},backend:r,attrs:{shape:l}});return i.forEach(function(v){return r.disposeIntermediateTensorInfo(v)}),m}return VW(r,e,n)}function PUe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=k.util.parseAxisParam(i,a.shape),s=k.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=Sn({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=k.backend_util.getInnerMostAxes(o.length,u.shape.length)),k.backend_util.assertAxesAreInnerMostDims("argMax",[o[0]],u.shape.length);var l=UW(t,u,o[0],"max");return c.forEach(function(f){return t.disposeIntermediateTensorInfo(f)}),l}var MUe={kernelName:k.ArgMax,backendName:"webgl",kernelFunc:PUe};function BUe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=k.util.parseAxisParam(i,a.shape),s=k.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=Sn({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=k.backend_util.getInnerMostAxes(o.length,u.shape.length)),k.backend_util.assertAxesAreInnerMostDims("argMin",[o[0]],u.shape.length);var l=UW(t,u,o[0],"min");return c.forEach(function(f){return t.disposeIntermediateTensorInfo(f)}),l}var LUe={kernelName:k.ArgMin,backendName:"webgl",kernelFunc:BUe};var zUe=Ja+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,$Ue=Nt({opSnippet:zUe}),qUe={kernelName:k.Asin,backendName:"webgl",kernelFunc:$Ue};var WUe=Ja+"return log(x + sqrt(x * x + 1.0));",VUe=Nt({opSnippet:WUe}),UUe={kernelName:k.Asinh,backendName:"webgl",kernelFunc:VUe};var GUe=Ja+`
  return atan(x);
`,HUe=Nt({opSnippet:GUe}),KUe={kernelName:k.Atan,backendName:"webgl",kernelFunc:HUe};var jUe=Yx+`
  return atan(a, b);
`,XUe=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Su+`
  return result;
`,YUe=un({opSnippet:jUe,packedOpSnippet:XUe}),ZUe={kernelName:k.Atan2,backendName:"webgl",kernelFunc:YUe};var JUe=Ja+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,QUe=Nt({opSnippet:JUe}),eGe={kernelName:k.Atanh,backendName:"webgl",kernelFunc:QUe};var mh=function(){function r(e,t,n,a,i){if(a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var o=e.filterWidth,s=e.strideHeight,u=e.strideWidth,c=e.dilationHeight,l=e.dilationWidth,f=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=e.padInfo.top,d=e.padInfo.left;this.outputShape=e.outShape;var m=t==="avg",v="((batch  * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + d"),g="(xR * ".concat(e.inWidth," + xC) * ").concat(e.inChannels," + d"),y="0.0";if(m||(y="-1.0 / 1e-20"),n){var w=">=";this.userCode=`
        const ivec2 strides = ivec2(`.concat(s,", ").concat(u,`);
        const ivec2 pads = ivec2(`).concat(p,", ").concat(d,`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `).concat(f,`;
              wR += `).concat(c,`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int wC = 0; wC < `).concat(h,`;
                wC += `).concat(l,`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value `).concat(w,` currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = `).concat(a?i?v:g:"wR * ".concat(h," + wC"),`;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `);return}var b="max",x="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(x="avgValue / max(count, 1.0)");var S=Math.floor(o/4)*4,T=o%4,E=`
      if (`.concat(m,`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = `).concat(b,`(values, minMaxValue);
      }
    `);this.userCode=`
      const ivec2 strides = ivec2(`.concat(s,", ").concat(u,`);
      const ivec2 pads = ivec2(`).concat(p,", ").concat(d,`);
      const float initializationValue = `).concat(y,`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `).concat(e.inWidth,`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`).concat(y,`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `).concat(f,`;
            wR += `).concat(c,`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `).concat(e.inHeight,`) {
            continue;
          }

          for (int wC = 0; wC < `).concat(S,`; wC += 4) {
            int xC = xCCorner + wC * `).concat(l,`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `).concat(l,`, d),
              getValue(batch, xR, xC + 2 * `).concat(l,`, d),
              getValue(batch, xR, xC + 3 * `).concat(l,`, d)
            );

            `).concat(E,`
          }

          int xC = xCCorner + `).concat(S,`;
          if (`).concat(T===1,`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `).concat(E,`
          } else if (`).concat(T===2,`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `).concat(l,`, d),
              initializationValue,
              initializationValue
            );

            `).concat(E,`
          } else if (`).concat(T===3,`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `).concat(l,`, d),
              getValue(batch, xR, xC + 2 * `).concat(l,`, d),
              initializationValue
            );

            `).concat(E,`
          }
        }
        setOutput(`).concat(x,`);
      }
    `)}return r}(),Jx=function(){function r(e,t,n,a,i){if(a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x"],t==="avg"&&n)throw new Error("Cannot compute positions for average pool.");var o=e.filterWidth,s=e.strideDepth,u=e.strideHeight,c=e.strideWidth,l=e.dilationDepth,f=e.dilationHeight,h=e.dilationWidth,p=e.effectiveFilterDepth,d=e.effectiveFilterHeight,m=e.effectiveFilterWidth,v=e.padInfo.front,g=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;var w=t==="avg",b="0.0";if(w||(b="-1.0 / 1e-20"),n){var x=">=";this.userCode=`
        const ivec3 strides =
            ivec3(`.concat(s,", ").concat(u,", ").concat(c,`);
        const ivec3 pads = ivec3(`).concat(v,", ").concat(g,", ").concat(y,`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `).concat(p,`;
              wD += `).concat(l,`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `).concat(e.inDepth,`) {
              continue;
            }

            for (int wR = 0; wR < `).concat(d,`;
                wR += `).concat(f,`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `).concat(e.inHeight,`) {
                continue;
              }

              for (int wC = 0; wC < `).concat(m,`;
                  wC += `).concat(h,`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value `).concat(x,` currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = `).concat(a?i?"(((batch * ".concat(e.inDepth," + xD) * ").concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"((xD * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"wD * ".concat(d," * ").concat(m,` +
                      wR * `).concat(m," + wC"),`;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `);return}var S="max",T="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(T="avgValue / max(count, 1.0)");var E=Math.floor(o/4)*4,C=o%4,R=`
      if (`.concat(w,`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = `).concat(S,`(values, minMaxValue);
      }
    `);this.userCode=`
      const ivec3 strides =
        ivec3(`.concat(s,", ").concat(u,", ").concat(c,`);
      const ivec3 pads = ivec3(`).concat(v,", ").concat(g,", ").concat(y,`);
      const float initializationValue = `).concat(b,`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `).concat(e.inWidth,`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`).concat(b,`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `).concat(p,`;
            wD += `).concat(l,`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `).concat(e.inDepth,`) {
            continue;
          }

          for (int wR = 0; wR < `).concat(d,`;
            wR += `).concat(f,`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int wC = 0; wC < `).concat(E,`; wC += 4) {
              int xC = xCCorner + wC * `).concat(h,`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `).concat(h,`, ch),
                getValue(batch, xD, xR, xC + 2 * `).concat(h,`, ch),
                getValue(batch, xD, xR, xC + 3 * `).concat(h,`, ch)
              );

              `).concat(R,`
            }

            int xC = xCCorner + `).concat(E,`;
            if (`).concat(C===1,`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `).concat(R,`
            } else if (`).concat(C===2,`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `).concat(h,`, ch),
                initializationValue,
                initializationValue
              );

              `).concat(R,`
            } else if (`).concat(C===3,`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `).concat(h,`, ch),
                getValue(batch, xD, xR, xC + 2 * `).concat(h,`, ch),
                initializationValue
              );

              `).concat(R,`
            }
          }
        }
        setOutput(`).concat(T,`);
      }
    `)}return r}();function tGe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;Uc(a,"avgPool");var i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=1;k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=k.backend_util.computePool2DInfo(a.shape,i,o,c,s,u);if(l.filterWidth===1&&l.filterHeight===1&&k.util.arraysEqual(l.inShape,l.outShape))return ca({inputs:{x:a},backend:t});var f=new mh(l,"avg",!1);return t.runWebGLProgram(f,[a],"float32")}var rGe={kernelName:k.AvgPool,backendName:"webgl",kernelFunc:tGe};function nGe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=n.dataFormat,l=[1,1,1],f=k.backend_util.computePool3DInfo(a.shape,i,o,l,s,u,c),h=new Jx(f,"avg",!1);return t.runWebGLProgram(h,[a],"float32")}var aGe={kernelName:k.AvgPool3D,backendName:"webgl",kernelFunc:nGe};var iGe=function(){function r(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=u-1-e.padInfo.top,f=c-1-e.padInfo.left,h=1/(t*n);this.userCode=`
      const ivec2 pads = ivec2(`.concat(l,", ").concat(f,`);
      const float avgMultiplier = float(`).concat(h,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(u,`;
            wR += `).concat(o,`) {
          float dyR = float(dyRCorner + wR) / `).concat(a,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `).concat(c,`;
            wC+= `).concat(s,`) {
            float dyC = float(dyCCorner + wC) / `).concat(i,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `)}return r}(),oGe=function(){function r(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,a=e.filterWidth,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=e.dilationDepth,c=e.dilationHeight,l=e.dilationWidth,f=e.effectiveFilterDepth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,d=f-1-e.padInfo.front,m=h-1-e.padInfo.top,v=p-1-e.padInfo.left,g=1/(t*n*a);this.userCode=`
      const ivec3 pads = ivec3(`.concat(d,", ").concat(m,", ").concat(v,`);
      const float avgMultiplier = float(`).concat(g,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `).concat(f,`;
            wD += `).concat(u,`) {
          float dyD = float(dyDCorner + wD) / `).concat(i,`.0;

          if (dyD < 0.0 || dyD >= `).concat(e.outDepth,`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `).concat(h,`;
              wR += `).concat(c,`) {
            float dyR = float(dyRCorner + wR) / `).concat(o,`.0;

            if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `).concat(p,`;
                wC += `).concat(l,`) {
              float dyC = float(dyCCorner + wC) / `).concat(s,`.0;

              if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}();function sGe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=i,s=n.filterSize,u=n.strides,c=n.pad,l=n.dimRoundingMode,f=[1,1,1],h=k.backend_util.computePool3DInfo(o.shape,s,u,f,c,l),p=new oGe(h);return t.runWebGLProgram(p,[a],o.dtype)}var uGe={kernelName:k.AvgPool3DGrad,backendName:"webgl",kernelFunc:sGe};function cGe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=i;Uc([a,i],"avgPoolGrad");var s=n.filterSize,u=n.strides,c=n.pad,l=k.backend_util.computePool2DInfo(o.shape,s,u,1,c),f=new iGe(l);return t.runWebGLProgram(f,[a],o.dtype)}var lGe={kernelName:k.AvgPoolGrad,backendName:"webgl",kernelFunc:cGe};function fGe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.a,i=e.b,o=n.transposeA,s=n.transposeB;return pm({a,b:i,transposeA:o,transposeB:s,backend:t})}var hGe={kernelName:k.BatchMatMul,backendName:"webgl",kernelFunc:fGe};var pGe=function(){function r(e,t,n,a,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],k.backend_util.assertAndGetBroadcastShape(e,t),k.backend_util.assertAndGetBroadcastShape(e,n);var s="0.0";a!=null&&(k.backend_util.assertAndGetBroadcastShape(e,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";i!=null&&(k.backend_util.assertAndGetBroadcastShape(e,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `.concat(s,`;
        float scale = `).concat(u,`;
        float inv = scale * inversesqrt(variance + float(`).concat(o,`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `)}return r}();var dGe=function(){function r(e,t,n,a,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],k.backend_util.assertAndGetBroadcastShape(e,t),k.backend_util.assertAndGetBroadcastShape(e,n);var s="vec4(0.0)";a!=null&&(k.backend_util.assertAndGetBroadcastShape(e,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";i!=null&&(k.backend_util.assertAndGetBroadcastShape(e,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = `.concat(s,`;
        vec4 scale = `).concat(u,`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`).concat(o,`));

        setOutput((x - mean) * inv + offset);
      }
    `)}return r}();var vGe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.mean,o=e.variance,s=e.offset,u=e.scale;k.util.assert(i.shape.length===o.shape.length,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),k.util.assert(s==null||i.shape.length===s.shape.length,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),k.util.assert(u==null||i.shape.length===u.shape.length,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var c=n.varianceEpsilon;c==null&&(c=.001);var l=[a,i,o],f=null;s!=null&&(f=s.shape,l.push(s));var h=null;u!=null&&(h=u.shape,l.push(u));var p=k.env().getBool("WEBGL_PACK_NORMALIZATION")?new dGe(a.shape,i.shape,o.shape,f,h,c):new pGe(a.shape,i.shape,o.shape,f,h,c),d=t.runWebGLProgram(p,l,l[0].dtype);return d},mGe={kernelName:k.FusedBatchNorm,backendName:"webgl",kernelFunc:vGe};var gGe=function(){function r(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t=Lt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var n=yGe(this.rank),a,i=e.map(function(o,s){return"sourceLoc.".concat(Px[s]," = start[").concat(s,"] + coords.").concat(Px[s],";")});a=`
        `.concat(t,` sourceLoc;
        `).concat(t,` coords = getOutputCoords();
        `).concat(i.join(`
`),`
      `),this.userCode=`
      void main() {
        `.concat(a,`
        setOutput(getSource(`).concat(n,`));
      }
    `)}return r}(),Px=["x","y","z","w","u","v"];function yGe(r){if(r===1)return"sourceLoc";if(r<=6)return Px.slice(0,r).map(function(e){return"sourceLoc."+e}).join(",");throw Error("Slicing for rank ".concat(r," is not yet supported"))}var bGe=function(){function r(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var t=Lt(this.rank),n=xn("coords",this.rank),a=xn("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s=`
      result.x = `.concat(o,`;
      if (++`).concat(n[this.rank-1]," < ").concat(e[this.rank-1],`) {
        ++`).concat(a[this.rank-1],`;
        result.y = `).concat(o,`;
        --`).concat(a[this.rank-1],`;
      }
    `),u=this.rank===1?"":`
      --`.concat(n[this.rank-1],`;
      if (++`).concat(n[this.rank-2]," < ").concat(e[this.rank-2],`) {
        ++`).concat(a[this.rank-2],`;
        result.z = `).concat(o,`;
        if (++`).concat(n[this.rank-1]," < ").concat(e[this.rank-1],`) {
          ++`).concat(a[this.rank-1],`;
          result.w = `).concat(o,`;
        }
      }
    `),c=this.rank<=4?`sourceLoc = coords +
            `.concat(t,"(").concat(e.map(function(l,f){return"start[".concat(f,"]")}).join(),");"):e.map(function(l,f){return"".concat(a[f]," = ").concat(n[f]," + start[").concat(f,"];")}).join(`
`);this.userCode=`
      void main() {
        `.concat(t,` coords = getOutputCoords();
        `).concat(t,` sourceLoc;
        `).concat(c,`
        vec4 result = vec4(0.);
        `).concat(s,`
        `).concat(u,`
        setOutput(result);
      }
    `)}return r}();function wGe(r,e,t,n){var a=n.texData.get(r.dataId),i=n.makeTensorInfo(t,r.dtype),o=n.texData.get(i.dataId);Object.assign(o,a),o.refCount=1,o.shape=t,o.dtype=r.dtype;var s=k.slice_util.computeFlatOffset(e,k.util.computeStrides(r.shape));a.slice&&(s+=a.slice.flatOffset),o.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||r.dataId};var u=n.dataRefCount.get(o.slice.origDataId)||1;return n.dataRefCount.set(o.slice.origDataId,u+1),i}function Zc(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.begin,o=n.size,s=Te(k.slice_util.parseSliceParams(a,i,o),2),u=s[0],c=s[1];if(k.slice_util.assertParamsValid(a,u,c),k.util.sizeFromShape(c)===0)return t.makeTensorInfo(c,a.dtype,[]);if(t.shouldExecuteOnCPU([a])||a.dtype==="string"){var l=t.texData.get(a.dataId),f=lVe(l.values,u,c,a.shape,a.dtype);return t.makeTensorInfo(c,a.dtype,f)}var h=t.texData.get(a.dataId).isPacked,p=k.slice_util.isSliceContinous(a.shape,u,c);if(h||!p){var d=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new bGe(c):new gGe(c),m=[u];return t.runWebGLProgram(d,[a],a.dtype,m)}return t.uploadToGPU(a.dataId),wGe(a,u,c,t)}var xGe={kernelName:k.Slice,backendName:"webgl",kernelFunc:Zc};var kGe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockShape,o=n.crops;k.util.assert(a.shape.length<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var s=i.reduce(function(y,w){return y*w}),u=k.backend_util.getReshaped(a.shape,i,s),c=k.backend_util.getPermuted(u.length,i.length),l=k.backend_util.getReshapedPermuted(a.shape,i,s),f=k.backend_util.getSliceBeginCoords(o,i.length),h=k.backend_util.getSliceSize(l,o,i.length),p=[],d=Ae({inputs:{x:a},backend:t,attrs:{shape:u}}),m=Sn({inputs:{x:d},backend:t,attrs:{perm:c}}),v=Ae({inputs:{x:m},backend:t,attrs:{shape:l}}),g=Zc({inputs:{x:v},backend:t,attrs:{begin:f,size:h}});return p.push(d),p.push(m),p.push(v),p.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),g},SGe={kernelName:k.BatchToSpaceND,backendName:"webgl",kernelFunc:kGe};function NGe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.weights,o=n.size,s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=DW(s,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,c)}var TGe={kernelName:k.Bincount,backendName:"webgl",kernelFunc:NGe},EGe=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,IGe=`
  return float(int(a.r) & int(b.r));
`;function CGe(r){var e=r.inputs,t=r.backend,n=e.a,a=e.b,i=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS"),o=k.env().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([n,a])||o===1){var s=t.texData.get(n.dataId).values,u=t.texData.get(a.dataId).values,c=Te(OWe(n.shape,a.shape,s,u,n.dtype),2),l=c[0],f=c[1],h=t.makeTensorInfo(f,n.dtype),p=t.texData.get(h.dataId);return p.values=l,h}var d;return i?d=new Xc(EGe,n.shape,a.shape,!1):d=new wu(IGe,n.shape,a.shape),t.runWebGLProgram(d,[n,a],n.dtype)}var AGe={kernelName:k.BitwiseAnd,backendName:"webgl",kernelFunc:CGe};function DGe(r){var e=r.inputs,t=r.backend,n=e.s0,a=e.s1,i=t.readSync(n.dataId),o=t.readSync(a.dataId),s=k.backend_util.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return t.makeTensorInfo([s.length],"int32",Int32Array.from(s))}var _Ge={kernelName:k.BroadcastArgs,backendName:"webgl",kernelFunc:DGe};var FGe="return float(a != b);",GW=un({opSnippet:FGe,cpuKernelImpl:tVe,dtype:"bool"}),RGe={kernelName:k.NotEqual,backendName:"webgl",kernelFunc:GW};function wh(r){var e=r.inputs,t=r.backend,n=e.input,a=t.texData.get(n.dataId);return ca({inputs:{x:a.complexTensorInfos.real},backend:t})}var OGe={kernelName:k.Real,backendName:"webgl",kernelFunc:wh};var PGe="return float(int(x));";function MGe(r,e){var t=new qi(r.shape,PGe),n=e.runWebGLProgram(t,[r],"int32");return{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}function Mx(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.dtype;if(i==="complex64"){if(a.dtype==="complex64")return ca({inputs:{x:a},backend:t});var o=g$e.zeros(a.shape),s=Mx({inputs:{x:a},backend:t,attrs:{dtype:"float32"}}),u=ss({inputs:{real:s,imag:o},backend:t});return o.dispose(),t.disposeIntermediateTensorInfo(s),u}if(a.dtype==="complex64"){var c=wh({inputs:{input:a},backend:t}),u=Mx({inputs:{x:c},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(c),u}if(!k.util.hasEncodingLoss(a.dtype,i)){var u=ca({inputs:{x:a},backend:t});return{dataId:u.dataId,shape:u.shape,dtype:i}}if(t.shouldExecuteOnCPU([a])){var l=t.texData.get(a.dataId).values,f=Te(PWe(l,a.shape,a.dtype,i),3),h=f[0],p=f[1],d=f[2];return t.makeTensorInfo(h,p,d)}if(i==="int32")return MGe(a,t);if(i==="bool"){var m=t.makeTensorInfo([],"bool",k.util.getTypedArrayFromDType("bool",1)),v={a,b:m},u=GW({inputs:v,backend:t});return t.disposeIntermediateTensorInfo(m),u}throw new Error("Error in Cast: failed to cast ".concat(a.dtype," to ").concat(i))}var BGe={kernelName:k.Cast,backendName:"webgl",kernelFunc:Mx};var kq="return ceil(x);",LGe=Nt({opSnippet:kq,packedOpSnippet:kq,cpuKernelImpl:MWe}),zGe={kernelName:k.Ceil,backendName:"webgl",kernelFunc:LGe};var $Ge=function(){function r(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return r}();var qGe=function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return r}();function WGe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.clipValueMin,o=n.clipValueMax,s;k.env().getBool("WEBGL_PACK_CLIP")?s=new qGe(a.shape):s=new $Ge(a.shape);var u=[[i],[o]];return t.runWebGLProgram(s,[a],a.dtype,u)}var VGe={kernelName:k.ClipByValue,backendName:"webgl",kernelFunc:WGe};var UGe=function(){function r(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}return r}();function Sq(r,e){return{dataId:e.dataId,dtype:e.dtype,shape:r.shape}}function GGe(r){var e=r.inputs,t=r.backend,n=e.x,a=t.texData.get(n.dataId),i=new UGe(n.shape),o=[Sq(n,a.complexTensorInfos.real),Sq(n,a.complexTensorInfos.imag)];return t.runWebGLProgram(i,o,o[0].dtype)}var HGe={kernelName:k.ComplexAbs,backendName:"webgl",kernelFunc:GGe};var KGe=function(){function r(e){this.outputShape=[],this.outputShape=k.backend_util.computeOutShape(e,1),this.variableNames=e.map(function(u,c){return"T".concat(c)});var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];for(var a=["if (yC < ".concat(t[0],") setOutput(getT0(yR, yC));")],n=1;n<t.length;n++){var i=t[n-1];a.push("else if (yC < ".concat(t[n],") ")+"setOutput(getT".concat(n,"(yR, yC-").concat(i,"));"))}var o=t.length,s=t[t.length-1];a.push("else setOutput(getT".concat(o,"(yR, yC-").concat(s,"));")),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `.concat(a.join(`
        `),`
      }
    `)}return r}();var jGe=function(){function r(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=k.backend_util.computeOutShape(e,t);var n=this.outputShape,a=n.length,i=Lt(a),o=xn("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=e.map(function(g,y){return"T".concat(y)});var u=new Array(e.length-1);u[0]=e[0][t];for(var c=1;c<u.length;c++)u[c]=u[c-1]+e[c][t];for(var l=s[t],f=s.slice(-2),h=s.join(),p="if (".concat(l," < ").concat(u[0],`) {
        return getChannel(
            getT0(`).concat(h,"), vec2(").concat(f.join(),`));
        }`),c=1;c<u.length;c++){var d=u[c-1];p+=`
        if (`.concat(l," < ").concat(u[c],"  && ").concat(l," >= ").concat(u[c-1],`) {
          return getChannel(
            getT`).concat(c,"(").concat(om(s,l,d),`),
            vec2(`).concat(om(f,l,d),`));
        }`)}var m=u.length,v=u[u.length-1];p+=`
        return getChannel(
          getT`.concat(m,"(").concat(om(s,l,v),`),
          vec2(`).concat(om(f,l,v),"));"),this.userCode=`
      float getValue(`.concat(s.map(function(g){return"int "+g}),`) {
        `).concat(p,`
      }

      void main() {
        `).concat(i,` coords = getOutputCoords();
        vec4 result = vec4(getValue(`).concat(o,`), 0., 0., 0.);

        `).concat(o[a-1]," = ").concat(o[a-1],` + 1;
        if (`).concat(o[a-1]," < ").concat(n[a-1],`) {
          result.g = getValue(`).concat(o,`);
        }

        `).concat(o[a-2]," = ").concat(o[a-2],` + 1;
        if (`).concat(o[a-2]," < ").concat(n[a-2],`) {
          result.a = getValue(`).concat(o,`);
        }

        `).concat(o[a-1]," = ").concat(o[a-1],` - 1;
        if (`).concat(o[a-2]," < ").concat(n[a-2],` &&
            `).concat(o[a-1]," < ").concat(n[a-1],`) {
          result.b = getValue(`).concat(o,`);
        }
        setOutput(result);
      }
    `)}return r}();function om(r,e,t){var n=r.indexOf(e),a=r.map(function(i,o){return o===n?"".concat(i," - ").concat(t):i});return a.join()}function bm(r){var e=r.inputs,t=r.backend,n=e.input,a=t.texData.get(n.dataId);return ca({inputs:{x:a.complexTensorInfos.imag},backend:t})}var XGe={kernelName:k.Imag,backendName:"webgl",kernelFunc:bm};function hh(r,e,t){var n,a,i=r[0].dtype;if(i==="complex64"){var o=r.map(function(V){return wh({inputs:{input:V},backend:t})}),s=r.map(function(V){return bm({inputs:{input:V},backend:t})}),u=hh(o,e,t),c=hh(s,e,t),l=ss({inputs:{real:u,imag:c},backend:t});return o.forEach(function(V){return t.disposeIntermediateTensorInfo(V)}),s.forEach(function(V){return t.disposeIntermediateTensorInfo(V)}),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(c),l}var f=t.shouldExecuteOnCPU(r);if(i==="string"&&(f=!0),f){var h=r.map(function(V){var j=k.util.sizeFromShape(V.shape.slice(e)),ne=[-1,j];return Ae({inputs:{x:V},backend:t,attrs:{shape:ne}})}),p=h.map(function(V){return{vals:t.readSync(V.dataId),shape:V.shape}}),d=k.backend_util.computeOutShape(h.map(function(V){return V.shape}),1),m=h[0].shape[0]===1,v=BWe(p,d,i,m),g=k.backend_util.computeOutShape(r.map(function(V){return V.shape}),e),y=t.makeTensorInfo(g,i,v);return h.forEach(function(V){return t.disposeIntermediateTensorInfo(V)}),y}var w=r.filter(function(V){return k.util.sizeFromShape(V.shape)>0}),b=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&w[0].shape.length>1;if(w.length===1){var x=b?new qi(r[0].shape,is):new os(r[0].shape,is);return t.runWebGLProgram(x,r,i)}var S=k.env().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(w.length>S){for(var T=[],E=0;E<w.length;E+=S){var C=w.slice(E,E+S);T.push(hh(C,e,t))}var R=hh(T,e,t);try{for(var _=kn(T),O=_.next();!O.done;O=_.next()){var E=O.value;t.disposeIntermediateTensorInfo(E)}}catch(V){n={error:V}}finally{try{O&&!O.done&&(a=_.return)&&a.call(_)}finally{if(n)throw n.error}}return R}if(b){var $=new jGe(w.map(function(V){return V.shape}),e);return t.runWebGLProgram($,w,i)}var z=YGe(w,e,t),L=z.tensors2D,B=z.outShape,W=new KGe(L.map(function(V){return V.shape})),X=t.runWebGLProgram(W,L,i);L.forEach(function(V){return t.disposeIntermediateTensorInfo(V)});var J=Ae({inputs:{x:X},attrs:{shape:B},backend:t});return t.disposeIntermediateTensorInfo(X),J}function YGe(r,e,t){var n=k.backend_util.computeOutShape(r.map(function(i){return i.shape}),e),a=r.map(function(i){return Ae({inputs:{x:i},attrs:{shape:[-1,k.util.sizeFromShape(i.shape.slice(e))]},backend:t})});return{tensors2D:a,outShape:n}}function HW(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.axis,i=k.util.parseAxisParam(a,e[0].shape)[0],o=e.map(function(c){return c.shape});k.backend_util.assertParamsConsistent(o,i);var s=k.backend_util.computeOutShape(e.map(function(c){return c.shape}),i);if(k.util.sizeFromShape(s)===0)return t.makeTensorInfo(s,e[0].dtype,[]);var u=e.filter(function(c){return k.util.sizeFromShape(c.shape)>0});return u.length===1?ca({inputs:{x:u[0]},backend:t}):hh(u,i,t)}var ZGe={kernelName:k.Concat,backendName:"webgl",kernelFunc:HW};var KW=function(){function r(e,t,n,a,i){t===void 0&&(t=!1),n===void 0&&(n=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,f=e.dilationWidth,h=e.filterHeight,p=e.filterWidth,d=Math.floor(e.inChannels/4)*4,m=e.inChannels%4,v=e.dataFormat==="channelsLast",g=v?1:2,y=v?2:3,w=v?3:1,b="",x="";n&&(a?b=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `.concat(n,`
        }`):i?b=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          `.concat(n,`
        }`):b=`
          float activation(float x) {
            `.concat(n,`
          }
        `),x="result = activation(result);");var S=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `.concat(b,`

      const ivec2 strides = ivec2(`).concat(u,", ").concat(c,`);
      const ivec2 pads = ivec2(`).concat(o,", ").concat(s,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`).concat(w,`];

        ivec2 xRCCorner =
            ivec2(coords[`).concat(g,"], coords[").concat(y,`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(h,`; wR++) {
          int xR = xRCorner + wR * `).concat(l,`;

          if (xR < 0 || xR >= `).concat(e.inHeight,`) {
            continue;
          }

          for (int wC = 0; wC < `).concat(p,`; wC++) {
            int xC = xCCorner + wC * `).concat(f,`;

            if (xC < 0 || xC >= `).concat(e.inWidth,`) {
              continue;
            }

            for (int d1 = 0; d1 < `).concat(d,`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`).concat(v,`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`).concat(m===1,`) {

              if (`).concat(v,`) {
                dotProd +=
                    getX(batch, xR, xC, `).concat(d,`) *
                    getW(wR, wC, `).concat(d,`, d2);
              } else {
                dotProd +=
                    getX(batch, `).concat(d,`, xR, xC) *
                    getW(wR, wC, `).concat(d,`, d2);
              }

            } else if (`).concat(m===2,`) {
              vec2 wValues = vec2(
                getW(wR, wC, `).concat(d,`, d2),
                getW(wR, wC, `).concat(d,` + 1, d2)
              );

              if (`).concat(v,`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `).concat(d,`),
                  getX(batch, xR, xC, `).concat(d,` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `).concat(d,`, xR, xC),
                  getX(batch, `).concat(d,` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`).concat(m===3,`) {
              vec3 wValues = vec3(
                getW(wR, wC, `).concat(d,`, d2),
                getW(wR, wC, `).concat(d,` + 1, d2),
                getW(wR, wC, `).concat(d,` + 2, d2)
              );

              if (`).concat(v,`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `).concat(d,`),
                  getX(batch, xR, xC, `).concat(d,` + 1),
                  getX(batch, xR, xC, `).concat(d,` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `).concat(d,`, xR, xC),
                  getX(batch, `).concat(d,` + 1, xR, xC),
                  getX(batch, `).concat(d,` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `).concat(S,`
        `).concat(x,`
        setOutput(result);
      }
    `)}return r}(),JGe=function(){function r(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,a=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=e.dilationDepth,c=e.dilationHeight,l=e.dilationWidth,f=e.filterDepth,h=e.filterHeight,p=e.filterWidth,d=Math.floor(e.inChannels/4)*4,m=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`.concat(i,", ").concat(o,", ").concat(s,`);
      const ivec3 pads = ivec3(`).concat(t,", ").concat(n,", ").concat(a,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `).concat(f,`; wF++) {
          int xF = xFCorner + wF * `).concat(u,`;

          if (xF < 0 || xF >= `).concat(e.inDepth,`) {
            continue;
          }

          for (int wR = 0; wR < `).concat(h,`; wR++) {
            int xR = xRCorner + wR * `).concat(c,`;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int wC = 0; wC < `).concat(p,`; wC++) {
              int xC = xCCorner + wC * `).concat(l,`;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              for (int d1 = 0; d1 < `).concat(d,`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`).concat(m===1,`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `).concat(d,`) *
                  getW(wF, wR, wC, `).concat(d,`, d2);
              } else if (`).concat(m===2,`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `).concat(d,`),
                  getX(batch, xF, xR, xC, `).concat(d,` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `).concat(d,`, d2),
                  getW(wF, wR, wC, `).concat(d,` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`).concat(m===3,`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `).concat(d,`),
                  getX(batch, xF, xR, xC, `).concat(d,` + 1),
                  getX(batch, xF, xR, xC, `).concat(d,` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `).concat(d,`, d2),
                  getW(wF, wR, wC, `).concat(d,` + 1, d2),
                  getW(wF, wR, wC, `).concat(d,` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}();var jW=function(){function r(e,t,n,a,i){t===void 0&&(t=!1),n===void 0&&(n=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=pn(this.outputShape.length);for(var o=e.padInfo.left,s=e.strideWidth,u=e.dilationWidth,c=e.filterHeight,l=e.filterWidth,f=l,h=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`,p=0;p<l;p++)h+=`
           vec4 xTexelC`.concat(p*2,`;
           int xTexelC`).concat(p*2,`Ready;
           vec4 xTexelC`).concat(p*2+1,`;
           int xTexelC`).concat(p*2+1,`Ready;
           vec4 xC`).concat(p,";");h+=`
     for (int r = 0; r < `.concat(c,`; r++) {
      for (int d1 = 0; d1 < `).concat(e.inChannels,`; d1 += 2) {
       `);for(var p=0;p<l;p++)h+=`
           xTexelC`.concat(p*2,` = vec4(0.0);
           xTexelC`).concat(p*2,`Ready = 0;
           xTexelC`).concat(p*2+1,` = vec4(0.0);
           xTexelC`).concat(p*2+1,`Ready = 0;
           xC`).concat(p," = vec4(0.0);");h+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(var d=0;d<(f+1)/2;d++){var m=d*2;if(h+=`
           xC = xCCorner + `.concat(m*u,`;
           `),s===1){if(m<l&&(o%2===1?(h+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                   xTexelC`).concat(m,` = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`).concat(m,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(m,`Ready = 1;
                 }
               `),u===1&&m>0?h+=`
                 xC`.concat(m," = vec4(xTexelC").concat(m-2,".zw, xTexelC").concat(m,`.xy);
                 `):h+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC`.concat(m," = vec4(previous.zw, xTexelC").concat(m,`.xy);
                   } else {
                     xC`).concat(m," = vec4(0.0, 0.0, xTexelC").concat(m,`.xy);
                   }
                   `)):h+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                   xTexelC`).concat(m,` = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC`).concat(m,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(m,`Ready = 1;
                 }

                 xC`).concat(m," = xTexelC").concat(m,`;
                 `),m+1<l)){var v=o%2===0?k.util.nearestLargerEven(u):u;u%2===0&&o%2===1||u%2!==0&&o%2!==1?(h+=`
                   xCOffset = xC + imod(pads[1], 2) + `.concat(v,`;

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                     xTexelC`).concat(m+1,` = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC`).concat(m+1,`.zw = vec2(0.0);
                     }
                     xTexelC`).concat(m+1,`Ready = 1;
                   }
                   `),u>1?h+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC`.concat(m+1," = vec4(previous.zw, xTexelC").concat(m+1,`.xy);
                     } else {
                      xC`).concat(m+1," = vec4(0.0, 0.0, xTexelC").concat(m+1,`.xy);
                     }
                     `):h+=`
                     xC`.concat(m+1," = vec4(xTexelC").concat(m,".zw, xTexelC").concat(m+1,`.xy);
                     `)):v===1?h+=`
                     xC`.concat(m+1," = xTexelC").concat(m,`;
                     `):h+=`
                     xCOffset = xC + `.concat(v,`;

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                       xTexelC`).concat(m+1,` = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC`).concat(m+1,`.zw = vec2(0.0);
                       }
                       xTexelC`).concat(m+1,`Ready = 1;
                     }

                     xC`).concat(m+1," = xTexelC").concat(m+1,`;
                     `)}}else m<l&&(o%2===1?(h+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                   xTexelC`).concat(m,` = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`).concat(m,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(m,`Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                   xTexelC`).concat(m+1,` = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC`).concat(m+1,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(m+1,`Ready = 1;
                 }

                 xC`).concat(m," = vec4(xTexelC").concat(m,".zw, xTexelC").concat(m+1,`.zw);
               `),m+1<l&&(h+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC`.concat(m+1," = vec4(xTexelC").concat(m+1,`.xy, final.xy);
                 `))):(h+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                   xTexelC`).concat(m,` = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC`).concat(m,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(m,`Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                   xTexelC`).concat(m+1,` = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`).concat(m+1,`.zw = vec2(0.);
                   }
                   xTexelC`).concat(m+1,`Ready = 1;
                 }

                 xC`).concat(m,` = vec4(
                   xTexelC`).concat(m,".xy, xTexelC").concat(m+1,`.xy);
               `),m+1<l&&(h+=`
                   xC`.concat(m+1," = vec4(xTexelC").concat(m,".zw, xTexelC").concat(m+1,`.zw);
                 `))));m<l&&(h+=`
             wTexel = getW(r, `.concat(m,`, d1, d2);
             dotProd += xC`).concat(m,`.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < `).concat(e.inChannels,`) {
               dotProd += xC`).concat(m,`.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `),m+1<l&&(h+=`
               wTexel = getW(r, `.concat(m+1,`, d1, d2);
               dotProd += xC`).concat(m+1,`.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < `).concat(e.inChannels,`) {
                 dotProd += xC`).concat(m+1,`.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `)))}h+=`
     }
   `,h+=`
     }
   `,h+=`
     }
   `;var g="",y="";n&&(a?g=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           `.concat(n,`
         }`):i?g=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           `.concat(n,`
         }`):g=`vec4 activation(vec4 x) {
           `.concat(n,`
         }`),y="result = activation(result);");var w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       `.concat(g,`

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         `).concat(h,`

         vec4 result = dotProd - vec4(0.000000000000001);
         `).concat(w,`
         `).concat(y,`
         setOutput(result);
       }
     `)}return r}();var QGe=function(){function r(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=pn(this.outputShape.length);for(var n=t.dataFormat,a=Nn(),i=n==="channelsLast",o=i?1:2,s=i?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < ".concat(e[2]," && pos < ").concat(e[1],") {"),c="",l=0;l<=1;l++)for(var f=0;f<=1;f++)c+=`
          blockIndex = rc.z + `.concat(f,`;
          pos = rc.y + `).concat(l,`;

          `).concat(u,`
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[`).concat(o,`] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[`).concat(s,`] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (`).concat(i,`) {
                  innerDims = vec2(d1, ch);
                  result[`).concat(l*2+f,`] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`).concat(l*2+f,`] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `);this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `.concat(c,`

        `).concat(a.output,` = result;
      }
    `)}return r}();function dm(r,e){var t=r.length;return t>=3?e?pr(pr([],Te(r.slice(0,-3)),!1),[r[t-3]*r[t-2],r[t-1]],!1):pr(pr([],Te(r.slice(0,-3)),!1),[r[t-3],r[t-2]*r[t-1]],!1):!e&&t===1&&r[0]>1?[r[0],1]:null}function XW(r){var e,t,n=r.x,a=r.filter,i=r.convInfo,o=r.backend,s=r.bias,u=s===void 0?null:s,c=r.preluActivationWeights,l=c===void 0?null:c,f=r.leakyreluAlpha,h=f===void 0?0:f,p=r.activation,d=p===void 0?null:p,m=n.shape,v=o.texData.get(n.dataId),g=i.inChannels,y=m[0]*m[1]*m[2],w=i.outChannels,b=i.dataFormat==="channelsLast",x=!1,S=!1,T,E=[];if(l!=null){var C=dm(l.shape,b);C!=null&&(l=Ae({inputs:{x:l},backend:o,attrs:{shape:C}}),E.push(l))}if(u!=null){var C=dm(u.shape,b);C!=null&&(u=Ae({inputs:{x:u},backend:o,attrs:{shape:C}}),E.push(u))}var R=(y===1||w===1)&&g>qW,_=!R&&v.isPacked&&b&&v.texture!=null&&m[2]%2!==0&&k.util.arraysEqual(v.shape.slice(-3),m.slice(-3));if(_){var C=m[0]*m[1]*(m[2]+1),O={dataId:n.dataId,shape:[1,C,i.inChannels],dtype:n.dtype},$=v.shape;v.shape=v.shape.slice(),v.shape[v.shape.length-2]++,k.util.assert(dh(v.shape,O.shape),function(){return"packed reshape ".concat(v.shape," to ").concat(O.shape," isn't free")});var z=Ae({inputs:{x:a},backend:o,attrs:{shape:[1,i.inChannels,i.outChannels]}});E.push(z);var L=pm({a:O,b:z,backend:o,transposeA:x,transposeB:S,bias:u,activation:d,preluActivationWeights:l,leakyreluAlpha:h}),B=o.texData.get(L.dataId);k.util.assert(B.isPacked,function(){return"batchMatMul result is expected to be packed"}),v.shape=$,B.shape=i.outShape,T=ca({inputs:{x:L},backend:o}),T.shape=i.outShape,E.push(L)}else{var W=i.outHeight*i.outWidth,X=Ae({inputs:{x:n},backend:o,attrs:{shape:b?[i.batchSize,W,i.inChannels]:[i.batchSize,i.inChannels,W]}}),z=Ae({inputs:{x:a},backend:o,attrs:{shape:[1,i.inChannels,i.outChannels]}}),J=pm({a:b?X:z,b:b?z:X,transposeA:!b,transposeB:S,backend:o,bias:u,activation:d,preluActivationWeights:l,leakyreluAlpha:h});T=Ae({inputs:{x:J},backend:o,attrs:{shape:i.outShape}}),E.push(X),E.push(z),E.push(J)}try{for(var V=kn(E),j=V.next();!j.done;j=V.next()){var ne=j.value;o.disposeIntermediateTensorInfo(ne)}}catch(re){e={error:re}}finally{try{j&&!j.done&&(t=V.return)&&t.call(V)}finally{if(e)throw e.error}}return T}function YW(r){var e,t,n=r.x,a=r.filter,i=r.convInfo,o=r.backend,s=r.bias,u=s===void 0?null:s,c=r.preluActivationWeights,l=c===void 0?null:c,f=r.leakyreluAlpha,h=f===void 0?0:f,p=r.activation,d=p===void 0?null:p,m=i.filterWidth,v=i.filterHeight,g=i.inChannels,y=i.outWidth,w=i.outHeight,b=i.dataFormat,x=b==="channelsLast",S=m*v*g,T=w*y,E=[i.batchSize,S,T],C=!0,R=!1,_=[];if(l!=null){var O=dm(l.shape,x);O!=null&&(l=Ae({inputs:{x:l},backend:o,attrs:{shape:O}}),_.push(l))}if(u!=null){var O=dm(u.shape,x);O!=null&&(u=Ae({inputs:{x:u},backend:o,attrs:{shape:O}}),_.push(u))}var $=Ae({inputs:{x:a},backend:o,attrs:{shape:[1,S,k.util.sizeFromShape(a.shape)/S]}});_.push($);var z=new QGe(E,i),L=[n.shape,[i.padInfo.top,i.padInfo.left],[i.strideHeight,i.strideWidth],[i.dilationHeight,i.dilationWidth],[i.inChannels],[i.filterWidth*i.inChannels],[i.outWidth]],B=o.runWebGLProgram(z,[n],"float32",L),W=Ae({inputs:{x:B},backend:o,attrs:{shape:E}});_.push(B),_.push(W);var X=u!=null,J=l!=null,V=d==="leakyrelu",j=d?vh(d,!0):null,ne=new $W(x?W.shape:$.shape,x?$.shape:W.shape,x?[i.batchSize,T,i.outChannels]:[i.batchSize,i.outChannels,T],C,R,X,j,J,V),re=x?[W,$]:[$,W];if(u&&re.push(u),J&&re.push(l),V){var oe=o.makeTensorInfo([],"float32",k.util.createScalarValue(h,"float32"));re.push(oe),_.push(oe)}var le=o.runWebGLProgram(ne,re,"float32"),de=Ae({inputs:{x:le},backend:o,attrs:{shape:i.outShape}});_.push(le);try{for(var ke=kn(_),he=ke.next();!he.done;he=ke.next()){var ye=he.value;o.disposeIntermediateTensorInfo(ye)}}catch(xe){e={error:xe}}finally{try{he&&!he.done&&(t=ke.return)&&t.call(ke)}finally{if(e)throw e.error}}return de}function e6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dataFormat,c=n.dilations,l=n.dimRoundingMode,f=k.backend_util.convertConv2DDataFormat(u),h=k.backend_util.computeConv2DInfo(a.shape,i.shape,o,c,s,l,!1,f),p;if(h.filterHeight===1&&h.filterWidth===1&&h.dilationHeight===1&&h.dilationWidth===1&&h.strideHeight===1&&h.strideWidth===1&&(h.padInfo.type==="SAME"||h.padInfo.type==="VALID"))p=XW({x:a,filter:i,convInfo:h,backend:t});else if(h.strideWidth<=2&&f==="channelsLast"&&k.env().getBool("WEBGL_EXP_CONV")){var d=new jW(h),m=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];p=t.runWebGLProgram(d,[a,i],"float32",m)}else if(k.env().getBool("WEBGL_CONV_IM2COL"))p=YW({x:a,filter:i,convInfo:h,backend:t});else{var d=new KW(h);p=t.runWebGLProgram(d,[a,i],"float32")}var v=Ae({inputs:{x:p},backend:t,attrs:{shape:h.outShape}});return t.disposeIntermediateTensorInfo(p),v}var t6e={kernelName:k.Conv2D,backendName:"webgl",kernelFunc:e6e};var r6e=function(){function r(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,a=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `.concat(e.batchSize,`; b++) {
          for (int yR = 0; yR < `).concat(e.outHeight,`; yR++) {
            int xR = wR + yR * `).concat(t," - ").concat(a,`;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int yC = 0; yC < `).concat(e.outWidth,`; yC++) {
              int xC = wC + yC * `).concat(n," - ").concat(i,`;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              `).concat(o?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`,`
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}(),n6e=function(){function r(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",s=t-1-e.padInfo.top,u=n-1-e.padInfo.left,c=o?1:2,l=o?2:3,f=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(`.concat(s,", ").concat(u,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`).concat(f,`];

        ivec2 dyCorner = ivec2(coords[`).concat(c,"], coords[").concat(l,`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(t,`; wR++) {
          float dyR = float(dyRCorner + wR) / `).concat(a,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `).concat(t,` - 1 - wR;

          for (int wC = 0; wC < `).concat(n,`; wC++) {
            float dyC = float(dyCCorner + wC) / `).concat(i,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `).concat(n,` - 1 - wC;

            for (int d2 = 0; d2 < `).concat(e.outChannels,`; d2++) {

              if (`).concat(o,`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}(),a6e=function(){function r(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,n=e.strideHeight,a=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,s=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `.concat(e.batchSize,`; b++) {
          for (int yF = 0; yF < `).concat(e.outDepth,`; yF++) {
            int xF = wF + yF * `).concat(t," - ").concat(i,`;

            if (xF < 0 || xF >= `).concat(e.inDepth,`) {
              continue;
            }

            for (int yR = 0; yR < `).concat(e.outHeight,`; yR++) {
              int xR = wR + yR * `).concat(n," - ").concat(o,`;

              if (xR < 0 || xR >= `).concat(e.inHeight,`) {
                continue;
              }

              for (int yC = 0; yC < `).concat(e.outWidth,`; yC++) {
                int xC = wC + yC * `).concat(a," - ").concat(s,`;

                if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}(),i6e=function(){function r(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,a=e.filterWidth,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=t-1-e.padInfo.front,c=n-1-e.padInfo.top,l=a-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`.concat(u,", ").concat(c,", ").concat(l,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `).concat(t,`; wF++) {
          float dyF = float(dyFCorner + wF) / `).concat(i,`.0;

          if (dyF < 0.0 || dyF >= `).concat(e.outDepth,`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `).concat(t,` - 1 - wF;

          for (int wR = 0; wR < `).concat(n,`; wR++) {
            float dyR = float(dyRCorner + wR) / `).concat(o,`.0;

            if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `).concat(n,` - 1 - wR;

            for (int wC = 0; wC < `).concat(a,`; wC++) {
              float dyC = float(dyCCorner + wC) / `).concat(s,`.0;

              if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `).concat(a,` - 1 - wC;

              for (int d2 = 0; d2 < `).concat(e.outChannels,`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}();function o6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode,l=n.filterShape,f=k.backend_util.convertConv2DDataFormat(u),h=k.backend_util.computeConv2DInfo(a.shape,l,o,1,s,c,!1,f),p=new r6e(h);return t.runWebGLProgram(p,[a,i],"float32")}var s6e={kernelName:k.Conv2DBackpropFilter,backendName:"webgl",kernelFunc:o6e};var u6e=function(){function r(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=pn(this.outputShape.length);var t=e.filterHeight,n=e.filterWidth,a=t-1-e.padInfo.top,i=n-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(`.concat(a,", ").concat(i,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < `).concat(t,`; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = `).concat(t,` - 1 - wR;

          for (int wC = 0; wC < `).concat(n,`; wC++) {
            int wCPerm = `).concat(n,` - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < `).concat(e.outWidth,`.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < `).concat(e.outWidth,`.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < `).concat(e.outChannels,`; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < `).concat(e.outChannels,`; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < `).concat(e.outChannels,`; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `)}return r}();function c6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.inputShape,s=n.strides,u=n.pad,c=n.dataFormat,l=n.dimRoundingMode,f=k.backend_util.convertConv2DDataFormat(c),h=k.backend_util.computeConv2DInfo(o,i.shape,s,1,u,l,!1,f);if(k.env().getBool("WEBGL_PACK")&&f==="channelsLast"){var p=[[h.strideHeight,h.strideWidth]],d=new u6e(h);return t.runWebGLProgram(d,[a,i],"float32",p)}else{var d=new n6e(h);return t.runWebGLProgram(d,[a,i],"float32")}}var l6e={kernelName:k.Conv2DBackpropInput,backendName:"webgl",kernelFunc:c6e};function f6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,c=k.backend_util.computeConv3DInfo(a.shape,i.shape,o,u,s),l=new JGe(c);return t.runWebGLProgram(l,[a,i],"float32")}var h6e={kernelName:k.Conv3D,backendName:"webgl",kernelFunc:f6e};function p6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.pad,u=n.filterShape,c=k.backend_util.computeConv3DInfo(a.shape,u,o,1,s),l=new a6e(c);return t.runWebGLProgram(l,[a,i],"float32")}var d6e={kernelName:k.Conv3DBackpropFilterV2,backendName:"webgl",kernelFunc:p6e};function v6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.pad,s=n.strides,u=n.inputShape,c=k.backend_util.computeConv3DInfo(u,i.shape,s,1,o),l=new i6e(c);return t.runWebGLProgram(l,[a,i],"float32")}var m6e={kernelName:k.Conv3DBackpropInputV2,backendName:"webgl",kernelFunc:v6e};var g6e=Yc+`
  return cos(x);
`,y6e=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  `.concat(Su,`
  return result;
`),b6e=Nt({opSnippet:g6e,packedOpSnippet:y6e}),w6e={kernelName:k.Cos,backendName:"webgl",kernelFunc:b6e};var x6e=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,k6e=Nt({opSnippet:x6e}),S6e={kernelName:k.Cosh,backendName:"webgl",kernelFunc:k6e};var N6e=function(){function r(e,t,n,a,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3],f=Te(t,1),h=f[0],p=Te(n,2),d=p[0],m=p[1];this.outputShape=[h,d,m,l];var v=a==="bilinear"?1:0,g=Te(["".concat(u-1,".0"),"".concat(c-1,".0")],2),y=g[0],w=g[1],b=Te(d>1?["".concat((u-1)/(d-1)),"(y2-y1) * height_ratio","y1*".concat(y," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(y)],3),x=b[0],S=b[1],T=b[2],E=Te(m>1?["".concat((c-1)/(m-1)),"(x2-x1) * width_ratio","x1*".concat(w," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(w)],3),C=E[0],R=E[1],_=E[2];this.userCode=`
      const float height_ratio = float(`.concat(x,`);
      const float width_ratio = float(`).concat(C,`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `).concat(s,`) {
          return;
        }

        float height_scale = `).concat(S,`;
        float width_scale = `).concat(R,`;

        float in_y = `).concat(T,`;
        if( in_y < 0.0 || in_y > `).concat(y,` ) {
          setOutput(float(`).concat(i,`));
          return;
        }
        float in_x = `).concat(_,`;
        if( in_x < 0.0 || in_x > `).concat(w,` ) {
          setOutput(float(`).concat(i,`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`).concat(v,` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `)}return r}();var T6e=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.image,i=e.boxes,o=e.boxInd,s=n.cropSize,u=n.method,c=n.extrapolationValue,l=new N6e(a.shape,i.shape,s,u,c);return t.runWebGLProgram(l,[a,i,o],"float32")},E6e={kernelName:k.CropAndResize,backendName:"webgl",kernelFunc:T6e},gh;(function(r){r.Prod="*",r.Sum="+"})(gh||(gh={}));var Nq=function(){function r(e,t,n,a){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];var i=this.outputShape.length,o=this.op===gh.Prod?"1.0":"0.0",s=n?o:"getX(".concat(Tq(i,"coords",this.op),")"),u=this.outputShape[this.outputShape.length-1],c="",l="";n?(c=a?"end != ".concat(u-1):"end != 0",l=a?"end + 1":"end - 1"):(c=a?"end + pow2 < ".concat(u):"end >= pow2",l=a?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        `.concat(Lt(i),` coords = getOutputCoords();
        int end = `).concat(Eq(i,"coords",this.op),`;
        float val = `).concat(s,`;
        int pow2 = int(pow(2.0, index));
        if (`).concat(c,`) {
          int idx = `).concat(l,`;
          `).concat(Eq(i,"coords",this.op),` = idx;
          val `).concat(this.op,"= getX(").concat(Tq(i,"coords",this.op),`);
        }
        setOutput(val);
      }
    `)}return r}();function Tq(r,e,t){if(r===1)return"".concat(e);if(r===2)return"".concat(e,".x, ").concat(e,".y");if(r===3)return"".concat(e,".x, ").concat(e,".y, ").concat(e,".z");if(r===4)return"".concat(e,".x, ").concat(e,".y, ").concat(e,".z, ").concat(e,".w");throw new Error("Cumulative ".concat(t," for rank ").concat(r," is not yet supported"))}function Eq(r,e,t){if(r===1)return"".concat(e);if(r===2)return"".concat(e,".y");if(r===3)return"".concat(e,".z");if(r===4)return"".concat(e,".w");throw new Error("Cumulative ".concat(t," for rank ").concat(r," is not yet supported"))}function ZW(r,e,t,n,a,i){var o=e.shape.length,s=k.backend_util.getAxesPermutation([n],o),u=e;s!=null&&(u=Sn({inputs:{x:e},backend:t,attrs:{perm:s}}));var c=k.backend_util.getInnerMostAxes(1,o)[0];if(c!==o-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(e.shape.length-1," ")+"but got axis=".concat(n));for(var l=u.shape[c],f=ca({inputs:{x:u},backend:t}),h=0;h<=Math.ceil(Math.log2(l))-1;h++){var p=new Nq(r,u.shape,!1,i),d=[[h]],m=f;f=t.runWebGLProgram(p,[f],f.dtype,d),t.disposeIntermediateTensorInfo(m)}if(a){var p=new Nq(r,u.shape,a,i),m=f;f=t.runWebGLProgram(p,[f],f.dtype),t.disposeIntermediateTensorInfo(m)}if(s!=null){var v=k.backend_util.getUndoAxesPermutation(s),g=Sn({inputs:{x:f},backend:t,attrs:{perm:v}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(u),g}return f}function I6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.exclusive,s=n.reverse;return ZW(gh.Prod,a,t,i,o,s)}var C6e={kernelName:k.Cumprod,backendName:"webgl",kernelFunc:I6e};function A6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.exclusive,s=n.reverse;return ZW(gh.Sum,a,t,i,o,s)}var D6e={kernelName:k.Cumsum,backendName:"webgl",kernelFunc:A6e};function _6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.weights,o=n.size,s=n.binaryOutput;if(a.shape.length===1){var u=t.readSync(a.dataId),c=t.readSync(i.dataId),l=DW(u,c,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,l)}else if(a.shape.length===2){var f=t.bufferSync(a),h=t.bufferSync(i),p=RWe(f,h,o,s);return t.makeTensorInfo(p.shape,i.dtype,p.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}var F6e={kernelName:k.DenseBincount,backendName:"webgl",kernelFunc:_6e};var R6e=function(){function r(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `.concat(this.getHeightCoordString(),`;
      int w = `).concat(this.getWidthCoordString(),`;
      int d = `).concat(this.getDepthCoordString(),`;

      int in_h = h / `).concat(t,`;
      int offset_h = imod(h, `).concat(t,`);
      int in_w = w / `).concat(t,`;
      int offset_w = imod(w, `).concat(t,`);
      int offset_d = (offset_h * `).concat(t,` + offset_w) *
        `).concat(this.getOutputDepthSize(),`;
      int in_d = d + offset_d;

      float result = `).concat(this.getInputSamplingString(),`;
      setOutput(result);
    }
  `)}return r.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},r.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},r.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},r.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},r.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},r}();function O6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockSize,o=n.dataFormat,s=a.shape[0],u=o==="NHWC"?a.shape[1]:a.shape[2],c=o==="NHWC"?a.shape[2]:a.shape[3],l=o==="NHWC"?a.shape[3]:a.shape[1],f=u*i,h=c*i,p=l/(i*i),d=o==="NHWC"?[s,f,h,p]:[s,p,f,h],m=new R6e(d,i,o);return t.runWebGLProgram(m,[a],a.dtype)}var P6e={kernelName:k.DepthToSpace,backendName:"webgl",kernelFunc:O6e};var JW=function(){function r(e,t,n,a,i){t===void 0&&(t=!1),n===void 0&&(n=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=pn(this.outputShape.length);var o=e.filterHeight,s=e.filterWidth,u=e.outChannels/e.inChannels,c="",l="";n&&(a?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `.concat(n,`
        }`):i?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          `.concat(n,`
        }`):c=`
          float activation(float x) {
            `.concat(n,`
          }
        `),l="result = activation(result);");var f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `.concat(c,`

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `).concat(u,`;
        int q = d2 - d1 * `).concat(u,`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `).concat(o,`; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < `).concat(s,`; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `).concat(f,`
        `).concat(l,`
        setOutput(result);
      }
    `)}return r}();var QW=function(){function r(e,t,n,a,i){t===void 0&&(t=!1),n===void 0&&(n=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=pn(this.outputShape.length);for(var o=e.outChannels/e.inChannels,s=e.padInfo.left,u=e.strideWidth,c=e.dilationWidth,l=e.filterHeight,f=e.filterWidth,h=f,p=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`,d=0;d<f;d++)p+=`
          vec4 xTexelC`.concat(d*2,`;
          int xTexelC`).concat(d*2,`Ready;
          vec4 xTexelC`).concat(d*2+1,`;
          int xTexelC`).concat(d*2+1,`Ready;
          vec4 xC`).concat(d,";");p+=`
    for (int r = 0; r < `.concat(l,`; r++) {
      `);for(var d=0;d<f;d++)p+=`
          xTexelC`.concat(d*2,` = vec4(0.0);
          xTexelC`).concat(d*2,`Ready = 0;
          xTexelC`).concat(d*2+1,` = vec4(0.0);
          xTexelC`).concat(d*2+1,`Ready = 0;
          xC`).concat(d," = vec4(0.0);");p+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(var m=0;m<(h+1)/2;m++){var v=m*2;if(p+=`
          xC = xCCorner + `.concat(v*c,`;
          `),u===1){if(v<f&&(s%2===1?(p+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                  xTexelC`).concat(v,` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`).concat(v,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(v,`Ready = 1;
                }
              `),c===1&&v>0?p+=`
                xC`.concat(v," = vec4(xTexelC").concat(v-2,".zw, xTexelC").concat(v,`.xy);
                `):p+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC`.concat(v," = vec4(previous.zw, xTexelC").concat(v,`.xy);
                  } else {
                    xC`).concat(v," = vec4(0.0, 0.0, xTexelC").concat(v,`.xy);
                  }
                  `)):p+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                  xTexelC`).concat(v,` = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC`).concat(v,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(v,`Ready = 1;
                }

                xC`).concat(v," = xTexelC").concat(v,`;
                `),v+1<f)){var g=s%2===0?k.util.nearestLargerEven(c):c;c%2===0&&s%2===1||c%2!==0&&s%2!==1?(p+=`
                  xCOffset = xC + imod(pads[1], 2) + `.concat(g,`;

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                    xTexelC`).concat(v+1,` = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC`).concat(v+1,`.zw = vec2(0.0);
                    }
                    xTexelC`).concat(v+1,`Ready = 1;
                  }
                  `),c>1?p+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC`.concat(v+1," = vec4(previous.zw, xTexelC").concat(v+1,`.xy);
                    } else {
                     xC`).concat(v+1," = vec4(0.0, 0.0, xTexelC").concat(v+1,`.xy);
                    }
                    `):p+=`
                    xC`.concat(v+1," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,`.xy);
                    `)):g===1?p+=`
                    xC`.concat(v+1," = xTexelC").concat(v,`;
                    `):p+=`
                    xCOffset = xC + `.concat(g,`;

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                      xTexelC`).concat(v+1,` = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC`).concat(v+1,`.zw = vec2(0.0);
                      }
                      xTexelC`).concat(v+1,`Ready = 1;
                    }

                    xC`).concat(v+1," = xTexelC").concat(v+1,`;
                    `)}}else v<f&&(s%2===1?(p+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                  xTexelC`).concat(v,` = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`).concat(v,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(v,`Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                  xTexelC`).concat(v+1,` = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC`).concat(v+1,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(v+1,`Ready = 1;
                }

                xC`).concat(v," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,`.zw);
              `),v+1<f&&(p+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC`.concat(v+1," = vec4(xTexelC").concat(v+1,`.xy, final.xy);
                `))):(p+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                  xTexelC`).concat(v,` = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC`).concat(v,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(v,`Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                  xTexelC`).concat(v+1,` = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`).concat(v+1,`.zw = vec2(0.);
                  }
                  xTexelC`).concat(v+1,`Ready = 1;
                }

                xC`).concat(v,` = vec4(
                  xTexelC`).concat(v,".xy, xTexelC").concat(v+1,`.xy);
              `),v+1<f&&(p+=`
                  xC`.concat(v+1," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,`.zw);
                `))));v<f&&(p+=`
            wTexel = getW(r, `.concat(v,`, d1, q);
            dotProd += xC`).concat(v,` * vec4(wTexel.xz, wTexel.xz);
          `),v+1<f&&(p+=`
              wTexel = getW(r, `.concat(v+1,`, d1, q);
              dotProd += xC`).concat(v+1,` * vec4(wTexel.xz, wTexel.xz);
            `)))}p+=`
    }
  `,p+=`
      }
    `;var y="",w="";n&&(a?y=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `.concat(n,`
        }`):i?y=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          `.concat(n,`
        }`):y=`vec4 activation(vec4 x) {
          `.concat(n,`
        }`),w="result = activation(result);");var b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `.concat(y,`

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `).concat(o,`;
        int q = d2 - d1 * `).concat(o,`;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        `).concat(p,`

        vec4 result = dotProd - vec4(0.000000000000001);
        `).concat(b,`
        `).concat(w,`
        setOutput(result);
      }
    `)}return r}();function M6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,c=n.dimRoundingMode,l=u;l==null&&(l=[1,1]),k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,l),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(l,"'")});var f=k.backend_util.computeConv2DInfo(a.shape,i.shape,o,l,s,c,!0),h;k.env().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?h=new QW(f):h=new JW(f);var p=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return t.runWebGLProgram(h,[a,i],"float32",p)}var B6e={kernelName:k.DepthwiseConv2dNative,backendName:"webgl",kernelFunc:M6e};var L6e=function(){function r(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,n=e.strideWidth,a=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `.concat(o,` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `).concat(e.batchSize,`; b++) {
          for (int yR = 0; yR < `).concat(e.outHeight,`; yR++) {
            int xR = wR + yR * `).concat(t," - ").concat(a,`;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int yC = 0; yC < `).concat(e.outWidth,`; yC++) {
              int xC = wC + yC * `).concat(n," - ").concat(i,`;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}(),z6e=function(){function r(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,s=n-1-e.padInfo.left,u=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`.concat(o,", ").concat(s,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `).concat(t,`; wR++) {
          float dyR = float(dyRCorner + wR) / `).concat(a,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `).concat(t,` - 1 - wR;

          for (int wC = 0; wC < `).concat(n,`; wC++) {
            float dyC = float(dyCCorner + wC) / `).concat(i,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `).concat(n,` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `).concat(u,`; dm++) {
              int d2 = d1 * `).concat(u,` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}();function $6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.dy,o=n.strides,s=n.dilations,u=n.pad,c=n.dimRoundingMode,l=n.filterShape,f=k.backend_util.computeConv2DInfo(a.shape,l,o,s,u,c,!0),h=new L6e(f);return t.runWebGLProgram(h,[a,i],"float32")}var q6e={kernelName:k.DepthwiseConv2dNativeBackpropFilter,backendName:"webgl",kernelFunc:$6e};function W6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.filter,o=n.strides,s=n.dilations,u=n.pad,c=n.dimRoundingMode,l=n.inputShape,f=k.backend_util.computeConv2DInfo(l,i.shape,o,s,u,c,!0),h=new z6e(f);return t.runWebGLProgram(h,[a,i],"float32")}var V6e={kernelName:k.DepthwiseConv2dNativeBackpropInput,backendName:"webgl",kernelFunc:W6e};var U6e=function(){function r(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}return r}();function G6e(r){var e=r.inputs,t=r.backend,n=e.x,a=pr(pr([],Te(n.shape),!1),Te(n.shape),!1),i=k.util.sizeFromShape(n.shape),o=Ae({inputs:{x:n},backend:t,attrs:{shape:[i]}}),s=new U6e(i),u=t.runWebGLProgram(s,[o],o.dtype),c=Ae({inputs:{x:u},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(u),c}var H6e={kernelName:k.Diag,backendName:"webgl",kernelFunc:G6e};var K6e=function(){function r(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.inHeight,n=e.inWidth,a=e.padInfo,i=e.strideHeight,o=e.strideWidth,s=e.filterHeight,u=e.filterWidth,c=e.dilationHeight,l=e.dilationWidth,f=a.top,h=a.left;this.userCode=`
      const ivec2 strides = ivec2(`.concat(i,", ").concat(o,`);
      const ivec2 pads = ivec2(`).concat(f,", ").concat(h,`);
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < `).concat(s,`; h++) {
          int hIn = hBeg + h * `).concat(c,`;

          if (hIn >= 0 && hIn < `).concat(t,`) {
            for (int w = 0; w < `).concat(u,`; w++) {
              int wIn = wBeg + w * `).concat(l,`;

              if (wIn >= 0 && wIn < `).concat(n,`) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `)}return r}();function j6e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=n.strides,s=n.pad,u=n.dilations,c=k.backend_util.computeDilation2DInfo(a.shape,i.shape,o,s,"NHWC",u),l,f=new K6e(c);l=t.runWebGLProgram(f,[a,i],"float32");var h=Ae({inputs:{x:l},backend:t,attrs:{shape:c.outShape}});return t.disposeIntermediateTensorInfo(l),h}var X6e={kernelName:k.Dilation2D,backendName:"webgl",kernelFunc:j6e};function Y6e(r){var e,t,n,a,i=r.inputs,o=r.backend,s=r.attrs,u=s.equation,c=i,l=k.backend_util.decodeEinsumEquation(u,c.length),f=l.allDims,h=l.summedDims,p=l.idDims;k.backend_util.checkEinsumDimSizes(f.length,p,c);for(var d=k.backend_util.getEinsumComputePath(h,p),m=d.path,v=d.steps,g=v.length,y=null,w=f.length,b=[],x=0;x<g;++x){try{for(var S=(e=void 0,kn(v[x])),T=S.next();!T.done;T=S.next()){var E=T.value,C=k.backend_util.getEinsumPermutation(w,p[E]),R=C.permutationIndices,_=C.expandDims,O=void 0;k.backend_util.isIdentityPermutation(R)?O=c[E]:(O=Sn({inputs:{x:c[E]},backend:o,attrs:{perm:R}}),b.push(O));for(var $=O.shape.slice(),z=0;z<_.length;++z)$.splice(_[z],0,1);k.util.arraysEqual(O.shape,$)||(O=Ae({inputs:{x:O},backend:o,attrs:{shape:$}}),b.push(O)),y===null?y=O:(y=Zx({inputs:{a:O,b:y},backend:o}),b.push(y))}}catch(X){e={error:X}}finally{try{T&&!T.done&&(t=S.return)&&t.call(S)}finally{if(e)throw e.error}}x<g-1&&(m[x]>=0&&(y=ym({inputs:{x:y},backend:o,attrs:{axis:m[x]-(f.length-w),keepDims:!1}}),b.push(y)),w--)}try{for(var L=kn(b),B=L.next();!B.done;B=L.next()){var W=B.value;W!==y&&o.disposeIntermediateTensorInfo(W)}}catch(X){n={error:X}}finally{try{B&&!B.done&&(a=L.return)&&a.call(L)}finally{if(n)throw n.error}}return y}var Z6e={kernelName:k.Einsum,backendName:"webgl",kernelFunc:Y6e};var J6e="return (x >= 0.0) ? x : (exp(x) - 1.0);",Q6e=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,eHe=Nt({opSnippet:J6e,packedOpSnippet:Q6e}),tHe={kernelName:k.Elu,backendName:"webgl",kernelFunc:eHe};var rHe="return (b >= 0.0) ? a : a * (b + 1.0);",nHe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,aHe=function(r){var e=r.inputs,t=r.backend,n=e.dy,a=e.y,i=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Xc(nHe,n.shape,a.shape):new wu(rHe,n.shape,a.shape);return t.runWebGLProgram(i,[n,a],n.dtype)},iHe={kernelName:k.EluGrad,backendName:"webgl",kernelFunc:aHe};var oHe=`
  return vec4(equal(a, b));
`,sHe="return float(a == b);",uHe=un({opSnippet:sHe,packedOpSnippet:oHe,dtype:"bool",cpuKernelImpl:LWe}),cHe={kernelName:k.Equal,backendName:"webgl",kernelFunc:uHe};var lHe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = `.concat(k.backend_util.ERF_P,`;
  float a1 = `).concat(k.backend_util.ERF_A1,`;
  float a2 = `).concat(k.backend_util.ERF_A2,`;
  float a3 = `).concat(k.backend_util.ERF_A3,`;
  float a4 = `).concat(k.backend_util.ERF_A4,`;
  float a5 = `).concat(k.backend_util.ERF_A5,`;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`),fHe=Nt({opSnippet:lHe}),hHe={kernelName:k.Erf,backendName:"webgl",kernelFunc:fHe};var pHe=Yc+`
  return exp(x);
`,dHe=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,eV=Nt({opSnippet:pHe,packedOpSnippet:dHe,cpuKernelImpl:zWe,dtype:"float32"}),vHe={kernelName:k.Exp,backendName:"webgl",kernelFunc:eV};function Bx(r){var e=r.inputs,t=r.attrs,n=r.backend,a=t.dim,i=e.input,o=i.shape.length,s=i.shape.slice(),u=a;return a<0&&(k.util.assert(-(o+1)<=a,function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")}),u=o+a+1),s.splice(u,0,1),Ae({inputs:{x:i},backend:n,attrs:{shape:s}})}var mHe={kernelName:k.ExpandDims,backendName:"webgl",kernelFunc:Bx};var Iq="return exp(x) - 1.0;",gHe=Nt({opSnippet:Iq,packedOpSnippet:Iq,cpuKernelImpl:$We}),yHe={kernelName:k.Expm1,backendName:"webgl",kernelFunc:gHe};var Cq=function(){function r(e,t,n){this.variableNames=["real","imag"];var a=t[1];this.outputShape=t;var i=n?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),o=n?"".concat(a,".0"):"1.0",s;if(e==="real")s="return real * expR - imag * expI;";else if(e==="imag")s="return real * expI + imag * expR;";else throw new Error('FFT component must be either "real" or "imag", got '.concat(e,"."));this.userCode=`
      const float exponentMultiplier = `.concat(i,`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `).concat(s,`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`).concat(a,`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `).concat(a,`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `).concat(o,`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `)}return r}();function tV(r,e,t){var n=t.texData.get(r.dataId),a=k.util.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],o=a/i,s=Ae({inputs:{x:r},backend:t,attrs:{shape:[o,i]}}),u=s.shape,c=new Cq("real",u,e),l=new Cq("imag",u,e),f=[{dataId:n.complexTensorInfos.real.dataId,dtype:n.complexTensorInfos.real.dtype,shape:u},{dataId:n.complexTensorInfos.imag.dataId,dtype:n.complexTensorInfos.imag.dtype,shape:u}],h=t.runWebGLProgram(c,f,"float32"),p=t.runWebGLProgram(l,f,"float32"),d=ss({inputs:{real:h,imag:p},backend:t});t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p);var m=Ae({inputs:{x:d},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(d),m}function bHe(r){var e=r.inputs,t=r.backend,n=e.input;return tV(n,!1,t)}var wHe={kernelName:k.FFT,backendName:"webgl",kernelFunc:bHe};var xHe=function(){function r(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return r}();function xh(r){var e=r.backend,t=r.attrs,n=t.shape,a=t.value,i=t.dtype;if(i=i||k.util.inferDtype(a),i==="string"){var o=k.util.getArrayFromDType(i,k.util.sizeFromShape(n));return o.fill(a),e.makeTensorInfo(n,i,o)}else{var s=new xHe(n,a),u=[[a]];return e.runWebGLProgram(s,[],i,u)}}var kHe={kernelName:k.Fill,backendName:"webgl",kernelFunc:xh};var SHe=function(){function r(e){this.variableNames=["Image"],this.outputShape=[];var t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = `.concat(t,` - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < `).concat(t,`) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `)}return r}();var NHe={kernelName:k.FlipLeftRight,backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e.image,a=t,i=new SHe(n.shape),o=a.runWebGLProgram(i,[n],n.dtype);return o}};var Aq="return floor(x);",THe=Nt({opSnippet:Aq,packedOpSnippet:Aq,cpuKernelImpl:qWe}),EHe={kernelName:k.Floor,backendName:"webgl",kernelFunc:THe};var IHe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,CHe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,AHe=un({opSnippet:IHe,packedOpSnippet:CHe,dtype:"int32"}),DHe={kernelName:k.FloorDiv,backendName:"webgl",kernelFunc:AHe},_He=function(){function r(e){this.variableNames=["A"];var t=Nn(),n=Te(e,2),a=n[0],i=n[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`.concat(i,".0, ").concat(a,`.0);

        vec4 values = `).concat(t.texture2D,`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `)}return r}(),FHe=function(){function r(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=Nn(),n=Te(e,2),a=n[0],i=n[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`.concat(i,".0, ").concat(a,`.0);
            vec4 values = `).concat(t.texture2D,`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `).concat(t.output,` = result;
      }
    `)}return r}(),RHe={kernelName:k.FromPixels,backendName:"webgl",kernelFunc:OHe},zc,Cx=k.env().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function OHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.pixels,i=n.numChannels,o=typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement,u=Te(o?[a.videoWidth,a.videoHeight]:[a.width,a.height],2),c=u[0],l=u[1],f=[l,c],h=[l,c,i];if(s||o){var p=k.env().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(zc==null||p!==Cx)&&(Cx=p,zc=document.createElement("canvas").getContext("2d",{willReadFrequently:Cx})),zc.canvas.width=c,zc.canvas.height=l,zc.drawImage(a,0,0,c,l),a=zc.canvas}var d=t.makeTensorInfo(f,"int32");t.texData.get(d.dataId).usage=xa.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(d.dataId),a);var m=k.env().getBool("WEBGL_PACK")?new FHe(h):new _He(h),v=t.runWebGLProgram(m,[d],"int32");return t.disposeData(d.dataId),v}function PHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=n.strides,c=n.pad,l=n.dataFormat,f=n.dilations,h=n.dimRoundingMode,p=n.activation,d=n.leakyreluAlpha,m=k.backend_util.convertConv2DDataFormat(l),v=k.backend_util.computeConv2DInfo(a.shape,i.shape,u,f,c,h,!1,m),g,y=[],w=o!=null,b=s!=null,x=p==="leakyrelu",S=function(){var $=[a,i],z=function(B,W){if(W==="NCHW"&&B.shape.length===1&&B.shape[0]!==1){var X=Ae({inputs:{x:B},backend:t,attrs:{shape:[B.shape[0],1,1]}});return y.push(X),X}return B};if(w&&$.push(z(o,l)),b&&$.push(z(s,l)),x){var L=t.makeTensorInfo([],"float32",k.util.createScalarValue(d,"float32"));$.push(L),y.push(L)}return $};if(v.filterHeight===1&&v.filterWidth===1&&v.dilationHeight===1&&v.dilationWidth===1&&v.strideHeight===1&&v.strideWidth===1&&(v.padInfo.type==="SAME"||v.padInfo.type==="VALID"))g=XW({x:a,filter:i,convInfo:v,backend:t,bias:o,activation:p,preluActivationWeights:s,leakyreluAlpha:d});else if(v.strideWidth<=2&&m==="channelsLast"&&k.env().getBool("WEBGL_EXP_CONV")){var T=p?vh(p,!0):null,E=new jW(v,w,T,b,x),C=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],R=S();g=t.runWebGLProgram(E,R,"float32",C)}else if(k.env().getBool("WEBGL_CONV_IM2COL"))g=YW({x:a,filter:i,convInfo:v,backend:t,bias:o,activation:p,preluActivationWeights:s,leakyreluAlpha:d});else{var T=p?vh(p,!1):null,E=new KW(v,w,T,b,x),_=S();g=t.runWebGLProgram(E,_,"float32")}var O=Ae({inputs:{x:g},backend:t,attrs:{shape:v.outShape}});return y.push(g),y.forEach(function($){return t.disposeIntermediateTensorInfo($)}),O}var MHe={kernelName:k.FusedConv2D,backendName:"webgl",kernelFunc:PHe};function BHe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=n.strides,c=n.pad,l=n.dilations,f=n.dimRoundingMode,h=n.activation,p=n.leakyreluAlpha,d=[],m=l;m==null&&(m=[1,1]),k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(u,m),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(u," and dilations '").concat(m,"'")});var v=k.backend_util.computeConv2DInfo(a.shape,i.shape,u,m,c,f,!0),g=k.env().getBool("WEBGL_PACK_DEPTHWISECONV")&&v.strideWidth<=2&&v.outChannels/v.inChannels===1,y=h?vh(h,g):null,w=[a,i],b=o!=null,x=s!=null,S=h==="leakyrelu";if(b&&w.push(o),x&&w.push(s),S){var T=t.makeTensorInfo([],"float32",k.util.createScalarValue(p,"float32"));w.push(T),d.push(T)}var E;g?E=new QW(v,b,y,x,S):E=new JW(v,b,y,x,S);var C=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],R=t.runWebGLProgram(E,w,"float32",C);return d.forEach(function(_){return t.disposeIntermediateTensorInfo(_)}),R}var LHe={kernelName:k.FusedDepthwiseConv2D,backendName:"webgl",kernelFunc:BHe},zHe=function(){function r(e,t,n,a){this.sliceDim=e,this.strides=t,this.paramsShape=a,this.variableNames=["x","indices"],this.outputShape=n;for(var i=Lt(n.length),o=`
    int index;`,s=0;s<this.sliceDim;s++)o+=`
          index = round(getIndices(coords[0], `.concat(s,`));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= `).concat(this.paramsShape[s],`;
          flattenIndex += index * `).concat(this.strides[s],";");this.userCode=`
         void main() {
          `.concat(i,` coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          `).concat(o,`

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `)}return r}();function $He(r){var e=r.inputs,t=r.backend,n=e.params,a=e.indices,i=a.shape,o=i[i.length-1],s=k.util.sizeFromShape(n.shape),u=Te(k.backend_util.prepareAndValidate(n,a),4),c=u[0],l=u[1],f=u[2],h=u[3],p=Ae({inputs:{x:a},backend:t,attrs:{shape:[l,o]}}),d=Ae({inputs:{x:n},backend:t,attrs:{shape:[k.util.sizeFromShape(n.shape)/f,f]}});if(t.shouldExecuteOnCPU([n,a])||n.dtype==="string"){var m=t.readSync(a.dataId),v=t.bufferSync(n),g=WWe(m,v,n.dtype,l,o,f,h,n.shape,s);return t.makeTensorInfo(c,n.dtype,g.values)}var y=new zHe(o,h,[l,f],n.shape),w=t.runWebGLProgram(y,[d,p],d.dtype),b=Ae({inputs:{x:w},backend:t,attrs:{shape:c}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(w),b}var qHe={kernelName:k.GatherNd,backendName:"webgl",kernelFunc:$He};var WHe=function(){function r(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;var n=Lt(this.rank),a=VHe(e);this.userCode=`
      void main() {
        `.concat(n,` resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < `).concat(e[2],`) ? 1.0 : 0.0;
        setOutput(inBounds * getA(`).concat(a,`));
      }
    `)}return r}();function VHe(r,e){for(var t=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[],a=0;a<r.length;a++)a===2?n.push("index"):n.push("".concat(t[a]));return n.join()}function rV(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.indices,o=n.axis,s=n.batchDims,u=k.util.parseAxisParam(o,a.shape)[0];if(k.env().get("DEBUG"))for(var c=t.readSync(i.dataId),l=a.shape[u],f=function(C){var R=c[C];k.util.assert(R<=l-1&&R>=0,function(){return"GatherV2: the index value ".concat(R," is not in [0, ").concat(l-1,"]")})},h=0;h<c.length;++h)f(h);var p=k.backend_util.segment_util.collectGatherOpShapeInfo(a,i,u,s),d=k.util.sizeFromShape(i.shape),m=[],v=Ae({inputs:{x:a},backend:t,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),g=Ae({inputs:{x:i},backend:t,attrs:{shape:[p.batchSize,d/p.batchSize]}});m.push(v),m.push(g);var y=[p.batchSize,p.outerSize,d/p.batchSize,p.sliceSize];if(t.shouldExecuteOnCPU([a,i])||a.dtype==="string"){var w=t.bufferSync(g),b=t.bufferSync(v),x=VWe(b,w,y);return m.forEach(function(C){return t.disposeIntermediateTensorInfo(C)}),t.makeTensorInfo(p.outputShape,x.dtype,x.values)}var S=new WHe(v.shape,y),T=t.runWebGLProgram(S,[v,g],v.dtype);m.push(T);var E=Ae({inputs:{x:T},backend:t,attrs:{shape:p.outputShape}});return m.forEach(function(C){return t.disposeIntermediateTensorInfo(C)}),E}var UHe={kernelName:k.GatherV2,backendName:"webgl",kernelFunc:rV};var GHe="return float(a > b);",HHe=`
  return vec4(greaterThan(a, b));
`,KHe=un({opSnippet:GHe,packedOpSnippet:HHe,cpuKernelImpl:UWe,dtype:"bool"}),jHe={kernelName:k.Greater,backendName:"webgl",kernelFunc:KHe};var XHe="return float(a >= b);",YHe=`
  return vec4(greaterThanEqual(a, b));
`,ZHe=un({opSnippet:XHe,packedOpSnippet:YHe,dtype:"bool",cpuKernelImpl:GWe}),JHe={kernelName:k.GreaterEqual,backendName:"webgl",kernelFunc:ZHe};function QHe(r){var e=r.inputs,t=r.backend,n=e.input;return tV(n,!0,t)}var e5e={kernelName:k.IFFT,backendName:"webgl",kernelFunc:QHe};var t5e="return float(!isnan(x) && !isinf(x));",r5e=Nt({opSnippet:t5e,dtype:"bool"}),n5e={kernelName:k.IsFinite,backendName:"webgl",kernelFunc:r5e};var a5e="return float(isinf(x));",i5e=Nt({opSnippet:a5e,dtype:"bool"}),o5e={kernelName:k.IsInf,backendName:"webgl",kernelFunc:i5e};var s5e="return float(isnan(x));",u5e=Nt({opSnippet:s5e,dtype:"bool"}),c5e={kernelName:k.IsNan,backendName:"webgl",kernelFunc:u5e};var l5e="return float(a < b);",f5e=`
  return vec4(lessThan(a, b));
`,h5e=un({opSnippet:l5e,packedOpSnippet:f5e,cpuKernelImpl:HWe,dtype:"bool"}),p5e={kernelName:k.Less,backendName:"webgl",kernelFunc:h5e};var d5e="return float(a <= b);",v5e=`
  return vec4(lessThanEqual(a, b));
`,m5e=un({opSnippet:d5e,packedOpSnippet:v5e,cpuKernelImpl:KWe,dtype:"bool"}),g5e={kernelName:k.LessEqual,backendName:"webgl",kernelFunc:m5e};function y5e(r){var e=r.backend,t=r.attrs,n=t.start,a=t.stop,i=t.num,o=jWe(n,a,i);return e.makeTensorInfo([o.length],"float32",o)}var b5e={kernelName:k.LinSpace,backendName:"webgl",kernelFunc:y5e};var w5e=Yc+`
  return x < 0.0 ? 0./0. : log(x);
`,x5e=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,k5e=Nt({opSnippet:w5e,packedOpSnippet:x5e,cpuKernelImpl:XWe}),S5e={kernelName:k.Log,backendName:"webgl",kernelFunc:k5e};var N5e=Yc+`
  return log(1.0 + x);
`,T5e=Nt({opSnippet:N5e}),E5e={kernelName:k.Log1p,backendName:"webgl",kernelFunc:T5e};var I5e="return float(a >= 1.0 && b >= 1.0);",C5e=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,A5e=un({opSnippet:I5e,packedOpSnippet:C5e,dtype:"bool"}),D5e={kernelName:k.LogicalAnd,backendName:"webgl",kernelFunc:A5e};var _5e="return float(!(x >= 1.0));",F5e=Nt({opSnippet:_5e}),R5e={kernelName:k.LogicalNot,backendName:"webgl",kernelFunc:F5e};var O5e="return float(a >= 1.0 || b >= 1.0);",P5e=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,M5e=un({opSnippet:O5e,packedOpSnippet:P5e,dtype:"bool"}),B5e={kernelName:k.LogicalOr,backendName:"webgl",kernelFunc:M5e};var L5e=function(){function r(e,t,n,a,i){this.variableNames=["x"],this.outputShape=[];var o=t,s=e[3]-1;this.outputShape=e;var u,c="float(".concat(n,") + float(").concat(a,") * sum");i===.5?u="inversesqrt(".concat(c,")"):i===1?u="1.0/(".concat(c,")"):u="exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`.concat(o,"; j <= ").concat(o,`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `).concat(s,`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `).concat(u,`;
        setOutput(val);
      }
    `)}return r}();var z5e=function(){function r(e,t,n,a,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o=t,s=e[3]-1;this.outputShape=e;var u,c="float(".concat(n,") + float(").concat(a,") * sum");i===.5?u="inversesqrt(".concat(c,")"):i===1?u="1.0/(".concat(c,")"):u="exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `.concat(this.outputShape[3],`;
        bool hasNextRow = c < `).concat(this.outputShape[2],`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `).concat(o,`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `).concat(o,"; j <= ").concat(o,`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`).concat(s,`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `).concat(u,`;
        setOutput(result);
      }
    `)}return r}();var $5e=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.depthRadius,o=n.bias,s=n.alpha,u=n.beta,c=k.env().getBool("WEBGL_PACK_NORMALIZATION")?new z5e(a.shape,i,o,s,u):new L5e(a.shape,i,o,s,u);return t.runWebGLProgram(c,[a],a.dtype)},q5e={kernelName:k.LRN,backendName:"webgl",kernelFunc:$5e};var W5e=function(){function r(e,t,n,a,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=a,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `.concat(this.depth,`; ++d) {
          int depthBegin = int(max(0.0, float(d - `).concat(t,`)));
          int depthEnd = int(min(float(`).concat(this.depth,`),
              float(d + `).concat(t,` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `).concat(this.depth,`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`).concat(a,") * norm + float(").concat(n,`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`).concat(a,`)
                * float(`).concat(i,`)
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `).concat(i,`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `)}return r}();var V5e=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.y,o=e.dy,s=n.depthRadius,u=n.bias,c=n.alpha,l=n.beta,f=new W5e(a.shape,s,u,c,l);return t.runWebGLProgram(f,[a,i,o],a.dtype)},U5e={kernelName:k.LRNGrad,backendName:"webgl",kernelFunc:V5e};function G5e(r,e,t,n){var a=k.util.sizeFromShape(e),i=k.util.sizeFromShape(r.shape),o=i/a,s=Ae({inputs:{x:r},attrs:{shape:[o,a]},backend:n}),u=Nu(s,r.dtype,"max",n),c=Ae({inputs:{x:u},attrs:{shape:t},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),c}function nV(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.reductionIndices,o=n.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=l!=null,h=t.shouldExecuteOnCPU([a]),p=a;if(f){if(h){for(var d=t.texData.get(p.dataId),m=d.values,v=new Array(s),g=0;g<v.length;g++)v[g]=a.shape[l[g]];var y=jx(m,a.shape,a.dtype,l,v);p=t.makeTensorInfo(v,a.dtype);var w=t.texData.get(p.dataId);w.values=y}else p=gm(a,l,t);c=k.backend_util.getInnerMostAxes(c.length,s)}k.backend_util.assertAxesAreInnerMostDims("max",c,s);var b=Te(k.backend_util.computeOutAndReduceShapes(p.shape,c),2),x=b[0],S=b[1],T=x;o&&(T=k.backend_util.expandShapeToKeepDim(x,u));var E;if(h){var d=t.texData.get(p.dataId),m=d.values,C=YWe(m,k.util.sizeFromShape(S),T,a.dtype);E=t.makeTensorInfo(T,a.dtype);var R=t.texData.get(E.dataId);R.values=C}else E=G5e(p,S,T,t);return f&&t.disposeIntermediateTensorInfo(p),E}var H5e={kernelName:k.Max,backendName:"webgl",kernelFunc:nV};var K5e=Yx+`
  return max(a, b);
`,j5e=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Su+`
  return result;
`,X5e=un({opSnippet:K5e,packedOpSnippet:j5e,cpuKernelImpl:ZWe}),Y5e={kernelName:k.Maximum,backendName:"webgl",kernelFunc:X5e};function Z5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;Uc(a,"maxPool");var i=n.filterSize,o=n.strides,s=n.pad,u=n.dimRoundingMode,c=1;k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=k.backend_util.computePool2DInfo(a.shape,i,o,c,s,u);if(l.filterWidth===1&&l.filterHeight===1&&k.util.arraysEqual(l.inShape,l.outShape))return ca({inputs:{x:a},backend:t});var f=new mh(l,"max",!1);return t.runWebGLProgram(f,[a],a.dtype)}var J5e={kernelName:k.MaxPool,backendName:"webgl",kernelFunc:Z5e};function Q5e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode,l=[1,1,1],f=k.backend_util.computePool3DInfo(a.shape,i,o,l,s,c,u),h=new Jx(f,"max",!1);return t.runWebGLProgram(h,[a],a.dtype)}var eKe={kernelName:k.MaxPool3D,backendName:"webgl",kernelFunc:Q5e};var tKe=function(){function r(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,n=e.strideWidth,a=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,s=i-1-e.padInfo.top,u=o-1-e.padInfo.left,c=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(`.concat(s,", ").concat(u,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(i,`;
          wR += `).concat(a,`) {
          float dyR = float(dyRCorner + wR) / `).concat(t,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `).concat(o,`; wC++) {
            float dyC = float(dyCCorner + wC) / `).concat(n,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `).concat(c,` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `).concat(o,` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `)}return r}(),rKe=function(){function r(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,n=e.strideHeight,a=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterDepth,c=e.effectiveFilterHeight,l=e.effectiveFilterWidth,f=u-1-e.padInfo.front,h=c-1-e.padInfo.top,p=l-1-e.padInfo.left,d=u*c*l-1;this.userCode=`
      const ivec3 pads = ivec3(`.concat(f,", ").concat(h,", ").concat(p,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `).concat(u,`;
           wD += `).concat(i,`) {
          float dyD = float(dyDCorner + wD) / `).concat(t,`.0;

          if (dyD < 0.0 || dyD >= `).concat(e.outDepth,`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `).concat(c,`;
              wR += `).concat(o,`) {
            float dyR = float(dyRCorner + wR) / `).concat(n,`.0;

            if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `).concat(l,`;
                wC += `).concat(s,`) {
              float dyC = float(dyCCorner + wC) / `).concat(a,`.0;

              if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `).concat(d,` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `).concat(c," * ").concat(l,` +
                  wR * `).concat(l,` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return r}();function nKe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=i,s=n.filterSize,u=n.strides,c=n.pad,l=n.dimRoundingMode,f=[1,1,1],h=k.backend_util.computePool3DInfo(o.shape,s,u,f,c,l),p=new Jx(h,"max",!0),d=t.runWebGLProgram(p,[o],o.dtype),m=new rKe(h),v=t.runWebGLProgram(m,[a,d],o.dtype);return t.disposeIntermediateTensorInfo(d),v}var aKe={kernelName:k.MaxPool3DGrad,backendName:"webgl",kernelFunc:nKe};function iKe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.dy,i=e.input,o=e.output,s=i;Uc([i,o],"maxPoolGrad");var u=n.filterSize,c=n.strides,l=n.pad,f=n.dimRoundingMode,h=k.backend_util.computePool2DInfo(s.shape,u,c,1,l,f),p=!0,d=new mh(h,"max",p),m=t.runWebGLProgram(d,[s],s.dtype),v=new tKe(h),g=t.runWebGLProgram(v,[a,m],s.dtype);return t.disposeIntermediateTensorInfo(m),g}var oKe={kernelName:k.MaxPoolGrad,backendName:"webgl",kernelFunc:iKe};function sKe(r,e,t,n){var a=new mh(t,"max",!1),i=n.runWebGLProgram(a,[r],"float32");a=new mh(t,"max",!0,!0,e);var o=n.runWebGLProgram(a,[r],"float32");return[i,o]}var uKe={kernelName:k.MaxPoolWithArgmax,backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.x,i=t.filterSize,o=t.strides,s=t.pad,u=t.includeBatchInIndex,c=n;k.util.assert(a.shape.length===4,function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,".")});var l=[1,1];k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,l),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(l,"'")});var f=k.backend_util.computePool2DInfo(a.shape,i,o,l,s),h=Te(sKe(a,u,f,c),2),p=h[0],d=h[1];return[p,d]}};function cKe(r,e,t,n){var a=k.util.sizeFromShape(e),i=k.util.sizeFromShape(r.shape),o=i/a,s=Ae({inputs:{x:r},attrs:{shape:[o,a]},backend:n}),u=Nu(s,"float32","mean",n),c=Ae({inputs:{x:u},attrs:{shape:t},backend:n});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(u),c}var lKe={kernelName:k.Mean,backendName:"webgl",kernelFunc:function(r){var e,t,n=r.inputs,a=r.attrs,i=r.backend,o=n.x,s=a.keepDims,u=a.axis,c=i,l=o.shape.length,f=k.util.parseAxisParam(u,o.shape),h=f,p=k.backend_util.getAxesPermutation(h,l),d=p!=null,m=c.shouldExecuteOnCPU([o]),v=[],g=o;if(d){if(m){for(var y=c.texData.get(g.dataId),w=y.values,b=new Array(l),x=0;x<b.length;x++)b[x]=o.shape[p[x]];var S=jx(w,o.shape,o.dtype,p,b);g=c.makeTensorInfo(b,o.dtype);var T=c.texData.get(g.dataId);T.values=S}else g=gm(o,p,c);v.push(g),h=k.backend_util.getInnerMostAxes(h.length,l)}k.backend_util.assertAxesAreInnerMostDims("sum",h,l);var E=Te(k.backend_util.computeOutAndReduceShapes(g.shape,h),2),C=E[0],R=E[1],_=C;s&&(_=k.backend_util.expandShapeToKeepDim(C,f));var O=cKe(g,R,_,c);try{for(var $=kn(v),z=$.next();!z.done;z=$.next()){var x=z.value;c.disposeIntermediateTensorInfo(x)}}catch(L){e={error:L}}finally{try{z&&!z.done&&(t=$.return)&&t.call($)}finally{if(e)throw e.error}}return O}};function fKe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=a;l!=null&&(f=Sn({inputs:{x:a},backend:t,attrs:{perm:l}}),c=k.backend_util.getInnerMostAxes(c.length,a.shape.length)),k.backend_util.assertAxesAreInnerMostDims("min",c,s);var h=Te(k.backend_util.computeOutAndReduceShapes(f.shape,c),2),p=h[0],d=h[1],m=k.util.sizeFromShape(d),v=Ae({inputs:{x:f},backend:t,attrs:{shape:[-1,m]}}),g=Nu(v,v.dtype,"min",t),y;if(o){var w=k.backend_util.expandShapeToKeepDim(p,u);y=Ae({inputs:{x:g},backend:t,attrs:{shape:w}})}else y=Ae({inputs:{x:g},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(g),l!=null&&t.disposeIntermediateTensorInfo(f),y}var hKe={kernelName:k.Min,backendName:"webgl",kernelFunc:fKe};var pKe=Yx+`
  return min(a, b);
`,dKe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+Su+`
  return result;
`,vKe=un({opSnippet:pKe,packedOpSnippet:dKe,cpuKernelImpl:JWe}),mKe={kernelName:k.Minimum,backendName:"webgl",kernelFunc:vKe};var gKe=function(){function r(e,t,n){this.variableNames=["x"],this.outputShape=t.map(function(l,f){return l[0]+e[f]+l[1]});var a=e.length,i=Lt(a),o=t.map(function(l){return l[0]}).join(","),s=t.map(function(l,f){return l[0]+e[f]}).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),c=n==="reflect"?0:1;if(a===1){this.userCode=`
        int start = `.concat(o,`;
        int end = `).concat(s,`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - `).concat(c,`;
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + `).concat(c,`;
          }
          setOutput(getX(outC - start));
        }
      `);return}this.userCode=`
      `.concat(i," start = ").concat(i,"(").concat(o,`);
      `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outC = getOutputCoords();
        for (int i = 0; i < `).concat(a,`; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - `).concat(c,`;
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + `).concat(c,`;
          }
        }
        `).concat(i,` coords = outC - start;
        setOutput(getX(`).concat(u,`));
      }
    `)}return r}();var yKe=function(){function r(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(m,v){return m[0]+e[v]+m[1]});var a=e.length,i=Lt(a),o=t.map(function(m){return m[0]}).join(","),s=t.map(function(m,v){return m[0]+e[v]}).join(","),u=xn("rc",a),c=xn("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),f=a===1?"source":"vec2(".concat(c.slice(-2).join(),")"),h=n==="reflect"?0:1,p="";if(a===1){var d=`
        `.concat(i,` source = rc;
        if (source < start) {
          source = start * 2 - source - `).concat(h,`;
        } else if (source >= end) {
          source = (end - 1) * 2 - source + `).concat(h,`;
        }
        source -= start;
      `);p=`
        `.concat(i,` rc = outputLoc;
        `).concat(d,`
        result[0] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        `).concat(u[a-1],` += 1;
        if(`).concat(l,`) {
          `).concat(d,`
          result[1] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        }
      `)}else{var d=`
        `.concat(i,` source = rc;
        `).concat(i," lt = ").concat(i,`(lessThan(source, start));
        `).concat(i," gte = ").concat(i,`(greaterThanEqual(source, end));
        `).concat(i,` orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - `).concat(h,`) +
                gte * ((end - 1) * 2 - source + `).concat(h,`);
        source -= start;
      `);p=`
        `.concat(i,` rc = outputLoc;
        `).concat(d,`
        result[0] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        `).concat(u[a-1],` += 1;
        if(`).concat(l,`) {
          `).concat(d,`
          result[1] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        }
        rc = outputLoc;
        `).concat(u[a-2],` += 1;
        if(`).concat(u[a-2]," < ").concat(this.outputShape[a-2],`) {
          `).concat(d,`
          result[2] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
          `).concat(u[a-1],` += 1;
          if(`).concat(l,`) {
            `).concat(d,`
            result[3] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
          }
        }
      `)}this.userCode=`
      const `.concat(i," start = ").concat(i,"(").concat(o,`);
      const `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `).concat(p,`
        setOutput(result);
      }
    `)}return r}();var bKe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.paddings,o=n.mode,s=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new yKe(a.shape,i,o):new gKe(a.shape,i,o),u=t.runWebGLProgram(s,[a],a.dtype);return u},wKe={kernelName:k.MirrorPad,backendName:"webgl",kernelFunc:bKe};var xKe=`if (b == 0.0) return NAN;
  return mod(a, b);`,kKe=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+Su+`
  return result;
`,SKe=un({opSnippet:xKe,packedOpSnippet:kKe}),NKe={kernelName:k.Mod,backendName:"webgl",kernelFunc:SKe};var TKe=function(){function r(e,t,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `.concat(t-1,`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`).concat(t-1,`));
      }
    `)}return r}();var EKe=`
if (a == b) {
  return 1.0;
};
return a / b;`,IKe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,aV=un({opSnippet:EKe,packedOpSnippet:IKe,checkOutOfBounds:!0}),CKe={kernelName:k.RealDiv,backendName:"webgl",kernelFunc:aV};var Dq="return a - b;",iV=un({opSnippet:Dq,packedOpSnippet:Dq,supportsComplex:!0,cpuKernelImpl:bVe}),AKe={kernelName:k.Sub,backendName:"webgl",kernelFunc:iV};function oV(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.logits,i=n.dim,o=k.util.parseAxisParam([i],a.shape),s=nV({inputs:{x:a},backend:t,attrs:{reductionIndices:o,keepDims:!1}}),u=k.backend_util.expandShapeToKeepDim(s.shape,o),c=Ae({inputs:{x:s},backend:t,attrs:{shape:u}}),l=iV({inputs:{a,b:c},backend:t}),f=eV({inputs:{x:l},backend:t}),h=ym({inputs:{x:f},backend:t,attrs:{axis:o,keepDims:!1}}),p=Ae({inputs:{x:h},backend:t,attrs:{shape:u}}),d=aV({inputs:{a:f,b:p},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),d}var DKe={kernelName:k.Softmax,backendName:"webgl",kernelFunc:oV};function _Ke(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.logits,i=n.numSamples,o=n.seed,s=n.normalized,u=s?a:oV({inputs:{logits:a},backend:t,attrs:{dim:a.shape.length-1}}),c=u.shape[0],l=u.shape[1],f=new TKe(c,l,i),h=[[o]],p=t.runWebGLProgram(f,[u],"int32",h);return s||t.disposeIntermediateTensorInfo(u),p}var FKe={kernelName:k.Multinomial,backendName:"webgl",kernelFunc:_Ke},RKe=Ja+`
  return -x;
`,OKe=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function PKe(r){var e=r.inputs,t=r.backend,n=e.x;if(t.shouldExecuteOnCPU([n])){var a=t.texData.get(n.dataId),i=Te(eVe(a.values,n.shape,n.dtype),2),o=i[0],s=i[1];return t.makeTensorInfo(s,n.dtype,o)}var u;return k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")?u=new os(n.shape,OKe):u=new qi(n.shape,RKe),t.runWebGLProgram(u,[n],n.dtype)}var MKe={kernelName:k.Neg,backendName:"webgl",kernelFunc:PKe};var BKe=k.kernel_impls.nonMaxSuppressionV3Impl;function LKe(r){k.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,c=t.readSync(a.dataId),l=t.readSync(i.dataId),f=BKe(c,l,o,s,u).selectedIndices;return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}var zKe={kernelName:k.NonMaxSuppressionV3,backendName:"webgl",kernelFunc:LKe};var $Ke=k.kernel_impls.nonMaxSuppressionV4Impl;function qKe(r){k.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,c=n.padToMaxOutputSize,l=t.readSync(a.dataId),f=t.readSync(i.dataId),h=$Ke(l,f,o,s,u,c),p=h.selectedIndices,d=h.validOutputs;return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([d]))]}var WKe={kernelName:k.NonMaxSuppressionV4,backendName:"webgl",kernelFunc:qKe};var VKe=k.kernel_impls.nonMaxSuppressionV5Impl;function UKe(r){k.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=r.inputs,t=r.backend,n=r.attrs,a=e.boxes,i=e.scores,o=n.maxOutputSize,s=n.iouThreshold,u=n.scoreThreshold,c=n.softNmsSigma,l=t.readSync(a.dataId),f=t.readSync(i.dataId),h=o,p=s,d=u,m=c,v=VKe(l,f,h,p,d,m),g=v.selectedIndices,y=v.selectedScores;return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var GKe={kernelName:k.NonMaxSuppressionV5,backendName:"webgl",kernelFunc:UKe};var HKe=function(){function r(e,t,n,a){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`.concat(a,"), float(").concat(n,`),
                      float(index == coords.y)));
      }
    `)}return r}(),KKe=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.indices,i=n.dtype,o=n.depth,s=n.onValue,u=n.offValue,c=k.util.sizeFromShape(a.shape),l=new HKe(c,o,s,u),f=Ae({inputs:{x:a},backend:t,attrs:{shape:[c]}}),h=t.runWebGLProgram(l,[f],i);t.disposeIntermediateTensorInfo(f);var p=pr(pr([],Te(a.shape),!1),[o],!1),d=Ae({inputs:{x:h},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(h),d},jKe={kernelName:k.OneHot,backendName:"webgl",kernelFunc:KKe};function vm(r){var e=r.inputs,t=r.backend,n=e.x;if(n.dtype==="complex64"){var a=wh({inputs:{input:n},backend:t}),i=vm({inputs:{x:a},backend:t}),o=bm({inputs:{input:n},backend:t}),s=vm({inputs:{x:o},backend:t}),u=ss({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return xh({attrs:{shape:n.shape,dtype:n.dtype,value:n.dtype==="string"?"":0},backend:t})}var XKe={kernelName:k.ZerosLike,backendName:"webgl",kernelFunc:vm};function sV(r){var e=r.inputs,t=r.backend,n=e.x;if(n.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(n.dtype==="complex64"){var a=wh({inputs:{input:n},backend:t}),i=sV({inputs:{x:a},backend:t}),o=bm({inputs:{input:n},backend:t}),s=vm({inputs:{x:o},backend:t}),u=ss({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return xh({attrs:{shape:n.shape,dtype:n.dtype,value:1},backend:t})}var YKe={kernelName:k.OnesLike,backendName:"webgl",kernelFunc:sV};function ZKe(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.axis;if(e.length===1)return Bx({inputs:{input:e[0]},backend:t,attrs:{dim:a}});var i=e[0].shape,o=e[0].dtype;e.forEach(function(l){k.util.assertShapesMatch(i,l.shape,"All tensors passed to stack must have matching shapes"),k.util.assert(o===l.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=[],u=e.map(function(l){var f=Bx({inputs:{input:l},backend:t,attrs:{dim:a}});return s.push(f),f}),c=HW({inputs:u,backend:t,attrs:{axis:a}});return s.forEach(function(l){return t.disposeIntermediateTensorInfo(l)}),c}var JKe={kernelName:k.Pack,backendName:"webgl",kernelFunc:ZKe};var QKe=function(){function r(e,t,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(function(c,l){return c[0]+e[l]+c[1]});var a=e.length,i=Lt(a),o=t.map(function(c){return c[0]}).join(","),s=t.map(function(c,l){return c[0]+e[l]}).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);if(a===1){this.userCode=`
        int start = `.concat(o,`;
        int end = `).concat(s,`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `);return}this.userCode=`
      `.concat(i," start = ").concat(i,"(").concat(o,`);
      `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          `).concat(i,` coords = outC - start;
          setOutput(getX(`).concat(u,`));
        }
      }
    `)}return r}();var eje=function(){function r(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(function(g,y){return g[0]+e[y]+g[1]});for(var a=e.length,i=Lt(a),o=t.map(function(g){return g[0]}).join(","),s=t.map(function(g,y){return g[0]+e[y]}).join(","),u=xn("rc",a),c=xn("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),f=a===1?"source":"vec2(".concat(c.slice(-2).join(),")"),h=["".concat(i," rc = outputLoc;"),"".concat(u[a-1],` += 1;
       if(`).concat(l,`) {
      `),a===1?"":`}
       rc = outputLoc;
       `.concat(u[a-2],` += 1;
       if(`).concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),a===1?"":"  ".concat(u[a-1],` += 1;
         if(`).concat(l,") {")],p=a===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",d="",m=0,v=a===1?2:4;m<v;m++)d+=`
        `.concat(h[m],`
        if (`).concat(p,`) {
          result[`).concat(m,`] = float(value);
        } else {
          `).concat(i,` source = rc - start;
          result[`).concat(m,"] = getChannel(getX(").concat(c.join(),"), ").concat(f,`);
        }
      `);d+=a===1?"} ":"}}",this.userCode=`
      const `.concat(i," start = ").concat(i,"(").concat(o,`);
      const `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `).concat(d,`
        setOutput(result);
      }
    `)}return r}();var uV=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.paddings,o=n.constantValue;if(k.util.sizeFromShape(a.shape)===0){var s=i.map(function(l,f){return l[0]+a.shape[f]+l[1]});return xh({backend:t,attrs:{shape:s,value:o,dtype:a.dtype}})}var u=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new eje(a.shape,i,o):new QKe(a.shape,i,o),c=[[o]];return t.runWebGLProgram(u,[a],a.dtype,c)},tje={kernelName:k.PadV2,backendName:"webgl",kernelFunc:uV};var rje=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,nje=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+Su+`
  return result;
`,aje=un({opSnippet:rje,packedOpSnippet:nje}),ije={kernelName:k.Pow,backendName:"webgl",kernelFunc:aje};function oje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.axis,o=n.keepDims,s=a.shape.length,u=[],c=k.util.parseAxisParam(i,a.shape),l=c,f=k.backend_util.getAxesPermutation(l,s),h=a;f!=null&&(h=Sn({inputs:{x:a},backend:t,attrs:{perm:f}}),l=k.backend_util.getInnerMostAxes(l.length,s),u.push(h)),k.backend_util.assertAxesAreInnerMostDims("prod",l,s);var p;if(t.shouldExecuteOnCPU([h])){var d=t.texData.get(h.dataId).values,m=rVe(h.shape,h.dtype,d,l),v=m.outVals,g=m.outShape,y=m.outDtype;p=t.makeTensorInfo(g,y,v)}else{var w=Te(k.backend_util.computeOutAndReduceShapes(h.shape,l),2),g=w[0],b=w[1],x=k.util.sizeFromShape(b),S=Ae({inputs:{x:h},backend:t,attrs:{shape:[-1,x]}}),T=k.sumOutType(a.dtype),E=Nu(S,T,"prod",t);p=Ae({inputs:{x:E},backend:t,attrs:{shape:g}}),u.push(S),u.push(E)}if(o){u.push(p);var C=k.backend_util.expandShapeToKeepDim(p.shape,c);p=Ae({inputs:{x:p},backend:t,attrs:{shape:C}})}return u.forEach(function(R){return t.disposeIntermediateTensorInfo(R)}),p}var sje={kernelName:k.Prod,backendName:"webgl",kernelFunc:oje};function uje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.paramsNestedSplits,i=e.paramsDenseValues,o=e.indices;n.outputRaggedRank;var s=a.map(function(g){return t.readSync(g.dataId)}),u=a.map(function(g){return g.shape}),c=t.readSync(i.dataId),l=t.readSync(o.dataId),f=Te(nVe(s,u,c,i.shape,i.dtype,l,o.shape),3),h=f[0],p=f[1],d=f[2],m=h.map(function(g){return t.makeTensorInfo([g.length],"int32",g)}),v=t.makeTensorInfo(d,i.dtype,p);return m.concat([v])}var cje={kernelName:k.RaggedGather,backendName:"webgl",kernelFunc:uje};function lje(r){var e=r.inputs,t=r.backend,n=e.starts,a=e.limits,i=e.deltas,o=t.readSync(n.dataId),s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=Te(aVe(o,n.shape,n.dtype,s,a.shape,u,i.shape),2),l=c[0],f=c[1],h=t.makeTensorInfo([l.length],"int32",l),p=t.makeTensorInfo([f.length],n.dtype,f);return[h,p]}var fje={kernelName:k.RaggedRange,backendName:"webgl",kernelFunc:lje};function hje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.shape,i=e.values,o=e.defaultValue,s=e.rowPartitionTensors,u=n.rowPartitionTypes,c=t.readSync(a.dataId),l=t.readSync(i.dataId),f=t.readSync(o.dataId),h=s.map(function(g){return t.readSync(g.dataId)}),p=s.map(function(g){return g.shape}),d=Te(iVe(c,a.shape,l,i.shape,i.dtype,f,o.shape,h,p,u),2),m=d[0],v=d[1];return t.makeTensorInfo(m,i.dtype,v)}var pje={kernelName:k.RaggedTensorToTensor,backendName:"webgl",kernelFunc:hje};var cV=function(r){var e=r.backend,t=r.attrs,n=t.start,a=t.stop,i=t.step,o=t.dtype,s=oVe(n,a,i,o);return e.makeTensorInfo([s.length],o,s)},dje={kernelName:k.Range,backendName:"webgl",kernelFunc:cV};var vje="return 1.0 / x;",mje=Nt({opSnippet:vje}),gje={kernelName:k.Reciprocal,backendName:"webgl",kernelFunc:mje};var yje=Ja+`
  return (x < 0.0) ? 0.0 : x;
`,bje=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,wje=Nt({opSnippet:yje,packedOpSnippet:bje}),xje={kernelName:k.Relu,backendName:"webgl",kernelFunc:wje};var kje=Ja+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Sje=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Nje=Nt({opSnippet:kje,packedOpSnippet:Sje}),Tje={kernelName:k.Relu6,backendName:"webgl",kernelFunc:Nje};var Eje=function(){function r(e,t,n,a,i){this.variableNames=["A"],this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,n,l];var f=[a&&t>1?u-1:u,a&&n>1?c-1:c],h=[a&&t>1?t-1:t,a&&n>1?n-1:n],p;i?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`);
      const vec2 inputShapeRC = vec2(`).concat(u,".0, ").concat(c,`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = `).concat(p,`;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `)}return r}();var Ije=function(){function r(e,t,n,a,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,n,l];var f=[a&&t>1?u-1:u,a&&n>1?c-1:c],h=[a&&t>1?t-1:t,a&&n>1?n-1:n],p;i?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`,
          `).concat(f[1]/h[1],`);
      const vec3 inputShapeRC = vec3(`).concat(u,".0, ").concat(c,`.0,
                                     `).concat(c,`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = `).concat(p,`;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `).concat(l-1,`;
        bool hasNextRow = coords.z < `).concat(n-1,`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `)}return r}();function Cje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=n.alignCorners,o=n.halfPixelCenters,s=n.size,u=Te(s,2),c=u[0],l=u[1],f=k.env().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Ije(a.shape,c,l,i,o):new Eje(a.shape,c,l,i,o);return t.runWebGLProgram(f,[a],"float32")}var Aje={kernelName:k.ResizeBilinear,backendName:"webgl",kernelFunc:Cje};var Dje=function(){function r(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;var a=Te(t,3),i=a[1],o=a[2],s=Te(e,3),u=s[1],c=s[2],l=[n&&u>1?i-1:i,n&&c>1?o-1:o],f=[n&&u>1?u-1:u,n&&c>1?c-1:c],h=l[0]/f[0],p=l[1]/f[1],d=1/h,m=1/p,v=Math.ceil(d)*2+2,g=Math.ceil(m)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`.concat(h,`);
        const float widthScale = float(`).concat(p,`);

        const float invHeightScale = float(`).concat(d,`);
        const float invWidthScale = float(`).concat(m,`);

        const int winHeight = int(`).concat(v,`);
        const int winWidth = int(`).concat(g,`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `).concat(u,`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `).concat(c,`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `).concat(i-1,`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `).concat(o-1,`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `)}return r}();function _je(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=e.dy,o=n.alignCorners,s=new Dje(i.shape,a.shape,o);return t.runWebGLProgram(s,[i],i.dtype)}var Fje={kernelName:k.ResizeBilinearGrad,backendName:"webgl",kernelFunc:_je};var Rje=function(){function r(e,t,n,a,i){this.variableNames=["A"],this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,n,l];var f=[a&&t>1?u-1:u,a&&n>1?c-1:c],h=[a&&t>1?t-1:t,a&&n>1?n-1:n],p=a?"0.5":"0.0",d;i?d="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`);
      const vec2 inputShapeRC = vec2(`).concat(u,".0, ").concat(c,`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = `).concat(d,`;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `).concat(p,`)));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `)}return r}();var Oje=function(){function r(e,t,n,a,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,n,l];var f=[a&&t>1?u-1:u,a&&n>1?c-1:c],h=[a&&t>1?t-1:t,a&&n>1?n-1:n],p=a?"0.5":"0.0",d;i?d="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`,
          `).concat(f[1]/h[1],`);
      const vec3 inputShapeRC = vec3(`).concat(u,".0, ").concat(c,`.0,
                                     `).concat(c,`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = `).concat(d,`;

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `).concat(p,`)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `).concat(l-1,`;
        bool hasNextRow = coords.z < `).concat(n-1,`;

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `)}return r}();function Pje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=n.alignCorners,o=n.halfPixelCenters,s=n.size,u=Te(s,2),c=u[0],l=u[1],f=k.env().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Oje(a.shape,c,l,i,o):new Rje(a.shape,c,l,i,o);return t.runWebGLProgram(f,[a],a.dtype)}var Mje={kernelName:k.ResizeNearestNeighbor,backendName:"webgl",kernelFunc:Pje};var Bje=function(){function r(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;var a=Te(t,3),i=a[1],o=a[2],s=Te(e,3),u=s[1],c=s[2],l=[n&&u>1?i-1:i,n&&c>1?o-1:o],f=[n&&u>1?u-1:u,n&&c>1?c-1:c],h=l[0]/f[0],p=l[1]/f[1],d=1/h,m=1/p,v=Math.ceil(d)*2+2,g=Math.ceil(m)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`.concat(h,`);
        const float widthScale = float(`).concat(p,`);

        const float invHeightScale = float(`).concat(d,`);
        const float invWidthScale = float(`).concat(m,`);

        const int winHeight = int(`).concat(v,`);
        const int winWidth = int(`).concat(g,`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `).concat(u,`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `).concat(c,`) {
              continue;
            }

            float sourceFracRow =
              float(`).concat(l[0],`) *
                (float(dyR) / float(`).concat(f[0],`));

            float sourceFracCol =
                float(`).concat(l[1],`) *
                  (float(dyC) / float(`).concat(f[1],`));

            int sourceNearestRow = int(min(
                float(int(`).concat(i,`) - 1),
                `).concat(n,` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`).concat(o,`) - 1),
                `).concat(n,` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `)}return r}();function Lje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.images,i=e.dy,o=n.alignCorners,s=new Bje(i.shape,a.shape,o);return t.runWebGLProgram(s,[i],i.dtype)}var zje={kernelName:k.ResizeNearestNeighborGrad,backendName:"webgl",kernelFunc:Lje};var $je=function(){function r(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-".concat(n," tensor is not yet supported"));if(this.outputShape=e,n===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`.concat(e[0],` - coord - 1));
        }
      `);return}var a=function(s){return t.indexOf(s)!==-1&&e[s]!==1?"".concat(e[s]," - coords[").concat(s,"] - 1"):"coords[".concat(s,"]")},i=e.map(function(s,u){return a(u)}).join(","),o=Lt(n);this.userCode=`
      void main() {
        `.concat(o,` coords = getOutputCoords();
        setOutput(getX(`).concat(i,`));
      }
    `)}return r}();var qje=function(){function r(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-".concat(n," tensor is not yet supported"));this.outputShape=e;var a=xn("rc",n),i="".concat(a[n-1]," + 1 < ").concat(this.outputShape[n-1]),o="".concat(a[n-2]," + 1 < ").concat(this.outputShape[n-2]),s=Lt(n);n===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`.concat(e[0],` - rc - 1),
            `).concat(e[0],` - rc - 1);
          if(`).concat(i,`){
              result.g = getChannel(getX(`).concat(e[0],` - (rc  + 1) - 1),
                `).concat(e[0],` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `):this.userCode=`
        void main() {
          `.concat(s,` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `).concat(u(a.slice()),`;
          if(`).concat(i,`){
            result.g = `).concat(c(a.slice()),`;
          }
          if(`).concat(o,`) {
            result.b = `).concat(l(a.slice()),`;
            if(`).concat(i,`) {
              result.a = `).concat(f(a.slice()),`;
            }
          }
          setOutput(result);
        }
    `);function u(d){return h(d)}function c(d){return d[n-1]="("+d[n-1]+" + 1)",h(d)}function l(d){return d[n-2]="("+d[n-2]+" + 1)",h(d)}function f(d){return d[n-1]="("+d[n-1]+" + 1)",d[n-2]="("+d[n-2]+" + 1)",h(d)}function h(d){var m=e.map(function(y,w){return p(w,d)}),v=m.join(","),g=m.slice(-2).join(",");return"getChannel(getX(".concat(v,"), vec2(").concat(g,"))")}function p(d,m){return t.indexOf(d)!==-1&&e[d]!==1?"".concat(e[d]," - ").concat(m[d]," - 1"):"".concat(m[d])}}return r}();function Wje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.dims,o=a.shape.length,s=k.util.parseAxisParam(i,a.shape);if(o===0)return ca({inputs:{x:a},backend:t});var u=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new qje(a.shape,s):new $je(a.shape,s);return t.runWebGLProgram(u,[a],a.dtype)}var Vje={kernelName:k.Reverse,backendName:"webgl",kernelFunc:Wje};var Uje=function(){function r(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];var n=e[1],a=e[2];this.outputShape=e;var i="";typeof t=="number"?i="float outputValue = ".concat(t.toFixed(2),";"):i=`
        vec3 fill = vec3(`.concat(t.join(","),`);
        float outputValue = fill[coords[3]];`),this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          `.concat(i,`
          if(coordX >= 0 && coordX < `).concat(a," && coordY >= 0 && coordY < ").concat(n,`) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `)}return r}(),Gje={kernelName:k.RotateWithOffset,backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.image,i=t.radians,o=t.fillValue,s=t.center,u=n,c=new Uje(a.shape,o),l=Te(k.backend_util.getImageCenter(s,a.shape[1],a.shape[2]),2),f=l[0],h=l[1],p=[[f,h,Math.sin(i),Math.cos(i)]],d=u.runWebGLProgram(c,[a],a.dtype,p);return d}};var Hje=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,Kje=Nt({opSnippet:Hje}),jje={kernelName:k.Round,backendName:"webgl",kernelFunc:Kje};var Xje="return inversesqrt(x);",Yje=Nt({opSnippet:Xje,cpuKernelImpl:sVe}),Zje={kernelName:k.Rsqrt,backendName:"webgl",kernelFunc:Yje};var Qx=function(){function r(e,t,n,a,i,o,s,u){u===void 0&&(u=!1),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var c=Lt(i.length),l=Lt(o.length),f="";n===1?f="i":n===2&&(f="i, j");var h="getIndices(".concat(f,")"),p="";a===1?p="i":a===2&&(p="i, coords[1]");var d="getUpdates(".concat(p,")"),m="";u&&(m="coords[0], coords[1]");var v="getDefaultValue(".concat(m,")"),g=t>1?"strides[j]":"strides";this.userCode=`
        `.concat(c," strides = ").concat(c,"(").concat(i,`);

        void main() {
          `).concat(l,` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `).concat(e,`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `).concat(t,`; j++) {
              int index = round(`).concat(h,`);
              flattenedIndex += index * `).concat(g,`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `).concat(d,`;
              found = true;
            }
          }
          setOutput(mix(`).concat(v,`, sum, float(found)));
        }
      `)}return r}();var Jje=function(){function r(e,t,n,a,i,o,s,u){u===void 0&&(u=!1),this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=o;var c=Lt(i.length),l=Lt(o.length),f="";n===1?f="i":n===2&&(f="i, j");var h="getIndices(".concat(f,")"),p="";a===1?p="i":a===2&&(p="i, coords[1]");var d="getUpdates(".concat(p,")"),m="";u&&(m="coords[0], coords[1]");var v="getDefaultValue(".concat(m,")"),g=t>1?"strides[j]":"strides",y=t>1?"strides[j + 1]":"strides";this.userCode=`
        `.concat(c," strides = ").concat(c,"(").concat(i,`);

        void main() {
          `).concat(l,` coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < `).concat(e,`; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < `).concat(t,`; j+=2) {
              ivec4 index = round(`).concat(h,`);
              flattenedIndex += index.xz * `).concat(g,`;
              if (j + 1 < `).concat(t,`) {
                flattenedIndex += index.yw * `).concat(y,`;
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = `).concat(d,`;
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(`).concat(v,`, sum, found));
        }
      `)}return r}();function Qje(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.indices,i=e.updates,o=n.shape,s=k.backend_util.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,f=s.strides,h=s.outputSize,p=[h/l,l];if(h===0)return t.makeTensorInfo(o,a.dtype);var d=Ae({inputs:{x:a},backend:t,attrs:{shape:[c,u]}}),m=Ae({inputs:{x:i},backend:t,attrs:{shape:[c,l]}}),v=t.makeTensorInfo([],"float32",new Float32Array([0])),g;k.env().getBool("WEBGL_PACK")?g=new Jje(c,u,d.shape.length,m.shape.length,f,p):g=new Qx(c,u,d.shape.length,m.shape.length,f,p);var y=t.runWebGLProgram(g,[m,d,v],m.dtype),w=Ae({inputs:{x:y},backend:t,attrs:{shape:o}});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(v),w}var e8e={kernelName:k.ScatterNd,backendName:"webgl",kernelFunc:Qje};var t8e=function(){function r(e,t,n,a){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,n];var i="while (left < right) {",o="for (int i = 0; i < ".concat(Math.ceil(Math.log2(t+1)),"; ++i) { if (left >= right) break;"),s=k.env().getNumber("WEBGL_VERSION")===2?i:o,u=a==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         `.concat(s,`
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) `).concat(u,` value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `)}return r}();function r8e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.sortedSequence,i=e.values,o=n.side,s=new t8e(a.shape[0],a.shape[1],i.shape[1],o),u=[[a.shape[1]]];return t.runWebGLProgram(s,[a,i],"int32",u)}var n8e={kernelName:k.SearchSorted,backendName:"webgl",kernelFunc:r8e};var a8e=function(){function r(e,t,n){this.variableNames=["c","a","b"],this.outputShape=t;var a,i;if(n>4)throw Error("Where for rank ".concat(n," is not yet supported"));if(n===1)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<t.length;c++)u.push("".concat(o[c])),c<e&&s.push("".concat(o[c]));a=s.join(),i=u.join()}var l=Lt(n);this.userCode=`
      void main() {
        `.concat(l,` resRC = getOutputCoords();
        float cVal = getC(`).concat(a,`);
        if (cVal >= 1.0) {
          setOutput(getA(`).concat(i,`));
        } else {
          setOutput(getB(`).concat(i,`));
        }
      }
    `)}return r}();function i8e(r){var e=r.inputs,t=r.backend,n=e.condition,a=e.t,i=e.e,o=new a8e(n.shape.length,a.shape,a.shape.length);return t.runWebGLProgram(o,[n,a,i],k.upcastType(a.dtype,i.dtype))}var o8e={kernelName:k.Select,backendName:"webgl",kernelFunc:i8e};var s8e=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `.concat(k.backend_util.SELU_SCALEALPHA,`;
  float scale = `).concat(k.backend_util.SELU_SCALE,`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`),u8e=Nt({opSnippet:s8e}),c8e={kernelName:k.Selu,backendName:"webgl",kernelFunc:u8e};var l8e=Yc+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,f8e=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,h8e=Nt({opSnippet:l8e,packedOpSnippet:f8e,cpuKernelImpl:cVe}),p8e={kernelName:k.Sigmoid,backendName:"webgl",kernelFunc:h8e};var d8e=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,v8e=Nt({opSnippet:d8e}),m8e={kernelName:k.Sign,backendName:"webgl",kernelFunc:v8e};var g8e=Yc+`
  return sin(x);
`,y8e=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  `.concat(Su,`
  return result;
`),b8e=Nt({opSnippet:g8e,packedOpSnippet:y8e}),w8e={kernelName:k.Sin,backendName:"webgl",kernelFunc:b8e};var x8e=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,k8e=Nt({opSnippet:x8e}),S8e={kernelName:k.Sinh,backendName:"webgl",kernelFunc:k8e};var N8e=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,T8e=Nt({opSnippet:N8e}),E8e={kernelName:k.Softplus,backendName:"webgl",kernelFunc:T8e},I8e=function(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.blockShape,o=n.paddings;k.util.assert(a.shape.length<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var s=i.reduce(function(y,w){return y*w}),u=[[0,0]];u.push.apply(u,pr([],Te(o),!1));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=[],f=uV({inputs:{x:a},backend:t,attrs:{paddings:u,constantValue:0}}),h=k.backend_util.getReshaped(f.shape,i,s,!1),p=k.backend_util.getPermuted(h.length,i.length,!1),d=k.backend_util.getReshapedPermuted(f.shape,i,s,!1),m=Ae({inputs:{x:f},backend:t,attrs:{shape:h}}),v=Sn({inputs:{x:m},backend:t,attrs:{perm:p}}),g=Ae({inputs:{x:v},backend:t,attrs:{shape:d}});return l.push(f),l.push(m),l.push(v),l.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),g},C8e={kernelName:k.SpaceToBatchND,backendName:"webgl",kernelFunc:I8e};function A8e(r){var e=r.inputs,t=r.backend,n=e.indices,a=e.values,i=e.denseShape,o=e.defaultValue;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         `.concat(i.shape));if(n.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         `.concat(n.shape));if(a.shape.length!==1)throw new Error(`Values must be a vector, saw:
         `.concat(a.shape));if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        `.concat(o.shape));var s=t.readSync(n.dataId),u=t.readSync(a.dataId),c=t.readSync(i.dataId),l=t.readSync(o.dataId)[0],f=Te(fVe(s,n.shape,n.dtype,u,a.dtype,c,l),5),h=f[0],p=f[1],d=f[2],m=f[3],v=f[4];return[t.makeTensorInfo(p,n.dtype,h),t.makeTensorInfo([p[0]],a.dtype,d),t.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(function(g){return Number(g)}))),t.makeTensorInfo([v.length],n.dtype,new Int32Array(v))]}var D8e={kernelName:k.SparseFillEmptyRows,backendName:"webgl",kernelFunc:A8e};function _8e(r){var e=r.inputs,t=r.backend,n=e.inputIndices,a=e.inputShape,i=e.newShape;if(n.shape.length!==2)throw new Error("Input indices should be a matrix but received shape ".concat(n.shape));if(a.shape.length!==1)throw new Error("Input shape should be a vector but received shape ".concat(a.shape));if(i.shape.length!==1)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(t.readSync(a.dataId)),s=t.readSync(n.dataId),u=Array.from(t.readSync(i.dataId)),c=Te(hVe(s,n.shape,n.dtype,o,u),3),l=c[0],f=c[1],h=c[2];return[t.makeTensorInfo(f,n.dtype,l),t.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}var F8e={kernelName:k.SparseReshape,backendName:"webgl",kernelFunc:_8e};function R8e(r){var e=r.inputs,t=r.backend,n=e.data,a=e.indices,i=e.segmentIds;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              `.concat(i.shape));var o=t.readSync(n.dataId),s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=Te(FW(o,n.shape,n.dtype,s,u,!0),2),l=c[0],f=c[1];return t.makeTensorInfo(f,n.dtype,l)}var O8e={kernelName:k.SparseSegmentMean,backendName:"webgl",kernelFunc:R8e};function P8e(r){var e=r.inputs,t=r.backend,n=e.data,a=e.indices,i=e.segmentIds;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             `.concat(i.shape));var o=t.readSync(n.dataId),s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=Te(FW(o,n.shape,n.dtype,s,u),2),l=c[0],f=c[1];return t.makeTensorInfo(f,n.dtype,l)}var M8e={kernelName:k.SparseSegmentSum,backendName:"webgl",kernelFunc:P8e};function B8e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.sparseIndices,i=e.sparseValues,o=e.defaultValue,s=n.outputShape,u=k.backend_util.calculateShapes(i,a,s),c=u.sliceRank,l=u.numUpdates,f=u.sliceSize,h=u.strides,p=u.outputSize,d=!1;if(i.dtype==="string"){var m=t.bufferSync(a),v=t.bufferSync(i),g=k.util.decodeString(t.readSync(o.dataId)[0]),y=uVe(m,v,s,p,f,l,c,h,g,d);return t.makeTensorInfo(s,y.dtype,y.values)}var w=new Qx(l,c,a.shape.length,i.shape.length,h,[p,1],d),b=t.runWebGLProgram(w,[i,a,o],i.dtype),x=Ae({inputs:{x:b},backend:t,attrs:{shape:s}});return t.disposeIntermediateTensorInfo(b),x}var L8e={kernelName:k.SparseToDense,backendName:"webgl",kernelFunc:B8e};function z8e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.numOrSizeSplits,o=n.axis,s=k.util.parseAxisParam(o,a.shape)[0],u=k.backend_util.prepareSplitSize(a,i,s),c=a.shape.length,l=new Array(c).fill(0),f=a.shape.slice();return u.map(function(h){var p=pr([],Te(f),!1);p[s]=h;var d=Zc({inputs:{x:a},backend:t,attrs:{begin:l,size:p}});return l[s]+=h,d})}var $8e={kernelName:k.SplitV,backendName:"webgl",kernelFunc:z8e};var _q="return sqrt(x);",q8e=Nt({opSnippet:_q,packedOpSnippet:_q,cpuKernelImpl:pVe}),W8e={kernelName:k.Sqrt,backendName:"webgl",kernelFunc:q8e};var V8e="return x * x;",U8e=Nt({opSnippet:V8e}),G8e={kernelName:k.Square,backendName:"webgl",kernelFunc:U8e};var Fq="return (a - b) * (a - b);",H8e=un({opSnippet:Fq,packedOpSnippet:Fq}),K8e={kernelName:k.SquaredDifference,backendName:"webgl",kernelFunc:H8e};function j8e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x;if(a.dtype!=="string")throw new Error("Input must be of datatype string");var i=t.readSync(a.dataId),o=k.backend_util.fromUint8ToStringArray(i),s=dVe(o,"string",n);return t.makeTensorInfo(a.shape,"string",s)}var X8e={kernelName:k.StaticRegexReplace,backendName:"webgl",kernelFunc:j8e};function Y8e(r){var e=r.inputs,t=r.attrs,n=r.backend,a=e.x,i=Ja+`
    return x > 0.0 ? 1.0 : float(`.concat(t.alpha,`);
  `),o=new qi(a.shape,i);return n.runWebGLProgram(o,[a],a.dtype)}var Z8e={kernelName:k.Step,backendName:"webgl",kernelFunc:Y8e};var J8e=function(){function r(e,t,n){this.variableNames=["x"],this.outputShape=n;var a=n.length,i=Lt(n.length),o=Lt(n.length),s="";if(a===1)s="coords * strides + begin";else{var u=0;s=n.map(function(c,l){return u++,n.length===1?"coords * strides[".concat(l,"] + begin[").concat(l,"]"):"coords[".concat(u-1,"] * strides[").concat(l,"] + begin[").concat(l,"]")}).join(",")}this.userCode=`
      `.concat(i," begin = ").concat(i,"(").concat(e,`);
      `).concat(i," strides = ").concat(i,"(").concat(t,`);

      void main() {
        `).concat(o,` coords = getOutputCoords();
        setOutput(getX(`).concat(s,`));
      }
    `)}return r}();function Q8e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.begin,o=n.end,s=n.strides,u=n.beginMask,c=n.endMask,l=n.ellipsisMask,f=n.newAxisMask,h=n.shrinkAxisMask,p=k.slice_util.sliceInfo(a.shape,i,o,s,u,c,l,f,h),d=p.finalShapeSparse,m=p.finalShape,v=p.isIdentity,g=p.sliceDim0,y=p.isSimpleSlice,w=p.begin,b=p.end,x=p.strides,S;if(v)S=Ae({inputs:{x:a},backend:t,attrs:{shape:m}});else if(g||y){k.util.assert(a.shape.length>=1,function(){return"Input must have rank at least 1, got: ".concat(a.shape.length)});var T=k.slice_util.computeOutShape(w,b,x),E=Zc({inputs:{x:a},backend:t,attrs:{begin:w,size:T}});S=Ae({inputs:{x:E},backend:t,attrs:{shape:m}}),t.disposeIntermediateTensorInfo(E)}else{var C=t.shouldExecuteOnCPU([a]);if(C){var R=t.readSync(a.dataId),_=k.buffer(a.shape,a.dtype,R),O=vVe(d,_,x,w);S=t.makeTensorInfo(m,a.dtype,O.values)}else{var $=new J8e(w,x,d);S=t.runWebGLProgram($,[a],a.dtype)}}var z=Ae({inputs:{x:S},backend:t,attrs:{shape:m}});return t.disposeIntermediateTensorInfo(S),z}var e7e={kernelName:k.StridedSlice,backendName:"webgl",kernelFunc:Q8e};function t7e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.separator,i=n.nGramWidths,o=n.leftPad,s=n.rightPad,u=n.padWidth,c=n.preserveShortSequences,l=e.data,f=e.dataSplits,h=t.readSync(l.dataId),p=t.readSync(f.dataId),d=Te(mVe(h,p,a,i,o,s,u,c),2),m=d[0],v=d[1];return[t.makeTensorInfo([m.length],"string",m),t.makeTensorInfo(f.shape,"int32",v)]}var r7e={kernelName:k.StringNGrams,backendName:"webgl",kernelFunc:t7e};function n7e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.skipEmpty,i=e.input,o=e.delimiter;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error("Input must be a vector, got shape: ".concat(i.shape));if(o.shape.length!==0)throw new Error("Delimiter must be a scalar, got shape: ".concat(o.shape));var s=t.readSync(i.dataId),u=t.readSync(o.dataId)[0],c=Te(gVe(s,u,a),3),l=c[0],f=c[1],h=c[2],p=f.length;return[t.makeTensorInfo([p,2],"int32",l),t.makeTensorInfo([p],"string",f),t.makeTensorInfo([2],"int32",new Int32Array(h))]}var a7e={kernelName:k.StringSplit,backendName:"webgl",kernelFunc:n7e};function i7e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=n.numBuckets,i=e.input;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");var o=t.readSync(i.dataId),s=yVe(o,a);return t.makeTensorInfo(i.shape,"int32",s)}var o7e={kernelName:k.StringToHashBucketFast,backendName:"webgl",kernelFunc:i7e};var s7e="return tan(x);",u7e=Nt({opSnippet:s7e}),c7e={kernelName:k.Tan,backendName:"webgl",kernelFunc:u7e};var l7e=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,f7e=Nt({opSnippet:l7e}),h7e={kernelName:k.Tanh,backendName:"webgl",kernelFunc:f7e};function p7e(r){var e=r.inputs,t=r.backend;r.attrs;var n=e.tensor,a=e.indices,i=e.updates,o=k.backend_util.calculateShapes(i,a,n.shape),s=o.sliceRank,u=o.numUpdates,c=o.sliceSize,l=o.strides,f=o.outputSize,h=[f/c,c];if(f===0)return t.makeTensorInfo(n.shape,a.dtype);var p=Ae({inputs:{x:a},backend:t,attrs:{shape:[u,s]}}),d=Ae({inputs:{x:i},backend:t,attrs:{shape:[u,c]}}),m=Ae({inputs:{x:n},backend:t,attrs:{shape:h}}),v=new Qx(u,s,p.shape.length,d.shape.length,l,h,!1,!0),g=t.runWebGLProgram(v,[d,p,m],m.dtype),y=Ae({inputs:{x:g},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),y}var d7e={kernelName:k.TensorScatterUpdate,backendName:"webgl",kernelFunc:p7e};var v7e=function(){function r(e,t){this.variableNames=["A"];for(var n=new Array(e.length),a=0;a<n.length;a++)n[a]=e[a]*t[a];this.outputShape=n,this.rank=n.length;var i=Lt(this.rank),o=m7e(e);this.userCode=`
      void main() {
        `.concat(i,` resRC = getOutputCoords();
        setOutput(getA(`).concat(o,`));
      }
    `)}return r}();function m7e(r){var e=r.length;if(e>5)throw Error("Tile for rank ".concat(e," is not yet supported"));if(e===1)return"imod(resRC, ".concat(r[0],")");for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],n=[],a=0;a<r.length;a++)n.push("imod(".concat(t[a],", ").concat(r[a],")"));return n.join()}function lV(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.reps;if(a.dtype==="string"||a.shape.length>5){var o=t.readSync(a.dataId),s=a.dtype==="string"?o.map(function(h){return k.util.decodeString(h)}):o,u=k.buffer(a.shape,a.dtype,s),c=wVe(u,i);return t.makeTensorInfo(c.shape,c.dtype,c.values)}var l=new v7e(a.shape,i),f=t.runWebGLProgram(l,[a],a.dtype);return f}var g7e={kernelName:k.Tile,backendName:"webgl",kernelFunc:lV},y7e=function(){function r(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}return r}(),b7e=function(){function r(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}return r}();function mu(r,e){e!==null&&r.disposeIntermediateTensorInfo(e)}function Rq(r){for(var e=1;e<r;)e*=2;return e}function w7e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=n.k,o=n.sorted,s=k.env().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=k.env().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=a.shape,l=c[c.length-1];if(t.shouldExecuteOnCPU([a])||l<s||i>u){var f=t.readSync(a.dataId),h=Te(xVe(f,c,a.dtype,i,o),2),p=h[0],d=h[1];return[t.makeTensorInfo(p.shape,p.dtype,p.values),t.makeTensorInfo(d.shape,d.dtype,d.values)]}if(i===0)return c[c.length-1]=0,[t.makeTensorInfo(c,a.dtype,[]),t.makeTensorInfo(c,"int32",[])];if(l===1)return[a,xh({attrs:{shape:c,dtype:"int32",value:0},backend:t})];var m=t.texData.get(a.dataId),v=m!==null&&m.isPacked,g=v?t.unpackTensor(a):a,y=k.util.sizeFromShape(c),w=y/l,b=Ae({inputs:{x:g},attrs:{shape:[w,l]},backend:t});v&&mu(t,g);for(var x=Rq(i),S=Rq(l),T=null,E=function(){return T===null?[b,b]:[b,T]},C=function(re,oe,le){var de=E(),ke=new y7e(le),he=T===null?1:0,ye=[[l],[he],[Number.NEGATIVE_INFINITY],[re],[oe]],xe=T;T=t.runWebGLProgram(ke,de,"int32",ye),mu(t,xe)},R=1;R<x;R*=2)for(var _=R*2,O=R;O>=1;O/=2)C(_,O,[w,S]);for(var $=S;$>x;$/=2){var z=E(),L=new b7e([w,$/2]),B=T===null?1:0,W=[[l],[B],[x]],X=T;T=t.runWebGLProgram(L,z,"int32",W),mu(t,X);for(var R=x/2,_=R*2,O=R;O>=1;O/=2)C(_,O,T.shape)}var J=T;T=Zc({inputs:{x:T},backend:t,attrs:{begin:0,size:[w,i]}}),mu(t,J);var V=rV({inputs:{x:b,indices:T},backend:t,attrs:{axis:1,batchDims:1}});mu(t,b);var j=c.slice(0,-1);j.push(i),J=T,T=Ae({inputs:{x:T},attrs:{shape:j},backend:t}),mu(t,J);var ne=V;return V=Ae({inputs:{x:V},attrs:{shape:j},backend:t}),mu(t,ne),[V,T]}var x7e={kernelName:k.TopK,backendName:"webgl",kernelFunc:w7e};var k7e=function(){function r(e,t,n,a,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;var s=n==="nearest"?1:2,u;switch(a){case"constant":u=1;break;case"reflect":u=2;break;case"wrap":u=3;break;case"nearest":u=4;break;default:u=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(`.concat(u,` == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (`).concat(u,` == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (`).concat(u,` == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < `).concat(e," && 0 <= coordX && coordX < ").concat(t,`) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(`).concat(i,`);
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(`).concat(i,`);
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(`).concat(t,`));
                float mapY = mapCoord(inY, float(`).concat(e,`));

                if (`).concat(s,` == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `)}return r}();function S7e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.image,i=e.transforms,o=n.interpolation,s=n.fillMode,u=n.fillValue,c=n.outputShape,l=Te(a.shape,4),f=l[0],h=l[1],p=l[2],d=l[3],m=Te(c??[h,p],2),v=m[0],g=m[1],y=[f,v,g,d],w=new k7e(h,p,o,s,u,y);return t.runWebGLProgram(w,[a,i],"float32")}var N7e={kernelName:k.Transform,backendName:"webgl",kernelFunc:S7e};function T7e(r){var e=r.inputs,t=r.attrs,n=r.backend,a=t.axis,i=e.x;Uc(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=n.readSync(i.dataId),s=kVe(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[n.makeTensorInfo(c,i.dtype,u),n.makeTensorInfo([l.length],"int32",l)]}var E7e={kernelName:k.Unique,backendName:"webgl",kernelFunc:T7e};function I7e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.value,i=n.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],c=new Array(s-1),l=0,f=0;f<s;f++)f!==i&&(c[l++]=o.shape[f]);var h=[],p=new Array(s).fill(0),d=o.shape.slice();d[i]=1;for(var m=new Array(u),f=0;f<m.length;f++){p[i]=f;var v=Zc({inputs:{x:o},backend:t,attrs:{begin:p,size:d}}),g=Ae({inputs:{x:v},backend:t,attrs:{shape:c}});m[f]=g,h.push(v)}return h.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),m}var C7e={kernelName:k.Unpack,backendName:"webgl",kernelFunc:I7e};var A7e=function(){function r(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,a=e.batchSize,i=e.inSize,o=e.numSegments,s=o*Math.ceil(i/n);this.outputShape=[a,s];var u="0.0",c="sumValue",l=Math.floor(n/4)*4,f=n%4,h=`
        sumValue += dot(values, segFilter);
    `,p="";i%n>0&&(p=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return initializationValue;
        }
      `));var d="";i%n>0&&(d=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return -1.0;
        }
      `)),this.userCode=`
      const float initializationValue = `.concat(u,`;

      float getValue(int batch, int inIdx) {
        `).concat(p,`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `).concat(d,`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `).concat(o,")) * float(").concat(n,`));
        int currentSeg = int(mod(float(outIdx), float(`).concat(o,`)));

        float sumValue = 0.0;

        for (int i = 0; i < `).concat(l,`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `).concat(h,`
        }

        int inIdx = inOffset + `).concat(l,`;
        if (`).concat(f===1,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `).concat(h,`
        } else if (`).concat(f===2,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `).concat(h,`
        } else if (`).concat(f===3,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `).concat(h,`
        }
        setOutput(`).concat(c,`);
      }
    `)}return r}();function D7e(r){var e=r.inputs,t=r.backend,n=r.attrs,a=e.x,i=e.segmentIds,o=n.numSegments,s=a.shape.length,u=[],c=0,l=k.backend_util.getAxesPermutation([c],s),f=a;l!=null&&(f=Sn({inputs:{x:a},backend:t,attrs:{perm:l}}),u.push(f),c=k.backend_util.getInnerMostAxes(1,s)[0]);var h=k.backend_util.segment_util.computeOutShape(f.shape,c,o),p=k.util.sizeFromShape([f.shape[c]]),d=Ae({inputs:{x:f},backend:t,attrs:{shape:[-1,p]}});u.push(d);var m=k.sumOutType(a.dtype),v=function(x,S,T,E,C){var R=x.shape[0],_=x.shape[1],O=k.backend_util.segment_util.segOpComputeOptimalWindowSize(_,C),$={windowSize:O,inSize:_,batchSize:R,numSegments:C},z=new A7e($,S),L=t.compileAndRun(z,[x,T],E);if(u.push(L),L.shape[1]===C)return L;var B=cV({backend:t,attrs:{start:0,stop:C,step:1,dtype:"float32"}}),W=lV({inputs:{x:B},backend:t,attrs:{reps:[_/O]}});u.push(B),u.push(W);var X=v(L,S,W,E,C);return X},g=v(d,"unsortedSegmentSum",i,m,o),y=Ae({inputs:{x:g},backend:t,attrs:{shape:h}}),w=y;if(l!=null){u.push(y);var b=k.backend_util.getUndoAxesPermutation(l);w=Sn({inputs:{x:w},backend:t,attrs:{perm:b}})}return u.forEach(function(x){return t.disposeIntermediateTensorInfo(x)}),w}var _7e={kernelName:k.UnsortedSegmentSum,backendName:"webgl",kernelFunc:D7e},Ax,Oq,F7e=[vUe,gUe,wUe,SUe,TUe,CUe,DUe,FUe,MUe,LUe,qUe,UUe,KUe,ZUe,eGe,rGe,aGe,uGe,lGe,hGe,mGe,SGe,TGe,AGe,_Ge,BGe,zGe,VGe,JVe,HGe,ZGe,t6e,s6e,l6e,h6e,d6e,m6e,w6e,S6e,E6e,C6e,D6e,F6e,P6e,B6e,q6e,V6e,H6e,X6e,Z6e,tHe,iHe,cHe,hHe,vHe,mHe,yHe,wHe,kHe,NHe,EHe,DHe,RHe,MHe,LHe,qHe,UHe,jHe,JHe,ZVe,e5e,XGe,n5e,o5e,c5e,eUe,p5e,g5e,b5e,S5e,E5e,D5e,R5e,B5e,q5e,U5e,H5e,Y5e,J5e,eKe,aKe,oKe,uKe,lKe,hKe,mKe,wKe,NKe,FKe,nUe,MKe,zKe,WKe,GKe,RGe,jKe,YKe,JKe,tje,ije,rUe,sje,cje,fje,pje,dje,OGe,CKe,gje,xje,Tje,iUe,Aje,Fje,Mje,zje,Vje,Gje,jje,Zje,e8e,n8e,o8e,c8e,p8e,m8e,w8e,S8e,xGe,DKe,E8e,C8e,D8e,F8e,O8e,M8e,L8e,$8e,W8e,G8e,K8e,X8e,Z8e,e7e,r7e,a7e,o7e,AKe,hUe,c7e,h7e,d7e,g7e,x7e,N7e,pUe,E7e,C7e,_7e,XKe];try{for(sh=kn(F7e),$c=sh.next();!$c.done;$c=sh.next())Pq=$c.value,k.registerKernel(Pq)}catch(r){Ax={error:r}}finally{try{$c&&!$c.done&&(Oq=sh.return)&&Oq.call(sh)}finally{if(Ax)throw Ax.error}}var Pq,sh,$c;po.GPGPUContext=fm;po.MathBackendWebGL=Xx;po.forceHalfFloat=PW;po.gpgpu_util=Iqe;po.setWebGLContext=Mq;po.version_webgl=XVe;po.webgl=YVe;po.webgl_util=R$e});var Lh=Y(Ta=>{"use strict";var nk=Rs(),R7e=pO(),ak=eB(),ik=KL(),PV=kz(),ok=iq(),sk=fV();function MV(r){var e=Object.create(null);return r&&Object.keys(r).forEach(function(t){if(t!=="default"){var n=Object.getOwnPropertyDescriptor(r,t);Object.defineProperty(e,t,n.get?n:{enumerable:!0,get:function(){return r[t]}})}}),e.default=r,e}var hV=MV(R7e),O7e=MV(PV),BV="Abs",LV="Acos",zV="Acosh",Tk="Add",P7e="AddN",M7e="All",B7e="Any",$V="ArgMax",qV="ArgMin",WV="Asin",VV="Asinh",UV="Atan",GV="Atanh",HV="Atan2",KV="AvgPool",L7e="AvgPoolGrad",z7e="AvgPool3D",$7e="AvgPool3DGrad",jV="BatchMatMul",XV="BatchToSpaceND",q7e="BroadcastTo",Ek="Cast",YV="Ceil",ZV="ClipByValue",W7e="Complex",JV="ComplexAbs",QV="Concat",eU="Conv2D",V7e="Conv2DBackpropFilter",tU="Conv2DBackpropInput",U7e="Conv3D",G7e="Conv3DBackpropFilterV2",H7e="Conv3DBackpropInputV2",rU="Cos",nU="Cosh",K7e="Cumprod",aU="Cumsum",j7e="DepthToSpace",iU="DepthwiseConv2dNative",X7e="DepthwiseConv2dNativeBackpropFilter",Y7e="DepthwiseConv2dNativeBackpropInput",oU="Dilation2D",Z7e="Dilation2DBackpropInput",J7e="Dilation2DBackpropFilter",sU="RealDiv",uU="Elu",Q7e="EluGrad",cU="Erf",eXe="Equal",lU="Exp",fU="ExpandDims",hU="Expm1",tXe="FFT",rXe="Fill",pU="Floor",dU="FloorDiv",vU="FusedBatchNorm",mU="GatherV2",nXe="Greater",gU="GreaterEqual",Ik="Identity",aXe="IFFT",iXe="Imag",yU="IsFinite",bU="IsInf",wU="IsNan",xU="LeakyRelu",oXe="Less",sXe="LessEqual",kU="Log",SU="Log1p",uXe="LogicalAnd",cXe="LogicalNot",lXe="LogicalOr",fXe="LogSoftmax",NU="LRN",hXe="LRNGrad",TU="Max",EU="Maximum",IU="MaxPool",pXe="MaxPoolGrad",dXe="MaxPool3D",vXe="MaxPool3DGrad",CU="Mean",AU="Min",DU="Minimum",_U="MirrorPad",FU="Mod",RU="Multiply",OU="Neg",mXe="NotEqual",PU="OnesLike",MU="OneHot",BU="Pack",LU="PadV2",zU="Pow",$U="Prelu",qU="Prod",gXe="Real",WU="Reciprocal",VU="Relu",UU="Reshape",GU="ResizeNearestNeighbor",yXe="ResizeNearestNeighborGrad",HU="ResizeBilinear",bXe="ResizeBilinearGrad",KU="Relu6",jU="Reverse",XU="Round",YU="Rsqrt",wXe="TensorScatterUpdate",ZU="Select",JU="Selu",QU="Slice",eG="Sin",tG="Sinh",rG="Sign",nG="Sigmoid",aG="Softplus",iG="Sqrt",oG="Sum",sG="SpaceToBatchND",uG="SplitV",cG="Softmax",lG="SquaredDifference",xXe="Square",kXe="StridedSlice",fG="Sub",hG="Tan",pG="Tanh",Ck="Tile",SXe="TopK",wm="Transpose",NXe="Unique",dG="Unpack",vG="UnsortedSegmentSum",mG="ZerosLike",gG="Step";var TXe=1e-7,EXe=1e-4,uk=class{refCount(e){return la("refCount")}incRef(e){return la("incRef")}timerAvailable(){return!0}time(e){return la("time")}read(e){return la("read")}readSync(e){return la("readSync")}readToGPU(e,t){return la("readToGPU")}numDataIds(){return la("numDataIds")}disposeData(e,t){return la("disposeData")}write(e,t,n){return la("write")}move(e,t,n,a,i){return la("move")}createTensorFromGPUData(e,t,n){return la("createTensorFromGPUData")}memory(){return la("memory")}floatPrecision(){return la("floatPrecision")}epsilon(){return this.floatPrecision()===32?TXe:EXe}dispose(){return la("dispose")}};function la(r){throw new Error(`'${r}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function ie(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function IXe(r,e,t=""){ie(Ak(r,e),()=>t+` Shapes ${r} and ${e} must match`)}function mo(r){if(r.length===0)return 1;let e=r[0];for(let t=1;t<r.length;t++)e*=r[t];return e}function Ak(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function Ah(r){return r%1===0}function xm(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function Ui(r,e){let t=e.length;return r=r==null?e.map((n,a)=>a):[].concat(r),ie(r.every(n=>n>=-t&&n<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${r}`),ie(r.every(n=>Ah(n)),()=>`All values in axis param must be integers but got axis ${r}`),r.map(n=>n<0?t+n:n)}function CXe(r,e){let t=[],n=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:Ui(e,r).sort(),o=0;for(let s=0;s<r.length;++s){if(i!=null){if(i[o]===s&&r[s]!==1)throw new Error(`Can't squeeze axis ${s} since its dim '${r[s]}' is not 1`);(i[o]==null||i[o]>s)&&r[s]===1&&(t.push(r[s]),n.push(s)),i[o]<=s&&o++}r[s]!==1&&(t.push(r[s]),n.push(s))}return{newShape:t,keptDims:n}}function AXe(r,e){for(let t=0;t<r.length;t++){let n=r[t];if(isNaN(n)||!isFinite(n))throw Error(`A tensor of type ${e} being uploaded contains ${n}.`)}}function DXe(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function ck(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error(`Unknown dtype ${r}`)}function _Xe(r){if(r==null)return 0;let e=0;return r.forEach(t=>e+=t.length),e}function Dk(r){return typeof r=="string"||r instanceof String}function FXe(r){return typeof r=="boolean"}function RXe(r){return typeof r=="number"}function Rm(r){return Array.isArray(r)?Rm(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray?"int32":RXe(r)?"float32":Dk(r)?"string":FXe(r)?"bool":"float32"}function lk(r){return!!(r&&r.constructor&&r.call&&r.apply)}function yG(r){let e=r.length;if(e<2)return[];let t=new Array(e-1);t[e-2]=r[e-1];for(let n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function bG(r,e,t,n=!1){let a=new Array;if(e.length===1){let i=e[0]*(n?2:1);for(let o=0;o<i;o++)a[o]=t[r+o]}else{let i=e[0],o=e.slice(1),s=o.reduce((u,c)=>u*c)*(n?2:1);for(let u=0;u<i;u++)a[u]=bG(r+u*s,o,t,n)}return a}function pV(r,e,t=!1){if(r.length===0)return e[0];let n=r.reduce((a,i)=>a*i)*(t?2:1);if(n===0)return[];if(n!==e.length)throw new Error(`[${r}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return bG(0,r,e,t)}function wG(r,e){let t=_k(r,e);for(let n=0;n<t.length;n++)t[n]=1;return t}function _k(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error(`Unknown data type ${e}`)}function Bh(r){r.forEach(e=>{ie(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${r}].`)})}function Fk(r){return r&&r.then&&typeof r.then=="function"}var dV="tfjsflags",fk=class{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=OXe,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(dr().getBool("IS_TEST")||dr().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){let a=this.urlFlags[e];dr().getBool("IS_TEST")||dr().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${a}.`),this.set(e,a)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];let t=this.evaluateFlag(e);if(Fk(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;let e=this.getQueryParams(this.global.location.search);dV in e&&e[dV].split(",").forEach(n=>{let[a,i]=n.split(":");this.urlFlags[a]=MXe(a,i)})}};function OXe(r){let e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...n)=>(PXe(e,n[0],n[1]),n.join("="))),e}function PXe(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function MXe(r,e){let t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function dr(){return xG}var xG=null;function BXe(r){xG=r}var ek;function kG(){if(ek==null){let r;if(typeof window<"u")r=window;else if(typeof global<"u")r=global;else if(typeof process<"u")r=process;else if(typeof self<"u")r=self;else throw new Error("Could not find a global object");ek=r}return ek}function LXe(){let r=kG();return r._tfGlobals==null&&(r._tfGlobals=new Map),r._tfGlobals}function Rk(r,e){let t=LXe();if(t.has(r))return t.get(r);{let n=e();return t.set(r,n),t.get(r)}}function Jc(...r){dr().getBool("IS_TEST")||dr().getBool("PROD")||console.warn(...r)}var SG=Rk("kernelRegistry",()=>new Map),hk=Rk("gradRegistry",()=>new Map);function vV(r,e){let t=$Xe(r,e);return SG.get(t)}function mV(r){return hk.get(r)}function gV(r){let e=SG.entries(),t=[];for(;;){let{done:n,value:a}=e.next();if(n)break;let[i,o]=a,[s]=i.split("_");s===r&&t.push(o)}return t}function zXe(r){let{kernelName:e}=r;hk.has(e)&&dr().getBool("DEBUG")&&Jc(`Overriding the gradient for '${e}'`),hk.set(e,r)}function $Xe(r,e){return`${e}_${r}`}function qXe(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array||r instanceof Uint8ClampedArray}var WXe=hV.default||hV;function Ok(r){return WXe.fromString(r,!0,16)}var sct=Ok("c3a5c85c97cb3127"),uct=Ok("b492b66fbe98f273"),cct=Ok("9ae16a3b2f90404f");function VXe(r,e){return r instanceof Float32Array&&e==="float32"||r instanceof Int32Array&&e==="int32"||r instanceof Uint8Array&&e==="bool"}function NG(r,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=Dh(r)),dr().getBool("DEBUG")&&AXe(r,e),VXe(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){let t=new Uint8Array(r.length);for(let n=0;n<t.length;++n)Math.round(r[n])!==0&&(t[n]=1);return t}else throw new Error(`Unknown data type ${e}`)}function Tm(){return dr().platform.now()}function UXe(r,e="utf-8"){return e=e||"utf-8",dr().platform.encode(r,e)}function yV(r,e="utf-8"){return e=e||"utf-8",dr().platform.decode(r,e)}function ei(r){return dr().platform.isTypedArray!=null?dr().platform.isTypedArray(r):qXe(r)}function Dh(r,e=[],t=!1){if(e==null&&(e=[]),typeof r=="boolean"||typeof r=="number"||typeof r=="string"||Fk(r)||r==null||ei(r)&&t)e.push(r);else if(Array.isArray(r)||ei(r))for(let n=0;n<r.length;++n)Dh(r[n],e,t);else{let n=-1;for(let a of Object.keys(r))/^([1-9]+[0-9]*|0)$/.test(a)&&(n=Math.max(n,Number(a)));for(let a=0;a<=n;a++)Dh(r[a],e,t)}return e}var pk=class{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new dk)}profileKernel(e,t,n){let a,i=()=>{a=n()},o,s=Tm();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(let c of a)c.dataSync();o=Promise.resolve({kernelMs:Tm()-s})}if(dr().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<a.length;c++){let l=a[c];l.data().then(f=>{GXe(f,l.dtype,e)})}return{kernelName:e,outputs:a,inputs:t,timeMs:o.then(c=>c.kernelMs),extraInfo:o.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){let{kernelName:t,outputs:n,timeMs:a,inputs:i,extraInfo:o}=e;n.forEach(s=>{Promise.all([s.data(),a,o]).then(u=>{this.logger.logKernelProfile(t,s,u[0],u[1],i,u[2])})})}};function GXe(r,e,t){if(e!=="float32")return!1;for(let n=0;n<r.length;n++){let a=r[n];if(isNaN(a)||!isFinite(a))return console.warn(`Found ${a} in the result of '${t}'`),!0}return!1}var dk=class{logKernelProfile(e,t,n,a,i,o){let s=typeof a=="number"?xm(`${a}ms`,9):a.error,u=xm(e,25),c=t.rank,l=t.size,f=xm(t.shape.toString(),14),h="";for(let p in i){let d=i[p];if(d!=null){let m=d.shape||t.shape,v=m.length;h+=`${p}: ${v}D ${v>0?m:""} `}}console.log(`%c${u}	%c${s}	%c${c}D ${f}	%c${l}	%c${h}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};function HXe(r,e,t){let n={},a={};for(let u=0;u<e.length;u++)n[e[u].id]=!0;for(let u=0;u<r.length;u++){let c=r[u],l=c.inputs;for(let f in l){let h=l[f],p=!1;for(let d=0;d<e.length;d++)if(n[h.id]){c.outputs.forEach(m=>n[m.id]=!0),p=!0,a[c.id]=!0;break}if(p)break}}let i={};i[t.id]=!0;let o={};for(let u=r.length-1;u>=0;u--){let c=r[u],l=c.inputs;for(let f=0;f<c.outputs.length;f++)if(i[c.outputs[f].id]){for(let h in l)i[l[h].id]=!0,o[c.id]=!0;break}}let s=[];for(let u=0;u<r.length;u++){let c=r[u];if(a[c.id]&&o[c.id]){let l={};for(let h in c.inputs){let p=c.inputs[h];n[p.id]&&(l[h]=p)}let f=Object.assign({},c);f.inputs=l,f.outputs=c.outputs,s.push(f)}}return s}function KXe(r,e,t,n){for(let a=e.length-1;a>=0;a--){let i=e[a],o=[];if(i.outputs.forEach(u=>{let c=r[u.id];c!=null?o.push(c):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);let s=i.gradient(o);for(let u in i.inputs){if(!(u in s))throw new Error(`Cannot backprop through input ${u}. Available gradients found: ${Object.keys(s)}.`);let c=t(()=>s[u]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${u} must have 'float32' dtype, but has '${c.dtype}'`);let l=i.inputs[u];if(!Ak(c.shape,l.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${u}' has shape '${c.shape}', which does not match the shape of the input '${l.shape}'`);if(r[l.id]==null)r[l.id]=c;else{let f=r[l.id];r[l.id]=n(f,c),f.dispose()}}}}var bV=20,kh=3,tk=7;function jXe(r,e,t,n){let a=yG(e),i=XXe(r,e,t,a),o=e.length,s=km(r,e,t,a,i),u=["Tensor"];return n&&(u.push(`  dtype: ${t}`),u.push(`  rank: ${o}`),u.push(`  shape: [${e}]`),u.push("  values:")),u.push(s.map(c=>"    "+c).join(`
`)),u.join(`
`)}function XXe(r,e,t,n){let a=mo(e),i=n[n.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?Ih(r):r;if(s>1)for(let c=0;c<a/i;c++){let l=c*i;for(let f=0;f<i;f++)o[f]=Math.max(o[f],Eh(u[l+f],0,t).length)}return o}function Eh(r,e,t){let n;return Array.isArray(r)?n=`${parseFloat(r[0].toFixed(tk))} + ${parseFloat(r[1].toFixed(tk))}j`:Dk(r)?n=`'${r}'`:t==="bool"?n=TG(r):n=parseFloat(r.toFixed(tk)).toString(),xm(n,e)}function TG(r){return r===0?"false":"true"}function km(r,e,t,n,a,i=!0){let o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){let m=Ih(r);return[Eh(m[0],0,t)]}return t==="bool"?[TG(r[0])]:[r[0].toString()]}if(u===1){if(s>bV){let v=kh*o,g=Array.from(r.slice(0,v)),y=Array.from(r.slice((s-kh)*o,s*o));return t==="complex64"&&(g=Ih(g),y=Ih(y)),["["+g.map((w,b)=>Eh(w,a[b],t)).join(", ")+", ..., "+y.map((w,b)=>Eh(w,a[s-kh+b],t)).join(", ")+"]"]}return["["+(t==="complex64"?Ih(r):Array.from(r)).map((v,g)=>Eh(v,a[g],t)).join(", ")+"]"]}let c=e.slice(1),l=n.slice(1),f=n[0]*o,h=[];if(s>bV){for(let m=0;m<kh;m++){let v=m*f,g=v+f;h.push(...km(r.slice(v,g),c,t,l,a,!1))}h.push("...");for(let m=s-kh;m<s;m++){let v=m*f,g=v+f;h.push(...km(r.slice(v,g),c,t,l,a,m===s-1))}}else for(let m=0;m<s;m++){let v=m*f,g=v+f;h.push(...km(r.slice(v,g),c,t,l,a,m===s-1))}let p=u===2?",":"";h[0]="["+(s>0?h[0]+p:"");for(let m=1;m<h.length-1;m++)h[m]=" "+h[m]+p;let d=`,
`;for(let m=2;m<u;m++)d+=`
`;return h[h.length-1]=" "+h[h.length-1]+"]"+(i?"":d),h}function Ih(r){let e=[];for(let t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var Wi=null,Sh=null,YXe=null;function ZXe(r){Wi=r}function JXe(r){YXe=r}var Tn=class{constructor(e,t,n,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=mo(e),this.strides=yG(e),this.dataId=n,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){let e=await this.data();return Sh.buffer(this.shape,this.dtype,e)}bufferSync(){return Sh.buffer(this.shape,this.dtype,this.dataSync())}async array(){let e=await this.data();return pV(this.shape,e,this.dtype==="complex64")}arraySync(){return pV(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();let e=Wi().read(this.dataId);if(this.dtype==="string"){let t=await e;try{return t.map(n=>yV(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Wi().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();let e=Wi().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>yV(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();let e=await Wi().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(Wi().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Sh.print(this,e)}clone(){return this.throwIfDisposed(),Sh.clone(this)}toString(e=!1){let t=this.dataSync();return jXe(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Sh.cast(this,e)}variable(e=!0,t,n){return this.throwIfDisposed(),Wi().makeVariable(this,e,t,n)}};Object.defineProperty(Tn,Symbol.hasInstance,{value:r=>!!r&&r.data!=null&&r.dataSync!=null&&r.throwIfDisposed!=null});function ce(){return Rk("Tensor",()=>Tn)}ce();var el=class extends Tn{constructor(e,t,n,a){super(e.shape,e.dtype,e.dataId,a),this.trainable=t,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!Ak(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Wi().disposeTensor(this),this.dataId=e.dataId,Wi().incRef(this,null)}dispose(){Wi().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(el,Symbol.hasInstance,{value:r=>r instanceof Tn&&r.assign!=null&&r.assign instanceof Function});var wV;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(wV||(wV={}));var vk;(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(vk||(vk={}));var mk;(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(mk||(mk={}));var gk;(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(gk||(gk={}));var yk;(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(yk||(yk={}));var QXe={float32:gk,int32:vk,bool:mk,complex64:yk};function e9e(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${r} with ${e}`)}return QXe[r][e]}function EG(r){return r!=null&&typeof r=="object"&&"texture"in r&&r.texture instanceof WebGLTexture}function IG(r){return typeof GPUBuffer<"u"&&r!=null&&typeof r=="object"&&"buffer"in r&&r.buffer instanceof GPUBuffer}function en(r,e){if(r.dtype===e.dtype)return[r,e];let t=e9e(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function CG(r){let e=[];return AG(r,e,new Set),e}function AG(r,e,t){if(r==null)return;if(r instanceof Tn){e.push(r);return}if(!t9e(r))return;let n=r;for(let a in n){let i=n[a];t.has(i)||(t.add(i),AG(i,e,t))}}function t9e(r){return Array.isArray(r)||typeof r=="object"}function rk(r){return r.kernelName!=null}var Em=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(let e in this.registeredVariables)this.registeredVariables[e].dispose()}},us=class{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Em}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;let e=this.getSortedBackends();for(let t=0;t<e.length;t++){let n=e[t];if(await this.initializeBackend(n).success){await this.setBackend(n);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){let{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){let{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,n=1){return e in this.registryFactory?(Jc(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;let{success:t,asyncInit:n}=this.initializeBackend(e);if(!(n?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new pk(this.backendInstance),!0}setupRegisteredKernels(){gV(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){gV(e).forEach(n=>{n.disposeFunc!=null&&n.disposeFunc(this.registry[e])})}initializeBackend(e){let t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{let n=t.factory();if(n&&!(n instanceof uk)&&typeof n.then=="function"){let a=++this.pendingBackendInitId,i=n.then(o=>a<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(a<this.pendingBackendInitId||(this.pendingBackendInit=null,Jc(`Initialization of backend ${e} failed`),Jc(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=n,{success:!0,asyncInit:!1}}catch(n){return Jc(`Initialization of backend ${e} failed`),Jc(n.stack||n.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){let e=this.getSortedBackends();for(let t=0;t<e.length;t++){let n=e[t],{success:a,asyncInit:i}=this.initializeBackend(n);if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){let n=this.state.tensorInfo.get(t),a=n.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),n.backend=e,e.move(t,i,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let n=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");n=e}let a;return this.scopedRun(()=>this.startScope(n),()=>this.endScope(a),()=>(a=t(),a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),a))}scopedRun(e,t,n){e();try{let a=n();return t(),a}catch(a){throw t(),a}}nextTensorId(){return us.nextTensorId++}nextVariableId(){return us.nextVariableId++}clone(e){let t=ae.runKernel(Ik,{x:e}),n={x:e},a=o=>({x:()=>{let s="float32",u={x:o},c={dtype:s};return ae.runKernel(Ek,u,c)}}),i=[];return this.addTapeNode(this.state.activeScope.name,n,[t],a,i,{}),t}runKernel(e,t,n){if(this.backendName==null&&this.backend,!(vV(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,n){let a=this.backend.numDataIds(),i=0;n.forEach(u=>{i+=u.dtype==="complex64"?3:1});let o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${s} data ids) after running '${e}'`)}runKernelFunc(e){let t,n=[],a=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let s;this.backendName==null&&this.backend;let u,c=rk(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(rk(e)){let{kernelName:d,inputs:m,attrs:v}=e;this.backendName==null&&this.backend;let g=vV(d,this.backendName);ie(g!=null,()=>`Cannot find registered kernel '${d}' for backend '${this.backendName}'`),s=()=>{let y=this.backend.numDataIds();u=g.kernelFunc({inputs:m,attrs:v,backend:this.backend});let w=Array.isArray(u)?u:[u];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(d,y,w);let b=w.map(x=>x.rank!=null?x:this.makeTensorFromTensorInfo(x));if(a){let x=this.getTensorsForGradient(d,m,b);n=this.saveTensorsForBackwardMode(x)}return b}}else{let{forwardFunc:d}=e,m=v=>{!a||(n=v.map(g=>this.keep(this.clone(g))))};s=()=>{let v=this.backend.numDataIds();u=this.tidy(()=>d(this.backend,m));let g=Array.isArray(u)?u:[u];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,v,g),g}}let{inputs:l,attrs:f}=e,h=rk(e)?null:e.backwardsFunc,p;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=s():(p=this.profiler.profileKernel(c,l,()=>s()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),t=p.outputs)}),a&&this.addTapeNode(c,l,t,h,n,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(l).map(d=>l[d]!=null?l[d].shape:null),outputShapes:t.map(d=>d.shape),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(u)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(n=>this.keep(this.clone(n)))}getTensorsForGradient(e,t,n){let a=mV(e);if(a!=null){let i=a.inputsToSave||[],o=a.outputsToSave||[],s;a.saveAllInputs?(ie(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),s=Object.keys(t).map(c=>t[c])):s=i.map(c=>t[c]);let u=n.filter((c,l)=>o[l]);return s.concat(u)}return[]}makeTensor(e,t,n,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",a=a||this.backend;let i=e;n==="string"&&Dk(e[0])&&(i=e.map(u=>UXe(u)));let o=a.write(i,t,n),s=new Tn(t,n,o,this.nextTensorId());if(this.trackTensor(s,a),n==="string"){let u=this.state.tensorInfo.get(o),c=_Xe(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s}makeTensorFromDataId(e,t,n,a){n=n||"float32";let i={dataId:e,shape:t,dtype:n};return this.makeTensorFromTensorInfo(i,a)}makeTensorFromTensorInfo(e,t){let{dataId:n,shape:a,dtype:i}=e,o=new Tn(a,i,n,this.nextTensorId());return this.trackTensor(o,t),o}makeVariable(e,t=!0,n,a){n=n||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));let i=new el(e,t,n,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*ck(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof el||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;let t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){let n=e.size*ck(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(let e in this.state.registeredVariables){let t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){let e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;let t=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(a=>a.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n;for(let a of this.state.activeProfile.kernels)a.kernelTimeMs=await a.kernelTimeMs,a.extraInfo=await a.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,n,a,i,o){let s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},u=mV(e);u!=null&&(a=u.gradFunc),a!=null&&(s.gradient=c=>(c=c.map((l,f)=>{if(l==null){let h=n[f],p=_k(h.size,h.dtype);return this.makeTensor(p,h.shape,h.dtype)}return l}),a(c.length>1?c:c[0],i,o))),this.state.activeTape.push(s)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){let t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){let t=CG(e),n=new Set(t.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){let o=this.state.activeScope.track[i];!o.kept&&!n.has(o.id)&&o.dispose()}let a=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(i=>{!i.kept&&i.scopeId===a.id&&this.track(i)})}gradients(e,t,n,a=!1){if(ie(t.length>0,()=>"gradients() received an empty list of xs."),n!=null&&n.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);let i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));ie(i instanceof Tn,()=>"The result y returned by f() must be a tensor.");let o=HXe(this.state.activeTape,t,i);if(!a&&o.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let s={};s[i.id]=n??r9e(i.shape),KXe(s,o,c=>this.tidy(c),a9e);let u=t.map(c=>s[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(let l of c.saved)l.dispose()}),this.state.activeTape=null),{value:i,grads:u}})}customGrad(e){return ie(lk(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{ie(t.every(s=>s instanceof Tn),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let n,a={};t.forEach((s,u)=>{a[u]=s});let i=(s,u)=>(n=e(...t,u),ie(n.value instanceof Tn,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),ie(lk(n.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),n.value),o=(s,u)=>{let c=n.gradFunc(s,u),l=Array.isArray(c)?c:[c];ie(l.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),ie(l.every(h=>h instanceof Tn),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let f={};return l.forEach((h,p)=>{f[p]=()=>h}),f};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:a})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){let t=Tm(),n=await this.backend.time(e);return n.wallMs=Tm()-t,n}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Em;for(let e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}};us.nextTensorId=0;us.nextVariableId=0;function r9e(r){let e=wG(mo(r),"float32");return ae.makeTensor(e,r,"float32")}function n9e(){let r=kG();if(r._tfengine==null){let e=new fk(r);r._tfengine=new us(e)}return BXe(r._tfengine.ENV),ZXe(()=>r._tfengine),r._tfengine}var ae=n9e();function a9e(r,e){let t={a:r,b:e};return ae.runKernel(Tk,t)}function i9e(r,e){let t=r;if(ei(r))return e==="string"?[]:[r.length];if(EG(r)){let a=r.channels||"RGBA";return[r.height,r.width*a.length]}else if(IG(r))return[r.buffer.size/(e==null?4:ck(e))];if(!Array.isArray(r))return[];let n=[];for(;Array.isArray(t)||ei(t)&&e!=="string";)n.push(t.length),t=t[0];return Array.isArray(r)&&dr().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&DG(r,n,[]),n}function DG(r,e,t){if(t=t||[],!Array.isArray(r)&&!ei(r)){ie(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}ie(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${r.length} elements`),ie(r.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${r.length} elements`);let n=e.slice(1);for(let a=0;a<r.length;++a)DG(r[a],n,t.concat(a))}function xV(r,e,t,n){if(r!=="string_or_numeric"){if(r==null)throw new Error("Expected dtype cannot be null.");if(r!=="numeric"&&r!==e||r==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${n}' must be ${r} tensor, but got ${e} tensor`)}}function ee(r,e,t,n="numeric"){if(r instanceof Tn)return xV(n,r.dtype,e,t),r;let a=Rm(r);if(a!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(a=n),xV(n,a,e,t),r==null||!ei(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){let u=r==null?"null":r.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${u}'`)}let i=i9e(r,a);!ei(r)&&!Array.isArray(r)&&(r=[r]);let s=a!=="string"?NG(r,a):Dh(r,[],!0);return ae.makeTensor(s,i,a)}function _G(r,e,t,n="numeric"){if(!Array.isArray(r))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return r.map((i,o)=>ee(i,`${e}[${o}]`,t,n))}var o9e="__op";function ue(r){let e=Object.keys(r);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+o9e;let a=(...i)=>{ae.startScope(t);try{let o=n(...i);return Fk(o)&&console.error("Cannot return a Promise inside of tidy."),ae.endScope(o),o}catch(o){throw ae.endScope(null),o}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function s9e(r,e){let t=ee(r,"x","cast");if(!DXe(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");let n={x:t},a={dtype:e};return ae.runKernel(Ek,n,a)}var ot=ue({cast_:s9e});function u9e(r,e){let t=ee(r,"a","mul"),n=ee(e,"b","mul");[t,n]=en(t,n);let a={a:t,b:n};return ae.runKernel(RU,a)}var $e=ue({mul_:u9e});function c9e(r,e=0){let n={x:ee(r,"x","step")},a={alpha:e};return ae.runKernel(gG,n,a)}var Om=ue({step_:c9e});var FG={kernelName:BV,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>$e(r,Om(ot(t,"float32"),-1))}}};function l9e(r,e){let t=ee(r,"a","floorDiv"),n=ee(e,"b","floorDiv");[t,n]=en(t,n);let a={a:t,b:n};return ae.runKernel(dU,a)}var RG=ue({floorDiv_:l9e});function f9e(r,e){let t=ee(r,"a","div"),n=ee(e,"b","div");if([t,n]=en(t,n),t.dtype==="int32"&&n.dtype==="int32")return RG(t,n);let a={a:t,b:n},i={};return ae.runKernel(sU,a,i)}var Rr=ue({div_:f9e});function h9e(r){let t={x:ee(r,"x","neg")};return ae.runKernel(OU,t)}var En=ue({neg_:h9e});function p9e(r,e,t,n){if(n==null)n=Rm(r);else if(n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(IG(r)||EG(r)){if(n!=="float32"&&n!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${n}.`);return ae.backend.createTensorFromGPUData(r,e||t,n)}if(!ei(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Bh(e);let a=mo(e),i=mo(t);ie(a===i,()=>`Based on the provided shape, [${e}], the tensor should have ${a} values but has ${i}`);for(let o=0;o<t.length;++o){let s=t[o],u=o===t.length-1?s!==mo(e.slice(o)):!0;ie(t[o]===e[o]||!u,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!ei(r)&&!Array.isArray(r)&&(r=[r]),e=e||t,r=n!=="string"?NG(r,n):Dh(r,[],!0),ae.makeTensor(r,e,n)}function Qr(r,e){if((ei(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&ei(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return p9e(r,[],[],e)}function d9e(r){let t={x:ee(r,"x","sqrt","float32")};return ae.runKernel(iG,t)}var cs=ue({sqrt_:d9e});function v9e(r){let e=ee(r,"x","square"),t={};return ae.runKernel("Square",{x:e},t)}var cn=ue({square_:v9e});function m9e(r,e){let t=ee(r,"a","sub"),n=ee(e,"b","sub");[t,n]=en(t,n);let a={a:t,b:n};return ae.runKernel(fG,a)}var dn=ue({sub_:m9e});var g9e={kernelName:LV,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=cn(ot(t,"float32")),a=cs(dn(Qr(1),n));return En(Rr(r,a))}}}};var y9e={kernelName:zV,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=cs(dn(cn(ot(t,"float32")),1));return Rr(r,n)}}}};function ln(r,e){let t=[];for(let n=0;n<e.length;n++){let a=r[r.length-n-1],i=e.length-n-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function Or(r,e){let t=Math.max(r.length,e.length),n=new Array(t);for(let a=0;a<t;a++){let i=r[r.length-a-1];i==null&&(i=1);let o=e[e.length-a-1];if(o==null&&(o=1),i===1)n[t-a-1]=o;else if(o===1)n[t-a-1]=i;else if(i!==o){let s=`Operands could not be broadcast together with shapes ${r} and ${e}.`;throw Error(s)}else n[t-a-1]=i}return n}function b9e(r,e){let n={x:ee(r,"x","reshape","string_or_numeric")},a={shape:e};return ae.runKernel(UU,n,a)}var pe=ue({reshape_:b9e});function w9e(r,e=null,t=!1){let n=ee(r,"x","sum");n.dtype==="bool"&&(n=ot(n,"int32"));let a={x:n},i={axis:e,keepDims:t};return ae.runKernel(oG,a,i)}var Et=ue({sum_:w9e});var x9e={kernelName:Tk,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Or(t.shape,n.shape);return{a:()=>{let s=r,u=ln(t.shape,a);return u.length>0&&(s=Et(s,u)),pe(s,t.shape)},b:()=>{let s=r,u=ln(n.shape,a);return u.length>0&&(s=Et(s,u)),pe(s,n.shape)}}}};var k9e={kernelName:P7e,saveAllInputs:!0,gradFunc:(r,e)=>{let t={};return e.forEach((n,a)=>{t[a]=()=>r.clone()}),t}};function S9e(r){let t={x:ee(r,"x","zerosLike")};return ae.runKernel(mG,t)}var kr=ue({zerosLike_:S9e});var N9e={kernelName:$V,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>kr(t)}}};var T9e={kernelName:qV,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>kr(t)}}};var E9e={kernelName:WV,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Rr(r,cs(dn(Qr(1),cn(ot(t,"float32")))))}}};function I9e(r,e){let t=ee(r,"a","add"),n=ee(e,"b","add");[t,n]=en(t,n);let a={a:t,b:n};return ae.runKernel(Tk,a)}var Qa=ue({add_:I9e});var C9e={kernelName:VV,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=cs(Qa(Qr(1),cn(ot(t,"float32"))));return Rr(r,n)}}}};var A9e={kernelName:HV,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Or(t.shape,n.shape);return{a:()=>{let s=Qa(cn(t),cn(n)),u=$e(r,Rr(n,s)),c=ln(t.shape,a);return c.length>0&&(u=Et(u,c)),pe(u,t.shape)},b:()=>{let s=Qa(cn(t),cn(n)),u=En($e(r,Rr(t,s))),c=ln(n.shape,a);return c.length>0&&(u=Et(u,c)),pe(u,n.shape)}}}};var D9e={kernelName:UV,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Rr(r,Qa(cn(ot(t,"float32")),1))}}};var _9e={kernelName:GV,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Rr(r,dn(Qr(1),cn(ot(t,"float32"))))}}};function F9e(r,e,t,n,a,i,o="channelsLast"){let[s,u]=_h(e),c;if(o==="channelsLast")c=[s,u,r[3],r[3]];else if(o==="channelsFirst")c=[s,u,r[1],r[1]];else throw new Error(`Unknown dataFormat ${o}`);return R9e(r,c,t,n,a,i,!1,o)}function R9e(r,e,t,n,a,i,o=!1,s="channelsLast"){let[u,c,l,f]=[-1,-1,-1,-1];if(s==="channelsLast")[u,c,l,f]=r;else if(s==="channelsFirst")[u,f,c,l]=r;else throw new Error(`Unknown dataFormat ${s}`);let[h,p,,d]=e,[m,v]=_h(t),[g,y]=_h(n),w=bk(h,g),b=bk(p,y),{padInfo:x,outHeight:S,outWidth:T}=M9e(a,c,l,m,v,w,b,i,s),E=o?d*f:d,C;return s==="channelsFirst"?C=[u,E,S,T]:s==="channelsLast"&&(C=[u,S,T,E]),{batchSize:u,dataFormat:s,inHeight:c,inWidth:l,inChannels:f,outHeight:S,outWidth:T,outChannels:E,padInfo:x,strideHeight:m,strideWidth:v,filterHeight:h,filterWidth:p,effectiveFilterHeight:w,effectiveFilterWidth:b,dilationHeight:g,dilationWidth:y,inShape:r,outShape:C,filterShape:e}}function O9e(r,e,t,n,a){n==null&&(n=P9e(r,e,t));let i=r[0],o=r[1],s=Im((i-e+2*n)/t+1,a),u=Im((o-e+2*n)/t+1,a);return[s,u]}function P9e(r,e,t,n=1){let a=bk(e,n);return Math.floor((r[0]*(t-1)-t+a)/2)}function _h(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function bk(r,e){return e<=1?r:r+(r-1)*(e-1)}function M9e(r,e,t,n,a,i,o,s,u){let c,l,f;if(typeof r=="number"){c={top:r,bottom:r,left:r,right:r,type:r===0?"VALID":"NUMBER"};let p=O9e([e,t],i,n,r,s);l=p[0],f=p[1]}else if(r==="same"){l=Math.ceil(e/n),f=Math.ceil(t/a);let h=Math.max(0,(l-1)*n+i-e),p=Math.max(0,(f-1)*a+o-t),d=Math.floor(h/2),m=h-d,v=Math.floor(p/2),g=p-v;c={top:d,bottom:m,left:v,right:g,type:"SAME"}}else if(r==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-i+1)/n),f=Math.ceil((t-o+1)/a);else if(typeof r=="object"){let h=u==="channelsLast"?r[1][0]:r[2][0],p=u==="channelsLast"?r[1][1]:r[2][1],d=u==="channelsLast"?r[2][0]:r[3][0],m=u==="channelsLast"?r[2][1]:r[3][1];c={top:h,bottom:p,left:d,right:m,type:h===0&&p===0&&d===0&&m===0?"VALID":"EXPLICIT"},l=Im((e-i+h+p)/n+1,s),f=Im((t-o+d+m)/a+1,s)}else throw Error(`Unknown padding parameter: ${r}`);return{padInfo:c,outHeight:l,outWidth:f}}function Im(r,e){if(!e)return Math.trunc(r);switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error(`Unknown roundingMode ${e}`)}}function Fh(r){let[e,t,n]=_h(r);return e===1&&t===1&&n===1}function al(r,e){return Fh(r)||Fh(e)}function Cm(r){return _h(r).every(e=>e>0)}function Ti(r,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${r}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")ie(Ah(e),()=>`Error in ${r}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(n=>{n.forEach(a=>{ie(Ah(a),()=>`Error in ${r}: pad must be an integer when using dimRoundingMode ${t} but got pad ${a}.`)})});else throw Error(`Error in ${r}: Unknown padding parameter: ${e}`)}}function B9e(r,e,t,n,a,i){let o=ee(r,"dy","avgPool3dGrad"),s=ee(e,"input","avgPool3dGrad"),u=o,c=s,l=!1;s.rank===4&&(l=!0,u=pe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=pe(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),ie(u.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),ie(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),Ti("avgPool3dGrad",a,i);let f={dy:u,input:c},h={filterSize:t,strides:n,pad:a,dimRoundingMode:i},p=ae.runKernel($7e,f,h);return l?pe(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var L9e=ue({avgPool3dGrad_:B9e});var z9e={kernelName:z7e,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{filterSize:a,strides:i,pad:o,dimRoundingMode:s}=t;return{x:()=>L9e(r,n,a,i,o,s)}}};function $9e(r,e,t,n,a){let i=ee(r,"dy","avgPoolGrad"),o=ee(e,"input","avgPoolGrad");ie(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let s=o,u=i,c=!1;o.rank===3&&(c=!0,s=pe(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=pe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),ie(u.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${u.rank}.`),ie(s.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${s.rank}.`);let l={dy:u,input:s},f={filterSize:t,strides:n,pad:a},h=ae.runKernel(L7e,l,f);return c?pe(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var q9e=ue({avgPoolGrad_:$9e});var W9e={kernelName:KV,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{filterSize:a,strides:i,pad:o}=t;return{x:()=>q9e(r,n,a,i,o)}}};function V9e(r,e,t=!1,n=!1){let a=ee(r,"a","matMul"),i=ee(e,"b","matMul");[a,i]=en(a,i);let o={a,b:i},s={transposeA:t,transposeB:n};return ae.runKernel(jV,o,s)}var Na=ue({matMul_:V9e});var U9e={kernelName:jV,inputsToSave:["a","b"],gradFunc:(r,e,t)=>{let[n,a]=e,{transposeA:i,transposeB:o}=t;return!i&&!o?{a:()=>Na(r,a,!1,!0),b:()=>Na(n,r,!0,!1)}:!i&&o?{a:()=>Na(r,a,!1,!1),b:()=>Na(r,n,!0,!1)}:i&&!o?{a:()=>Na(a,r,!1,!0),b:()=>Na(n,r,!1,!1)}:{a:()=>Na(a,r,!0,!0),b:()=>Na(r,n,!0,!0)}}};function G9e(r,e,t){let n=ee(r,"x","spaceToBatchND");ie(n.rank>=1+e.length,()=>`input rank ${n.rank} should be > than [blockShape] ${e.length}`),ie(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),ie(n.shape.reduce((o,s,u)=>u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o,!0),()=>`input spatial dimensions ${n.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);let a={x:n},i={blockShape:e,paddings:t};return ae.runKernel(sG,a,i)}var Pk=ue({spaceToBatchND_:G9e});var H9e={kernelName:XV,gradFunc:(r,e,t)=>{let{blockShape:n,crops:a}=t;return{x:()=>Pk(r,n,a)}}};var K9e={kernelName:q7e,gradFunc:(r,e,t)=>{let n=t,a=n.inputShape,i=n.shape,o=Array.from(i);for(let u=a.length-1;u>=0;u--)if(a[u]===i[u])o[u]=1;else if(a[u]!==1)throw new Error(`broadcastTo(): [${a}] cannot be broadcast to [${i}].`);let s=[];for(let u=0;u<o.length;u++)o[u]>1&&s.push(u);return{x:()=>Et(r,s,!0)}}};var j9e={kernelName:Ek,gradFunc:r=>({x:()=>r.clone()})};var X9e={kernelName:YV,gradFunc:r=>({x:()=>kr(r)})};function Y9e(r,e){let t=ee(r,"a","greaterEqual","string_or_numeric"),n=ee(e,"b","greaterEqual","string_or_numeric");[t,n]=en(t,n),Or(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(gU,a)}var Pm=ue({greaterEqual_:Y9e});function Z9e(r,e){let t=ee(r,"a","lessEqual","string_or_numeric"),n=ee(e,"b","lessEqual","string_or_numeric");[t,n]=en(t,n),Or(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(sXe,a)}var Mm=ue({lessEqual_:Z9e});function J9e(r,e){let t=ee(r,"a","logicalAnd","bool"),n=ee(e,"b","logicalAnd","bool");Or(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(uXe,a)}var Rh=ue({logicalAnd_:J9e});function Q9e(r){let t={x:ee(r,"x","clone","string_or_numeric")};return ae.runKernel(Ik,t)}var OG=ue({clone_:Q9e});function eYe(r,e){let t=ee(r,"broadcastTo","x"),n=t.shape;if(Bh(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){let c=t.shape.slice();for(;c.length<e.length;)c.unshift(1);t=pe(t,c)}let a=t.shape,i=Array.from(e);for(let c=e.length-1;c>=0;c--)if(a[c]===e[c])i[c]=1;else if(t.shape[c]!==1)throw new Error(`broadcastTo(): [${n}] cannot be broadcast to [${e}].`);if(i.map((c,l)=>c>1?l:-1).filter(c=>c>=0).length===0)return OG(t);let s={x:t},u={reps:i};return ae.runKernel(Ck,s,u)}var Sm=ue({broadcastTo_:eYe});function tYe(r,e,t){let n=ee(e,"a","where"),a=ee(t,"b","where"),i=ee(r,"condition","where","bool"),o=Or(Or(i.shape,n.shape),a.shape),s=Sm(i,o),u=Sm(n,o),c=Sm(a,o),l={condition:s,t:u,e:c};return ae.runKernel(ZU,l)}var go=ue({where_:tYe});var rYe={kernelName:ZV,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{clipValueMin:a,clipValueMax:i}=t;return{x:()=>go(Rh(Pm(n,a),Mm(n,i)),r,kr(r))}}};var nYe={kernelName:JV,inputsToSave:["x"],gradFunc:FG.gradFunc};function aYe(r,e,t=0){let a={x:ee(r,"x","split")},i={numOrSizeSplits:e,axis:t};return ae.runKernel(uG,a,i)}var Am=ue({split_:aYe});var iYe={kernelName:QV,saveAllInputs:!0,gradFunc:(r,e,t)=>{let n=e.map(u=>u.shape),{axis:a}=t,i=Ui(a,e[0].shape)[0],o=n.map(u=>u[i]);return Am(r,o,i).map(u=>()=>u)}};function oYe(r,e,t,n,a,i="NHWC",o){let s=r;r.rank===3&&(s=pe(r,[1,r.shape[0],r.shape[1],r.shape[2]]));let u=e;u.rank===3&&(u=pe(e,[1,e.shape[0],e.shape[1],e.shape[2]])),ie(s.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${s.shape}.`),ie(u.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`),ie(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);let c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];ie(c===t[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${t[2]}.`),ie(l===t[3],()=>`Error in conv2dDerFilter: depth of dy (${l}) must match output depth for filter (${t[3]}).`),Ti("conv2dDerFilter",a,o);let f={x:s,dy:u},h={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return ae.runKernel(V7e,f,h)}var PG=ue({conv2DBackpropFilter_:oYe});function sYe(r,e,t,n,a,i="NHWC",o){ie(r.length===e.rank,()=>`Length of inShape (${r.length}) and rank of dy (${e.rank}) must match`);let s=r,u=e,c=!1;e.rank===3&&(c=!0,u=pe(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,r[0],r[1],r[2]]),ie(s.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${s.length}.`),ie(u.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`),ie(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);let l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];ie(l===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[2]}.`),ie(f===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${t.shape[3]}.`),Ti("conv2dDerInput",a,o);let h={dy:u,filter:t},p={strides:n,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=ae.runKernel(tU,h,p);return c?pe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var MG=ue({conv2DBackpropInput_:sYe});var uYe={kernelName:eU,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let[n,a]=e,{dilations:i,strides:o,pad:s,dataFormat:u}=t;return ie(Fh(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>MG(n.shape,r,a,o,s,u),filter:()=>PG(n,r,a.shape,o,s,u)}}};function cYe(r,e,t,n,a="NHWC",i=[1,1],o){let s=ee(r,"x","conv2d","float32"),u=ee(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=pe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ie(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),ie(u.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`),Ti("conv2d",n,o);let f=a==="NHWC"?c.shape[3]:c.shape[1];ie(f===u.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${u.shape[2]}.`),ie(al(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),ie(Cm(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),ie(Cm(t),()=>"Error in conv2D: Strides should be larger than 0.");let h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=ae.runKernel(eU,h,p);return l?pe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Bm=ue({conv2d_:cYe});var lYe={kernelName:tU,inputsToSave:["dy","filter"],gradFunc:(r,e,t)=>{let[n,a]=e,{strides:i,pad:o,dataFormat:s,dimRoundingMode:u}=t;return{dy:()=>Bm(r,a,i,o,s,1,u),filter:()=>PG(r,n,a.shape,i,o,s,u)}}};function fYe(r,e,t,n,a){let i=r;r.rank===4&&(i=pe(r,[1,r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));let o=e;o.rank===4&&(o=pe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),ie(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),ie(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),ie(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),ie(i.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${t[3]}.`),ie(o.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${t[4]}).`);let s={x:i,dy:o},u={strides:n,pad:a,filterShape:t};return ae.runKernel(G7e,s,u)}var hYe=ue({conv3DBackpropFilter_:fYe});function pYe(r,e,t,n,a){ie(r.length===e.rank,()=>`Length of inShape (${r.length}) and rank of dy (${e.rank}) must match`);let i=r,o=e,s=!1;e.rank===4&&(s=!0,o=pe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,r[0],r[1],r[2],r[3]]);let u=i[4],c=o.shape[4];ie(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),ie(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),ie(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),ie(u===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${t.shape[3]}.`),ie(c===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${t.shape[4]}.`);let l={dy:o,filter:t},f={pad:a,strides:n,inputShape:i},h=ae.runKernel(H7e,l,f);return s?pe(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var dYe=ue({conv3DBackpropInput_:pYe});var vYe={kernelName:U7e,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let{dilations:n,strides:a,pad:i}=t;ie(Fh(n),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${n}'`);let[o,s]=e;return{x:()=>dYe(o.shape,r,s,a,i),filter:()=>hYe(o,r,s.shape,a,i)}}};function mYe(r){let t={x:ee(r,"x","sin","float32")};return ae.runKernel(eG,t)}var BG=ue({sin_:mYe});var gYe={kernelName:rU,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>$e(En(BG(ot(t,"float32"))),r)}}};function yYe(r){let t={x:ee(r,"x","sinh")};return ae.runKernel(tG,t)}var LG=ue({sinh_:yYe});var bYe={kernelName:nU,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>$e(LG(ot(t,"float32")),r)}}};function wYe(r,e){for(let t=0;t<r.length;++t)if(r[r.length-t-1]!==e-1-t)return!1;return!0}function xYe(r,e,t){let n=r.length+e.length,a=[],i=0,o=0;for(let s=0;s<n;s++)t.indexOf(s)===-1?a.push(r[i++]):a.push(e[o++]);return a}function kYe(r,e){let t=[],n=r.length;for(let i=0;i<n;i++)e.indexOf(i)===-1&&t.push(r[i]);let a=e.map(i=>r[i]);return[t,a]}function Dm(r,e){let t=e.map(n=>1);return xYe(r,t,e)}function zG(r,e){if(wYe(r,e))return null;let t=[];for(let n=0;n<e;++n)r.indexOf(n)===-1&&t.push(n);return r.forEach(n=>t.push(n)),t}function Mk(r){return r.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function SYe(r,e=0,t=!1,n=!1){let i={x:ee(r,"x","cumsum")},o={axis:e,exclusive:t,reverse:n};return ae.runKernel(aU,i,o)}var $G=ue({cumsum_:SYe});function NYe(r){dr().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}JXe(NYe);function TYe(r,e){return ae.tidy(r,e)}function kV(r){CG(r).forEach(t=>t.dispose())}function EYe(r,e){let t=ee(r,"real","complex"),n=ee(e,"imag","complex");IXe(t.shape,n.shape,`real and imag shapes, ${t.shape} and ${n.shape}, must match in call to tf.complex().`);let a={real:t,imag:n};return ae.runKernel(W7e,a)}var tl=ue({complex_:EYe});function IYe(r){let t={input:ee(r,"input","imag")};return ae.runKernel(iXe,t)}var Bk=ue({imag_:IYe});function CYe(r){let t={input:ee(r,"input","real")};return ae.runKernel(gXe,t)}var _m=ue({real_:CYe});function AYe(r,e,t){let n=ee(r,"x","transpose");if(e==null&&(e=n.shape.map((o,s)=>s).reverse()),ie(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of perm ${e}.`),e.forEach(o=>{ie(o>=0&&o<n.rank,()=>`All entries in 'perm' must be between 0 and ${n.rank-1} but got ${e}`)}),n.rank<=1)return n.clone();let a={x:n},i={perm:e};return n.dtype==="complex64"?TYe(()=>{let o=_m(n),s=Bk(n);return o=ae.runKernel(wm,{x:o},i),s=ae.runKernel(wm,{x:s},i),t&&(s=En(s)),tl(o,s)}):ae.runKernel(wm,a,i)}var Tu=ue({transpose_:AYe});var DYe={kernelName:aU,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{axis:a,exclusive:i,reverse:o}=t;return{x:()=>{let s=zG([a],n.rank),u=$G(r,a,i,!o);return s!=null&&(u=Tu(u,s)),u}}}};function _Ye(r,e,t,n,a,i=[1,1],o){let s=r;r.rank===3&&(s=pe(r,[1,r.shape[0],r.shape[1],r.shape[2]]));let u=e;u.rank===3&&(u=pe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let c={x:s,dy:u},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return ae.runKernel(X7e,c,l)}var FYe=ue({depthwiseConv2dNativeBackpropFilter_:_Ye});function RYe(r,e,t,n,a,i=[1,1],o){let s=e,u=!1;e.rank===3&&(u=!0,s=pe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let c={dy:s,filter:t},l={strides:n,pad:a,dimRoundingMode:o,dilations:i,inputShape:r},f=ae.runKernel(Y7e,c,l);return u?pe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var OYe=ue({depthwiseConv2dNativeBackpropInput_:RYe});var PYe={kernelName:iU,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let{dilations:n,strides:a,pad:i,dimRoundingMode:o}=t,s=n??[1,1];ie(Fh(s),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`);let[u,c]=e;return ie(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${u.rank}.`),ie(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),ie(u.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),ie(al(a,s),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${a} and dilations '${s}'.`),Ti("depthwiseConv2d",i,o),{x:()=>OYe(u.shape,r,c,a,i,s,o),filter:()=>FYe(u,r,c.shape,a,i,s,o)}}};var MYe={kernelName:oU,inputsToSave:["x","filter"],gradFunc:(r,e,t)=>{let[n,a]=e,i={x:n,filter:a,dy:r},o={x:n,filter:a,dy:r};return{x:()=>ae.runKernel(Z7e,i,t),filter:()=>ae.runKernel(J7e,o,t)}}};var BYe={kernelName:uU,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e,n={dy:r,y:t};return{x:()=>ae.runKernel(Q7e,n)}}};function LYe(r){let t={x:ee(r,"x","exp")};return ae.runKernel(lU,t)}var ls=ue({exp_:LYe});var zYe={kernelName:cU,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e,n=$e(ls(En(cn(t))),2/Math.sqrt(Math.PI));return{x:()=>$e(r,n)}}};var $Ye={kernelName:lU,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e;return{x:()=>$e(r,t)}}};var qYe={kernelName:fU,inputsToSave:["input"],gradFunc:(r,e)=>{let[t]=e;return{input:()=>pe(r,t.shape)}}};var WYe={kernelName:hU,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>$e(r,ls(t))}}};var VYe={kernelName:pU,gradFunc:r=>({x:()=>kr(r)})};var UYe={kernelName:dU,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Or(t.shape,n.shape);return{a:()=>{let s=Rr(r,ot(n,"float32")),u=ln(t.shape,a);return u.length>0?pe(Et(s,u),t.shape):s},b:()=>{let s=$e(r,ot(t,"float32")),u=ln(n.shape,a);u.length>0&&(s=pe(Et(s,u),n.shape));let c=cn(n);return En(Rr(s,ot(c,"float32")))}}}};function GYe(r){let t={x:ee(r,"x","rsqrt","float32")};return ae.runKernel(YU,t)}var qG=ue({rsqrt_:GYe});function HYe(r,e){let t=ee(r,"x","tile","string_or_numeric");ie(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);let n={x:t},a={reps:e};return ae.runKernel(Ck,n,a)}var WG=ue({tile_:HYe});var KYe={kernelName:vU,inputsToSave:["x","mean","variance","scale"],gradFunc:(r,e,t)=>{let{varianceEpsilon:n}=t,[a,i,o,s]=e,u=s??Qr(1),c=ln(i.shape,a.shape),l=[];if(i.rank===1){for(let b=0;b<a.shape.length-1;++b)l.push(a.shape[b]);l.push(1)}let f=dn(a,i),h=$e(r,u),p=qG(Qa(o,Qr(n))),d=$e($e($e(p,p),p),Qr(-.5));return{x:()=>i.rank===1?pe($e($e(r,WG(pe(p,[1,1,1,i.shape[0]]),l)),u),a.shape):pe($e($e(r,p),u),a.shape),mean:()=>{let b=$e($e(p,Qr(-1)),h);return i.rank===1&&(b=Et(b,c)),pe(b,i.shape)},variance:()=>{let b=$e($e(d,f),h);return i.rank===1&&(b=Et(b,c)),pe(b,i.shape)},scale:()=>{let b=$e(f,p),x=$e(r,b);return i.rank===1&&(x=Et(x,c)),pe(x,i.shape)},offset:()=>{let b=r;return i.rank===1&&(b=Et(b,c)),pe(b,i.shape)}}}};function jYe(r,e,t){let n=ee(r,"x","unsortedSegmentSum"),a=ee(e,"segmentIds","unsortedSegmentSum","int32");ie(Ah(t),()=>"numSegments must be of dtype int");let i={x:n,segmentIds:a},o={numSegments:t};return ae.runKernel(vG,i,o)}var VG=ue({unsortedSegmentSum_:jYe});var XYe={kernelName:mU,inputsToSave:["x","indices"],gradFunc:(r,e,t)=>{let[n,a]=e,{axis:i}=t,o=Ui(i,n.shape)[0];return{x:()=>{let u=n.shape,c=a.size,l=u.slice(0,o),f=l.length,h=u.slice(i,u.length).slice(1),p=h.length,d=SV(0,f),m=SV(f+1,f+1+p),v=NV([l,[c],h]),g=pe(r,v),y=pe(a,[c]),w=NV([[f],d,m]),b=Tu(g,w),x=VG(b,y,n.shape[o]),S=Mk(w);return x=Tu(x,S),x},indices:()=>a}}};function SV(r,e){let t=[];for(let n=r;n<e;++n)t.push(n);return t}function NV(r){let e=[];for(let t=0;t<r.length;++t)for(let n=0;n<r[t].length;++n)e.push(r[t][n]);return e}var YYe={kernelName:gU,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e;return{a:()=>kr(t),b:()=>kr(n)}}};var ZYe={kernelName:Ik,gradFunc:r=>({x:()=>ot(r,"float32")})};var JYe={kernelName:yU,gradFunc:r=>({x:()=>kr(r)})};var QYe={kernelName:bU,gradFunc:r=>({x:()=>kr(r)})};var eZe={kernelName:wU,gradFunc:r=>({x:()=>kr(r)})};function tZe(r,e){let t=ee(r,"a","greater","string_or_numeric"),n=ee(e,"b","greater","string_or_numeric");[t,n]=en(t,n),Or(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(nXe,a)}var il=ue({greater_:tZe});var rZe={kernelName:xU,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{alpha:a}=t,i=il(n,0);return{x:()=>go(i,r,$e(r,a))}}};var nZe={kernelName:SU,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Rr(r,Qa(t,1))}}};var aZe={kernelName:kU,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Rr(r,ot(t,"float32"))}}};var iZe={kernelName:fXe,inputsToSave:[],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n]=e,{axis:a}=t;return{logits:()=>{let o=ls(n);return dn(r,$e(Et(r,a,!0),o))}}}};function oZe(r,e,t,n=5,a=1,i=1,o=.5){let s={x:r,y:e,dy:t},u={depthRadius:n,bias:a,alpha:i,beta:o};return ae.runKernel(hXe,s,u)}var sZe=ue({localResponseNormalizationBackprop_:oZe});var uZe={kernelName:NU,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n,a]=e,{depthRadius:i,bias:o,alpha:s,beta:u}=t;return{x:()=>sZe(n,a,r,i,o,s,u)}}};function cZe(r,e){let t=ee(r,"a","equal","string_or_numeric"),n=ee(e,"b","equal","string_or_numeric");[t,n]=en(t,n),Or(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(eXe,a)}var Lk=ue({equal_:cZe});function UG(r,e,t,n){return e.rank<t.rank&&(e=pe(e,Dm(e.shape,n))),r.rank<t.rank&&(r=pe(r,Dm(r.shape,n))),{x:()=>$e(r,ot(Lk(t,e),r.dtype))}}var TV={kernelName:TU,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let n=t,{reductionIndices:a}=n,i=e[0],o=e[1],s=Ui(a,i.shape),u=UG(r,o,i,s);return{x:()=>u.x()}}};function lZe(r,e){let t=ee(r,"a","less","string_or_numeric"),n=ee(e,"b","less","string_or_numeric");[t,n]=en(t,n),Or(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(oXe,a)}var GG=ue({less_:lZe});var fZe={kernelName:EU,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e;return{a:()=>$e(r,ot(Pm(t,n),"float32")),b:()=>$e(r,ot(GG(t,n),"float32"))}}};function hZe(r,e,t,n,a,i,o){let s=ee(r,"dy","maxPool3dGrad"),u=ee(e,"input","maxPool3dGrad"),c=ee(t,"output","maxPool3dGrad"),l=s,f=u,h=c,p=!1;u.rank===4&&(p=!0,l=pe(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),f=pe(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=pe(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),ie(l.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),ie(f.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${f.rank}.`),ie(h.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${h.rank}.`),Ti("maxPool3dGrad",i,o);let d={dy:l,input:f,output:h},m={filterSize:n,strides:a,pad:i,dimRoundingMode:o},v=ae.runKernel(vXe,d,m);return p?pe(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}var pZe=ue({maxPool3dGrad_:hZe});var dZe={kernelName:dXe,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n,a]=e,{filterSize:i,strides:o,pad:s,dimRoundingMode:u}=t;return{x:()=>pZe(r,n,a,i,o,s,u)}}};function vZe(r,e,t,n,a,i,o){let s=ee(r,"dy","maxPoolGrad"),u=ee(e,"input","maxPoolGrad"),c=ee(t,"output","maxPoolGrad");ie(u.rank===s.rank,()=>`Rank of input (${u.rank}) does not match rank of dy (${s.rank})`),ie(s.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${s.rank}.`),ie(u.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${u.rank}.`),Ti("maxPoolGrad",i,o);let l={dy:s,input:u,output:c},f={filterSize:n,strides:a,pad:i,dimRoundingMode:o};return ae.runKernel(pXe,l,f)}var mZe=ue({maxPoolGrad_:vZe});var gZe={kernelName:IU,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n,a]=e,{filterSize:i,strides:o,pad:s}=t;return{x:()=>mZe(r,n,a,i,o,s)}}};function Oh(r,e="float32"){if(Bh(r),e==="complex64"){let n=Oh(r,"float32"),a=Oh(r,"float32");return tl(n,a)}let t=_k(mo(r),e);return ae.makeTensor(t,r,e)}function Lm(r,e="float32"){if(Bh(r),e==="complex64"){let n=Lm(r,"float32"),a=Oh(r,"float32");return tl(n,a)}let t=wG(mo(r),e);return ae.makeTensor(t,r,e)}var yZe={kernelName:CU,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{axis:a}=t,i=Ui(a,n.shape),s=kYe(n.shape,i)[1],u=mo(s);return{x:()=>{let l=n.shape.slice();i.forEach(p=>{l[p]=1});let f=pe(r,l);return Rr($e(f,Lm(n.shape,"float32")),u)}}}};var bZe={kernelName:AU,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(r,e,t)=>{let n=t,{axis:a}=n,[i,o]=e,s=Ui(a,i.shape),u=UG(r,o,i,s);return{x:()=>u.x()}}};var wZe={kernelName:DU,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e;return{a:()=>$e(r,ot(Mm(t,n),"float32")),b:()=>$e(r,ot(il(t,n),"float32"))}}};function xZe(r,e,t){let n=ee(r,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");let a={x:n},i={begin:e,size:t};return ae.runKernel(QU,a,i)}var Vi=ue({slice_:xZe});var kZe={kernelName:_U,inputsToSave:["x"],gradFunc:(r,e,t)=>{let n=e[0],{paddings:a}=t,i=a.map(o=>o[0]);return{x:()=>Vi(r,i,n.shape)}}};function SZe(r){let t={x:ee(r,"x","floor","float32")};return ae.runKernel(pU,t)}var HG=ue({floor_:SZe});var NZe={kernelName:FU,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Or(t.shape,n.shape);return{a:()=>{let s=ln(t.shape,a);return s.length>0?pe(Et(r,s),t.shape):r},b:()=>{let s=$e(r,En(HG(Rr(t,n)))),u=ln(n.shape,a);return u.length>0?pe(Et(s,u),n.shape):s}}}};var TZe={kernelName:RU,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Or(t.shape,n.shape);return{a:()=>{let s=$e(r,ot(n,"float32")),u=ln(t.shape,a);return u.length>0?pe(Et(s,u),t.shape):s},b:()=>{let s=$e(r,ot(t,"float32")),u=ln(n.shape,a);return u.length>0?pe(Et(s,u),n.shape):s}}}};var EZe={kernelName:OU,gradFunc:r=>({x:()=>En(r)})};var IZe={kernelName:MU,inputsToSave:["indices"],gradFunc:(r,e)=>{let t=e[0];return{indices:()=>Oh(t.shape,"float32")}}};var CZe={kernelName:PU,gradFunc:r=>({x:()=>kr(r)})};function AZe(r,e=0){let t=ee(r,"x","unstack","string_or_numeric");ie(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);let n={value:t},a={axis:e};return ae.runKernel(dG,n,a)}var KG=ue({unstack_:AZe});var DZe={kernelName:BU,saveAllInputs:!0,gradFunc:(r,e,t)=>{let{axis:n}=t;return KG(r,n).map(i=>()=>i)}};var EV={kernelName:LU,inputsToSave:["x"],gradFunc:(r,e,t)=>{let n=e[0],{paddings:a}=t,i=a.map(o=>o[0]);return{x:()=>Vi(r,i,n.shape)}}};function _Ze(r){let t={x:ee(r,"x","log","float32")};return ae.runKernel(kU,t)}var zm=ue({log_:_Ze});function FZe(r,e){let t=ee(r,"base","pow"),n=ee(e,"exp","pow");[t,n]=en(t,n);let a={a:t,b:n};return ae.runKernel(zU,a)}var $m=ue({pow_:FZe});var RZe={kernelName:zU,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(r,e)=>{let[t,n,a]=e,i=t,o=n,s=Or(i.shape,o.shape);return{a:()=>{let l=ot(o,"float32"),f=$e(r,$e(l,$m(i,dn(l,Qr(1))))),h=ln(i.shape,s);return h.length>0&&(f=Et(f,h)),pe(f,i.shape)},b:()=>{let l=il(i,0),f=go(l,zm(i),kr(i)),h=$e(r,$e(a,f)),p=ln(o.shape,s);return p.length>0&&(h=Et(h,p)),pe(h,o.shape)}}}};var OZe={kernelName:$U,inputsToSave:["x","alpha"],gradFunc:(r,e)=>{let[t,n]=e,a=il(t,0);return{x:()=>go(a,r,$e(r,n)),alpha:()=>{let i=go(a,kr(r),$e(r,t)),o=ln(n.shape,r.shape);return o.length>0&&(i=Et(i,o)),pe(i,n.shape)}}}};function PZe(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Ln=dr();Ln.registerFlag("DEBUG",()=>!1,r=>{r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Ln.registerFlag("IS_BROWSER",()=>PZe());Ln.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Ln.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Ln.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));Ln.registerFlag("PROD",()=>!1);Ln.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Ln.getBool("DEBUG"));Ln.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Ln.registerFlag("IS_TEST",()=>!1);Ln.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>Ln.getBool("DEBUG"));Ln.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);Ln.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);Ln.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);var fs=class{static join(e){return new fs(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(n=>ei(n)?n.buffer:n),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let n=0;n<e.length;n++){let a=e[n];n!==e.length-1&&a.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);let i=t+a.byteLength;this.shards.push({buffer:a,start:t,end:i}),t=i}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);let n=this.findShardForByte(e);if(n===-1)throw new Error(`Could not find start shard for byte ${e}`);let a=t-e,i=new ArrayBuffer(a),o=new Uint8Array(i),s=0;for(let u=n;u<this.shards.length;u++){let c=this.shards[u],f=e+s-c.start,h=s,d=Math.min(t,c.end)-c.start,m=new Uint8Array(c.buffer,f,d-f);if(o.set(m,h),s+=m.length,t<c.end)break}return i}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(a){return e<a.start?-1:e>=a.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;let n=MZe(this.shards,t);return n===-1?-1:(this.previousShardIndex=n,this.previousShardIndex)}};function MZe(r,e){let t=0,n=r.length;for(;t<=n;){let a=Math.floor((n-t)/2)+t,i=e(r[a]);if(i===0)return a;i<0?n=a:t=a+1}return-1}var zk=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function IV(r){return zk?Buffer.byteLength(r,"utf8"):new Blob([r]).size}function BZe(r){if(zk)return Buffer.from(r).toString("base64");let e=new Uint8Array(r),t="";for(let n=0,a=e.length;n<a;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function LZe(r){if(zk){let n=Buffer.from(r,"base64");return n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}let e=atob(r),t=new Uint8Array(e.length);for(let n=0;n<e.length;++n)t.set([e.charCodeAt(n)],n);return t.buffer}function jG(r,e){let t={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy,weightsManifest:e};return r.signature!=null&&(t.signature=r.signature),r.userDefinedMetadata!=null&&(t.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(t.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(t.initializerSignature=r.initializerSignature),r.trainingConfig!=null&&(t.trainingConfig=r.trainingConfig),t}function zZe(r,e,t){let n={modelTopology:r.modelTopology,format:r.format,generatedBy:r.generatedBy,convertedBy:r.convertedBy};if(r.trainingConfig!=null&&(n.trainingConfig=r.trainingConfig),r.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");n.weightSpecs=e,n.weightData=t}return r.signature!=null&&(n.signature=r.signature),r.userDefinedMetadata!=null&&(n.userDefinedMetadata=r.userDefinedMetadata),r.modelInitializer!=null&&(n.modelInitializer=r.modelInitializer),r.initializerSignature!=null&&(n.initializerSignature=r.initializerSignature),n}async function $Ze(r,e){let t,n;return r.weightsManifest!=null&&([t,n]=await e(r.weightsManifest)),zZe(r,t,n)}function qm(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:IV(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:IV(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:new fs(r.weightData).byteLength}}function qZe(r){let e=[];for(let t of r)e.push(...t.weights);return e}var Ur=class{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Ur.instance==null&&(Ur.instance=new Ur),Ur.instance}static registerSaveRouter(e){Ur.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Ur.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Ur.getHandlers(e,"save")}static getLoadHandlers(e,t){return Ur.getHandlers(e,"load",t)}static getHandlers(e,t,n){let a=[];return(t==="load"?Ur.getInstance().loadRouters:Ur.getInstance().saveRouters).forEach(o=>{let s=o(e,n);s!==null&&a.push(s)}),a}};var WZe="tensorflowjs",VZe=1,Ch="models_store",Nm="model_info_store";function UZe(){if(!dr().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let r=typeof window>"u"?self:window,e=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function GZe(r){let e=r.result;e.createObjectStore(Ch,{keyPath:"modelPath"}),e.createObjectStore(Nm,{keyPath:"modelPath"})}var rl=class{constructor(e){if(this.indexedDB=UZe(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((n,a)=>{let i=this.indexedDB.open(WZe,VZe);i.onupgradeneeded=()=>GZe(i),i.onsuccess=()=>{let o=i.result;if(t==null){let s=o.transaction(Ch,"readonly"),c=s.objectStore(Ch).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return o.close(),a(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));n(c.result.modelArtifacts)},c.onerror=l=>(o.close(),a(c.error)),s.oncomplete=()=>o.close()}else{let s=qm(t),u=o.transaction(Nm,"readwrite"),c=u.objectStore(Nm),l;try{l=c.put({modelPath:this.modelPath,modelArtifactsInfo:s})}catch(h){return a(h)}let f;l.onsuccess=()=>{f=o.transaction(Ch,"readwrite");let h=f.objectStore(Ch),p;try{p=h.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:s})}catch(d){return a(d)}p.onsuccess=()=>n({modelArtifactsInfo:s}),p.onerror=d=>{c=u.objectStore(Nm);let m=c.delete(this.modelPath);m.onsuccess=()=>(o.close(),a(p.error)),m.onerror=v=>(o.close(),a(p.error))}},l.onerror=h=>(o.close(),a(l.error)),u.oncomplete=()=>{f==null?o.close():f.oncomplete=()=>o.close()}}},i.onerror=o=>a(i.error)})}};rl.URL_SCHEME="indexeddb://";var XG=r=>dr().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(rl.URL_SCHEME)?HZe(r.slice(rl.URL_SCHEME.length)):null;Ur.registerSaveRouter(XG);Ur.registerLoadRouter(XG);function HZe(r){return new rl(r)}var Nh="/",Th="tensorflowjs_models",KZe="info",jZe="model_topology",XZe="weight_specs",YZe="weight_data",ZZe="model_metadata";function JZe(r){return{info:[Th,r,KZe].join(Nh),topology:[Th,r,jZe].join(Nh),weightSpecs:[Th,r,XZe].join(Nh),weightData:[Th,r,YZe].join(Nh),modelMetadata:[Th,r,ZZe].join(Nh)}}function QZe(r){for(let e of Object.values(r))window.localStorage.removeItem(e)}var nl=class{constructor(e){if(!dr().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=JZe(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),a=qm(e),i=fs.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,BZe(i));let o={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:a}}catch{throw QZe(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${a.modelTopologyBytes}, weightSpecsBytes=${a.weightSpecsBytes}, weightDataBytes=${a.weightDataBytes}.`)}}}async load(){let e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let t={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(n==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=n;let a=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(a==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=a;let i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){let s=JSON.parse(i);t.format=s.format,t.generatedBy=s.generatedBy,t.convertedBy=s.convertedBy,s.signature!=null&&(t.signature=s.signature),s.userDefinedMetadata!=null&&(t.userDefinedMetadata=s.userDefinedMetadata),s.modelInitializer!=null&&(t.modelInitializer=s.modelInitializer),s.initializerSignature!=null&&(t.initializerSignature=s.initializerSignature),s.trainingConfig!=null&&(t.trainingConfig=s.trainingConfig)}let o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=LZe(o),t}};nl.URL_SCHEME="localstorage://";var YG=r=>dr().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(nl.URL_SCHEME)?eJe(r.slice(nl.URL_SCHEME.length)):null;Ur.registerSaveRouter(YG);Ur.registerLoadRouter(YG);function eJe(r){return new nl(r)}var tJe="model",rJe=".json",nJe=".weights.bin";function CV(r){return new Promise(e=>setTimeout(e)).then(r)}var yo=class{constructor(e){if(!dr().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(yo.URL_SCHEME)&&(e=e.slice(yo.URL_SCHEME.length)),(e==null||e.length===0)&&(e=tJe),this.modelJsonFileName=e+rJe,this.weightDataFileName=e+nJe}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");let t=fs.join(e.weightData),n=window.URL.createObjectURL(new Blob([t],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let a=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i=jG(e,a),o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),s=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(s.download=this.modelJsonFileName,s.href=o,await CV(()=>s.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){let u=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;u.download=this.weightDataFileName,u.href=n,await CV(()=>u.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:qm(e)}}}};yo.URL_SCHEME="downloads://";var aJe=r=>dr().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(yo.URL_SCHEME)?iJe(r.slice(yo.URL_SCHEME.length)):null;Ur.registerSaveRouter(aJe);function iJe(r="model"){return new yo(r)}function AV(r,e,t,n){o(r),t=t??0,n=n??1,s(t,n);let a=0,i=u=>(u.then(c=>{let l=t+ ++a/r.length*(n-t);return e(l),c}),u);function o(u){ie(u!=null&&Array.isArray(u)&&u.length>0,()=>"promises must be a none empty array")}function s(u,c){ie(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${u}`),ie(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),ie(c>=u,()=>`startFraction must be no more than endFraction, but got startFraction ${u} and endFraction ${c}`)}return Promise.all(r.map(i))}async function oJe(r,e){e==null&&(e={});let t=e.fetchFunc==null?dr().platform.fetch:e.fetchFunc,n=r.map(f=>t(f,e.requestInit,{isBinary:!0})),a=0,i=.5,s=(e.onProgress==null?await Promise.all(n):await AV(n,e.onProgress,a,i)).map(f=>f.arrayBuffer()),u=.5,c=1;return e.onProgress==null?await Promise.all(s):await AV(s,e.onProgress,u,c)}var sJe="application/octet-stream",uJe="application/json",Ph=class{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(ie(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=dr().platform.fetch,ie(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&ie(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;let n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=jG(e,n);if(t.body.append("model.json",new Blob([JSON.stringify(a)],{type:uJe}),"model.json"),e.weightData!=null){let o=fs.join(e.weightData);t.body.append("model.weights.bin",new Blob([o],{type:sJe}),"model.weights.bin")}let i=await this.fetch(this.path,t);if(i.ok)return{modelArtifactsInfo:qm(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async load(){let e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}let n=t.modelTopology,a=t.weightsManifest;if(n==null&&a==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return $Ze(t,i=>this.loadWeights(i))}async loadWeights(e){let t=Array.isArray(this.path)?this.path[1]:this.path,[n,a]=cJe(t),i=this.weightPathPrefix||n,o=qZe(e),s=[],u=[];for(let l of e)for(let f of l.paths)this.weightUrlConverter!=null?u.push(this.weightUrlConverter(f)):s.push(i+f+a);this.weightUrlConverter&&s.push(...await Promise.all(u));let c=await oJe(s,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[o,c]}};Ph.URL_SCHEME_REGEX=/^https?:\/\//;function cJe(r){let e=r.lastIndexOf("/"),t=r.lastIndexOf("?"),n=r.substring(0,e),a=t>e?r.substring(t):"";return[n+"/",a]}function DV(r){return r.match(Ph.URL_SCHEME_REGEX)!=null}var ZG=(r,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(r)?t=r.every(n=>DV(n)):t=DV(r),t)return lJe(r,e)}return null};Ur.registerSaveRouter(ZG);Ur.registerLoadRouter(ZG);function lJe(r,e){return new Ph(r,e)}function fJe(r,e,t=1,n=0,a="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);let o={indices:ee(r,"indices","oneHot","int32")},s={dtype:a,depth:e,onValue:t,offValue:n};return ae.runKernel(MU,o,s)}var hJe=ue({oneHot_:fJe});function pJe(r,e,t){let n=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${r}, sliceDim: ${n}, and batchDim: ${a}.`;if(t.rank<a)throw new Error(i+` update.rank < ${a}. `);if(r.length<n+(t.rank-a))throw new Error(i+` Output shape length < ${n+(t.rank-a)}`);if(t.rank!==a+r.length-n)throw new Error(i+` update.rank != ${a+r.length-n}`);for(let o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+` updates.shape[${o}] (${t.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<t.rank-a;++o)if(t.shape[o+a]!==r[o+n])throw new Error(i+` updates.shape[${o+a}] (${t.shape[o+a]}) != shape[${o+a}] (${r[o+a]})`)}function dJe(r,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(r.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${r.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(r.size===0)throw new Error(`Updates specified for empty output. updates shape: ${r.shape}`)}pJe(t,e,r)}function vJe(r,e,t){let n,a=r.shape.length;typeof e=="number"?n=[e,...new Array(a-1).fill(0)]:e.length<a?n=e.concat(new Array(a-e.length).fill(0)):n=e.slice(),n.forEach(o=>{ie(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=[t,...new Array(a-1).fill(-1)]:t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map((o,s)=>o>=0?o:(ie(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${s}.`),r.shape[s]-n[s])),[n,i]}var wk=class{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}};function mJe(r){let e=ee(r,"x","abs");if(e.dtype==="complex64"){let t={x:e};return ae.runKernel(JV,t)}else{let t={x:e};return ae.runKernel(BV,t)}}var vo=ue({abs_:mJe});function gJe(r){let t={x:ee(r,"x","acos")};return ae.runKernel(LV,t)}var yJe=ue({acos_:gJe});function bJe(r){let t={x:ee(r,"x","acosh")};return ae.runKernel(zV,t)}var wJe=ue({acosh_:bJe});function xJe(r,e=null,t=!1){let a={x:ee(r,"x","all","bool")},i={axis:e,keepDims:t};return ae.runKernel(M7e,a,i)}var kJe=ue({all_:xJe});function SJe(r,e=null,t=!1){let a={x:ee(r,"x","any","bool")},i={axis:e,keepDims:t};return ae.runKernel(B7e,a,i)}var NJe=ue({any_:SJe});function TJe(r,e=0){let n={x:ee(r,"x","argMax")},a={axis:e};return ae.runKernel($V,n,a)}var EJe=ue({argMax_:TJe});function IJe(r,e=0){let n={x:ee(r,"x","argMin")},a={axis:e};return ae.runKernel(qV,n,a)}var CJe=ue({argMin_:IJe});function AJe(r){let t={x:ee(r,"x","asin")};return ae.runKernel(WV,t)}var DJe=ue({asin_:AJe});function _Je(r){let t={x:ee(r,"x","asinh")};return ae.runKernel(VV,t)}var FJe=ue({asinh_:_Je});function RJe(r){let t={x:ee(r,"x","atan")};return ae.runKernel(UV,t)}var OJe=ue({atan_:RJe});function PJe(r,e){let t=ee(r,"a","atan2"),n=ee(e,"b","atan2");[t,n]=en(t,n);let a={a:t,b:n};return ae.runKernel(HV,a)}var MJe=ue({atan2_:PJe});function BJe(r){let t={x:ee(r,"x","atanh")};return ae.runKernel(GV,t)}var LJe=ue({atanh_:BJe});function zJe(r,e,t,n,a){let i=ee(r,"x","avgPool","float32"),o=1;ie(al(t,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);let s=i,u=!1;i.rank===3&&(u=!0,s=pe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),ie(s.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${s.rank}.`),Ti("avgPool",n,a);let c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=ae.runKernel(KV,c,l);return f=ot(f,i.dtype),u?pe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var JG=ue({avgPool_:zJe});function $Je(r,e=0){ie(r.length>=1,()=>"Pass at least one tensor to concat");let t=_G(r,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),t.length===1)return OG(t[0]);let n=t,a={axis:e};return ae.runKernel(QV,n,a)}var Mh=ue({concat_:$Je});function qJe(r){let t={x:ee(r,"x","sigmoid","float32")};return ae.runKernel(nG,t)}var $k=ue({sigmoid_:qJe});function WJe(r){let t={x:ee(r,"x","tanh","float32")};return ae.runKernel(pG,t)}var VJe=ue({tanh_:WJe});function UJe(r,e,t){let n=ee(r,"x","batchToSpaceND"),a=e.reduce((s,u)=>s*u);ie(n.rank>=1+e.length,()=>`input rank is ${n.rank} but should be > than blockShape.length ${e.length}`),ie(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),ie(n.shape[0]%a===0,()=>`input tensor batch is ${n.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${a}`);let i={x:n},o={blockShape:e,crops:t};return ae.runKernel(XV,i,o)}var qk=ue({batchToSpaceND_:UJe});function GJe(r){let e;return r.rank===0||r.rank===1?e=pe(r,[1,1,1,r.size]):r.rank===2?e=pe(r,[1,1,r.shape[0],r.shape[1]]):r.rank===3?e=pe(r,[1,r.shape[0],r.shape[1],r.shape[2]]):e=r,e}function HJe(r,e,t,n,a,i){i==null&&(i=.001);let o=ee(r,"x","batchNorm"),s=ee(e,"mean","batchNorm"),u=ee(t,"variance","batchNorm"),c;a!=null&&(c=ee(a,"scale","batchNorm"));let l;n!=null&&(l=ee(n,"offset","batchNorm")),ie(s.rank===u.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),ie(l==null||s.rank===l.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),ie(c==null||s.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let h={x:GJe(o),scale:c,offset:l,mean:s,variance:u},p={varianceEpsilon:i},d=ae.runKernel(vU,h,p);return pe(d,o.shape)}var KJe=ue({batchNorm_:HJe});function jJe(r){let t={x:ee(r,"x","ceil","float32")};return ae.runKernel(YV,t)}var XJe=ue({ceil_:jJe});function YJe(r,e,t){Bh(r),t=t||Rm(e);let n={shape:r,value:e,dtype:t};return ae.runKernel(rXe,{},n)}function ZJe(r,e,t){let n=ee(r,"x","clipByValue");if(ie(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return YJe(n.shape,e,n.dtype);let a={x:n},i={clipValueMin:e,clipValueMax:t};return ae.runKernel(ZV,a,i)}var JJe=ue({clipByValue_:ZJe});function QJe(r,e,t,n,a="NWC",i=1,o){let s=ee(r,"x","conv1d"),u=ee(e,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=pe(s,[1,s.shape[0],s.shape[1]])),ie(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),ie(u.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`),Ti("conv1d",n,o),ie(c.shape[2]===u.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${u.shape[1]}.`),ie(al(t,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${i}'`),ie(Cm(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),ie(Cm(t),()=>"Error in conv1D: Stride should be larger than 0."),ie(a==="NWC",()=>`Error in conv1d: got dataFormat of ${a} but only NWC is currently supported.`);let f=pe(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=pe(c,[c.shape[0],1,c.shape[1],c.shape[2]]),v=Bm(h,f,[1,t],n,"NHWC",[1,i],o);return l?pe(v,[v.shape[2],v.shape[3]]):pe(v,[v.shape[0],v.shape[2],v.shape[3]])}var eQe=ue({conv1d_:QJe});function tQe(r,e,t,n,a,i){let o=ee(r,"x","conv2dTranspose"),s=ee(e,"filter","conv2dTranspose");return MG(t,o,s,n,a,"NHWC",i)}var rQe=ue({conv2dTranspose_:tQe});function nQe(r){let t={x:ee(r,"x","cos","float32")};return ae.runKernel(rU,t)}var Wk=ue({cos_:nQe});function aQe(r){let t={x:ee(r,"x","cosh","float32")};return ae.runKernel(nU,t)}var QG=ue({cosh_:aQe});function iQe(r,e=0,t=!1,n=!1){let i={x:ee(r,"x","cumprod")},o={axis:e,exclusive:t,reverse:n};return ae.runKernel(K7e,i,o)}var xk=ue({cumprod_:iQe});function oQe(r,e,t="NHWC"){let n=ee(r,"x","depthToSpace","float32"),a=t==="NHWC"?n.shape[1]:n.shape[2],i=t==="NHWC"?n.shape[2]:n.shape[3],o=t==="NHWC"?n.shape[3]:n.shape[1];ie(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),ie(a*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${a} and ${e}  for depthToSpace with input shape
    ${n.shape}`),ie(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${n.shape}`),ie(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${n.shape}`);let s={x:n},u={blockSize:e,dataFormat:t};return ae.runKernel(j7e,s,u)}var sQe=ue({depthToSpace_:oQe});function uQe(r,e,t,n,a="NHWC",i=[1,1],o){let s=ee(r,"x","depthwiseConv2d","float32"),u=ee(e,"filter","depthwiseConv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=pe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ie(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),ie(u.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`);let f=a==="NHWC"?c.shape[3]:c.shape[1];ie(f===u.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${f}) must match the inChannels dimension in filter ${u.shape[2]}.`),Ti("depthwiseConv2d",n,o);let h={x:c,filter:u},p={strides:t,pad:n,dataFormat:a,dilations:i,dimRoundingMode:o},d=ae.runKernel(iU,h,p);return l?pe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var e6=ue({depthwiseConv2d_:uQe});function cQe(r,e,t,n,a=[1,1],i="NHWC"){let o=ee(r,"x","dilation2d"),s=ee(e,"filter","dilation2d");ie(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),ie(s.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${s.rank}.`),ie(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let u=o,c=!1;o.rank===3&&(u=pe(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),ie(u.shape[3]===s.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${u.shape[3]} vs ${s.shape[2]}`);let l={x:u,filter:s},f={strides:t,pad:n,dilations:a},h=ae.runKernel(oU,l,f);return c?pe(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var lQe=ue({dilation2d_:cQe});function fQe(r,e){let t=ee(r,"a","div"),n=ee(e,"b","div");[t,n]=en(t,n);let a=Rr(t,n),i=kr(a),o=Lk(n,i);return go(o,i,a)}var hQe=ue({divNoNan_:fQe});function pQe(r,e){let t=ee(r,"t1","dot"),n=ee(e,"t2","dot");ie((t.rank===1||t.rank===2)&&(n.rank===1||n.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${n.rank}.`);let a=t.rank===1?t.size:t.shape[1],i=n.rank===1?n.size:n.shape[0];if(ie(a===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${a} and ${i}.`),t.rank===1&&n.rank===1){let o=pe(t,[1,-1]),s=pe(n,[-1,1]),u=Na(o,s);return pe(u,[])}else if(t.rank===1&&n.rank===2){let o=pe(t,[1,-1]),s=pe(n,[n.shape[0],n.shape[1]]),u=Na(o,s);return pe(u,[u.size])}else if(t.rank===2&&n.rank===1){let o=pe(n,[-1,1]),s=Na(t,o);return pe(s,[s.size])}else{let o=pe(n,[n.shape[0],n.shape[1]]);return Na(t,o)}}var dQe=ue({dot_:pQe});function vQe(r){let t={x:ee(r,"x","elu","float32")};return ae.runKernel(uU,t)}var mQe=ue({elu_:vQe});function gQe(r){let e=ee(r,"x","erf");ie(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=ot(e,"float32"));let t={x:e};return ae.runKernel(cU,t)}var yQe=ue({erf_:gQe});function bQe(r,e=null,t=!1){let a={x:ee(r,"x","max")},i={reductionIndices:e,keepDims:t};return ae.runKernel(TU,a,i)}var Qc=ue({max_:bQe});function wQe(r,e=null,t=!1){let a={x:ee(r,"x","min")},i={axis:e,keepDims:t};return ae.runKernel(AU,a,i)}var kk=ue({min_:wQe});function xQe(r,e="euclidean",t=null,n=!1){r=ee(r,"x","norm");let a=t6(r,e,t),i=a.shape;if(n){let o=Ui(t,r.shape);i=Dm(a.shape,o)}return pe(a,i)}function t6(r,e,t=null){if(r.rank===0)return vo(r);if(r.rank!==1&&t===null)return t6(pe(r,[-1]),e,t);if(r.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Et(vo(r),t);if(e===1/0)return Qc(vo(r),t);if(e===-1/0)return kk(vo(r),t);if(e==="euclidean"||e===2)return cs(Et($m(vo(r),Qr(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return Qc(Et(vo(r),t[0]),t[1]-1);if(e===1/0)return Qc(Et(vo(r),t[1]),t[0]);if(e===-1/0)return kk(Et(vo(r),t[1]),t[0]);if(e==="fro"||e==="euclidean")return cs(Et(cn(r),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}var r6=ue({norm_:xQe});function kQe(r,e=null,t=!1){return r6(r,"euclidean",e,t)}var SQe=ue({euclideanNorm_:kQe});function NQe(r,e=0){let t=ee(r,"x","expandDims","string_or_numeric");ie(e<=t.rank,()=>"Axis must be <= rank of the tensor");let n={input:t},a={dim:e};return ae.runKernel(fU,n,a)}var n6=ue({expandDims_:NQe});function TQe(r){let t={x:ee(r,"x","expm1")};return ae.runKernel(hU,t)}var EQe=ue({expm1_:TQe});function IQe(r,e,t=0,n=0){let a=ee(r,"x","gather"),i=ee(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:n};return ae.runKernel(mU,o,s)}var a6=ue({gather_:IQe});function CQe(r){let t={x:ee(r,"x","isFinite")};return ae.runKernel(yU,t)}var AQe=ue({isFinite_:CQe});function DQe(r){let t={x:ee(r,"x","isInf")};return ae.runKernel(bU,t)}var _Qe=ue({isInf_:DQe});function FQe(r){let t={x:ee(r,"x","isNaN")};return ae.runKernel(wU,t)}var RQe=ue({isNaN_:FQe});function OQe(r,e=.2){let n={x:ee(r,"x","leakyRelu")},a={alpha:e};return ae.runKernel(xU,n,a)}var PQe=ue({leakyRelu_:OQe});function MQe(r,e=5,t=1,n=1,a=.5){let i=ee(r,"x","localResponseNormalization");ie(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),ie(Ah(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,s=!1;i.rank===3&&(s=!0,o=pe(i,[1,i.shape[0],i.shape[1],i.shape[2]]));let u={x:o},c={depthRadius:e,bias:t,alpha:n,beta:a},l=ae.runKernel(NU,u,c);return s?pe(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var BQe=ue({localResponseNormalization_:MQe});function LQe(r){let t={x:ee(r,"x","log1p")};return ae.runKernel(SU,t)}var zQe=ue({log1p_:LQe});function $Qe(r,e){ie(lk(r),()=>"The f passed in variableGrads(f) must be a function"),ie(e==null||Array.isArray(e)&&e.every(c=>c instanceof el),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");let t=e!=null;if(!t){e=[];for(let c in ae.registeredVariables)e.push(ae.registeredVariables[c])}let n=t?e.filter(c=>!c.trainable):null,a=e.length;e=e.filter(c=>c.trainable),ie(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${a} variables is trainable.`);let i=!0,{value:o,grads:s}=ae.gradients(r,e,null,i);ie(s.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),ie(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);let u={};return e.forEach((c,l)=>{s[l]!=null&&(u[c.name]=s[l])}),n?.forEach(c=>u[c.name]=null),{value:o,grads:u}}function i6(r){return ae.customGrad(r)}function qQe(r){let t={x:ee(r,"x","softplus")};return ae.runKernel(aG,t)}var o6=ue({softplus_:qQe});function WQe(r){let e=ee(r,"x","logSigmoid");return i6(n=>({value:En(o6(En(n))),gradFunc:o=>$e(o,$k(En(n)))}))(e)}var VQe=ue({logSigmoid_:WQe});function UQe(r,e=-1){let t=ee(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return i6((a,i)=>{let s=Qc(a,e,!0),u=dn(a,s),c=dn(ot(u,"float32"),zm(Et(ls(u),e,!0)));return i([c]),{value:c,gradFunc:(f,h)=>{let[p]=h,d=!0,m=ls(p);return dn(f,$e(Et(f,e,d),m))}}})(t)}var GQe=ue({logSoftmax_:UQe});function HQe(r,e=null,t=!1){let n=ee(r,"x","logSumExp"),a=Ui(e,n.shape),i=Qc(n,a,!0),o=dn(n,i),s=ls(o),u=Et(s,a),c=zm(u),l=Qa(pe(i,c.shape),c);if(t){let f=Dm(l.shape,a);return pe(l,f)}return l}var KQe=ue({logSumExp_:HQe});function jQe(r){let t={x:ee(r,"x","logicalNot","bool")};return ae.runKernel(cXe,t)}var Vk=ue({logicalNot_:jQe});function XQe(r,e){let t=ee(r,"a","logicalOr","bool"),n=ee(e,"b","logicalOr","bool");Or(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(lXe,a)}var s6=ue({logicalOr_:XQe});function YQe(r,e){let t=ee(r,"a","logicalXor","bool"),n=ee(e,"b","logicalXor","bool");return Or(t.shape,n.shape),Rh(s6(r,e),Vk(Rh(r,e)))}var ZQe=ue({logicalXor_:YQe});function JQe(r,e,t,n,a){let i=ee(r,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=pe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),ie(s.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.rank}.`),ie(al(t,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),Ti("maxPool",n,a);let c={x:s},l={filterSize:e,strides:t,pad:n,dimRoundingMode:a},f=ae.runKernel(IU,c,l);return u?pe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var u6=ue({maxPool_:JQe});function QQe(r,e){let t=ee(r,"a","maximum"),n=ee(e,"b","maximum");[t,n]=en(t,n),t.dtype==="bool"&&(t=ot(t,"int32"),n=ot(n,"int32")),Or(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(EU,a)}var c6=ue({maximum_:QQe});function eet(r,e=null,t=!1){let a={x:ee(r,"x","mean")},i={axis:e,keepDims:t};return ae.runKernel(CU,a,i)}var tet=ue({mean_:eet});function ret(r,e){let t=ee(r,"a","minimum"),n=ee(e,"b","minimum");[t,n]=en(t,n),t.dtype==="bool"&&(t=ot(t,"int32"),n=ot(n,"int32")),Or(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(DU,a)}var net=ue({minimum_:ret});function aet(r,e,t){ie(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);let n=ee(r,"x","mirrorPad");if(n.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");ie(e.length===n.rank,()=>`Padding doesn't match input. Must be ${n.rank}. Got ${e.length}.`);let a=t==="reflect"?1:0;for(let s=0;s<n.rank;s++)ie(e[s].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),ie(e[s][0]>=0&&e[s][0]<=n.shape[s]-a&&e[s][1]>=0&&e[s][1]<=n.shape[s]-a,()=>`Padding in dimension ${s} cannot be greater than or equal to ${n.shape[s]-a} or less than 0 for input of shape ${n.shape}`);let i={paddings:e,mode:t},o={x:n};return ae.runKernel(_U,o,i)}var iet=ue({mirrorPad_:aet});function oet(r,e){let t=ee(r,"a","mod"),n=ee(e,"b","mod");[t,n]=en(t,n);let a={a:t,b:n};return ae.runKernel(FU,a)}var set=ue({mod_:oet});function uet(r,e){let t=ee(r,"a","notEqual","string_or_numeric"),n=ee(e,"b","notEqual","string_or_numeric");[t,n]=en(t,n),Or(t.shape,n.shape);let a={a:t,b:n};return ae.runKernel(mXe,a)}var cet=ue({notEqual_:uet});function fet(r){let t={x:ee(r,"x","onesLike")};return ae.runKernel(PU,t)}var het=ue({onesLike_:fet});function pet(r,e,t=0){let n=ee(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let a={paddings:e,constantValue:t},i={x:n};return ae.runKernel(LU,i,a)}var l6=ue({pad_:pet});function det(r,e,t,n,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),n===0&&(n="valid");let s=ee(r,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=pe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ie(al(i,a),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${a}'`);let l=F9e(u.shape,e,i,a,n),f=[l.dilationHeight,l.dilationWidth],h;n==="same"?h=met([l.filterHeight,l.filterWidth],f):h=[[0,0],[0,0]];let p=f[0]===1&&f[1]===1,[d,m]=vet([l.inHeight,l.inWidth],f,h),v=p?n:"valid",g=p?u:Pk(u,f,d),w=(t==="avg"?()=>JG(g,e,i,v,o):()=>u6(g,e,i,v,o))(),b=p?w:qk(w,f,m);return c?pe(b,[b.shape[1],b.shape[2],b.shape[3]]):b}function vet(r,e,t){let n=t.map(l=>l[0]),a=t.map(l=>l[1]),i=r.concat(n,a),o=e.map((l,f)=>(l-i[f]%l)%l),s=a.map((l,f)=>l+o[f]),u=e.map((l,f)=>[n[f],s[f]]),c=e.map((l,f)=>[0,o[f]]);return[u,c]}function met(r,e){let n=r.map((o,s)=>o+(o-1)*(e[s]-1)).map(o=>o-1),a=n.map(o=>Math.floor(o/2)),i=n.map((o,s)=>o-a[s]);return n.map((o,s)=>[a[s],i[s]])}var get=ue({pool_:det});function yet(r,e){let t=ee(r,"x","prelu"),n=ee(e,"alpha","prelu"),a={x:t,alpha:n};return ae.runKernel($U,a)}var bet=ue({prelu_:yet});function wet(r,e=null,t=!1){let n=ee(r,"x","prod");n.dtype==="bool"&&(n=ot(n,"int32"));let a={x:n},i={axis:e,keepDims:t};return ae.runKernel(qU,a,i)}var xet=ue({prod_:wet});var Eu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Uk={exports:{}},lct=Uk.exports;(function(r){(function(e,t,n){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o})(Eu,r,!1)})(Uk);var ket=Uk.exports,Gk={exports:{}},fct=Gk.exports;(function(r){(function(e,t,n){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o})(Eu,r,!1)})(Gk);var Net=Gk.exports,Hk={exports:{}},hct=Hk.exports;(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o})(Eu,r,!1)})(Hk);var Tet=Hk.exports,Kk={exports:{}},pct=Kk.exports;(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,p,d;return h=l[f],h^=h>>>7,p=h^h<<24,h=l[f+1&7],p^=h^h>>>10,h=l[f+3&7],p^=h^h>>>3,h=l[f+4&7],p^=h^h<<7,h=l[f+7&7],h=h^h<<13,p^=h^h<<9,l[f]=p,u.i=f+1&7,p};function c(l,f){var h,p,d=[];if(f===(f|0))p=d[0]=f;else for(f=""+f,h=0;h<f.length;++h)d[h&7]=d[h&7]<<15^f.charCodeAt(h)+d[h+1&7]<<13;for(;d.length<8;)d.push(0);for(h=0;h<8&&d[h]===0;++h);for(h==8?p=d[7]=-1:p=d[h],l.x=d,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o})(Eu,r,!1)})(Kk);var Eet=Kk.exports,jk={exports:{}},dct=jk.exports;(function(r){(function(e,t,n){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,p,d;return u.w=l=l+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(l^l>>>16)|0};function c(l,f){var h,p,d,m,v,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,m=-32;m<y;++m)f&&(p^=f.charCodeAt((m+32)%f.length)),m===0&&(v=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(v=v+1640531527|0,h=g[m&127]^=p+v,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,m=4*128;m>0;--m)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;l.w=v,l.X=g,l.i=d}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o})(Eu,r,!1)})(jk);var Iet=jk.exports,Xk={exports:{}},vct=Xk.exports;(function(r){(function(e,t,n){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o})(Eu,r,!1)})(Xk);var Cet=Xk.exports,Yk={exports:{}},mct=Yk.exports;(function(r){(function(e,t,n){var a=256,i=6,o=52,s="random",u=n.pow(a,i),c=n.pow(2,o),l=c*2,f=a-1,h;function p(b,x,S){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(v(x.entropy?[b,w(t)]:b??y(),3),T),C=new d(T),R=function(){for(var _=C.g(i),O=u,$=0;_<c;)_=(_+$)*a,O*=a,$=C.g(1);for(;_>=l;)_/=2,O/=2,$>>>=1;return(_+$)/O};return R.int32=function(){return C.g(4)|0},R.quick=function(){return C.g(4)/4294967296},R.double=R,g(w(C.S),t),(x.pass||S||function(_,O,$,z){return z&&(z.S&&m(z,C),_.state=function(){return m(C,{})}),$?(n[s]=_,O):_})(R,E,"global"in x?x.global:this==n,x.state)}function d(b){var x,S=b.length,T=this,E=0,C=T.i=T.j=0,R=T.S=[];for(S||(b=[S++]);E<a;)R[E]=E++;for(E=0;E<a;E++)R[E]=R[C=f&C+b[E%S]+(x=R[E])],R[C]=x;(T.g=function(_){for(var O,$=0,z=T.i,L=T.j,B=T.S;_--;)O=B[z=f&z+1],$=$*a+B[f&(B[z]=B[L=f&L+O])+(B[L]=O)];return T.i=z,T.j=L,$})(a)}function m(b,x){return x.i=b.i,x.j=b.j,x.S=b.S.slice(),x}function v(b,x){var S=[],T=typeof b,E;if(x&&T=="object")for(E in b)try{S.push(v(b[E],x-1))}catch{}return S.length?S:T=="string"?b:b+"\0"}function g(b,x){for(var S=b+"",T,E=0;E<S.length;)x[f&E]=f&(T^=x[f&E]*19)+S.charCodeAt(E++);return w(x)}function y(){try{var b;return h&&(b=h.randomBytes)?b=b(a):(b=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(b)),w(b)}catch{var x=e.navigator,S=x&&x.plugins;return[+new Date,e,S,e.screen,w(t)]}}function w(b){return String.fromCharCode.apply(0,b)}if(g(n.random(),t),r.exports){r.exports=p;try{h=Fp()}catch{}}else n["seed"+s]=p})(typeof self<"u"?self:Eu,[],Math)})(Yk);var Aet=Yk.exports,Det=ket,_et=Net,Fet=Tet,Ret=Eet,Oet=Iet,Pet=Cet,ol=Aet;ol.alea=Det;ol.xor128=_et;ol.xorwow=Fet;ol.xorshift7=Ret;ol.xor4096=Oet;ol.tychei=Pet;function Met(r){let t={x:ee(r,"x","reciprocal")};return ae.runKernel(WU,t)}var Bet=ue({reciprocal_:Met});function Let(r){let t={x:ee(r,"x","relu")};return ae.runKernel(VU,t)}var zet=ue({relu_:Let});function $et(r){let t={x:ee(r,"x","relu6")};return ae.runKernel(KU,t)}var qet=ue({relu6_:$et});function Wet(r,e){let n={x:ee(r,"x","reverse")},a={dims:e};return ae.runKernel(jU,n,a)}var Fm=ue({reverse_:Wet});function Vet(r){let t={x:ee(r,"x","round")};return ae.runKernel(XU,t)}var Uet=ue({round_:Vet});function Get(r){let t={x:ee(r,"x","selu")};return ae.runKernel(JU,t)}var Het=ue({selu_:Get});function Ket(r,e,t,n,a,i=[1,1],o="NHWC"){let s=ee(r,"x","separableConv2d"),u=ee(e,"depthwiseFilter","separableConv2d"),c=ee(t,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(s.rank===3&&(f=!0,l=pe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");ie(l.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${l.rank}.`),ie(u.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`),ie(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`),ie(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),ie(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);let h=u.shape[2],p=u.shape[3];ie(c.shape[2]===h*p,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*p}, but got ${c.shape[2]}.`);let d=e6(l,u,n,a,o,i),v=Bm(d,c,1,"valid",o);return f?pe(v,[v.shape[1],v.shape[2],v.shape[3]]):v}var jet=ue({separableConv2d_:Ket});function Xet(r){let t={x:ee(r,"x","sign")};return ae.runKernel(rG,t)}var Yet=ue({sign_:Xet});function Zet(r,e=-1){let t=ee(r,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);let n={logits:t},a={dim:e};return ae.runKernel(cG,n,a)}var Jet=ue({softmax_:Zet});function Qet(r){ie(r.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${r.dtype}.`);let e={input:r};return ae.runKernel(tXe,e)}var f6=ue({fft_:Qet});function ett(r){ie(r.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${r.dtype}.`);let e={input:r};return ae.runKernel(aXe,e)}var Sk=ue({ifft_:ett});function ttt(r){let e=r.shape[r.shape.length-1],t=r.size/e,n;if(e<=2){let a=pe(r,[t,e]);n=Sk(a)}else{let a=[t,2*(e-1)],i=pe(_m(r),[t,e]),o=pe(Bk(r),[t,e]),s=Fm(Vi(i,[0,1],[t,e-2]),1),u=$e(Fm(Vi(o,[0,1],[t,e-2]),1),Qr(-1)),c=Mh([i,s],1),l=Mh([o,u],1),f=pe(tl(c,l),[a[0],a[1]]);n=Sk(f)}if(n=_m(n),r.rank===3&&r.shape[0]!==0){let a=n,i=r.shape[0];n=pe(n,[i,n.shape[0]/i,n.shape[1]]),a.dispose()}return n}var rtt=ue({irfft_:ttt});function ntt(r,e){ie(r.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${r.dtype}`);let t=r.shape[r.shape.length-1],n=r.size/t,a;if(e!=null&&e<t){let d=r.shape.map(v=>0),m=r.shape.map(v=>v);m[r.shape.length-1]=e,a=Vi(r,d,m),t=e}else if(e!=null&&e>t){let d=r.shape.map(m=>m);d[r.shape.length-1]=e-t,a=Mh([r,Oh(d)],r.shape.length-1),t=e}else a=r;let i=kr(a),o=pe(tl(a,i),[n,t]),s=f6(o),u=Math.floor(t/2)+1,c=_m(s),l=Bk(s),f=Am(c,[u,t-u],c.shape.length-1),h=Am(l,[u,t-u],l.shape.length-1),p=a.shape.slice();return p[a.shape.length-1]=u,pe(tl(f[0],h[0]),p)}var att=ue({rfft_:ntt});function itt(r,e){let t=ee(r,"a","squaredDifference"),n=ee(e,"b","squaredDifference");[t,n]=en(t,n),Or(t.shape,n.shape);let a={a:t,b:n},i={};return ae.runKernel(lG,a,i)}var ott=ue({squaredDifference_:itt});function stt(r,e){let t=ee(r,"x","squeeze","string_or_numeric");return pe(t,CXe(t.shape,e).newShape)}var utt=ue({squeeze_:stt});function ctt(r,e=0){let t=_G(r,"tensors","stack","string_or_numeric");ie(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&ie(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");let n=t,a={axis:e};return ae.runKernel(BU,n,a)}var h6=ue({stack_:ctt});function ltt(r,e,t,n,a=0,i=0,o=0,s=0,u=0){let l={x:ee(r,"x","stridedSlice","string_or_numeric")},f={begin:e,end:t,strides:n,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return ae.runKernel(kXe,l,f)}var ftt=ue({stridedSlice_:ltt});function htt(r){let t={x:ee(r,"x","tan","float32")};return ae.runKernel(hG,t)}var ptt=ue({tan_:htt});function dtt(r,e,t){let n=ee(r,"tensor","tensorScatterupdate"),a=ee(e,"indices","tensorScatterupdate","int32"),i=ee(t,"updates","tensorScatterupdate");if(dJe(i,a,n.shape),n.dtype!==i.dtype)throw new Error(`tensor and updates must have the same dtype, instead they are ${n.dtype} and ${i.dtype}.`);let o={tensor:n,indices:a,updates:i},s={};return ae.runKernel(wXe,o,s)}var gct=ue({tensorScatterUpdate_:dtt});function vtt(r,e=1,t=!0){let n=ee(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");let a=n.shape[n.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>a)throw new Error(`'k' passed to topk() must be <= the last dimension (${a}) but got ${e}`);let i={x:n},o={k:e,sorted:t},[s,u]=ae.runKernel(SXe,i,o);return{values:s,indices:u}}var mtt=ue({topk_:vtt});function gtt(r,e=0){let t=ee(r,"x","unique","string_or_numeric");ie(t.rank>0,()=>"The input tensor must be at least 1D");let n={x:t},a={axis:e},[i,o]=ae.runKernel(NXe,n,a);return{values:i,indices:o}}var ytt=ue({unique_:gtt});function btt(r,e,t=!1,n=!1){let a=ee(r,"images","resizeBilinear");ie(a.rank===3||a.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${a.rank}.`),ie(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),ie(n===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=a,o=!1;a.rank===3&&(o=!0,i=pe(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let[]=e,s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},c=ae.runKernel(HU,s,u);return o?pe(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var wtt=ue({resizeBilinear_:btt});function xtt(r,e,t=!1,n=!1){let a=ee(r,"images","resizeNearestNeighbor");ie(a.rank===3||a.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${a.rank}.`),ie(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),ie(a.dtype==="float32"||a.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),ie(n===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=a,o=!1;a.rank===3&&(o=!0,i=pe(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let[]=e,s={images:i},u={alignCorners:t,halfPixelCenters:n,size:e},c=ae.runKernel(GU,s,u);return o?pe(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var ktt=ue({resizeNearestNeighbor_:xtt});var _V;(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(_V||(_V={}));var Nk=class extends wk{minimize(e,t=!1,n){let{value:a,grads:i}=this.computeGradients(e,n);if(n!=null){let o=n.map(s=>({name:s.name,tensor:i[s.name]}));this.applyGradients(o)}else this.applyGradients(i);return kV(i),t?a:(a.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return $Qe(e,t)}dispose(){this.iterations_!=null&&kV(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Qr(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}};Object.defineProperty(Nk,Symbol.hasInstance,{value:r=>r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null});var yct=(()=>typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:r=>r())();var FV;(function(r){r[r.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",r[r.VALUE_ROWIDS=1]="VALUE_ROWIDS",r[r.ROW_LENGTHS=2]="ROW_LENGTHS",r[r.ROW_SPLITS=3]="ROW_SPLITS",r[r.ROW_LIMITS=4]="ROW_LIMITS",r[r.ROW_STARTS=5]="ROW_STARTS"})(FV||(FV={}));var Stt=1.7580993408473768,Ntt=1.0507009873554805;function Ttt(r,e,t){let n=r.shape.slice();n[t]=1;let a=pe(e,n),i=xk(r,t,!0,!1),o=xk(r,t,!0,!0),s=$e(i,o);return $e(a,s)}function Ett(r,e,t){let n=r.shape.length,a=n-t.length,i=zG(t,n),o=r;i!=null&&(o=Tu(r,i));let s=o.shape.slice(),c=s.splice(n-t.length,t.length).reduce((h,p)=>h*p,1);s.push(c);let l=o.reshape(s),f=Ttt(l,e,a);if(f=f.reshape(o.shape),i!=null){let h=Mk(i);f=Tu(f,h)}return f}var Itt={kernelName:qU,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{axis:a}=t,i=[];return a==null?i=n.shape.map((o,s)=>s):typeof a=="number"?i=[a]:i=a,{x:()=>Ett(n,r,i)}}};var Ctt={kernelName:sU,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Or(t.shape,n.shape);return{a:()=>{let s=Rr(r,ot(n,"float32")),u=ln(t.shape,a);return u.length>0?pe(Et(s,u),t.shape):s},b:()=>{let s=$e(r,ot(t,"float32")),u=ln(n.shape,a);u.length>0&&(s=pe(Et(s,u),n.shape));let c=cn(n);return En(Rr(s,ot(c,"float32")))}}}};var Att={kernelName:WU,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Rr(r,En(cn(t)))}}};var Dtt={kernelName:KU,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e,n=$e(Mm(t,6),Om(t));return{x:()=>$e(r,ot(n,"float32"))}}};var _tt={kernelName:VU,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>$e(r,ot(Om(t),"float32"))}}};var Ftt={kernelName:UU,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>pe(r,t.shape)}}};var Rtt={kernelName:HU,inputsToSave:["images"],gradFunc:(r,e,t)=>{let[n]=e,a={dy:r,images:n};return{images:()=>ae.runKernel(bXe,a,t)}}};var Ott={kernelName:GU,inputsToSave:["images"],gradFunc:(r,e,t)=>{let[n]=e,a={dy:r,images:n};return{images:()=>ae.runKernel(yXe,a,t)}}};var Ptt={kernelName:jU,gradFunc:(r,e,t)=>{let{dims:n}=t,a=Ui(n,r.shape);return{x:()=>Fm(r,a)}}};var Mtt={kernelName:XU,gradFunc:r=>({x:()=>kr(r)})};var Btt={kernelName:YU,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>En(Rr(r,$e($m(t,1.5),2)))}}};var Ltt={kernelName:ZU,inputsToSave:["condition"],gradFunc:(r,e)=>{let[t]=e;return{condition:()=>ot(kr(t),"float32"),t:()=>$e(r,ot(t,r.dtype)),e:()=>$e(r,ot(Vk(t),r.dtype))}}};var ztt={kernelName:JU,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>{let n=il(t,Qr(0)),a=Qr(Stt),i=Qr(Ntt),o=$e(r,i),s=$e($e(r,a),ls(ot(t,"float32")));return go(n,o,s)}}}};var $tt={kernelName:nG,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e;return{x:()=>$e(r,$e(t,dn(Qr(1),t)))}}};var qtt={kernelName:rG,gradFunc:r=>({x:()=>kr(r)})};var Wtt={kernelName:eG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>$e(Wk(ot(t,"float32")),r)}}};var Vtt={kernelName:tG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>$e(QG(ot(t,"float32")),r)}}};var Utt={kernelName:QU,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{begin:a,size:i}=t,o=n.shape,[s,u]=vJe(n,a,i),c=[];for(let l=0;l<r.rank;l++)c.push([s[l],o[l]-s[l]-u[l]]);return{x:()=>l6(r,c)}}};var Gtt={kernelName:cG,outputsToSave:[!0],gradFunc:(r,e,t)=>{let[n]=e,{dim:a}=t,i=!0,o=$e(r,n);return{logits:()=>dn(o,$e(Et(o,[a],i),n))}}};var Htt={kernelName:aG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>$e(r,$k(t))}}};var RV={kernelName:sG,gradFunc:(r,e,t)=>{let{blockShape:n,paddings:a}=t;return{x:()=>qk(r,n,a)}}};var OV={kernelName:uG,gradFunc:(r,e,t)=>{let{axis:n}=t;return{x:()=>Mh(r,n)}}};var Ktt={kernelName:iG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Rr(r,$e(cs(ot(t,"float32")),2))}}};var jtt={kernelName:xXe,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>$e(r,$e(ot(t,"float32"),2))}}};var Xtt={kernelName:lG,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Qr(2);return{a:()=>$e(r,$e(a,dn(t,n))),b:()=>$e(r,$e(a,dn(n,t)))}}};var Ytt={kernelName:gG,gradFunc:r=>({x:()=>kr(r)})};var Ztt={kernelName:fG,inputsToSave:["a","b"],gradFunc:(r,e)=>{let[t,n]=e,a=Or(t.shape,n.shape);return{a:()=>{let s=r,u=ln(t.shape,a);return u.length>0&&(s=Et(s,u)),pe(s,t.shape)},b:()=>{let s=r,u=ln(n.shape,a);return u.length>0&&(s=Et(s,u)),pe(En(s),n.shape)}}}};var Jtt={kernelName:oG,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,a=n.shape.slice(),{axis:i}=t;Ui(i,n.shape).forEach(c=>{a[c]=1});let s=pe(r,a),u=$e(s,Lm(n.shape,"float32"));return{x:()=>u}}};var Qtt={kernelName:hG,inputsToSave:["x"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>Rr(r,cn(Wk(t)))}}};var ert={kernelName:pG,outputsToSave:[!0],gradFunc:(r,e)=>{let[t]=e;return{x:()=>$e(dn(Qr(1),cn(t)),r)}}};var trt={kernelName:Ck,inputsToSave:["x"],gradFunc:(r,e,t)=>{let[n]=e,{reps:a}=t;return{x:()=>{let o=kr(n);if(n.rank===1)for(let s=0;s<a[0];++s)o=Qa(o,Vi(r,[s*n.shape[0]],[n.shape[0]]));else if(n.rank===2)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)o=Qa(o,Vi(r,[s*n.shape[0],u*n.shape[1]],[n.shape[0],n.shape[1]]));else if(n.rank===3)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)for(let c=0;c<a[2];++c)o=Qa(o,Vi(r,[s*n.shape[0],u*n.shape[1],c*n.shape[2]],[n.shape[0],n.shape[1],n.shape[2]]));else if(n.rank===4)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)for(let c=0;c<a[2];++c)for(let l=0;l<a[3];++l)o=Qa(o,Vi(r,[s*n.shape[0],u*n.shape[1],c*n.shape[2],l*n.shape[3]],[n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${n.rank} tensors yet.`);return o}}}};var rrt={kernelName:wm,gradFunc:(r,e,t)=>{let n=t,{perm:a}=n,i=Mk(a);return{x:()=>Tu(r,i)}}};var nrt={kernelName:dG,gradFunc:(r,e,t)=>{let n=t,{axis:a}=n;return{value:()=>h6(r,a)}}};var art={kernelName:vG,inputsToSave:["segmentIds"],gradFunc:(r,e)=>{let[t]=e;return{x:()=>irt(r,t)}}};function irt(r,e){let t=c6(e,kr(e)),n=a6(r,t),a=Pm(e,Qr(0,"int32")),i=n.rank-a.rank;for(let s=0;s<i;++s)a=n6(a,s+1);a=Rh(a,Lm(n.shape,"bool"));let o=kr(n);return go(a,n,o)}var ort={kernelName:mG,gradFunc:r=>({x:()=>kr(r)})};var srt=[FG,g9e,y9e,x9e,k9e,N9e,T9e,E9e,C9e,A9e,D9e,_9e,z9e,W9e,U9e,H9e,K9e,j9e,X9e,rYe,nYe,iYe,lYe,uYe,vYe,gYe,bYe,DYe,PYe,MYe,Ctt,BYe,zYe,$Ye,qYe,WYe,UYe,VYe,KYe,XYe,YYe,ZYe,JYe,QYe,eZe,rZe,nZe,aZe,iZe,uZe,TV,TV,fZe,dZe,gZe,yZe,bZe,wZe,kZe,NZe,TZe,EZe,IZe,CZe,DZe,EV,EV,RZe,OZe,Itt,Att,Dtt,_tt,Ftt,Rtt,Ott,Ptt,Mtt,Btt,Ltt,ztt,$tt,qtt,Wtt,Vtt,Utt,Gtt,Htt,RV,RV,OV,OV,Ktt,Xtt,jtt,Ytt,Ztt,Jtt,Qtt,ert,trt,rrt,nrt,art,ort];for(let r of srt)zXe(r);ce().prototype.abs=function(){return this.throwIfDisposed(),vo(this)};ce().prototype.acos=function(){return this.throwIfDisposed(),yJe(this)};ce().prototype.acosh=function(){return this.throwIfDisposed(),wJe(this)};ce().prototype.add=function(r){return this.throwIfDisposed(),Qa(this,r)};ce().prototype.all=function(r,e){return this.throwIfDisposed(),kJe(this,r,e)};ce().prototype.any=function(r,e){return this.throwIfDisposed(),NJe(this,r,e)};ce().prototype.argMax=function(r){return this.throwIfDisposed(),EJe(this,r)};ce().prototype.argMin=function(r){return this.throwIfDisposed(),CJe(this,r)};ce().prototype.asScalar=function(){return this.throwIfDisposed(),ie(this.size===1,()=>"The array must have only 1 element."),pe(this,[])};ce().prototype.asType=function(r){return this.throwIfDisposed(),ot(this,r)};ce().prototype.as1D=function(){return this.throwIfDisposed(),pe(this,[this.size])};ce().prototype.as2D=function(r,e){return this.throwIfDisposed(),pe(this,[r,e])};ce().prototype.as3D=function(r,e,t){return this.throwIfDisposed(),pe(this,[r,e,t])};ce().prototype.as4D=function(r,e,t,n){return this.throwIfDisposed(),pe(this,[r,e,t,n])};ce().prototype.as5D=function(r,e,t,n,a){return this.throwIfDisposed(),pe(this,[r,e,t,n,a])};ce().prototype.asin=function(){return this.throwIfDisposed(),DJe(this)};ce().prototype.asinh=function(){return this.throwIfDisposed(),FJe(this)};ce().prototype.atan=function(){return this.throwIfDisposed(),OJe(this)};ce().prototype.atan2=function(r){return this.throwIfDisposed(),MJe(this,r)};ce().prototype.atanh=function(){return this.throwIfDisposed(),LJe(this)};ce().prototype.avgPool=function(r,e,t,n){return this.throwIfDisposed(),JG(this,r,e,t,n)};ce().prototype.batchToSpaceND=function(r,e){return this.throwIfDisposed(),qk(this,r,e)};ce().prototype.batchNorm=function(r,e,t,n,a){return this.throwIfDisposed(),KJe(this,r,e,t,n,a)};ce().prototype.broadcastTo=function(r){return this.throwIfDisposed(),Sm(this,r)};ce().prototype.cast=function(r){return this.throwIfDisposed(),ot(this,r)};ce().prototype.ceil=function(){return this.throwIfDisposed(),XJe(this)};ce().prototype.clipByValue=function(r,e){return this.throwIfDisposed(),JJe(this,r,e)};ce().prototype.concat=function(r,e){return this.throwIfDisposed(),r instanceof Tn&&(r=[r]),Mh([this,...r],e)};ce().prototype.conv1d=function(r,e,t,n,a,i){return this.throwIfDisposed(),eQe(this,r,e,t,n,a,i)};ce().prototype.conv2dTranspose=function(r,e,t,n,a){return this.throwIfDisposed(),rQe(this,r,e,t,n,a)};ce().prototype.conv2d=function(r,e,t,n,a,i){return this.throwIfDisposed(),Bm(this,r,e,t,n,a,i)};ce().prototype.cos=function(){return this.throwIfDisposed(),Wk(this)};ce().prototype.cosh=function(){return this.throwIfDisposed(),QG(this)};ce().prototype.cumprod=function(r,e,t){return this.throwIfDisposed(),xk(this,r,e,t)};ce().prototype.cumsum=function(r,e,t){return this.throwIfDisposed(),$G(this,r,e,t)};ce().prototype.depthToSpace=function(r,e){return this.throwIfDisposed(),sQe(this,r,e)};ce().prototype.depthwiseConv2d=function(r,e,t,n,a,i){return this.throwIfDisposed(),e6(this,r,e,t,n,a,i)};ce().prototype.dilation2d=function(r,e,t,n,a){return this.throwIfDisposed(),lQe(this,r,e,t,n,a)};ce().prototype.divNoNan=function(r){return this.throwIfDisposed(),hQe(this,r)};ce().prototype.div=function(r){return this.throwIfDisposed(),Rr(this,r)};ce().prototype.dot=function(r){return this.throwIfDisposed(),dQe(this,r)};ce().prototype.elu=function(){return this.throwIfDisposed(),mQe(this)};ce().prototype.equal=function(r){return this.throwIfDisposed(),Lk(this,r)};ce().prototype.erf=function(){return this.throwIfDisposed(),yQe(this)};ce().prototype.euclideanNorm=function(r,e){return this.throwIfDisposed(),SQe(this,r,e)};ce().prototype.exp=function(){return this.throwIfDisposed(),ls(this)};ce().prototype.expandDims=function(r){return this.throwIfDisposed(),n6(this,r)};ce().prototype.expm1=function(){return this.throwIfDisposed(),EQe(this)};ce().prototype.fft=function(){return this.throwIfDisposed(),f6(this)};ce().prototype.flatten=function(){return this.throwIfDisposed(),pe(this,[this.size])};ce().prototype.floor=function(){return this.throwIfDisposed(),HG(this)};ce().prototype.floorDiv=function(r){return this.throwIfDisposed(),RG(this,r)};ce().prototype.gather=function(r,e,t){return this.throwIfDisposed(),a6(this,r,e,t)};ce().prototype.greaterEqual=function(r){return this.throwIfDisposed(),Pm(this,r)};ce().prototype.greater=function(r){return this.throwIfDisposed(),il(this,r)};ce().prototype.ifft=function(){return this.throwIfDisposed(),Sk(this)};ce().prototype.irfft=function(){return this.throwIfDisposed(),rtt(this)};ce().prototype.isFinite=function(){return this.throwIfDisposed(),AQe(this)};ce().prototype.isInf=function(){return this.throwIfDisposed(),_Qe(this)};ce().prototype.isNaN=function(){return this.throwIfDisposed(),RQe(this)};ce().prototype.leakyRelu=function(r){return this.throwIfDisposed(),PQe(this,r)};ce().prototype.lessEqual=function(r){return this.throwIfDisposed(),Mm(this,r)};ce().prototype.less=function(r){return this.throwIfDisposed(),GG(this,r)};ce().prototype.localResponseNormalization=function(r,e,t,n){return this.throwIfDisposed(),BQe(this,r,e,t,n)};ce().prototype.logSigmoid=function(){return this.throwIfDisposed(),VQe(this)};ce().prototype.logSoftmax=function(r){return this.throwIfDisposed(),GQe(this,r)};ce().prototype.logSumExp=function(r,e){return this.throwIfDisposed(),KQe(this,r,e)};ce().prototype.log=function(){return this.throwIfDisposed(),zm(this)};ce().prototype.log1p=function(){return this.throwIfDisposed(),zQe(this)};ce().prototype.logicalAnd=function(r){return this.throwIfDisposed(),Rh(this,r)};ce().prototype.logicalNot=function(){return this.throwIfDisposed(),Vk(this)};ce().prototype.logicalOr=function(r){return this.throwIfDisposed(),s6(this,r)};ce().prototype.logicalXor=function(r){return this.throwIfDisposed(),ZQe(this,r)};ce().prototype.matMul=function(r,e,t){return this.throwIfDisposed(),Na(this,r,e,t)};ce().prototype.maxPool=function(r,e,t,n){return this.throwIfDisposed(),u6(this,r,e,t,n)};ce().prototype.max=function(r,e){return this.throwIfDisposed(),Qc(this,r,e)};ce().prototype.maximum=function(r){return this.throwIfDisposed(),c6(this,r)};ce().prototype.mean=function(r,e){return this.throwIfDisposed(),tet(this,r,e)};ce().prototype.min=function(r,e){return this.throwIfDisposed(),kk(this,r,e)};ce().prototype.minimum=function(r){return this.throwIfDisposed(),net(this,r)};ce().prototype.mirrorPad=function(r,e){return this.throwIfDisposed(),iet(this,r,e)};ce().prototype.mod=function(r){return this.throwIfDisposed(),set(this,r)};ce().prototype.mul=function(r){return this.throwIfDisposed(),$e(this,r)};ce().prototype.neg=function(){return this.throwIfDisposed(),En(this)};ce().prototype.norm=function(r,e,t){return this.throwIfDisposed(),r6(this,r,e,t)};ce().prototype.notEqual=function(r){return this.throwIfDisposed(),cet(this,r)};ce().prototype.oneHot=function(r,e=1,t=0){return this.throwIfDisposed(),hJe(this,r,e,t)};ce().prototype.onesLike=function(){return this.throwIfDisposed(),het(this)};ce().prototype.pad=function(r,e){return this.throwIfDisposed(),l6(this,r,e)};ce().prototype.pool=function(r,e,t,n,a,i){return this.throwIfDisposed(),get(this,r,e,t,n,a,i)};ce().prototype.pow=function(r){return this.throwIfDisposed(),$m(this,r)};ce().prototype.prelu=function(r){return this.throwIfDisposed(),bet(this,r)};ce().prototype.prod=function(r,e){return this.throwIfDisposed(),xet(this,r,e)};ce().prototype.reciprocal=function(){return this.throwIfDisposed(),Bet(this)};ce().prototype.relu=function(){return this.throwIfDisposed(),zet(this)};ce().prototype.relu6=function(){return this.throwIfDisposed(),qet(this)};ce().prototype.reshapeAs=function(r){return this.throwIfDisposed(),pe(this,r.shape)};ce().prototype.reshape=function(r){return this.throwIfDisposed(),pe(this,r)};ce().prototype.resizeBilinear=function(r,e,t){return this.throwIfDisposed(),wtt(this,r,e,t)};ce().prototype.resizeNearestNeighbor=function(r,e,t){return this.throwIfDisposed(),ktt(this,r,e,t)};ce().prototype.reverse=function(r){return this.throwIfDisposed(),Fm(this,r)};ce().prototype.rfft=function(){return this.throwIfDisposed(),att(this)};ce().prototype.round=function(){return this.throwIfDisposed(),Uet(this)};ce().prototype.rsqrt=function(){return this.throwIfDisposed(),qG(this)};ce().prototype.selu=function(){return this.throwIfDisposed(),Het(this)};ce().prototype.separableConv2d=function(r,e,t,n,a,i){return this.throwIfDisposed(),jet(this,r,e,t,n,a,i)};ce().prototype.sigmoid=function(){return this.throwIfDisposed(),$k(this)};ce().prototype.sign=function(){return this.throwIfDisposed(),Yet(this)};ce().prototype.sin=function(){return this.throwIfDisposed(),BG(this)};ce().prototype.sinh=function(){return this.throwIfDisposed(),LG(this)};ce().prototype.slice=function(r,e){return this.throwIfDisposed(),Vi(this,r,e)};ce().prototype.softmax=function(r){return this.throwIfDisposed(),Jet(this,r)};ce().prototype.softplus=function(){return this.throwIfDisposed(),o6(this)};ce().prototype.spaceToBatchND=function(r,e){return this.throwIfDisposed(),Pk(this,r,e)};ce().prototype.split=function(r,e){return this.throwIfDisposed(),Am(this,r,e)};ce().prototype.sqrt=function(){return this.throwIfDisposed(),cs(this)};ce().prototype.square=function(){return this.throwIfDisposed(),cn(this)};ce().prototype.squaredDifference=function(r){return this.throwIfDisposed(),ott(this,r)};ce().prototype.squeeze=function(r){return this.throwIfDisposed(),utt(this,r)};ce().prototype.stack=function(r,e){this.throwIfDisposed();let t=r instanceof Tn?[this,r]:[this,...r];return h6(t,e)};ce().prototype.step=function(r){return this.throwIfDisposed(),Om(this,r)};ce().prototype.stridedSlice=function(r,e,t,n,a,i,o,s){return this.throwIfDisposed(),ftt(this,r,e,t,n,a,i,o,s)};ce().prototype.sub=function(r){return this.throwIfDisposed(),dn(this,r)};ce().prototype.sum=function(r,e){return this.throwIfDisposed(),Et(this,r,e)};ce().prototype.tan=function(){return this.throwIfDisposed(),ptt(this)};ce().prototype.tanh=function(){return this.throwIfDisposed(),VJe(this)};ce().prototype.tile=function(r){return this.throwIfDisposed(),WG(this,r)};ce().prototype.toBool=function(){return this.throwIfDisposed(),ot(this,"bool")};ce().prototype.toFloat=function(){return this.throwIfDisposed(),ot(this,"float32")};ce().prototype.toInt=function(){return this.throwIfDisposed(),ot(this,"int32")};ce().prototype.topk=function(r,e){return this.throwIfDisposed(),mtt(this,r,e)};ce().prototype.transpose=function(r){return this.throwIfDisposed(),Tu(this,r)};ce().prototype.unique=function(r){return this.throwIfDisposed(),ytt(this,r)};ce().prototype.unsortedSegmentSum=function(r,e){return this.throwIfDisposed(),VG(this,r,e)};ce().prototype.unstack=function(r){return this.throwIfDisposed(),KG(this,r)};ce().prototype.where=function(r,e){return this.throwIfDisposed(),go(r,this,e)};ce().prototype.zerosLike=function(){return this.throwIfDisposed(),kr(this)};var urt="4.6.0";var crt={"tfjs-core":nk.version_core,"tfjs-backend-cpu":ok.version_cpu,"tfjs-backend-webgl":sk.version_webgl,"tfjs-data":PV.version_data,"tfjs-layers":ak.version_layers,"tfjs-converter":ik.version_converter,tfjs:urt};Ta.data=O7e;Ta.version=crt;Object.keys(nk).forEach(function(r){r!=="default"&&!Ta.hasOwnProperty(r)&&Object.defineProperty(Ta,r,{enumerable:!0,get:function(){return nk[r]}})});Object.keys(ak).forEach(function(r){r!=="default"&&!Ta.hasOwnProperty(r)&&Object.defineProperty(Ta,r,{enumerable:!0,get:function(){return ak[r]}})});Object.keys(ik).forEach(function(r){r!=="default"&&!Ta.hasOwnProperty(r)&&Object.defineProperty(Ta,r,{enumerable:!0,get:function(){return ik[r]}})});Object.keys(ok).forEach(function(r){r!=="default"&&!Ta.hasOwnProperty(r)&&Object.defineProperty(Ta,r,{enumerable:!0,get:function(){return ok[r]}})});Object.keys(sk).forEach(function(r){r!=="default"&&!Ta.hasOwnProperty(r)&&Object.defineProperty(Ta,r,{enumerable:!0,get:function(){return sk[r]}})})});var sl=Y((wct,d6)=>{var{argmin:lrt,distance:frt,isArray:hrt,isDataFrame:p6,isNumber:prt,isSeries:drt,shape:vrt}=It(),Wm=Lh(),mrt=new Function("try { return this === window } catch(e) { return false }");function grt(r){return zh(r)?r.shape.length===2:p6(r)?!0:hrt(r)&&vrt(r).length===2}function zh(r){return r instanceof Wm.Tensor}function yrt(r){return prt(r)&&parseInt(r)===r&&r>=0}function brt(r,e){return Wm.tidy(()=>{zh(r)&&(r=r.arraySync()),zh(e)&&(e=e.arraySync());let t=[],n=e.slice();return r.forEach(a=>{let i=lrt(n.map(o=>frt(a,o)));t.push(n[i]),n.splice(i,1)}),t.concat(n)})}function wrt(r){return Wm.tidy(()=>((p6(r)||drt(r))&&(r=r.values),zh(r)||(r=Wm.tensor(r)),r.div(r.abs())))}d6.exports={isBrowser:mrt,isMatrix:grt,isTFTensor:zh,isWholeNumber:yrt,orderCentroids:brt,sign:wrt}});var Qk=Y((xct,g6)=>{var{assert:Zk,flatten:v6,isDataFrame:Iu,isEqual:Jk,isSeries:Cu,isUndefined:xrt,shape:ul}=It(),{isTFTensor:Au,sign:krt}=sl(),Gi=Lh();function Srt(r,e){return Au(r)&&(r=r.arraySync()),(Iu(r)||Cu(r))&&(r=r.values),Au(e)&&(e=e.arraySync()),(Iu(e)||Cu(e))&&(e=e.values),Zk(Jk(ul(r),ul(e)),"`yPred` and `yTrue` must have the same shape!"),Gi.tidy(()=>Gi.tensor(r).sub(Gi.tensor(e)).pow(2).sum().arraySync())}function Nrt(r,e){Au(r)&&(r=r.arraySync()),(Iu(r)||Cu(r))&&(r=r.values),Au(e)&&(e=e.arraySync()),(Iu(e)||Cu(e))&&(e=e.values),Zk(Jk(ul(r),ul(e)),"`yPred` and `yTrue` must have the same shape!");let t=v6(r),n=v6(e),a=0;return t.forEach((i,o)=>{i===n[o]&&a++}),a/t.length}function m6(r,e,t){return Gi.tidy(()=>{Au(r)&&(r=r.arraySync()),(Iu(r)||Cu(r))&&(r=r.values),Au(e)&&(e=e.arraySync()),(Iu(e)||Cu(e))&&(e=e.values),xrt(t)&&(t=r),Au(t)&&(t=t.arraySync()),(Iu(t)||Cu(t))&&(t=t.values),typeof t=="number"&&(t=[t]),Zk(Jk(ul(r),ul(e)),"`yTrue` and `yPred` must have the same shape!"),r=Gi.tensor(r),e=Gi.tensor(e),t=Gi.tensor(t);let n=r.sub(e).pow(2).sum(),a=r.sub(t.mean()).pow(2).sum();return Gi.scalar(1).sub(n.div(a)).arraySync()})}function Trt(r,e,t){return Gi.tidy(()=>{let n=Gi.scalar(m6(r,e,t));return krt(n).mul(n.abs().sqrt()).arraySync()})}g6.exports={sse:Srt,accuracy:Nrt,rSquared:m6,rScore:Trt}});var Hi=Y((kct,y6)=>{y6.exports={shouldIgnoreNaNValues:!0}});var cl=Y((Sct,w6)=>{var{assert:Ert,flatten:Irt,isArray:Crt,isDataFrame:Art,isNumber:Drt,isSeries:_rt}=It();function b6(r){if(Art(r)||_rt(r))return b6(r.values);Ert(Crt(r),"The `containsOnlyNumbers` function only works on arrays, Series, and DataFrames!");let e=Irt(r);for(let t=0;t<e.length;t++)if(!Drt(e[t]))return!1;return!0}w6.exports=b6});var t2=Y((Nct,x6)=>{var{dropMissing:Frt,flatten:Rrt,isArray:Ort,isDataFrame:Prt,isSeries:Mrt}=It();function e2(r){return typeof r=="number"?r===0||r===1:Prt(r)||Mrt(r)?e2(r.values):Ort(r)?r.length===0?!1:Frt(Rrt(r)).every(t=>e2(t)):!1}x6.exports=e2});var _6=Y((Tct,D6)=>{var{abs:k6,apply:S6,assert:N6,clamp:Brt,copy:Lrt,divide:zrt,dropNaN:$rt,flatten:qrt,isArray:Wrt,isDataFrame:Vrt,isNumber:T6,isSeries:Urt,max:E6,median:I6,min:Grt,sort:Hrt,subtract:C6}=It(),Krt=Hi(),jrt=cl(),Xrt=t2();function A6(r,e){if(Vrt(r)||Urt(r)){let u=r.copy();return u._values=A6(u._values,e),u}if(N6(Wrt(r),"The `clipOutliers` function only works on arrays, Series, and DataFrames!"),e=e||5,N6(T6(e),"Any `maxScore` value passed into the `clipOutliers` function must be a number!"),!Krt.shouldIgnoreNaNValues&&!jrt(r))return S6(r,()=>NaN);let t=qrt(r),n=$rt(t);if(Xrt(n)||n.length===0)return r;let a=I6(n),i=I6(k6(C6(n,a))),o=!1;if(i===0){let u=Hrt(Lrt(n)),c=u.filter(p=>p<a),l=u.filter(p=>p>a),f=a,h=a;if(c.length>0&&(f=E6(c)),l.length>0&&(h=Grt(l)),i=(h-f)/2,i===0)return r;o=(a-f)/i>e||(h-a)/i>e}return E6(zrt(k6(C6(n,a)),i))>e||o?S6(r,u=>T6(u)?Brt(u,a-e*i,a+e*i):u):r}D6.exports=A6});var n2=Y((Ect,z6)=>{var{assert:F6,dropNaN:R6,isArray:O6,isSeries:P6,mean:M6,shape:B6,variance:L6}=It(),Yrt=Hi();function r2(r,e){if(P6(r))return r2(r.values,e);if(P6(e))return r2(r,e.values);F6(O6(r)&&O6(e)&&B6(r).length===1&&B6(e).length===1,"The `cohensd` function only works on 1-dimensional arrays and Series!"),F6(r.length===e.length,"Two arrays or Series passed into the `cohensd` function must have the same length!"),Yrt.shouldIgnoreNaNValues&&(r=R6(r),e=R6(e));try{let t=M6(r),n=M6(e),a=Math.sqrt((L6(r)+L6(e))/2);return(t-n)/a}catch{return NaN}}z6.exports=r2});var V6=Y((Ict,W6)=>{var{assert:$6,DataFrame:Zrt,isArray:Jrt,isSeries:Qrt,shape:ent,zeros:tnt}=It();function q6(r){if(Qrt(r)){let n=new Zrt(q6(r.values));return n.index=r.index.slice(),n.columns=r.index.slice(),n}$6(Jrt(r),"The `diagonalize` function only works on 1-dimensional arrays and Series!");let e=ent(r);$6(e.length===1,"The `diagonalize` function only works on 1-dimensional arrays and Series!");let t=tnt([e[0],e[0]]);return r.forEach((n,a)=>t[a][a]=n),t}W6.exports=q6});var s2=Y((Cct,K6)=>{var{assert:a2,clamp:rnt,correl:U6,DataFrame:Vm,dropNaNPairwise:nnt,isArray:G6,isDataFrame:Um,isJagged:H6,isUndefined:ant,ndarray:int}=It(),ont=Hi();function i2(r){let e="@jrc03c/js-data-science-helpers/get-correlation-matrix";return Object.defineProperty(r,e,{configurable:!1,enumerable:!1,writable:!1,value:Symbol.for(e)}),r}function o2(r,e){if(ant(e)&&(e=r),Um(r)){let n=new Vm(o2(r.values,e));return n.index=r.columns.slice(),n.columns=Um(e)?e.columns.slice():new Vm(e).columns.slice(),i2(n)}if(Um(e)){let n=new Vm(o2(r,e.values));return n.index=Um(r)?r.columns.slice():new Vm(r).columns.slice(),n.columns=e.columns.slice(),i2(n)}a2(G6(r)&&G6(e),"The `getCorrelationMatrix` function only works on 2-dimensional arrays and DataFrames!"),a2(!H6(r)&&!H6(e),"The `getCorrelationMatrix` function only works on non-jagged 2-dimensional arrays and DataFrames!"),a2(r.length===e.length,'The dimensions of the matrices you passed into the `getCorrelationMatrix` function aren\'t compatible! ([shape(a).join(", ")] vs. [shape(b).join(", ")]) The function expects that you\'ll be comparing the columns of two matrices where the columns are all of the same length, so please make sure that the matrices are oriented accordingly.');let t=int([r[0].length,e[0].length]);for(let n=0;n<r[0].length;n++){let a=r.map(i=>i[n]);for(let i=0;i<e[0].length;i++){let o=e.map(s=>s[i]);ont.shouldIgnoreNaNValues?t[n][i]=U6(...nnt(a,o)):t[n][i]=U6(a,o)}}return i2(rnt(t,-1,1))}K6.exports=o2});var u2=Y((Act,j6)=>{function snt(r){try{let e="@jrc03c/js-data-science-helpers/get-correlation-matrix";return r[e]===Symbol.for(e)}catch{return!1}}j6.exports=snt});var J6=Y((Dct,Z6)=>{var{DataFrame:c2,isArray:unt,isDataFrame:Gm,isNumber:X6,MathError:cnt,sort:lnt}=It(),Y6=s2(),fnt=u2();function hnt(r,e,t){t=Object.values(arguments).find(i=>X6(i))||1-1e-5;let n=(()=>{let i=Object.values(arguments).filter(o=>unt(o)||Gm(o));if(i.length===1){let o=i[0];if(fnt(o))return Gm(o)?o:new c2(o);{let s=Y6(o,null);return Gm(s)?s:new c2(s)}}if(i.length===2){let o=Y6(i[0],i[1]);return Gm(o)?o:new c2(o)}throw new cnt("You must pass 1 or 2 2-dimensional arrays or DataFrames into the `getHighlyCorrelatedColumns` function!")})(),a={};return n.values.forEach((i,o)=>{i.forEach((s,u)=>{if(X6(s)&&s>t){let c=n.index[o],l=n.columns[u];a[c]||(a[c]=[]),a[c].indexOf(l)<0&&a[c].push(l),a[l]||(a[l]=[]),a[l].indexOf(c)<0&&a[l].push(c)}})}),Object.keys(a).forEach(i=>{a[i]=lnt(a[i])}),a}Z6.exports=hnt});var l2=Y((_ct,eH)=>{var{dropNaN:pnt,isArray:dnt,isDataFrame:vnt,isNumber:mnt,isSeries:gnt,pow:ynt,sqrt:bnt,sum:wnt}=It(),xnt=Hi();function Q6(r){return vnt(r)||gnt(r)?Q6(r.values):mnt(r)?Math.abs(r):dnt(r)?(xnt.shouldIgnoreNaNValues&&(r=pnt(r)),bnt(wnt(ynt(r,2)))):NaN}eH.exports=Q6});var f2=Y((Fct,aH)=>{var{assert:tH,DataFrame:knt,isArray:Snt,isSeries:Nnt,isString:Tnt,isUndefined:rH,set:Ent,shape:Int,sort:Cnt}=It();function nH(){if(arguments.length===1&&Nnt(arguments[0])){let{name:a,values:i}=arguments[0],o=nH(a,i),s=new knt(o);return s.index=arguments[0].index.slice(),s}let[r,e]=arguments;tH(Tnt(r),"When passing two arguments into the `getOneHotEncodings` function, the first argument must be a string representing the name of the variable being encoded!"),tH(Snt(e)&&Int(e).length===1,"When passing two arguments into the `getOneHotEncodings` function, the second argument must be a 1-dimensional array!");let t={};return Cnt(Ent(e)).filter(a=>typeof a!="number"||a.toString()!=="NaN").filter(a=>!rH(a)).map(a=>r+"_"+a).slice(0,-1).forEach(a=>{t[a]=e.map(i=>a===r+"_"+i?1:typeof i=="number"&&i.toString()==="NaN"?NaN:rH(i)?NaN:0)}),t}aH.exports=nH});var oH=Y((Rct,iH)=>{var{count:Ant}=It();function Dnt(r){return Ant(r).map(t=>(t.percentage=t.count/r.length,t))}iH.exports=Dnt});var sH=Y((Oct,_nt)=>{_nt.exports=[.5,.49601,.49202,.48803,.48405,.48006,.47608,.4721,.46812,.46414,.46017,.4562,.45224,.44828,.44433,.44038,.4364,.43251,.42858,.42465,.42074,.41683,.41294,.40905,.40517,.40129,.39743,.39358,.38974,.38591,.38209,.37828,.37448,.3707,.36693,.36317,.35942,.35569,.35197,.34827,.34458,.3409,.33724,.3336,.32997,.32636,.32276,.31918,.31561,.31207,.30854,.30503,.30153,.29806,.2946,.29116,.28774,.28434,.28096,.2776,.27425,.27093,.26763,.26435,.26109,.25785,.25463,.25143,.24825,.2451,.24196,.23885,.23576,.2327,.22965,.22663,.22363,.22065,.2177,.21476,.21186,.20897,.20611,.20327,.20045,.19766,.19489,.19215,.18943,.18673,.18406,.18141,.17879,.17619,.17361,.17106,.16853,.16602,.16354,.16109,.15866,.15625,.15386,.15151,.14917,.14686,.14457,.14231,.14007,.13786,.13567,.1335,.13136,.12924,.12714,.12507,.12302,.121,.119,.11702,.11507,.11314,.11123,.10935,.10749,.10565,.10383,.10204,.10027,.09853,.0968,.0951,.09342,.09176,.09012,.08851,.08692,.08534,.08379,.08226,.08076,.07927,.0778,.07636,.07493,.07353,.07215,.07078,.06944,.06811,.06681,.06552,.06426,.06301,.06178,.06057,.05938,.05821,.05705,.05592,.0548,.0537,.05262,.05155,.0505,.04947,.04846,.04746,.04648,.04551,.04457,.04363,.04272,.04182,.04093,.04006,.0392,.03836,.03754,.03673,.03593,.03515,.03438,.03362,.03288,.03216,.03144,.03074,.03005,.02938,.02872,.02807,.02743,.0268,.02619,.02559,.025,.02442,.02385,.0233,.02275,.02222,.02169,.02118,.02068,.02018,.0197,.01923,.01876,.01831,.01786,.01743,.017,.01659,.01618,.01578,.01539,.015,.01463,.01426,.0139,.01355,.01321,.01287,.01255,.01222,.01191,.0116,.0113,.01101,.01072,.01044,.01017,.0099,.00964,.00939,.00914,.00889,.00866,.00842,.0082,.00798,.00776,.00755,.00734,.00714,.00695,.00676,.00657,.00639,.00621,.00604,.00587,.0057,.00554,.00539,.00523,.00508,.00494,.0048,.00466,.00453,.0044,.00427,.00415,.00402,.00391,.00379,.00368,.00357,.00347,.00336,.00326,.00317,.00307,.00298,.00289,.0028,.00272,.00264,.00256,.00248,.0024,.00233,.00226,.00219,.00212,.00205,.00199,.00193,.00187,.00181,.00175,.00169,.00164,.00159,.00154,.00149,.00144,.00139,.00135,.00131,.00126,.00122,.00118,.00114,.00111,.00107,.00104,.001,97e-5,94e-5,9e-4,87e-5,84e-5,82e-5,79e-5,76e-5,74e-5,71e-5,69e-5,66e-5,64e-5,62e-5,6e-4,58e-5,56e-5,54e-5,52e-5,5e-4,48e-5,47e-5,45e-5,43e-5,42e-5,4e-4,39e-5,38e-5,36e-5,35e-5,34e-5,32e-5,31e-5,3e-4,29e-5,28e-5,27e-5,26e-5,25e-5,24e-5,23e-5,22e-5,22e-5,21e-5,2e-4,19e-5,19e-5,18e-5,17e-5,17e-5,16e-5,15e-5,15e-5,14e-5,14e-5,13e-5,13e-5,12e-5,12e-5,11e-5,11e-5,1e-4,1e-4,1e-4,9e-5,9e-5,8e-5,8e-5,8e-5,8e-5,7e-5,7e-5,7e-5,6e-5,6e-5,6e-5,6e-5,5e-5,5e-5,5e-5,5e-5,5e-5,4e-5,4e-5,4e-5,4e-5,4e-5,4e-5,3e-5,3e-5,3e-5,3e-5,3e-5,3e-5,3e-5,3e-5,2e-5,2e-5,2e-5,2e-5]});var p2=Y((Pct,mH)=>{var{abs:uH,assert:Fnt,dropNaNPairwise:Rnt,flatten:Hm,isArray:cH,isDataFrame:lH,isEqual:Ont,isSeries:fH,mean:hH,remap:Pnt,round:Mnt,shape:pH,sqrt:Bnt,std:dH}=It(),Lnt=Hi(),vH=sH();function znt(r){return uH(r)>4.1?0:vH[Mnt(Pnt(uH(r),0,4.1,0,vH.length))]}function h2(r,e){if(lH(r)||fH(r))return h2(r.values,e);if(lH(e)||fH(e))return h2(r,e.values);Fnt(cH(r)&&cH(e)&&Ont(pH(r),pH(e)),"You must pass two identically-shaped arrays, Series, or DataFrames into the `pValue` function!");let[t,n]=Lnt.shouldIgnoreNaNValues?Rnt(Hm(r),Hm(e)):[Hm(r),Hm(e)];if(t.length===0||n.length===0)return NaN;let a=hH(t),i=hH(n),o=dH(t),s=dH(n),u=t.length,c=n.length,l=(a-i)/Bnt(o*o/u+s*s/c);return 2*znt(l)}mH.exports=h2});var xH=Y((Mct,wH)=>{var{assert:d2,clamp:$nt,DataFrame:Km,dropNaNPairwise:qnt,isArray:gH,isDataFrame:jm,isJagged:yH,isUndefined:Wnt,ndarray:Vnt}=It(),Unt=Hi(),bH=p2();function v2(r){let e="@jrc03c/js-data-science-helpers/get-p-value-matrix";return Object.defineProperty(r,e,{configurable:!1,enumerable:!1,writable:!1,value:Symbol.for(e)}),r}function m2(r,e){if(Wnt(e)&&(e=r),jm(r)){let n=new Km(m2(r.values,e));return n.index=r.columns.slice(),n.columns=jm(e)?e.columns.slice():new Km(e).columns.slice(),v2(n)}if(jm(e)){let n=new Km(m2(r,e.values));return n.index=jm(r)?r.columns.slice():new Km(r).columns.slice(),n.columns=e.columns.slice(),v2(n)}d2(gH(r)&&gH(e),"The `getPValueMatrix` function only works on 2-dimensional arrays and DataFrames!"),d2(!yH(r)&&!yH(e),"The `getPValueMatrix` function only works on non-jagged 2-dimensional arrays and DataFrames!"),d2(r.length===e.length,'The dimensions of the matrices you passed into the `getPValueMatrix` function aren\'t compatible! ([shape(a).join(", ")] vs. [shape(b).join(", ")]) The function expects that you\'ll be comparing the columns of two matrices where the columns are all of the same length, so please make sure that the matrices are oriented accordingly.');let t=Vnt([r[0].length,e[0].length]);for(let n=0;n<r[0].length;n++){let a=r.map(i=>i[n]);for(let i=0;i<e[0].length;i++){let o=e.map(s=>s[i]);Unt.shouldIgnoreNaNValues?t[n][i]=bH(...qnt(a,o)):t[n][i]=bH(a,o)}}return v2($nt(t,0,1))}wH.exports=m2});var EH=Y((Bct,TH)=>{var{assert:Xm,intersect:Gnt,isDataFrame:kH,isSeries:SH,isUndefined:NH}=It(),ll=class{constructor(e){let t=this;Xm(NH(e)||e===ll.DROP_NAN_MODE||e===ll.DROP_MISSING_MODE,"The `mode` value passed into the `IndexMatcher` constructor must be undefined or one of [IndexMatcher.DROP_NAN_MODE, IndexMatcher.DROP_MISSING_MODE]! (By default, the mode is `Indexer.DROP_MISSING_MODE`.)"),t.mode=NH(e)?ll.DROP_MISSING_MODE:e,t.index=null}fit(){let e=this,t=[];return Object.values(arguments).forEach(n=>{Xm(kH(n)||SH(n),"The `IndexMatcher` only works on Series and DataFrames! To drop NaN values in a pair-wise fashion from regular arrays, use the `dropNaNPairwise` function from the @jrc03c/js-math-tools library."),e.mode===ll.DROP_MISSING_MODE?t.push(n.dropMissing().index):t.push(n.dropNaN().index)}),e.index=Gnt(...t),e}transform(){let e=this;Xm(!!e.index,"The IndexMatcher hasn't been fitted yet! Please call the `fit` method before calling the `transform` method.");let t=Object.values(arguments).map(n=>(Xm(kH(n)||SH(n),"The `IndexMatcher` only works on Series and DataFrames! To drop NaN values in a pair-wise fashion from regular arrays, use the `dropNaNPairwise` function from the @jrc03c/js-math-tools library."),n.get(e.index,null)));return t.length===1?t[0]:t}fitAndTransform(){return this.fit(...arguments).transform(...arguments)}},$h=ll;ag($h,"DROP_NAN_MODE","DROP_NAN_MODE"),ag($h,"DROP_MISSING_MODE","DROP_MISSING_MODE");TH.exports=$h});var y2=Y((zct,_H)=>{var{assert:g2,isArray:Hnt,isBoolean:Knt,isDataFrame:IH,isSeries:CH,int:jnt,isNumber:Xnt,isUndefined:AH,range:DH,set:Ynt,shape:Znt,shuffle:Jnt}=It();_H.exports=function(){let e=Array.from(arguments),t=e.find(p=>Knt(p)),n=AH(t)?!0:t,a=e.find(p=>Xnt(p)),i=AH(a)?.1:a;g2(i>0&&i<1,"`testSize` must be a number between 0 and 1 (exclusive on both ends)!");let o=e.filter(p=>Hnt(p)||IH(p)||CH(p));g2(o.length>0,"You must pass at least one dataset into the `trainTestSplit` function!");let s=o.map(p=>Znt(p)[0]);g2(Ynt(s).length===1,`All datasets passed into the \`trainTestSplit\` function must be the same length at their shallowest dimension! The lengths of your datasets, though, are: ${s.join(", ")}`);let u=[],c=n?Jnt(DH(0,s[0])):DH(0,s[0]),l=jnt((1-i)*c.length),f=c.slice(0,l),h=c.slice(l);return o.forEach(p=>{if(IH(p))u.push(p.get(f,null)),u.push(p.get(h,null));else if(CH(p))u.push(p.get(f)),u.push(p.get(h));else{let d=[],m=[];p.forEach((v,g)=>{f.indexOf(g)>-1?d.push(v):m.push(v)}),u.push(d),u.push(m)}}),u}});var Zm=Y(($ct,BH)=>{var{add:Qnt,argmin:eat,assert:tat,flatten:FH,isArray:rat,isDataFrame:RH,isEqual:nat,int:aat,isNumber:iat,isSeries:OH,normal:b2,pow:oat,random:sat,range:uat,scale:cat,shape:Ym,subtract:lat,sum:fat}=It(),hat=y2();function w2(r,e){(RH(r)||OH(r))&&(r=r.values),(RH(e)||OH(e))&&(e=e.values),tat(nat(Ym(r),Ym(e)),"`yPred` and `yTrue` must have the same shape!");let t=FH(r),n=FH(e),a=0;return t.forEach((i,o)=>{i===n[o]&&a++}),a/t.length}function pat(r){test(`tests that the \`${r.name}\` model works correctly`,()=>{let e=b2([5,10]).map(f=>f.map(h=>h*100+b2()*100)),t=[],n=uat(0,500).map(()=>{let f=aat(sat()*e.length),h=e[f];return t.push(f),Qnt(h,cat(5,b2(Ym(h))))}),[a,i,o,s]=hat(n,t),u=new r({k:e.length});u.fit(a),u.centroids=PH(e,u.centroids);let c=u.predict(a),l=u.predict(i);expect(w2(o,c)).toBeGreaterThan(.95),expect(w2(s,l)).toBeGreaterThan(.95)})}function dat(r){return rat(r)&&Ym(r).length===2}function vat(r){return iat(r)&&parseInt(r)===r&&r>=0}function PH(r,e){return r.map(t=>e[eat(e.map(n=>MH(t,n)))])}function MH(r,e){return fat(oat(lat(r,e),2))}BH.exports={accuracy:w2,createGenericTest:pat,isMatrix:dat,isWholeNumber:vat,orderCentroids:PH,sse:MH}});var S2=Y((qct,qH)=>{var{add:LH,argmin:mat,assert:Du,copy:gat,distance:zH,divide:yat,isDataFrame:bat,isFunction:wat,isUndefined:Jm,normal:xat,random:kat,range:Sat,scale:Nat,shuffle:Tat,zeros:$H}=It(),{isMatrix:Eat,isWholeNumber:x2,sse:Iat}=Zm(),k2=class{constructor(e){Du(typeof e=="object","`config` must be an object! See the documentation for more information about the properties that the `config` object can contain."),Du(x2(e.k),"`k` must be a whole number!"),Du(x2(e.maxIterations)||Jm(e.maxIterations),"`maxIterations` must be a whole number or undefined!"),Du(x2(e.maxRestarts)||Jm(e.maxRestarts),"`maxRestarts` must be a whole number or undefined!"),Du(typeof e.tolerance=="number"||Jm(e.tolerance),"`tolerance` must be a number or undefined!");let t=this;t.k=e.k,t.maxRestarts=e.maxRestarts||25,t.maxIterations=e.maxIterations||100,t.tolerance=e.tolerance||1e-4,t.centroids=null,t._fitState=null}initializeCentroids(e){let t=this;return Tat(e).slice(0,t.k)}fitStep(e,t){let n=this;if(Du(Eat(e),"`x` must be a matrix!"),bat(e)&&(e=e.values),Jm(t)||Du(wat(t),"If defined, `progress` must be a function!"),n._fitState){if(n._fitState.isFinished)return n}else{let u=n.initializeCentroids(e);n._fitState={currentRestart:0,currentIteration:0,currentCentroids:u,bestCentroids:u,bestScore:-1/0,isFinished:!1}}let a=n.predict(e,n._fitState.currentCentroids),i=[],o=$H(n.k);e.forEach((u,c)=>{let l=a[c];i[l]||(i[l]=$H(u.length)),i[l]=LH(i[l],u),o[l]++});let s=Sat(0,n.k).map(u=>o[u]===0?LH(n._fitState.currentCentroids[parseInt(kat()*n._fitState.currentCentroids.length)],Nat(.001,xat(n._fitState.currentCentroids[0].length))):yat(i[u],o[u]));if(zH(n._fitState.currentCentroids,s)<n.tolerance?n._fitState.currentIteration=n.maxIterations-1:n._fitState.currentCentroids=s,t&&t((n._fitState.currentRestart+n._fitState.currentIteration/n.maxIterations)/n.maxRestarts,n),n._fitState.currentIteration++,n._fitState.currentIteration>=n.maxIterations){let u=n.score(e,n._fitState.currentCentroids);if(u>n._fitState.bestScore&&(n._fitState.bestScore=u,n._fitState.bestCentroids=gat(n._fitState.currentCentroids)),n._fitState.currentIteration=0,n._fitState.currentRestart++,n._fitState.currentRestart>=n.maxRestarts)n._fitState.isFinished=!0,n.centroids=n._fitState.bestCentroids,t&&t(1,n);else{let c=n.initializeCentroids(e);n._fitState.currentCentroids=c}}return n}fit(e,t){let n=this;for(n._fitState&&(n._fitState=null);!n._fitState||!n._fitState.isFinished;)n.fitStep(e,t);return n}predict(e,t){if(t=t||this.centroids,!t)throw new Error("No centroids were provided to the `predict` method, and the K-Means model hasn't been fitted yet. Please either pass centroids as a second parameter to the `predict` method or run the `fit` method first!");return e.map(a=>mat(t.map(i=>zH(a,i))))}score(e,t){let n=this;if(t=t||n.centroids,!t)throw new Error("No centroids were provided to the `score` method, and the K-Means model hasn't been fitted yet. Please either pass centroids as a second parameter to the `score` method or run the `fit` method first!");let i=n.predict(e,t).map(o=>t[o]);return-Iat(e,i)}};qH.exports=k2});var T2=Y((Wct,UH)=>{var{argmin:Cat,distance:WH,divide:Aat,max:Dat,random:VH}=It(),_at=S2(),N2=class extends _at{initializeCentroids(e){let t=this,n=[e[parseInt(VH()*e.length)]];for(;n.length<t.k;){let a=e.map(o=>WH(o,n[Cat(n.map(s=>WH(o,s)))])),i=Aat(a,Dat(a));n.push(e[i.findIndex(o=>VH()<o)])}return n}};UH.exports=N2});var KH=Y((Vct,HH)=>{var{assert:bo,isArray:Fat,isDataFrame:Rat,isEqual:Oat,isFunction:Pat,isUndefined:fl,range:Mat,shape:GH}=It(),{isMatrix:Bat,isWholeNumber:E2}=Zm(),Lat=T2(),I2=class{constructor(e){fl(e)&&(e={}),bo(typeof e=="object","`config` must be an object! See the documentation for more information about the properties that the `config` object can contain."),fl(e.ks)&&(e.ks=Mat(1,16)),bo(Fat(e.ks),"`ks` must be an array of whole numbers!"),e.ks.forEach(n=>{bo(E2(n),"`ks` must be an array of whole numbers!")}),bo(E2(e.maxIterations)||fl(e.maxIterations),"`maxIterations` must be a whole number or undefined!"),bo(E2(e.maxRestarts)||fl(e.maxRestarts),"`maxRestarts` must be a whole number or undefined!"),bo(typeof e.tolerance=="number"||fl(e.tolerance),"`tolerance` must be a number or undefined!");let t=this;t.ks=e.ks,t.maxRestarts=e.maxRestarts||25,t.maxIterations=e.maxIterations||100,t.tolerance=e.tolerance||1e-4,t.scoreStopRatio=e.scoreStopRatio||.85,t.modelClass=e.modelClass||Lat,t.fittedModel=null,t._fitState=null}fitStep(e,t){let n=this;if(bo(Bat(e),"`x` must be a matrix!"),Rat(e)&&(e=e.values),fl(t)||bo(Pat(t),"If defined, `progress` must be a function!"),!n._fitState)n._fitState={isFinished:!1,lastScore:-1/0,currentIndex:0};else if(n._fitState.isFinished)return n;let a=n.ks[n._fitState.currentIndex],i=new n.modelClass({k:a,maxRestarts:10,maxIterations:20});i.fit(e,s=>t?t((n._fitState.currentIndex+s)/(n.ks.length+1)):null);let o=i.score(e);return o/n._fitState.lastScore>n.scoreStopRatio?(n._fitState.isFinished=!0,n._fitState.currentIndex--):(n._fitState.lastScore=o,n._fitState.currentIndex+1>=n.ks.length?n._fitState.isFinished=!0:n._fitState.currentIndex++),n._fitState.isFinished&&(n.fittedModel=new n.modelClass({k:n.ks[n._fitState.currentIndex],maxRestarts:n.maxRestarts,maxIterations:n.maxIterations}),n.fittedModel.fit(e,s=>t?t((n.ks.length+s)/(n.ks.length+1)):null),t&&t(1)),n}fit(e,t){let n=this;for(n._fitState=null;!n._fitState||!n._fitState.isFinished;)n.fitStep(e,t);return n}predict(e,t){return this.fittedModel.predict(e,t)}score(e,t){return this.fittedModel.score(e,t)}get k(){return this.fittedModel.k}set k(e){throw new Error("You can't set the k-value manually! It has to be set automatically via the `fit` method.")}get centroids(){return this.fittedModel.centroids}set centroids(e){let t=this;bo(Oat(GH(e),GH(t.fittedModel.centroids)),"When assigning a new value to the `centroids` property, the new centroids must have the same shape as the old centroids!"),t.fittedModel.centroids=e}};HH.exports=I2});var XH=Y((Uct,jH)=>{jH.exports={KMeansMeta:KH(),KMeansNaive:S2(),KMeansPlusPlus:T2(),helpers:Zm()}});var C2=Y((Gct,t5)=>{var{apply:zat,assert:$at,dropNaN:YH,isArray:qat,isDataFrame:Wat,isSeries:Vat,mean:ZH,std:JH}=It(),QH=Hi();function e5(r){if(Wat(r)||Vat(r)){let n=r.copy();return n.values=e5(n.values),n}$at(qat(r),"The `normalize` function only works on arrays, Series, and DataFrames!");let e=(()=>QH.shouldIgnoreNaNValues?ZH(YH(r)):ZH(r))(),t=(()=>QH.shouldIgnoreNaNValues?JH(YH(r)):JH(r))();return t===0?r:zat(r,n=>(n-e)/t)}t5.exports=e5});var D2=Y((Hct,o5)=>{var{assert:hl,dot:r5,isArray:n5,isSeries:A2,scale:Uat,Series:Gat,shape:a5}=It(),i5=cl();function Qm(r,e){if(A2(r)){if(A2(e))return new Gat(Qm(r.values,e.values));{let t=r.copy();return t.values=Qm(r.values,e),t}}if(A2(e)){let t=e.copy();return t.values=Qm(r,e.values),t}return hl(n5(r),"`project` only works on vectors!"),hl(n5(e),"`project` only works on vectors!"),hl(i5(r),"`project` only works on vectors of numbers!"),hl(i5(e),"`project` only works on vectors of numbers!"),hl(a5(r).length===1,"`project` only works on vectors!"),hl(a5(e).length===1,"`project` only works on vectors!"),Uat(r5(e,r)/r5(e,e),e)}o5.exports=Qm});var f5=Y((Kct,l5)=>{var{assert:s5,copy:Hat,DataFrame:Kat,divide:jat,isArray:Xat,isDataFrame:Yat,isJagged:Zat,shape:Jat,subtract:Qat,transpose:u5}=It(),eit=cl(),tit=l2(),rit=D2();function c5(r){if(Yat(r)){let a=new Kat(c5(r.values));return a.index=r.index.slice(),a.columns=r.columns.slice(),a}s5(Xat(r)&&!Zat(r)&&Jat(r).length===2,"`orthonormalize` only works on matrices!"),s5(eit(r),"`orthonormalize` only works on matrices of numbers!");let e=u5(r),t=[];e.forEach(a=>{let i=Hat(a);t.forEach(o=>{i=Qat(i,rit(i,o))}),t.push(i)});let n=t.map(a=>jat(a,tit(a)));return u5(n)}l5.exports=c5});var p5=Y((jct,h5)=>{function nit(r){if(typeof r!="string")throw new Error("`text` must be a string!");r=r.trim();let e="",t=!1;for(let n=0;n<r.length;n++){let a=r[n];a.match(/[A-Za-z0-9]/g)?(e.length===0?e+=a.toLowerCase():t?e+=a.toUpperCase():e+=a,t=!1):!a.includes("'")&&!a.includes("\u2019")&&!a.includes("\u275C")&&(t=!0)}return e}h5.exports=nit});var v5=Y((Xct,d5)=>{function ait(r,e){return e=e||"",r.split(`
`).map(t=>t.trim().length>0?e+t:t).join(`
`)}d5.exports=ait});var g5=Y((Yct,m5)=>{function iit(r,e,t){if(typeof r!="string")throw new Error("`text` must be a string!");if(typeof e!="string")throw new Error("`a` must be a string!");if(typeof t!="string")throw new Error("`b` must be a string!");return r.split(e).join(t)}m5.exports=iit});var b5=Y((Zct,y5)=>{y5.exports="!\"#%&'()*+,-./:;<=>?@[]^_`{|}~\xA0\xA1\xA4\xA7\xA9\xAA\xAB\xAE\xB0\xB1\xB6\xB7\xBA\xBB\xBF\xD7\xF7\u0254\u0300\u0301\u0302\u0303\u037E\u0387\u055A\u055B\u055C\u055D\u055E\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A\u066B\u066C\u066D\u06D4\u0700\u0701\u0702\u0703\u0704\u0705\u0706\u0707\u0708\u0709\u070A\u070B\u070C\u070D\u07F7\u07F8\u07F9\u0830\u0831\u0832\u0833\u0834\u0835\u0836\u0837\u0838\u0839\u083A\u083B\u083C\u083D\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04\u0F05\u0F06\u0F07\u0F08\u0F09\u0F0A\u0F0B\u0F0C\u0F0D\u0F0E\u0F0F\u0F10\u0F11\u0F12\u0F14\u0F3A\u0F3B\u0F3C\u0F3D\u0F85\u0FD0\u0FD1\u0FD2\u0FD3\u0FD4\u0FD9\u0FDA\u104A\u104B\u104C\u104D\u104E\u104F\u10FB\u1360\u1361\u1362\u1363\u1364\u1365\u1366\u1367\u1368\u1400\u166E\u169B\u169C\u16EB\u16EC\u16ED\u1735\u1736\u17D4\u17D5\u17D6\u17D8\u17D9\u17DA\u1800\u1801\u1802\u1803\u1804\u1805\u1806\u1807\u1808\u1809\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0\u1AA1\u1AA2\u1AA3\u1AA4\u1AA5\u1AA6\u1AA8\u1AA9\u1AAA\u1AAB\u1AAC\u1AAD\u1B5A\u1B5B\u1B5C\u1B5D\u1B5E\u1B5F\u1B60\u1BFC\u1BFD\u1BFE\u1BFF\u1C3B\u1C3C\u1C3D\u1C3E\u1C3F\u1C7E\u1C7F\u1CC0\u1CC1\u1CC2\u1CC3\u1CC4\u1CC5\u1CC6\u1CC7\u1CD3\u2010\u2011\u2012\u2013\u2014\u2015\u2016\u2017\u2018\u2019\u201A\u201B\u201C\u201D\u201E\u201F\u2020\u2021\u2022\u2023\u2024\u2025\u2026\u2027\u2030\u2031\u2032\u2033\u2034\u2035\u2036\u2037\u2038\u2039\u203A\u203B\u203C\u203D\u203E\u203F\u2040\u2041\u2042\u2043\u2045\u2046\u2047\u2048\u2049\u204A\u204B\u204C\u204D\u204E\u204F\u2050\u2051\u2052\u2053\u2054\u2055\u2056\u2057\u2058\u2059\u205A\u205B\u205C\u205D\u205E\u207D\u207E\u208D\u208E\u2116\u2117\u2120\u2122\u212E\u2212\u2234\u2235\u2248\u2300\u2308\u2309\u230A\u230B\u2311\u2329\u232A\u2380\u25CA\u25CC\u261E\u2640\u2642\u26A5\u2766\u2767\u2768\u2769\u276A\u276B\u276C\u276D\u276E\u276F\u2770\u2771\u2772\u2773\u2774\u2775\u27C5\u27C6\u27E6\u27E7\u27E8\u27E9\u27EA\u27EB\u27EC\u27ED\u27EE\u27EF\u2983\u2984\u2985\u2986\u2987\u2988\u2989\u298A\u298B\u298C\u298D\u298E\u298F\u2990\u2991\u2992\u2993\u2994\u2995\u2996\u2997\u2998\u29D8\u29D9\u29DA\u29DB\u29FC\u29FD\u2CF9\u2CFA\u2CFB\u2CFC\u2CFE\u2CFF\u2D70\u2E00\u2E01\u2E02\u2E03\u2E04\u2E05\u2E06\u2E07\u2E08\u2E09\u2E0A\u2E0B\u2E0C\u2E0D\u2E0E\u2E0F\u2E10\u2E11\u2E12\u2E13\u2E14\u2E15\u2E16\u2E17\u2E18\u2E19\u2E1A\u2E1B\u2E1C\u2E1D\u2E1E\u2E1F\u2E20\u2E21\u2E22\u2E23\u2E24\u2E25\u2E26\u2E27\u2E28\u2E29\u2E2A\u2E2B\u2E2C\u2E2D\u2E2E\u2E30\u2E31\u2E32\u2E33\u2E34\u2E35\u2E36\u2E37\u2E38\u2E39\u2E3A\u2E3B\u2E3C\u2E3D\u2E3E\u2E3F\u2E40\u2E41\u2E42\u2E43\u2E44\u2E45\u2E46\u2E47\u2E48\u2E49\u2E4A\u2E4B\u2E4C\u2E4D\u2E4E\u2E4F\u2E52\u3001\u3002\u3003\u3008\u3009\u300A\u300B\u300C\u300D\u300E\u300F\u3010\u3011\u3014\u3015\u3016\u3017\u3018\u3019\u301A\u301B\u301C\u301D\u301E\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D\uA60E\uA60F\uA673\uA67E\uA6F2\uA6F3\uA6F4\uA6F5\uA6F6\uA6F7\uA874\uA875\uA876\uA877\uA8CE\uA8CF\uA8F8\uA8F9\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1\uA9C2\uA9C3\uA9C4\uA9C5\uA9C6\uA9C7\uA9C8\uA9C9\uA9CA\uA9CB\uA9CC\uA9CD\uA9DE\uA9DF\uAA5C\uAA5D\uAA5E\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uD800\uD801\uD802\uD803\uD804\uD805\uD806\uD807\uD809\uD81A\uD81B\uD82F\uD836\uD83A\u{1F03B}\uDC41\uDC42\uDC43\uDC44\uDC45\uDC47\uDC48\uDC49\uDC4A\uDC4B\uDC4C\uDC4D\uDC4E\uDC4F\uDC57\uDC5A\uDC5B\uDC5D\uDC70\uDC71\uDC72\uDC73\uDC74\uDC9F\uDCBB\uDCBC\uDCBE\uDCBF\uDCC0\uDCC1\uDCC6\uDD00\uDD01\uDD02\uDD1F\uDD2F\uDD3F\uDD40\uDD41\uDD42\uDD43\uDD44\uDD45\uDD46\uDD5E\uDD5F\uDD6F\uDD74\uDD75\uDDC1\uDDC2\uDDC3\uDDC4\uDDC5\uDDC6\uDDC7\uDDC8\uDDC9\uDDCA\uDDCB\uDDCC\uDDCD\uDDCE\uDDCF\uDDD0\uDDD1\uDDD2\uDDD3\uDDD4\uDDD5\uDDD6\uDDD7\uDDDB\uDDDD\uDDDE\uDDDF\uDDE2\uDE38\uDE39\uDE3A\uDE3B\uDE3C\uDE3D\uDE3F\uDE40\uDE41\uDE42\uDE43\uDE44\uDE45\uDE46\uDE50\uDE51\uDE52\uDE53\uDE54\uDE55\uDE56\uDE57\uDE58\uDE60\uDE61\uDE62\uDE63\uDE64\uDE65\uDE66\uDE67\uDE68\uDE69\uDE6A\uDE6B\uDE6C\uDE6E\uDE6F\uDE7F\uDE87\uDE88\uDE89\uDE8A\uDE8B\uDE97\uDE98\uDE99\uDE9A\uDE9B\uDE9C\uDE9E\uDE9F\uDEA0\uDEA1\uDEA2\uDEA9\uDEAD\uDEF0\uDEF1\uDEF2\uDEF3\uDEF4\uDEF5\uDEF6\uDEF7\uDEF8\uDF37\uDF38\uDF39\uDF3A\uDF3B\uDF3C\uDF3D\uDF3E\uDF3F\uDF44\uDF55\uDF56\uDF57\uDF58\uDF59\uDF99\uDF9A\uDF9B\uDF9C\uDF9F\uDFD0\uDFE2\uDFFF\uFD3F\uFE10\uFE11\uFE12\uFE13\uFE14\uFE15\uFE16\uFE17\uFE18\uFE19\uFE30\uFE31\uFE32\uFE33\uFE34\uFE35\uFE36\uFE37\uFE38\uFE39\uFE3A\uFE3B\uFE3C\uFE3D\uFE3E\uFE3F\uFE40\uFE41\uFE42\uFE43\uFE44\uFE45\uFE46\uFE47\uFE48\uFE49\uFE4A\uFE4B\uFE4C\uFE4D\uFE4E\uFE4F\uFE50\uFE51\uFE52\uFE54\uFE55\uFE56\uFE57\uFE58\uFE59\uFE5A\uFE5B\uFE5C\uFE5D\uFE5E\uFE5F\uFE60\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01\uFF02\uFF03\uFF05\uFF06\uFF07\uFF08\uFF09\uFF0A\uFF0C\uFF0D\uFF0E\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B\uFF3C\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F\uFF60\uFF61\uFF62\uFF63\uFF64\uFF65"});var _2=Y((Jct,k5)=>{var oit=g5(),sit=b5(),w5="  ",x5=" ";function uit(r){if(typeof r!="string")throw new Error("`text` must be a string!");let e="";for(let t=0;t<r.length;t++){let n=r[t].toLowerCase();sit.includes(n)?e+=x5:e+=n}for(;e.includes(w5);)e=oit(e,w5,x5);return e.trim()}k5.exports=uit});var N5=Y((Qct,S5)=>{var cit=_2();function lit(r){if(typeof r!="string")throw new Error("`text` must be a string!");let e=cit(r).split(" ");return e.length===0?"":e.length===1?e[0]:e.join("-")}S5.exports=lit});var E5=Y((elt,T5)=>{var fit=_2();function hit(r){if(typeof r!="string")throw new Error("`text` must be a string!");let e=fit(r).split(" ");return e.length===0?"":e.length===1?e[0]:e.join("_")}T5.exports=hit});var C5=Y((tlt,I5)=>{var{decycle:pit}=It();function dit(r,e,t){return JSON.stringify(pit(r),e,t)}I5.exports=dit});var D5=Y((rlt,A5)=>{function vit(r){let e=r.split(`
`),t=e.filter(a=>a.trim().length>0).map(a=>a.split("").findIndex(i=>!i.match(/\s/g))),n=Math.min(...t);return e.map(a=>a.substring(n)).join(`
`)}A5.exports=vit});var F5=Y((nlt,_5)=>{function mit(r,e){if(typeof r!="string")throw new Error("The first argument to the `wrap` function must be a string!");if((typeof e>"u"||e===null)&&(typeof process<"u"&&typeof process.stdout<"u"&&typeof process.stdout.columns=="number"?e=process.stdout.columns>80?80:process.stdout.columns:e=80),isNaN(e)||typeof e!="number")throw new Error("The second argument to the `wrap` function must be undefined, null, or an integer!");let t=[];return r.split(`
`).forEach(n=>{if(n.trim().length===0)return t.push("");let a=n.split(/[^\s]/g)[0],i=n.replace(a,"").split(" "),o=a;i.forEach(s=>{let u=o+(o.trim().length>0?" ":"")+s;u.length>e?(t.push(o),o=a+s):o=u}),o.length>0&&t.push(o)}),t.join(`
`)}_5.exports=mit});var R5=Y((alt,F2)=>{var qh={camelify:p5(),indent:v5(),kebabify:N5(),snakeify:E5(),stringify:C5(),unindent:D5(),wrap:F5(),dump(){Object.keys(qh).forEach(r=>{typeof global<"u"&&(global[r]=qh[r]),typeof window<"u"&&(window[r]=qh[r])})}};typeof F2<"u"&&(F2.exports=qh);typeof window<"u"&&(window.JSTextTools=qh)});var $5=Y((ilt,z5)=>{var{assert:pl,correl:O5,count:git,DataFrame:P5,inferType:yit,isArray:bit,isDataFrame:wit,isFunction:xit,isJagged:kit,isNumber:Wh,isUndefined:M5,shape:Sit,sort:Nit,sum:Tit}=It(),{stringify:Eit}=R5(),Iit=f2(),B5=r=>Wh(r)&&(parseInt(r)===r||r===1/0);function L5(r,e){e=e||{};let t=Wh(e.maxUniqueValues)?e.maxUniqueValues:7,n=Wh(e.minNonMissingValues)?e.minNonMissingValues:15,a=Wh(e.maxCorrelationThreshold)?e.maxCorrelationThreshold:1-1e-5,i=e.progress||null;if(bit(r))return pl(Sit(r).length===2&&!kit(r),"The `convertToNumerical` function only works on non-jagged 2-dimensional arrays and DataFrames!"),L5(new P5(r));pl(wit(r),"You must pass a DataFrame into the `convertToNumerical` function!"),pl(B5(t),"`maxUniqueValues` must be a whole number!"),pl(B5(n),"`minNonMissingValues` must be a whole number!"),pl(Wh(a),"`maxCorrelationThreshold` must be a number!"),M5(i)||pl(xit(i),"If defined, `progress` must be a function!");let o={};return r.apply((s,u)=>{i&&i(u/r.columns.length);let c=yit(s.values);if(c.type==="boolean"&&(c.values=c.values.map(f=>f?1:0)),c.type==="date"&&(c.values=c.values.map(f=>{try{return f.getTime()}catch{return NaN}})),c.type==="null")return;c.type,c.type==="object"&&(c.values=c.values.map(f=>Eit(f))),c.type;let l=c.values.filter(f=>!M5(f));if(!(c.values.length-l.length>n)){if(c.type!=="boolean"){let f=Nit(git(l),(p,d)=>d.count-p.count);if(Tit(f.slice(0,t).map(p=>p.count))/l.length>=.9){if(f.length<2)return;let p=Iit(s.name,c.values);for(;Object.keys(p).length>0;){let d=Object.keys(p)[0],m=p[d];delete p[d];let v=Object.keys(o);for(let g=0;g<v.length;g++){let y=o[v[g]];if(O5(m,y)>a)return}o[d]=m}return}if(c.type==="object"||c.type==="string")return}if(c.type==="boolean"||c.type==="date"||c.type==="number"){let f=Object.keys(o);for(let h=0;h<f.length;h++){let p=o[f[h]];if(O5(c.values,p)>a)return}o[s.name]=c.values}}}),new P5(o)}z5.exports=L5});var Y5=Y((olt,X5)=>{var{abs:Cit,add:Ait,assert:Vh,isArray:q5,isDataFrame:W5,isEqual:Dit,isSeries:V5,mean:_it,pow:U5,scale:Fit,shape:G5,sign:Rit,sqrt:Oit,sum:H5}=It(),K5=cl(),j5=(r,e)=>Ait(r,Fit(e,-1));function R2(r,e){if(W5(r)||V5(r))return R2(r.values,e);if(W5(e)||V5(e))return R2(r,e.values);Vh(q5(r),"You must pass two same-shaped numerical arrays into the `rScore` function!"),Vh(q5(e),"You must pass two same-shaped numerical arrays into the `rScore` function!"),Vh(Dit(G5(r),G5(e)),"You must pass two same-shaped numerical arrays into the `rScore` function!"),Vh(K5(r),"You must pass two same-shaped numerical arrays into the `rScore` function!"),Vh(K5(e),"You must pass two same-shaped numerical arrays into the `rScore` function!");let t=H5(U5(j5(r,e),2)),n=H5(U5(j5(r,_it(r)),2));if(n===0)return NaN;let a=1-t/n;return Rit(a)*Oit(Cit(a))}X5.exports=R2});var tK=Y((slt,eK)=>{var{argmax:Z5,assert:Uh,copy:Pit,DataFrame:Mit,dot:Bit,isArray:Lit,isDataFrame:zit,isEqual:J5,isJagged:$it,isNumber:qit,reverse:Wit,shape:Vit,transpose:Uit}=It();function Q5(r){if(Lit(r)){Uh(Vit(r).length===2&&!$it(r),"The `sortCorrelationMatrix` function only works on non-jagged 2-dimensional arrays and DataFrames!");let s=new Mit(r);return s.index=s.columns.slice(),Q5(s).values}Uh(zit(r),"You must pass a 2-dimensional array or DataFrame into the `sortCorrelationMatrix` function!");let e=r.copy(),t=[];e.values.forEach((s,u)=>{s.forEach((c,l)=>{qit(c)?Uh(c>=-1&&c<=1,"The correlation matrix passed into the `sortCorrelationMatrix` function must not contain values less than -1 or greater than 1!"):(t.push({row:e.index[u],col:e.columns[l],value:c}),e.values[u][l]=-1/0)})}),Uh(J5(e.values,Uit(e.values)),"The correlation matrix passed into the `sortCorrelationMatrix` function must be symmetrical!"),Uh(J5(e.index,e.columns),"The correlation matrix passed into the `sortCorrelationMatrix` function must be symmetrical! (In this case, although the values themselves are symmetrical, the row and column names differ.)");let n=Pit(e.index),a=[];for(;n.length>0;)if(a.length===0){let s=Z5(e.values.map(u=>Bit(u,u)));a.push(n[s]),n.splice(s,1)}else{let s=e.index.indexOf(a.at(-1)),u=Z5(n.map(l=>e.values[e.index.indexOf(l)][s])),c=n[u];a.push(c),n.splice(u,1)}let i=Wit(a),o=e.get(i,i);return t.forEach(s=>{let u=o.index.indexOf(s.row),c=o.columns.indexOf(s.col);o.values[u][c]=s.value,o.values[c][u]=s.value}),o}eK.exports=Q5});var nK=Y((ult,rK)=>{var Git=C2();function Hit(){return Git(...arguments)}rK.exports=Hit});var hK=Y((clt,fK)=>{var{assert:eg,DataFrame:aK,dropNaN:Kit,flatten:iK,isArray:jit,isDataFrame:O2,isSeries:P2,mean:oK,range:Xit,Series:sK,shape:uK,stdev:cK,transpose:lK}=It(),Yit=Hi(),M2=class{constructor(){let e=this;e.means=[],e.stdevs=[],e.wasFittedOnAVector=!1,e.hasBeenFitted=!1}_getDataArrayAndShape(e){if(O2(e))return[e.values,e.shape];if(P2(e)){let n=lK([e.values]);return[n,uK(n)]}eg(jit(e),"`x` must be a 1- or 2-dimensional array, DataFrame, or Series!");let t=uK(e);return eg(t.length<3,"`x` must be a 1- or 2-dimensional array, DataFrame, or Series!"),t.length===1&&(t.push(1),e=lK([e])),[e,t]}fit(e){let t=this,n=t._getDataArrayAndShape(e);e=n[0];let a=n[1];return t.wasFittedOnAVector=a.indexOf(1)>-1,t.means=[],t.stdevs=[],Xit(0,a[1]).forEach(i=>{let o=e.map(s=>s[i]);if(Yit.shouldIgnoreNaNValues){let s=Kit(o);t.means.push(oK(s)),t.stdevs.push(cK(s))}else t.means.push(oK(o)),t.stdevs.push(cK(o))}),t.hasBeenFitted=!0,t}transform(e){let t=this;if(!t.hasBeenFitted)throw new Error("This `StandardScaler` instance hasn't been trained on any data yet! Please use the `fit` method to train it before calling the `transform` method.");if(O2(e)){let o=new aK(t.transform(e.values));return o.columns=e.columns,o.index=e.index,o}if(P2(e)){let o=new sK(t.transform(e.values));return o.name=e.name,o.index=e.index,o}let n=t._getDataArrayAndShape(e);e=n[0];let a=n[1];eg(a[1]===t.means.length,"The data you passed into the `transform` function doesn't have the same number of columns as the data set on which this StandardScaler was fitted!");let i=e.map(o=>o.map((s,u)=>(s-t.means[u])/t.stdevs[u]));return t.wasFittedOnAVector?iK(i):i}untransform(e){let t=this;if(!t.hasBeenFitted)throw new Error("This `StandardScaler` instance hasn't been trained on any data yet! Please use the `fit` method to train it before calling the `transform` method.");if(O2(e)){let o=new aK(t.untransform(e.values));return o.columns=e.columns,o.index=e.index,o}if(P2(e)){let o=new sK(t.untransform(e.values));return o.name=e.name,o.index=e.index,o}let n=t._getDataArrayAndShape(e);e=n[0];let a=n[1];eg(a[1]===t.means.length,"The data you passed into the `untransform` function doesn't have the same number of columns as the data set on which this StandardScaler was fitted!");let i=e.map(o=>o.map((s,u)=>s*t.stdevs[u]+t.means[u]));return t.wasFittedOnAVector?iK(i):i}};fK.exports=M2});var B2=Y((llt,dK)=>{var{MathError:Zit}=It(),pK={clipOutliers:_6(),cohensD:n2(),cohensd:n2(),common:Hi(),containsOnlyNumbers:cl(),diagonalize:V6(),getCorrelationMatrix:s2(),getHighlyCorrelatedColumns:J6(),getMagnitude:l2(),getOneHotEncodings:f2(),getPercentages:oH(),getPValueMatrix:xH(),IndexMatcher:EH(),isBinary:t2(),isCorrelationMatrix:u2(),KMeans:XH(),normalize:C2(),orthonormalize:f5(),convertToNumerical:$5(),project:D2(),pValue:p2(),rScore:Y5(),sortCorrelationMatrix:tK(),standardize:nK(),StandardScaler:hK(),trainTestSplit:y2(),dump(){let r=this,e=typeof global<"u"?global:typeof window<"u"?window:null;if(!e)throw new Zit("Cannot dump functions into global scope because neither `global` nor `window` exist in the current context!");Object.keys(r).forEach(t=>{try{Object.defineProperty(e,t,{configurable:!1,enumerable:!0,writable:!1,value:r[t]})}catch{e[t]=r[t]}})}};try{window.JSDataScienceHelpers=pK}catch{}try{dK.exports=pK}catch{}});var z2=Y((flt,yK)=>{var{add:Jit,assert:_u,isDataFrame:tg,isFunction:Qit,isUndefined:vK,normal:eot,random:tot,scale:rot,shape:mK}=It(),{isMatrix:rg,isTFTensor:dl}=sl(),{KMeansNaive:not}=B2().KMeans,{sse:gK}=Qk(),wo=Lh(),L2=class extends not{initializeCentroids(e){return tg(e)&&(e=e.values),dl(e)&&(e=e.arraySync()),wo.tensor(super.initializeCentroids(e))}getFitStepFunction(e,t){let n=this;tg(e)&&(e=e.values),dl(e)&&(e=e.arraySync()),_u(rg(e),"`x` must be a matrix!"),vK(t)||_u(Qit(t),"If defined, `progress` must be a function!");let a=[],i=c=>(a.push(c),c),o=i(wo.tensor(e)),s=i(n.initializeCentroids(e)),u={currentRestart:0,currentIteration:0,currentCentroids:s,bestCentroids:s,bestScore:-1/0,isFinished:!1};return function(){try{let l=n.predict(o,u.currentCentroids),f=u.currentCentroids.arraySync(),h=[];for(let d=0;d<n.k;d++){let m=[];if(l.forEach((v,g)=>{v===d&&m.push(g)}),m.length===0)h.push(Jit(f[parseInt(tot()*f.length)],rot(.01,eot(e[0].length))));else{let v=i(o.gather(m));h.push(i(v.mean(0)))}}if(h=i(wo.stack(h)),gK(u.currentCentroids,h)<n.tolerance&&(u.currentIteration=n.maxIterations-1),u.currentIteration++,u.currentIteration>=n.maxIterations){u.currentRestart++;let d=n.score(o,h);d>u.bestScore&&(u.bestScore=d,u.bestCentroids=i(h.clone())),u.currentIteration=0,u.currentRestart>=n.maxRestarts?u.isFinished=!0:u.currentCentroids=i(n.initializeCentroids(e))}else u.currentCentroids=i(h.clone());return u.isFinished?(n.centroids=u.bestCentroids.arraySync(),u={isFinished:!0},a.forEach(d=>{try{d.dispose()}catch{}}),t&&t(1,n)):t&&t((u.currentRestart+u.currentIteration/n.maxIterations)/n.maxRestarts,n),u}catch(l){throw a.forEach(f=>{try{f.dispose()}catch{}}),l}}}fit(e,t){let n=this,a=n.getFitStepFunction(e,t),i;for(;!i||!i.isFinished;)i=a();return n}predict(e,t){let n=this;return wo.tidy(()=>{dl(e)&&(e=e.arraySync()),tg(e)&&(e=e.values),_u(rg(e),"`x` must be a matrix!"),t=t||n.centroids,dl(t)||(t=wo.tensor(t)),_u(mK(e)[1]===t.shape[1],"`x` and `centroids` must have the same number of columns!");let a=wo.tensor(e).expandDims(1),i=t.expandDims(0);return a.sub(i).pow(2).sum(2).argMin(1).arraySync()})}score(e,t){let n=this;return wo.tidy(()=>{dl(e)&&(e=e.arraySync()),tg(e)&&(e=e.values),_u(rg(e),"`x` must be a matrix!"),t=t||n.centroids,dl(t)||(t=wo.tensor(t)),_u(rg(t)||vK(t),"`centroids` must be a matrix or undefined!"),_u(mK(e)[1]===t.shape[1],"`x` and `centroids` must have the same number of columns!");let a=wo.tensor(e),i=n.predict(a,t),o=t.gather(i).arraySync();return-gK(a,o)})}};yK.exports=L2});var W2=Y((hlt,wK)=>{var{assert:aot,int:bK,random:$2}=It(),{isMatrix:iot}=sl(),vl=Lh(),oot=z2(),q2=class extends oot{initializeCentroids(e){aot(iot(e),"`x` must be a matrix!");let t=this;return vl.tidy(()=>{let n=vl.tensor(e),a=[bK($2()*e.length)];for(;a.length<t.k;){let i=a.map(l=>e[l]),o=vl.tensor(t.predict(e,i),null,"int32"),s=vl.tidy(()=>vl.tensor(i).gather(o).sub(n).pow(2).sum(1)),u=s.div(s.max()).arraySync(),c=0;for(let l=0;l<1e4;l++){c=bK($2()*u.length);let f=u[c];if($2()<f)break}a.push(c)}return vl.tensor(a.map(i=>e[i]))})}};wK.exports=q2});var SK=Y((plt,kK)=>{var{assert:sot,isEqual:uot,shape:xK}=It(),{KMeansMeta:cot}=B2().KMeans,{isTFTensor:lot}=sl(),fot=W2(),V2=class extends cot{constructor(e){super(e);let t=this;e=e||{},t.modelClass=e.modelClass||fot}get centroids(){let e=this;return e.fittedModel?e.fittedModel.centroids:e._fitState.bestCentroids}set centroids(e){let t=this;lot(e)&&(e=e.arraySync());let n=xK(e);if(t.centroids){let a=t.centroids,i=xK(a);sot(uot(n,i),`The new centroids must have the same shape as the old centroids! (expected: [${i.join(", ")}], received: [${n.join(", ")}])`)}t.fittedModel||(t.fittedModel=new t.modelClass({k:n[0],maxIterations:t.maxIterations,maxRestarts:t.maxRestarts,tolerance:t.tolerance})),t.fittedModel.centroids=e}};kK.exports=V2});var TK=Y((dlt,NK)=>{NK.exports={TFKMeansMeta:SK(),TFKMeansNaive:z2(),TFKMeansPlusPlus:W2()}});var hot=Y((vlt,U2)=>{var EK={helpers:sl(),metrics:Qk(),models:TK()};typeof U2<"u"&&(U2.exports=EK);typeof window<"u"&&(window.TFKMeans=EK)});hot();})();
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/** @license See the LICENSE file. */
