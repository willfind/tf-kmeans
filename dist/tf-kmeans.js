(()=>{var $H=Object.defineProperty;var qH=(n,e,t)=>e in n?$H(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var A2=(n=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(n,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):n)(function(n){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+n+'" is not supported')});var J=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);var Km=(n,e,t)=>(qH(n,typeof e!="symbol"?e+"":e,t),t);var Au=J((knt,_2)=>{var WH=new Function(`
  try {
    return this === window
  } catch(e) {}

  try {
    return typeof importScripts !== "undefined"
  } catch(e) {}

  return false
`),jm=class extends Error{constructor(e){WH()?super(e):super(`

\x1B[31m`+e+`
\x1B[0m`)}};_2.exports=jm});var qe=J((Snt,D2)=>{var VH=Au();D2.exports=function(n,e){if(!n)throw new VH(e)}});var Qa=J((Nnt,F2)=>{function GH(n){try{return structuredClone(n)}catch{return n}}F2.exports=GH});var Ue=J((Tnt,R2)=>{function UH(n){try{return n instanceof Array||typeof n.constructor<"u"&&n.constructor.name==="Array"}catch{return!1}}R2.exports=UH});var ft=J((Ent,O2)=>{function HH(n){try{return!!n._symbol&&n._symbol===Symbol.for("@jrc03c/js-math-tools/dataframe")}catch{return!1}}O2.exports=HH});var ct=J((Int,P2)=>{function KH(n){try{return!!n._symbol&&n._symbol===Symbol.for("@jrc03c/js-math-tools/series")}catch{return!1}}P2.exports=KH});var dn=J((Cnt,L2)=>{var jH=qe(),XH=Qa(),M2=Ue(),YH=ft(),ZH=ct();function B2(n){if(YH(n)||ZH(n))return B2(n.values);jH(M2(n),"The `flatten` function only works on arrays, Series, and DataFrames!");function e(t){let r=[];return XH(t).forEach(a=>{M2(a)?r=r.concat(e(a)):r.push(a)}),r}return e(n)}L2.exports=B2});var Tr=J((Ant,z2)=>{function JH(n){return typeof n=="function"}z2.exports=JH});var rt=J((_nt,$2)=>{function QH(n){return typeof n=="number"&&!isNaN(n)}$2.exports=QH});var yt=J((Dnt,q2)=>{function eK(n){return n===null||typeof n>"u"}q2.exports=eK});var vo=J((Fnt,W2)=>{var tK=Ue(),nK=yt();function rK(n){return typeof n=="object"&&!nK(n)&&!tK(n)}W2.exports=rK});var gl=J((Rnt,U2)=>{var aK=qe(),V2=Ue(),iK=ft(),oK=Tr(),Xm=rt(),G2=vo(),sK=ct();function Ym(n,e){if(iK(n)){let i=Ym(n.values,e);return i.length>0&&Xm(i[0])&&i[0]>=0&&i[0]<n.index.length&&(i[0]=n.index[i[0]]),i.length>1&&Xm(i[1])&&i[1]>=0&&i[1]<n.columns.length&&(i[1]=n.columns[i[1]]),i}if(sK(n)){let i=Ym(n.values,e);return i.length>0&&Xm(i[0])&&i[0]>=0&&i[0]<n.index.length&&(i[0]=n.index[i[0]]),i}if(aK(G2(n)||V2(n),"You must pass (1) an object, array, Series, or DataFrame and (2) a function or value into the `indexOf` function!"),!oK(e)){let i=e;e=o=>o===i}function t(i,o,s){if(s=s||[],s.indexOf(i)>-1)return null;if(G2(i)){s.push(i);let u=Object.keys(i);for(let c=0;c<u.length;c++){let l=u[c],f=i[l];if(o(f))return[l];let h=t(f,o,s);if(h&&h.length>0)return[l].concat(h)}}else if(V2(i)){s.push(i);for(let u=0;u<i.length;u++){let c=i[u];if(o(c))return[u];let l=t(c,o,s);if(l&&l.length>0)return[u].concat(l)}}else if(o(i))return[];return null}function r(i){try{return e(i)}catch{return!1}}let a=t(n,r);return a&&a.length>0?a:null}U2.exports=Ym});var Zm=J((Ont,H2)=>{var uK=Qa(),cK=gl(),lK=Ue(),fK=ft(),hK=ct();H2.exports=function(e){function t(i,o,s){if(o=o||[],s=s||"",o.indexOf(i)>-1){let u=s.split("/").slice(s.startsWith("/")?1:0);if(u.some((l,f)=>{let h=u.slice(0,u.length-f-1),p=r;return h.forEach(d=>{p=p[d]}),p===i}))return`<reference to "${r===i?"/":"/"+cK(r,i).join("/")}">`}return typeof i=="object"?i===null?null:(o.push(i),lK(i)?i.map((u,c)=>t(u,o,s+"/"+c)):(Object.keys(i).forEach(u=>{i[u]=t(i[u],o,s+"/"+u)}),i)):i}let r=uK(e),a=t(r);if(fK(e)){let i=e.copy();i._values=a.values,i._columns=a.columns,i._index=a.index,a=i}if(hK(e)){let i=e.copy();i.name=a.name,i._values=a.values,i._index=a.index,a=i}return a}});var Ti=J((Pnt,X2)=>{var K2=Qa(),j2=Zm();function pK(n,e){function t(r,a){let i=typeof r;if(i!==typeof a)return!1;if(i==="undefined")return!0;if(i==="boolean"||i==="symbol")return r===a;if(i==="number"||i==="bigint")return r.toString()==="NaN"&&a.toString()==="NaN"?!0:r===a;if(i==="string"||i==="function")return r===a;if(i==="object"){if(r===null||a===null)return r===null&&a===null;{let s=Object.keys(r),u=Object.keys(a);if(s.length!==u.length)return!1;for(let c=0;c<s.length;c++){let l=s[c];if(!t(r[l],a[l]))return!1}return!0}}}try{return t(K2(n),K2(e))}catch{return t(j2(n),j2(e))}}X2.exports=pK});var ei=J((Mnt,Q2)=>{var dK=qe(),vK=dn(),mK=Ue(),Y2=ft(),gK=Tr(),Z2=ct(),yK=yt();function yl(n){let e="abcdefg1234567890",t="";for(;t.length<n;)t+=e[parseInt(Math.random()*e.length)];return t}var bK=yl(256),wK=yl(256),xK=yl(256),kK=yl(256),SK=yl(256);function J2(n){if(Y2(n)||Z2(n))return J2(n.values);dK(mK(n),"The `set` function only works on arrays, Series, and DataFrames!");let e=[],t={};return vK(n).forEach(r=>{let a=typeof r=="object"&&r===null?bK:yK(r)?wK:gK(r)?r.toString():typeof r=="symbol"?r.toString()+" - "+SK:r===1/0?xK:r===-1/0?kK:Y2(r)?r.toJSONString():Z2(r)?JSON.stringify(r.toObject()):JSON.stringify(r);t[a]||e.push(r),t[a]=!0}),e}Q2.exports=J2});var bl=J((Bnt,nS)=>{var NK=qe(),Jm=dn(),eS=Ue(),TK=ft(),tS=Ti(),EK=Tr(),IK=ct(),CK=ei();function Xh(n,e){if(TK(n)||IK(n))return arguments.length>1?Xh(n.values,e):Xh(n.values,n.values);if(NK(eS(n),"The first argument to the `count` function must be an array, Series, or DataFrame!"),EK(e))return Jm(n).filter(t=>e(t)).length;if(eS(e)){let t=Jm(n);return CK(e).map(r=>({item:r,count:t.filter(a=>tS(a,r)).length}))}else return arguments.length>1?Jm(n).filter(t=>tS(t,e)).length:Xh(n,n)}nS.exports=Xh});var wl=J((Lnt,aS)=>{var AK=qe(),rS=Ue(),_K=ft(),DK=ct();function Qm(n){if(_K(n)||DK(n))return Qm(n.values);AK(rS(n),"The `isJagged` function only works on arrays, Series, and DataFrames!");let e=0,t=null;for(let r=0;r<n.length;r++)if(rS(n[r])){if(e++,Qm(n[r]))return!0;if(t===null)t=n[r].length;else if(n[r].length!==t)return!0}return e>0&&e<n.length}aS.exports=Qm});var Yh=J((znt,sS)=>{var FK=qe(),iS=Ue(),RK=ft(),OK=ct();function oS(n){if(RK(n)||OK(n))return oS(n.values);FK(iS(n),"The `isNested` function only works on arrays, Series, and DataFrames!");for(let e=0;e<n.length;e++)if(iS(n[e]))return!0;return!1}sS.exports=oS});var mo=J(($nt,cS)=>{var us=qe(),PK=Ue(),MK=Yh(),BK=rt(),LK=yt(),_u="You must pass a natural number or a one-dimensional array of natural numbers into the `ndarray` function!";function uS(n){us(!LK(n),_u),PK(n)||(n=[n]),us(!MK(n),_u),us(n.length>0,_u);let e=n[0];if(us(BK(e),_u),us(parseInt(e)===e,_u),us(e>=0,_u),us(e!==1/0,"We can't create an array containing an infinite number of values!"),n.length===1){let t=[];for(let r=0;r<e;r++)t.push(void 0);return t}else{let t=[];for(let r=0;r<e;r++)t.push(uS(n.slice(1)));return t}}cS.exports=uS});var xl=J((qnt,lS)=>{var zK=qe(),$K=Ue(),qK=ft(),WK=ct();function eg(n){if(qK(n)||WK(n)){let t=n.copy();return t.values=eg(t.values),t.index=eg(t.index),t}zK($K(n),"The `reverse` function only works on arrays, Series, and DataFrames!");let e=[];for(let t=n.length-1;t>=0;t--)e.push(n[t]);return e}lS.exports=eg});var sa=J((Wnt,fS)=>{var tg=qe(),ng=rt(),rg=yt(),VK=xl();function GK(n,e,t=1){tg(!rg(n)&&!rg(e)&&!rg(t),"You must pass two numbers and optionally a step value to the `range` function!"),tg(ng(n)&&ng(e)&&ng(t),"You must pass two numbers and optionally a step value to the `range` function!"),tg(t>0,"The step value must be greater than 0! (NOTE: The step value is a magnitude; it does not indicate direction.)");let r=!1;if(n>e){r=!0;let i=n;n=e+t,e=i+t}let a=[];for(let i=n;i<e;i+=t)a.push(i);return r&&(a=VK(a)),a}fS.exports=GK});var on=J((Vnt,vS)=>{var UK=qe(),hS=Ue(),HK=ft(),KK=Ti(),jK=ct(),XK=yt();function pS(n){if(!hS(n))return;let e=[n.length],t=0,r=n.map(a=>{let i=pS(a);return XK(i)?i:(t++,i.length===1?i[0]:i)});return t>0?t===n.length&&r.slice(0,-1).every((i,o)=>KK(i,r[o+1]))?e.concat(r[0]):(e.push(r),e):e}function dS(n){return HK(n)||jK(n)?dS(n.values):(UK(hS(n),"The `shape` function only works on arrays, Series, and DataFrames!"),pS(n))}vS.exports=dS});var xS=J((Gnt,wS)=>{var mS=qe(),YK=Ue(),ZK=ft(),JK=wl(),QK=ct(),e5=yt(),gS=Au(),Zh=mo(),yS=sa(),t5=ei(),n5=on();function bS(n,e,t){if(e5(t)&&(t=0),mS(t===0||t===1||t==="vertical"||t==="horizontal",'The only valid axis values for use when appending data to a DataFrame are 0, 1, "vertical", and "horizontal". Note that 0 == "horizontal" and 1 == "vertical".'),YK(e)){mS(!JK(e),"The array of data you're trying to append to this DataFrame is jagged!");let r=n5(e);if(r.length===1)if(t===0){let a=n.copy();a._values.push(e);let i=Math.max(n.shape[1],r[0]);for(a._values.forEach(o=>{for(;o.length<i;)o.push(void 0)});a._index.length<a._values.length;)a._index.push("row"+a._index.length);for(;a._columns.length<i;)a._columns.push("col"+a._columns.length);return a}else{let a=Math.max(n.shape[0],r[0]),i=n.copy();for(yS(0,a).forEach(o=>{o>=i._values.length&&i._values.push(Zh(n.shape[1])),i._values[o].push(e[o])});i._index.length<i._values.length;)i._index.push("row"+i._index.length);for(;i._columns.length<i._values[0].length;)i._columns.push("col"+i._columns.length);return i}else if(r.length===2)if(t===0){let a=Math.max(...e.map(o=>o.length).concat([n.shape[1]])),i=n.copy();for(i._values=i._values.concat(e).map(o=>{for(;o.length<a;)o.push(void 0);return o});i._index.length<i._values.length;)i._index.push("row"+i._index.length);for(;i._columns.length<a;)i._columns.push("col"+i._columns.length);return i}else{let a=Math.max(...e.map(s=>s.length))+n.shape[1],i=Math.max(n.shape[0],r[0]),o=n.copy();for(yS(0,i).forEach(s=>{for(s>=o._values.length&&o._values.push(Zh(n.shape[1])),o._values[s]=o._values[s].concat(e[s]);o._values[s].length<a;)o._values[s].push(void 0)});o._index.length<o._values.length;)o._index.push("row"+o._index.length);for(;o._columns.length<a;)o._columns.push("col"+o._columns.length);return o}else throw new gS("Only 1- and 2-dimensional arrays can be appended to a DataFrame!")}else if(QK(e)){let r=bS(n,e.values,t);return t===0?r.index[r.index.length-1]=r.index.indexOf(e.name)>-1?e.name+" (2)":e.name:r.columns[r.columns.length-1]=r.columns.indexOf(e.name)>-1?e.name+" (2)":e.name,r}else if(ZK(e))if(t===0){let r=n.copy(),a=t5(r._columns.concat(e._columns)).length;for(r._values.forEach(i=>{for(;i.length<a;)i.push(void 0)}),e.apply(i=>{let o=i.copy(),s=[];r._columns.forEach(u=>{let c=o._index.indexOf(u);c>-1?(s.push(o._values[c]),o._values.splice(c,1),o._index.splice(c,1)):s.push(void 0)}),r._values.push(s.concat(o._values))},1),r._columns=r._columns.concat(e._columns.filter(i=>r._columns.indexOf(i)<0));r._index.length<r._values.length;){let i="row"+r._index.length;r._index.push(i+(n._index.indexOf(i)>-1?" (2)":""))}return r}else{let r=n.copy();return r._index.forEach((a,i)=>{let o=e._index.indexOf(a);o>-1?r._values[i]=r._values[i].concat(e._values[o]):r._values[i]=r._values[i].concat(Zh(e.shape[1]))}),e._index.forEach((a,i)=>{r._index.indexOf(a)<0&&(r._index.push(a),r._values.push(Zh(r._columns.length).concat(e._values[i])))}),r._columns=r._columns.concat(e._columns.map(a=>a+(r._columns.indexOf(a)>-1?" (2)":""))),r}else throw new gS("Only 1- or 2-dimensional arrays, Series, and DataFrames can be appended to a DataFrame!")}wS.exports=bS});var ES=J((Unt,TS)=>{var kS=qe(),SS=Ue(),r5=Tr(),NS=yt();function a5(n,e,t,r,a){if(a=a||0,kS(r5(r),"The first parameter to the `apply` method must be a function."),kS(a===0||a===1,"The second parameter to the `apply` method (the `axis`) must be 0 or 1."),a===0){let i={},o;if(t.columns.forEach((s,u)=>{let c=new e(t.values.map(f=>f[u]));c.name=s,c.index=t.index;let l=r(c,u,t);l instanceof e?i[s]=l.values:i[s]=l,NS(o)&&(o=l instanceof e||SS(l))}),o){let s=new n(i);return s.index=t.index,s}else{let s=new e(t.columns.map(u=>i[u]));return s.index=t.columns,s}}else if(a===1){let i,o=t.values.map((s,u)=>{let c=new e(s);c.name=t.index[u],c.index=t.columns;let l=r(c,u,t);return NS(i)&&(i=l instanceof e||SS(l)),l instanceof e?l.values:l});if(i){let s=new n(o);return s.index=t.index,s.columns=t.columns,s}else{let s=new e(o);return s.index=t.index,s}}}TS.exports=a5});var Lr=J((Hnt,IS)=>{function i5(n){return typeof n=="string"}IS.exports=i5});var _S=J((Knt,AS)=>{var CS=qe(),o5=Ue(),s5=wl(),u5=vo(),c5=Lr(),l5=yt(),f5=Au(),h5=on();function p5(n,e,t,r,a){let i=s=>s instanceof n,o=s=>s instanceof e;if(l5(a)){if(i(r))return t.append(r,1);if(o(r))return t.append(r,1);if(u5(r)){let s=Math.max(...Object.keys(r).map(u=>r[u].length));return Object.keys(r).forEach(u=>{for(;r[u].length<s;)r[u].push(void 0)}),t.append(new n(r),1)}else throw new f5("You must pass a DataFrame, Series, or object into the `assign` method!")}else{CS(c5(r),"If passing two arguments into the `assign` method, then the first argument must be a string name!"),CS(o5(a)&&!s5(a)&&h5(a).length===1,"If passing two arguments into the `assign` method, then the second argument must be a 1-dimensional array!");let s=t.append(a,1);return s.columns[s.columns.length-1]=r,s}}AS.exports=p5});var FS=J((jnt,DS)=>{var d5=Qa();function v5(n,e){if(e.isEmpty)return new n;let t=new n(d5(e.values));return t.columns=e.columns.slice(),t.index=e.index.slice(),t}DS.exports=v5});var zS=J((Xnt,LS)=>{var Jh=qe(),RS=Ue(),OS=rt(),PS=Lr(),MS=yt(),BS=on();function m5(n,e,t,r,a){MS(r)&&(r=[]),MS(a)&&(a=[]),(PS(r)||OS(r))&&(r=[r]),(PS(a)||OS(a))&&(a=[a]),Jh(RS(r),"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings."),Jh(RS(a),"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings."),Jh(BS(r).length===1,"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings."),Jh(BS(a).length===1,"The `drop` method only works on 1-dimensional arrays of numerical indices and/or strings.");let i,o;t.index.forEach((u,c)=>{r.indexOf(u)<0&&r.indexOf(c)<0&&(i||(i=[]),i.push(u))}),t.columns.forEach((u,c)=>{a.indexOf(u)<0&&a.indexOf(c)<0&&(o||(o=[]),o.push(u))});let s=t.get(i,o);if(s instanceof e){let u=new n;u=u.assign(s),t.index.indexOf(s.name)>-1&&(u=u.transpose()),s=u}return s}LS.exports=m5});var kl=J((Ynt,$S)=>{var g5=rt();function y5(n){return g5(n)&&parseInt(n)===n}function b5(n){return y5(n)&&n>=0}$S.exports=b5});var WS=J((Znt,qS)=>{var ag=qe(),w5=Lr(),Qh=yt(),x5=kl(),k5=on();function S5(n,e,t,r,a,i){r=r||0,ag(r===0||r===1,"The first parameter of the `dropMissing` method (the `axis`) must be 0 or 1."),i=i||0,ag(x5(i),"The third parameter of the `dropMissing` method (the `threshold`) should be a whole number (meaning that data should be dropped if it contains more than `threshold` null values)."),a=i>0?"none":a||"any",ag(a==="any"||a==="all"||a==="none","The second parameter of the `dropMissing` method (the `condition` parameter, which indicates the condition under which data should be dropped) should be 'any' or 'all' (meaning that if 'any' of the data contains null values, then it should be dropped; or that if 'all' of the data contains null values, then it should be dropped).");function o(c){if(i>0){let l=0;for(let f=0;f<c.length;f++){let h=c[f];if(Qh(h)&&l++,l>=i)return[]}}else if(a==="any")for(let l=0;l<c.length;l++){let f=c[l];if(Qh(f))return[]}else if(a==="all"){for(let l=0;l<c.length;l++){let f=c[l];if(!Qh(f))return c}return[]}return c}let s=t.copy(),u=Math.random().toString();if(r===0){s=s.assign(u,s.index);let c=s.values.map(o).filter(f=>f.length>0);if(k5(c).length<2)return new n;s.values=c;let l=s.get(null,u);if(Qh(l))return new n;w5(l)&&(l=[l]),l instanceof e&&(l=l.values),s.index=l,s=s.drop(null,u)}else if(r===1){let c={};if(s.columns.forEach((f,h)=>{let p=s.values.map(v=>v[h]),d=o(p);d.length>0&&(c[f]=d)}),Object.keys(c).length===0)return new n;let l=new n(c);return l.index=s.index,l}return s}qS.exports=S5});var ig=J((Jnt,GS)=>{var N5=qe(),T5=Ue(),E5=ft(),I5=rt(),C5=ct();function VS(n){if(E5(n)||C5(n))return n.dropNaN(...Object.values(arguments).slice(1));N5(T5(n),"The `dropNaN` function only works on arrays, Series, and DataFrames!");let e=[];return n.forEach(t=>{try{return e.push(VS(t))}catch{if(I5(t))return e.push(t)}}),e}GS.exports=VS});var HS=J((Qnt,US)=>{var og=qe(),A5=ig(),_5=kl();function D5(n,e,t,r,a){t=t||0,og(t===0||t===1,"The first parameter of the `dropNaN` method (the `axis`) must be 0 or 1."),a=a||0,og(_5(a),"The third parameter of the `dropNaN` method (the `threshold`) should be a whole number (meaning that data should be dropped if it contains more than `threshold` NaN values)."),r=a>0?"none":r||"any",og(r==="any"||r==="all"||r==="none","The second parameter of the `dropNaN` method (the `condition` parameter, which indicates the condition under which data should be dropped) should be 'any' or 'all' (meaning that if 'any' of the data contains NaN values, then it should be dropped; or that if 'all' of the data contains NaN values, then it should be dropped).");function i(s){let u=A5(s);return a>0?s.length-u.length<a:r==="any"?u.length===s.length:r==="all"?u.length>0:!0}let o=e.copy();if(t===0){let s=o.index.filter(u=>{let c=o.get(u,null).values;return i(c)});return s.length>0?o.get(s,null):new n}else if(t===1){let s=o.columns.filter(u=>{let c=o.get(null,u).values;return i(c)});return s.length>0?o.get(null,s):new n}return o}US.exports=D5});var YS=J((ert,XS)=>{var KS=qe(),Sl=dn(),F5=Tr(),R5=yt();function jS(n){let e={};return Sl(n).forEach((t,r)=>{e[t]=r}),e}function Du(n){return Object.keys(n).sort((e,t)=>n[e]-n[t])}function O5(n,e,t,r,a){KS(F5(r),"The `filter` method takes a single parameter: a function that is used to filter the values."),R5(a)&&(a=0),KS(a===0||a===1,"The `axis` parameter to the `filter` method must be 0 or 1.");let i=t.copy();if(i.isEmpty)return i;let o=jS(i.index),s=jS(i.columns);if(a===0){let u=i.values.filter((c,l)=>{let f=new e(c);f.name=t.index[l],f.index=t.columns;let h=r(f,l,t);return h||delete o[i.index[l]],h});if(Sl(u).length===0)return new n;if(u.length===1){let c=new e(Sl(u));return c.name=Du(o)[0],c.index=Du(s),c}i.values=u,i.index=Du(o)}else if(a===1){i=i.transpose();let u=i.values.filter((c,l)=>{let f=new e(c);f.name=t.columns[l],f.index=t.index;let h=r(f,l,t);return h||delete s[i.index[l]],h});if(Sl(u).length===0)return new n;if(u.length===1){let c=new e(Sl(u));return c.name=Du(s)[0],c.index=Du(o),c}i.values=u,i.index=Du(s),i=i.transpose()}return i}XS.exports=O5});var QS=J((trt,JS)=>{var Na=qe(),ep=rt(),tp=Lr(),ZS=yt(),P5=ei();function M5(n,e,t){(tp(e)||ep(e))&&(e=[e]),(tp(t)||ep(t))&&(t=[t]);let r=P5((e||[]).concat(t||[]).map(a=>typeof a));return Na(r.length<=2,"Only whole numbers and/or strings are allowed in `get` arrays!"),r.length===1&&Na(r[0]==="string"||r[0]==="number","Only whole numbers and/or strings are allowed in `get` arrays!"),r.length===2&&(Na(r.indexOf("string")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!"),Na(r.indexOf("number")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!")),ZS(e)||(e=e.map(a=>{if(tp(a))return Na(n.index.indexOf(a)>-1,`Row "${a}" does not exist!`),a;if(ep(a))return Na(a>=0,`Index ${a} is out of bounds!`),Na(parseInt(a)===a,"Row numbers must be integers!"),Na(a<n.index.length,`Index ${a} is out of bounds!`),n.index[a]})),ZS(t)||(t=t.map(a=>{if(tp(a))return Na(n.columns.indexOf(a)>-1,`Column "${a}" does not exist!`),a;if(ep(a))return Na(a>=0,`Column ${a} is out of bounds!`),Na(parseInt(a)===a,"Column numbers must be integers!"),Na(a<n.columns.length,`Column ${a} is out of bounds!`),n.columns[a]})),n.getSubsetByNames(e,t)}JS.exports=M5});var go=J((nrt,tN)=>{var eN=qe(),B5=Ue(),L5=ft(),z5=Tr(),$5=ct(),q5=yt();function W5(n,e){try{return n<e?-1:n>e?1:0}catch{return n=typeof n=="object"&&n!==null?JSON.stringify(n):n.toString(),e=typeof e=="object"&&e!==null?JSON.stringify(e):e.toString(),n<e?-1:n>e?1:0}}function V5(n,e){if(q5(e)&&(e=W5),L5(n)||$5(n))return n.sort(...Object.values(arguments).slice(1));eN(B5(n),"The `sort` function only works on arrays, Series, and DataFrames!"),eN(z5(e),"The second parameter of the `sort` function must be a comparison function!");let t=n.slice();return t.sort(e),t}tN.exports=V5});var iN=J((rrt,aN)=>{var nN=qe(),rN=Lr(),G5=yt(),U5=ei(),H5=go();function K5(n){let e=n.toLowerCase(),t="";for(let a=0;a<e.length;a++){let i=e[a];i.match(/[a-z0-9]/g)?t+=i:t+=" "}let r=t.split(" ").filter(a=>a.length>0);return r[0]+r.slice(1).map(a=>a[0].toUpperCase()+a.substring(1)).join("")}function j5(n,e,t){G5(t)?t=e.columns:rN(t)&&(t=[t]);let r={};t.forEach(i=>{nN(rN(i),"You must pass either a string or a one-dimensional array of strings into the `getDummies` (AKA `oneHotEncode`) method!");let o=e.columns.indexOf(i);nN(o>-1,`The given DataFrame does not have a column called "${i}"!`);let s=e.values.map(c=>c[o]),u=H5(U5(s));s.forEach(c=>{u.forEach(l=>{let f=i+"_"+K5(l.toString());r[f]||(r[f]=[]),c===l?r[f].push(1):r[f].push(0)})})});let a=new n(r);return a.index=e.index,a}aN.exports=j5});var pN=J((art,hN)=>{var yo=qe(),oN=Ue(),sN=rt(),uN=yt(),cN=kl(),lN=sa(),fN=on();function X5(n,e,t){let r=n.shape;uN(e)&&(e=lN(0,r[0])),uN(t)&&(t=lN(0,r[1])),sN(e)&&(e=[e]),sN(t)&&(t=[t]),yo(oN(e)&&oN(t),"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),yo(fN(e).length===1&&fN(t).length===1,"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),yo(e.length>0,"The `rowIndices` array must contain at least one index."),yo(t.length>0,"The `colIndices` array must contain at least one index."),e.forEach(o=>{yo(cN(o),"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),yo(o<n.index.length,`The row index ${o} is out of bounds.`)}),t.forEach(o=>{yo(cN(o),"The `rowIndices` and `colIndices` parameters must be 1-dimensional arrays of whole numbers."),yo(o<n.columns.length,`The column index ${o} is out of bounds.`)});let a=e.map(o=>n.index[o]),i=t.map(o=>n.columns[o]);return n.getSubsetByNames(a,i)}hN.exports=X5});var yN=J((irt,gN)=>{var bo=qe(),sg=dn(),dN=Ue(),np=Lr(),vN=yt(),mN=on();function Y5(n,e,t,r,a){vN(r)&&(r=t.index),vN(a)&&(a=t.columns),np(r)&&(r=[r]),np(a)&&(a=[a]),bo(dN(r)&&dN(a),"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),bo(mN(r).length===1&&mN(a).length===1,"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),bo(r.length>0,"The `rows` array must contain at least one row name."),bo(a.length>0,"The `cols` array must contain at least one column name."),r.forEach(s=>{bo(np(s),"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),bo(t.index.indexOf(s)>-1,`The row name "${s}" does not exist in the list of rows.`)}),a.forEach(s=>{bo(np(s),"The `rows` and `cols` parameters must be 1-dimensional arrays of strings."),bo(t.columns.indexOf(s)>-1,`The column name "${s}" does not exist in the list of columns.`)});let i=r.map(s=>a.map(u=>t.values[t.index.indexOf(s)][t.columns.indexOf(u)]));if(r.length===1&&a.length===1)return sg(i)[0];if(r.length===1){let s=new e(sg(i));return s.name=r[0],s.index=a,s}if(a.length===1){let s=new e(sg(i));return s.name=a[0],s.index=r,s}let o=new n(i);return o.columns=a,o.index=r,o}gN.exports=Y5});var wN=J((ort,bN)=>{var Z5=Lr(),Nl=sa();function J5(n,e,t){function r(h,p){return Z5(h)&&h.length>p?h.substring(0,p-3)+"...":h}if(t.isEmpty)return console.table({}),console.log("Shape:",[0,0],`
`),t;let a=typeof window>"u"?20:10,i=parseInt(a/2),o=typeof process>"u"?10:Math.floor(process.stdout.columns/24)-1,s=parseInt(o/2),u=a>t.index.length?null:Nl(0,i).concat(Nl(t.index.length-i,t.index.length)),c=o>t.columns.length?null:Nl(0,s).concat(Nl(t.columns.length-s,t.columns.length)),l=t.get(u,c);l instanceof e&&(t.shape[0]===1?(l=new n([l.values]),l.index=t.index,l.columns=new e(t.columns).get(c).values):t.shape[1]===1&&(l=new n([l.values]).transpose(),l.index=new e(t.index).get(u).values,l.columns=t.columns)),a<=t.index.length&&(l._index.splice(i,0,"..."),l._values.splice(i,0,Nl(0,l.columns.length).map(()=>"..."))),o<=t.columns.length&&(l._columns.splice(s,0,"..."),l._values=l._values.map(h=>(h.splice(s,0,"..."),h)));let f=28;return l instanceof e?(l.values=l.values.map(h=>r(h,f)),l.name=r(l.name,f),l.index=l.index.map(h=>r(h,f))):(l.values=l.values.map(h=>h.map(p=>r(p,f))),l.columns=l.columns.map(h=>r(h,f)),l.index=l.index.map(h=>r(h,f))),console.table(l.toObject()),console.log("Shape:",t.shape,`
`),t}bN.exports=J5});var rp=J((srt,xN)=>{var Q5=qe(),ej=rt();function tj(n,e){Q5(ej(n),"The `leftPad` function only works on numbers!");let t=n.toString();for(;t.length<e;)t="0"+t;return t}xN.exports=tj});var SN=J((urt,kN)=>{var nj=rp(),rj=sa();function aj(n,e){let t=e?n:n.copy();return t.index=rj(0,n.shape[0]).map(r=>"row"+nj(r,(t.index.length-1).toString().length)),t}kN.exports=aj});var Tl=J((crt,TN)=>{var ij=qe(),oj=dn(),sj=Ue(),uj=ft(),cj=ct();function NN(n){if(uj(n)||cj(n))return NN(n.values);ij(sj(n),"The `product` function only works on arrays, Series, and DataFrames!");try{return n.length===0?NaN:oj(n).reduce((e,t)=>e*t,1)}catch{return NaN}}TN.exports=NN});var ap=J((lrt,AN)=>{var El=qe(),EN=dn(),IN=Ue(),lj=ft(),CN=rt(),fj=ct(),hj=Tl(),pj=on();function ug(n,e){if(lj(n)||fj(n))return ug(n.values,e);if(El(IN(n),"The first argument passed into the `reshape` function must be an array!"),CN(e)&&(e=[e]),El(IN(e),"The second argument passed into the `reshape` function must be a whole number or a one-dimensional array of whole numbers!"),El(pj(e).length===1,"The first argument passed into the `reshape` function must be a whole number or a one-dimensional array of whole numbers!"),e.forEach(i=>{El(CN(i)&&parseInt(i)===i&&i>0,"The first argument passed into the `reshape` function must be a whole number or a one-dimensional array of whole numbers!")}),e.length===0)return EN(n);let t=EN(n);if(e.length===1&&e[0]===t.length)return t;El(hj(e)===t.length,"The new shape doesn't match the number of values available in `x` (the first argument passed into the `reshape` function)!");let r=[],a=parseInt(t.length/e[0]);for(let i=0;i<e[0];i++){let o=t.slice(i*a,(i+1)*a);r.push(ug(o,e.slice(1)))}return r}AN.exports=ug});var Fu=J((frt,MN)=>{var dj=qe(),FN=Qa(),vj=Ue(),mj=rt(),RN=yt(),gj=mo(),yj=Tl(),bj=ap(),ON=Math.pow(2,64),sn=[];PN(parseInt(Math.random()*ON));function wj(n,e){n=dr(n);function t(){n+=dr("0x9e3779b97f4a7c15");let a=FN(n);return a=(a^a>>30n)*dr("0xbf58476d1ce4e5b9"),a=(a^a>>27n)*dr("0x94d049bb133111eb"),a^a>>31n}let r=[];for(let a=0;a<e;a++)r.push(t());return r}function dr(n){return BigInt.asUintN(64,BigInt(n))}function _N(n,e){return n=dr(n),e=BigInt(e),dr(dr(n<<e)|dr(n>>dr(64n-e)))}function PN(n){if(RN(n))return FN(sn);{dj(mj(n),"If passing a value into the `seed` function, then that value must be an integer!");let e=wj(parseInt(n),4);sn[0]=e[0],sn[1]=e[1],sn[2]=e[2],sn[3]=e[3]}}function DN(){let n=dr(_N(sn[0]+sn[3],23)+sn[0]),e=dr(sn[1]<<17n);return sn[2]=dr(sn[2]^sn[0]),sn[3]=dr(sn[3]^sn[1]),sn[1]=dr(sn[1]^sn[2]),sn[0]=dr(sn[0]^sn[3]),sn[2]=dr(sn[2]^e),sn[3]=_N(sn[3],45),parseInt(n)/ON}function xj(n){return RN(n)?DN():(vj(n)||(n=[n]),bj(gj(yj(n)).map(DN),n))}MN.exports={random:xj,seed:PN}});var ip=J((hrt,BN)=>{var{random:kj}=Fu(),Sj=qe(),Nj=Ue(),Tj=ft(),Ej=ct();function Ij(n){if(Tj(n)||Ej(n))return n.shuffle(...Object.values(arguments).slice(1));Sj(Nj(n),"The `shuffle` function only works on arrays, Series, and DataFrames!");let e=[],t=n.slice();for(let r=0;r<n.length;r++){let a=parseInt(kj()*t.length);e.push(t.splice(a,1)[0])}return e}BN.exports=Ij});var $N=J((prt,zN)=>{var Cj=qe(),Aj=yt(),LN=ip();function _j(n,e){return Aj(e)&&(e=0),Cj(e===0||e===1,"The `axis` parameter to the `shuffle` must be 0, 1, or undefined."),n.get(e===0?LN(n.index):null,e===1?LN(n.columns):null)}zN.exports=_j});var op=J((drt,qN)=>{function Dj(n){return typeof n=="boolean"}qN.exports=Dj});var HN=J((vrt,UN)=>{var{random:Fj}=Fu(),zr=qe(),Rj=dn(),WN=Ue(),cg=op(),GN=Tr(),sp=rt(),Ru=Lr(),lg=yt(),Oj=sa(),VN=on(),fg=go();function Pj(n,e,t){return GN(e)?Mj(n,e,t):Bj(n,e,t)}function Mj(n,e,t){if(t=lg(t)?0:t,zr(GN(e),"When sorting a DataFrame using a function, the first argument to the `sort` method must be a function!"),zr(sp(t),"When sorting a DataFrame using a function, the second argument to the `sort` method must be null, undefined, 0, or 1 to indicate the axis along which the data should be sorted! An axis of 0 means that the rows will be sorted relative to each other, whereas an axis of 1 means that the columns will be sorted relative to each other."),t===0){let r=fg(n.index,(a,i)=>e(n.get(a,null),n.get(i,null)));return n.get(r,null)}else{let r=fg(n.columns,(a,i)=>e(n.get(null,a),n.get(null,i)));return n.get(null,r)}}function Bj(n,e,t){let r=n.copy(),a=Fj().toString();return r=r.assign(a,r.index),lg(e)&&(e=[a],t=[!0]),(sp(e)||Ru(e))&&(e=[e],(cg(t)||Ru(t))&&(t=[t])),zr(WN(e),"The first parameter of the `sort` method must be (1) a string or index representing a column name or index, respectively; (2) a 1-dimensional array of strings and/or indices; or (3) null."),zr(VN(e).length===1,"The first parameter of the `sort` method must be (1) a string or index representing a column name or index, respectively; (2) a 1-dimensional array of strings and/or indices; or (3) null."),lg(t)&&(t=Oj(0,e.length).map(()=>!0)),zr(WN(t),"The second parameter of the `sort` method must be (1) a string or boolean representing the sort direction ('ascending' / 'descending', or true / false); (2) a 1-dimensional array of strings and/or booleans; or (3) null."),zr(VN(t).length===1,"The second parameter of the `sort` method must be (1) a string or boolean representing the sort direction ('ascending' / 'descending', or true / false); (2) a 1-dimensional array of strings and/or booleans; or (3) null."),zr(e.length===t.length,"The arrays passed into the `sort` method must be equal in length."),e=e.map(i=>{if(zr(Ru(i)||sp(i),"Column references can either be column names (as strings) or column indices (as whole numbers)."),Ru(i)){let o=r.columns.indexOf(i);return zr(o>-1,`The column "${i}" does not exist!`),o}if(sp(i))return zr(parseInt(i)===i,"Column indices must be whole numbers!"),zr(i>=0,`The column index ${i} is out of bounds!`),zr(i<r.columns.length,`The index ${i} is out of bounds!`),i}),t=t.map(i=>{if(zr(Ru(i)||cg(i),"Direction references can either be strings ('ascending' or 'descending') or booleans (true or false)."),Ru(i)){let o=i.trim().toLowerCase();return zr(o==="ascending"||o==="descending","Direction references can either be strings ('ascending' or 'descending') or booleans (true or false)."),o==="ascending"}if(cg(i))return i}),r.values=fg(r.values,(i,o)=>{let s=0;for(;i[e[s]]===o[e[s]]&&s<e.length;)s++;let u=t[s];if(i[e[s]]===o[e[s]])return 0;if(i[e[s]]<o[e[s]])return u?-1:1;if(i[e[s]]>o[e[s]])return u?1:-1}),r.index=Rj(r.get(null,a).values),r=r.dropColumns(a),r}UN.exports=Pj});var hg=J((mrt,KN)=>{function Lj(n,e){return JSON.stringify(n.toObject(e))}KN.exports=Lj});var jN=J((grt,dg)=>{var pg=Au(),zj=hg();function $j(n,e,t){let r=zj(n,t),a=!1,i=!1,o,s;try{let u=e;if(e.includes("/")){let l=e.split("/");u=l[l.length-1]}let c=document.createElement("a");c.href=`data:application/json;charset=utf-8,${encodeURIComponent(r)}`,c.download=u,c.dispatchEvent(new MouseEvent("click")),a=!0}catch(u){o=u}try{let u=A2("fs"),c=A2("path");u.writeFileSync(c.resolve(e),r,"utf8"),i=!0}catch(u){s=u}if(!a&&!i)throw typeof window<"u"?new pg(o):typeof dg<"u"?new pg(s):new pg("I don't know what's going wrong, but it doesn't seem like you're in Node or the browser, and we couldn't download and/or write the file to disk!");return n}dg.exports=$j});var YN=J((yrt,XN)=>{var qj=qe(),Wj=yt();function Vj(n,e){Wj(e)?e=0:qj(e===0||e===1,"The axis parameter of the `toObject` method must be undefined, 0, or 1. An axis of 0 indicates that the returned object should be organized first by rows and then by columns. An axis of 1 indicates that the returned object should be organized first by columns and then by rows.");let t={};return e===0?n.index.forEach((r,a)=>{let i={};n.columns.forEach((o,s)=>{i[o]=n.values[a][s]}),t[r]=i}):n.columns.forEach((r,a)=>{let i={};n.index.forEach((o,s)=>{i[o]=n.values[s][a]}),t[r]=i}),t}XN.exports=Vj});var cs=J((brt,QN)=>{var ZN=qe(),Gj=Ue(),Uj=ft(),Hj=ct(),Kj=mo(),JN=xl(),jj=on();function Xj(n){if(Uj(n)||Hj(n))return n.transpose();ZN(Gj(n),"The `transpose` function only works on arrays, Series, and DataFrames!");let e=jj(n);if(ZN(e.length<=2,"I'm not smart enough to know how to transpose arrays that have more than 2 dimensions. Sorry for the inconvenience! Please only pass 1- or 2-dimensional arrays into the `transpose` function!"),e.length===1)return JN(n);if(e.length===2){let t=Kj(JN(e));for(let r=0;r<e[0];r++)for(let a=0;a<e[1];a++)t[a][r]=n[r][a];return t}}QN.exports=Xj});var rT=J((wrt,nT)=>{var eT=qe(),Yj=Ue(),Zj=ft(),Jj=Yh(),Qj=ct(),e8=on();function tT(n,e,t){if(Qj(t))return new n(e.values.concat(t.values));if(Yj(t)){let r=e8(t);eT(r.length===1&&!Jj(r),"Only vectors can be appended to Series!");let a=e.copy();return t.forEach((i,o)=>{a._values.push(i),a._index.push("item"+(e.values.length+o))}),a}return eT(!Zj(t),"DataFrames cannot be appended to Series!"),tT(e,[t])}nT.exports=tT});var iT=J((xrt,aT)=>{var t8=qe(),n8=Tr();function r8(n,e){t8(n8(e),"The parameter to the `apply` method must be a function.");let t=n.copy();return t._values=t._values.map((r,a)=>e(r,a)),t}aT.exports=r8});var sT=J((krt,oT)=>{var a8=yt();function i8(n){let e=n.copy(),t=[];return e._values=e.values.filter((r,a)=>a8(r)?!1:(t.push(e.index[a]),!0)),e._index=t,e}oT.exports=i8});var cT=J((Srt,uT)=>{var o8=rt();function s8(n,e){let t=[],r=[];e.values.forEach((i,o)=>{o8(i)&&(r.push(i),t.push(e.index[o]))});let a=new n(r);return a.name=e.name,a.index=t,a}uT.exports=s8});var fT=J((Nrt,lT)=>{var u8=Qa();function c8(n,e,t){let r=e.copy(),a=u8(r.index),i=[],o=r.values.filter((s,u)=>{let c=t(s,u,r.values);return c||i.push(r.index[u]),c});return i.forEach(s=>{a.splice(a.indexOf(s),1)}),o.length===0?(r=new n,r.name=e.name,r):(r.values=o,r.index=a,r)}lT.exports=c8});var pT=J((Trt,hT)=>{var wo=qe(),l8=rt(),f8=Lr(),h8=yt(),p8=ei();function d8(n,e){(f8(e)||l8(e))&&(e=[e]);let t=p8((e||[]).map(r=>typeof r));return wo(t.length<=2,"Only whole numbers and/or strings are allowed in `get` arrays!"),t.length===1&&wo(t[0]==="string"||t[0]==="number","Only whole numbers and/or strings are allowed in `get` arrays!"),t.length===2&&(wo(t.indexOf("string")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!"),wo(t.indexOf("number")>-1,"Only whole numbers and/or strings are allowed in `get` arrays!")),h8(e)||(e=e.map(r=>{if(typeof r=="string")return wo(n.index.indexOf(r)>-1,`Index "${r}" does not exist!`),r;if(typeof r=="number")return wo(r>=0,`Index ${r} is out of bounds!`),wo(parseInt(r)===r,"Indices must be integers!"),wo(r<n.index.length,`Index ${r} is out of bounds!`),n.index[r]})),n.getSubsetByNames(e)}hT.exports=d8});var vT=J((Ert,dT)=>{var Il=qe(),v8=Ue(),m8=yt(),g8=kl(),y8=sa(),b8=on();function w8(n,e){let t=n.shape;m8(e)&&(e=y8(0,t[0])),Il(v8(e),"The `indices` array must be 1-dimensional array of whole numbers."),Il(b8(e).length===1,"The `indices` array must be a 1-dimensional array of whole numbers."),Il(e.length>0,"The `indices` array must contain at least one index."),e.forEach(a=>{Il(g8(a),"The `indices` array must be a 1-dimensional array of whole numbers."),Il(a<n.index.length,`The row index ${a} is out of bounds.`)});let r=e.map(a=>n.index[a]);return n.getSubsetByNames(r)}dT.exports=w8});var gT=J((Irt,mT)=>{var Cl=qe(),x8=Ue(),k8=Lr(),S8=yt(),N8=on();function T8(n,e,t){S8(t)&&(t=e.index),Cl(x8(t),"The `indices` array must be a 1-dimensional array of strings."),Cl(N8(t).length===1,"The `indices` array must be a 1-dimensional array of strings."),Cl(t.length>0,"The `indices` array must contain at least one index name."),t.forEach(i=>{Cl(k8(i),"The `indices` array must contain only strings."),Cl(e.index.indexOf(i)>-1,`The name "${i}" does not exist in the index.`)});let r=t.map(i=>e.values[e.index.indexOf(i)]);if(r.length===1)return r[0];let a=new n(r);return a.index=t,a.name=e.name,a}mT.exports=T8});var wT=J((Crt,bT)=>{var E8=Qa(),yT=sa();function I8(n){let e=n.copy(),t=typeof window>"u"?20:10;if(e.index.length>t){e=e.get(yT(0,t/2).concat(yT(e.index.length-t/2,e.index.length)));let a=E8(e.index);a.splice(parseInt(a.length/2),0,"..."),e.values.push("..."),e.index.push("..."),e=e.get(a)}let r={};return e.values.forEach((a,i)=>{let o={};o[e.name]=a,r[e.index[i]]=o}),console.table(r),console.log("Shape:",n.shape,`
`),n}bT.exports=I8});var kT=J((Art,xT)=>{var C8=ip();function A8(n){let e=n.copy();return e.get(C8(e.index))}xT.exports=A8});var NT=J((_rt,ST)=>{var _8=qe(),D8=Tr(),F8=yt(),R8=go(),O8=cs();function P8(n,e,t){t=t||((u,c)=>u<c?-1:1),_8(F8(t)||D8(t),"You must pass undefined, null, or a comparison function as the second argument to the `sort` method!");let r=O8([e.values,e.index]),a=R8(r,(u,c)=>t(u[0],c[0])),i=[],o=[];a.forEach(u=>{i.push(u[0]),o.push(u[1])});let s=new n;return s._values=i,s._index=o,s.name=e.name,s}ST.exports=P8});var IT=J((Drt,ET)=>{var M8=go(),TT=cs();function B8(n,e){let t=TT([e.values,e.index]);t=TT(M8(t,(a,i)=>{if(a[1]===i[1])return 0;if(a[1]<i[1])return-1;if(a[1]>i[1])return 1}));let r=new n(t[0]);return r.index=t[1],r.name=e.name,r}ET.exports=B8});var AT=J((Frt,CT)=>{function L8(n){let e={};return e[n.name]={},n.index.forEach((t,r)=>{e[n.name][t]=n.values[r]}),e}CT.exports=L8});var OT=J((Rrt,RT)=>{var Hi=qe(),up=Qa(),vg=Ue(),z8=Lr(),$8=yt(),_T=rp(),DT=sa(),cp=xl(),q8=rT(),W8=iT(),V8=sT(),G8=cT(),U8=fT(),H8=pT(),K8=vT(),j8=gT(),X8=wT(),Y8=kT(),Z8=NT(),J8=IT(),Q8=AT(),Al=on(),e7=cs(),FT=Symbol.for("@jrc03c/js-math-tools/series");RT.exports=function(n){class e{static[Symbol.hasInstance](r){try{return!!r._symbol&&r._symbol===FT}catch{return!1}}constructor(r){let a=this;if(a.name="data",Object.defineProperty(a,"_symbol",{configurable:!1,enumerable:!1,writable:!1,value:FT}),Object.defineProperty(a,"_values",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(a,"values",{configurable:!0,enumerable:!0,get(){return a._values},set(i){Hi(vg(i),"The new values must be a 1-dimensional array!");let o=Al(i);Hi(o.length===1,"The new array of values must be 1-dimensional!"),o[0]<a._index.length?a._index=a._index.slice(0,o[0]):o[0]>a._index.length&&(a._index=a._index.concat(DT(a._index.length,o[0]).map(s=>"item"+_T(s,(i.length-1).toString().length)))),a._values=i}}),Object.defineProperty(a,"_index",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(a,"index",{configurable:!0,enumerable:!0,get(){return a._index},set(i){Hi(vg(i),"The new index must be a 1-dimensional array of strings!"),Hi(i.length===a.shape[0],"The new index must be the same length as the old index!"),Hi(Al(i).length===1,"The new index must be a 1-dimensional array of strings!"),i.forEach(o=>{Hi(z8(o),"All of the row names must be strings!")}),a._index=i}}),r){if(r instanceof e)a.name=r.name,a.values=up(r.values),a.index=up(r.index);else if(vg(r)){let i=Al(r);Hi(i.length===1,"When passing an array into the constructor of a Series, the array must be 1-dimensional!"),a.values=r}else if(r instanceof Object){let i=Object.keys(r);Hi(i.length===1,"When passing an object into the constructor of a Series, the object must have only 1 key-value pair, where the key is the name of the data and the value is the 1-dimensional array of values!");let o=i[0],s=r[o];Hi(Al(s).length===1,"When passing an object into the constructor of a Series, the object must have only 1 key-value pair, where the key is the name of the data and the value is the 1-dimensional array of values!"),a.name=o,a.values=s.slice()}}}get shape(){return Al(this.values)}get length(){return this.shape[0]}get isEmpty(){return this.values.filter(a=>!$8(a)).length===0}clear(){let a=this.copy();return a.values.forEach((i,o)=>{a.values[o]=void 0}),a}get(r){return H8(this,r)}getSubsetByNames(r){return j8(e,this,r)}getSubsetByIndices(r){return K8(this,r)}loc(r){return this.getSubsetByNames(r)}iloc(r){return this.getSubsetByIndices(r)}reverse(){let r=this,a=new e(cp(r.values));return a.index=cp(r.index),a.name=r.name,a}resetIndex(){let r=this,a=r.copy();return a.index=DT(0,r.shape[0]).map(i=>"item"+_T(i,(a.index.length-1).toString().length)),a}copy(){let r=this,a=new e;return a._values=up(r.values),a._index=up(r.index),a.name=r.name,a}append(r){return q8(e,this,r)}apply(r){return W8(this,r)}concat(r){return this.append(r)}dropMissing(r,a){return V8(this,r,a)}dropNaN(){return G8(e,this)}toObject(){return Q8(this)}print(){return X8(this)}shuffle(){return Y8(this)}sort(r){return Z8(e,this,r)}sortByIndex(){return J8(e,this)}filter(r){return U8(e,this,r)}toDataFrame(){let r=this,a=new n(e7([r.values]));return a.columns=[r.name],a.index=r.index,a}transpose(){let a=this.copy();return a.values=cp(a.values),a.index=cp(a.index),a}getDummies(){return this.toDataFrame().getDummies()}oneHotEncode(){return this.getDummies()}}return e}});var Dl=J((Ort,$T)=>{var Ei=qe(),mg=Qa(),PT=bl(),t7=xS(),n7=ES(),r7=_S(),a7=FS(),i7=zS(),o7=WS(),s7=HS(),u7=YS(),c7=QS(),MT=iN(),l7=pN(),f7=yN(),h7=wN(),p7=SN(),d7=$N(),v7=HN(),m7=jN(),g7=hg(),y7=YN(),b7=dn(),_l=Ue(),w7=vo(),BT=yt(),gg=rp(),x7=mo(),yg=sa(),Ou=on(),LT=cs(),zT=Symbol.for("@jrc03c/js-math-tools/dataframe");function lp(n){let e="abcdefghijklmnopqrstuvwxyz1234567890",t="";for(let r=0;r<n;r++)t+=e[parseInt(Math.random()*e.length)];return t}var Un=class{static[Symbol.hasInstance](e){try{return!!e._symbol&&e._symbol===zT}catch{return!1}}constructor(e){let t=this;if(Object.defineProperty(t,"_symbol",{configurable:!1,enumerable:!1,writable:!1,value:zT}),Object.defineProperty(t,"_values",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(t,"values",{configurable:!0,enumerable:!0,get(){return t._values.length===0||!BT(t._values[0])&&t._values[0].length===0?[[]]:t._values},set(r){Ei(_l(r),"The new values must be a 2-dimensional array!");let a=Ou(r);Ei(a.length===2,"The new array of values must be 2-dimensional!"),a[0]<t._index.length?t._index=t._index.slice(0,a[0]):a[0]>t._index.length&&(t._index=t._index.concat(yg(t._index.length,a[0]).map(i=>"row"+gg(i,(a[0]-1).toString().length)))),a[1]<t._columns.length?t._columns=t._columns.slice(0,a[1]):a[1]>t._columns.length&&(t._columns=t._columns.concat(yg(t._columns.length,a[1]).map(i=>"col"+gg(i,(a[1]-1).toString().length)))),t._values=r}}),Object.defineProperty(t,"_columns",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(t,"columns",{configurable:!0,enumerable:!0,get(){return t._columns},set(r){Ei(_l(r),"The new columns list must be a 1-dimensional array of strings!"),Ei(t.isEmpty||r.length===t.shape[1],"The new columns list must be the same length as the old columns list!"),Ei(Ou(r).length===1,"The new columns list must be a 1-dimensional array of strings!"),r=r.map(i=>(typeof i!="string"&&(i=JSON.stringify(i)||i.toString()),i.trim().length===0?"untitled_"+lp(8):i.trim()));let a=(()=>{let i=PT(r),o={};return i.forEach(s=>{o[s.item]=s.count}),o})();r=r.map(i=>a[i]>1?i+"_"+lp(8):i),t._columns=r}}),Object.defineProperty(t,"_index",{value:[],configurable:!0,enumerable:!1,writable:!0}),Object.defineProperty(t,"index",{configurable:!0,enumerable:!0,get(){return t._index},set(r){Ei(_l(r),"The new index must be a 1-dimensional array of strings!"),Ei(t.isEmpty||r.length===t.shape[0],"The new index must be the same length as the old index!"),Ei(Ou(r).length===1,"The new index must be a 1-dimensional array of strings!"),r=r.map(i=>(typeof i!="string"&&(i=JSON.stringify(i)||i.toString()),i.trim().length===0?"untitled_"+lp(8):i.trim()));let a=(()=>{let i=PT(r),o={};return i.forEach(s=>{o[s.item]=s.count}),o})();r=r.map(i=>a[i]>1?i+"_"+lp(8):i),t._index=r}}),Ei(BT(e)||w7(e)||_l(e),"The `data` passed into the constructor of a DataFrame must be either (1) an object where the key-value pairs are (respectively) column names and 1-dimensional arrays of values, or (2) a 2-dimensional array of values."),e)if(e instanceof Un)t.values=mg(e.values),t.columns=mg(e.columns),t.index=mg(e.index);else if(_l(e)){let r=Ou(e);Ei(r.length===2,"The `data` array passed into the constructor of a DataFrame must be 2-dimensional!"),t.values=e}else{t._columns=Object.keys(e);let r=[];t._columns.forEach(i=>{let o=e[i];r.push(o)}),t._values=LT(r);let a=Ou(t.values);t._index=yg(0,a[0]).map(i=>"row"+gg(i,(a[0]-1).toString().length))}}get shape(){return Ou(this.values)}get length(){return this.shape[0]}get width(){return this.shape[1]}get rows(){return this.index}set rows(e){let t=this;t.index=e}get isEmpty(){return b7(this.values).length===0}clear(){let e=this,t=new Un(x7(e.shape));return t.columns=e.columns.slice(),t.index=e.index.slice(),t}get(e,t){let r=this;if(arguments.length===0)return r;if(arguments.length===1)try{return r.get(null,e)}catch{return r.get(e,null)}return c7(r,e,t)}getSubsetByNames(e,t){return f7(Un,xo,this,e,t)}getSubsetByIndices(e,t){return l7(this,e,t)}getDummies(e){return MT(Un,this,e)}oneHotEncode(e){return MT(Un,this,e)}transpose(){let e=this,t=new Un(LT(e.values));return t.columns=e.index.slice(),t.index=e.columns.slice(),t}get T(){return this.transpose()}resetIndex(e){return p7(this,e)}copy(){return a7(Un,this)}assign(e,t){return r7(Un,xo,this,e,t)}apply(e,t){return n7(Un,xo,this,e,t)}dropMissing(e,t,r){return o7(Un,xo,this,e,t,r)}dropNaN(e,t,r){return s7(Un,this,e,t,r)}drop(e,t){return i7(Un,xo,this,e,t)}dropColumns(e){return this.drop(null,e)}dropRows(e){return this.drop(e,null)}toObject(e){return y7(this,e)}toJSONString(e){return g7(this,e)}saveAsJSON(e,t){return m7(this,e,t)}print(){return h7(Un,xo,this)}sort(e,t){return v7(this,e,t)}sortByIndex(){return this.sort()}filter(e,t){return u7(Un,xo,this,e,t)}shuffle(e){return d7(this,e)}append(e,t){return t7(this,e,t)}concat(e,t){return this.append(e,t)}join(e,t){return this.append(e,t)}toString(){let e=this;return JSON.stringify(e)}},xo=OT()(Un);$T.exports={DataFrame:Un,Series:xo}});var Pu=J((Prt,WT)=>{var k7=qe(),S7=dn(),N7=Ue(),T7=ft(),E7=ct();function qT(n){if(T7(n)||E7(n))return qT(n.values);k7(N7(n),"The `max` function only works on arrays, Series, and DataFrames!");try{return Math.max(...S7(n))}catch{return NaN}}WT.exports=qT});var Lt=J((Mrt,KT)=>{var{DataFrame:VT,Series:GT}=Dl(),UT=qe(),Fl=Ue(),bg=ft(),HT=Ti(),I7=Tr(),wg=ct(),C7=Pu(),A7=sa(),fp=on();function _7(n){return Fl(n)||wg(n)||bg(n)}function D7(n){return UT(I7(n),"You must pass a function into the `vectorize` function!"),function e(){let t,r,a=[],i=[],o=Object.keys(arguments).filter(s=>{let u=arguments[s];return Fl(u)?!0:wg(u)?(t=!0,a.push(u),!0):bg(u)?(r=!0,i.push(u),!0):!1}).map(s=>arguments[s]);if(o.slice(0,-1).forEach((s,u)=>{UT(HT(Fl(s)?fp(s):s.shape,Fl(o[u+1])?fp(o[u+1]):o[u+1].shape),`When passing multiple arrays into the \`${n.name}\` function, all of the arrays must have the same shape!`)}),o.length>0){let s=C7(o.map(c=>c.length?c.length:c.values.length)),u=A7(0,s).map(c=>{let l=Object.keys(arguments).map(f=>{if(_7(arguments[f])){if(Fl(arguments[f]))return arguments[f][c];if(wg(arguments[f]))return arguments[f].values[c];if(bg(arguments[f]))return arguments[f].values[c]}else return arguments[f]});return e(...l)});if(r)try{if(i.length===1&&HT(fp(i[0]),fp(u))){let c=new VT(u);return c.index=i[0].index.slice(),c.columns=i[0].columns.slice(),c}else return new VT(u)}catch{return u}if(t)try{if(a.length===1&&a[0].length===u.length){let c=new GT(u);return c.name=a[0].name,c.index=a[0].index.slice(),c}else return new GT(u)}catch{return u}return u}else return n(...arguments)}}KT.exports=D7});var hp=J((Brt,jT)=>{var F7=rt(),R7=Lt();function O7(n){try{return F7(n)?Math.abs(n):NaN}catch{return NaN}}jT.exports=R7(O7)});var pp=J((Lrt,XT)=>{var P7=rt(),M7=Lt();function B7(){try{let n=0,e=Object.values(arguments);for(let t=0;t<e.length;t++){if(!P7(e[t]))return NaN;n+=e[t]}return n}catch{return NaN}}XT.exports=M7(B7)});var Rl=J((zrt,YT)=>{var L7=Lt();function z7(n,e){try{return e(n)}catch{return NaN}}YT.exports=L7(z7)});var JT=J(($rt,ZT)=>{var $7=rt(),q7=Lt();function W7(n){try{return $7(n)?Math.acos(n):NaN}catch{return NaN}}ZT.exports=q7(W7)});var eE=J((qrt,QT)=>{var V7=rt(),G7=Lt();function U7(n){try{return V7(n)?Math.asin(n):NaN}catch{return NaN}}QT.exports=G7(U7)});var nE=J((Wrt,tE)=>{var H7=rt(),K7=Lt();function j7(n){try{return H7(n)?Math.atan(n):NaN}catch{return NaN}}tE.exports=K7(j7)});var aE=J((Vrt,rE)=>{var X7=qe(),Y7=gl(),Z7=Ue(),J7=ft(),Q7=ct(),eX=Pu();function xg(n){if(J7(n)){let e=xg(n.values);return[n.index[e[0]],n.columns[e[1]]]}if(Q7(n)){let e=xg(n.values);return[n.index[e]]}X7(Z7(n),"The `argmax` function only works on arrays, Series, and DataFrames!");try{let e=Y7(n,eX(n));return e?e.length===0?void 0:e.length===1?e[0]:e:void 0}catch{return}}rE.exports=xg});var dp=J((Grt,oE)=>{var tX=qe(),nX=dn(),rX=Ue(),aX=ft(),iX=ct();function iE(n){if(aX(n)||iX(n))return iE(n.values);tX(rX(n),"The `min` function only works on arrays, Series, and DataFrames!");try{return Math.min(...nX(n))}catch{return NaN}}oE.exports=iE});var uE=J((Urt,sE)=>{var oX=qe(),sX=gl(),uX=Ue(),cX=ft(),lX=ct(),fX=dp();function kg(n){if(cX(n)){let e=kg(n.values);return[n.index[e[0]],n.columns[e[1]]]}if(lX(n)){let e=kg(n.values);return[n.index[e]]}oX(uX(n),"The `argmin` function only works on arrays, Series, and DataFrames!");try{let e=sX(n,fX(n));return e?e.length===0?void 0:e.length===1?e[0]:e:void 0}catch{return}}sE.exports=kg});var Sg=J((Hrt,cE)=>{cE.exports=["null","none","nan","na","n/a","","undefined"]});var Tg=J((Krt,hE)=>{var lE=Ue(),hX=op(),pX=vo(),fE=yt(),dX=Sg();function Ng(n,e){if(lE(n))return n.map(t=>Ng(t,e));if(e==="null")return null;if(e==="number"){if(fE(n))return NaN;let t=parseFloat(n);return isNaN(t)?NaN:t}if(e==="boolean"){if(hX(n))return n;try{let t=(typeof n=="object"?n.toString()==="null"?"false":JSON.stringify(n):n.toString()).trim().toLowerCase();return t==="true"||t==="yes"||t==="y"?!0:t==="false"||t==="no"||t==="n"?!1:null}catch{return null}}if(e==="date"){if(n instanceof Date)return n;let t=new Date(n);return t.toString()==="Invalid Date"?null:t}if(e==="object"){if(pX(n))return n;try{let t=JSON.parse(n);return lE(t)?t.map(r=>Ng(r,e)):t}catch{return null}}if(e==="string"){if(fE(n))return null;let t=(()=>typeof n=="object"?n===null?"null":JSON.stringify(n):n.toString())();return dX.indexOf(t.trim().toLowerCase())>-1?null:t}}hE.exports=Ng});var dE=J((jrt,pE)=>{var vX=rt(),mX=Lt();function gX(n){try{return vX(n)?Math.ceil(n):NaN}catch{return NaN}}pE.exports=mX(gX)});var gE=J((Xrt,mE)=>{var yX=hp(),vE=rt(),bX=yt(),wX=Lt();function xX(n,e){try{if(!vE(n))return NaN;if(bX(e))e=1e-10;else if(!vE(e))return NaN;return yX(n)<e?0:n}catch{return NaN}}mE.exports=wX(xX)});var bE=J((Yrt,yE)=>{var Eg=rt(),kX=Lt();function SX(n,e,t){try{return Eg(n)?Eg(e)?Eg(t)?n<e?e:n>t?t:n:NaN:NaN:NaN}catch{return NaN}}yE.exports=kX(SX)});var xE=J((Zrt,wE)=>{var Ig=qe(),NX=dn(),TX=Ue(),EX=ft(),IX=rt(),CX=ct();function Cg(n,e){if(EX(n)||CX(n))return Cg(n.values,e);if(Ig(TX(n),"The `combinations` function only works on arrays, Series, and DataFrames!"),Ig(IX(e),"`r` must be a whole number!"),n=NX(n),e>n.length)return[n];if(e<=0)return[[]];if(Ig(e===parseInt(e),"`r` must be a whole number!"),n.length<2)return n;let t=[];return n.forEach((r,a)=>{let i=n.slice(a+1);if(i.length<e-1)return;Cg(i,e-1).forEach(s=>{t.push([r].concat(s))})}),t}wE.exports=Cg});var vp=J((Jrt,SE)=>{var AX=qe(),_X=dn(),DX=Ue(),FX=ft(),RX=ct();function kE(n){if(FX(n)||RX(n))return kE(n.values);AX(DX(n),"The `mean` function only works on arrays, Series, and DataFrames!");try{let e=_X(n),t=0;return e.forEach(r=>{t+=r}),t/e.length}catch{return NaN}}SE.exports=kE});var _g=J((Qrt,AE)=>{var NE=qe(),TE=Ue(),mp=rt(),EE=ct(),IE=vp(),CE=on();function Ag(n,e){if(EE(n))return Ag(n.values,e);if(EE(e))return Ag(n,e.values);NE(TE(n)&&TE(e)&&CE(n).length===1&&CE(e).length===1,"The `covariance` function only works on 1-dimensional arrays and Series!"),NE(n.length===e.length,"The two arrays or Series passed into the `covariance` function must have the same length!");try{let t=IE(n),r=IE(e);if(!mp(t)||!mp(r))return NaN;let a=Math.max(n.length,e.length),i=0;for(let o=0;o<a;o++){if(!mp(n[o]))return NaN;if(!mp(e[o]))return NaN;i+=(n[o]-t)*(e[o]-r)}return i/n.length}catch{return NaN}}AE.exports=Ag});var gp=J((eat,_E)=>{var OX=rt(),PX=Lt();function MX(n){try{return OX(n)?Math.sqrt(n):NaN}catch{return NaN}}_E.exports=PX(MX)});var Dg=J((tat,FE)=>{var BX=qe(),LX=dn(),zX=Ue(),$X=ft(),qX=rt(),WX=ct(),VX=vp();function DE(n){if($X(n)||WX(n))return DE(n.values);BX(zX(n),"The `variance` function only works on arrays, Series, and DataFrames!");try{let e=LX(n),t=VX(e),r=0;for(let a=0;a<e.length;a++){if(!qX(e[a]))return NaN;r+=(e[a]-t)*(e[a]-t)}return r/e.length}catch{return NaN}}FE.exports=DE});var yp=J((nat,OE)=>{var GX=qe(),UX=Ue(),HX=ft(),KX=ct(),jX=gp(),XX=Dg();function RE(n){if(HX(n)||KX(n))return RE(n.values);GX(UX(n),"The `std` function only works on arrays, Series, and DataFrames!");try{return jX(XX(n))}catch{return NaN}}OE.exports=RE});var qE=J((rat,$E)=>{var PE=qe(),YX=_g(),ME=Ue(),BE=ct(),LE=on(),zE=yp();function Fg(n,e){if(BE(n))return Fg(n.values,e);if(BE(e))return Fg(n,e.values);PE(ME(n)&&ME(e)&&LE(n).length===1&&LE(e).length===1,"The `correl` function only works on 1-dimensional arrays and Series!"),PE(n.length===e.length,"The two arrays or Series passed into the `correl` function must have the same length!");try{return YX(n,e)/(zE(n)*zE(e))}catch{return NaN}}$E.exports=Fg});var VE=J((aat,WE)=>{var ZX=rt(),JX=Lt();function QX(n){try{return ZX(n)?Math.cos(n):NaN}catch{return NaN}}WE.exports=JX(QX)});var UE=J((iat,GE)=>{GE.exports=Object.freeze({boolean:"boolean",date:"date",null:"null",number:"number",object:"object",string:"string"})});var ZE=J((oat,YE)=>{var e9=qe(),HE=Ue(),KE=ft(),t9=Ti(),jE=ct(),XE=ei();function Rg(n,e){if(KE(n)||jE(n))return Rg(n.values,e);if(KE(e)||jE(e))return Rg(n,e.values);e9(HE(n)&&HE(e),"The `diff` function only works on arrays, Series, and DataFrames!");let t=XE(n),r=XE(e),a=[];return t.forEach(i=>{r.findIndex(o=>t9(o,i))<0&&a.push(i)}),a}YE.exports=Rg});var bp=J((sat,QE)=>{var JE=rt(),n9=Lt();function r9(n,e){try{return JE(n)?JE(e)?Math.pow(n,e):NaN:NaN}catch{return NaN}}QE.exports=n9(r9)});var Og=J((uat,eI)=>{var a9=rt(),i9=Lt();function o9(){try{let n=Object.values(arguments);if(n.length===0)return NaN;let e=1;for(let t=0;t<n.length;t++){if(!a9(n[t]))return NaN;e*=n[t]}return e}catch{return NaN}}eI.exports=i9(o9)});var Mu=J((cat,tI)=>{var s9=Og();function u9(){return s9(...arguments)}tI.exports=u9});var Pg=J((lat,nI)=>{var c9=pp(),l9=Mu();function f9(n,e){return c9(n,l9(e,-1))}nI.exports=f9});var wp=J((fat,aI)=>{var h9=qe(),p9=dn(),d9=Ue(),v9=ft(),m9=ct();function rI(n){if(v9(n)||m9(n))return rI(n.values);h9(d9(n),"The `sum` function only works on arrays, Series, and DataFrames!");try{return n.length===0?NaN:p9(n).reduce((e,t)=>e+t,0)}catch{return NaN}}aI.exports=rI});var fI=J((hat,lI)=>{var g9=hp(),y9=qe(),iI=Ue(),oI=ft(),b9=Ti(),sI=rt(),uI=ct(),w9=bp(),cI=on(),x9=gp(),k9=Pg(),S9=wp();function Mg(n,e){if(sI(n)&&sI(e))return g9(n-e);if(oI(n)||uI(n))return Mg(n.values,e);if(oI(e)||uI(e))return Mg(n,e.values);iI(n)&&iI(e)&&y9(b9(cI(n),cI(e)),"If passing two arrays, Series, or DataFrames into the `distance` function, then those objects must have the same shape!");try{return x9(S9(w9(k9(n,e),2)))}catch{return NaN}}lI.exports=Mg});var pI=J((pat,hI)=>{var N9=bp(),T9=Mu();function E9(n,e){return T9(n,N9(e,-1))}hI.exports=E9});var Lg=J((dat,bI)=>{var{DataFrame:dI,Series:vI}=Dl(),xp=qe(),mI=dn(),gI=Ue(),Bg=ft(),I9=rt(),kp=ct(),C9=Mu(),Sp=on(),A9=wp(),yI=cs();function ko(n,e){if(Bg(n)){let a=ko(n.values,e);if(Sp(a).length===1){let i=new vI(a);return i.name=kp(e)?e.name:i.name,i.index=n.index.slice(),i}else{let i=new dI(a);return i.index=n.index.slice(),Bg(e)&&(i.columns=e.columns.slice()),i}}if(Bg(e)){let a=ko(n,e.values);if(Sp(a).length===1){let i=new vI(a);return i.name=kp(n)?n.name:i.name,i.index=e.columns.slice(),i}else{let i=new dI(a);return i.columns=e.columns.slice(),i}}if(kp(n))return ko(n.values,e);if(kp(e))return ko(n,e.values);xp(gI(n)&&gI(e),"The `dot` function only works on arrays, Series, and DataFrames!"),mI(n).concat(mI(e)).forEach(a=>{xp(I9(a),"One of the arrays you passed into the `dot` function contains non-numerical values!")});let t=Sp(n),r=Sp(e);if(xp(t.length<=2&&r.length<=2,"I'm not smart enough to know how to get the dot-product of arrays that have more than 2 dimensions. Sorry for the inconvenience! Please only pass 1- or 2-dimensional arrays into the `dot` function!"),xp(t[t.length-1]===r[0],`There's a dimension misalignment in the two arrays you passed into the \`dot\` function. (${t[t.length-1]} !== ${r[0]})`),t.length===1&&r.length===1)return A9(C9(n,e));if(t.length===1&&r.length===2)return yI(e).map(a=>ko(n,a));if(t.length===2&&r.length===1)return n.map(a=>ko(a,e));if(t.length===2&&r.length===2){let a=yI(e),i=[];for(let o=0;o<n.length;o++){let s=[];for(let u=0;u<a.length;u++)s.push(ko(n[o],a[u]));i.push(s)}return i}}bI.exports=ko});var zg=J((vat,xI)=>{var _9=qe(),D9=Ue(),F9=ft(),R9=ct(),O9=yt();function wI(n){if(F9(n)||R9(n))return n.dropMissing(...Object.values(arguments).slice(1));_9(D9(n),"The `dropMissing` function only works on arrays, Series, and DataFrames!");let e=[];return n.forEach(t=>{try{return e.push(wI(t))}catch{O9(t)||e.push(t)}}),e}xI.exports=wI});var AI=J((mat,CI)=>{var kI=qe(),SI=Ue(),NI=ft(),P9=Ti(),TI=ct(),EI=yt(),II=on();function Np(n,e){if(NI(n)||TI(n))return Np(n.values,e);if(NI(e)||TI(e))return Np(n,e.values);kI(SI(n)&&SI(e),"The `dropMissingPairwise` function only works on arrays, Series, and DataFrames!"),kI(P9(II(n),II(e)),"The two arrays, Series, and/or DataFrames passed into the `dropMissingPairwise` function must have the same shape!");let t=[],r=[];for(let a=0;a<n.length;a++)try{let[i,o]=Np(n[a],e[a]);t.push(i),r.push(o)}catch{!EI(n[a])&&!EI(e[a])&&(t.push(n[a]),r.push(e[a]))}return[t,r]}CI.exports=Np});var BI=J((gat,MI)=>{var _I=qe(),DI=Ue(),FI=ft(),M9=Ti(),RI=rt(),OI=ct(),PI=on();function Tp(n,e){if(FI(n)||OI(n))return Tp(n.values,e);if(FI(e)||OI(e))return Tp(n,e.values);_I(DI(n)&&DI(e),"The `dropNaNPairwise` only works on arrays, Series, and DataFrames!"),_I(M9(PI(n),PI(e)),"The two arrays, Series, and/or DataFrames passed into the `dropNaNPairwise` must have the same shape!");let t=[],r=[];for(let a=0;a<n.length;a++)try{let[i,o]=Tp(n[a],e[a]);t.push(i),r.push(o)}catch{RI(n[a])&&RI(e[a])&&(t.push(n[a]),r.push(e[a]))}return[t,r]}MI.exports=Tp});var zI=J((yat,LI)=>{var B9=zg();function L9(n){return B9(n)}LI.exports=L9});var qI=J((bat,$I)=>{var z9=rt(),$9=Lt();function q9(n){try{return z9(n)?Math.exp(n):NaN}catch{return NaN}}$I.exports=$9(q9)});var GI=J((wat,VI)=>{var W9=Lt();function WI(n){try{return n!==parseInt(n)?NaN:n<=1?1:n*WI(n-1)}catch{return NaN}}VI.exports=W9(WI)});var jI=J((xat,KI)=>{var V9=qe(),G9=dn(),UI=Ue(),U9=ft(),H9=Tr(),HI=vo(),K9=ct();function $g(n,e){if(U9(n))return $g(G9(n.values),e);if(K9(n))return $g(n.values,e);if(V9(HI(n)||UI(n),"You must pass (1) an object, array, Series, or DataFrame and (2) a function or value into the `find` function!"),!H9(e)){let a=e;e=i=>i===a}function t(a,i,o){if(o=o||[],o.indexOf(a)>-1)return null;if(HI(a)){o.push(a);let s=Object.keys(a);for(let u=0;u<s.length;u++){let c=s[u],l=a[c];if(i(l))return l;let f=t(l,i,o);if(f)return f}}else if(UI(a)){o.push(a);for(let s=0;s<a.length;s++){let u=a[s];if(i(u))return u;let c=t(u,i,o);if(c)return c}}else if(i(a))return a;return null}function r(a){try{return e(a)}catch{return!1}}return t(n,r)}KI.exports=$g});var JI=J((kat,ZI)=>{var j9=qe(),X9=dn(),XI=Ue(),Y9=ft(),Z9=Tr(),YI=vo(),J9=ct();function qg(n,e){if(Y9(n))return qg(X9(n.values),e);if(J9(n))return qg(n.values,e);if(j9(YI(n)||XI(n),"You must pass (1) an object, array, Series, or DataFrame and (2) a function or value into the `findAll` function!"),!Z9(e)){let i=e;e=o=>o===i}function t(i,o,s){if(s=s||[],s.indexOf(i)>-1)return null;if(YI(i)){s.push(i);let u=Object.keys(i),c=[];for(let l=0;l<u.length;l++){let f=u[l],h=i[f],p=!1;o(h)&&(c.push(h),p=!0);let d=t(h,o,s);d&&d.length>0&&d.slice(p?1:0).forEach(v=>c.push(v))}return c}else if(XI(i)){s.push(i);let u=[];for(let c=0;c<i.length;c++){let l=i[c],f=!1;o(l)&&(u.push(l),f=!0);let h=t(l,o,s);h&&h.length>0&&h.slice(f?1:0).forEach(p=>u.push(p))}return u}else if(o(i))return[i];return null}function r(i){try{return e(i)}catch{return!1}}let a=t(n,r);return a&&a.length>0?a:null}ZI.exports=qg});var eC=J((Sat,QI)=>{var Q9=rt(),eY=Lt();function tY(n){try{if(n==="Infinity")return 1/0;if(n==="-Infinity")return-1/0;let e=JSON.parse(n);return Q9(e)?e:NaN}catch{return NaN}}QI.exports=eY(tY)});var nC=J((Nat,tC)=>{var nY=rt(),rY=Lt();function aY(n){try{return nY(n)?Math.floor(n):NaN}catch{return NaN}}tC.exports=rY(aY)});var Wg=J((Tat,rC)=>{var iY=rt(),oY=Tl(),sY=ap();function uY(n){iY(n)&&(n=[n]);let e=[],t=oY(n);for(let r=0;r<t;r++)e.push(0);return sY(e,n)}rC.exports=uY});var iC=J((Eat,aC)=>{var Ep=qe(),cY=rt(),lY=yt(),fY=Wg();function hY(n){Ep(!lY(n),"You must pass an integer greater than 0 (representing the size) into the `identity` function!"),Ep(cY(n),"You must pass an integer greater than 0 (representing the size) into the `identity` function!"),Ep(parseInt(n)===n,"You must pass an integer greater than 0 (representing the size) into the `identity` function!"),Ep(n>0,"You must pass an integer greater than 0 (representing the size) into the `identity` function!");let e=fY([n,n]);for(let t=0;t<n;t++)e[t][t]=1;return e}aC.exports=hY});var sC=J((Iat,oC)=>{oC.exports=["true","false","yes","no"]});var cC=J((Cat,uC)=>{var pY=Rl(),dY=qe(),vY=sC(),mY=Tg(),gY=bl(),yY=dn(),Vg=Ue(),bY=ft(),wY=rt(),xY=ct(),kY=Lr(),SY=Sg();function Ip(n){if(bY(n)){let a=n.copy(),i=Ip(n.values);return a.values=i.values,{type:i.type,values:a}}if(xY(n)){let a=n.copy(),i=Ip(n.values);return a.values=i.values,{type:i.type,values:a}}if(n instanceof Date)return{type:"date",value:n};if(!Vg(n)){let a=Ip([n]);return a.value=a.values[0],delete a.values,a}dY(Vg(n),"The `inferType` function only works on arrays, Series, and DataFrames!");let e=yY(n).map(a=>{if(a===void 0)return"null";if(a instanceof Date)return"date";kY(a)||(a=JSON.stringify(a));let o=a.toLowerCase().trim();if(SY.indexOf(o)>-1)return"null";if(vY.indexOf(o)>-1)return"boolean";try{let s=JSON.parse(a);return wY(s)?"number":typeof s=="object"?Vg(s)?"string":"object":"string"}catch{return new Date(a).toString()!=="Invalid Date"?"date":"string"}}),r=gY(e).sort((a,i)=>i.count-a.count)[0].item;return{type:r,values:pY(n,a=>mY(a,r))}}uC.exports=Ip});var fC=J((Aat,lC)=>{var NY=rt(),TY=Lt();function EY(n){try{let e=JSON.parse(n);return NY(e)?parseInt(e):NaN}catch{return NaN}}lC.exports=TY(EY)});var pC=J((_at,hC)=>{var IY=qe(),CY=Ue(),AY=ft(),_Y=Ti(),DY=ct(),Gg=ei();function FY(){let n=Object.values(arguments).map(t=>AY(t)||DY(t)?Gg(t.values):(IY(CY(t),"The `intersect` function only works on arrays, Series, and DataFrames!"),Gg(t)));return Gg(n).filter(t=>n.every(r=>r.findIndex(a=>_Y(a,t))>-1))}hC.exports=FY});var gC=J((Dat,mC)=>{var dC=pp(),So=qe(),RY=Lg(),OY=dn(),PY=Ue(),MY=ft(),Ug=rt(),vC=Mu(),BY=on();function Cp(n){if(MY(n)){let t=n.copy();return t.values=Cp(t.values),t}So(PY(n),"The `inverse` function only works on square 2-dimensional arrays or DataFrames!"),OY(n).forEach(t=>So(Ug(t),"The array passed into the `inverse` function must contain only numbers!"));let e=BY(n);if(So(e.length===2,"The array passed into the `inverse` function must be exactly two-dimensional and square!"),So(e[0]===e[1],"The array passed into the `inverse` function must be exactly two-dimensional and square!"),So(e[0]>=0,"The array passed into the `inverse` function must be exactly two-dimensional and square!"),e[0]===0)return n;if(e[0]===1)return So(n[0][0]!==0,"This matrix cannot be inverted!"),1/n[0][0];if(e[0]===2){let t=n[0][0],r=n[0][1],a=n[1][0],i=n[1][1],o=t*i-r*a;So(o!==0,"This matrix cannot be inverted!");let s=[[i,-r],[-a,t]];return vC(s,1/o)}else if(e[0]>1){let t=(r,a)=>Ug(r)||Ug(a)?vC(r,a):RY(r,a);for(let r=1;r<e[0]-1;r++)try{let a=n.slice(0,r).map(v=>v.slice(0,r)),i=n.slice(0,r).map(v=>v.slice(r,e[0])),o=n.slice(r,e[0]).map(v=>v.slice(0,r)),s=n.slice(r,e[0]).map(v=>v.slice(r,e[0])),u=Cp(a),c=Cp(dC(s,t(-1,t(t(o,u),i)))),l=dC(u,t(t(t(t(u,i),c),o),u)),f=t(-1,t(t(u,i),c)),h=t(-1,t(t(c,o),u)),p=c;return l.map((v,m)=>v.concat(f[m])).concat(h.map((v,m)=>v.concat(p[m])))}catch{}So(!1,"This matrix cannot be inverted!")}}mC.exports=Cp});var bC=J((Fat,yC)=>{var Hg=rt(),LY=Lt();function zY(n,e,t){try{return Hg(n)?Hg(e)?Hg(t)?t*(e-n)+n:NaN:NaN:NaN}catch{return NaN}}yC.exports=LY(zY)});var kC=J((Rat,xC)=>{var wC=rt(),$Y=yt(),qY=Lt();function WY(n,e){try{return e=$Y(e)?Math.E:e,wC(n)?wC(e)?Math.log(n)/Math.log(e):NaN:NaN}catch{return NaN}}xC.exports=qY(WY)});var TC=J((Oat,NC)=>{var VY=qe(),GY=dn(),UY=Ue(),HY=ft(),KY=ct(),jY=go();function SC(n){if(HY(n)||KY(n))return SC(n.values);VY(UY(n),"The `median` function only works on arrays, Series, and DataFrames!");try{let e=jY(GY(n));return e.length===0?NaN:e.length%2===0?(e[e.length/2-1]+e[e.length/2])/2:e[parseInt(e.length/2)]}catch{return NaN}}NC.exports=SC});var CC=J((Pat,IC)=>{var EC=rt(),XY=Lt();function YY(n,e){try{return EC(n)?EC(e)?n%e:NaN:NaN}catch{return NaN}}IC.exports=XY(YY)});var FC=J((Mat,DC)=>{var ZY=qe(),JY=bl(),QY=dn(),eZ=Ue(),tZ=ft(),nZ=ct(),rZ=ei(),AC=go();function _C(n){if(tZ(n)||nZ(n))return _C(n.values);ZY(eZ(n),"The `mode` function only works on arrays, Series, and DataFrames!");try{if(n.length===0)return NaN;let e=QY(n);if(e.length===0)return NaN;let t={},r=rZ(e);r.forEach(s=>{t[s]=JY(e,s)});let a=AC(r,(s,u)=>t[u]-t[s]),i=a[0];return AC(a.filter(s=>t[s]===t[i]))}catch{return NaN}}DC.exports=_C});var MC=J((Bat,PC)=>{var{random:RC}=Fu(),aZ=Rl(),iZ=yt(),oZ=mo();function OC(){let n=RC(),e=RC();return Math.sqrt(-2*Math.log(n))*Math.cos(2*Math.PI*e)}function sZ(n){return iZ(n)?OC():aZ(oZ(n),OC)}PC.exports=sZ});var LC=J((Lat,BC)=>{var uZ=Rl(),cZ=mo();function lZ(n){return uZ(cZ(n),()=>1)}BC.exports=lZ});var $C=J((zat,zC)=>{var Kg=qe(),fZ=dn(),hZ=Ue(),pZ=ft(),dZ=rt(),vZ=ct(),mZ=yt();function Ap(n,e){if(pZ(n)||vZ(n))return Ap(n.values,e);if(Kg(hZ(n),"The `permutations` function only works on arrays, Series, and DataFrames!"),mZ(e)&&(e=n.length),Kg(dZ(e),"`r` must be a whole number!"),n=fZ(n),e>n.length)return Ap(n);if(e<=0)return[[]];if(Kg(e===parseInt(e),"`r` must be a whole number!"),n.length<2)return n;let t=[];return n.forEach((r,a)=>{let i=n.slice(0,a),o=n.slice(a+1),s=i.concat(o);Ap(s,e-1).forEach(c=>{t.push([r].concat(c))})}),t}zC.exports=Ap});var WC=J(($at,qC)=>{var{DataFrame:gZ,Series:yZ}=Dl(),bZ=Ue(),wZ=ft(),xZ=wl(),kZ=ct(),SZ=on();function NZ(){Object.keys(arguments).forEach(n=>{let e=arguments[n];if(bZ(e))if(xZ(e))console.log(e);else{let t=SZ(e);t.length===1?new yZ(e).print():t.length==2?new gZ(e).print():console.log(e)}else wZ(e)||kZ(e)?e.print():console.log(e)})}qC.exports=NZ});var UC=J((qat,GC)=>{var TZ=Ue(),EZ=rt(),VC=yt(),IZ=Pu(),CZ=dp(),AZ=Lt(),_Z=AZ(function(n,e,t,r,a){try{return[n,e,t,r,a].every(i=>EZ(i))?t-e===0?NaN:(a-r)*(n-e)/(t-e)+r:NaN}catch{return NaN}});function DZ(n,e,t,r,a){return TZ(n)&&VC(r)&&VC(a)&&(r=e,a=t,e=CZ(n),t=IZ(n)),_Z(n,e,t,r,a)}GC.exports=DZ});var KC=J((Wat,HC)=>{var FZ=rt(),RZ=Lt();function OZ(n){try{return FZ(n)?Math.round(n):NaN}catch{return NaN}}HC.exports=RZ(OZ)});var XC=J((Vat,jC)=>{var PZ=rt(),MZ=Lt();function BZ(n){try{return PZ(n)?n<0?-1:n>0?1:0:NaN}catch{return NaN}}jC.exports=MZ(BZ)});var ZC=J((Gat,YC)=>{var LZ=rt(),zZ=Lt();function $Z(n){try{return LZ(n)?Math.sin(n):NaN}catch{return NaN}}YC.exports=zZ($Z)});var QC=J((Uat,JC)=>{var qZ=yp();function WZ(n){return qZ(n)}JC.exports=WZ});var tA=J((Hat,eA)=>{var VZ=rt(),GZ=Lt();function UZ(n){try{return VZ(n)?Math.tan(n):NaN}catch{return NaN}}eA.exports=GZ(UZ)});var _p=J((Kat,aA)=>{var nA=qe(),rA=Tr();function HZ(n,e){nA(rA(n),"`fn` must be a function!");let t=new Date;return e?n(...e):n(),new Date-t}async function KZ(n,e){nA(rA(n),"`fn` must be a function!");let t=new Date;return e?await n(...e):await n(),new Date-t}aA.exports={timeSync:HZ,timeAsync:KZ}});var oA=J((jat,iA)=>{var jZ=Ue(),XZ=ft(),YZ=ct(),ZZ=ei();function JZ(){return ZZ([...arguments].map(n=>jZ(n)?n:XZ(n)||YZ(n)?n.values:[n]))}iA.exports=JZ});var uA=J((Xat,sA)=>{var QZ=qe(),eJ=Ue(),tJ=ft(),nJ=ct(),rJ=yt(),aJ=Pu(),iJ=sa();function oJ(){let n=[],e=Object.values(arguments).map(t=>((tJ(t)||nJ(t))&&(t=t.values),QZ(eJ(t),"The `zip` function only works on arrays, Series, and DataFrames!"),t));return iJ(0,aJ(e.map(t=>t.length))).forEach(t=>{let r=[];e.forEach(a=>{let i=a[t];r.push(rJ(i)?void 0:i)}),n.push(r)}),n}sA.exports=oJ});var Ct=J((Yat,jg)=>{var{DataFrame:sJ,Series:uJ}=Dl(),Bu={abs:hp(),add:pp(),apply:Rl(),arccos:JT(),arcsin:eE(),arctan:nE(),argmax:aE(),argmin:uE(),assert:qe(),cast:Tg(),ceil:dE(),chop:gE(),clamp:bE(),combinations:xE(),copy:Qa(),correl:qE(),cos:VE(),count:bl(),covariance:_g(),DataFrame:sJ,dataTypes:UE(),decycle:Zm(),diff:ZE(),distance:fI(),divide:pI(),dot:Lg(),dropMissing:zg(),dropMissingPairwise:AI(),dropNaN:ig(),dropNaNPairwise:BI(),dropUndefined:zI(),exp:qI(),factorial:GI(),find:jI(),findAll:JI(),flatten:dn(),float:eC(),floor:nC(),identity:iC(),indexOf:gl(),inferType:cC(),int:fC(),intersect:pC(),inverse:gC(),isArray:Ue(),isBoolean:op(),isDataFrame:ft(),isEqual:Ti(),isFunction:Tr(),isJagged:wl(),isNested:Yh(),isNumber:rt(),isObject:vo(),isSeries:ct(),isString:Lr(),isUndefined:yt(),lerp:bC(),log:kC(),MathError:Au(),max:Pu(),mean:vp(),median:TC(),min:dp(),mod:CC(),mode:FC(),multiply:Og(),ndarray:mo(),normal:MC(),ones:LC(),permutations:$C(),pow:bp(),print:WC(),product:Tl(),random:Fu().random,range:sa(),remap:UC(),reshape:ap(),reverse:xl(),round:KC(),scale:Mu(),seed:Fu().seed,Series:uJ,set:ei(),shape:on(),shuffle:ip(),sign:XC(),sin:ZC(),sort:go(),sqrt:gp(),std:yp(),stdev:QC(),subtract:Pg(),sum:wp(),tan:tA(),time:_p().timeSync,timeSync:_p().timeSync,timeAsync:_p().timeAsync,transpose:cs(),union:oA(),variance:Dg(),vectorize:Lt(),zeros:Wg(),zip:uA(),dump:function(){let n=typeof global<"u"?global:window;if(!n)throw new Bu.MathError("Cannot dump functions into global scope because neither `global` nor `window` exist in the current context!");Object.keys(Bu).forEach(e=>{try{Object.defineProperty(n,e,{configurable:!1,enumerable:!0,writable:!1,value:Bu[e]})}catch{n[e]=Bu[e]}})}};typeof jg<"u"&&(jg.exports=Bu);typeof window<"u"&&(window.JSMathTools=Bu)});var cA=J(()=>{});var lA=J(()=>{});var Dp=J(()=>{});var Cs=J(A=>{"use strict";Object.defineProperty(A,"__esModule",{value:!0});function cJ(n,e){return e.forEach(function(t){Object.keys(t).forEach(function(r){if(r!=="default"&&!(r in n)){var a=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,a.get?a:{enumerable:!0,get:function(){return t[r]}})}})}),n}var t0=function(n,e){return t0=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])},t0(n,e)};function Zi(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");t0(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function je(n,e,t,r){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(r.next(l))}catch(f){o(f)}}function u(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((r=r.apply(n,e||[])).next())})}function Xe(n,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(l){c=[6,l],a=0}finally{r=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function cr(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ke(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=r.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return i}function wt(n,e,t){if(t||arguments.length===2)for(var r=0,a=e.length,i;r<a;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}var lJ=1e-7,fJ=1e-4,hJ=function(){function n(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return n.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},n.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},n.prototype.has=function(e){return this.data.has(e)},n.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},n.prototype.numDataIds=function(){return this.dataIdsCount},n}(),_A=function(){function n(){}return n.prototype.refCount=function(e){return $r("refCount")},n.prototype.incRef=function(e){return $r("incRef")},n.prototype.timerAvailable=function(){return!0},n.prototype.time=function(e){return $r("time")},n.prototype.read=function(e){return $r("read")},n.prototype.readSync=function(e){return $r("readSync")},n.prototype.readToGPU=function(e,t){return $r("readToGPU")},n.prototype.numDataIds=function(){return $r("numDataIds")},n.prototype.disposeData=function(e,t){return $r("disposeData")},n.prototype.write=function(e,t,r){return $r("write")},n.prototype.move=function(e,t,r,a,i){return $r("move")},n.prototype.createTensorFromGPUData=function(e,t,r){return $r("createTensorFromGPUData")},n.prototype.memory=function(){return $r("memory")},n.prototype.floatPrecision=function(){return $r("floatPrecision")},n.prototype.epsilon=function(){return this.floatPrecision()===32?lJ:fJ},n.prototype.dispose=function(){return $r("dispose")},n}();function $r(n){throw new Error("'".concat(n,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function DA(n){for(var e=n.length,t=0;e>0;)t=Math.random()*e|0,e--,Lp(n,e,t)}function pJ(n,e){if(n.length!==e.length)throw new Error("Array sizes must match to be shuffled together "+"First array length was ".concat(n.length)+"Second array length was ".concat(e.length));for(var t=n.length,r=0;t>0;)r=Math.random()*t|0,t--,Lp(n,t,r),Lp(e,t,r)}function $l(n,e,t){return Math.max(n,Math.min(e,t))}function dJ(n){return n%2===0?n:n+1}function Lp(n,e,t){var r=n[e];n[e]=n[t],n[t]=r}function vJ(n){for(var e=0,t=0;t<n.length;t++)e+=n[t];return e}function mJ(n,e){var t=Math.random();return e*t+(1-t)*n}function gJ(n,e){for(var t=0,r=0;r<n.length;r++){var a=Number(n[r])-Number(e[r]);t+=a*a}return t}function q(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function mr(n,e,t){t===void 0&&(t=""),q(Fo(n,e),function(){return t+" Shapes ".concat(n," and ").concat(e," must match")})}function Ss(n){q(n!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Ut(n){if(n.length===0)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function yJ(n){return n.length===0}function Fo(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Ku(n){return n%1===0}function bJ(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var e=Math.exp(2*n);return(e-1)/(e+1)}function wJ(n){var e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function xJ(n){for(var e=new Uint32Array(n),t=0;t<n;++t)e[t]=t;return DA(e),e}function Bl(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function kJ(n,e,t,r){return e===void 0&&(e=function(a){return 0}),new Promise(function(a,i){var o=0,s=function(){if(n()){a();return}o++;var u=e(o);if(t!=null&&o>=t){i();return}r!=null?r(s,u):setTimeout(s,u)};s()})}function SJ(n,e){for(var t=1,r=-1,a=0;a<n.length;++a)if(n[a]>=0)t*=n[a];else if(n[a]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. "+"Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(n[a]<0)throw Error("Shapes can not be < 0. Found ".concat(n[a]," at dim ").concat(a));if(r===-1){if(e>0&&e!==t)throw Error("Size(".concat(e,") must match the product of shape ").concat(n));return n}if(t===0)throw Error("Cannot infer the missing size in [".concat(n,"] when ")+"there are 0 elements");if(e%t!==0)throw Error("The implicit shape can't be a fractional number. "+"Got ".concat(e," / ").concat(t));var i=n.slice();return i[r]=e/t,i}function ef(n,e){var t=e.length;return n=n==null?e.map(function(r,a){return a}):[].concat(n),q(n.every(function(r){return r>=-t&&r<t}),function(){return"All values in axis param must be in range [-".concat(t,", ").concat(t,") but ")+"got axis ".concat(n)}),q(n.every(function(r){return Ku(r)}),function(){return"All values in axis param must be integers but "+"got axis ".concat(n)}),n.map(function(r){return r<0?t+r:r})}function FA(n,e){for(var t=[],r=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:ef(e,n).sort(),o=0,s=0;s<n.length;++s){if(i!=null){if(i[o]===s&&n[s]!==1)throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(n[s],"' is not 1"));(i[o]==null||i[o]>s)&&n[s]===1&&(t.push(n[s]),r.push(s)),i[o]<=s&&o++}n[s]!==1&&(t.push(n[s]),r.push(s))}return{newShape:t,keptDims:r}}function RA(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else throw new Error("Unknown data type ".concat(n));return t}function OA(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error("Unknown data type ".concat(n));return t}function PA(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(e," being uploaded contains ").concat(r,"."))}}function MA(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function NJ(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function zp(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype ".concat(n))}function BA(n){if(n==null)return 0;var e=0;return n.forEach(function(t){return e+=t.length}),e}function To(n){return typeof n=="string"||n instanceof String}function LA(n){return typeof n=="boolean"}function zA(n){return typeof n=="number"}function Jp(n){return Array.isArray(n)?Jp(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":zA(n)?"float32":To(n)?"string":LA(n)?"bool":"float32"}function Co(n){return!!(n&&n.constructor&&n.call&&n.apply)}function $p(n,e){for(var t=e;t<n;++t)if(n%t===0)return t;return n}function Ju(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function $A(n,e,t,r){r===void 0&&(r=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(r?2:1),o=0;o<i;o++)a[o]=t[n+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(l,f){return l*f})*(r?2:1),o=0;o<i;o++)a[o]=$A(n+o*u,s,t,r);return a}function qu(n,e,t){if(t===void 0&&(t=!1),n.length===0)return e[0];var r=n.reduce(function(a,i){return a*i})*(t?2:1);if(r===0)return[];if(r!==e.length)throw new Error("[".concat(n,"] does not match the input size ").concat(e.length).concat(t?" for a complex tensor":"","."));return $A(0,n,e,t)}function TJ(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error("Unknown dtype ".concat(e))}function E0(n,e){for(var t=Qp(n,e),r=0;r<t.length;r++)t[r]=1;return t}function Qp(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error("Unknown data type ".concat(e))}function EJ(n,e){var t=n.reduce(function(r,a){return r*a},1);if(e==null||e==="float32")return qu(n,new Float32Array(t));if(e==="int32")return qu(n,new Int32Array(t));if(e==="bool")return qu(n,new Uint8Array(t));throw new Error("Unknown data type ".concat(e))}function Vr(n){n.forEach(function(e){q(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(n,"].")})})}function IJ(n,e,t){if(e===0)return 0;if(e===1)return n[0];for(var r=n[n.length-1],a=0;a<n.length-1;++a)r+=t[a]*n[a];return r}function CJ(n,e,t){if(e===0)return[];if(e===1)return[n];for(var r=new Array(e),a=0;a<r.length-1;++a)r[a]=Math.floor(n/t[a]),n-=r[a]*t[a];return r[r.length-1]=n,r}function ed(n){return n&&n.then&&typeof n.then=="function"}var fA="tfjsflags",qA=function(){function n(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=AJ,this.populateURLFlags()}return n.prototype.setPlatform=function(e,t){this.platform!=null&&(vt().getBool("IS_TEST")||vt().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t},n.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){var a=this.urlFlags[e];vt().getBool("IS_TEST")||vt().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(a,".")),this.set(e,a)}},n.prototype.getAsync=function(e){return je(this,void 0,void 0,function(){var t,r;return Xe(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,r=e,[4,this.evaluateFlag(e)]);case 1:return t[r]=a.sent(),[2,this.flags[e]]}})})},n.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(ed(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},n.prototype.getNumber=function(e){return this.get(e)},n.prototype.getBool=function(e){return this.get(e)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!1,configurable:!0}),n.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},n.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()},n.prototype.setFlags=function(e){this.flags=Object.assign({},e)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if(fA in t){var r=t[fA].split(",");r.forEach(function(a){var i=ke(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=DJ(o,s)})}}},n}();function AJ(n){var e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];return _J(e,r[0],r[1]),r.join("=")}),e}function _J(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function DJ(n,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if("".concat(+e)===e)return+e;throw new Error("Could not parse value flag value ".concat(e," for flag ").concat(n,"."))}function vt(){return A.ENV}A.ENV=null;function FJ(n){A.ENV=n}var Xg;function WA(){if(Xg==null){var n=void 0;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");Xg=n}return Xg}function RJ(){var n=WA();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function I0(n,e){var t=RJ();if(t.has(n))return t.get(n);var r=e();return t.set(n,r),t.get(n)}var VA="Abs",GA="Acos",UA="Acosh",C0="Add",HA="AddN",KA="All",jA="Any",XA="ArgMax",YA="ArgMin",ZA="Asin",JA="Asinh",QA="Atan",e_="Atanh",t_="Atan2",n_="AvgPool",OJ="AvgPoolGrad",r_="AvgPool3D",PJ="AvgPool3DGrad",a_="BatchMatMul",i_="BatchToSpaceND",o_="Bincount",MJ="BroadcastTo",s_="BroadcastArgs",A0="Cast",u_="Ceil",c_="ClipByValue",l_="Complex",f_="ComplexAbs",h_="Concat",p_="Conv2D",d_="Conv2DBackpropFilter",v_="Conv2DBackpropInput",m_="Conv3D",BJ="Conv3DBackpropFilterV2",g_="Conv3DBackpropInputV2",y_="Cos",b_="Cosh",w_="Cumprod",x_="Cumsum",k_="CropAndResize",S_="DenseBincount",N_="DepthToSpace",T_="DepthwiseConv2dNative",E_="DepthwiseConv2dNativeBackpropFilter",I_="DepthwiseConv2dNativeBackpropInput",C_="Diag",A_="Dilation2D",LJ="Dilation2DBackpropInput",zJ="Dilation2DBackpropFilter",__="RealDiv",D_="Einsum",F_="Elu",$J="EluGrad",R_="Erf",O_="Equal",P_="Exp",M_="ExpandDims",B_="Expm1",L_="FFT",z_="Fill",$_="FlipLeftRight",q_="Floor",W_="FloorDiv",V_="FusedBatchNorm",G_="GatherV2",U_="GatherNd",H_="Greater",K_="GreaterEqual",_0="Identity",j_="IFFT",X_="Imag",Y_="IsFinite",Z_="IsInf",J_="IsNan",Q_="LeakyRelu",eD="Less",tD="LessEqual",nD="LinSpace",rD="Log",aD="Log1p",iD="LogicalAnd",oD="LogicalNot",sD="LogicalOr",qJ="LogicalXor",WJ="LogSoftmax",VJ="LowerBound",uD="LRN",GJ="LRNGrad",cD="Max",lD="Maximum",fD="MaxPool",UJ="MaxPoolGrad",hD="MaxPool3D",HJ="MaxPool3DGrad",pD="MaxPoolWithArgmax",dD="Mean",vD="Min",mD="Minimum",gD="MirrorPad",yD="Mod",bD="Multinomial",wD="Multiply",xD="Neg",kD="NotEqual",SD="NonMaxSuppressionV3",ND="NonMaxSuppressionV4",TD="NonMaxSuppressionV5",ED="OnesLike",ID="OneHot",CD="Pack",AD="PadV2",KJ="Pool",_D="Pow",DD="Prelu",FD="Prod",RD="RaggedGather",OD="RaggedRange",PD="RaggedTensorToTensor",MD="Range",BD="Real",LD="Reciprocal",zD="Relu",$D="Reshape",qD="ResizeNearestNeighbor",jJ="ResizeNearestNeighborGrad",WD="ResizeBilinear",XJ="ResizeBilinearGrad",VD="Relu6",GD="Reverse",UD="Round",HD="Rsqrt",KD="ScatterNd",jD="SearchSorted",XD="Select",YD="Selu",ZD="Slice",JD="Sin",QD="Sinh",e3="Sign",t3="Sigmoid",n3="Softplus",r3="Sqrt",a3="Sum",i3="SpaceToBatchND",o3="SplitV",s3="Softmax",u3="SparseFillEmptyRows",c3="SparseReshape",l3="SparseSegmentMean",f3="SparseSegmentSum",h3="SparseToDense",p3="SquaredDifference",YJ="Square",d3="StridedSlice",v3="StringNGrams",m3="StringSplit",g3="StringToHashBucketFast",y3="Sub",b3="Tan",w3="Tanh",D0="Tile",x3="TopK",k3="Transform",Op="Transpose",S3="Unique",N3="Unpack",T3="UnsortedSegmentSum",ZJ="UpperBound",E3="ZerosLike",I3="Step",n0="FromPixels",C3="RotateWithOffset",r0="_FusedMatMul",a0="FusedConv2D",i0="FusedDepthwiseConv2D";function No(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];vt().getBool("IS_TEST")||vt().getBool("PROD")||console.warn.apply(console,wt([],ke(n),!1))}function JJ(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];vt().getBool("IS_TEST")||vt().getBool("PROD")||console.log.apply(console,wt([],ke(n),!1))}var ju=I0("kernelRegistry",function(){return new Map}),ql=I0("gradRegistry",function(){return new Map});function qp(n,e){var t=F0(n,e);return ju.get(t)}function o0(n){return ql.get(n)}function Wp(n){for(var e=ju.entries(),t=[];;){var r=e.next(),a=r.done,i=r.value;if(a)break;var o=ke(i,2),s=o[0],u=o[1],c=ke(s.split("_"),1),l=c[0];l===n&&t.push(u)}return t}function A3(n){var e=n.kernelName,t=n.backendName,r=F0(e,t);ju.has(r)&&No("The kernel '".concat(e,"' for backend ")+"'".concat(t,"' is already registered")),ju.set(r,n)}function QJ(n){var e=n.kernelName;ql.has(e)&&vt().getBool("DEBUG")&&No("Overriding the gradient for '".concat(e,"'")),ql.set(e,n)}function eQ(n,e){var t=F0(n,e);if(!ju.has(t))throw new Error("The kernel '".concat(n,"' for backend ")+"'".concat(e,"' is not registered"));ju.delete(t)}function tQ(n){if(!ql.has(n))throw new Error("The gradient '".concat(n,"' for backend is not registered"));ql.delete(n)}function nQ(n,e){var t=Wp(n);t.forEach(function(r){var a=Object.assign({},r,{backendName:e});A3(a)})}function F0(n,e){return"".concat(e,"_").concat(n)}var s0=Ht,Ta=null;try{Ta=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Ht(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}Ht.prototype.__isLong__;Object.defineProperty(Ht.prototype,"__isLong__",{value:!0});function Gr(n){return(n&&n.__isLong__)===!0}Ht.isLong=Gr;var hA={},pA={};function Ns(n,e){var t,r,a;return e?(n>>>=0,(a=0<=n&&n<256)&&(r=pA[n],r)?r:(t=Kt(n,(n|0)<0?-1:0,!0),a&&(pA[n]=t),t)):(n|=0,(a=-128<=n&&n<128)&&(r=hA[n],r)?r:(t=Kt(n,n<0?-1:0,!1),a&&(hA[n]=t),t))}Ht.fromInt=Ns;function Ea(n,e){if(isNaN(n))return e?ds:Ia;if(e){if(n<0)return ds;if(n>=_3)return R3}else{if(n<=-vA)return qr;if(n+1>=vA)return F3}return n<0?Ea(-n,e).neg():Kt(n%Xu|0,n/Xu|0,e)}Ht.fromNumber=Ea;function Kt(n,e,t){return new Ht(n,e,t)}Ht.fromBits=Kt;var Vp=Math.pow;function R0(n,e,t){if(n.length===0)throw Error("empty string");if(n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return Ia;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var r;if((r=n.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return R0(n.substring(1),e,t).neg();for(var a=Ea(Vp(t,8)),i=Ia,o=0;o<n.length;o+=8){var s=Math.min(8,n.length-o),u=parseInt(n.substring(o,o+s),t);if(s<8){var c=Ea(Vp(t,s));i=i.mul(c).add(Ea(u))}else i=i.mul(a),i=i.add(Ea(u))}return i.unsigned=e,i}Ht.fromString=R0;function ai(n,e){return typeof n=="number"?Ea(n,e):typeof n=="string"?R0(n,e):Kt(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}Ht.fromValue=ai;var dA=1<<16,rQ=1<<24,Xu=dA*dA,_3=Xu*Xu,vA=_3/2,mA=Ns(rQ),Ia=Ns(0);Ht.ZERO=Ia;var ds=Ns(0,!0);Ht.UZERO=ds;var $u=Ns(1);Ht.ONE=$u;var D3=Ns(1,!0);Ht.UONE=D3;var u0=Ns(-1);Ht.NEG_ONE=u0;var F3=Kt(-1,2147483647,!1);Ht.MAX_VALUE=F3;var R3=Kt(-1,-1,!0);Ht.MAX_UNSIGNED_VALUE=R3;var qr=Kt(0,-2147483648,!1);Ht.MIN_VALUE=qr;var _e=Ht.prototype;_e.toInt=function(){return this.unsigned?this.low>>>0:this.low};_e.toNumber=function(){return this.unsigned?(this.high>>>0)*Xu+(this.low>>>0):this.high*Xu+(this.low>>>0)};_e.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(qr)){var t=Ea(e),r=this.div(t),a=r.mul(t).sub(this);return r.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Ea(Vp(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};_e.getHighBits=function(){return this.high};_e.getHighBitsUnsigned=function(){return this.high>>>0};_e.getLowBits=function(){return this.low};_e.getLowBitsUnsigned=function(){return this.low>>>0};_e.getNumBitsAbs=function(){if(this.isNegative())return this.eq(qr)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};_e.isZero=function(){return this.high===0&&this.low===0};_e.eqz=_e.isZero;_e.isNegative=function(){return!this.unsigned&&this.high<0};_e.isPositive=function(){return this.unsigned||this.high>=0};_e.isOdd=function(){return(this.low&1)===1};_e.isEven=function(){return(this.low&1)===0};_e.equals=function(e){return Gr(e)||(e=ai(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};_e.eq=_e.equals;_e.notEquals=function(e){return!this.eq(e)};_e.neq=_e.notEquals;_e.ne=_e.notEquals;_e.lessThan=function(e){return this.comp(e)<0};_e.lt=_e.lessThan;_e.lessThanOrEqual=function(e){return this.comp(e)<=0};_e.lte=_e.lessThanOrEqual;_e.le=_e.lessThanOrEqual;_e.greaterThan=function(e){return this.comp(e)>0};_e.gt=_e.greaterThan;_e.greaterThanOrEqual=function(e){return this.comp(e)>=0};_e.gte=_e.greaterThanOrEqual;_e.ge=_e.greaterThanOrEqual;_e.compare=function(e){if(Gr(e)||(e=ai(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};_e.comp=_e.compare;_e.negate=function(){return!this.unsigned&&this.eq(qr)?qr:this.not().add($u)};_e.neg=_e.negate;_e.add=function(e){Gr(e)||(e=ai(e));var t=this.high>>>16,r=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,p=0;return p+=i+c,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=r+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,Kt(h<<16|p,l<<16|f,this.unsigned)};_e.subtract=function(e){return Gr(e)||(e=ai(e)),this.add(e.neg())};_e.sub=_e.subtract;_e.multiply=function(e){if(this.isZero())return Ia;if(Gr(e)||(e=ai(e)),Ta){var t=Ta.mul(this.low,this.high,e.low,e.high);return Kt(t,Ta.get_high(),this.unsigned)}if(e.isZero())return Ia;if(this.eq(qr))return e.isOdd()?qr:Ia;if(e.eq(qr))return this.isOdd()?qr:Ia;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(mA)&&e.lt(mA))return Ea(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*l,p+=d>>>16,d&=65535,p+=i*l,h+=p>>>16,p&=65535,p+=o*c,h+=p>>>16,p&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=r*l+a*c+i*u+o*s,f&=65535,Kt(p<<16|d,f<<16|h,this.unsigned)};_e.mul=_e.multiply;_e.divide=function(e){if(Gr(e)||(e=ai(e)),e.isZero())throw Error("division by zero");if(Ta){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Ta.div_u:Ta.div_s)(this.low,this.high,e.low,e.high);return Kt(t,Ta.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?ds:Ia;var r,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return ds;if(e.gt(this.shru(1)))return D3;i=ds}else{if(this.eq(qr)){if(e.eq($u)||e.eq(u0))return qr;if(e.eq(qr))return $u;var o=this.shr(1);return r=o.div(e).shl(1),r.eq(Ia)?e.isNegative()?$u:u0:(a=this.sub(e.mul(r)),i=r.add(a.div(e)),i)}else if(e.eq(qr))return this.unsigned?ds:Ia;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Ia}for(a=this;a.gte(e);){r=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(r)/Math.LN2),u=s<=48?1:Vp(2,s-48),c=Ea(r),l=c.mul(e);l.isNegative()||l.gt(a);)r-=u,c=Ea(r,this.unsigned),l=c.mul(e);c.isZero()&&(c=$u),i=i.add(c),a=a.sub(l)}return i};_e.div=_e.divide;_e.modulo=function(e){if(Gr(e)||(e=ai(e)),Ta){var t=(this.unsigned?Ta.rem_u:Ta.rem_s)(this.low,this.high,e.low,e.high);return Kt(t,Ta.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};_e.mod=_e.modulo;_e.rem=_e.modulo;_e.not=function(){return Kt(~this.low,~this.high,this.unsigned)};_e.and=function(e){return Gr(e)||(e=ai(e)),Kt(this.low&e.low,this.high&e.high,this.unsigned)};_e.or=function(e){return Gr(e)||(e=ai(e)),Kt(this.low|e.low,this.high|e.high,this.unsigned)};_e.xor=function(e){return Gr(e)||(e=ai(e)),Kt(this.low^e.low,this.high^e.high,this.unsigned)};_e.shiftLeft=function(e){return Gr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Kt(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Kt(0,this.low<<e-32,this.unsigned)};_e.shl=_e.shiftLeft;_e.shiftRight=function(e){return Gr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Kt(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Kt(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};_e.shr=_e.shiftRight;_e.shiftRightUnsigned=function(e){if(Gr(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var r=this.low;return Kt(r>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?Kt(t,0,this.unsigned):Kt(t>>>e-32,0,this.unsigned)};_e.shru=_e.shiftRightUnsigned;_e.shr_u=_e.shiftRightUnsigned;_e.toSigned=function(){return this.unsigned?Kt(this.low,this.high,!1):this};_e.toUnsigned=function(){return this.unsigned?this:Kt(this.low,this.high,!0)};_e.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};_e.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};_e.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};Ht.fromBytes=function(e,t,r){return r?Ht.fromBytesLE(e,t):Ht.fromBytesBE(e,t)};Ht.fromBytesLE=function(e,t){return new Ht(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};Ht.fromBytesBE=function(e,t){return new Ht(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var aQ=cJ({__proto__:null,default:s0},[s0]),ps=s0||aQ;function tf(n){return ps.fromString(n,!0,16)}var O3=tf("c3a5c85c97cb3127"),fs=tf("b492b66fbe98f273"),vr=tf("9ae16a3b2f90404f");function c0(n){return n.xor(n.shru(47))}function P3(n,e,t){var r=n.slice(e,e+t);return ps.fromBytes(Array.from(r),!0,!0)}function $t(n,e){return P3(n,e,8)}function gA(n,e){return P3(n,e,4)}function Hn(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function Io(n,e,t){t===void 0&&(t=tf("9ddfea08eb382d69"));var r=n.xor(e).mul(t);r=r.xor(r.shru(47));var a=e.xor(r).mul(t);return a=a.xor(a.shru(47)),a=a.mul(t),a}function iQ(n,e,t,r,a,i){a=a.add(n),i=Hn(i.add(a).add(r),21);var o=a;return a=a.add(e),a=a.add(t),i=i.add(Hn(a,44)),[a.add(r),i.add(o)]}function Fp(n,e,t,r){return iQ($t(n,e),$t(n,e+8),$t(n,e+16),$t(n,e+24),t,r)}function oQ(n,e){if(e===void 0&&(e=n.length),e>=8){var t=vr.add(e*2),r=$t(n,0).add(vr),a=$t(n,e-8),i=Hn(a,37).mul(t).add(r),o=Hn(r,25).add(a).mul(t);return Io(i,o,t)}if(e>=4){var t=vr.add(e*2),r=gA(n,0);return Io(r.shl(3).add(e),gA(n,e-4),t)}if(e>0){var r=n[0],a=n[e>>1],i=n[e-1],s=r+(a<<8),u=e+(i<<2);return c0(vr.mul(s).xor(O3.mul(u))).mul(vr)}return vr}function sQ(n,e){e===void 0&&(e=n.length);var t=vr.add(e*2),r=$t(n,0).mul(fs),a=$t(n,8),i=$t(n,e-8).mul(t),o=$t(n,e-16).mul(vr);return Io(Hn(r.add(a),43).add(Hn(i,30)).add(o),r.add(Hn(a.add(vr),18)).add(i),t)}function uQ(n,e){e===void 0&&(e=n.length);var t=vr.add(e*2),r=$t(n,0).mul(vr),a=$t(n,8),i=$t(n,e-8).mul(t),o=$t(n,e-16).mul(vr),s=Hn(r.add(a),43).add(Hn(i,30)).add(o),u=Io(s,r.add(Hn(a.add(vr),18)).add(i),t),c=$t(n,16).mul(t),l=$t(n,24),f=s.add($t(n,e-32)).mul(t),h=u.add($t(n,e-24)).mul(t);return Io(Hn(c.add(l),43).add(Hn(f,30)).add(h),c.add(Hn(l.add(r),18)).add(f),t)}function cQ(n,e){var t,r;e===void 0&&(e=n.length);var a=ps.fromNumber(81,!0);if(e<=32)return e<=16?oQ(n,e):sQ(n,e);if(e<=64)return uQ(n,e);var i=a,o=a.mul(fs).add(113),s=c0(o.mul(vr).add(113)).mul(vr),u=[ps.UZERO,ps.UZERO],c=[ps.UZERO,ps.UZERO];i=i.mul(vr).add($t(n,0));var l=0,f=(e-1>>6)*64,h=f+(e-1&63)-63;do i=Hn(i.add(o).add(u[0]).add($t(n,l+8)),37).mul(fs),o=Hn(o.add(u[1]).add($t(n,l+48)),42).mul(fs),i=i.xor(c[1]),o=o.add(u[0]).add($t(n,l+40)),s=Hn(s.add(c[0]),33).mul(fs),u=Fp(n,l,u[1].mul(fs),i.add(c[0])),c=Fp(n,l+32,s.add(c[1]),o.add($t(n,l+16))),t=ke([i,s],2),s=t[0],i=t[1],l+=64;while(l!==f);var p=fs.add(s.and(255).shl(1));return l=h,c[0]=c[0].add(e-1&63),u[0]=u[0].add(c[0]),c[0]=c[0].add(u[0]),i=Hn(i.add(o).add(u[0]).add($t(n,l+8)),37).mul(p),o=Hn(o.add(u[1]).add($t(n,l+48)),42).mul(p),i=i.xor(c[1].mul(9)),o=o.add(u[0].mul(9).add($t(n,l+40))),s=Hn(s.add(c[0]),33).mul(p),u=Fp(n,l,u[1].mul(p),i.add(c[0])),c=Fp(n,l+32,s.add(c[1]),o.add($t(n,l+16))),r=ke([i,s],2),s=r[0],i=r[1],Io(Io(u[0],c[0],p).add(c0(o).mul(O3)).add(s),Io(u[1],c[1],p).add(i),p)}function lQ(n,e){return e==="string"?nf(n):td([n],e)}function fQ(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function td(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Ao(n)),vt().getBool("DEBUG")&&PA(n,e),fQ(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){for(var t=new Uint8Array(n.length),r=0;r<t.length;++r)Math.round(n[r])!==0&&(t[r]=1);return t}else throw new Error("Unknown data type ".concat(e))}function Wl(){return vt().platform.now()}function hQ(n,e){return vt().platform.fetch(n,e)}function nf(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",vt().platform.encode(n,e)}function Gp(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",vt().platform.decode(n,e)}function er(n){return vt().platform.isTypedArray(n)}function Ao(n,e,t){var r,a;if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||ed(n)||n==null||er(n)&&t)e.push(n);else if(Array.isArray(n)||er(n))for(var i=0;i<n.length;++i)Ao(n[i],e,t);else{var o=-1;try{for(var s=cr(Object.keys(n)),u=s.next();!u.done;u=s.next()){var c=u.value;/^([1-9]+[0-9]*|0)$/.test(c)&&(o=Math.max(o,Number(c)))}}catch(l){r={error:l}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}for(var i=0;i<=o;i++)Ao(n[i],e,t)}return e}var pQ={__proto__:null,createScalarValue:lQ,toTypedArray:td,now:Wl,fetch:hQ,encodeString:nf,decodeString:Gp,isTypedArray:er,flatten:Ao,shuffle:DA,shuffleCombo:pJ,clamp:$l,nearestLargerEven:dJ,swap:Lp,sum:vJ,randUniform:mJ,distSquared:gJ,assert:q,assertShapesMatch:mr,assertNonNull:Ss,sizeFromShape:Ut,isScalarShape:yJ,arraysEqual:Fo,isInt:Ku,tanh:bJ,sizeToSquarishShape:wJ,createShuffledIndices:xJ,rightPad:Bl,repeatedTry:kJ,inferFromImplicitShape:SJ,parseAxisParam:ef,squeezeShape:FA,getTypedArrayFromDType:RA,getArrayFromDType:OA,checkConversionForErrors:PA,isValidDtype:MA,hasEncodingLoss:NJ,bytesPerElement:zp,bytesFromStringArray:BA,isString:To,isBoolean:LA,isNumber:zA,inferDtype:Jp,isFunction:Co,nearestDivisor:$p,computeStrides:Ju,toNestedArray:qu,convertBackendValuesAndArrayBuffer:TJ,makeOnesTypedArray:E0,makeZerosTypedArray:Qp,makeZerosNestedTypedArray:EJ,assertNonNegativeIntegerDimensions:Vr,locToIndex:IJ,indexToLoc:CJ,isPromise:ed,hexToLong:tf,fingerPrint64:cQ},dQ=function(){function n(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new mQ)}return n.prototype.profileKernel=function(e,t,r){var a,i,o,s=function(){o=r()},u,c=Wl();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var l=cr(o),f=l.next();!f.done;f=l.next()){var h=f.value;h.dataSync()}}catch(m){a={error:m}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:Wl()-c})}if(vt().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var p=function(m){var g=o[m];g.data().then(function(y){vQ(y,g.dtype,e)})},d=0;d<o.length;d++)p(d);var v={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(m){return m.kernelMs}),extraInfo:u.then(function(m){return m.getExtraProfileInfo!=null?m.getExtraProfileInfo():""})};return v},n.prototype.logKernelProfile=function(e){var t=this,r=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(c){t.logger.logKernelProfile(r,u,c[0],c[1],o,c[2])})})},n}();function vQ(n,e,t){if(e!=="float32")return!1;for(var r=0;r<n.length;r++){var a=n[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(t,"'")),!0}return!1}var mQ=function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,a,i,o){var s=typeof a=="number"?Bl("".concat(a,"ms"),9):a.error,u=Bl(e,25),c=t.rank,l=t.size,f=Bl(t.shape.toString(),14),h="";for(var p in i){var d=i[p];if(d!=null){var v=d.shape||t.shape,m=v.length;h+="".concat(p,": ").concat(m,"D ").concat(m>0?v:""," ")}}console.log("%c".concat(u,"	%c").concat(s,"	%c").concat(c,"D ").concat(f,"	%c").concat(l,"	%c").concat(h,"	%c").concat(o),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n}();function gQ(n,e,t){for(var r={},a={},i=0;i<e.length;i++)r[e[i].id]=!0;for(var i=0;i<n.length;i++){var o=n[i],s=o.inputs;for(var u in s){for(var c=s[u],l=!1,f=0;f<e.length;f++)if(r[c.id]){o.outputs.forEach(function(b){return r[b.id]=!0}),l=!0,a[o.id]=!0;break}if(l)break}}var h={};h[t.id]=!0;for(var p={},i=n.length-1;i>=0;i--)for(var o=n[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,p[o.id]=!0;break}for(var d=[],i=0;i<n.length;i++){var o=n[i];if(a[o.id]&&p[o.id]){var v={};for(var u in o.inputs){var m=o.inputs[u];r[m.id]&&(v[u]=m)}var g=Object.assign({},o);g.inputs=v,g.outputs=o.outputs,d.push(g)}}return d}function yQ(n,e,t,r){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var p=n[h.id];p!=null?u.push(p):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(s.kernelName,"."));var c=s.gradient(u),l=function(h){if(!(h in c))throw new Error("Cannot backprop through input ".concat(h,". ")+"Available gradients found: ".concat(Object.keys(c),"."));var p=t(function(){return c[h]()});if(p.dtype!=="float32")throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"".concat(h," must have 'float32' dtype, but has '").concat(p.dtype,"'"));var d=s.inputs[h];if(!Fo(p.shape,d.shape))throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"'".concat(h,"' has shape '").concat(p.shape,"', which does not match ")+"the shape of the input '".concat(d.shape,"'"));if(n[d.id]==null)n[d.id]=p;else{var v=n[d.id];n[d.id]=r(v,p),v.dispose()}};for(var f in s.inputs)l(f)},i=e.length-1;i>=0;i--)a(i)}var yA=20,Ol=3,Yg=7;function bQ(n,e,t,r){var a=Ju(e),i=wQ(n,e,t,a),o=e.length,s=Pp(n,e,t,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(t)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(e,"]")),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function wQ(n,e,t,r){var a=Ut(e),i=r[r.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?Ml(n):n;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,f=0;f<i;f++)o[f]=Math.max(o[f],Pl(u[l+f],0,t).length);return o}function Pl(n,e,t){var r;return Array.isArray(n)?r="".concat(parseFloat(n[0].toFixed(Yg))," + ")+"".concat(parseFloat(n[1].toFixed(Yg)),"j"):To(n)?r="'".concat(n,"'"):t==="bool"?r=M3(n):r=parseFloat(n.toFixed(Yg)).toString(),Bl(r,e)}function M3(n){return n===0?"false":"true"}function Pp(n,e,t,r,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var c=Ml(n);return[Pl(c[0],0,t)]}return t==="bool"?[M3(n[0])]:[n[0].toString()]}if(u===1){if(s>yA){var l=Ol*o,f=Array.from(n.slice(0,l)),h=Array.from(n.slice((s-Ol)*o,s*o));return t==="complex64"&&(f=Ml(f),h=Ml(h)),["["+f.map(function(T,E){return Pl(T,a[E],t)}).join(", ")+", ..., "+h.map(function(T,E){return Pl(T,a[s-Ol+E],t)}).join(", ")+"]"]}var p=t==="complex64"?Ml(n):Array.from(n);return["["+p.map(function(T,E){return Pl(T,a[E],t)}).join(", ")+"]"]}var d=e.slice(1),v=r.slice(1),m=r[0]*o,g=[];if(s>yA){for(var y=0;y<Ol;y++){var b=y*m,w=b+m;g.push.apply(g,wt([],ke(Pp(n.slice(b,w),d,t,v,a,!1)),!1))}g.push("...");for(var y=s-Ol;y<s;y++){var b=y*m,w=b+m;g.push.apply(g,wt([],ke(Pp(n.slice(b,w),d,t,v,a,y===s-1)),!1))}}else for(var y=0;y<s;y++){var b=y*m,w=b+m;g.push.apply(g,wt([],ke(Pp(n.slice(b,w),d,t,v,a,y===s-1)),!1))}var x=u===2?",":"";g[0]="["+(s>0?g[0]+x:"");for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+x;for(var N=`,
`,y=2;y<u;y++)N+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":N),g}function Ml(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var Up=function(){function n(e,t,r){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=Ut(e),r!=null){var i=r.length;q(i===this.size,function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||OA(t,this.size),this.strides=Ju(e)}return n.prototype.set=function(e){for(var t=this,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];r.length===0&&(r=[0]),q(r.length===this.rank,function(){return"The number of provided coordinates (".concat(r.length,") must ")+"match the rank (".concat(t.rank,")")});var i=this.locToIndex(r);this.values[i]=e},n.prototype.get=function(){for(var e,t,r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];r.length===0&&(r=[0]);var i=0;try{for(var o=cr(r),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var c="Requested out of range element at ".concat(r,". ")+"  Buffer shape=".concat(this.shape);throw new Error(c)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var l=r[r.length-1],f=0;f<r.length-1;++f)l+=this.strides[f]*r[f];return this.values[l]},n.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),n.prototype.toTensor=function(){return ti().makeTensor(this.values,this.shape,this.dtype)},n}(),ti=null,Lu=null;function xQ(n){ti=n}function kQ(n){Lu=n}var Pn=function(){function n(e,t,r,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Ut(e),this.strides=Ju(e),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),n.prototype.buffer=function(){return je(this,void 0,void 0,function(){var e;return Xe(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Lu.buffer(this.shape,this.dtype,e)]}})})},n.prototype.bufferSync=function(){return Lu.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return je(this,void 0,void 0,function(){var e;return Xe(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,qu(this.shape,e,this.dtype==="complex64")]}})})},n.prototype.arraySync=function(){return qu(this.shape,this.dataSync(),this.dtype==="complex64")},n.prototype.data=function(){return je(this,void 0,void 0,function(){var e,t;return Xe(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=ti().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=r.sent();try{return[2,t.map(function(a){return Gp(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}})})},n.prototype.dataToGPU=function(e){return this.throwIfDisposed(),ti().readToGPU(this.dataId,e)},n.prototype.dataSync=function(){this.throwIfDisposed();var e=ti().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return Gp(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},n.prototype.bytes=function(){return je(this,void 0,void 0,function(){var e;return Xe(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,ti().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},n.prototype.dispose=function(){this.isDisposed||(ti().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!1,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.print=function(e){return e===void 0&&(e=!1),Lu.print(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),Lu.clone(this)},n.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return bQ(t,this.shape,this.dtype,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),Lu.cast(this,e)},n.prototype.variable=function(e,t,r){return e===void 0&&(e=!0),this.throwIfDisposed(),ti().makeVariable(this,e,t,r)},n}();Object.defineProperty(Pn,Symbol.hasInstance,{value:function(n){return!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null}});function SQ(){return I0("Tensor",function(){return Pn})}SQ();var Vl=function(n){Zi(e,n);function e(t,r,a,i){var o=n.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=r,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(t.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!Fo(t.shape,this.shape))throw new Error("shape of the new value (".concat(t.shape,") and ")+"previous value (".concat(this.shape,") must match"));ti().disposeTensor(this),this.dataId=t.dataId,ti().incRef(this,null)},e.prototype.dispose=function(){ti().disposeVariable(this),this.isDisposedInternal=!0},e}(Pn);Object.defineProperty(Vl,Symbol.hasInstance,{value:function(n){return n instanceof Pn&&n.assign!=null&&n.assign instanceof Function}});A.Rank=void 0;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(A.Rank||(A.Rank={}));var l0;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(l0||(l0={}));var f0;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(f0||(f0={}));var h0;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(h0||(h0={}));var p0;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(p0||(p0={}));var NQ={float32:h0,int32:l0,bool:f0,complex64:p0};function nd(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error("Can not upcast ".concat(n," with ").concat(e))}return NQ[n][e]}function TQ(n){return nd(n,"int32")}function vn(n,e){if(n.dtype===e.dtype)return[n,e];var t=nd(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function B3(n,e){q(n.dtype===e.dtype,function(){return"The dtypes of the first(".concat(n.dtype,") and")+" second(".concat(e.dtype,") input must match")})}function EQ(n,e){return e.some(function(t){return t.id===n.id})}function O0(n){var e=[],t=new Set;return L3(n,e,t),e}function L3(n,e,t){if(n!=null){if(n instanceof Pn){e.push(n);return}if(!!IQ(n)){var r=n;for(var a in r){var i=r[a];t.has(i)||(t.add(i),L3(i,e,t))}}}}function IQ(n){return Array.isArray(n)||typeof n=="object"}var CQ={__proto__:null,makeTypesMatch:vn,assertTypesMatch:B3,isTensorInList:EQ,getTensorsInContainer:O0};function Zg(n){return n.kernelName!=null}var bA=function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return n.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},n}(),P0=function(){function n(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new bA}return n.prototype.ready=function(){return je(this,void 0,void 0,function(){var e,t,r,a;return Xe(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(r=e[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(n.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,r=e.asyncInit;if(r)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!1,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},n.prototype.registerBackend=function(e,t,r){return r===void 0&&(r=1),e in this.registryFactory?(No("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},n.prototype.setBackend=function(e){return je(this,void 0,void 0,function(){var t,r,a,i,o;return Xe(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '".concat(e,"' not found in registry"));return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,a=t.asyncInit,a?[4,r]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=r,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new dQ(this.backendInstance),[2,!0]}})})},n.prototype.setupRegisteredKernels=function(){var e=this,t=Wp(this.backendName);t.forEach(function(r){r.setupFunc!=null&&r.setupFunc(e.backendInstance)})},n.prototype.disposeRegisteredKernels=function(e){var t=this,r=Wp(e);r.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},n.prototype.initializeBackend=function(e){var t=this,r=this.registryFactory[e];if(r==null)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var a=r.factory();if(a&&!(a instanceof _A)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,No("Initialization of backend ".concat(e," failed")),No(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return No("Initialization of backend ".concat(e," failed")),No(s.stack||s.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority})},n.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],a=this.initializeBackend(r),i=a.success,o=a.asyncInit;if(o||i)return{name:r,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(e,t){var r=this.state.tensorInfo.get(t),a=r.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),r.backend=e,e.move(t,i,r.shape,r.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(e,t){var r=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return r.startScope(a)},function(){return r.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},n.prototype.scopedRun=function(e,t,r){e();try{var a=r();return t(),a}catch(i){throw t(),i}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=U.runKernel(_0,{x:e}),r={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},c={dtype:s};return U.runKernel(A0,u,c)}}},i=[];return this.addTapeNode(this.state.activeScope.name,r,[t],a,i,{}),t},n.prototype.runKernel=function(e,t,r){this.backendName==null&&this.backend;var a=qp(e,this.backendName)!=null;if(!a)throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:r})},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(e,t,r){var a=this.backend.numDataIds(),i=0;r.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(s," data ids) after running '").concat(e,"'"))},n.prototype.runKernelFunc=function(e){var t=this,r,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var c,l=Zg(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Zg(e)){var f=e.kernelName,h=e.inputs,p=e.attrs;this.backendName==null&&this.backend;var d=qp(f,this.backendName);q(d!=null,function(){return"Cannot find registered kernel '".concat(f,"' for backend '").concat(t.backendName,"'")}),u=function(){var x=t.backend.numDataIds();c=d.kernelFunc({inputs:h,attrs:p,backend:t.backend});var N=Array.isArray(c)?c:[c];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,x,N);var T=N.map(function(C){return C.rank!=null?C:t.makeTensorFromTensorInfo(C)});if(i){var E=t.getTensorsForGradient(f,h,T);a=t.saveTensorsForBackwardMode(E)}return T}}else{var v=e.forwardFunc,m=function(x){!i||(a=x.map(function(N){return t.keep(t.clone(N))}))};u=function(){var x=t.backend.numDataIds();c=t.tidy(function(){return v(t.backend,m)});var N=Array.isArray(c)?c:[c];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(l,x,N),N}}var g=e.inputs,y=e.attrs,b=Zg(e)?null:e.backwardsFunc,w;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?r=u():(w=t.profiler.profileKernel(l,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(w),r=w.outputs)}),i&&this.addTapeNode(l,g,r,b,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(x){return g[x]!=null?g[x].shape:null}),outputShapes:r.map(function(x){return x.shape}),kernelTimeMs:w.timeMs,extraInfo:w.extraInfo}),Array.isArray(c)?r:r[0]},n.prototype.saveTensorsForBackwardMode=function(e){var t=this,r=e.map(function(a){return t.keep(t.clone(a))});return r},n.prototype.getTensorsForGradient=function(e,t,r){var a=o0(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(q(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(c){return t[c]})):s=i.map(function(c){return t[c]});var u=r.filter(function(c,l){return o[l]});return s.concat(u)}return[]},n.prototype.makeTensor=function(e,t,r,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",a=a||this.backend;var i=e;r==="string"&&To(e[0])&&(i=e.map(function(l){return nf(l)}));var o=a.write(i,t,r),s=new Pn(t,r,o,this.nextTensorId());if(this.trackTensor(s,a),r==="string"){var u=this.state.tensorInfo.get(o),c=BA(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},n.prototype.makeTensorFromDataId=function(e,t,r,a){r=r||"float32";var i={dataId:e,shape:t,dtype:r};return this.makeTensorFromTensorInfo(i,a)},n.prototype.makeTensorFromTensorInfo=function(e,t){var r=e.dataId,a=e.shape,i=e.dtype,o=new Pn(a,i,r,this.nextTensorId());return this.trackTensor(o,t),o},n.prototype.makeVariable=function(e,t,r,a){t===void 0&&(t=!0),r=r||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new Vl(e,t,r,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name ".concat(i.name," was already registered"));return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},n.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var r=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(r=e.size*zp(e.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r})),e instanceof Vl||this.track(e)},n.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},n.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},n.prototype.disposeTensor=function(e){if(!!this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var r=e.size*zp(e.dtype);this.state.numBytes-=r}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},n.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},n.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return je(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f,h;return Xe(this,function(p){switch(p.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=p.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,wt([],ke(this.state.activeProfile.kernels.map(function(d){return d.totalBytesSnapshot})),!1)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,p.label=2;case 2:p.trys.push([2,8,9,10]),i=cr(this.state.activeProfile.kernels),o=i.next(),p.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=p.sent(),c=s,[4,s.extraInfo];case 5:c.extraInfo=p.sent(),p.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return l=p.sent(),f={error:l},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},n.prototype.addTapeNode=function(e,t,r,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:i},c=o0(e);c!=null&&(a=c.gradFunc),a!=null&&(u.gradient=function(l){return l=l.map(function(f,h){if(f==null){var p=r[h],d=Qp(p.size,p.dtype);return s.makeTensor(d,p.shape,p.dtype)}return f}),a(l.length>1?l:l[0],i,o)}),this.state.activeTape.push(u)},n.prototype.keep=function(e){return e.kept=!0,e},n.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=O0(e),a=new Set(r.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},n.prototype.gradients=function(e,t,r,a){var i=this;if(a===void 0&&(a=!1),q(t.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '".concat(r.dtype,"'"));var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});q(o instanceof Pn,function(){return"The result y returned by f() must be a tensor."});var s=gQ(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=r??AQ(o.shape),yQ(u,s,function(l){return i.tidy(l)},_Q);var c=t.map(function(l){return u[l.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(l){var f,h;try{for(var p=cr(l.saved),d=p.next();!d.done;d=p.next()){var v=d.value;v.dispose()}}catch(m){f={error:m}}finally{try{d&&!d.done&&(h=p.return)&&h.call(p)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:c}})},n.prototype.customGrad=function(e){var t=this;return q(Co(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];q(r.every(function(c){return c instanceof Pn}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};r.forEach(function(c,l){o[l]=c});var s=function(c,l){return i=e.apply(void 0,wt([],ke(wt(wt([],ke(r),!1),[l],!1)),!1)),q(i.value instanceof Pn,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),q(Co(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(c,l){var f=i.gradFunc(c,l),h=Array.isArray(f)?f:[f];q(h.length===r.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),q(h.every(function(d){return d instanceof Pn}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return h.forEach(function(d,v){p[v]=function(){return d}}),p};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},n.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},n.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},n.prototype.readToGPU=function(e,t){var r=this.state.tensorInfo.get(e);return r.backend.readToGPU(e,t)},n.prototype.time=function(e){return je(this,void 0,void 0,function(){var t,r;return Xe(this,function(a){switch(a.label){case 0:return t=Wl(),[4,this.backend.time(e)];case 1:return r=a.sent(),r.wallMs=Wl()-t,[2,r]}})})},n.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!1,configurable:!0}),n.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new bA;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n}();P0.nextTensorId=0;P0.nextVariableId=0;function AQ(n){var e=E0(Ut(n),"float32");return U.makeTensor(e,n,"float32")}function z3(){var n=WA();if(n._tfengine==null){var e=new qA(n);n._tfengine=new P0(e)}return FJ(n._tfengine.ENV),xQ(function(){return n._tfengine}),n._tfengine}var U=z3();function _Q(n,e){var t={a:n,b:e};return U.runKernel(C0,t)}function DQ(){return typeof navigator<"u"&&navigator!=null}var d0;function FQ(n){d0=n}function RQ(n){if(d0!==void 0)return d0;if(n||DQ()){if(n||(n=navigator),n.product==="ReactNative")return!0;var e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){var t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function $3(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var OQ={__proto__:null,mockIsMobile:FQ,isMobile:RQ,isBrowser:$3};var la=vt();la.registerFlag("DEBUG",function(){return!1},function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});la.registerFlag("IS_BROWSER",function(){return $3()});la.registerFlag("IS_NODE",function(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"});la.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)});la.registerFlag("PROD",function(){return!1});la.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return la.getBool("DEBUG")});la.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0});la.registerFlag("IS_TEST",function(){return!1});la.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",function(){return!0});la.registerFlag("WRAP_TO_IMAGEBITMAP",function(){return!1});la.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",function(){return!1});la.registerFlag("USE_SETTIMEOUTCUSTOM",function(){return!1});function Ci(n,e){var t=n;if(er(n))return e==="string"?[]:[n.length];var r=typeof n=="object";if(r){if("texture"in n){var a=n.channels||"RGBA";return[n.height,n.width*a.length]}else if("buffer"in n&&!(n.buffer instanceof ArrayBuffer))return[n.buffer.size/(e==null?4:zp(e))]}if(!Array.isArray(n))return[];for(var i=[];Array.isArray(t)||er(t)&&e!=="string";)i.push(t.length),t=t[0];return Array.isArray(n)&&vt().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&q3(n,i,[]),i}function q3(n,e,t){if(t=t||[],!Array.isArray(n)&&!er(n)){q(e.length===0,function(){return"Element arr[".concat(t.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(e[0]," elements")});return}q(e.length>0,function(){return"Element arr[".concat(t.join("]["),"] should be a primitive, ")+"but is an array of ".concat(n.length," elements")}),q(n.length===e[0],function(){return"Element arr[".concat(t.join("]["),"] should have ").concat(e[0]," ")+"elements, but has ".concat(n.length," elements")});for(var r=e.slice(1),a=0;a<n.length;++a)q3(n[a],r,t.concat(a))}function wA(n,e,t,r){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error("Argument '".concat(t,"' passed to '").concat(r,"' must ")+"be ".concat(n," tensor, but got ").concat(e," tensor"))}}function P(n,e,t,r){if(r===void 0&&(r="numeric"),n instanceof Pn)return wA(r,n.dtype,e,t),n;var a=Jp(n);if(a!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),wA(r,a,e,t),n==null||!er(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var i=n==null?"null":n.constructor.name;throw new Error("Argument '".concat(e,"' passed to '").concat(t,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=Ci(n,a);!er(n)&&!Array.isArray(n)&&(n=[n]);var s=!0,u=a!=="string"?td(n,a):Ao(n,[],s);return U.makeTensor(u,o,a)}function Gl(n,e,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument ".concat(e," passed to ").concat(t," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=n;return a.map(function(i,o){return P(i,"".concat(e,"[").concat(o,"]"),t,r)})}var W3="__op";function H(n){var e=Object.keys(n);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(e.length," keys."));var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+W3;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];U.startScope(t);try{var s=r.apply(void 0,wt([],ke(i),!1));return ed(s)&&console.error("Cannot return a Promise inside of tidy."),U.endScope(s),s}catch(u){throw U.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function PQ(n,e){var t=P(n,"real","complex"),r=P(e,"imag","complex");mr(t.shape,r.shape,"real and imag shapes, ".concat(t.shape," and ").concat(r.shape,", ")+"must match in call to tf.complex().");var a={real:t,imag:r};return U.runKernel(l_,a)}var _o=H({complex_:PQ});function Ro(n,e,t,r){if(r==null)r=Jp(n);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(typeof n=="object"&&("texture"in n||"buffer"in n&&!(n.buffer instanceof ArrayBuffer))){if(r!=="float32"&&r!=="int32")throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(r,"."));return U.backend.createTensorFromGPUData(n,e||t,r)}if(!er(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Vr(e);var a=Ut(e),i=Ut(t);q(a===i,function(){return"Based on the provided shape, [".concat(e,"], the tensor should have ")+"".concat(a," values but has ").concat(i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==Ut(e.slice(o)):!0;q(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(t,") does not match the provided ")+"shape (".concat(e,"). ")})}}return!er(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=r!=="string"?td(n,r):Ao(n,[],!0),U.makeTensor(n,e,r)}function Wu(n,e,t){var r=Ci(n,t);return Ro(n,e,r,t)}var v0={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8},Hp=4;function MQ(n,e){return je(this,void 0,void 0,function(){var t,r,a,i,o,s,u=this;return Xe(this,function(c){switch(c.label){case 0:for(t=[],r=[],a=Array.isArray(n)?n.map(function(l){return l.name}):Object.keys(n),i=function(l){var f=a[l],h=Array.isArray(n)?n[l].tensor:n[f];if(h.dtype!=="float32"&&h.dtype!=="int32"&&h.dtype!=="bool"&&h.dtype!=="string"&&h.dtype!=="complex64")throw new Error("Unsupported dtype in weight '".concat(f,"': ").concat(h.dtype));var p={name:f,shape:h.shape,dtype:h.dtype};if(h.dtype==="string"){var d=new Promise(function(v){return je(u,void 0,void 0,function(){var m,g,y,b,w,x,N;return Xe(this,function(T){switch(T.label){case 0:return[4,h.bytes()];case 1:for(m=T.sent(),g=m.reduce(function(E,C){return E+C.length},0)+Hp*m.length,y=new Uint8Array(g),b=0,w=0;w<m.length;w++)x=m[w],N=new Uint8Array(new Uint32Array([x.length]).buffer),y.set(N,b),b+=Hp,y.set(x,b),b+=x.length;return v(y),[2]}})})});r.push(d)}else r.push(h.data());e!=null&&(p.group=e),t.push(p)},o=0;o<a.length;++o)i(o);return[4,Promise.all(r)];case 1:return s=c.sent(),[2,{data:BQ(s),specs:t}]}})})}function V3(n,e){var t,r,a={},i,o=0;try{for(var s=cr(e),u=s.next();!u.done;u=s.next()){var c=u.value,l=c.name,f=c.dtype,h=c.shape,p=Ut(h),d=void 0;if("quantization"in c){var v=c.quantization;if(v.dtype==="uint8"||v.dtype==="uint16"){if(!("min"in v&&"scale"in v))throw new Error("Weight ".concat(c.name," with quantization ").concat(v.dtype," ")+"doesn't have corresponding metadata min and scale.")}else if(v.dtype==="float16"){if(f!=="float32")throw new Error("Weight ".concat(c.name," is quantized with ").concat(v.dtype," ")+"which only supports weights of type float32 not ".concat(f,"."))}else throw new Error("Weight ".concat(c.name," has unknown ")+"quantization dtype ".concat(v.dtype,". ")+"Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.");var m=v0[v.dtype],g=n.slice(o,o+p*m),y=v.dtype==="uint8"?new Uint8Array(g):new Uint16Array(g);if(f==="float32")if(v.dtype==="uint8"||v.dtype==="uint16"){d=new Float32Array(y.length);for(var b=0;b<y.length;b++){var w=y[b];d[b]=w*v.scale+v.min}}else if(v.dtype==="float16")i===void 0&&(i=VQ()),d=i(y);else throw new Error("Unsupported quantization type ".concat(v.dtype," ")+"for weight type float32.");else if(f==="int32"){if(v.dtype!=="uint8"&&v.dtype!=="uint16")throw new Error("Unsupported quantization type ".concat(v.dtype," ")+"for weight type int32.");d=new Int32Array(y.length);for(var b=0;b<y.length;b++){var w=y[b];d[b]=Math.round(w*v.scale+v.min)}}else throw new Error("Unsupported dtype in weight '".concat(l,"': ").concat(f));o+=p*m}else if(f==="string"){var x=Ut(c.shape);d=[];for(var b=0;b<x;b++){var N=new Uint32Array(n.slice(o,o+Hp))[0];o+=Hp;var T=new Uint8Array(n.slice(o,o+N));d.push(T),o+=N}}else{var E=v0[f],g=n.slice(o,o+p*E);if(f==="float32")d=new Float32Array(g);else if(f==="int32")d=new Int32Array(g);else if(f==="bool")d=new Uint8Array(g);else if(f==="complex64"){d=new Float32Array(g);for(var C=new Float32Array(d.length/2),F=new Float32Array(d.length/2),b=0;b<C.length;b++)C[b]=d[b*2],F[b]=d[b*2+1];var D=Wu(C,h,"float32"),O=Wu(F,h,"float32");a[l]=_o(D,O),D.dispose(),O.dispose()}else throw new Error("Unsupported dtype in weight '".concat(l,"': ").concat(f));o+=p*E}f!=="complex64"&&(a[l]=Wu(d,h,f))}}catch(L){t={error:L}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return a}function BQ(n){if(n===null)throw new Error("Invalid input value: ".concat(JSON.stringify(n)));var e=0,t=[];n.forEach(function(i){if(e+=i.byteLength,t.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(i.constructor.name))});var r=new Uint8Array(e),a=0;return t.forEach(function(i){r.set(new Uint8Array(i.buffer),a),a+=i.byteLength}),r.buffer}var M0=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function xA(n){return M0?Buffer.byteLength(n):new Blob([n]).size}function LQ(n){if(M0)return Buffer.from(n).toString("base64");for(var e=new Uint8Array(n),t="",r=0,a=e.length;r<a;r++)t+=String.fromCharCode(e[r]);return btoa(t)}function zQ(n){if(M0){var e=Buffer.from(n,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var t=atob(n),r=new Uint8Array(t.length),a=0;a<t.length;++a)r.set([t.charCodeAt(a)],a);return r.buffer}function B0(n){if(n.length===1)return n[0];var e=0;n.forEach(function(a){e+=a.byteLength});var t=new Uint8Array(e),r=0;return n.forEach(function(a){t.set(new Uint8Array(a),r),r+=a.byteLength}),t.buffer}function kA(n){var e="/";for(n=n.trim();n.endsWith(e);)n=n.slice(0,n.length-1);var t=n.split(e);return t[t.length-1]}function G3(n,e){var t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function U3(n,e,t){var r={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(r.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=e,r.weightData=t}return n.signature!=null&&(r.signature=n.signature),n.userDefinedMetadata!=null&&(r.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(r.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(r.initializerSignature=n.initializerSignature),r}function L0(n,e){return je(this,void 0,void 0,function(){var t,r,a;return Xe(this,function(i){switch(i.label){case 0:return n.weightsManifest==null?[3,2]:[4,e(n.weightsManifest)];case 1:a=ke.apply(void 0,[i.sent(),2]),t=a[0],r=a[1],i.label=2;case 2:return[2,U3(n,t,r)]}})})}function rf(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:xA(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:xA(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}function H3(n){var e,t,r=[];try{for(var a=cr(n),i=a.next();!i.done;i=a.next()){var o=i.value;r.push.apply(r,wt([],ke(o.weights),!1))}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return r}function $Q(){var n=function(r){for(var a=r<<13,i=0;(a&8388608)===0;)i-=8388608,a<<=1;return a&=-8388609,i+=947912704,a|i},e=new Uint32Array(2048);e[0]=0;for(var t=1;t<1024;t++)e[t]=n(t);for(var t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function qQ(){var n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(var e=1;e<31;e++)n[e]=e<<23;for(var e=33;e<63;e++)n[e]=2147483648+(e-32<<23);return n}function WQ(){for(var n=new Uint32Array(64),e=0;e<64;e++)n[e]=1024;return n[0]=n[32]=0,n}function VQ(){var n=$Q(),e=qQ(),t=WQ();return function(r){for(var a=new ArrayBuffer(4*r.length),i=new Uint32Array(a),o=0;o<r.length;o++){var s=r[o],u=n[t[s>>10]+(s&1023)]+e[s>>10];i[o]=u}return new Float32Array(a)}}var fa=function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerSaveRouter=function(e){n.getInstance().saveRouters.push(e)},n.registerLoadRouter=function(e){n.getInstance().loadRouters.push(e)},n.getSaveHandlers=function(e){return n.getHandlers(e,"save")},n.getLoadHandlers=function(e,t){return n.getHandlers(e,"load",t)},n.getHandlers=function(e,t,r){var a=[],i=t==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters;return i.forEach(function(o){var s=o(e,r);s!==null&&a.push(s)}),a},n}(),GQ=function(n){return fa.registerSaveRouter(n)},UQ=function(n){return fa.registerLoadRouter(n)},HQ=function(n){return fa.getSaveHandlers(n)},KQ=function(n,e){return fa.getLoadHandlers(n,e)},m0="tensorflowjs",g0=1,vs="models_store",Eo="model_info_store";function K3(){if(!vt().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function y0(n){var e=n.result;e.createObjectStore(vs,{keyPath:"modelPath"}),e.createObjectStore(Eo,{keyPath:"modelPath"})}var ys=function(){function n(e){if(this.indexedDB=K3(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return n.prototype.save=function(e){return je(this,void 0,void 0,function(){return Xe(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},n.prototype.load=function(){return je(this,void 0,void 0,function(){return Xe(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},n.prototype.databaseAction=function(e,t){var r=this;return new Promise(function(a,i){var o=r.indexedDB.open(m0,g0);o.onupgradeneeded=function(){return y0(o)},o.onsuccess=function(){var s=o.result;if(t==null){var u=s.transaction(vs,"readonly"),c=u.objectStore(vs),l=c.get(r.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),i(new Error("Cannot find model with path '".concat(r.modelPath,"' ")+"in IndexedDB."));a(l.result.modelArtifacts)},l.onerror=function(m){return s.close(),i(l.error)},u.oncomplete=function(){return s.close()}}else{var f=rf(t),h=s.transaction(Eo,"readwrite"),p=h.objectStore(Eo),d=p.put({modelPath:r.modelPath,modelArtifactsInfo:f}),v;d.onsuccess=function(){v=s.transaction(vs,"readwrite");var m=v.objectStore(vs),g=m.put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:f});g.onsuccess=function(){return a({modelArtifactsInfo:f})},g.onerror=function(y){p=h.objectStore(Eo);var b=p.delete(r.modelPath);b.onsuccess=function(){return s.close(),i(g.error)},b.onerror=function(w){return s.close(),i(g.error)}}},d.onerror=function(m){return s.close(),i(d.error)},h.oncomplete=function(){v==null?s.close():v.oncomplete=function(){return s.close()}}}},o.onerror=function(s){return i(o.error)}})},n}();ys.URL_SCHEME="indexeddb://";var j3=function(n){return vt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(ys.URL_SCHEME)?jQ(n.slice(ys.URL_SCHEME.length)):null};fa.registerSaveRouter(j3);fa.registerLoadRouter(j3);function jQ(n){return new ys(n)}function XQ(n){return n.startsWith(ys.URL_SCHEME)?n.slice(ys.URL_SCHEME.length):n}var YQ=function(){function n(){this.indexedDB=K3()}return n.prototype.listModels=function(){return je(this,void 0,void 0,function(){var e=this;return Xe(this,function(t){return[2,new Promise(function(r,a){var i=e.indexedDB.open(m0,g0);i.onupgradeneeded=function(){return y0(i)},i.onsuccess=function(){var o=i.result,s=o.transaction(Eo,"readonly"),u=s.objectStore(Eo),c=u.getAll();c.onsuccess=function(){var l,f,h={};try{for(var p=cr(c.result),d=p.next();!d.done;d=p.next()){var v=d.value;h[v.modelPath]=v.modelArtifactsInfo}}catch(m){l={error:m}}finally{try{d&&!d.done&&(f=p.return)&&f.call(p)}finally{if(l)throw l.error}}r(h)},c.onerror=function(l){return o.close(),a(c.error)},s.oncomplete=function(){return o.close()}},i.onerror=function(o){return a(i.error)}})]})})},n.prototype.removeModel=function(e){return je(this,void 0,void 0,function(){var t=this;return Xe(this,function(r){return e=XQ(e),[2,new Promise(function(a,i){var o=t.indexedDB.open(m0,g0);o.onupgradeneeded=function(){return y0(o)},o.onsuccess=function(){var s=o.result,u=s.transaction(Eo,"readwrite"),c=u.objectStore(Eo),l=c.get(e),f;l.onsuccess=function(){if(l.result==null)return s.close(),i(new Error("Cannot find model with path '".concat(e,"' ")+"in IndexedDB."));var h=c.delete(e),p=function(){f=s.transaction(vs,"readwrite");var d=f.objectStore(vs),v=d.delete(e);v.onsuccess=function(){return a(l.result.modelArtifactsInfo)},v.onerror=function(m){return i(l.error)}};h.onsuccess=p,h.onerror=function(d){return p(),s.close(),i(l.error)}},l.onerror=function(h){return s.close(),i(l.error)},u.oncomplete=function(){f==null?s.close():f.oncomplete=function(){return s.close()}}},o.onerror=function(s){return i(o.error)}})]})})},n}(),Ki="/",zu="tensorflowjs_models",X3="info",ZQ="model_topology",JQ="weight_specs",QQ="weight_data",eee="model_metadata";function Y3(n){return{info:[zu,n,X3].join(Ki),topology:[zu,n,ZQ].join(Ki),weightSpecs:[zu,n,JQ].join(Ki),weightData:[zu,n,QQ].join(Ki),modelMetadata:[zu,n,eee].join(Ki)}}function Z3(n){var e,t;try{for(var r=cr(Object.values(n)),a=r.next();!a.done;a=r.next()){var i=a.value;window.localStorage.removeItem(i)}}catch(o){e={error:o}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}}function tee(n){var e=n.split(Ki);if(e.length<3)throw new Error("Invalid key format: ".concat(n));return e.slice(1,e.length-1).join(Ki)}function nee(n){return n.startsWith(bs.URL_SCHEME)?n.slice(bs.URL_SCHEME.length):n}var bs=function(){function n(e){if(!vt().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Y3(this.modelPath)}return n.prototype.save=function(e){return je(this,void 0,void 0,function(){var t,r,a,i;return Xe(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),a=rf(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,LQ(e.weightData)),i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),[2,{modelArtifactsInfo:a}]}catch{throw Z3(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."))}return[2]})})},n.prototype.load=function(){return je(this,void 0,void 0,function(){var e,t,r,a,i,o,s;return Xe(this,function(u){if(e=JSON.parse(this.LS.getItem(this.keys.info)),e==null)throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},r=JSON.parse(this.LS.getItem(this.keys.topology)),r==null)throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");if(t.modelTopology=r,a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)),a==null)throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");if(t.weightSpecs=a,i=this.LS.getItem(this.keys.modelMetadata),i!=null&&(o=JSON.parse(i),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,o.signature!=null&&(t.signature=o.signature),o.userDefinedMetadata!=null&&(t.userDefinedMetadata=o.userDefinedMetadata),o.modelInitializer!=null&&(t.modelInitializer=o.modelInitializer),o.initializerSignature!=null&&(t.initializerSignature=o.initializerSignature),o.trainingConfig!=null&&(t.trainingConfig=o.trainingConfig)),s=this.LS.getItem(this.keys.weightData),s==null)throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));return t.weightData=zQ(s),[2,t]})})},n}();bs.URL_SCHEME="localstorage://";var J3=function(n){return vt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(bs.URL_SCHEME)?ree(n.slice(bs.URL_SCHEME.length)):null};fa.registerSaveRouter(J3);fa.registerLoadRouter(J3);function ree(n){return new bs(n)}var aee=function(){function n(){q(vt().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),q(typeof window>"u"||typeof window.localStorage<"u",function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return n.prototype.listModels=function(){return je(this,void 0,void 0,function(){var e,t,r,a,i,o;return Xe(this,function(s){for(e={},t=zu+Ki,r=Ki+X3,a=0;a<this.LS.length;++a)i=this.LS.key(a),i.startsWith(t)&&i.endsWith(r)&&(o=tee(i),e[o]=JSON.parse(this.LS.getItem(i)));return[2,e]})})},n.prototype.removeModel=function(e){return je(this,void 0,void 0,function(){var t,r;return Xe(this,function(a){if(e=nee(e),t=Y3(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '".concat(e,"'"));return r=JSON.parse(this.LS.getItem(t.info)),Z3(t),[2,r]})})},n}(),Vu="://",Do=function(){function n(){this.managers={}}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerManager=function(e,t){q(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(Vu)&&(e=e.slice(0,e.indexOf(Vu))),q(e.length>0,function(){return"scheme must not be an empty string."});var r=n.getInstance();q(r.managers[e]==null,function(){return"A model store manager is already registered for scheme '".concat(e,"'.")}),r.managers[e]=t},n.getManager=function(e){var t=n.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '".concat(e,"'"));return t},n.getSchemes=function(){return Object.keys(n.getInstance().managers)},n}();function Mp(n){if(n.indexOf(Vu)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+"".concat(Do.getSchemes().join(",")));return{scheme:n.split(Vu)[0],path:n.split(Vu)[1]}}function Q3(n,e,t){return t===void 0&&(t=!1),je(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f;return Xe(this,function(h){switch(h.label){case 0:return q(n!==e,function(){return"Old path and new path are the same: '".concat(n,"'")}),r=fa.getLoadHandlers(n),q(r.length>0,function(){return"Copying failed because no load handler is found for source URL ".concat(n,".")}),q(r.length<2,function(){return"Copying failed because more than one (".concat(r.length,") ")+"load handlers for source URL ".concat(n,".")}),a=r[0],i=fa.getSaveHandlers(e),q(i.length>0,function(){return"Copying failed because no save handler is found for destination "+"URL ".concat(e,".")}),q(i.length<2,function(){return"Copying failed because more than one (".concat(r.length,") ")+"save handlers for destination URL ".concat(e,".")}),o=i[0],s=Mp(n).scheme,u=Mp(n).path,c=s===Mp(n).scheme,[4,a.load()];case 1:return l=h.sent(),t&&c?[4,Do.getManager(s).removeModel(u)]:[3,3];case 2:h.sent(),h.label=3;case 3:return[4,o.save(l)];case 4:return f=h.sent(),t&&!c?[4,Do.getManager(s).removeModel(u)]:[3,6];case 5:h.sent(),h.label=6;case 6:return[2,f.modelArtifactsInfo]}})})}function iee(){return je(this,void 0,void 0,function(){var n,e,t,r,a,i,o,s,u,c,l;return Xe(this,function(f){switch(f.label){case 0:n=Do.getSchemes(),e={},f.label=1;case 1:f.trys.push([1,6,7,8]),t=cr(n),r=t.next(),f.label=2;case 2:return r.done?[3,5]:(a=r.value,[4,Do.getManager(a).listModels()]);case 3:i=f.sent();for(o in i)s=a+Vu+o,e[s]=i[o];f.label=4;case 4:return r=t.next(),[3,2];case 5:return[3,8];case 6:return u=f.sent(),c={error:u},[3,8];case 7:try{r&&!r.done&&(l=t.return)&&l.call(t)}finally{if(c)throw c.error}return[7];case 8:return[2,e]}})})}function oee(n){return je(this,void 0,void 0,function(){var e,t;return Xe(this,function(r){return e=Mp(n),t=Do.getManager(e.scheme),[2,t.removeModel(e.path)]})})}function see(n,e){return je(this,void 0,void 0,function(){var t;return Xe(this,function(r){return t=!1,[2,Q3(n,e,t)]})})}function uee(n,e){return je(this,void 0,void 0,function(){var t;return Xe(this,function(r){return t=!0,[2,Q3(n,e,t)]})})}var cee=function(){function n(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}return n.prototype.fetch=function(e,t){return fetch(e,t)},n.prototype.now=function(){return performance.now()},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},n.prototype.setTimeoutCustom=function(e,t){var r=this;if(typeof window>"u"||!vt().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(function(){window.postMessage({name:r.messageName,index:r.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",function(a){if(a.source===window&&a.data.name===r.messageName){a.stopPropagation();var i=r.functionRefs[a.data.index];i(),r.handledMessageCount++,r.handledMessageCount===r.functionRefs.length&&(r.functionRefs=[],r.handledMessageCount=0)}},!0))},n.prototype.isTypedArray=function(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray},n}();if(vt().get("IS_BROWSER")){vt().setPlatform("browser",new cee);try{Do.registerManager(bs.URL_SCHEME,new aee)}catch{}try{Do.registerManager(ys.URL_SCHEME,new YQ)}catch{}}var lee={importFetch:function(){return cA()}},Jg,fee=function(){function n(){this.util=lA(),this.textEncoder=new this.util.TextEncoder}return n.prototype.fetch=function(e,t){return vt().global.fetch!=null?vt().global.fetch(e,t):(Jg==null&&(Jg=lee.importFetch()),Jg(e,t))},n.prototype.now=function(){var e=process.hrtime();return e[0]*1e3+e[1]/1e6},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},n.prototype.isTypedArray=function(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)},n}();vt().get("IS_NODE")&&!vt().get("IS_BROWSER")&&vt().setPlatform("node",new fee);function Xi(n,e,t){return e===void 0&&(e="float32"),e=e||"float32",Vr(n),new Up(n,e,t)}function hee(n,e){var t=P(n,"x","cast");if(!MA(e))throw new Error("Failed to cast to unknown dtype ".concat(e));if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var r={x:t},a={dtype:e};return U.runKernel(A0,r,a)}var Nn=H({cast_:hee});function pee(n){var e=P(n,"x","clone","string_or_numeric"),t={x:e};return U.runKernel(_0,t)}var gs=H({clone_:pee});function eF(n,e){e===void 0&&(e=!1),console.log(n.toString(e))}z3();var dee={buffer:Xi,cast:Nn,clone:gs,print:eF};kQ(dee);function vee(){vt().set("PROD",!0)}function mee(){vt().set("DEBUG",!0)}function gee(){vt().set("DEPRECATION_WARNINGS_ENABLED",!1),console.warn("TensorFlow.js deprecation warnings have been disabled.")}function yee(n){vt().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function bee(){U.disposeVariables()}function wee(){return U}function xee(){return U.memory()}function kee(n){return U.profile(n)}function Mn(n,e){return U.tidy(n,e)}function Er(n){var e=O0(n);e.forEach(function(t){return t.dispose()})}function tF(n){return U.keep(n)}function See(n){return U.time(n)}function Nee(n){return U.setBackend(n)}function Tee(){return U.ready()}function Eee(){return U.backendName}function Iee(n){U.removeBackend(n)}function Cee(n){return U.findBackend(n)}function Aee(n){return U.findBackendFactory(n)}function _ee(n,e,t){return t===void 0&&(t=1),U.registerBackend(n,e,t)}function Dee(){return U.backend}function Fee(n,e){vt().setPlatform(n,e)}function Ree(n,e){var t,r=P(n,"a","add"),a=P(e,"b","add");t=ke(vn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return U.runKernel(C0,i)}var ut=H({add_:Ree});function Oee(n,e){var t,r=P(n,"a","floorDiv"),a=P(e,"b","floorDiv");t=ke(vn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return U.runKernel(W_,i)}var nF=H({floorDiv_:Oee});function Pee(n,e){var t,r=P(n,"a","div"),a=P(e,"b","div");if(t=ke(vn(r,a),2),r=t[0],a=t[1],r.dtype==="int32"&&a.dtype==="int32")return nF(r,a);var i={a:r,b:a},o={};return U.runKernel(__,i,o)}var Gt=H({div_:Pee});function Mee(n,e){var t,r=P(n,"a","mul"),a=P(e,"b","mul");t=ke(vn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return U.runKernel(wD,i)}var Me=H({mul_:Mee});function Bee(n){var e=P(n,"x","abs");if(e.dtype==="complex64"){var t={x:e};return U.runKernel(f_,t)}else{var t={x:e};return U.runKernel(VA,t)}}var ua=H({abs_:Bee});function Lee(n){var e=P(n,"x","acos"),t={x:e};return U.runKernel(GA,t)}var zee=H({acos_:Lee});function $ee(n){var e=P(n,"x","acosh"),t={x:e};return U.runKernel(UA,t)}var qee=H({acosh_:$ee});function Wee(n){q(Array.isArray(n),function(){return"The argument passed to tf.addN() must be a list of tensors"}),q(n.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+"".concat(n.length)});var e=n.map(function(a,i){return P(a,"tensors".concat(i),"addN")}),t=e[0];e.forEach(function(a){if(a.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(a){if(!Fo(a.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=e;return U.runKernel(HA,r)}var Vee=H({addN_:Wee});function Gee(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=P(n,"x","all","bool"),a={x:r},i={axis:e,keepDims:t};return U.runKernel(KA,a,i)}var Uee=H({all_:Gee});function Hee(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=P(n,"x","any","bool"),a={x:r},i={axis:e,keepDims:t};return U.runKernel(jA,a,i)}var Kee=H({any_:Hee});function jee(n,e){e===void 0&&(e=0);var t=P(n,"x","argMax"),r={x:t},a={axis:e};return U.runKernel(XA,r,a)}var Xee=H({argMax_:jee});function Yee(n,e){e===void 0&&(e=0);var t=P(n,"x","argMin"),r={x:t},a={axis:e};return U.runKernel(YA,r,a)}var Zee=H({argMin_:Yee});function Jee(n){var e=P(n,"x","asin"),t={x:e};return U.runKernel(ZA,t)}var Qee=H({asin_:Jee});function ete(n){var e=P(n,"x","asinh"),t={x:e};return U.runKernel(JA,t)}var tte=H({asinh_:ete});function nte(n){var e=P(n,"x","atan"),t={x:e};return U.runKernel(QA,t)}var rte=H({atan_:nte});function ate(n,e){var t,r=P(n,"a","atan2"),a=P(e,"b","atan2");t=ke(vn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return U.runKernel(t_,i)}var ite=H({atan2_:ate});function ote(n){var e=P(n,"x","atanh"),t={x:e};return U.runKernel(e_,t)}var ste=H({atanh_:ote});function ute(n,e,t,r,a,i){a===void 0&&(a="NHWC");var o=n[3],s=wt(wt([],ke(e),!1),[o],!1),u=iF(a);return af(n,s,t,i,r,null,null,u)}function rF(n,e,t,r,a,i,o){o===void 0&&(o="channelsLast");var s=ke(Ul(e),2),u=s[0],c=s[1],l;if(o==="channelsLast")l=[u,c,n[3],n[3]];else if(o==="channelsFirst")l=[u,c,n[1],n[1]];else throw new Error("Unknown dataFormat ".concat(o));return af(n,l,t,r,a,i,!1,o)}function cte(n,e,t,r,a,i,o){o===void 0&&(o="NDHWC");var s=ke(b0(e),3),u=s[0],c=s[1],l=s[2],f,h;if(o==="NDHWC")h="channelsLast",f=[u,c,l,n[4],n[4]];else if(o==="NCDHW")h="channelsFirst",f=[u,c,l,n[1],n[1]];else throw new Error("Unknown dataFormat ".concat(o));return aF(n,f,t,r,a,!1,h,i)}function af(n,e,t,r,a,i,o,s){var u,c;o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var l=ke([-1,-1,-1,-1],4),f=l[0],h=l[1],p=l[2],d=l[3];if(s==="channelsLast")u=ke(n,4),f=u[0],h=u[1],p=u[2],d=u[3];else if(s==="channelsFirst")c=ke(n,4),f=c[0],d=c[1],h=c[2],p=c[3];else throw new Error("Unknown dataFormat ".concat(s));var v=ke(e,4),m=v[0],g=v[1],y=v[3],b=ke(Ul(t),2),w=b[0],x=b[1],N=ke(Ul(r),2),T=N[0],E=N[1],C=Gu(m,T),F=Gu(g,E),D=hte(a,h,p,w,x,C,F,i,s),O=D.padInfo,L=D.outHeight,z=D.outWidth,$=o?y*d:y,B;return s==="channelsFirst"?B=[f,$,L,z]:s==="channelsLast"&&(B=[f,L,z,$]),{batchSize:f,dataFormat:s,inHeight:h,inWidth:p,inChannels:d,outHeight:L,outWidth:z,outChannels:$,padInfo:O,strideHeight:w,strideWidth:x,filterHeight:m,filterWidth:g,effectiveFilterHeight:C,effectiveFilterWidth:F,dilationHeight:T,dilationWidth:E,inShape:n,outShape:B,filterShape:e}}function aF(n,e,t,r,a,i,o,s){var u,c;i===void 0&&(i=!1),o===void 0&&(o="channelsLast");var l=ke([-1,-1,-1,-1,-1],5),f=l[0],h=l[1],p=l[2],d=l[3],v=l[4];if(o==="channelsLast")u=ke(n,5),f=u[0],h=u[1],p=u[2],d=u[3],v=u[4];else if(o==="channelsFirst")c=ke(n,5),f=c[0],v=c[1],h=c[2],p=c[3],d=c[4];else throw new Error("Unknown dataFormat ".concat(o));var m=ke(e,5),g=m[0],y=m[1],b=m[2],w=m[4],x=ke(b0(t),3),N=x[0],T=x[1],E=x[2],C=ke(b0(r),3),F=C[0],D=C[1],O=C[2],L=Gu(g,F),z=Gu(y,D),$=Gu(b,O),B=pte(a,h,p,d,N,T,E,L,z,$,s),W=B.padInfo,X=B.outDepth,Y=B.outHeight,V=B.outWidth,j=i?w*v:w,re;return o==="channelsFirst"?re=[f,j,X,Y,V]:o==="channelsLast"&&(re=[f,X,Y,V,j]),{batchSize:f,dataFormat:o,inDepth:h,inHeight:p,inWidth:d,inChannels:v,outDepth:X,outHeight:Y,outWidth:V,outChannels:j,padInfo:W,strideDepth:N,strideHeight:T,strideWidth:E,filterDepth:g,filterHeight:y,filterWidth:b,effectiveFilterDepth:L,effectiveFilterHeight:z,effectiveFilterWidth:$,dilationDepth:F,dilationHeight:D,dilationWidth:O,inShape:n,outShape:re,filterShape:e}}function lte(n,e,t,r,a){r==null&&(r=z0(n,e,t));var i=n[0],o=n[1],s=Hl((i-e+2*r)/t+1,a),u=Hl((o-e+2*r)/t+1,a);return[s,u]}function fte(n,e,t,r,a,i){a==null&&(a=z0(n,e[0],r[0]));for(var o=[0,0,0,t],s=0;s<3;s++)n[s]+2*a>=e[s]&&(o[s]=Hl((n[s]-e[s]+2*a)/r[s]+1,i));return o}function z0(n,e,t,r){r===void 0&&(r=1);var a=Gu(e,r);return Math.floor((n[0]*(t-1)-t+a)/2)}function Ul(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function b0(n){return typeof n=="number"?[n,n,n]:n}function Gu(n,e){return e<=1?n:n+(n-1)*(e-1)}function hte(n,e,t,r,a,i,o,s,u){var c,l,f;if(typeof n=="number"){var h=n===0?"VALID":"NUMBER";c={top:n,bottom:n,left:n,right:n,type:h};var p=lte([e,t],i,r,n,s);l=p[0],f=p[1]}else if(n==="same"){l=Math.ceil(e/r),f=Math.ceil(t/a);var d=Math.max(0,(l-1)*r+i-e),v=Math.max(0,(f-1)*a+o-t),m=Math.floor(d/2),g=d-m,y=Math.floor(v/2),b=v-y;c={top:m,bottom:g,left:y,right:b,type:"SAME"}}else if(n==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-i+1)/r),f=Math.ceil((t-o+1)/a);else if(typeof n=="object"){var m=u==="channelsLast"?n[1][0]:n[2][0],g=u==="channelsLast"?n[1][1]:n[2][1],y=u==="channelsLast"?n[2][0]:n[3][0],b=u==="channelsLast"?n[2][1]:n[3][1],h=m===0&&g===0&&y===0&&b===0?"VALID":"EXPLICIT";c={top:m,bottom:g,left:y,right:b,type:h},l=Hl((e-i+m+g)/r+1,s),f=Hl((t-o+y+b)/a+1,s)}else throw Error("Unknown padding parameter: ".concat(n));return{padInfo:c,outHeight:l,outWidth:f}}function pte(n,e,t,r,a,i,o,s,u,c,l){var f,h,p,d;if(n==="valid"&&(n=0),typeof n=="number"){var v=n===0?"VALID":"NUMBER";f={top:n,bottom:n,left:n,right:n,front:n,back:n,type:v};var m=fte([e,t,r,1],[s,u,c],1,[a,i,o],n,l);h=m[0],p=m[1],d=m[2]}else if(n==="same"){h=Math.ceil(e/a),p=Math.ceil(t/i),d=Math.ceil(r/o);var g=(h-1)*a+s-e,y=(p-1)*i+u-t,b=(d-1)*o+c-r,w=Math.floor(g/2),x=g-w,N=Math.floor(y/2),T=y-N,E=Math.floor(b/2),C=b-E;f={top:N,bottom:T,left:E,right:C,front:w,back:x,type:"SAME"}}else throw Error("Unknown padding parameter: ".concat(n));return{padInfo:f,outDepth:h,outHeight:p,outWidth:d}}function Hl(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode ".concat(e))}}function Kl(n){var e=ke(Ul(n),3),t=e[0],r=e[1],a=e[2];return t===1&&r===1&&a===1}function Ji(n,e){return Kl(n)||Kl(e)}function ws(n){return Ul(n).every(function(e){return e>0})}function iF(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat ".concat(n))}function Ca(n,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,"."));if(typeof e=="number")q(Ku(e),function(){return"Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,".")});else if(typeof e=="object")e.forEach(function(r){r.forEach(function(a){q(Ku(a),function(){return"Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(a,".")})})});else throw Error("Error in ".concat(n,": Unknown padding parameter: ").concat(e))}}function dte(n,e){var t=P(n,"x","reshape","string_or_numeric"),r={x:t},a={shape:e};return U.runKernel($D,r,a)}var ve=H({reshape_:dte});function vte(n,e,t,r,a){var i=P(n,"x","avgPool","float32"),o=1;q(Ji(t,o),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")});var s=i,u=!1;i.rank===3&&(u=!0,s=ve(i,[1,i.shape[0],i.shape[1],i.shape[2]])),q(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(s.rank,".")}),Ca("avgPool",r,a);var c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a},f=U.runKernel(n_,c,l);return f=Nn(f,i.dtype),u?ve(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var oF=H({avgPool_:vte});function mte(n,e,t,r,a,i){i===void 0&&(i="NDHWC");var o=P(n,"x","avgPool3d","float32"),s=o,u=!1;o.rank===4&&(u=!0,s=ve(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),q(s.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),q(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),q(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,function(){return"Error in avgPool3d: Stride must be > 0, but got '".concat(t,"'")}),Ca("avgPool3d",r,a);var c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a,dataFormat:i},f=U.runKernel(r_,c,l);return f=Nn(f,s.dtype),u?ve(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var gte=H({avgPool3d_:mte});function yte(n,e){e===void 0&&(e=0),q(n.length>=1,function(){return"Pass at least one tensor to concat"});var t=Gl(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `.concat(i.dtype,". "))}),t.length===1)return gs(t[0]);var r=t,a={axis:e};return U.runKernel(h_,r,a)}var Wr=H({concat_:yte});function bte(n,e,t,r){var a;t===void 0&&(t=!1),r===void 0&&(r=!1);var i=P(n,"a","matMul"),o=P(e,"b","matMul");a=ke(vn(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:r};return U.runKernel(a_,s,u)}var Ft=H({matMul_:bte});function wte(n){var e=P(n,"x","sigmoid","float32"),t={x:e};return U.runKernel(t3,t)}var Uu=H({sigmoid_:wte});function xte(n,e,t){var r=P(n,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");var a={x:r},i={begin:e,size:t};return U.runKernel(ZD,a,i)}var un=H({slice_:xte});function kte(n){var e=P(n,"x","tanh","float32"),t={x:e};return U.runKernel(w3,t)}var w0=H({tanh_:kte});function Ste(n,e,t,r,a,i){var o=P(n,"forgetBias","basicLSTMCell"),s=P(e,"lstmKernel","basicLSTMCell"),u=P(t,"lstmBias","basicLSTMCell"),c=P(r,"data","basicLSTMCell"),l=P(a,"c","basicLSTMCell"),f=P(i,"h","basicLSTMCell"),h=Wr([c,f],1),p=Ft(h,s),d=ut(p,u),v=d.shape[0],m=d.shape[1]/4,g=[v,m],y=un(d,[0,0],g),b=un(d,[0,m],g),w=un(d,[0,m*2],g),x=un(d,[0,m*3],g),N=ut(Me(Uu(y),w0(b)),Me(l,Uu(ut(o,w)))),T=Me(w0(N),Uu(x));return[N,T]}var Nte=H({basicLSTMCell_:Ste});function Tte(n,e,t){var r=P(n,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});q(r.rank>=1+e.length,function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(e.length)}),q(t.length===e.length,function(){return"crops.length is ".concat(t.length," but should be equal to blockShape.length  ").concat(e.length)}),q(r.shape[0]%a===0,function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(e.join(" * ")," === ").concat(a)});var i={x:r},o={blockShape:e,crops:t};return U.runKernel(i_,i,o)}var sF=H({batchToSpaceND_:Tte});function Ete(n){var e;return n.rank===0||n.rank===1?e=ve(n,[1,1,1,n.size]):n.rank===2?e=ve(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=ve(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}function Ite(n,e,t,r,a,i){i==null&&(i=.001);var o=P(n,"x","batchNorm"),s=P(e,"mean","batchNorm"),u=P(t,"variance","batchNorm"),c;a!=null&&(c=P(a,"scale","batchNorm"));var l;r!=null&&(l=P(r,"offset","batchNorm")),q(s.rank===u.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),q(l==null||s.rank===l.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),q(c==null||s.rank===c.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var f=Ete(o),h={x:f,scale:c,offset:l,mean:s,variance:u},p={varianceEpsilon:i},d=U.runKernel(V_,h,p);return ve(d,o.shape)}var rd=H({batchNorm_:Ite});function Cte(n,e,t,r,a,i){var o=P(n,"x","batchNorm"),s=P(e,"mean","batchNorm"),u=P(t,"variance","batchNorm"),c;a!=null&&(c=P(a,"scale","batchNorm"));var l;return r!=null&&(l=P(r,"offset","batchNorm")),q(o.rank===2,function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(o.rank,".")}),q(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(s.rank,".")}),q(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&q(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&q(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(l.rank,".")}),rd(o,s,u,l,c,i)}var Ate=H({batchNorm2d_:Cte});function _te(n,e,t,r,a,i){var o=P(n,"x","batchNorm"),s=P(e,"mean","batchNorm"),u=P(t,"variance","batchNorm"),c;a!=null&&(c=P(a,"scale","batchNorm"));var l;return r!=null&&(l=P(r,"offset","batchNorm")),q(o.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(o.rank,".")}),q(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(s.rank,".")}),q(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&q(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&q(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(l.rank,".")}),rd(o,s,u,l,c,i)}var Dte=H({batchNorm3d_:_te});function Fte(n,e,t,r,a,i){var o=P(n,"x","batchNorm"),s=P(e,"mean","batchNorm"),u=P(t,"variance","batchNorm"),c;a!=null&&(c=P(a,"scale","batchNorm"));var l;return r!=null&&(l=P(r,"offset","batchNorm")),q(o.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(o.rank,".")}),q(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(s.rank,".")}),q(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&q(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&q(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(l.rank,".")}),rd(o,s,u,l,c,i)}var Rte=H({batchNorm4d_:Fte});function Ote(n,e,t){var r=P(n,"x","bincount"),a=P(e,"weights","bincount");q(r.dtype==="int32",function(){return"Error in bincount: input "+"dtype must be int32, but got ".concat(r.dtype)}),q(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),q(a.size===r.size||a.size===0,function(){return"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(r.shape,", weights shape: ")+"".concat(a.shape,".")});var i={x:r,weights:a},o={size:t};return U.runKernel(o_,i,o)}var uF=H({bincount_:Ote});function Pte(n,e){var t=P(n,"s0","broadcastArgs","int32"),r=P(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error("broadcastArgs(): first input must be a vector (rank=1). "+"Has rank ".concat(t.rank));if(r.rank!==1)throw new Error("broadcastArgs(): second input must be a vector (rank=1). "+"Has rank ".concat(r.rank));var a={s0:t,s1:r};return U.runKernel(s_,a)}var Mte=H({broadcastArgs_:Pte});function Bte(n,e){var t=P(n,"broadcastTo","x"),r=t.shape;if(Vr(e),e.length<t.rank)throw new Error("broadcastTo(): shape.length=".concat(e.length," < input.rank=").concat(t.rank,"."));if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=ve(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(e,"]."));var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return gs(t);var c={x:t},l={reps:o};return U.runKernel(D0,c,l)}var Bp=H({broadcastTo_:Bte});function Lte(n){var e=P(n,"x","ceil","float32"),t={x:e};return U.runKernel(u_,t)}var zte=H({ceil_:Lte});function of(n,e,t){Vr(n);var r={shape:n,value:e,dtype:t};return U.runKernel(z_,{},r)}function $te(n,e,t){var r=P(n,"x","clipByValue");if(q(e<=t,function(){return"Error in clip: min (".concat(e,") must be ")+"less than or equal to max (".concat(t,").")}),e===t)return of(r.shape,e,r.dtype);var a={x:r},i={clipValueMin:e,clipValueMax:t};return U.runKernel(c_,a,i)}var qte=H({clipByValue_:$te});function Wte(n){return Wr(n,0)}var Vte=H({concat1d_:Wte});function Gte(n,e){return Wr(n,e)}var Ute=H({concat2d_:Gte});function Hte(n,e){return Wr(n,e)}var Kte=H({concat3d_:Hte});function jte(n,e){return Wr(n,e)}var Xte=H({concat4d_:jte});function Yte(n,e,t,r,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=P(n,"x","conv2d","float32"),u=P(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=ve(s,[1,s.shape[0],s.shape[1],s.shape[2]])),q(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")}),q(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")}),Ca("conv2d",r,o);var f=a==="NHWC"?c.shape[3]:c.shape[1];q(f===u.shape[2],function(){return"Error in conv2d: depth of input (".concat(f,") must match ")+"input depth for filter ".concat(u.shape[2],".")}),q(Ji(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),q(ws(i),function(){return"Error in conv2D: Dilated rates should be larger than 0."}),q(ws(t),function(){return"Error in conv2D: Strides should be larger than 0."});var h={x:c,filter:u},p={strides:t,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},d=U.runKernel(p_,h,p);return l?ve(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var ad=H({conv2d_:Yte});function Zte(n,e,t,r,a,i,o){a===void 0&&(a="NWC"),i===void 0&&(i=1);var s=P(n,"x","conv1d"),u=P(e,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=ve(s,[1,s.shape[0],s.shape[1]])),q(c.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")}),q(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+"".concat(u.rank,".")}),Ca("conv1d",r,o),q(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match ")+"input depth for filter ".concat(u.shape[1],".")}),q(Ji(t,i),function(){return"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(t," and dilation '").concat(i,"'")}),q(ws(i),function(){return"Error in conv1D: Dilated rates should be larger than 0."}),q(ws(t),function(){return"Error in conv1D: Stride should be larger than 0."}),q(a==="NWC",function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")});var f=ve(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=ve(c,[c.shape[0],1,c.shape[1],c.shape[2]]),p=[1,t],d=[1,i],v="NHWC",m=ad(h,f,p,r,v,d,o);return l?ve(m,[m.shape[2],m.shape[3]]):ve(m,[m.shape[0],m.shape[2],m.shape[3]])}var Jte=H({conv1d_:Zte});function Qte(n,e,t,r,a,i,o){i===void 0&&(i="NHWC"),q(n.length===e.rank,function(){return"Length of inShape "+"(".concat(n.length,") and rank of dy (").concat(e.rank,") must match")});var s=n,u=e,c=!1;e.rank===3&&(c=!0,u=ve(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,n[0],n[1],n[2]]),q(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")}),q(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)}),q(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(t.rank)});var l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];q(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(t.shape[2],".")}),q(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output (".concat(f,") must ")+"match output depth for filter ".concat(t.shape[3],".")}),Ca("conv2dDerInput",a,o);var h={dy:u,filter:t},p={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=U.runKernel(v_,h,p);return c?ve(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var cF=H({conv2DBackpropInput_:Qte});function ene(n,e,t,r,a,i){var o=P(n,"x","conv2dTranspose"),s=P(e,"filter","conv2dTranspose");return cF(t,o,s,r,a,"NHWC",i)}var tne=H({conv2dTranspose_:ene});function nne(n,e,t,r,a,i){a===void 0&&(a="NDHWC"),i===void 0&&(i=[1,1,1]);var o=P(n,"x","conv3d"),s=P(e,"filter","conv3d"),u=o,c=!1;o.rank===4&&(c=!0,u=ve(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),q(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")}),q(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+"".concat(s.rank,".")}),q(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match ")+"input depth for filter ".concat(s.shape[3],".")}),q(Ji(t,i),function(){return"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),q(a==="NDHWC",function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")}),q(ws(i),function(){return"Error in conv3D: Dilated rates should be larger than 0."}),q(ws(t),function(){return"Error in conv3D: Strides should be larger than 0."});var l={x:u,filter:s},f={strides:t,pad:r,dataFormat:a,dilations:i},h=U.runKernel(m_,l,f);return c?ve(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var rne=H({conv3d_:nne});function ane(n,e,t,r,a){q(n.length===e.rank,function(){return"Length of inShape "+"(".concat(n.length,") and rank of dy (").concat(e.rank,") must match")});var i=n,o=e,s=!1;e.rank===4&&(s=!0,o=ve(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);var u=i[4],c=o.shape[4];q(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")}),q(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)}),q(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(t.rank)}),q(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(t.shape[3],".")}),q(c===t.shape[4],function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(t.shape[4],".")});var l={dy:o,filter:t},f={pad:a,strides:r,inputShape:i},h=U.runKernel(g_,l,f);return s?ve(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var ine=H({conv3DBackpropInput_:ane});function one(n,e,t,r,a){var i=P(n,"x","conv3dTranspose"),o=P(e,"filter","conv3dTranspose");return ine(t,i,o,r,a)}var sne=H({conv3dTranspose_:one});function une(n){var e=P(n,"x","cos","float32"),t={x:e};return U.runKernel(y_,t)}var cne=H({cos_:une});function lne(n){var e=P(n,"x","cosh","float32"),t={x:e};return U.runKernel(b_,t)}var fne=H({cosh_:lne});function hne(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var a=P(n,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:r};return U.runKernel(w_,i,o)}var pne=H({cumprod_:hne});function dne(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var a=P(n,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:r};return U.runKernel(x_,i,o)}var vne=H({cumsum_:dne});function mne(n,e,t,r){r===void 0&&(r=!1);var a=P(n,"x","denseBincount"),i=P(e,"weights","denseBincount");q(a.dtype==="int32",function(){return"Error in denseBincount: input "+"dtype must be int32, but got ".concat(a.dtype)}),q(a.rank<=2,function(){return"Error in denseBincount: input must be at most rank 2, but got "+"rank ".concat(a.rank,".")}),q(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),q(i.size===a.size||i.size===0,function(){return"Error in denseBincount: weights must have the same shape as x or "+"0-length, but got x shape: ".concat(a.shape,", weights shape: ")+"".concat(i.shape,".")});var o={x:a,weights:i},s={size:t,binaryOutput:r};return U.runKernel(S_,o,s)}var gne=H({denseBincount_:mne});function yne(n,e,t){t===void 0&&(t="NHWC");var r=P(n,"x","depthToSpace","float32"),a=t==="NHWC"?r.shape[1]:r.shape[2],i=t==="NHWC"?r.shape[2]:r.shape[3],o=t==="NHWC"?r.shape[3]:r.shape[1];q(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(e)}),q(a*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(a," and ").concat(e,`  for depthToSpace with input shape
    `).concat(r.shape)}),q(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(i," and ").concat(e,` for depthToSpace with input shape
        `).concat(r.shape)}),q(o%(e*e)===0,function(){return"Dimension size must be evenly divisible by ".concat(e*e," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape)});var s={x:r},u={blockSize:e,dataFormat:t};return U.runKernel(N_,s,u)}var bne=H({depthToSpace_:yne});function wne(n,e,t,r,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=P(n,"x","depthwiseConv2d","float32"),u=P(e,"filter","depthwiseConv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=ve(s,[1,s.shape[0],s.shape[1],s.shape[2]])),q(c.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(c.rank,".")}),q(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")});var f=a==="NHWC"?c.shape[3]:c.shape[1];q(f===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels "+"(".concat(f,") must match the inChannels dimension in ")+"filter ".concat(u.shape[2],".")}),Ca("depthwiseConv2d",r,o);var h={x:c,filter:u},p={strides:t,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},d=U.runKernel(T_,h,p);return l?ve(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var $0=H({depthwiseConv2d_:wne});function xne(n){var e=P(n,"x","diag"),t={x:e};return U.runKernel(C_,t)}var kne=H({diag_:xne});function Sne(n,e,t,r,a,i){a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC");var o=P(n,"x","dilation2d"),s=P(e,"filter","dilation2d");q(o.rank===3||o.rank===4,function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(o.rank,".")}),q(s.rank===3,function(){return"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(s.rank,".")}),q(i==="NHWC",function(){return"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(i)});var u=o,c=!1;o.rank===3&&(u=ve(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),q(u.shape[3]===s.shape[2],function(){return"Error in dilation2d:  input and filter must have the same depth: ".concat(u.shape[3]," vs ").concat(s.shape[2])});var l={x:u,filter:s},f={strides:t,pad:r,dilations:a},h=U.runKernel(A_,l,f);return c?ve(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var Nne=H({dilation2d_:Sne});function lF(n,e){for(var t=n.length,r=[],a=0;a<t;a++){var i=t-1-a,o=n[i]||1,s=e[e.length-1-a]||1;s>1&&o===1&&r.unshift(i)}return r}function q0(n,e){for(var t=[],r=0;r<e.length;r++){var a=n[n.length-r-1],i=e.length-r-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function Bn(n,e){for(var t=[],r=Math.max(n.length,e.length),a=0;a<r;a++){var i=n[n.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)t.unshift(o);else if(o===1)t.unshift(i);else if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(n," and ").concat(e,".");throw Error(s)}else t.unshift(i)}return t}var Tne={__proto__:null,getBroadcastDims:lF,getReductionAxes:q0,assertAndGetBroadcastShape:Bn};function Ene(n,e){var t,r=P(n,"a","equal","string_or_numeric"),a=P(e,"b","equal","string_or_numeric");t=ke(vn(r,a),2),r=t[0],a=t[1],Bn(r.shape,a.shape);var i={a:r,b:a};return U.runKernel(O_,i)}var fF=H({equal_:Ene});function Ine(n,e,t){var r=P(e,"a","where"),a=P(t,"b","where"),i=P(n,"condition","where","bool"),o=Bn(Bn(i.shape,r.shape),a.shape),s=Bp(i,o),u=Bp(r,o),c=Bp(a,o),l={condition:s,t:u,e:c};return U.runKernel(XD,l)}var Yu=H({where_:Ine});function Cne(n){var e=P(n,"x","zerosLike"),t={x:e};return U.runKernel(E3,t)}var ca=H({zerosLike_:Cne});function Ane(n,e){var t,r=P(n,"a","div"),a=P(e,"b","div");t=ke(vn(r,a),2),r=t[0],a=t[1];var i=Gt(r,a),o=ca(i),s=fF(a,o);return Yu(s,o,i)}var _ne=H({divNoNan_:Ane});function Dne(n,e){var t=P(n,"t1","dot"),r=P(e,"t2","dot");q((t.rank===1||t.rank===2)&&(r.rank===1||r.rank===2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(t.rank," and ").concat(r.rank,".")});var a=t.rank===1?t.size:t.shape[1],i=r.rank===1?r.size:r.shape[0];if(q(a===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+"".concat(a," and ").concat(i,".")}),t.rank===1&&r.rank===1){var o=ve(t,[1,-1]),s=ve(r,[-1,1]),u=Ft(o,s);return ve(u,[])}else if(t.rank===1&&r.rank===2){var o=ve(t,[1,-1]),s=ve(r,[r.shape[0],r.shape[1]]),u=Ft(o,s);return ve(u,[u.size])}else if(t.rank===2&&r.rank===1){var s=ve(r,[-1,1]),u=Ft(t,s);return ve(u,[u.size])}else{var s=ve(r,[r.shape[0],r.shape[1]]),u=Ft(t,s);return u}}var Fne=H({dot_:Dne});function Rne(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var r=e.map(function(i,o){return P(i,"tensors".concat(o),"einsum")}),a={equation:n};return U.runKernel(D_,r,a)}var One=H({einsum_:Rne});function Pne(n){var e=P(n,"x","elu","float32"),t={x:e};return U.runKernel(F_,t)}var hF=H({elu_:Pne});function Mne(n){var e=P(n,"x","erf");q(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=Nn(e,"float32"));var t={x:e};return U.runKernel(R_,t)}var Bne=H({erf_:Mne});function W0(n,e){for(var t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function pF(n,e,t){for(var r=n.length+e.length,a=[],i=0,o=0,s=0;s<r;s++)t.indexOf(s)===-1?a.push(n[i++]):a.push(e[o++]);return a}function Lne(n,e){for(var t=[],r=n.length,a=0;a<r;a++)e.indexOf(a)===-1&&t.push(n[a]);var i=e.map(function(o){return n[o]});return[t,i]}function sf(n,e){var t=e.map(function(r){return 1});return pF(n,t,e)}function zne(n,e,t){q(W0(e,t),function(){return"".concat(n," supports only inner-most axes for now. ")+"Got axes ".concat(e," and rank-").concat(t," input.")})}function $ne(n,e){if(W0(n,e))return null;for(var t=[],r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach(function(a){return t.push(a)}),t}function qne(n){return n.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function Wne(n,e){for(var t=[],r=e-n;r<e;++r)t.push(r);return t}function Vne(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=P(n,"x","max"),a={x:r},i={reductionIndices:e,keepDims:t};return U.runKernel(cD,a,i)}var Hu=H({max_:Vne});function Gne(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=P(n,"x","min"),a={x:r},i={axis:e,keepDims:t};return U.runKernel(vD,a,i)}var x0=H({min_:Gne});function Une(n,e){var t,r=P(n,"base","pow"),a=P(e,"exp","pow");t=ke(vn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return U.runKernel(_D,i)}var jl=H({pow_:Une});function Rt(n,e){if((er(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&er(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],r=[];return Ro(n,t,r,e)}function Hne(n){var e=P(n,"x","sqrt","float32"),t={x:e};return U.runKernel(r3,t)}var Yi=H({sqrt_:Hne});function Kne(n){var e=P(n,"x","square"),t={};return U.runKernel("Square",{x:e},t)}var ri=H({square_:Kne});function jne(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=P(n,"x","sum");r.dtype==="bool"&&(r=Nn(r,"int32"));var a={x:r},i={axis:e,keepDims:t};return U.runKernel(a3,a,i)}var Vt=H({sum_:jne});function Xne(n,e,t,r){e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1),n=P(n,"x","norm");var a=dF(n,e,t),i=a.shape;if(r){var o=ef(t,n.shape);i=sf(a.shape,o)}return ve(a,i)}function dF(n,e,t){if(t===void 0&&(t=null),n.rank===0)return ua(n);if(n.rank!==1&&t===null)return dF(ve(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Vt(ua(n),t);if(e===1/0)return Hu(ua(n),t);if(e===-1/0)return x0(ua(n),t);if(e==="euclidean"||e===2)return Yi(Vt(jl(ua(n),Rt(2,"int32")),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}if(Array.isArray(t)&&t.length===2){if(e===1)return Hu(Vt(ua(n),t[0]),t[1]-1);if(e===1/0)return Hu(Vt(ua(n),t[1]),t[0]);if(e===-1/0)return x0(Vt(ua(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return Yi(Vt(ri(n),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}throw new Error("Error in norm: invalid axis: ".concat(t))}var id=H({norm_:Xne});function Yne(n,e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),id(n,"euclidean",e,t)}var Zne=H({euclideanNorm_:Yne});function Jne(n){var e=P(n,"x","exp"),t={x:e};return U.runKernel(P_,t)}var xs=H({exp_:Jne});function Qne(n,e){e===void 0&&(e=0);var t=P(n,"x","expandDims","string_or_numeric");q(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var r={input:t},a={dim:e};return U.runKernel(M_,r,a)}var hs=H({expandDims_:Qne});function ere(n){var e=P(n,"x","expm1"),t={x:e};return U.runKernel(B_,t)}var tre=H({expm1_:ere});function nre(n,e){var t=P(n,"x","tile","string_or_numeric");q(t.rank===e.length,function(){return"Error in transpose: rank of input ".concat(t.rank," ")+"must match length of reps ".concat(e,".")});var r={x:t},a={reps:e};return U.runKernel(D0,r,a)}var Ll=H({tile_:nre});function rre(n,e,t,r){r===void 0&&(r="float32"),e==null&&(e=n);for(var a=Xi([n,e],r),i=n<=e?n:e,o=0;o<i;++o)a.set(1,o,o);var s=ve(a.toTensor(),[n,e]);if(t==null)return s;if(t.length===1)return Ll(hs(s,0),[t[0],1,1]);if(t.length===2)return Ll(hs(hs(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return Ll(hs(hs(hs(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(t.length,"D."))}var vF=H({eye_:rre});function are(n){var e=P(n,"x","floor","float32"),t={x:e};return U.runKernel(q_,t)}var mF=H({floor_:are});function ire(n,e,t,r){t===void 0&&(t=0),r===void 0&&(r=0);var a=P(n,"x","gather"),i=P(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:r};return U.runKernel(G_,o,s)}var gF=H({gather_:ire});function ore(n,e){var t,r=P(n,"a","greater","string_or_numeric"),a=P(e,"b","greater","string_or_numeric");t=ke(vn(r,a),2),r=t[0],a=t[1],Bn(r.shape,a.shape);var i={a:r,b:a};return U.runKernel(H_,i)}var od=H({greater_:ore});function sre(n,e){var t,r=P(n,"a","greaterEqual","string_or_numeric"),a=P(e,"b","greaterEqual","string_or_numeric");t=ke(vn(r,a),2),r=t[0],a=t[1],Bn(r.shape,a.shape);var i={a:r,b:a};return U.runKernel(K_,i)}var yF=H({greaterEqual_:sre});function ure(n){var e=P(n,"input","imag"),t={input:e};return U.runKernel(X_,t)}var sd=H({imag_:ure});function cre(n){var e=P(n,"x","isFinite"),t={x:e};return U.runKernel(Y_,t)}var lre=H({isFinite_:cre});function fre(n){var e=P(n,"x","isInf"),t={x:e};return U.runKernel(Z_,t)}var hre=H({isInf_:fre});function pre(n){var e=P(n,"x","isNaN"),t={x:e};return U.runKernel(J_,t)}var dre=H({isNaN_:pre});function vre(n,e){e===void 0&&(e=.2);var t=P(n,"x","leakyRelu"),r={x:t},a={alpha:e};return U.runKernel(Q_,r,a)}var bF=H({leakyRelu_:vre});function mre(n,e){var t,r=P(n,"a","less","string_or_numeric"),a=P(e,"b","less","string_or_numeric");t=ke(vn(r,a),2),r=t[0],a=t[1],Bn(r.shape,a.shape);var i={a:r,b:a};return U.runKernel(eD,i)}var gre=H({less_:mre});function yre(n,e){var t,r=P(n,"a","lessEqual","string_or_numeric"),a=P(e,"b","lessEqual","string_or_numeric");t=ke(vn(r,a),2),r=t[0],a=t[1],Bn(r.shape,a.shape);var i={a:r,b:a};return U.runKernel(tD,i)}var V0=H({lessEqual_:yre});function bre(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");var r={start:n,stop:e,num:t};return U.runKernel(nD,{},r)}function wre(n,e,t,r,a){e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),a===void 0&&(a=.5);var i=P(n,"x","localResponseNormalization");q(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `.concat(i.rank,".")}),q(Ku(e),function(){return"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(e,".")});var o=i,s=!1;i.rank===3&&(s=!0,o=ve(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:e,bias:t,alpha:r,beta:a},l=U.runKernel(uD,u,c);return s?ve(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var xre=H({localResponseNormalization_:wre});function kre(n){var e=P(n,"x","log","float32"),t={x:e};return U.runKernel(rD,t)}var Xl=H({log_:kre});function Sre(n){var e=P(n,"x","log1p"),t={x:e};return U.runKernel(aD,t)}var wF=H({log1p_:Sre});function Nre(n){return q(Co(n),function(){return"The f passed in grad(f) must be a function"}),function(e,t){var r=P(e,"x","tf.grad","string_or_numeric"),a=t!=null?P(t,"dy","tf.grad"):null;return U.tidy(function(){var i=U.gradients(function(){return n(r)},[r],a),o=i.value,s=i.grads;return a!=null&&mr(o.shape,a.shape,"The shape of dy passed in grad(f)(x, dy) must match the shape returned by f(x)"),ud(s),s[0]})}}function Tre(n){return q(Co(n),function(){return"The f passed in grads(f) must be a function"}),function(e,t){q(Array.isArray(e),function(){return"The args passed in grads(f)(args) must be an array of `Tensor`s or `TensorLike`s"});var r=Gl(e,"args","tf.grads","string_or_numeric"),a=t!=null?P(t,"dy","tf.grads"):null;return U.tidy(function(){var i=U.gradients(function(){return n.apply(void 0,wt([],ke(r),!1))},r,a),o=i.value,s=i.grads;return a!=null&&mr(o.shape,a.shape,"The shape of dy passed in grads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),ud(s),s})}}function Ere(n){return q(Co(n),function(){return"The f passed in valueAndGrad(f) must be a function"}),function(e,t){q(e instanceof Pn,function(){return"The x passed in valueAndGrad(f)(x) must be a tensor"}),q(t==null||t instanceof Pn,function(){return"The dy passed in valueAndGrad(f)(x, dy) must be a tensor"});var r=U.gradients(function(){return n(e)},[e],t),a=r.grads,i=r.value;return ud(a),{grad:a[0],value:i}}}function Ire(n){return q(Co(n),function(){return"The f passed in valueAndGrads(f) must be a function"}),function(e,t){q(Array.isArray(e)&&e.every(function(a){return a instanceof Pn}),function(){return"The args passed in valueAndGrads(f)(args) must be array of tensors"}),q(t==null||t instanceof Pn,function(){return"The dy passed in valueAndGrads(f)(args, dy) must be a tensor"});var r=U.gradients(function(){return n.apply(void 0,wt([],ke(e),!1))},e,t);return t!=null&&mr(r.value.shape,t.shape,"The shape of dy passed in valueAndGrads(f)([x1,...], dy) must match the shape returned by f([x1,...])"),ud(r.grads),r}}function xF(n,e){q(Co(n),function(){return"The f passed in variableGrads(f) must be a function"}),q(e==null||Array.isArray(e)&&e.every(function(f){return f instanceof Vl}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t){e=[];for(var r in U.registeredVariables)e.push(U.registeredVariables[r])}var a=t?e.filter(function(f){return!f.trainable}):null,i=e.length;e=e.filter(function(f){return f.trainable}),q(e.length>0,function(){return"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(i," variables is ")+"trainable."});var o=!0,s=U.gradients(n,e,null,o),u=s.value,c=s.grads;q(c.some(function(f){return f!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),q(u.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(u.rank," tensor")});var l={};return e.forEach(function(f,h){c[h]!=null&&(l[f.name]=c[h])}),a?.forEach(function(f){return l[f.name]=null}),{value:u,grads:l}}function Ai(n){return U.customGrad(n)}function ud(n){var e=n.filter(function(t){return t==null}).length;if(e>0)throw new Error(`Cannot compute gradient of y=f(x) with respect to x. Make sure that
    the f you passed encloses all operations that lead from x to y.`)}function Cre(n){var e=P(n,"x","neg"),t={x:e};return U.runKernel(xD,t)}var ji=H({neg_:Cre});function Are(n){var e=P(n,"x","softplus"),t={x:e};return U.runKernel(n3,t)}var kF=H({softplus_:Are});function _re(n){var e=P(n,"x","logSigmoid"),t=Ai(function(r){var a=ji(kF(ji(r))),i=function(o){var s=Me(o,Uu(ji(r)));return s};return{value:a,gradFunc:i}});return t(e)}var Dre=H({logSigmoid_:_re});function Fre(n,e){var t,r=P(n,"a","sub"),a=P(e,"b","sub");t=ke(vn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return U.runKernel(y3,i)}var bt=H({sub_:Fre});function Rre(n,e){e===void 0&&(e=-1);var t=P(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and axis was ").concat(e));var r=Ai(function(a,i){var o=!0,s=Hu(a,e,!0),u=bt(a,s),c=bt(Nn(u,"float32"),Xl(Vt(xs(u),e,o)));i([c]);var l=function(f,h){var p=ke(h,1),d=p[0],v=!0,m=xs(d);return bt(f,Me(Vt(f,e,v),m))};return{value:c,gradFunc:l}});return r(t)}var Ore=H({logSoftmax_:Rre});function Pre(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=P(n,"x","logSumExp"),a=ef(e,r.shape),i=Hu(r,a,!0),o=bt(r,i),s=xs(o),u=Vt(s,a),c=Xl(u),l=ut(ve(i,c.shape),c);if(t){var f=sf(l.shape,a);return ve(l,f)}return l}var SF=H({logSumExp_:Pre});function Mre(n,e){var t=P(n,"a","logicalAnd","bool"),r=P(e,"b","logicalAnd","bool");Bn(t.shape,r.shape);var a={a:t,b:r};return U.runKernel(iD,a)}var Kp=H({logicalAnd_:Mre});function Bre(n){var e=P(n,"x","logicalNot","bool"),t={x:e};return U.runKernel(oD,t)}var NF=H({logicalNot_:Bre});function Lre(n,e){var t=P(n,"a","logicalOr","bool"),r=P(e,"b","logicalOr","bool");Bn(t.shape,r.shape);var a={a:t,b:r};return U.runKernel(sD,a)}var TF=H({logicalOr_:Lre});function zre(n,e){var t=P(n,"a","logicalXor","bool"),r=P(e,"b","logicalXor","bool");return Bn(t.shape,r.shape),Kp(TF(n,e),NF(Kp(n,e)))}var $re=H({logicalXor_:zre});var Rp=2147483648;function qre(n,e,t){t===void 0&&(t="left");var r=P(n,"sortedSequence","searchSorted"),a=P(e,"values","searchSorted"),i=r.shape[r.shape.length-1],o=a.shape[a.shape.length-1],s=ve(r,[-1,i]),u=ve(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(Ut(u.shape)>=Rp)throw new Error("values tensor size must less than ".concat(Rp));if(s.shape[1]>=Rp)throw new Error("trailing dim_size must less than ".concat(Rp," for int32 output type, was ").concat(s.shape[1]));var c={sortedSequence:s,values:u},l={side:t};return U.runKernel(jD,c,l)}var G0=H({searchSorted_:qre});function Wre(n,e){return G0(n,e,"left")}function Vre(n,e,t,r,a){var i=P(n,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=ve(i,[1,i.shape[0],i.shape[1],i.shape[2]])),q(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(s.rank,".")}),q(Ji(t,o),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")}),Ca("maxPool",r,a);var c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a},f=U.runKernel(fD,c,l);return u?ve(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var EF=H({maxPool_:Vre});function Gre(n,e,t,r,a,i){e===void 0&&(e=[1,1,1]),i===void 0&&(i="NDHWC");var o=P(n,"x","maxPool3d"),s=o,u=!1;o.rank===4&&(u=!0,s=ve(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),q(s.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),q(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),Ca("maxPool3d",r,a);var c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a,dataFormat:i},f=U.runKernel(hD,c,l);return u?ve(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var Ure=H({maxPool3d_:Gre});function Hre(n,e,t,r,a){a===void 0&&(a=!1);var i=P(n,"x","maxPoolWithArgmax"),o={x:i},s={filterSize:e,strides:t,pad:r,includeBatchInIndex:a},u=U.runKernel(pD,o,s);return{result:u[0],indexes:u[1]}}var Kre=H({maxPoolWithArgmax_:Hre});function jre(n,e){var t,r=P(n,"a","maximum"),a=P(e,"b","maximum");t=ke(vn(r,a),2),r=t[0],a=t[1],r.dtype==="bool"&&(r=Nn(r,"int32"),a=Nn(a,"int32")),Bn(r.shape,a.shape);var i={a:r,b:a};return U.runKernel(lD,i)}var IF=H({maximum_:jre});function Xre(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=P(n,"x","mean"),a={x:r},i={axis:e,keepDims:t};return U.runKernel(dD,a,i)}var jp=H({mean_:Xre});function Zu(n,e){if(e===void 0&&(e="float32"),Vr(n),e==="complex64"){var t=Zu(n,"float32"),r=Zu(n,"float32");return _o(t,r)}var a=Qp(Ut(n),e);return U.makeTensor(a,n,e)}function ms(n,e){if(e===void 0&&(e="float32"),Vr(n),e==="complex64"){var t=ms(n,"float32"),r=Zu(n,"float32");return _o(t,r)}var a=E0(Ut(n),e);return U.makeTensor(a,n,e)}function Yre(n,e,t){var r=t===void 0?{}:t,a=r.indexing,i=a===void 0?"xy":a;if(i!=="xy"&&i!=="ij")throw new TypeError("".concat(i," is not a valid third argument to meshgrid"));if(n===void 0)return[];var o=P(n,"x","meshgrid",n instanceof Pn?n.dtype:"float32");if(e===void 0)return[o];var s=P(e,"y","meshgrid",e instanceof Pn?e.dtype:"float32"),u=Ut(o.shape),c=Ut(s.shape);return i==="xy"?(o=ve(o,[1,-1]),s=ve(s,[-1,1]),[Ft(ms([c,1],o.dtype),o),Ft(s,ms([1,u],s.dtype))]):(o=ve(o,[-1,1]),s=ve(s,[1,-1]),[Ft(o,ms([1,c],o.dtype)),Ft(ms([u,1],s.dtype),s)])}function Zre(n,e){var t,r=P(n,"a","minimum"),a=P(e,"b","minimum");t=ke(vn(r,a),2),r=t[0],a=t[1],r.dtype==="bool"&&(r=Nn(r,"int32"),a=Nn(a,"int32")),Bn(r.shape,a.shape);var i={a:r,b:a};return U.runKernel(mD,i)}var CF=H({minimum_:Zre});function Jre(n,e,t){q(t==="reflect"||t==="symmetric",function(){return"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(t,".")});var r=P(n,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");q(e.length===r.rank,function(){return"Padding doesn't match input. Must be ".concat(r.rank,". ")+"Got ".concat(e.length,".")});for(var a=t==="reflect"?1:0,i=function(c){q(e[c].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),q(e[c][0]>=0&&e[c][0]<=r.shape[c]-a&&e[c][1]>=0&&e[c][1]<=r.shape[c]-a,function(){return"Padding in dimension ".concat(c," cannot be greater than or equal ")+"to ".concat(r.shape[c]-a," or less than 0 for input of ")+"shape ".concat(r.shape)})},o=0;o<r.rank;o++)i(o);var s={paddings:e,mode:t},u={x:r};return U.runKernel(gD,u,s)}var Qre=H({mirrorPad_:Jre});function eae(n,e){var t,r=P(n,"a","mod"),a=P(e,"b","mod");t=ke(vn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return U.runKernel(yD,i)}var tae=H({mod_:eae});function nae(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1),n=P(n,"x","moments");var r=ef(e,n.shape),a=jp(n,r,t),i=a.shape;t||(i=sf(a.shape,r));var o=ri(bt(Nn(n,"float32"),ve(a,i))),s=jp(o,r,t);return{mean:a,variance:s}}var rae=H({moments_:nae});function aae(n,e,t,r){for(var a=P(e,"data","multiRNNCell"),i=Gl(t,"c","multiRNNCell"),o=Gl(r,"h","multiRNNCell"),s=a,u=[],c=0;c<n.length;c++){var l=n[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}for(var f=[],h=[],c=0;c<u.length;c+=2)f.push(u[c]),h.push(u[c+1]);return[f,h]}var iae=H({multiRNNCell_:aae});function oae(n,e,t,r){r===void 0&&(r=!1);var a=P(n,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+"".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));t=t||Math.random();var s=o===1?ve(a,[1,-1]):a,u={logits:s},c={numSamples:e,seed:t,normalized:r},l=U.runKernel(bD,u,c);return o===1?ve(l,[l.size]):l}var sae=H({multinomial_:oae});function uae(n,e){var t,r=P(n,"a","notEqual","string_or_numeric"),a=P(e,"b","notEqual","string_or_numeric");t=ke(vn(r,a),2),r=t[0],a=t[1],Bn(r.shape,a.shape);var i={a:r,b:a};return U.runKernel(kD,i)}var AF=H({notEqual_:uae});function cae(n,e,t,r,a){if(t===void 0&&(t=1),r===void 0&&(r=0),a===void 0&&(a="int32"),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(e));var i=P(n,"indices","oneHot","int32"),o={indices:i},s={dtype:a,depth:e,onValue:t,offValue:r};return U.runKernel(ID,o,s)}var k0=H({oneHot_:cae});function lae(n){var e=P(n,"x","onesLike"),t={x:e};return U.runKernel(ED,t)}var fae=H({onesLike_:lae});function hae(n,e){var t=P(n,"v1","outerProduct"),r=P(e,"v2","outerProduct");q(t.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+"".concat(t.rank," and ").concat(r.rank,".")});var a=ve(t,[-1,1]),i=ve(r,[1,-1]);return Ft(a,i)}var pae=H({outerProduct_:hae});function dae(n,e,t){t===void 0&&(t=0);var r=P(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:r};return U.runKernel(AD,i,a)}var uf=H({pad_:dae});function vae(n,e,t){return t===void 0&&(t=0),q(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),uf(n,[e],t)}var mae=H({pad1d_:vae});function gae(n,e,t){return t===void 0&&(t=0),q(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),uf(n,e,t)}var yae=H({pad2d_:gae});function bae(n,e,t){return t===void 0&&(t=0),q(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),uf(n,e,t)}var wae=H({pad3d_:bae});function xae(n,e,t){return t===void 0&&(t=0),q(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),uf(n,e,t)}var kae=H({pad4d_:xae});function Sae(n,e,t){var r=P(n,"x","spaceToBatchND");q(r.rank>=1+e.length,function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(e.length)}),q(t.length===e.length,function(){return"paddings.shape[0] ".concat(t.length," must be equal to [blockShape] ").concat(e.length)}),q(r.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(t.toString()," must be divisible by blockShapes ").concat(e.toString())});var a={x:r},i={blockShape:e,paddings:t};return U.runKernel(i3,a,i)}var _F=H({spaceToBatchND_:Sae});function Nae(n,e,t,r,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),r===0&&(r="valid");var s=P(n,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=ve(s,[1,s.shape[0],s.shape[1],s.shape[2]])),q(Ji(i,a),function(){return"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'")});var l=rF(u.shape,e,i,a,r),f=[l.dilationHeight,l.dilationWidth],h;r==="same"?h=Eae([l.filterHeight,l.filterWidth],f):h=[[0,0],[0,0]];var p=f[0]===1&&f[1]===1,d=ke(Tae([l.inHeight,l.inWidth],f,h),2),v=d[0],m=d[1],g=p?r:"valid",y=p?u:_F(u,f,v),b=t==="avg"?function(){return oF(y,e,i,g,o)}:function(){return EF(y,e,i,g,o)},w=b(),x=p?w:sF(w,f,m);return c?ve(x,[x.shape[1],x.shape[2],x.shape[3]]):x}function Tae(n,e,t){var r=t.map(function(l){return l[0]}),a=t.map(function(l){return l[1]}),i=n.concat(r,a),o=e.map(function(l,f){return(l-i[f]%l)%l}),s=a.map(function(l,f){return l+o[f]}),u=e.map(function(l,f){return[r[f],s[f]]}),c=e.map(function(l,f){return[0,o[f]]});return[u,c]}function Eae(n,e){var t=n.map(function(o,s){return o+(o-1)*(e[s]-1)}),r=t.map(function(o){return o-1}),a=r.map(function(o){return Math.floor(o/2)}),i=r.map(function(o,s){return o-a[s]});return r.map(function(o,s){return[a[s],i[s]]})}var Iae=H({pool_:Nae});function Cae(n,e){var t=P(n,"x","prelu"),r=P(e,"alpha","prelu"),a={x:t,alpha:r};return U.runKernel(DD,a)}var DF=H({prelu_:Cae});function Aae(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=P(n,"x","prod");r.dtype==="bool"&&(r=Nn(r,"int32"));var a={x:r},i={axis:e,keepDims:t};return U.runKernel(FD,a,i)}var _ae=H({prod_:Aae});function Dae(n,e,t,r){var a=n.map(function(l,f){return P(l,"tensors".concat(f),"raggedGather","int32")}),i=P(e,"paramsDenseValues","raggedGather"),o=P(t,"indices","raggedGather","int32"),s={paramsNestedSplits:a,paramsDenseValues:i,indices:o},u={outputRaggedRank:r},c=U.runKernel(RD,s,u);return{outputNestedSplits:c.slice(0,c.length-1),outputDenseValues:c[c.length-1]}}var Fae=H({raggedGather_:Dae});function Rae(n,e,t){var r=P(n,"starts","raggedRange"),a=P(e,"limits","raggedRange",r.dtype),i=P(t,"deltas","raggedRange",r.dtype),o={starts:r,limits:a,deltas:i},s=U.runKernel(OD,o);return{rtNestedSplits:s[0],rtDenseValues:s[1]}}var Oae=H({raggedRange_:Rae});function Pae(n,e,t,r,a){var i=P(n,"shape","raggedTensorToTensor","int32"),o=P(e,"values","raggedTensorToTensor"),s=P(t,"defaultValue","raggedTensorToTensor",o.dtype),u=r.map(function(f,h){return P(f,"tensors".concat(h),"raggedTensorToTensor","int32")}),c={shape:i,values:o,defaultValue:s,rowPartitionTensors:u},l={rowPartitionTypes:a};return U.runKernel(PD,c,l)}var Mae=H({raggedTensorToTensor_:Pae});function Bae(n,e,t){Vr(n);var r=Ut(n),a=null;if(t==null||t==="float32")a=new Float32Array(r);else if(t==="int32")a=new Int32Array(r);else if(t==="bool")a=new Uint8Array(r);else throw new Error("Unknown data type ".concat(t));for(var i=0;i<r;i++)a[i]=e();return U.makeTensor(a,n,t)}var Lae=H({rand_:Bae}),Ts=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Es(n){var e={exports:{}};return n(e,e.exports),e.exports}var zae=Es(function(n){(function(e,t,r){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.alea=o})(Ts,n,!1)}),$ae=Es(function(n){(function(e,t,r){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor128=o})(Ts,n,!1)}),qae=Es(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorwow=o})(Ts,n,!1)}),Wae=Es(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,p;return h=l[f],h^=h>>>7,p=h^h<<24,h=l[f+1&7],p^=h^h>>>10,h=l[f+3&7],p^=h^h>>>3,h=l[f+4&7],p^=h^h<<7,h=l[f+7&7],h=h^h<<13,p^=h^h<<9,l[f]=p,u.i=f+1&7,p};function c(l,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8&&(p[7]=-1),l.x=p,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorshift7=o})(Ts,n,!1)}),Vae=Es(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,p,d;return u.w=l=l+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(l^l>>>16)|0};function c(l,f){var h,p,d,v,m,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,v=-32;v<y;++v)f&&(p^=f.charCodeAt((v+32)%f.length)),v===0&&(m=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,v>=0&&(m=m+1640531527|0,h=g[v&127]^=p+m,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,v=4*128;v>0;--v)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;l.w=m,l.X=g,l.i=d}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor4096=o})(Ts,n,!1)}),Gae=Es(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.tychei=o})(Ts,n,!1)}),Is=Es(function(n){(function(e,t,r){var a=256,i=6,o=52,s="random",u=r.pow(a,i),c=r.pow(2,o),l=c*2,f=a-1,h;function p(w,x,N){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(m(x.entropy?[w,b(t)]:w??y(),3),T),C=new d(T),F=function(){for(var D=C.g(i),O=u,L=0;D<c;)D=(D+L)*a,O*=a,L=C.g(1);for(;D>=l;)D/=2,O/=2,L>>>=1;return(D+L)/O};return F.int32=function(){return C.g(4)|0},F.quick=function(){return C.g(4)/4294967296},F.double=F,g(b(C.S),t),(x.pass||N||function(D,O,L,z){return z&&(z.S&&v(z,C),D.state=function(){return v(C,{})}),L?(r[s]=D,O):D})(F,E,"global"in x?x.global:this==r,x.state)}function d(w){var x,N=w.length,T=this,E=0,C=T.i=T.j=0,F=T.S=[];for(N||(w=[N++]);E<a;)F[E]=E++;for(E=0;E<a;E++)F[E]=F[C=f&C+w[E%N]+(x=F[E])],F[C]=x;(T.g=function(D){for(var O,L=0,z=T.i,$=T.j,B=T.S;D--;)O=B[z=f&z+1],L=L*a+B[f&(B[z]=B[$=f&$+O])+(B[$]=O)];return T.i=z,T.j=$,L})(a)}function v(w,x){return x.i=w.i,x.j=w.j,x.S=w.S.slice(),x}function m(w,x){var N=[],T=typeof w,E;if(x&&T=="object")for(E in w)try{N.push(m(w[E],x-1))}catch{}return N.length?N:T=="string"?w:w+"\0"}function g(w,x){for(var N=w+"",T,E=0;E<N.length;)x[f&E]=f&(T^=x[f&E]*19)+N.charCodeAt(E++);return b(x)}function y(){try{var w;return h&&(w=h.randomBytes)?w=w(a):(w=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var x=e.navigator,N=x&&x.plugins;return[+new Date,e,N,e.screen,b(t)]}}function b(w){return String.fromCharCode.apply(0,w)}if(g(r.random(),t),n.exports){n.exports=p;try{h=Dp()}catch{}}else r["seed"+s]=p})(typeof self<"u"?self:Ts,[],Math)});Is.alea=zae;Is.xor128=$ae;Is.xorwow=qae;Is.xorshift7=Wae;Is.xor4096=Vae;Is.tychei=Gae;var U0=Is,Uae=.001,FF=.1;function Hae(n,e,t){return t==null&&(t=H0()),S0(n,e,function(r,a){return K0(r,a,t)})}function H0(){return U.backend.floatPrecision()===32?Uae:FF}function S0(n,e,t){var r=!0;if((er(n)||er(e))&&(r=!1),er(n)&&er(e)&&(r=!0),r){var a=n.constructor.name,i=e.constructor.name;if(a!==i)throw new Error("Arrays are of different type. Actual: ".concat(a,". ")+"Expected: ".concat(i))}if(Array.isArray(n)&&Array.isArray(e)){var o=Ci(n),s=Ci(e);if(!Fo(o,s))throw new Error("Arrays have different shapes. "+"Actual: [".concat(o,"]. Expected: [").concat(s,"]"))}var u=er(n)?n:Ao(n),c=er(e)?e:Ao(e);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: ".concat(u.length," vs ")+"expected: ".concat(c.length,`.
`)+"Actual:   ".concat(u,`.
`)+"Expected: ".concat(c,"."));for(var l=0;l<c.length;++l){var f=u[l],h=c[l];if(!t(f,h))throw new Error("Arrays differ: actual[".concat(l,"] = ").concat(f,", expected[").concat(l,"] = ").concat(h,`.
`)+"Actual:   ".concat(u,`.
`)+"Expected: ".concat(c,"."))}typeof expect<"u"&&expect().nothing()}function Kae(n,e){n().then(function(){return e.fail()},function(){return e()}),typeof expect<"u"&&expect().nothing()}function jae(n,e){var t=typeof e=="string"||typeof e=="number"||typeof e=="boolean"?[e]:e;return To(n)||To(n[0])||To(e)||To(e[0])?S0(n,t,function(r,a){return r==a}):S0(n,e,function(r,a){return K0(r,a,0)})}function Xae(n,e,t){if(t==null&&(t=H0()),!K0(n,e,t))throw new Error("Numbers differ: actual === ".concat(n,", expected === ").concat(e));typeof expect<"u"&&expect().nothing()}function K0(n,e,t){return!isFinite(n)&&!isFinite(e)?!0:!(isNaN(n)||isNaN(e)||Math.abs(n-e)>t)}function Yae(n,e,t){for(var r=0;r<n.length;r++)if(n[r]<e||n[r]>t)throw new Error("Value out of range:".concat(n[r]," low: ").concat(e,", high: ").concat(t))}function Zae(n,e){var t=new Float32Array(n),r=new Float32Array(e);if(t.length!==r.length)throw new Error("Expected ArrayBuffer to be of length "+"".concat(r.length,", but it was ").concat(t.length));for(var a=0;a<r.length;a++)if(t[a]!==r[a])throw new Error("Expected ArrayBuffer value at ".concat(a," to be ")+"".concat(r[a]," but got ").concat(t[a]," instead"))}function RF(n){for(var e=0;e<n.length;e++){var t=n[e];Array.isArray(t)?RF(t):n[e]=nf(t)}return n}function Jae(n){var e=document.createElement("video");return"playsInline"in e&&(e.playsInline=!0),e.muted=!0,e.loop=!0,e.style.position="fixed",e.style.left="0px",e.style.top="0px",e.preload="auto",e.appendChild(n),new Promise(function(t){e.addEventListener("loadeddata",function(r){return t(e)}),e.load()})}function Qae(n){return je(this,void 0,void 0,function(){return Xe(this,function(e){switch(e.label){case 0:return[4,n.play()];case 1:return e.sent(),"requestVideoFrameCallback"in n?[4,new Promise(function(t){n.requestVideoFrameCallback(t)})]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})}var eie={__proto__:null,TEST_EPSILON_FLOAT16:FF,expectArraysClose:Hae,testEpsilon:H0,expectPromiseToFail:Kae,expectArraysEqual:jae,expectNumbersClose:Xae,expectValuesInRange:Yae,expectArrayBuffersEqual:Zae,encodeStrings:RF,createVideoElement:Jae,play:Qae};var j0=function(){function n(e,t,r,a,i){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);var o=i||Math.random();this.random=U0.alea(o.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,r,a=!1;!a;){var i=void 0,o=void 0,s=void 0;do i=2*this.random()-1,o=2*this.random()-1,s=i*i+o*o;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*i*u,r=this.mean+this.stdDev*o*u,(!this.truncated||this.isValidTruncated(t))&&(a=!0)}return(!this.truncated||this.isValidTruncated(r))&&(this.nextVal=this.convertValue(r)),this.convertValue(t)},n.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},n.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},n}(),tie=function(){function n(e,t,r,a){this.alpha=e,this.beta=1/t,this.dtype=r;var i=a||Math.random();this.randu=U0.alea(i.toString()),this.randn=new j0(0,1,r,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var e,t,r,a,i,o;;){do a=this.randn.nextValue(),o=1+this.c*a;while(o<=0);if(o*=o*o,e=a*a,t=1-.331*e*e,r=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<t||Math.log(i)<r)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},n.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},n}(),nie=function(){function n(e,t,r,a){e===void 0&&(e=0),t===void 0&&(t=1);var i=this;if(this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=r,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(e," - ").concat(t," <= 1 and dtype is not float"));this.random=U0.alea(a)}return n.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n}();function rie(n,e,t,r,a){if(t===void 0&&(t=1),r===void 0&&(r="float32"),Vr(n),t==null&&(t=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type ".concat(r));for(var i=new tie(e,t,r,a),o=Xi(n,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var aie=H({randomGamma_:rie});function iie(n,e,t,r,a){if(e===void 0&&(e=0),t===void 0&&(t=1),Vr(n),r!=null&&r==="bool")throw new Error("Unsupported data type ".concat(r));for(var i=new j0(e,t,r,!1,a),o=Xi(n,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var OF=H({randomNormal_:iie});function oie(n,e,t){if(e!=null&&e==="bool")throw new Error("Unsupported data type ".concat(e));return OF(n,0,1,e,t)}var sie=H({randomStandardNormal_:oie});function uie(n,e,t,r,a){e===void 0&&(e=0),t===void 0&&(t=1),r===void 0&&(r="float32"),Vr(n);for(var i=Xi(n,r),o=new nie(e,t,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}var PF=H({randomUniform_:uie});function Yl(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t===0)throw new Error("Cannot have a step of zero");var a={start:n,stop:e,step:t,dtype:r};return U.runKernel(MD,{},a)}function cie(n){var e=P(n,"input","real"),t={input:e};return U.runKernel(BD,t)}var Zl=H({real_:cie});function lie(n){var e=P(n,"x","reciprocal"),t={x:e};return U.runKernel(LD,t)}var fie=H({reciprocal_:lie});function hie(n){var e=P(n,"x","relu"),t={x:e};return U.runKernel(zD,t)}var cd=H({relu_:hie});function pie(n){var e=P(n,"x","relu6"),t={x:e};return U.runKernel(VD,t)}var MF=H({relu6_:pie});function die(n,e){var t=P(n,"x","reverse"),r={x:t},a={dims:e};return U.runKernel(GD,r,a)}var ks=H({reverse_:die});function vie(n){var e=P(n,"x","reverse");return q(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(e.rank,".")}),ks(e,0)}var mie=H({reverse1d_:vie});function gie(n,e){var t=P(n,"x","reverse");return q(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(t.rank,".")}),ks(t,e)}var yie=H({reverse2d_:gie});function bie(n,e){var t=P(n,"x","reverse");return q(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(t.rank,".")}),ks(t,e)}var wie=H({reverse3d_:bie});function xie(n,e){var t=P(n,"x","reverse");return q(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(t.rank,".")}),ks(t,e)}var kie=H({reverse4d_:xie});function Sie(n){var e=P(n,"x","round"),t={x:e};return U.runKernel(UD,t)}var BF=H({round_:Sie});function Nie(n){var e=P(n,"x","rsqrt","float32"),t={x:e};return U.runKernel(HD,t)}var Tie=H({rsqrt_:Nie});function Eie(n){var e=P(n,"x","selu"),t={x:e};return U.runKernel(YD,t)}var Iie=H({selu_:Eie});function Cie(n,e,t,r,a,i,o){i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC");var s=P(n,"x","separableConv2d"),u=P(e,"depthwiseFilter","separableConv2d"),c=P(t,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(s.rank===3&&(f=!0,l=ve(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");q(l.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(l.rank,".")}),q(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),q(c.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),q(c.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(c.shape[0],".")}),q(c.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(c.shape[1],".")});var h=u.shape[2],p=u.shape[3];q(c.shape[2]===h*p,function(){return"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(h*p,", ")+"but got ".concat(c.shape[2],".")});var d=$0(l,u,r,a,o,i),v=1,m=ad(d,c,v,"valid",o);return f?ve(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var Aie=H({separableConv2d_:Cie});function _ie(n,e){return je(this,void 0,void 0,function(){var t,r,a,i,o,s,l,u,c,l,f;return Xe(this,function(h){switch(h.label){case 0:return t=P(n,"x","setdiff1d"),r=P(e,"y","setdiff1d"),q(t.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x (".concat(t.dtype,") and y (").concat(r.dtype,").")}),q(t.rank===1,function(){return"x should be 1D tensor, but got x (".concat(t.shape,").")}),q(r.rank===1,function(){return"y should be 1D tensor, but got y (".concat(r.shape,").")}),[4,t.data()];case 1:return a=h.sent(),[4,r.data()];case 2:for(i=h.sent(),o=new Set(i),s=0,l=0;l<a.length;l++)o.has(a[l])||s++;for(u=new Up([s],t.dtype),c=new Up([s],"int32"),l=0,f=0;l<a.length;l++)o.has(a[l])||(u.values[f]=a[l],c.values[f]=l,f++);return[2,[u.toTensor(),c.toTensor()]]}})})}var Die=_ie;function Fie(n){var e=P(n,"x","sign"),t={x:e};return U.runKernel(e3,t)}var Rie=H({sign_:Fie});function Oie(n){var e=P(n,"x","sin","float32"),t={x:e};return U.runKernel(JD,t)}var Pie=H({sin_:Oie});function Mie(n){var e=P(n,"x","sinh"),t={x:e};return U.runKernel(QD,t)}var Bie=H({sinh_:Mie});function Lie(n,e,t){var r=P(n,"x","slice1d");return q(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")}),un(r,[e],[t])}var zie=H({slice1d_:Lie});function $ie(n,e,t){var r=P(n,"x","slice2d");return q(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")}),un(r,e,t)}var qie=H({slice2d_:$ie});function Wie(n,e,t){var r=P(n,"x","slice3d");return q(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")}),un(r,e,t)}var Vie=H({slice3d_:Wie});function Gie(n,e,t){var r=P(n,"x","slice4d");return q(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")}),un(r,e,t)}var Uie=H({slice4d_:Gie});function Hie(n,e){e===void 0&&(e=-1);var t=P(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and dim was ").concat(e));var r={logits:t},a={dim:e};return U.runKernel(s3,r,a)}var Kie=H({softmax_:Hie});function jie(n){q(n.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(n.dtype,".")});var e={input:n};return U.runKernel(L_,e)}var X0=H({fft_:jie});function Xie(n){q(n.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(n.dtype,".")});var e={input:n};return U.runKernel(j_,e)}var Xp=H({ifft_:Xie});function Yie(n){var e=n.shape[n.shape.length-1],t=n.size/e,r;if(e<=2){var a=ve(n,[t,e]);r=Xp(a)}else{var i=[t,2*(e-1)],o=ve(Zl(n),[t,e]),s=ve(sd(n),[t,e]),u=ks(un(o,[0,1],[t,e-2]),1),c=Me(ks(un(s,[0,1],[t,e-2]),1),Rt(-1)),l=Wr([o,u],1),f=Wr([s,c],1),a=ve(_o(l,f),[i[0],i[1]]);r=Xp(a)}if(r=Zl(r),n.rank===3&&n.shape[0]!==0){var h=r,p=n.shape[0];r=ve(r,[p,r.shape[0]/p,r.shape[1]]),h.dispose()}return r}var LF=H({irfft_:Yie});function Zie(n,e,t){t===void 0&&(t=0);var r=P(n,"x","split"),a={x:r},i={numOrSizeSplits:e,axis:t};return U.runKernel(o3,a,i)}var Jl=H({split_:Zie});function Jie(n,e){q(n.dtype==="float32",function(){return"The dtype for rfft() must be real value but got ".concat(n.dtype)});var t=n.shape[n.shape.length-1],r=n.size/t,a;if(e!=null&&e<t){var i=n.shape.map(function(g){return 0}),o=n.shape.map(function(g){return g});o[n.shape.length-1]=e,a=un(n,i,o),t=e}else if(e!=null&&e>t){var s=n.shape.map(function(g){return g});s[n.shape.length-1]=e-t,a=Wr([n,Zu(s)],n.shape.length-1),t=e}else a=n;var u=ca(a),c=ve(_o(a,u),[r,t]),l=X0(c),f=Math.floor(t/2)+1,h=Zl(l),p=sd(l),d=Jl(h,[f,t-f],h.shape.length-1),v=Jl(p,[f,t-f],p.shape.length-1),m=a.shape.slice();return m[a.shape.length-1]=f,ve(_o(d[0],v[0]),m)}var Y0=H({rfft_:Jie});function Qie(n,e){var t,r=P(n,"a","squaredDifference"),a=P(e,"b","squaredDifference");t=ke(vn(r,a),2),r=t[0],a=t[1],Bn(r.shape,a.shape);var i={a:r,b:a},o={};return U.runKernel(p3,i,o)}var zF=H({squaredDifference_:Qie});function eoe(n,e){var t=P(n,"x","squeeze","string_or_numeric");return ve(t,FA(t.shape,e).newShape)}var Z0=H({squeeze_:eoe});function toe(n,e){e===void 0&&(e=0);var t=Gl(n,"tensors","stack","string_or_numeric");q(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&q(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var r=t,a={axis:e};return U.runKernel(CD,r,a)}var Ql=H({stack_:toe});function noe(n,e){e===void 0&&(e=0);var t=P(n,"x","step"),r={x:t},a={alpha:e};return U.runKernel(I3,r,a)}var $F=H({step_:noe});function roe(n,e,t,r,a,i,o,s,u){a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),u===void 0&&(u=0);var c=P(n,"x","stridedSlice","string_or_numeric"),l={x:c},f={begin:e,end:t,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return U.runKernel(d3,l,f)}var aoe=H({stridedSlice_:roe});function ioe(n){var e=P(n,"x","tan","float32"),t={x:e};return U.runKernel(b3,t)}var ooe=H({tan_:ioe});function ni(n,e){Ss(n);var t=Ci(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");var r=null;return Ro(n,r,t,e)}function zl(n,e,t){if(Ss(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=Ci(n,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Ro(n,e,r,t)}function qF(n,e,t){if(Ss(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=Ci(n,t);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Ro(n,e,r,t)}function soe(n,e,t){if(Ss(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=Ci(n,t);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Ro(n,e,r,t)}function uoe(n,e,t){if(Ss(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=Ci(n,t);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Ro(n,e,r,t)}function coe(n,e,t){if(Ss(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=Ci(n,t);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||r,Ro(n,e,r,t)}function loe(n,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var r=P(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(e<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(e));if(e>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") ")+"but got ".concat(e));var i={x:r},o={k:e,sorted:t},s=ke(U.runKernel(x3,i,o),2),u=s[0],c=s[1];return{values:u,indices:c}}var foe=H({topk_:loe});function hoe(n,e,t,r,a){if(e===void 0&&(e=0),t===void 0&&(t=1),Vr(n),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");for(var i=new j0(e,t,r,!0,a),o=Xi(n,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var poe=H({truncatedNormal_:hoe});function doe(n,e){e===void 0&&(e=0);var t=P(n,"x","unique","string_or_numeric");q(t.rank>0,function(){return"The input tensor must be at least 1D"});var r={x:t},a={axis:e},i=ke(U.runKernel(S3,r,a),2),o=i[0],s=i[1];return{values:o,indices:s}}var voe=H({unique_:doe});function moe(n,e,t){var r=P(n,"x","unsortedSegmentSum"),a=P(e,"segmentIds","unsortedSegmentSum","int32");q(Ku(t),function(){return"numSegments must be of dtype int"});var i={x:r,segmentIds:a},o={numSegments:t};return U.runKernel(T3,i,o)}var goe=H({unsortedSegmentSum_:moe});function yoe(n,e){e===void 0&&(e=0);var t=P(n,"x","unstack","string_or_numeric");q(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = ".concat(e," is not in [-").concat(t.shape.length,", ").concat(t.shape.length,")")});var r={value:t},a={axis:e};return U.runKernel(N3,r,a)}var J0=H({unstack_:yoe});function boe(n,e){return G0(n,e,"right")}function woe(n,e,t,r){return e===void 0&&(e=!0),U.makeVariable(n,e,t,r)}function WF(n,e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(r);for(var a=Xi(n,"int32"),i=Xi([t.length,n.length],"int32"),r=0;r<t.length;r++){var o=a.indexToLoc(t[r]),s=r*n.length;i.values.set(o,s)}return i.toTensor()}function xoe(n){return je(this,void 0,void 0,function(){var e,t,r;return Xe(this,function(a){switch(a.label){case 0:return e=P(n,"condition","whereAsync","bool"),[4,e.data()];case 1:return t=a.sent(),r=WF(e.shape,t),n!==e&&e.dispose(),[2,r]}})})}var VF=xoe;function koe(n,e,t){return je(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f,h,p,d,v;return Xe(this,function(m){switch(m.label){case 0:for(r=P(n,"tensor","boolMask"),a=P(e,"mask","boolMask","bool"),i=t??0,o=a.rank,s=r.shape,q(o>0,function(){return"mask cannot be scalar"}),mr(s.slice(i,i+o),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+o;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+o)),f=ve(r,l),h=ve(a,[-1]),[4,VF(h)];case 1:return p=m.sent(),d=Z0(p,[1]),v=gF(f,d,i),n!==r&&r.dispose(),e!==a&&a.dispose(),d.dispose(),f.dispose(),h.dispose(),p.dispose(),[2,v]}})})}var Soe=koe;function Noe(n,e,t){var r=P(n,"x","transpose");if(e==null&&(e=r.shape.map(function(o,s){return s}).reverse()),q(r.rank===e.length,function(){return"Error in transpose: rank of input ".concat(r.rank," ")+"must match length of perm ".concat(e,".")}),e.forEach(function(o){q(o>=0&&o<r.rank,function(){return"All entries in 'perm' must be between 0 and ".concat(r.rank-1)+" but got ".concat(e)})}),r.rank<=1)return r.clone();var a={x:r},i={perm:e};return r.dtype==="complex64"?Mn(function(){var o=Zl(r),s=sd(r);return o=U.runKernel(Op,{x:o},i),s=U.runKernel(Op,{x:s},i),t&&(s=ji(s)),_o(o,s)}):U.runKernel(Op,a,i)}var Yp=H({transpose_:Noe});function Toe(n,e,t,r,a){a===void 0&&(a=!0);var i=P(n,"v","movingAverage"),o=P(e,"x","movingAverage"),s=P(t,"decay","movingAverage");B3(i,o),q(Fo(i.shape,o.shape),function(){return"Shape mismatch in v and x"});var u=Rt(1),c=bt(u,s),l=Me(bt(o,i),c);if(a){q(r!=null,function(){return"When using zeroDebias: true, step is required."});var f=P(r,"step","movingAverage");l=Gt(l,bt(u,jl(s,f)))}return ut(i,l)}var Eoe=H({movingAverage_:Toe});function Q0(n,e,t){var r=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(t.shape)+", indices.shape: ".concat(e.shape,", shape: ").concat(n)+", sliceDim: ".concat(r,", and batchDim: ").concat(a,".");if(t.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(n.length<r+(t.rank-a))throw new Error(i+" Output shape length < ".concat(r+(t.rank-a)));if(t.rank!==a+n.length-r)throw new Error(i+" update.rank != ".concat(a+n.length-r));for(var o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(t.shape[o],") != indices.shape[").concat(o,"] (").concat(e.shape[o],")."));for(var o=0;o<t.rank-a;++o)if(t.shape[o+a]!==n[o+r])throw new Error(i+" updates.shape[".concat(o+a,"] (").concat(t.shape[o+a],") != shape[").concat(o+a,"] (").concat(n[o+a],")"))}function ey(n,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(n.rank,"."));if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(e.dtype));if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(t));if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: ".concat(e.shape));if(n.size===0)throw new Error("Updates specified for empty output. updates shape: ".concat(n.shape))}Q0(t,e,n)}function GF(n,e,t){for(var r=e.shape.length,a=r>1?e.shape[r-1]:1,i=t.length,o=1,s=a;s<i;++s)o*=t[s];var u=a<1?1:a,c=Ut(e.shape)/u,l=wt(wt([],ke(Ju(t.slice(0,a))),!1),[1],!1),f=Ut(t);return{sliceRank:a,numUpdates:c,sliceSize:o,strides:l,outputSize:f}}var Ioe={__proto__:null,validateUpdateShape:Q0,validateInput:ey,calculateShapes:GF};function Coe(n,e,t){Vr(t);var r=P(n,"indices","scatterND","int32"),a=P(e,"updates","scatterND");ey(a,r,t);var i={indices:r,updates:a},o={shape:t};return U.runKernel(KD,i,o)}var Aoe=H({scatterND_:Coe});function _oe(n,e,t,r){if(n.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+" but the dtype was ".concat(n.dtype,"."));if(n.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+" but got shape ".concat(n.shape,"."));var a=n.rank>0?n.shape[0]:1,i=n.rank>1?n.shape[1]:1;if(t.length!==i)throw new Error("outputShape has incorrect number of elements:,"+" ".concat(t.length,", should be: ").concat(i,"."));var o=e.size;if(!(e.rank===0||e.rank===1&&o===a))throw new Error("sparseValues has incorrect shape "+"".concat(e.shape,", should be [] or [").concat(a,"]"));if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function Doe(n,e,t,r){r===void 0&&(r=0),Vr(t);var a=P(n,"sparseIndices","sparseToDense","int32"),i=P(e,"sparseValues","sparseToDense","string_or_numeric"),o=P(r,"defaultValue","sparseToDense",i.dtype);_oe(a,i,t,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:t};return U.runKernel(h3,s,u)}var Foe=H({sparseToDense_:Doe});function Roe(n,e){var t=P(e,"indices","gatherND","int32"),r=P(n,"x","gatherND","string_or_numeric"),a={params:r,indices:t};return U.runKernel(U_,a)}var Ooe=H({gatherND_:Roe});function Poe(n,e){if(e==null)return n.shape.slice();if(Fo(n.shape,e))return e;if(n.shape.length===e.length){for(var t=[],r=0;r<n.shape.length;r++)e[r]==null&&n.shape[r]!=null?t.push(n.shape[r]):t.push(e[r]);return t}return e}function Moe(n,e,t,r){var a=P(n,"x","dropout");if(q(a.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(a.dtype," tensor instead.")}),q(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got ".concat(e,".")}),e===0)return n instanceof Pn?a.clone():a;var i=Poe(a,t),o=1-e,s=Gt(mF(ut(PF(i,0,1,"float32",r),o)),o);return Me(a,s)}var Boe=H({dropout_:Moe});function UF(n){return Math.floor(Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))))}function ty(n,e,t){for(var r=1-n%2,a=new Float32Array(n),i=0;i<n;++i){var o=2*Math.PI*i/(n+r-1);a[i]=e-t*Math.cos(o)}return ni(a,"float32")}function Loe(n,e,t){return t===void 0&&(t=1),je(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f,h,p,d,v,m,m;return Xe(this,function(g){switch(g.label){case 0:return r=P(n,"predictions","inTopK"),a=P(e,"targets","inTopK"),q(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, "+"but got ".concat(r.rank)}),q(r.rank-1===a.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+"".concat(r.rank," and targets rank ").concat(a.rank)}),mr(r.shape.slice(0,r.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],q(t>0&&t<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last "+"dimension (".concat(i,"), but got ").concat(t)}),[4,r.data()];case 1:return o=g.sent(),[4,a.data()];case 2:for(s=g.sent(),u=ke([o.length/i,i],2),c=u[0],l=u[1],f=RA("bool",c),h=0;h<c;h++){for(p=h*l,d=o.subarray(p,p+l),v=[],m=0;m<d.length;m++)v.push({value:d[m],index:m});for(v.sort(function(y,b){return b.value-y.value}),f[h]=0,m=0;m<t;m++)if(v[m].index===s[h]){f[h]=1;break}}return n!==r&&r.dispose(),e!==a&&a.dispose(),[2,Wu(f,a.shape,"bool")]}})})}var zoe=Loe;function $oe(n,e,t,r,a,i,o){i===void 0&&(i="NHWC");var s=n;n.rank===3&&(s=ve(n,[1,n.shape[0],n.shape[1],n.shape[2]]));var u=e;u.rank===3&&(u=ve(e,[1,e.shape[0],e.shape[1],e.shape[2]])),q(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")}),q(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")}),q(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(t,".")});var c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];q(c===t[2],function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(t[2],".")}),q(l===t[3],function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(t[3],").")}),Ca("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return U.runKernel(d_,f,h)}var qoe=H({conv2DBackpropFilter_:$oe});function ld(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return Me(n,$F(e));throw new Error("Cannot compute gradient for fused activation ".concat(t,"."))}function fd(n,e){var t=e,r=q0(n.shape,e.shape);return r.length>0&&(t=Vt(t,r)),ve(t,n.shape)}function hd(n,e,t,r){if(e==="linear")return n;if(e==="relu")return cd(n);if(e==="elu")return hF(n);if(e==="relu6")return MF(n);if(e==="prelu")return DF(n,t);if(e==="leakyrelu")return bF(n,r);if(e==="sigmoid")return Uu(n);throw new Error("Unknown fused activation ".concat(e,"."))}var pd=function(n,e){var t=n>0;return!t||e==="linear"};function Woe(n){var e,t=n.x,r=n.filter,a=n.strides,i=n.pad,o=n.dataFormat,s=o===void 0?"NHWC":o,u=n.dilations,c=u===void 0?[1,1]:u,l=n.dimRoundingMode,f=n.bias,h=n.activation,p=h===void 0?"linear":h,d=n.preluActivationWeights,v=n.leakyreluAlpha;if(p=p||"linear",pd(U.state.gradientDepth,p)===!1){q(s==="NHWC",function(){return"Error in fused conv2d: got dataFormat of ".concat(s," but ")+"only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."});var m=ad(t,r,a,i,s,c,l);return f!=null&&(m=ut(m,f)),hd(m,p,d,v)}var g=P(t,"x","conv2d","float32"),y=P(r,"filter","conv2d","float32"),b=g,w=!1;g.rank===3&&(w=!0,b=ve(g,[1,g.shape[0],g.shape[1],g.shape[2]])),q(b.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(b.rank,".")}),q(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(y.rank,".")}),Ca("fused conv2d",i,l);var x=s==="NHWC"?b.shape[3]:b.shape[1];q(y.shape[2]===x,function(){return"Error in conv2d: depth of input (".concat(x,") must match ")+"input depth for filter ".concat(y.shape[2],".")}),q(Ji(a,c),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(a," and dilations '").concat(c,"'")});var N=af(b.shape,y.shape,a,c,i,l),T;f!=null&&(T=P(f,"bias","fused conv2d"),e=ke(vn(T,g),1),T=e[0],s==="NHWC"?Bn(N.outShape,T.shape):(q(T.shape.length<=1,function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+"rank-".concat(T.shape.length,".")}),q(T.shape.length===0||T.shape[0]===N.outChannels||T.shape[0]===1,function(){return"Error in fused conv2d: bias shape (".concat(T.shape,") is not ")+"compatible with the number of output channels "+"(".concat(N.outChannels,")")})));var E;if(d!=null){var C=d.shape;if(q(C.length<=1||C.length===3,function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+"rank-".concat(C.length,".")}),C.length===1)q(C[0]===1||C[0]===N.outChannels,function(){return"Error in fused conv2d: PReLU activation weights "+"(".concat(C,") is not compatible with the number of output ")+"channels (".concat(N.outChannels,").")});else if(C.length===3)try{Bn(C,N.outShape)}catch{var F="Error in fused conv2d: PReLU activation weights (".concat(C,") ")+"is not compatible with the output shape of the conv2d "+"(".concat(N.outShape,").");throw Error(F)}E=P(d,"prelu weights","fused conv2d")}var D=function(B,W){q(s==="NHWC",function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(s," but only NHWC is currently supported.")});var X=ke(W,4),Y=X[0],V=X[1],j=X[2],re=X[3],ne=ld(B,j,p);q(Kl(c),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(c,"'")});var oe=cF(V.shape,ne,Y,a,i),le=qoe(V,ne,Y.shape,a,i),de=[oe,le];if(re!=null){var xe=fd(re,ne);de.push(xe)}return de},O={x:b,filter:y,bias:T,preluActivationWeights:E},L={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:p,leakyreluAlpha:v};if(f==null){var z=Ai(function(B,W,X){var Y=U.runKernel(a0,O,L);return X([W,B,Y]),w&&(Y=ve(Y,[Y.shape[1],Y.shape[2],Y.shape[3]])),{value:Y,gradFunc:D}});return z(b,y)}else{var $=Ai(function(B,W,X,Y){var V=U.runKernel(a0,O,L);return Y([W,B,V,X]),w&&(V=ve(V,[V.shape[1],V.shape[2],V.shape[3]])),{value:V,gradFunc:D}});return $(b,y,T)}}var Voe=H({fusedConv2d_:Woe});function Goe(n,e,t,r,a,i,o){i===void 0&&(i=[1,1]);var s=n;n.rank===3&&(s=ve(n,[1,n.shape[0],n.shape[1],n.shape[2]]));var u=e;u.rank===3&&(u=ve(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={x:s,dy:u},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return U.runKernel(E_,c,l)}var Uoe=H({depthwiseConv2dNativeBackpropFilter_:Goe});function Hoe(n,e,t,r,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=ve(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={dy:s,filter:t},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:n},f=U.runKernel(I_,c,l);return u?ve(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var Koe=H({depthwiseConv2dNativeBackpropInput_:Hoe});function joe(n){var e,t=n.x,r=n.filter,a=n.strides,i=n.pad,o=n.dataFormat,s=o===void 0?"NHWC":o,u=n.dilations,c=u===void 0?[1,1]:u,l=n.dimRoundingMode,f=n.bias,h=n.activation,p=h===void 0?"linear":h,d=n.preluActivationWeights,v=n.leakyreluAlpha;if(pd(U.state.gradientDepth,p)===!1){var m=$0(t,r,a,i,s,c,l);return f!=null&&(m=ut(m,f)),hd(m,p,d,v)}var g=P(t,"x","depthwiseConv2d","float32"),y=P(r,"filter","depthwiseConv2d","float32"),b=g,w=!1;g.rank===3&&(w=!0,b=ve(g,[1,g.shape[0],g.shape[1],g.shape[2]])),q(b.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(b.rank,".")}),q(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+"but got rank ".concat(y.rank,".")}),q(b.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels "+"(".concat(b.shape[3],") must match the inChannels dimension in ")+"filter ".concat(y.shape[2],".")}),c==null&&(c=[1,1]),q(Ji(a,c),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+"be 1. Got strides ".concat(a," and dilations '").concat(c,"'")}),Ca("fused depthwiseConv2d",i,l);var x=af(b.shape,y.shape,a,c,i,l,!0),N;f!=null&&(N=P(f,"bias","fused conv2d"),e=ke(vn(N,g),1),N=e[0],Bn(x.outShape,N.shape));var T;d!=null&&(T=P(d,"prelu weights","fused depthwiseConv2d"));var E=function(L,z){q(Kl(c),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(c,"'")});var $=ke(z,4),B=$[0],W=$[1],X=$[2],Y=$[3],V=ld(L,X,p),j=Koe(W.shape,V,B,a,i,c,l),re=Uoe(W,V,B.shape,a,i,c,l);if(Y!=null){var ne=fd(N,V);return[j,re,ne]}return[j,re]},C={x:b,filter:y,bias:N,preluActivationWeights:T},F={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:p,leakyreluAlpha:v};if(f==null){var D=Ai(function(L,z,$){var B=U.runKernel(i0,C,F);return $([z,L,B]),w&&(B=ve(B,[B.shape[1],B.shape[2],B.shape[3]])),{value:B,gradFunc:E}});return D(b,y)}else{var O=Ai(function(L,z,$,B){var W=U.runKernel(i0,C,F);return B([z,L,W,$]),w&&(W=ve(W,[W.shape[1],W.shape[2],W.shape[3]])),{value:W,gradFunc:E}});return O(b,y,N)}}var Xoe=H({fusedDepthwiseConv2d_:joe});function Yoe(n){var e,t,r=n.a,a=n.b,i=n.transposeA,o=i===void 0?!1:i,s=n.transposeB,u=s===void 0?!1:s,c=n.bias,l=n.activation,f=l===void 0?"linear":l,h=n.preluActivationWeights,p=n.leakyreluAlpha,d=p===void 0?.2:p;if(pd(U.state.gradientDepth,f)===!1){var v=Ft(r,a,o,u);return c!=null&&(v=ut(v,c)),hd(v,f,h,d)}var m=P(r,"a","fused matMul"),g=P(a,"b","fused matMul");e=ke(vn(m,g),2),m=e[0],g=e[1];var y=o?m.shape[m.rank-2]:m.shape[m.rank-1],b=u?g.shape[g.rank-1]:g.shape[g.rank-2],w=o?m.shape[m.rank-1]:m.shape[m.rank-2],x=u?g.shape[g.rank-2]:g.shape[g.rank-1],N=m.shape.slice(0,-2),T=g.shape.slice(0,-2),E=Ut(N),C=Ut(T);q(y===b,function(){return"Error in fused matMul: inner shapes (".concat(y,") and (")+"".concat(b,") of Tensors with shapes ").concat(m.shape," and ")+"".concat(g.shape," and transposeA=").concat(o)+" and transposeB=".concat(u," must match.")});var F=Bn(m.shape.slice(0,-2),g.shape.slice(0,-2)),D=F.concat([w,x]),O=o?ve(m,[E,y,w]):ve(m,[E,w,y]),L=u?ve(g,[C,x,b]):ve(g,[C,b,x]),z;c!=null&&(z=P(c,"bias","fused matMul"),t=ke(vn(z,m),1),z=t[0],Bn(D,z.shape));var $;h!=null&&($=P(h,"prelu weights","fused matMul"));var B=function(j,re){var ne=ke(re,4),oe=ne[0],le=ne[1],de=ne[2],xe=ne[3],he=ld(ve(j,de.shape),de,f),ye,we;if(!o&&!u?(ye=Ft(he,le,!1,!0),we=Ft(oe,he,!0,!1)):!o&&u?(ye=Ft(he,le,!1,!1),we=Ft(he,oe,!0,!1)):o&&!u?(ye=Ft(le,he,!1,!0),we=Ft(oe,he,!1,!1)):(ye=Ft(le,he,!0,!0),we=Ft(he,oe,!0,!0)),c!=null){var Ae=fd(xe,he);return[ye,we,Ae]}else return[ye,we]},W={a:O,b:L,bias:z,preluActivationWeights:$},X={transposeA:o,transposeB:u,activation:f,leakyreluAlpha:d};if(c==null){var Y=Ai(function(j,re,ne){var oe=U.runKernel(r0,W,X);return ne([j,re,oe]),{value:ve(oe,D),gradFunc:B}});return Y(O,L)}else{var V=Ai(function(j,re,ne,oe){var le=U.runKernel(r0,W,X);return oe([j,re,le,ne]),{value:ve(le,D),gradFunc:B}});return V(O,L,z)}}var Zoe=H({fusedMatMul_:Yoe});var Joe={__proto__:null,conv2d:Voe,depthwiseConv2d:Xoe,matMul:Zoe};function Qoe(n){return ty(n,.54,.46)}var ese=H({hammingWindow_:Qoe});function tse(n){return ty(n,.5,.5)}var HF=H({hannWindow_:tse});function nse(n,e,t,r,a){r===void 0&&(r=!1),a===void 0&&(a=0);for(var i=0,o=[];i+e<=n.size;)o.push(un(n,i,e)),i+=t;if(r)for(;i<n.size;){var s=i+e-n.size,u=Wr([un(n,i,e-s),of([s],a)]);o.push(u),i+=t}return o.length===0?zl([],[0,e]):ve(Wr(o),[o.length,e])}var KF=H({frame_:nse});function rse(n,e,t,r,a){a===void 0&&(a=HF),r==null&&(r=UF(e));var i=KF(n,e,t),o=Me(i,a(e));return Y0(o,r)}var ase=H({stft_:rse});function ise(n,e,t,r,a,i){a===void 0&&(a="bilinear"),i===void 0&&(i=0);var o=P(n,"image","cropAndResize"),s=P(e,"boxes","cropAndResize","float32"),u=P(t,"boxInd","cropAndResize","int32"),c=s.shape[0];q(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),q(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] ")+"but had shape ".concat(s.shape,".")}),q(u.rank===1&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] ")+"but had shape ".concat(s.shape,".")}),q(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(r.length,".")}),q(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was ".concat(r)}),q(a==="bilinear"||a==="nearest",function(){return"method must be bilinear or nearest, but was ".concat(a)});var l={image:o,boxes:s,boxInd:u},f={method:a,extrapolationValue:i,cropSize:r},h=U.runKernel(k_,l,f);return h}var ose=H({cropAndResize_:ise});function sse(n){var e=P(n,"image","flipLeftRight","float32");q(e.rank===4,function(){return"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(e.rank,".")});var t={image:e},r=U.runKernel($_,t,{});return r}var use=H({flipLeftRight_:sse});function cse(n){var e=P(n,"image","grayscaleToRGB"),t=e.rank-1,r=e.shape[t];q(e.rank>=2,function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(e.rank,".")}),q(r===1,function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(r,".")});var a=new Array(e.rank);return a.fill(1,0,t),a[t]=3,Ll(e,a)}var lse=H({grayscaleToRGB_:cse});function fse(n,e,t,r){t===void 0&&(t=0),r===void 0&&(r=.5);var a=P(n,"image","rotateWithOffset","float32");q(a.rank===4,function(){return"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,".")});var i={image:a},o={radians:e,fillValue:t,center:r},s=U.runKernel(C3,i,o);return s}var hse=H({rotateWithOffset_:fse});function Qu(n,e,t,r,a,i){r==null&&(r=.5),a==null&&(a=Number.NEGATIVE_INFINITY),i==null&&(i=0);var o=n.shape[0];return t=Math.min(t,o),q(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")}),q(n.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '".concat(n.rank,"'")}),q(n.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(n.shape[1])}),q(e.rank===1,function(){return"scores must be a 1D tensor"}),q(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(e.shape[0])}),q(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")}),{maxOutputSize:t,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}function pse(n,e,t,r,a){r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var i=P(n,"boxes","nonMaxSuppression","float32"),o=P(e,"scores","nonMaxSuppression","float32"),s=Qu(i,o,t,r,a);t=s.maxOutputSize,r=s.iouThreshold,a=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:r,scoreThreshold:a};return U.runKernel(SD,{boxes:i,scores:o},u)}var dse=H({nonMaxSuppression_:pse});function vse(n,e,t){var r=mse(n,e,t),a=r<0?-(r+1):r;n.splice(a,0,e)}function mse(n,e,t){return yse(n,e,t||gse)}function gse(n,e){return n>e?1:n<e?-1:0}function yse(n,e,t){for(var r=0,a=n.length,i=0,o=!1;r<a;){i=r+(a-r>>>1);var s=t(e,n[i]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}function jF(n,e,t,r,a){return ny(n,e,t,r,a,0)}function XF(n,e,t,r,a,i){return ny(n,e,t,r,a,0,!1,i,!0)}function YF(n,e,t,r,a,i){return ny(n,e,t,r,a,i,!0)}function ny(n,e,t,r,a,i,o,s,u){o===void 0&&(o=!1),s===void 0&&(s=!1),u===void 0&&(u=!1);for(var c=[],l=0;l<e.length;l++)e[l]>a&&c.push({score:e[l],boxIndex:l,suppressBeginIndex:0});c.sort(SA);for(var f=i>0?-.5/i:0,h=[],p=[];h.length<t&&c.length>0;){var d=c.pop(),v=d.score,m=d.boxIndex,g=d.suppressBeginIndex;if(v<a)break;for(var y=!1,b=h.length-1;b>=g;--b){var w=bse(n,m,h[b]);if(w>=r){y=!0;break}if(d.score=d.score*wse(r,f,w),d.score<=a)break}d.suppressBeginIndex=h.length,y||(d.score===v?(h.push(m),p.push(d.score)):d.score>a&&vse(c,d,SA))}var x=h.length,N=t-x;s&&N>0&&(h.push.apply(h,wt([],ke(new Array(N).fill(0)),!1)),p.push.apply(p,wt([],ke(new Array(N).fill(0)),!1)));var T={selectedIndices:h};return o&&(T.selectedScores=p),u&&(T.validOutputs=x),T}function bse(n,e,t){var r=n.subarray(e*4,e*4+4),a=n.subarray(t*4,t*4+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),f=Math.max(a[0],a[2]),h=Math.max(a[1],a[3]),p=(s-i)*(u-o),d=(f-c)*(h-l);if(p<=0||d<=0)return 0;var v=Math.max(i,c),m=Math.max(o,l),g=Math.min(s,f),y=Math.min(u,h),b=Math.max(g-v,0)*Math.max(y-m,0);return b/(p+d-b)}function wse(n,e,t){var r=Math.exp(e*t*t);return t<=n?r:0}function SA(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}function xse(n,e,t,r,a){return r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),je(this,void 0,void 0,function(){var i,o,s,u,c,l,f;return Xe(this,function(h){switch(h.label){case 0:return i=P(n,"boxes","nonMaxSuppressionAsync"),o=P(e,"scores","nonMaxSuppressionAsync"),s=Qu(i,o,t,r,a),t=s.maxOutputSize,r=s.iouThreshold,a=s.scoreThreshold,[4,Promise.all([i.data(),o.data()])];case 1:return u=h.sent(),c=u[0],l=u[1],f=jF(c,l,t,r,a).selectedIndices,i!==n&&i.dispose(),o!==e&&o.dispose(),[2,ni(f,"int32")]}})})}var kse=xse;function Sse(n,e,t,r,a,i){r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var o=P(n,"boxes","nonMaxSuppression"),s=P(e,"scores","nonMaxSuppression"),u=Qu(o,s,t,r,a,i);t=u.maxOutputSize,r=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma;var c={boxes:o,scores:s},l={maxOutputSize:t,iouThreshold:r,scoreThreshold:a,softNmsSigma:i},f=U.runKernel(TD,c,l);return{selectedIndices:f[0],selectedScores:f[1]}}var Nse=H({nonMaxSuppressionWithScore_:Sse});function Tse(n,e,t,r,a,i){return r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),je(this,void 0,void 0,function(){var o,s,u,c,l,f,h,p,d;return Xe(this,function(v){switch(v.label){case 0:return o=P(n,"boxes","nonMaxSuppressionAsync"),s=P(e,"scores","nonMaxSuppressionAsync"),u=Qu(o,s,t,r,a,i),t=u.maxOutputSize,r=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return c=v.sent(),l=c[0],f=c[1],h=YF(l,f,t,r,a,i),p=h.selectedIndices,d=h.selectedScores,o!==n&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:ni(p,"int32"),selectedScores:ni(d)}]}})})}var Ese=Tse;function Ise(n,e,t,r,a,i){r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1);var o=P(n,"boxes","nonMaxSuppression"),s=P(e,"scores","nonMaxSuppression"),u=Qu(o,s,t,r,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,h={boxes:o,scores:s},p={maxOutputSize:c,iouThreshold:l,scoreThreshold:f,padToMaxOutputSize:i},d=U.runKernel(ND,h,p);return{selectedIndices:d[0],validOutputs:d[1]}}var Cse=H({nonMaxSuppressionPadded_:Ise});function Ase(n,e,t,r,a,i){return r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1),je(this,void 0,void 0,function(){var o,s,u,c,l,f,h,p,d,v,m,g;return Xe(this,function(y){switch(y.label){case 0:return o=P(n,"boxes","nonMaxSuppressionAsync"),s=P(e,"scores","nonMaxSuppressionAsync"),u=Qu(o,s,t,r,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,[4,Promise.all([o.data(),s.data()])];case 1:return h=ke.apply(void 0,[y.sent(),2]),p=h[0],d=h[1],v=XF(p,d,c,l,f,i),m=v.selectedIndices,g=v.validOutputs,o!==n&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:ni(m,"int32"),validOutputs:Rt(g,"int32")}]}})})}var _se=Ase;function Dse(n,e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!1);var a=P(n,"images","resizeBilinear");q(a.rank===3||a.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),q(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(e,".")}),q(r===!1||t===!1,function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=ve(a,[1,a.shape[0],a.shape[1],a.shape[2]])),ke(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:r,size:e},c=U.runKernel(WD,s,u);return o?ve(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var Fse=H({resizeBilinear_:Dse});function Rse(n,e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!1);var a=P(n,"images","resizeNearestNeighbor");q(a.rank===3||a.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),q(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(e,".")}),q(a.dtype==="float32"||a.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"}),q(r===!1||t===!1,function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=ve(a,[1,a.shape[0],a.shape[1],a.shape[2]])),ke(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:r,size:e},c=U.runKernel(qD,s,u);return o?ve(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var Ose=H({resizeNearestNeighbor_:Rse});function Pse(n,e,t,r){var a;e===void 0&&(e="binary"),t===void 0&&(t=!1),r===void 0&&(r=.5);var i=P(n,"image","threshold"),o=.2989,s=.587,u=.114,c=i.shape[0]*i.shape[1],l=Me(ni([r]),255),f,h,p,d;if(q(i.rank===3,function(){return"Error in threshold: image must be rank 3,"+"but got rank ".concat(i.rank,".")}),q(i.shape[2]===3||i.shape[2]===1,function(){return"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(i.shape[2],".")}),q(i.dtype==="int32"||i.dtype==="float32",function(){return"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(i.dtype,".")}),q(e==="otsu"||e==="binary",function(){return"Method must be binary or otsu, but was ".concat(e)}),i.shape[2]===3){a=ke(Jl(i,[1,1,1],-1),3),f=a[0],h=a[1],p=a[2];var v=Me(f,o),m=Me(h,s),g=Me(p,u);d=ut(ut(v,m),g)}else d=n;if(e==="otsu"){var y=uF(Nn(BF(d),"int32"),Wu([]),256);l=Mse(y,c)}var b=t?V0(d,l):od(d,l),w=Nn(Me(b,255),"int32");return w}function Mse(n,e){for(var t=ni([-1]),r=ni([0]),a=ni([0]),i,o,s,u,c,l,f=0;f<n.size-1;f++){i=un(n,0,f+1),o=un(n,f+1),c=Gt(Vt(i),e),l=Gt(Vt(o),e);var h=Vt(Me(i,Yl(0,i.size)));s=Gt(h,Vt(i));var p=of(o.shape,i.size),d=ut(Yl(0,o.size),p),v=Me(o,d);u=Gt(Vt(v),Vt(o));var m=bt(s,u),g=bt(s,u),y=Me(c,l);a=Me(Me(y,m),g);var b=od(a,r);r=Yu(b,a,r),t=Yu(b,ni([f]),t)}return t}var Bse=H({threshold_:Pse});function Lse(n,e,t,r,a,i){t===void 0&&(t="nearest"),r===void 0&&(r="constant"),a===void 0&&(a=0);var o=P(n,"image","transform","float32"),s=P(e,"transforms","transform","float32");q(o.rank===4,function(){return"Error in transform: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),q(s.rank===2&&(s.shape[0]===o.shape[0]||s.shape[0]===1)&&s.shape[1]===8,function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"}),q(i==null||i.length===2,function(){return"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(i,".")});var u={image:o,transforms:s},c={interpolation:t,fillMode:r,fillValue:a,outputShape:i};return U.runKernel(k3,u,c)}var zse=H({transform_:Lse});function $se(n,e,t){q(e%1===0,function(){return"bandPart(): numLower must be an integer, got ".concat(e,".")}),q(t%1===0,function(){return"bandPart(): numUpper must be an integer, got ".concat(t,".")});var r=P(n,"a","bandPart");q(r.rank>=2,function(){return"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")});var a=r.shape,i=ke(r.shape.slice(-2),2),o=i[0],s=i[1];if(!(e<=o))throw new Error("bandPart(): numLower (".concat(e,")")+" must not be greater than the number of rows (".concat(o,")."));if(!(t<=s))throw new Error("bandPart(): numUpper (".concat(t,")")+" must not be greater than the number of columns (".concat(s,")."));e<0&&(e=o),t<0&&(t=s);var u=ve(Yl(0,o,1,"int32"),[-1,1]),c=Yl(0,s,1,"int32"),l=bt(u,c),f=Kp(V0(l,Rt(+e,"int32")),yF(l,Rt(-t,"int32"))),h=Zu([o,s],r.dtype);return ve(Ql(J0(ve(r,[-1,o,s])).map(function(p){return Yu(f,p,h)})),a)}var qse=H({bandPart_:$se});function Wse(n){var e;if(Array.isArray(n)){e=!1,q(n!=null&&n.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=n[0].shape[0],r=function(u){q(n[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(n[u].shape[0]," vs. ").concat(t,")")})},a=1;a<n.length;++a)r(a)}else e=!0,n=Jl(n,n.shape[0],0).map(function(u){return Z0(u,[0])});q(n.length<=n[0].shape[0],function(){return"Gram-Schmidt: Number of vectors (".concat(n.length,") exceeds ")+"number of dimensions (".concat(n[0].shape[0],").")});for(var i=[],o=n,s=function(u){i.push(U.tidy(function(){var c=o[u];if(u>0)for(var l=0;l<u;++l){var f=Me(Vt(Me(i[l],c)),i[l]);c=bt(c,f)}return Gt(c,id(c,"euclidean"))}))},a=0;a<n.length;++a)s(a);return e?Ql(i,0):i}var Vse=H({gramSchmidt_:Wse});function Gse(n,e){if(e===void 0&&(e=!1),q(n.rank>=2,function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(n.rank)}),n.rank===2)return NA(n,e);var t=n.shape.slice(0,n.shape.length-2).reduce(function(u,c){return u*c}),r=J0(ve(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),a=[],i=[];r.forEach(function(u){var c=ke(NA(u,e),2),l=c[0],f=c[1];a.push(l),i.push(f)});var o=ve(Ql(a,0),n.shape),s=ve(Ql(i,0),n.shape);return[o,s]}function NA(n,e){return e===void 0&&(e=!1),U.tidy(function(){q(n.shape.length===2,function(){return"qr2d() requires a 2D Tensor, but got a ".concat(n.shape.length,"D Tensor.")});for(var t=n.shape[0],r=n.shape[1],a=vF(t),i=gs(n),o=zl([[1]],[1,1]),s=gs(o),u=t>=r?r:t,c=function(f){var h,p=i,d=s,v=a;h=ke(U.tidy(function(){var m=un(i,[f,f],[t-f,1]),g=id(m),y=un(i,[f,f],[1,1]),b=Yu(od(y,0),zl([[-1]]),zl([[1]])),w=bt(y,Me(b,g)),x=Gt(m,w);x.shape[0]===1?s=gs(o):s=Wr([o,un(x,[1,0],[x.shape[0]-1,x.shape[1]])],0);var N=ji(Gt(Ft(b,w),g)),T=un(i,[f,0],[t-f,r]),E=Me(N,s),C=Yp(s);if(f===0)i=bt(T,Ft(E,Ft(C,T)));else{var F=bt(T,Ft(E,Ft(C,T)));i=Wr([un(i,[0,0],[f,r]),F],0)}var D=Yp(E),O=un(a,[0,f],[t,a.shape[1]-f]);if(f===0)a=bt(O,Ft(Ft(O,s),D));else{var L=bt(O,Ft(Ft(O,s),D));a=Wr([un(a,[0,0],[t,f]),L],1)}return[s,i,a]}),3),s=h[0],i=h[1],a=h[2],Er([p,d,v])},l=0;l<u;++l)c(l);return!e&&t>r&&(a=un(a,[0,0],[t,r]),i=un(i,[0,0],[r,r])),[a,i]})}var Use=H({qr_:Gse});A.Reduction=void 0;(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(A.Reduction||(A.Reduction={}));function Hse(n,e,t){t===void 0&&(t=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var r=P(n,"losses","computeWeightedLoss"),a=null;e!=null&&(a=P(e,"weights","computeWeightedLoss"));var i=a==null?r:Me(r,a);if(t===A.Reduction.NONE)return i;if(t===A.Reduction.SUM)return Vt(i);if(t===A.Reduction.MEAN){if(a==null)return jp(i);var o=r.size/a.size,s=Gt(Vt(i),Vt(a));return o>1?Gt(s,Rt(o)):s}if(t===A.Reduction.SUM_BY_NONZERO_WEIGHTS){if(a==null)return Gt(Vt(i),Rt(r.size));var u=Me(a,ms(r.shape)),c=Nn(Vt(AF(u,Rt(0))),"float32");return Gt(Vt(i),c)}throw Error("Unknown reduction: ".concat(t))}var Qi=H({computeWeightedLoss_:Hse});function Kse(n,e,t,r){r===void 0&&(r=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=P(n,"labels","absoluteDifference"),i=P(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=P(t,"weights","absoluteDifference")),mr(a.shape,i.shape,"Error in absoluteDifference: ");var s=ua(bt(a,i));return Qi(s,o,r)}var jse=H({absoluteDifference_:Kse});function Xse(n,e,t,r,a){a===void 0&&(a=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=P(n,"labels","cosineDistance"),o=P(e,"predictions","cosineDistance"),s=null;r!=null&&(s=P(r,"weights","cosineDistance")),mr(i.shape,o.shape,"Error in cosineDistance: ");var u=Rt(1),c=bt(u,Vt(Me(i,o),t,!0));return Qi(c,s,a)}var Yse=H({cosineDistance_:Xse});function Zse(n,e,t,r){r===void 0&&(r=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=P(n,"labels","hingeLoss"),i=P(e,"predictions","hingeLoss"),o=null;t!=null&&(o=P(t,"weights","hingeLoss")),mr(a.shape,i.shape,"Error in hingeLoss: ");var s=Rt(1);a=bt(Me(Rt(2),a),s);var u=cd(bt(s,Me(a,i)));return Qi(u,o,r)}var Jse=H({hingeLoss_:Zse});function Qse(n,e,t,r,a){r===void 0&&(r=1),a===void 0&&(a=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=P(n,"labels","huberLoss"),o=P(e,"predictions","huberLoss"),s=null;t!=null&&(s=P(t,"weights","huberLoss")),mr(i.shape,o.shape,"Error in huberLoss: ");var u=Rt(r),c=ua(bt(o,i)),l=CF(c,u),f=bt(c,l),h=ut(Me(Rt(.5),ri(l)),Me(u,f));return Qi(h,s,a)}var eue=H({huberLoss_:Qse});function tue(n,e,t,r,a){r===void 0&&(r=1e-7),a===void 0&&(a=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=P(n,"labels","logLoss"),o=P(e,"predictions","logLoss"),s=null;t!=null&&(s=P(t,"weights","logLoss")),mr(i.shape,o.shape,"Error in logLoss: ");var u=Rt(1),c=Rt(r),l=ji(Me(i,Xl(ut(o,c)))),f=Me(bt(u,i),Xl(ut(bt(u,o),c))),h=bt(l,f);return Qi(h,s,a)}var nue=H({logLoss_:tue});function rue(n,e,t,r){r===void 0&&(r=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var a=P(n,"labels","meanSquaredError"),i=P(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=P(t,"weights","meanSquaredError")),mr(a.shape,i.shape,"Error in meanSquaredError: ");var s=zF(a,i);return Qi(s,o,r)}var aue=H({meanSquaredError_:rue});function iue(n,e){var t=P(n,"labels","sigmoidCrossEntropyWithLogits"),r=P(e,"logits","sigmoidCrossEntropyWithLogits");mr(t.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=cd(r),i=Me(r,t),o=wF(xs(ji(ua(r))));return ut(bt(a,i),o)}function oue(n,e,t,r,a){r===void 0&&(r=0),a===void 0&&(a=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=P(n,"multiClassLabels","sigmoidCrossEntropy"),o=P(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=P(t,"weights","sigmoidCrossEntropy")),mr(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Rt(r),c=Rt(1),l=Rt(.5);i=ut(Me(i,bt(c,u)),Me(l,u))}var f=iue(i,o);return Qi(f,s,a)}var sue=H({sigmoidCrossEntropy_:oue});function uue(n,e,t){if(t===void 0&&(t=-1),t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(e.rank," ")+"and dim was ".concat(t));var r=Ai(function(a,i,o){var s=!0,u=SF(i,[t],s),c=bt(Nn(i,"float32"),u);o([a,c]);var l=ji(Me(c,a)),f=Vt(l,[t]),h=function(p,d){var v=ke(d,2),m=v[0],g=v[1],y=sf(p.shape,[t]);return[Me(ve(p,y),bt(Nn(m,"float32"),xs(g))),Me(ve(p,y),bt(xs(g),Nn(m,"float32")))]};return{value:f,gradFunc:h}});return r(n,e)}function cue(n,e,t,r,a){r===void 0&&(r=0),a===void 0&&(a=A.Reduction.SUM_BY_NONZERO_WEIGHTS);var i=P(n,"onehotLabels","softmaxCrossEntropy"),o=P(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=P(t,"weights","softmaxCrossEntropy")),mr(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Rt(r),c=Rt(1),l=Rt(i.shape[1]);i=ut(Me(i,bt(c,u)),Gt(u,l))}var f=uue(i,o);return Qi(f,s,a)}var lue=H({softmaxCrossEntropy_:cue});function fue(n,e,t,r){var a=P(n,"indices","sparseFillEmptyRows","int32"),i=P(e,"values","sparseFillEmptyRows"),o=P(t,"denseShape","sparseFillEmptyRows","int32"),s=P(r,"defaultValue","sparseFillEmptyRows",i.dtype);if(a.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        `.concat(a.shape));if(i.rank!==1)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(o.rank!==1)throw new Error("Dense shape should be Tensor1D but received shape ".concat(o.shape));if(s.rank!==0)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));var u={indices:a,values:i,denseShape:o,defaultValue:s},c=U.runKernel(u3,u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}var hue=H({sparseFillEmptyRows_:fue});function pue(n,e,t){var r=P(n,"inputIndices","sparseReshape","int32"),a=P(e,"inputShape","sparseReshape","int32"),i=P(t,"newShape","sparseReshape","int32");if(r.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        `.concat(r.shape));if(a.rank!==1)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(i.rank!==1)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));var o={inputIndices:r,inputShape:a,newShape:i},s=U.runKernel(c3,o);return{outputIndices:s[0],outputShape:s[1]}}var due=H({sparseReshape_:pue});function vue(n,e,t){var r=P(n,"data","sparseSegmentMean"),a=P(e,"indices","sparseSegmentMean","int32"),i=P(t,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          `.concat(i.shape));var o={data:r,indices:a,segmentIds:i};return U.runKernel(l3,o)}var mue=H({sparseSegmentMean_:vue});function gue(n,e,t){var r=P(n,"data","sparseSegmentSum"),a=P(e,"indices","sparseSegmentSum","int32"),i=P(t,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         `.concat(i.shape));var o={data:r,indices:a,segmentIds:i};return U.runKernel(f3,o)}var yue=H({sparseSegmentSum_:gue});function bue(n,e,t,r,a,i,o,s){var u=P(n,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error("Data must be a vector, saw: ".concat(u.shape));var c=P(e,"dataSplits","stringNGrams");if(c.dtype!=="int32")throw new Error("Data splits must be of datatype int32");var l={separator:t,nGramWidths:r,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},f={data:u,dataSplits:c},h=U.runKernel(v3,f,l);return{nGrams:h[0],nGramsSplits:h[1]}}var wue=H({stringNGrams_:bue});function xue(n,e,t){t===void 0&&(t=!0);var r=P(n,"input","stringSplit","string"),a=P(e,"delimiter","stringSplit","string");if(r.rank!==1)throw new Error("Input should be Tensor1D but received shape ".concat(r.shape));if(a.rank!==0)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));var i={skipEmpty:t},o={input:r,delimiter:a},s=U.runKernel(m3,o,i);return{indices:s[0],values:s[1],shape:s[2]}}var kue=H({stringSplit_:xue});function Sue(n,e){var t=P(n,"input","stringToHashBucketFast","string"),r={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");var a={input:t};return U.runKernel(g3,a,r)}var Nue=H({stringToHashBucketFast_:Sue});var Tue={fft:X0,ifft:Xp,rfft:Y0,irfft:LF},Eue={hammingWindow:ese,hannWindow:HF,frame:KF,stft:ase},Iue={flipLeftRight:use,grayscaleToRGB:lse,resizeNearestNeighbor:Ose,resizeBilinear:Fse,rotateWithOffset:hse,cropAndResize:ose,nonMaxSuppression:dse,nonMaxSuppressionAsync:kse,nonMaxSuppressionWithScore:Nse,nonMaxSuppressionWithScoreAsync:Ese,nonMaxSuppressionPadded:Cse,nonMaxSuppressionPaddedAsync:_se,threshold:Bse,transform:zse},Cue={bandPart:qse,gramSchmidt:Vse,qr:Use},Aue={absoluteDifference:jse,computeWeightedLoss:Qi,cosineDistance:Yse,hingeLoss:Jse,huberLoss:eue,logLoss:nue,meanSquaredError:aue,sigmoidCrossEntropy:sue,softmaxCrossEntropy:lue},_ue={sparseFillEmptyRows:hue,sparseReshape:due,sparseSegmentMean:mue,sparseSegmentSum:yue},Due={stringNGrams:wue,stringSplit:kue,stringToHashBucketFast:Nue};var ZF=function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(e,t){return new e(t)},n}(),JF=function(){function n(){this.classNameMap={}}return n.getMap=function(){return n.instance==null&&(n.instance=new n),n.instance},n.register=function(e){n.getMap().classNameMap[e.className]=[e,e.fromConfig]},n}();function QF(n){q(n.className!=null,function(){return"Class being registered does not have the static className property defined."}),q(typeof n.className=="string",function(){return"className is required to be a string, but got type "+typeof n.className}),q(n.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),JF.register(n)}var Fue={__proto__:null,Serializable:ZF,SerializationMap:JF,registerClass:QF},Oo=function(n){Zi(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.minimize=function(t,r,a){r===void 0&&(r=!1);var i=this.computeGradients(t,a),o=i.value,s=i.grads;if(a!=null){var u=a.map(function(c){return{name:c.name,tensor:s[c.name]}});this.applyGradients(u)}else this.applyGradients(s);return Er(s),r?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!1,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,r){return xF(t,r)},e.prototype.dispose=function(){this.iterations_!=null&&Er(this.iterations_)},e.prototype.saveIterations=function(){return je(this,void 0,void 0,function(){return Xe(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Rt(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){return Xe(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){return Xe(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()))})})},e.prototype.extractIterations=function(t){return je(this,void 0,void 0,function(){var r;return Xe(this,function(a){switch(a.label){case 0:return r=this,[4,t[0].tensor.data()];case 1:return r.iterations_=a.sent()[0],[2,t.slice(1)]}})})},e}(ZF);Object.defineProperty(Oo,Symbol.hasInstance,{value:function(n){return n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null}});var ry=function(n){Zi(e,n);function e(t,r,a){a===void 0&&(a=null);var i=n.call(this)||this;return i.learningRate=t,i.rho=r,i.epsilon=a,i.accumulatedGrads=[],i.accumulatedUpdates=[],a==null&&(i.epsilon=U.backend.epsilon()),i}return Object.defineProperty(e,"className",{get:function(){return"Adadelta"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=U.registeredVariables[i],u=!1;r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:"".concat(i,"/accum_grad"),variable:Mn(function(){return ca(s).variable(u)})}),r.accumulatedUpdates[o]==null&&(r.accumulatedUpdates[o]={originalName:"".concat(i,"/accum_var"),variable:Mn(function(){return ca(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=r.accumulatedGrads[o].variable,f=r.accumulatedUpdates[o].variable;Mn(function(){var h=ut(Me(l,r.rho),Me(ri(c),1-r.rho)),p=Me(Gt(Yi(ut(f,r.epsilon)),Yi(ut(l,r.epsilon))),c),d=ut(Me(f,r.rho),Me(ri(p),1-r.rho));l.assign(h),f.assign(d);var v=ut(Me(p,-r.learningRate),s);s.assign(v)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(Er(this.accumulatedGrads.map(function(t){return t.variable})),Er(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){var t;return Xe(this,function(r){switch(r.label){case 0:return t=wt(wt([],ke(this.accumulatedGrads),!1),ke(this.accumulatedUpdates),!1),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){var r,a;return Xe(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=t.length/2,a=!1,this.accumulatedGrads=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedUpdates=t.slice(r,r*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},e}(Oo),ay=function(n){Zi(e,n);function e(t,r){r===void 0&&(r=.1);var a=n.call(this)||this;return a.learningRate=t,a.initialAccumulatorValue=r,a.accumulatedGrads=[],a}return Object.defineProperty(e,"className",{get:function(){return"Adagrad"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=U.registeredVariables[i];if(r.accumulatedGrads[o]==null){var u=!1;r.accumulatedGrads[o]={originalName:"".concat(i,"/accumulator"),variable:Mn(function(){return of(s.shape,r.initialAccumulatorValue).variable(u)})}}var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=r.accumulatedGrads[o].variable;Mn(function(){var f=ut(l,ri(c));l.assign(f);var h=ut(Me(Gt(c,Yi(ut(f,U.backend.epsilon()))),-r.learningRate),s);s.assign(h)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&Er(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){return Xe(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){var r;return Xe(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),r=!1,this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(r)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},e}(Oo),iy=function(n){Zi(e,n);function e(t,r,a,i){i===void 0&&(i=null);var o=n.call(this)||this;return o.learningRate=t,o.beta1=r,o.beta2=a,o.epsilon=i,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],Mn(function(){o.accBeta1=Rt(r).variable(),o.accBeta2=Rt(a).variable()}),i==null&&(o.epsilon=U.backend.epsilon()),o}return Object.defineProperty(e,"className",{get:function(){return"Adam"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Mn(function(){var i=bt(1,r.accBeta1),o=bt(1,r.accBeta2);a.forEach(function(s,u){var c=U.registeredVariables[s],l=!1;r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:Mn(function(){return ca(c).variable(l)})}),r.accumulatedSecondMoment[u]==null&&(r.accumulatedSecondMoment[u]={originalName:"".concat(s,"/v"),variable:Mn(function(){return ca(c).variable(l)})});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=r.accumulatedFirstMoment[u].variable,p=r.accumulatedSecondMoment[u].variable,d=ut(Me(h,r.beta1),Me(f,1-r.beta1)),v=ut(Me(p,r.beta2),Me(ri(f),1-r.beta2)),m=Gt(d,i),g=Gt(v,o);h.assign(d),p.assign(v);var y=ut(Me(Gt(m,ut(Yi(g),r.epsilon)),-r.learningRate),c);c.assign(y)}}),r.accBeta1.assign(Me(r.accBeta1,r.beta1)),r.accBeta2.assign(Me(r.accBeta2,r.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Er(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&Er(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){var t;return Xe(this,function(r){switch(r.label){case 0:return t=wt(wt([],ke(this.accumulatedFirstMoment),!1),ke(this.accumulatedSecondMoment),!1),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){var r,a,i=this;return Xe(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),Mn(function(){i.accBeta1.assign(jl(i.beta1,i.iterations_+1)),i.accBeta2.assign(jl(i.beta2,i.iterations_+1))}),r=t.length/2,a=!1,this.accumulatedFirstMoment=t.slice(0,r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),this.accumulatedSecondMoment=t.slice(r,r*2).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},e}(Oo),oy=function(n){Zi(e,n);function e(t,r,a,i,o){i===void 0&&(i=null),o===void 0&&(o=0);var s=n.call(this)||this;return s.learningRate=t,s.beta1=r,s.beta2=a,s.epsilon=i,s.decay=o,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],Mn(function(){s.iteration=Rt(0).variable(),s.accBeta1=Rt(r).variable()}),i==null&&(s.epsilon=U.backend.epsilon()),s}return Object.defineProperty(e,"className",{get:function(){return"Adamax"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);Mn(function(){var i=bt(1,r.accBeta1),o=Gt(-r.learningRate,ut(Me(r.iteration,r.decay),1));a.forEach(function(s,u){var c=U.registeredVariables[s],l=!1;r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:ca(c).variable(l)}),r.accumulatedWeightedInfNorm[u]==null&&(r.accumulatedWeightedInfNorm[u]={originalName:"".concat(s,"/v"),variable:ca(c).variable(l)});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=r.accumulatedFirstMoment[u].variable,p=r.accumulatedWeightedInfNorm[u].variable,d=ut(Me(h,r.beta1),Me(f,1-r.beta1)),v=Me(p,r.beta2),m=ua(f),g=IF(v,m);h.assign(d),p.assign(g);var y=ut(Me(Gt(o,i),Gt(d,ut(g,r.epsilon))),c);c.assign(y)}}),r.iteration.assign(ut(r.iteration,1)),r.accBeta1.assign(Me(r.accBeta1,r.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Er(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&Er(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){return Xe(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){return Xe(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e}(Oo),dd=function(n){Zi(e,n);function e(t){var r=n.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return Object.defineProperty(e,"className",{get:function(){return"SGD"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=U.registeredVariables[i];Mn(function(){var c=ut(Me(r.c,s),u);u.assign(c)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=tF(Rt(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){return Xe(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){return Xe(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:if(t=r.sent(),t.length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,r){return new t(r.learningRate)},e}(Oo),sy=function(n){Zi(e,n);function e(t,r,a){a===void 0&&(a=!1);var i=n.call(this,t)||this;return i.learningRate=t,i.momentum=r,i.useNesterov=a,i.accumulations=[],i.m=Rt(i.momentum),i}return Object.defineProperty(e,"className",{get:function(){return"Momentum"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=U.registeredVariables[i];if(r.accumulations[o]==null){var u=!1;r.accumulations[o]={originalName:"".concat(i,"/momentum"),variable:Mn(function(){return ca(s).variable(u)})}}var c=r.accumulations[o].variable,l=Array.isArray(t)?t[o].tensor:t[i];l!=null&&Mn(function(){var f,h=ut(Me(r.m,c),l);r.useNesterov?f=ut(Me(r.c,ut(l,Me(h,r.m))),s):f=ut(Me(r.c,h),s),c.assign(h),s.assign(f)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&Er(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){return Xe(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){var r;return Xe(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),r=!1,this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(r)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},e}(dd),uy=function(n){Zi(e,n);function e(t,r,a,i,o){r===void 0&&(r=.9),a===void 0&&(a=0),i===void 0&&(i=null),o===void 0&&(o=!1);var s=n.call(this)||this;if(s.learningRate=t,s.decay=r,s.momentum=a,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=o,i==null&&(s.epsilon=U.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return Object.defineProperty(e,"className",{get:function(){return"RMSProp"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=U.registeredVariables[i],u=!1;r.accumulatedMeanSquares[o]==null&&(r.accumulatedMeanSquares[o]={originalName:"".concat(i,"/rms"),variable:Mn(function(){return ca(s).variable(u)})}),r.accumulatedMoments[o]==null&&(r.accumulatedMoments[o]={originalName:"".concat(i,"/momentum"),variable:Mn(function(){return ca(s).variable(u)})}),r.accumulatedMeanGrads[o]==null&&r.centered&&(r.accumulatedMeanGrads[o]={originalName:"".concat(i,"/mg"),variable:Mn(function(){return ca(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=r.accumulatedMeanSquares[o].variable,f=r.accumulatedMoments[o].variable;Mn(function(){var h=ut(Me(l,r.decay),Me(ri(c),1-r.decay));if(r.centered){var p=r.accumulatedMeanGrads[o].variable,d=ut(Me(p,r.decay),Me(c,1-r.decay)),v=Gt(Me(c,r.learningRate),Yi(bt(h,ut(ri(d),r.epsilon)))),m=ut(Me(f,r.momentum),v);l.assign(h),p.assign(d),f.assign(m);var g=bt(s,m);s.assign(g)}else{var y=ut(Me(l,r.decay),Me(ri(c),1-r.decay)),m=ut(Me(f,r.momentum),Gt(Me(c,r.learningRate),Yi(ut(y,r.epsilon))));l.assign(y),f.assign(m);var g=bt(s,m);s.assign(g)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&Er(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&Er(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&Er(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return je(this,void 0,void 0,function(){var t;return Xe(this,function(r){switch(r.label){case 0:return t=wt(wt([],ke(this.accumulatedMeanSquares),!1),ke(this.accumulatedMoments),!1),this.centered&&t.push.apply(t,wt([],ke(this.accumulatedMeanGrads),!1)),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return je(this,void 0,void 0,function(){var r,a;return Xe(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=this.centered?t.length/3:t.length/2,a=!1,this.accumulatedMeanSquares=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedMoments=t.slice(r,r*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(r*2,r*3).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e}(Oo),Rue=[ry,ay,iy,oy,sy,uy,dd];function Oue(){var n,e;try{for(var t=cr(Rue),r=t.next();!r.done;r=t.next()){var a=r.value;QF(a)}}catch(i){n={error:i}}finally{try{r&&!r.done&&(e=t.return)&&e.call(t)}finally{if(n)throw n.error}}}var Pue="model",Mue=".json",Bue=".weights.bin";function TA(n){return new Promise(function(e){return setTimeout(e)}).then(n)}var Zp=function(){function n(e){if(!vt().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),(e==null||e.length===0)&&(e=Pue),this.modelJsonFileName=e+Mue,this.weightDataFileName=e+Bue}return n.prototype.save=function(e){return je(this,void 0,void 0,function(){var t,r,a,i,o,s;return Xe(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],a=G3(e,r),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),o=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor,o.download=this.modelJsonFileName,o.href=i,[4,TA(function(){return o.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),e.weightData==null?[3,4]:(s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor,s.download=this.weightDataFileName,s.href=t,[4,TA(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:rf(e)}]}})})},n}();Zp.URL_SCHEME="downloads://";var Lue=function(){function n(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, "+"but received ".concat(e));this.jsonFile=e[0],this.weightsFiles=e.slice(1)}return n.prototype.load=function(){return je(this,void 0,void 0,function(){var e=this;return Xe(this,function(t){return[2,new Promise(function(r,a){var i=new FileReader;i.onload=function(o){var s=JSON.parse(o.target.result),u=s.modelTopology;if(u==null){a(new Error("modelTopology field is missing from file ".concat(e.jsonFile.name)));return}var c=s.weightsManifest;if(c==null){a(new Error("weightManifest field is missing from file ".concat(e.jsonFile.name)));return}if(e.weightsFiles.length===0){r({modelTopology:u});return}var l=L0(s,function(f){return e.loadWeights(f)});r(l)},i.onerror=function(o){return a("Failed to read model topology and weights manifest JSON "+"from file '".concat(e.jsonFile.name,"'. BrowserFiles supports loading ")+"Keras-style tf.Model artifacts only.")},i.readAsText(e.jsonFile)})]})})},n.prototype.loadWeights=function(e){var t,r,a=this,i=[],o=[];try{for(var s=cr(e),u=s.next();!u.done;u=s.next()){var c=u.value;i.push.apply(i,wt([],ke(c.weights),!1)),o.push.apply(o,wt([],ke(c.paths),!1))}}catch(h){t={error:h}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}var l=this.checkManifestAndWeightFiles(e),f=o.map(function(h){return a.loadWeightsFile(h,l[h])});return Promise.all(f).then(function(h){return[i,B0(h)]})},n.prototype.loadWeightsFile=function(e,t){return new Promise(function(r,a){var i=new FileReader;i.onload=function(o){var s=o.target.result;r(s)},i.onerror=function(o){return a("Failed to weights data from file of path '".concat(e,"'."))},i.readAsArrayBuffer(t)})},n.prototype.checkManifestAndWeightFiles=function(e){var t,r,a=this,i=[],o=this.weightsFiles.map(function(f){return kA(f.name)}),s={};try{for(var u=cr(e),c=u.next();!c.done;c=u.next()){var l=c.value;l.paths.forEach(function(f){var h=kA(f);if(i.indexOf(h)!==-1)throw new Error("Duplicate file basename found in weights manifest: "+"'".concat(h,"'"));if(i.push(h),o.indexOf(h)===-1)throw new Error("Weight file with basename '".concat(h,"' is not provided."));s[f]=a.weightsFiles[o.indexOf(h)]})}}catch(f){t={error:f}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}if(i.length!==this.weightsFiles.length)throw new Error("Mismatch in the number of files in weights manifest "+"(".concat(i.length,") and the number of weight files provided ")+"(".concat(this.weightsFiles.length,")."));return s},n}(),zue=function(n){return vt().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Zp.URL_SCHEME)?$ue(n.slice(Zp.URL_SCHEME.length)):null};fa.registerSaveRouter(zue);function $ue(n){return n===void 0&&(n="model"),new Zp(n)}function que(n){return new Lue(n)}function EA(n,e,t,r){o(n),t=t??0,r=r??1,s(t,r);var a=0,i=function(u){return u.then(function(c){var l=t+ ++a/n.length*(r-t);return e(l),c}),u};function o(u){q(u!=null&&Array.isArray(u)&&u.length>0,function(){return"promises must be a none empty array"})}function s(u,c){q(u>=0&&u<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(u)}),q(c>=0&&c<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(c)}),q(c>=u,function(){return"startFraction must be no more than endFraction, but "+"got startFraction ".concat(u," and endFraction ")+"".concat(c)})}return Promise.all(n.map(i))}function eR(n,e){return je(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f,h;return Xe(this,function(p){switch(p.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?vt().platform.fetch:e.fetchFunc,r=n.map(function(d){return t(d,e.requestInit,{isBinary:!0})}),a=0,i=.5,e.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return s=p.sent(),[3,4];case 2:return[4,EA(r,e.onProgress,a,i)];case 3:s=p.sent(),p.label=4;case 4:return o=s,u=o.map(function(d){return d.arrayBuffer()}),c=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(u)];case 5:return h=p.sent(),[3,8];case 6:return[4,EA(u,e.onProgress,c,l)];case 7:h=p.sent(),p.label=8;case 8:return f=h,[2,f]}})})}function Wue(n,e,t,r){return e===void 0&&(e=""),je(this,void 0,void 0,function(){var a,i;return Xe(this,function(o){return a=function(s){return eR(s,{requestInit:r})},i=tR(a),[2,i(n,e,t)]})})}function tR(n){var e=this;return function(t,r,a){return r===void 0&&(r=""),je(e,void 0,void 0,function(){var i,o,s,u,c,l,f,h,p,d;return Xe(this,function(v){switch(v.label){case 0:if(i=t.map(function(){return!1}),o={},s=a!=null?a.map(function(){return!1}):[],u=[],t.forEach(function(m,g){var y=0;m.weights.forEach(function(b){var w="quantization"in b?b.quantization.dtype:b.dtype,x=v0[w]*Ut(b.shape),N=function(){i[g]=!0,o[g]==null&&(o[g]=[]),o[g].push({manifestEntry:b,groupOffset:y,sizeBytes:x})};a!=null?a.forEach(function(T,E){T===b.name&&(N(),s[E]=!0)}):N(),u.push(b.name),y+=x})}),!s.every(function(m){return m}))throw c=a.filter(function(m,g){return!s[g]}),new Error("Could not find weights in manifest with names: "+"".concat(c.join(", "),`. 
`)+"Manifest JSON has weights with names: "+"".concat(u.join(", "),"."));return l=i.reduce(function(m,g,y){return g&&m.push(y),m},[]),f=[],l.forEach(function(m){t[m].paths.forEach(function(g){var y=r+(r.endsWith("/")?"":"/")+g;f.push(y)})}),[4,n(f)];case 1:return h=v.sent(),p={},d=0,l.forEach(function(m){for(var g=t[m].paths.length,y=0,b=0;b<g;b++)y+=h[d+b].byteLength;for(var w=new ArrayBuffer(y),x=new Uint8Array(w),N=0,T=0;T<g;T++){var E=new Uint8Array(h[d+T]);x.set(E,N),N+=E.byteLength}var C=o[m];C.forEach(function(F){var D=w.slice(F.groupOffset,F.groupOffset+F.sizeBytes),O=V3(D,[F.manifestEntry]);for(var L in O)p[L]=O[L]}),d+=g}),[2,p]}})})}}var Vue="application/octet-stream",Gue="application/json",cy=function(){function n(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(q(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=vt().platform.fetch,q(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&q(e.length===2,function(){return"URL paths for http must have a length of 2, "+"(actual length is ".concat(e.length,").")}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return n.prototype.save=function(e){return je(this,void 0,void 0,function(){var t,r,a,i;return Xe(this,function(o){switch(o.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit),t.body=new FormData,r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=G3(e,r),t.body.append("model.json",new Blob([JSON.stringify(a)],{type:Gue}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:Vue}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if(i=o.sent(),i.ok)return[2,{modelArtifactsInfo:rf(e),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(i.status,"."))}})})},n.prototype.load=function(){return je(this,void 0,void 0,function(){var e,t,r,a,i,o=this;return Xe(this,function(s){switch(s.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(e=s.sent(),!e.ok)throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(e.status,". Please verify this URL points to ")+"the model JSON of the model to load.");s.label=2;case 2:return s.trys.push([2,4,,5]),[4,e.json()];case 3:return t=s.sent(),[3,5];case 4:throw s.sent(),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(a=t.modelTopology,i=t.weightsManifest,a==null&&i==null)throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");return[2,L0(t,function(u){return o.loadWeights(u)})]}})})},n.prototype.loadWeights=function(e){return je(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f,h,p,d,v,m,g,y,b,w,x,N,T,E;return Xe(this,function(C){switch(C.label){case 0:t=Array.isArray(this.path)?this.path[1]:this.path,r=ke(Uue(t),2),a=r[0],i=r[1],o=this.weightPathPrefix||a,s=H3(e),u=[],c=[];try{for(l=cr(e),f=l.next();!f.done;f=l.next()){h=f.value;try{for(p=(T=void 0,cr(h.paths)),d=p.next();!d.done;d=p.next())v=d.value,this.weightUrlConverter!=null?c.push(this.weightUrlConverter(v)):u.push(o+v+i)}catch(F){T={error:F}}finally{try{d&&!d.done&&(E=p.return)&&E.call(p)}finally{if(T)throw T.error}}}}catch(F){x={error:F}}finally{try{f&&!f.done&&(N=l.return)&&N.call(l)}finally{if(x)throw x.error}}return this.weightUrlConverter?(g=(m=u.push).apply,y=[u],b=[[]],[4,Promise.all(c)]):[3,2];case 1:g.apply(m,y.concat([wt.apply(void 0,b.concat([ke.apply(void 0,[C.sent()]),!1]))])),C.label=2;case 2:return[4,eR(u,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 3:return w=C.sent(),[2,[s,B0(w)]]}})})},n}();cy.URL_SCHEME_REGEX=/^https?:\/\//;function Uue(n){var e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),r=n.substring(0,e),a=t>e?n.substring(t):"";return[r+"/",a]}function N0(n){return n.match(cy.URL_SCHEME_REGEX)!=null}var nR=function(n,e){if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;var t=!0;return Array.isArray(n)?t=n.every(function(r){return N0(r)}):t=N0(n),t?ly(n,e):null};fa.registerSaveRouter(nR);fa.registerLoadRouter(nR);function ly(n,e){return new cy(n,e)}function Hue(n,e){return ly(n,e)}var Qg=function(){function n(e){this.modelArtifacts=e}return n.prototype.load=function(){return this.modelArtifacts},n}(),rR=function(){function n(e){this.saveHandler=e}return n.prototype.save=function(e){return this.saveHandler(e)},n}(),Kue=function(){function n(e){e.load&&(this.load=function(){return Promise.resolve(e.load())}),e.save&&(this.save=function(t){return Promise.resolve(e.save(t))})}return n}();function jue(n,e,t,r){var a=arguments;return new Kue(aR.apply(void 0,wt([],ke(a),!1)))}function aR(n,e,t,r){if(arguments.length===1){var a=n.modelTopology!=null||n.weightSpecs!=null;return a?new Qg(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Qg({modelTopology:n}))}else return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Qg({modelTopology:n,weightSpecs:e,weightData:t,trainingConfig:r})}function Xue(n){return new rR(n)}function Yue(n){return new rR(n)}var Zue={__proto__:null,browserFiles:que,browserHTTPRequest:Hue,concatenateArrayBuffers:B0,decodeWeights:V3,encodeWeights:MQ,fromMemory:jue,fromMemorySync:aR,getLoadHandlers:KQ,getModelArtifactsForJSON:L0,getModelArtifactsForJSONSync:U3,getModelArtifactsInfoForJSON:rf,getSaveHandlers:HQ,getWeightSpecs:H3,http:ly,isHTTPScheme:N0,loadWeights:Wue,registerLoadRouter:UQ,registerSaveRouter:GQ,weightsLoaderFactory:tR,withSaveHandler:Xue,withSaveHandlerSync:Yue,copyModel:see,listModels:iee,moveModel:uee,removeModel:oee};function Jue(n,e,t){var r=P(n,"labels","confusionMatrix"),a=P(e,"predictions","confusionMatrix");q(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, "+"but got ".concat(t)}),q(r.rank===1,function(){return"Expected the rank of labels to be 1, but got ".concat(r.rank)}),q(a.rank===1,function(){return"Expected the rank of predictions to be 1, "+"but got ".concat(a.rank)}),q(r.shape[0]===a.shape[0],function(){return"Mismatch in the number of examples: "+"".concat(r.shape[0]," vs. ").concat(a.shape[0],". ")+"Labels and predictions should have the same number of elements."}),q(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+"".concat(t)});var i=k0(Nn(r,"int32"),t),o=k0(Nn(a,"int32"),t),s=Yp(i),u=Ft(s,o);return Nn(u,"int32")}var Que=H({confusionMatrix_:Jue});var ece={__proto__:null,confusionMatrix:Que},ls;function iR(n,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,r=!1,a=!1,i=!1,o=!1,s=!1;if(n.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)a=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)i=!0;else if(n.getContext!=null)o=!0;else if(typeof ImageBitmap<"u"&&n instanceof ImageBitmap)s=!0;else throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, "+"but was ".concat(n.constructor.name));var u=qp(n0,U.backendName);if(u!=null){var c={pixels:n},l={numChannels:e};return U.runKernel(n0,c,l)}var f=ke(a?[n.videoWidth,n.videoHeight]:[n.width,n.height],2),h=f[0],p=f[1],d;if(o)d=n.getContext("2d").getImageData(0,0,h,p).data;else if(r||t)d=n.data;else if(i||a||s){if(ls==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")ls=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else ls=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});ls.canvas.width=h,ls.canvas.height=p,ls.drawImage(n,0,0,h,p),d=ls.getImageData(0,0,h,p).data}var v;if(e===4)v=new Int32Array(d);else{var m=h*p;v=new Int32Array(m*e);for(var g=0;g<m;g++)for(var y=0;y<e;++y)v[g*e+y]=d[g*4+y]}var b=[p,h,e];return qF(v,b,"int32")}function tce(n){return n!=null&&n.data instanceof Uint8Array}function nce(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function rce(n){return n!=null&&n.width!==0&&n.height!==0}function ace(n){return nce()&&!(n instanceof ImageBitmap)&&rce(n)&&!tce(n)}function ice(n,e){return e===void 0&&(e=3),je(this,void 0,void 0,function(){var t,r;return Xe(this,function(a){switch(a.label){case 0:if(t=null,!(vt().getBool("WRAP_TO_IMAGEBITMAP")&&ace(n)))return[3,5];r=void 0,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,createImageBitmap(n,{premultiplyAlpha:"none"})];case 2:return r=a.sent(),[3,4];case 3:return a.sent(),r=null,[3,4];case 4:return r!=null&&r.width===n.width&&r.height===n.height?t=r:t=n,[3,6];case 5:t=n,a.label=6;case 6:return[2,iR(t,e)]}})})}function oce(n,e){return je(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f,h,p,d,v,m,g;return Xe(this,function(y){switch(y.label){case 0:if(t=P(n,"img","toPixels"),n instanceof Pn||(r=t,t=Nn(r,"int32"),r.dispose()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank ".concat(t.rank,"."));if(a=ke(t.shape.slice(0,2),2),i=a[0],o=a[1],s=t.rank===2?1:t.shape[2],s>4||s===2)throw new Error("toPixels only supports depth of size "+"1, 3 or 4 but got ".concat(s));if(t.dtype!=="float32"&&t.dtype!=="int32")throw new Error("Unsupported type for toPixels: ".concat(t.dtype,".")+" Please use float32 or int32 tensors.");return[4,t.data()];case 1:for(u=y.sent(),c=t.dtype==="float32"?255:1,l=new Uint8ClampedArray(o*i*4),f=0;f<i*o;++f){for(h=[0,0,0,255],p=0;p<s;p++){if(d=u[f*s+p],t.dtype==="float32"){if(d<0||d>1)throw new Error("Tensor values for a float32 Tensor must be in the "+"range [0 - 1] but encountered ".concat(d,"."))}else if(t.dtype==="int32"&&(d<0||d>255))throw new Error("Tensor values for a int32 Tensor must be in the "+"range [0 - 255] but encountered ".concat(d,"."));s===1?(h[0]=d*c,h[1]=d*c,h[2]=d*c):h[p]=d*c}v=f*4,l[v+0]=Math.round(h[0]),l[v+1]=Math.round(h[1]),l[v+2]=Math.round(h[2]),l[v+3]=Math.round(h[3])}return e!=null&&(e.width=o,e.height=i,m=e.getContext("2d"),g=new ImageData(l,o,i),m.putImageData(g,0,0)),t!==n&&t.dispose(),[2,l]}})})}var sce=H({fromPixels_:iR}),uce={__proto__:null,fromPixelsAsync:ice,toPixels:oce,fromPixels:sce};function oR(n,e){var t=n.shape.length,r=e.shape.length;if(t<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+" but the rank was ".concat(t,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(r,"."));if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type,"+" but the dtype was ".concat(e.dtype,"."));if(e.shape[r-1]>t)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+"".concat(e.shape[r-1]," vs. ").concat(t));if(Ut(n.shape)===0)throw new Error("Requested more than 0 entries, but input is empty."+" Input shape: ".concat(n.shape,"."));for(var a=e.shape,i=a[a.length-1],o=1,s=0;s<a.length-1;++s)o*=a[s];var u=n.shape,c=a.slice();c.pop();for(var l=1,s=i;s<t;++s)l*=u[s],c.push(u[s]);var f=wt(wt([],ke(Ju(n.shape).map(function(h){return h/l})),!1),[1],!1).slice(0,i);return[c,o,l,f]}var cce={__proto__:null,prepareAndValidate:oR},T0=-2,lce=-1;function fce(n,e,t){var r=n.shape.length;q(r===e.length,function(){return"Error in slice".concat(r,"D: Length of begin ").concat(e," must ")+"match the rank of the array (".concat(r,").")}),q(r===t.length,function(){return"Error in slice".concat(r,"D: Length of size ").concat(t," must ")+"match the rank of the array (".concat(r,").")});for(var a=function(o){q(e[o]+t[o]<=n.shape[o],function(){return"Error in slice".concat(r,"D: begin[").concat(o,"] + size[").concat(o,"] ")+"(".concat(e[o]+t[o],") would overflow input.shape[").concat(o,"] (").concat(n.shape[o],")")})},i=0;i<r;++i)a(i)}function hce(n){for(var e=[],t=0;n>0;)n&1&&e.push(t),n/=2,t++;return e}function pce(n,e,t){for(var r=[],a=0;a<n.length;a++)r[a]=Math.ceil((e[a]-n[a])/t[a]);return r}function sR(n,e,t,r){for(var a=wt([],ke(n),!1),i=a.length;i<r.length;i++)a.push(1);for(var i=0;i<t;i++)i===0?a[e]=1:(a.splice(e,0,1),a.pop());return a}function uR(n,e,t){return t<=n?t:t-(e-1)}function cR(n,e){for(var t=[],r=0;r<n;r++)t.push(e+r);return t}function dce(n,e,t,r,a,i,o,s,u){var c=n.length,l=new Array(c),f=new Array(c),h=new Array(c);if(e.length&&t>0){var p=e[0],d=t+1;l=lR(o,p,d,r,n),f=fR(s,p,d,a,n),h=sR(i,p,d,n)}else for(var v=0;v<c;v++)l[v]=pR(o,r,i,n,v,u),f[v]=dR(s,a,i,n,v,u),h[v]=hR(i,v,u);return{begin:l,end:f,strides:h}}function lR(n,e,t,r,a){for(var i=wt([],ke(a),!1),o=cR(t,e),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=0;else{var u=uR(e,t,s),c=r[u];n&1<<u&&(c=0),i[s]=c}return i}function fR(n,e,t,r,a){for(var i=wt([],ke(a),!1),o=cR(t,e),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=Number.MAX_SAFE_INTEGER;else{var u=uR(e,t,s),c=r[u];n&1<<u&&(c=Number.MAX_SAFE_INTEGER),i[s]=c}for(var l=0;l<i.length;l++){var f=a[l];i[l]<0&&(i[l]+=f),i[l]=$l(0,i[l],a[l])}return i}function hR(n,e,t){var r=n[e];return(t&1<<e||r==null)&&(r=1),r}function pR(n,e,t,r,a,i){var o=e[a],s=t[a]||1;(n&1<<a||i&1<<a||o==null)&&(s>0?o=Number.MIN_SAFE_INTEGER:o=Number.MAX_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),o=$l(0,o,u-1),o}function dR(n,e,t,r,a,i){var o=e[a],s=t[a]||1;(n&1<<a||i&1<<a||o==null)&&(s>0?o=Number.MAX_SAFE_INTEGER:o=Number.MIN_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),s>0?o=$l(0,o,u):o=$l(-1,o,u-1),o}function vce(n,e,t){for(var r=t.length,a=0;a<t.length;a++)if(t[a]>1){r=a;break}for(var a=r+1;a<t.length;a++)if(e[a]>0||t[a]!==n[a])return!1;return!0}function mce(n,e){for(var t=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function gce(n,e,t){var r,a=n.shape.length;typeof e=="number"?r=wt([e],ke(new Array(a-1).fill(0)),!1):e.length<a?r=e.concat(new Array(a-e.length).fill(0)):r=e.slice(),r.forEach(function(o){q(o!==-1,function(){return"slice() does not support negative begin indexing."})});var i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=wt([t],ke(new Array(a-1).fill(-1)),!1):t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map(function(o,s){return o>=0?o:(q(o===-1,function(){return"Negative size values should be exactly -1 but got "+"".concat(o," for the slice() size at index ").concat(s,".")}),n.shape[s]-r[s])}),[r,i]}function yce(n,e,t,r,a,i,o,s,u){var c;if(r==null?(c=new Array(e.length),c.fill(1)):c=r,o!=null&&(o&o-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");for(var l=!1,f={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:c.slice(),beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u},h=0;h<f.dims;h++)l&&(1<<h&s)!==0&&f.numAddAxisAfterEllipsis++,1<<h&o&&(l=!0);l||(f.ellipsisMask|=1<<f.dims,f.dims++);var p={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};bce(f,p);for(var d=!0,v=!0,m=!0,g=[],y=[],h=0;h<n.length;++h){if(p.strides[h]===0)throw Error("strides[".concat(h,"] must be non-zero"));var b=!!(p.shrinkAxisMask&1<<h),w=n[h];if(w===-1){g.push(b?1:-1);continue}var x=[p.beginMask&1<<h,p.endMask&1<<h],N=[p.strides[h]>0?0:-1,p.strides[h]>0?w:w-1];if(b&&p.strides[h]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&p.strides[h]===1;var T=!!(p.beginMask&1<<h&&p.endMask&1<<h);if(p.beginValid&&p.endValid){if(b){var E=p.begin[h]<0?w+p.begin[h]:p.begin[h];if(p.begin[h]=E,p.end[h]=p.begin[h]+1,E<0||E>=w)throw Error("slice index ".concat(p.begin[h]," of dimension ").concat(h," out of bounds."))}else p.begin[h]=IA(p.begin[h],0,p.strides[h],w,x,N),p.end[h]=IA(p.end[h],1,p.strides[h],w,x,N);var C=p.strides[h]===1&&p.begin[h]===0&&p.end[h]===w;d=d&&C,v=v&&(h===0&&p.strides[h]===1||C)}else d=d&&p.strides[h]===1&&T,v=v&&(h===0&&p.strides[h]===1||T);var F=void 0,D=!1;if(p.beginValid&&p.endValid?(F=p.end[h]-p.begin[h],D=!0):b?(F=1,D=!0):T&&w>=0&&(p.strides[h]<0?F=-w:F=w,D=!0),D){var O=void 0;F===0||F<0!=p.strides[h]<0?O=0:O=Math.trunc(F/p.strides[h])+(F%p.strides[h]!==0?1:0),g.push(O)}else g.push(-1)}for(var L=0;L<p.finalShapeGatherIndices.length;++L){var z=p.finalShapeGatherIndices[L];z>=0?y.push(g[z]):z===T0&&y.push(1)}var $=y.filter(function(B,W){return p.finalShapeGatherIndices[W]!==T0});return{finalShapeSparse:$,finalShape:y,isIdentity:d,sliceDim0:v,isSimpleSlice:m,begin:p.begin,end:p.end,strides:p.strides}}function bce(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;var t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(var r=0;r<n.dims;r++)if(1<<r&n.ellipsisMask)for(var a=Math.min(e.dims-(n.dims-r)+1+n.numAddAxisAfterEllipsis,e.dims);t<a;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=r;else if(1<<r&n.newAxisMask)e.finalShapeGatherIndices.push(T0),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error("Index out of range using input dim ".concat(t,"; input ")+"has only ".concat(e.dims," dims, ").concat(e.begin.length,"."));n.begin!=null&&(e.begin[t]=n.begin[r]),n.end!=null&&(e.end[t]=n.end[r]),e.strides[t]=n.strides[r],n.beginMask&1<<r&&(e.beginMask|=1<<t),n.endMask&1<<r&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<r?(e.finalShapeGatherIndices.push(lce),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(r)),e.inputShapeGatherIndicesSparse[t]=r,t++}}function IA(n,e,t,r,a,i){if(a[e])return t>0?i[e]:i[e+1&1];var o=n<0?r+n:n;return o<i[0]?i[0]:o>i[1]?i[1]:o}var vR={__proto__:null,assertParamsValid:fce,maskToAxes:hce,computeOutShape:pce,stridesWithElidedDims:sR,getNormalizedAxes:dce,startIndicesWithElidedDims:lR,stopIndicesWithElidedDims:fR,stridesForAxis:hR,startForAxis:pR,stopForAxis:dR,isSliceContinous:vce,computeFlatOffset:mce,parseSliceParams:gce,sliceInfo:yce};var wce="4.2.0";var mR=function(){function n(){}return n.sgd=function(e){return new dd(e)},n.momentum=function(e,t,r){return r===void 0&&(r=!1),new sy(e,t,r)},n.rmsprop=function(e,t,r,a,i){return t===void 0&&(t=.9),r===void 0&&(r=0),a===void 0&&(a=null),i===void 0&&(i=!1),new uy(e,t,r,a,i)},n.adam=function(e,t,r,a){return e===void 0&&(e=.001),t===void 0&&(t=.9),r===void 0&&(r=.999),a===void 0&&(a=null),new iy(e,t,r,a)},n.adadelta=function(e,t,r){return e===void 0&&(e=.001),t===void 0&&(t=.95),r===void 0&&(r=null),new ry(e,t,r)},n.adamax=function(e,t,r,a,i){return e===void 0&&(e=.002),t===void 0&&(t=.9),r===void 0&&(r=.999),a===void 0&&(a=null),i===void 0&&(i=0),new oy(e,t,r,a,i)},n.adagrad=function(e,t){return t===void 0&&(t=.1),new ay(e,t)},n}();var xce=mR;var kce=function(){return typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:function(n){return n()}}();function Sce(){return new Promise(function(n){return kce(function(){return n()})})}function Nce(n,e){var t=n[0].length;n.forEach(function(a,i){q(a.length===t,function(){return"Error in concat".concat(t,"D: rank of tensors[").concat(i,"] must be the same ")+"as the rank of the rest (".concat(t,")")})}),q(e>=0&&e<t,function(){return"Error in concat".concat(t,"D: axis must be between 0 and ").concat(t-1,".")});var r=n[0];n.forEach(function(a,i){for(var o=0;o<t;o++)q(o===e||a[o]===r[o],function(){return"Error in concat".concat(t,"D: Shape of tensors[").concat(i,"] (").concat(a,") ")+"does not match the shape of the rest (".concat(r,") ")+"along the non-concatenated axis ".concat(i,".")})})}function Tce(n,e){for(var t=n[0].slice(),r=1;r<n.length;r++)t[e]+=n[r][e];return t}var Ii;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(Ii||(Ii={}));function Ece(n,e,t){var r=new Array;if(t==null&&e==null)return r;if(e==null)for(;r.length<n+t.length;)r.push(-1);else r=e.slice();if(t==null)return r;if(n+t.length!==r.length)throw new Error("rt input.shape and shape=".concat(e," are incompatible: rt input.rank = ").concat(n+t.length,", but shape.rank = ").concat(r.length));for(var a=1;a<t.length;++a){var i=t[a],o=r[r.length-t.length+a],s=r[o];if(i>=0)if(s>=0){if(s!==i)throw new Error("rt input.shape and shape=".concat(e," are incompatible: rt input.shape[").concat(a+n,"] = ").concat(i," but shape[").concat(a+n,"] = ").concat(s))}else r[o]=i}return r}function Ice(n){var e,t,r={FIRST_DIM_SIZE:Ii.FIRST_DIM_SIZE,VALUE_ROWIDS:Ii.VALUE_ROWIDS,ROW_LENGTHS:Ii.ROW_LENGTHS,ROW_SPLITS:Ii.ROW_SPLITS,ROW_LIMITS:Ii.ROW_LIMITS,ROW_STARTS:Ii.ROW_STARTS},a=[];try{for(var i=cr(n),o=i.next();!o.done;o=i.next()){var s=o.value;if(s in r)a.push(r[s]);else break}}catch(u){e={error:u}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return a}function Cce(n){return n.length===0?0:n[0]===Ii.FIRST_DIM_SIZE?n.length-1:n.length}function Ace(n,e){if(!(n==null||e==null)){var t=n.length,r=e.length;if(t>=r)throw new Error("defaultValue.shape=".concat(n," and ragged tensor flatValues.shape=").concat(e,", are incompatible: defaultValue.rank = ").concat(t," must be less than ragged tensor input flatValues.rank = ").concat(r,")"));for(var a=0;a<Math.min(t,r-1);++a){var i=n[a],o=e[a+1];if(i>=0&&o>=0&&i!==1&&i!==o)throw new Error("defaultValue.shape=".concat(n,", and ragged tensor input flatValues.shape=").concat(e," are incompatible: defaultValue.shape[").concat(a-n.length,"] = ").concat(i," but ragged tensor input.flatValues.shape[").concat(a-n.length,"] = ").concat(o))}}}var fy=30;function _ce(n){return n<=fy?n:$p(n,Math.floor(Math.sqrt(n)))}function Dce(n,e,t){var r=t*(typeof n=="number"?n:n[0]),a=e*(typeof n=="number"?n:n[1]);return[r,a]}function Fce(n,e,t,r){r===void 0&&(r=!0);var a=[];if(r)a=a.concat(e.slice(0)),a.push(n[0]/t),a=a.concat(n.slice(1));else{a=a.concat(n[0]);for(var i=e.length,o=0;o<i;++o)a=a.concat([n[o+1]/e[o],e[o]]);a=a.concat(n.slice(i+1))}return a}function Rce(n,e,t){t===void 0&&(t=!0);var r=[];if(t){r.push(e);for(var a=e+1;a<n;++a)a<=2*e?(r.push(a),r.push(a-(e+1))):r.push(a)}else{for(var i=[],o=[],a=1;a<n;++a)a>=e*2+1||a%2===1?o.push(a):i.push(a);r.push.apply(r,wt([],ke(i),!1)),r.push(0),r.push.apply(r,wt([],ke(o),!1))}return r}function Oce(n,e,t,r){r===void 0&&(r=!0);var a=[];r?a.push(n[0]/t):a.push(n[0]*t);for(var i=1;i<n.length;++i)i<=e.length?r?a.push(e[i-1]*n[i]):a.push(n[i]/e[i-1]):a.push(n[i]);return a}function Pce(n,e){for(var t=[0],r=0;r<e;++r)t.push(n[r][0]);return t}function Mce(n,e,t){for(var r=n.slice(0,1),a=0;a<t;++a)r.push(n[a+1]-e[a][0]-e[a][1]);return r}var Bce=1.7580993408473768,Lce=1.0507009873554805;var zce=.3275911,$ce=.254829592,qce=-.284496736,Wce=1.421413741,Vce=-1.453152027,Gce=1.061405429;function Uce(n,e){if(n.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+"".concat(n.length,", imag: ").concat(e.length,"."));for(var t=new Float32Array(n.length*2),r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function Hce(n){for(var e=new Float32Array(n.length/2),t=new Float32Array(n.length/2),r=0;r<n.length;r+=2)e[r/2]=n[r],t[r/2]=n[r+1];return{real:e,imag:t}}function Kce(n){for(var e=Math.ceil(n.length/4),t=new Float32Array(e),r=new Float32Array(e),a=0;a<n.length;a+=4)t[Math.floor(a/4)]=n[a],r[Math.floor(a/4)]=n[a+1];return{real:t,imag:r}}function jce(n){for(var e=Math.floor(n.length/4),t=new Float32Array(e),r=new Float32Array(e),a=2;a<n.length;a+=4)t[Math.floor(a/4)]=n[a],r[Math.floor(a/4)]=n[a+1];return{real:t,imag:r}}function Xce(n,e){var t=n[e*2],r=n[e*2+1];return{real:t,imag:r}}function Yce(n,e,t,r){n[r*2]=e,n[r*2+1]=t}function Zce(n,e){for(var t=new Float32Array(n/2),r=new Float32Array(n/2),a=0;a<Math.ceil(n/2);a++){var i=(e?2:-2)*Math.PI*(a/n);t[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:t,imag:r}}function Jce(n,e,t){var r=(t?2:-2)*Math.PI*(n/e),a=Math.cos(r),i=Math.sin(r);return{real:a,imag:i}}var e0="->",Qce=/->/g,CA=",",AA="...";function ele(n,e){n=n.replace(/\s/g,"");var t=(n.length-n.replace(Qce,"").length)/e0.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error('Equation must contain exactly one arrow ("'.concat(e0,'").'));var r=ke(n.split(e0),2),a=r[0],i=r[1];q(a.indexOf(AA)===-1,function(){return'The ellipsis notation ("'.concat(AA,'") is not supported yet.')});var o=a.split(CA),s=o.length;if(e!==s)throw new Error("Expected ".concat(s," input tensors, received ").concat(e));if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");for(var u=[],c=function(g){var y=i[g];if(!o.some(function(b){return b.indexOf(y)!==-1}))throw new Error("Output subscripts contain the label ".concat(y," ")+"not present in the input subscripts.");u.indexOf(y)===-1&&u.push(y)},l=0;l<i.length;++l)c(l);for(var l=0;l<a.length;++l){var f=a[l];u.indexOf(f)===-1&&f!==CA&&u.push(f)}for(var h=new Array(o.length),l=0;l<s;++l){if(new Set(o[l].split("")).size!==o[l].length)throw new Error("Found duplicate axes in input component ".concat(o[l],". ")+"Support for duplicate axes in input is not implemented yet.");h[l]=[];for(var p=0;p<o[l].length;++p)h[l].push(u.indexOf(o[l][p]))}for(var d=u.length,v=i.length,m=[],l=v;l<d;++l)m.push(l);return{allDims:u,summedDims:m,idDims:h}}function tle(n,e){var t=new Array(n);t.fill(-1);for(var r=0;r<e.length;++r)t[e[r]]=r;for(var a=[],r=0;r<n;++r)t[r]===-1&&a.push(r);return t=t.filter(function(i){return i!==-1}),{permutationIndices:t,expandDims:a}}function nle(n,e,t){for(var r=new Array(n),a=function(o){for(var s=t[o].shape,u=function(l){r[e[o][l]]===void 0?r[e[o][l]]=s[l]:q(r[e[o][l]]===s[l],function(){return"Expected dimension ".concat(r[e[o][l]]," at axis ").concat(l," ")+"of input shaped ".concat(JSON.stringify(s),", ")+"but got dimension ".concat(s[l])})},c=0;c<e[o].length;++c)u(c)},i=0;i<t.length;++i)a(i)}function rle(n,e){var t,r,a=n,i=[],o=0;n.length===0&&a.push(-1),o=n.length+1;for(var s=0;s<o;++s)i.push([]);for(var u=[],s=0;s<a.length;++s){var c=a[s],l=ile(e,c);try{for(var f=(t=void 0,cr(l)),h=f.next();!h.done;h=f.next()){var p=h.value;u.indexOf(p)===-1&&(i[s].push(p),u.push(p))}}catch(v){t={error:v}}finally{try{h&&!h.done&&(r=f.return)&&r.call(f)}finally{if(t)throw t.error}}}return{path:a,steps:i}}function ale(n){return n.every(function(e,t){return e===t})}function ile(n,e){for(var t=[],r=0;r<n.length;++r)(n[r].length===0||n[r].indexOf(e)!==-1||e===-1)&&t.push(r);return t}function ole(n,e,t){t===void 0&&(t=0);var r=[];if(typeof e=="number")q(n.shape[t]%e===0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(e).fill(n.shape[t]/e);else{var a=e.reduce(function(s,u){return u===-1&&(s+=1),s},0);q(a<=1,function(){return"There should be only one negative value in split array."});var i=e.indexOf(-1);if(i!==-1){var o=e.reduce(function(s,u){return u>0?s+u:s});e[i]=n.shape[t]-o}q(n.shape[t]===e.reduce(function(s,u){return s+u}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=e}return r}function sle(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = `.concat(n)}function ule(n,e){return"indices(".concat(n,", 0) is invalid: ").concat(e," < 0")}function cle(n,e,t){return"indices(".concat(n,", 0) is invalid: ").concat(e," >= ").concat(t)}function lle(n,e){return"only one output dimension may be -1, not both ".concat(n," and ").concat(e)}function fle(n,e){return"size ".concat(n," must be non-negative, not ").concat(e)}function hle(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function ple(n,e){var t=Ut(n),r=Ut(e);return"Input to reshape is a SparseTensor with ".concat(t,`
  dense values, but the requested shape requires a multiple of `).concat(r,". inputShape=").concat(n," outputShape= ").concat(e)}function dle(n,e){var t=Ut(n),r=Ut(e);return"Input to reshape is a tensor with ".concat(t," dense values, but the requested shape has ").concat(r,". inputShape=").concat(n," outputShape=").concat(e)}function vle(){return"segment ids must be >= 0"}function mle(){return"segment ids are not increasing"}function gle(n,e){return"Segment id ".concat(n," out of range [0, ").concat(e,"), possibly because segmentIds input is not sorted.")}function yle(n,e,t){return"Bad: indices[".concat(n,"] == ").concat(e," out of range [0, ").concat(t,")")}function ble(n,e){var t=!1,r;for(n<=fy?(r=n,t=!0):r=$p(n,Math.floor(Math.sqrt(n)));!t;)r>e||r===n?t=!0:r=$p(n,r+1);return r}function wle(n,e,t){for(var r=[],a=n.length,i=0;i<a;i++)i!==e?r.push(n[i]):r.push(t);return r}function xle(n,e,t,r){var a=e.shape.length,i=n.shape.length;if(r!==0&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>i)throw new Error("batchDims (".concat(r,`) must be less than rank(x) (
    `).concat(i,")."));if(t<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(t,")."));for(var o=0;o<r;++o)if(n.shape[o]!==e.shape[o])throw new Error("x.shape[".concat(o,"]: ").concat(n.shape[o]," should be equal to indices.shape[").concat(o,"]: ").concat(e.shape[o],"."));for(var s=n.shape[t],u=[],c=1,l=1,f=1,o=0;o<r;++o)u.push(n.shape[o]),c*=n.shape[o];for(var o=r;o<t;o++)u.push(n.shape[o]),l*=n.shape[o];for(var o=r;o<a;o++)u.push(e.shape[o]);for(var o=t+1;o<i;o++)u.push(n.shape[o]),f*=n.shape[o];return{batchSize:c,sliceSize:f,outerSize:l,dimSize:s,outputShape:u}}var kle={__proto__:null,segOpComputeOptimalWindowSize:ble,computeOutShape:wle,collectGatherOpShapeInfo:xle};function Sle(n){try{return n.map(function(e){return Gp(e)})}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(e))}}function Nle(n){return n.map(function(e){return nf(e)})}var Tle={__proto__:null,slice_util:vR,segment_util:kle,fromUint8ToStringArray:Sle,fromStringArrayToUint8:Nle,upcastType:nd,axesAreInnerMostDims:W0,combineLocations:pF,computeOutAndReduceShapes:Lne,expandShapeToKeepDim:sf,assertAxesAreInnerMostDims:zne,getAxesPermutation:$ne,getUndoAxesPermutation:qne,getInnerMostAxes:Wne,getBroadcastDims:lF,getReductionAxes:q0,assertAndGetBroadcastShape:Bn,assertParamsConsistent:Nce,computeOutShape:Tce,computeDilation2DInfo:ute,computePool2DInfo:rF,computePool3DInfo:cte,computeConv2DInfo:af,computeConv3DInfo:aF,computeDefaultPad:z0,tupleValuesAreOne:Kl,eitherStridesOrDilationsAreOne:Ji,stridesOrDilationsArePositive:ws,convertConv2DDataFormat:iF,checkPadOnDimRoundingMode:Ca,getFusedDyActivation:ld,getFusedBiasGradient:fd,applyActivation:hd,shouldFuse:pd,get RowPartitionType(){return Ii},combineRaggedTensorToTensorShapes:Ece,getRowPartitionTypesHelper:Ice,getRaggedRank:Cce,validateDefaultValueShape:Ace,PARALLELIZE_THRESHOLD:fy,computeOptimalWindowSize:_ce,getImageCenter:Dce,getReshaped:Fce,getPermuted:Rce,getReshapedPermuted:Oce,getSliceBeginCoords:Pce,getSliceSize:Mce,prepareAndValidate:oR,validateUpdateShape:Q0,validateInput:ey,calculateShapes:GF,SELU_SCALEALPHA:Bce,SELU_SCALE:Lce,ERF_P:zce,ERF_A1:$ce,ERF_A2:qce,ERF_A3:Wce,ERF_A4:Vce,ERF_A5:Gce,warn:No,log:JJ,mergeRealAndImagArrays:Uce,splitRealAndImagArrays:Hce,complexWithEvenIndex:Kce,complexWithOddIndex:jce,getComplexWithIndex:Xce,assignToTypedArray:Yce,exponents:Zce,exponent:Jce,decodeEinsumEquation:ele,getEinsumPermutation:tle,checkEinsumDimSizes:nle,getEinsumComputePath:rle,isIdentityPermutation:ale,prepareSplitSize:ole,getSparseFillEmptyRowsIndicesDenseShapeMismatch:sle,getSparseFillEmptyRowsNegativeIndexErrorMessage:ule,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:cle,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:lle,getSparseReshapeNegativeOutputDimErrorMessage:fle,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:hle,getSparseReshapeInputOutputMultipleErrorMessage:ple,getSparseReshapeInputOutputMismatchErrorMessage:dle,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:vle,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:mle,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:gle,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:yle};var Ele={__proto__:null,nonMaxSuppressionV3Impl:jF,nonMaxSuppressionV4Impl:XF,nonMaxSuppressionV5Impl:YF,whereImpl:WF};Oue();A.Abs=VA;A.Acos=GA;A.Acosh=UA;A.AdadeltaOptimizer=ry;A.AdagradOptimizer=ay;A.AdamOptimizer=iy;A.AdamaxOptimizer=oy;A.Add=C0;A.AddN=HA;A.All=KA;A.Any=jA;A.ArgMax=XA;A.ArgMin=YA;A.Asin=ZA;A.Asinh=JA;A.Atan=QA;A.Atan2=t_;A.Atanh=e_;A.AvgPool=n_;A.AvgPool3D=r_;A.AvgPool3DGrad=PJ;A.AvgPoolGrad=OJ;A.BatchMatMul=a_;A.BatchToSpaceND=i_;A.Bincount=o_;A.BroadcastArgs=s_;A.BroadcastTo=MJ;A.Cast=A0;A.Ceil=u_;A.ClipByValue=c_;A.Complex=l_;A.ComplexAbs=f_;A.Concat=h_;A.Conv2D=p_;A.Conv2DBackpropFilter=d_;A.Conv2DBackpropInput=v_;A.Conv3D=m_;A.Conv3DBackpropFilterV2=BJ;A.Conv3DBackpropInputV2=g_;A.Cos=y_;A.Cosh=b_;A.CropAndResize=k_;A.Cumprod=w_;A.Cumsum=x_;A.DataStorage=hJ;A.DenseBincount=S_;A.DepthToSpace=N_;A.DepthwiseConv2dNative=T_;A.DepthwiseConv2dNativeBackpropFilter=E_;A.DepthwiseConv2dNativeBackpropInput=I_;A.Diag=C_;A.Dilation2D=A_;A.Dilation2DBackpropFilter=zJ;A.Dilation2DBackpropInput=LJ;A.Einsum=D_;A.Elu=F_;A.EluGrad=$J;A.Environment=qA;A.Equal=O_;A.Erf=R_;A.Exp=P_;A.ExpandDims=M_;A.Expm1=B_;A.FFT=L_;A.Fill=z_;A.FlipLeftRight=$_;A.Floor=q_;A.FloorDiv=W_;A.FromPixels=n0;A.FusedBatchNorm=V_;A.FusedConv2D=a0;A.FusedDepthwiseConv2D=i0;A.GatherNd=U_;A.GatherV2=G_;A.Greater=H_;A.GreaterEqual=K_;A.IFFT=j_;A.Identity=_0;A.Imag=X_;A.IsFinite=Y_;A.IsInf=Z_;A.IsNan=J_;A.KernelBackend=_A;A.LRN=uD;A.LRNGrad=GJ;A.LeakyRelu=Q_;A.Less=eD;A.LessEqual=tD;A.LinSpace=nD;A.Log=rD;A.Log1p=aD;A.LogSoftmax=WJ;A.LogicalAnd=iD;A.LogicalNot=oD;A.LogicalOr=sD;A.LogicalXor=qJ;A.LowerBound=VJ;A.Max=cD;A.MaxPool=fD;A.MaxPool3D=hD;A.MaxPool3DGrad=HJ;A.MaxPoolGrad=UJ;A.MaxPoolWithArgmax=pD;A.Maximum=lD;A.Mean=dD;A.Min=vD;A.Minimum=mD;A.MirrorPad=gD;A.Mod=yD;A.MomentumOptimizer=sy;A.Multinomial=bD;A.Multiply=wD;A.Neg=xD;A.NonMaxSuppressionV3=SD;A.NonMaxSuppressionV4=ND;A.NonMaxSuppressionV5=TD;A.NotEqual=kD;A.OP_SCOPE_SUFFIX=W3;A.OneHot=ID;A.OnesLike=ED;A.Optimizer=Oo;A.OptimizerConstructors=mR;A.Pack=CD;A.PadV2=AD;A.Pool=KJ;A.Pow=_D;A.Prelu=DD;A.Prod=FD;A.RMSPropOptimizer=uy;A.RaggedGather=RD;A.RaggedRange=OD;A.RaggedTensorToTensor=PD;A.Range=MD;A.Real=BD;A.RealDiv=__;A.Reciprocal=LD;A.Relu=zD;A.Relu6=VD;A.Reshape=$D;A.ResizeBilinear=WD;A.ResizeBilinearGrad=XJ;A.ResizeNearestNeighbor=qD;A.ResizeNearestNeighborGrad=jJ;A.Reverse=GD;A.RotateWithOffset=C3;A.Round=UD;A.Rsqrt=HD;A.SGDOptimizer=dd;A.ScatterNd=KD;A.SearchSorted=jD;A.Select=XD;A.Selu=YD;A.Sigmoid=t3;A.Sign=e3;A.Sin=JD;A.Sinh=QD;A.Slice=ZD;A.Softmax=s3;A.Softplus=n3;A.SpaceToBatchND=i3;A.SparseFillEmptyRows=u3;A.SparseReshape=c3;A.SparseSegmentMean=l3;A.SparseSegmentSum=f3;A.SparseToDense=h3;A.SplitV=o3;A.Sqrt=r3;A.Square=YJ;A.SquaredDifference=p3;A.Step=I3;A.StridedSlice=d3;A.StringNGrams=v3;A.StringSplit=m3;A.StringToHashBucketFast=g3;A.Sub=y3;A.Sum=a3;A.Tan=b3;A.Tanh=w3;A.Tensor=Pn;A.TensorBuffer=Up;A.Tile=D0;A.TopK=x3;A.Transform=k3;A.Transpose=Op;A.Unique=S3;A.Unpack=N3;A.UnsortedSegmentSum=T3;A.UpperBound=ZJ;A.Variable=Vl;A.ZerosLike=E3;A._FusedMatMul=r0;A.abs=ua;A.acos=zee;A.acosh=qee;A.add=ut;A.addN=Vee;A.all=Uee;A.any=Kee;A.argMax=Xee;A.argMin=Zee;A.asin=Qee;A.asinh=tte;A.atan=rte;A.atan2=ite;A.atanh=ste;A.avgPool=oF;A.avgPool3d=gte;A.backend=Dee;A.backend_util=Tle;A.basicLSTMCell=Nte;A.batchNorm=rd;A.batchNorm2d=Ate;A.batchNorm3d=Dte;A.batchNorm4d=Rte;A.batchToSpaceND=sF;A.bincount=uF;A.booleanMaskAsync=Soe;A.broadcastArgs=Mte;A.broadcastTo=Bp;A.broadcast_util=Tne;A.browser=uce;A.buffer=Xi;A.cast=Nn;A.ceil=zte;A.clipByValue=qte;A.clone=gs;A.complex=_o;A.concat=Wr;A.concat1d=Vte;A.concat2d=Ute;A.concat3d=Kte;A.concat4d=Xte;A.conv1d=Jte;A.conv2d=ad;A.conv2dTranspose=tne;A.conv3d=rne;A.conv3dTranspose=sne;A.copyRegisteredKernels=nQ;A.cos=cne;A.cosh=fne;A.cosineWindow=ty;A.cumprod=pne;A.cumsum=vne;A.customGrad=Ai;A.denseBincount=gne;A.deprecationWarn=yee;A.depthToSpace=bne;A.depthwiseConv2d=$0;A.device_util=OQ;A.diag=kne;A.dilation2d=Nne;A.disableDeprecationWarnings=gee;A.dispose=Er;A.disposeVariables=bee;A.div=Gt;A.divNoNan=_ne;A.dot=Fne;A.dropout=Boe;A.einsum=One;A.elu=hF;A.enableDebugMode=mee;A.enableProdMode=vee;A.enclosingPowerOfTwo=UF;A.engine=wee;A.env=vt;A.equal=fF;A.erf=Bne;A.euclideanNorm=Zne;A.exp=xs;A.expandDims=hs;A.expm1=tre;A.eye=vF;A.fft=X0;A.fill=of;A.findBackend=Cee;A.findBackendFactory=Aee;A.floor=mF;A.floorDiv=nF;A.fused=Joe;A.gather=gF;A.gatherND=Ooe;A.gather_util=cce;A.getBackend=Eee;A.getGradient=o0;A.getKernel=qp;A.getKernelsForBackend=Wp;A.grad=Nre;A.grads=Tre;A.greater=od;A.greaterEqual=yF;A.ifft=Xp;A.imag=sd;A.image=Iue;A.inTopKAsync=zoe;A.io=Zue;A.irfft=LF;A.isFinite=lre;A.isInf=hre;A.isNaN=dre;A.keep=tF;A.kernel_impls=Ele;A.leakyRelu=bF;A.less=gre;A.lessEqual=V0;A.linalg=Cue;A.linspace=bre;A.localResponseNormalization=xre;A.log=Xl;A.log1p=wF;A.logSigmoid=Dre;A.logSoftmax=Ore;A.logSumExp=SF;A.logicalAnd=Kp;A.logicalNot=NF;A.logicalOr=TF;A.logicalXor=$re;A.losses=Aue;A.lowerBound=Wre;A.matMul=Ft;A.math=ece;A.max=Hu;A.maxPool=EF;A.maxPool3d=Ure;A.maxPoolWithArgmax=Kre;A.maximum=IF;A.mean=jp;A.memory=xee;A.meshgrid=Yre;A.min=x0;A.minimum=CF;A.mirrorPad=Qre;A.mod=tae;A.moments=rae;A.movingAverage=Eoe;A.mul=Me;A.multiRNNCell=iae;A.multinomial=sae;A.neg=ji;A.nextFrame=Sce;A.norm=id;A.notEqual=AF;A.oneHot=k0;A.ones=ms;A.onesLike=fae;A.op=H;A.outerProduct=pae;A.pad=uf;A.pad1d=mae;A.pad2d=yae;A.pad3d=wae;A.pad4d=kae;A.pool=Iae;A.pow=jl;A.prelu=DF;A.print=eF;A.prod=_ae;A.profile=kee;A.raggedGather=Fae;A.raggedRange=Oae;A.raggedTensorToTensor=Mae;A.rand=Lae;A.randomGamma=aie;A.randomNormal=OF;A.randomStandardNormal=sie;A.randomUniform=PF;A.range=Yl;A.ready=Tee;A.real=Zl;A.reciprocal=fie;A.registerBackend=_ee;A.registerGradient=QJ;A.registerKernel=A3;A.relu=cd;A.relu6=MF;A.removeBackend=Iee;A.reshape=ve;A.reverse=ks;A.reverse1d=mie;A.reverse2d=yie;A.reverse3d=wie;A.reverse4d=kie;A.rfft=Y0;A.round=BF;A.rsqrt=Tie;A.scalar=Rt;A.scatterND=Aoe;A.scatter_util=Ioe;A.searchSorted=G0;A.selu=Iie;A.separableConv2d=Aie;A.serialization=Fue;A.setBackend=Nee;A.setPlatform=Fee;A.setdiff1dAsync=Die;A.sigmoid=Uu;A.sign=Rie;A.signal=Eue;A.sin=Pie;A.sinh=Bie;A.slice=un;A.slice1d=zie;A.slice2d=qie;A.slice3d=Vie;A.slice4d=Uie;A.slice_util=vR;A.softmax=Kie;A.softplus=kF;A.spaceToBatchND=_F;A.sparse=_ue;A.sparseToDense=Foe;A.spectral=Tue;A.split=Jl;A.sqrt=Yi;A.square=ri;A.squaredDifference=zF;A.squeeze=Z0;A.stack=Ql;A.step=$F;A.stridedSlice=aoe;A.string=Due;A.sub=bt;A.sum=Vt;A.sumOutType=TQ;A.tan=ooe;A.tanh=w0;A.tensor=Wu;A.tensor1d=ni;A.tensor2d=zl;A.tensor3d=qF;A.tensor4d=soe;A.tensor5d=uoe;A.tensor6d=coe;A.tensor_util=CQ;A.test_util=eie;A.tidy=Mn;A.tile=Ll;A.time=See;A.topk=foe;A.train=xce;A.transpose=Yp;A.truncatedNormal=poe;A.unique=voe;A.unregisterGradient=tQ;A.unregisterKernel=eQ;A.unsortedSegmentSum=goe;A.unstack=J0;A.upcastType=nd;A.upperBound=boe;A.util=pQ;A.valueAndGrad=Ere;A.valueAndGrads=Ire;A.variable=woe;A.variableGrads=xF;A.version_core=wce;A.where=Yu;A.whereAsync=VF;A.zeros=Zu;A.zerosLike=ca});var IR=J((ait,ER)=>{ER.exports=jt;var Aa=null;try{Aa=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function jt(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}jt.prototype.__isLong__;Object.defineProperty(jt.prototype,"__isLong__",{value:!0});function Hr(n){return(n&&n.__isLong__)===!0}jt.isLong=Hr;var gR={},yR={};function _s(n,e){var t,r,a;return e?(n>>>=0,(a=0<=n&&n<256)&&(r=yR[n],r)?r:(t=Xt(n,(n|0)<0?-1:0,!0),a&&(yR[n]=t),t)):(n|=0,(a=-128<=n&&n<128)&&(r=gR[n],r)?r:(t=Xt(n,n<0?-1:0,!1),a&&(gR[n]=t),t))}jt.fromInt=_s;function _a(n,e){if(isNaN(n))return e?As:Da;if(e){if(n<0)return As;if(n>=kR)return TR}else{if(n<=-wR)return Ur;if(n+1>=wR)return NR}return n<0?_a(-n,e).neg():Xt(n%tc|0,n/tc|0,e)}jt.fromNumber=_a;function Xt(n,e,t){return new jt(n,e,t)}jt.fromBits=Xt;var vd=Math.pow;function py(n,e,t){if(n.length===0)throw Error("empty string");if(n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return Da;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var r;if((r=n.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return py(n.substring(1),e,t).neg();for(var a=_a(vd(t,8)),i=Da,o=0;o<n.length;o+=8){var s=Math.min(8,n.length-o),u=parseInt(n.substring(o,o+s),t);if(s<8){var c=_a(vd(t,s));i=i.mul(c).add(_a(u))}else i=i.mul(a),i=i.add(_a(u))}return i.unsigned=e,i}jt.fromString=py;function ii(n,e){return typeof n=="number"?_a(n,e):typeof n=="string"?py(n,e):Xt(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}jt.fromValue=ii;var bR=1<<16,Ile=1<<24,tc=bR*bR,kR=tc*tc,wR=kR/2,xR=_s(Ile),Da=_s(0);jt.ZERO=Da;var As=_s(0,!0);jt.UZERO=As;var ec=_s(1);jt.ONE=ec;var SR=_s(1,!0);jt.UONE=SR;var hy=_s(-1);jt.NEG_ONE=hy;var NR=Xt(-1,2147483647,!1);jt.MAX_VALUE=NR;var TR=Xt(-1,-1,!0);jt.MAX_UNSIGNED_VALUE=TR;var Ur=Xt(0,-2147483648,!1);jt.MIN_VALUE=Ur;var De=jt.prototype;De.toInt=function(){return this.unsigned?this.low>>>0:this.low};De.toNumber=function(){return this.unsigned?(this.high>>>0)*tc+(this.low>>>0):this.high*tc+(this.low>>>0)};De.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Ur)){var t=_a(e),r=this.div(t),a=r.mul(t).sub(this);return r.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=_a(vd(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};De.getHighBits=function(){return this.high};De.getHighBitsUnsigned=function(){return this.high>>>0};De.getLowBits=function(){return this.low};De.getLowBitsUnsigned=function(){return this.low>>>0};De.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Ur)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};De.isZero=function(){return this.high===0&&this.low===0};De.eqz=De.isZero;De.isNegative=function(){return!this.unsigned&&this.high<0};De.isPositive=function(){return this.unsigned||this.high>=0};De.isOdd=function(){return(this.low&1)===1};De.isEven=function(){return(this.low&1)===0};De.equals=function(e){return Hr(e)||(e=ii(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};De.eq=De.equals;De.notEquals=function(e){return!this.eq(e)};De.neq=De.notEquals;De.ne=De.notEquals;De.lessThan=function(e){return this.comp(e)<0};De.lt=De.lessThan;De.lessThanOrEqual=function(e){return this.comp(e)<=0};De.lte=De.lessThanOrEqual;De.le=De.lessThanOrEqual;De.greaterThan=function(e){return this.comp(e)>0};De.gt=De.greaterThan;De.greaterThanOrEqual=function(e){return this.comp(e)>=0};De.gte=De.greaterThanOrEqual;De.ge=De.greaterThanOrEqual;De.compare=function(e){if(Hr(e)||(e=ii(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};De.comp=De.compare;De.negate=function(){return!this.unsigned&&this.eq(Ur)?Ur:this.not().add(ec)};De.neg=De.negate;De.add=function(e){Hr(e)||(e=ii(e));var t=this.high>>>16,r=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,p=0;return p+=i+c,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=r+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,Xt(h<<16|p,l<<16|f,this.unsigned)};De.subtract=function(e){return Hr(e)||(e=ii(e)),this.add(e.neg())};De.sub=De.subtract;De.multiply=function(e){if(this.isZero())return Da;if(Hr(e)||(e=ii(e)),Aa){var t=Aa.mul(this.low,this.high,e.low,e.high);return Xt(t,Aa.get_high(),this.unsigned)}if(e.isZero())return Da;if(this.eq(Ur))return e.isOdd()?Ur:Da;if(e.eq(Ur))return this.isOdd()?Ur:Da;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(xR)&&e.lt(xR))return _a(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*l,p+=d>>>16,d&=65535,p+=i*l,h+=p>>>16,p&=65535,p+=o*c,h+=p>>>16,p&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=r*l+a*c+i*u+o*s,f&=65535,Xt(p<<16|d,f<<16|h,this.unsigned)};De.mul=De.multiply;De.divide=function(e){if(Hr(e)||(e=ii(e)),e.isZero())throw Error("division by zero");if(Aa){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Aa.div_u:Aa.div_s)(this.low,this.high,e.low,e.high);return Xt(t,Aa.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?As:Da;var r,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return As;if(e.gt(this.shru(1)))return SR;i=As}else{if(this.eq(Ur)){if(e.eq(ec)||e.eq(hy))return Ur;if(e.eq(Ur))return ec;var o=this.shr(1);return r=o.div(e).shl(1),r.eq(Da)?e.isNegative()?ec:hy:(a=this.sub(e.mul(r)),i=r.add(a.div(e)),i)}else if(e.eq(Ur))return this.unsigned?As:Da;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Da}for(a=this;a.gte(e);){r=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(r)/Math.LN2),u=s<=48?1:vd(2,s-48),c=_a(r),l=c.mul(e);l.isNegative()||l.gt(a);)r-=u,c=_a(r,this.unsigned),l=c.mul(e);c.isZero()&&(c=ec),i=i.add(c),a=a.sub(l)}return i};De.div=De.divide;De.modulo=function(e){if(Hr(e)||(e=ii(e)),Aa){var t=(this.unsigned?Aa.rem_u:Aa.rem_s)(this.low,this.high,e.low,e.high);return Xt(t,Aa.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};De.mod=De.modulo;De.rem=De.modulo;De.not=function(){return Xt(~this.low,~this.high,this.unsigned)};De.and=function(e){return Hr(e)||(e=ii(e)),Xt(this.low&e.low,this.high&e.high,this.unsigned)};De.or=function(e){return Hr(e)||(e=ii(e)),Xt(this.low|e.low,this.high|e.high,this.unsigned)};De.xor=function(e){return Hr(e)||(e=ii(e)),Xt(this.low^e.low,this.high^e.high,this.unsigned)};De.shiftLeft=function(e){return Hr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Xt(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Xt(0,this.low<<e-32,this.unsigned)};De.shl=De.shiftLeft;De.shiftRight=function(e){return Hr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Xt(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Xt(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};De.shr=De.shiftRight;De.shiftRightUnsigned=function(e){if(Hr(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var r=this.low;return Xt(r>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?Xt(t,0,this.unsigned):Xt(t>>>e-32,0,this.unsigned)};De.shru=De.shiftRightUnsigned;De.shr_u=De.shiftRightUnsigned;De.toSigned=function(){return this.unsigned?Xt(this.low,this.high,!1):this};De.toUnsigned=function(){return this.unsigned?this:Xt(this.low,this.high,!0)};De.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};De.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};De.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};jt.fromBytes=function(e,t,r){return r?jt.fromBytesLE(e,t):jt.fromBytesBE(e,t)};jt.fromBytesLE=function(e,t){return new jt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};jt.fromBytesBE=function(e,t){return new jt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}});var e4=J(Qt=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});var R=Cs();function Cle(n){if(n&&n.__esModule)return n;var e=Object.create(null);return n&&Object.keys(n).forEach(function(t){if(t!=="default"){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}}),e.default=n,e}function Ale(n,e){return e.forEach(function(t){Object.keys(t).forEach(function(r){if(r!=="default"&&!(r in n)){var a=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,a.get?a:{enumerable:!0,get:function(){return t[r]}})}})}),n}var _=Cle(R),Ty=function(n,e){return Ty=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])},Ty(n,e)};function se(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Ty(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Ce(n,e,t,r){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(r.next(l))}catch(f){o(f)}}function u(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((r=r.apply(n,e||[])).next())})}function Ee(n,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(l){c=[6,l],a=0}finally{r=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function fe(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function te(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=r.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return i}function Qe(n,e,t){if(t||arguments.length===2)for(var r=0,a=e.length,i;r<a;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}var Bo=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return Object.setPrototypeOf(r,e.prototype),r}return e}(Error),Fi=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return Object.setPrototypeOf(r,e.prototype),r}return e}(Error),Z=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return Object.setPrototypeOf(r,e.prototype),r}return e}(Error),dt=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return Object.setPrototypeOf(r,e.prototype),r}return e}(Error),_le=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return Object.setPrototypeOf(r,e.prototype),r}return e}(Error);(function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return Object.setPrototypeOf(r,e.prototype),r}return e})(Error);var CO=function(){function n(e){this.maxEntries=e||100,this.cache=new Map}return n.prototype.get=function(e){var t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t},n.prototype.put=function(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){var r=this.cache.keys().next().value;this.cache.delete(r)}this.cache.set(e,t)},n.prototype.getMaxEntries=function(){return this.maxEntries},n.prototype.setMaxEntries=function(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got ".concat(e,"."));if(this.maxEntries>e)for(var t=0;t<this.maxEntries-e;t++){var r=this.cache.keys().next().value;this.cache.delete(r)}this.maxEntries=e},n}();function Ps(n,e){if(Array.isArray(n)){for(var t=[],r=0;r<e;r++)t=t.concat(n);return t}else{var t=new Array(e);return t.fill(n),t}}function _i(n,e){if(!n)throw new _le(e)}function CR(n,e){var t,r,a=0;try{for(var i=fe(n),o=i.next();!o.done;o=i.next()){var s=o.value;s===e&&a++}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return a}function Ir(n){return n.length===1?n[0]:n}function Yt(n){return Array.isArray(n)?n:[n]}function eo(n){var e=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2"),t=e.replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function Ds(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,function(e,t){return t.toUpperCase()})}var Fa={};function Gy(n){if(n==null)return null;var e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function Ey(n){var e,t;if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(function(u){return Ey(u)});else{var r=Object.keys(n);try{for(var a=fe(r),i=a.next();!i.done;i=a.next()){var o=i.value,s=n[o];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[o]=s.value:Ey(s))}}catch(u){e={error:u}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}}}function Ef(n,e,t,r,a){var i,o,s,u,c,l,f,h,p,d,v;if(e===void 0&&(e={}),t===void 0&&(t={}),r===void 0&&(r="object"),a===void 0&&(a=!1),typeof n=="string"){var m=n,g=void 0;if(m in t)g=t[m];else if(m in Fa)g=Fa[m];else if(g=e[m],g==null)throw new Z("Unknown ".concat(r,": ").concat(n,". ")+`This may be due to one of the following reasons:
`+"1. The ".concat(r," is defined in Python, in which ")+`case it needs to be ported to TensorFlow.js or your JavaScript code.
`+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");return g}else{var y=n;if(y.className==null||y.config==null)throw new Z("".concat(r,": Improper config format: ")+"".concat(JSON.stringify(y),`.
`)+"'className' and 'config' must set.");var b=y.className,w=void 0,x=void 0;if(b in t?(i=te(t[b],2),w=i[0],x=i[1]):b in Fa?(o=te(Fa.className,2),w=o[0],x=o[1]):b in e&&(s=te(e[b],2),w=s[0],x=s[1]),w==null)throw new Z("Unknown ".concat(r,": ").concat(b,". ")+`This may be due to one of the following reasons:
`+"1. The ".concat(r," is defined in Python, in which ")+`case it needs to be ported to TensorFlow.js or your JavaScript code.
`+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");if(x!=null){var N={};try{for(var T=fe(Object.keys(Fa)),E=T.next();!E.done;E=T.next()){var C=E.value;N[C]=Fa[C]}}catch(Y){u={error:Y}}finally{try{E&&!E.done&&(c=T.return)&&c.call(T)}finally{if(u)throw u.error}}try{for(var F=fe(Object.keys(t)),D=F.next();!D.done;D=F.next()){var C=D.value;N[C]=t[C]}}catch(Y){l={error:Y}}finally{try{D&&!D.done&&(f=F.return)&&f.call(F)}finally{if(l)throw l.error}}var O=y.config;O.customObjects=N;var L=Object.assign({},Fa);try{for(var z=fe(Object.keys(t)),$=z.next();!$.done;$=z.next()){var C=$.value;Fa[C]=t[C]}}catch(Y){h={error:Y}}finally{try{$&&!$.done&&(p=z.return)&&p.call(z)}finally{if(h)throw h.error}}Ey(y.config);var B=x(w,y.config,t,a);return Fa=Object.assign({},L),B}else{var L=Object.assign({},Fa);try{for(var W=fe(Object.keys(t)),X=W.next();!X.done;X=W.next()){var C=X.value;Fa[C]=t[C]}}catch(j){d={error:j}}finally{try{X&&!X.done&&(v=W.return)&&v.call(W)}finally{if(d)throw d.error}}var B=new w(y.config);return Fa=Object.assign({},L),B}}}function Dle(n,e){return n<e?-1:n>e?1:0}function md(n,e){return-1*Dle(n,e)}function Lo(n){var e,t;if(n==null)return n;var r=[];try{for(var a=fe(n),i=a.next();!i.done;i=a.next()){var o=i.value;r.indexOf(o)===-1&&r.push(o)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return r}function Fle(n){if(n==null)throw new Z("Invalid value in obj: ".concat(JSON.stringify(n)));for(var e in n)if(n.hasOwnProperty(e))return!1;return!0}function Bs(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new Z("".concat(t," is not a valid ").concat(e,".  Valid values are ").concat(n," or null/undefined."))}function Uy(n,e,t,r){return t===void 0&&(t=0),r===void 0&&(r=1/0),_i(t>=0),_i(r>=t),Array.isArray(n)&&n.length>=t&&n.length<=r&&n.every(function(a){return typeof a===e})}function Kn(n,e){Array.isArray(n)?(R.util.assert(n.length>0,function(){return"".concat(e," is unexpectedly an empty array.")}),n.forEach(function(t,r){return Kn(t,"element ".concat(r+1," of ").concat(e))})):R.util.assert(Number.isInteger(n)&&n>0,function(){return"Expected ".concat(e," to be a positive integer, but got ")+"".concat(AO(n),".")})}function AO(n){return n===null?"null":Array.isArray(n)?"["+n.map(function(e){return AO(e)}).join(",")+"]":typeof n=="string"?'"'.concat(n,'"'):"".concat(n)}function Rle(n,e,t){var r=t!=null?t():R.util.now(),a,i=function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var u=t!=null?t():R.util.now();return u-r<e||(r=u,a=n.apply(void 0,Qe([],te(o),!1))),a};return i}function _O(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}var Ole=0;function DO(){return Ole++}var gd={};function Vd(n){return n===void 0&&(n=""),n in gd||(gd[n]=0),gd[n]+=1,n+gd[n].toString()}var Ple=["channelsFirst","channelsLast"],Mle=["nearest","bilinear"],Ble=["valid","same","causal"],Lle=["max","avg"],zle=["sum","mul","concat","ave"];var nc=new Map;function Dn(n){Bs(Ple,"DataFormat",n)}function $le(n){Bs(Mle,"InterpolationFormat",n)}function da(n){Bs(Ble,"PaddingMode",n)}function FO(n){Bs(Lle,"PoolMode",n)}var wf=[],AR="/";function Rs(n,e){wf.push(n);try{var t=e();return wf.pop(),t}catch(r){throw wf.pop(),r}}function qle(){return wf.length===0?"":wf.join(AR)+AR}function RO(n){if(!PO(n))throw new Error("Not a valid tensor name: '"+n+"'");return qle()+n}function OO(n){if(!PO(n))throw new Error("Not a valid tensor name: '"+n+"'");nc.has(n)||nc.set(n,0);var e=nc.get(n);if(nc.set(n,nc.get(n)+1),e>0){var t="".concat(n,"_").concat(e);return nc.set(t,1),t}else return n}var Wle=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function PO(n){return!!n.match(Wle)}function Vle(n){return n===parseInt(n.toString(),10)}function zo(n,e,t){e==null&&(e=0),t==null&&(t=n.length);for(var r=1,a=e;a<t;++a)r*=n[a];return r}function cc(n){if(n.length===0)return Number.NaN;for(var e=Number.POSITIVE_INFINITY,t=0;t<n.length;t++){var r=n[t];r<e&&(e=r)}return e}function $o(n){if(n.length===0)return Number.NaN;for(var e=Number.NEGATIVE_INFINITY,t=0;t<n.length;t++){var r=n[t];r>e&&(e=r)}return e}function fi(n,e){if(e<n)throw new Z("end (".concat(e,") < begin (").concat(n,") is forbidden."));for(var t=[],r=n;r<e;++r)t.push(r);return t}var dy;function qn(){return dy==null&&(dy=R.backend().epsilon()),dy}function hi(){return"channelsLast"}function Ri(n,e){return _.cast(n,e)}function If(n,e){e===void 0&&(e=-1);var t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),_.reshape(n,t)}function Gle(n,e){return R.tidy(function(){if(n.shape.length!==2)throw new Z("repeat() expects a rank-2 tensor, but received a "+"rank-".concat(n.shape.length," tensor."));var t=If(n,1);return Iy(t,[1,e,1])})}function Ule(n){var e=[zo(n.shape)];return _.reshape(n,e)}function Hle(n){if(n.rank<=1)throw new Z("batchFlatten requires a minimum rank of 2. Got rank: ".concat(n.rank,"."));var e=[n.shape[0],zo(n.shape,1)];return _.reshape(n,e)}function Os(n,e,t){return R.tidy(function(){switch(n.rank){case 1:return _.slice1d(n,e,t);case 2:return _.slice2d(n,[e,0],[t,n.shape[1]]);case 3:return _.slice3d(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return _.slice4d(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return _.slice(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return _.slice(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new Z("sliceAlongFirstAxis() received an unsupported tensor rank: "+"".concat(n.rank))}})}function vy(n,e,t){return R.tidy(function(){switch(n.rank){case 1:return _.slice1d(n,e,t);case 2:return _.slice2d(n,[0,e],[n.shape[0],t]);case 3:return _.slice3d(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return _.slice4d(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new Z("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(n.rank))}})}function yd(n,e,t,r){return R.tidy(function(){switch(n.rank){case 1:return _.slice1d(n,e,t);case 2:switch(r){case 1:return Os(n,e,t);case 2:return vy(n,e,t);default:throw new Z("The axis is not within the rank of the tensor "+"".concat(r))}case 3:switch(r){case 1:return Os(n,e,t);case 2:return _.slice3d(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return vy(n,e,t);default:throw new Z("The axis is not within the rank of the tensor "+"".concat(r))}case 4:switch(r){case 1:return Os(n,e,t);case 2:return _.slice4d(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return _.slice4d(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return vy(n,e,t);default:throw new Z("The axis is not within the rank of the tensor "+"".concat(r))}default:throw new Z("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(n.rank))}})}function Hy(n,e){e===void 0&&(e=-1);var t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),_.concat(n,e)}function _R(n,e){switch(n.rank){case 1:return _.concat1d([n,e]);case 2:return _.concat2d([n,e],0);case 3:return _.concat3d([n,e],0);case 4:return _.concat4d([n,e],0);default:throw new Z("concatAlongFirstAxis() received an unsupported "+"tensor rank: ".concat(n.rank))}}function Iy(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new Z("The length of input n (".concat(e.length,") does not match ")+"the number of dimensions in input x (".concat(n.rank,")"));return _.tile(n,e)}function Gd(n,e,t,r,a){return e===void 0&&(e=0),t===void 0&&(t=1),_.randomNormal(n,e,t,r,a)}function Oi(n,e,t,r){if(n.rank<2||e.rank<2)throw new dt("dot requires both inputs to be rank >= 2"+" but got x shape = ".concat(n.shape," and y shape = ").concat(e.shape));if(e.rank>=3){var a=n.shape.slice(-1)[0],i=e.shape.slice(-2)[0];if(a!==i)throw new dt("If rank y >= 3, then the second last dim"+" of y must equal the last dim of x but got x shape = ".concat(n.shape," and ")+" y shape = ".concat(e.shape))}if(n.rank===2&&e.rank===2){var o=!1,s=!1;return _.fused.matMul({a:n,b:e,transposeA:o,transposeB:s,bias:r?Cy(n.rank,r,hi()):null,activation:t})}else{var u=n.shape.slice(),c=u.pop();n=_.reshape(n,[-1,c]);var l=e.shape.slice(),f=l.pop(),i=l.pop(),h=Qe(Qe([],te(l),!1),[f],!1),p=Array.from({length:e.rank},function(y,b){return b===0?e.rank-2:b<=e.rank-2?b-1:b});e=_.reshape(_.transpose(e,p),[i,-1]);var d=Qe(Qe([],te(u),!1),te(h),!1),o=!1,s=!1;return _.reshape(_.fused.matMul({a:n,b:e,transposeA:o,transposeB:s,bias:r?Cy(n.rank,r,hi()):null,activation:t}),d)}}function MO(n,e,t){return R.tidy(function(){return Array.isArray(e)?e=R.tensor1d(e,"int32"):e=_.cast(e,"int32"),_.gather(n,e,t)})}function Cf(n){return _.mul(n,n)}function Cy(n,e,t){var r=e.shape;if(e.rank!==1&&e.rank!==n)throw new Z("Unexpected bias dimensions: ".concat(e.rank)+"; expected it to be 1 or ".concat(n));if(n===5){if(t==="channelsFirst")return r.length===1?_.reshape(e,[1,r[0],1,1,1]):_.reshape(e,[1,r[3],r[0],r[1],r[2]]);if(t==="channelsLast")return r.length===1?_.reshape(e,[1,1,1,1,r[0]]):_.reshape(e,[1].concat(r))}else if(n===4){if(t==="channelsFirst")return r.length===1?_.reshape(e,[1,r[0],1,1]):_.reshape(e,[1,r[2],r[0],r[1]]);if(t==="channelsLast")return r.length===1?_.reshape(e,[1,1,1,r[0]]):_.reshape(e,[1].concat(r))}else if(n===3){if(t==="channelsFirst")return r.length===1?_.reshape(e,[1,r[0],1]):_.reshape(e,[1,r[1],r[0]]);if(t==="channelsLast")return r.length===1?_.reshape(e,[1,1,r[0]]):_.reshape(e,[1].concat(r))}else if(n<3)return e;throw new Z("Unsupported input rank by biasAdd: ".concat(e.rank))}function vi(n,e,t){return R.tidy(function(){return t==null&&(t=hi()),Dn(t),_.add(n,Cy(n.rank,e,t))})}function Kle(n,e){if(e===void 0&&(e=1),e!==1)throw new dt("Support for alpha values other than 1 (".concat(e,") is not implemented ")+"yet.");return _.elu(n)}function jle(n){return R.tidy(function(){return _.div(n,_.add(_.abs(n),1))})}function BO(n,e,t,r){return R.tidy(function(){return _.dropout(n,e,t,r)})}function Xle(n){return R.tidy(function(){var e=_.add(.5,_.mul(.2,n));return _.clipByValue(e,0,1)})}function Af(n,e,t){return t===void 0&&(t=!1),t?n():e()}var Yle=["fanIn","fanOut","fanAvg"],Zle=["normal","uniform","truncatedNormal"];function Jle(n){Bs(Yle,"FanMode",n)}function Qle(n){Bs(Zle,"Distribution",n)}var Ba=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.fromConfigUsesCustomObjects=function(){return!1},e.prototype.getConfig=function(){return{}},e}(R.serialization.Serializable),Ky=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t,r){return R.zeros(t,r)},e}(Ba);Ky.className="Zeros";R.serialization.registerClass(Ky);var Ud=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t,r){return R.ones(t,r)},e}(Ba);Ud.className="Ones";R.serialization.registerClass(Ud);var jy=function(n){se(e,n);function e(t){var r=n.call(this)||this;if(typeof t!="object")throw new Z("Expected argument of type ConstantConfig but got ".concat(t));if(t.value===void 0)throw new Z("config must have value set but got ".concat(t));return r.value=t.value,r}return e.prototype.apply=function(t,r){var a=this;return R.tidy(function(){return R.mul(R.scalar(a.value),R.ones(t,r))})},e.prototype.getConfig=function(){return{value:this.value}},e}(Ba);jy.className="Constant";R.serialization.registerClass(jy);var Xy=function(n){se(e,n);function e(t){var r=n.call(this)||this;return r.DEFAULT_MINVAL=-.05,r.DEFAULT_MAXVAL=.05,r.minval=t.minval||r.DEFAULT_MINVAL,r.maxval=t.maxval||r.DEFAULT_MAXVAL,r.seed=t.seed,r}return e.prototype.apply=function(t,r){return R.randomUniform(t,this.minval,this.maxval,r,this.seed)},e.prototype.getConfig=function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}},e}(Ba);Xy.className="RandomUniform";R.serialization.registerClass(Xy);var Yy=function(n){se(e,n);function e(t){var r=n.call(this)||this;return r.DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=t.mean||r.DEFAULT_MEAN,r.stddev=t.stddev||r.DEFAULT_STDDEV,r.seed=t.seed,r}return e.prototype.apply=function(t,r){if(r=r||"float32",r!=="float32"&&r!=="int32")throw new dt("randomNormal does not support dType ".concat(r,"."));return Gd(t,this.mean,this.stddev,r,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e}(Ba);Yy.className="RandomNormal";R.serialization.registerClass(Yy);var Zy=function(n){se(e,n);function e(t){var r=n.call(this)||this;return r.DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=t.mean||r.DEFAULT_MEAN,r.stddev=t.stddev||r.DEFAULT_STDDEV,r.seed=t.seed,r}return e.prototype.apply=function(t,r){if(r=r||"float32",r!=="float32"&&r!=="int32")throw new dt("truncatedNormal does not support dType ".concat(r,"."));return R.truncatedNormal(t,this.mean,this.stddev,r,this.seed)},e.prototype.getConfig=function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}},e}(Ba);Zy.className="TruncatedNormal";R.serialization.registerClass(Zy);var Jy=function(n){se(e,n);function e(t){var r=n.call(this)||this;return r.gain=t.gain!=null?t.gain:1,r}return e.prototype.apply=function(t,r){var a=this;return R.tidy(function(){if(t.length!==2||t[0]!==t[1])throw new Z("Identity matrix initializer can only be used for 2D square matrices.");return R.mul(a.gain,R.eye(t[0]))})},e.prototype.getConfig=function(){return{gain:this.gain}},e}(Ba);Jy.className="Identity";R.serialization.registerClass(Jy);function efe(n,e){e===void 0&&(e="channelsLast");var t,r;if(Dn(e),n.length===2)t=n[0],r=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){var a=zo(n,2);t=n[1]*a,r=n[0]*a}else if(e==="channelsLast"){var a=zo(n,0,n.length-2);t=n[n.length-2]*a,r=n[n.length-1]*a}}else{var i=zo(n);t=Math.sqrt(i),r=Math.sqrt(i)}return[t,r]}var Cr=function(n){se(e,n);function e(t){var r=n.call(this)||this;if(t.scale<0)throw new Z("scale must be a positive float. Got: ".concat(t.scale));return r.scale=t.scale==null?1:t.scale,r.mode=t.mode==null?"fanIn":t.mode,Jle(r.mode),r.distribution=t.distribution==null?"normal":t.distribution,Qle(r.distribution),r.seed=t.seed,r}return e.prototype.apply=function(t,r){var a=efe(t),i=a[0],o=a[1],s=this.scale;if(this.mode==="fanIn"?s/=Math.max(1,i):this.mode==="fanOut"?s/=Math.max(1,o):s/=Math.max(1,(i+o)/2),this.distribution==="normal"){var u=Math.sqrt(s);if(r=r||"float32",r!=="float32"&&r!=="int32")throw new dt("".concat(this.getClassName()," does not support dType ").concat(r,"."));return R.truncatedNormal(t,0,u,r,this.seed)}else{var c=Math.sqrt(3*s);return R.randomUniform(t,-c,c,r,this.seed)}},e.prototype.getConfig=function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}},e}(Ba);Cr.className="VarianceScaling";R.serialization.registerClass(Cr);var Hd=function(n){se(e,n);function e(t){return n.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Cr.className},e}(Cr);Hd.className="GlorotUniform";R.serialization.registerClass(Hd);var Kd=function(n){se(e,n);function e(t){return n.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Cr.className},e}(Cr);Kd.className="GlorotNormal";R.serialization.registerClass(Kd);var jd=function(n){se(e,n);function e(t){return n.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Cr.className},e}(Cr);jd.className="HeNormal";R.serialization.registerClass(jd);var Xd=function(n){se(e,n);function e(t){return n.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Cr.className},e}(Cr);Xd.className="HeUniform";R.serialization.registerClass(Xd);var Yd=function(n){se(e,n);function e(t){return n.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Cr.className},e}(Cr);Yd.className="LeCunNormal";R.serialization.registerClass(Yd);var Zd=function(n){se(e,n);function e(t){return n.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:t==null?null:t.seed})||this}return e.prototype.getClassName=function(){return Cr.className},e}(Cr);Zd.className="LeCunUniform";R.serialization.registerClass(Zd);var Qy=function(n){se(e,n);function e(t){var r=n.call(this)||this;if(r.DEFAULT_GAIN=1,r.gain=t.gain==null?r.DEFAULT_GAIN:t.gain,r.seed=t.seed,r.seed!=null)throw new dt("Random seed is not implemented for Orthogonal Initializer yet.");return r}return e.prototype.apply=function(t,r){var a=this;return R.tidy(function(){if(t.length<2)throw new dt("Shape must be at least 2D.");t[0]*t[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more "+"than 2000 (".concat(t[0]*t[1],") elements: ")+"Slowness may result.");var i=t[0]>t[1]?[t[1],t[0]]:t,o=Gd(i,0,1,"float32"),s=R.linalg.gramSchmidt(o);return t[0]>t[1]&&(s=R.transpose(s)),R.mul(a.gain,s)})},e.prototype.getConfig=function(){return{gain:this.gain,seed:this.seed}},e}(Ba);Qy.className="Orthogonal";R.serialization.registerClass(Qy);var DR={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function FR(n,e){return e===void 0&&(e={}),Ef(n,R.serialization.SerializationMap.getMap().classNameMap,e,"initializer")}function mn(n){return Gy(n)}function cn(n){if(typeof n=="string"){var e=n in DR?DR[n]:n;if(e==="GlorotNormal")return new Kd;if(e==="GlorotUniform")return new Hd;if(e==="HeNormal")return new jd;if(e==="HeUniform")return new Xd;if(e==="LeCunNormal")return new Yd;if(e==="LeCunUniform")return new Zd;var t={};return t.className=e,t.config={},FR(t)}else return n instanceof Ba?n:FR(n)}function Ay(n){return Array.isArray(n)&&Array.isArray(n[0])}function Td(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function it(n){var e;if(Array.isArray(n)){if(n.length!==1)throw new Z("Expected Tensor length to be 1; got ".concat(n.length));e=n[0]}else e=n;return e}function Et(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new Z("Expected exactly 1 Shape; got ".concat(n.length))}else return n}function Ed(n){var e,t,r=0;try{for(var a=fe(n),i=a.next();!i.done;i=a.next()){var o=i.value;o.shape.length===0?r+=1:r+=o.shape.reduce(function(s,u){return s*u})}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return r}var RR="Variable",LO=function(){function n(e,t,r,a,i){t===void 0&&(t="float32"),r===void 0&&(r=RR),a===void 0&&(a=!0),i===void 0&&(i=null),this.dtype=t??"float32",this.shape=e.shape,this.id=DO(),r=r??RR,this.originalName=RO(r),this.name=OO(this.originalName),this.trainable_=a,this.constraint=i,this.val=_.variable(e,this.trainable_,this.name,this.dtype)}return n.prototype.read=function(){return this.assertNotDisposed(),this.val},n.prototype.write=function(e){return this.assertNotDisposed(),tfe(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this},n.prototype.dispose=function(){this.assertNotDisposed(),this.val.dispose()},n.prototype.assertNotDisposed=function(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))},Object.defineProperty(n.prototype,"trainable",{get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e},enumerable:!1,configurable:!0}),n}();function tfe(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function _y(n){return n.map(function(e){return e.read()})}function eb(n){n.forEach(function(e){var t=e[0];t.write(e[1])})}var Ln=function(){function n(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}return n}(),ui=function(){function n(e,t,r,a,i,o,s){this.dtype=e,this.shape=t,this.sourceLayer=r,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=DO(),o!=null&&(this.originalName=RO(o),this.name=OO(this.originalName)),this.rank=t.length}return n}(),nfe=0,Jd=function(){function n(e,t){var r,a;this.callArgs=t,this.id=nfe++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;try{for(var i=fe(e.inboundLayers),o=i.next();!o.done;o=i.next()){var s=o.value;s?.outboundNodes.push(this)}}catch(u){r={error:u}}finally{try{o&&!o.done&&(a=i.return)&&a.call(i)}finally{if(r)throw r.error}}e.outboundLayer.inboundNodes.push(this)}return n.prototype.getConfig=function(){var e,t,r=[];try{for(var a=fe(this.inboundLayers),i=a.next();!i.done;i=a.next()){var o=i.value;o!=null?r.push(o.name):r.push(null)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:r,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}},n}(),rfe=0,gt=function(n){se(e,n);function e(t){t===void 0&&(t={});var r=n.call(this)||this;r._callHook=null,r._addedWeightNames=[],r._stateful=!1,r.id=rfe++,r.activityRegularizer=null,r.inputSpec=null,r.supportsMasking=!1,r._trainableWeights=[],r._nonTrainableWeights=[],r._losses=[],r._updates=[],r._built=!1,r.inboundNodes=[],r.outboundNodes=[];var a=t.name;if(!a){var i=r.getClassName();a=eo(i)+"_"+Vd(i)}if(r.name=a,r.trainable_=t.trainable==null?!0:t.trainable,t.inputShape!=null||t.batchInputShape!=null){var o=void 0;if(t.batchInputShape!=null)o=t.batchInputShape;else if(t.inputShape!=null){var s=null;t.batchSize!=null&&(s=t.batchSize),o=[s].concat(t.inputShape)}r.batchInputShape=o;var u=t.dtype;u==null&&(u=t.inputDType),u==null&&(u="float32"),r.dtype=u}return t.weights!=null?r.initialWeights=t.weights:r.initialWeights=null,r._refCount=null,r.fastWeightInitDuringBuild=!1,r}return e.nodeKey=function(t,r){return t.name+"_ib-"+r.toString()},e.prototype.getNodeAtIndex=function(t,r){if(this.inboundNodes.length===0)throw new Fi("The layer has never been called "+"and thus has no defined ".concat(r,"."));if(this.inboundNodes.length<=t)throw new Z("Asked to get ".concat(r," at node ").concat(t,", ")+"but the layer has only ".concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[t]},e.prototype.getInputAt=function(t){return Ir(this.getNodeAtIndex(t,"input").inputTensors)},e.prototype.getOutputAt=function(t){return Ir(this.getNodeAtIndex(t,"output").outputTensors)},Object.defineProperty(e.prototype,"input",{get:function(){if(this.inboundNodes.length>1)throw new Bo("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(this.inboundNodes.length===0)throw new Bo("Layer ".concat(this.name)+" is not connected, no input to return.");return Ir(this.getNodeAtIndex(0,"input").inputTensors)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"output",{get:function(){if(this.inboundNodes.length===0)throw new Bo("Layer ".concat(this.name)+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new Bo("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return Ir(this.getNodeAtIndex(0,"output").outputTensors)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this._losses},enumerable:!1,configurable:!0}),e.prototype.calculateLosses=function(){return this.losses.map(function(t){return t()})},Object.defineProperty(e.prototype,"updates",{get:function(){return this._updates},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"built",{get:function(){return this._built},set:function(t){this._built=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this._trainableWeights.forEach(function(r){return r.trainable=t}),this.trainable_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable_?this._trainableWeights.filter(function(t){return t.trainable}):[]},set:function(t){this._trainableWeights=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this._trainableWeights.filter(function(t){return!t.trainable}).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(t){this._nonTrainableWeights=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stateful",{get:function(){return this._stateful},enumerable:!1,configurable:!0}),e.prototype.resetStates=function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")},e.prototype.assertInputCompatibility=function(t){if(t=Yt(t),!(this.inputSpec==null||this.inputSpec.length===0)){var r=Yt(this.inputSpec);if(t.length!==r.length)throw new Z("Layer ".concat(this.name," expects ").concat(r.length," inputs, ")+"but it received ".concat(t.length," input tensors. ")+"Input received: ".concat(t));for(var a=0;a<t.length;a++){var i=t[a],o=r[a];if(o!=null){var s=i.rank;if(o.ndim!=null&&s!==o.ndim)throw new Z("Input ".concat(a," is incompatible with layer ").concat(this.name,": ")+"expected ndim=".concat(o.ndim,", found ndim=").concat(s));if(o.maxNDim!=null&&s>o.maxNDim)throw new Z("Input ".concat(a," is incompatible with layer ").concat(this.name)+": expected max_ndim=".concat(o.maxNDim,", found ndim=").concat(s));if(o.minNDim!=null&&s<o.minNDim)throw new Z("Input ".concat(a," is incompatible with layer ").concat(this.name)+": expected min_ndim=".concat(o.minNDim,", found ndim=").concat(s,"."));if(o.dtype!=null&&i.dtype!==o.dtype)throw new Z("Input ".concat(a," is incompatible with layer ").concat(this.name," ")+": expected dtype=".concat(o.dtype,", found dtype=").concat(i.dtype,"."));if(o.axes){var u=i.shape;for(var c in o.axes){var l=Number(c),f=o.axes[c],h=l>=0?u[l]:u[u.length+l];if(f!=null&&[f,null].indexOf(h)===-1)throw new Z("Input ".concat(a," is incompatible with layer ")+"".concat(this.name,": expected axis ").concat(l," of input shape to ")+"have value ".concat(f," but got shape ").concat(u,"."))}}if(o.shape!=null)for(var p=0;p<o.shape.length;++p){var d=o.shape[p],v=i.shape[p];if(d!=null&&v!=null&&d!==v)throw new Z("Input ".concat(a," is incompatible with layer ")+"".concat(this.name,": expected shape=").concat(o.shape,", ")+"found shape=".concat(i.shape,"."))}}}}},e.prototype.call=function(t,r){return t},e.prototype.invokeCallHook=function(t,r){this._callHook!=null&&this._callHook(t,r)},e.prototype.setCallHook=function(t){this._callHook=t},e.prototype.clearCallHook=function(){this._callHook=null},e.prototype.apply=function(t,r){var a,i,o,s,u=this;r=r||{},this.assertNotDisposed();var c=Yt(t),l=!0;try{for(var f=fe(c),h=f.next();!h.done;h=f.next()){var p=h.value;if(!(p instanceof ui)){l=!1;break}}}catch(g){a={error:g}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}var d=!0;try{for(var v=fe(c),m=v.next();!m.done;m=v.next()){var p=m.value;if(p instanceof ui){d=!1;break}}}catch(g){o={error:g}}finally{try{m&&!m.done&&(s=v.return)&&s.call(v)}finally{if(o)throw o.error}}if(l===d)throw new Z("Arguments to apply() must be all SymbolicTensors or all Tensors");return Rs(this.name,function(){var g,y,b,w;if(!u.built){u.assertInputCompatibility(t);var x=[];try{for(var N=fe(Yt(t)),T=N.next();!T.done;T=N.next()){var E=T.value;x.push(E.shape)}}catch(X){g={error:X}}finally{try{T&&!T.done&&(y=N.return)&&y.call(N)}finally{if(g)throw g.error}}u.build(Ir(x)),u.built=!0,u.initialWeights&&u.setWeights(u.initialWeights),u._refCount===null&&d&&(u._refCount=1)}if(u.assertInputCompatibility(t),d){var C=u.call(t,r),F=Yt(C),D=[];try{for(var O=fe(F),L=O.next();!L.done;L=O.next()){var z=L.value;c.indexOf(z)!==-1&&(z=z.clone()),D.push(z)}}catch(X){b={error:X}}finally{try{L&&!L.done&&(w=O.return)&&w.call(O)}finally{if(b)throw b.error}}if(C=Ir(D),u.activityRegularizer!=null)throw new dt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return C}else{var $=afe(t),B=u.computeOutputShape($),C=void 0,W=ife(t);if(u.warnOnIncompatibleInputShape(Array.isArray(t)?$[0]:$),B!=null&&B.length>0&&Array.isArray(B[0])?C=B.map(function(Y,V){return new ui(W,Y,u,Yt(t),r,u.name,V)}):C=new ui(W,B,u,Yt(t),r,u.name),u.addInboundNode(t,C,null,null,$,B,r),u._refCount++,u.activityRegularizer!=null)throw new dt("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return C}})},e.prototype.warnOnIncompatibleInputShape=function(t){if(this.batchInputShape!=null)if(t.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+"".concat(JSON.stringify(t),") does not match that of the ")+"batchInputShape (".concat(JSON.stringify(this.batchInputShape),") ")+"of the layer ".concat(this.name));else{var r=!1;this.batchInputShape.forEach(function(a,i){a!=null&&t[i]!=null&&t[i]!==a&&(r=!0)}),r&&console.warn("The shape of the input tensor "+"(".concat(JSON.stringify(t),") does not ")+"match the expectation of layer ".concat(this.name,": ")+"".concat(JSON.stringify(this.batchInputShape)))}},Object.defineProperty(e.prototype,"outputShape",{get:function(){var t,r;if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Bo("The layer ".concat(this.name," has never been called and thus has no ")+"defined output shape.");var a=[];try{for(var i=fe(this.inboundNodes),o=i.next();!o.done;o=i.next()){var s=o.value,u=JSON.stringify(s.outputShapes);a.indexOf(u)===-1&&a.push(u)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}if(a.length===1){var c=this.inboundNodes[0].outputShapes;return Array.isArray(c)&&Array.isArray(c[0])&&c.length===1?c[0]:c}else throw new Bo("The layer ".concat(this.name," has multiple inbound nodes with different ")+'output shapes. Hence the notion of "output shape" is ill-defined for the layer.')},enumerable:!1,configurable:!0}),e.prototype.countParams=function(){if(!this.built)throw new Fi("You tried to call countParams() on ".concat(this.name,", ")+"but the layer is not built yet. Build it first by calling build(batchInputShape).");return Ed(this.weights)},e.prototype.build=function(t){this.built=!0},e.prototype.getWeights=function(t){return t===void 0&&(t=!1),_y(t?this.trainableWeights:this.weights)},e.prototype.setWeights=function(t){var r=this;R.tidy(function(){var a=r.weights;if(a.length!==t.length)throw new Z('You called setWeights(weights) on layer "'.concat(r.name,'" ')+"with a weight list of length ".concat(t.length,", ")+"but the layer was expecting ".concat(a.length," weights. ")+"Provided weights: ".concat(t,"..."));if(a.length!==0){for(var i=[],o=_y(a),s=0;s<o.length;++s){var u=o[s],c=a[s],l=t[s];if(!R.util.arraysEqual(u.shape,l.shape))throw new Z("Layer weight shape ".concat(u.shape," ")+"not compatible with provided weight shape ".concat(l.shape));i.push([c,l])}eb(i)}})},e.prototype.addWeight=function(t,r,a,i,o,s,u,c){if(this._addedWeightNames.indexOf(t)!==-1)throw new Z("Duplicate weight name ".concat(t," for layer ").concat(this.name));this._addedWeightNames.push(t),a==null&&(a="float32"),this.fastWeightInitDuringBuild&&(i=c!=null?c():cn("zeros"));var l=i.apply(r,a),f=new LO(l,a,t,s,u);return l.dispose(),o!=null&&this.addLoss(function(){return o.apply(f.read())}),s==null&&(s=!0),s?this._trainableWeights.push(f):this._nonTrainableWeights.push(f),f},e.prototype.setFastWeightInitDuringBuild=function(t){this.fastWeightInitDuringBuild=t},e.prototype.addLoss=function(t){var r;t==null||Array.isArray(t)&&t.length===0||(t=Yt(t),this._losses!==void 0&&this._losses!==null&&(r=this.losses).push.apply(r,Qe([],te(t),!1)))},e.prototype.computeOutputShape=function(t){return t},e.prototype.computeMask=function(t,r){var a=this;if(!this.supportsMasking){if(r!=null)if(Array.isArray(r))r.forEach(function(i){if(i!=null)throw new TypeError("Layer ".concat(a.name," does not support masking, ")+"but was passed an inputMask.")});else throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.");return null}return r},e.prototype.addInboundNode=function(t,r,a,i,o,s,u){var c,l;u===void 0&&(u=null);var f=Yt(t);r=Yt(r),a=Yt(a),i=Yt(i),o=Td(o),s=Td(s);var h=[],p=[],d=[];try{for(var v=fe(f),m=v.next();!m.done;m=v.next()){var g=m.value;h.push(g.sourceLayer),p.push(g.nodeIndex),d.push(g.tensorIndex)}}catch(b){c={error:b}}finally{try{m&&!m.done&&(l=v.return)&&l.call(v)}finally{if(c)throw c.error}}new Jd({outboundLayer:this,inboundLayers:h,nodeIndices:p,tensorIndices:d,inputTensors:f,outputTensors:r,inputMasks:a,outputMasks:i,inputShapes:o,outputShapes:s},u);for(var y=0;y<r.length;y++)r[y].sourceLayer=this,r[y].nodeIndex=this.inboundNodes.length-1,r[y].tensorIndex=y},e.prototype.getConfig=function(){var t={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(t.batchInputShape=this.batchInputShape),this.dtype!=null&&(t.dtype=this.dtype),t},e.prototype.disposeWeights=function(){return this.weights.forEach(function(t){return t.dispose()}),this.weights.length},e.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Layer '".concat(this.name,"' is already disposed."))},e.prototype.dispose=function(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been ")+"built yet.");if(this._refCount===null)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used ")+"yet.");this.assertNotDisposed();var t=0;return--this._refCount===0&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}},e}(R.serialization.Serializable);function afe(n){var e,t;n=Yt(n);var r=[];try{for(var a=fe(n),i=a.next();!i.done;i=a.next()){var o=i.value;r.push(o.shape)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return Ir(r)}function ife(n){return"float32"}function zO(n,e,t){var r,a;if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];var i=e.inboundNodes[t];if(i.inboundLayers.length===0)return i.inputTensors;for(var o=[],s=0;s<i.inboundLayers.length;s++){var u=i.inputTensors[s],c=i.inboundLayers[s],l=i.nodeIndices[s],f=zO(u,c,l);try{for(var h=(r=void 0,fe(f)),p=h.next();!p.done;p=h.next()){var d=p.value;o.indexOf(d)===-1&&o.push(d)}}catch(v){r={error:v}}finally{try{p&&!p.done&&(a=h.return)&&a.call(h)}finally{if(r)throw r.error}}}return o}var pc=function(n){se(e,n);function e(t){var r=n.call(this,{dtype:t.dtype,name:t.name!=null?t.name:Vd("input").toString()})||this;if(t.batchSize==null&&(t.batchSize=null),t.sparse==null&&(t.sparse=!1),r.trainable=!1,r.built=!0,r.sparse=t.sparse,t.inputShape!=null&&t.batchInputShape!=null)throw new Z("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=t.batchInputShape;if(a==null){if(t.inputShape==null)throw new Z("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[t.batchSize].concat(t.inputShape)}else if(t.batchSize!=null)throw new Z("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=t.dtype||"float32";r.batchInputShape=a,r.dtype=i,r.inputSpec=[{shape:a}];var o=new ui(r.dtype,r.batchInputShape,r,[],{},r.name);return o.nodeIndex=0,o.tensorIndex=0,new Jd({outboundLayer:r,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),r}return e.prototype.apply=function(t,r){throw new Z("Cannot pass any input to an "+"InputLayer's apply() method. InputLayer name: ".concat(this.name))},e.prototype.dispose=function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}},e.prototype.getConfig=function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}},e}(gt);pc.className="InputLayer";R.serialization.registerClass(pc);function $O(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new Z("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));var t=n.dtype;t==null&&(t="float32");var r=new pc({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}),a=r.inboundNodes[0].outputTensors;return a[0]}function ofe(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return R.cast(e,n.dtype)}catch{throw new Z("The dtype of the feed (".concat(e.dtype,") can not be cast to the dtype ")+"of the key '".concat(n.name,"' (").concat(n.dtype,")."))}}var ic=function(){function n(e){var t,r;if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof n)for(var a in e.id2Value)this.id2Value[a]=e.id2Value[a],a in e.id2Mask&&(this.id2Mask[a]=e.id2Mask[a]);else{if(e==null)return;try{for(var i=fe(e),o=i.next();!o.done;o=i.next()){var s=o.value;this.add(s.key,s.value)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}}}return n.prototype.add=function(e,t,r){if(this.id2Value[e.id]==null)this.id2Value[e.id]=ofe(e,t),this.name2Id[e.name]=e.id,r!=null&&(this.id2Mask[e.id]=r);else throw new Z("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this},n.prototype.addFeed=function(e){this.add(e.key,e.value)},n.prototype.hasKey=function(e){return this.id2Value[e.id]!=null},n.prototype.names=function(){return Object.keys(this.name2Id)},n.prototype.getValue=function(e){if(e instanceof ui){if(this.id2Value[e.id]==null)throw new Z("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}else{var t=this.name2Id[e];if(t==null)throw new Z("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}},n.prototype.getMask=function(e){if(e instanceof ui){if(this.id2Value[e.id]==null)throw new Z("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}else{var t=this.name2Id[e];if(t==null)throw new Z("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}},n.prototype.disposeMasks=function(){this.id2Mask!=null&&R.dispose(this.id2Mask)},n}(),Id=new CO,Cd=new CO;function sfe(n){Id?.setMaxEntries(n),Cd?.setMaxEntries(n)}function mf(n,e,t,r){var a,i,o,s,u=t==null?!1:t.training,c=Array.isArray(n),l=c?n:[n],f=l.map(function(le){return le.name}),h=[],p=e.names();try{for(var d=fe(f),v=d.next();!v.done;v=d.next()){var m=v.value;p.indexOf(m)!==-1?h.push(e.getValue(m)):h.push(null)}}catch(le){a={error:le}}finally{try{v&&!v.done&&(i=d.return)&&i.call(d)}finally{if(a)throw a.error}}r!=null&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);var g=f.join(",")+"|"+e.names().sort().join(","),y=Id.get(g),b;if(y==null){var w=ufe(l,e);y=w.sorted,b=w.recipientCounts,Id.put(g,y),Cd.put(g,b)}b={},u||Object.assign(b,Cd.get(g));for(var x=new ic(e),N=0;N<y.length;++N){if(r!=null){var T=R.memory().numTensors;T>r.maxNumTensors&&(r.maxNumTensors=T),T<r.minNumTensors&&(r.minNumTensors=T)}var E=y[N],C=E.sourceLayer;if(!(C instanceof pc)){var F=[],D=[],O=[],L=!1;try{for(var z=(o=void 0,fe(E.inputs)),$=z.next();!$.done;$=z.next()){var B=$.value,W=x.getValue(B),X=x.getMask(B);F.push(W),D.push(X),X!=null&&(L=!0),u||(b[B.name]--,b[B.name]===0&&!e.hasKey(B)&&f.indexOf(B.name)===-1&&!W.isDisposed&&B.sourceLayer.stateful!==!0&&O.push(W))}}catch(le){o={error:le}}finally{try{$&&!$.done&&(s=z.return)&&s.call(z)}finally{if(o)throw o.error}}L&&(t=t||{},t.mask=D[0]);var Y=Yt(C.apply(F,t)),V=null;C.supportsMasking&&(V=C.computeMask(F,D));for(var j=lfe(E),re=Array.isArray(j)?j:[j],ne=0;ne<re.length;++ne){x.hasKey(re[ne])||x.add(re[ne],Y[ne],Array.isArray(V)?V[0]:V);var oe=f.indexOf(re[ne].name);oe!==-1&&(h[oe]=Y[ne])}u||R.dispose(O)}}return x.disposeMasks(),c?h:h[0]}function ufe(n,e){var t,r,a,i;R.util.assert(n!=null&&n.length>0,function(){return"Expected at least one fetch, got none"});var o=[],s={};if(n.length===1){var u=OR(n[0],e);o=u.sorted,s=u.recipientMap}else{var c=new Set;try{for(var l=fe(n),f=l.next();!f.done;f=l.next()){var h=f.value,p=OR(h,e),d=p.sorted,v=p.recipientMap;try{for(var m=(a=void 0,fe(d)),g=m.next();!g.done;g=m.next()){var y=g.value;c.has(y.name)||(o.push(y),c.add(y.name))}}catch(x){a={error:x}}finally{try{g&&!g.done&&(i=m.return)&&i.call(m)}finally{if(a)throw a.error}}var b=function(x){s[x]==null&&(s[x]=new Set),v[x].forEach(function(N){return s[x].add(N)})};for(var w in v)b(w)}}catch(x){t={error:x}}finally{try{f&&!f.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}}return{sorted:o,recipientCounts:cfe(s)}}function cfe(n){var e={};for(var t in n)e[t]=n[t].size;return e}function OR(n,e){var t,r,a,i,o=new Set,s=[],u={};try{for(var c=fe(e.names()),l=c.next();!l.done;l=c.next()){var f=l.value;o.add(f)}}catch(b){t={error:b}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}var h=[],p=[];for(h.push(n);h.length>0;){var d=h[h.length-1];if(o.has(d.name)){h.pop();continue}var v=p[p.length-1]===h.length-1;if(d.inputs.length===0||v)h.pop(),s.push(d),o.add(d.name),v&&p.pop();else{p.push(h.length-1);try{for(var m=(a=void 0,fe(d.inputs)),g=m.next();!g.done;g=m.next()){var y=g.value;u[y.name]==null&&(u[y.name]=new Set),u[y.name].add(d.name),!o.has(y.name)&&h.push(y)}}catch(b){a={error:b}}finally{try{g&&!g.done&&(i=m.return)&&i.call(m)}finally{if(a)throw a.error}}}}return{sorted:s,recipientMap:u}}function lfe(n){var e,t,r;if(n.sourceLayer.inboundNodes.length===1)r=n.sourceLayer.output;else{for(var a=null,i=0;i<n.sourceLayer.inboundNodes.length;++i)try{for(var o=(e=void 0,fe(n.sourceLayer.inboundNodes[i].outputTensors)),s=o.next();!s.done;s=o.next()){var u=s.value;if(u.id===n.id){a=i;break}}}catch(c){e={error:c}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}r=n.sourceLayer.getOutputAt(a)}return r}var ffe=R.env();ffe.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",function(){return 100},sfe);var qO="Abs",hfe="Acos",pfe="Acosh",tb="Add",dfe="AddN",vfe="ArgMax",mfe="ArgMin",gfe="Asin",yfe="Asinh",bfe="Atan",wfe="Atanh",xfe="Atan2",kfe="AvgPool",Sfe="AvgPoolGrad",Nfe="AvgPool3D",Tfe="AvgPool3DGrad",WO="BatchMatMul",VO="BatchToSpaceND",Efe="BroadcastTo",nb="Cast",Ife="Ceil",Cfe="ClipByValue",Afe="Complex",GO="ComplexAbs",UO="Concat",HO="Conv2D",_fe="Conv2DBackpropFilter",KO="Conv2DBackpropInput",Dfe="Conv3D",Ffe="Conv3DBackpropFilterV2",Rfe="Conv3DBackpropInputV2",jO="Cos",XO="Cosh",Ofe="Cumprod",YO="Cumsum",Pfe="DepthwiseConv2dNative",Mfe="DepthwiseConv2dNativeBackpropFilter",Bfe="DepthwiseConv2dNativeBackpropInput",Lfe="Dilation2D",zfe="Dilation2DBackpropInput",$fe="Dilation2DBackpropFilter",ZO="RealDiv",qfe="Elu",Wfe="EluGrad",Vfe="Erf",Gfe="Equal",JO="Exp",QO="ExpandDims",Ufe="Expm1",Hfe="Fill",eP="Floor",tP="FloorDiv",Kfe="FusedBatchNorm",nP="GatherV2",jfe="Greater",rP="GreaterEqual",rb="Identity",Xfe="Imag",Yfe="IsFinite",Zfe="IsInf",Jfe="IsNan",Qfe="LeakyRelu",ehe="Less",the="LessEqual",aP="Log",nhe="Log1p",rhe="LogicalAnd",ahe="LogicalNot",ihe="LogSoftmax",ohe="LRN",she="LRNGrad",uhe="Max",iP="Maximum",che="MaxPool",lhe="MaxPoolGrad",fhe="MaxPool3D",hhe="MaxPool3DGrad",phe="Mean",dhe="Min",vhe="Minimum",mhe="MirrorPad",ghe="Mod",oP="Multiply",sP="Neg",yhe="OnesLike",bhe="OneHot",uP="Pack",cP="PadV2",lP="Pow",whe="Prelu",xhe="Prod",khe="Real",She="Reciprocal",Nhe="Relu",fP="Reshape",The="ResizeNearestNeighbor",Ehe="ResizeNearestNeighborGrad",Ihe="ResizeBilinear",Che="ResizeBilinearGrad",Ahe="Relu6",hP="Reverse",_he="Round",pP="Rsqrt",dP="Select",Dhe="Selu",vP="Slice",mP="Sin",gP="Sinh",Fhe="Sign",yP="Sigmoid",Rhe="Softplus",bP="Sqrt",wP="Sum",xP="SpaceToBatchND",kP="SplitV",Ohe="Softmax",Phe="SquaredDifference",Mhe="Square",SP="Sub",Bhe="Tan",Lhe="Tanh",ab="Tile",xd="Transpose",NP="Unpack",TP="UnsortedSegmentSum",EP="ZerosLike",IP="Step";var zhe=1e-7,$he=1e-4,qhe=function(){function n(){}return n.prototype.refCount=function(e){return Kr("refCount")},n.prototype.incRef=function(e){return Kr("incRef")},n.prototype.timerAvailable=function(){return!0},n.prototype.time=function(e){return Kr("time")},n.prototype.read=function(e){return Kr("read")},n.prototype.readSync=function(e){return Kr("readSync")},n.prototype.readToGPU=function(e,t){return Kr("readToGPU")},n.prototype.numDataIds=function(){return Kr("numDataIds")},n.prototype.disposeData=function(e,t){return Kr("disposeData")},n.prototype.write=function(e,t,r){return Kr("write")},n.prototype.move=function(e,t,r,a,i){return Kr("move")},n.prototype.createTensorFromGPUData=function(e,t,r){return Kr("createTensorFromGPUData")},n.prototype.memory=function(){return Kr("memory")},n.prototype.floatPrecision=function(){return Kr("floatPrecision")},n.prototype.epsilon=function(){return this.floatPrecision()===32?zhe:$he},n.prototype.dispose=function(){return Kr("dispose")},n}();function Kr(n){throw new Error("'".concat(n,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function Se(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function Whe(n,e,t){t===void 0&&(t=""),Se(ib(n,e),function(){return t+" Shapes ".concat(n," and ").concat(e," must match")})}function Pi(n){if(n.length===0)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function ib(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Ad(n){return n%1===0}function kd(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function Ls(n,e){var t=e.length;return n=n==null?e.map(function(r,a){return a}):[].concat(n),Se(n.every(function(r){return r>=-t&&r<t}),function(){return"All values in axis param must be in range [-".concat(t,", ").concat(t,") but ")+"got axis ".concat(n)}),Se(n.every(function(r){return Ad(r)}),function(){return"All values in axis param must be integers but "+"got axis ".concat(n)}),n.map(function(r){return r<0?t+r:r})}function Vhe(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error("Unknown data type ".concat(n));return t}function Ghe(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(e," being uploaded contains ").concat(r,"."))}}function Uhe(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function Dy(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype ".concat(n))}function Hhe(n){if(n==null)return 0;var e=0;return n.forEach(function(t){return e+=t.length}),e}function ob(n){return typeof n=="string"||n instanceof String}function Khe(n){return typeof n=="boolean"}function jhe(n){return typeof n=="number"}function sb(n){return Array.isArray(n)?sb(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":jhe(n)?"float32":ob(n)?"string":Khe(n)?"bool":"float32"}function Fy(n){return!!(n&&n.constructor&&n.call&&n.apply)}function ub(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function CP(n,e,t,r){r===void 0&&(r=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(r?2:1),o=0;o<i;o++)a[o]=t[n+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(l,f){return l*f})*(r?2:1),o=0;o<i;o++)a[o]=CP(n+o*u,s,t,r);return a}function PR(n,e,t){if(t===void 0&&(t=!1),n.length===0)return e[0];var r=n.reduce(function(a,i){return a*i})*(t?2:1);if(r===0)return[];if(r!==e.length)throw new Error("[".concat(n,"] does not match the input size ").concat(e.length).concat(t?" for a complex tensor":"","."));return CP(0,n,e,t)}function AP(n,e){for(var t=cb(n,e),r=0;r<t.length;r++)t[r]=1;return t}function cb(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error("Unknown data type ".concat(e))}function _f(n){n.forEach(function(e){Se(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(n,"].")})})}function lb(n){return n&&n.then&&typeof n.then=="function"}var MR="tfjsflags",Xhe=function(){function n(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Yhe,this.populateURLFlags()}return n.prototype.setPlatform=function(e,t){this.platform!=null&&(Tn().getBool("IS_TEST")||Tn().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t},n.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){var a=this.urlFlags[e];Tn().getBool("IS_TEST")||Tn().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(a,".")),this.set(e,a)}},n.prototype.getAsync=function(e){return Ce(this,void 0,void 0,function(){var t,r;return Ee(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,r=e,[4,this.evaluateFlag(e)]);case 1:return t[r]=a.sent(),[2,this.flags[e]]}})})},n.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(lb(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},n.prototype.getNumber=function(e){return this.get(e)},n.prototype.getBool=function(e){return this.get(e)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!1,configurable:!0}),n.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},n.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()},n.prototype.setFlags=function(e){this.flags=Object.assign({},e)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if(MR in t){var r=t[MR].split(",");r.forEach(function(a){var i=te(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=Jhe(o,s)})}}},n}();function Yhe(n){var e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];return Zhe(e,r[0],r[1]),r.join("=")}),e}function Zhe(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Jhe(n,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if("".concat(+e)===e)return+e;throw new Error("Could not parse value flag value ".concat(e," for flag ").concat(n,"."))}function Tn(){return _P}var _P=null;function Qhe(n){_P=n}var my;function DP(){if(my==null){var n=void 0;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");my=n}return my}function epe(){var n=DP();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function fb(n,e){var t=epe();if(t.has(n))return t.get(n);var r=e();return t.set(n,r),t.get(n)}function ac(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];Tn().getBool("IS_TEST")||Tn().getBool("PROD")||console.warn.apply(console,Qe([],te(n),!1))}var FP=fb("kernelRegistry",function(){return new Map}),Ry=fb("gradRegistry",function(){return new Map});function BR(n,e){var t=npe(n,e);return FP.get(t)}function LR(n){return Ry.get(n)}function zR(n){for(var e=FP.entries(),t=[];;){var r=e.next(),a=r.done,i=r.value;if(a)break;var o=te(i,2),s=o[0],u=o[1],c=te(s.split("_"),1),l=c[0];l===n&&t.push(u)}return t}function tpe(n){var e=n.kernelName;Ry.has(e)&&Tn().getBool("DEBUG")&&ac("Overriding the gradient for '".concat(e,"'")),Ry.set(e,n)}function npe(n,e){return"".concat(e,"_").concat(n)}var Oy=Zt,Oa=null;try{Oa=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Zt(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}Zt.prototype.__isLong__;Object.defineProperty(Zt.prototype,"__isLong__",{value:!0});function Xr(n){return(n&&n.__isLong__)===!0}Zt.isLong=Xr;var $R={},qR={};function zs(n,e){var t,r,a;return e?(n>>>=0,(a=0<=n&&n<256)&&(r=qR[n],r)?r:(t=Jt(n,(n|0)<0?-1:0,!0),a&&(qR[n]=t),t)):(n|=0,(a=-128<=n&&n<128)&&(r=$R[n],r)?r:(t=Jt(n,n<0?-1:0,!1),a&&($R[n]=t),t))}Zt.fromInt=zs;function Pa(n,e){if(isNaN(n))return e?Fs:Ma;if(e){if(n<0)return Fs;if(n>=RP)return MP}else{if(n<=-VR)return jr;if(n+1>=VR)return PP}return n<0?Pa(-n,e).neg():Jt(n%lc|0,n/lc|0,e)}Zt.fromNumber=Pa;function Jt(n,e,t){return new Zt(n,e,t)}Zt.fromBits=Jt;var _d=Math.pow;function hb(n,e,t){if(n.length===0)throw Error("empty string");if(n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return Ma;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var r;if((r=n.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return hb(n.substring(1),e,t).neg();for(var a=Pa(_d(t,8)),i=Ma,o=0;o<n.length;o+=8){var s=Math.min(8,n.length-o),u=parseInt(n.substring(o,o+s),t);if(s<8){var c=Pa(_d(t,s));i=i.mul(c).add(Pa(u))}else i=i.mul(a),i=i.add(Pa(u))}return i.unsigned=e,i}Zt.fromString=hb;function mi(n,e){return typeof n=="number"?Pa(n,e):typeof n=="string"?hb(n,e):Jt(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}Zt.fromValue=mi;var WR=1<<16,rpe=1<<24,lc=WR*WR,RP=lc*lc,VR=RP/2,GR=zs(rpe),Ma=zs(0);Zt.ZERO=Ma;var Fs=zs(0,!0);Zt.UZERO=Fs;var oc=zs(1);Zt.ONE=oc;var OP=zs(1,!0);Zt.UONE=OP;var Py=zs(-1);Zt.NEG_ONE=Py;var PP=Jt(-1,2147483647,!1);Zt.MAX_VALUE=PP;var MP=Jt(-1,-1,!0);Zt.MAX_UNSIGNED_VALUE=MP;var jr=Jt(0,-2147483648,!1);Zt.MIN_VALUE=jr;var Fe=Zt.prototype;Fe.toInt=function(){return this.unsigned?this.low>>>0:this.low};Fe.toNumber=function(){return this.unsigned?(this.high>>>0)*lc+(this.low>>>0):this.high*lc+(this.low>>>0)};Fe.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(jr)){var t=Pa(e),r=this.div(t),a=r.mul(t).sub(this);return r.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Pa(_d(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};Fe.getHighBits=function(){return this.high};Fe.getHighBitsUnsigned=function(){return this.high>>>0};Fe.getLowBits=function(){return this.low};Fe.getLowBitsUnsigned=function(){return this.low>>>0};Fe.getNumBitsAbs=function(){if(this.isNegative())return this.eq(jr)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};Fe.isZero=function(){return this.high===0&&this.low===0};Fe.eqz=Fe.isZero;Fe.isNegative=function(){return!this.unsigned&&this.high<0};Fe.isPositive=function(){return this.unsigned||this.high>=0};Fe.isOdd=function(){return(this.low&1)===1};Fe.isEven=function(){return(this.low&1)===0};Fe.equals=function(e){return Xr(e)||(e=mi(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Fe.eq=Fe.equals;Fe.notEquals=function(e){return!this.eq(e)};Fe.neq=Fe.notEquals;Fe.ne=Fe.notEquals;Fe.lessThan=function(e){return this.comp(e)<0};Fe.lt=Fe.lessThan;Fe.lessThanOrEqual=function(e){return this.comp(e)<=0};Fe.lte=Fe.lessThanOrEqual;Fe.le=Fe.lessThanOrEqual;Fe.greaterThan=function(e){return this.comp(e)>0};Fe.gt=Fe.greaterThan;Fe.greaterThanOrEqual=function(e){return this.comp(e)>=0};Fe.gte=Fe.greaterThanOrEqual;Fe.ge=Fe.greaterThanOrEqual;Fe.compare=function(e){if(Xr(e)||(e=mi(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Fe.comp=Fe.compare;Fe.negate=function(){return!this.unsigned&&this.eq(jr)?jr:this.not().add(oc)};Fe.neg=Fe.negate;Fe.add=function(e){Xr(e)||(e=mi(e));var t=this.high>>>16,r=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,p=0;return p+=i+c,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=r+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,Jt(h<<16|p,l<<16|f,this.unsigned)};Fe.subtract=function(e){return Xr(e)||(e=mi(e)),this.add(e.neg())};Fe.sub=Fe.subtract;Fe.multiply=function(e){if(this.isZero())return Ma;if(Xr(e)||(e=mi(e)),Oa){var t=Oa.mul(this.low,this.high,e.low,e.high);return Jt(t,Oa.get_high(),this.unsigned)}if(e.isZero())return Ma;if(this.eq(jr))return e.isOdd()?jr:Ma;if(e.eq(jr))return this.isOdd()?jr:Ma;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(GR)&&e.lt(GR))return Pa(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*l,p+=d>>>16,d&=65535,p+=i*l,h+=p>>>16,p&=65535,p+=o*c,h+=p>>>16,p&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=r*l+a*c+i*u+o*s,f&=65535,Jt(p<<16|d,f<<16|h,this.unsigned)};Fe.mul=Fe.multiply;Fe.divide=function(e){if(Xr(e)||(e=mi(e)),e.isZero())throw Error("division by zero");if(Oa){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Oa.div_u:Oa.div_s)(this.low,this.high,e.low,e.high);return Jt(t,Oa.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Fs:Ma;var r,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Fs;if(e.gt(this.shru(1)))return OP;i=Fs}else{if(this.eq(jr)){if(e.eq(oc)||e.eq(Py))return jr;if(e.eq(jr))return oc;var o=this.shr(1);return r=o.div(e).shl(1),r.eq(Ma)?e.isNegative()?oc:Py:(a=this.sub(e.mul(r)),i=r.add(a.div(e)),i)}else if(e.eq(jr))return this.unsigned?Fs:Ma;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Ma}for(a=this;a.gte(e);){r=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(r)/Math.LN2),u=s<=48?1:_d(2,s-48),c=Pa(r),l=c.mul(e);l.isNegative()||l.gt(a);)r-=u,c=Pa(r,this.unsigned),l=c.mul(e);c.isZero()&&(c=oc),i=i.add(c),a=a.sub(l)}return i};Fe.div=Fe.divide;Fe.modulo=function(e){if(Xr(e)||(e=mi(e)),Oa){var t=(this.unsigned?Oa.rem_u:Oa.rem_s)(this.low,this.high,e.low,e.high);return Jt(t,Oa.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Fe.mod=Fe.modulo;Fe.rem=Fe.modulo;Fe.not=function(){return Jt(~this.low,~this.high,this.unsigned)};Fe.and=function(e){return Xr(e)||(e=mi(e)),Jt(this.low&e.low,this.high&e.high,this.unsigned)};Fe.or=function(e){return Xr(e)||(e=mi(e)),Jt(this.low|e.low,this.high|e.high,this.unsigned)};Fe.xor=function(e){return Xr(e)||(e=mi(e)),Jt(this.low^e.low,this.high^e.high,this.unsigned)};Fe.shiftLeft=function(e){return Xr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Jt(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Jt(0,this.low<<e-32,this.unsigned)};Fe.shl=Fe.shiftLeft;Fe.shiftRight=function(e){return Xr(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Jt(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Jt(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Fe.shr=Fe.shiftRight;Fe.shiftRightUnsigned=function(e){if(Xr(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var r=this.low;return Jt(r>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?Jt(t,0,this.unsigned):Jt(t>>>e-32,0,this.unsigned)};Fe.shru=Fe.shiftRightUnsigned;Fe.shr_u=Fe.shiftRightUnsigned;Fe.toSigned=function(){return this.unsigned?Jt(this.low,this.high,!1):this};Fe.toUnsigned=function(){return this.unsigned?this:Jt(this.low,this.high,!0)};Fe.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Fe.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Fe.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};Zt.fromBytes=function(e,t,r){return r?Zt.fromBytesLE(e,t):Zt.fromBytesBE(e,t)};Zt.fromBytesLE=function(e,t){return new Zt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};Zt.fromBytesBE=function(e,t){return new Zt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var ape=Ale({__proto__:null,default:Oy},[Oy]),ipe=Oy||ape;function pb(n){return ipe.fromString(n,!0,16)}pb("c3a5c85c97cb3127");pb("b492b66fbe98f273");pb("9ae16a3b2f90404f");function ope(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function BP(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=xf(n)),Tn().getBool("DEBUG")&&Ghe(n,e),ope(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){for(var t=new Uint8Array(n.length),r=0;r<t.length;++r)Math.round(n[r])!==0&&(t[r]=1);return t}else throw new Error("Unknown data type ".concat(e))}function Dd(){return Tn().platform.now()}function spe(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",Tn().platform.encode(n,e)}function UR(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",Tn().platform.decode(n,e)}function pi(n){return Tn().platform.isTypedArray(n)}function xf(n,e,t){var r,a;if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||lb(n)||n==null||pi(n)&&t)e.push(n);else if(Array.isArray(n)||pi(n))for(var i=0;i<n.length;++i)xf(n[i],e,t);else{var o=-1;try{for(var s=fe(Object.keys(n)),u=s.next();!u.done;u=s.next()){var c=u.value;/^([1-9]+[0-9]*|0)$/.test(c)&&(o=Math.max(o,Number(c)))}}catch(l){r={error:l}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}for(var i=0;i<=o;i++)xf(n[i],e,t)}return e}var upe=function(){function n(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new lpe)}return n.prototype.profileKernel=function(e,t,r){var a,i,o,s=function(){o=r()},u,c=Dd();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var l=fe(o),f=l.next();!f.done;f=l.next()){var h=f.value;h.dataSync()}}catch(m){a={error:m}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:Dd()-c})}if(Tn().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var p=function(m){var g=o[m];g.data().then(function(y){cpe(y,g.dtype,e)})},d=0;d<o.length;d++)p(d);var v={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(m){return m.kernelMs}),extraInfo:u.then(function(m){return m.getExtraProfileInfo!=null?m.getExtraProfileInfo():""})};return v},n.prototype.logKernelProfile=function(e){var t=this,r=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(c){t.logger.logKernelProfile(r,u,c[0],c[1],o,c[2])})})},n}();function cpe(n,e,t){if(e!=="float32")return!1;for(var r=0;r<n.length;r++){var a=n[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(t,"'")),!0}return!1}var lpe=function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,a,i,o){var s=typeof a=="number"?kd("".concat(a,"ms"),9):a.error,u=kd(e,25),c=t.rank,l=t.size,f=kd(t.shape.toString(),14),h="";for(var p in i){var d=i[p];if(d!=null){var v=d.shape||t.shape,m=v.length;h+="".concat(p,": ").concat(m,"D ").concat(m>0?v:""," ")}}console.log("%c".concat(u,"	%c").concat(s,"	%c").concat(c,"D ").concat(f,"	%c").concat(l,"	%c").concat(h,"	%c").concat(o),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n}();function fpe(n,e,t){for(var r={},a={},i=0;i<e.length;i++)r[e[i].id]=!0;for(var i=0;i<n.length;i++){var o=n[i],s=o.inputs;for(var u in s){for(var c=s[u],l=!1,f=0;f<e.length;f++)if(r[c.id]){o.outputs.forEach(function(b){return r[b.id]=!0}),l=!0,a[o.id]=!0;break}if(l)break}}var h={};h[t.id]=!0;for(var p={},i=n.length-1;i>=0;i--)for(var o=n[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,p[o.id]=!0;break}for(var d=[],i=0;i<n.length;i++){var o=n[i];if(a[o.id]&&p[o.id]){var v={};for(var u in o.inputs){var m=o.inputs[u];r[m.id]&&(v[u]=m)}var g=Object.assign({},o);g.inputs=v,g.outputs=o.outputs,d.push(g)}}return d}function hpe(n,e,t,r){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var p=n[h.id];p!=null?u.push(p):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(s.kernelName,"."));var c=s.gradient(u),l=function(h){if(!(h in c))throw new Error("Cannot backprop through input ".concat(h,". ")+"Available gradients found: ".concat(Object.keys(c),"."));var p=t(function(){return c[h]()});if(p.dtype!=="float32")throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"".concat(h," must have 'float32' dtype, but has '").concat(p.dtype,"'"));var d=s.inputs[h];if(!ib(p.shape,d.shape))throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"'".concat(h,"' has shape '").concat(p.shape,"', which does not match ")+"the shape of the input '".concat(d.shape,"'"));if(n[d.id]==null)n[d.id]=p;else{var v=n[d.id];n[d.id]=r(v,p),v.dispose()}};for(var f in s.inputs)l(f)},i=e.length-1;i>=0;i--)a(i)}var HR=20,cf=3,gy=7;function ppe(n,e,t,r){var a=ub(e),i=dpe(n,e,t,a),o=e.length,s=Sd(n,e,t,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(t)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(e,"]")),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function dpe(n,e,t,r){var a=Pi(e),i=r[r.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?yf(n):n;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,f=0;f<i;f++)o[f]=Math.max(o[f],gf(u[l+f],0,t).length);return o}function gf(n,e,t){var r;return Array.isArray(n)?r="".concat(parseFloat(n[0].toFixed(gy))," + ")+"".concat(parseFloat(n[1].toFixed(gy)),"j"):ob(n)?r="'".concat(n,"'"):t==="bool"?r=LP(n):r=parseFloat(n.toFixed(gy)).toString(),kd(r,e)}function LP(n){return n===0?"false":"true"}function Sd(n,e,t,r,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var c=yf(n);return[gf(c[0],0,t)]}return t==="bool"?[LP(n[0])]:[n[0].toString()]}if(u===1){if(s>HR){var l=cf*o,f=Array.from(n.slice(0,l)),h=Array.from(n.slice((s-cf)*o,s*o));return t==="complex64"&&(f=yf(f),h=yf(h)),["["+f.map(function(T,E){return gf(T,a[E],t)}).join(", ")+", ..., "+h.map(function(T,E){return gf(T,a[s-cf+E],t)}).join(", ")+"]"]}var p=t==="complex64"?yf(n):Array.from(n);return["["+p.map(function(T,E){return gf(T,a[E],t)}).join(", ")+"]"]}var d=e.slice(1),v=r.slice(1),m=r[0]*o,g=[];if(s>HR){for(var y=0;y<cf;y++){var b=y*m,w=b+m;g.push.apply(g,Qe([],te(Sd(n.slice(b,w),d,t,v,a,!1)),!1))}g.push("...");for(var y=s-cf;y<s;y++){var b=y*m,w=b+m;g.push.apply(g,Qe([],te(Sd(n.slice(b,w),d,t,v,a,y===s-1)),!1))}}else for(var y=0;y<s;y++){var b=y*m,w=b+m;g.push.apply(g,Qe([],te(Sd(n.slice(b,w),d,t,v,a,y===s-1)),!1))}var x=u===2?",":"";g[0]="["+(s>0?g[0]+x:"");for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+x;for(var N=`,
`,y=2;y<u;y++)N+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":N),g}function yf(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}(function(){function n(e,t,r){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=Pi(e),r!=null){var i=r.length;Se(i===this.size,function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Vhe(t,this.size),this.strides=ub(e)}return n.prototype.set=function(e){for(var t=this,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];r.length===0&&(r=[0]),Se(r.length===this.rank,function(){return"The number of provided coordinates (".concat(r.length,") must ")+"match the rank (".concat(t.rank,")")});var i=this.locToIndex(r);this.values[i]=e},n.prototype.get=function(){for(var e,t,r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];r.length===0&&(r=[0]);var i=0;try{for(var o=fe(r),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var c="Requested out of range element at ".concat(r,". ")+"  Buffer shape=".concat(this.shape);throw new Error(c)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var l=r[r.length-1],f=0;f<r.length-1;++f)l+=this.strides[f]*r[f];return this.values[l]},n.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),n.prototype.toTensor=function(){return si().makeTensor(this.values,this.shape,this.dtype)},n})();var si=null,lf=null;function vpe(n){si=n}var Ra=function(){function n(e,t,r,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Pi(e),this.strides=ub(e),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),n.prototype.buffer=function(){return Ce(this,void 0,void 0,function(){var e;return Ee(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,lf.buffer(this.shape,this.dtype,e)]}})})},n.prototype.bufferSync=function(){return lf.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return Ce(this,void 0,void 0,function(){var e;return Ee(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,PR(this.shape,e,this.dtype==="complex64")]}})})},n.prototype.arraySync=function(){return PR(this.shape,this.dataSync(),this.dtype==="complex64")},n.prototype.data=function(){return Ce(this,void 0,void 0,function(){var e,t;return Ee(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=si().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=r.sent();try{return[2,t.map(function(a){return UR(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}})})},n.prototype.dataToGPU=function(e){return this.throwIfDisposed(),si().readToGPU(this.dataId,e)},n.prototype.dataSync=function(){this.throwIfDisposed();var e=si().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return UR(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},n.prototype.bytes=function(){return Ce(this,void 0,void 0,function(){var e;return Ee(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,si().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},n.prototype.dispose=function(){this.isDisposed||(si().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!1,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.print=function(e){return e===void 0&&(e=!1),lf.print(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),lf.clone(this)},n.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return ppe(t,this.shape,this.dtype,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),lf.cast(this,e)},n.prototype.variable=function(e,t,r){return e===void 0&&(e=!0),this.throwIfDisposed(),si().makeVariable(this,e,t,r)},n}();Object.defineProperty(Ra,Symbol.hasInstance,{value:function(n){return!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null}});function mpe(){return fb("Tensor",function(){return Ra})}mpe();var Fd=function(n){se(e,n);function e(t,r,a,i){var o=n.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=r,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(t.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!ib(t.shape,this.shape))throw new Error("shape of the new value (".concat(t.shape,") and ")+"previous value (".concat(this.shape,") must match"));si().disposeTensor(this),this.dataId=t.dataId,si().incRef(this,null)},e.prototype.dispose=function(){si().disposeVariable(this),this.isDisposedInternal=!0},e}(Ra);Object.defineProperty(Fd,Symbol.hasInstance,{value:function(n){return n instanceof Ra&&n.assign!=null&&n.assign instanceof Function}});var KR;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(KR||(KR={}));var My;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(My||(My={}));var By;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(By||(By={}));var Ly;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(Ly||(Ly={}));var zy;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(zy||(zy={}));var gpe={float32:Ly,int32:My,bool:By,complex64:zy};function ype(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error("Can not upcast ".concat(n," with ").concat(e))}return gpe[n][e]}function va(n,e){if(n.dtype===e.dtype)return[n,e];var t=ype(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function zP(n){var e=[],t=new Set;return $P(n,e,t),e}function $P(n,e,t){if(n!=null){if(n instanceof Ra){e.push(n);return}if(!!bpe(n)){var r=n;for(var a in r){var i=r[a];t.has(i)||(t.add(i),$P(i,e,t))}}}}function bpe(n){return Array.isArray(n)||typeof n=="object"}function yy(n){return n.kernelName!=null}var jR=function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return n.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},n}(),db=function(){function n(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new jR}return n.prototype.ready=function(){return Ce(this,void 0,void 0,function(){var e,t,r,a;return Ee(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(r=e[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(n.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,r=e.asyncInit;if(r)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!1,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},n.prototype.registerBackend=function(e,t,r){return r===void 0&&(r=1),e in this.registryFactory?(ac("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},n.prototype.setBackend=function(e){return Ce(this,void 0,void 0,function(){var t,r,a,i,o;return Ee(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '".concat(e,"' not found in registry"));return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,a=t.asyncInit,a?[4,r]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=r,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new upe(this.backendInstance),[2,!0]}})})},n.prototype.setupRegisteredKernels=function(){var e=this,t=zR(this.backendName);t.forEach(function(r){r.setupFunc!=null&&r.setupFunc(e.backendInstance)})},n.prototype.disposeRegisteredKernels=function(e){var t=this,r=zR(e);r.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},n.prototype.initializeBackend=function(e){var t=this,r=this.registryFactory[e];if(r==null)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var a=r.factory();if(a&&!(a instanceof qhe)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,ac("Initialization of backend ".concat(e," failed")),ac(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return ac("Initialization of backend ".concat(e," failed")),ac(s.stack||s.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority})},n.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],a=this.initializeBackend(r),i=a.success,o=a.asyncInit;if(o||i)return{name:r,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(e,t){var r=this.state.tensorInfo.get(t),a=r.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),r.backend=e,e.move(t,i,r.shape,r.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(e,t){var r=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return r.startScope(a)},function(){return r.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},n.prototype.scopedRun=function(e,t,r){e();try{var a=r();return t(),a}catch(i){throw t(),i}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=me.runKernel(rb,{x:e}),r={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},c={dtype:s};return me.runKernel(nb,u,c)}}},i=[];return this.addTapeNode(this.state.activeScope.name,r,[t],a,i,{}),t},n.prototype.runKernel=function(e,t,r){this.backendName==null&&this.backend;var a=BR(e,this.backendName)!=null;if(!a)throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:r})},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(e,t,r){var a=this.backend.numDataIds(),i=0;r.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(s," data ids) after running '").concat(e,"'"))},n.prototype.runKernelFunc=function(e){var t=this,r,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var c,l=yy(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(yy(e)){var f=e.kernelName,h=e.inputs,p=e.attrs;this.backendName==null&&this.backend;var d=BR(f,this.backendName);Se(d!=null,function(){return"Cannot find registered kernel '".concat(f,"' for backend '").concat(t.backendName,"'")}),u=function(){var x=t.backend.numDataIds();c=d.kernelFunc({inputs:h,attrs:p,backend:t.backend});var N=Array.isArray(c)?c:[c];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,x,N);var T=N.map(function(C){return C.rank!=null?C:t.makeTensorFromTensorInfo(C)});if(i){var E=t.getTensorsForGradient(f,h,T);a=t.saveTensorsForBackwardMode(E)}return T}}else{var v=e.forwardFunc,m=function(x){!i||(a=x.map(function(N){return t.keep(t.clone(N))}))};u=function(){var x=t.backend.numDataIds();c=t.tidy(function(){return v(t.backend,m)});var N=Array.isArray(c)?c:[c];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(l,x,N),N}}var g=e.inputs,y=e.attrs,b=yy(e)?null:e.backwardsFunc,w;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?r=u():(w=t.profiler.profileKernel(l,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(w),r=w.outputs)}),i&&this.addTapeNode(l,g,r,b,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(x){return g[x]!=null?g[x].shape:null}),outputShapes:r.map(function(x){return x.shape}),kernelTimeMs:w.timeMs,extraInfo:w.extraInfo}),Array.isArray(c)?r:r[0]},n.prototype.saveTensorsForBackwardMode=function(e){var t=this,r=e.map(function(a){return t.keep(t.clone(a))});return r},n.prototype.getTensorsForGradient=function(e,t,r){var a=LR(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(Se(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(c){return t[c]})):s=i.map(function(c){return t[c]});var u=r.filter(function(c,l){return o[l]});return s.concat(u)}return[]},n.prototype.makeTensor=function(e,t,r,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",a=a||this.backend;var i=e;r==="string"&&ob(e[0])&&(i=e.map(function(l){return spe(l)}));var o=a.write(i,t,r),s=new Ra(t,r,o,this.nextTensorId());if(this.trackTensor(s,a),r==="string"){var u=this.state.tensorInfo.get(o),c=Hhe(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},n.prototype.makeTensorFromDataId=function(e,t,r,a){r=r||"float32";var i={dataId:e,shape:t,dtype:r};return this.makeTensorFromTensorInfo(i,a)},n.prototype.makeTensorFromTensorInfo=function(e,t){var r=e.dataId,a=e.shape,i=e.dtype,o=new Ra(a,i,r,this.nextTensorId());return this.trackTensor(o,t),o},n.prototype.makeVariable=function(e,t,r,a){t===void 0&&(t=!0),r=r||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new Fd(e,t,r,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name ".concat(i.name," was already registered"));return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},n.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var r=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(r=e.size*Dy(e.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r})),e instanceof Fd||this.track(e)},n.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},n.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},n.prototype.disposeTensor=function(e){if(!!this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var r=e.size*Dy(e.dtype);this.state.numBytes-=r}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},n.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},n.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return Ce(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f,h;return Ee(this,function(p){switch(p.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=p.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,Qe([],te(this.state.activeProfile.kernels.map(function(d){return d.totalBytesSnapshot})),!1)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,p.label=2;case 2:p.trys.push([2,8,9,10]),i=fe(this.state.activeProfile.kernels),o=i.next(),p.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=p.sent(),c=s,[4,s.extraInfo];case 5:c.extraInfo=p.sent(),p.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return l=p.sent(),f={error:l},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},n.prototype.addTapeNode=function(e,t,r,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:i},c=LR(e);c!=null&&(a=c.gradFunc),a!=null&&(u.gradient=function(l){return l=l.map(function(f,h){if(f==null){var p=r[h],d=cb(p.size,p.dtype);return s.makeTensor(d,p.shape,p.dtype)}return f}),a(l.length>1?l:l[0],i,o)}),this.state.activeTape.push(u)},n.prototype.keep=function(e){return e.kept=!0,e},n.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=zP(e),a=new Set(r.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},n.prototype.gradients=function(e,t,r,a){var i=this;if(a===void 0&&(a=!1),Se(t.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '".concat(r.dtype,"'"));var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});Se(o instanceof Ra,function(){return"The result y returned by f() must be a tensor."});var s=fpe(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=r??wpe(o.shape),hpe(u,s,function(l){return i.tidy(l)},kpe);var c=t.map(function(l){return u[l.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(l){var f,h;try{for(var p=fe(l.saved),d=p.next();!d.done;d=p.next()){var v=d.value;v.dispose()}}catch(m){f={error:m}}finally{try{d&&!d.done&&(h=p.return)&&h.call(p)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:c}})},n.prototype.customGrad=function(e){var t=this;return Se(Fy(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];Se(r.every(function(c){return c instanceof Ra}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};r.forEach(function(c,l){o[l]=c});var s=function(c,l){return i=e.apply(void 0,Qe([],te(Qe(Qe([],te(r),!1),[l],!1)),!1)),Se(i.value instanceof Ra,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),Se(Fy(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(c,l){var f=i.gradFunc(c,l),h=Array.isArray(f)?f:[f];Se(h.length===r.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),Se(h.every(function(d){return d instanceof Ra}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return h.forEach(function(d,v){p[v]=function(){return d}}),p};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},n.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},n.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},n.prototype.readToGPU=function(e,t){var r=this.state.tensorInfo.get(e);return r.backend.readToGPU(e,t)},n.prototype.time=function(e){return Ce(this,void 0,void 0,function(){var t,r;return Ee(this,function(a){switch(a.label){case 0:return t=Dd(),[4,this.backend.time(e)];case 1:return r=a.sent(),r.wallMs=Dd()-t,[2,r]}})})},n.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!1,configurable:!0}),n.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new jR;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n}();db.nextTensorId=0;db.nextVariableId=0;function wpe(n){var e=AP(Pi(n),"float32");return me.makeTensor(e,n,"float32")}function xpe(){var n=DP();if(n._tfengine==null){var e=new Xhe(n);n._tfengine=new db(e)}return Qhe(n._tfengine.ENV),vpe(function(){return n._tfengine}),n._tfengine}var me=xpe();function kpe(n,e){var t={a:n,b:e};return me.runKernel(tb,t)}function Spe(n,e){var t=n;if(pi(n))return e==="string"?[]:[n.length];var r=typeof n=="object";if(r){if("texture"in n){var a=n.channels||"RGBA";return[n.height,n.width*a.length]}else if("buffer"in n&&!(n.buffer instanceof ArrayBuffer))return[n.buffer.size/(e==null?4:Dy(e))]}if(!Array.isArray(n))return[];for(var i=[];Array.isArray(t)||pi(t)&&e!=="string";)i.push(t.length),t=t[0];return Array.isArray(n)&&Tn().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&qP(n,i,[]),i}function qP(n,e,t){if(t=t||[],!Array.isArray(n)&&!pi(n)){Se(e.length===0,function(){return"Element arr[".concat(t.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(e[0]," elements")});return}Se(e.length>0,function(){return"Element arr[".concat(t.join("]["),"] should be a primitive, ")+"but is an array of ".concat(n.length," elements")}),Se(n.length===e[0],function(){return"Element arr[".concat(t.join("]["),"] should have ").concat(e[0]," ")+"elements, but has ".concat(n.length," elements")});for(var r=e.slice(1),a=0;a<n.length;++a)qP(n[a],r,t.concat(a))}function XR(n,e,t,r){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error("Argument '".concat(t,"' passed to '").concat(r,"' must ")+"be ".concat(n," tensor, but got ").concat(e," tensor"))}}function Ie(n,e,t,r){if(r===void 0&&(r="numeric"),n instanceof Ra)return XR(r,n.dtype,e,t),n;var a=sb(n);if(a!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),XR(r,a,e,t),n==null||!pi(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var i=n==null?"null":n.constructor.name;throw new Error("Argument '".concat(e,"' passed to '").concat(t,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=Spe(n,a);!pi(n)&&!Array.isArray(n)&&(n=[n]);var s=!0,u=a!=="string"?BP(n,a):xf(n,[],s);return me.makeTensor(u,o,a)}function WP(n,e,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument ".concat(e," passed to ").concat(t," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=n;return a.map(function(i,o){return Ie(i,"".concat(e,"[").concat(o,"]"),t,r)})}var Npe="__op";function Ve(n){var e=Object.keys(n);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(e.length," keys."));var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+Npe;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];me.startScope(t);try{var s=r.apply(void 0,Qe([],te(i),!1));return lb(s)&&console.error("Cannot return a Promise inside of tidy."),me.endScope(s),s}catch(u){throw me.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function Tpe(n,e){var t=Ie(n,"x","cast");if(!Uhe(e))throw new Error("Failed to cast to unknown dtype ".concat(e));if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var r={x:t},a={dtype:e};return me.runKernel(nb,r,a)}var St=Ve({cast_:Tpe});function Epe(n,e){var t,r=Ie(n,"a","mul"),a=Ie(e,"b","mul");t=te(va(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return me.runKernel(oP,i)}var be=Ve({mul_:Epe});function Ipe(n,e){e===void 0&&(e=0);var t=Ie(n,"x","step"),r={x:t},a={alpha:e};return me.runKernel(IP,r,a)}var vb=Ve({step_:Ipe}),VP={kernelName:qO,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(n,vb(St(r,"float32"),-1))}}}};function Cpe(n,e){var t,r=Ie(n,"a","floorDiv"),a=Ie(e,"b","floorDiv");t=te(va(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return me.runKernel(tP,i)}var Ape=Ve({floorDiv_:Cpe});function _pe(n,e){var t,r=Ie(n,"a","div"),a=Ie(e,"b","div");if(t=te(va(r,a),2),r=t[0],a=t[1],r.dtype==="int32"&&a.dtype==="int32")return Ape(r,a);var i={a:r,b:a},o={};return me.runKernel(ZO,i,o)}var Ot=Ve({div_:_pe});function Dpe(n){var e=Ie(n,"x","neg"),t={x:e};return me.runKernel(sP,t)}var La=Ve({neg_:Dpe});function Fpe(n,e,t,r){if(r==null)r=sb(n);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(typeof n=="object"&&("texture"in n||"buffer"in n&&!(n.buffer instanceof ArrayBuffer))){if(r!=="float32"&&r!=="int32")throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(r,"."));return me.backend.createTensorFromGPUData(n,e||t,r)}if(!pi(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){_f(e);var a=Pi(e),i=Pi(t);Se(a===i,function(){return"Based on the provided shape, [".concat(e,"], the tensor should have ")+"".concat(a," values but has ").concat(i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==Pi(e.slice(o)):!0;Se(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(t,") does not match the provided ")+"shape (".concat(e,"). ")})}}return!pi(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=r!=="string"?BP(n,r):xf(n,[],!0),me.makeTensor(n,e,r)}function En(n,e){if((pi(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&pi(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],r=[];return Fpe(n,t,r,e)}function Rpe(n){var e=Ie(n,"x","sqrt","float32"),t={x:e};return me.runKernel(bP,t)}var di=Ve({sqrt_:Rpe});function Ope(n){var e=Ie(n,"x","square"),t={};return me.runKernel("Square",{x:e},t)}var In=Ve({square_:Ope});function Ppe(n,e){var t,r=Ie(n,"a","sub"),a=Ie(e,"b","sub");t=te(va(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return me.runKernel(SP,i)}var tr=Ve({sub_:Ppe}),Mpe={kernelName:hfe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){var a=In(St(r,"float32")),i=di(tr(En(1),a));return La(Ot(n,i))}}}},Bpe={kernelName:pfe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){var a=di(tr(In(St(r,"float32")),1));return Ot(n,a)}}}};function nr(n,e){for(var t=[],r=0;r<e.length;r++){var a=n[n.length-r-1],i=e.length-r-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function lr(n,e){for(var t=[],r=Math.max(n.length,e.length),a=0;a<r;a++){var i=n[n.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)t.unshift(o);else if(o===1)t.unshift(i);else if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(n," and ").concat(e,".");throw Error(s)}else t.unshift(i)}return t}function Lpe(n,e){var t=Ie(n,"x","reshape","string_or_numeric"),r={x:t},a={shape:e};return me.runKernel(fP,r,a)}var Je=Ve({reshape_:Lpe});function zpe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Ie(n,"x","sum");r.dtype==="bool"&&(r=St(r,"int32"));var a={x:r},i={axis:e,keepDims:t};return me.runKernel(wP,a,i)}var gn=Ve({sum_:zpe}),$pe={kernelName:tb,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=lr(r.shape,a.shape),o=function(){var u=n,c=nr(r.shape,i);return c.length>0&&(u=gn(u,c)),Je(u,r.shape)},s=function(){var u=n,c=nr(a.shape,i);return c.length>0&&(u=gn(u,c)),Je(u,a.shape)};return{a:o,b:s}}};var qpe={kernelName:dfe,saveAllInputs:!0,gradFunc:function(n,e){var t={};return e.forEach(function(r,a){t[a]=function(){return n.clone()}}),t}};function Wpe(n){var e=Ie(n,"x","zerosLike"),t={x:e};return me.runKernel(EP,t)}var At=Ve({zerosLike_:Wpe}),Vpe={kernelName:vfe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return At(r)}}}},Gpe={kernelName:mfe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return At(r)}}}},Upe={kernelName:gfe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Ot(n,di(tr(En(1),In(St(r,"float32")))))}}}};function Hpe(n,e){var t,r=Ie(n,"a","add"),a=Ie(e,"b","add");t=te(va(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return me.runKernel(tb,i)}var xt=Ve({add_:Hpe}),Kpe={kernelName:yfe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){var a=di(xt(En(1),In(St(r,"float32"))));return Ot(n,a)}}}},jpe={kernelName:xfe,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=lr(r.shape,a.shape),o=function(){var u=xt(In(r),In(a)),c=be(n,Ot(a,u)),l=nr(r.shape,i);return l.length>0&&(c=gn(c,l)),Je(c,r.shape)},s=function(){var u=xt(In(r),In(a)),c=La(be(n,Ot(r,u))),l=nr(a.shape,i);return l.length>0&&(c=gn(c,l)),Je(c,a.shape)};return{a:o,b:s}}},Xpe={kernelName:bfe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Ot(n,xt(In(St(r,"float32")),1))}}}},Ype={kernelName:wfe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Ot(n,tr(En(1),In(St(r,"float32"))))}}}};function GP(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function kf(n){var e=te(GP(n),3),t=e[0],r=e[1],a=e[2];return t===1&&r===1&&a===1}function UP(n,e){return kf(n)||kf(e)}function YR(n){return GP(n).every(function(e){return e>0})}function $s(n,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,"."));if(typeof e=="number")Se(Ad(e),function(){return"Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,".")});else if(typeof e=="object")e.forEach(function(r){r.forEach(function(a){Se(Ad(a),function(){return"Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(a,".")})})});else throw Error("Error in ".concat(n,": Unknown padding parameter: ").concat(e))}}function Zpe(n,e,t,r,a,i){var o=Ie(n,"dy","avgPool3dGrad"),s=Ie(e,"input","avgPool3dGrad"),u=o,c=s,l=!1;s.rank===4&&(l=!0,u=Je(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=Je(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),Se(u.rank===5,function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank "+"".concat(u.rank,".")}),Se(c.rank===5,function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank "+"".concat(c.rank,".")}),$s("avgPool3dGrad",a,i);var f={dy:u,input:c},h={filterSize:t,strides:r,pad:a,dimRoundingMode:i},p=me.runKernel(Tfe,f,h);return l?Je(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var Jpe=Ve({avgPool3dGrad_:Zpe}),Qpe={kernelName:Nfe,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.filterSize,o=t.strides,s=t.pad,u=t.dimRoundingMode;return{x:function(){return Jpe(n,a,i,o,s,u)}}}};function ede(n,e,t,r,a){var i=Ie(n,"dy","avgPoolGrad"),o=Ie(e,"input","avgPoolGrad");Se(o.rank===i.rank,function(){return"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")});var s=o,u=i,c=!1;o.rank===3&&(c=!0,s=Je(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=Je(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Se(u.rank===4,function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank "+"".concat(u.rank,".")}),Se(s.rank===4,function(){return"Error in avgPoolGrad: input must be rank 4 but got rank "+"".concat(s.rank,".")});var l={dy:u,input:s},f={filterSize:t,strides:r,pad:a},h=me.runKernel(Sfe,l,f);return c?Je(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var tde=Ve({avgPoolGrad_:ede}),nde={kernelName:kfe,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.filterSize,o=t.strides,s=t.pad;return{x:function(){return tde(n,a,i,o,s)}}}};function rde(n,e,t,r){var a;t===void 0&&(t=!1),r===void 0&&(r=!1);var i=Ie(n,"a","matMul"),o=Ie(e,"b","matMul");a=te(va(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:r};return me.runKernel(WO,s,u)}var Po=Ve({matMul_:rde}),ade={kernelName:WO,inputsToSave:["a","b"],gradFunc:function(n,e,t){var r=te(e,2),a=r[0],i=r[1],o=t.transposeA,s=t.transposeB;return!o&&!s?{a:function(){return Po(n,i,!1,!0)},b:function(){return Po(a,n,!0,!1)}}:!o&&s?{a:function(){return Po(n,i,!1,!1)},b:function(){return Po(n,a,!0,!1)}}:o&&!s?{a:function(){return Po(i,n,!1,!0)},b:function(){return Po(a,n,!1,!1)}}:{a:function(){return Po(i,n,!0,!0)},b:function(){return Po(n,a,!0,!0)}}}};function ide(n,e,t){var r=Ie(n,"x","spaceToBatchND");Se(r.rank>=1+e.length,function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(e.length)}),Se(t.length===e.length,function(){return"paddings.shape[0] ".concat(t.length," must be equal to [blockShape] ").concat(e.length)}),Se(r.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(t.toString()," must be divisible by blockShapes ").concat(e.toString())});var a={x:r},i={blockShape:e,paddings:t};return me.runKernel(xP,a,i)}var ode=Ve({spaceToBatchND_:ide});var sde={kernelName:VO,gradFunc:function(n,e,t){var r=t.blockShape,a=t.crops;return{x:function(){return ode(n,r,a)}}}};var ude={kernelName:Efe,gradFunc:function(n,e,t){for(var r=t,a=r.inputShape,i=r.shape,o=Array.from(i),s=a.length-1;s>=0;s--)if(a[s]===i[s])o[s]=1;else if(a[s]!==1)throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(i,"]."));for(var u=[],s=0;s<o.length;s++)o[s]>1&&u.push(s);return{x:function(){return gn(n,u,!0)}}}};var cde={kernelName:nb,gradFunc:function(n){return{x:function(){return n.clone()}}}};var lde={kernelName:Ife,gradFunc:function(n){return{x:function(){return At(n)}}}};function fde(n,e){var t,r=Ie(n,"a","greaterEqual","string_or_numeric"),a=Ie(e,"b","greaterEqual","string_or_numeric");t=te(va(r,a),2),r=t[0],a=t[1],lr(r.shape,a.shape);var i={a:r,b:a};return me.runKernel(rP,i)}var mb=Ve({greaterEqual_:fde});function hde(n,e){var t,r=Ie(n,"a","lessEqual","string_or_numeric"),a=Ie(e,"b","lessEqual","string_or_numeric");t=te(va(r,a),2),r=t[0],a=t[1],lr(r.shape,a.shape);var i={a:r,b:a};return me.runKernel(the,i)}var gb=Ve({lessEqual_:hde});function pde(n,e){var t=Ie(n,"a","logicalAnd","bool"),r=Ie(e,"b","logicalAnd","bool");lr(t.shape,r.shape);var a={a:t,b:r};return me.runKernel(rhe,a)}var HP=Ve({logicalAnd_:pde});function dde(n){var e=Ie(n,"x","clone","string_or_numeric"),t={x:e};return me.runKernel(rb,t)}var KP=Ve({clone_:dde});function vde(n,e){var t=Ie(n,"broadcastTo","x"),r=t.shape;if(_f(e),e.length<t.rank)throw new Error("broadcastTo(): shape.length=".concat(e.length," < input.rank=").concat(t.rank,"."));if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=Je(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(e,"]."));var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return KP(t);var c={x:t},l={reps:o};return me.runKernel(ab,c,l)}var by=Ve({broadcastTo_:vde});function mde(n,e,t){var r=Ie(e,"a","where"),a=Ie(t,"b","where"),i=Ie(n,"condition","where","bool"),o=lr(lr(i.shape,r.shape),a.shape),s=by(i,o),u=by(r,o),c=by(a,o),l={condition:s,t:u,e:c};return me.runKernel(dP,l)}var Ms=Ve({where_:mde}),gde={kernelName:Cfe,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.clipValueMin,o=t.clipValueMax;return{x:function(){return Ms(HP(mb(a,i),gb(a,o)),n,At(n))}}}};var yde={kernelName:GO,inputsToSave:["x"],gradFunc:VP.gradFunc};function bde(n,e,t){t===void 0&&(t=0);var r=Ie(n,"x","split"),a={x:r},i={numOrSizeSplits:e,axis:t};return me.runKernel(kP,a,i)}var wde=Ve({split_:bde});var xde={kernelName:UO,saveAllInputs:!0,gradFunc:function(n,e,t){var r=e.map(function(u){return u.shape}),a=t.axis,i=Ls(a,e[0].shape)[0],o=r.map(function(u){return u[i]}),s=wde(n,o,i);return s.map(function(u){return function(){return u}})}};function kde(n,e,t,r,a,i,o){i===void 0&&(i="NHWC");var s=n;n.rank===3&&(s=Je(n,[1,n.shape[0],n.shape[1],n.shape[2]]));var u=e;u.rank===3&&(u=Je(e,[1,e.shape[0],e.shape[1],e.shape[2]])),Se(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")}),Se(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")}),Se(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(t,".")});var c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];Se(c===t[2],function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(t[2],".")}),Se(l===t[3],function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(t[3],").")}),$s("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return me.runKernel(_fe,f,h)}var jP=Ve({conv2DBackpropFilter_:kde});function Sde(n,e,t,r,a,i,o){i===void 0&&(i="NHWC"),Se(n.length===e.rank,function(){return"Length of inShape "+"(".concat(n.length,") and rank of dy (").concat(e.rank,") must match")});var s=n,u=e,c=!1;e.rank===3&&(c=!0,u=Je(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,n[0],n[1],n[2]]),Se(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")}),Se(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)}),Se(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(t.rank)});var l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];Se(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(t.shape[2],".")}),Se(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output (".concat(f,") must ")+"match output depth for filter ".concat(t.shape[3],".")}),$s("conv2dDerInput",a,o);var h={dy:u,filter:t},p={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=me.runKernel(KO,h,p);return c?Je(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Nde=Ve({conv2DBackpropInput_:Sde}),Tde={kernelName:HO,inputsToSave:["x","filter"],gradFunc:function(n,e,t){var r=te(e,2),a=r[0],i=r[1],o=t.dilations,s=t.strides,u=t.pad,c=t.dataFormat;return Se(kf(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(o,"'")}),{x:function(){return Nde(a.shape,n,i,s,u,c)},filter:function(){return jP(a,n,i.shape,s,u,c)}}}};function Ede(n,e,t,r,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=Ie(n,"x","conv2d","float32"),u=Ie(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=Je(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Se(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")}),Se(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")}),$s("conv2d",r,o);var f=a==="NHWC"?c.shape[3]:c.shape[1];Se(f===u.shape[2],function(){return"Error in conv2d: depth of input (".concat(f,") must match ")+"input depth for filter ".concat(u.shape[2],".")}),Se(UP(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),Se(YR(i),function(){return"Error in conv2D: Dilated rates should be larger than 0."}),Se(YR(t),function(){return"Error in conv2D: Strides should be larger than 0."});var h={x:c,filter:u},p={strides:t,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},d=me.runKernel(HO,h,p);return l?Je(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Ide=Ve({conv2d_:Ede}),Cde={kernelName:KO,inputsToSave:["dy","filter"],gradFunc:function(n,e,t){var r=te(e,2),a=r[0],i=r[1],o=t.strides,s=t.pad,u=t.dataFormat,c=t.dimRoundingMode;return{dy:function(){return Ide(n,i,o,s,u,1,c)},filter:function(){return jP(n,a,i.shape,o,s,u,c)}}}};function Ade(n,e,t,r,a){var i=n;n.rank===4&&(i=Je(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));var o=e;o.rank===4&&(o=Je(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),Se(i.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+"".concat(i.shape,".")}),Se(o.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+"".concat(o.shape,".")}),Se(t.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+"".concat(t,".")}),Se(i.shape[4]===t[3],function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must ")+"match input depth in filter (".concat(t[3],".")}),Se(o.shape[4]===t[4],function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must ")+"match output depth for filter (".concat(t[4],").")});var s={x:i,dy:o},u={strides:r,pad:a,filterShape:t};return me.runKernel(Ffe,s,u)}var _de=Ve({conv3DBackpropFilter_:Ade});function Dde(n,e,t,r,a){Se(n.length===e.rank,function(){return"Length of inShape "+"(".concat(n.length,") and rank of dy (").concat(e.rank,") must match")});var i=n,o=e,s=!1;e.rank===4&&(s=!0,o=Je(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);var u=i[4],c=o.shape[4];Se(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")}),Se(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)}),Se(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(t.rank)}),Se(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(t.shape[3],".")}),Se(c===t.shape[4],function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(t.shape[4],".")});var l={dy:o,filter:t},f={pad:a,strides:r,inputShape:i},h=me.runKernel(Rfe,l,f);return s?Je(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var Fde=Ve({conv3DBackpropInput_:Dde}),Rde={kernelName:Dfe,inputsToSave:["x","filter"],gradFunc:function(n,e,t){var r=t.dilations,a=t.strides,i=t.pad;Se(kf(r),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are "+"not yet supported in gradients. Got dilations '".concat(r,"'")});var o=te(e,2),s=o[0],u=o[1];return{x:function(){return Fde(s.shape,n,u,a,i)},filter:function(){return _de(s,n,u.shape,a,i)}}}};function Ode(n){var e=Ie(n,"x","sin","float32"),t={x:e};return me.runKernel(mP,t)}var Pde=Ve({sin_:Ode}),Mde={kernelName:jO,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(La(Pde(St(r,"float32"))),n)}}}};function Bde(n){var e=Ie(n,"x","sinh"),t={x:e};return me.runKernel(gP,t)}var Lde=Ve({sinh_:Bde}),zde={kernelName:XO,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(Lde(St(r,"float32")),n)}}}};function $de(n,e){for(var t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function qde(n,e,t){for(var r=n.length+e.length,a=[],i=0,o=0,s=0;s<r;s++)t.indexOf(s)===-1?a.push(n[i++]):a.push(e[o++]);return a}function Wde(n,e){for(var t=[],r=n.length,a=0;a<r;a++)e.indexOf(a)===-1&&t.push(n[a]);var i=e.map(function(o){return n[o]});return[t,i]}function ZR(n,e){var t=e.map(function(r){return 1});return qde(n,t,e)}function XP(n,e){if($de(n,e))return null;for(var t=[],r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach(function(a){return t.push(a)}),t}function yb(n){return n.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function Vde(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var a=Ie(n,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:r};return me.runKernel(YO,i,o)}var Gde=Ve({cumsum_:Vde});function $n(n,e){return me.tidy(n,e)}function ha(n){var e=zP(n);e.forEach(function(t){return t.dispose()})}function Ude(n){return me.keep(n)}function Hde(n,e){var t=Ie(n,"real","complex"),r=Ie(e,"imag","complex");Whe(t.shape,r.shape,"real and imag shapes, ".concat(t.shape," and ").concat(r.shape,", ")+"must match in call to tf.complex().");var a={real:t,imag:r};return me.runKernel(Afe,a)}var bb=Ve({complex_:Hde});function Kde(n){var e=Ie(n,"input","imag"),t={input:e};return me.runKernel(Xfe,t)}var jde=Ve({imag_:Kde});function Xde(n){var e=Ie(n,"input","real"),t={input:e};return me.runKernel(khe,t)}var Yde=Ve({real_:Xde});function Zde(n,e,t){var r=Ie(n,"x","transpose");if(e==null&&(e=r.shape.map(function(o,s){return s}).reverse()),Se(r.rank===e.length,function(){return"Error in transpose: rank of input ".concat(r.rank," ")+"must match length of perm ".concat(e,".")}),e.forEach(function(o){Se(o>=0&&o<r.rank,function(){return"All entries in 'perm' must be between 0 and ".concat(r.rank-1)+" but got ".concat(e)})}),r.rank<=1)return r.clone();var a={x:r},i={perm:e};return r.dtype==="complex64"?$n(function(){var o=Yde(r),s=jde(r);return o=me.runKernel(xd,{x:o},i),s=me.runKernel(xd,{x:s},i),t&&(s=La(s)),bb(o,s)}):me.runKernel(xd,a,i)}var fc=Ve({transpose_:Zde}),Jde={kernelName:YO,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.axis,o=t.exclusive,s=t.reverse;return{x:function(){var u=XP([i],a.rank),c=Gde(n,i,o,!s);return u!=null&&(c=fc(c,u)),c}}}};function Qde(n,e,t,r,a,i,o){i===void 0&&(i=[1,1]);var s=n;n.rank===3&&(s=Je(n,[1,n.shape[0],n.shape[1],n.shape[2]]));var u=e;u.rank===3&&(u=Je(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={x:s,dy:u},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return me.runKernel(Mfe,c,l)}var eve=Ve({depthwiseConv2dNativeBackpropFilter_:Qde});function tve(n,e,t,r,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=Je(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={dy:s,filter:t},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:n},f=me.runKernel(Bfe,c,l);return u?Je(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var nve=Ve({depthwiseConv2dNativeBackpropInput_:tve}),rve={kernelName:Pfe,inputsToSave:["x","filter"],gradFunc:function(n,e,t){var r=t.dilations,a=t.strides,i=t.pad,o=t.dimRoundingMode,s=r??[1,1];Se(kf(s),function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(s,"'")});var u=te(e,2),c=u[0],l=u[1];return Se(c.rank===4,function(){return"Error in gradient of depthwiseConv2dNative: input must be "+"rank 4, but got rank ".concat(c.rank,".")}),Se(l.rank===4,function(){return"Error in gradient of depthwiseConv2dNative: filter must be "+"rank 4, but got rank ".concat(l.rank,".")}),Se(c.shape[3]===l.shape[2],function(){return"Error in gradient of depthwiseConv2d: number of input "+"channels (".concat(c.shape[3],") must match the inChannels dimension ")+"in filter ".concat(l.shape[2],".")}),Se(UP(a,s),function(){return"Error in gradient of depthwiseConv2d: Either strides or "+"dilations must be  1. Got strides ".concat(a," and dilations ")+"'".concat(s,"'.")}),$s("depthwiseConv2d",i,o),{x:function(){return nve(c.shape,n,l,a,i,s,o)},filter:function(){return eve(c,n,l.shape,a,i,s,o)}}}},ave={kernelName:Lfe,inputsToSave:["x","filter"],gradFunc:function(n,e,t){var r=te(e,2),a=r[0],i=r[1],o={x:a,filter:i,dy:n},s={x:a,filter:i,dy:n};return{x:function(){return me.runKernel(zfe,o,t)},filter:function(){return me.runKernel($fe,s,t)}}}},ive={kernelName:qfe,outputsToSave:[!0],gradFunc:function(n,e){var t=te(e,1),r=t[0],a={dy:n,y:r};return{x:function(){return me.runKernel(Wfe,a)}}}};function ove(n){var e=Ie(n,"x","exp"),t={x:e};return me.runKernel(JO,t)}var Qd=Ve({exp_:ove}),sve={kernelName:Vfe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0],a=be(Qd(La(In(r))),2/Math.sqrt(Math.PI));return{x:function(){return be(n,a)}}}},uve={kernelName:JO,outputsToSave:[!0],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(n,r)}}}},cve={kernelName:QO,inputsToSave:["input"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{input:function(){return Je(n,r.shape)}}}},lve={kernelName:Ufe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(n,Qd(r))}}}};var fve={kernelName:eP,gradFunc:function(n){return{x:function(){return At(n)}}}},hve={kernelName:tP,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=lr(r.shape,a.shape),o=function(){var u=Ot(n,St(a,"float32")),c=nr(r.shape,i);return c.length>0?Je(gn(u,c),r.shape):u},s=function(){var u=be(n,St(r,"float32")),c=nr(a.shape,i);c.length>0&&(u=Je(gn(u,c),a.shape));var l=In(a);return La(Ot(u,St(l,"float32")))};return{a:o,b:s}}};function pve(n){var e=Ie(n,"x","rsqrt","float32"),t={x:e};return me.runKernel(pP,t)}var dve=Ve({rsqrt_:pve});function vve(n,e){var t=Ie(n,"x","tile","string_or_numeric");Se(t.rank===e.length,function(){return"Error in transpose: rank of input ".concat(t.rank," ")+"must match length of reps ".concat(e,".")});var r={x:t},a={reps:e};return me.runKernel(ab,r,a)}var mve=Ve({tile_:vve}),gve={kernelName:Kfe,inputsToSave:["x","mean","variance","scale"],gradFunc:function(n,e,t){var r=t.varianceEpsilon,a=te(e,4),i=a[0],o=a[1],s=a[2],u=a[3],c=u??En(1),l=nr(o.shape,i.shape),f=[];if(o.rank===1){for(var h=0;h<i.shape.length-1;++h)f.push(i.shape[h]);f.push(1)}var p=tr(i,o),d=be(n,c),v=dve(xt(s,En(r))),m=be(be(be(v,v),v),En(-.5)),g=function(){return o.rank===1?Je(be(be(n,mve(Je(v,[1,1,1,o.shape[0]]),f)),c),i.shape):Je(be(be(n,v),c),i.shape)},y=function(){var N=be(be(v,En(-1)),d);return o.rank===1&&(N=gn(N,l)),Je(N,o.shape)},b=function(){var N=be(be(m,p),d);return o.rank===1&&(N=gn(N,l)),Je(N,o.shape)},w=function(){var N=be(p,v),T=be(n,N);return o.rank===1&&(T=gn(T,l)),Je(T,o.shape)},x=function(){var N=n;return o.rank===1&&(N=gn(N,l)),Je(N,o.shape)};return{x:g,mean:y,variance:b,scale:w,offset:x}}};function yve(n,e,t){var r=Ie(n,"x","unsortedSegmentSum"),a=Ie(e,"segmentIds","unsortedSegmentSum","int32");Se(Ad(t),function(){return"numSegments must be of dtype int"});var i={x:r,segmentIds:a},o={numSegments:t};return me.runKernel(TP,i,o)}var bve=Ve({unsortedSegmentSum_:yve}),wve={kernelName:nP,inputsToSave:["x","indices"],gradFunc:function(n,e,t){var r=te(e,2),a=r[0],i=r[1],o=t.axis,s=Ls(o,a.shape)[0],u=function(){var c=a.shape,l=i.size,f=c.slice(0,s),h=f.length,p=c.slice(o,c.length).slice(1),d=p.length,v=JR(0,h),m=JR(h+1,h+1+d),g=QR([f,[l],p]),y=Je(n,g),b=Je(i,[l]),w=QR([[h],v,m]),x=fc(y,w),N=bve(x,b,a.shape[s]),T=yb(w);return N=fc(N,T),N};return{x:u,indices:function(){return i}}}};function JR(n,e){for(var t=[],r=n;r<e;++r)t.push(r);return t}function QR(n){for(var e=[],t=0;t<n.length;++t)for(var r=0;r<n[t].length;++r)e.push(n[t][r]);return e}var xve={kernelName:rP,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1];return{a:function(){return At(r)},b:function(){return At(a)}}}};var kve={kernelName:rb,gradFunc:function(n){return{x:function(){return St(n,"float32")}}}};var Sve={kernelName:Yfe,gradFunc:function(n){return{x:function(){return At(n)}}}};var Nve={kernelName:Zfe,gradFunc:function(n){return{x:function(){return At(n)}}}};var Tve={kernelName:Jfe,gradFunc:function(n){return{x:function(){return At(n)}}}};function Eve(n,e){var t,r=Ie(n,"a","greater","string_or_numeric"),a=Ie(e,"b","greater","string_or_numeric");t=te(va(r,a),2),r=t[0],a=t[1],lr(r.shape,a.shape);var i={a:r,b:a};return me.runKernel(jfe,i)}var Df=Ve({greater_:Eve}),Ive={kernelName:Qfe,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.alpha,o=Df(a,0);return{x:function(){return Ms(o,n,be(n,i))}}}},Cve={kernelName:nhe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Ot(n,xt(r,1))}}}},Ave={kernelName:aP,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Ot(n,St(r,"float32"))}}}},_ve={kernelName:ihe,inputsToSave:[],outputsToSave:[!0],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.axis;return{logits:function(){var o=!0,s=Qd(a);return tr(n,be(gn(n,i,o),s))}}}};function Dve(n,e,t,r,a,i,o){r===void 0&&(r=5),a===void 0&&(a=1),i===void 0&&(i=1),o===void 0&&(o=.5);var s={x:n,y:e,dy:t},u={depthRadius:r,bias:a,alpha:i,beta:o};return me.runKernel(she,s,u)}var Fve=Ve({localResponseNormalizationBackprop_:Dve}),Rve={kernelName:ohe,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(n,e,t){var r=te(e,2),a=r[0],i=r[1],o=t.depthRadius,s=t.bias,u=t.alpha,c=t.beta;return{x:function(){return Fve(a,i,n,o,s,u,c)}}}};function Ove(n,e){var t,r=Ie(n,"a","equal","string_or_numeric"),a=Ie(e,"b","equal","string_or_numeric");t=te(va(r,a),2),r=t[0],a=t[1],lr(r.shape,a.shape);var i={a:r,b:a};return me.runKernel(Gfe,i)}var Pve=Ve({equal_:Ove});function YP(n,e,t,r){return e.rank<t.rank&&(e=Je(e,ZR(e.shape,r))),n.rank<t.rank&&(n=Je(n,ZR(n.shape,r))),{x:function(){var a=be(n,St(Pve(t,e),n.dtype));return a}}}var eO={kernelName:uhe,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(n,e,t){var r=t,a=r.reductionIndices,i=e[0],o=e[1],s=Ls(a,i.shape),u=YP(n,o,i,s);return{x:function(){return u.x()}}}};function Mve(n,e){var t,r=Ie(n,"a","less","string_or_numeric"),a=Ie(e,"b","less","string_or_numeric");t=te(va(r,a),2),r=t[0],a=t[1],lr(r.shape,a.shape);var i={a:r,b:a};return me.runKernel(ehe,i)}var Bve=Ve({less_:Mve}),Lve={kernelName:iP,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=function(){return be(n,St(mb(r,a),"float32"))},o=function(){return be(n,St(Bve(r,a),"float32"))};return{a:i,b:o}}};function zve(n,e,t,r,a,i,o){var s=Ie(n,"dy","maxPool3dGrad"),u=Ie(e,"input","maxPool3dGrad"),c=Ie(t,"output","maxPool3dGrad"),l=s,f=u,h=c,p=!1;u.rank===4&&(p=!0,l=Je(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),f=Je(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=Je(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),Se(l.rank===5,function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank "+"".concat(l.rank,".")}),Se(f.rank===5,function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank "+"".concat(f.rank,".")}),Se(h.rank===5,function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank "+"".concat(h.rank,".")}),$s("maxPool3dGrad",i,o);var d={dy:l,input:f,output:h},v={filterSize:r,strides:a,pad:i,dimRoundingMode:o},m=me.runKernel(hhe,d,v);return p?Je(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}var $ve=Ve({maxPool3dGrad_:zve}),qve={kernelName:fhe,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(n,e,t){var r=te(e,2),a=r[0],i=r[1],o=t.filterSize,s=t.strides,u=t.pad,c=t.dimRoundingMode;return{x:function(){return $ve(n,a,i,o,s,u,c)}}}};function Wve(n,e,t,r,a,i,o){var s=Ie(n,"dy","maxPoolGrad"),u=Ie(e,"input","maxPoolGrad"),c=Ie(t,"output","maxPoolGrad");Se(u.rank===s.rank,function(){return"Rank of input (".concat(u.rank,") does not match rank of dy ")+"(".concat(s.rank,")")}),Se(s.rank===4,function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank "+"".concat(s.rank,".")}),Se(u.rank===4,function(){return"Error in maxPoolGrad: input must be rank 4 but got rank "+"".concat(u.rank,".")}),$s("maxPoolGrad",i,o);var l={dy:s,input:u,output:c},f={filterSize:r,strides:a,pad:i,dimRoundingMode:o};return me.runKernel(lhe,l,f)}var Vve=Ve({maxPoolGrad_:Wve}),Gve={kernelName:che,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(n,e,t){var r=te(e,2),a=r[0],i=r[1],o=t.filterSize,s=t.strides,u=t.pad;return{x:function(){return Vve(n,a,i,o,s,u)}}}};function Rd(n,e){if(e===void 0&&(e="float32"),_f(n),e==="complex64"){var t=Rd(n,"float32"),r=Rd(n,"float32");return bb(t,r)}var a=cb(Pi(n),e);return me.makeTensor(a,n,e)}function ev(n,e){if(e===void 0&&(e="float32"),_f(n),e==="complex64"){var t=ev(n,"float32"),r=Rd(n,"float32");return bb(t,r)}var a=AP(Pi(n),e);return me.makeTensor(a,n,e)}var Uve={kernelName:phe,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.axis,o=Ls(i,a.shape),s=Wde(a.shape,o),u=s[1],c=Pi(u),l=function(){var f=a.shape.slice();o.forEach(function(d){f[d]=1});var h=Je(n,f),p=Ot(be(h,ev(a.shape,"float32")),c);return p};return{x:l}}},Hve={kernelName:dhe,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(n,e,t){var r=t,a=r.axis,i=te(e,2),o=i[0],s=i[1],u=Ls(a,o.shape),c=YP(n,s,o,u);return{x:function(){return c.x()}}}},Kve={kernelName:vhe,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=function(){return be(n,St(gb(r,a),"float32"))},o=function(){return be(n,St(Df(r,a),"float32"))};return{a:i,b:o}}};function jve(n,e,t){var r=Ie(n,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");var a={x:r},i={begin:e,size:t};return me.runKernel(vP,a,i)}var sc=Ve({slice_:jve});var Xve={kernelName:mhe,inputsToSave:["x"],gradFunc:function(n,e,t){var r=e[0],a=t.paddings,i=a.map(function(o){return o[0]});return{x:function(){return sc(n,i,r.shape)}}}};function Yve(n){var e=Ie(n,"x","floor","float32"),t={x:e};return me.runKernel(eP,t)}var Zve=Ve({floor_:Yve}),Jve={kernelName:ghe,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=lr(r.shape,a.shape),o=function(){var u=nr(r.shape,i);return u.length>0?Je(gn(n,u),r.shape):n},s=function(){var u=be(n,La(Zve(Ot(r,a)))),c=nr(a.shape,i);return c.length>0?Je(gn(u,c),a.shape):u};return{a:o,b:s}}},Qve={kernelName:oP,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=lr(r.shape,a.shape),o=function(){var u=be(n,St(a,"float32")),c=nr(r.shape,i);return c.length>0?Je(gn(u,c),r.shape):u},s=function(){var u=be(n,St(r,"float32")),c=nr(a.shape,i);return c.length>0?Je(gn(u,c),a.shape):u};return{a:o,b:s}}};var eme={kernelName:sP,gradFunc:function(n){return{x:function(){return La(n)}}}};var tme={kernelName:bhe,inputsToSave:["indices"],gradFunc:function(n,e){var t=e[0];return{indices:function(){return Rd(t.shape,"float32")}}}};var nme={kernelName:yhe,gradFunc:function(n){return{x:function(){return At(n)}}}};function rme(n,e){e===void 0&&(e=0);var t=Ie(n,"x","unstack","string_or_numeric");Se(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = ".concat(e," is not in [-").concat(t.shape.length,", ").concat(t.shape.length,")")});var r={value:t},a={axis:e};return me.runKernel(NP,r,a)}var ame=Ve({unstack_:rme});var ime={kernelName:uP,saveAllInputs:!0,gradFunc:function(n,e,t){var r=t.axis,a=ame(n,r);return a.map(function(i){return function(){return i}})}};var tO={kernelName:cP,inputsToSave:["x"],gradFunc:function(n,e,t){var r=e[0],a=t.paddings,i=a.map(function(o){return o[0]});return{x:function(){return sc(n,i,r.shape)}}}};function ome(n){var e=Ie(n,"x","log","float32"),t={x:e};return me.runKernel(aP,t)}var sme=Ve({log_:ome});function ume(n,e){var t,r=Ie(n,"base","pow"),a=Ie(e,"exp","pow");t=te(va(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return me.runKernel(lP,i)}var Od=Ve({pow_:ume}),cme={kernelName:lP,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(n,e){var t=te(e,3),r=t[0],a=t[1],i=t[2],o=r,s=a,u=lr(o.shape,s.shape),c=function(){var f=St(s,"float32"),h=be(n,be(f,Od(o,tr(f,En(1))))),p=nr(o.shape,u);return p.length>0&&(h=gn(h,p)),Je(h,o.shape)},l=function(){var f=Df(o,0),h=Ms(f,sme(o),At(o)),p=be(n,be(i,h)),d=nr(s.shape,u);return d.length>0&&(p=gn(p,d)),Je(p,s.shape)};return{a:c,b:l}}},lme={kernelName:whe,inputsToSave:["x","alpha"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=Df(r,0);return{x:function(){return Ms(i,n,be(n,a))},alpha:function(){var o=Ms(i,At(n),be(n,r)),s=nr(a.shape,n.shape);return s.length>0&&(o=gn(o,s)),Je(o,a.shape)}}}};function fme(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var pa=Tn();pa.registerFlag("DEBUG",function(){return!1},function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});pa.registerFlag("IS_BROWSER",function(){return fme()});pa.registerFlag("IS_NODE",function(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"});pa.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)});pa.registerFlag("PROD",function(){return!1});pa.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return pa.getBool("DEBUG")});pa.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0});pa.registerFlag("IS_TEST",function(){return!1});pa.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",function(){return!0});pa.registerFlag("WRAP_TO_IMAGEBITMAP",function(){return!1});pa.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",function(){return!1});pa.registerFlag("USE_SETTIMEOUTCUSTOM",function(){return!1});var wb=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function nO(n){return wb?Buffer.byteLength(n):new Blob([n]).size}function hme(n){if(wb)return Buffer.from(n).toString("base64");for(var e=new Uint8Array(n),t="",r=0,a=e.length;r<a;r++)t+=String.fromCharCode(e[r]);return btoa(t)}function pme(n){if(wb){var e=Buffer.from(n,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var t=atob(n),r=new Uint8Array(t.length),a=0;a<t.length;++a)r.set([t.charCodeAt(a)],a);return r.buffer}function dme(n){if(n.length===1)return n[0];var e=0;n.forEach(function(a){e+=a.byteLength});var t=new Uint8Array(e),r=0;return n.forEach(function(a){t.set(new Uint8Array(a),r),r+=a.byteLength}),t.buffer}function ZP(n,e){var t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function vme(n,e,t){var r={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(r.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=e,r.weightData=t}return n.signature!=null&&(r.signature=n.signature),n.userDefinedMetadata!=null&&(r.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(r.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(r.initializerSignature=n.initializerSignature),r}function mme(n,e){return Ce(this,void 0,void 0,function(){var t,r,a;return Ee(this,function(i){switch(i.label){case 0:return n.weightsManifest==null?[3,2]:[4,e(n.weightsManifest)];case 1:a=te.apply(void 0,[i.sent(),2]),t=a[0],r=a[1],i.label=2;case 2:return[2,vme(n,t,r)]}})})}function tv(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:nO(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:nO(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}function gme(n){var e,t,r=[];try{for(var a=fe(n),i=a.next();!i.done;i=a.next()){var o=i.value;r.push.apply(r,Qe([],te(o.weights),!1))}}catch(s){e={error:s}}finally{try{i&&!i.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return r}var qs=function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerSaveRouter=function(e){n.getInstance().saveRouters.push(e)},n.registerLoadRouter=function(e){n.getInstance().loadRouters.push(e)},n.getSaveHandlers=function(e){return n.getHandlers(e,"save")},n.getLoadHandlers=function(e,t){return n.getHandlers(e,"load",t)},n.getHandlers=function(e,t,r){var a=[],i=t==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters;return i.forEach(function(o){var s=o(e,r);s!==null&&a.push(s)}),a},n}(),yme="tensorflowjs",bme=1,bf="models_store",Nd="model_info_store";function wme(){if(!Tn().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function xme(n){var e=n.result;e.createObjectStore(bf,{keyPath:"modelPath"}),e.createObjectStore(Nd,{keyPath:"modelPath"})}var Pd=function(){function n(e){if(this.indexedDB=wme(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return n.prototype.save=function(e){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},n.prototype.load=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},n.prototype.databaseAction=function(e,t){var r=this;return new Promise(function(a,i){var o=r.indexedDB.open(yme,bme);o.onupgradeneeded=function(){return xme(o)},o.onsuccess=function(){var s=o.result;if(t==null){var u=s.transaction(bf,"readonly"),c=u.objectStore(bf),l=c.get(r.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),i(new Error("Cannot find model with path '".concat(r.modelPath,"' ")+"in IndexedDB."));a(l.result.modelArtifacts)},l.onerror=function(m){return s.close(),i(l.error)},u.oncomplete=function(){return s.close()}}else{var f=tv(t),h=s.transaction(Nd,"readwrite"),p=h.objectStore(Nd),d=p.put({modelPath:r.modelPath,modelArtifactsInfo:f}),v;d.onsuccess=function(){v=s.transaction(bf,"readwrite");var m=v.objectStore(bf),g=m.put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:f});g.onsuccess=function(){return a({modelArtifactsInfo:f})},g.onerror=function(y){p=h.objectStore(Nd);var b=p.delete(r.modelPath);b.onsuccess=function(){return s.close(),i(g.error)},b.onerror=function(w){return s.close(),i(g.error)}}},d.onerror=function(m){return s.close(),i(d.error)},h.oncomplete=function(){v==null?s.close():v.oncomplete=function(){return s.close()}}}},o.onerror=function(s){return i(o.error)}})},n}();Pd.URL_SCHEME="indexeddb://";var JP=function(n){return Tn().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Pd.URL_SCHEME)?kme(n.slice(Pd.URL_SCHEME.length)):null};qs.registerSaveRouter(JP);qs.registerLoadRouter(JP);function kme(n){return new Pd(n)}var ff="/",hf="tensorflowjs_models",Sme="info",Nme="model_topology",Tme="weight_specs",Eme="weight_data",Ime="model_metadata";function Cme(n){return{info:[hf,n,Sme].join(ff),topology:[hf,n,Nme].join(ff),weightSpecs:[hf,n,Tme].join(ff),weightData:[hf,n,Eme].join(ff),modelMetadata:[hf,n,Ime].join(ff)}}function Ame(n){var e,t;try{for(var r=fe(Object.values(n)),a=r.next();!a.done;a=r.next()){var i=a.value;window.localStorage.removeItem(i)}}catch(o){e={error:o}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}}var Md=function(){function n(e){if(!Tn().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Cme(this.modelPath)}return n.prototype.save=function(e){return Ce(this,void 0,void 0,function(){var t,r,a,i;return Ee(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),a=tv(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,hme(e.weightData)),i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),[2,{modelArtifactsInfo:a}]}catch{throw Ame(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."))}return[2]})})},n.prototype.load=function(){return Ce(this,void 0,void 0,function(){var e,t,r,a,i,o,s;return Ee(this,function(u){if(e=JSON.parse(this.LS.getItem(this.keys.info)),e==null)throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},r=JSON.parse(this.LS.getItem(this.keys.topology)),r==null)throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");if(t.modelTopology=r,a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)),a==null)throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");if(t.weightSpecs=a,i=this.LS.getItem(this.keys.modelMetadata),i!=null&&(o=JSON.parse(i),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,o.signature!=null&&(t.signature=o.signature),o.userDefinedMetadata!=null&&(t.userDefinedMetadata=o.userDefinedMetadata),o.modelInitializer!=null&&(t.modelInitializer=o.modelInitializer),o.initializerSignature!=null&&(t.initializerSignature=o.initializerSignature),o.trainingConfig!=null&&(t.trainingConfig=o.trainingConfig)),s=this.LS.getItem(this.keys.weightData),s==null)throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));return t.weightData=pme(s),[2,t]})})},n}();Md.URL_SCHEME="localstorage://";var QP=function(n){return Tn().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Md.URL_SCHEME)?_me(n.slice(Md.URL_SCHEME.length)):null};qs.registerSaveRouter(QP);qs.registerLoadRouter(QP);function _me(n){return new Md(n)}var Dme="model",Fme=".json",Rme=".weights.bin";function rO(n){return new Promise(function(e){return setTimeout(e)}).then(n)}var Bd=function(){function n(e){if(!Tn().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),(e==null||e.length===0)&&(e=Dme),this.modelJsonFileName=e+Fme,this.weightDataFileName=e+Rme}return n.prototype.save=function(e){return Ce(this,void 0,void 0,function(){var t,r,a,i,o,s;return Ee(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],a=ZP(e,r),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),o=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor,o.download=this.modelJsonFileName,o.href=i,[4,rO(function(){return o.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),e.weightData==null?[3,4]:(s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor,s.download=this.weightDataFileName,s.href=t,[4,rO(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:tv(e)}]}})})},n}();Bd.URL_SCHEME="downloads://";var Ome=function(n){return Tn().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Bd.URL_SCHEME)?Pme(n.slice(Bd.URL_SCHEME.length)):null};qs.registerSaveRouter(Ome);function Pme(n){return n===void 0&&(n="model"),new Bd(n)}function aO(n,e,t,r){o(n),t=t??0,r=r??1,s(t,r);var a=0,i=function(u){return u.then(function(c){var l=t+ ++a/n.length*(r-t);return e(l),c}),u};function o(u){Se(u!=null&&Array.isArray(u)&&u.length>0,function(){return"promises must be a none empty array"})}function s(u,c){Se(u>=0&&u<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(u)}),Se(c>=0&&c<=1,function(){return"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(c)}),Se(c>=u,function(){return"startFraction must be no more than endFraction, but "+"got startFraction ".concat(u," and endFraction ")+"".concat(c)})}return Promise.all(n.map(i))}function Mme(n,e){return Ce(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f,h;return Ee(this,function(p){switch(p.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?Tn().platform.fetch:e.fetchFunc,r=n.map(function(d){return t(d,e.requestInit,{isBinary:!0})}),a=0,i=.5,e.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return s=p.sent(),[3,4];case 2:return[4,aO(r,e.onProgress,a,i)];case 3:s=p.sent(),p.label=4;case 4:return o=s,u=o.map(function(d){return d.arrayBuffer()}),c=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(u)];case 5:return h=p.sent(),[3,8];case 6:return[4,aO(u,e.onProgress,c,l)];case 7:h=p.sent(),p.label=8;case 8:return f=h,[2,f]}})})}var Bme="application/octet-stream",Lme="application/json",xb=function(){function n(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(Se(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=Tn().platform.fetch,Se(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&Se(e.length===2,function(){return"URL paths for http must have a length of 2, "+"(actual length is ".concat(e.length,").")}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return n.prototype.save=function(e){return Ce(this,void 0,void 0,function(){var t,r,a,i;return Ee(this,function(o){switch(o.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit),t.body=new FormData,r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=ZP(e,r),t.body.append("model.json",new Blob([JSON.stringify(a)],{type:Lme}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:Bme}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if(i=o.sent(),i.ok)return[2,{modelArtifactsInfo:tv(e),responses:[i]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(i.status,"."))}})})},n.prototype.load=function(){return Ce(this,void 0,void 0,function(){var e,t,r,a,i,o=this;return Ee(this,function(s){switch(s.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(e=s.sent(),!e.ok)throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(e.status,". Please verify this URL points to ")+"the model JSON of the model to load.");s.label=2;case 2:return s.trys.push([2,4,,5]),[4,e.json()];case 3:return t=s.sent(),[3,5];case 4:throw s.sent(),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(a=t.modelTopology,i=t.weightsManifest,a==null&&i==null)throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");return[2,mme(t,function(u){return o.loadWeights(u)})]}})})},n.prototype.loadWeights=function(e){return Ce(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f,h,p,d,v,m,g,y,b,w,x,N,T,E;return Ee(this,function(C){switch(C.label){case 0:t=Array.isArray(this.path)?this.path[1]:this.path,r=te(zme(t),2),a=r[0],i=r[1],o=this.weightPathPrefix||a,s=gme(e),u=[],c=[];try{for(l=fe(e),f=l.next();!f.done;f=l.next()){h=f.value;try{for(p=(T=void 0,fe(h.paths)),d=p.next();!d.done;d=p.next())v=d.value,this.weightUrlConverter!=null?c.push(this.weightUrlConverter(v)):u.push(o+v+i)}catch(F){T={error:F}}finally{try{d&&!d.done&&(E=p.return)&&E.call(p)}finally{if(T)throw T.error}}}}catch(F){x={error:F}}finally{try{f&&!f.done&&(N=l.return)&&N.call(l)}finally{if(x)throw x.error}}return this.weightUrlConverter?(g=(m=u.push).apply,y=[u],b=[[]],[4,Promise.all(c)]):[3,2];case 1:g.apply(m,y.concat([Qe.apply(void 0,b.concat([te.apply(void 0,[C.sent()]),!1]))])),C.label=2;case 2:return[4,Mme(u,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 3:return w=C.sent(),[2,[s,dme(w)]]}})})},n}();xb.URL_SCHEME_REGEX=/^https?:\/\//;function zme(n){var e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),r=n.substring(0,e),a=t>e?n.substring(t):"";return[r+"/",a]}function iO(n){return n.match(xb.URL_SCHEME_REGEX)!=null}var eM=function(n,e){if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;var t=!0;return Array.isArray(n)?t=n.every(function(r){return iO(r)}):t=iO(n),t?$me(n,e):null};qs.registerSaveRouter(eM);qs.registerLoadRouter(eM);function $me(n,e){return new xb(n,e)}function qme(n,e,t){var r,a=n.shape.length;typeof e=="number"?r=Qe([e],te(new Array(a-1).fill(0)),!1):e.length<a?r=e.concat(new Array(a-e.length).fill(0)):r=e.slice(),r.forEach(function(o){Se(o!==-1,function(){return"slice() does not support negative begin indexing."})});var i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=Qe([t],te(new Array(a-1).fill(-1)),!1):t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map(function(o,s){return o>=0?o:(Se(o===-1,function(){return"Negative size values should be exactly -1 but got "+"".concat(o," for the slice() size at index ").concat(s,".")}),n.shape[s]-r[s])}),[r,i]}var Wme=function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(e,t){return new e(t)},n}();function Vme(n){var e=Ie(n,"x","abs");if(e.dtype==="complex64"){var t={x:e};return me.runKernel(GO,t)}else{var t={x:e};return me.runKernel(qO,t)}}var Gme=Ve({abs_:Vme});function Ume(n,e){e===void 0&&(e=0),Se(n.length>=1,function(){return"Pass at least one tensor to concat"});var t=WP(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `.concat(i.dtype,". "))}),t.length===1)return KP(t[0]);var r=t,a={axis:e};return me.runKernel(UO,r,a)}var Hme=Ve({concat_:Ume});function Kme(n){var e=Ie(n,"x","sigmoid","float32"),t={x:e};return me.runKernel(yP,t)}var jme=Ve({sigmoid_:Kme});function Xme(n,e,t){var r=Ie(n,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});Se(r.rank>=1+e.length,function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(e.length)}),Se(t.length===e.length,function(){return"crops.length is ".concat(t.length," but should be equal to blockShape.length  ").concat(e.length)}),Se(r.shape[0]%a===0,function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(e.join(" * ")," === ").concat(a)});var i={x:r},o={blockShape:e,crops:t};return me.runKernel(VO,i,o)}var Yme=Ve({batchToSpaceND_:Xme});function Zme(n,e,t){_f(n);var r={shape:n,value:e,dtype:t};return me.runKernel(Hfe,{},r)}function Jme(n){var e=Ie(n,"x","cos","float32"),t={x:e};return me.runKernel(jO,t)}var tM=Ve({cos_:Jme});function Qme(n){var e=Ie(n,"x","cosh","float32"),t={x:e};return me.runKernel(XO,t)}var ege=Ve({cosh_:Qme});function tge(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var a=Ie(n,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:r};return me.runKernel(Ofe,i,o)}var oO=Ve({cumprod_:tge});function nge(n,e){e===void 0&&(e=0);var t=Ie(n,"x","expandDims","string_or_numeric");Se(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var r={input:t},a={dim:e};return me.runKernel(QO,r,a)}var rge=Ve({expandDims_:nge});function age(n,e,t,r){t===void 0&&(t=0),r===void 0&&(r=0);var a=Ie(n,"x","gather"),i=Ie(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:r};return me.runKernel(nP,o,s)}var ige=Ve({gather_:age});function oge(n,e){Se(Fy(n),function(){return"The f passed in variableGrads(f) must be a function"}),Se(e==null||Array.isArray(e)&&e.every(function(f){return f instanceof Fd}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t){e=[];for(var r in me.registeredVariables)e.push(me.registeredVariables[r])}var a=t?e.filter(function(f){return!f.trainable}):null,i=e.length;e=e.filter(function(f){return f.trainable}),Se(e.length>0,function(){return"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(i," variables is ")+"trainable."});var o=!0,s=me.gradients(n,e,null,o),u=s.value,c=s.grads;Se(c.some(function(f){return f!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),Se(u.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(u.rank," tensor")});var l={};return e.forEach(function(f,h){c[h]!=null&&(l[f.name]=c[h])}),a?.forEach(function(f){return l[f.name]=null}),{value:u,grads:l}}function sge(n){var e=Ie(n,"x","logicalNot","bool"),t={x:e};return me.runKernel(ahe,t)}var uge=Ve({logicalNot_:sge});function cge(n,e){var t,r=Ie(n,"a","maximum"),a=Ie(e,"b","maximum");t=te(va(r,a),2),r=t[0],a=t[1],r.dtype==="bool"&&(r=St(r,"int32"),a=St(a,"int32")),lr(r.shape,a.shape);var i={a:r,b:a};return me.runKernel(iP,i)}var nM=Ve({maximum_:cge});function lge(n,e,t){t===void 0&&(t=0);var r=Ie(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:r};return me.runKernel(cP,i,a)}var fge=Ve({pad_:lge}),Ws=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function hge(n){if(n.__esModule)return n;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(n).forEach(function(t){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}),e}function Vs(n){var e={exports:{}};return n(e,e.exports),e.exports}var pge=Vs(function(n){(function(e,t,r){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.alea=o})(Ws,n,!1)}),dge=Vs(function(n){(function(e,t,r){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor128=o})(Ws,n,!1)}),vge=Vs(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorwow=o})(Ws,n,!1)}),mge=Vs(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,p;return h=l[f],h^=h>>>7,p=h^h<<24,h=l[f+1&7],p^=h^h>>>10,h=l[f+3&7],p^=h^h>>>3,h=l[f+4&7],p^=h^h<<7,h=l[f+7&7],h=h^h<<13,p^=h^h<<9,l[f]=p,u.i=f+1&7,p};function c(l,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8&&(p[7]=-1),l.x=p,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorshift7=o})(Ws,n,!1)}),gge=Vs(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,p,d;return u.w=l=l+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(l^l>>>16)|0};function c(l,f){var h,p,d,v,m,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,v=-32;v<y;++v)f&&(p^=f.charCodeAt((v+32)%f.length)),v===0&&(m=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,v>=0&&(m=m+1640531527|0,h=g[v&127]^=p+m,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,v=4*128;v>0;--v)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;l.w=m,l.X=g,l.i=d}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor4096=o})(Ws,n,!1)}),yge=Vs(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.tychei=o})(Ws,n,!1)}),bge={},wge={__proto__:null,default:bge},xge=hge(wge),dc=Vs(function(n){(function(e,t,r){var a=256,i=6,o=52,s="random",u=r.pow(a,i),c=r.pow(2,o),l=c*2,f=a-1,h;function p(w,x,N){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(m(x.entropy?[w,b(t)]:w??y(),3),T),C=new d(T),F=function(){for(var D=C.g(i),O=u,L=0;D<c;)D=(D+L)*a,O*=a,L=C.g(1);for(;D>=l;)D/=2,O/=2,L>>>=1;return(D+L)/O};return F.int32=function(){return C.g(4)|0},F.quick=function(){return C.g(4)/4294967296},F.double=F,g(b(C.S),t),(x.pass||N||function(D,O,L,z){return z&&(z.S&&v(z,C),D.state=function(){return v(C,{})}),L?(r[s]=D,O):D})(F,E,"global"in x?x.global:this==r,x.state)}function d(w){var x,N=w.length,T=this,E=0,C=T.i=T.j=0,F=T.S=[];for(N||(w=[N++]);E<a;)F[E]=E++;for(E=0;E<a;E++)F[E]=F[C=f&C+w[E%N]+(x=F[E])],F[C]=x;(T.g=function(D){for(var O,L=0,z=T.i,$=T.j,B=T.S;D--;)O=B[z=f&z+1],L=L*a+B[f&(B[z]=B[$=f&$+O])+(B[$]=O)];return T.i=z,T.j=$,L})(a)}function v(w,x){return x.i=w.i,x.j=w.j,x.S=w.S.slice(),x}function m(w,x){var N=[],T=typeof w,E;if(x&&T=="object")for(E in w)try{N.push(m(w[E],x-1))}catch{}return N.length?N:T=="string"?w:w+"\0"}function g(w,x){for(var N=w+"",T,E=0;E<N.length;)x[f&E]=f&(T^=x[f&E]*19)+N.charCodeAt(E++);return b(x)}function y(){try{var w;return h&&(w=h.randomBytes)?w=w(a):(w=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var x=e.navigator,N=x&&x.plugins;return[+new Date,e,N,e.screen,b(t)]}}function b(w){return String.fromCharCode.apply(0,w)}if(g(r.random(),t),n.exports){n.exports=p;try{h=xge}catch{}}else r["seed"+s]=p})(typeof self<"u"?self:Ws,[],Math)});dc.alea=pge;dc.xor128=dge;dc.xorwow=vge;dc.xorshift7=mge;dc.xor4096=gge;dc.tychei=yge;function kge(n,e){var t=Ie(n,"x","reverse"),r={x:t},a={dims:e};return me.runKernel(hP,r,a)}var Sge=Ve({reverse_:kge});function Nge(n,e){e===void 0&&(e=0);var t=WP(n,"tensors","stack","string_or_numeric");Se(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&Se(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var r=t,a={axis:e};return me.runKernel(uP,r,a)}var Tge=Ve({stack_:Nge});var sO;(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(sO||(sO={}));var Gs=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.minimize=function(t,r,a){r===void 0&&(r=!1);var i=this.computeGradients(t,a),o=i.value,s=i.grads;if(a!=null){var u=a.map(function(c){return{name:c.name,tensor:s[c.name]}});this.applyGradients(u)}else this.applyGradients(s);return ha(s),r?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!1,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,r){return oge(t,r)},e.prototype.dispose=function(){this.iterations_!=null&&ha(this.iterations_)},e.prototype.saveIterations=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:En(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()))})})},e.prototype.extractIterations=function(t){return Ce(this,void 0,void 0,function(){var r;return Ee(this,function(a){switch(a.label){case 0:return r=this,[4,t[0].tensor.data()];case 1:return r.iterations_=a.sent()[0],[2,t.slice(1)]}})})},e}(Wme);Object.defineProperty(Gs,Symbol.hasInstance,{value:function(n){return n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null}});(function(n){se(e,n);function e(t,r,a){a===void 0&&(a=null);var i=n.call(this)||this;return i.learningRate=t,i.rho=r,i.epsilon=a,i.accumulatedGrads=[],i.accumulatedUpdates=[],a==null&&(i.epsilon=me.backend.epsilon()),i}return Object.defineProperty(e,"className",{get:function(){return"Adadelta"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=me.registeredVariables[i],u=!1;r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:"".concat(i,"/accum_grad"),variable:$n(function(){return At(s).variable(u)})}),r.accumulatedUpdates[o]==null&&(r.accumulatedUpdates[o]={originalName:"".concat(i,"/accum_var"),variable:$n(function(){return At(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=r.accumulatedGrads[o].variable,f=r.accumulatedUpdates[o].variable;$n(function(){var h=xt(be(l,r.rho),be(In(c),1-r.rho)),p=be(Ot(di(xt(f,r.epsilon)),di(xt(l,r.epsilon))),c),d=xt(be(f,r.rho),be(In(p),1-r.rho));l.assign(h),f.assign(d);var v=xt(be(p,-r.learningRate),s);s.assign(v)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(ha(this.accumulatedGrads.map(function(t){return t.variable})),ha(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){var t;return Ee(this,function(r){switch(r.label){case 0:return t=Qe(Qe([],te(this.accumulatedGrads),!1),te(this.accumulatedUpdates),!1),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var r,a;return Ee(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=t.length/2,a=!1,this.accumulatedGrads=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedUpdates=t.slice(r,r*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},e})(Gs);(function(n){se(e,n);function e(t,r){r===void 0&&(r=.1);var a=n.call(this)||this;return a.learningRate=t,a.initialAccumulatorValue=r,a.accumulatedGrads=[],a}return Object.defineProperty(e,"className",{get:function(){return"Adagrad"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=me.registeredVariables[i];if(r.accumulatedGrads[o]==null){var u=!1;r.accumulatedGrads[o]={originalName:"".concat(i,"/accumulator"),variable:$n(function(){return Zme(s.shape,r.initialAccumulatorValue).variable(u)})}}var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=r.accumulatedGrads[o].variable;$n(function(){var f=xt(l,In(c));l.assign(f);var h=xt(be(Ot(c,di(xt(f,me.backend.epsilon()))),-r.learningRate),s);s.assign(h)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&ha(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var r;return Ee(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),r=!1,this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(r)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},e})(Gs);(function(n){se(e,n);function e(t,r,a,i){i===void 0&&(i=null);var o=n.call(this)||this;return o.learningRate=t,o.beta1=r,o.beta2=a,o.epsilon=i,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],$n(function(){o.accBeta1=En(r).variable(),o.accBeta2=En(a).variable()}),i==null&&(o.epsilon=me.backend.epsilon()),o}return Object.defineProperty(e,"className",{get:function(){return"Adam"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);$n(function(){var i=tr(1,r.accBeta1),o=tr(1,r.accBeta2);a.forEach(function(s,u){var c=me.registeredVariables[s],l=!1;r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:$n(function(){return At(c).variable(l)})}),r.accumulatedSecondMoment[u]==null&&(r.accumulatedSecondMoment[u]={originalName:"".concat(s,"/v"),variable:$n(function(){return At(c).variable(l)})});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=r.accumulatedFirstMoment[u].variable,p=r.accumulatedSecondMoment[u].variable,d=xt(be(h,r.beta1),be(f,1-r.beta1)),v=xt(be(p,r.beta2),be(In(f),1-r.beta2)),m=Ot(d,i),g=Ot(v,o);h.assign(d),p.assign(v);var y=xt(be(Ot(m,xt(di(g),r.epsilon)),-r.learningRate),c);c.assign(y)}}),r.accBeta1.assign(be(r.accBeta1,r.beta1)),r.accBeta2.assign(be(r.accBeta2,r.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&ha(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&ha(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){var t;return Ee(this,function(r){switch(r.label){case 0:return t=Qe(Qe([],te(this.accumulatedFirstMoment),!1),te(this.accumulatedSecondMoment),!1),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var r,a,i=this;return Ee(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),$n(function(){i.accBeta1.assign(Od(i.beta1,i.iterations_+1)),i.accBeta2.assign(Od(i.beta2,i.iterations_+1))}),r=t.length/2,a=!1,this.accumulatedFirstMoment=t.slice(0,r).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),this.accumulatedSecondMoment=t.slice(r,r*2).map(function(s){return{originalName:s.name,variable:s.tensor.variable(a)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},e})(Gs);(function(n){se(e,n);function e(t,r,a,i,o){i===void 0&&(i=null),o===void 0&&(o=0);var s=n.call(this)||this;return s.learningRate=t,s.beta1=r,s.beta2=a,s.epsilon=i,s.decay=o,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],$n(function(){s.iteration=En(0).variable(),s.accBeta1=En(r).variable()}),i==null&&(s.epsilon=me.backend.epsilon()),s}return Object.defineProperty(e,"className",{get:function(){return"Adamax"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);$n(function(){var i=tr(1,r.accBeta1),o=Ot(-r.learningRate,xt(be(r.iteration,r.decay),1));a.forEach(function(s,u){var c=me.registeredVariables[s],l=!1;r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:"".concat(s,"/m"),variable:At(c).variable(l)}),r.accumulatedWeightedInfNorm[u]==null&&(r.accumulatedWeightedInfNorm[u]={originalName:"".concat(s,"/v"),variable:At(c).variable(l)});var f=Array.isArray(t)?t[u].tensor:t[s];if(f!=null){var h=r.accumulatedFirstMoment[u].variable,p=r.accumulatedWeightedInfNorm[u].variable,d=xt(be(h,r.beta1),be(f,1-r.beta1)),v=be(p,r.beta2),m=Gme(f),g=nM(v,m);h.assign(d),p.assign(g);var y=xt(be(Ot(o,i),Ot(d,xt(g,r.epsilon))),c);c.assign(y)}}),r.iteration.assign(xt(r.iteration,1)),r.accBeta1.assign(be(r.accBeta1,r.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&ha(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&ha(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e})(Gs);var Ege=function(n){se(e,n);function e(t){var r=n.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return Object.defineProperty(e,"className",{get:function(){return"SGD"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=me.registeredVariables[i];$n(function(){var c=xt(be(r.c,s),u);u.assign(c)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=Ude(En(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:if(t=r.sent(),t.length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,r){return new t(r.learningRate)},e}(Gs);(function(n){se(e,n);function e(t,r,a){a===void 0&&(a=!1);var i=n.call(this,t)||this;return i.learningRate=t,i.momentum=r,i.useNesterov=a,i.accumulations=[],i.m=En(i.momentum),i}return Object.defineProperty(e,"className",{get:function(){return"Momentum"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=me.registeredVariables[i];if(r.accumulations[o]==null){var u=!1;r.accumulations[o]={originalName:"".concat(i,"/momentum"),variable:$n(function(){return At(s).variable(u)})}}var c=r.accumulations[o].variable,l=Array.isArray(t)?t[o].tensor:t[i];l!=null&&$n(function(){var f,h=xt(be(r.m,c),l);r.useNesterov?f=xt(be(r.c,xt(l,be(h,r.m))),s):f=xt(be(r.c,h),s),c.assign(h),s.assign(f)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&ha(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var r;return Ee(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(t)];case 1:return t=a.sent(),r=!1,this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(r)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},e})(Ege);(function(n){se(e,n);function e(t,r,a,i,o){r===void 0&&(r=.9),a===void 0&&(a=0),i===void 0&&(i=null),o===void 0&&(o=!1);var s=n.call(this)||this;if(s.learningRate=t,s.decay=r,s.momentum=a,s.epsilon=i,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=o,i==null&&(s.epsilon=me.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return Object.defineProperty(e,"className",{get:function(){return"RMSProp"},enumerable:!1,configurable:!0}),e.prototype.applyGradients=function(t){var r=this,a=Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t);a.forEach(function(i,o){var s=me.registeredVariables[i],u=!1;r.accumulatedMeanSquares[o]==null&&(r.accumulatedMeanSquares[o]={originalName:"".concat(i,"/rms"),variable:$n(function(){return At(s).variable(u)})}),r.accumulatedMoments[o]==null&&(r.accumulatedMoments[o]={originalName:"".concat(i,"/momentum"),variable:$n(function(){return At(s).variable(u)})}),r.accumulatedMeanGrads[o]==null&&r.centered&&(r.accumulatedMeanGrads[o]={originalName:"".concat(i,"/mg"),variable:$n(function(){return At(s).variable(u)})});var c=Array.isArray(t)?t[o].tensor:t[i];if(c!=null){var l=r.accumulatedMeanSquares[o].variable,f=r.accumulatedMoments[o].variable;$n(function(){var h=xt(be(l,r.decay),be(In(c),1-r.decay));if(r.centered){var p=r.accumulatedMeanGrads[o].variable,d=xt(be(p,r.decay),be(c,1-r.decay)),v=Ot(be(c,r.learningRate),di(tr(h,xt(In(d),r.epsilon)))),m=xt(be(f,r.momentum),v);l.assign(h),p.assign(d),f.assign(m);var g=tr(s,m);s.assign(g)}else{var y=xt(be(l,r.decay),be(In(c),1-r.decay)),m=xt(be(f,r.momentum),Ot(be(c,r.learningRate),di(xt(y,r.epsilon))));l.assign(y),f.assign(m);var g=tr(s,m);s.assign(g)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&ha(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&ha(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&ha(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Ce(this,void 0,void 0,function(){var t;return Ee(this,function(r){switch(r.label){case 0:return t=Qe(Qe([],te(this.accumulatedMeanSquares),!1),te(this.accumulatedMoments),!1),this.centered&&t.push.apply(t,Qe([],te(this.accumulatedMeanGrads),!1)),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},e.prototype.setWeights=function(t){return Ce(this,void 0,void 0,function(){var r,a;return Ee(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=this.centered?t.length/3:t.length/2,a=!1,this.accumulatedMeanSquares=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.accumulatedMoments=t.slice(r,r*2).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(r*2,r*3).map(function(o){return{originalName:o.name,variable:o.tensor.variable(a)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e})(Gs);(function(){return typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:function(n){return n()}})();var uO;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(uO||(uO={}));var Ige=1.7580993408473768,Cge=1.0507009873554805;function Age(n,e,t){var r=n.shape.slice();r[t]=1;var a=Je(e,r),i=oO(n,t,!0,!1),o=oO(n,t,!0,!0),s=be(i,o);return be(a,s)}function _ge(n,e,t){var r=n.shape.length,a=r-t.length,i=XP(t,r),o=n;i!=null&&(o=fc(n,i));var s=o.shape.slice(),u=s.splice(r-t.length,t.length),c=u.reduce(function(p,d){return p*d},1);s.push(c);var l=o.reshape(s),f=Age(l,e,a);if(f=f.reshape(o.shape),i!=null){var h=yb(i);f=fc(f,h)}return f}var Dge={kernelName:xhe,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.axis,o=[];return i==null?o=a.shape.map(function(s,u){return u}):typeof i=="number"?o=[i]:o=i,{x:function(){return _ge(a,n,o)}}}},Fge={kernelName:ZO,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=lr(r.shape,a.shape),o=function(){var u=Ot(n,St(a,"float32")),c=nr(r.shape,i);return c.length>0?Je(gn(u,c),r.shape):u},s=function(){var u=be(n,St(r,"float32")),c=nr(a.shape,i);c.length>0&&(u=Je(gn(u,c),a.shape));var l=In(a);return La(Ot(u,St(l,"float32")))};return{a:o,b:s}}},Rge={kernelName:She,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Ot(n,La(In(r)))}}}},Oge={kernelName:Ahe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0],a=be(gb(r,6),vb(r));return{x:function(){return be(n,St(a,"float32"))}}}},Pge={kernelName:Nhe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(n,St(vb(r),"float32"))}}}},Mge={kernelName:fP,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Je(n,r.shape)}}}},Bge={kernelName:Ihe,inputsToSave:["images"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i={dy:n,images:a},o=function(){return me.runKernel(Che,i,t)};return{images:o}}},Lge={kernelName:The,inputsToSave:["images"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i={dy:n,images:a},o=function(){return me.runKernel(Ehe,i,t)};return{images:o}}};var zge={kernelName:hP,gradFunc:function(n,e,t){var r=t.dims,a=Ls(r,n.shape);return{x:function(){return Sge(n,a)}}}};var $ge={kernelName:_he,gradFunc:function(n){return{x:function(){return At(n)}}}},qge={kernelName:pP,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return La(Ot(n,be(Od(r,1.5),2)))}}}},Wge={kernelName:dP,inputsToSave:["condition"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{condition:function(){return St(At(r),"float32")},t:function(){return be(n,St(r,n.dtype))},e:function(){return be(n,St(uge(r),n.dtype))}}}},Vge={kernelName:Dhe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){var a=Df(r,En(0)),i=En(Ige),o=En(Cge),s=be(n,o),u=be(be(n,i),Qd(St(r,"float32")));return Ms(a,s,u)}}}},Gge={kernelName:yP,outputsToSave:[!0],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(n,be(r,tr(En(1),r)))}}}};var Uge={kernelName:Fhe,gradFunc:function(n){return{x:function(){return At(n)}}}},Hge={kernelName:mP,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(tM(St(r,"float32")),n)}}}},Kge={kernelName:gP,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(ege(St(r,"float32")),n)}}}},jge={kernelName:vP,inputsToSave:["x"],gradFunc:function(n,e,t){for(var r=te(e,1),a=r[0],i=t.begin,o=t.size,s=a.shape,u=te(qme(a,i,o),2),c=u[0],l=u[1],f=[],h=0;h<n.rank;h++)f.push([c[h],s[h]-c[h]-l[h]]);return{x:function(){return fge(n,f)}}}},Xge={kernelName:Ohe,outputsToSave:[!0],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.dim,o=!0,s=be(n,a);return{logits:function(){return tr(s,be(gn(s,[i],o),a))}}}},Yge={kernelName:Rhe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(n,jme(r))}}}};var cO={kernelName:xP,gradFunc:function(n,e,t){var r=t.blockShape,a=t.paddings;return{x:function(){return Yme(n,r,a)}}}};var lO={kernelName:kP,gradFunc:function(n,e,t){var r=t.axis;return{x:function(){return Hme(n,r)}}}},Zge={kernelName:bP,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Ot(n,be(di(St(r,"float32")),2))}}}},Jge={kernelName:Mhe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(n,be(St(r,"float32"),2))}}}},Qge={kernelName:Phe,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=En(2),o=function(){return be(n,be(i,tr(r,a)))},s=function(){return be(n,be(i,tr(a,r)))};return{a:o,b:s}}};var e0e={kernelName:IP,gradFunc:function(n){return{x:function(){return At(n)}}}},t0e={kernelName:SP,inputsToSave:["a","b"],gradFunc:function(n,e){var t=te(e,2),r=t[0],a=t[1],i=lr(r.shape,a.shape),o=function(){var u=n,c=nr(r.shape,i);return c.length>0&&(u=gn(u,c)),Je(u,r.shape)},s=function(){var u=n,c=nr(a.shape,i);return c.length>0&&(u=gn(u,c)),Je(La(u),a.shape)};return{a:o,b:s}}},n0e={kernelName:wP,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=a.shape.slice(),o=t.axis,s=Ls(o,a.shape);s.forEach(function(l){i[l]=1});var u=Je(n,i),c=be(u,ev(a.shape,"float32"));return{x:function(){return c}}}},r0e={kernelName:Bhe,inputsToSave:["x"],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return Ot(n,In(tM(r)))}}}},a0e={kernelName:Lhe,outputsToSave:[!0],gradFunc:function(n,e){var t=te(e,1),r=t[0];return{x:function(){return be(tr(En(1),In(r)),n)}}}},i0e={kernelName:ab,inputsToSave:["x"],gradFunc:function(n,e,t){var r=te(e,1),a=r[0],i=t.reps,o=function(){var s=At(a);if(a.rank===1)for(var u=0;u<i[0];++u)s=xt(s,sc(n,[u*a.shape[0]],[a.shape[0]]));else if(a.rank===2)for(var u=0;u<i[0];++u)for(var c=0;c<i[1];++c)s=xt(s,sc(n,[u*a.shape[0],c*a.shape[1]],[a.shape[0],a.shape[1]]));else if(a.rank===3)for(var u=0;u<i[0];++u)for(var c=0;c<i[1];++c)for(var l=0;l<i[2];++l)s=xt(s,sc(n,[u*a.shape[0],c*a.shape[1],l*a.shape[2]],[a.shape[0],a.shape[1],a.shape[2]]));else if(a.rank===4)for(var u=0;u<i[0];++u)for(var c=0;c<i[1];++c)for(var l=0;l<i[2];++l)for(var f=0;f<i[3];++f)s=xt(s,sc(n,[u*a.shape[0],c*a.shape[1],l*a.shape[2],f*a.shape[3]],[a.shape[0],a.shape[1],a.shape[2],a.shape[3]]));else throw new Error("Gradient for tile operation is not implemented for rank-"+"".concat(a.rank," tensors yet."));return s};return{x:o}}};var o0e={kernelName:xd,gradFunc:function(n,e,t){var r=t,a=r.perm,i=yb(a);return{x:function(){return fc(n,i)}}}};var s0e={kernelName:NP,gradFunc:function(n,e,t){var r=t,a=r.axis;return{value:function(){return Tge(n,a)}}}},u0e={kernelName:TP,inputsToSave:["segmentIds"],gradFunc:function(n,e){var t=te(e,1),r=t[0],a=function(){return c0e(n,r)};return{x:a}}};function c0e(n,e){for(var t=nM(e,At(e)),r=ige(n,t),a=mb(e,En(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=rge(a,o+1);a=HP(a,ev(r.shape,"bool"));var s=At(r);return Ms(a,r,s)}var l0e={kernelName:EP,gradFunc:function(n){return{x:function(){return At(n)}}}},wy,fO,f0e=[VP,Mpe,Bpe,$pe,qpe,Vpe,Gpe,Upe,Kpe,jpe,Xpe,Ype,Qpe,nde,ade,sde,ude,cde,lde,gde,yde,xde,Cde,Tde,Rde,Mde,zde,Jde,rve,ave,Fge,ive,sve,uve,cve,lve,hve,fve,gve,wve,xve,kve,Sve,Nve,Tve,Ive,Cve,Ave,_ve,Rve,eO,eO,Lve,qve,Gve,Uve,Hve,Kve,Xve,Jve,Qve,eme,tme,nme,ime,tO,tO,cme,lme,Dge,Rge,Oge,Pge,Mge,Bge,Lge,zge,$ge,qge,Wge,Vge,Gge,Uge,Hge,Kge,jge,Xge,Yge,cO,cO,lO,lO,Zge,Qge,Jge,e0e,t0e,n0e,r0e,a0e,i0e,o0e,s0e,u0e,l0e];try{for(pf=fe(f0e),rc=pf.next();!rc.done;rc=pf.next())hO=rc.value,tpe(hO)}catch(n){wy={error:n}}finally{try{rc&&!rc.done&&(fO=pf.return)&&fO.call(pf)}finally{if(wy)throw wy.error}}var hO,pf,rc;function kb(n,e){return R.tidy(function(){return _.sqrt(_.sum(_.mul(n,n),e,!0))})}var Ff=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getConfig=function(){return{}},e}(R.serialization.Serializable),Sb=function(n){se(e,n);function e(t){var r=n.call(this)||this;return r.defaultMaxValue=2,r.defaultAxis=0,r.maxValue=t.maxValue!=null?t.maxValue:r.defaultMaxValue,r.axis=t.axis!=null?t.axis:r.defaultAxis,r}return e.prototype.apply=function(t){var r=this;return R.tidy(function(){var a=kb(t,r.axis),i=_.clipByValue(a,0,r.maxValue);return _.mul(t,_.div(i,_.add(qn(),a)))})},e.prototype.getConfig=function(){return{maxValue:this.maxValue,axis:this.axis}},e}(Ff);Sb.className="MaxNorm";R.serialization.registerClass(Sb);var Nb=function(n){se(e,n);function e(t){var r=n.call(this)||this;return r.defaultAxis=0,r.axis=t.axis!=null?t.axis:r.defaultAxis,r}return e.prototype.apply=function(t){var r=this;return R.tidy(function(){return _.div(t,_.add(qn(),kb(t,r.axis)))})},e.prototype.getConfig=function(){return{axis:this.axis}},e}(Ff);Nb.className="UnitNorm";R.serialization.registerClass(Nb);var Tb=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return _.relu(t)},e}(Ff);Tb.className="NonNeg";R.serialization.registerClass(Tb);var Eb=function(n){se(e,n);function e(t){var r=n.call(this)||this;return r.defaultMinValue=0,r.defaultMaxValue=1,r.defaultRate=1,r.defaultAxis=0,r.minValue=t.minValue!=null?t.minValue:r.defaultMinValue,r.maxValue=t.maxValue!=null?t.maxValue:r.defaultMaxValue,r.rate=t.rate!=null?t.rate:r.defaultRate,r.axis=t.axis!=null?t.axis:r.defaultAxis,r}return e.prototype.apply=function(t){var r=this;return R.tidy(function(){var a=kb(t,r.axis),i=_.add(_.mul(r.rate,_.clipByValue(a,r.minValue,r.maxValue)),_.mul(1-r.rate,a));return _.mul(t,_.div(i,_.add(qn(),a)))})},e.prototype.getConfig=function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}},e}(Ff);Eb.className="MinMaxNorm";R.serialization.registerClass(Eb);var pO={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Wn(n){return Gy(n)}function dO(n,e){return e===void 0&&(e={}),Ef(n,R.serialization.SerializationMap.getMap().classNameMap,e,"constraint")}function Vn(n){if(n==null)return null;if(typeof n=="string"){var e=n in pO?pO[n]:n,t={className:e,config:{}};return dO(t)}else return n instanceof Ff?n:dO(n)}function h0e(n){return new Sb(n)}function p0e(n){return new Nb(n)}function d0e(){return new Tb}function v0e(n){return new Eb(n)}var m0e={__proto__:null,maxNorm:h0e,unitNorm:p0e,nonNeg:d0e,minMaxNorm:v0e};function g0e(){return new Ky}function y0e(){return new Ud}function b0e(n){return new jy(n)}function w0e(n){return new Xy(n)}function x0e(n){return new Yy(n)}function k0e(n){return new Zy(n)}function S0e(n){return new Jy(n)}function N0e(n){return new Cr(n)}function T0e(n){return new Hd(n)}function E0e(n){return new Kd(n)}function I0e(n){return new jd(n)}function C0e(n){return new Xd(n)}function A0e(n){return new Yd(n)}function _0e(n){return new Zd(n)}function D0e(n){return new Qy(n)}var F0e={__proto__:null,zeros:g0e,ones:y0e,constant:b0e,randomUniform:w0e,randomNormal:x0e,truncatedNormal:k0e,identity:S0e,varianceScaling:N0e,glorotUniform:T0e,glorotNormal:E0e,heNormal:I0e,heUniform:C0e,leCunNormal:A0e,leCunUniform:_0e,orthogonal:D0e};function Mo(n){return Ce(this,void 0,void 0,function(){var e,t,r,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:if(n==null)return[2];e=[],t=[],r=[];for(a in n)i=n[a],typeof i!="number"&&(o=i,e.push(o.data()),t.push(a),r.push(o));return e.length>0?[4,Promise.all(e)]:[3,2];case 1:for(s=c.sent(),u=0;u<s.length;++u)n[t[u]]=s[u][0];R.dispose(r),c.label=2;case 2:return[2]}})})}function rM(n){if(n!=null)for(var e in n){var t=n[e];typeof t!="number"&&t.dispose()}}var vO;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(vO||(vO={}));var R0e=125,hc=function(){function n(){this.validationData=null}return n.prototype.setParams=function(e){this.params=e},n.prototype.onEpochBegin=function(e,t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){return[2]})})},n.prototype.onEpochEnd=function(e,t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){return[2]})})},n.prototype.onBatchBegin=function(e,t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){return[2]})})},n.prototype.onBatchEnd=function(e,t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){return[2]})})},n.prototype.onTrainBegin=function(e){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){return[2]})})},n.prototype.onTrainEnd=function(e){return Ce(this,void 0,void 0,function(){return Ee(this,function(t){return[2]})})},n.prototype.setModel=function(e){},n}(),aM=function(){function n(e,t){t===void 0&&(t=10),e==null&&(e=[]),this.callbacks=e,this.queueLength=t}return n.prototype.append=function(e){this.callbacks.push(e)},n.prototype.setParams=function(e){var t,r;try{for(var a=fe(this.callbacks),i=a.next();!i.done;i=a.next()){var o=i.value;o.setParams(e)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}},n.prototype.setModel=function(e){var t,r;try{for(var a=fe(this.callbacks),i=a.next();!i.done;i=a.next()){var o=i.value;o.setModel(e)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}},n.prototype.onEpochBegin=function(e,t){return Ce(this,void 0,void 0,function(){var r,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),r=fe(this.callbacks),a=r.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onEpochBegin(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=r.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=r.return)&&u.call(r)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},n.prototype.onEpochEnd=function(e,t){return Ce(this,void 0,void 0,function(){var r,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),r=fe(this.callbacks),a=r.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onEpochEnd(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=r.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=r.return)&&u.call(r)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},n.prototype.onBatchBegin=function(e,t){return Ce(this,void 0,void 0,function(){var r,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),r=fe(this.callbacks),a=r.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onBatchBegin(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=r.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=r.return)&&u.call(r)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},n.prototype.onBatchEnd=function(e,t){return Ce(this,void 0,void 0,function(){var r,a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:t==null&&(t={}),c.label=1;case 1:c.trys.push([1,6,7,8]),r=fe(this.callbacks),a=r.next(),c.label=2;case 2:return a.done?[3,5]:(i=a.value,[4,i.onBatchEnd(e,t)]);case 3:c.sent(),c.label=4;case 4:return a=r.next(),[3,2];case 5:return[3,8];case 6:return o=c.sent(),s={error:o},[3,8];case 7:try{a&&!a.done&&(u=r.return)&&u.call(r)}finally{if(s)throw s.error}return[7];case 8:return[2]}})})},n.prototype.onTrainBegin=function(e){return Ce(this,void 0,void 0,function(){var t,r,a,i,o,s;return Ee(this,function(u){switch(u.label){case 0:e==null&&(e={}),u.label=1;case 1:u.trys.push([1,6,7,8]),t=fe(this.callbacks),r=t.next(),u.label=2;case 2:return r.done?[3,5]:(a=r.value,[4,a.onTrainBegin(e)]);case 3:u.sent(),u.label=4;case 4:return r=t.next(),[3,2];case 5:return[3,8];case 6:return i=u.sent(),o={error:i},[3,8];case 7:try{r&&!r.done&&(s=t.return)&&s.call(t)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},n.prototype.onTrainEnd=function(e){return Ce(this,void 0,void 0,function(){var t,r,a,i,o,s;return Ee(this,function(u){switch(u.label){case 0:e==null&&(e={}),u.label=1;case 1:u.trys.push([1,6,7,8]),t=fe(this.callbacks),r=t.next(),u.label=2;case 2:return r.done?[3,5]:(a=r.value,[4,a.onTrainEnd(e)]);case 3:u.sent(),u.label=4;case 4:return r=t.next(),[3,2];case 5:return[3,8];case 6:return i=u.sent(),o={error:i},[3,8];case 7:try{r&&!r.done&&(s=t.return)&&s.call(t)}finally{if(o)throw o.error}return[7];case 8:return[2]}})})},n}(),O0e=function(n){se(e,n);function e(){return n.call(this)||this}return e.prototype.onEpochBegin=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){return this.seen=0,this.totals={},[2]})})},e.prototype.onBatchEnd=function(t,r){return Ce(this,void 0,void 0,function(){var a,i,o,s,u=this;return Ee(this,function(c){r==null&&(r={}),a=r.size==null?0:r.size,this.seen+=a,i=function(l){var f=r[l];if(typeof f=="number")o.totals.hasOwnProperty(l)||(o.totals[l]=0),o.totals[l]=o.totals[l]+f*a;else{var h=void 0;l in o.totals?h=o.totals[l]:o.totals[l]=0;var p=R.tidy(function(){return R.add(u.totals[l],R.mul(f,a))});o.totals[l]=p,h?.dispose()}},o=this;for(s in r)i(s);return[2]})})},e.prototype.onEpochEnd=function(t,r){return Ce(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f=this;return Ee(this,function(h){if(r!=null){a=function(p){if(i.totals[p]==null)return"continue";typeof i.totals[p]=="number"?r[p]=i.totals[p]/i.seen:R.tidy(function(){var d=R.mul(R.div(1,f.seen),f.totals[p]);r[p]=d,f.totals[p].dispose(),R.keep(r[p])})},i=this;try{for(o=fe(this.params.metrics),s=o.next();!s.done;s=o.next())u=s.value,a(u)}catch(p){c={error:p}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}}return[2]})})},e}(hc),iM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.onTrainBegin=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){return this.epoch=[],this.history={},[2]})})},e.prototype.onEpochEnd=function(t,r){return Ce(this,void 0,void 0,function(){var a;return Ee(this,function(i){r==null&&(r={}),this.epoch.push(t);for(a in r)this.history[a]==null&&(this.history[a]=[]),this.history[a].push(r[a]);return[2]})})},e.prototype.syncData=function(){return Ce(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f;return Ee(this,function(h){switch(h.label){case 0:t=[],r=[],a=[];for(i in this.history)for(o=this.history[i],s=0;s<o.length;++s)typeof o[s]!="number"&&(u=o[s],t.push(u.data()),r.push(i),a.push(s));return[4,Promise.all(t)];case 1:for(c=h.sent(),l=0;l<c.length;++l)f=this.history[r[l]][a[l]],f.dispose(),this.history[r[l]][a[l]]=c[l][0];return[2]}})})},e}(hc),oM=function(n){se(e,n);function e(t,r){var a=n.call(this)||this;if(a.currentEpoch=0,a.nowFunc=t.nowFunc,a.nextFrameFunc=t.nextFrameFunc||R.nextFrame,a.yieldEvery=r||"auto",a.yieldEvery==="auto"&&(a.yieldEvery=R0e),a.yieldEvery==="never"&&t.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return R.util.isNumber(a.yieldEvery)&&(a.maybeWait=Rle(a.maybeWait.bind(a),a.yieldEvery,a.nowFunc)),a.trainBegin=t.onTrainBegin,a.trainEnd=t.onTrainEnd,a.epochBegin=t.onEpochBegin,a.epochEnd=t.onEpochEnd,a.batchBegin=t.onBatchBegin,a.batchEnd=t.onBatchEnd,a.yield=t.onYield,a}return e.prototype.maybeWait=function(t,r,a){return Ce(this,void 0,void 0,function(){var i;return Ee(this,function(o){switch(o.label){case 0:return i=[],this.yield==null?[3,2]:[4,Mo(a)];case 1:o.sent(),i.push(this.yield(t,r,a)),o.label=2;case 2:return i.push(this.nextFrameFunc()),[4,Promise.all(i)];case 3:return o.sent(),[2]}})})},e.prototype.onEpochBegin=function(t,r){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){switch(a.label){case 0:return this.currentEpoch=t,this.epochBegin==null?[3,3]:[4,Mo(r)];case 1:return a.sent(),[4,this.epochBegin(t,r)];case 2:a.sent(),a.label=3;case 3:return[2]}})})},e.prototype.onEpochEnd=function(t,r){return Ce(this,void 0,void 0,function(){var a;return Ee(this,function(i){switch(i.label){case 0:return a=[],this.epochEnd==null?[3,2]:[4,Mo(r)];case 1:i.sent(),a.push(this.epochEnd(t,r)),i.label=2;case 2:return this.yieldEvery==="epoch"&&a.push(this.nextFrameFunc()),[4,Promise.all(a)];case 3:return i.sent(),[2]}})})},e.prototype.onBatchBegin=function(t,r){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){switch(a.label){case 0:return this.batchBegin==null?[3,3]:[4,Mo(r)];case 1:return a.sent(),[4,this.batchBegin(t,r)];case 2:a.sent(),a.label=3;case 3:return[2]}})})},e.prototype.onBatchEnd=function(t,r){return Ce(this,void 0,void 0,function(){var a;return Ee(this,function(i){switch(i.label){case 0:return a=[],this.batchEnd==null?[3,2]:[4,Mo(r)];case 1:i.sent(),a.push(this.batchEnd(t,r)),i.label=2;case 2:return this.yieldEvery==="batch"?a.push(this.nextFrameFunc()):R.util.isNumber(this.yieldEvery)&&a.push(this.maybeWait(this.currentEpoch,t,r)),[4,Promise.all(a)];case 3:return i.sent(),[2]}})})},e.prototype.onTrainBegin=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){switch(r.label){case 0:return this.trainBegin==null?[3,3]:[4,Mo(t)];case 1:return r.sent(),[4,this.trainBegin(t)];case 2:r.sent(),r.label=3;case 3:return[2]}})})},e.prototype.onTrainEnd=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){switch(r.label){case 0:return this.trainEnd==null?[3,3]:[4,Mo(t)];case 1:return r.sent(),[4,this.trainEnd(t)];case 2:r.sent(),r.label=3;case 3:return[2]}})})},e}(hc);function sM(n,e){if(n==null&&(n={}),n instanceof hc)return[n];if(Array.isArray(n)&&n[0]instanceof hc)return n;var t=Yt(n);return t.map(function(r){return new oM(r,e)})}var Ib=function(){function n(){}return n.registerCallbackConstructor=function(e,t){R.util.assert(e>=0&&Number.isInteger(e),function(){return"Verbosity level is expected to be an integer >= 0, "+"but got ".concat(e)}),n.checkForDuplicate(t),n.constructors[e]==null&&(n.constructors[e]=[]),n.constructors[e].push(t)},n.checkForDuplicate=function(e){for(var t in n.constructors){var r=n.constructors[+t];r.forEach(function(a){if(a===e)throw new Z("Duplicate callback constructor.")})}},n.clear=function(){n.constructors={}},n.createCallbacks=function(e){var t=[];for(var r in n.constructors){var a=+r;e>=a&&t.push.apply(t,Qe([],te(n.constructors[a]),!1))}return t.map(function(i){return new i})},n}();Ib.constructors={};function uM(n,e,t,r,a,i,o,s,u){var c=new iM,l=Qe([new O0e],te(Ib.createCallbacks(e)),!1);n!=null&&l.push.apply(l,Qe([],te(n),!1)),l.push(c);var f=new aM(l);return f.setParams({epochs:t,initialEpoch:r,samples:a,steps:i,batchSize:o,verbose:e,doValidation:s,metrics:u}),{callbackList:f,history:c}}function ci(n,e,t){return e===void 0&&(e={}),t===void 0&&(t=!1),Ef(n,R.serialization.SerializationMap.getMap().classNameMap,e,"layer",t)}function Ld(n,e){return R.tidy(function(){n.dtype!=="float32"&&(n=_.cast(n,"float32"));var t=_.sum(Cf(n),e,!0),r=_.fill(t.shape,qn()),a=_.sqrt(_.maximum(t,r));return _.div(n,a)})}function Us(n,e){return R.tidy(function(){return _.mean(Cf(_.sub(e,n)),-1)})}function nv(n,e){return R.tidy(function(){return _.mean(_.abs(_.sub(e,n)),-1)})}function vc(n,e){return R.tidy(function(){var t=_.sub(n,e),r=_.clipByValue(_.abs(n),qn(),Number.MAX_VALUE),a=_.abs(_.div(t,r));return _.mul(100,_.mean(a,-1))})}function P0e(n,e){return R.tidy(function(){var t=_.clipByValue(e,qn(),Number.MAX_VALUE),r=_.log(_.add(1,t)),a=_.clipByValue(n,qn(),Number.MAX_VALUE),i=_.log(_.add(1,a));return _.mean(Cf(_.sub(r,i)),-1)})}function M0e(n,e){return R.tidy(function(){var t=_.maximum(0,_.sub(1,_.mul(n,e)));return _.mean(Cf(t),-1)})}function B0e(n,e){return R.tidy(function(){var t=_.maximum(0,_.sub(1,_.mul(n,e)));return _.mean(t,-1)})}function L0e(n,e){return R.tidy(function(){var t=_.sum(_.mul(n,e),-1),r=_.max(_.mul(_.sub(1,n),e),-1);return _.maximum(0,_.add(1,_.sub(r,t)))})}function z0e(n,e){return R.tidy(function(){var t=Math.log(2),r=_.sub(e,n),a=_.sub(_.add(r,_.softplus(_.mul(-2,r))),t);return _.mean(a,-1)})}function Sf(n,e,t){return t===void 0&&(t=!1),R.tidy(function(){if(t)e=_.softmax(e);else{var r=_.sum(e,e.shape.length-1,!0);e=_.div(e,r)}return e=_.clipByValue(e,qn(),1-qn()),_.neg(_.sum(_.mul(_.cast(n,"float32"),_.log(e)),e.shape.length-1))})}function zd(n,e,t){return t===void 0&&(t=!1),R.tidy(function(){var r=_.cast(_.floor(Ule(n)),"int32");e=_.clipByValue(e,qn(),1-qn());var a=e.shape,i=_.reshape(_.oneHot(r,a[a.length-1]),a);return Sf(i,e,t)})}function $0e(n,e){if(!R.util.arraysEqual(n.shape,e.shape))throw new Z("logits and labels must have the same shape, but got shapes "+"".concat(JSON.stringify(n.shape)," and ").concat(JSON.stringify(e.shape)));return R.tidy(function(){var t=_.relu(e),r=_.neg(_.abs(e));return _.add(_.sub(t,_.mul(e,n)),_.log1p(_.exp(r)))})}function rv(n,e){return R.tidy(function(){var t;return t=_.clipByValue(e,qn(),1-qn()),t=_.log(_.div(t,_.sub(1,t))),_.mean($0e(n,t),-1)})}function q0e(n,e){return R.tidy(function(){var t=_.clipByValue(n,qn(),1),r=_.clipByValue(e,qn(),1);return _.sum(_.mul(n,_.log(_.div(t,r))),-1)})}function W0e(n,e){return R.tidy(function(){var t=_.log(_.add(qn(),e));return _.mean(_.sub(e,_.mul(n,t)),-1)})}function Cb(n,e){return R.tidy(function(){var t=Ld(n,-1),r=Ld(e,-1),a=_.mul(t,r);return _.neg(_.sum(a,-1))})}var $d={meanSquaredError:Us,meanAbsoluteError:nv,meanAbsolutePercentageError:vc,meanSquaredLogarithmicError:P0e,squaredHinge:M0e,hinge:B0e,categoricalHinge:L0e,logcosh:z0e,categoricalCrossentropy:Sf,sparseCategoricalCrossentropy:zd,binaryCrossentropy:rv,kullbackLeiblerDivergence:q0e,poisson:W0e,cosineProximity:Cb};function xy(n){if(typeof n=="string"){if(n in $d)return $d[n];var e="Unknown loss ".concat(n);throw n.toLowerCase().includes("softmaxcrossentropy")&&(e="Unknown loss ".concat(n,". ")+'Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new Z(e)}else return n}function Ab(n,e){return R.tidy(function(){var t=_.mul(.5,_.onesLike(e)),r=Ri(_.greater(e,t),n.dtype);return _.mean(_.equal(n,r),-1)})}function _b(n,e){return R.tidy(function(){return Ri(_.equal(_.argMax(n,-1),_.argMax(e,-1)),"float32")})}function cM(n,e){return R.tidy(function(){return _.cast(_.sum(_.logicalAnd(_.equal(n,1),_.equal(e,1))),"float32")})}function V0e(n,e){return R.tidy(function(){return _.cast(_.sum(_.logicalAnd(_.equal(n,1),_.equal(e,0))),"float32")})}function G0e(n,e){return R.tidy(function(){return _.cast(_.sum(_.logicalAnd(_.equal(n,0),_.equal(e,1))),"float32")})}function lM(n,e){return R.tidy(function(){var t=cM(n,e),r=G0e(n,e),a=_.add(t,r);return _.cast(_.where(_.greater(a,0),_.div(t,a),0),"float32")})}function U0e(n,e){return R.tidy(function(){var t=cM(n,e),r=V0e(n,e),a=_.add(t,r);return _.cast(_.where(_.greater(a,0),_.div(t,a),0),"float32")})}function fM(n,e){return rv(n,e)}function hM(n,e){return n.rank===e.rank&&(n=_.squeeze(n,[n.rank-1])),e=_.argMax(e,-1),e.dtype!==n.dtype&&(e=_.cast(e,n.dtype)),_.cast(_.equal(n,e),"float32")}var H0e=Us,K0e=Us,j0e=nv,X0e=nv,Y0e=vc,Z0e=vc,Db=Sf,J0e=Cb,pM=zd,qd={binaryAccuracy:Ab,categoricalAccuracy:_b,precision:lM,categoricalCrossentropy:Db,sparseCategoricalCrossentropy:pM,mse:H0e,MSE:K0e,mae:j0e,MAE:X0e,mape:Y0e,MAPE:Z0e,cosine:J0e};function Q0e(n){if(typeof n=="string"&&n in qd)return qd[n];if(typeof n!="string"&&n!=null)return n;throw new Z("Unknown metric ".concat(n))}function bd(n){var e,t,r,a;if(_i(n!==null,"Unknown LossOrMetricFn ".concat(n)),typeof n=="string")return n;var i=void 0;try{for(var o=fe(Object.keys($d)),s=o.next();!s.done;s=o.next()){var u=s.value;if($d[u]===n){i=u;break}}}catch(f){e={error:f}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}if(i!==void 0)return i;try{for(var c=fe(Object.keys(qd)),l=c.next();!l.done;l=c.next()){var u=l.value;if(qd[u]===n){i=u;break}}}catch(f){r={error:f}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(r)throw r.error}}return i!==void 0?i:n.name}function eye(n){var e={Adagrad:function(){return R.train.adagrad(.01)},Adadelta:function(){return R.train.adadelta(1,.95,qn())},Adam:function(){return R.train.adam(.001,.9,.999,qn())},Adamax:function(){return R.train.adamax(.002,.9,.999,qn(),0)},RMSProp:function(){return R.train.rmsprop(.001,.9,0,qn())},SGD:function(){return R.train.sgd(.01)}};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new Z("Unknown Optimizer ".concat(n))}var mO=1*1024*1024;function gO(n,e,t){if(t===void 0&&(t=!1),n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!$y(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){var r=JSON.stringify(n);r.length>mO&&console.warn('User-defined metadata of model "'.concat(e,'" is too large in ')+"size (length=".concat(r.length," when serialized). It is not ")+"recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+"".concat(mO,"."))}}function $y(n){var e,t,r,a;if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){var i=Object.keys(n);try{for(var o=fe(i),s=o.next();!s.done;s=o.next()){var u=s.value;if(typeof u!="string"||!$y(n[u]))return!1}}catch(p){e={error:p}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}return!0}else if(Array.isArray(n)){try{for(var c=fe(n),l=c.next();!l.done;l=c.next()){var f=l.value;if(!$y(f))return!1}}catch(p){r={error:p}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(r)throw r.error}}return!0}else return!1;else{var h=typeof n;return h==="string"||h==="number"||h==="boolean"}}function tye(n,e,t,r){r===void 0&&(r=console.log);var a=rye(n),i=["Layer (type)","Input Shape","Output shape","Param #"];a?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(function(h){return Math.floor(e*h)}));var o;if(!a){i.push("Receives inputs"),o=[];for(var s in n.nodesByDepth)o.push.apply(o,Qe([],te(n.nodesByDepth[s]),!1))}r("_".repeat(e)),Wd(i,t,r),r("=".repeat(e));for(var u=n.layers,c=0;c<u.length;++c)a?aye(u[c],t,r):iye(u[c],t,o,r),r((c===u.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();var l=nye(n),f=Ed(n.nonTrainableWeights);r("Total params: ".concat(l+f)),r("Trainable params: ".concat(l)),r("Non-trainable params: ".concat(f)),r("_".repeat(e))}function nye(n){var e;return n.collectedTrainableWeights!=null?e=Ed(n.collectedTrainableWeights):e=Ed(n.trainableWeights),e}function rye(n){var e,t,r,a,i,o,s=!0,u=[],c=[];for(var l in n.nodesByDepth)u.push(n.nodesByDepth[l]);try{for(var f=fe(u),h=f.next();!h.done;h=f.next()){var p=h.value;if(p.length>1||p.length===1&&p[0].inboundLayers.length>1){s=!1;break}c.push.apply(c,Qe([],te(p),!1))}}catch(x){e={error:x}}finally{try{h&&!h.done&&(t=f.return)&&t.call(f)}finally{if(e)throw e.error}}if(s)try{for(var d=fe(n.layers),v=d.next();!v.done;v=d.next()){var m=v.value,g=!1;try{for(var y=(i=void 0,fe(m.inboundNodes)),b=y.next();!b.done;b=y.next()){var w=b.value;if(c.indexOf(w)!==-1)if(g){s=!1;break}else g=!0}}catch(x){i={error:x}}finally{try{b&&!b.done&&(o=y.return)&&o.call(y)}finally{if(i)throw i.error}}if(!s)break}}catch(x){r={error:x}}finally{try{v&&!v.done&&(a=d.return)&&a.call(d)}finally{if(r)throw r.error}}return s}function Wd(n,e,t){t===void 0&&(t=console.log);for(var r="",a=0;a<n.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r+=n[a],r=r.slice(0,e[a]),r+=" ".repeat(e[a]-r.length);t(r)}function aye(n,e,t){var r,a;try{a=n.inboundNodes.map(function(u){return JSON.stringify(u.inputShapes)}).join(",")}catch{a="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}var i=n.name,o=n.getClassName(),s=["".concat(i," (").concat(o,")"),a,r,n.countParams().toString()];Wd(s,e,t)}function iye(n,e,t,r){var a,i,o,s;try{s=n.inboundNodes.map(function(w){return JSON.stringify(w.inputShapes)}).join(",")}catch{s="multiple"}try{o=JSON.stringify(n.outputShape)}catch{o="multiple"}var u=[];try{for(var c=fe(n.inboundNodes),l=c.next();!l.done;l=c.next()){var f=l.value;if(!(t!=null&&t.length>0&&t.indexOf(f)===-1))for(var h=0;h<f.inboundLayers.length;++h){var p=f.inboundLayers[h].name,d=f.nodeIndices[h],v=f.tensorIndices[h];u.push("".concat(p,"[").concat(d,"][").concat(v,"]"))}}}catch(w){a={error:w}}finally{try{l&&!l.done&&(i=c.return)&&i.call(c)}finally{if(a)throw a.error}}var m=n.name,g=n.getClassName(),y=u.length===0?"":u[0],b=["".concat(m," (").concat(g,")"),s,o,n.countParams().toString(),y];Wd(b,e,r);for(var h=1;h<u.length;++h)Wd(["","","","",u[h]],e,r)}function dM(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function Nf(n,e){var t,r;if(n===null)return null;if(typeof n=="string")return Ds(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){for(var a=[],i=n.length,o=0;o<i;++o){var s=n[o];dM(e,o,s)?a.push(s):a.push(Nf(s,e))}return a}else{var u={};try{for(var c=fe(Object.keys(n)),l=c.next();!l.done;l=c.next()){var f=l.value,h=n[f];if(f==="name"&&typeof h=="string")u[f]=h;else{var p=Ds(f);u[p]=Nf(h,p)}}}catch(d){t={error:d}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}return u}}function qy(n,e){var t,r;if(n==null)return null;if(typeof n=="string")return eo(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){for(var a=[],i=n.length,o=0;o<i;++o){var s=n[o];dM(e,o,s)?a.push(s):a.push(qy(s,e))}return a}else{var u={};try{for(var c=fe(Object.keys(n)),l=c.next();!l.done;l=c.next()){var f=l.value,h=n[f],p=eo(f);(f==="name"||f==="className")&&typeof h=="string"?u[p]=h:u[p]=qy(h,f)}}catch(d){t={error:d}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}return u}}var Fb="4.2.0",oye=function(n){se(e,n);function e(t){var r,a,i,o,s,u,c,l,f,h,p,d,v,m,g,y,b,w,x,N,T,E,C,F,D=n.call(this,{})||this;if(D.containerNodes=new Set,D.name=t.name,D.name==null){var O=D.getClassName().toLowerCase();D.name=Vd(O)}if(D.supportsMasking=!1,D.trainable_=!0,Array.isArray(t.inputs)?D.inputs=t.inputs.slice():D.inputs=[t.inputs],Array.isArray(t.outputs)?D.outputs=t.outputs.slice():D.outputs=[t.outputs],Lo(D.inputs).length!==D.inputs.length)throw new Z("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+"".concat(D.inputs.map(function(pt){return pt.name})));Lo(D.outputs).length!==D.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+"".concat(D.outputs.map(function(pt){return pt.name}))),D.inputLayers=[],D.inputLayersNodeIndices=[],D.inputLayersTensorIndices=[],D.outputLayers=[],D.outputLayersNodeIndices=[],D.outputLayersTensorIndices=[],D.layers=[],D.internalContainerRefs=[];try{for(var L=fe(D.outputs),z=L.next();!z.done;z=L.next()){var $=z.value,B=$.sourceLayer,W=$.nodeIndex,X=$.tensorIndex;D.outputLayers.push(B),D.outputLayersNodeIndices.push(W),D.outputLayersTensorIndices.push(X)}}catch(pt){r={error:pt}}finally{try{z&&!z.done&&(a=L.return)&&a.call(L)}finally{if(r)throw r.error}}try{for(var Y=fe(D.inputs),V=Y.next();!V.done;V=Y.next()){var $=V.value,B=$.sourceLayer,W=$.nodeIndex,X=$.tensorIndex;_i(W===0,"input layer has >1 nodes"),_i(X===0,"input layer has >1 tensors"),D.inputLayers.push(B),D.inputLayersNodeIndices.push(W),D.inputLayersTensorIndices.push(X)}}catch(pt){i={error:pt}}finally{try{V&&!V.done&&(o=Y.return)&&o.call(Y)}finally{if(i)throw i.error}}D.inputNames=[],D.outputNames=[],D.feedInputShapes=[],D.feedInputNames=[],D.feedOutputNames=[];for(var j=0;j<D.inputLayers.length;j++){var B=D.inputLayers[j];if(!(B instanceof pc))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. "+"Received inputs: ".concat(t.inputs,". ")+"Input ".concat(j," (0-based) originates ")+"from layer type ".concat(B.getClassName(),"."));D.inputNames.push(B.name),D.feedInputShapes.push(B.batchInputShape),D.feedInputNames.push(B.name)}try{for(var re=fe(D.outputLayers),ne=re.next();!ne.done;ne=re.next()){var B=ne.value;D.outputNames.push(B.name)}}catch(pt){s={error:pt}}finally{try{ne&&!ne.done&&(u=re.return)&&u.call(re)}finally{if(s)throw s.error}}D.internalInputShapes=D.inputs.map(function(pt){return pt.shape}),D.internalOutputShapes=D.outputs.map(function(pt){return pt.shape});var oe={},le={},de={},xe={},he={},ye=[],we=function(pt,Sa,Ja,Br,ss,C2){(Br==null||ss==null||C2==null)&&(Br=pt.sourceLayer,ss=pt.nodeIndex,C2=pt.tensorIndex);var oa=Br.inboundNodes[ss];if(Ja.indexOf(oa)!==-1)throw new Fi("The tensor ".concat(pt.name,' at layer "').concat(Br.name,'" ')+"is part of a cycle.");if(Sa.indexOf(oa)===-1){D.containerNodes.add(e.nodeKey(Br,ss)),Br.id in he||(he[Br.id]=Object.keys(he).length),Ja.indexOf(oa)===-1&&Ja.push(oa);for(var PH=oa.inboundLayers.length,Cu=0;Cu<PH;Cu++){var MH=oa.inputTensors[Cu],BH=oa.inboundLayers[Cu],LH=oa.nodeIndices[Cu],zH=oa.tensorIndices[Cu];we(MH,Sa,Ja,BH,LH,zH)}for(Sa.push(oa);Ja.indexOf(oa)>=0;)Ja.splice(Ja.indexOf(oa),1);ye.push(oa)}},Ae=[],Ye=[];try{for(var ht=fe(D.outputs),at=ht.next();!at.done;at=ht.next()){var $=at.value;we($,Ae,Ye)}}catch(pt){c={error:pt}}finally{try{at&&!at.done&&(l=ht.return)&&l.call(ht)}finally{if(c)throw c.error}}var nt=ye.slice().reverse();try{for(var lt=fe(nt),st=lt.next();!st.done;st=lt.next()){var Ze=st.value;le[Ze.id]=Ze,Ze.id in oe||(oe[Ze.id]=0);var tt=oe[Ze.id],et=de[Ze.outboundLayer.id]==null?0:de[Ze.outboundLayer.id];tt=Math.max(tt,et),de[Ze.outboundLayer.id]=tt,xe[Ze.outboundLayer.id]=Ze.outboundLayer,oe[Ze.id]=tt;for(var j=0;j<Ze.inboundLayers.length;j++){var rn=Ze.inboundLayers[j],W=Ze.nodeIndices[j],He=rn.inboundNodes[W],kt=oe[He.id]==null?0:oe[He.id];oe[He.id]=Math.max(tt+1,kt),le[He.id]=He}}}catch(pt){f={error:pt}}finally{try{st&&!st.done&&(h=lt.return)&&h.call(lt)}finally{if(f)throw f.error}}var An={};for(var hr in oe){var tt=oe[hr];tt in An||(An[tt]=[]),An[tt].push(le[hr])}var On={};for(var _n in de){var tt=de[_n];tt in On||(On[tt]=[]),On[tt].push(xe[_n])}var an=Object.keys(On).map(function(pt){return parseInt(pt,10)}).sort(md);D.layers=[];try{for(var Pr=fe(an),pr=Pr.next();!pr.done;pr=Pr.next()){var tt=pr.value,Mr=On[tt];Mr.sort(function(Sa,Ja){var Br=he[Sa.id],ss=he[Ja.id];return Br<ss?-1:Br>ss?1:0});try{for(var Sn=(v=void 0,fe(Mr)),Gi=Sn.next();!Gi.done;Gi=Sn.next()){var B=Gi.value;B instanceof e&&D.internalContainerRefs.push(B),D.layers.push(B)}}catch(Sa){v={error:Sa}}finally{try{Gi&&!Gi.done&&(m=Sn.return)&&m.call(Sn)}finally{if(v)throw v.error}}}}catch(pt){p={error:pt}}finally{try{pr&&!pr.done&&(d=Pr.return)&&d.call(Pr)}finally{if(p)throw p.error}}D.layersByDepth=On,an=Object.keys(An).map(function(pt){return parseInt(pt,10)}).sort(md);var Eu=D.inputs.slice(),Uh=[];try{for(var Ui=fe(an),os=Ui.next();!os.done;os=Ui.next()){var tt=os.value;try{for(var Iu=(b=void 0,fe(An[tt])),pl=Iu.next();!pl.done;pl=Iu.next()){var Ze=pl.value,B=Ze.outboundLayer;if(B!=null){try{for(var Hh=(x=void 0,fe(Ze.inputTensors)),dl=Hh.next();!dl.done;dl=Hh.next()){var $=dl.value;if(Eu.indexOf($)===-1)throw new Fi("Graph disconnected: cannot obtain value for tensor ".concat($)+' at layer "'.concat(B.name,'". ')+"The following previous layers were accessed without "+"issue: ".concat(Uh))}}catch(Br){x={error:Br}}finally{try{dl&&!dl.done&&(N=Hh.return)&&N.call(Hh)}finally{if(x)throw x.error}}try{for(var Kh=(T=void 0,fe(Ze.outputTensors)),vl=Kh.next();!vl.done;vl=Kh.next()){var $=vl.value;Eu.push($)}}catch(Br){T={error:Br}}finally{try{vl&&!vl.done&&(E=Kh.return)&&E.call(Kh)}finally{if(T)throw T.error}}Uh.push(B.name)}}}catch(Sa){b={error:Sa}}finally{try{pl&&!pl.done&&(w=Iu.return)&&w.call(Iu)}finally{if(b)throw b.error}}}}catch(pt){g={error:pt}}finally{try{os&&!os.done&&(y=Ui.return)&&y.call(Ui)}finally{if(g)throw g.error}}D.nodesByDepth=An;var Hm=D.layers.map(function(pt){return pt.name}),RH=function(pt){var Sa=Hm.filter(function(Ja){return Ja===pt}).length;if(Sa!==1)throw new Fi('The name "'.concat(pt,'" is used ').concat(Sa," times ")+"in the model. All layer names should be unique. Layer names: "+JSON.stringify(Hm))};try{for(var jh=fe(Hm),ml=jh.next();!ml.done;ml=jh.next()){var OH=ml.value;RH(OH)}}catch(pt){C={error:pt}}finally{try{ml&&!ml.done&&(F=jh.return)&&F.call(jh)}finally{if(C)throw C.error}}return D.outboundNodes=[],D.inboundNodes=[],new Jd({outboundLayer:D,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:D.inputs,outputTensors:D.outputs,inputMasks:D.inputs.map(function(pt){return null}),outputMasks:D.outputs.map(function(pt){return null}),inputShapes:D.inputs.map(function(pt){return pt.shape}),outputShapes:D.outputs.map(function(pt){return pt.shape})}),D.built=!0,D._refCount=1,D}return e.prototype.assertNotDisposed=function(){if(this._refCount===0)throw new Error("Container '".concat(this.name,"' is already disposed."))},e.prototype.dispose=function(){var t,r,a,i;this.assertNotDisposed();var o={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){var c=u.value;o.numDisposedVariables+=c.dispose().numDisposedVariables}}catch(p){t={error:p}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}try{for(var l=fe(this.internalContainerRefs),f=l.next();!f.done;f=l.next()){var h=f.value;o.numDisposedVariables+=h.dispose().numDisposedVariables}}catch(p){a={error:p}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}}return o.refCountAfterDispose=this._refCount,o},Object.defineProperty(e.prototype,"trainable",{get:function(){return this.trainable_},set:function(t){this.layers.forEach(function(r){r._trainableWeights.forEach(function(a){return a.trainable=t})}),this.trainable_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){var t,r;if(this._trainableWeights.length>0)throw new Z("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var a=[];try{for(var i=fe(this.layers),o=i.next();!o.done;o=i.next()){var s=o.value;a=a.concat(s.trainableWeights)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return a},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){var t,r,a,i,o=[];try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){var c=u.value;o.push.apply(o,Qe([],te(c.nonTrainableWeights),!1))}}catch(p){t={error:p}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}if(!this.trainable){var l=[];try{for(var f=fe(this.layers),h=f.next();!h.done;h=f.next()){var c=h.value;l.push.apply(l,Qe([],te(c.trainableWeights),!1))}}catch(p){a={error:p}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}return l.concat(o)}return o},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"weights",{get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)},enumerable:!1,configurable:!0}),e.prototype.loadWeights=function(t,r){var a,i,o,s;r===void 0&&(r=!0);var u={},c=0;try{for(var l=fe(this.layers),f=l.next();!f.done;f=l.next()){var h=f.value;try{for(var p=(o=void 0,fe(h.weights)),d=p.next();!d.done;d=p.next()){var v=d.value;if(u[v.originalName]!=null)throw new Z("Duplicate weight name: ".concat(v.originalName));u[v.originalName]=v,c++}}catch(N){o={error:N}}finally{try{d&&!d.done&&(s=p.return)&&s.call(p)}finally{if(o)throw o.error}}}}catch(N){a={error:N}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}var m=[];for(var g in t){var y=g;if(u[g]==null){var b=g.split("/"),w=b.slice(0,-2).concat([b[b.length-1]]);y=w.join("/")}if(u[y]!=null)m.push([u[y],t[g]]);else if(r)throw new Z("Provided weight data has no target variable: ".concat(g));delete u[y]}if(r){var x=[];for(var g in u)x.push(g);if(x.length>0)throw new Z("".concat(x.length," of ").concat(c," weights are not set: ")+"".concat(x))}eb(m)},e.prototype.updatedConfig=function(){var t=this.getConfig(),r={};return r.className=this.getClassName(),r.config=t,r.kerasVersion="tfjs-layers ".concat(Fb),r.backend="TensorFlow.js",r},e.prototype.toJSON=function(t,r){r===void 0&&(r=!0);var a=qy(this.updatedConfig());return r?JSON.stringify(a):a},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){t=Yt(t);for(var i=new ic,o=0;o<a.inputs.length;++o)i.add(a.inputs[o],t[o]);return mf(a.outputs,i,r)})},e.prototype.computeMask=function(t,r){var a=this;return R.tidy(function(){t=Yt(t);var i;return r==null?i=Ps(null,t.length):i=Yt(r),a.runInternalGraph(t,i)[1]})},e.prototype.computeOutputShape=function(t){var r,a,i,o,s=Td(t);if(s.length!==this.inputLayers.length)throw new Z("Invalid inputShape argument ".concat(t,": ")+"model has ".concat(this.inputLayers.length," tensor inputs."));for(var u={},c=0;c<s.length;c++){var l=this.inputLayers[c],f=s[c],h=l.name+"_0_0";u[h]=f}var p=Object.keys(this.nodesByDepth).map(function(W){return parseInt(W,10)}).sort(md);if(p.length>1)try{for(var d=fe(p),v=d.next();!v.done;v=d.next()){var m=v.value,g=this.nodesByDepth[m];try{for(var y=(i=void 0,fe(g)),b=y.next();!b.done;b=y.next()){var w=b.value,l=w.outboundLayer;if(this.inputLayers.map(function(X){return X.id}).indexOf(l.id)===-1){for(var x=[],N=0;N<w.inboundLayers.length;N++){var T=w.inboundLayers[N],E=w.nodeIndices[N],C=w.tensorIndices[N],h="".concat(T.name,"_").concat(E,"_").concat(C),F=u[h];x.push(F)}for(var D=l.computeOutputShape(Ir(x)),O=Td(D),L=l.inboundNodes.indexOf(w),N=0;N<O.length;N++){var h="".concat(l.name,"_").concat(L,"_").concat(N);u[h]=O[N]}}}}catch(W){i={error:W}}finally{try{b&&!b.done&&(o=y.return)&&o.call(y)}finally{if(i)throw i.error}}}}catch(W){r={error:W}}finally{try{v&&!v.done&&(a=d.return)&&a.call(d)}finally{if(r)throw r.error}}for(var z=[],$=[],c=0;c<this.outputLayers.length;c++){var l=this.outputLayers[c],L=this.outputLayersNodeIndices[c],C=this.outputLayersTensorIndices[c],h="".concat(l.name,"_").concat(L,"_").concat(C);$.push(h)}for(var c=0;c<$.length;c++){var B=$[c];_i(B in u),z.push(u[B])}return Ir(z)},e.prototype.runInternalGraph=function(t,r){var a,i,o,s,u,c,l,f;r==null&&(r=Ps(null,t.length));for(var h={},p=0;p<this.inputs.length;++p){var d=this.inputs[p],v=t[p],m=r[p];h[d.id]=[v,m]}var g=Object.keys(this.nodesByDepth).map(function(we){return parseInt(we,10)}).sort(md);try{for(var y=fe(g),b=y.next();!b.done;b=y.next()){var w=b.value,x=this.nodesByDepth[w];try{for(var N=(o=void 0,fe(x)),T=N.next();!T.done;T=N.next()){var E=T.value,C=E.outboundLayer,F=E.inputTensors,D=E.outputTensors,O=new Array;try{for(var L=(u=void 0,fe(F)),z=L.next();!z.done;z=L.next()){var d=z.value;d.id in h&&O.push(h[d.id])}}catch(we){u={error:we}}finally{try{z&&!z.done&&(c=L.return)&&c.call(L)}finally{if(u)throw u.error}}if(O.length===F.length){var $={},B=void 0,W=void 0,X=void 0,Y=void 0;if(E.callArgs!=null&&($=E.callArgs),O.length===1){var V=te(O[0],2),j=V[0],re=V[1];$.mask==null&&($.mask=re),X=Yt(C.call(j,$)),Y=Yt(C.computeMask(j,re)),B=[j],W=[re]}else B=O.map(function(we){return we[0]}),W=O.map(function(we){return we[1]}),$.mask==null&&($.mask=W),X=Yt(C.call(B,$)),Y=Yt(C.computeMask(B,W));if(C.activityRegularizer)throw new dt("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var p=0;p<D.length;++p){var d=D[p],v=X[p],m=Y[p];h[d.id]=[v,m]}}}}catch(we){o={error:we}}finally{try{T&&!T.done&&(s=N.return)&&s.call(N)}finally{if(o)throw o.error}}}}catch(we){a={error:we}}finally{try{b&&!b.done&&(i=y.return)&&i.call(y)}finally{if(a)throw a.error}}var ne=[],oe=[],le=[];try{for(var de=fe(this.outputs),xe=de.next();!xe.done;xe=de.next()){var d=xe.value;_i(d.id in h,"Could not compute output ".concat(d.name," : ").concat(d.id));var he=te(h[d.id],2),ye=he[0],m=he[1];le.push(ye.shape),ne.push(ye),oe.push(m)}}catch(we){l={error:we}}finally{try{xe&&!xe.done&&(f=de.return)&&f.call(de)}finally{if(l)throw l.error}}return[ne,oe,le]},e.prototype.buildNodeConversionMap=function(t){var r,a,i={},o;try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){var c=u.value;o=c instanceof e?1:0;for(var l=0;l<c.inboundNodes.length;l++){var f=e.nodeKey(c,l);this.containerNodes.has(f)&&(i[f]=o,o+=1)}}}catch(h){r={error:h}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}return i},e.prototype.getLayer=function(t,r){var a,i;if(r!=null){if(this.layers.length<=r)throw new Z("Was asked to retrieve layer at index ".concat(r,", but model only ")+"has ".concat(this.layers.length," layer(s)."));return this.layers[r]}else if(t==null)throw new Z("Provide either a layer name or layer index");try{for(var o=fe(this.layers),s=o.next();!s.done;s=o.next()){var u=s.value;if(u.name===t)return u}}catch(c){a={error:c}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(a)throw a.error}}throw new Z("No such layer: ".concat(t))},e.prototype.calculateLosses=function(){var t=this;return R.tidy(function(){var r,a,i=[];try{for(var o=fe(t.layers),s=o.next();!s.done;s=o.next())for(var u=s.value,c=0;c<u.inboundNodes.length;++c){var l=e.nodeKey(u,c);t.containerNodes.has(l)&&i.push.apply(i,Qe([],te(u.calculateLosses()),!1))}}catch(f){r={error:f}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}return i})},e.prototype.getConfig=function(){var t,r,a={name:this.name},i=this.buildNodeConversionMap(this.layers),o=[];try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){for(var c=u.value,l=c.getClassName(),f=c.getConfig(),h=[],p=0;p<c.inboundNodes.length;p++){var d=c.inboundNodes[p],v=e.nodeKey(c,p),m={};if(this.containerNodes.has(v)){if(d.callArgs)try{JSON.stringify(d.callArgs),m=d.callArgs}catch{console.warn("Layer ".concat(c.name," was passed ")+"non-serializable keyword arguments: "+"".concat(d.callArgs,". They will not be included ")+"in the serialized model (and thus will be missing at deserialization time)."),m={}}if(d.inboundLayers.length>0){for(var g=[],y=0;y<d.inboundLayers.length;y++){var b=d.inboundLayers[y],w=d.nodeIndices[y],x=d.tensorIndices[y],N=e.nodeKey(b,w),T=i[N];T==null&&(T=0),g.push([b.name,T,x,m])}h.push(g)}}}var E={};E.name=c.name,E.className=l,E.config=f,E.inboundNodes=h,o.push(E)}}catch(D){t={error:D}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}a.layers=o;for(var C=[],y=0;y<this.inputLayers.length;y++){var c=this.inputLayers[y],w=this.inputLayersNodeIndices[y],v=e.nodeKey(c,w);if(!!this.containerNodes.has(v)){var T=i[v];T==null&&(T=0);var x=this.inputLayersTensorIndices[y];C.push([c.name,T,x])}}a.inputLayers=C;for(var F=[],y=0;y<this.outputLayers.length;y++){var c=this.outputLayers[y],w=this.outputLayersNodeIndices[y],v=e.nodeKey(c,w);if(!!this.containerNodes.has(v)){var T=i[v];T==null&&(T=0);var x=this.outputLayersTensorIndices[y];F.push([c.name,T,x])}}return a.outputLayers=F,a},e.fromConfig=function(t,r,a,i){var o,s,u,c,l,f,h,p,d,v;i===void 0&&(i=!1);var m={},g={};function y(ye,we){ye.name in g?g[ye.name].push(we):g[ye.name]=[we]}function b(ye,we){var Ae,Ye,ht=[],at;try{for(var nt=fe(we),lt=nt.next();!lt.done;lt=nt.next()){var st=lt.value,Ze=st[0],tt=st[1],et=st[2];if(at=st[3]==null?{}:st[3],!(Ze in m)){y(ye,we);return}var rn=m[Ze];if(rn.inboundNodes.length<=tt){y(ye,we);return}var He=rn.inboundNodes[tt];ht.push(He.outputTensors[et])}}catch(kt){Ae={error:kt}}finally{try{lt&&!lt.done&&(Ye=nt.return)&&Ye.call(nt)}finally{if(Ae)throw Ae.error}}ht.length>0&&ye.apply(Ir(ht),at)}function w(ye){var we=ye.name,Ae=ci(ye,r.customObjects!=null?r.customObjects:{});Ae.setFastWeightInitDuringBuild(i),m[we]=Ae;var Ye=ye.inboundNodes;Ye.forEach(function(ht){if(!(ht instanceof Array))throw new Z("Corrupted configuration, expected array for nodeData: ".concat(ht));y(Ae,ht)})}var x=r.name,N=r.layers;try{for(var T=fe(N),E=T.next();!E.done;E=T.next()){var C=E.value;w(C)}}catch(ye){o={error:ye}}finally{try{E&&!E.done&&(s=T.return)&&s.call(T)}finally{if(o)throw o.error}}for(;!Fle(g);)try{for(var F=(u=void 0,fe(N)),D=F.next();!D.done;D=F.next()){var C=D.value,O=m[C.name];if(O.name in g){var L=g[O.name];delete g[O.name];try{for(var z=(l=void 0,fe(L)),$=z.next();!$.done;$=z.next()){var B=$.value;b(O,B)}}catch(we){l={error:we}}finally{try{$&&!$.done&&(f=z.return)&&f.call(z)}finally{if(l)throw l.error}}}}}catch(ye){u={error:ye}}finally{try{D&&!D.done&&(c=F.return)&&c.call(F)}finally{if(u)throw u.error}}var W=[],X=[],Y=r.inputLayers;try{for(var V=fe(Y),j=V.next();!j.done;j=V.next()){var C=j.value,re=C[0],ne=C[1],oe=C[2];_i(re in m);var O=m[re],le=O.inboundNodes[ne].outputTensors;W.push(le[oe])}}catch(ye){h={error:ye}}finally{try{j&&!j.done&&(p=V.return)&&p.call(V)}finally{if(h)throw h.error}}var de=r.outputLayers;try{for(var xe=fe(de),he=xe.next();!he.done;he=xe.next()){var C=he.value,re=C[0],ne=C[1],oe=C[2];_i(re in m);var O=m[re],le=O.inboundNodes[ne].outputTensors;X.push(le[oe])}}catch(ye){d={error:ye}}finally{try{he&&!he.done&&(v=xe.return)&&v.call(xe)}finally{if(d)throw d.error}}return new t({inputs:W,outputs:X,name:x})},Object.defineProperty(e.prototype,"stateful",{get:function(){var t,r;if(this._stateful)throw new Z("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");try{for(var a=fe(this.layers),i=a.next();!i.done;i=a.next()){var o=i.value;if(o.stateful)return!0}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}return!1},enumerable:!1,configurable:!0}),e.prototype.resetStates=function(){var t=this;R.tidy(function(){t.layers.forEach(function(r){r.stateful&&r.resetStates()})})},e}(gt);function sye(n,e,t){var r=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(function(i){return null});if(r===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==r)throw new Error("Provided ".concat(t," is an array of ").concat(n.length," ")+"element(s), but the model has ".concat(r," outputs. ")+"Make sure a set of weights is provided for each model output.");return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){var a=[];return e.forEach(function(i){i in n?a.push(n[i]):a.push(null)}),a}else throw new Error("The model has multiple (".concat(r,") outputs, ")+"so ".concat(t," must be either an array with ")+"".concat(r," elements or an object with ").concat(e," keys. ")+"Provided ".concat(t," not understood: ").concat(JSON.stringify(n)))}function vM(n,e){return sye(n,e,"classWeight")}function mM(n,e,t,r){return Ce(this,void 0,void 0,function(){var a,i,o,s,u;return Ee(this,function(c){switch(c.label){case 0:if(e!=null||r!=null)throw new Error("Support sampleWeight is not implemented yet");return t==null?[3,2]:(a=R.tidy(function(){if(n.shape.length===1)return R.clone(n);if(n.shape.length===2)if(n.shape[1]>1){var l=1;return R.argMax(n,l)}else{if(n.shape[1]===1)return R.reshape(n,[n.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(n.shape[1],") ")+"during handling of class weights. The size is expected to be >= 1.")}else throw new Error("Unexpected rank of target (y) tensor (".concat(n.rank,") during ")+"handling of class weights. The rank is expected to be 1 or 2.")}),s=(o=Array).from,[4,a.data()]);case 1:return i=s.apply(o,[c.sent()]),R.dispose(a),u=[],i.forEach(function(l){if(t[l]==null)throw new Error("classWeight must contain all classes in the training data. "+"The class ".concat(l," exists in the data but not in ")+"classWeight");u.push(t[l])}),[2,R.tensor1d(u,"float32")];case 2:return[2,null]}})})}function uye(n,e){return R.mul(n,e)}var cye=32;function gM(n,e){var t,r,a=e;t=a.xs,r=a.ys,_.util.assert(t!=null&&r!=null,function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+"".concat(e)});var i=yO("input",n.inputNames,t),o=yO("output",n.outputNames,r),s=i[0].shape[0];_.util.assert(i.length===n.inputs.length,function(){return"LayersModel has ".concat(n.inputs.length," inputs, but the dataset ")+"provides ".concat(i.length," inputs.  (Expected input keys: ")+"".concat(JSON.stringify(n.inputNames),")")}),_.util.assert(o.length===n.outputs.length,function(){return"LayersModel has ".concat(n.outputs.length," outputs, but the dataset ")+"provides ".concat(o.length," outputs.  (Expected output keys: ")+"".concat(JSON.stringify(n.outputNames),")")});for(var u=function(h){_.util.assert(i[h].shape[0]===s,function(){return"Batch size mismatch: input "+"".concat(n.inputNames[h]," has ").concat(i[h].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(n.inputNames[0],".")})},c=0;c<i.length;c++)u(c);for(var l=function(h){_.util.assert(o[h].shape[0]===s,function(){return"Batch size mismatch: output "+"".concat(n.outputNames[h]," has ").concat(o[h].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(n.inputNames[0],".")})},f=0;f<o.length;f++)l(f);return{xs:i,ys:o}}function yO(n,e,t){var r,a;if(t instanceof _.Tensor)return[t];if(Array.isArray(t))return _.util.assert(t.length===e.length,function(){return"Received an array of ".concat(t.length," Tensors, but expected ").concat(e.length," to match the ").concat(n," keys ").concat(e,".")}),t;var i=[];try{for(var o=fe(e),s=o.next();!s.done;s=o.next()){var u=s.value;if(t[u]==null)throw new Z("The feature data generated by the dataset lacks the required "+"".concat(n," key '").concat(u,"'."));i.push(t[u])}}catch(c){r={error:c}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}return i}function lye(n){if(n.length===3)throw new dt("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}function fye(n,e,t){return Ce(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f,h,p,d,v,m,g,y,b,w,x,N,T,E,C,F,D,V,O,L,z,$,V,B,W,X,Y,V;return Ee(this,function(j){switch(j.label){case 0:if(r=t.batchesPerEpoch!=null,_.util.assert(n.optimizer!=null,function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."}),_.util.assert(t!=null,function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."}),_.util.assert(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),function(){return"For fitDataset(), config.epochs is expected to be a positive "+"integer, but got ".concat(t.epochs)}),_.util.assert(!r||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a "+"positive integer if specified, but got ".concat(t.batchesPerEpoch)}),_.util.assert(t.validationSplit==null,function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."}),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0,j.label=1;case 1:return j.trys.push([1,,26,27]),a=t.validationData!=null,i=void 0,o=void 0,a&&(bO(t.validationData)?_.util.assert(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, "+"but got ".concat(t.validationBatches)}):(s=lye(t.validationData),i=s.xs,o=s.ys)),u=n.makeTrainFunction(),c=n.getDedupedMetricsNames(),l=void 0,a?l=c.slice().concat(c.map(function(re){return"val_"+re})):l=c.slice(),f=sM(t.callbacks,t.yieldEvery),h=t.verbose==null?1:t.verbose,p=uM(f,h,t.epochs,null,null,hye(e,t),null,a,l),d=p.callbackList,v=p.history,d.setModel(n),n.history=v,[4,d.onTrainBegin()];case 2:return j.sent(),n.stopTraining_=!1,m=t.initialEpoch==null?0:t.initialEpoch,[4,e.iterator()];case 3:g=j.sent(),j.label=4;case 4:return m<t.epochs?(y={},[4,d.onEpochBegin(m)]):[3,23];case 5:return j.sent(),b=0,w=0,r?[3,7]:[4,e.iterator()];case 6:g=j.sent(),j.label=7;case 7:return!r||b<t.batchesPerEpoch?[4,g.next()]:[3,21];case 8:return x=j.sent(),r&&x.done?(console.warn("You provided `batchesPerEpoch` as "+"".concat(t.batchesPerEpoch,", ")+"but your dataset iterator ran out of data after "+"".concat(b," batches; ")+"interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+"".concat(t.batchesPerEpoch*t.epochs," batches). ")+"You may need to use the repeat() function when building your dataset."),[3,21]):x.value==null?[3,15]:(N=gM(n,x.value),T=N.xs,E=N.ys,C={},C.batch=w,C.size=T[0].shape[0],[4,d.onBatchBegin(w,C)]);case 9:if(j.sent(),F=[],t.classWeight==null)return[3,13];D=vM(t.classWeight,n.outputNames),V=0,j.label=10;case 10:return V<D.length?(L=(O=F).push,[4,mM(E[V],null,D[V])]):[3,13];case 11:L.apply(O,[j.sent()]),j.label=12;case 12:return++V,[3,10];case 13:for(z=T.concat(E).concat(F),$=u(z),_.dispose(z),V=0;V<c.length;++V)B=c[V],W=$[V],C[B]=W,_.keep(W);return[4,d.onBatchEnd(w,C)];case 14:j.sent(),rM(C),w++,b++,j.label=15;case 15:return(r?b>=t.batchesPerEpoch:x.done)?a?(X=void 0,bO(t.validationData)?(Y=Yt,[4,n.evaluateDataset(t.validationData,{batches:t.validationBatches})]):[3,17]):[3,19]:[3,20];case 16:return X=Y.apply(void 0,[j.sent()]),[3,18];case 17:X=Yt(n.evaluate(i,o,{batchSize:t.validationBatchSize==null?cye:t.validationBatchSize,verbose:0})),j.label=18;case 18:for(V=0;V<n.metricsNames.length;++V)y["val_".concat(n.metricsNames[V])]=X[V];j.label=19;case 19:return[3,21];case 20:return n.stopTraining_?[3,21]:[3,7];case 21:return[4,d.onEpochEnd(m,y)];case 22:return j.sent(),m++,n.stopTraining_?[3,23]:[3,4];case 23:return[4,d.onTrainEnd()];case 24:return j.sent(),[4,n.history.syncData()];case 25:return j.sent(),[2,n.history];case 26:return n.isTraining=!1,[7];case 27:return[2]}})})}function hye(n,e){var t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function bO(n){return typeof n.iterator=="function"}function pye(n){return typeof n.next=="function"}function dye(n,e,t){return Ce(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f,h,p;return Ee(this,function(d){switch(d.label){case 0:if(t=t||{},r=t.batches!=null,a=n.testFunction,i=[],t.verbose>0)throw new dt("Verbose mode is not implemented yet.");return _.util.assert(!r||t.batches>0&&Number.isInteger(t.batches),function(){return"Test loop expects `batches` to be a positive integer, but "+"received ".concat(JSON.stringify(t.batches))}),pye(e)?(s=e,[3,3]):[3,1];case 1:return[4,e.iterator()];case 2:s=d.sent(),d.label=3;case 3:o=s,u=0,c=0,l=function(){var v;return Ee(this,function(m){switch(m.label){case 0:return[4,o.next()];case 1:return v=m.sent(),i=_.tidy(function(){if(v.value){var g=gM(n,v.value),y=g.xs,b=g.ys,w=y.concat(b),x=_.tidy(function(){return a(w)});if(_.dispose(w),c===0)for(var N=0;N<x.length;++N)i.push(R.scalar(0));for(var T=w[0].shape[0],E=function(C){var F=x[C],D=i[C];i[C]=_.tidy(function(){return _.add(i[C],_.mul(T,F))}),c>0&&_.dispose(D)},N=0;N<x.length;++N)E(N);_.dispose(x),u+=T,++c}return i}),v.done?(r&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` "+"batches (in this case, ".concat(t.batches," batches). ")+"You may need to use the repeat() function when building your dataset."),[2,"break"]):[2]}})},d.label=4;case 4:return!r||c<t.batches?[5,l()]:[3,6];case 5:return f=d.sent(),f==="break"?[3,6]:[3,4];case 6:for(h=0;h<i.length;++h)p=i[h],i[h]=_.div(i[h],u),_.dispose(p);return[2,Ir(i)]}})})}function ky(n){_.util.assert(n>0&&Number.isInteger(n),function(){return"batchSize is required to be a positive integer, but got ".concat(n)})}function df(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(function(r){return Os(r,e,t-e)}):Os(n,e,t-e)}function Wy(n,e){return _.tidy(function(){return n==null?null:Array.isArray(n)?n.map(function(t){return Wy(t,e)}):MO(n,e.dtype==="int32"?e:_.cast(e,"int32"))})}function Sy(n,e){for(var t=[],r=0,a=null;r<n;)a=r+e,a>=n&&(a=n),t.push([r,a]),r=a;return t}function yM(n){var e=[];n instanceof R.Tensor&&(n=[n]);for(var t=0;t<n.length;++t){var r=n[t];if(r.rank===1)e.push(If(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(r)}}return e}function oi(n,e){if(n!=null){var t=[];if(e instanceof R.Tensor)t.push(e.id);else if(Array.isArray(e))e.forEach(function(s){return t.push(s.id)});else if(e!=null)for(var r in e){var a=e[r];t.push(a.id)}var i=[];if(n instanceof R.Tensor)t.indexOf(n.id)===-1&&i.push(n);else if(Array.isArray(n))n.forEach(function(s){t.indexOf(s.id)===-1&&i.push(s)});else if(n!=null)for(var r in n){var o=n[r];t.indexOf(o.id)===-1&&i.push(o)}i.forEach(function(s){s.isDisposed||s.dispose()})}}function vye(n){return n instanceof R.Tensor}function Vy(n){return Array.isArray(n)}function wO(n){return!vye(n)&&!Vy(n)}function xO(n,e,t,r,a){var i,o;if(r===void 0&&(r=!0),a===void 0&&(a=""),e==null||e.length===0){if(n!=null){var s=!1;if(Vy(n)&&n.length>0)s=!0;else if(wO(n)){for(var u in n)if(n.hasOwnProperty(u)){s=!0;break}}else s=!0;if(s)throw new Z("Error when checking model ".concat(a," expected no data, ")+"but got ".concat(n))}return[]}if(n==null)return e.map(function(y){return null});var c;if(wO(n)){n=n,c=[];try{for(var l=fe(e),f=l.next();!f.done;f=l.next()){var h=f.value;if(n[h]==null)throw new Z('No data provided for "'.concat(h,'". Need data for each key in: ')+"".concat(e));c.push(n[h])}}catch(y){i={error:y}}finally{try{f&&!f.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}}else if(Vy(n)){if(n=n,n.length!==e.length)throw new Z("Error when checking model ".concat(a,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"model expected. Expected to see ".concat(e.length," Tensor(s), but ")+"instead got the following list of Tensor(s): ".concat(n));c=n}else{if(n=n,e.length>1)throw new Z("The model ".concat(a," expects ").concat(e.length," Tensor(s), ")+"but only received one Tensor. Found: Tensor with shape ".concat(n.shape));c=[n]}if(c=yM(c),t!=null){for(var p=0;p<e.length;++p)if(t[p]!=null){var d=c[p];if(d.shape.length!==t[p].length)throw new Z("Error when checking ".concat(a,": expected ").concat(e[p]," ")+"to have ".concat(t[p].length," dimension(s). but got array with ")+"shape ".concat(d.shape));for(var v=0;v<t[p].length;++v)if(!(v===0&&!r)){var m=d.shape[v],g=t[p][v];if(g!=null&&g>=0&&m!==g)throw new Z("".concat(a," expected a batch of elements where each ")+"example has shape [".concat(t[p].slice(1,t[p].length),"] ")+"(i.e.,tensor shape [*,".concat(t[p].slice(1,t[p].length),"])")+" but the ".concat(a," received an input with ").concat(d.shape[0])+" examples, each with shape [".concat(d.shape.slice(1,d.shape.length),"]")+" (tensor shape [".concat(d.shape,"])"))}}}return c}function mye(n,e,t){var r=Lo(n.map(function(i){return i.shape[0]}));r.sort();var a=Lo(e.map(function(i){return i.shape[0]}));if(a.sort(),r.length>1)throw new Z("All input Tensors (x) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(n.map(function(i){return i.shape}))));if(a.length>1)throw new Z("All target Tensors (y) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(e.map(function(i){return i.shape}))));if(r.length>0&&a.length>0&&!R.util.arraysEqual(r,a))throw new Z("Input Tensors should have the same number of samples as target "+"Tensors. Found ".concat(r[0]," input sample(s) and ").concat(a[0]," target ")+"sample(s).")}function gye(n,e,t){for(var r=[Us,rv,Sf],a=0;a<n.length;++a){var i=n[a],o=e[a],s=t[a];if(o!=null){if(o===Sf&&i.shape[i.shape.length-1]===1)throw new Z("You are passing a target array of shape ".concat(i.shape," while using ")+"a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(r.indexOf(o)!==-1)for(var u=i.shape.slice(1),c=s.slice(1),l=0;l<u.length;++l){var f=u[l],h=c[l];if(h!=null&&f!==h)throw new Z("A target Tensor with shape ".concat(i.shape," was passed for an ")+"output of shape ".concat(s,", while using a loss function that ")+"expects targets to have the same shape as the output.")}}}}function kO(n,e,t,r,a){r===void 0&&(r=!0),a===void 0&&(a="");var i;if(Array.isArray(n)){if(n.length!==e.length)throw new Z("Error when checking model ".concat(a,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"the model expected. Expected to see ".concat(e.length," Tensor(s),")+" but instead got ".concat(n.length," Tensors(s)."));i=n}else{if(e.length>1)throw new Z("The model expects ".concat(e.length," ").concat(a," Tensors, ")+"but only received one Tensor. Found: array with shape "+"".concat(JSON.stringify(n.shape),"."));i=[n]}if(t!=null){for(var o=0;o<e.length;++o)if(t[o]!=null){var s=i[o];if(s.shape.length!==t[o].length)throw new Z("Error when checking ".concat(a,": expected ").concat(e[o]," ")+"to have ".concat(t[o].length," dimension(s), but got array with ")+"shape ".concat(JSON.stringify(s.shape)));for(var u=0;u<t[o].length;++u)if(!(u===0&&!r)){var c=s.shape[u],l=t[o][u];if(l!=null&&l!==c)throw new Z("Error when checking ".concat(a,": expected ")+"".concat(e[o]," to have shape ").concat(JSON.stringify(t[o])," but ")+"got array with shape ".concat(JSON.stringify(s.shape),"."))}}}}function yye(n,e){var t,r;if(n==null||Array.isArray(n)&&n.length===0)return e.map(function(l){return[]});var a;if(typeof n=="string"||typeof n=="function")a=[n];else if(Array.isArray(n)||typeof n=="object")a=n;else throw new TypeError("Type of metrics argument not understood. Expected an string,"+"function, Array, or Object, found: ".concat(n));if(Array.isArray(a))return e.map(function(l){return a});var i=[];try{for(var o=fe(e),s=o.next();!s.done;s=o.next()){var u=s.value,c=a.hasOwnProperty(u)?a[u]:[];Array.isArray(c)||(c=[c]),i.push(c)}}catch(l){t={error:l}}finally{try{s&&!s.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return i}var bye="layers-model",to=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.isTraining=!1,r}return e.prototype.summary=function(t,r,a){if(a===void 0&&(a=console.log),!this.built)throw new Z("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");tye(this,t,r,a)},e.prototype.compile=function(t){var r,a,i=this;if(t.loss==null&&(t.loss=[]),this.loss=t.loss,typeof t.optimizer=="string")this.optimizer_=eye(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof R.Optimizer))throw new Z("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}var o=[];if(!Array.isArray(t.loss)&&typeof t.loss!="string"&&typeof t.loss!="function"){t.loss=t.loss;for(var s in t.loss)if(this.outputNames.indexOf(s)===-1)throw new Z('Unknown entry in loss dictionary: "'.concat(s,'". ')+"Only expected the following keys: ".concat(this.outputNames));try{for(var u=fe(this.outputNames),c=u.next();!c.done;c=u.next()){var s=c.value;t.loss[s]==null&&console.warn('Output "'.concat(s,'" is missing from loss dictionary. We assume ')+"this was done on purpose, and we will not be expecting data "+"to be passed to ".concat(s," during training")),o.push(xy(t.loss[s]))}}catch(g){r={error:g}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(r)throw r.error}}}else if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new Z("When passing an Array as loss, it should have one entry per "+"model output. The model has ".concat(this.outputs.length," output(s), ")+"but you passed loss=".concat(t.loss,"."));var l=t.loss;o=l.map(function(g){return xy(g)})}else{var f=xy(t.loss);this.outputs.forEach(function(g){o.push(f)})}this.lossFunctions=o,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var h=0;h<this.outputs.length;++h){var p=this.internalOutputShapes[h],s=this.outputNames[h];this.feedOutputNames.push(s),this.feedOutputShapes.push(p),this.feedLossFns.push(this.lossFunctions[h])}var d=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Rs("loss",function(){for(var g=0;g<i.outputs.length;++g)if(d.indexOf(g)===-1){var y=i.lossFunctions[g];i.outputs.length>1&&(i.metricsTensors.push([y,g]),i.metricsNames.push(i.outputNames[g]+"_loss"))}});var v=yye(t.metrics,this.outputNames),m=function(g,y,b){i.outputNames.length>1&&(y=i.outputNames[g]+"_"+y),i.metricsNames.push(y),i.metricsTensors.push([b,g])};Rs("metric",function(){for(var g=function(b){if(d.indexOf(b)!==-1)return"continue";var w=v[b],x=function(N){var T,E,C="",F,D,O,L=function(W){if(typeof W=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(W)!==-1){var X=i.internalOutputShapes[b];X[X.length-1]===1||i.lossFunctions[b]===rv?["accuracy","acc"].indexOf(W)!==-1?D=Ab:["crossentropy","ce"].indexOf(W)!==-1&&(D=fM):i.lossFunctions[b]===zd?["accuracy","acc"].indexOf(W)!==-1?D=hM:["crossentropy","ce"].indexOf(W)!==-1&&(D=pM):["accuracy","acc"].indexOf(W)!==-1?D=_b:["crossentropy","ce"].indexOf(W)!==-1&&(D=Db);var Y=void 0;["accuracy","acc"].indexOf(W)!==-1?Y="acc":["crossentropy","ce"].indexOf(W)!==-1&&(Y="ce"),O=D,F=C+Y}else{var V=Q0e(W);O=V,F=C+bd(W)}var j;Rs(F,function(){j=O}),m(b,F,j)};try{for(var z=(T=void 0,fe(N)),$=z.next();!$.done;$=z.next()){var B=$.value;L(B)}}catch(W){T={error:W}}finally{try{$&&!$.done&&(E=z.return)&&E.call(z)}finally{if(T)throw T.error}}};x(w)},y=0;y<i.outputs.length;++y)g(y)}),this.collectedTrainableWeights=this.trainableWeights},e.prototype.checkTrainableWeightsConsistency=function(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")},e.prototype.evaluate=function(t,r,a){a===void 0&&(a={});var i=a.batchSize==null?32:a.batchSize;ky(i);var o=!0,s=this.standardizeUserDataXY(t,r,o,i);try{var u=s[0].concat(s[1]);this.makeTestFunction();var c=this.testFunction,l=this.testLoop(c,u,i,a.verbose,a.steps);return Ir(l)}finally{oi(s[0],t),oi(s[1],r)}},e.prototype.evaluateDataset=function(t,r){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){return this.makeTestFunction(),[2,dye(this,t,r)]})})},e.prototype.checkNumSamples=function(t,r,a,i){i===void 0&&(i="steps");var o;if(a!=null){if(o=null,r!=null)throw new Z("If ".concat(i," is set, batchSize must be null or undefined.")+"Got batchSize = ".concat(r))}else if(t!=null)Array.isArray(t)?o=t[0].shape[0]:o=t.shape[0];else throw new Z("Either the input data should have a defined shape, or "+"".concat(i," shoud be specified."));return o},e.prototype.execute=function(t,r){var a,i;if(Array.isArray(r)&&r.length===0)throw new Z("`outputs` is an empty Array, which is not allowed.");var o=Array.isArray(r),s=o?r:[r],u=this.retrieveSymbolicTensors(s),c=new ic;if(t instanceof R.Tensor&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new Z("The number of inputs provided (".concat(t.length,") ")+"does not match the number of inputs of this model "+"(".concat(this.inputs.length,")."));for(var l=0;l<this.inputs.length;++l)c.add(this.inputs[l],t[l])}else try{for(var f=fe(this.inputs),h=f.next();!h.done;h=f.next()){var p=h.value,d=t[p.name];if(d==null)throw new Z("No value is provided for the model's input ".concat(p.name));c.add(p,d)}}catch(m){a={error:m}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}var v=mf(u,c);return o?v:v[0]},e.prototype.retrieveSymbolicTensors=function(t){var r,a,i=Ps(null,t.length),o=t.length;try{for(var s=fe(this.layers),u=s.next();!u.done;u=s.next()){for(var c=u.value,l=Array.isArray(c.output)?c.output:[c.output],f=l.map(function(v){return v.name}),h=0;h<t.length;++h){var p=f.indexOf(t[h]);if(p!==-1&&(i[h]=l[p],o--),o===0)break}if(o===0)break}}catch(v){r={error:v}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}if(o>0){var d=[];throw i.forEach(function(v,m){v==null&&d.push(t[m])}),new Z("Cannot find SymbolicTensors for output name(s): "+"".concat(JSON.stringify(d)))}return i},e.prototype.predictLoop=function(t,r,a){var i=this;return r===void 0&&(r=32),a===void 0&&(a=!1),_.tidy(function(){var o=i.checkNumSamples(t);if(a)throw new dt("Verbose predictLoop() is not implemented yet.");for(var s=Sy(o,r),u=i.outputs.map(function(f){return[]}),c=function(f){var h=_.tidy(function(){var p=s[f][0],d=s[f][1],v=df(t,p,d),m=[];if(Array.isArray(v))for(var g=0;g<v.length;++g)m.push({key:i.inputs[g],value:v[g]});else m.push({key:i.inputs[0],value:v});var y=new ic(m);return mf(i.outputs,y)});h.forEach(function(p,d){return u[d].push(p)})},l=0;l<s.length;++l)c(l);return Ir(u.map(function(f){return _.concat(f,0)}))})},e.prototype.predict=function(t,r){r===void 0&&(r={});var a=yM(t);kO(a,this.inputNames,this.feedInputShapes,!1);try{var i=r.batchSize==null?32:r.batchSize;return ky(i),this.predictLoop(a,i)}finally{oi(a,t)}},e.prototype.predictOnBatch=function(t){kO(t,this.inputNames,this.feedInputShapes,!0);var r=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,r)},e.prototype.standardizeUserDataXY=function(t,r,a,i){if(this.optimizer_==null)throw new Fi("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var o=[],s=0;s<this.feedOutputShapes.length;++s){var u=this.feedOutputShapes[s],c=this.feedLossFns[s];c===zd?o.push(u.slice(0,u.length-1).concat([1])):o.push(u)}if(t=xO(t,this.feedInputNames,this.feedInputShapes,!1,"input"),r=xO(r,this.feedOutputNames,o,!1,"target"),mye(t,r),gye(r,this.feedLossFns,this.feedOutputShapes),this.stateful&&i!=null&&i>0&&t[0].shape[0]%i!==0)throw new Z("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+"".concat(i,". Found: ").concat(t[0].shape[0]," sample(s)."));return[t,r]},e.prototype.standardizeUserData=function(t,r,a,i,o,s){return o===void 0&&(o=!0),Ce(this,void 0,void 0,function(){var u,c,l,f,h,p,d,v;return Ee(this,function(m){switch(m.label){case 0:if(u=te(this.standardizeUserDataXY(t,r,o,s),2),c=u[0],l=u[1],a!=null)throw new Error("sample weight is not supported yet.");if(f=null,i==null)return[3,4];h=vM(i,this.outputNames),f=[],p=0,m.label=1;case 1:return p<h.length?(v=(d=f).push,[4,mM(l[p],null,h[p])]):[3,4];case 2:v.apply(d,[m.sent()]),m.label=3;case 3:return++p,[3,1];case 4:return[2,[c,l,f]]}})})},e.prototype.testLoop=function(t,r,a,i,o){var s=this;return i===void 0&&(i=0),_.tidy(function(){var u=s.checkNumSamples(r,a,o,"steps"),c=[];if(i>0)throw new dt("Verbose mode is not implemented yet.");if(o!=null)throw new dt("steps mode in testLoop() is not implemented yet");for(var l=Sy(u,a),f=R.tensor1d(fi(0,u)),h=0;h<l.length;++h){var p=l[h][0],d=l[h][1],v=Os(f,p,d-p),m=Wy(r,v),g=t(m);if(h===0)for(var y=0;y<g.length;++y)c.push(R.scalar(0));for(var y=0;y<g.length;++y){var b=g[y];c[y]=_.add(c[y],_.mul(d-p,b))}}for(var y=0;y<c.length;++y)c[y]=_.div(c[y],u);return c})},e.prototype.getDedupedMetricsNames=function(){for(var t=this.metricsNames,r=[],a=0;a<t.length;++a){var i=t[a],o=i;if(CR(t,i)>1){var s=CR(t.slice(0,a),i);o+="_".concat(s)}r.push(o)}return r},e.prototype.makeTrainFunction=function(){var t=this;return function(r){var a=[],i=r.slice(0,t.inputs.length),o=r.slice(t.inputs.length,t.inputs.length+t.outputs.length),s=r.slice(t.inputs.length+t.outputs.length,t.inputs.length+t.outputs.length*2),u=[],c=function(){for(var p=[],d=0;d<t.inputs.length;++d)p.push({key:t.inputs[d],value:i[d]});for(var v=new ic(p),m=mf(t.outputs,v,{training:!0}),g,d=0;d<t.lossFunctions.length;++d){var y=t.lossFunctions[d],b=y(o[d],m[d]);s[d]!=null&&(b=uye(b,s[d]));var w=_.mean(b);a.push(w),d===0?g=b:g=_.add(g,b)}for(var d=0;d<t.metricsTensors.length;++d){var x=void 0;if(t.outputs.length>1&&d<t.outputs.length)x=a[d];else{var N=t.metricsTensors[d][0],T=t.metricsTensors[d][1];x=_.mean(N(o[T],m[T]))}_.keep(x),u.push(x)}return g=_.mean(g),t.calculateLosses().forEach(function(E){g=_.add(g,E)}),g},l=t.collectedTrainableWeights.map(function(p){return p.read()}),f=!0,h=t.optimizer_.minimize(c,f,l);return[h].concat(u)}},e.prototype.makeTestFunction=function(){var t=this;this.testFunction=function(r){return _.tidy(function(){for(var a=[],i,o=r.slice(0,t.inputs.length),s=r.slice(t.inputs.length,t.inputs.length+t.outputs.length),u=[],c=0;c<t.inputs.length;++c)u.push({key:t.inputs[c],value:o[c]});for(var l=new ic(u),f=mf(t.outputs,l),c=0;c<t.lossFunctions.length;++c){var h=t.lossFunctions[c],p=_.mean(h(s[c],f[c]));c===0?i=p:i=_.add(i,p),a.push(i)}for(var c=0;c<t.metricsTensors.length;++c){var d=t.metricsTensors[c][0],v=t.metricsTensors[c][1],m=_.mean(d(s[v],f[v]));a.push(m)}return a})}},e.prototype.fit=function(t,r,a){return a===void 0&&(a={}),Ce(this,void 0,void 0,function(){var i,o,s,u,c,l,f,h,p,d,v,m,g,y,b,w,x,N,T,E,C,F,D,O,L;return Ee(this,function(z){switch(z.label){case 0:if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0,z.label=1;case 1:return z.trys.push([1,,7,8]),d=a.batchSize==null?32:a.batchSize,ky(d),v=!1,[4,this.standardizeUserData(t,r,a.sampleWeight,a.classWeight,v,d)];case 2:if(m=z.sent(),i=m[0],o=m[1],p=m[2],g=!1,y=void 0,!(a.validationData!=null&&a.validationData.length>0))return[3,4];if(g=!0,a.validationData.length===2)c=a.validationData[0],l=a.validationData[1];else throw a.validationData.length===3?new dt("validationData including sample weights is not supported yet."):new Z("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+"".concat(a.validationData," is invalid."));return b=!0,[4,this.standardizeUserData(c,l,null,null,b,d)];case 3:return w=z.sent(),f=w[0],h=w[1],y=f.concat(h),[3,5];case 4:a.validationSplit!=null&&a.validationSplit>0&&a.validationSplit<1?(g=!0,x=Math.floor(i[0].shape[0]*(1-a.validationSplit)),N=i[0].shape[0],f=df(i,x,N),s=i,i=df(i,0,x),h=df(o,x,N),u=o,o=df(o,0,x),y=f.concat(h)):a.validationSteps!=null&&(g=!0),z.label=5;case 5:return T=i.concat(o).concat(p),this.checkTrainableWeightsConsistency(),E=this.makeTrainFunction(),C=this.getDedupedMetricsNames(),F=void 0,D=void 0,g?(this.makeTestFunction(),F=this.testFunction,D=C.slice().concat(C.map(function($){return"val_"+$}))):(F=null,y=[],D=C.slice()),O=sM(a.callbacks,a.yieldEvery),[4,this.fitLoop(E,T,C,d,a.epochs,a.verbose,O,F,y,a.shuffle,D,a.initialEpoch,null,null)];case 6:return L=z.sent(),[2,L];case 7:return this.isTraining=!1,oi(i,t),oi(o,r),oi(s,t),oi(u,r),oi(f,c),oi(h,l),p!=null&&_.dispose(p),[7];case 8:return[2]}})})},e.prototype.fitLoop=function(t,r,a,i,o,s,u,c,l,f,h,p,d,v){return Ce(this,void 0,void 0,function(){var m,g,y,b,w,x,N,T,E,C,F=this;return Ee(this,function(D){switch(D.label){case 0:if(i==null&&(i=32),o==null&&(o=1),f==null&&(f=!0),p==null&&(p=0),m=!1,c!=null&&l!=null&&(m=!0),v!=null&&(m=!0,d==null))throw new Z("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");return g=this.checkNumSamples(r,i,d,"steps_per_epoch"),g!=null&&(y=fi(0,g)),s==null&&(s=1),b=uM(u,s,o,p,g,d,i,m,h),w=b.callbackList,x=b.history,w.setModel(this),this.history=x,[4,w.onTrainBegin()];case 1:D.sent(),this.stopTraining_=!1,N=function(O){var L,z,$,B,W,X;return Ee(this,function(Y){switch(Y.label){case 0:return[4,w.onEpochBegin(O)];case 1:if(Y.sent(),L={},d==null)return[3,2];throw new dt("stepsPerEpoch mode is not implemented yet.");case 2:if(f==="batch")throw new dt("batch shuffling is not implemneted yet");f&&R.util.shuffle(y),z=R.tensor1d(y),$=Sy(g,i),B=function(V){var j;return Ee(this,function(re){switch(re.label){case 0:return j={},[4,w.onBatchBegin(V,j)];case 1:return re.sent(),_.tidy(function(){var ne=$[V][0],oe=$[V][1],le=Os(z,ne,oe-ne);j.batch=V,j.size=oe-ne;for(var de=Wy(r,le),xe=t(de),he=0;he<a.length;++he){var ye=a[he],we=xe[he];j[ye]=we,_.keep(we)}if(V===$.length-1&&m)for(var Ae=F.testLoop(c,l,i),he=0;he<a.length;++he){var ye=a[he],we=Ae[he];_.keep(we),L["val_"+ye]=we}}),[4,w.onBatchEnd(V,j)];case 2:return re.sent(),rM(j),T.stopTraining_?[2,"break"]:[2]}})},W=0,Y.label=3;case 3:return W<$.length?[5,B(W)]:[3,6];case 4:if(X=Y.sent(),X==="break")return[3,6];Y.label=5;case 5:return++W,[3,3];case 6:z.dispose(),Y.label=7;case 7:return[4,w.onEpochEnd(O,L)];case 8:return Y.sent(),T.stopTraining_?[2,"break"]:[2]}})},T=this,E=p,D.label=2;case 2:return E<o?[5,N(E)]:[3,5];case 3:if(C=D.sent(),C==="break")return[3,5];D.label=4;case 4:return++E,[3,2];case 5:return[4,w.onTrainEnd()];case 6:return D.sent(),[4,this.history.syncData()];case 7:return D.sent(),[2,this.history]}})})},e.prototype.fitDataset=function(t,r){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){return[2,fye(this,t,r)]})})},e.prototype.trainOnBatch=function(t,r){return Ce(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f,h,p,d,v,m;return Ee(this,function(g){switch(g.label){case 0:return[4,this.standardizeUserData(t,r)];case 1:a=g.sent(),i=a[0],o=a[1],s=this.makeTrainFunction(),u=s(i.concat(o)),c=[],g.label=2;case 2:g.trys.push([2,7,8,9]),l=fe(u),f=l.next(),g.label=3;case 3:return f.done?[3,6]:(h=f.value,[4,h.data()]);case 4:p=g.sent(),c.push(p[0]),g.label=5;case 5:return f=l.next(),[3,3];case 6:return[3,9];case 7:return d=g.sent(),v={error:d},[3,9];case 8:try{f&&!f.done&&(m=l.return)&&m.call(l)}finally{if(v)throw v.error}return[7];case 9:return _.dispose(u),oi(a[0],t),oi(a[1],r),[2,Ir(c)]}})})},e.prototype.getNamedWeights=function(t){for(var r=[],a=t!=null&&t.trainableOnly,i=a?this.trainableWeights:this.weights,o=this.getWeights(a),s=0;s<i.length;++s)a&&!i[s].trainable||r.push({name:i[s].originalName,tensor:o[s]});return r},Object.defineProperty(e.prototype,"stopTraining",{get:function(){return this.stopTraining_},set:function(t){this.stopTraining_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"optimizer",{get:function(){return this.optimizer_},set:function(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){var t=n.prototype.dispose.call(this);if(t.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){var r=_.memory().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=r-_.memory().numTensors}return t},e.prototype.getLossIdentifiers=function(){var t,r,a,i,o;if(typeof this.loss=="string")o=eo(this.loss);else if(Array.isArray(this.loss)){try{for(var s=fe(this.loss),u=s.next();!u.done;u=s.next()){var c=u.value;if(typeof c!="string")throw new Error("Serialization of non-string loss is not supported.")}}catch(v){t={error:v}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}o=this.loss.map(function(v){return eo(v)})}else{var l=Object.keys(this.loss);o={};var f=this.loss;try{for(var h=fe(l),p=h.next();!p.done;p=h.next()){var d=p.value;if(typeof f[d]=="string")o[d]=eo(f[d]);else throw new Error("Serialization of non-string loss is not supported.")}}catch(v){a={error:v}}finally{try{p&&!p.done&&(i=h.return)&&i.call(h)}finally{if(a)throw a.error}}}return o},e.prototype.getMetricIdentifiers=function(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[eo(bd(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(function(a){return eo(bd(a))});var t={};for(var r in this.metrics)t[r]=eo(bd(this.metrics[r]));return t},e.prototype.getTrainingConfig=function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}},e.prototype.loadTrainingConfig=function(t){if(t.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(t.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(t.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");var r=Nf(t.optimizer_config),a=ci(r),i;if(typeof t.loss=="string")i=Ds(t.loss);else if(Array.isArray(t.loss))i=t.loss.map(function(u){return Ds(u)});else if(t.loss!=null){i={};for(var o in t.loss)i[o]=Ds(t.loss[o])}var s;if(Array.isArray(t.metrics))s=t.metrics.map(function(u){return Ds(u)});else if(t.metrics!=null){s={};for(var o in t.metrics)s[o]=Ds(t.metrics[o])}this.compile({loss:i,metrics:s,optimizer:a})},e.prototype.save=function(t,r){return Ce(this,void 0,void 0,function(){var a,i,o,s,u,c,l,f,h,p,d,v,m,g,y;return Ee(this,function(b){switch(b.label){case 0:if(typeof t=="string"){if(a=R.io.getSaveHandlers(t),a.length===0)throw new Z("Cannot find any save handlers for URL '".concat(t,"'"));if(a.length>1)throw new Z("Found more than one (".concat(a.length,") save handlers for ")+"URL '".concat(t,"'"));t=a[0]}if(t.save==null)throw new Z("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[4,R.io.encodeWeights(this.getNamedWeights(r))];case 1:return i=b.sent(),o=!1,s=null,u=this.toJSON(s,o),c={modelTopology:u,format:bye,generatedBy:"TensorFlow.js tfjs-layers v".concat(Fb),convertedBy:null},l=r==null?!1:r.includeOptimizer,l&&this.optimizer!=null?(c.trainingConfig=this.getTrainingConfig(),f="optimizer",m=(v=R.io).encodeWeights,[4,this.optimizer.getWeights()]):[3,4];case 2:return[4,m.apply(v,[b.sent(),f])];case 3:h=b.sent(),p=h.data,d=h.specs,(y=i.specs).push.apply(y,Qe([],te(d),!1)),i.data=R.io.concatenateArrayBuffers([i.data,p]),b.label=4;case 4:return this.userDefinedMetadata!=null&&(g=!0,gO(this.userDefinedMetadata,this.name,g),c.userDefinedMetadata=this.userDefinedMetadata),c.weightData=i.data,c.weightSpecs=i.specs,[2,t.save(c)]}})})},e.prototype.setUserDefinedMetadata=function(t){gO(t,this.name),this.userDefinedMetadata=t},e.prototype.getUserDefinedMetadata=function(){return this.userDefinedMetadata},e}(oye);to.className="Model";R.serialization.registerClass(to);var bM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e}(to);bM.className="Functional";R.serialization.registerClass(bM);function wye(n,e){return Ce(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f;return Ee(this,function(h){switch(h.label){case 0:return"modelTopology"in n||(n={modelTopology:n}),n=n,t=n.modelTopology,t.model_config!=null&&(t=t.model_config),r=Nf(t),a=ci(r,e),n.weightsManifest==null?[3,2]:[4,R.io.loadWeights(n.weightsManifest,n.pathPrefix,a.weights.map(function(p){return p.originalName}))];case 1:i=h.sent(),o={};try{for(s=fe(a.weights),u=s.next();!u.done;u=s.next())c=u.value,o[c.originalName]=i[c.originalName]}catch(p){l={error:p}}finally{try{u&&!u.done&&(f=s.return)&&f.call(s)}finally{if(l)throw l.error}}a.loadWeights(o),R.dispose(i),h.label=2;case 2:return[2,a]}})})}function xye(n,e){return Ce(this,void 0,void 0,function(){var t;return Ee(this,function(r){if(e==null&&(e={}),typeof n=="string"){if(t=R.io.getLoadHandlers(n,e),t.length===0)t.push(R.io.browserHTTPRequest(n,e));else if(t.length>1)throw new Z("Found more than one (".concat(t.length,") load handlers for ")+"URL '".concat(n,"'"));n=t[0]}return[2,kye(n,void 0,e)]})})}function kye(n,e,t){return Ce(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f;return Ee(this,function(h){switch(h.label){case 0:if(t==null&&(t={}),n.load==null)throw new Z("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return[4,n.load()];case 1:if(r=h.sent(),a=r.modelTopology,a.model_config!=null&&(a=a.model_config),i=t.strict==null?!0:t.strict,o=r.weightData!=null&&r.weightSpecs!=null&&i,s=ci(Nf(a),e,o),u=r.trainingConfig,u!=null&&s.loadTrainingConfig(u),r.userDefinedMetadata!=null&&s.setUserDefinedMetadata(r.userDefinedMetadata),r.weightData==null)return[3,4];if(r.weightSpecs==null)throw new Z("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");return c=Sye(r.weightData,r.weightSpecs),l=c.modelWeights,f=c.optimizerWeights,s.loadWeights(l,i),s.optimizer!=null&&f.length>0?[4,s.optimizer.setWeights(f)]:[3,3];case 2:h.sent(),h.label=3;case 3:R.dispose(l),R.dispose(f.map(function(p){return p.tensor})),h.label=4;case 4:return[2,s]}})})}function Sye(n,e){var t=R.io.decodeWeights(n,e),r={},a=[];return e.forEach(function(i){i.group==="optimizer"?a.push({name:i.name,tensor:t[i.name]}):r[i.name]=t[i.name]}),{modelWeights:r,optimizerWeights:a}}var av=function(n){se(e,n);function e(t){var r,a,i=n.call(this,{inputs:[],outputs:[]})||this;if(t=t||{},i.trainable=!0,i.built=!1,i.name=t.name!=null?t.name:Vd("sequential_"),t.layers!=null)try{for(var o=fe(t.layers),s=o.next();!s.done;s=o.next()){var u=s.value;i.add(u)}}catch(c){r={error:c}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}return i}return e.prototype.checkShape=function(t){var r=t.inboundNodes[0].outputTensors[0].shape;if(r.some(function(a){return a<0}))throw new Z("Negative dimension size caused by adding layer "+"".concat(t.name," with input shape [")+"".concat(t.inboundNodes[0].inputTensors[0].shape,"]"))},e.prototype.add=function(t){var r=t instanceof e||t instanceof to,a;if(r){if(a=t,a.outputs.length!==1)throw new Z("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(a.inputs.length!==1)throw new Z("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(t.inboundNodes.length===0){if(t.batchInputShape==null)throw new Z("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var i=$O({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(i)}if(r)this.outputs=a.outputs,this.inputs=a.inputs;else{if(t.inboundNodes.length!==1)throw new Z("A layer added to a Sequential model must not already be "+"connected somewhere else. LayersModel received layer ".concat(t.name," ")+"which has ".concat(t.inboundNodes.length," pre-existing inbound ")+"connections.");if(t.inboundNodes[0].outputTensors.length!==1)throw new Z("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=zO(this.outputs[0])}this.inboundNodes=[],new Jd({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Ps(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(function(s){return s.shape}),outputShapes:this.outputs[0].shape})}else{var o=t.apply(this.outputs[0]);if(Array.isArray(o))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[o],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1},e.prototype.pop=function(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}},e.prototype.call=function(t,r){return this.model==null&&this.build(),this.model.call(t,r)},e.prototype.build=function(t){if(Et(t),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new to({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0},e.prototype.countParams=function(){return this.built||this.build(),n.prototype.countParams.call(this)},e.prototype.summary=function(t,r,a){a===void 0&&(a=console.log),this.built||this.build(),n.prototype.summary.call(this,t,r,a)},e.prototype.setWeights=function(t){this.model==null&&this.build(),this.model.setWeights(t)},e.prototype.evaluate=function(t,r,a){if(a===void 0&&(a={}),!this.built)throw new Fi("The model needs to be compiled before being used.");return this.model.evaluate(t,r,a)},e.prototype.evaluateDataset=function(t,r){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){if(!this.built)throw new Fi("The model needs to be compiled before being used.");return[2,this.model.evaluateDataset(t,r)]})})},e.prototype.predict=function(t,r){return r===void 0&&(r={}),this.model==null&&this.build(),this.model.predict(t,r)},e.prototype.predictOnBatch=function(t){return this.model==null&&this.build(),this.model.predictOnBatch(t)},e.prototype.compile=function(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames},Object.defineProperty(e.prototype,"optimizer",{get:function(){return this.model==null?void 0:this.model.optimizer},set:function(t){this.model.optimizer=t},enumerable:!1,configurable:!0}),e.prototype.fit=function(t,r,a){return a===void 0&&(a={}),Ce(this,void 0,void 0,function(){return Ee(this,function(i){if(!this.built)throw new Fi("The model needs to be compiled before being used.");return[2,this.model.fit(t,r,a)]})})},e.prototype.fitDataset=function(t,r){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){if(!this.built)throw new Fi("The model needs to be compiled before being used.");return[2,this.model.fitDataset(t,r)]})})},e.prototype.trainOnBatch=function(t,r){return Ce(this,void 0,void 0,function(){return Ee(this,function(a){return[2,this.model.trainOnBatch(t,r)]})})},e.fromConfig=function(t,r,a,i){var o,s;i===void 0&&(i=!1);var u,c={};if(r instanceof Array){if(r[0].className==null||r[0].className==="Merge")throw new Z("Legacy serialization format not supported yet.");u=r}else R.util.assert(r.layers!=null,function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."}),u=r.layers,delete r.layers,c=r;var l=new t(c);if(!(l instanceof e))throw new dt("Sequential.fromConfig called on non-Sequential input: ".concat(l));try{for(var f=fe(u),h=f.next();!h.done;h=f.next()){var p=h.value,d=void 0,v=ci(p,d,i);i&&v.setFastWeightInitDuringBuild(!0),l.add(v)}}catch(m){o={error:m}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}return l},Object.defineProperty(e.prototype,"stopTraining",{get:function(){if(this.model==null)throw new Z("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(t){if(this.model==null)throw new Z("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t},enumerable:!1,configurable:!0}),e.prototype.getConfig=function(){var t,r,a=[];try{for(var i=fe(this.layers),o=i.next();!o.done;o=i.next()){var s=o.value,u={};u.className=s.getClassName(),u.config=s.getConfig(),a.push(u)}}catch(c){t={error:c}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return{name:this.name,layers:a}},e}(to);av.className="Sequential";R.serialization.registerClass(av);function Nye(n){return new to(n)}function Tye(n){return new av(n)}function wM(n){return $O(n)}function Eye(n,e){Ib.registerCallbackConstructor(n,e)}var Ar=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getConfig=function(){return{}},e}(R.serialization.Serializable),xM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t,r){return r===void 0&&(r=1),Kle(t,r)},e}(Ar);xM.className="elu";R.serialization.registerClass(xM);var kM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return _.selu(t)},e}(Ar);kM.className="selu";R.serialization.registerClass(kM);var SM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return _.relu(t)},e}(Ar);SM.className="relu";R.serialization.registerClass(SM);var NM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return R.tidy(function(){return _.minimum(6,_.relu(t))})},e}(Ar);NM.className="relu6";R.serialization.registerClass(NM);var TM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return t},e}(Ar);TM.className="linear";R.serialization.registerClass(TM);var EM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return _.sigmoid(t)},e}(Ar);EM.className="sigmoid";R.serialization.registerClass(EM);var IM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return Xle(t)},e}(Ar);IM.className="hardSigmoid";R.serialization.registerClass(IM);var CM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return _.softplus(t)},e}(Ar);CM.className="softplus";R.serialization.registerClass(CM);var AM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return jle(t)},e}(Ar);AM.className="softsign";R.serialization.registerClass(AM);var _M=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return _.tanh(t)},e}(Ar);_M.className="tanh";R.serialization.registerClass(_M);var Rb=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t,r){return r===void 0&&(r=-1),_.softmax(t,r)},e}(Ar);Rb.className="softmax";R.serialization.registerClass(Rb);var DM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t,r){return r===void 0&&(r=-1),_.logSoftmax(t,r)},e}(Ar);DM.className="logSoftmax";R.serialization.registerClass(DM);var FM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t,r){return r===void 0&&(r=1),R.tidy(function(){return _.mul(_.sigmoid(_.mul(t,r)),t)})},e}(Ar);FM.className="swish";R.serialization.registerClass(FM);var RM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.apply=function(t){return R.tidy(function(){return _.mul(t,_.tanh(_.softplus(t)))})},e}(Ar);RM.className="mish";R.serialization.registerClass(RM);function qo(n){return n.getClassName()}function Ny(n,e){return e===void 0&&(e={}),Ef(n,R.serialization.SerializationMap.getMap().classNameMap,e,"activation")}function Wo(n){if(n==null){var e={};return e.className="linear",e.config={},Ny(e)}if(typeof n=="string"){var e={};return e.className=n,e.config={},Ny(e)}else return n instanceof Ar?n:Ny(n)}function Ob(n){if(n!=null&&typeof n!="object")throw new Error("Argument to L1L2 regularizer's constructor is expected to be an "+"object, but received: ".concat(n))}var OM=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e}(R.serialization.Serializable),Rf=function(n){se(e,n);function e(t){var r=n.call(this)||this;return Ob(t),r.l1=t==null||t.l1==null?.01:t.l1,r.l2=t==null||t.l2==null?.01:t.l2,r.hasL1=r.l1!==0,r.hasL2=r.l2!==0,r}return e.prototype.apply=function(t){var r=this;return R.tidy(function(){var a=R.zeros([1]);return r.hasL1&&(a=R.add(a,R.sum(_.mul(r.l1,R.abs(t))))),r.hasL2&&(a=R.add(a,R.sum(_.mul(r.l2,Cf(t))))),_.reshape(a,[])})},e.prototype.getConfig=function(){return{l1:this.l1,l2:this.l2}},e.fromConfig=function(t,r){return new t({l1:r.l1,l2:r.l2})},e}(OM);Rf.className="L1L2";R.serialization.registerClass(Rf);function Iye(n){return Ob(n),new Rf({l1:n!=null?n.l1:null,l2:0})}function Cye(n){return Ob(n),new Rf({l2:n!=null?n.l2:null,l1:0})}var SO={l1l2:"L1L2"};function zt(n){return Gy(n)}function NO(n,e){return e===void 0&&(e={}),Ef(n,R.serialization.SerializationMap.getMap().classNameMap,e,"regularizer")}function ln(n){if(n==null)return null;if(typeof n=="string"){var e=n in SO?SO[n]:n,t={className:e,config:{}};return NO(t)}else return n instanceof OM?n:NO(n)}var Pb=function(n){se(e,n);function e(t){var r=n.call(this,t??{})||this;return r.supportsMasking=!0,t!=null&&(r.maxValue=t.maxValue),r}return e.prototype.call=function(t,r){t=it(t);var a=R.relu(t);return this.maxValue!=null&&(a=R.clipByValue(a,0,this.maxValue)),a},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={maxValue:this.maxValue},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);Pb.className="ReLU";R.serialization.registerClass(Pb);var Mb=function(n){se(e,n);function e(t){var r=n.call(this,t??{})||this;return r.DEFAULT_ALPHA=.3,t==null&&(t={}),r.alpha=t.alpha==null?r.DEFAULT_ALPHA:t.alpha,r}return e.prototype.call=function(t,r){var a=it(t);return R.leakyRelu(a,this.alpha)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={alpha:this.alpha},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);Mb.className="LeakyReLU";R.serialization.registerClass(Mb);var Bb=function(n){se(e,n);function e(t){var r=n.call(this,t??{})||this;if(r.DEFAULT_ALPHA_INITIALIZER="zeros",t==null&&(t={}),r.supportsMasking=!0,r.alphaInitializer=cn(t.alphaInitializer||r.DEFAULT_ALPHA_INITIALIZER),r.alphaRegularizer=ln(t.alphaRegularizer),r.alphaConstraint=Vn(t.alphaConstraint),t.sharedAxes==null)r.sharedAxes=null;else if(Array.isArray(t.sharedAxes))r.sharedAxes=t.sharedAxes;else if(typeof t.sharedAxes=="number")r.sharedAxes=[t.sharedAxes];else throw new Z("Expected sharedAxes to be a number or an array of numbers, "+"but got ".concat(t.sharedAxes));return r}return e.prototype.build=function(t){var r,a;t=Et(t);var i=t.slice(1);if(this.sharedAxes!=null)try{for(var o=fe(this.sharedAxes),s=o.next();!s.done;s=o.next()){var u=s.value;i[u-1]=1}}catch(l){r={error:l}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}this.alpha=this.addWeight("alpha",i,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var c={};if(this.sharedAxes!=null)for(var u=1;u<t.length;++u)c[u]=t[u];this.inputSpec=[new Ln({ndim:t.length,axes:c})],this.built=!0},e.prototype.call=function(t,r){return t=it(t),R.prelu(t,this.alpha.read())},e.prototype.getConfig=function(){var t={alphaInitializer:mn(this.alphaInitializer),alphaRegularizer:zt(this.alphaRegularizer),alphaConstraint:Wn(this.alphaConstraint),sharedAxes:this.sharedAxes},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);Bb.className="PReLU";R.serialization.registerClass(Bb);var Lb=function(n){se(e,n);function e(t){var r=n.call(this,t??{})||this;if(r.DEFAULT_ALPHA=1,t==null&&(t={}),t.alpha!=null&&t.alpha!==r.DEFAULT_ALPHA)throw new dt("Non-default alpha value (".concat(t.alpha,") is not supported by the ")+"ELU layer yet.");return r.alpha=t.alpha==null?r.DEFAULT_ALPHA:t.alpha,r}return e.prototype.call=function(t,r){var a=it(t);return R.elu(a)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={alpha:this.alpha},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);Lb.className="ELU";R.serialization.registerClass(Lb);var zb=function(n){se(e,n);function e(t){var r=n.call(this,t??{})||this;return r.DEFAULT_THETA=1,t==null&&(t={}),r.theta=t.theta==null?r.DEFAULT_THETA:t.theta,r}return e.prototype.call=function(t,r){var a=it(t);return R.mul(a,R.cast(R.greater(a,this.theta),"float32"))},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={theta:this.theta},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);zb.className="ThresholdedReLU";R.serialization.registerClass(zb);var $b=function(n){se(e,n);function e(t){var r=n.call(this,t??{})||this;return r.DEFAULT_AXIS=1,t==null&&(t={}),r.softmax=new Rb().apply,r.axis=t.axis==null?r.DEFAULT_AXIS:t.axis,r}return e.prototype.call=function(t,r){var a=it(t);return this.softmax(a,this.axis)},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t={axis:this.axis},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);$b.className="Softmax";R.serialization.registerClass($b);function uc(n,e,t){if(typeof n=="number")return Ps(n,e);if(n.length!==e)throw new Z("The ".concat(t," argument must be an integer or tuple of ").concat(e," integers.")+" Received: ".concat(n.length," elements."));for(var r=0;r<e;++r){var a=n[r];if(!Vle(a))throw new Z("The ".concat(t," argument must be an integer or tuple of ").concat(e)+" integers. Received: ".concat(JSON.stringify(n)," including a")+" non-integer number ".concat(a))}return n}function li(n,e,t,r,a){if(a===void 0&&(a=1),n==null)return n;var i=e+(e-1)*(a-1),o;return t==="same"?o=n:o=n-i+1,Math.floor((o+r-1)/r)}function Di(n,e,t,r){if(n==null)return null;if(r==="valid")n=n*e+$o([t-e,0]);else if(r==="same")n=n*e;else throw new Z("Unsupport padding mode: ".concat(r,"."));return n}function qb(n,e){return R.tidy(function(){return Dn(e),e==="channelsFirst"?_.transpose(n,[0,2,3,1]):n})}function PM(n,e){return R.tidy(function(){return Dn(e),e==="channelsFirst"?_.transpose(n,[0,2,3,4,1]):n})}function Aye(n,e,t,r,a,i,o){return r===void 0&&(r=1),a===void 0&&(a="valid"),o===void 0&&(o=1),R.tidy(function(){if(i==null&&(i=hi()),Dn(i),n.shape.length!==3)throw new Z("The input of a conv1dWithBias operation should be 3, but is "+"".concat(n.shape.length," instead."));if(e.shape.length!==3)throw new Z("The kernel for a conv1dWithBias operation should be 3, but is "+"".concat(e.shape.length," instead"));if(t!=null&&t.shape.length!==1)throw new Z("The bias for a conv1dWithBias operation should be 1, but is "+"".concat(e.shape.length," instead"));if(i==="channelsFirst"&&(n=_.transpose(n,[0,2,1])),a==="causal")throw new dt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=_.conv1d(n,e,r,a==="same"?"same":"valid","NWC",o);return t!=null&&(s=vi(s,t)),s})}function TO(n,e,t,r,a,i,o,s){return r===void 0&&(r=[1,1]),a===void 0&&(a="valid"),s===void 0&&(s=null),R.tidy(function(){if(i==null&&(i=hi()),Dn(i),n.rank!==3&&n.rank!==4)throw new Z("conv2dWithBiasActivation expects input to be of rank 3 or 4, "+"but received ".concat(n.rank,"."));if(e.rank!==3&&e.rank!==4)throw new Z("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, "+"but received ".concat(n.rank,"."));var u=qb(n,i);if(a==="causal")throw new dt("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=_.fused.conv2d({x:u,filter:e,strides:r,pad:a==="same"?"same":"valid",dilations:o,dataFormat:"NHWC",bias:t,activation:s}),i==="channelsFirst"&&(u=_.transpose(u,[0,3,1,2])),u})}function _ye(n,e,t,r,a,i,o){return r===void 0&&(r=[1,1,1]),a===void 0&&(a="valid"),R.tidy(function(){if(i==null&&(i=hi()),Dn(i),n.rank!==4&&n.rank!==5)throw new Z("conv3dWithBias expects input to be of rank 4 or 5, but received "+"".concat(n.rank,"."));if(e.rank!==4&&e.rank!==5)throw new Z("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+"".concat(n.rank,"."));var s=PM(n,i);if(a==="causal")throw new dt("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=_.conv3d(s,e,r,a==="same"?"same":"valid","NDHWC",o),t!=null&&(s=vi(s,t)),i==="channelsFirst"&&(s=_.transpose(s,[0,4,1,2,3])),s})}var MM=function(n){se(e,n);function e(t,r){var a=n.call(this,r)||this;if(a.bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",e.verifyArgs(r),a.rank=t,Kn(a.rank,"rank"),a.rank!==1&&a.rank!==2&&a.rank!==3)throw new dt("Convolution layer for rank other than 1, 2, or 3 (".concat(a.rank,") is ")+"not implemented yet.");if(a.kernelSize=uc(r.kernelSize,t,"kernelSize"),a.strides=uc(r.strides==null?1:r.strides,t,"strides"),a.padding=r.padding==null?"valid":r.padding,da(a.padding),a.dataFormat=r.dataFormat==null?"channelsLast":r.dataFormat,Dn(a.dataFormat),a.activation=Wo(r.activation),a.useBias=r.useBias==null?!0:r.useBias,a.biasInitializer=cn(r.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=Vn(r.biasConstraint),a.biasRegularizer=ln(r.biasRegularizer),a.activityRegularizer=ln(r.activityRegularizer),a.dilationRate=uc(r.dilationRate==null?1:r.dilationRate,t,"dilationRate"),a.rank===1&&Array.isArray(a.dilationRate)&&a.dilationRate.length!==1)throw new Z("dilationRate must be a number or an array of a single number for 1D convolution, but received "+"".concat(JSON.stringify(a.dilationRate)));if(a.rank===2){if(typeof a.dilationRate=="number")a.dilationRate=[a.dilationRate,a.dilationRate];else if(a.dilationRate.length!==2)throw new Z("dilationRate must be a number or array of two numbers for 2D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)))}else if(a.rank===3){if(typeof a.dilationRate=="number")a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(a.dilationRate.length!==3)throw new Z("dilationRate must be a number or array of three numbers for 3D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)))}return a}return e.verifyArgs=function(t){if(_i("kernelSize"in t,"required key 'kernelSize' not in config"),typeof t.kernelSize!="number"&&!Uy(t.kernelSize,"number",1,3))throw new Z("BaseConv expects config.kernelSize to be number or number[] with "+"length 1, 2, or 3, but received ".concat(JSON.stringify(t.kernelSize),"."))},e.prototype.getConfig=function(){var t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:qo(this.activation),useBias:this.useBias,biasInitializer:mn(this.biasInitializer),biasRegularizer:zt(this.biasRegularizer),activityRegularizer:zt(this.activityRegularizer),biasConstraint:Wn(this.biasConstraint)},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt),iv=function(n){se(e,n);function e(t,r){var a=n.call(this,t,r)||this;return a.kernel=null,e.verifyArgs(r),a.filters=r.filters,Kn(a.filters,"filters"),a.kernelInitializer=cn(r.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=Vn(r.kernelConstraint),a.kernelRegularizer=ln(r.kernelRegularizer),a}return e.prototype.build=function(t){var r;t=Et(t);var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new Z("The channel dimension of the input should be defined. "+"Found ".concat(t[a]));var i=t[a],o=this.kernelSize.concat([i,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(r={},r[a]=i,r)}],this.built=!0},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){t=it(t);var i,o=a.bias==null?null:a.bias.read(),s=_O(a.activation.getClassName());if(s!=null&&a.rank===2)i=TO(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate,s);else{if(a.rank===1)i=Aye(t,a.kernel.read(),o,a.strides[0],a.padding,a.dataFormat,a.dilationRate[0]);else if(a.rank===2)i=TO(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate);else if(a.rank===3)i=_ye(t,a.kernel.read(),o,a.strides,a.padding,a.dataFormat,a.dilationRate);else throw new dt("convolutions greater than 3D are not implemented yet.");a.activation!=null&&(i=a.activation.apply(i))}return i})},e.prototype.computeOutputShape=function(t){t=Et(t);for(var r=[],a=this.dataFormat==="channelsLast"?t.slice(1,t.length-1):t.slice(2),i=0;i<a.length;++i){var o=li(a[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);r.push(o)}var s=[t[0]];return this.dataFormat==="channelsLast"?(s=s.concat(r),s.push(this.filters)):(s.push(this.filters),s=s.concat(r)),s},e.prototype.getConfig=function(){var t={filters:this.filters,kernelInitializer:mn(this.kernelInitializer),kernelRegularizer:zt(this.kernelRegularizer),kernelConstraint:Wn(this.kernelConstraint)},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e.verifyArgs=function(t){if(!("filters"in t)||typeof t.filters!="number"||t.filters<1)throw new Z("Convolution layer expected config.filters to be a 'number' > 0 "+"but got ".concat(JSON.stringify(t.filters)))},e}(MM),ov=function(n){se(e,n);function e(t){var r=n.call(this,2,t)||this;return e.verifyArgs(t),r}return e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this);return delete t.rank,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!Uy(t.kernelSize,"number",1,2))throw new Z("Conv2D expects config.kernelSize to be number or number[] with "+"length 1 or 2, but received ".concat(JSON.stringify(t.kernelSize),"."))},e}(iv);ov.className="Conv2D";R.serialization.registerClass(ov);var sv=function(n){se(e,n);function e(t){var r=n.call(this,3,t)||this;return e.verifyArgs(t),r}return e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this);return delete t.rank,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!(Array.isArray(t.kernelSize)&&(t.kernelSize.length===1||t.kernelSize.length===3)))throw new Z("Conv3D expects config.kernelSize to be number or"+" [number, number, number], but received ".concat(JSON.stringify(t.kernelSize),"."))},e}(iv);sv.className="Conv3D";R.serialization.registerClass(sv);var Wb=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;if(r.inputSpec=[new Ln({ndim:4})],r.padding!=="same"&&r.padding!=="valid")throw new Z("Conv2DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(r.padding));return r}return e.prototype.build=function(t){var r;if(t=Et(t),t.length!==4)throw new Z("Input should have rank 4; Received input shape: "+JSON.stringify(t));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new Z("The channel dimension of the inputs should be defined. Found `None`.");var i=t[a],o=this.kernelSize.concat([this.filters,i]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Ln({ndim:4,axes:(r={},r[a]=i,r)})],this.built=!0},e.prototype.call=function(t,r){var a=this;return _.tidy(function(){var i=it(t);if(i.shape.length!==4)throw new Z("Conv2DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(i.shape.length));var o=i.shape,s=o[0],u,c;a.dataFormat==="channelsFirst"?(u=2,c=3):(u=1,c=2);var l=o[u],f=o[c],h=a.kernelSize[0],p=a.kernelSize[1],d=a.strides[0],v=a.strides[1],m=Di(l,d,h,a.padding),g=Di(f,v,p,a.padding),y=[s,m,g,a.filters];a.dataFormat!=="channelsLast"&&(i=_.transpose(i,[0,2,3,1]));var b=_.conv2dTranspose(i,a.kernel.read(),y,a.strides,a.padding);return a.dataFormat!=="channelsLast"&&(b=_.transpose(b,[0,3,1,2])),a.bias!=null&&(b=vi(b,a.bias.read(),a.dataFormat)),a.activation!=null&&(b=a.activation.apply(b)),b})},e.prototype.computeOutputShape=function(t){t=Et(t);var r=t.slice(),a,i,o;this.dataFormat==="channelsFirst"?(a=1,i=2,o=3):(a=3,i=1,o=2);var s=this.kernelSize[0],u=this.kernelSize[1],c=this.strides[0],l=this.strides[1];return r[a]=this.filters,r[i]=Di(r[i],c,s,this.padding),r[o]=Di(r[o],l,u,this.padding),r},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this);return delete t.dilationRate,t},e}(ov);Wb.className="Conv2DTranspose";R.serialization.registerClass(Wb);var Vb=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;if(r.inputSpec=[new Ln({ndim:5})],r.padding!=="same"&&r.padding!=="valid")throw new Z("Conv3DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(r.padding));return r}return e.prototype.build=function(t){var r;if(t=Et(t),t.length!==5)throw new Z("Input should have rank 5; Received input shape: "+JSON.stringify(t));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new Z("The channel dimension of the inputs should be defined. Found `None`.");var i=t[a],o=this.kernelSize.concat([this.filters,i]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Ln({ndim:5,axes:(r={},r[a]=i,r)})],this.built=!0},e.prototype.call=function(t,r){var a=this;return _.tidy(function(){var i=it(t);if(i.shape.length!==5)throw new Z("Conv3DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(i.shape.length));var o=i.shape,s=o[0],u,c,l;a.dataFormat==="channelsFirst"?(l=2,u=3,c=4):(l=1,u=2,c=3);var f=o[l],h=o[u],p=o[c],d=a.kernelSize[0],v=a.kernelSize[1],m=a.kernelSize[2],g=a.strides[0],y=a.strides[1],b=a.strides[2],w=Di(f,g,d,a.padding),x=Di(h,y,v,a.padding),N=Di(p,b,m,a.padding),T=[s,w,x,N,a.filters];a.dataFormat!=="channelsLast"&&(i=_.transpose(i,[0,2,3,4,1]));var E=_.conv3dTranspose(i,a.kernel.read(),T,a.strides,a.padding);return a.dataFormat!=="channelsLast"&&(E=_.transpose(E,[0,4,1,2,3])),a.bias!==null&&(E=vi(E,a.bias.read(),a.dataFormat)),a.activation!==null&&(E=a.activation.apply(E)),E})},e.prototype.computeOutputShape=function(t){t=Et(t);var r=t.slice(),a,i,o,s;this.dataFormat==="channelsFirst"?(a=1,i=2,o=3,s=4):(a=4,i=1,o=2,s=3);var u=this.kernelSize[0],c=this.kernelSize[1],l=this.kernelSize[2],f=this.strides[0],h=this.strides[1],p=this.strides[2];return r[a]=this.filters,r[i]=Di(r[i],f,u,this.padding),r[o]=Di(r[o],h,c,this.padding),r[s]=Di(r[s],p,l,this.padding),r},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this);return delete t.dilationRate,t},e}(sv);Vb.className="Conv3DTranspose";R.serialization.registerClass(Vb);var BM=function(n){se(e,n);function e(t,r){var a=n.call(this,t,r)||this;if(a.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,r.filters==null)throw new Z("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(r.kernelInitializer!=null||r.kernelRegularizer!=null||r.kernelConstraint!=null)throw new Z("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(r.padding!=null&&r.padding!=="same"&&r.padding!=="valid")throw new Z("SeparableConv".concat(a.rank,"D supports only padding modes: ")+"'same' and 'valid', but received ".concat(JSON.stringify(r.padding)));return a.depthMultiplier=r.depthMultiplier==null?1:r.depthMultiplier,a.depthwiseInitializer=cn(r.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=ln(r.depthwiseRegularizer),a.depthwiseConstraint=Vn(r.depthwiseConstraint),a.pointwiseInitializer=cn(r.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=ln(r.pointwiseRegularizer),a.pointwiseConstraint=Vn(r.pointwiseConstraint),a}return e.prototype.build=function(t){var r;if(t=Et(t),t.length<this.rank+2)throw new Z("Inputs to SeparableConv".concat(this.rank,"D should have rank ")+"".concat(this.rank+2,", but received input shape: ")+"".concat(JSON.stringify(t)));var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null||t[a]<0)throw new Z("The channel dimension of the inputs should be defined, "+"but found ".concat(JSON.stringify(t[a])));for(var i=t[a],o=this.kernelSize.concat([i,this.depthMultiplier]),s=[],u=0;u<this.rank;++u)s.push(1);s.push(i*this.depthMultiplier,this.filters);var c=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",o,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,c,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",s,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,c,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,c,this.biasConstraint):this.bias=null,this.inputSpec=[new Ln({ndim:this.rank+2,axes:(r={},r[a]=i,r)})],this.built=!0},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){t=it(t);var i;if(a.rank===1)throw new dt("1D separable convolution is not implemented yet.");return a.rank===2&&(a.dataFormat==="channelsFirst"&&(t=_.transpose(t,[0,2,3,1])),i=_.separableConv2d(t,a.depthwiseKernel.read(),a.pointwiseKernel.read(),a.strides,a.padding,a.dilationRate,"NHWC")),a.useBias&&(i=vi(i,a.bias.read(),a.dataFormat)),a.activation!=null&&(i=a.activation.apply(i)),a.dataFormat==="channelsFirst"&&(i=_.transpose(i,[0,3,1,2])),i})},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this);return delete t.rank,delete t.kernelInitializer,delete t.kernelRegularizer,delete t.kernelConstraint,t.depthwiseInitializer=mn(this.depthwiseInitializer),t.pointwiseInitializer=mn(this.pointwiseInitializer),t.depthwiseRegularizer=zt(this.depthwiseRegularizer),t.pointwiseRegularizer=zt(this.pointwiseRegularizer),t.depthwiseConstraint=Wn(this.depthwiseConstraint),t.pointwiseConstraint=Wn(this.pointwiseConstraint),t},e}(iv);BM.className="SeparableConv";var Gb=function(n){se(e,n);function e(t){return n.call(this,2,t)||this}return e}(BM);Gb.className="SeparableConv2D";R.serialization.registerClass(Gb);var Ub=function(n){se(e,n);function e(t){var r=n.call(this,1,t)||this;return e.verifyArgs(t),r.inputSpec=[{ndim:3}],r}return e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this);return delete t.rank,delete t.dataFormat,t},e.verifyArgs=function(t){if(typeof t.kernelSize!="number"&&!Uy(t.kernelSize,"number",1,1))throw new Z("Conv1D expects config.kernelSize to be number or number[] with "+"length 1, but received ".concat(JSON.stringify(t.kernelSize),"."))},e}(iv);Ub.className="Conv1D";R.serialization.registerClass(Ub);var Hb=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return typeof t.cropping=="number"?r.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:typeof t.cropping[0]=="number"?r.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:r.cropping=t.cropping,r.dataFormat=t.dataFormat===void 0?"channelsLast":t.dataFormat,r.inputSpec=[{ndim:4}],r}return e.prototype.computeOutputShape=function(t){return this.dataFormat==="channelsFirst"?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){if(t=it(t),a.dataFormat==="channelsLast"){var i=yd(t,a.cropping[0][0],t.shape[1]-a.cropping[0][0]-a.cropping[0][1],2);return yd(i,a.cropping[1][0],t.shape[2]-a.cropping[1][1]-a.cropping[1][0],3)}else{var i=yd(t,a.cropping[0][0],t.shape[2]-a.cropping[0][0]-a.cropping[0][1],3);return yd(i,a.cropping[1][0],t.shape[3]-a.cropping[1][1]-a.cropping[1][0],4)}})},e.prototype.getConfig=function(){var t={cropping:this.cropping,dataFormat:this.dataFormat},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);Hb.className="Cropping2D";R.serialization.registerClass(Hb);var Kb=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.DEFAULT_SIZE=[2,2],r.inputSpec=[{ndim:4}],r.size=t.size==null?r.DEFAULT_SIZE:t.size,r.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Dn(r.dataFormat),r.interpolation=t.interpolation==null?"nearest":t.interpolation,$le(r.interpolation),r}return e.prototype.computeOutputShape=function(t){if(this.dataFormat==="channelsFirst"){var r=t[2]==null?null:this.size[0]*t[2],a=t[3]==null?null:this.size[1]*t[3];return[t[0],t[1],r,a]}else{var r=t[1]==null?null:this.size[0]*t[1],a=t[2]==null?null:this.size[1]*t[2];return[t[0],r,a,t[3]]}},e.prototype.call=function(t,r){var a=this;return _.tidy(function(){var i=it(t),o=i.shape;if(a.dataFormat==="channelsFirst"){i=_.transpose(i,[0,2,3,1]);var s=a.size[0]*o[2],u=a.size[1]*o[3],c=a.interpolation==="nearest"?_.image.resizeNearestNeighbor(i,[s,u]):_.image.resizeBilinear(i,[s,u]);return _.transpose(c,[0,3,1,2])}else{var s=a.size[0]*o[1],u=a.size[1]*o[2];return a.interpolation==="nearest"?_.image.resizeNearestNeighbor(i,[s,u]):_.image.resizeBilinear(i,[s,u])}})},e.prototype.getConfig=function(){var t={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);Kb.className="UpSampling2D";R.serialization.registerClass(Kb);function Dye(n,e,t,r,a,i){return t===void 0&&(t=[1,1]),r===void 0&&(r="valid"),R.tidy(function(){a==null&&(a=hi()),Dn(a);var o=qb(n,a);if(n.rank!==4)throw new Z("Input for depthwiseConv2d is required to be 4-D, but is instead "+"".concat(n.rank,"-D"));if(e.rank!==4)throw new Z("depthwiseKernel is required to be 4-D, but is instead "+"".concat(e.rank,"-D"));return o=_.depthwiseConv2d(o,e,t,r==="same"?"same":"valid","NHWC",i),a==="channelsFirst"&&(o=_.transpose(o,[0,3,1,2])),o})}var jb=function(n){se(e,n);function e(t){var r=n.call(this,2,t)||this;return r.depthwiseKernel=null,r.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,r.depthwiseInitializer=cn(t.depthwiseInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.depthwiseConstraint=Vn(t.depthwiseConstraint),r.depthwiseRegularizer=ln(t.depthwiseRegularizer),r}return e.prototype.build=function(t){if(t=Et(t),t.length<4)throw new Z("Inputs to DepthwiseConv2D should have rank 4. "+"Received input shape: ".concat(JSON.stringify(t),"."));var r=this.dataFormat==="channelsFirst"?1:3;if(t[r]==null||t[r]<0)throw new Z("The channel dimension of the inputs to DepthwiseConv2D should "+"be defined, but is not (".concat(t[r],")."));var a=t[r],i=[this.kernelSize[0],this.kernelSize[1],a,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[a*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){t=it(t);var i=Dye(t,a.depthwiseKernel.read(),a.strides,a.padding,a.dataFormat,null);return a.useBias&&(i=vi(i,a.bias.read(),a.dataFormat)),a.activation!=null&&(i=a.activation.apply(i)),i})},e.prototype.computeOutputShape=function(t){t=Et(t);var r=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,o=li(r,this.kernelSize[0],this.padding,this.strides[0]),s=li(a,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[t[0],i,o,s]:[t[0],o,s,i]},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this);return t.depthMultiplier=this.depthMultiplier,t.depthwiseInitializer=mn(this.depthwiseInitializer),t.depthwiseRegularizer=zt(this.depthwiseRegularizer),t.depthwiseConstraint=Wn(this.depthwiseRegularizer),t},e}(MM);jb.className="DepthwiseConv2D";R.serialization.registerClass(jb);function LM(n,e,t,r){if(Array.isArray(n)){if(e!=null||t!=null)throw new Z("When inputs is an array, neither initialState or constants should be provided");r!=null&&(t=n.slice(n.length-r,n.length),n=n.slice(0,n.length-r)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function a(i){return i==null||Array.isArray(i)?i:[i]}return e=a(e),t=a(t),{inputs:n,initialState:e,constants:t}}function zM(n,e,t,r,a,i,o,s){return r===void 0&&(r=!1),o===void 0&&(o=!1),s===void 0&&(s=!1),_.tidy(function(){var u=e.shape.length;if(u<3)throw new Z("Input should be at least 3D, but is ".concat(u,"D."));var c=[1,0].concat(fi(2,u));if(e=_.transpose(e,c),i!=null)throw new dt("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),a!=null&&(a=_.cast(_.cast(a,"bool"),"float32"),a.rank===u-1&&(a=_.expandDims(a,-1)),a=_.transpose(a,c)),r&&(e=_.reverse(e,0),a!=null&&(a=_.reverse(a,0)));var l=[],f,h=t,p=e.shape[0],d=_.unstack(e),v;a!=null&&(v=_.unstack(a));for(var m=function(w){var x=d[w],N=_.tidy(function(){return n(x,h)});if(a==null)f=N[0],h=N[1];else{var T=_.tidy(function(){var E=v[w],C=_.sub(_.onesLike(E),E),F=_.add(_.mul(N[0],E),_.mul(h[0],C)),D=h.map(function(O,L){return _.add(_.mul(N[1][L],E),_.mul(O,C))});return{output:F,newStates:D}});f=T.output,h=T.newStates}s&&l.push(f)},g=0;g<p;++g)m(g);var y;if(s){var b=1;y=_.stack(l,b)}return[f,y,h]})}var no=function(n){se(e,n);function e(t){var r=n.call(this,t)||this,a;if(t.cell==null)throw new Z("cell property is missing for the constructor of RNN.");if(Array.isArray(t.cell)?a=new lv({cells:t.cell}):a=t.cell,a.stateSize==null)throw new Z("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=a,r.returnSequences=t.returnSequences==null?!1:t.returnSequences,r.returnState=t.returnState==null?!1:t.returnState,r.goBackwards=t.goBackwards==null?!1:t.goBackwards,r._stateful=t.stateful==null?!1:t.stateful,r.unroll=t.unroll==null?!1:t.unroll,r.supportsMasking=!0,r.inputSpec=[new Ln({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],r}return e.prototype.getStates=function(){if(this.states_==null){var t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return fi(0,t).map(function(r){return null})}else return this.states_},e.prototype.setStates=function(t){this.states_=t},e.prototype.computeOutputShape=function(t){var r,a;Ay(t)&&(t=t[0]),t=t;var i=this.cell.stateSize;Array.isArray(i)||(i=[i]);var o=i[0],s;if(this.returnSequences?s=[t[0],t[1],o]:s=[t[0],o],this.returnState){var u=[];try{for(var c=fe(i),l=c.next();!l.done;l=c.next()){var f=l.value;u.push([t[0],f])}}catch(h){r={error:h}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(r)throw r.error}}return[s].concat(u)}else return s},e.prototype.computeMask=function(t,r){var a=this;return _.tidy(function(){Array.isArray(r)&&(r=r[0]);var i=a.returnSequences?r:null;if(a.returnState){var o=a.states.map(function(s){return null});return[i].concat(o)}else return i})},Object.defineProperty(e.prototype,"states",{get:function(){if(this.states_==null){for(var t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,r=[],a=0;a<t;++a)r.push(null);return r}else return this.states_},set:function(t){this.states_=t},enumerable:!1,configurable:!0}),e.prototype.build=function(t){if(this.numConstants!=null)throw new dt("Constants support is not implemented in RNN yet.");Ay(t)&&(t=t[0]),t=t;var r=this.stateful?t[0]:null,a=t.slice(2);this.inputSpec[0]=new Ln({shape:Qe([r,null],te(a),!1)});var i=[t[0]].concat(t.slice(2));this.cell.build(i);var o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!R.util.arraysEqual(this.stateSpec.map(function(s){return s.shape[s.shape.length-1]}),o))throw new Z("An initialState was passed that is not compatible with "+"cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; ")+"However cell.stateSize is ".concat(this.cell.stateSize))}else this.stateSpec=o.map(function(s){return new Ln({shape:[null,s]})});this.stateful&&this.resetStates()},e.prototype.resetStates=function(t,r){var a=this;r===void 0&&(r=!1),R.tidy(function(){if(!a.stateful)throw new Bo("Cannot call resetStates() on an RNN Layer that is not stateful.");var i=a.inputSpec[0].shape[0];if(i==null)throw new Z("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(a.states_==null)Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(l){return _.zeros([i,l])}):a.states_=[_.zeros([i,a.cell.stateSize])];else if(t==null)_.dispose(a.states_),a.keptStates!=null&&(_.dispose(a.keptStates),a.keptStates=[]),Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(l){return _.zeros([i,l])}):a.states_[0]=_.zeros([i,a.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==a.states_.length)throw new Z("Layer ".concat(a.name," expects ").concat(a.states_.length," state(s), ")+"but it received ".concat(t.length," state value(s). Input ")+"received: ".concat(t));r===!0?a.keptStates.push(a.states_.slice()):_.dispose(a.states_);for(var o=0;o<a.states_.length;++o){var s=t[o],u=Array.isArray(a.cell.stateSize)?a.cell.stateSize[o]:a.cell.stateSize,c=[i,u];if(!R.util.arraysEqual(s.shape,c))throw new Z("State ".concat(o," is incompatible with layer ").concat(a.name,": ")+"expected shape=".concat(c,", received shape=").concat(s.shape));a.states_[o]=s}}a.states_=a.states_.map(function(l){return _.keep(l.clone())})})},e.prototype.apply=function(t,r){var a,i,o=r==null?null:r.initialState,s=r==null?null:r.constants;r==null&&(r={});var u=LM(t,o,s,this.numConstants);t=u.inputs,o=u.initialState,s=u.constants;var c=[],l=[];if(o!=null){r.initialState=o,c=c.concat(o),this.stateSpec=[];try{for(var f=fe(o),h=f.next();!h.done;h=f.next()){var p=h.value;this.stateSpec.push(new Ln({shape:p.shape}))}}catch(b){a={error:b}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}l=l.concat(this.stateSpec)}s!=null&&(r.constants=s,c=c.concat(s),this.numConstants=s.length);var d=c[0]instanceof ui;if(d){var v=[t].concat(c),m=this.inputSpec.concat(l),g=this.inputSpec;this.inputSpec=m;var y=n.prototype.apply.call(this,v,r);return this.inputSpec=g,y}else return n.prototype.apply.call(this,t,r)},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i=r==null?null:r.mask,o=r==null?null:r.training,s=r==null?null:r.initialState;t=it(t),s==null&&(a.stateful?s=a.states_:s=a.getInitialState(t));var u=Array.isArray(a.cell.stateSize)?a.cell.stateSize.length:1;if(s.length!==u)throw new Z("RNN Layer has ".concat(u," state(s) but was passed ")+"".concat(s.length," initial state(s)."));a.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var c={training:o},l=function(m,g){var y=a.cell.call([m].concat(g),c);return[y[0],y.slice(1)]},f=zM(l,t,s,a.goBackwards,i,null,a.unroll,a.returnSequences),h=f[0],p=f[1],d=f[2];a.stateful&&a.resetStates(d,o);var v=a.returnSequences?p:h;return a.returnState?[v].concat(d):v})},e.prototype.getInitialState=function(t){var r=this;return R.tidy(function(){var a=_.zeros(t.shape);return a=_.sum(a,[1,2]),a=If(a),Array.isArray(r.cell.stateSize)?r.cell.stateSize.map(function(i){return i>1?Iy(a,[1,i]):a}):r.cell.stateSize>1?[Iy(a,[1,r.cell.stateSize])]:[a]})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.trainable?this.cell.trainableWeights:[]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights},enumerable:!1,configurable:!0}),e.prototype.setFastWeightInitDuringBuild=function(t){n.prototype.setFastWeightInitDuringBuild.call(this,t),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(t)},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(r.numConstants=this.numConstants);var a=this.cell.getConfig();return this.getClassName()===e.className&&(r.cell={className:this.cell.getClassName(),config:a}),Object.assign(Object.assign(Object.assign({},a),t),r)},e.fromConfig=function(t,r,a){a===void 0&&(a={});var i=r.cell,o=ci(i,a);return new t(Object.assign(r,{cell:o}))},e}(gt);no.className="RNN";R.serialization.registerClass(no);var mc=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e}(gt),uv=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.DEFAULT_ACTIVATION="tanh",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=t.units,Kn(r.units,"units"),r.activation=Wo(t.activation==null?r.DEFAULT_ACTIVATION:t.activation),r.useBias=t.useBias==null?!0:t.useBias,r.kernelInitializer=cn(t.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=cn(t.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=cn(t.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=ln(t.kernelRegularizer),r.recurrentRegularizer=ln(t.recurrentRegularizer),r.biasRegularizer=ln(t.biasRegularizer),r.kernelConstraint=Vn(t.kernelConstraint),r.recurrentConstraint=Vn(t.recurrentConstraint),r.biasConstraint=Vn(t.biasConstraint),r.dropout=cc([1,$o([0,t.dropout==null?0:t.dropout])]),r.recurrentDropout=cc([1,$o([0,t.recurrentDropout==null?0:t.recurrentDropout])]),r.dropoutFunc=t.dropoutFunc,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return e.prototype.build=function(t){t=Et(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){if(t=t,t.length!==2)throw new Z("SimpleRNNCell expects 2 input Tensors, got ".concat(t.length,"."));var i=t[1];t=t[0];var o=r.training==null?!1:r.training;0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=Vo({ones:function(){return _.onesLike(t)},rate:a.dropout,training:o,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=Vo({ones:function(){return _.onesLike(i)},rate:a.recurrentDropout,training:o,dropoutFunc:a.dropoutFunc}));var s,u=a.dropoutMask,c=a.recurrentDropoutMask;u!=null?s=Oi(_.mul(t,u),a.kernel.read()):s=Oi(t,a.kernel.read()),a.bias!=null&&(s=vi(s,a.bias.read())),c!=null&&(i=_.mul(i,c));var l=_.add(s,Oi(i,a.recurrentKernel.read()));return a.activation!=null&&(l=a.activation.apply(l)),[l,l]})},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r={units:this.units,activation:qo(this.activation),useBias:this.useBias,kernelInitializer:mn(this.kernelInitializer),recurrentInitializer:mn(this.recurrentInitializer),biasInitializer:mn(this.biasInitializer),kernelRegularizer:zt(this.kernelRegularizer),recurrentRegularizer:zt(this.recurrentRegularizer),biasRegularizer:zt(this.biasRegularizer),activityRegularizer:zt(this.activityRegularizer),kernelConstraint:Wn(this.kernelConstraint),recurrentConstraint:Wn(this.recurrentConstraint),biasConstraint:Wn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},t),r)},e}(mc);uv.className="SimpleRNNCell";R.serialization.registerClass(uv);var Xb=function(n){se(e,n);function e(t){return t.cell=new uv(t),n.call(this,t)||this}return e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.cell.dropoutMask!=null&&(_.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(_.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=r==null?null:r.mask,o=r==null?null:r.training,s=r==null?null:r.initialState;return n.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,r){return new t(r)},e}(no);Xb.className="SimpleRNN";R.serialization.registerClass(Xb);var cv=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;if(r.DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new Z("GRUCell does not support reset_after parameter set to true.");return r.units=t.units,Kn(r.units,"units"),r.activation=Wo(t.activation===void 0?r.DEFAULT_ACTIVATION:t.activation),r.recurrentActivation=Wo(t.recurrentActivation===void 0?r.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),r.useBias=t.useBias==null?!0:t.useBias,r.kernelInitializer=cn(t.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=cn(t.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=cn(t.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=ln(t.kernelRegularizer),r.recurrentRegularizer=ln(t.recurrentRegularizer),r.biasRegularizer=ln(t.biasRegularizer),r.kernelConstraint=Vn(t.kernelConstraint),r.recurrentConstraint=Vn(t.recurrentConstraint),r.biasConstraint=Vn(t.biasConstraint),r.dropout=cc([1,$o([0,t.dropout==null?0:t.dropout])]),r.recurrentDropout=cc([1,$o([0,t.recurrentDropout==null?0:t.recurrentDropout])]),r.dropoutFunc=t.dropoutFunc,r.implementation=t.implementation,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return e.prototype.build=function(t){t=Et(t);var r=t[t.length-1];this.kernel=this.addWeight("kernel",[r,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){if(t=t,t.length!==2)throw new Z("GRUCell expects 2 input Tensors (inputs, h, c), got "+"".concat(t.length,"."));var i=r.training==null?!1:r.training,o=t[1];t=t[0],0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=Vo({ones:function(){return _.onesLike(t)},rate:a.dropout,training:i,count:3,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=Vo({ones:function(){return _.onesLike(o)},rate:a.recurrentDropout,training:i,count:3,dropoutFunc:a.dropoutFunc}));var s=a.dropoutMask,u=a.recurrentDropoutMask,c,l,f;0<a.dropout&&a.dropout<1&&(t=_.mul(t,s[0]));var h=Oi(t,a.kernel.read());a.useBias&&(h=vi(h,a.bias.read())),0<a.recurrentDropout&&a.recurrentDropout<1&&(o=_.mul(o,u[0]));var p=a.recurrentKernel.read(),d=te(_.split(p,[2*a.units,a.units],p.rank-1),2),v=d[0],m=d[1],g=Oi(o,v),y=te(_.split(h,3,h.rank-1),3),b=y[0],w=y[1],x=y[2],N=te(_.split(g,2,g.rank-1),2),T=N[0],E=N[1];c=a.recurrentActivation.apply(_.add(b,T)),l=a.recurrentActivation.apply(_.add(w,E));var C=Oi(_.mul(l,o),m);f=a.activation.apply(_.add(x,C));var F=_.add(_.mul(c,o),_.mul(_.add(1,_.neg(c)),f));return[F,F]})},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r={units:this.units,activation:qo(this.activation),recurrentActivation:qo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:mn(this.kernelInitializer),recurrentInitializer:mn(this.recurrentInitializer),biasInitializer:mn(this.biasInitializer),kernelRegularizer:zt(this.kernelRegularizer),recurrentRegularizer:zt(this.recurrentRegularizer),biasRegularizer:zt(this.biasRegularizer),activityRegularizer:zt(this.activityRegularizer),kernelConstraint:Wn(this.kernelConstraint),recurrentConstraint:Wn(this.recurrentConstraint),biasConstraint:Wn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},t),r)},e}(mc);cv.className="GRUCell";R.serialization.registerClass(cv);var Yb=function(n){se(e,n);function e(t){return t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new cv(t),n.call(this,t)||this}return e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.cell.dropoutMask!=null&&(_.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(_.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=r==null?null:r.mask,o=r==null?null:r.training,s=r==null?null:r.initialState;return n.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,r){return r.implmentation===0&&(r.implementation=1),new t(r)},e}(no);Yb.className="GRU";R.serialization.registerClass(Yb);var Of=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=t.units,Kn(r.units,"units"),r.activation=Wo(t.activation===void 0?r.DEFAULT_ACTIVATION:t.activation),r.recurrentActivation=Wo(t.recurrentActivation===void 0?r.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),r.useBias=t.useBias==null?!0:t.useBias,r.kernelInitializer=cn(t.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=cn(t.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=cn(t.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.unitForgetBias=t.unitForgetBias,r.kernelRegularizer=ln(t.kernelRegularizer),r.recurrentRegularizer=ln(t.recurrentRegularizer),r.biasRegularizer=ln(t.biasRegularizer),r.kernelConstraint=Vn(t.kernelConstraint),r.recurrentConstraint=Vn(t.recurrentConstraint),r.biasConstraint=Vn(t.biasConstraint),r.dropout=cc([1,$o([0,t.dropout==null?0:t.dropout])]),r.recurrentDropout=cc([1,$o([0,t.recurrentDropout==null?0:t.recurrentDropout])]),r.dropoutFunc=t.dropoutFunc,r.implementation=t.implementation,r.stateSize=[r.units,r.units],r.dropoutMask=null,r.recurrentDropoutMask=null,r}return e.prototype.build=function(t){var r;t=Et(t);var a=t[t.length-1];this.kernel=this.addWeight("kernel",[a,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);var i;if(this.useBias){if(this.unitForgetBias){var o=this.biasInitializer,s=this.units;i=new(r=function(u){se(c,u);function c(){return u!==null&&u.apply(this,arguments)||this}return c.prototype.apply=function(l,f){var h=o.apply([s]),p=new Ud().apply([s]),d=o.apply([s*2]);return _R(_R(h,p),d)},c}(Ba),r.className="CustomInit",r)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i=r.training==null?!1:r.training;if(t=t,t.length!==3)throw new Z("LSTMCell expects 3 input Tensors (inputs, h, c), got "+"".concat(t.length,"."));var o=t[1],s=t[2];t=t[0],0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=Vo({ones:function(){return _.onesLike(t)},rate:a.dropout,training:i,count:4,dropoutFunc:a.dropoutFunc})),0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=Vo({ones:function(){return _.onesLike(o)},rate:a.recurrentDropout,training:i,count:4,dropoutFunc:a.dropoutFunc}));var u=a.dropoutMask,c=a.recurrentDropoutMask,l,f,h,p;0<a.dropout&&a.dropout<1&&(t=_.mul(t,u[0]));var d=Oi(t,a.kernel.read());0<a.recurrentDropout&&a.recurrentDropout<1&&(o=_.mul(o,c[0])),d=_.add(d,Oi(o,a.recurrentKernel.read())),a.useBias&&(d=vi(d,a.bias.read()));var v=te(_.split(d,4,d.rank-1),4),m=v[0],g=v[1],y=v[2],b=v[3];l=a.recurrentActivation.apply(m),f=a.recurrentActivation.apply(g),h=_.add(_.mul(f,s),_.mul(l,a.activation.apply(y))),p=a.recurrentActivation.apply(b);var w=_.mul(p,a.activation.apply(h));return[w,w,h]})},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r={units:this.units,activation:qo(this.activation),recurrentActivation:qo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:mn(this.kernelInitializer),recurrentInitializer:mn(this.recurrentInitializer),biasInitializer:mn(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:zt(this.kernelRegularizer),recurrentRegularizer:zt(this.recurrentRegularizer),biasRegularizer:zt(this.biasRegularizer),activityRegularizer:zt(this.activityRegularizer),kernelConstraint:Wn(this.kernelConstraint),recurrentConstraint:Wn(this.recurrentConstraint),biasConstraint:Wn(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},t),r)},e}(mc);Of.className="LSTMCell";R.serialization.registerClass(Of);var Zb=function(n){se(e,n);function e(t){return t.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Of(t),n.call(this,t)||this}return e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.cell.dropoutMask!=null&&(_.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(_.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null);var i=r==null?null:r.mask,o=r==null?null:r.training,s=r==null?null:r.initialState;return n.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.fromConfig=function(t,r){return r.implmentation===0&&(r.implementation=1),new t(r)},e}(no);Zb.className="LSTM";R.serialization.registerClass(Zb);var lv=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.cells=t.cells,r}return Object.defineProperty(e.prototype,"stateSize",{get:function(){var t,r,a=[];try{for(var i=fe(this.cells.slice().reverse()),o=i.next();!o.done;o=i.next()){var s=o.value;Array.isArray(s.stateSize)?a.push.apply(a,Qe([],te(s.stateSize),!1)):a.push(s.stateSize)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return a},enumerable:!1,configurable:!0}),e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i,o,s,u;t=t;var c=t.slice(1),l=[];try{for(var f=fe(a.cells.slice().reverse()),h=f.next();!h.done;h=f.next()){var p=h.value;Array.isArray(p.stateSize)?l.push(c.splice(0,p.stateSize.length)):l.push(c.splice(0,1))}}catch(w){i={error:w}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}l.reverse();for(var d=[],v,m=0;m<a.cells.length;++m){var p=a.cells[m];c=l[m],m===0?v=[t[0]].concat(c):v=[v[0]].concat(c),v=p.call(v,r),d.push(v.slice(1))}c=[];try{for(var g=fe(d.slice().reverse()),y=g.next();!y.done;y=g.next()){var b=y.value;c.push.apply(c,Qe([],te(b),!1))}}catch(w){s={error:w}}finally{try{y&&!y.done&&(u=g.return)&&u.call(g)}finally{if(s)throw s.error}}return[v[0]].concat(c)})},e.prototype.build=function(t){Ay(t)&&(t=t[0]),t=t;var r;this.cells.forEach(function(a,i){Rs("RNNCell_".concat(i),function(){a.build(t),Array.isArray(a.stateSize)?r=a.stateSize[0]:r=a.stateSize,t=[t[0],r]})}),this.built=!0},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r=function(o){return{className:o.getClassName(),config:o.getConfig()}},a=this.cells.map(r),i={cells:a};return Object.assign(Object.assign({},t),i)},e.fromConfig=function(t,r,a){var i,o;a===void 0&&(a={});var s=[];try{for(var u=fe(r.cells),c=u.next();!c.done;c=u.next()){var l=c.value;s.push(ci(l,a))}}catch(f){i={error:f}}finally{try{c&&!c.done&&(o=u.return)&&o.call(u)}finally{if(i)throw i.error}}return new t({cells:s})},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){var t,r;if(!this.trainable)return[];var a=[];try{for(var i=fe(this.cells),o=i.next();!o.done;o=i.next()){var s=o.value;a.push.apply(a,Qe([],te(s.trainableWeights),!1))}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return a},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){var t,r,a,i,o=[];try{for(var s=fe(this.cells),u=s.next();!u.done;u=s.next()){var c=u.value;o.push.apply(o,Qe([],te(c.nonTrainableWeights),!1))}}catch(p){t={error:p}}finally{try{u&&!u.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}if(!this.trainable){var l=[];try{for(var f=fe(this.cells),h=f.next();!h.done;h=f.next()){var c=h.value;l.push.apply(l,Qe([],te(c.trainableWeights),!1))}}catch(p){a={error:p}}finally{try{h&&!h.done&&(i=f.return)&&i.call(f)}finally{if(a)throw a.error}}return l.concat(o)}return o},enumerable:!1,configurable:!0}),e.prototype.getWeights=function(){var t,r,a=[];try{for(var i=fe(this.cells),o=i.next();!o.done;o=i.next()){var s=o.value;a.push.apply(a,Qe([],te(s.weights),!1))}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return _y(a)},e.prototype.setWeights=function(t){var r,a,i=[];try{for(var o=fe(this.cells),s=o.next();!s.done;s=o.next())for(var u=s.value,c=u.weights.length,l=t.splice(c),f=0;f<u.weights.length;++f)i.push([u.weights[f],l[f]])}catch(h){r={error:h}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}eb(i)},e}(mc);lv.className="StackedRNNCells";R.serialization.registerClass(lv);function Vo(n){var e=n.ones,t=n.rate,r=n.training,a=r===void 0?!1:r,i=n.count,o=i===void 0?1:i,s=n.dropoutFunc,u=function(){return s!=null?s(e(),t):BO(e(),t)},c=function(){return Af(u,e,a)};if(!o||o<=1)return _.keep(c().clone());var l=Array(o).fill(void 0).map(c);return l.map(function(f){return _.keep(f.clone())})}var Fye=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(n);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(n,r[a])&&(t[r[a]]=n[r[a]]);return t};(function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(mc);var $M=function(n){se(e,n);function e(t){var r=this;if(t.unroll)throw new dt("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new dt("It is not possible at the moment to stack convolutional cells.");return r=n.call(this,t)||this,r.inputSpec=[new Ln({ndim:5})],r}return e.prototype.call=function(t,r){var a=this;return _.tidy(function(){if(a.cell.dropoutMask!=null&&(_.dispose(a.cell.dropoutMask),a.cell.dropoutMask=null),a.cell.recurrentDropoutMask!=null&&(_.dispose(a.cell.recurrentDropoutMask),a.cell.recurrentDropoutMask=null),r&&r.constants)throw new Z("ConvRNN2D cell does not support constants");var i=r==null?null:r.mask,o=r==null?null:r.training,s=r==null?null:r.initialState;return n.prototype.call.call(a,t,{mask:i,training:o,initialState:s})})},e.prototype.computeOutputShape=function(t){var r=this.computeSingleOutputShape(t);return this.returnSequences||(r=Qe([r[0]],te(r.slice(2)),!1)),this.returnState&&(r=Qe([r],te(Array(2).fill(Qe([t[0]],te(r.slice(-3)),!1))),!1)),r},e.prototype.getInitialState=function(t){var r=this;return _.tidy(function(){var a=r.cell.stateSize,i=t.shape,o=r.computeSingleOutputShape(i),s=Qe([o[0]],te(o.slice(2)),!1),u=_.zeros(s);return Array.isArray(a)?Array(a.length).fill(u):[u]})},e.prototype.resetStates=function(t,r){var a=this;r===void 0&&(r=!1),_.tidy(function(){if(!a.stateful)throw new Bo("Cannot call resetStates() on an RNN Layer that is not stateful.");var i=a.inputSpec[0].shape,o=a.computeSingleOutputShape(i),s=Qe([o[0]],te(o.slice(2)),!1),u=i[0];if(u==null)throw new Z("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(a.getStates()==null)Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(){return _.zeros(s)}):a.states_=[_.zeros(s)];else if(t==null)_.dispose(a.states_),a.keptStates!=null&&(_.dispose(a.keptStates),a.keptStates=[]),Array.isArray(a.cell.stateSize)?a.states_=a.cell.stateSize.map(function(){return _.zeros(s)}):a.states_[0]=_.zeros(s);else{if(Array.isArray(t)||(t=[t]),t.length!==a.states_.length)throw new Z("Layer ".concat(a.name," expects ").concat(a.states_.length," state(s), ")+"but it received ".concat(t.length," state value(s). Input ")+"received: ".concat(t));r?a.keptStates.push(a.states_.slice()):_.dispose(a.states_);for(var c=0;c<a.states_.length;++c){var l=t[c],f=s;if(!R.util.arraysEqual(l.shape,f))throw new Z("State ".concat(c," is incompatible with layer ").concat(a.name,": ")+"expected shape=".concat(f,", received shape=").concat(l.shape));a.states_[c]=l}}a.states_=a.states_.map(function(h){return _.keep(h.clone())})})},e.prototype.computeSingleOutputShape=function(t){var r=this.cell,a=r.dataFormat,i=r.filters,o=r.kernelSize,s=r.padding,u=r.strides,c=r.dilationRate,l=a==="channelsFirst",f=t[l?3:2],h=t[l?4:3],p=li(f,o[0],s,u[0],c[0]),d=li(h,o[1],s,u[1],c[1]),v=Qe(Qe([],te(t.slice(0,2)),!1),te(l?[i,p,d]:[p,d,i]),!1);return v},e}(no);$M.className="ConvRNN2D";var fv=function(n){se(e,n);function e(t){var r=this,a=t.filters,i=t.kernelSize,o=t.strides,s=t.padding,u=t.dataFormat,c=t.dilationRate;return r=n.call(this,Object.assign(Object.assign({},t),{units:a}))||this,r.filters=a,Kn(r.filters,"filters"),r.kernelSize=uc(i,2,"kernelSize"),r.kernelSize.forEach(function(l){return Kn(l,"kernelSize")}),r.strides=uc(o||1,2,"strides"),r.strides.forEach(function(l){return Kn(l,"strides")}),r.padding=s||"valid",da(r.padding),r.dataFormat=u||"channelsLast",Dn(r.dataFormat),r.dilationRate=uc(c||1,2,"dilationRate"),r.dilationRate.forEach(function(l){return Kn(l,"dilationRate")}),r}return e.prototype.build=function(t){var r;t=Et(t);var a=this.dataFormat==="channelsFirst"?1:t.length-1;if(t[a]==null)throw new Z("The channel dimension of the input should be defined. "+"Found ".concat(t[a]));var i=t[a],o=4,s=this.kernelSize.concat([i,this.filters*o]);this.kernel=this.addWeight("kernel",s,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var u=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",u,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var c=void 0;if(this.unitForgetBias){var l=this.biasInitializer,f=this.filters;c=new(r=function(h){se(p,h);function p(){return h!==null&&h.apply(this,arguments)||this}return p.prototype.apply=function(d,v){var m=l.apply([f]),g=_.ones([f]),y=l.apply([f*2]);return Hy([m,g,y])},p}(Ba),r.className="CustomInit",r)}else c=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,c,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0},e.prototype.call=function(t,r){var a=this;return _.tidy(function(){if(t.length!==3)throw new Z("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+"".concat(t.length,"."));var i=r.training||!1,o=t[0],s=t[1],u=t[2],c=4;0<a.dropout&&a.dropout<1&&a.dropoutMask==null&&(a.dropoutMask=Vo({ones:function(){return _.onesLike(o)},rate:a.dropout,training:i,count:c,dropoutFunc:a.dropoutFunc}));var l=a.dropoutMask,f=function(le,de,xe){return!de||!de[xe]?le:_.mul(de[xe],le)},h=f(o,l,0),p=f(o,l,1),d=f(o,l,2),v=f(o,l,3);0<a.recurrentDropout&&a.recurrentDropout<1&&a.recurrentDropoutMask==null&&(a.recurrentDropoutMask=Vo({ones:function(){return _.onesLike(s)},rate:a.recurrentDropout,training:i,count:c,dropoutFunc:a.dropoutFunc}));var m=a.recurrentDropoutMask,g=f(s,m,0),y=f(s,m,1),b=f(s,m,2),w=f(s,m,3),x=3,N=te(_.split(a.kernel.read(),c,x),4),T=N[0],E=N[1],C=N[2],F=N[3],D=te(a.useBias?_.split(a.bias.read(),c):[null,null,null,null],4),O=D[0],L=D[1],z=D[2],$=D[3];h=a.inputConv(h,T,O,a.padding),p=a.inputConv(p,E,L,a.padding),d=a.inputConv(d,C,z,a.padding),v=a.inputConv(v,F,$,a.padding);var B=te(_.split(a.recurrentKernel.read(),c,x),4),W=B[0],X=B[1],Y=B[2],V=B[3];g=a.recurrentConv(g,W),y=a.recurrentConv(y,X),b=a.recurrentConv(b,Y),w=a.recurrentConv(w,V);var j=a.recurrentActivation.apply(_.add(h,g)),re=a.recurrentActivation.apply(_.add(p,y)),ne=_.add(_.mul(re,u),_.mul(j,a.activation.apply(_.add(d,b)))),oe=_.mul(a.recurrentActivation.apply(_.add(v,w)),a.activation.apply(ne));return[oe,oe,ne]})},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this);t.units;var r=Fye(t,["units"]),a={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},r),a)},e.prototype.inputConv=function(t,r,a,i){var o=_.conv2d(t,r,this.strides,i||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return a?vi(o,a,this.dataFormat):o},e.prototype.recurrentConv=function(t,r){var a=1;return _.conv2d(t,r,a,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")},e}(Of);fv.className="ConvLSTM2DCell";_.serialization.registerClass(fv);var Jb=function(n){se(e,n);function e(t){var r=new fv(t);return n.call(this,Object.assign(Object.assign({},t),{cell:r}))||this}return e.fromConfig=function(t,r){return new t(r)},e}($M);Jb.className="ConvLSTM2D";_.serialization.registerClass(Jb);var hv=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.rate=Math.max(Math.min(t.rate,1),0),r.noiseShape=t.noiseShape,r.seed=t.seed,r.supportsMasking=!0,r}return e.prototype.getNoiseShape=function(t){if(this.noiseShape==null)return this.noiseShape;for(var r=t.shape,a=[],i=0;i<this.noiseShape.length;++i)a.push(this.noiseShape[i]==null?r[i]:this.noiseShape[i]);return a},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t);if(0<a.rate&&a.rate<1){var o=r.training==null?!1:r.training,s=a.getNoiseShape(i),u=Af(function(){return BO(i,a.rate,s,a.seed)},function(){return i},o);return u}return t})},e.prototype.getConfig=function(){var t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e.prototype.dispose=function(){return n.prototype.dispose.call(this)},e}(gt);hv.className="Dropout";R.serialization.registerClass(hv);var Qb=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.inputSpec=[{ndim:3}],r}return e.prototype.getNoiseShape=function(t){var r=t.shape;return[r[0],1,r[2]]},e}(hv);Qb.className="SpatialDropout1D";R.serialization.registerClass(Qb);var e1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;if(r.activation=null,r.useBias=!0,r.kernel=null,r.bias=null,r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_BIAS_INITIALIZER="zeros",t.batchInputShape==null&&t.inputShape==null&&t.inputDim!=null){var a=null;t.batchSize!=null&&(a=t.batchSize),r.batchInputShape=[a,t.inputDim]}return r.units=t.units,Kn(r.units,"units"),r.activation=Wo(t.activation),t.useBias!=null&&(r.useBias=t.useBias),r.kernelInitializer=cn(t.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.biasInitializer=cn(t.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelConstraint=Vn(t.kernelConstraint),r.biasConstraint=Vn(t.biasConstraint),r.kernelRegularizer=ln(t.kernelRegularizer),r.biasRegularizer=ln(t.biasRegularizer),r.activityRegularizer=ln(t.activityRegularizer),r.supportsMasking=!0,r.inputSpec=[{minNDim:2}],r}return e.prototype.build=function(t){var r;t=Et(t);var a=t[t.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[a,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(r={},r[-1]=a,r)}],this.built=!0},e.prototype.computeOutputShape=function(t){t=Et(t);var r=t.slice();return r[r.length-1]=this.units,r},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t),o=_O(a.activation.getClassName()),s;return o!=null?s=Oi(i,a.kernel.read(),o,a.bias?a.bias.read():null):(s=Oi(i,a.kernel.read()),a.bias!=null&&(s=vi(s,a.bias.read())),a.activation!=null&&(s=a.activation.apply(s))),s})},e.prototype.getConfig=function(){var t={units:this.units,activation:qo(this.activation),useBias:this.useBias,kernelInitializer:mn(this.kernelInitializer),biasInitializer:mn(this.biasInitializer),kernelRegularizer:zt(this.kernelRegularizer),biasRegularizer:zt(this.biasRegularizer),activityRegularizer:zt(this.activityRegularizer),kernelConstraint:Wn(this.kernelConstraint),biasConstraint:Wn(this.biasConstraint)},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);e1.className="Dense";R.serialization.registerClass(e1);var t1=function(n){se(e,n);function e(t){var r=this;return t=t||{},r=n.call(this,t)||this,r.inputSpec=[{minNDim:3}],r.dataFormat=t.dataFormat,r}return e.prototype.computeOutputShape=function(t){var r,a;t=Et(t);try{for(var i=fe(t.slice(1)),o=i.next();!o.done;o=i.next()){var s=o.value;if(s==null)throw new Z('The shape of the input to "Flatten" is not fully defined '+"(got ".concat(t.slice(1),"). Make sure to pass a complete ")+'"input_shape" or "batch_input_shape" argument to the first layer in your model.')}}catch(u){r={error:u}}finally{try{o&&!o.done&&(a=i.return)&&a.call(i)}finally{if(r)throw r.error}}return[t[0],zo(t,1)]},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t);if(a.dataFormat==="channelsFirst"&&i.rank>1){for(var o=[0],s=2;s<i.rank;++s)o.push(s);o.push(1),i=R.transpose(i,o)}return Hle(i)})},e.prototype.getConfig=function(){var t={};this.dataFormat!=null&&(t.dataFormat=this.dataFormat);var r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);t1.className="Flatten";R.serialization.registerClass(t1);var n1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.supportsMasking=!0,r.activation=Wo(t.activation),r}return e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t);return a.activation.apply(i)})},e.prototype.getConfig=function(){var t={activation:qo(this.activation)},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);n1.className="Activation";R.serialization.registerClass(n1);var r1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.n=t.n,r.inputSpec=[{ndim:2}],r}return e.prototype.computeOutputShape=function(t){return[t[0],this.n,t[1]]},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){return t=it(t),Gle(t,a.n)})},e.prototype.getConfig=function(){var t={n:this.n},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);r1.className="RepeatVector";R.serialization.registerClass(r1);var a1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;r.targetShape=t.targetShape;for(var a=0;a<r.targetShape.length;++a)r.isUnknown(r.targetShape[a])&&(r.targetShape[a]=null);return r}return e.prototype.isUnknown=function(t){return t<0||t==null},e.prototype.fixUnknownDimension=function(t,r){for(var a="Total size of new array must be unchanged.",i=r.slice(),o=1,s=null,u=0;u<i.length;++u){var c=i[u];if(this.isUnknown(c))if(s===null)s=u;else throw new Z("Can only specifiy one unknown dimension.");else o*=c}var l=zo(t);if(s!==null){if(o===0||l%o!==0)throw new Z(a);i[s]=l/o}else if(l!==o)throw new Z(a);return i},e.prototype.computeOutputShape=function(t){for(var r=!1,a=0;a<t.length;++a)if(this.isUnknown(t[a])){r=!0;break}return r?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t),o=i.shape,s=o.slice(0,1).concat(a.fixUnknownDimension(o.slice(1),a.targetShape));return R.reshape(i,s)})},e.prototype.getConfig=function(){var t={targetShape:this.targetShape},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);a1.className="Reshape";R.serialization.registerClass(a1);var i1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;if(t.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+"".concat(t.dims," instead."));var a=fi(1,t.dims.length+1);if(!R.util.arraysEqual(t.dims.slice().sort(),a))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");return r.dims=t.dims,r.dimsIncludingBatch=[0].concat(r.dims),r.inputSpec=[new Ln({ndim:r.dims.length+1})],r}return e.prototype.computeOutputShape=function(t){t=Et(t);var r=t.slice();return this.dims.forEach(function(a,i){r[i+1]=t[a]}),r},e.prototype.call=function(t,r){return R.transpose(it(t),this.dimsIncludingBatch)},e.prototype.getConfig=function(){var t={dims:this.dims},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);i1.className="Permute";R.serialization.registerClass(i1);var o1=function(n){se(e,n);function e(t){var r=n.call(this,t??{})||this;return r.supportsMasking=!0,t!=null?r.maskValue=t.maskValue==null?0:t.maskValue:r.maskValue=0,r}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r={maskValue:this.maskValue};return Object.assign(r,t),r},e.prototype.computeMask=function(t,r){var a=it(t),i=-1;return R.any(R.notEqual(a,this.maskValue),i)},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t),o=-1,s=!0,u=R.any(R.notEqual(i,a.maskValue),o,s),c=R.mul(i,R.cast(u,i.dtype));return c})},e}(gt);o1.className="Masking";R.serialization.registerClass(o1);var s1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;if(r.embeddings=null,r.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",t.batchInputShape==null&&t.inputShape==null){var a=null;t.batchSize!=null&&(a=t.batchSize),t.inputLength==null?r.batchInputShape=[a,null]:r.batchInputShape=[a].concat(Yt(t.inputLength))}return r.inputDim=t.inputDim,Kn(r.inputDim,"inputDim"),r.outputDim=t.outputDim,Kn(r.outputDim,"outputDim"),r.embeddingsInitializer=cn(t.embeddingsInitializer||r.DEFAULT_EMBEDDINGS_INITIALIZER),r.embeddingsRegularizer=ln(t.embeddingsRegularizer),r.activityRegularizer=ln(t.activityRegularizer),r.embeddingsConstraint=Vn(t.embeddingsConstraint),r.maskZero=t.maskZero,r.supportsMasking=t.maskZero,r.inputLength=t.inputLength,r}return e.prototype.build=function(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0},e.prototype.warnOnIncompatibleInputShape=function(t){},e.prototype.computeMask=function(t,r){var a=this;return R.tidy(function(){return a.maskZero?(t=it(t),R.notEqual(t,R.zerosLike(t))):null})},e.prototype.computeOutputShape=function(t){if(t=Et(t),this.inputLength==null)return Qe(Qe([],te(t),!1),[this.outputDim],!1);var r=Yt(this.inputLength);if(r.length!==t.length-1)throw new Z('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(t));for(var a=0,i=0;i<r.length;++i){var o=r[i],s=t[i+1];if(o!=null&&s!=null&&o!==s)throw new Z('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(t));o==null&&(r[a]=s),a++}return Qe(Qe([t[0]],te(r),!1),[this.outputDim],!1)},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t);i.dtype!=="int32"&&(i=Ri(i,"int32"));var o=MO(a.embeddings.read(),R.reshape(i,[i.size]));return R.reshape(o,Et(a.computeOutputShape(i.shape)))})},e.prototype.getConfig=function(){var t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:mn(this.embeddingsInitializer),embeddingsRegularizer:zt(this.embeddingsRegularizer),activityRegularizer:zt(this.activityRegularizer),embeddingsConstraint:Wn(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);s1.className="Embedding";R.serialization.registerClass(s1);var Hs=function(n){se(e,n);function e(t){var r=n.call(this,t||{})||this;return r.supportsMasking=!0,r}return e.prototype.mergeFunction=function(t){throw new dt},e.prototype.computeElementwiseOpOutputShape=function(t,r){if(t==null||r==null)return null;if(t.length<r.length)return this.computeElementwiseOpOutputShape(r,t);if(r.length===0)return t;for(var a=t.slice(0,t.length-r.length),i=0;i<r.length;++i){var o=t[t.length-r.length+i],s=r[i];if(o==null||s==null||o<0||s<0)a.push(null);else if(o===1)a.push(s);else if(s===1)a.push(o);else{if(o!==s)throw new Z("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(r));a.push(o)}}return a},e.prototype.build=function(t){var r,a;if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[Et(t)]),t=t,t.length<2)throw new Z("A merge layer should be called on an Array of at least 2 inputs."+" Got ".concat(t.length," input(s)."));var i=[];try{for(var o=fe(t),s=o.next();!s.done;s=o.next()){var u=s.value;u!=null&&u[0]!==null&&i.push(u[0])}}catch(h){r={error:h}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}if(i=Lo(i),i.length>1)throw new Z("Can not merge tensors with different batch sizes. "+"Got tensors with shapes: ".concat(JSON.stringify(t),"."));for(var c=t[0]==null?null:t[0].slice(1),l=1;l<t.length;++l){var u=t[l]==null?null:t[l].slice(1);c=this.computeElementwiseOpOutputShape(c,u)}var f=t.map(function(h){return h.length});t.indexOf(null)===-1&&Lo(f).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i,o,s,u;if(t=t,a.reshapeRequired){var c=[],l=t.map(function(L){return L.rank});if(l.indexOf(null)===-1){var f=$o(l);try{for(var h=fe(t),p=h.next();!p.done;p=h.next()){for(var d=p.value,v=d.rank,m=0;m<f-v;++m)d=If(d,1);c.push(d)}}catch(L){i={error:L}}finally{try{p&&!p.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}return a.mergeFunction(c)}else{var g=!1;try{for(var y=fe(t),b=y.next();!b.done;b=y.next()){var d=b.value,v=d.rank;if(v==null){var w=d.shape,x=w[0],N=w.slice(1).concat([x]),T=_.reshape(d,[x].concat(zo(w.slice(1))));T=_.transpose(T,[1,0]),T=_.reshape(T,N),c.push(T),g=!0}else if(v>1){var E=fi(1,v).concat([0]);c.push(_.transpose(d,E)),g=!0}else c.push(d)}}catch(L){s={error:L}}finally{try{b&&!b.done&&(u=y.return)&&u.call(y)}finally{if(s)throw s.error}}var C=a.mergeFunction(c),F=C.rank;if(g){if(F==null){var D=C.shape,O=D.length,x=D[O-1],N=[x].concat(D.slice(0,D.length-1));C=_.reshape(_.transpose(_.reshape(C,[-1,x]),[1,0]),N)}else if(F>1){var E=[F-1].concat(fi(0,F-1));C=_.transpose(C,E)}}return C}}else return a.mergeFunction(t)})},e.prototype.computeOutputShape=function(t){var r,a;t=t;var i;t[0]==null?i=null:i=t[0].slice(1);for(var o=1;o<t.length;++o){var s=t[o]==null?null:t[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}var u=[];try{for(var c=fe(t),l=c.next();!l.done;l=c.next()){var s=l.value;s!=null&&s[0]!==null&&u.push(s[0])}}catch(f){r={error:f}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(r)throw r.error}}return u=Lo(u),u.length===1?i=u.concat(i):i=[null].concat(i),i},e.prototype.computeMask=function(t,r){return _.tidy(function(){if(r==null)return null;if(!Array.isArray(r))throw new Z("`mask` should be an Array");if(!Array.isArray(t))throw new Z("`inputs` should be an Array");if(r.length!==t.length)throw new Z("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths "+"(".concat(t.length," vs ").concat(r.length,")"));if(r.every(function(o){return o==null}))return null;r=r.map(function(o){return o==null?o:_.expandDims(o,0)});for(var a=r[0],i=1;i<r.length-1;++i)a=_.logicalAnd(a,r[i]);return a})},e}(gt),u1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.mergeFunction=function(t){return R.tidy(function(){for(var r=t[0].clone(),a=1;a<t.length;++a)r=_.add(r,t[a]);return r})},e}(Hs);u1.className="Add";R.serialization.registerClass(u1);var c1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.mergeFunction=function(t){return R.tidy(function(){for(var r=t[0].clone(),a=1;a<t.length;++a)r=_.mul(r,t[a]);return r})},e}(Hs);c1.className="Multiply";R.serialization.registerClass(c1);var l1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.mergeFunction=function(t){return R.tidy(function(){for(var r=t[0].clone(),a=1;a<t.length;++a)r=_.add(r,t[a]);return _.mul(1/t.length,r)})},e}(Hs);l1.className="Average";R.serialization.registerClass(l1);var f1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.mergeFunction=function(t){return R.tidy(function(){for(var r=t[0],a=1;a<t.length;++a)r=_.maximum(r,t[a]);return r})},e}(Hs);f1.className="Maximum";R.serialization.registerClass(f1);var h1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.mergeFunction=function(t){return R.tidy(function(){for(var r=t[0],a=1;a<t.length;++a)r=_.minimum(r,t[a]);return r})},e}(Hs);h1.className="Minimum";R.serialization.registerClass(h1);var p1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.DEFAULT_AXIS=-1,t==null&&(t={}),r.axis=t.axis==null?r.DEFAULT_AXIS:t.axis,r.supportsMasking=!0,r.reshapeRequired=!1,r}return e.prototype.build=function(t){var r,a,i,o;if(!(Array.isArray(t)&&Array.isArray(t[0]))||t.length===1)throw new Z("A `Concatenate` layer should be called on a list of at least 2 inputs");t=t;var s=!0;try{for(var u=fe(t),c=u.next();!c.done;c=u.next()){var l=c.value;if(l!=null){s=!1;break}}}catch(g){r={error:g}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(r)throw r.error}}if(!s){for(var f=[],h=0;h<t.length;++h){var p=t[h].slice();p.splice(this.axis,1);var d=!1;try{for(var v=(i=void 0,fe(f)),m=v.next();!m.done;m=v.next()){var l=m.value;if(R.util.arraysEqual(l,p)){d=!0;break}}}catch(g){i={error:g}}finally{try{m&&!m.done&&(o=v.return)&&o.call(v)}finally{if(i)throw i.error}}d||f.push(p)}if(f.length>1)throw new Z("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}},e.prototype.mergeFunction=function(t){var r=this;return R.tidy(function(){return Hy(t,r.axis)})},e.prototype.computeOutputShape=function(t){var r,a;if(!(Array.isArray(t)&&Array.isArray(t[0])))throw new Z("A `Concatenate` layer should be called on a list of inputs.");var i=t,o=i[0].slice(),s=this.axis<0?o.length+this.axis:this.axis;try{for(var u=fe(i.slice(1)),c=u.next();!c.done;c=u.next()){var l=c.value;if(o[s]==null||l[s]==null){o[s]=null;break}o[s]+=l[s]}}catch(f){r={error:f}}finally{try{c&&!c.done&&(a=u.return)&&a.call(u)}finally{if(r)throw r.error}}return o},e.prototype.computeMask=function(t,r){var a=this;if(r==null)return null;if(!Array.isArray(r))throw new Z("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new Z("`inputs` should be an array for Concatenate");if(r.length!==t.length)throw new Z("Mismatch in the length of mask (".concat(r.length,") ")+"and the legnth of inputs (".concat(t.length,")"));return _.tidy(function(){var i=!0;if(r.forEach(function(c){if(c!=null){i=!1;return}}),i)return null;for(var o=[],s=0;s<t.length;++s)r[s]==null?o.push(_.cast(_.onesLike(t[s]),"bool")):r[s].rank<t[s].rank?o.push(_.expandDims(r[s],-1)):o.push(r[s]);var u=_.concat(o,a.axis);return _.all(u,-1,!1)})},e.prototype.getConfig=function(){var t={axis:this.axis},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(Hs);p1.className="Concatenate";R.serialization.registerClass(p1);function vf(n,e){for(;n<0;)n+=e;return n}function Rye(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new dt("batchDot is not implemented for tensors of 4D or higher rank yet");if(_.util.assert(n.shape.length>=2,function(){return"batchDot requires the rank of x to be >= 2, "+"but got ".concat(n.shape.length)}),_.util.assert(n.shape.length>=2,function(){return"batchDot requires the rank of y to be >= 2, "+"but got ".concat(e.shape.length)}),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new dt("batchDot is not implemented for complex64-type Tensors yet.");var r=n.shape.length,a=e.shape.length;t==null&&(t=[r-1,a-2]);var i=t;return _.tidy(function(){var o;if(r>a){o=r-a;for(var s=[],u=0;u<o;++u)s.push(1);e=_.reshape(e,e.shape.concat(s))}else if(a>r){o=a-r;for(var s=[],u=0;u<o;++u)s.push(1);n=_.reshape(n,n.shape.concat(s))}else o=0;var c;if(n.shape.length===2&&e.shape.length===2)i[0]===i[1]?c=_.sum(_.mul(n,e),i[0]):c=_.sum(_.mul(_.transpose(n,[1,0]),e),i[1]);else{var l=i[0]!==n.shape.length-1,f=i[1]===e.shape.length-1;c=_.matMul(n,e,l,f)}if(o>0){var h=void 0;r>a?h=r+a-3:h=r-1;for(var p=[],u=h;u<h+o;++u)p.push(u);c=_.squeeze(c,p)}return c.shape.length===1&&(c=_.expandDims(c,1)),c})}var d1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.axes=t.axes,r.normalize=t.normalize==null?!1:t.normalize,r.supportsMasking=!0,r.reshapeRequired=!1,r}return e.prototype.build=function(t){_.util.assert(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var r=t[0],a=t[1];if(r.length>3||a.length>3)throw new dt("Dot layer does not support tensors of 4D or higher rank yet.");var i=this.interpretAxes(r,a);if(r[i[0]]!==a[i[1]])throw new Z("Dimension incompatibility: "+"".concat(r[i[0]]," !== ").concat(a[i[1]]))},e.prototype.mergeFunction=function(t){if(t.length!==2)throw new Z("A `Dot` layer must be called on exactly 2 inputs, "+"but received ".concat(t.length," input(s)."));var r=t[0],a=t[1],i;return Array.isArray(this.axes)?i=this.axes.map(function(o,s){return vf(o,t[s].shape.length)}):i=[vf(this.axes,r.shape.length),vf(this.axes,a.shape.length)],this.normalize&&(r=Ld(r,i[0]),a=Ld(a,i[1])),Rye(r,a,i)},e.prototype.interpretAxes=function(t,r){var a;return Array.isArray(this.axes)?a=this.axes:a=[vf(this.axes,t.length),vf(this.axes,r.length)],a},e.prototype.computeOutputShape=function(t){_.util.assert(Array.isArray(t)&&t.length===2&&Array.isArray(t[0])&&Array.isArray(t[1]),function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."});var r=t[0].slice(),a=t[1].slice();if(r.length>3||a.length>3)throw new dt("Dot layer does not support tensors of 4D or higher rank yet.");var i=this.interpretAxes(r,a);r.splice(i[0],1),a.splice(i[1],1),a.splice(0,1);var o=r.concat(a);return o.length===1&&o.push(1),o},e.prototype.computeMask=function(t,r){return null},e.prototype.getConfig=function(){var t={axes:this.axes,normalize:this.normalize},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(Hs);d1.className="Dot";R.serialization.registerClass(d1);var v1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.supportsMasking=!0,r.stddev=t.stddev,r}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r={stddev:this.stddev};return Object.assign(r,t),r},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t),o=function(){return R.add(Gd(i.shape,0,a.stddev),i)},s=Af(o,function(){return i},r.training||!1);return s})},e}(gt);v1.className="GaussianNoise";R.serialization.registerClass(v1);var m1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.supportsMasking=!0,r.rate=t.rate,r}return e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r={rate:this.rate};return Object.assign(r,t),r},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r);var i=it(t);if(a.rate>0&&a.rate<1){var o=function(){var s=Math.sqrt(a.rate/(1-a.rate));return R.mul(i,Gd(i.shape,1,s))};return Af(o,function(){return i},r.training||!1)}return i})},e}(gt);m1.className="GaussianDropout";R.serialization.registerClass(m1);var g1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.supportsMasking=!0,r.rate=t.rate,r.noiseShape=t.noiseShape,r}return e.prototype._getNoiseShape=function(t){return this.noiseShape||it(t).shape},e.prototype.computeOutputShape=function(t){return t},e.prototype.getConfig=function(){var t=n.prototype.getConfig.call(this),r={rate:this.rate};return Object.assign(r,t),r},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){if(a.rate<1&&a.rate>0){var i=a._getNoiseShape(t),o=function(){var s=it(t),u=1.6732632423543772,c=1.0507009873554805,l=-u*c,f=R.greaterEqual(R.randomUniform(i),a.rate);f=Ri(f,"float32");var h=Math.pow((1-a.rate)*(1+a.rate*Math.pow(l,2)),-.5),p=-h*l*a.rate,d=R.add(R.mul(s,f),R.mul(R.add(f,-1),l));return R.add(R.mul(d,h),p)};return Af(o,function(){return it(t)},r.training||!1)}return t})},e}(gt);g1.className="AlphaDropout";R.serialization.registerClass(g1);function Tf(n,e,t,r,a,i){i===void 0&&(i=.001);var o;if(n.rank===2)o=_.batchNorm2d(n,e,t,r,a,i);else if(n.rank===3)o=_.batchNorm3d(n,e,t,r,a,i);else if(n.rank===4)o=_.batchNorm4d(n,e,t,r,a,i);else throw new dt("batchNormalization is not implemented for array of rank ".concat(n.rank," ")+"yet");return o}function Oye(n,e,t,r,a){return a===void 0&&(a=.001),R.tidy(function(){var i=_.moments(n,r),o=i.mean,s=i.variance,u=Tf(n,o,s,t,e,a);return[u,o,s]})}function Pye(n,e,t,r,a){return a===void 0&&(a=.001),R.tidy(function(){var i,o,s=_.moments(n,r),u=s.mean,c=s.variance,l=[];try{for(var f=fe(fi(0,n.rank)),h=f.next();!h.done;h=f.next()){var p=h.value;r.indexOf(p)!==-1?l.push(1):l.push(n.shape[p])}}catch(b){i={error:b}}finally{try{h&&!h.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}var d=R.reshape(u,l),v=R.reshape(c,l),m=e==null?null:R.reshape(e,l),g=t==null?null:R.reshape(t,l),y=Tf(n,d,v,g,m,a);return[y,u,c]})}function Mye(n,e,t,r,a){return a===void 0&&(a=.001),R.util.arraysEqual(r.slice().sort(),fi(0,n.rank-1))?Oye(n,e,t,r,a):Pye(n,e,t,r,a)}var y1=function(n){se(e,n);function e(t){var r=this;return t==null&&(t={}),r=n.call(this,t)||this,r.supportsMasking=!0,r.axis=t.axis==null?-1:t.axis,r.momentum=t.momentum==null?.99:t.momentum,r.epsilon=t.epsilon==null?.001:t.epsilon,r.center=t.center==null?!0:t.center,r.scale=t.scale==null?!0:t.scale,r.betaInitializer=cn(t.betaInitializer||"zeros"),r.gammaInitializer=cn(t.gammaInitializer||"ones"),r.movingMeanInitializer=cn(t.movingMeanInitializer||"zeros"),r.movingVarianceInitializer=cn(t.movingVarianceInitializer||"ones"),r.betaConstraint=Vn(t.betaConstraint),r.gammaConstraint=Vn(t.gammaConstraint),r.betaRegularizer=ln(t.betaRegularizer),r.gammaRegularizer=ln(t.gammaRegularizer),r}return e.prototype.build=function(t){var r;t=Et(t);var a=this.axis>=0?this.axis:this.axis+t.length,i=t[a];if(i==null)throw new Z("Axis ".concat(a," of input tensor should have a defined dimension but ")+"the layer received an input with shape "+"".concat(JSON.stringify(t),"."));this.inputSpec=[new Ln({ndim:t.length,axes:(r={},r[a]=i,r)})];var o=[i];this.scale&&(this.gamma=this.addWeight("gamma",o,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",o,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",o,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",o,null,this.movingVarianceInitializer,null,!1),this.built=!0},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i=r.training==null?!1:r.training,o=it(t),s=o.shape,u=s.length,c=fi(0,u),l=a.axis>=0?a.axis:a.axis+u;c.splice(l,1);var f=Ps(1,u);f[l]=s[l];var h=c.slice();h.sort();var p=!R.util.arraysEqual(h,fi(0,u).slice(0,u-1)),d=function(){if(p){var x=R.reshape(a.movingMean.read(),f),N=R.reshape(a.movingVariance.read(),f),T=a.center?R.reshape(a.beta.read(),f):null,E=a.scale?R.reshape(a.gamma.read(),f):null;return Tf(o,x,N,T,E,a.epsilon)}else return Tf(o,a.movingMean.read(),a.movingVariance.read(),a.beta==null?null:a.beta.read(),a.gamma==null?null:a.gamma.read(),a.epsilon)};if(!i)return d();var v=te(Mye(o,a.gamma.read(),a.beta.read(),c,a.epsilon),3),m=v[0],g=v[1],y=v[2],b=function(x,N,T){_.tidy(function(){var E=1-T,C=x.read(),F=_.mul(_.sub(C,N),E);x.write(_.sub(C,F))})},w=function(){b(a.movingMean,g,a.momentum),b(a.movingVariance,y,a.momentum)};return w(),m})},e.prototype.getConfig=function(){var t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:mn(this.betaInitializer),gammaInitializer:mn(this.gammaInitializer),movingMeanInitializer:mn(this.movingMeanInitializer),movingVarianceInitializer:mn(this.movingVarianceInitializer),betaRegularizer:zt(this.betaRegularizer),gammaRegularizer:zt(this.gammaRegularizer),betaConstraint:Wn(this.betaConstraint),gammaConstraint:Wn(this.gammaConstraint)},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);y1.className="BatchNormalization";R.serialization.registerClass(y1);var b1=function(n){se(e,n);function e(t){var r,a,i=this;if(t==null&&(t={}),i=n.call(this,t)||this,i.axis=t.axis==null?-1:t.axis,typeof i.axis=="number"){if(!Number.isInteger(i.axis))throw new Error("Expected axis to be an integer, but received ".concat(i.axis))}else if(Array.isArray(i.axis))try{for(var o=fe(i.axis),s=o.next();!s.done;s=o.next()){var u=s.value;if(!Number.isInteger(u))throw new Error("Expected axis to be an array of integers, "+"but received ".concat(JSON.stringify(i.axis)))}}catch(c){r={error:c}}finally{try{s&&!s.done&&(a=o.return)&&a.call(o)}finally{if(r)throw r.error}}else throw new Error("Expected axis to be an integer or an array of integers, "+"but received ".concat(JSON.stringify(i.axis)));return i.epsilon=t.epsilon==null?.001:t.epsilon,i.center=t.center==null?!0:t.center,i.scale=t.scale==null?!0:t.scale,i.betaInitializer=cn(t.betaInitializer||"zeros"),i.gammaInitializer=cn(t.gammaInitializer||"ones"),i.betaRegularizer=ln(t.betaRegularizer),i.gammaRegularizer=ln(t.gammaRegularizer),i.supportsMasking=!0,i}return e.prototype.build=function(t){var r,a;t=Et(t);var i=t.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(var o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=i);try{for(var s=fe(this.axis),u=s.next();!u.done;u=s.next()){var c=u.value;if(c<0||c>=i)throw new Error("Invalid axis: ".concat(c))}}catch(h){r={error:h}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}if(this.axis.length!==Lo(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));var l=this.axis.map(function(h){return t[h]}),f=!0;this.scale?this.gamma=this.addWeight("gamma",l,"float32",this.gammaInitializer,this.gammaRegularizer,f):this.gamma=null,this.center?this.beta=this.addWeight("beta",l,"float32",this.betaInitializer,this.betaRegularizer,f):this.beta=null,this.built=!0},e.prototype.call=function(t,r){var a=this,i=it(t),o=i.shape,s=o.length;return R.tidy(function(){var u,c,l=!0,f=R.moments(i,a.axis,l),h=f.mean,p=f.variance,d=Ps(1,s);try{for(var v=fe(a.axis),m=v.next();!m.done;m=v.next()){var g=m.value;d[g]=o[g]}}catch(E){u={error:E}}finally{try{m&&!m.done&&(c=v.return)&&c.call(v)}finally{if(u)throw u.error}}for(var y=function(E){return E!=null&&E.shape.length!==s?_.reshape(E,d):E},b=a.scale?y(a.gamma.read()):null,w=a.center?y(a.beta.read()):null,x=[],N=[],T=0;T<s;++T)a.axis.indexOf(T)!==-1?(x.push(o[T]),N.push(1)):(x.push(1),N.push(o[T]));return h=_.tile(h,x),p=_.tile(p,x),b!=null&&(b=_.tile(b,N)),w!=null&&(w=_.tile(w,N)),Tf(i,h,p,w,b,a.epsilon)})},e.prototype.getConfig=function(){var t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:mn(this.betaInitializer),gammaInitializer:mn(this.gammaInitializer),betaRegularizer:zt(this.betaRegularizer),gammaRegularizer:zt(this.gammaRegularizer)},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);b1.className="LayerNormalization";R.serialization.registerClass(b1);function Bye(n,e,t){return R.tidy(function(){if(n.rank!==4)throw new Z("temporalPadding expects input tensor to be 4-D, but received a "+"".concat(n.rank,"-D tensor."));if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new Z("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=hi()),t!=="channelsLast"&&t!=="channelsFirst")throw new Z("Unknown data format: ".concat(t,". ")+"Supported data formats are 'channelsLast' and 'channelsFirst.");var r;return t==="channelsFirst"?r=[[0,0],[0,0],e[0],e[1]]:r=[[0,0],e[0],e[1],[0,0]],_.pad(n,r)})}var w1=function(n){se(e,n);function e(t){var r=this;if(t==null&&(t={}),r=n.call(this,t)||this,r.dataFormat=t.dataFormat==null?hi():t.dataFormat,t.padding==null)r.padding=[[1,1],[1,1]];else if(typeof t.padding=="number")r.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,t.padding.length!==2)throw new Z("ZeroPadding2D expects padding to be a length-2 array, but "+"received a length-".concat(t.padding.length," array."));var a=void 0,i=void 0;if(typeof t.padding[0]=="number")a=[t.padding[0],t.padding[0]],i=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,t.padding[0].length!==2)throw new Z("ZeroPadding2D expects height padding to be a length-2 array, "+"but received a length-".concat(t.padding[0].length," array."));if(a=t.padding[0],t.padding[1].length!==2)throw new Z("ZeroPadding2D expects width padding to be a length-2 array, "+"but received a length-".concat(t.padding[1].length," array."));i=t.padding[1]}r.padding=[a,i]}return r.inputSpec=[new Ln({ndim:4})],r}return e.prototype.computeOutputShape=function(t){t=Et(t);var r,a;return this.dataFormat==="channelsFirst"?(t[2]!=null&&t[2]>=0?r=t[2]+this.padding[0][0]+this.padding[0][1]:r=null,t[3]!=null&&t[3]>=0?a=t[3]+this.padding[1][0]+this.padding[1][1]:a=null,[t[0],t[1],r,a]):(t[1]!=null&&t[1]>=0?r=t[1]+this.padding[0][0]+this.padding[0][1]:r=null,t[2]!=null&&t[2]>=0?a=t[2]+this.padding[1][0]+this.padding[1][1]:a=null,[t[0],r,a,t[3]])},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){return Bye(it(t),a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={padding:this.padding,dataFormat:this.dataFormat},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt);w1.className="ZeroPadding2D";R.serialization.registerClass(w1);function pv(n,e,t,r,a,i){return R.tidy(function(){Dn(a),FO(i),da(r),t==null&&(t=[1,1]),r==null&&(r="valid"),a==null&&(a=hi()),i==null&&(i="max"),n=qb(n,a);var o,s=r==="same"?"same":"valid";return i==="max"?o=_.maxPool(n,e,t,s):o=_.avgPool(n,e,t,s),a==="channelsFirst"&&(o=_.transpose(o,[0,3,1,2])),o})}function qM(n,e,t,r,a,i){return R.tidy(function(){Dn(a),FO(i),da(r),t==null&&(t=[1,1,1]),r==null&&(r="valid"),a==null&&(a=hi()),i==null&&(i="max"),n=PM(n,a);var o,s=r==="same"?"same":"valid";return i==="max"?o=_.maxPool3d(n,e,t,s):o=_.avgPool3d(n,e,t,s),a==="channelsFirst"&&(o=_.transpose(o,[0,4,1,2,3])),o})}var WM=function(n){se(e,n);function e(t){var r=this;if(t.poolSize==null&&(t.poolSize=2),r=n.call(this,t)||this,typeof t.poolSize=="number")r.poolSize=[t.poolSize];else if(Array.isArray(t.poolSize)&&t.poolSize.length===1&&typeof t.poolSize[0]=="number")r.poolSize=t.poolSize;else throw new Z("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(t.poolSize)));if(Kn(r.poolSize,"poolSize"),t.strides==null)r.strides=r.poolSize;else if(typeof t.strides=="number")r.strides=[t.strides];else if(Array.isArray(t.strides)&&t.strides.length===1&&typeof t.strides[0]=="number")r.strides=t.strides;else throw new Z("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(t.strides)));return Kn(r.strides,"strides"),r.padding=t.padding==null?"valid":t.padding,da(r.padding),r.inputSpec=[new Ln({ndim:3})],r}return e.prototype.computeOutputShape=function(t){t=Et(t);var r=li(t[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],r,t[2]]},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){a.invokeCallHook(t,r),t=If(it(t),2);var i=a.poolingFunction(it(t),[a.poolSize[0],1],[a.strides[0],1],a.padding,"channelsLast");return _.squeeze(i,[2])})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt),x1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.poolingFunction=function(t,r,a,i,o){return Dn(o),da(i),pv(t,r,a,i,o,"max")},e}(WM);x1.className="MaxPooling1D";R.serialization.registerClass(x1);var k1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.poolingFunction=function(t,r,a,i,o){return Dn(o),da(i),pv(t,r,a,i,o,"avg")},e}(WM);k1.className="AveragePooling1D";R.serialization.registerClass(k1);var VM=function(n){se(e,n);function e(t){var r=this;if(t.poolSize==null&&(t.poolSize=[2,2]),r=n.call(this,t)||this,r.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],t.strides==null)r.strides=r.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==2)throw new Z("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+"".concat(t.strides.length,"."));r.strides=t.strides}else r.strides=[t.strides,t.strides];return Kn(r.poolSize,"poolSize"),Kn(r.strides,"strides"),r.padding=t.padding==null?"valid":t.padding,r.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Dn(r.dataFormat),da(r.padding),r.inputSpec=[new Ln({ndim:4})],r}return e.prototype.computeOutputShape=function(t){t=Et(t);var r=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2];return r=li(r,this.poolSize[0],this.padding,this.strides[0]),a=li(a,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[t[0],t[1],r,a]:[t[0],r,a,t[3]]},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){return a.invokeCallHook(t,r),a.poolingFunction(it(t),a.poolSize,a.strides,a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt),S1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.poolingFunction=function(t,r,a,i,o){return Dn(o),da(i),pv(t,r,a,i,o,"max")},e}(VM);S1.className="MaxPooling2D";R.serialization.registerClass(S1);var N1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.poolingFunction=function(t,r,a,i,o){return Dn(o),da(i),pv(t,r,a,i,o,"avg")},e}(VM);N1.className="AveragePooling2D";R.serialization.registerClass(N1);var GM=function(n){se(e,n);function e(t){var r=this;if(t.poolSize==null&&(t.poolSize=[2,2,2]),r=n.call(this,t)||this,r.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],t.strides==null)r.strides=r.poolSize;else if(Array.isArray(t.strides)){if(t.strides.length!==3)throw new Z("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+"".concat(t.strides.length,"."));r.strides=t.strides}else r.strides=[t.strides,t.strides,t.strides];return Kn(r.poolSize,"poolSize"),Kn(r.strides,"strides"),r.padding=t.padding==null?"valid":t.padding,r.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Dn(r.dataFormat),da(r.padding),r.inputSpec=[new Ln({ndim:5})],r}return e.prototype.computeOutputShape=function(t){t=Et(t);var r=this.dataFormat==="channelsFirst"?t[2]:t[1],a=this.dataFormat==="channelsFirst"?t[3]:t[2],i=this.dataFormat==="channelsFirst"?t[4]:t[3];return r=li(r,this.poolSize[0],this.padding,this.strides[0]),a=li(a,this.poolSize[1],this.padding,this.strides[1]),i=li(i,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[t[0],t[1],r,a,i]:[t[0],r,a,i,t[4]]},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){return a.invokeCallHook(t,r),a.poolingFunction(it(t),a.poolSize,a.strides,a.padding,a.dataFormat)})},e.prototype.getConfig=function(){var t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt),T1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.poolingFunction=function(t,r,a,i,o){return Dn(o),da(i),qM(t,r,a,i,o,"max")},e}(GM);T1.className="MaxPooling3D";R.serialization.registerClass(T1);var E1=function(n){se(e,n);function e(t){return n.call(this,t)||this}return e.prototype.poolingFunction=function(t,r,a,i,o){return Dn(o),da(i),qM(t,r,a,i,o,"avg")},e}(GM);E1.className="AveragePooling3D";R.serialization.registerClass(E1);var UM=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.inputSpec=[new Ln({ndim:3})],r}return e.prototype.computeOutputShape=function(t){return[t[0],t[2]]},e.prototype.call=function(t,r){throw new dt},e}(gt),I1=function(n){se(e,n);function e(t){return n.call(this,t||{})||this}return e.prototype.call=function(t,r){return R.tidy(function(){var a=it(t);return _.mean(a,1)})},e}(UM);I1.className="GlobalAveragePooling1D";R.serialization.registerClass(I1);var C1=function(n){se(e,n);function e(t){return n.call(this,t||{})||this}return e.prototype.call=function(t,r){return R.tidy(function(){var a=it(t);return _.max(a,1)})},e}(UM);C1.className="GlobalMaxPooling1D";R.serialization.registerClass(C1);var HM=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,Dn(r.dataFormat),r.inputSpec=[new Ln({ndim:4})],r}return e.prototype.computeOutputShape=function(t){return t=t,this.dataFormat==="channelsLast"?[t[0],t[3]]:[t[0],t[1]]},e.prototype.call=function(t,r){throw new dt},e.prototype.getConfig=function(){var t={dataFormat:this.dataFormat},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e}(gt),A1=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i=it(t);return a.dataFormat==="channelsLast"?_.mean(i,[1,2]):_.mean(i,[2,3])})},e}(HM);A1.className="GlobalAveragePooling2D";R.serialization.registerClass(A1);var _1=function(n){se(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i=it(t);return a.dataFormat==="channelsLast"?_.max(i,[1,2]):_.max(i,[2,3])})},e}(HM);_1.className="GlobalMaxPooling2D";R.serialization.registerClass(_1);var KM=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.layer=t.layer,r}return e.prototype.build=function(t){this.built=!0},Object.defineProperty(e.prototype,"trainable",{get:function(){return this.layer!=null?this.layer.trainable:!1},set:function(t){this.layer!=null&&(this.layer.trainable=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.layer.trainableWeights},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.layer.nonTrainableWeights},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updates",{get:function(){return this.layer._updates},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"losses",{get:function(){return this.layer.losses},enumerable:!1,configurable:!0}),e.prototype.getWeights=function(){return this.layer.getWeights()},e.prototype.setWeights=function(t){this.layer.setWeights(t)},e.prototype.getConfig=function(){var t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e.prototype.setFastWeightInitDuringBuild=function(t){n.prototype.setFastWeightInitDuringBuild.call(this,t),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(t)},e.fromConfig=function(t,r,a){a===void 0&&(a={});var i=r.layer,o=ci(i,a);delete r.layer;var s={layer:o};return Object.assign(s,r),new t(s)},e}(gt),D1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.supportsMasking=!0,r}return e.prototype.build=function(t){if(t=Et(t),t.length<3)throw new Z("TimeDistributed layer expects an input shape >= 3D, but received "+"input shape ".concat(JSON.stringify(t)));this.inputSpec=[{shape:t}];var r=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(r),this.layer.built=!0),n.prototype.build.call(this,t)},e.prototype.computeOutputShape=function(t){t=Et(t);var r=[t[0]].concat(t.slice(2)),a=this.layer.computeOutputShape(r),i=t[1];return[a[0],i].concat(a.slice(1))},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){t=it(t);var i=function(u,c){var l=it(a.layer.call(u,r));return[l,[]]},o=zM(i,t,[],!1,null,null,!1,!0),s=o[1];return s})},e}(KM);D1.className="TimeDistributed";R.serialization.registerClass(D1);function Lye(n){Bs(zle,"BidirectionalMergeMode",n)}var zye="concat",F1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this,a=t.layer.getConfig(),i={};i.className=t.layer.getClassName(),i.config=a,r.forwardLayer=ci(i),a.goBackwards=a.goBackwards!==!0;var o={};if(o.className=t.layer.getClassName(),o.config=a,r.backwardLayer=ci(o),r.forwardLayer.name="forward_"+r.forwardLayer.name,r.backwardLayer.name="backward_"+r.backwardLayer.name,r.mergeMode=t.mergeMode===void 0?zye:t.mergeMode,Lye(r.mergeMode),t.weights)throw new dt("weights support is not implemented for Bidirectional layer yet.");return r._stateful=t.layer.stateful,r.returnSequences=t.layer.returnSequences,r.returnState=t.layer.returnState,r.supportsMasking=!0,r._trainable=!0,r.inputSpec=t.layer.inputSpec,r.numConstants=null,r}return Object.defineProperty(e.prototype,"trainable",{get:function(){return this._trainable},set:function(t){this._trainable=t,this.forwardLayer!=null&&(this.forwardLayer.trainable=t),this.backwardLayer!=null&&(this.backwardLayer.trainable=t)},enumerable:!1,configurable:!0}),e.prototype.getWeights=function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())},e.prototype.setWeights=function(t){var r=t.length,a=Math.floor(r/2);this.forwardLayer.setWeights(t.slice(0,a)),this.backwardLayer.setWeights(t.slice(a))},e.prototype.computeOutputShape=function(t){var r=this.forwardLayer.computeOutputShape(t);Array.isArray(r)&&Array.isArray(r[0])||(r=[r]),r=r;var a,i,o;return this.returnState&&(o=r.slice(1)),a=r[0],a=a,this.mergeMode==="concat"?(a[a.length-1]*=2,i=[a]):this.mergeMode==null?i=[a,a.slice()]:i=[a],this.returnState?this.mergeMode==null?i.concat(o).concat(o.slice()):[a].concat(o).concat(o.slice()):Ir(i)},e.prototype.apply=function(t,r){var a,i,o=r==null?null:r.initialState,s=r==null?null:r.constants;r==null&&(r={});var u=LM(t,o,s,this.numConstants);if(t=u.inputs,o=u.initialState,s=u.constants,Array.isArray(t)&&(o=t.slice(1),t=t[0]),(o==null||o.length===0)&&s==null)return n.prototype.apply.call(this,t,r);var c=[],l=[];if(o!=null){var f=o.length;if(f%2>0)throw new Z("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");r.initialState=o,c.push.apply(c,Qe([],te(o),!1));var h=o.map(function(x){return new Ln({shape:x.shape})});this.forwardLayer.stateSpec=h.slice(0,f/2),this.backwardLayer.stateSpec=h.slice(f/2),l.push.apply(l,Qe([],te(h),!1))}if(s!=null)throw new dt("Support for constants in Bidirectional layers is not implemented yet.");var p=c[0]instanceof ui;try{for(var d=fe(c),v=d.next();!v.done;v=d.next()){var m=v.value;if(m instanceof ui!==p)throw new Z("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}}catch(x){a={error:x}}finally{try{v&&!v.done&&(i=d.return)&&i.call(d)}finally{if(a)throw a.error}}if(p){var g=[t].concat(c),y=this.inputSpec.concat(l),b=this.inputSpec;this.inputSpec=y;var w=n.prototype.apply.call(this,g,r);return this.inputSpec=b,w}else return n.prototype.apply.call(this,t,r)},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i=r.initialState,o,s;if(i==null)o=a.forwardLayer.call(t,r),s=a.backwardLayer.call(t,r);else{var u=i.slice(0,i.length/2),c=i.slice(i.length/2);o=a.forwardLayer.call(t,Object.assign(r,{initialState:u})),s=a.backwardLayer.call(t,Object.assign(r,{initialState:c}))}var l;a.returnState&&(Array.isArray(o)&&(l=o.slice(1).concat(s.slice(1))),o=o[0],s=s[0]),a.returnSequences&&(s=_.reverse(s,1));var f;return a.mergeMode==="concat"?f=Hy([o,s]):a.mergeMode==="sum"?f=_.add(o,s):a.mergeMode==="ave"?f=_.mul(.5,_.add(o,s)):a.mergeMode==="mul"?f=_.mul(o,s):a.mergeMode==null&&(f=[o,s]),a.returnState?a.mergeMode==null?f.concat(l):[f].concat(l):f})},e.prototype.resetStates=function(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()},e.prototype.build=function(t){var r=this;Rs(this.forwardLayer.name,function(){r.forwardLayer.build(t)}),Rs(this.backwardLayer.name,function(){r.backwardLayer.build(t)}),this.built=!0},e.prototype.computeMask=function(t,r){Array.isArray(r)&&(r=r[0]);var a;if(this.returnSequences?this.mergeMode==null?a=[r,r]:a=r:this.mergeMode==null?a=[null,null]:a=null,this.returnState){var i=this.forwardLayer.states,o=i.map(function(s){return null});return Array.isArray(a)?a.concat(o).concat(o):[a].concat(o).concat(o)}else return a},Object.defineProperty(e.prototype,"trainableWeights",{get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nonTrainableWeights",{get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)},enumerable:!1,configurable:!0}),e.prototype.setFastWeightInitDuringBuild=function(t){n.prototype.setFastWeightInitDuringBuild.call(this,t),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(t),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(t)},e.prototype.getConfig=function(){var t={mergeMode:this.mergeMode},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e.fromConfig=function(t,r){var a=ci(r.layer);if(delete r.layer,r.numConstants!=null)throw new dt("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var i=r;return i.layer=a,new t(i)},e}(KM);F1.className="Bidirectional";R.serialization.registerClass(F1);var R1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.scale=t.scale,t.offset?r.offset=t.offset:r.offset=0,r}return e.prototype.getConfig=function(){var t={scale:this.scale,offset:this.offset},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){return t=it(t),t.dtype!=="float32"&&(t=Ri(t,"float32")),R.add(R.mul(t,a.scale),a.offset)})},e}(gt);R1.className="Rescaling";R.serialization.registerClass(R1);var $ye=R.image.resizeBilinear,qye=R.image.cropAndResize,O1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.height=t.height,r.width=t.width,r}return e.prototype.centerCrop=function(t,r,a,i,o,s,u,c){return R.tidy(function(){var l,f=!1,h=r/s,p=a/u,d=(i+r)/s,v=(o+a)/u,m=[h,p,d,v],g=[];t.rank===3?(f=!0,l=R.stack([t])):l=t;for(var y=0;y<l.shape[0];y++)g.push(m);var b=R.tensor(g,[g.length,4]),w=R.range(0,g.length,1,"int32"),x=[i,o],N=qye(l,b,w,x,"nearest");return Ri(f?it(R.unstack(N)):N,c)})},e.prototype.upsize=function(t,r,a,i){return R.tidy(function(){var o=$ye(t,[r,a]);return Ri(o,i)})},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i=it(t),o=i.dtype,s=i.shape,u=s[s.length-3],c=s[s.length-2],l=0;u!==a.height&&(l=Math.floor((u-a.height)/2));var f=0;return c!==a.width&&(f=Math.floor((c-a.width)/2),f===0&&(f=1)),l>=0&&f>=0?a.centerCrop(i,l,f,a.height,a.width,u,c,o):a.upsize(t,a.height,a.width,o)})},e.prototype.getConfig=function(){var t={height:this.height,width:this.width},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e.prototype.computeOutputShape=function(t){t=Et(t);var r=t.length-3,a=t.length-2;return t[r]=this.height,t[a]=this.width,t},e}(gt);O1.className="CenterCrop";R.serialization.registerClass(O1);function Wye(n,e,t,r){var a=it(n);if(a.dtype!=="int32"&&(a=Ri(a,"int32")),e==="int")return a;var i=a.shape;if(a.rank===0&&(a=R.expandDims(a,-1)),e==="oneHot"&&a.shape[a.shape.length-1]!==1&&(a=R.expandDims(a,-1)),a.rank>2)throw new Z("When outputMode is not int, maximum output rank is 2"+" Received outputMode ".concat(e," and input shape ").concat(i)+" which would result in output rank ".concat(a.rank,"."));var o=["multiHot","oneHot"].includes(e),s=a,u;if(typeof r<"u"&&e==="count"?u=R.denseBincount(s,r,t,o):u=R.denseBincount(s,[],t,o),e!=="tfIdf")return u;if(r)return R.mul(u,r);throw new Z("When outputMode is 'tfIdf', weights must be provided.")}var P1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;return r.numTokens=t.numTokens,t.outputMode?r.outputMode=t.outputMode:r.outputMode="multiHot",r}return e.prototype.getConfig=function(){var t={numTokens:this.numTokens,outputMode:this.outputMode},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e.prototype.computeOutputShape=function(t){return t=Et(t),t==null?[this.numTokens]:this.outputMode==="oneHot"&&t[t.length-1]!==1?(t.push(this.numTokens),t):(t[t.length-1]=this.numTokens,t)},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){t=it(t),t.dtype!=="int32"&&(t=Ri(t,"int32"));var i;if(typeof r.countWeights<"u"){if(a.outputMode!=="count")throw new Z(`countWeights is not used when outputMode !== count.
              Received countWeights=`.concat(r.countWeights));i=it(r.countWeights)}var o=R.max(t),s=R.min(t),u=R.greater(a.numTokens,o).bufferSync().get(0),c=R.greaterEqual(s,0).bufferSync().get(0);if(!(u&&c))throw new Z("Input values must be between 0 < values <="+" numTokens with numTokens=".concat(a.numTokens));return Wye(t,a.outputMode,a.numTokens,i)})},e}(gt);P1.className="CategoryEncoding";R.serialization.registerClass(P1);var Vye=["bilinear","nearest"],EO=new Set(Vye),M1=function(n){se(e,n);function e(t){var r=n.call(this,t)||this;if(r.height=t.height,r.width=t.width,t.interpolation)if(EO.has(t.interpolation))r.interpolation=t.interpolation;else throw new Z("Invalid interpolation parameter: ".concat(t.interpolation," is not implemented"));else r.interpolation="bilinear";return r.cropToAspectRatio=Boolean(t.cropToAspectRatio),r}return e.prototype.computeOutputShape=function(t){t=Et(t);var r=t[2];return[this.height,this.width,r]},e.prototype.getConfig=function(){var t={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},r=n.prototype.getConfig.call(this);return Object.assign(t,r),t},e.prototype.call=function(t,r){var a=this;return R.tidy(function(){var i=[a.height,a.width];if(a.interpolation==="bilinear")return R.image.resizeBilinear(t,i,!a.cropToAspectRatio);if(a.interpolation==="nearest")return R.image.resizeNearestNeighbor(t,i,!a.cropToAspectRatio);throw new Error("Interpolation is ".concat(a.interpolation," but only ").concat(Qe([],te(EO),!1)," are supported"))})},e}(gt);M1.className="Resizing";R.serialization.registerClass(M1);function Gye(n){return new pc(n)}function Uye(n){return new Lb(n)}function Hye(n){return new Pb(n)}function Kye(n){return new Mb(n)}function jye(n){return new Bb(n)}function Xye(n){return new $b(n)}function Yye(n){return new zb(n)}function Zye(n){return new Ub(n)}function Jye(n){return new ov(n)}function Qye(n){return new Wb(n)}function ebe(n){return new sv(n)}function tbe(n){return new Vb(n)}function nbe(n){return new Gb(n)}function rbe(n){return new Hb(n)}function abe(n){return new Kb(n)}function ibe(n){return new jb(n)}function obe(n){return new n1(n)}function sbe(n){return new e1(n)}function ube(n){return new hv(n)}function cbe(n){return new Qb(n)}function lbe(n){return new t1(n)}function fbe(n){return new r1(n)}function hbe(n){return new a1(n)}function pbe(n){return new i1(n)}function dbe(n){return new s1(n)}function vbe(n){return new u1(n)}function mbe(n){return new l1(n)}function gbe(n){return new p1(n)}function ybe(n){return new f1(n)}function bbe(n){return new h1(n)}function wbe(n){return new c1(n)}function xbe(n){return new d1(n)}function kbe(n){return new y1(n)}function Sbe(n){return new b1(n)}function Nbe(n){return new w1(n)}function B1(n){return new k1(n)}function Tbe(n){return B1(n)}function Ebe(n){return B1(n)}function L1(n){return new N1(n)}function Ibe(n){return L1(n)}function Cbe(n){return L1(n)}function z1(n){return new E1(n)}function Abe(n){return z1(n)}function _be(n){return z1(n)}function Dbe(n){return new I1(n)}function Fbe(n){return new A1(n)}function jM(n){return new C1(n)}function XM(n){return new _1(n)}function YM(n){return new x1(n)}function ZM(n){return new S1(n)}function Rbe(n){return new T1(n)}function Obe(n){return new Yb(n)}function Pbe(n){return new cv(n)}function Mbe(n){return new Zb(n)}function Bbe(n){return new Of(n)}function Lbe(n){return new Xb(n)}function zbe(n){return new uv(n)}function $be(n){return new Jb(n)}function qbe(n){return new fv(n)}function Wbe(n){return new no(n)}function Vbe(n){return new lv(n)}function Gbe(n){return new F1(n)}function Ube(n){return new D1(n)}var Hbe=jM,Kbe=XM,jbe=YM,Xbe=ZM;function Ybe(n){return new v1(n)}function Zbe(n){return new m1(n)}function Jbe(n){return new g1(n)}function Qbe(n){return new o1(n)}function e1e(n){return new R1(n)}function t1e(n){return new O1(n)}function n1e(n){return new M1(n)}function r1e(n){return new P1(n)}var a1e={__proto__:null,inputLayer:Gye,elu:Uye,reLU:Hye,leakyReLU:Kye,prelu:jye,softmax:Xye,thresholdedReLU:Yye,conv1d:Zye,conv2d:Jye,conv2dTranspose:Qye,conv3d:ebe,conv3dTranspose:tbe,separableConv2d:nbe,cropping2D:rbe,upSampling2d:abe,depthwiseConv2d:ibe,activation:obe,dense:sbe,dropout:ube,spatialDropout1d:cbe,flatten:lbe,repeatVector:fbe,reshape:hbe,permute:pbe,embedding:dbe,add:vbe,average:mbe,concatenate:gbe,maximum:ybe,minimum:bbe,multiply:wbe,dot:xbe,batchNormalization:kbe,layerNormalization:Sbe,zeroPadding2d:Nbe,averagePooling1d:B1,avgPool1d:Tbe,avgPooling1d:Ebe,averagePooling2d:L1,avgPool2d:Ibe,avgPooling2d:Cbe,averagePooling3d:z1,avgPool3d:Abe,avgPooling3d:_be,globalAveragePooling1d:Dbe,globalAveragePooling2d:Fbe,globalMaxPooling1d:jM,globalMaxPooling2d:XM,maxPooling1d:YM,maxPooling2d:ZM,maxPooling3d:Rbe,gru:Obe,gruCell:Pbe,lstm:Mbe,lstmCell:Bbe,simpleRNN:Lbe,simpleRNNCell:zbe,convLstm2d:$be,convLstm2dCell:qbe,rnn:Wbe,stackedRNNCells:Vbe,bidirectional:Gbe,timeDistributed:Ube,globalMaxPool1d:Hbe,globalMaxPool2d:Kbe,maxPool1d:jbe,maxPool2d:Xbe,Layer:gt,RNN:no,RNNCell:mc,input:wM,gaussianNoise:Ybe,gaussianDropout:Zbe,alphaDropout:Jbe,masking:Qbe,rescaling:e1e,centerCrop:t1e,resizing:n1e,categoryEncoding:r1e};function i1e(n,e){return Ab(n,e)}function o1e(n,e){return fM(n,e)}function s1e(n,e){return hM(n,e)}function u1e(n,e){return _b(n,e)}function c1e(n,e){return Db(n,e)}function l1e(n,e){return lM(n,e)}function f1e(n,e){return U0e(n,e)}function h1e(n,e){return Cb(n,e)}function p1e(n,e){return nv(n,e)}function d1e(n,e){return vc(n,e)}function v1e(n,e){return vc(n,e)}function m1e(n,e){return vc(n,e)}function g1e(n,e){return Us(n,e)}function y1e(n,e){return Us(n,e)}function b1e(n,e){return Us(n,e)}var w1e={__proto__:null,binaryAccuracy:i1e,binaryCrossentropy:o1e,sparseCategoricalAccuracy:s1e,categoricalAccuracy:u1e,categoricalCrossentropy:c1e,precision:l1e,recall:f1e,cosineProximity:h1e,meanAbsoluteError:p1e,meanAbsolutePercentageError:d1e,MAPE:v1e,mape:m1e,meanSquaredError:g1e,MSE:y1e,mse:b1e};var x1e={__proto__:null,modelFromJSON:wye};function k1e(n){return new Rf(n)}function S1e(n){return Iye(n)}function N1e(n){return Cye(n)}var T1e={__proto__:null,l1l2:k1e,l1:S1e,l2:N1e},JM=function(n){se(e,n);function e(){var t=n.apply(this,Qe([],te(arguments),!1))||this;return t.model=null,t}return e.prototype.setModel=function(t){if(!(t instanceof to))throw new Error("model must be a LayersModel, not some other Container");this.model=t},e}(hc);function wd(n,e){return n<e}function IO(n,e){return n>e}var QM=function(n){se(e,n);function e(t){var r=n.call(this)||this;if(t==null&&(t={}),t.restoreBestWeights)throw new dt("restoreBestWeights = True is not implemented in EarlyStopping yet.");return r.monitor=t.monitor||"val_loss",r.minDelta=Math.abs(t.minDelta||0),r.patience=t.patience||0,r.verbose=t.verbose||0,r.mode=t.mode||"auto",r.baseline=t.baseline,["auto","min","max"].indexOf(r.mode)===-1&&(console.warn("EarlyStopping mode '".concat(r.mode,"' is invalid. ")+"Falling back to mode 'auto'."),r.mode="auto"),r.mode==="min"?r.monitorFunc=wd:r.mode==="max"||r.monitor.indexOf("acc")!==-1?r.monitorFunc=IO:r.monitorFunc=wd,r.monitorFunc===wd&&(r.minDelta*=-1),r}return e.prototype.onTrainBegin=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){return this.wait=0,this.stoppedEpoch=0,this.baseline!=null?this.best=this.baseline:this.best=this.monitorFunc===wd?1/0:-1/0,[2]})})},e.prototype.onEpochEnd=function(t,r){return Ce(this,void 0,void 0,function(){var a;return Ee(this,function(i){switch(i.label){case 0:return[4,Mo(r)];case 1:return i.sent(),a=this.getMonitorValue(r),a==null?[2]:(this.monitorFunc(a-this.minDelta,this.best)?(this.best=a,this.wait=0):(this.wait++,this.wait>=this.patience&&(this.stoppedEpoch=t,this.model.stopTraining=!0)),[2])}})})},e.prototype.onTrainEnd=function(t){return Ce(this,void 0,void 0,function(){return Ee(this,function(r){return this.stoppedEpoch>0&&this.verbose&&console.log("Epoch ".concat(this.stoppedEpoch,": early stopping.")),[2]})})},e.prototype.getMonitorValue=function(t){t==null&&(t={});var r=t[this.monitor];return r==null&&console.warn("Metric for EarlyStopping ".concat(this.monitor," is not available. ")+"Available metrics are: ".concat(Object.keys(t))),r},e}(JM);function E1e(n){return new QM(n)}var I1e={earlyStopping:E1e};Qt.Callback=JM;Qt.CallbackList=aM;Qt.CustomCallback=oM;Qt.EarlyStopping=QM;Qt.History=iM;Qt.InputSpec=Ln;Qt.LayerVariable=LO;Qt.LayersModel=to;Qt.RNN=no;Qt.Sequential=av;Qt.SymbolicTensor=ui;Qt.callbacks=I1e;Qt.constraints=m0e;Qt.initializers=F0e;Qt.input=wM;Qt.layers=a1e;Qt.loadLayersModel=xye;Qt.metrics=w1e;Qt.model=Nye;Qt.models=x1e;Qt.registerCallbackConstructor=Eye;Qt.regularizers=T1e;Qt.sequential=Tye;Qt.version_layers=Fb});var PB=J(jo=>{"use strict";Object.defineProperty(jo,"__esModule",{value:!0});var Be=Cs();function C1e(n){if(n&&n.__esModule)return n;var e=Object.create(null);return n&&Object.keys(n).forEach(function(t){if(t!=="default"){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}}),e.default=n,e}function A1e(n,e){return e.forEach(function(t){Object.keys(t).forEach(function(r){if(r!=="default"&&!(r in n)){var a=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,a.get?a:{enumerable:!0,get:function(){return t[r]}})}})}),n}var t4=C1e(Be);var _1e=Be.env();_1e.registerFlag("KEEP_INTERMEDIATE_TENSORS",function(){return!1},function(n){n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});var U1=function(n,e){return U1=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])},U1(n,e)};function D1e(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");U1(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Pt(n,e,t,r){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(r.next(l))}catch(f){o(f)}}function u(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((r=r.apply(n,e||[])).next())})}function _t(n,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(l){c=[6,l],a=0}finally{r=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function xc(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ne(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=r.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return i}function yn(n,e,t){if(t||arguments.length===2)for(var r=0,a=e.length,i;r<a;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}var za;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(za||(za={}));var n4;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(n4||(n4={}));var gw={};function F1e(n,e){var t={tfOpName:n,category:"custom",inputs:[],attrs:[],customExecutor:e};gw[n]=t}function F4(n){return gw[n]}function R1e(n){delete gw[n]}function I(n,e,t,r,a){var i=e.inputParams[n];if(i&&i.inputIndexStart!==void 0){var o=i.inputIndexStart,s=i.inputIndexEnd===0?void 0:i.inputIndexEnd===void 0?o+1:i.inputIndexEnd;if(i.type==="tensor")return gr(e.inputNames[i.inputIndexStart],t,r,a);if(i.type==="tensors"){var u=e.inputNames.slice(o,s);return u.map(function(h){return gr(h,t,r,a)})}var c=gr(e.inputNames.slice(o)[0],t,r,a),l=c.dataSync();return i.type==="number"?l[0]:Be.util.toNestedArray(c.shape,l)}var f=e.attrParams[n];return f&&f.value}function gr(n,e,t,r){var a=Ne(Zr(n),2),i=a[0],o=a[1];if(r!=null){var s=r.getHashTableHandleByName(i);if(s!=null)return s}var u=t.currentContextIds.find(function(c){return!!e[bv(i,c)]});return u!==void 0?e[bv(i,u)][o]:void 0}function O1e(n,e,t){return e[bv(n,t.currentContextId)]}function ro(n,e){var t=Ne(Zr(n),3),r=t[0],a=t[1],i=t[2];return[bv(r,e&&e.currentContextId),a,i]}function bv(n,e){return e?"".concat(n,"-").concat(e):n}function Zr(n){var e=n.split(":");if(e.length===1)return[n,0,void 0];var t=e[0],r=e.length===3?e[1]:void 0,a=Number(e[e.length-1]);return[t,a,r]}function vv(n,e,t){var r=I("pad",n,e,t);if(r==="explicit"){r=I("explicitPaddings",n,e,t);for(var a=[[0,0],[0,0],[0,0],[0,0]],i=0;i<4;i++)a[i][0]=r[i*2],a[i][1]=r[i*2+1];return a}return r}function ao(n){return n.kept?n:Be.clone(n)}var P1e=[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],M1e={__proto__:null,json:P1e};var B1e=[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],L1e={__proto__:null,json:B1e};var z1e=[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}],$1e={__proto__:null,json:z1e};var q1e=[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}],W1e={__proto__:null,json:q1e};var V1e=[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}],G1e={__proto__:null,json:V1e};var U1e=[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],H1e={__proto__:null,json:U1e};var K1e=[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}],j1e={__proto__:null,json:K1e};var X1e=[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}],Y1e={__proto__:null,json:X1e};var Z1e=[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"InitializeTable",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]},{tfOpName:"InitializeTableV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}]}],J1e={__proto__:null,json:Z1e};var Q1e=[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}],ewe={__proto__:null,json:Q1e};var twe=[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}],nwe={__proto__:null,json:twe};var rwe=[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}],awe={__proto__:null,json:rwe};var iwe=[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}],owe={__proto__:null,json:iwe};var swe=[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}],uwe={__proto__:null,json:swe};var cwe=[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}],lwe={__proto__:null,json:cwe};var fwe=[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}],hwe={__proto__:null,json:fwe};var pwe=[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}],dwe={__proto__:null,json:pwe};var vwe=[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}],mwe={__proto__:null,json:vwe};var gwe=[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}],ywe={__proto__:null,json:gwe},r4=function(){function n(){var e=[M1e,L1e,$1e,W1e,G1e,H1e,j1e,Y1e,J1e,ewe,nwe,awe,owe,uwe,lwe,hwe,dwe,mwe,ywe],t=[].concat.apply([],yn([],Ne(e.map(function(r){return r.json})),!1));this.opMappers=t.reduce(function(r,a){return r[a.tfOpName]=a,r},{})}return Object.defineProperty(n,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!1,configurable:!0}),n.prototype.transformGraph=function(e,t){var r=this;t===void 0&&(t={});var a=e.node,i=[],o=[],s=[],u=a.reduce(function(m,g){return m[g.name]=r.mapNode(g),g.op.startsWith("Placeholder")?i.push(m[g.name]):g.op==="Const"?o.push(m[g.name]):(g.input==null||g.input.length===0)&&s.push(m[g.name]),m},{}),c=[],l=[],f={},h={};t!=null&&(f=this.mapSignatureEntries(t.inputs),h=this.mapSignatureEntries(t.outputs));var p=Object.keys(u);p.forEach(function(m){var g=u[m];g.inputNames.forEach(function(y,b){var w=Ne(ro(y),3),x=w[0],N=w[2],T=u[x];if(T.outputs!=null){var E=T.outputs.indexOf(N);if(E!==-1){var C="".concat(x,":").concat(E);g.inputNames[b]=C}}g.inputs.push(T),T.children.push(g)})}),Object.keys(h).length===0?p.forEach(function(m){var g=u[m];g.children.length===0&&l.push(g)}):Object.keys(h).forEach(function(m){var g=Ne(ro(m),1),y=g[0],b=u[y];b!=null&&(b.signatureKey=h[m],l.push(b))}),Object.keys(f).length>0?Object.keys(f).forEach(function(m){var g=Ne(ro(m),1),y=g[0],b=u[y];b&&(b.signatureKey=f[m],c.push(b))}):c=i;var d={};e.library!=null&&e.library.function!=null&&(d=e.library.function.reduce(function(m,g){return m[g.signature.name]=r.mapFunction(g),m},{}));var v={nodes:u,inputs:c,outputs:l,weights:o,placeholders:i,signature:t,functions:d};return s.length>0&&(v.initNodes=s),v},n.prototype.mapSignatureEntries=function(e){return Object.keys(e||{}).reduce(function(t,r){return t[e[r].name]=r,t},{})},n.prototype.mapNode=function(e){var t=F4(e.op)||this.opMappers[e.op]||{};e.attr==null&&(e.attr={});var r={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map(function(a){return a.startsWith("^")?a.slice(1):a}),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return t.inputs!=null&&(r.inputParams=t.inputs.reduce(function(a,i){return a[i.name]={type:i.type,inputIndexStart:i.start,inputIndexEnd:i.end},a},{})),t.attrs!=null&&(r.attrParams=t.attrs.reduce(function(a,i){var o=i.type,s=void 0;switch(i.type){case"string":s=H1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=H1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"string[]":s=Q1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=Q1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number":s=j1(e.attr,i.tfName,i.defaultValue||0),s===void 0&&!!i.tfDeprecatedName&&(s=j1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"number[]":s=J1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=J1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool":s=K1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=K1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"bool[]":s=tw(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=tw(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape":s=Z1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=Z1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"shape[]":s=ew(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=ew(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype":s=X1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=X1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"dtype[]":s=Y1(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=Y1(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"func":s=a4(e.attr,i.tfName,i.defaultValue),s===void 0&&!!i.tfDeprecatedName&&(s=a4(e.attr,i.tfDeprecatedName,i.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: ".concat(i.type," for op: ").concat(e.op))}return a[i.name]={value:s,type:o},a},{})),r},n.prototype.mapFunction=function(e){var t=this,r=e.nodeDef,a=[],i=[],o={};r!=null&&(o=r.reduce(function(h,p){return h[p.name]=t.mapNode(p),p.op==="Const"&&i.push(h[p.name]),h},{}));var s=[],u=[];e.signature.inputArg.forEach(function(h){var p=Ne(ro(h.name),1),d=p[0],v={name:d,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:yw(h.type),type:"dtype"}},children:[]};v.signatureKey=h.name,s.push(v),o[d]=v});var c=Object.keys(o);c.forEach(function(h){var p=o[h];p.inputNames.forEach(function(d,v){var m=Ne(ro(d),3),g=m[0],y=m[2],b=o[g];if(b.outputs!=null){var w=b.outputs.indexOf(y);if(w!==-1){var x="".concat(g,":").concat(w);p.inputNames[v]=x}}p.inputs.push(b),b.children.push(p)})});var l=e.ret;e.signature.outputArg.forEach(function(h){var p=Ne(ro(l[h.name]),2),d=p[0],v=p[1],m=o[d];m!=null&&(m.defaultOutput=v,u.push(m))});var f=this.mapArgsToSignature(e);return{nodes:o,inputs:s,outputs:u,weights:i,placeholders:a,signature:f}},n.prototype.mapArgsToSignature=function(e){var t=this;return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce(function(r,a){return r[a.name]=t.mapArgToTensorInfo(a),r},{}),outputs:e.signature.outputArg.reduce(function(r,a){return r[a.name]=t.mapArgToTensorInfo(a,e.ret),r},{})}},n.prototype.mapArgToTensorInfo=function(e,t){var r=e.name;return t!=null&&(r=t[r]),{name:r,dtype:e.type}},n}();function bwe(n){var e=Be.env().global;if(typeof e.atob<"u")return e.atob(n);if(typeof Buffer<"u")return new Buffer(n,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}function R4(n,e){var t=Array.isArray(n)?String.fromCharCode.apply(null,n):bwe(n);return e?t:t.toLowerCase()}function H1(n,e,t,r){r===void 0&&(r=!1);var a=n[e];return a!=null?R4(a.s,r):t}function K1(n,e,t){var r=n[e];return r?r.b:t}function j1(n,e,t){var r=n[e]||{},a=r.i!=null?r.i:r.f!=null?r.f:t;return typeof a=="number"?a:parseInt(a,10)}function yw(n){switch(typeof n=="string"&&(n=za[n]),n){case za.DT_FLOAT:case za.DT_HALF:return"float32";case za.DT_INT32:case za.DT_INT64:case za.DT_INT8:case za.DT_UINT8:return"int32";case za.DT_BOOL:return"bool";case za.DT_DOUBLE:return"float32";case za.DT_STRING:return"string";default:return null}}function a4(n,e,t){var r=n[e];return r&&r.func?r.func.name:t}function X1(n,e,t){var r=n[e];return r&&r.type?yw(r.type):t}function Y1(n,e,t){var r=n[e];return r&&r.list&&r.list.type?r.list.type.map(function(a){return yw(a)}):t}function O4(n){if(!n.unknownRank)return n.dim!=null?n.dim.map(function(e){return typeof e.size=="number"?e.size:parseInt(e.size,10)}):[]}function Z1(n,e,t){var r=n[e];return r&&r.shape?O4(r.shape):t}function J1(n,e,t){var r=n[e];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map(function(a){return typeof a=="number"?a:parseInt(a,10)}):t}function Q1(n,e,t,r){r===void 0&&(r=!1);var a=n[e];return a&&a.list&&a.list.s?a.list.s.map(function(i){return R4(i,r)}):t}function ew(n,e,t){var r=n[e];return r&&r.list&&r.list.shape?r.list.shape.map(function(a){return O4(a)}):t}function tw(n,e,t){var r=n[e];return r&&r.list&&r.list.b?r.list.b:t}var wwe=function(){function n(e,t,r){var a=this;this.node=e,this.tensorMap=t,this.context=r,this.inputs=[],this.attrs={},this.inputs=e.inputNames.map(function(i){return a.getInput(i)}),e.rawAttrs!=null&&(this.attrs=Object.keys(e.rawAttrs).reduce(function(i,o){return i[o]=a.getAttr(o),i},{}))}return n.prototype.getInput=function(e){return gr(e,this.tensorMap,this.context)},n.prototype.getAttr=function(e,t){var r=this.node.rawAttrs[e];if(r.tensor!=null)return gr(e,this.tensorMap,this.context);if(r.i!=null||r.f!=null)return j1(this.node.rawAttrs,e,t);if(r.s!=null)return H1(this.node.rawAttrs,e,t);if(r.b!=null)return K1(this.node.rawAttrs,e,t);if(r.shape!=null)return Z1(this.node.rawAttrs,e,t);if(r.type!=null)return X1(this.node.rawAttrs,e,t);if(r.list!=null){if(r.list.i!=null||r.list.f!=null)return J1(this.node.rawAttrs,e,t);if(r.list.s!=null)return Q1(this.node.rawAttrs,e,t);if(r.list.shape!=null)return ew(this.node.rawAttrs,e,t);if(r.list.b!=null)return tw(this.node.rawAttrs,e,t);if(r.list.type!=null)return Y1(this.node.rawAttrs,e,t)}return t},n}();var xwe=1e-7,kwe=1e-4,Swe=function(){function n(){}return n.prototype.refCount=function(e){return Yr("refCount")},n.prototype.incRef=function(e){return Yr("incRef")},n.prototype.timerAvailable=function(){return!0},n.prototype.time=function(e){return Yr("time")},n.prototype.read=function(e){return Yr("read")},n.prototype.readSync=function(e){return Yr("readSync")},n.prototype.readToGPU=function(e,t){return Yr("readToGPU")},n.prototype.numDataIds=function(){return Yr("numDataIds")},n.prototype.disposeData=function(e,t){return Yr("disposeData")},n.prototype.write=function(e,t,r){return Yr("write")},n.prototype.move=function(e,t,r,a,i){return Yr("move")},n.prototype.createTensorFromGPUData=function(e,t,r){return Yr("createTensorFromGPUData")},n.prototype.memory=function(){return Yr("memory")},n.prototype.floatPrecision=function(){return Yr("floatPrecision")},n.prototype.epsilon=function(){return this.floatPrecision()===32?xwe:kwe},n.prototype.dispose=function(){return Yr("dispose")},n}();function Yr(n){throw new Error("'".concat(n,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function G(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function Ua(n,e,t){t===void 0&&(t=""),G(Ic(n,e),function(){return t+" Shapes ".concat(n," and ").concat(e," must match")})}function Ec(n){G(n!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Fr(n){if(n.length===0)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function Ic(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Vf(n){return n%1===0}function mv(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function Cv(n,e){var t=e.length;return n=n==null?e.map(function(r,a){return a}):[].concat(n),G(n.every(function(r){return r>=-t&&r<t}),function(){return"All values in axis param must be in range [-".concat(t,", ").concat(t,") but ")+"got axis ".concat(n)}),G(n.every(function(r){return Vf(r)}),function(){return"All values in axis param must be integers but "+"got axis ".concat(n)}),n.map(function(r){return r<0?t+r:r})}function Nwe(n,e){for(var t=[],r=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:Cv(e,n).sort(),o=0,s=0;s<n.length;++s){if(i!=null){if(i[o]===s&&n[s]!==1)throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(n[s],"' is not 1"));(i[o]==null||i[o]>s)&&n[s]===1&&(t.push(n[s]),r.push(s)),i[o]<=s&&o++}n[s]!==1&&(t.push(n[s]),r.push(s))}return{newShape:t,keptDims:r}}function Twe(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else throw new Error("Unknown data type ".concat(n));return t}function Ewe(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error("Unknown data type ".concat(n));return t}function Iwe(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(e," being uploaded contains ").concat(r,"."))}}function Cwe(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function nw(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype ".concat(n))}function Awe(n){if(n==null)return 0;var e=0;return n.forEach(function(t){return e+=t.length}),e}function bw(n){return typeof n=="string"||n instanceof String}function _we(n){return typeof n=="boolean"}function Dwe(n){return typeof n=="number"}function ww(n){return Array.isArray(n)?ww(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":Dwe(n)?"float32":bw(n)?"string":_we(n)?"bool":"float32"}function i4(n){return!!(n&&n.constructor&&n.call&&n.apply)}function xw(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function P4(n,e,t,r){r===void 0&&(r=!1);var a=new Array;if(e.length===1)for(var i=e[0]*(r?2:1),o=0;o<i;o++)a[o]=t[n+o];else for(var i=e[0],s=e.slice(1),u=s.reduce(function(l,f){return l*f})*(r?2:1),o=0;o<i;o++)a[o]=P4(n+o*u,s,t,r);return a}function o4(n,e,t){if(t===void 0&&(t=!1),n.length===0)return e[0];var r=n.reduce(function(a,i){return a*i})*(t?2:1);if(r===0)return[];if(r!==e.length)throw new Error("[".concat(n,"] does not match the input size ").concat(e.length).concat(t?" for a complex tensor":"","."));return P4(0,n,e,t)}function M4(n,e){for(var t=kw(n,e),r=0;r<t.length;r++)t[r]=1;return t}function kw(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error("Unknown data type ".concat(e))}function ga(n){n.forEach(function(e){G(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(n,"].")})})}function Sw(n){return n&&n.then&&typeof n.then=="function"}var s4="tfjsflags",Fwe=function(){function n(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Rwe,this.populateURLFlags()}return n.prototype.setPlatform=function(e,t){this.platform!=null&&(ma().getBool("IS_TEST")||ma().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t},n.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){var a=this.urlFlags[e];ma().getBool("IS_TEST")||ma().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(a,".")),this.set(e,a)}},n.prototype.getAsync=function(e){return Pt(this,void 0,void 0,function(){var t,r;return _t(this,function(a){switch(a.label){case 0:return e in this.flags?[2,this.flags[e]]:(t=this.flags,r=e,[4,this.evaluateFlag(e)]);case 1:return t[r]=a.sent(),[2,this.flags[e]]}})})},n.prototype.get=function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(Sw(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]},n.prototype.getNumber=function(e){return this.get(e)},n.prototype.getBool=function(e){return this.get(e)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!1,configurable:!0}),n.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},n.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()},n.prototype.setFlags=function(e){this.flags=Object.assign({},e)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var e=this;if(!(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")){var t=this.getQueryParams(this.global.location.search);if(s4 in t){var r=t[s4].split(",");r.forEach(function(a){var i=Ne(a.split(":"),2),o=i[0],s=i[1];e.urlFlags[o]=Pwe(o,s)})}}},n}();function Rwe(n){var e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];return Owe(e,r[0],r[1]),r.join("=")}),e}function Owe(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Pwe(n,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if("".concat(+e)===e)return+e;throw new Error("Could not parse value flag value ".concat(e," for flag ").concat(n,"."))}function ma(){return B4}var B4=null;function Mwe(n){B4=n}var $1;function L4(){if($1==null){var n=void 0;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");$1=n}return $1}function Bwe(){var n=L4();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function Nw(n,e){var t=Bwe();if(t.has(n))return t.get(n);var r=e();return t.set(n,r),t.get(n)}var Lwe="Abs",zwe="Acos",$we="Acosh",z4="Add",qwe="AddN",Wwe="All",Vwe="Any",Gwe="ArgMax",Uwe="ArgMin",Hwe="Asin",Kwe="Asinh",jwe="Atan",Xwe="Atanh",Ywe="Atan2",Zwe="AvgPool",Jwe="AvgPool3D",Qwe="BatchMatMul",exe="BatchToSpaceND",txe="Bincount",nxe="BroadcastArgs",$4="Cast",rxe="Ceil",axe="ClipByValue",ixe="Complex",oxe="ComplexAbs",sxe="Concat",uxe="Conv2D",cxe="Conv2DBackpropFilter",lxe="Conv2DBackpropInput",fxe="Conv3D",hxe="Conv3DBackpropInputV2",pxe="Cos",dxe="Cosh",vxe="Cumprod",mxe="Cumsum",gxe="CropAndResize",yxe="DenseBincount",bxe="DepthToSpace",wxe="DepthwiseConv2dNative",xxe="DepthwiseConv2dNativeBackpropFilter",kxe="DepthwiseConv2dNativeBackpropInput",Sxe="Diag",Nxe="Dilation2D",Txe="RealDiv",Exe="Einsum",Ixe="Elu",Cxe="Erf",Axe="Equal",_xe="Exp",Dxe="ExpandDims",Fxe="Expm1",Rxe="FFT",Oxe="Fill",Pxe="FlipLeftRight",Mxe="Floor",Bxe="FloorDiv",Lxe="FusedBatchNorm",zxe="GatherV2",$xe="GatherNd",qxe="Greater",Wxe="GreaterEqual",q4="Identity",Vxe="IFFT",Gxe="Imag",Uxe="IsFinite",Hxe="IsInf",Kxe="IsNan",jxe="LeakyRelu",Xxe="Less",Yxe="LessEqual",Zxe="LinSpace",Jxe="Log",Qxe="Log1p",eke="LogicalAnd",tke="LogicalNot",nke="LogicalOr",rke="LRN",ake="Max",ike="Maximum",oke="MaxPool",ske="MaxPool3D",uke="MaxPoolWithArgmax",cke="Mean",lke="Min",fke="Minimum",hke="MirrorPad",pke="Mod",dke="Multinomial",vke="Multiply",mke="Neg",gke="NotEqual",yke="NonMaxSuppressionV3",bke="NonMaxSuppressionV4",wke="NonMaxSuppressionV5",xke="OnesLike",kke="OneHot",Ske="Pack",Nke="PadV2",Tke="Pow",Eke="Prelu",Ike="Prod",Cke="RaggedGather",Ake="RaggedRange",_ke="RaggedTensorToTensor",Dke="Range",Fke="Real",Rke="Reciprocal",Oke="Relu",Pke="Reshape",Mke="ResizeNearestNeighbor",Bke="ResizeBilinear",Lke="Relu6",zke="Reverse",$ke="Round",qke="Rsqrt",Wke="ScatterNd",Vke="SearchSorted",Gke="Select",Uke="Selu",Hke="Slice",Kke="Sin",jke="Sinh",Xke="Sign",Yke="Sigmoid",Zke="Softplus",Jke="Sqrt",Qke="Sum",e2e="SpaceToBatchND",t2e="SplitV",n2e="Softmax",r2e="SparseFillEmptyRows",a2e="SparseReshape",i2e="SparseSegmentMean",o2e="SparseSegmentSum",s2e="SparseToDense",u2e="SquaredDifference",c2e="StridedSlice",l2e="StringNGrams",f2e="StringSplit",h2e="StringToHashBucketFast",p2e="Sub",d2e="Tan",v2e="Tanh",W4="Tile",m2e="TopK",g2e="Transform",q1="Transpose",y2e="Unique",b2e="Unpack",w2e="UnsortedSegmentSum",x2e="ZerosLike",k2e="Step",S2e="RotateWithOffset",u4="_FusedMatMul",c4="FusedConv2D",l4="FusedDepthwiseConv2D";function Pf(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];ma().getBool("IS_TEST")||ma().getBool("PROD")||console.warn.apply(console,yn([],Ne(n),!1))}var V4=Nw("kernelRegistry",function(){return new Map}),N2e=Nw("gradRegistry",function(){return new Map});function f4(n,e){var t=T2e(n,e);return V4.get(t)}function h4(n){return N2e.get(n)}function p4(n){for(var e=V4.entries(),t=[];;){var r=e.next(),a=r.done,i=r.value;if(a)break;var o=Ne(i,2),s=o[0],u=o[1],c=Ne(s.split("_"),1),l=c[0];l===n&&t.push(u)}return t}function T2e(n,e){return"".concat(e,"_").concat(n)}var rw=tn,Wa=null;try{Wa=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function tn(n,e,t){this.low=n|0,this.high=e|0,this.unsigned=!!t}tn.prototype.__isLong__;Object.defineProperty(tn.prototype,"__isLong__",{value:!0});function ea(n){return(n&&n.__isLong__)===!0}tn.isLong=ea;var d4={},v4={};function Qs(n,e){var t,r,a;return e?(n>>>=0,(a=0<=n&&n<256)&&(r=v4[n],r)?r:(t=nn(n,(n|0)<0?-1:0,!0),a&&(v4[n]=t),t)):(n|=0,(a=-128<=n&&n<128)&&(r=d4[n],r)?r:(t=nn(n,n<0?-1:0,!1),a&&(d4[n]=t),t))}tn.fromInt=Qs;function Va(n,e){if(isNaN(n))return e?js:Ga;if(e){if(n<0)return js;if(n>=G4)return K4}else{if(n<=-g4)return Jr;if(n+1>=g4)return H4}return n<0?Va(-n,e).neg():nn(n%kc|0,n/kc|0,e)}tn.fromNumber=Va;function nn(n,e,t){return new tn(n,e,t)}tn.fromBits=nn;var wv=Math.pow;function Tw(n,e,t){if(n.length===0)throw Error("empty string");if(n==="NaN"||n==="Infinity"||n==="+Infinity"||n==="-Infinity")return Ga;if(typeof e=="number"?(t=e,e=!1):e=!!e,t=t||10,t<2||36<t)throw RangeError("radix");var r;if((r=n.indexOf("-"))>0)throw Error("interior hyphen");if(r===0)return Tw(n.substring(1),e,t).neg();for(var a=Va(wv(t,8)),i=Ga,o=0;o<n.length;o+=8){var s=Math.min(8,n.length-o),u=parseInt(n.substring(o,o+s),t);if(s<8){var c=Va(wv(t,s));i=i.mul(c).add(Va(u))}else i=i.mul(a),i=i.add(Va(u))}return i.unsigned=e,i}tn.fromString=Tw;function wi(n,e){return typeof n=="number"?Va(n,e):typeof n=="string"?Tw(n,e):nn(n.low,n.high,typeof e=="boolean"?e:n.unsigned)}tn.fromValue=wi;var m4=1<<16,E2e=1<<24,kc=m4*m4,G4=kc*kc,g4=G4/2,y4=Qs(E2e),Ga=Qs(0);tn.ZERO=Ga;var js=Qs(0,!0);tn.UZERO=js;var gc=Qs(1);tn.ONE=gc;var U4=Qs(1,!0);tn.UONE=U4;var aw=Qs(-1);tn.NEG_ONE=aw;var H4=nn(-1,2147483647,!1);tn.MAX_VALUE=H4;var K4=nn(-1,-1,!0);tn.MAX_UNSIGNED_VALUE=K4;var Jr=nn(0,-2147483648,!1);tn.MIN_VALUE=Jr;var Re=tn.prototype;Re.toInt=function(){return this.unsigned?this.low>>>0:this.low};Re.toNumber=function(){return this.unsigned?(this.high>>>0)*kc+(this.low>>>0):this.high*kc+(this.low>>>0)};Re.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Jr)){var t=Va(e),r=this.div(t),a=r.mul(t).sub(this);return r.toString(e)+a.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var i=Va(wv(e,6),this.unsigned),o=this,s="";;){var u=o.div(i),c=o.sub(u.mul(i)).toInt()>>>0,l=c.toString(e);if(o=u,o.isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}};Re.getHighBits=function(){return this.high};Re.getHighBitsUnsigned=function(){return this.high>>>0};Re.getLowBits=function(){return this.low};Re.getLowBitsUnsigned=function(){return this.low>>>0};Re.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Jr)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return this.high!=0?t+33:t+1};Re.isZero=function(){return this.high===0&&this.low===0};Re.eqz=Re.isZero;Re.isNegative=function(){return!this.unsigned&&this.high<0};Re.isPositive=function(){return this.unsigned||this.high>=0};Re.isOdd=function(){return(this.low&1)===1};Re.isEven=function(){return(this.low&1)===0};Re.equals=function(e){return ea(e)||(e=wi(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};Re.eq=Re.equals;Re.notEquals=function(e){return!this.eq(e)};Re.neq=Re.notEquals;Re.ne=Re.notEquals;Re.lessThan=function(e){return this.comp(e)<0};Re.lt=Re.lessThan;Re.lessThanOrEqual=function(e){return this.comp(e)<=0};Re.lte=Re.lessThanOrEqual;Re.le=Re.lessThanOrEqual;Re.greaterThan=function(e){return this.comp(e)>0};Re.gt=Re.greaterThan;Re.greaterThanOrEqual=function(e){return this.comp(e)>=0};Re.gte=Re.greaterThanOrEqual;Re.ge=Re.greaterThanOrEqual;Re.compare=function(e){if(ea(e)||(e=wi(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};Re.comp=Re.compare;Re.negate=function(){return!this.unsigned&&this.eq(Jr)?Jr:this.not().add(gc)};Re.neg=Re.negate;Re.add=function(e){ea(e)||(e=wi(e));var t=this.high>>>16,r=this.high&65535,a=this.low>>>16,i=this.low&65535,o=e.high>>>16,s=e.high&65535,u=e.low>>>16,c=e.low&65535,l=0,f=0,h=0,p=0;return p+=i+c,h+=p>>>16,p&=65535,h+=a+u,f+=h>>>16,h&=65535,f+=r+s,l+=f>>>16,f&=65535,l+=t+o,l&=65535,nn(h<<16|p,l<<16|f,this.unsigned)};Re.subtract=function(e){return ea(e)||(e=wi(e)),this.add(e.neg())};Re.sub=Re.subtract;Re.multiply=function(e){if(this.isZero())return Ga;if(ea(e)||(e=wi(e)),Wa){var t=Wa.mul(this.low,this.high,e.low,e.high);return nn(t,Wa.get_high(),this.unsigned)}if(e.isZero())return Ga;if(this.eq(Jr))return e.isOdd()?Jr:Ga;if(e.eq(Jr))return this.isOdd()?Jr:Ga;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(y4)&&e.lt(y4))return Va(this.toNumber()*e.toNumber(),this.unsigned);var r=this.high>>>16,a=this.high&65535,i=this.low>>>16,o=this.low&65535,s=e.high>>>16,u=e.high&65535,c=e.low>>>16,l=e.low&65535,f=0,h=0,p=0,d=0;return d+=o*l,p+=d>>>16,d&=65535,p+=i*l,h+=p>>>16,p&=65535,p+=o*c,h+=p>>>16,p&=65535,h+=a*l,f+=h>>>16,h&=65535,h+=i*c,f+=h>>>16,h&=65535,h+=o*u,f+=h>>>16,h&=65535,f+=r*l+a*c+i*u+o*s,f&=65535,nn(p<<16|d,f<<16|h,this.unsigned)};Re.mul=Re.multiply;Re.divide=function(e){if(ea(e)||(e=wi(e)),e.isZero())throw Error("division by zero");if(Wa){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var t=(this.unsigned?Wa.div_u:Wa.div_s)(this.low,this.high,e.low,e.high);return nn(t,Wa.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?js:Ga;var r,a,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return js;if(e.gt(this.shru(1)))return U4;i=js}else{if(this.eq(Jr)){if(e.eq(gc)||e.eq(aw))return Jr;if(e.eq(Jr))return gc;var o=this.shr(1);return r=o.div(e).shl(1),r.eq(Ga)?e.isNegative()?gc:aw:(a=this.sub(e.mul(r)),i=r.add(a.div(e)),i)}else if(e.eq(Jr))return this.unsigned?js:Ga;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=Ga}for(a=this;a.gte(e);){r=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(r)/Math.LN2),u=s<=48?1:wv(2,s-48),c=Va(r),l=c.mul(e);l.isNegative()||l.gt(a);)r-=u,c=Va(r,this.unsigned),l=c.mul(e);c.isZero()&&(c=gc),i=i.add(c),a=a.sub(l)}return i};Re.div=Re.divide;Re.modulo=function(e){if(ea(e)||(e=wi(e)),Wa){var t=(this.unsigned?Wa.rem_u:Wa.rem_s)(this.low,this.high,e.low,e.high);return nn(t,Wa.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};Re.mod=Re.modulo;Re.rem=Re.modulo;Re.not=function(){return nn(~this.low,~this.high,this.unsigned)};Re.and=function(e){return ea(e)||(e=wi(e)),nn(this.low&e.low,this.high&e.high,this.unsigned)};Re.or=function(e){return ea(e)||(e=wi(e)),nn(this.low|e.low,this.high|e.high,this.unsigned)};Re.xor=function(e){return ea(e)||(e=wi(e)),nn(this.low^e.low,this.high^e.high,this.unsigned)};Re.shiftLeft=function(e){return ea(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?nn(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):nn(0,this.low<<e-32,this.unsigned)};Re.shl=Re.shiftLeft;Re.shiftRight=function(e){return ea(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?nn(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):nn(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};Re.shr=Re.shiftRight;Re.shiftRightUnsigned=function(e){if(ea(e)&&(e=e.toInt()),e&=63,e===0)return this;var t=this.high;if(e<32){var r=this.low;return nn(r>>>e|t<<32-e,t>>>e,this.unsigned)}else return e===32?nn(t,0,this.unsigned):nn(t>>>e-32,0,this.unsigned)};Re.shru=Re.shiftRightUnsigned;Re.shr_u=Re.shiftRightUnsigned;Re.toSigned=function(){return this.unsigned?nn(this.low,this.high,!1):this};Re.toUnsigned=function(){return this.unsigned?this:nn(this.low,this.high,!0)};Re.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};Re.toBytesLE=function(){var e=this.high,t=this.low;return[t&255,t>>>8&255,t>>>16&255,t>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};Re.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,t>>>24,t>>>16&255,t>>>8&255,t&255]};tn.fromBytes=function(e,t,r){return r?tn.fromBytesLE(e,t):tn.fromBytesBE(e,t)};tn.fromBytesLE=function(e,t){return new tn(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)};tn.fromBytesBE=function(e,t){return new tn(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var I2e=A1e({__proto__:null,default:rw},[rw]),C2e=rw||I2e;function Ew(n){return C2e.fromString(n,!0,16)}Ew("c3a5c85c97cb3127");Ew("b492b66fbe98f273");Ew("9ae16a3b2f90404f");function A2e(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function j4(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Gf(n)),ma().getBool("DEBUG")&&Iwe(n,e),A2e(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){for(var t=new Uint8Array(n.length),r=0;r<t.length;++r)Math.round(n[r])!==0&&(t[r]=1);return t}else throw new Error("Unknown data type ".concat(e))}function xv(){return ma().platform.now()}function _2e(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",ma().platform.encode(n,e)}function b4(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",ma().platform.decode(n,e)}function bi(n){return ma().platform.isTypedArray(n)}function Gf(n,e,t){var r,a;if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||Sw(n)||n==null||bi(n)&&t)e.push(n);else if(Array.isArray(n)||bi(n))for(var i=0;i<n.length;++i)Gf(n[i],e,t);else{var o=-1;try{for(var s=xc(Object.keys(n)),u=s.next();!u.done;u=s.next()){var c=u.value;/^([1-9]+[0-9]*|0)$/.test(c)&&(o=Math.max(o,Number(c)))}}catch(l){r={error:l}}finally{try{u&&!u.done&&(a=s.return)&&a.call(s)}finally{if(r)throw r.error}}for(var i=0;i<=o;i++)Gf(n[i],e,t)}return e}var D2e=function(){function n(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new R2e)}return n.prototype.profileKernel=function(e,t,r){var a,i,o,s=function(){o=r()},u,c=xv();if(this.backendTimer.timerAvailable())u=this.backendTimer.time(s);else{s();try{for(var l=xc(o),f=l.next();!f.done;f=l.next()){var h=f.value;h.dataSync()}}catch(m){a={error:m}}finally{try{f&&!f.done&&(i=l.return)&&i.call(l)}finally{if(a)throw a.error}}u=Promise.resolve({kernelMs:xv()-c})}if(ma().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var p=function(m){var g=o[m];g.data().then(function(y){F2e(y,g.dtype,e)})},d=0;d<o.length;d++)p(d);var v={kernelName:e,outputs:o,inputs:t,timeMs:u.then(function(m){return m.kernelMs}),extraInfo:u.then(function(m){return m.getExtraProfileInfo!=null?m.getExtraProfileInfo():""})};return v},n.prototype.logKernelProfile=function(e){var t=this,r=e.kernelName,a=e.outputs,i=e.timeMs,o=e.inputs,s=e.extraInfo;a.forEach(function(u){Promise.all([u.data(),i,s]).then(function(c){t.logger.logKernelProfile(r,u,c[0],c[1],o,c[2])})})},n}();function F2e(n,e,t){if(e!=="float32")return!1;for(var r=0;r<n.length;r++){var a=n[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(t,"'")),!0}return!1}var R2e=function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,a,i,o){var s=typeof a=="number"?mv("".concat(a,"ms"),9):a.error,u=mv(e,25),c=t.rank,l=t.size,f=mv(t.shape.toString(),14),h="";for(var p in i){var d=i[p];if(d!=null){var v=d.shape||t.shape,m=v.length;h+="".concat(p,": ").concat(m,"D ").concat(m>0?v:""," ")}}console.log("%c".concat(u,"	%c").concat(s,"	%c").concat(c,"D ").concat(f,"	%c").concat(l,"	%c").concat(h,"	%c").concat(o),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n}();function O2e(n,e,t){for(var r={},a={},i=0;i<e.length;i++)r[e[i].id]=!0;for(var i=0;i<n.length;i++){var o=n[i],s=o.inputs;for(var u in s){for(var c=s[u],l=!1,f=0;f<e.length;f++)if(r[c.id]){o.outputs.forEach(function(b){return r[b.id]=!0}),l=!0,a[o.id]=!0;break}if(l)break}}var h={};h[t.id]=!0;for(var p={},i=n.length-1;i>=0;i--)for(var o=n[i],s=o.inputs,f=0;f<o.outputs.length;f++)if(h[o.outputs[f].id]){for(var u in s)h[s[u].id]=!0,p[o.id]=!0;break}for(var d=[],i=0;i<n.length;i++){var o=n[i];if(a[o.id]&&p[o.id]){var v={};for(var u in o.inputs){var m=o.inputs[u];r[m.id]&&(v[u]=m)}var g=Object.assign({},o);g.inputs=v,g.outputs=o.outputs,d.push(g)}}return d}function P2e(n,e,t,r){for(var a=function(o){var s=e[o],u=[];if(s.outputs.forEach(function(h){var p=n[h.id];p!=null?u.push(p):u.push(null)}),s.gradient==null)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(s.kernelName,"."));var c=s.gradient(u),l=function(h){if(!(h in c))throw new Error("Cannot backprop through input ".concat(h,". ")+"Available gradients found: ".concat(Object.keys(c),"."));var p=t(function(){return c[h]()});if(p.dtype!=="float32")throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"".concat(h," must have 'float32' dtype, but has '").concat(p.dtype,"'"));var d=s.inputs[h];if(!Ic(p.shape,d.shape))throw new Error("Error in gradient for op ".concat(s.kernelName,". The gradient of input ")+"'".concat(h,"' has shape '").concat(p.shape,"', which does not match ")+"the shape of the input '".concat(d.shape,"'"));if(n[d.id]==null)n[d.id]=p;else{var v=n[d.id];n[d.id]=r(v,p),v.dispose()}};for(var f in s.inputs)l(f)},i=e.length-1;i>=0;i--)a(i)}var w4=20,Mf=3,W1=7;function M2e(n,e,t,r){var a=xw(e),i=B2e(n,e,t,a),o=e.length,s=gv(n,e,t,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(t)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(e,"]")),u.push("  values:")),u.push(s.map(function(c){return"    "+c}).join(`
`)),u.join(`
`)}function B2e(n,e,t,r){var a=Fr(e),i=r[r.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?$f(n):n;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,f=0;f<i;f++)o[f]=Math.max(o[f],zf(u[l+f],0,t).length);return o}function zf(n,e,t){var r;return Array.isArray(n)?r="".concat(parseFloat(n[0].toFixed(W1))," + ")+"".concat(parseFloat(n[1].toFixed(W1)),"j"):bw(n)?r="'".concat(n,"'"):t==="bool"?r=X4(n):r=parseFloat(n.toFixed(W1)).toString(),mv(r,e)}function X4(n){return n===0?"false":"true"}function gv(n,e,t,r,a,i){i===void 0&&(i=!0);var o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){var c=$f(n);return[zf(c[0],0,t)]}return t==="bool"?[X4(n[0])]:[n[0].toString()]}if(u===1){if(s>w4){var l=Mf*o,f=Array.from(n.slice(0,l)),h=Array.from(n.slice((s-Mf)*o,s*o));return t==="complex64"&&(f=$f(f),h=$f(h)),["["+f.map(function(T,E){return zf(T,a[E],t)}).join(", ")+", ..., "+h.map(function(T,E){return zf(T,a[s-Mf+E],t)}).join(", ")+"]"]}var p=t==="complex64"?$f(n):Array.from(n);return["["+p.map(function(T,E){return zf(T,a[E],t)}).join(", ")+"]"]}var d=e.slice(1),v=r.slice(1),m=r[0]*o,g=[];if(s>w4){for(var y=0;y<Mf;y++){var b=y*m,w=b+m;g.push.apply(g,yn([],Ne(gv(n.slice(b,w),d,t,v,a,!1)),!1))}g.push("...");for(var y=s-Mf;y<s;y++){var b=y*m,w=b+m;g.push.apply(g,yn([],Ne(gv(n.slice(b,w),d,t,v,a,y===s-1)),!1))}}else for(var y=0;y<s;y++){var b=y*m,w=b+m;g.push.apply(g,yn([],Ne(gv(n.slice(b,w),d,t,v,a,y===s-1)),!1))}var x=u===2?",":"";g[0]="["+(s>0?g[0]+x:"");for(var y=1;y<g.length-1;y++)g[y]=" "+g[y]+x;for(var N=`,
`,y=2;y<u;y++)N+=`
`;return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":N),g}function $f(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var iw=function(){function n(e,t,r){var a=this;if(this.dtype=t,this.shape=e.slice(),this.size=Fr(e),r!=null){var i=r.length;G(i===this.size,function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Ewe(t,this.size),this.strides=xw(e)}return n.prototype.set=function(e){for(var t=this,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];r.length===0&&(r=[0]),G(r.length===this.rank,function(){return"The number of provided coordinates (".concat(r.length,") must ")+"match the rank (".concat(t.rank,")")});var i=this.locToIndex(r);this.values[i]=e},n.prototype.get=function(){for(var e,t,r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];r.length===0&&(r=[0]);var i=0;try{for(var o=xc(r),s=o.next();!s.done;s=o.next()){var u=s.value;if(u<0||u>=this.shape[i]){var c="Requested out of range element at ".concat(r,". ")+"  Buffer shape=".concat(this.shape);throw new Error(c)}i++}}catch(h){e={error:h}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var l=r[r.length-1],f=0;f<r.length-1;++f)l+=this.strides[f]*r[f];return this.values[l]},n.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),n.prototype.toTensor=function(){return gi().makeTensor(this.values,this.shape,this.dtype)},n}(),gi=null,Bf=null;function L2e(n){gi=n}var _r=function(){function n(e,t,r,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Fr(e),this.strides=xw(e),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!1,configurable:!0}),n.prototype.buffer=function(){return Pt(this,void 0,void 0,function(){var e;return _t(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Bf.buffer(this.shape,this.dtype,e)]}})})},n.prototype.bufferSync=function(){return Bf.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return Pt(this,void 0,void 0,function(){var e;return _t(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,o4(this.shape,e,this.dtype==="complex64")]}})})},n.prototype.arraySync=function(){return o4(this.shape,this.dataSync(),this.dtype==="complex64")},n.prototype.data=function(){return Pt(this,void 0,void 0,function(){var e,t;return _t(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=gi().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=r.sent();try{return[2,t.map(function(a){return b4(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}})})},n.prototype.dataToGPU=function(e){return this.throwIfDisposed(),gi().readToGPU(this.dataId,e)},n.prototype.dataSync=function(){this.throwIfDisposed();var e=gi().readSync(this.dataId);if(this.dtype==="string")try{return e.map(function(t){return b4(t)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},n.prototype.bytes=function(){return Pt(this,void 0,void 0,function(){var e;return _t(this,function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,gi().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}})})},n.prototype.dispose=function(){this.isDisposed||(gi().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!1,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.print=function(e){return e===void 0&&(e=!1),Bf.print(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),Bf.clone(this)},n.prototype.toString=function(e){e===void 0&&(e=!1);var t=this.dataSync();return M2e(t,this.shape,this.dtype,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),Bf.cast(this,e)},n.prototype.variable=function(e,t,r){return e===void 0&&(e=!0),this.throwIfDisposed(),gi().makeVariable(this,e,t,r)},n}();Object.defineProperty(_r,Symbol.hasInstance,{value:function(n){return!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null}});function z2e(){return Nw("Tensor",function(){return _r})}z2e();var ow=function(n){D1e(e,n);function e(t,r,a,i){var o=n.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=r,o.name=a,o}return e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(t.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!Ic(t.shape,this.shape))throw new Error("shape of the new value (".concat(t.shape,") and ")+"previous value (".concat(this.shape,") must match"));gi().disposeTensor(this),this.dataId=t.dataId,gi().incRef(this,null)},e.prototype.dispose=function(){gi().disposeVariable(this),this.isDisposedInternal=!0},e}(_r);Object.defineProperty(ow,Symbol.hasInstance,{value:function(n){return n instanceof _r&&n.assign!=null&&n.assign instanceof Function}});var x4;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(x4||(x4={}));var sw;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(sw||(sw={}));var uw;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(uw||(uw={}));var cw;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(cw||(cw={}));var lw;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(lw||(lw={}));var $2e={float32:cw,int32:sw,bool:uw,complex64:lw};function q2e(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error("Can not upcast ".concat(n," with ").concat(e))}return $2e[n][e]}function Cn(n,e){if(n.dtype===e.dtype)return[n,e];var t=q2e(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function W2e(n,e){G(n.dtype===e.dtype,function(){return"The dtypes of the first(".concat(n.dtype,") and")+" second(".concat(e.dtype,") input must match")})}function Y4(n){var e=[],t=new Set;return Z4(n,e,t),e}function Z4(n,e,t){if(n!=null){if(n instanceof _r){e.push(n);return}if(!!V2e(n)){var r=n;for(var a in r){var i=r[a];t.has(i)||(t.add(i),Z4(i,e,t))}}}}function V2e(n){return Array.isArray(n)||typeof n=="object"}function V1(n){return n.kernelName!=null}var k4=function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(function(e){return e.name})))}}}return n.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},n}(),Iw=function(){function n(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new k4}return n.prototype.ready=function(){return Pt(this,void 0,void 0,function(){var e,t,r,a;return _t(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(r=e[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return a=i.sent(),a?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(n.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name,r=e.asyncInit;if(r)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!1,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(e){if(!(e in this.registry))if(e in this.registryFactory){var t=this.initializeBackend(e).asyncInit;if(t)return null}else return null;return this.registry[e]},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},n.prototype.registerBackend=function(e,t,r){return r===void 0&&(r=1),e in this.registryFactory?(Pf("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},n.prototype.setBackend=function(e){return Pt(this,void 0,void 0,function(){var t,r,a,i,o;return _t(this,function(s){switch(s.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '".concat(e,"' not found in registry"));return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,a=t.asyncInit,a?[4,r]:[3,2]);case 1:return o=s.sent(),[3,3];case 2:o=r,s.label=3;case 3:if(i=o,!i)return[2,!1];s.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new D2e(this.backendInstance),[2,!0]}})})},n.prototype.setupRegisteredKernels=function(){var e=this,t=p4(this.backendName);t.forEach(function(r){r.setupFunc!=null&&r.setupFunc(e.backendInstance)})},n.prototype.disposeRegisteredKernels=function(e){var t=this,r=p4(e);r.forEach(function(a){a.disposeFunc!=null&&a.disposeFunc(t.registry[e])})},n.prototype.initializeBackend=function(e){var t=this,r=this.registryFactory[e];if(r==null)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var a=r.factory();if(a&&!(a instanceof Swe)&&typeof a.then=="function"){var i=++this.pendingBackendInitId,o=a.then(function(s){return i<t.pendingBackendInitId?!1:(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return i<t.pendingBackendInitId||(t.pendingBackendInit=null,Pf("Initialization of backend ".concat(e," failed")),Pf(s.stack||s.message)),!1});return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=a,{success:!0,asyncInit:!1}}catch(s){return Pf("Initialization of backend ".concat(e," failed")),Pf(s.stack||s.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority})},n.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],a=this.initializeBackend(r),i=a.success,o=a.asyncInit;if(o||i)return{name:r,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(e,t){var r=this.state.tensorInfo.get(t),a=r.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),r.backend=e,e.move(t,i,r.shape,r.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(e,t){var r=this,a=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}var i;return this.scopedRun(function(){return r.startScope(a)},function(){return r.endScope(i)},function(){return i=t(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i})},n.prototype.scopedRun=function(e,t,r){e();try{var a=r();return t(),a}catch(i){throw t(),i}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=Q.runKernel(q4,{x:e}),r={x:e},a=function(o){return{x:function(){var s="float32",u={x:o},c={dtype:s};return Q.runKernel($4,u,c)}}},i=[];return this.addTapeNode(this.state.activeScope.name,r,[t],a,i,{}),t},n.prototype.runKernel=function(e,t,r){this.backendName==null&&this.backend;var a=f4(e,this.backendName)!=null;if(!a)throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:r})},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(e,t,r){var a=this.backend.numDataIds(),i=0;r.forEach(function(u){i+=u.dtype==="complex64"?3:1});var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(s," data ids) after running '").concat(e,"'"))},n.prototype.runKernelFunc=function(e){var t=this,r,a=[],i=this.isTapeOn(),o=this.state.numBytes,s=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var u;this.backendName==null&&this.backend;var c,l=V1(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(V1(e)){var f=e.kernelName,h=e.inputs,p=e.attrs;this.backendName==null&&this.backend;var d=f4(f,this.backendName);G(d!=null,function(){return"Cannot find registered kernel '".concat(f,"' for backend '").concat(t.backendName,"'")}),u=function(){var x=t.backend.numDataIds();c=d.kernelFunc({inputs:h,attrs:p,backend:t.backend});var N=Array.isArray(c)?c:[c];t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(f,x,N);var T=N.map(function(C){return C.rank!=null?C:t.makeTensorFromTensorInfo(C)});if(i){var E=t.getTensorsForGradient(f,h,T);a=t.saveTensorsForBackwardMode(E)}return T}}else{var v=e.forwardFunc,m=function(x){!i||(a=x.map(function(N){return t.keep(t.clone(N))}))};u=function(){var x=t.backend.numDataIds();c=t.tidy(function(){return v(t.backend,m)});var N=Array.isArray(c)?c:[c];return t.shouldCheckForMemLeaks()&&t.checkKernelForMemLeak(l,x,N),N}}var g=e.inputs,y=e.attrs,b=V1(e)?null:e.backwardsFunc,w;return this.scopedRun(function(){return t.state.kernelDepth++},function(){return t.state.kernelDepth--},function(){!t.ENV.getBool("DEBUG")&&!t.state.profiling?r=u():(w=t.profiler.profileKernel(l,g,function(){return u()}),t.ENV.getBool("DEBUG")&&t.profiler.logKernelProfile(w),r=w.outputs)}),i&&this.addTapeNode(l,g,r,b,a,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:l,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-s,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map(function(x){return g[x]!=null?g[x].shape:null}),outputShapes:r.map(function(x){return x.shape}),kernelTimeMs:w.timeMs,extraInfo:w.extraInfo}),Array.isArray(c)?r:r[0]},n.prototype.saveTensorsForBackwardMode=function(e){var t=this,r=e.map(function(a){return t.keep(t.clone(a))});return r},n.prototype.getTensorsForGradient=function(e,t,r){var a=h4(e);if(a!=null){var i=a.inputsToSave||[],o=a.outputsToSave||[],s=void 0;a.saveAllInputs?(G(Array.isArray(t),function(){return"saveAllInputs is true, expected inputs to be an array."}),s=Object.keys(t).map(function(c){return t[c]})):s=i.map(function(c){return t[c]});var u=r.filter(function(c,l){return o[l]});return s.concat(u)}return[]},n.prototype.makeTensor=function(e,t,r,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",a=a||this.backend;var i=e;r==="string"&&bw(e[0])&&(i=e.map(function(l){return _2e(l)}));var o=a.write(i,t,r),s=new _r(t,r,o,this.nextTensorId());if(this.trackTensor(s,a),r==="string"){var u=this.state.tensorInfo.get(o),c=Awe(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s},n.prototype.makeTensorFromDataId=function(e,t,r,a){r=r||"float32";var i={dataId:e,shape:t,dtype:r};return this.makeTensorFromTensorInfo(i,a)},n.prototype.makeTensorFromTensorInfo=function(e,t){var r=e.dataId,a=e.shape,i=e.dtype,o=new _r(a,i,r,this.nextTensorId());return this.trackTensor(o,t),o},n.prototype.makeVariable=function(e,t,r,a){t===void 0&&(t=!0),r=r||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));var i=new ow(e,t,r,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error("Variable with name ".concat(i.name," was already registered"));return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},n.prototype.trackTensor=function(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;var r=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(r=e.size*nw(e.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r})),e instanceof ow||this.track(e)},n.prototype.incRef=function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)},n.prototype.removeDataId=function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)},n.prototype.disposeTensor=function(e){if(!!this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){var r=e.size*nw(e.dtype);this.state.numBytes-=r}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}},n.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},n.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return Pt(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f,h;return _t(this,function(p){switch(p.label){case 0:return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],a=this.state.activeProfile,[4,e()];case 1:a.result=p.sent(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,yn([],Ne(this.state.activeProfile.kernels.map(function(d){return d.totalBytesSnapshot})),!1)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,p.label=2;case 2:p.trys.push([2,8,9,10]),i=xc(this.state.activeProfile.kernels),o=i.next(),p.label=3;case 3:return o.done?[3,7]:(s=o.value,u=s,[4,s.kernelTimeMs]);case 4:return u.kernelTimeMs=p.sent(),c=s,[4,s.extraInfo];case 5:c.extraInfo=p.sent(),p.label=6;case 6:return o=i.next(),[3,3];case 7:return[3,10];case 8:return l=p.sent(),f={error:l},[3,10];case 9:try{o&&!o.done&&(h=i.return)&&h.call(i)}finally{if(f)throw f.error}return[7];case 10:return[2,this.state.activeProfile]}})})},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},n.prototype.addTapeNode=function(e,t,r,a,i,o){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:i},c=h4(e);c!=null&&(a=c.gradFunc),a!=null&&(u.gradient=function(l){return l=l.map(function(f,h){if(f==null){var p=r[h],d=kw(p.size,p.dtype);return s.makeTensor(d,p.shape,p.dtype)}return f}),a(l.length>1?l:l[0],i,o)}),this.state.activeTape.push(u)},n.prototype.keep=function(e){return e.kept=!0,e},n.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=Y4(e),a=new Set(r.map(function(u){return u.id})),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];!o.kept&&!a.has(o.id)&&o.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){!u.kept&&u.scopeId===s.id&&t.track(u)})},n.prototype.gradients=function(e,t,r,a){var i=this;if(a===void 0&&(a=!1),G(t.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '".concat(r.dtype,"'"));var o=this.scopedRun(function(){return i.startTape()},function(){return i.endTape()},function(){return i.tidy("forward",e)});G(o instanceof _r,function(){return"The result y returned by f() must be a tensor."});var s=O2e(this.state.activeTape,t,o);if(!a&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u={};u[o.id]=r??G2e(o.shape),P2e(u,s,function(l){return i.tidy(l)},H2e);var c=t.map(function(l){return u[l.id]});return i.state.gradientDepth===0&&(i.state.activeTape.forEach(function(l){var f,h;try{for(var p=xc(l.saved),d=p.next();!d.done;d=p.next()){var v=d.value;v.dispose()}}catch(m){f={error:m}}finally{try{d&&!d.done&&(h=p.return)&&h.call(p)}finally{if(f)throw f.error}}}),i.state.activeTape=null),{value:o,grads:c}})},n.prototype.customGrad=function(e){var t=this;return G(i4(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r=[],a=0;a<arguments.length;a++)r[a]=arguments[a];G(r.every(function(c){return c instanceof _r}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i,o={};r.forEach(function(c,l){o[l]=c});var s=function(c,l){return i=e.apply(void 0,yn([],Ne(yn(yn([],Ne(r),!1),[l],!1)),!1)),G(i.value instanceof _r,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),G(i4(i.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),i.value},u=function(c,l){var f=i.gradFunc(c,l),h=Array.isArray(f)?f:[f];G(h.length===r.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),G(h.every(function(d){return d instanceof _r}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return h.forEach(function(d,v){p[v]=function(){return d}}),p};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}},n.prototype.readSync=function(e){var t=this.state.tensorInfo.get(e);return t.backend.readSync(e)},n.prototype.read=function(e){var t=this.state.tensorInfo.get(e);return t.backend.read(e)},n.prototype.readToGPU=function(e,t){var r=this.state.tensorInfo.get(e);return r.backend.readToGPU(e,t)},n.prototype.time=function(e){return Pt(this,void 0,void 0,function(){var t,r;return _t(this,function(a){switch(a.label){case 0:return t=xv(),[4,this.backend.time(e)];case 1:return r=a.sent(),r.wallMs=xv()-t,[2,r]}})})},n.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!1,configurable:!0}),n.prototype.reset=function(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new k4;for(var e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n}();Iw.nextTensorId=0;Iw.nextVariableId=0;function G2e(n){var e=M4(Fr(n),"float32");return Q.makeTensor(e,n,"float32")}function U2e(){var n=L4();if(n._tfengine==null){var e=new Fwe(n);n._tfengine=new Iw(e)}return Mwe(n._tfengine.ENV),L2e(function(){return n._tfengine}),n._tfengine}var Q=U2e();function H2e(n,e){var t={a:n,b:e};return Q.runKernel(z4,t)}function Uo(n,e){var t=n;if(bi(n))return e==="string"?[]:[n.length];var r=typeof n=="object";if(r){if("texture"in n){var a=n.channels||"RGBA";return[n.height,n.width*a.length]}else if("buffer"in n&&!(n.buffer instanceof ArrayBuffer))return[n.buffer.size/(e==null?4:nw(e))]}if(!Array.isArray(n))return[];for(var i=[];Array.isArray(t)||bi(t)&&e!=="string";)i.push(t.length),t=t[0];return Array.isArray(n)&&ma().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&J4(n,i,[]),i}function J4(n,e,t){if(t=t||[],!Array.isArray(n)&&!bi(n)){G(e.length===0,function(){return"Element arr[".concat(t.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(e[0]," elements")});return}G(e.length>0,function(){return"Element arr[".concat(t.join("]["),"] should be a primitive, ")+"but is an array of ".concat(n.length," elements")}),G(n.length===e[0],function(){return"Element arr[".concat(t.join("]["),"] should have ").concat(e[0]," ")+"elements, but has ".concat(n.length," elements")});for(var r=e.slice(1),a=0;a<n.length;++a)J4(n[a],r,t.concat(a))}function S4(n,e,t,r){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error("Argument '".concat(t,"' passed to '").concat(r,"' must ")+"be ".concat(n," tensor, but got ").concat(e," tensor"))}}function M(n,e,t,r){if(r===void 0&&(r="numeric"),n instanceof _r)return S4(r,n.dtype,e,t),n;var a=ww(n);if(a!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),S4(r,a,e,t),n==null||!bi(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var i=n==null?"null":n.constructor.name;throw new Error("Argument '".concat(e,"' passed to '").concat(t,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=Uo(n,a);!bi(n)&&!Array.isArray(n)&&(n=[n]);var s=!0,u=a!=="string"?j4(n,a):Gf(n,[],s);return Q.makeTensor(u,o,a)}function kv(n,e,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument ".concat(e," passed to ").concat(t," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=n;return a.map(function(i,o){return M(i,"".concat(e,"[").concat(o,"]"),t,r)})}var Q4="__op";function K(n){var e=Object.keys(n);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(e.length," keys."));var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+Q4;var a=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];Q.startScope(t);try{var s=r.apply(void 0,yn([],Ne(i),!1));return Sw(s)&&console.error("Cannot return a Promise inside of tidy."),Q.endScope(s),s}catch(u){throw Q.endScope(null),u}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function K2e(n){var e=M(n,"x","abs");if(e.dtype==="complex64"){var t={x:e};return Q.runKernel(oxe,t)}else{var t={x:e};return Q.runKernel(Lwe,t)}}var $a=K({abs_:K2e});function j2e(n){var e=M(n,"x","acos"),t={x:e};return Q.runKernel(zwe,t)}var X2e=K({acos_:j2e});function Y2e(n){var e=M(n,"x","acosh"),t={x:e};return Q.runKernel($we,t)}var Z2e=K({acosh_:Y2e});function J2e(n,e){var t,r=M(n,"a","add"),a=M(e,"b","add");t=Ne(Cn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return Q.runKernel(z4,i)}var jn=K({add_:J2e});function Q2e(n){G(Array.isArray(n),function(){return"The argument passed to tf.addN() must be a list of tensors"}),G(n.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+"".concat(n.length)});var e=n.map(function(a,i){return M(a,"tensors".concat(i),"addN")}),t=e[0];e.forEach(function(a){if(a.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(a){if(!Ic(a.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=e;return Q.runKernel(qwe,r)}var eSe=K({addN_:Q2e});function tSe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","all","bool"),a={x:r},i={axis:e,keepDims:t};return Q.runKernel(Wwe,a,i)}var nSe=K({all_:tSe});function rSe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","any","bool"),a={x:r},i={axis:e,keepDims:t};return Q.runKernel(Vwe,a,i)}var aSe=K({any_:rSe});function iSe(n,e){e===void 0&&(e=0);var t=M(n,"x","argMax"),r={x:t},a={axis:e};return Q.runKernel(Gwe,r,a)}var oSe=K({argMax_:iSe});function sSe(n,e){e===void 0&&(e=0);var t=M(n,"x","argMin"),r={x:t},a={axis:e};return Q.runKernel(Uwe,r,a)}var uSe=K({argMin_:sSe});function cSe(n){var e=M(n,"x","asin"),t={x:e};return Q.runKernel(Hwe,t)}var lSe=K({asin_:cSe});function fSe(n){var e=M(n,"x","asinh"),t={x:e};return Q.runKernel(Kwe,t)}var hSe=K({asinh_:fSe});function pSe(n){var e=M(n,"x","atan"),t={x:e};return Q.runKernel(jwe,t)}var dSe=K({atan_:pSe});function vSe(n,e){var t,r=M(n,"a","atan2"),a=M(e,"b","atan2");t=Ne(Cn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return Q.runKernel(Ywe,i)}var mSe=K({atan2_:vSe});function gSe(n){var e=M(n,"x","atanh"),t={x:e};return Q.runKernel(Xwe,t)}var ySe=K({atanh_:gSe});function bSe(n,e){var t=M(n,"x","cast");if(!Cwe(e))throw new Error("Failed to cast to unknown dtype ".concat(e));if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var r={x:t},a={dtype:e};return Q.runKernel($4,r,a)}var rr=K({cast_:bSe});function wSe(n,e,t,r,a,i,o){o===void 0&&(o="channelsLast");var s=Ne(Uf(e),2),u=s[0],c=s[1],l;if(o==="channelsLast")l=[u,c,n[3],n[3]];else if(o==="channelsFirst")l=[u,c,n[1],n[1]];else throw new Error("Unknown dataFormat ".concat(o));return Cw(n,l,t,r,a,i,!1,o)}function Cw(n,e,t,r,a,i,o,s){var u,c;o===void 0&&(o=!1),s===void 0&&(s="channelsLast");var l=Ne([-1,-1,-1,-1],4),f=l[0],h=l[1],p=l[2],d=l[3];if(s==="channelsLast")u=Ne(n,4),f=u[0],h=u[1],p=u[2],d=u[3];else if(s==="channelsFirst")c=Ne(n,4),f=c[0],d=c[1],h=c[2],p=c[3];else throw new Error("Unknown dataFormat ".concat(s));var v=Ne(e,4),m=v[0],g=v[1],y=v[3],b=Ne(Uf(t),2),w=b[0],x=b[1],N=Ne(Uf(r),2),T=N[0],E=N[1],C=fw(m,T),F=fw(g,E),D=SSe(a,h,p,w,x,C,F,i,s),O=D.padInfo,L=D.outHeight,z=D.outWidth,$=o?y*d:y,B;return s==="channelsFirst"?B=[f,$,L,z]:s==="channelsLast"&&(B=[f,L,z,$]),{batchSize:f,dataFormat:s,inHeight:h,inWidth:p,inChannels:d,outHeight:L,outWidth:z,outChannels:$,padInfo:O,strideHeight:w,strideWidth:x,filterHeight:m,filterWidth:g,effectiveFilterHeight:C,effectiveFilterWidth:F,dilationHeight:T,dilationWidth:E,inShape:n,outShape:B,filterShape:e}}function xSe(n,e,t,r,a){r==null&&(r=kSe(n,e,t));var i=n[0],o=n[1],s=Sv((i-e+2*r)/t+1,a),u=Sv((o-e+2*r)/t+1,a);return[s,u]}function kSe(n,e,t,r){r===void 0&&(r=1);var a=fw(e,r);return Math.floor((n[0]*(t-1)-t+a)/2)}function Uf(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function fw(n,e){return e<=1?n:n+(n-1)*(e-1)}function SSe(n,e,t,r,a,i,o,s,u){var c,l,f;if(typeof n=="number"){var h=n===0?"VALID":"NUMBER";c={top:n,bottom:n,left:n,right:n,type:h};var p=xSe([e,t],i,r,n,s);l=p[0],f=p[1]}else if(n==="same"){l=Math.ceil(e/r),f=Math.ceil(t/a);var d=Math.max(0,(l-1)*r+i-e),v=Math.max(0,(f-1)*a+o-t),m=Math.floor(d/2),g=d-m,y=Math.floor(v/2),b=v-y;c={top:m,bottom:g,left:y,right:b,type:"SAME"}}else if(n==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-i+1)/r),f=Math.ceil((t-o+1)/a);else if(typeof n=="object"){var m=u==="channelsLast"?n[1][0]:n[2][0],g=u==="channelsLast"?n[1][1]:n[2][1],y=u==="channelsLast"?n[2][0]:n[3][0],b=u==="channelsLast"?n[2][1]:n[3][1],h=m===0&&g===0&&y===0&&b===0?"VALID":"EXPLICIT";c={top:m,bottom:g,left:y,right:b,type:h},l=Sv((e-i+m+g)/r+1,s),f=Sv((t-o+y+b)/a+1,s)}else throw Error("Unknown padding parameter: ".concat(n));return{padInfo:c,outHeight:l,outWidth:f}}function Sv(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode ".concat(e))}}function Nv(n){var e=Ne(Uf(n),3),t=e[0],r=e[1],a=e[2];return t===1&&r===1&&a===1}function Ho(n,e){return Nv(n)||Nv(e)}function Sc(n){return Uf(n).every(function(e){return e>0})}function xi(n,e,t){if(t!=null){if(typeof e=="string")throw Error("Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,"."));if(typeof e=="number")G(Vf(e),function(){return"Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(e,".")});else if(typeof e=="object")e.forEach(function(r){r.forEach(function(a){G(Vf(a),function(){return"Error in ".concat(n,": pad must be an integer when using ")+"dimRoundingMode ".concat(t," but got pad ").concat(a,".")})})});else throw Error("Error in ".concat(n,": Unknown padding parameter: ").concat(e))}}function NSe(n,e){var t=M(n,"x","reshape","string_or_numeric"),r={x:t},a={shape:e};return Q.runKernel(Pke,r,a)}var ge=K({reshape_:NSe});function TSe(n,e,t,r,a){var i=M(n,"x","avgPool","float32"),o=1;G(Ho(t,o),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")});var s=i,u=!1;i.rank===3&&(u=!0,s=ge(i,[1,i.shape[0],i.shape[1],i.shape[2]])),G(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(s.rank,".")}),xi("avgPool",r,a);var c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a},f=Q.runKernel(Zwe,c,l);return f=rr(f,i.dtype),u?ge(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var eB=K({avgPool_:TSe});function ESe(n,e,t,r,a,i){i===void 0&&(i="NDHWC");var o=M(n,"x","avgPool3d","float32"),s=o,u=!1;o.rank===4&&(u=!0,s=ge(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),G(s.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),G(i==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),G(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,function(){return"Error in avgPool3d: Stride must be > 0, but got '".concat(t,"'")}),xi("avgPool3d",r,a);var c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a,dataFormat:i},f=Q.runKernel(Jwe,c,l);return f=rr(f,s.dtype),u?ge(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var ISe=K({avgPool3d_:ESe});function CSe(n){var e=M(n,"x","clone","string_or_numeric"),t={x:e};return Q.runKernel(q4,t)}var yc=K({clone_:CSe});function ASe(n,e){e===void 0&&(e=0),G(n.length>=1,function(){return"Pass at least one tensor to concat"});var t=kv(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(function(i){if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `.concat(i.dtype,". "))}),t.length===1)return yc(t[0]);var r=t,a={axis:e};return Q.runKernel(sxe,r,a)}var Qr=K({concat_:ASe});function _Se(n,e,t,r){var a;t===void 0&&(t=!1),r===void 0&&(r=!1);var i=M(n,"a","matMul"),o=M(e,"b","matMul");a=Ne(Cn(i,o),2),i=a[0],o=a[1];var s={a:i,b:o},u={transposeA:t,transposeB:r};return Q.runKernel(Qwe,s,u)}var Bt=K({matMul_:_Se});function DSe(n,e){var t,r=M(n,"a","mul"),a=M(e,"b","mul");t=Ne(Cn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return Q.runKernel(vke,i)}var mt=K({mul_:DSe});function FSe(n){var e=M(n,"x","sigmoid","float32"),t={x:e};return Q.runKernel(Yke,t)}var bc=K({sigmoid_:FSe});function RSe(n,e,t){var r=M(n,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");var a={x:r},i={begin:e,size:t};return Q.runKernel(Hke,a,i)}var fn=K({slice_:RSe});function OSe(n){var e=M(n,"x","tanh","float32"),t={x:e};return Q.runKernel(v2e,t)}var hw=K({tanh_:OSe});function PSe(n,e,t,r,a,i){var o=M(n,"forgetBias","basicLSTMCell"),s=M(e,"lstmKernel","basicLSTMCell"),u=M(t,"lstmBias","basicLSTMCell"),c=M(r,"data","basicLSTMCell"),l=M(a,"c","basicLSTMCell"),f=M(i,"h","basicLSTMCell"),h=Qr([c,f],1),p=Bt(h,s),d=jn(p,u),v=d.shape[0],m=d.shape[1]/4,g=[v,m],y=fn(d,[0,0],g),b=fn(d,[0,m],g),w=fn(d,[0,m*2],g),x=fn(d,[0,m*3],g),N=jn(mt(bc(y),hw(b)),mt(l,bc(jn(o,w)))),T=mt(hw(N),bc(x));return[N,T]}var MSe=K({basicLSTMCell_:PSe});function BSe(n,e,t){var r=M(n,"x","batchToSpaceND"),a=e.reduce(function(s,u){return s*u});G(r.rank>=1+e.length,function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(e.length)}),G(t.length===e.length,function(){return"crops.length is ".concat(t.length," but should be equal to blockShape.length  ").concat(e.length)}),G(r.shape[0]%a===0,function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(e.join(" * ")," === ").concat(a)});var i={x:r},o={blockShape:e,crops:t};return Q.runKernel(exe,i,o)}var tB=K({batchToSpaceND_:BSe});function LSe(n){var e;return n.rank===0||n.rank===1?e=ge(n,[1,1,1,n.size]):n.rank===2?e=ge(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=ge(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}function zSe(n,e,t,r,a,i){i==null&&(i=.001);var o=M(n,"x","batchNorm"),s=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm"),c;a!=null&&(c=M(a,"scale","batchNorm"));var l;r!=null&&(l=M(r,"offset","batchNorm")),G(s.rank===u.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),G(l==null||s.rank===l.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),G(c==null||s.rank===c.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var f=LSe(o),h={x:f,scale:c,offset:l,mean:s,variance:u},p={varianceEpsilon:i},d=Q.runKernel(Lxe,h,p);return ge(d,o.shape)}var Av=K({batchNorm_:zSe});function $Se(n,e,t,r,a,i){var o=M(n,"x","batchNorm"),s=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm"),c;a!=null&&(c=M(a,"scale","batchNorm"));var l;return r!=null&&(l=M(r,"offset","batchNorm")),G(o.rank===2,function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(o.rank,".")}),G(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(s.rank,".")}),G(u.rank===2||u.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&G(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&G(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(l.rank,".")}),Av(o,s,u,l,c,i)}var qSe=K({batchNorm2d_:$Se});function WSe(n,e,t,r,a,i){var o=M(n,"x","batchNorm"),s=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm"),c;a!=null&&(c=M(a,"scale","batchNorm"));var l;return r!=null&&(l=M(r,"offset","batchNorm")),G(o.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(o.rank,".")}),G(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(s.rank,".")}),G(u.rank===3||u.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&G(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&G(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(l.rank,".")}),Av(o,s,u,l,c,i)}var VSe=K({batchNorm3d_:WSe});function GSe(n,e,t,r,a,i){var o=M(n,"x","batchNorm"),s=M(e,"mean","batchNorm"),u=M(t,"variance","batchNorm"),c;a!=null&&(c=M(a,"scale","batchNorm"));var l;return r!=null&&(l=M(r,"offset","batchNorm")),G(o.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(o.rank,".")}),G(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(s.rank,".")}),G(u.rank===4||u.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(u.rank,".")}),c!=null&&G(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(c.rank,".")}),l!=null&&G(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(l.rank,".")}),Av(o,s,u,l,c,i)}var USe=K({batchNorm4d_:GSe});function HSe(n,e,t){var r=M(n,"x","bincount"),a=M(e,"weights","bincount");G(r.dtype==="int32",function(){return"Error in bincount: input "+"dtype must be int32, but got ".concat(r.dtype)}),G(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),G(a.size===r.size||a.size===0,function(){return"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(r.shape,", weights shape: ")+"".concat(a.shape,".")});var i={x:r,weights:a},o={size:t};return Q.runKernel(txe,i,o)}var nB=K({bincount_:HSe});function KSe(n,e){var t=M(n,"s0","broadcastArgs","int32"),r=M(e,"s1","broadcastArgs","int32");if(t.rank!==1)throw new Error("broadcastArgs(): first input must be a vector (rank=1). "+"Has rank ".concat(t.rank));if(r.rank!==1)throw new Error("broadcastArgs(): second input must be a vector (rank=1). "+"Has rank ".concat(r.rank));var a={s0:t,s1:r};return Q.runKernel(nxe,a)}var jSe=K({broadcastArgs_:KSe});function XSe(n,e){var t=M(n,"broadcastTo","x"),r=t.shape;if(ga(e),e.length<t.rank)throw new Error("broadcastTo(): shape.length=".concat(e.length," < input.rank=").concat(t.rank,"."));if(e.length>t.rank){for(var a=t.shape.slice();a.length<e.length;)a.unshift(1);t=ge(t,a)}for(var i=t.shape,o=Array.from(e),s=e.length-1;s>=0;s--)if(i[s]===e[s])o[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(e,"]."));var u=o.map(function(f,h){return f>1?h:-1}).filter(function(f){return f>=0});if(u.length===0)return yc(t);var c={x:t},l={reps:o};return Q.runKernel(W4,c,l)}var yv=K({broadcastTo_:XSe});function Go(n,e,t){return e===void 0&&(e="float32"),e=e||"float32",ga(n),new iw(n,e,t)}function YSe(n){var e=M(n,"x","ceil","float32"),t={x:e};return Q.runKernel(rxe,t)}var ZSe=K({ceil_:YSe});function _v(n,e,t){ga(n);var r={shape:n,value:e,dtype:t};return Q.runKernel(Oxe,{},r)}function JSe(n,e,t){var r=M(n,"x","clipByValue");if(G(e<=t,function(){return"Error in clip: min (".concat(e,") must be ")+"less than or equal to max (".concat(t,").")}),e===t)return _v(r.shape,e,r.dtype);var a={x:r},i={clipValueMin:e,clipValueMax:t};return Q.runKernel(axe,a,i)}var QSe=K({clipByValue_:JSe});function eNe(n,e){var t=M(n,"real","complex"),r=M(e,"imag","complex");Ua(t.shape,r.shape,"real and imag shapes, ".concat(t.shape," and ").concat(r.shape,", ")+"must match in call to tf.complex().");var a={real:t,imag:r};return Q.runKernel(ixe,a)}var Ys=K({complex_:eNe});function tNe(n){return Qr(n,0)}var nNe=K({concat1d_:tNe});function rNe(n,e){return Qr(n,e)}var aNe=K({concat2d_:rNe});function iNe(n,e){return Qr(n,e)}var oNe=K({concat3d_:iNe});function sNe(n,e){return Qr(n,e)}var uNe=K({concat4d_:sNe});function cNe(n,e,t,r,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=M(n,"x","conv2d","float32"),u=M(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),G(c.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")}),G(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")}),xi("conv2d",r,o);var f=a==="NHWC"?c.shape[3]:c.shape[1];G(f===u.shape[2],function(){return"Error in conv2d: depth of input (".concat(f,") must match ")+"input depth for filter ".concat(u.shape[2],".")}),G(Ho(t,i),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),G(Sc(i),function(){return"Error in conv2D: Dilated rates should be larger than 0."}),G(Sc(t),function(){return"Error in conv2D: Strides should be larger than 0."});var h={x:c,filter:u},p={strides:t,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},d=Q.runKernel(uxe,h,p);return l?ge(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Dv=K({conv2d_:cNe});function lNe(n,e,t,r,a,i,o){a===void 0&&(a="NWC"),i===void 0&&(i=1);var s=M(n,"x","conv1d"),u=M(e,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=ge(s,[1,s.shape[0],s.shape[1]])),G(c.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")}),G(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+"".concat(u.rank,".")}),xi("conv1d",r,o),G(c.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match ")+"input depth for filter ".concat(u.shape[1],".")}),G(Ho(t,i),function(){return"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(t," and dilation '").concat(i,"'")}),G(Sc(i),function(){return"Error in conv1D: Dilated rates should be larger than 0."}),G(Sc(t),function(){return"Error in conv1D: Stride should be larger than 0."}),G(a==="NWC",function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")});var f=ge(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=ge(c,[c.shape[0],1,c.shape[1],c.shape[2]]),p=[1,t],d=[1,i],v="NHWC",m=Dv(h,f,p,r,v,d,o);return l?ge(m,[m.shape[2],m.shape[3]]):ge(m,[m.shape[0],m.shape[2],m.shape[3]])}var fNe=K({conv1d_:lNe});function hNe(n,e,t,r,a,i,o){i===void 0&&(i="NHWC"),G(n.length===e.rank,function(){return"Length of inShape "+"(".concat(n.length,") and rank of dy (").concat(e.rank,") must match")});var s=n,u=e,c=!1;e.rank===3&&(c=!0,u=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,n[0],n[1],n[2]]),G(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")}),G(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)}),G(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(t.rank)});var l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];G(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(t.shape[2],".")}),G(f===t.shape[3],function(){return"Error in conv2dDerInput: depth of output (".concat(f,") must ")+"match output depth for filter ".concat(t.shape[3],".")}),xi("conv2dDerInput",a,o);var h={dy:u,filter:t},p={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=Q.runKernel(lxe,h,p);return c?ge(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var rB=K({conv2DBackpropInput_:hNe});function pNe(n,e,t,r,a,i){var o=M(n,"x","conv2dTranspose"),s=M(e,"filter","conv2dTranspose");return rB(t,o,s,r,a,"NHWC",i)}var dNe=K({conv2dTranspose_:pNe});function vNe(n,e,t,r,a,i){a===void 0&&(a="NDHWC"),i===void 0&&(i=[1,1,1]);var o=M(n,"x","conv3d"),s=M(e,"filter","conv3d"),u=o,c=!1;o.rank===4&&(c=!0,u=ge(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),G(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")}),G(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+"".concat(s.rank,".")}),G(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match ")+"input depth for filter ".concat(s.shape[3],".")}),G(Ho(t,i),function(){return"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(i,"'")}),G(a==="NDHWC",function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")}),G(Sc(i),function(){return"Error in conv3D: Dilated rates should be larger than 0."}),G(Sc(t),function(){return"Error in conv3D: Strides should be larger than 0."});var l={x:u,filter:s},f={strides:t,pad:r,dataFormat:a,dilations:i},h=Q.runKernel(fxe,l,f);return c?ge(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var mNe=K({conv3d_:vNe});function gNe(n,e,t,r,a){G(n.length===e.rank,function(){return"Length of inShape "+"(".concat(n.length,") and rank of dy (").concat(e.rank,") must match")});var i=n,o=e,s=!1;e.rank===4&&(s=!0,o=ge(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);var u=i[4],c=o.shape[4];G(i.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")}),G(o.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)}),G(t.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(t.rank)}),G(u===t.shape[3],function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(t.shape[3],".")}),G(c===t.shape[4],function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(t.shape[4],".")});var l={dy:o,filter:t},f={pad:a,strides:r,inputShape:i},h=Q.runKernel(hxe,l,f);return s?ge(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var yNe=K({conv3DBackpropInput_:gNe});function bNe(n,e,t,r,a){var i=M(n,"x","conv3dTranspose"),o=M(e,"filter","conv3dTranspose");return yNe(t,i,o,r,a)}var wNe=K({conv3dTranspose_:bNe});function xNe(n){var e=M(n,"x","cos","float32"),t={x:e};return Q.runKernel(pxe,t)}var kNe=K({cos_:xNe});function SNe(n){var e=M(n,"x","cosh","float32"),t={x:e};return Q.runKernel(dxe,t)}var NNe=K({cosh_:SNe});function TNe(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var a=M(n,"x","cumprod"),i={x:a},o={axis:e,exclusive:t,reverse:r};return Q.runKernel(vxe,i,o)}var ENe=K({cumprod_:TNe});function INe(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var a=M(n,"x","cumsum"),i={x:a},o={axis:e,exclusive:t,reverse:r};return Q.runKernel(mxe,i,o)}var CNe=K({cumsum_:INe});function ANe(n,e,t,r){r===void 0&&(r=!1);var a=M(n,"x","denseBincount"),i=M(e,"weights","denseBincount");G(a.dtype==="int32",function(){return"Error in denseBincount: input "+"dtype must be int32, but got ".concat(a.dtype)}),G(a.rank<=2,function(){return"Error in denseBincount: input must be at most rank 2, but got "+"rank ".concat(a.rank,".")}),G(t>=0,function(){return"size must be non-negative, but got ".concat(t,".")}),G(i.size===a.size||i.size===0,function(){return"Error in denseBincount: weights must have the same shape as x or "+"0-length, but got x shape: ".concat(a.shape,", weights shape: ")+"".concat(i.shape,".")});var o={x:a,weights:i},s={size:t,binaryOutput:r};return Q.runKernel(yxe,o,s)}var _Ne=K({denseBincount_:ANe});function DNe(n,e,t){t===void 0&&(t="NHWC");var r=M(n,"x","depthToSpace","float32"),a=t==="NHWC"?r.shape[1]:r.shape[2],i=t==="NHWC"?r.shape[2]:r.shape[3],o=t==="NHWC"?r.shape[3]:r.shape[1];G(e>1,function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(e)}),G(a*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(a," and ").concat(e,`  for depthToSpace with input shape
    `).concat(r.shape)}),G(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
    `.concat(i," and ").concat(e,` for depthToSpace with input shape
        `).concat(r.shape)}),G(o%(e*e)===0,function(){return"Dimension size must be evenly divisible by ".concat(e*e," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape)});var s={x:r},u={blockSize:e,dataFormat:t};return Q.runKernel(bxe,s,u)}var FNe=K({depthToSpace_:DNe});function RNe(n,e,t,r,a,i,o){a===void 0&&(a="NHWC"),i===void 0&&(i=[1,1]);var s=M(n,"x","depthwiseConv2d","float32"),u=M(e,"filter","depthwiseConv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),G(c.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(c.rank,".")}),G(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")});var f=a==="NHWC"?c.shape[3]:c.shape[1];G(f===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels "+"(".concat(f,") must match the inChannels dimension in ")+"filter ".concat(u.shape[2],".")}),xi("depthwiseConv2d",r,o);var h={x:c,filter:u},p={strides:t,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},d=Q.runKernel(wxe,h,p);return l?ge(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Aw=K({depthwiseConv2d_:RNe});function ONe(n){var e=M(n,"x","diag"),t={x:e};return Q.runKernel(Sxe,t)}var PNe=K({diag_:ONe});function MNe(n,e,t,r,a,i){a===void 0&&(a=[1,1]),i===void 0&&(i="NHWC");var o=M(n,"x","dilation2d"),s=M(e,"filter","dilation2d");G(o.rank===3||o.rank===4,function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(o.rank,".")}),G(s.rank===3,function(){return"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(s.rank,".")}),G(i==="NHWC",function(){return"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(i)});var u=o,c=!1;o.rank===3&&(u=ge(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),G(u.shape[3]===s.shape[2],function(){return"Error in dilation2d:  input and filter must have the same depth: ".concat(u.shape[3]," vs ").concat(s.shape[2])});var l={x:u,filter:s},f={strides:t,pad:r,dilations:a},h=Q.runKernel(Nxe,l,f);return c?ge(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var BNe=K({dilation2d_:MNe});function LNe(n,e){var t,r=M(n,"a","floorDiv"),a=M(e,"b","floorDiv");t=Ne(Cn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return Q.runKernel(Bxe,i)}var aB=K({floorDiv_:LNe});function zNe(n,e){var t,r=M(n,"a","div"),a=M(e,"b","div");if(t=Ne(Cn(r,a),2),r=t[0],a=t[1],r.dtype==="int32"&&a.dtype==="int32")return aB(r,a);var i={a:r,b:a},o={};return Q.runKernel(Txe,i,o)}var yr=K({div_:zNe});function $Ne(n,e){for(var t=[],r=0;r<e.length;r++){var a=n[n.length-r-1],i=e.length-r-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function Xn(n,e){for(var t=[],r=Math.max(n.length,e.length),a=0;a<r;a++){var i=n[n.length-a-1];i==null&&(i=1);var o=e[e.length-a-1];if(o==null&&(o=1),i===1)t.unshift(o);else if(o===1)t.unshift(i);else if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(n," and ").concat(e,".");throw Error(s)}else t.unshift(i)}return t}function qNe(n,e){var t,r=M(n,"a","equal","string_or_numeric"),a=M(e,"b","equal","string_or_numeric");t=Ne(Cn(r,a),2),r=t[0],a=t[1],Xn(r.shape,a.shape);var i={a:r,b:a};return Q.runKernel(Axe,i)}var iB=K({equal_:qNe});function WNe(n,e,t){var r=M(e,"a","where"),a=M(t,"b","where"),i=M(n,"condition","where","bool"),o=Xn(Xn(i.shape,r.shape),a.shape),s=yv(i,o),u=yv(r,o),c=yv(a,o),l={condition:s,t:u,e:c};return Q.runKernel(Gke,l)}var Nc=K({where_:WNe});function VNe(n){var e=M(n,"x","zerosLike"),t={x:e};return Q.runKernel(x2e,t)}var _w=K({zerosLike_:VNe});function GNe(n,e){var t,r=M(n,"a","div"),a=M(e,"b","div");t=Ne(Cn(r,a),2),r=t[0],a=t[1];var i=yr(r,a),o=_w(i),s=iB(a,o);return Nc(s,o,i)}var UNe=K({divNoNan_:GNe});function HNe(n,e){var t=M(n,"t1","dot"),r=M(e,"t2","dot");G((t.rank===1||t.rank===2)&&(r.rank===1||r.rank===2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(t.rank," and ").concat(r.rank,".")});var a=t.rank===1?t.size:t.shape[1],i=r.rank===1?r.size:r.shape[0];if(G(a===i,function(){return"Error in dot: inner dimensions of inputs must match, but got "+"".concat(a," and ").concat(i,".")}),t.rank===1&&r.rank===1){var o=ge(t,[1,-1]),s=ge(r,[-1,1]),u=Bt(o,s);return ge(u,[])}else if(t.rank===1&&r.rank===2){var o=ge(t,[1,-1]),s=ge(r,[r.shape[0],r.shape[1]]),u=Bt(o,s);return ge(u,[u.size])}else if(t.rank===2&&r.rank===1){var s=ge(r,[-1,1]),u=Bt(t,s);return ge(u,[u.size])}else{var s=ge(r,[r.shape[0],r.shape[1]]),u=Bt(t,s);return u}}var KNe=K({dot_:HNe});function jNe(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var r=e.map(function(i,o){return M(i,"tensors".concat(o),"einsum")}),a={equation:n};return Q.runKernel(Exe,r,a)}var XNe=K({einsum_:jNe});function YNe(n){var e=M(n,"x","elu","float32"),t={x:e};return Q.runKernel(Ixe,t)}var oB=K({elu_:YNe});function ZNe(n){var e=M(n,"x","erf");G(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=rr(e,"float32"));var t={x:e};return Q.runKernel(Cxe,t)}var JNe=K({erf_:ZNe});function QNe(n,e,t){for(var r=n.length+e.length,a=[],i=0,o=0,s=0;s<r;s++)t.indexOf(s)===-1?a.push(n[i++]):a.push(e[o++]);return a}function Fv(n,e){var t=e.map(function(r){return 1});return QNe(n,t,e)}function eTe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","max"),a={x:r},i={reductionIndices:e,keepDims:t};return Q.runKernel(ake,a,i)}var wc=K({max_:eTe});function tTe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","min"),a={x:r},i={axis:e,keepDims:t};return Q.runKernel(lke,a,i)}var pw=K({min_:tTe});function nTe(n,e){var t,r=M(n,"base","pow"),a=M(e,"exp","pow");t=Ne(Cn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return Q.runKernel(Tke,i)}var Dw=K({pow_:nTe});function Ko(n,e,t,r){if(r==null)r=ww(n);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(typeof n=="object"&&("texture"in n||"buffer"in n&&!(n.buffer instanceof ArrayBuffer))){if(r!=="float32"&&r!=="int32")throw new Error("Creating tensor from GPU data only supports "+"'float32'|'int32' dtype, while the dtype is ".concat(r,"."));return Q.backend.createTensorFromGPUData(n,e||t,r)}if(!bi(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){ga(e);var a=Fr(e),i=Fr(t);G(a===i,function(){return"Based on the provided shape, [".concat(e,"], the tensor should have ")+"".concat(a," values but has ").concat(i)});for(var o=0;o<t.length;++o){var s=t[o],u=o===t.length-1?s!==Fr(e.slice(o)):!0;G(t[o]===e[o]||!u,function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(t,") does not match the provided ")+"shape (".concat(e,"). ")})}}return!bi(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=r!=="string"?j4(n,r):Gf(n,[],!0),Q.makeTensor(n,e,r)}function bn(n,e){if((bi(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&bi(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");var t=[],r=[];return Ko(n,t,r,e)}function rTe(n){var e=M(n,"x","sqrt","float32"),t={x:e};return Q.runKernel(Jke,t)}var dw=K({sqrt_:rTe});function aTe(n){var e=M(n,"x","square"),t={};return Q.runKernel("Square",{x:e},t)}var Rv=K({square_:aTe});function iTe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","sum");r.dtype==="bool"&&(r=rr(r,"int32"));var a={x:r},i={axis:e,keepDims:t};return Q.runKernel(Qke,a,i)}var en=K({sum_:iTe});function oTe(n,e,t,r){e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1),n=M(n,"x","norm");var a=sB(n,e,t),i=a.shape;if(r){var o=Cv(t,n.shape);i=Fv(a.shape,o)}return ge(a,i)}function sB(n,e,t){if(t===void 0&&(t=null),n.rank===0)return $a(n);if(n.rank!==1&&t===null)return sB(ge(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return en($a(n),t);if(e===1/0)return wc($a(n),t);if(e===-1/0)return pw($a(n),t);if(e==="euclidean"||e===2)return dw(en(Dw($a(n),bn(2,"int32")),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}if(Array.isArray(t)&&t.length===2){if(e===1)return wc(en($a(n),t[0]),t[1]-1);if(e===1/0)return wc(en($a(n),t[1]),t[0]);if(e===-1/0)return pw(en($a(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return dw(en(Rv(n),t));throw new Error("Error in norm: invalid ord value: ".concat(e))}throw new Error("Error in norm: invalid axis: ".concat(t))}var Ov=K({norm_:oTe});function sTe(n,e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),Ov(n,"euclidean",e,t)}var uTe=K({euclideanNorm_:sTe});function cTe(n){var e=M(n,"x","exp"),t={x:e};return Q.runKernel(_xe,t)}var Zs=K({exp_:cTe});function lTe(n,e){e===void 0&&(e=0);var t=M(n,"x","expandDims","string_or_numeric");G(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var r={input:t},a={dim:e};return Q.runKernel(Dxe,r,a)}var Ks=K({expandDims_:lTe});function fTe(n){var e=M(n,"x","expm1"),t={x:e};return Q.runKernel(Fxe,t)}var hTe=K({expm1_:fTe});function pTe(n,e){var t=M(n,"x","tile","string_or_numeric");G(t.rank===e.length,function(){return"Error in transpose: rank of input ".concat(t.rank," ")+"must match length of reps ".concat(e,".")});var r={x:t},a={reps:e};return Q.runKernel(W4,r,a)}var qf=K({tile_:pTe});function dTe(n,e,t,r){r===void 0&&(r="float32"),e==null&&(e=n);for(var a=Go([n,e],r),i=n<=e?n:e,o=0;o<i;++o)a.set(1,o,o);var s=ge(a.toTensor(),[n,e]);if(t==null)return s;if(t.length===1)return qf(Ks(s,0),[t[0],1,1]);if(t.length===2)return qf(Ks(Ks(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return qf(Ks(Ks(Ks(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(t.length,"D."))}var uB=K({eye_:dTe});function vTe(n){var e=M(n,"x","floor","float32"),t={x:e};return Q.runKernel(Mxe,t)}var cB=K({floor_:vTe});function mTe(n,e,t,r){t===void 0&&(t=0),r===void 0&&(r=0);var a=M(n,"x","gather"),i=M(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:r};return Q.runKernel(zxe,o,s)}var lB=K({gather_:mTe});function gTe(n,e){var t,r=M(n,"a","greater","string_or_numeric"),a=M(e,"b","greater","string_or_numeric");t=Ne(Cn(r,a),2),r=t[0],a=t[1],Xn(r.shape,a.shape);var i={a:r,b:a};return Q.runKernel(qxe,i)}var Pv=K({greater_:gTe});function yTe(n,e){var t,r=M(n,"a","greaterEqual","string_or_numeric"),a=M(e,"b","greaterEqual","string_or_numeric");t=Ne(Cn(r,a),2),r=t[0],a=t[1],Xn(r.shape,a.shape);var i={a:r,b:a};return Q.runKernel(Wxe,i)}var fB=K({greaterEqual_:yTe});function bTe(n){var e=M(n,"input","imag"),t={input:e};return Q.runKernel(Gxe,t)}var Mv=K({imag_:bTe});function wTe(n){var e=M(n,"x","isFinite"),t={x:e};return Q.runKernel(Uxe,t)}var xTe=K({isFinite_:wTe});function kTe(n){var e=M(n,"x","isInf"),t={x:e};return Q.runKernel(Hxe,t)}var STe=K({isInf_:kTe});function NTe(n){var e=M(n,"x","isNaN"),t={x:e};return Q.runKernel(Kxe,t)}var TTe=K({isNaN_:NTe});function ETe(n,e){e===void 0&&(e=.2);var t=M(n,"x","leakyRelu"),r={x:t},a={alpha:e};return Q.runKernel(jxe,r,a)}var hB=K({leakyRelu_:ETe});function ITe(n,e){var t,r=M(n,"a","less","string_or_numeric"),a=M(e,"b","less","string_or_numeric");t=Ne(Cn(r,a),2),r=t[0],a=t[1],Xn(r.shape,a.shape);var i={a:r,b:a};return Q.runKernel(Xxe,i)}var CTe=K({less_:ITe});function ATe(n,e){var t,r=M(n,"a","lessEqual","string_or_numeric"),a=M(e,"b","lessEqual","string_or_numeric");t=Ne(Cn(r,a),2),r=t[0],a=t[1],Xn(r.shape,a.shape);var i={a:r,b:a};return Q.runKernel(Yxe,i)}var Fw=K({lessEqual_:ATe});function _Te(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");var r={start:n,stop:e,num:t};return Q.runKernel(Zxe,{},r)}function DTe(n,e,t,r,a){e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),a===void 0&&(a=.5);var i=M(n,"x","localResponseNormalization");G(i.rank===4||i.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `.concat(i.rank,".")}),G(Vf(e),function(){return"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(e,".")});var o=i,s=!1;i.rank===3&&(s=!0,o=ge(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:e,bias:t,alpha:r,beta:a},l=Q.runKernel(rke,u,c);return s?ge(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var FTe=K({localResponseNormalization_:DTe});function RTe(n){var e=M(n,"x","log","float32"),t={x:e};return Q.runKernel(Jxe,t)}var Hf=K({log_:RTe});function OTe(n){var e=M(n,"x","log1p"),t={x:e};return Q.runKernel(Qxe,t)}var pB=K({log1p_:OTe});function oo(n){return Q.customGrad(n)}function PTe(n){var e=M(n,"x","neg"),t={x:e};return Q.runKernel(mke,t)}var io=K({neg_:PTe});function MTe(n){var e=M(n,"x","softplus"),t={x:e};return Q.runKernel(Zke,t)}var dB=K({softplus_:MTe});function BTe(n){var e=M(n,"x","logSigmoid"),t=oo(function(r){var a=io(dB(io(r))),i=function(o){var s=mt(o,bc(io(r)));return s};return{value:a,gradFunc:i}});return t(e)}var LTe=K({logSigmoid_:BTe});function zTe(n,e){var t,r=M(n,"a","sub"),a=M(e,"b","sub");t=Ne(Cn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return Q.runKernel(p2e,i)}var It=K({sub_:zTe});function $Te(n,e){e===void 0&&(e=-1);var t=M(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and axis was ").concat(e));var r=oo(function(a,i){var o=!0,s=wc(a,e,!0),u=It(a,s),c=It(rr(u,"float32"),Hf(en(Zs(u),e,o)));i([c]);var l=function(f,h){var p=Ne(h,1),d=p[0],v=!0,m=Zs(d);return It(f,mt(en(f,e,v),m))};return{value:c,gradFunc:l}});return r(t)}var qTe=K({logSoftmax_:$Te});function WTe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","logSumExp"),a=Cv(e,r.shape),i=wc(r,a,!0),o=It(r,i),s=Zs(o),u=en(s,a),c=Hf(u),l=jn(ge(i,c.shape),c);if(t){var f=Fv(l.shape,a);return ge(l,f)}return l}var vB=K({logSumExp_:WTe});function VTe(n,e){var t=M(n,"a","logicalAnd","bool"),r=M(e,"b","logicalAnd","bool");Xn(t.shape,r.shape);var a={a:t,b:r};return Q.runKernel(eke,a)}var Tv=K({logicalAnd_:VTe});function GTe(n){var e=M(n,"x","logicalNot","bool"),t={x:e};return Q.runKernel(tke,t)}var mB=K({logicalNot_:GTe});function UTe(n,e){var t=M(n,"a","logicalOr","bool"),r=M(e,"b","logicalOr","bool");Xn(t.shape,r.shape);var a={a:t,b:r};return Q.runKernel(nke,a)}var gB=K({logicalOr_:UTe});function HTe(n,e){var t=M(n,"a","logicalXor","bool"),r=M(e,"b","logicalXor","bool");return Xn(t.shape,r.shape),Tv(gB(n,e),mB(Tv(n,e)))}var KTe=K({logicalXor_:HTe});var dv=2147483648;function jTe(n,e,t){t===void 0&&(t="left");var r=M(n,"sortedSequence","searchSorted"),a=M(e,"values","searchSorted"),i=r.shape[r.shape.length-1],o=a.shape[a.shape.length-1],s=ge(r,[-1,i]),u=ge(a,[-1,o]);if(s.rank<2)throw new Error("Sorted input argument must be at least 2-dimensional");if(s.shape[0]!==u.shape[0])throw new Error("Leading dimension of 'sortedSequence' and 'values' must match.");if(Fr(u.shape)>=dv)throw new Error("values tensor size must less than ".concat(dv));if(s.shape[1]>=dv)throw new Error("trailing dim_size must less than ".concat(dv," for int32 output type, was ").concat(s.shape[1]));var c={sortedSequence:s,values:u},l={side:t};return Q.runKernel(Vke,c,l)}var Rw=K({searchSorted_:jTe});function XTe(n,e){return Rw(n,e,"left")}function YTe(n,e,t,r,a){var i=M(n,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=ge(i,[1,i.shape[0],i.shape[1],i.shape[2]])),G(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(s.rank,".")}),G(Ho(t,o),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(t," and dilations '").concat(o,"'")}),xi("maxPool",r,a);var c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a},f=Q.runKernel(oke,c,l);return u?ge(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var yB=K({maxPool_:YTe});function ZTe(n,e,t,r,a,i){e===void 0&&(e=[1,1,1]),i===void 0&&(i="NDHWC");var o=M(n,"x","maxPool3d"),s=o,u=!1;o.rank===4&&(u=!0,s=ge(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),G(s.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")}),G(i==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)}),xi("maxPool3d",r,a);var c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a,dataFormat:i},f=Q.runKernel(ske,c,l);return u?ge(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var JTe=K({maxPool3d_:ZTe});function QTe(n,e,t,r,a){a===void 0&&(a=!1);var i=M(n,"x","maxPoolWithArgmax"),o={x:i},s={filterSize:e,strides:t,pad:r,includeBatchInIndex:a},u=Q.runKernel(uke,o,s);return{result:u[0],indexes:u[1]}}var eEe=K({maxPoolWithArgmax_:QTe});function tEe(n,e){var t,r=M(n,"a","maximum"),a=M(e,"b","maximum");t=Ne(Cn(r,a),2),r=t[0],a=t[1],r.dtype==="bool"&&(r=rr(r,"int32"),a=rr(a,"int32")),Xn(r.shape,a.shape);var i={a:r,b:a};return Q.runKernel(ike,i)}var nEe=K({maximum_:tEe});function rEe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","mean"),a={x:r},i={axis:e,keepDims:t};return Q.runKernel(cke,a,i)}var Ev=K({mean_:rEe});function Tc(n,e){if(e===void 0&&(e="float32"),ga(n),e==="complex64"){var t=Tc(n,"float32"),r=Tc(n,"float32");return Ys(t,r)}var a=kw(Fr(n),e);return Q.makeTensor(a,n,e)}function Xs(n,e){if(e===void 0&&(e="float32"),ga(n),e==="complex64"){var t=Xs(n,"float32"),r=Tc(n,"float32");return Ys(t,r)}var a=M4(Fr(n),e);return Q.makeTensor(a,n,e)}function aEe(n,e,t){var r=t===void 0?{}:t,a=r.indexing,i=a===void 0?"xy":a;if(i!=="xy"&&i!=="ij")throw new TypeError("".concat(i," is not a valid third argument to meshgrid"));if(n===void 0)return[];var o=M(n,"x","meshgrid",n instanceof _r?n.dtype:"float32");if(e===void 0)return[o];var s=M(e,"y","meshgrid",e instanceof _r?e.dtype:"float32"),u=Fr(o.shape),c=Fr(s.shape);return i==="xy"?(o=ge(o,[1,-1]),s=ge(s,[-1,1]),[Bt(Xs([c,1],o.dtype),o),Bt(s,Xs([1,u],s.dtype))]):(o=ge(o,[-1,1]),s=ge(s,[1,-1]),[Bt(o,Xs([1,c],o.dtype)),Bt(Xs([u,1],s.dtype),s)])}function iEe(n,e){var t,r=M(n,"a","minimum"),a=M(e,"b","minimum");t=Ne(Cn(r,a),2),r=t[0],a=t[1],r.dtype==="bool"&&(r=rr(r,"int32"),a=rr(a,"int32")),Xn(r.shape,a.shape);var i={a:r,b:a};return Q.runKernel(fke,i)}var bB=K({minimum_:iEe});function oEe(n,e,t){G(t==="reflect"||t==="symmetric",function(){return"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(t,".")});var r=M(n,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");G(e.length===r.rank,function(){return"Padding doesn't match input. Must be ".concat(r.rank,". ")+"Got ".concat(e.length,".")});for(var a=t==="reflect"?1:0,i=function(c){G(e[c].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),G(e[c][0]>=0&&e[c][0]<=r.shape[c]-a&&e[c][1]>=0&&e[c][1]<=r.shape[c]-a,function(){return"Padding in dimension ".concat(c," cannot be greater than or equal ")+"to ".concat(r.shape[c]-a," or less than 0 for input of ")+"shape ".concat(r.shape)})},o=0;o<r.rank;o++)i(o);var s={paddings:e,mode:t},u={x:r};return Q.runKernel(hke,u,s)}var sEe=K({mirrorPad_:oEe});function uEe(n,e){var t,r=M(n,"a","mod"),a=M(e,"b","mod");t=Ne(Cn(r,a),2),r=t[0],a=t[1];var i={a:r,b:a};return Q.runKernel(pke,i)}var cEe=K({mod_:uEe});function lEe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1),n=M(n,"x","moments");var r=Cv(e,n.shape),a=Ev(n,r,t),i=a.shape;t||(i=Fv(a.shape,r));var o=Rv(It(rr(n,"float32"),ge(a,i))),s=Ev(o,r,t);return{mean:a,variance:s}}var fEe=K({moments_:lEe});function hEe(n,e,t,r){for(var a=M(e,"data","multiRNNCell"),i=kv(t,"c","multiRNNCell"),o=kv(r,"h","multiRNNCell"),s=a,u=[],c=0;c<n.length;c++){var l=n[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}for(var f=[],h=[],c=0;c<u.length;c+=2)f.push(u[c]),h.push(u[c+1]);return[f,h]}var pEe=K({multiRNNCell_:hEe});function dEe(n,e,t,r){r===void 0&&(r=!1);var a=M(n,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+"".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));t=t||Math.random();var s=o===1?ge(a,[1,-1]):a,u={logits:s},c={numSamples:e,seed:t,normalized:r},l=Q.runKernel(dke,u,c);return o===1?ge(l,[l.size]):l}var vEe=K({multinomial_:dEe});function mEe(n,e){var t,r=M(n,"a","notEqual","string_or_numeric"),a=M(e,"b","notEqual","string_or_numeric");t=Ne(Cn(r,a),2),r=t[0],a=t[1],Xn(r.shape,a.shape);var i={a:r,b:a};return Q.runKernel(gke,i)}var wB=K({notEqual_:mEe});function gEe(n,e,t,r,a){if(t===void 0&&(t=1),r===void 0&&(r=0),a===void 0&&(a="int32"),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(e));var i=M(n,"indices","oneHot","int32"),o={indices:i},s={dtype:a,depth:e,onValue:t,offValue:r};return Q.runKernel(kke,o,s)}var yEe=K({oneHot_:gEe});function bEe(n){var e=M(n,"x","onesLike"),t={x:e};return Q.runKernel(xke,t)}var wEe=K({onesLike_:bEe});function xEe(n,e){var t=M(n,"v1","outerProduct"),r=M(e,"v2","outerProduct");G(t.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+"".concat(t.rank," and ").concat(r.rank,".")});var a=ge(t,[-1,1]),i=ge(r,[1,-1]);return Bt(a,i)}var kEe=K({outerProduct_:xEe});function SEe(n,e,t){t===void 0&&(t=0);var r=M(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:e,constantValue:t},i={x:r};return Q.runKernel(Nke,i,a)}var Zf=K({pad_:SEe});function NEe(n,e,t){return t===void 0&&(t=0),G(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),Zf(n,[e],t)}var TEe=K({pad1d_:NEe});function EEe(n,e,t){return t===void 0&&(t=0),G(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Zf(n,e,t)}var IEe=K({pad2d_:EEe});function CEe(n,e,t){return t===void 0&&(t=0),G(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Zf(n,e,t)}var AEe=K({pad3d_:CEe});function _Ee(n,e,t){return t===void 0&&(t=0),G(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),Zf(n,e,t)}var DEe=K({pad4d_:_Ee});function FEe(n,e,t){var r=M(n,"x","spaceToBatchND");G(r.rank>=1+e.length,function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(e.length)}),G(t.length===e.length,function(){return"paddings.shape[0] ".concat(t.length," must be equal to [blockShape] ").concat(e.length)}),G(r.shape.reduce(function(o,s,u){return u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o},!0),function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(t.toString()," must be divisible by blockShapes ").concat(e.toString())});var a={x:r},i={blockShape:e,paddings:t};return Q.runKernel(e2e,a,i)}var xB=K({spaceToBatchND_:FEe});function REe(n,e,t,r,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),r===0&&(r="valid");var s=M(n,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),G(Ho(i,a),function(){return"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'")});var l=wSe(u.shape,e,i,a,r),f=[l.dilationHeight,l.dilationWidth],h;r==="same"?h=PEe([l.filterHeight,l.filterWidth],f):h=[[0,0],[0,0]];var p=f[0]===1&&f[1]===1,d=Ne(OEe([l.inHeight,l.inWidth],f,h),2),v=d[0],m=d[1],g=p?r:"valid",y=p?u:xB(u,f,v),b=t==="avg"?function(){return eB(y,e,i,g,o)}:function(){return yB(y,e,i,g,o)},w=b(),x=p?w:tB(w,f,m);return c?ge(x,[x.shape[1],x.shape[2],x.shape[3]]):x}function OEe(n,e,t){var r=t.map(function(l){return l[0]}),a=t.map(function(l){return l[1]}),i=n.concat(r,a),o=e.map(function(l,f){return(l-i[f]%l)%l}),s=a.map(function(l,f){return l+o[f]}),u=e.map(function(l,f){return[r[f],s[f]]}),c=e.map(function(l,f){return[0,o[f]]});return[u,c]}function PEe(n,e){var t=n.map(function(o,s){return o+(o-1)*(e[s]-1)}),r=t.map(function(o){return o-1}),a=r.map(function(o){return Math.floor(o/2)}),i=r.map(function(o,s){return o-a[s]});return r.map(function(o,s){return[a[s],i[s]]})}var MEe=K({pool_:REe});function BEe(n,e){var t=M(n,"x","prelu"),r=M(e,"alpha","prelu"),a={x:t,alpha:r};return Q.runKernel(Eke,a)}var kB=K({prelu_:BEe});function LEe(n,e){e===void 0&&(e=!1),console.log(n.toString(e))}function zEe(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=M(n,"x","prod");r.dtype==="bool"&&(r=rr(r,"int32"));var a={x:r},i={axis:e,keepDims:t};return Q.runKernel(Ike,a,i)}var $Ee=K({prod_:zEe});function qEe(n,e,t,r){var a=n.map(function(l,f){return M(l,"tensors".concat(f),"raggedGather","int32")}),i=M(e,"paramsDenseValues","raggedGather"),o=M(t,"indices","raggedGather","int32"),s={paramsNestedSplits:a,paramsDenseValues:i,indices:o},u={outputRaggedRank:r},c=Q.runKernel(Cke,s,u);return{outputNestedSplits:c.slice(0,c.length-1),outputDenseValues:c[c.length-1]}}var WEe=K({raggedGather_:qEe});function VEe(n,e,t){var r=M(n,"starts","raggedRange"),a=M(e,"limits","raggedRange",r.dtype),i=M(t,"deltas","raggedRange",r.dtype),o={starts:r,limits:a,deltas:i},s=Q.runKernel(Ake,o);return{rtNestedSplits:s[0],rtDenseValues:s[1]}}var GEe=K({raggedRange_:VEe});function UEe(n,e,t,r,a){var i=M(n,"shape","raggedTensorToTensor","int32"),o=M(e,"values","raggedTensorToTensor"),s=M(t,"defaultValue","raggedTensorToTensor",o.dtype),u=r.map(function(f,h){return M(f,"tensors".concat(h),"raggedTensorToTensor","int32")}),c={shape:i,values:o,defaultValue:s,rowPartitionTensors:u},l={rowPartitionTypes:a};return Q.runKernel(_ke,c,l)}var HEe=K({raggedTensorToTensor_:UEe});function KEe(n,e,t){ga(n);var r=Fr(n),a=null;if(t==null||t==="float32")a=new Float32Array(r);else if(t==="int32")a=new Int32Array(r);else if(t==="bool")a=new Uint8Array(r);else throw new Error("Unknown data type ".concat(t));for(var i=0;i<r;i++)a[i]=e();return Q.makeTensor(a,n,t)}var jEe=K({rand_:KEe}),eu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function XEe(n){if(n.__esModule)return n;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(n).forEach(function(t){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}),e}function tu(n){var e={exports:{}};return n(e,e.exports),e.exports}var YEe=tu(function(n){(function(e,t,r){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.alea=o})(eu,n,!1)}),ZEe=tu(function(n){(function(e,t,r){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor128=o})(eu,n,!1)}),JEe=tu(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorwow=o})(eu,n,!1)}),QEe=tu(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,p;return h=l[f],h^=h>>>7,p=h^h<<24,h=l[f+1&7],p^=h^h>>>10,h=l[f+3&7],p^=h^h>>>3,h=l[f+4&7],p^=h^h<<7,h=l[f+7&7],h=h^h<<13,p^=h^h<<9,l[f]=p,u.i=f+1&7,p};function c(l,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8&&(p[7]=-1),l.x=p,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorshift7=o})(eu,n,!1)}),eIe=tu(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,p,d;return u.w=l=l+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(l^l>>>16)|0};function c(l,f){var h,p,d,v,m,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,v=-32;v<y;++v)f&&(p^=f.charCodeAt((v+32)%f.length)),v===0&&(m=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,v>=0&&(m=m+1640531527|0,h=g[v&127]^=p+m,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,v=4*128;v>0;--v)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;l.w=m,l.X=g,l.i=d}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor4096=o})(eu,n,!1)}),tIe=tu(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.tychei=o})(eu,n,!1)}),nIe={},rIe={__proto__:null,default:nIe},aIe=XEe(rIe),nu=tu(function(n){(function(e,t,r){var a=256,i=6,o=52,s="random",u=r.pow(a,i),c=r.pow(2,o),l=c*2,f=a-1,h;function p(w,x,N){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(m(x.entropy?[w,b(t)]:w??y(),3),T),C=new d(T),F=function(){for(var D=C.g(i),O=u,L=0;D<c;)D=(D+L)*a,O*=a,L=C.g(1);for(;D>=l;)D/=2,O/=2,L>>>=1;return(D+L)/O};return F.int32=function(){return C.g(4)|0},F.quick=function(){return C.g(4)/4294967296},F.double=F,g(b(C.S),t),(x.pass||N||function(D,O,L,z){return z&&(z.S&&v(z,C),D.state=function(){return v(C,{})}),L?(r[s]=D,O):D})(F,E,"global"in x?x.global:this==r,x.state)}function d(w){var x,N=w.length,T=this,E=0,C=T.i=T.j=0,F=T.S=[];for(N||(w=[N++]);E<a;)F[E]=E++;for(E=0;E<a;E++)F[E]=F[C=f&C+w[E%N]+(x=F[E])],F[C]=x;(T.g=function(D){for(var O,L=0,z=T.i,$=T.j,B=T.S;D--;)O=B[z=f&z+1],L=L*a+B[f&(B[z]=B[$=f&$+O])+(B[$]=O)];return T.i=z,T.j=$,L})(a)}function v(w,x){return x.i=w.i,x.j=w.j,x.S=w.S.slice(),x}function m(w,x){var N=[],T=typeof w,E;if(x&&T=="object")for(E in w)try{N.push(m(w[E],x-1))}catch{}return N.length?N:T=="string"?w:w+"\0"}function g(w,x){for(var N=w+"",T,E=0;E<N.length;)x[f&E]=f&(T^=x[f&E]*19)+N.charCodeAt(E++);return b(x)}function y(){try{var w;return h&&(w=h.randomBytes)?w=w(a):(w=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var x=e.navigator,N=x&&x.plugins;return[+new Date,e,N,e.screen,b(t)]}}function b(w){return String.fromCharCode.apply(0,w)}if(g(r.random(),t),n.exports){n.exports=p;try{h=aIe}catch{}}else r["seed"+s]=p})(typeof self<"u"?self:eu,[],Math)});nu.alea=YEe;nu.xor128=ZEe;nu.xorwow=JEe;nu.xorshift7=QEe;nu.xor4096=eIe;nu.tychei=tIe;var Ow=nu;var Pw=function(){function n(e,t,r,a,i){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);var o=i||Math.random();this.random=Ow.alea(o.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,r,a=!1;!a;){var i=void 0,o=void 0,s=void 0;do i=2*this.random()-1,o=2*this.random()-1,s=i*i+o*o;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*i*u,r=this.mean+this.stdDev*o*u,(!this.truncated||this.isValidTruncated(t))&&(a=!0)}return(!this.truncated||this.isValidTruncated(r))&&(this.nextVal=this.convertValue(r)),this.convertValue(t)},n.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},n.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},n}(),iIe=function(){function n(e,t,r,a){this.alpha=e,this.beta=1/t,this.dtype=r;var i=a||Math.random();this.randu=Ow.alea(i.toString()),this.randn=new Pw(0,1,r,!1,this.randu()),e<1?this.d=e+2/3:this.d=e-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var e,t,r,a,i,o;;){do a=this.randn.nextValue(),o=1+this.c*a;while(o<=0);if(o*=o*o,e=a*a,t=1-.331*e*e,r=.5*e+this.d*(1-o+Math.log(o)),i=this.randu(),i<t||Math.log(i)<r)break}return o=1/this.beta*this.d*o,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},n.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},n}(),oIe=function(){function n(e,t,r,a){e===void 0&&(e=0),t===void 0&&(t=1);var i=this;if(this.canReturnFloat=function(){return i.dtype==null||i.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=r,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(e," - ").concat(t," <= 1 and dtype is not float"));this.random=Ow.alea(a)}return n.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n}();function sIe(n,e,t,r,a){if(t===void 0&&(t=1),r===void 0&&(r="float32"),ga(n),t==null&&(t=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type ".concat(r));for(var i=new iIe(e,t,r,a),o=Go(n,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var uIe=K({randomGamma_:sIe});function cIe(n,e,t,r,a){if(e===void 0&&(e=0),t===void 0&&(t=1),ga(n),r!=null&&r==="bool")throw new Error("Unsupported data type ".concat(r));for(var i=new Pw(e,t,r,!1,a),o=Go(n,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var SB=K({randomNormal_:cIe});function lIe(n,e,t){if(e!=null&&e==="bool")throw new Error("Unsupported data type ".concat(e));return SB(n,0,1,e,t)}var fIe=K({randomStandardNormal_:lIe});function hIe(n,e,t,r,a){e===void 0&&(e=0),t===void 0&&(t=1),r===void 0&&(r="float32"),ga(n);for(var i=Go(n,r),o=new oIe(e,t,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}var NB=K({randomUniform_:hIe});function Kf(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t===0)throw new Error("Cannot have a step of zero");var a={start:n,stop:e,step:t,dtype:r};return Q.runKernel(Dke,{},a)}function pIe(n){var e=M(n,"input","real"),t={input:e};return Q.runKernel(Fke,t)}var jf=K({real_:pIe});function dIe(n){var e=M(n,"x","reciprocal"),t={x:e};return Q.runKernel(Rke,t)}var vIe=K({reciprocal_:dIe});function mIe(n){var e=M(n,"x","relu"),t={x:e};return Q.runKernel(Oke,t)}var Bv=K({relu_:mIe});function gIe(n){var e=M(n,"x","relu6"),t={x:e};return Q.runKernel(Lke,t)}var TB=K({relu6_:gIe});function yIe(n,e){var t=M(n,"x","reverse"),r={x:t},a={dims:e};return Q.runKernel(zke,r,a)}var Js=K({reverse_:yIe});function bIe(n){var e=M(n,"x","reverse");return G(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank ".concat(e.rank,".")}),Js(e,0)}var wIe=K({reverse1d_:bIe});function xIe(n,e){var t=M(n,"x","reverse");return G(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank ".concat(t.rank,".")}),Js(t,e)}var kIe=K({reverse2d_:xIe});function SIe(n,e){var t=M(n,"x","reverse");return G(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank ".concat(t.rank,".")}),Js(t,e)}var NIe=K({reverse3d_:SIe});function TIe(n,e){var t=M(n,"x","reverse");return G(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank ".concat(t.rank,".")}),Js(t,e)}var EIe=K({reverse4d_:TIe});function IIe(n){var e=M(n,"x","round"),t={x:e};return Q.runKernel($ke,t)}var EB=K({round_:IIe});function CIe(n){var e=M(n,"x","rsqrt","float32"),t={x:e};return Q.runKernel(qke,t)}var AIe=K({rsqrt_:CIe});function _Ie(n){var e=M(n,"x","selu"),t={x:e};return Q.runKernel(Uke,t)}var DIe=K({selu_:_Ie});function FIe(n,e,t,r,a,i,o){i===void 0&&(i=[1,1]),o===void 0&&(o="NHWC");var s=M(n,"x","separableConv2d"),u=M(e,"depthwiseFilter","separableConv2d"),c=M(t,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(s.rank===3&&(f=!0,l=ge(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");G(l.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(l.rank,".")}),G(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),G(c.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")}),G(c.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(c.shape[0],".")}),G(c.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(c.shape[1],".")});var h=u.shape[2],p=u.shape[3];G(c.shape[2]===h*p,function(){return"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(h*p,", ")+"but got ".concat(c.shape[2],".")});var d=Aw(l,u,r,a,o,i),v=1,m=Dv(d,c,v,"valid",o);return f?ge(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var RIe=K({separableConv2d_:FIe});function OIe(n,e){return Pt(this,void 0,void 0,function(){var t,r,a,i,o,s,l,u,c,l,f;return _t(this,function(h){switch(h.label){case 0:return t=M(n,"x","setdiff1d"),r=M(e,"y","setdiff1d"),G(t.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x (".concat(t.dtype,") and y (").concat(r.dtype,").")}),G(t.rank===1,function(){return"x should be 1D tensor, but got x (".concat(t.shape,").")}),G(r.rank===1,function(){return"y should be 1D tensor, but got y (".concat(r.shape,").")}),[4,t.data()];case 1:return a=h.sent(),[4,r.data()];case 2:for(i=h.sent(),o=new Set(i),s=0,l=0;l<a.length;l++)o.has(a[l])||s++;for(u=new iw([s],t.dtype),c=new iw([s],"int32"),l=0,f=0;l<a.length;l++)o.has(a[l])||(u.values[f]=a[l],c.values[f]=l,f++);return[2,[u.toTensor(),c.toTensor()]]}})})}var PIe=OIe;function MIe(n){var e=M(n,"x","sign"),t={x:e};return Q.runKernel(Xke,t)}var BIe=K({sign_:MIe});function LIe(n){var e=M(n,"x","sin","float32"),t={x:e};return Q.runKernel(Kke,t)}var zIe=K({sin_:LIe});function $Ie(n){var e=M(n,"x","sinh"),t={x:e};return Q.runKernel(jke,t)}var qIe=K({sinh_:$Ie});function WIe(n,e,t){var r=M(n,"x","slice1d");return G(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")}),fn(r,[e],[t])}var VIe=K({slice1d_:WIe});function GIe(n,e,t){var r=M(n,"x","slice2d");return G(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")}),fn(r,e,t)}var UIe=K({slice2d_:GIe});function HIe(n,e,t){var r=M(n,"x","slice3d");return G(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")}),fn(r,e,t)}var KIe=K({slice3d_:HIe});function jIe(n,e,t){var r=M(n,"x","slice4d");return G(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")}),fn(r,e,t)}var XIe=K({slice4d_:jIe});function YIe(n,e){e===void 0&&(e=-1);var t=M(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(t.rank," and dim was ").concat(e));var r={logits:t},a={dim:e};return Q.runKernel(n2e,r,a)}var ZIe=K({softmax_:YIe});function JIe(n){G(n.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(n.dtype,".")});var e={input:n};return Q.runKernel(Rxe,e)}var Mw=K({fft_:JIe});function QIe(n){G(n.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(n.dtype,".")});var e={input:n};return Q.runKernel(Vxe,e)}var Iv=K({ifft_:QIe});function eCe(n){var e=n.shape[n.shape.length-1],t=n.size/e,r;if(e<=2){var a=ge(n,[t,e]);r=Iv(a)}else{var i=[t,2*(e-1)],o=ge(jf(n),[t,e]),s=ge(Mv(n),[t,e]),u=Js(fn(o,[0,1],[t,e-2]),1),c=mt(Js(fn(s,[0,1],[t,e-2]),1),bn(-1)),l=Qr([o,u],1),f=Qr([s,c],1),a=ge(Ys(l,f),[i[0],i[1]]);r=Iv(a)}if(r=jf(r),n.rank===3&&n.shape[0]!==0){var h=r,p=n.shape[0];r=ge(r,[p,r.shape[0]/p,r.shape[1]]),h.dispose()}return r}var IB=K({irfft_:eCe});function tCe(n,e,t){t===void 0&&(t=0);var r=M(n,"x","split"),a={x:r},i={numOrSizeSplits:e,axis:t};return Q.runKernel(t2e,a,i)}var Xf=K({split_:tCe});function nCe(n,e){G(n.dtype==="float32",function(){return"The dtype for rfft() must be real value but got ".concat(n.dtype)});var t=n.shape[n.shape.length-1],r=n.size/t,a;if(e!=null&&e<t){var i=n.shape.map(function(g){return 0}),o=n.shape.map(function(g){return g});o[n.shape.length-1]=e,a=fn(n,i,o),t=e}else if(e!=null&&e>t){var s=n.shape.map(function(g){return g});s[n.shape.length-1]=e-t,a=Qr([n,Tc(s)],n.shape.length-1),t=e}else a=n;var u=_w(a),c=ge(Ys(a,u),[r,t]),l=Mw(c),f=Math.floor(t/2)+1,h=jf(l),p=Mv(l),d=Xf(h,[f,t-f],h.shape.length-1),v=Xf(p,[f,t-f],p.shape.length-1),m=a.shape.slice();return m[a.shape.length-1]=f,ge(Ys(d[0],v[0]),m)}var Bw=K({rfft_:nCe});function rCe(n,e){var t,r=M(n,"a","squaredDifference"),a=M(e,"b","squaredDifference");t=Ne(Cn(r,a),2),r=t[0],a=t[1],Xn(r.shape,a.shape);var i={a:r,b:a},o={};return Q.runKernel(u2e,i,o)}var CB=K({squaredDifference_:rCe});function aCe(n,e){var t=M(n,"x","squeeze","string_or_numeric");return ge(t,Nwe(t.shape,e).newShape)}var Lw=K({squeeze_:aCe});function iCe(n,e){e===void 0&&(e=0);var t=kv(n,"tensors","stack","string_or_numeric");G(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length>0&&G(e<=t[0].rank,function(){return"Axis must be <= rank of the tensor"});var r=t,a={axis:e};return Q.runKernel(Ske,r,a)}var Yf=K({stack_:iCe});function oCe(n,e){e===void 0&&(e=0);var t=M(n,"x","step"),r={x:t},a={alpha:e};return Q.runKernel(k2e,r,a)}var AB=K({step_:oCe});function sCe(n,e,t,r,a,i,o,s,u){a===void 0&&(a=0),i===void 0&&(i=0),o===void 0&&(o=0),s===void 0&&(s=0),u===void 0&&(u=0);var c=M(n,"x","stridedSlice","string_or_numeric"),l={x:c},f={begin:e,end:t,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return Q.runKernel(c2e,l,f)}var uCe=K({stridedSlice_:sCe});function cCe(n){var e=M(n,"x","tan","float32"),t={x:e};return Q.runKernel(d2e,t)}var lCe=K({tan_:cCe});function zw(n,e,t){var r=Uo(n,t);return Ko(n,e,r,t)}function yi(n,e){Ec(n);var t=Uo(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");var r=null;return Ko(n,r,t,e)}function Wf(n,e,t){if(Ec(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=Uo(n,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Ko(n,e,r,t)}function fCe(n,e,t){if(Ec(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=Uo(n,t);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Ko(n,e,r,t)}function hCe(n,e,t){if(Ec(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=Uo(n,t);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Ko(n,e,r,t)}function pCe(n,e,t){if(Ec(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=Uo(n,t);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Ko(n,e,r,t)}function dCe(n,e,t){if(Ec(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=Uo(n,t);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return e=e||r,Ko(n,e,r,t)}function vCe(n,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var r=M(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(e<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(e));if(e>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") ")+"but got ".concat(e));var i={x:r},o={k:e,sorted:t},s=Ne(Q.runKernel(m2e,i,o),2),u=s[0],c=s[1];return{values:u,indices:c}}var mCe=K({topk_:vCe});function gCe(n,e,t,r,a){if(e===void 0&&(e=0),t===void 0&&(t=1),ga(n),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");for(var i=new Pw(e,t,r,!0,a),o=Go(n,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}var yCe=K({truncatedNormal_:gCe});function bCe(n,e){e===void 0&&(e=0);var t=M(n,"x","unique","string_or_numeric");G(t.rank>0,function(){return"The input tensor must be at least 1D"});var r={x:t},a={axis:e},i=Ne(Q.runKernel(y2e,r,a),2),o=i[0],s=i[1];return{values:o,indices:s}}var wCe=K({unique_:bCe});function xCe(n,e,t){var r=M(n,"x","unsortedSegmentSum"),a=M(e,"segmentIds","unsortedSegmentSum","int32");G(Vf(t),function(){return"numSegments must be of dtype int"});var i={x:r,segmentIds:a},o={numSegments:t};return Q.runKernel(w2e,i,o)}var kCe=K({unsortedSegmentSum_:xCe});function SCe(n,e){e===void 0&&(e=0);var t=M(n,"x","unstack","string_or_numeric");G(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = ".concat(e," is not in [-").concat(t.shape.length,", ").concat(t.shape.length,")")});var r={value:t},a={axis:e};return Q.runKernel(b2e,r,a)}var $w=K({unstack_:SCe});function NCe(n,e){return Rw(n,e,"right")}function TCe(n,e,t,r){return e===void 0&&(e=!0),Q.makeVariable(n,e,t,r)}function ECe(n,e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(r);for(var a=Go(n,"int32"),i=Go([t.length,n.length],"int32"),r=0;r<t.length;r++){var o=a.indexToLoc(t[r]),s=r*n.length;i.values.set(o,s)}return i.toTensor()}function ICe(n){return Pt(this,void 0,void 0,function(){var e,t,r;return _t(this,function(a){switch(a.label){case 0:return e=M(n,"condition","whereAsync","bool"),[4,e.data()];case 1:return t=a.sent(),r=ECe(e.shape,t),n!==e&&e.dispose(),[2,r]}})})}var _B=ICe;function CCe(n,e,t){return Pt(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f,h,p,d,v;return _t(this,function(m){switch(m.label){case 0:for(r=M(n,"tensor","boolMask"),a=M(e,"mask","boolMask","bool"),i=t??0,o=a.rank,s=r.shape,G(o>0,function(){return"mask cannot be scalar"}),Ua(s.slice(i,i+o),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=i;c<i+o;c++)u*=s[c];return l=s.slice(0,i).concat([u],s.slice(i+o)),f=ge(r,l),h=ge(a,[-1]),[4,_B(h)];case 1:return p=m.sent(),d=Lw(p,[1]),v=lB(f,d,i),n!==r&&r.dispose(),e!==a&&a.dispose(),d.dispose(),f.dispose(),h.dispose(),p.dispose(),[2,v]}})})}var ACe=CCe;function _Ce(n,e){return Q.tidy(n,e)}function DCe(n){var e=Y4(n);e.forEach(function(t){return t.dispose()})}function FCe(n,e,t){var r=M(n,"x","transpose");if(e==null&&(e=r.shape.map(function(o,s){return s}).reverse()),G(r.rank===e.length,function(){return"Error in transpose: rank of input ".concat(r.rank," ")+"must match length of perm ".concat(e,".")}),e.forEach(function(o){G(o>=0&&o<r.rank,function(){return"All entries in 'perm' must be between 0 and ".concat(r.rank-1)+" but got ".concat(e)})}),r.rank<=1)return r.clone();var a={x:r},i={perm:e};return r.dtype==="complex64"?_Ce(function(){var o=jf(r),s=Mv(r);return o=Q.runKernel(q1,{x:o},i),s=Q.runKernel(q1,{x:s},i),t&&(s=io(s)),Ys(o,s)}):Q.runKernel(q1,a,i)}var vw=K({transpose_:FCe});function RCe(n,e,t,r,a){a===void 0&&(a=!0);var i=M(n,"v","movingAverage"),o=M(e,"x","movingAverage"),s=M(t,"decay","movingAverage");W2e(i,o),G(Ic(i.shape,o.shape),function(){return"Shape mismatch in v and x"});var u=bn(1),c=It(u,s),l=mt(It(o,i),c);if(a){G(r!=null,function(){return"When using zeroDebias: true, step is required."});var f=M(r,"step","movingAverage");l=yr(l,It(u,Dw(s,f)))}return jn(i,l)}var OCe=K({movingAverage_:RCe});function PCe(n,e,t){var r=e.rank>1?e.shape[e.rank-1]:1,a=e.rank>1?e.rank-1:1,i="Must have updates.shape = indices.shape[:batchDim] + "+"shape[sliceDim:], got updates.shape: ".concat(t.shape)+", indices.shape: ".concat(e.shape,", shape: ").concat(n)+", sliceDim: ".concat(r,", and batchDim: ").concat(a,".");if(t.rank<a)throw new Error(i+" update.rank < ".concat(a,". "));if(n.length<r+(t.rank-a))throw new Error(i+" Output shape length < ".concat(r+(t.rank-a)));if(t.rank!==a+n.length-r)throw new Error(i+" update.rank != ".concat(a+n.length-r));for(var o=0;o<a;++o)if(t.shape[o]!==e.shape[o])throw new Error(i+" updates.shape[".concat(o,"] (").concat(t.shape[o],") != indices.shape[").concat(o,"] (").concat(e.shape[o],")."));for(var o=0;o<t.rank-a;++o)if(t.shape[o+a]!==n[o+r])throw new Error(i+" updates.shape[".concat(o+a,"] (").concat(t.shape[o+a],") != shape[").concat(o+a,"] (").concat(n[o+a],")"))}function MCe(n,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(e.rank,"."));if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher,"+" but the rank was ".concat(n.rank,"."));if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(e.dtype));if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(t));if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: ".concat(e.shape));if(n.size===0)throw new Error("Updates specified for empty output. updates shape: ".concat(n.shape))}PCe(t,e,n)}function BCe(n,e,t){ga(t);var r=M(n,"indices","scatterND","int32"),a=M(e,"updates","scatterND");MCe(a,r,t);var i={indices:r,updates:a},o={shape:t};return Q.runKernel(Wke,i,o)}var LCe=K({scatterND_:BCe});function zCe(n,e,t,r){if(n.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type,"+" but the dtype was ".concat(n.dtype,"."));if(n.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix,"+" but got shape ".concat(n.shape,"."));var a=n.rank>0?n.shape[0]:1,i=n.rank>1?n.shape[1]:1;if(t.length!==i)throw new Error("outputShape has incorrect number of elements:,"+" ".concat(t.length,", should be: ").concat(i,"."));var o=e.size;if(!(e.rank===0||e.rank===1&&o===a))throw new Error("sparseValues has incorrect shape "+"".concat(e.shape,", should be [] or [").concat(a,"]"));if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}function $Ce(n,e,t,r){r===void 0&&(r=0),ga(t);var a=M(n,"sparseIndices","sparseToDense","int32"),i=M(e,"sparseValues","sparseToDense","string_or_numeric"),o=M(r,"defaultValue","sparseToDense",i.dtype);zCe(a,i,t,o);var s={sparseIndices:a,sparseValues:i,defaultValue:o},u={outputShape:t};return Q.runKernel(s2e,s,u)}var qCe=K({sparseToDense_:$Ce});function WCe(n,e){var t=M(e,"indices","gatherND","int32"),r=M(n,"x","gatherND","string_or_numeric"),a={params:r,indices:t};return Q.runKernel($xe,a)}var VCe=K({gatherND_:WCe});function GCe(n,e){if(e==null)return n.shape.slice();if(Ic(n.shape,e))return e;if(n.shape.length===e.length){for(var t=[],r=0;r<n.shape.length;r++)e[r]==null&&n.shape[r]!=null?t.push(n.shape[r]):t.push(e[r]);return t}return e}function UCe(n,e,t,r){var a=M(n,"x","dropout");if(G(a.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(a.dtype," tensor instead.")}),G(e>=0&&e<1,function(){return"rate must be a float in the range [0, 1), but got ".concat(e,".")}),e===0)return n instanceof _r?a.clone():a;var i=GCe(a,t),o=1-e,s=yr(cB(jn(NB(i,0,1,"float32",r),o)),o);return mt(a,s)}var HCe=K({dropout_:UCe});function DB(n){return Math.floor(Math.pow(2,Math.ceil(Math.log(n)/Math.log(2))))}function qw(n,e,t){for(var r=1-n%2,a=new Float32Array(n),i=0;i<n;++i){var o=2*Math.PI*i/(n+r-1);a[i]=e-t*Math.cos(o)}return yi(a,"float32")}function KCe(n,e,t){return t===void 0&&(t=1),Pt(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f,h,p,d,v,m,m;return _t(this,function(g){switch(g.label){case 0:return r=M(n,"predictions","inTopK"),a=M(e,"targets","inTopK"),G(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, "+"but got ".concat(r.rank)}),G(r.rank-1===a.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+"".concat(r.rank," and targets rank ").concat(a.rank)}),Ua(r.shape.slice(0,r.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],G(t>0&&t<=i,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last "+"dimension (".concat(i,"), but got ").concat(t)}),[4,r.data()];case 1:return o=g.sent(),[4,a.data()];case 2:for(s=g.sent(),u=Ne([o.length/i,i],2),c=u[0],l=u[1],f=Twe("bool",c),h=0;h<c;h++){for(p=h*l,d=o.subarray(p,p+l),v=[],m=0;m<d.length;m++)v.push({value:d[m],index:m});for(v.sort(function(y,b){return b.value-y.value}),f[h]=0,m=0;m<t;m++)if(v[m].index===s[h]){f[h]=1;break}}return n!==r&&r.dispose(),e!==a&&a.dispose(),[2,zw(f,a.shape,"bool")]}})})}var jCe=KCe;function XCe(n,e,t,r,a,i,o){i===void 0&&(i="NHWC");var s=n;n.rank===3&&(s=ge(n,[1,n.shape[0],n.shape[1],n.shape[2]]));var u=e;u.rank===3&&(u=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]])),G(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")}),G(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")}),G(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(t,".")});var c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];G(c===t[2],function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(t[2],".")}),G(l===t[3],function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(t[3],").")}),xi("conv2dDerFilter",a,o);var f={x:s,dy:u},h={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return Q.runKernel(cxe,f,h)}var YCe=K({conv2DBackpropFilter_:XCe});function Ww(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return mt(n,AB(e));throw new Error("Cannot compute gradient for fused activation ".concat(t,"."))}function Vw(n,e){var t=e,r=$Ne(n.shape,e.shape);return r.length>0&&(t=en(t,r)),ge(t,n.shape)}function Gw(n,e,t,r){if(e==="linear")return n;if(e==="relu")return Bv(n);if(e==="elu")return oB(n);if(e==="relu6")return TB(n);if(e==="prelu")return kB(n,t);if(e==="leakyrelu")return hB(n,r);if(e==="sigmoid")return bc(n);throw new Error("Unknown fused activation ".concat(e,"."))}var Uw=function(n,e){var t=n>0;return!t||e==="linear"};function ZCe(n){var e,t=n.x,r=n.filter,a=n.strides,i=n.pad,o=n.dataFormat,s=o===void 0?"NHWC":o,u=n.dilations,c=u===void 0?[1,1]:u,l=n.dimRoundingMode,f=n.bias,h=n.activation,p=h===void 0?"linear":h,d=n.preluActivationWeights,v=n.leakyreluAlpha;if(p=p||"linear",Uw(Q.state.gradientDepth,p)===!1){G(s==="NHWC",function(){return"Error in fused conv2d: got dataFormat of ".concat(s," but ")+"only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."});var m=Dv(t,r,a,i,s,c,l);return f!=null&&(m=jn(m,f)),Gw(m,p,d,v)}var g=M(t,"x","conv2d","float32"),y=M(r,"filter","conv2d","float32"),b=g,w=!1;g.rank===3&&(w=!0,b=ge(g,[1,g.shape[0],g.shape[1],g.shape[2]])),G(b.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(b.rank,".")}),G(y.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(y.rank,".")}),xi("fused conv2d",i,l);var x=s==="NHWC"?b.shape[3]:b.shape[1];G(y.shape[2]===x,function(){return"Error in conv2d: depth of input (".concat(x,") must match ")+"input depth for filter ".concat(y.shape[2],".")}),G(Ho(a,c),function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(a," and dilations '").concat(c,"'")});var N=Cw(b.shape,y.shape,a,c,i,l),T;f!=null&&(T=M(f,"bias","fused conv2d"),e=Ne(Cn(T,g),1),T=e[0],s==="NHWC"?Xn(N.outShape,T.shape):(G(T.shape.length<=1,function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+"rank-".concat(T.shape.length,".")}),G(T.shape.length===0||T.shape[0]===N.outChannels||T.shape[0]===1,function(){return"Error in fused conv2d: bias shape (".concat(T.shape,") is not ")+"compatible with the number of output channels "+"(".concat(N.outChannels,")")})));var E;if(d!=null){var C=d.shape;if(G(C.length<=1||C.length===3,function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+"rank-".concat(C.length,".")}),C.length===1)G(C[0]===1||C[0]===N.outChannels,function(){return"Error in fused conv2d: PReLU activation weights "+"(".concat(C,") is not compatible with the number of output ")+"channels (".concat(N.outChannels,").")});else if(C.length===3)try{Xn(C,N.outShape)}catch{var F="Error in fused conv2d: PReLU activation weights (".concat(C,") ")+"is not compatible with the output shape of the conv2d "+"(".concat(N.outShape,").");throw Error(F)}E=M(d,"prelu weights","fused conv2d")}var D=function(B,W){G(s==="NHWC",function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(s," but only NHWC is currently supported.")});var X=Ne(W,4),Y=X[0],V=X[1],j=X[2],re=X[3],ne=Ww(B,j,p);G(Nv(c),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(c,"'")});var oe=rB(V.shape,ne,Y,a,i),le=YCe(V,ne,Y.shape,a,i),de=[oe,le];if(re!=null){var xe=Vw(re,ne);de.push(xe)}return de},O={x:b,filter:y,bias:T,preluActivationWeights:E},L={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:p,leakyreluAlpha:v};if(f==null){var z=oo(function(B,W,X){var Y=Q.runKernel(c4,O,L);return X([W,B,Y]),w&&(Y=ge(Y,[Y.shape[1],Y.shape[2],Y.shape[3]])),{value:Y,gradFunc:D}});return z(b,y)}else{var $=oo(function(B,W,X,Y){var V=Q.runKernel(c4,O,L);return Y([W,B,V,X]),w&&(V=ge(V,[V.shape[1],V.shape[2],V.shape[3]])),{value:V,gradFunc:D}});return $(b,y,T)}}var JCe=K({fusedConv2d_:ZCe});function QCe(n,e,t,r,a,i,o){i===void 0&&(i=[1,1]);var s=n;n.rank===3&&(s=ge(n,[1,n.shape[0],n.shape[1],n.shape[2]]));var u=e;u.rank===3&&(u=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={x:s,dy:u},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return Q.runKernel(xxe,c,l)}var eAe=K({depthwiseConv2dNativeBackpropFilter_:QCe});function tAe(n,e,t,r,a,i,o){i===void 0&&(i=[1,1]);var s=e,u=!1;e.rank===3&&(u=!0,s=ge(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var c={dy:s,filter:t},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:n},f=Q.runKernel(kxe,c,l);return u?ge(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var nAe=K({depthwiseConv2dNativeBackpropInput_:tAe});function rAe(n){var e,t=n.x,r=n.filter,a=n.strides,i=n.pad,o=n.dataFormat,s=o===void 0?"NHWC":o,u=n.dilations,c=u===void 0?[1,1]:u,l=n.dimRoundingMode,f=n.bias,h=n.activation,p=h===void 0?"linear":h,d=n.preluActivationWeights,v=n.leakyreluAlpha;if(Uw(Q.state.gradientDepth,p)===!1){var m=Aw(t,r,a,i,s,c,l);return f!=null&&(m=jn(m,f)),Gw(m,p,d,v)}var g=M(t,"x","depthwiseConv2d","float32"),y=M(r,"filter","depthwiseConv2d","float32"),b=g,w=!1;g.rank===3&&(w=!0,b=ge(g,[1,g.shape[0],g.shape[1],g.shape[2]])),G(b.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(b.rank,".")}),G(y.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+"but got rank ".concat(y.rank,".")}),G(b.shape[3]===y.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels "+"(".concat(b.shape[3],") must match the inChannels dimension in ")+"filter ".concat(y.shape[2],".")}),c==null&&(c=[1,1]),G(Ho(a,c),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+"be 1. Got strides ".concat(a," and dilations '").concat(c,"'")}),xi("fused depthwiseConv2d",i,l);var x=Cw(b.shape,y.shape,a,c,i,l,!0),N;f!=null&&(N=M(f,"bias","fused conv2d"),e=Ne(Cn(N,g),1),N=e[0],Xn(x.outShape,N.shape));var T;d!=null&&(T=M(d,"prelu weights","fused depthwiseConv2d"));var E=function(L,z){G(Nv(c),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(c,"'")});var $=Ne(z,4),B=$[0],W=$[1],X=$[2],Y=$[3],V=Ww(L,X,p),j=nAe(W.shape,V,B,a,i,c,l),re=eAe(W,V,B.shape,a,i,c,l);if(Y!=null){var ne=Vw(N,V);return[j,re,ne]}return[j,re]},C={x:b,filter:y,bias:N,preluActivationWeights:T},F={strides:a,pad:i,dataFormat:s,dilations:c,dimRoundingMode:l,activation:p,leakyreluAlpha:v};if(f==null){var D=oo(function(L,z,$){var B=Q.runKernel(l4,C,F);return $([z,L,B]),w&&(B=ge(B,[B.shape[1],B.shape[2],B.shape[3]])),{value:B,gradFunc:E}});return D(b,y)}else{var O=oo(function(L,z,$,B){var W=Q.runKernel(l4,C,F);return B([z,L,W,$]),w&&(W=ge(W,[W.shape[1],W.shape[2],W.shape[3]])),{value:W,gradFunc:E}});return O(b,y,N)}}var aAe=K({fusedDepthwiseConv2d_:rAe});function iAe(n){var e,t,r=n.a,a=n.b,i=n.transposeA,o=i===void 0?!1:i,s=n.transposeB,u=s===void 0?!1:s,c=n.bias,l=n.activation,f=l===void 0?"linear":l,h=n.preluActivationWeights,p=n.leakyreluAlpha,d=p===void 0?.2:p;if(Uw(Q.state.gradientDepth,f)===!1){var v=Bt(r,a,o,u);return c!=null&&(v=jn(v,c)),Gw(v,f,h,d)}var m=M(r,"a","fused matMul"),g=M(a,"b","fused matMul");e=Ne(Cn(m,g),2),m=e[0],g=e[1];var y=o?m.shape[m.rank-2]:m.shape[m.rank-1],b=u?g.shape[g.rank-1]:g.shape[g.rank-2],w=o?m.shape[m.rank-1]:m.shape[m.rank-2],x=u?g.shape[g.rank-2]:g.shape[g.rank-1],N=m.shape.slice(0,-2),T=g.shape.slice(0,-2),E=Fr(N),C=Fr(T);G(y===b,function(){return"Error in fused matMul: inner shapes (".concat(y,") and (")+"".concat(b,") of Tensors with shapes ").concat(m.shape," and ")+"".concat(g.shape," and transposeA=").concat(o)+" and transposeB=".concat(u," must match.")});var F=Xn(m.shape.slice(0,-2),g.shape.slice(0,-2)),D=F.concat([w,x]),O=o?ge(m,[E,y,w]):ge(m,[E,w,y]),L=u?ge(g,[C,x,b]):ge(g,[C,b,x]),z;c!=null&&(z=M(c,"bias","fused matMul"),t=Ne(Cn(z,m),1),z=t[0],Xn(D,z.shape));var $;h!=null&&($=M(h,"prelu weights","fused matMul"));var B=function(j,re){var ne=Ne(re,4),oe=ne[0],le=ne[1],de=ne[2],xe=ne[3],he=Ww(ge(j,de.shape),de,f),ye,we;if(!o&&!u?(ye=Bt(he,le,!1,!0),we=Bt(oe,he,!0,!1)):!o&&u?(ye=Bt(he,le,!1,!1),we=Bt(he,oe,!0,!1)):o&&!u?(ye=Bt(le,he,!1,!0),we=Bt(oe,he,!1,!1)):(ye=Bt(le,he,!0,!0),we=Bt(he,oe,!0,!0)),c!=null){var Ae=Vw(xe,he);return[ye,we,Ae]}else return[ye,we]},W={a:O,b:L,bias:z,preluActivationWeights:$},X={transposeA:o,transposeB:u,activation:f,leakyreluAlpha:d};if(c==null){var Y=oo(function(j,re,ne){var oe=Q.runKernel(u4,W,X);return ne([j,re,oe]),{value:ge(oe,D),gradFunc:B}});return Y(O,L)}else{var V=oo(function(j,re,ne,oe){var le=Q.runKernel(u4,W,X);return oe([j,re,le,ne]),{value:ge(le,D),gradFunc:B}});return V(O,L,z)}}var oAe=K({fusedMatMul_:iAe});var sAe={__proto__:null,conv2d:JCe,depthwiseConv2d:aAe,matMul:oAe};function uAe(n){return qw(n,.54,.46)}var cAe=K({hammingWindow_:uAe});function lAe(n){return qw(n,.5,.5)}var FB=K({hannWindow_:lAe});function fAe(n,e,t,r,a){r===void 0&&(r=!1),a===void 0&&(a=0);for(var i=0,o=[];i+e<=n.size;)o.push(fn(n,i,e)),i+=t;if(r)for(;i<n.size;){var s=i+e-n.size,u=Qr([fn(n,i,e-s),_v([s],a)]);o.push(u),i+=t}return o.length===0?Wf([],[0,e]):ge(Qr(o),[o.length,e])}var RB=K({frame_:fAe});function hAe(n,e,t,r,a){a===void 0&&(a=FB),r==null&&(r=DB(e));var i=RB(n,e,t),o=mt(i,a(e));return Bw(o,r)}var pAe=K({stft_:hAe});function dAe(n,e,t,r,a,i){a===void 0&&(a="bilinear"),i===void 0&&(i=0);var o=M(n,"image","cropAndResize"),s=M(e,"boxes","cropAndResize","float32"),u=M(t,"boxInd","cropAndResize","int32"),c=s.shape[0];G(o.rank===4,function(){return"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),G(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] ")+"but had shape ".concat(s.shape,".")}),G(u.rank===1&&u.shape[0]===c,function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] ")+"but had shape ".concat(s.shape,".")}),G(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(r.length,".")}),G(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was ".concat(r)}),G(a==="bilinear"||a==="nearest",function(){return"method must be bilinear or nearest, but was ".concat(a)});var l={image:o,boxes:s,boxInd:u},f={method:a,extrapolationValue:i,cropSize:r},h=Q.runKernel(gxe,l,f);return h}var vAe=K({cropAndResize_:dAe});function mAe(n){var e=M(n,"image","flipLeftRight","float32");G(e.rank===4,function(){return"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(e.rank,".")});var t={image:e},r=Q.runKernel(Pxe,t,{});return r}var gAe=K({flipLeftRight_:mAe});function yAe(n){var e=M(n,"image","grayscaleToRGB"),t=e.rank-1,r=e.shape[t];G(e.rank>=2,function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(e.rank,".")}),G(r===1,function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(r,".")});var a=new Array(e.rank);return a.fill(1,0,t),a[t]=3,qf(e,a)}var bAe=K({grayscaleToRGB_:yAe});function wAe(n,e,t,r){t===void 0&&(t=0),r===void 0&&(r=.5);var a=M(n,"image","rotateWithOffset","float32");G(a.rank===4,function(){return"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,".")});var i={image:a},o={radians:e,fillValue:t,center:r},s=Q.runKernel(S2e,i,o);return s}var xAe=K({rotateWithOffset_:wAe});function Cc(n,e,t,r,a,i){r==null&&(r=.5),a==null&&(a=Number.NEGATIVE_INFINITY),i==null&&(i=0);var o=n.shape[0];return t=Math.min(t,o),G(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")}),G(n.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '".concat(n.rank,"'")}),G(n.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(n.shape[1])}),G(e.rank===1,function(){return"scores must be a 1D tensor"}),G(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(e.shape[0])}),G(0<=i&&i<=1,function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")}),{maxOutputSize:t,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}function kAe(n,e,t,r,a){r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var i=M(n,"boxes","nonMaxSuppression","float32"),o=M(e,"scores","nonMaxSuppression","float32"),s=Cc(i,o,t,r,a);t=s.maxOutputSize,r=s.iouThreshold,a=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:r,scoreThreshold:a};return Q.runKernel(yke,{boxes:i,scores:o},u)}var SAe=K({nonMaxSuppression_:kAe});function NAe(n,e,t){var r=TAe(n,e,t),a=r<0?-(r+1):r;n.splice(a,0,e)}function TAe(n,e,t){return IAe(n,e,t||EAe)}function EAe(n,e){return n>e?1:n<e?-1:0}function IAe(n,e,t){for(var r=0,a=n.length,i=0,o=!1;r<a;){i=r+(a-r>>>1);var s=t(e,n[i]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}function CAe(n,e,t,r,a){return Hw(n,e,t,r,a,0)}function AAe(n,e,t,r,a,i){return Hw(n,e,t,r,a,0,!1,i,!0)}function _Ae(n,e,t,r,a,i){return Hw(n,e,t,r,a,i,!0)}function Hw(n,e,t,r,a,i,o,s,u){o===void 0&&(o=!1),s===void 0&&(s=!1),u===void 0&&(u=!1);for(var c=[],l=0;l<e.length;l++)e[l]>a&&c.push({score:e[l],boxIndex:l,suppressBeginIndex:0});c.sort(N4);for(var f=i>0?-.5/i:0,h=[],p=[];h.length<t&&c.length>0;){var d=c.pop(),v=d.score,m=d.boxIndex,g=d.suppressBeginIndex;if(v<a)break;for(var y=!1,b=h.length-1;b>=g;--b){var w=DAe(n,m,h[b]);if(w>=r){y=!0;break}if(d.score=d.score*FAe(r,f,w),d.score<=a)break}d.suppressBeginIndex=h.length,y||(d.score===v?(h.push(m),p.push(d.score)):d.score>a&&NAe(c,d,N4))}var x=h.length,N=t-x;s&&N>0&&(h.push.apply(h,yn([],Ne(new Array(N).fill(0)),!1)),p.push.apply(p,yn([],Ne(new Array(N).fill(0)),!1)));var T={selectedIndices:h};return o&&(T.selectedScores=p),u&&(T.validOutputs=x),T}function DAe(n,e,t){var r=n.subarray(e*4,e*4+4),a=n.subarray(t*4,t*4+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),f=Math.max(a[0],a[2]),h=Math.max(a[1],a[3]),p=(s-i)*(u-o),d=(f-c)*(h-l);if(p<=0||d<=0)return 0;var v=Math.max(i,c),m=Math.max(o,l),g=Math.min(s,f),y=Math.min(u,h),b=Math.max(g-v,0)*Math.max(y-m,0);return b/(p+d-b)}function FAe(n,e,t){var r=Math.exp(e*t*t);return t<=n?r:0}function N4(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}function RAe(n,e,t,r,a){return r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),Pt(this,void 0,void 0,function(){var i,o,s,u,c,l,f;return _t(this,function(h){switch(h.label){case 0:return i=M(n,"boxes","nonMaxSuppressionAsync"),o=M(e,"scores","nonMaxSuppressionAsync"),s=Cc(i,o,t,r,a),t=s.maxOutputSize,r=s.iouThreshold,a=s.scoreThreshold,[4,Promise.all([i.data(),o.data()])];case 1:return u=h.sent(),c=u[0],l=u[1],f=CAe(c,l,t,r,a).selectedIndices,i!==n&&i.dispose(),o!==e&&o.dispose(),[2,yi(f,"int32")]}})})}var OAe=RAe;function PAe(n,e,t,r,a,i){r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0);var o=M(n,"boxes","nonMaxSuppression"),s=M(e,"scores","nonMaxSuppression"),u=Cc(o,s,t,r,a,i);t=u.maxOutputSize,r=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma;var c={boxes:o,scores:s},l={maxOutputSize:t,iouThreshold:r,scoreThreshold:a,softNmsSigma:i},f=Q.runKernel(wke,c,l);return{selectedIndices:f[0],selectedScores:f[1]}}var MAe=K({nonMaxSuppressionWithScore_:PAe});function BAe(n,e,t,r,a,i){return r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=0),Pt(this,void 0,void 0,function(){var o,s,u,c,l,f,h,p,d;return _t(this,function(v){switch(v.label){case 0:return o=M(n,"boxes","nonMaxSuppressionAsync"),s=M(e,"scores","nonMaxSuppressionAsync"),u=Cc(o,s,t,r,a,i),t=u.maxOutputSize,r=u.iouThreshold,a=u.scoreThreshold,i=u.softNmsSigma,[4,Promise.all([o.data(),s.data()])];case 1:return c=v.sent(),l=c[0],f=c[1],h=_Ae(l,f,t,r,a,i),p=h.selectedIndices,d=h.selectedScores,o!==n&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:yi(p,"int32"),selectedScores:yi(d)}]}})})}var LAe=BAe;function zAe(n,e,t,r,a,i){r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1);var o=M(n,"boxes","nonMaxSuppression"),s=M(e,"scores","nonMaxSuppression"),u=Cc(o,s,t,r,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,h={boxes:o,scores:s},p={maxOutputSize:c,iouThreshold:l,scoreThreshold:f,padToMaxOutputSize:i},d=Q.runKernel(bke,h,p);return{selectedIndices:d[0],validOutputs:d[1]}}var $Ae=K({nonMaxSuppressionPadded_:zAe});function qAe(n,e,t,r,a,i){return r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),i===void 0&&(i=!1),Pt(this,void 0,void 0,function(){var o,s,u,c,l,f,h,p,d,v,m,g;return _t(this,function(y){switch(y.label){case 0:return o=M(n,"boxes","nonMaxSuppressionAsync"),s=M(e,"scores","nonMaxSuppressionAsync"),u=Cc(o,s,t,r,a,null),c=u.maxOutputSize,l=u.iouThreshold,f=u.scoreThreshold,[4,Promise.all([o.data(),s.data()])];case 1:return h=Ne.apply(void 0,[y.sent(),2]),p=h[0],d=h[1],v=AAe(p,d,c,l,f,i),m=v.selectedIndices,g=v.validOutputs,o!==n&&o.dispose(),s!==e&&s.dispose(),[2,{selectedIndices:yi(m,"int32"),validOutputs:bn(g,"int32")}]}})})}var WAe=qAe;function VAe(n,e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!1);var a=M(n,"images","resizeBilinear");G(a.rank===3||a.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),G(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(e,".")}),G(r===!1||t===!1,function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=ge(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Ne(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:r,size:e},c=Q.runKernel(Bke,s,u);return o?ge(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var GAe=K({resizeBilinear_:VAe});function UAe(n,e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!1);var a=M(n,"images","resizeNearestNeighbor");G(a.rank===3||a.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")}),G(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(e,".")}),G(a.dtype==="float32"||a.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"}),G(r===!1||t===!1,function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."});var i=a,o=!1;a.rank===3&&(o=!0,i=ge(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Ne(e,0);var s={images:i},u={alignCorners:t,halfPixelCenters:r,size:e},c=Q.runKernel(Mke,s,u);return o?ge(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var HAe=K({resizeNearestNeighbor_:UAe});function KAe(n,e,t,r){var a;e===void 0&&(e="binary"),t===void 0&&(t=!1),r===void 0&&(r=.5);var i=M(n,"image","threshold"),o=.2989,s=.587,u=.114,c=i.shape[0]*i.shape[1],l=mt(yi([r]),255),f,h,p,d;if(G(i.rank===3,function(){return"Error in threshold: image must be rank 3,"+"but got rank ".concat(i.rank,".")}),G(i.shape[2]===3||i.shape[2]===1,function(){return"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(i.shape[2],".")}),G(i.dtype==="int32"||i.dtype==="float32",function(){return"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(i.dtype,".")}),G(e==="otsu"||e==="binary",function(){return"Method must be binary or otsu, but was ".concat(e)}),i.shape[2]===3){a=Ne(Xf(i,[1,1,1],-1),3),f=a[0],h=a[1],p=a[2];var v=mt(f,o),m=mt(h,s),g=mt(p,u);d=jn(jn(v,m),g)}else d=n;if(e==="otsu"){var y=nB(rr(EB(d),"int32"),zw([]),256);l=jAe(y,c)}var b=t?Fw(d,l):Pv(d,l),w=rr(mt(b,255),"int32");return w}function jAe(n,e){for(var t=yi([-1]),r=yi([0]),a=yi([0]),i,o,s,u,c,l,f=0;f<n.size-1;f++){i=fn(n,0,f+1),o=fn(n,f+1),c=yr(en(i),e),l=yr(en(o),e);var h=en(mt(i,Kf(0,i.size)));s=yr(h,en(i));var p=_v(o.shape,i.size),d=jn(Kf(0,o.size),p),v=mt(o,d);u=yr(en(v),en(o));var m=It(s,u),g=It(s,u),y=mt(c,l);a=mt(mt(y,m),g);var b=Pv(a,r);r=Nc(b,a,r),t=Nc(b,yi([f]),t)}return t}var XAe=K({threshold_:KAe});function YAe(n,e,t,r,a,i){t===void 0&&(t="nearest"),r===void 0&&(r="constant"),a===void 0&&(a=0);var o=M(n,"image","transform","float32"),s=M(e,"transforms","transform","float32");G(o.rank===4,function(){return"Error in transform: image must be rank 4,"+"but got rank ".concat(o.rank,".")}),G(s.rank===2&&(s.shape[0]===o.shape[0]||s.shape[0]===1)&&s.shape[1]===8,function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"}),G(i==null||i.length===2,function(){return"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(i,".")});var u={image:o,transforms:s},c={interpolation:t,fillMode:r,fillValue:a,outputShape:i};return Q.runKernel(g2e,u,c)}var ZAe=K({transform_:YAe});function JAe(n,e,t){G(e%1===0,function(){return"bandPart(): numLower must be an integer, got ".concat(e,".")}),G(t%1===0,function(){return"bandPart(): numUpper must be an integer, got ".concat(t,".")});var r=M(n,"a","bandPart");G(r.rank>=2,function(){return"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")});var a=r.shape,i=Ne(r.shape.slice(-2),2),o=i[0],s=i[1];if(!(e<=o))throw new Error("bandPart(): numLower (".concat(e,")")+" must not be greater than the number of rows (".concat(o,")."));if(!(t<=s))throw new Error("bandPart(): numUpper (".concat(t,")")+" must not be greater than the number of columns (".concat(s,")."));e<0&&(e=o),t<0&&(t=s);var u=ge(Kf(0,o,1,"int32"),[-1,1]),c=Kf(0,s,1,"int32"),l=It(u,c),f=Tv(Fw(l,bn(+e,"int32")),fB(l,bn(-t,"int32"))),h=Tc([o,s],r.dtype);return ge(Yf($w(ge(r,[-1,o,s])).map(function(p){return Nc(f,p,h)})),a)}var QAe=K({bandPart_:JAe});function e_e(n){var e;if(Array.isArray(n)){e=!1,G(n!=null&&n.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=n[0].shape[0],r=function(u){G(n[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(n[u].shape[0]," vs. ").concat(t,")")})},a=1;a<n.length;++a)r(a)}else e=!0,n=Xf(n,n.shape[0],0).map(function(u){return Lw(u,[0])});G(n.length<=n[0].shape[0],function(){return"Gram-Schmidt: Number of vectors (".concat(n.length,") exceeds ")+"number of dimensions (".concat(n[0].shape[0],").")});for(var i=[],o=n,s=function(u){i.push(Q.tidy(function(){var c=o[u];if(u>0)for(var l=0;l<u;++l){var f=mt(en(mt(i[l],c)),i[l]);c=It(c,f)}return yr(c,Ov(c,"euclidean"))}))},a=0;a<n.length;++a)s(a);return e?Yf(i,0):i}var t_e=K({gramSchmidt_:e_e});function n_e(n,e){if(e===void 0&&(e=!1),G(n.rank>=2,function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(n.rank)}),n.rank===2)return T4(n,e);var t=n.shape.slice(0,n.shape.length-2).reduce(function(u,c){return u*c}),r=$w(ge(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),a=[],i=[];r.forEach(function(u){var c=Ne(T4(u,e),2),l=c[0],f=c[1];a.push(l),i.push(f)});var o=ge(Yf(a,0),n.shape),s=ge(Yf(i,0),n.shape);return[o,s]}function T4(n,e){return e===void 0&&(e=!1),Q.tidy(function(){G(n.shape.length===2,function(){return"qr2d() requires a 2D Tensor, but got a ".concat(n.shape.length,"D Tensor.")});for(var t=n.shape[0],r=n.shape[1],a=uB(t),i=yc(n),o=Wf([[1]],[1,1]),s=yc(o),u=t>=r?r:t,c=function(f){var h,p=i,d=s,v=a;h=Ne(Q.tidy(function(){var m=fn(i,[f,f],[t-f,1]),g=Ov(m),y=fn(i,[f,f],[1,1]),b=Nc(Pv(y,0),Wf([[-1]]),Wf([[1]])),w=It(y,mt(b,g)),x=yr(m,w);x.shape[0]===1?s=yc(o):s=Qr([o,fn(x,[1,0],[x.shape[0]-1,x.shape[1]])],0);var N=io(yr(Bt(b,w),g)),T=fn(i,[f,0],[t-f,r]),E=mt(N,s),C=vw(s);if(f===0)i=It(T,Bt(E,Bt(C,T)));else{var F=It(T,Bt(E,Bt(C,T)));i=Qr([fn(i,[0,0],[f,r]),F],0)}var D=vw(E),O=fn(a,[0,f],[t,a.shape[1]-f]);if(f===0)a=It(O,Bt(Bt(O,s),D));else{var L=It(O,Bt(Bt(O,s),D));a=Qr([fn(a,[0,0],[t,f]),L],1)}return[s,i,a]}),3),s=h[0],i=h[1],a=h[2],DCe([p,d,v])},l=0;l<u;++l)c(l);return!e&&t>r&&(a=fn(a,[0,0],[t,r]),i=fn(i,[0,0],[r,r])),[a,i]})}var r_e=K({qr_:n_e});var Dr;(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Dr||(Dr={}));function a_e(n,e,t){t===void 0&&(t=Dr.SUM_BY_NONZERO_WEIGHTS);var r=M(n,"losses","computeWeightedLoss"),a=null;e!=null&&(a=M(e,"weights","computeWeightedLoss"));var i=a==null?r:mt(r,a);if(t===Dr.NONE)return i;if(t===Dr.SUM)return en(i);if(t===Dr.MEAN){if(a==null)return Ev(i);var o=r.size/a.size,s=yr(en(i),en(a));return o>1?yr(s,bn(o)):s}if(t===Dr.SUM_BY_NONZERO_WEIGHTS){if(a==null)return yr(en(i),bn(r.size));var u=mt(a,Xs(r.shape)),c=rr(en(wB(u,bn(0))),"float32");return yr(en(i),c)}throw Error("Unknown reduction: ".concat(t))}var so=K({computeWeightedLoss_:a_e});function i_e(n,e,t,r){r===void 0&&(r=Dr.SUM_BY_NONZERO_WEIGHTS);var a=M(n,"labels","absoluteDifference"),i=M(e,"predictions","absoluteDifference"),o=null;t!=null&&(o=M(t,"weights","absoluteDifference")),Ua(a.shape,i.shape,"Error in absoluteDifference: ");var s=$a(It(a,i));return so(s,o,r)}var o_e=K({absoluteDifference_:i_e});function s_e(n,e,t,r,a){a===void 0&&(a=Dr.SUM_BY_NONZERO_WEIGHTS);var i=M(n,"labels","cosineDistance"),o=M(e,"predictions","cosineDistance"),s=null;r!=null&&(s=M(r,"weights","cosineDistance")),Ua(i.shape,o.shape,"Error in cosineDistance: ");var u=bn(1),c=It(u,en(mt(i,o),t,!0));return so(c,s,a)}var u_e=K({cosineDistance_:s_e});function c_e(n,e,t,r){r===void 0&&(r=Dr.SUM_BY_NONZERO_WEIGHTS);var a=M(n,"labels","hingeLoss"),i=M(e,"predictions","hingeLoss"),o=null;t!=null&&(o=M(t,"weights","hingeLoss")),Ua(a.shape,i.shape,"Error in hingeLoss: ");var s=bn(1);a=It(mt(bn(2),a),s);var u=Bv(It(s,mt(a,i)));return so(u,o,r)}var l_e=K({hingeLoss_:c_e});function f_e(n,e,t,r,a){r===void 0&&(r=1),a===void 0&&(a=Dr.SUM_BY_NONZERO_WEIGHTS);var i=M(n,"labels","huberLoss"),o=M(e,"predictions","huberLoss"),s=null;t!=null&&(s=M(t,"weights","huberLoss")),Ua(i.shape,o.shape,"Error in huberLoss: ");var u=bn(r),c=$a(It(o,i)),l=bB(c,u),f=It(c,l),h=jn(mt(bn(.5),Rv(l)),mt(u,f));return so(h,s,a)}var h_e=K({huberLoss_:f_e});function p_e(n,e,t,r,a){r===void 0&&(r=1e-7),a===void 0&&(a=Dr.SUM_BY_NONZERO_WEIGHTS);var i=M(n,"labels","logLoss"),o=M(e,"predictions","logLoss"),s=null;t!=null&&(s=M(t,"weights","logLoss")),Ua(i.shape,o.shape,"Error in logLoss: ");var u=bn(1),c=bn(r),l=io(mt(i,Hf(jn(o,c)))),f=mt(It(u,i),Hf(jn(It(u,o),c))),h=It(l,f);return so(h,s,a)}var d_e=K({logLoss_:p_e});function v_e(n,e,t,r){r===void 0&&(r=Dr.SUM_BY_NONZERO_WEIGHTS);var a=M(n,"labels","meanSquaredError"),i=M(e,"predictions","meanSquaredError"),o=null;t!=null&&(o=M(t,"weights","meanSquaredError")),Ua(a.shape,i.shape,"Error in meanSquaredError: ");var s=CB(a,i);return so(s,o,r)}var m_e=K({meanSquaredError_:v_e});function g_e(n,e){var t=M(n,"labels","sigmoidCrossEntropyWithLogits"),r=M(e,"logits","sigmoidCrossEntropyWithLogits");Ua(t.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=Bv(r),i=mt(r,t),o=pB(Zs(io($a(r))));return jn(It(a,i),o)}function y_e(n,e,t,r,a){r===void 0&&(r=0),a===void 0&&(a=Dr.SUM_BY_NONZERO_WEIGHTS);var i=M(n,"multiClassLabels","sigmoidCrossEntropy"),o=M(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=M(t,"weights","sigmoidCrossEntropy")),Ua(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=bn(r),c=bn(1),l=bn(.5);i=jn(mt(i,It(c,u)),mt(l,u))}var f=g_e(i,o);return so(f,s,a)}var b_e=K({sigmoidCrossEntropy_:y_e});function w_e(n,e,t){if(t===void 0&&(t=-1),t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(e.rank," ")+"and dim was ".concat(t));var r=oo(function(a,i,o){var s=!0,u=vB(i,[t],s),c=It(rr(i,"float32"),u);o([a,c]);var l=io(mt(c,a)),f=en(l,[t]),h=function(p,d){var v=Ne(d,2),m=v[0],g=v[1],y=Fv(p.shape,[t]);return[mt(ge(p,y),It(rr(m,"float32"),Zs(g))),mt(ge(p,y),It(Zs(g),rr(m,"float32")))]};return{value:f,gradFunc:h}});return r(n,e)}function x_e(n,e,t,r,a){r===void 0&&(r=0),a===void 0&&(a=Dr.SUM_BY_NONZERO_WEIGHTS);var i=M(n,"onehotLabels","softmaxCrossEntropy"),o=M(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=M(t,"weights","softmaxCrossEntropy")),Ua(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=bn(r),c=bn(1),l=bn(i.shape[1]);i=jn(mt(i,It(c,u)),yr(u,l))}var f=w_e(i,o);return so(f,s,a)}var k_e=K({softmaxCrossEntropy_:x_e});function S_e(n,e,t,r){var a=M(n,"indices","sparseFillEmptyRows","int32"),i=M(e,"values","sparseFillEmptyRows"),o=M(t,"denseShape","sparseFillEmptyRows","int32"),s=M(r,"defaultValue","sparseFillEmptyRows",i.dtype);if(a.rank!==2)throw new Error(`Indices should be Tensor2D but received shape
        `.concat(a.shape));if(i.rank!==1)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(o.rank!==1)throw new Error("Dense shape should be Tensor1D but received shape ".concat(o.shape));if(s.rank!==0)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));var u={indices:a,values:i,denseShape:o,defaultValue:s},c=Q.runKernel(r2e,u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}var N_e=K({sparseFillEmptyRows_:S_e});function T_e(n,e,t){var r=M(n,"inputIndices","sparseReshape","int32"),a=M(e,"inputShape","sparseReshape","int32"),i=M(t,"newShape","sparseReshape","int32");if(r.rank!==2)throw new Error(`Input indices should be Tensor2D but received shape
        `.concat(r.shape));if(a.rank!==1)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(i.rank!==1)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));var o={inputIndices:r,inputShape:a,newShape:i},s=Q.runKernel(a2e,o);return{outputIndices:s[0],outputShape:s[1]}}var E_e=K({sparseReshape_:T_e});function I_e(n,e,t){var r=M(n,"data","sparseSegmentMean"),a=M(e,"indices","sparseSegmentMean","int32"),i=M(t,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
          `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
          `.concat(i.shape));var o={data:r,indices:a,segmentIds:i};return Q.runKernel(i2e,o)}var C_e=K({sparseSegmentMean_:I_e});function A_e(n,e,t){var r=M(n,"data","sparseSegmentSum"),a=M(e,"indices","sparseSegmentSum","int32"),i=M(t,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.rank!==1)throw new Error(`Indices should be Tensor1D but received shape
         `.concat(a.shape));if(i.rank!==1)throw new Error(`Segment ids should be Tensor1D but received shape
         `.concat(i.shape));var o={data:r,indices:a,segmentIds:i};return Q.runKernel(o2e,o)}var __e=K({sparseSegmentSum_:A_e});function D_e(n,e,t,r,a,i,o,s){var u=M(n,"data","stringNGrams","string");if(u.dtype!=="string")throw new Error("Data must be of datatype string");if(u.shape.length!==1)throw new Error("Data must be a vector, saw: ".concat(u.shape));var c=M(e,"dataSplits","stringNGrams");if(c.dtype!=="int32")throw new Error("Data splits must be of datatype int32");var l={separator:t,nGramWidths:r,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},f={data:u,dataSplits:c},h=Q.runKernel(l2e,f,l);return{nGrams:h[0],nGramsSplits:h[1]}}var F_e=K({stringNGrams_:D_e});function R_e(n,e,t){t===void 0&&(t=!0);var r=M(n,"input","stringSplit","string"),a=M(e,"delimiter","stringSplit","string");if(r.rank!==1)throw new Error("Input should be Tensor1D but received shape ".concat(r.shape));if(a.rank!==0)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));var i={skipEmpty:t},o={input:r,delimiter:a},s=Q.runKernel(f2e,o,i);return{indices:s[0],values:s[1],shape:s[2]}}var O_e=K({stringSplit_:R_e});function P_e(n,e){var t=M(n,"input","stringToHashBucketFast","string"),r={numBuckets:e};if(e<=0)throw new Error("Number of buckets must be at least 1");var a={input:t};return Q.runKernel(h2e,a,r)}var M_e=K({stringToHashBucketFast_:P_e});var B_e={fft:Mw,ifft:Iv,rfft:Bw,irfft:IB},L_e={hammingWindow:cAe,hannWindow:FB,frame:RB,stft:pAe},z_e={flipLeftRight:gAe,grayscaleToRGB:bAe,resizeNearestNeighbor:HAe,resizeBilinear:GAe,rotateWithOffset:xAe,cropAndResize:vAe,nonMaxSuppression:SAe,nonMaxSuppressionAsync:OAe,nonMaxSuppressionWithScore:MAe,nonMaxSuppressionWithScoreAsync:LAe,nonMaxSuppressionPadded:$Ae,nonMaxSuppressionPaddedAsync:WAe,threshold:XAe,transform:ZAe},$_e={bandPart:QAe,gramSchmidt:t_e,qr:r_e},q_e={absoluteDifference:o_e,computeWeightedLoss:so,cosineDistance:u_e,hingeLoss:l_e,huberLoss:h_e,logLoss:d_e,meanSquaredError:m_e,sigmoidCrossEntropy:b_e,softmaxCrossEntropy:k_e},W_e={sparseFillEmptyRows:N_e,sparseReshape:E_e,sparseSegmentMean:C_e,sparseSegmentSum:__e},V_e={stringNGrams:F_e,stringSplit:O_e,stringToHashBucketFast:M_e};var ar={__proto__:null,abs:$a,acos:X2e,acosh:Z2e,add:jn,addN:eSe,all:nSe,any:aSe,argMax:oSe,argMin:uSe,asin:lSe,asinh:hSe,atan:dSe,atan2:mSe,atanh:ySe,avgPool:eB,avgPool3d:ISe,basicLSTMCell:MSe,batchToSpaceND:tB,batchNorm:Av,batchNorm2d:qSe,batchNorm3d:VSe,batchNorm4d:USe,bincount:nB,broadcastArgs:jSe,broadcastTo:yv,buffer:Go,cast:rr,ceil:ZSe,clipByValue:QSe,clone:yc,complex:Ys,concat:Qr,concat1d:nNe,concat2d:aNe,concat3d:oNe,concat4d:uNe,conv1d:fNe,conv2d:Dv,conv2dTranspose:dNe,conv3d:mNe,conv3dTranspose:wNe,cos:kNe,cosh:NNe,cumprod:ENe,cumsum:CNe,denseBincount:_Ne,depthToSpace:FNe,depthwiseConv2d:Aw,diag:PNe,dilation2d:BNe,div:yr,divNoNan:UNe,dot:KNe,einsum:XNe,elu:oB,equal:iB,erf:JNe,euclideanNorm:uTe,exp:Zs,expandDims:Ks,expm1:hTe,eye:uB,fill:_v,floor:cB,floorDiv:aB,gather:lB,greater:Pv,greaterEqual:fB,imag:Mv,isFinite:xTe,isInf:STe,isNaN:TTe,leakyRelu:hB,less:CTe,lessEqual:Fw,linspace:_Te,localResponseNormalization:FTe,log:Hf,log1p:pB,logSigmoid:LTe,logSoftmax:qTe,logSumExp:vB,logicalAnd:Tv,logicalNot:mB,logicalOr:gB,logicalXor:KTe,lowerBound:XTe,matMul:Bt,max:wc,maxPool:yB,maxPool3d:JTe,maxPoolWithArgmax:eEe,maximum:nEe,mean:Ev,meshgrid:aEe,min:pw,minimum:bB,mirrorPad:sEe,mod:cEe,moments:fEe,mul:mt,multiRNNCell:pEe,multinomial:vEe,neg:io,notEqual:wB,oneHot:yEe,ones:Xs,onesLike:wEe,outerProduct:kEe,pad:Zf,pad1d:TEe,pad2d:IEe,pad3d:AEe,pad4d:DEe,pool:MEe,pow:Dw,prelu:kB,print:LEe,prod:$Ee,raggedGather:WEe,raggedRange:GEe,raggedTensorToTensor:HEe,rand:jEe,randomGamma:uIe,randomNormal:SB,randomStandardNormal:fIe,randomUniform:NB,range:Kf,real:jf,reciprocal:vIe,relu:Bv,relu6:TB,reshape:ge,reverse:Js,reverse1d:wIe,reverse2d:kIe,reverse3d:NIe,reverse4d:EIe,round:EB,rsqrt:AIe,scalar:bn,selu:DIe,separableConv2d:RIe,setdiff1dAsync:PIe,sigmoid:bc,sign:BIe,sin:zIe,sinh:qIe,slice:fn,slice1d:VIe,slice2d:UIe,slice3d:KIe,slice4d:XIe,softmax:ZIe,softplus:dB,spaceToBatchND:xB,fft:Mw,ifft:Iv,irfft:IB,rfft:Bw,split:Xf,sqrt:dw,square:Rv,squaredDifference:CB,squeeze:Lw,stack:Yf,step:AB,stridedSlice:uCe,sub:It,sum:en,tan:lCe,tanh:hw,tensor:zw,tensor1d:yi,tensor2d:Wf,tensor3d:fCe,tensor4d:hCe,tensor5d:pCe,tensor6d:dCe,tile:qf,topk:mCe,truncatedNormal:yCe,unique:wCe,unsortedSegmentSum:kCe,unstack:$w,upperBound:NCe,variable:TCe,where:Nc,whereAsync:_B,zeros:Tc,zerosLike:_w,op:K,OP_SCOPE_SUFFIX:Q4,booleanMaskAsync:ACe,transpose:vw,norm:Ov,movingAverage:OCe,scatterND:LCe,searchSorted:Rw,sparseToDense:qCe,gatherND:VCe,dropout:HCe,enclosingPowerOfTwo:DB,cosineWindow:qw,inTopKAsync:jCe,image:z_e,linalg:$_e,losses:q_e,spectral:B_e,fused:sAe,signal:L_e,sparse:W_e,string:V_e};var G_e=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"BiasAdd":case"AddV2":case"Add":return[r.add(I("a",n,e,t),I("b",n,e,t))];case"AddN":return[r.addN(I("tensors",n,e,t))];case"FloorMod":case"Mod":return[r.mod(I("a",n,e,t),I("b",n,e,t))];case"Mul":return[r.mul(I("a",n,e,t),I("b",n,e,t))];case"RealDiv":case"Div":return[r.div(I("a",n,e,t),I("b",n,e,t))];case"DivNoNan":return[r.divNoNan(I("a",n,e,t),I("b",n,e,t))];case"FloorDiv":return[r.floorDiv(I("a",n,e,t),I("b",n,e,t))];case"Sub":return[r.sub(I("a",n,e,t),I("b",n,e,t))];case"Minimum":return[r.minimum(I("a",n,e,t),I("b",n,e,t))];case"Maximum":return[r.maximum(I("a",n,e,t),I("b",n,e,t))];case"Pow":return[r.pow(I("a",n,e,t),I("b",n,e,t))];case"SquaredDifference":return[r.squaredDifference(I("a",n,e,t),I("b",n,e,t))];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var U_e=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"Abs":case"ComplexAbs":return[r.abs(I("x",n,e,t))];case"Acos":return[r.acos(I("x",n,e,t))];case"Acosh":return[r.acosh(I("x",n,e,t))];case"Asin":return[r.asin(I("x",n,e,t))];case"Asinh":return[r.asinh(I("x",n,e,t))];case"Atan":return[r.atan(I("x",n,e,t))];case"Atan2":return[r.atan2(I("x",n,e,t),I("y",n,e,t))];case"Atanh":return[r.atanh(I("x",n,e,t))];case"Ceil":return[r.ceil(I("x",n,e,t))];case"Complex":return[r.complex(I("real",n,e,t),I("imag",n,e,t))];case"Cos":return[r.cos(I("x",n,e,t))];case"Cosh":return[r.cosh(I("x",n,e,t))];case"Elu":return[r.elu(I("x",n,e,t))];case"Erf":return[r.erf(I("x",n,e,t))];case"Exp":return[r.exp(I("x",n,e,t))];case"Expm1":return[r.expm1(I("x",n,e,t))];case"Floor":return[r.floor(I("x",n,e,t))];case"Log":return[r.log(I("x",n,e,t))];case"Log1p":return[r.log1p(I("x",n,e,t))];case"Imag":return[r.imag(I("x",n,e,t))];case"Neg":return[r.neg(I("x",n,e,t))];case"Reciprocal":return[r.reciprocal(I("x",n,e,t))];case"Real":return[r.real(I("x",n,e,t))];case"Relu":return[r.relu(I("x",n,e,t))];case"Round":return[r.round(I("x",n,e,t))];case"Selu":return[r.selu(I("x",n,e,t))];case"Sigmoid":return[r.sigmoid(I("x",n,e,t))];case"Sin":return[r.sin(I("x",n,e,t))];case"Sign":return[r.sign(I("x",n,e,t))];case"Sinh":return[r.sinh(I("x",n,e,t))];case"Softplus":return[r.softplus(I("x",n,e,t))];case"Sqrt":return[r.sqrt(I("x",n,e,t))];case"Square":return[r.square(I("x",n,e,t))];case"Tanh":return[r.tanh(I("x",n,e,t))];case"Tan":return[r.tan(I("x",n,e,t))];case"ClipByValue":return[r.clipByValue(I("x",n,e,t),I("clipValueMin",n,e,t),I("clipValueMax",n,e,t))];case"Relu6":return[r.relu6(I("x",n,e,t))];case"Rsqrt":return[r.rsqrt(gr(n.inputNames[0],e,t))];case"Prod":return[r.prod(I("x",n,e,t),I("axes",n,e,t))];case"LeakyRelu":return[r.leakyRelu(I("x",n,e,t),I("alpha",n,e,t))];case"Prelu":return[r.prelu(I("x",n,e,t),I("alpha",n,e,t))];case"IsNan":return[r.isNaN(gr(n.inputNames[0],e,t))];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};function qa(n,e,t){if(t===void 0&&(t=""),!(typeof n=="number"||typeof e=="number")){Be.util.assert(n.length===e.length,function(){return t+" Shapes ".concat(n," and ").concat(e," must match")});for(var r=0;r<n.length;r++){var a=n[r],i=e[r];Be.util.assert(a<0||i<0||a===i,function(){return t+" Shapes ".concat(n," and ").concat(e," must match")})}}}function E4(n){return!(typeof n=="number"||n.some(function(e){return e<0}))}function Lf(n,e,t){var r=mw(n,t),a=!E4(r);if(a&&e.length===0)throw new Error("Tried to calculate elements of an empty list"+" with non-fully-defined elementShape: ".concat(r));if(a&&e.forEach(function(i){r=mw(i.shape,r)}),!E4(r))throw new Error("Non-fully-defined elementShape: ".concat(r));return r}function mw(n,e){if(typeof n=="number")return e;if(typeof e=="number")return n;if(n.length!==e.length)throw new Error("Incompatible ranks during merge: ".concat(n," vs. ").concat(e));for(var t=[],r=0;r<n.length;++r){var a=n[r],i=e[r];if(a>=0&&i>=0&&a!==i)throw new Error("Incompatible shape during merge: ".concat(n," vs. ").concat(e));t[r]=a>=0?a:i}return t}var H_e=function(){function n(e,t,r,a,i,o,s){this.name=e,this.dtype=t,this.maxSize=r,this.elementShape=a,this.identicalElementShapes=i,this.dynamicSize=o,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=Be.scalar(0),Be.keep(this.idTensor)}return Object.defineProperty(n.prototype,"id",{get:function(){return this.idTensor.id},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"closed",{get:function(){return this.closed_},enumerable:!1,configurable:!0}),n.prototype.clearAndClose=function(e){this.tensors.forEach(function(t){(e==null||!e.has(t.tensor.id))&&t.tensor.dispose()}),this.tensors=[],this.closed_=!0,this.idTensor.dispose()},n.prototype.size=function(){return this.tensors.length},n.prototype.read=function(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read ")+"(perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor},n.prototype.readMany=function(e){var t=this;return e.map(function(r){return t.read(r)})},n.prototype.write=function(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));var r=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,`,
          because the value dtype is `).concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(this.size()===0&&(this.elementShape==null||this.elementShape.length===0)&&(this.elementShape=t.shape),qa(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),r.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(r.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));r.tensor=t,Be.keep(t),r.written=!0,this.tensors[e]=r},n.prototype.writeMany=function(e,t){var r=this;if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,")+"because the index size: ".concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach(function(a,i){return r.write(a,t[i])})},n.prototype.gather=function(e,t){if(!!t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(var r=0;r<this.size();r++)e.push(r)}if(e.length===0)return Be.tensor([],[0].concat(this.elementShape));var a=this.readMany(e);return qa(this.elementShape,a[0].shape,"TensorArray shape mismatch: "),Be.stack(a,0)},n.prototype.concat=function(e){if(!!e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(this.size()===0)return Be.tensor([],[0].concat(this.elementShape));for(var t=[],r=0;r<this.size();r++)t.push(r);var a=this.readMany(t);return qa(this.elementShape,a[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(a[0].shape,")")),Be.concat(a,0)},n.prototype.scatter=function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));var r=Math.max.apply(Math,yn([],Ne(e),!1));if(!this.dynamicSize&&r>=this.maxSize)throw new Error("Max index must be < array size (".concat(r,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,Be.unstack(t,0))},n.prototype.split=function(e,t){var r=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));var a=0,i=e.map(function(l){return a+=l,a});if(a!==t.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        `.concat(a,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), ")+"and the TensorArray is not marked as dynamically resizeable");var o=a===0?0:t.size/a,s=[];Be.tidy(function(){t=Be.reshape(t,[1,a,o]);for(var l=0;l<e.length;++l){var f=l===0?0:i[l-1],h=[0,f,0],p=[1,e[l],o];s[l]=Be.reshape(Be.slice(t,h,p),r.elementShape)}return s});for(var u=[],c=0;c<e.length;c++)u[c]=c;this.writeMany(u,s)},n}(),Lv=function(){function n(e,t,r,a){a===void 0&&(a=-1),this.tensors=e,this.elementShape=t,this.elementDtype=r,e?.forEach(function(i){if(r!==i.dtype)throw new Error("Invalid data types; op elements ".concat(r,", but list elements ").concat(i.dtype));qa(t,i.shape,"TensorList shape mismatch: "),Be.keep(i)}),this.idTensor=Be.scalar(0),this.maxNumElements=a,Be.keep(this.idTensor)}return Object.defineProperty(n.prototype,"id",{get:function(){return this.idTensor.id},enumerable:!1,configurable:!0}),n.prototype.copy=function(){return new n(yn([],Ne(this.tensors),!1),this.elementShape,this.elementDtype)},n.prototype.clearAndClose=function(e){this.tensors.forEach(function(t){(e==null||!e.has(t.id))&&t.dispose()}),this.tensors.length=0,this.idTensor.dispose()},n.prototype.size=function(){return this.tensors.length},n.prototype.stack=function(e,t,r){var a=this;if(r===void 0&&(r=-1),t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(r!==-1&&this.tensors.length!==r)throw new Error("Operation expected a list with ".concat(r," elements but got a list with ").concat(this.tensors.length," elements."));qa(e,this.elementShape,"TensorList shape mismatch: ");var i=Lf(this.elementShape,this.tensors,e);return Be.tidy(function(){var o=a.tensors.map(function(s){return Be.reshape(s,i)});return Be.stack(o,0)})},n.prototype.popBack=function(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(this.size()===0)throw new Error("Trying to pop from an empty list.");var r=Lf(this.elementShape,this.tensors,e),a=this.tensors.pop();return a.kept=!1,qa(a.shape,e,"TensorList shape mismatch: "),Be.reshape(a,r)},n.prototype.pushBack=function(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(this.elementDtype));if(qa(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");Be.keep(e),this.tensors.push(e)},n.prototype.resize=function(e){if(e<0)throw new Error("TensorListResize expects size to be non-negative. Got: ".concat(e));if(this.maxNumElements!==-1&&e>this.maxNumElements)throw new Error("TensorListResize input size ".concat(e," is greater maxNumElement ").concat(this.maxNumElements,"."));var t=new n([],this.elementShape,this.elementDtype,this.maxNumElements);t.tensors.length=e;for(var r=0;r<Math.min(this.tensors.length,e);++r)t.tensors[r]=this.tensors[r];return t},n.prototype.getItem=function(e,t,r){if(r!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(r,", but list elements ").concat(this.elementDtype));if(e<0||e>this.tensors.length)throw new Error("Trying to access element ".concat(e," in a list with ").concat(this.tensors.length," elements."));if(this.tensors[e]==null)throw new Error("element at index ".concat(e," is null."));qa(this.tensors[e].shape,t,"TensorList shape mismatch: ");var a=Lf(this.elementShape,this.tensors,t);return Be.reshape(this.tensors[e],a)},n.prototype.setItem=function(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t.dtype,", but list elements ").concat(this.elementDtype));if(e<0||this.maxNumElements!==-1&&e>=this.maxNumElements)throw new Error("Trying to set element ".concat(e," in a list with max ").concat(this.maxNumElements," elements."));qa(this.elementShape,t.shape,"TensorList shape mismatch: "),Be.keep(t),this.tensors[e]!=null&&(this.tensors[e].kept=!1),this.tensors[e]=t},n.prototype.gather=function(e,t,r){var a=this;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));qa(this.elementShape,r,"TensorList shape mismatch: "),e=e.slice(0,this.size());var i=Lf(this.elementShape,this.tensors,r);return e.length===0?Be.tensor([],[0].concat(i)):Be.tidy(function(){var o=e.map(function(s){return Be.reshape(a.tensors[s],i)});return Be.stack(o,0)})},n.prototype.concat=function(e,t){var r=this;if(!!e&&e!==this.elementDtype)throw new Error("TensorList dtype is ".concat(this.elementDtype," but concat requested dtype ").concat(e));qa(this.elementShape,t,"TensorList shape mismatch: ");var a=Lf(this.elementShape,this.tensors,t);return this.size()===0?Be.tensor([],[0].concat(a)):Be.tidy(function(){var i=r.tensors.map(function(o){return Be.reshape(o,a)});return Be.concat(i,0)})},n}();function K_e(n,e,t){var r=n.dtype;if(n.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: ".concat(n.shape));if(n.dtype!==t)throw new Error("Invalid data types; op elements ".concat(n.dtype,", but list elements ").concat(t));var a=n.shape.slice(1);qa(a,e,"TensorList shape mismatch: ");var i=Be.unstack(n);return new Lv(i,e,r)}function j_e(n,e,t,r){return new Lv([],n,e,r)}function X_e(n,e,t,r){if(e.length!==n.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(n.shape[0]));var a=Math.max.apply(Math,yn([],Ne(e),!1));if(r!=null&&r!==-1&&a>=r)throw new Error("Max index must be < array size (".concat(a,"  vs. ").concat(r,")"));var i=new Lv([],t,n.dtype,r),o=Be.unstack(n,0);return e.forEach(function(s,u){i.setItem(s,o[u])}),i}function Y_e(n,e,t){var r=0,a=e.map(function(f){return r+=f,r});if(r!==n.shape[0])throw new Error(`Expected sum of lengths to be equal to
          tensor.shape[0], but sum of lengths is
        `.concat(r,", and tensor's shape is: ").concat(n.shape));for(var i=n.shape.slice(1),o=mw(i,t),s=r===0?0:n.size/r,u=Be.tidy(function(){var f=[];n=Be.reshape(n,[1,r,s]);for(var h=0;h<e.length;++h){var p=h===0?0:a[h-1],d=[0,p,0],v=[1,e[h],s];f[h]=Be.reshape(Be.slice(n,d,v),o)}return n.dispose(),f}),c=new Lv([],t,n.dtype,e.length),l=0;l<u.length;l++)c.setItem(l,u[l]);return c}var Z_e=function(n,e,t){return Pt(void 0,void 0,void 0,function(){var r,a,i,o,c,h,s,u,c,l,f,h,p,d,v,v,y,m,y,g,y,y,y,An,b,et,w,x,N,T,E,C,oe,st,F,D,le,O,we,Ae,L,z,$,de,xe,B,nt,W,lt,X,tt,rn,Y,V,j,re,ne,kt,oe,st,He,kt,le,et,Ze,He,de,xe,et,Ye,He,et,at,he,Ye,ye,He,we,Ae,et,at,He,kt,et,at,Ye,He,ht,et,at,He,nt,He,lt,et,kt,st,He,kt,et,Ze,He,tt,et,rn,He,kt,He,kt,An,hr,On;return _t(this,function(_n){switch(_n.label){case 0:switch(r=n.op,r){case"If":return[3,1];case"StatelessIf":return[3,1];case"While":return[3,3];case"StatelessWhile":return[3,3];case"LoopCond":return[3,9];case"Switch":return[3,10];case"Merge":return[3,12];case"Enter":return[3,13];case"Exit":return[3,14];case"NextIteration":return[3,15];case"TensorArrayV3":return[3,16];case"TensorArrayWriteV3":return[3,17];case"TensorArrayReadV3":return[3,18];case"TensorArrayGatherV3":return[3,19];case"TensorArrayScatterV3":return[3,20];case"TensorArrayConcatV3":return[3,21];case"TensorArraySplitV3":return[3,22];case"TensorArraySizeV3":return[3,23];case"TensorArrayCloseV3":return[3,24];case"TensorListSetItem":return[3,25];case"TensorListGetItem":return[3,26];case"TensorListScatterV2":return[3,27];case"TensorListScatter":return[3,27];case"TensorListReserve":return[3,28];case"EmptyTensorList":return[3,28];case"TensorListGather":return[3,29];case"TensorListStack":return[3,30];case"TensorListFromTensor":return[3,31];case"TensorListConcat":return[3,32];case"TensorListConcatV2":return[3,32];case"TensorListPushBack":return[3,33];case"TensorListPopBack":return[3,34];case"TensorListSplit":return[3,35];case"TensorListLength":return[3,36];case"TensorListResize":return[3,37]}return[3,38];case 1:return a=I("thenBranch",n,e,t),i=I("elseBranch",n,e,t),o=I("cond",n,e,t),c=I("args",n,e,t),[4,o.data()];case 2:return h=_n.sent(),h[0]?[2,t.functionMap[a].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap)]:[2,t.functionMap[i].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap)];case 3:return s=I("body",n,e,t),u=I("cond",n,e,t),c=I("args",n,e,t),[4,t.functionMap[u].executeFunctionAsync(c,t.tensorArrayMap,t.tensorListMap)];case 4:return l=_n.sent(),f=c.map(function(an){return an.id}),[4,l[0].data()];case 5:h=_n.sent(),l.forEach(function(an){!an.kept&&f.indexOf(an.id)===-1&&an.dispose()}),p=c,d=function(){var an,Pr,pr;return _t(this,function(Mr){switch(Mr.label){case 0:return an=p,[4,t.functionMap[s].executeFunctionAsync(p,t.tensorArrayMap,t.tensorListMap)];case 1:return p=Mr.sent(),Pr=p.map(function(Sn){return Sn.id}),an.forEach(function(Sn){!Sn.kept&&f.indexOf(Sn.id)===-1&&Pr.indexOf(Sn.id)===-1&&Sn.dispose()}),[4,t.functionMap[u].executeFunctionAsync(p,t.tensorArrayMap,t.tensorListMap)];case 2:return pr=Mr.sent(),[4,pr[0].data()];case 3:return h=Mr.sent(),pr.forEach(function(Sn){!Sn.kept&&f.indexOf(Sn.id)===-1&&Pr.indexOf(Sn.id)===-1&&Sn.dispose()}),[2]}})},_n.label=6;case 6:return h[0]?[5,d()]:[3,8];case 7:return _n.sent(),[3,6];case 8:return[2,p];case 9:return v=I("pred",n,e,t),[2,[ao(v)]];case 10:return v=I("pred",n,e,t),y=I("data",n,e,t),y.kept||(y=ao(y)),[4,v.data()];case 11:return[2,_n.sent()[0]?[void 0,y]:[y,void 0]];case 12:return m=n.inputNames.find(function(an){return gr(an,e,t)!==void 0}),m?(y=gr(m,e,t),[2,[ao(y)]]):[2,void 0];case 13:return g=I("frameName",n,e,t),y=I("tensor",n,e,t),t.enterFrame(g),[2,[ao(y)]];case 14:return y=I("tensor",n,e,t),t.exitFrame(),[2,[ao(y)]];case 15:return y=I("tensor",n,e,t),t.nextIteration(),[2,[ao(y)]];case 16:return An=I("size",n,e,t),b=I("dtype",n,e,t),et=I("elementShape",n,e,t),w=I("dynamicSize",n,e,t),x=I("clearAfterRead",n,e,t),N=I("identicalElementShapes",n,e,t),T=I("name",n,e,t),E=new H_e(T,b,An,et,N,w,x),t.addTensorArray(E),[2,[E.idTensor,Be.scalar(1)]];case 17:return C=I("tensorArrayId",n,e,t),oe=I("index",n,e,t),st=I("tensor",n,e,t),F=t.getTensorArray(C.id),F.write(oe,st),[2,[F.idTensor]];case 18:return D=I("tensorArrayId",n,e,t),le=I("index",n,e,t),O=t.getTensorArray(D.id),[2,[O.read(le)]];case 19:return we=I("tensorArrayId",n,e,t),Ae=I("indices",n,e,t),L=I("dtype",n,e,t),z=t.getTensorArray(we.id),[2,[z.gather(Ae,L)]];case 20:return $=I("tensorArrayId",n,e,t),de=I("indices",n,e,t),xe=I("tensor",n,e,t),B=t.getTensorArray($.id),B.scatter(de,xe),[2,[B.idTensor]];case 21:return nt=I("tensorArrayId",n,e,t),W=t.getTensorArray(nt.id),lt=I("dtype",n,e,t),[2,[W.concat(lt)]];case 22:return X=I("tensorArrayId",n,e,t),tt=I("tensor",n,e,t),rn=I("lengths",n,e,t),Y=t.getTensorArray(X.id),Y.split(rn,tt),[2,[Y.idTensor]];case 23:return V=I("tensorArrayId",n,e,t),j=t.getTensorArray(V.id),[2,[Be.scalar(j.size(),"int32")]];case 24:return re=I("tensorArrayId",n,e,t),ne=t.getTensorArray(re.id),ne.clearAndClose(),[2,[ne.idTensor]];case 25:return kt=I("tensorListId",n,e,t),oe=I("index",n,e,t),st=I("tensor",n,e,t),He=t.getTensorList(kt.id),He.setItem(oe,st),[2,[He.idTensor]];case 26:return kt=I("tensorListId",n,e,t),le=I("index",n,e,t),et=I("elementShape",n,e,t),Ze=I("elementDType",n,e,t),He=t.getTensorList(kt.id),[2,[He.getItem(le,et,Ze)]];case 27:return de=I("indices",n,e,t),xe=I("tensor",n,e,t),et=I("elementShape",n,e,t),Ye=I("numElements",n,e,t),He=X_e(xe,de,et,Ye),t.addTensorList(He),[2,[He.idTensor]];case 28:return et=I("elementShape",n,e,t),at=I("elementDType",n,e,t),he=void 0,n.op==="TensorListReserve"?he="numElements":he="maxNumElements",Ye=I(he,n,e,t),ye=n.op==="TensorListReserve"?-1:Ye,He=j_e(et,at,Ye,ye),t.addTensorList(He),[2,[He.idTensor]];case 29:return we=I("tensorListId",n,e,t),Ae=I("indices",n,e,t),et=I("elementShape",n,e,t),at=I("elementDType",n,e,t),He=t.getTensorList(we.id),[2,[He.gather(Ae,at,et)]];case 30:return kt=I("tensorListId",n,e,t),et=I("elementShape",n,e,t),at=I("elementDType",n,e,t),Ye=I("numElements",n,e,t),He=t.getTensorList(kt.id),[2,[He.stack(et,at,Ye)]];case 31:return ht=I("tensor",n,e,t),et=I("elementShape",n,e,t),at=I("elementDType",n,e,t),He=K_e(ht,et,at),t.addTensorList(He),[2,[He.idTensor]];case 32:return nt=I("tensorListId",n,e,t),He=t.getTensorList(nt.id),lt=I("dtype",n,e,t),et=I("elementShape",n,e,t),[2,[He.concat(lt,et)]];case 33:return kt=I("tensorListId",n,e,t),st=I("tensor",n,e,t),He=t.getTensorList(kt.id),He.pushBack(st),[2,[He.idTensor]];case 34:return kt=I("tensorListId",n,e,t),et=I("elementShape",n,e,t),Ze=I("elementDType",n,e,t),He=t.getTensorList(kt.id),[2,[He.popBack(et,Ze)]];case 35:return tt=I("tensor",n,e,t),et=I("elementShape",n,e,t),rn=I("lengths",n,e,t),He=Y_e(tt,rn,et),t.addTensorList(He),[2,[He.idTensor]];case 36:return kt=I("tensorListId",n,e,t),He=t.getTensorList(kt.id),[2,[Be.scalar(He.size(),"int32")]];case 37:return kt=I("tensorListId",n,e,t),An=I("size",n,e,t),hr=t.getTensorList(kt.id),On=hr.resize(An),t.addTensorList(On),[2,[On.idTensor]];case 38:throw TypeError("Node type ".concat(n.op," is not implemented"))}})})};function I4(n,e,t){var r=Ne(I("fusedOps",n,e,t),2),a=r[0],i=r[1],o=a==="biasadd",s=!o,u=i==="prelu",c=a==="fusedbatchnorm",l=I("numArgs",n,e,t);if(o){if(u&&l!==2)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!u&&o&&l!==1)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(c)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");var f=I("strides",n,e,t),h=vv(n,e,t),p=I("dataFormat",n,e,t).toUpperCase(),d=I("dilations",n,e,t),v=Ne(I("args",n,e,t),2),m=v[0],g=v[1];s&&(g=m,m=void 0);var y=I("leakyreluAlpha",n,e,t);return{stride:f,pad:h,dataFormat:p,dilations:d,biasArg:m,preluArg:g,activationFunc:i,leakyreluAlpha:y}}var J_e=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"Conv1D":{var a=I("stride",n,e,t),i=I("pad",n,e,t),o=I("dataFormat",n,e,t).toUpperCase(),s=I("dilation",n,e,t);return[r.conv1d(I("x",n,e,t),I("filter",n,e,t),a,i,o,s)]}case"Conv2D":{var a=I("strides",n,e,t),i=vv(n,e,t),o=I("dataFormat",n,e,t).toUpperCase(),u=I("dilations",n,e,t);return[r.conv2d(I("x",n,e,t),I("filter",n,e,t),[a[1],a[2]],i,o,[u[1],u[2]])]}case"_FusedConv2D":{var c=I4(n,e,t),a=c.stride,i=c.pad,o=c.dataFormat,u=c.dilations,l=c.biasArg,f=c.preluArg,h=c.activationFunc,p=c.leakyreluAlpha;return[r.fused.conv2d({x:I("x",n,e,t),filter:I("filter",n,e,t),strides:[a[1],a[2]],pad:i,dataFormat:o,dilations:[u[1],u[2]],bias:l,activation:h,preluActivationWeights:f,leakyreluAlpha:p})]}case"FusedDepthwiseConv2dNative":{var d=I4(n,e,t),a=d.stride,i=d.pad,o=d.dataFormat,u=d.dilations,l=d.biasArg,f=d.preluArg,h=d.activationFunc,p=d.leakyreluAlpha;return[r.fused.depthwiseConv2d({x:I("x",n,e,t),filter:I("filter",n,e,t),strides:[a[1],a[2]],pad:i,dataFormat:o,dilations:[u[1],u[2]],bias:l,activation:h,preluActivationWeights:f,leakyreluAlpha:p})]}case"Conv2DBackpropInput":case"Conv2dTranspose":{var v=I("outputShape",n,e,t),a=I("strides",n,e,t),i=vv(n,e,t);return[r.conv2dTranspose(I("x",n,e,t),I("filter",n,e,t),v,[a[1],a[2]],i)]}case"DepthwiseConv2dNative":case"DepthwiseConv2d":{var a=I("strides",n,e,t),i=vv(n,e,t),u=I("dilations",n,e,t),o=I("dataFormat",n,e,t).toUpperCase();return[r.depthwiseConv2d(I("input",n,e,t),I("filter",n,e,t),[a[1],a[2]],i,o,[u[1],u[2]])]}case"Conv3D":{var a=I("strides",n,e,t),i=I("pad",n,e,t),o=I("dataFormat",n,e,t).toUpperCase(),u=I("dilations",n,e,t);return[r.conv3d(I("x",n,e,t),I("filter",n,e,t),[a[1],a[2],a[3]],i,o,[u[1],u[2],u[3]])]}case"AvgPool":{var a=I("strides",n,e,t),i=I("pad",n,e,t),m=I("kernelSize",n,e,t);return[r.avgPool(I("x",n,e,t),[m[1],m[2]],[a[1],a[2]],i)]}case"MaxPool":{var a=I("strides",n,e,t),i=I("pad",n,e,t),m=I("kernelSize",n,e,t);return[r.maxPool(I("x",n,e,t),[m[1],m[2]],[a[1],a[2]],i)]}case"MaxPoolWithArgmax":{var a=I("strides",n,e,t),i=I("pad",n,e,t),m=I("kernelSize",n,e,t),g=I("includeBatchInIndex",n,e,t),y=r.maxPoolWithArgmax(I("x",n,e,t),[m[1],m[2]],[a[1],a[2]],i,g),b=y.result,w=y.indexes;return[b,w]}case"AvgPool3D":{var a=I("strides",n,e,t),i=I("pad",n,e,t),m=I("kernelSize",n,e,t);return[r.avgPool3d(I("x",n,e,t),[m[1],m[2],m[3]],[a[1],a[2],a[3]],i)]}case"MaxPool3D":{var a=I("strides",n,e,t),i=I("pad",n,e,t),m=I("kernelSize",n,e,t);return[r.maxPool3d(I("x",n,e,t),[m[1],m[2],m[3]],[a[1],a[2],a[3]],i)]}case"Dilation2D":{var x=I("strides",n,e,t),i=I("pad",n,e,t),u=I("dilations",n,e,t),N=x[1],T=x[2],E=u[1],C=u[2];return[r.dilation2d(I("x",n,e,t),I("filter",n,e,t),[N,T],i,[E,C],"NHWC")]}default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var Q_e=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"Fill":{var a=I("shape",n,e,t),i=I("dtype",n,e,t),o=I("value",n,e,t);return[r.fill(a,o,i)]}case"LinSpace":{var s=I("start",n,e,t),u=I("stop",n,e,t),c=I("num",n,e,t);return[r.linspace(s,u,c)]}case"Multinomial":{var l=I("logits",n,e,t),f=I("numSamples",n,e,t),h=I("seed",n,e,t);return[r.multinomial(l,f,h)]}case"OneHot":{var p=I("indices",n,e,t),d=I("depth",n,e,t),v=I("onValue",n,e,t),m=I("offValue",n,e,t),i=I("dtype",n,e,t);return[r.oneHot(p,d,v,m,i)]}case"Ones":return[r.ones(I("shape",n,e,t),I("dtype",n,e,t))];case"OnesLike":return[r.onesLike(I("x",n,e,t))];case"RandomStandardNormal":return[r.randomStandardNormal(I("shape",n,e,t),I("dtype",n,e,t),I("seed",n,e,t))];case"RandomUniform":return[r.randomUniform(I("shape",n,e,t),I("minval",n,e,t),I("maxval",n,e,t),I("dtype",n,e,t))];case"Range":{var s=I("start",n,e,t),u=I("stop",n,e,t),g=I("step",n,e,t);return[r.range(s,u,g,I("dtype",n,e,t))]}case"TruncatedNormal":{var a=I("shape",n,e,t),y=I("mean",n,e,t),b=I("stdDev",n,e,t),h=I("seed",n,e,t);return[r.truncatedNormal(a,y,b,I("dtype",n,e,t),h)]}case"Zeros":return[r.zeros(I("shape",n,e,t),I("dtype",n,e,t))];case"ZerosLike":return[r.zerosLike(I("x",n,e,t))];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};function G1(n,e,t){var r=I("boxes",n,e,t),a=I("scores",n,e,t),i=I("maxOutputSize",n,e,t),o=I("iouThreshold",n,e,t),s=I("scoreThreshold",n,e,t),u=I("softNmsSigma",n,e,t);return{boxes:r,scores:a,maxOutputSize:i,iouThreshold:o,scoreThreshold:s,softNmsSigma:u}}var eDe=function(n,e,t,r,a){return a===void 0&&(a=ar),Pt(void 0,void 0,void 0,function(){var i,o,f,h,p,d,v,s,g,u,f,h,p,d,v,c,g,l,f,h,p,d,v,m,g;return _t(this,function(y){switch(y.label){case 0:switch(i=n.op,i){case"NonMaxSuppressionV5":return[3,1];case"NonMaxSuppressionV4":return[3,3];case"NonMaxSuppressionV3":return[3,5];case"NonMaxSuppressionV2":return[3,5];case"Where":return[3,7];case"ListDiff":return[3,9]}return[3,10];case 1:return o=G1(n,e,t),f=o.boxes,h=o.scores,p=o.maxOutputSize,d=o.iouThreshold,v=o.scoreThreshold,s=o.softNmsSigma,[4,a.image.nonMaxSuppressionWithScoreAsync(f,h,p,d,v,s)];case 2:return g=y.sent(),[2,[g.selectedIndices,g.selectedScores]];case 3:return u=G1(n,e,t),f=u.boxes,h=u.scores,p=u.maxOutputSize,d=u.iouThreshold,v=u.scoreThreshold,c=I("padToMaxOutputSize",n,e,t),[4,a.image.nonMaxSuppressionPaddedAsync(f,h,p,d,v,c)];case 4:return g=y.sent(),[2,[g.selectedIndices,g.validOutputs]];case 5:return l=G1(n,e,t),f=l.boxes,h=l.scores,p=l.maxOutputSize,d=l.iouThreshold,v=l.scoreThreshold,[4,a.image.nonMaxSuppressionAsync(f,h,p,d,v)];case 6:return[2,[y.sent()]];case 7:return m=a.cast(I("condition",n,e,t),"bool"),[4,a.whereAsync(m)];case 8:return g=[y.sent()],m.dispose(),[2,g];case 9:return[2,a.setdiff1dAsync(I("x",n,e,t),I("y",n,e,t))];case 10:throw TypeError("Node type ".concat(n.op," is not implemented"))}})})};var tDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"LowerBound":{var a=I("sortedSequence",n,e,t),i=I("values",n,e,t);return[r.lowerBound(a,i)]}case"TopKV2":{var o=I("x",n,e,t),s=I("k",n,e,t),u=I("sorted",n,e,t),c=r.topk(o,s,u);return[c.values,c.indices]}case"UpperBound":{var a=I("sortedSequence",n,e,t),i=I("values",n,e,t);return[r.upperBound(a,i)]}case"Unique":{var o=I("x",n,e,t),c=r.unique(o);return[c.values,c.indices]}case"UniqueV2":{var o=I("x",n,e,t),l=I("axis",n,e,t),c=r.unique(o,l);return[c.values,c.indices]}default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var nDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"Const":return e[n.name];case"PlaceholderWithDefault":var a=I("default",n,e,t);return[gr(n.name,e,t)||a];case"Placeholder":return[gr(n.name,e,t)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":{var i=I("x",n,e,t);return[ao(i)]}case"IdentityN":return I("x",n,e,t).map(function(h){return ao(h)});case"Snapshot":var o=I("x",n,e,t);return[ao(o)];case"Shape":return[r.tensor1d(I("x",n,e,t).shape,"int32")];case"ShapeN":return I("x",n,e,t).map(function(h){return r.tensor1d(h.shape)});case"Size":return[r.scalar(I("x",n,e,t).size,"int32")];case"Rank":return[r.scalar(I("x",n,e,t).rank,"int32")];case"NoOp":return[r.scalar(1)];case"Print":var s=I("x",n,e,t),u=I("data",n,e,t),c=I("message",n,e,t),l=I("summarize",n,e,t);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(c);for(var f=0;f<u.length;f++)console.log(Array.prototype.slice.call(u[f].dataSync()).slice(0,l));return[s];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}},rDe=function(){function n(e,t){this.keyDType=e,this.valueDType=t,this.handle=Be.scalar(0),this.tensorMap=new Map,Be.keep(this.handle)}return Object.defineProperty(n.prototype,"id",{get:function(){return this.handle.id},enumerable:!1,configurable:!0}),n.prototype.clearAndClose=function(){this.tensorMap.forEach(function(e){return e.dispose()}),this.tensorMap.clear(),this.handle.dispose()},n.prototype.size=function(){return this.tensorMap.size},n.prototype.tensorSize=function(){return bn(this.size(),"int32")},n.prototype.import=function(e,t){return Pt(this,void 0,void 0,function(){var r,a=this;return _t(this,function(i){switch(i.label){case 0:return this.checkKeyAndValueTensor(e,t),[4,e.data()];case 1:return r=i.sent(),this.tensorMap.forEach(function(o){return o.dispose()}),this.tensorMap.clear(),[2,Be.tidy(function(){var o=Be.unstack(t),s=r.length,u=o.length;Be.util.assert(s===u,function(){return"The number of elements doesn't match, keys has "+"".concat(s," elements, the values has ").concat(u," ")+"elements."});for(var c=0;c<s;c++){var l=r[c],f=o[c];Be.keep(f),a.tensorMap.set(l,f)}return a.handle})]}})})},n.prototype.find=function(e,t){return Pt(this,void 0,void 0,function(){var r,a=this;return _t(this,function(i){switch(i.label){case 0:return this.checkKeyAndValueTensor(e,t),[4,e.data()];case 1:return r=i.sent(),[2,Be.tidy(function(){for(var o=[],s=0;s<r.length;s++){var u=r[s],c=a.findWithDefault(u,t);o.push(c)}return Be.stack(o)})]}})})},n.prototype.findWithDefault=function(e,t){var r=this.tensorMap.get(e);return r??t},n.prototype.checkKeyAndValueTensor=function(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype ".concat(this.keyDType,", but got ")+"".concat(e.dtype));if(t.dtype!==this.valueDType)throw new Error("Expect value dtype ".concat(this.valueDType,", but got ")+"".concat(t.dtype))},n}(),aDe=function(n,e,t,r){return Pt(void 0,void 0,void 0,function(){var a,i,o,s,h,f,c,u,h,f,c,l,h,f,h;return _t(this,function(p){switch(p.label){case 0:switch(a=n.op,a){case"HashTable":return[3,1];case"HashTableV2":return[3,1];case"InitializeTable":return[3,2];case"InitializeTableV2":return[3,2];case"LookupTableImport":return[3,2];case"LookupTableImportV2":return[3,2];case"LookupTableFind":return[3,4];case"LookupTableFindV2":return[3,4];case"LookupTableSize":return[3,6];case"LookupTableSizeV2":return[3,6]}return[3,7];case 1:return i=r.getHashTableHandleByName(n.name),i!=null?[2,[i]]:(o=I("keyDType",n,e,t),s=I("valueDType",n,e,t),h=new rDe(o,s),r.addHashTable(n.name,h),[2,[h.handle]]);case 2:return f=I("tableHandle",n,e,t,r),c=I("keys",n,e,t),u=I("values",n,e,t),h=r.getHashTableById(f.id),[4,h.import(c,u)];case 3:return[2,[p.sent()]];case 4:return f=I("tableHandle",n,e,t,r),c=I("keys",n,e,t),l=I("defaultValue",n,e,t),h=r.getHashTableById(f.id),[4,h.find(c,l)];case 5:return[2,[p.sent()]];case 6:return f=I("tableHandle",n,e,t,r),h=r.getHashTableById(f.id),[2,[h.tensorSize()]];case 7:throw TypeError("Node type ".concat(n.op," is not implemented"))}})})};var iDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"ResizeBilinear":{var a=I("images",n,e,t),i=I("size",n,e,t),o=I("alignCorners",n,e,t),s=I("halfPixelCenters",n,e,t);return[r.image.resizeBilinear(a,[i[0],i[1]],o,s)]}case"ResizeNearestNeighbor":{var a=I("images",n,e,t),i=I("size",n,e,t),o=I("alignCorners",n,e,t),s=I("halfPixelCenters",n,e,t);return[r.image.resizeNearestNeighbor(a,[i[0],i[1]],o,s)]}case"CropAndResize":{var u=I("image",n,e,t),c=I("boxes",n,e,t),l=I("boxInd",n,e,t),f=I("cropSize",n,e,t),h=I("method",n,e,t),p=I("extrapolationValue",n,e,t);return[r.image.cropAndResize(u,c,l,f,h,p)]}case"ImageProjectiveTransformV3":{var a=I("images",n,e,t),d=I("transforms",n,e,t),v=I("outputShape",n,e,t),m=I("fillValue",n,e,t),g=I("interpolation",n,e,t),y=I("fillMode",n,e,t);return[r.image.transform(a,d,g.toLowerCase(),y.toLowerCase(),m,v)]}default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var oDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"Equal":return[r.equal(I("a",n,e,t),I("b",n,e,t))];case"NotEqual":return[r.notEqual(I("a",n,e,t),I("b",n,e,t))];case"Greater":return[r.greater(I("a",n,e,t),I("b",n,e,t))];case"GreaterEqual":return[r.greaterEqual(I("a",n,e,t),I("b",n,e,t))];case"Less":return[r.less(I("a",n,e,t),I("b",n,e,t))];case"LessEqual":return[r.lessEqual(I("a",n,e,t),I("b",n,e,t))];case"LogicalAnd":return[r.logicalAnd(I("a",n,e,t),I("b",n,e,t))];case"LogicalNot":return[r.logicalNot(I("a",n,e,t))];case"LogicalOr":return[r.logicalOr(I("a",n,e,t),I("b",n,e,t))];case"Select":case"SelectV2":return[r.where(I("condition",n,e,t),I("a",n,e,t),I("b",n,e,t))];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}},sDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[r.matMul(I("a",n,e,t),I("b",n,e,t),I("transposeA",n,e,t),I("transposeB",n,e,t))];case"Einsum":return[r.einsum.apply(r,yn([I("equation",n,e,t)],Ne(I("tensors",n,e,t)),!1))];case"Transpose":return[r.transpose(I("x",n,e,t),I("perm",n,e,t))];case"_FusedMatMul":var a=Ne(I("fusedOps",n,e,t),2),i=a[0],o=a[1],s=i==="biasadd",u=o==="prelu",c=I("numArgs",n,e,t),l=I("leakyreluAlpha",n,e,t);if(s){if(u&&c!==2)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!u&&c!==1)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var f=Ne(I("args",n,e,t),2),h=f[0],p=f[1];return[r.fused.matMul({a:I("a",n,e,t),b:I("b",n,e,t),transposeA:I("transposeA",n,e,t),transposeB:I("transposeB",n,e,t),bias:h,activation:o,preluActivationWeights:p,leakyreluAlpha:l})];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var uDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"EuclideanNorm":return[r.euclideanNorm(I("x",n,e,t),I("axis",n,e,t),I("keepDims",n,e,t))];case"FusedBatchNorm":case"FusedBatchNormV2":return[r.batchNorm(I("x",n,e,t),I("mean",n,e,t),I("variance",n,e,t),I("offset",n,e,t),I("scale",n,e,t),I("epsilon",n,e,t))];case"FusedBatchNormV3":return[r.batchNorm(I("x",n,e,t),I("mean",n,e,t),I("variance",n,e,t),I("offset",n,e,t),I("scale",n,e,t),I("epsilon",n,e,t))];case"LRN":return[r.localResponseNormalization(I("x",n,e,t),I("radius",n,e,t),I("bias",n,e,t),I("alpha",n,e,t),I("beta",n,e,t))];case"Softmax":return[r.softmax(I("x",n,e,t))];case"LogSoftmax":return[r.logSoftmax(I("x",n,e,t))];case"SparseToDense":return[r.sparseToDense(I("sparseIndices",n,e,t),I("outputShape",n,e,t),I("sparseValues",n,e,t),I("defaultValue",n,e,t))];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var cDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"RaggedGather":{var a=r.raggedGather(I("paramsNestedSplits",n,e,t),I("paramsDenseValues",n,e,t),I("indices",n,e,t),I("outputRaggedRank",n,e,t)),i=a.outputNestedSplits,o=a.outputDenseValues;return i.concat(o)}case"RaggedRange":{var s=r.raggedRange(I("starts",n,e,t),I("limits",n,e,t),I("splits",n,e,t)),u=s.rtNestedSplits,c=s.rtDenseValues;return[u,c]}case"RaggedTensorToTensor":return[r.raggedTensorToTensor(I("shape",n,e,t),I("values",n,e,t),I("defaultValue",n,e,t),I("rowPartitionTensors",n,e,t),I("rowPartitionTypes",n,e,t))];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var lDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"Max":{var a=I("axis",n,e,t),i=I("keepDims",n,e,t);return[r.max(I("x",n,e,t),a,i)]}case"Mean":{var a=I("axis",n,e,t),i=I("keepDims",n,e,t);return[r.mean(I("x",n,e,t),a,i)]}case"Min":{var a=I("axis",n,e,t),i=I("keepDims",n,e,t);return[r.min(I("x",n,e,t),a,i)]}case"Sum":{var a=I("axis",n,e,t),i=I("keepDims",n,e,t);return[r.sum(I("x",n,e,t),a,i)]}case"All":{var a=I("axis",n,e,t),i=I("keepDims",n,e,t);return[r.all(I("x",n,e,t),a,i)]}case"Any":{var a=I("axis",n,e,t),i=I("keepDims",n,e,t);return[r.any(I("x",n,e,t),a,i)]}case"ArgMax":{var a=I("axis",n,e,t);return[r.argMax(I("x",n,e,t),a)]}case"ArgMin":{var a=I("axis",n,e,t);return[r.argMin(I("x",n,e,t),a)]}case"Prod":{var a=I("axis",n,e,t),i=I("keepDims",n,e,t);return[r.prod(I("x",n,e,t),a,i)]}case"Cumprod":{var a=I("axis",n,e,t),o=I("exclusive",n,e,t),s=I("reverse",n,e,t);return[r.cumprod(I("x",n,e,t),a,o,s)]}case"Cumsum":{var a=I("axis",n,e,t),o=I("exclusive",n,e,t),s=I("reverse",n,e,t);return[r.cumsum(I("x",n,e,t),a,o,s)]}case"Bincount":var u=I("x",n,e,t),c=I("weights",n,e,t),l=I("size",n,e,t);return[r.bincount(u,c,l)];case"DenseBincount":{var f=I("x",n,e,t),h=I("weights",n,e,t),p=I("size",n,e,t),d=I("binaryOutput",n,e,t);return[r.denseBincount(f,h,p,d)]}default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var fDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"ConcatV2":case"Concat":{var a=I("n",n,e,t),i=I("axis",n,e,t),o=I("tensors",n,e,t);return o=o.slice(0,a),[r.concat(o,i)]}case"Gather":{var s=I("x",n,e,t),u=I("indices",n,e,t);return[r.gather(s,r.cast(u,"int32"),0)]}case"GatherV2":{var i=I("axis",n,e,t),c=I("batchDims",n,e,t),s=I("x",n,e,t),u=I("indices",n,e,t);return[r.gather(s,r.cast(u,"int32"),i,c)]}case"Reverse":{for(var l=I("dims",n,e,t),i=[],f=0;f<l.length;f++)l[f]&&i.push(f);var s=I("x",n,e,t);return[r.reverse(s,i)]}case"ReverseV2":{var i=I("axis",n,e,t),s=I("x",n,e,t);return[r.reverse(s,i)]}case"Slice":{var h=I("begin",n,e,t),p=I("size",n,e,t);return[r.slice(I("x",n,e,t),h,p)]}case"StridedSlice":{var h=I("begin",n,e,t),d=I("end",n,e,t),v=I("strides",n,e,t),m=I("beginMask",n,e,t),g=I("endMask",n,e,t),y=I("ellipsisMask",n,e,t),b=I("newAxisMask",n,e,t),w=I("shrinkAxisMask",n,e,t),x=I("x",n,e,t);return[r.stridedSlice(x,h,d,v,m,g,y,b,w)]}case"Pack":return Be.tidy(function(){var L=I("axis",n,e,t),z=I("tensors",n,e,t),$=z[0].shape,B=r.squeeze(z[0]).shape,W=z.map(function(X){var Y=Be.util.arraysEqual(X.shape,$);if(!Y&&!Be.util.arraysEqual(r.squeeze(X).shape,B))throw new Error("the input tensors shape does not match");return Y?X:r.reshape(X,$)});return[r.stack(W,L)]});case"Unpack":{var i=I("axis",n,e,t),x=I("tensor",n,e,t);return r.unstack(x,i)}case"Tile":{var N=I("reps",n,e,t);return[r.tile(I("x",n,e,t),N)]}case"Split":case"SplitV":{var i=I("axis",n,e,t),T=I("numOrSizeSplits",n,e,t),x=I("x",n,e,t);return r.split(x,T,i)}case"ScatterNd":{var u=I("indices",n,e,t),E=I("values",n,e,t),C=I("shape",n,e,t);return[r.scatterND(u,E,C)]}case"GatherNd":{var F=I("x",n,e,t),u=I("indices",n,e,t);return[r.gatherND(F,u)]}case"SparseToDense":{var u=I("sparseIndices",n,e,t),C=I("outputShape",n,e,t),D=I("sparseValues",n,e,t),O=I("defaultValue",n,e,t);return[r.sparseToDense(u,D,C,D.dtype===O.dtype?O:r.cast(O,D.dtype))]}default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var hDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"SparseFillEmptyRows":{var a=r.sparse.sparseFillEmptyRows(I("indices",n,e,t),I("values",n,e,t),I("denseShape",n,e,t),I("defaultValue",n,e,t)),i=a.outputIndices,o=a.outputValues,s=a.emptyRowIndicator,u=a.reverseIndexMap;return[i,o,s,u]}case"SparseReshape":{var c=r.sparse.sparseReshape(I("inputIndices",n,e,t),I("inputShape",n,e,t),I("newShape",n,e,t)),i=c.outputIndices,l=c.outputShape;return[i,l]}case"SparseSegmentMean":{var f=r.sparse.sparseSegmentMean(I("data",n,e,t),I("indices",n,e,t),I("segmentIds",n,e,t));return[f]}case"SparseSegmentSum":{var f=r.sparse.sparseSegmentSum(I("data",n,e,t),I("indices",n,e,t),I("segmentIds",n,e,t));return[f]}default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var pDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"FFT":return[r.fft(I("x",n,e,t))];case"IFFT":return[r.ifft(I("x",n,e,t))];case"RFFT":return[r.rfft(I("x",n,e,t))];case"IRFFT":return[r.irfft(I("x",n,e,t))];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var dDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"StringNGrams":{var a=r.string.stringNGrams(I("data",n,e,t),I("dataSplits",n,e,t),I("separator",n,e,t),I("nGramWidths",n,e,t),I("leftPad",n,e,t),I("rightPad",n,e,t),I("padWidth",n,e,t),I("preserveShortSequences",n,e,t)),i=a.nGrams,o=a.nGramsSplits;return[i,o]}case"StringSplit":{var s=r.string.stringSplit(I("input",n,e,t),I("delimiter",n,e,t),I("skipEmpty",n,e,t)),u=s.indices,c=s.values,l=s.shape;return[u,c,l]}case"StringToHashBucketFast":{var f=r.string.stringToHashBucketFast(I("input",n,e,t),I("numBuckets",n,e,t));return[f]}default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};var vDe=function(n,e,t,r){switch(r===void 0&&(r=ar),n.op){case"Cast":return[r.cast(I("x",n,e,t),I("dtype",n,e,t))];case"ExpandDims":{var a=I("axis",n,e,t);return[r.expandDims(I("x",n,e,t),a)]}case"Squeeze":{var a=I("axis",n,e,t);return[r.squeeze(I("x",n,e,t),a)]}case"Reshape":return[r.reshape(I("x",n,e,t),I("shape",n,e,t))];case"MirrorPad":return[r.mirrorPad(I("x",n,e,t),I("padding",n,e,t),I("mode",n,e,t))];case"PadV2":case"Pad":return[r.pad(I("x",n,e,t),I("padding",n,e,t),I("constantValue",n,e,t))];case"SpaceToBatchND":{var i=I("blockShape",n,e,t),o=I("paddings",n,e,t);return[r.spaceToBatchND(I("x",n,e,t),i,o)]}case"BatchToSpaceND":{var i=I("blockShape",n,e,t),s=I("crops",n,e,t);return[r.batchToSpaceND(I("x",n,e,t),i,s)]}case"DepthToSpace":{var u=I("blockSize",n,e,t),c=I("dataFormat",n,e,t).toUpperCase();return[r.depthToSpace(I("x",n,e,t),u,c)]}case"BroadcastTo":return[r.broadcastTo(I("x",n,e,t),I("shape",n,e,t))];case"BroadcastArgs":return[r.broadcastArgs(I("s0",n,e,t),I("s1",n,e,t))];default:throw TypeError("Node type ".concat(n.op," is not implemented"))}};function C4(n,e,t,r,a){a===void 0&&(a=t4.tidy);var i=function(o,s,u){switch(o.category){case"arithmetic":return a(function(){return G_e(o,s,u)});case"basic_math":return a(function(){return U_e(o,s,u)});case"control":return Z_e(o,s,u);case"convolution":return a(function(){return J_e(o,s,u)});case"creation":return a(function(){return Q_e(o,s,u)});case"dynamic":return eDe(o,s,u);case"evaluation":return a(function(){return tDe(o,s,u)});case"image":return a(function(){return iDe(o,s,u)});case"graph":return a(function(){return nDe(o,s,u)});case"logical":return a(function(){return oDe(o,s,u)});case"matrices":return a(function(){return sDe(o,s,u)});case"normalization":return a(function(){return uDe(o,s,u)});case"ragged":return a(function(){return cDe(o,s,u)});case"reduction":return a(function(){return lDe(o,s,u)});case"slice_join":return a(function(){return fDe(o,s,u)});case"sparse":return a(function(){return hDe(o,s,u)});case"spectral":return a(function(){return pDe(o,s,u)});case"string":return a(function(){return dDe(o,s,u)});case"transformation":return a(function(){return vDe(o,s,u)});case"hash_table":return aDe(o,s,u,r);case"custom":var c=F4(o.op);if(c&&c.customExecutor)return c.customExecutor(new wwe(o,s,u));throw TypeError("Custom op ".concat(o.op," is not registered."));default:throw TypeError("Unknown op '".concat(o.op,"'. File an issue at ")+"https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(n,e,t);return t4.util.isPromise(i)?i.then(function(o){return[].concat(o)}):[].concat(i)}var A4=function(){function n(e,t,r,a){e===void 0&&(e={}),t===void 0&&(t={}),r===void 0&&(r={}),a===void 0&&(a={}),this.weightMap=e,this.tensorArrayMap=t,this.tensorListMap=r,this.functionMap=a,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return n.prototype.newFrame=function(e,t){return{id:e,frameName:t,iterationId:0}},Object.defineProperty(n.prototype,"currentContext",{get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!1,configurable:!0}),n.prototype.generateCurrentContextIds=function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var r=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(r))}e.push(""),this._currentContextIds=e},n.prototype.contextIdforContexts=function(e){return e?e.map(function(t){return t.id===0&&t.iterationId===0?"":"".concat(t.frameName,"-").concat(t.iterationId)}).join("/"):""},n.prototype.enterFrame=function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},n.prototype.exitFrame=function(){if(this.contexts&&this.contexts.length>1)this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift();else throw new Error("Cannot exit frame, the context is empty")},n.prototype.nextIteration=function(){if(this.contexts&&this.contexts.length>0){this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}else throw new Error("Cannot increase frame iteration, the context is empty")},n.prototype.getWeight=function(e){return this.weightMap[e]},n.prototype.addTensorArray=function(e){this.tensorArrayMap[e.id]=e},n.prototype.getTensorArray=function(e){return this.tensorArrayMap[e]},n.prototype.addTensorList=function(e){this.tensorListMap[e.id]=e},n.prototype.getTensorList=function(e){return this.tensorListMap[e]},n.prototype.dispose=function(e){for(var t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(var t in this.tensorListMap)this.tensorListMap[t].clearAndClose(e)},n}();function _4(n,e,t,r){var a=new Set,i=[],o=null,s=null,u=new Set,c=Object.keys(n).map(function(p){return Zr(p)[0]}),l=[];r!=null&&(l=r.map(function(p){return Zr(p.name)[0]}));for(var f=yn([],Ne(e),!1);f.length>0;){var h=f.pop();if((OB(h)||wDe(h)||xDe(h))&&o==null&&(o=h,s=o.children.map(function(p){return p.name}).filter(function(p){return a.has(p)})),a.add(h.name),t[h.name]==null&&c.indexOf(h.name)===-1&&l.indexOf(h.name)===-1){if(h.inputs.length===0){i.push(h.name);continue}h.inputs.forEach(function(p){u.has(p.name)||(u.add(p.name),f.push(p))})}}return{inputs:n,outputs:e,usedNodes:a,missingInputs:i,dynamicNode:o,syncInputs:s}}function mDe(n,e,t){var r=t.usedNodes,a=t.inputs,i=[],o=Object.keys(a).map(function(f){return Zr(f)[0]}).map(function(f){return n.nodes[f]}),s=n.initNodes;o.forEach(function(f){r.has(f.name)&&i.push(f)}),n.weights.forEach(function(f){r.has(f.name)&&i.push(f)}),s?.forEach(function(f){r.has(f.name)&&i.push(f)});for(var u=new Set,c=[];i.length>0;){var l=i.pop();u.add(l.name),e[l.name]||c.push(l),l.children.forEach(function(f){!u.has(f.name)&&r.has(f.name)&&f.inputs.every(function(h){return u.has(h.name)})&&i.push(f)})}return c}var gDe=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],yDe=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],bDe=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function OB(n){return gDe.indexOf(n.op)>=0}function wDe(n){return yDe.indexOf(n.op)>=0}function xDe(n){return bDe.indexOf(n.op)>=0}var D4=function(){function n(e,t){var r=this;this.graph=e,this.parent=t,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.keepIntermediateTensors=!1,this._outputs=e.outputs,this._inputs=e.inputs,this._initNodes=e.initNodes,this._signature=e.signature,this._functions=e.functions,e.functions!=null&&Object.keys(e.functions).forEach(function(a){r._functionExecutorMap[a]=new n(e.functions[a],r)})}return Object.defineProperty(n.prototype,"weightIds",{get:function(){return this.parent?this.parent.weightIds:this._weightIds},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"functionExecutorMap",{get:function(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"weightMap",{get:function(){return this.parent?this.parent.weightMap:this._weightMap},set:function(e){var t=Object.keys(e).map(function(r){return e[r].map(function(a){return a.id})});this._weightIds=[].concat.apply([],yn([],Ne(t),!1)),this._weightMap=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"resourceManager",{set:function(e){this._resourceManager=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"inputs",{get:function(){return this._inputs.map(function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"outputs",{get:function(){return this._outputs.map(function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"inputNodes",{get:function(){return this._inputs.map(function(e){return e.signatureKey||e.name})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"outputNodes",{get:function(){return this._outputs.map(function(e){var t=e.signatureKey||e.name;return e.defaultOutput?"".concat(t,":").concat(e.defaultOutput):t})},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"functions",{get:function(){var e=this;return Object.keys(this._functions).reduce(function(t,r){return t[r]=e._functions[r].signature,t},{})},enumerable:!1,configurable:!0}),n.prototype.getCompilationKey=function(e,t){var r=e.map(function(i){return i.name}).sort(),a=t.map(function(i){return i.name}).sort();return r.join(this.SEPERATOR)+"--"+a.join(this.SEPERATOR)},n.prototype.compile=function(e,t){var r=_4(e,t,this.weightMap,this._initNodes),a=r.missingInputs,i=r.dynamicNode,o=r.syncInputs;if(i!=null)throw new Error("This execution contains the node '".concat(i.name,"', which has ")+"the dynamic op '".concat(i.op,"'. Please use ")+"model.executeAsync() instead. Alternatively, to avoid the "+"dynamic ops, specify the inputs [".concat(o,"]"));if(a.length>0){var s=t.map(function(c){return c.name}),u=Object.keys(e);throw new Error("Cannot compute the outputs [".concat(s,"] from the provided inputs ")+"[".concat(u,"]. Missing the following inputs: [").concat(a,"]"))}return mDe(this.graph,this.weightMap,r)},n.prototype.cloneAndKeepTensor=function(e){if(e==null)return null;var t=e.clone();return Be.keep(t),t},n.prototype.cloneTensorList=function(e){var t=this;if(!e)return null;var r=e.map(function(a){return t.cloneAndKeepTensor(a)});return r},n.prototype.cloneTensorMap=function(e){var t=this;return Object.fromEntries(Object.entries(e).map(function(r){var a=Ne(r,2),i=a[0],o=a[1];return[i,t.cloneTensorList(o)]}))},n.prototype.execute=function(e,t){var r=this;this.disposeIntermediateTensors(),e=this.mapInputs(e);var a=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var i=a.map(function(h){return r.graph.nodes[Zr(h)[0]]}),o=t.map(function(h){return Zr(h)[0]}),s=o.map(function(h){return r.graph.nodes[h]});s.length===0&&(s=this._outputs);var u=this.getCompilationKey(i,s),c=this.compiledMap.get(u);c==null&&(c=this.compile(e,s),this.compiledMap.set(u,c));try{this.keepIntermediateTensors=Be.env().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(h){this.keepIntermediateTensors=!1,console.warn(h.message)}var l={},f={};return Be.tidy(function(){var h=new A4(r.weightMap,l,f,r.functionExecutorMap),p=Object.assign({},r.weightMap);r.keepIntermediateTensors&&(r.clonedTensorsMap=r.cloneTensorMap(r.weightMap)),Object.keys(e).forEach(function(b){var w=Ne(Zr(b),2),x=w[0],N=w[1],T=[];T[N]=e[b],p[x]=T,r.keepIntermediateTensors&&(r.clonedTensorsMap[x]=r.cloneTensorList(T))});for(var d=r.getFrozenTensorIds(p),v={},m=0;m<c.length;m++){var g=c[m];if(!p[g.name]){var y=C4(g,p,h,r._resourceManager);if(Be.util.isPromise(y))throw new Error("The execution of the op '".concat(g.op,"' returned a promise. ")+"Please use model.executeAsync() instead.");p[g.name]=y,r.keepIntermediateTensors&&(r.clonedTensorsMap[g.name]=r.cloneTensorList(y)),r.checkTensorForDisposal(g.name,g,p,h,d,o,v)}}return r.parent==null&&h.dispose(d),t.map(function(b){return gr(b,p,h)})})},n.prototype.getFrozenTensorIds=function(e){var t=[].concat.apply([],Object.keys(e).map(function(r){return e[r]}).map(function(r){return r.map(function(a){return a.id})}));return new Set(t)},n.prototype.checkTensorForDisposal=function(e,t,r,a,i,o,s){t.category==="control"||o.indexOf(e)!==-1||(r[e].forEach(function(u){u!=null&&(s[u.id]=(s[u.id]||0)+t.children.length)}),t.inputs.forEach(function(u){if(u.category!=="control"){var c=O1e(u.name,r,a);c?.forEach(function(l){if(l&&!l.kept&&!i.has(l.id)){var f=s[l.id];f===1?(l.dispose(),delete s[l.id]):f!=null&&s[l.id]--}})}}))},n.prototype.executeAsync=function(e,t){return Pt(this,void 0,void 0,function(){return _t(this,function(r){return[2,this._executeAsync(e,t)]})})},n.prototype.disposeIntermediateTensors=function(){!this.clonedTensorsMap||(Object.values(this.clonedTensorsMap).forEach(function(e){var t,r;try{for(var a=xc(e),i=a.next();!i.done;i=a.next()){var o=i.value;o&&!o.isDisposed&&o.dispose()}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}}),this.clonedTensorsMap=null)},n.prototype.getIntermediateTensors=function(){return this.clonedTensorsMap},n.prototype._executeAsync=function(e,t,r,a,i){return r===void 0&&(r=!1),a===void 0&&(a={}),i===void 0&&(i={}),Pt(this,void 0,void 0,function(){var o,s,u,c,l,f;return _t(this,function(h){switch(h.label){case 0:this.disposeIntermediateTensors(),r||(e=this.mapInputs(e),this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t));try{this.keepIntermediateTensors=Be.env().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(p){this.keepIntermediateTensors=!1,console.warn(p.message)}return o=new A4(this.weightMap,a,i,this.functionExecutorMap),this.keepIntermediateTensors&&(this.clonedTensorsMap=this.cloneTensorMap(this.weightMap)),[4,this.executeWithControlFlow(e,o,t,r)];case 1:return s=h.sent(),u=t.map(function(p){return gr(p,s,o)}),c=u.map(function(p){return p.id}),l=Object.keys(e).map(function(p){return e[p].id}),f=new Set(yn(yn(yn([],Ne(c),!1),Ne(l),!1),Ne(this.weightIds),!1)),Object.values(s).forEach(function(p){p.forEach(function(d){d&&!d.isDisposed&&!f.has(d.id)&&d.dispose()})}),this.parent==null&&o.dispose(f),[2,u]}})})},n.prototype.executeFunctionAsync=function(e,t,r){return Pt(this,void 0,void 0,function(){var a,i=this;return _t(this,function(o){return a=e.reduce(function(s,u,c){return s[i.inputs[c].name]=u,s},{}),[2,this._executeAsync(a,this.outputNodes,!0,t,r)]})})},n.prototype.executeWithControlFlow=function(e,t,r,a){return Pt(this,void 0,void 0,function(){var i,o,s,u,c,l,f,h,p,d,v,m,g,y,b,w,x,N=this;return _t(this,function(T){switch(T.label){case 0:i=Object.keys(e),o=i.map(function(E){return N.graph.nodes[Zr(E)[0]]}),s=r.map(function(E){return Zr(E)[0]}),u=s.map(function(E){return N.graph.nodes[E]}),u.length===0&&(u=this._outputs),c=_4(e,u,this.weightMap,this._initNodes),l=c.usedNodes,f=c.missingInputs,h=c.dynamicNode,p=c.syncInputs,d=yn(yn(yn([],Ne(o),!1),Ne(this.graph.weights),!1),Ne(this._initNodes||[]),!1).map(function(E){return{node:E,contexts:t.currentContext}}),v=Object.assign({},this.weightMap),Object.keys(e).forEach(function(E){var C=Ne(Zr(E),2),F=C[0],D=C[1],O=[];O[D]=e[E],v[F]=O}),m={},g=this.getFrozenTensorIds(v),y={},T.label=1;case 1:return d.length>0?(b=this.processStack(o,d,t,v,y,g,s,m,l),[4,Promise.all(b)]):[3,3];case 2:return T.sent(),[3,1];case 3:if(h==null&&!a&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),w=u.filter(function(E){return!OB(E)&&!gr(E.name,v,t)}).map(function(E){return E.name}),w.length>0)throw x="",h!=null&&(x="Alternatively, to avoid the dynamic ops, use model.execute() "+"and specify the inputs [".concat(p,"]")),new Error("Cannot compute the outputs [".concat(w,"] from the provided ")+"inputs [".concat(i,"]. Consider providing the following inputs: ")+"[".concat(f,"]. ").concat(x));return[2,v]}})})},n.prototype.processStack=function(e,t,r,a,i,o,s,u,c){for(var l=this,f=[],h=function(){var d,v,m=t.pop();r.currentContext=m.contexts;var g="";if(m.node.op==="Enter"&&I("isConstant",m.node,a,r)&&(d=Ne(ro(m.node.name,r),1),g=d[0]),a[m.node.name]==null){var y=C4(m.node,a,r,p._resourceManager);g||(v=Ne(ro(m.node.name,r),1),g=v[0]);var b=r.currentContext;Be.util.isPromise(y)?f.push(y.then(function(w){return a[g]=w,l.keepIntermediateTensors&&(l.clonedTensorsMap[g]=l.cloneTensorList(w)),r.currentContext=b,l.checkTensorForDisposal(g,m.node,a,r,o,s,u),l.processChildNodes(m.node,t,r,a,i,c),w})):(a[g]=y,p.keepIntermediateTensors&&(p.clonedTensorsMap[g]=p.cloneTensorList(y)),p.checkTensorForDisposal(g,m.node,a,r,o,s,u),p.processChildNodes(m.node,t,r,a,i,c))}else p.processChildNodes(m.node,t,r,a,i,c)},p=this;t.length>0;)h();return f},n.prototype.processChildNodes=function(e,t,r,a,i,o){e.children.forEach(function(s){var u=Ne(ro(s.name,r),1),c=u[0];i[c]||!o.has(s.name)||(s.op==="Merge"?s.inputNames.some(function(l){return!!gr(l,a,r)})&&(i[c]=!0,t.push({contexts:r.currentContext,node:s})):s.inputNames.every(function(l){return!!gr(l,a,r)})&&(i[c]=!0,t.push({contexts:r.currentContext,node:s})))})},n.prototype.dispose=function(){var e=this;Object.keys(this.weightMap).forEach(function(t){return e.weightMap[t].forEach(function(r){return r.dispose()})})},n.prototype.checkInputShapeAndType=function(e){var t=this;Object.keys(e).forEach(function(r){var a=e[r],i=Ne(Zr(r),1),o=i[0],s=t.graph.nodes[o];if(s.attrParams.shape&&s.attrParams.shape.value){var u=s.attrParams.shape.value,c=u.length===a.shape.length&&a.shape.every(function(l,f){return u[f]===-1||u[f]===l});Be.util.assert(c,function(){return"The shape of dict['".concat(s.name,"'] provided in ")+"model.execute(dict) must be [".concat(u,"], but was ")+"[".concat(a.shape,"]")})}s.attrParams.dtype&&s.attrParams.dtype.value&&Be.util.assert(a.dtype===s.attrParams.dtype.value,function(){return"The dtype of dict['".concat(s.name,"'] provided in ")+"model.execute(dict) must be "+"".concat(s.attrParams.dtype.value,", but was ").concat(a.dtype)})})},n.prototype.mapInputs=function(e){var t,r,a={};for(var i in e){var o=(r=(t=this._signature)===null||t===void 0?void 0:t.inputs)===null||r===void 0?void 0:r[i];o!=null?a[o.name]=e[i]:a[i]=e[i]}return a},n.prototype.checkInputs=function(e){var t=this,r=Object.keys(e).filter(function(a){var i=Ne(Zr(a),1),o=i[0];return t.graph.nodes[o]==null});if(r.length>0)throw new Error("The dict provided in model.execute(dict) has "+"keys: [".concat(r,"] that are not part of graph"))},n.prototype.mapOutputs=function(e){var t=this;return e.map(function(r){var a,i,o=(i=(a=t._signature)===null||a===void 0?void 0:a.outputs)===null||i===void 0?void 0:i[r];return o!=null?o.name:r},{})},n.prototype.checkOutputs=function(e){var t=this;e.forEach(function(r){var a=Ne(Zr(r),1),i=a[0];if(!t.graph.nodes[i])throw new Error("The output '".concat(r,"' is not found in the graph"))})},n}(),kDe=function(){function n(e,t){e===void 0&&(e={}),t===void 0&&(t={}),this.hashTableNameToHandle=e,this.hashTableMap=t}return n.prototype.addHashTable=function(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t},n.prototype.getHashTableHandleByName=function(e){return this.hashTableNameToHandle[e]},n.prototype.getHashTableById=function(e){return this.hashTableMap[e]},n.prototype.dispose=function(){for(var e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(var t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]},n}(),SDe="?tfjs-format=file",NDe="model.json",Kw=function(){function n(e,t,r){t===void 0&&(t={}),r===void 0&&(r=Be.io),this.modelUrl=e,this.loadOptions=t,this.version="n/a",this.io=r,t==null&&(this.loadOptions={}),this.resourceManager=new kDe}return Object.defineProperty(n.prototype,"modelVersion",{get:function(){return this.version},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"metadata",{get:function(){return this.artifacts.userDefinedMetadata},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"modelSignature",{get:function(){return this.signature},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"modelStructuredOutputKeys",{get:function(){return this.structuredOutputKeys},enumerable:!1,configurable:!0}),n.prototype.findIOHandler=function(){var e=this.modelUrl;if(e.load!=null)this.handler=e;else if(this.loadOptions.requestInit!=null)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{var t=this.io.getLoadHandlers(e,this.loadOptions);if(t.length===0)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one (".concat(t.length,") load handlers for ")+"URL '".concat([e],"'"));this.handler=t[0]}},n.prototype.load=function(){var e=this;if(this.findIOHandler(),this.handler.load==null)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");var t=this.handler.load();return Be.util.isPromise(t)?t.then(function(r){return e.loadSync(r)}):this.loadSync(t)},n.prototype.loadSync=function(e){this.artifacts=e;var t=this.artifacts.modelTopology,r=this.artifacts.signature;if(this.artifacts.userDefinedMetadata!=null){var a=this.artifacts.userDefinedMetadata;a.signature!=null&&(r=a.signature),a.structuredOutputKeys!=null&&(this.structuredOutputKeys=a.structuredOutputKeys)}this.signature=r,this.version="".concat(t.versions.producer,".").concat(t.versions.minConsumer);var i=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new D4(r4.Instance.transformGraph(t,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(i),this.executor.resourceManager=this.resourceManager,e.modelInitializer!=null&&e.modelInitializer.node!=null){var o=r4.Instance.transformGraph(e.modelInitializer);this.initializer=new D4(o),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializerSignature=e.initializerSignature}return!0},n.prototype.save=function(e,t){return Pt(this,void 0,void 0,function(){var r;return _t(this,function(a){if(typeof e=="string"){if(r=this.io.getSaveHandlers(e),r.length===0)throw new Error("Cannot find any save handlers for URL '".concat(e,"'"));if(r.length>1)throw new Error("Found more than one (".concat(r.length,") save handlers for ")+"URL '".concat(e,"'"));e=r[0]}if(e.save==null)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[2,e.save(this.artifacts)]})})},n.prototype.addStructuredOutputNames=function(e){var t=this;if(this.structuredOutputKeys){var r=e instanceof Be.Tensor?[e]:e,a={};return r.forEach(function(i,o){return a[t.structuredOutputKeys[o]]=i}),a}return e},n.prototype.predict=function(e,t){var r=this.execute(e,this.outputNodes);return this.addStructuredOutputNames(r)},n.prototype.predictAsync=function(e,t){return Pt(this,void 0,void 0,function(){var r;return _t(this,function(a){switch(a.label){case 0:return[4,this.executeAsync(e,this.outputNodes)];case 1:return r=a.sent(),[2,this.addStructuredOutputNames(r)]}})})},n.prototype.normalizeInputs=function(e){var t=this,r;if(!(e instanceof Be.Tensor)&&!Array.isArray(e)){var a=(r=this.signature)===null||r===void 0?void 0:r.inputs;if(a!=null)for(var i in a){var o=a[i];o.resourceId!=null&&(e[i]=this.resourceIdToCapturedInput[o.resourceId])}return e}e=Array.isArray(e)?e:[e];var s=Object.keys(this.resourceIdToCapturedInput).length;if(e.length+s!==this.inputNodes.length)throw new Error("Input tensor count mismatch, the graph model has ".concat(this.inputNodes.length-s," non-resource placeholders, while there are ").concat(e.length," input tensors provided."));var u=0;return this.inputNodes.reduce(function(c,l){var f,h,p,d=(p=(h=(f=t.signature)===null||f===void 0?void 0:f.inputs)===null||h===void 0?void 0:h[l])===null||p===void 0?void 0:p.resourceId;return d!=null?c[l]=t.resourceIdToCapturedInput[d]:c[l]=e[u++],c},{})},n.prototype.normalizeOutputs=function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]},n.prototype.executeInitializerGraph=function(){return this.initializer==null?[]:this.initializerSignature==null?this.initializer.execute({},[]):this.initializer.execute({},Object.keys(this.initializerSignature.outputs))},n.prototype.executeInitializerGraphAsync=function(){return Pt(this,void 0,void 0,function(){return _t(this,function(e){return this.initializer==null?[2,[]]:this.initializerSignature==null?[2,this.initializer.executeAsync({},[])]:[2,this.initializer.executeAsync({},Object.keys(this.initializerSignature.outputs))]})})},n.prototype.setResourceIdToCapturedInput=function(e){if(this.resourceIdToCapturedInput={},this.initializerSignature)for(var t=this.initializerSignature.outputs,r=Object.keys(t),a=0;a<r.length;a++){var i=r[a],o=t[i];this.resourceIdToCapturedInput[o.resourceId]=e[a]}},n.prototype.execute=function(e,t){this.resourceIdToCapturedInput==null&&this.setResourceIdToCapturedInput(this.executeInitializerGraph()),e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var r=this.executor.execute(e,t);return r.length>1?r:r[0]},n.prototype.executeAsync=function(e,t){return Pt(this,void 0,void 0,function(){var r,a;return _t(this,function(i){switch(i.label){case 0:return this.resourceIdToCapturedInput!=null?[3,2]:(r=this.setResourceIdToCapturedInput,[4,this.executeInitializerGraphAsync()]);case 1:r.apply(this,[i.sent()]),i.label=2;case 2:return e=this.normalizeInputs(e),t=this.normalizeOutputs(t),[4,this.executor.executeAsync(e,t)];case 3:return a=i.sent(),[2,a.length>1?a:a[0]]}})})},n.prototype.getIntermediateTensors=function(){return this.executor.getIntermediateTensors()},n.prototype.disposeIntermediateTensors=function(){this.executor.disposeIntermediateTensors()},n.prototype.convertTensorMapToTensorsMap=function(e){return Object.keys(e).reduce(function(t,r){return t[r]=[e[r]],t},{})},n.prototype.dispose=function(){this.executor.dispose(),this.initializer&&(this.initializer.dispose(),this.resourceIdToCapturedInput&&Be.dispose(this.resourceIdToCapturedInput)),this.resourceManager.dispose()},n}();function TDe(n,e,t){return e===void 0&&(e={}),t===void 0&&(t=Be.io),Pt(this,void 0,void 0,function(){var r;return _t(this,function(a){switch(a.label){case 0:if(n==null)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");return e==null&&(e={}),e.fromTFHub&&typeof n=="string"&&(n=IDe(n)),r=new Kw(n,e,t),[4,r.load()];case 1:return a.sent(),[2,r]}})})}function EDe(n){if(n==null)throw new Error("modelUrl in loadGraphModelSync() cannot be null. Please provide model artifacts or an IOHandler that loads the model");var e;if(n instanceof Array){var t=Ne(n,2),r=t[0],a=t[1];if(!r)throw new Error("modelJSON must be the first element of the array");if(!a||!(a instanceof ArrayBuffer))throw new Error("An ArrayBuffer of weights must be the second element of the array");if(!("modelTopology"in r))throw new Error("Model JSON is missing 'modelTopology'");if(!("weightsManifest"in r))throw new Error("Model JSON is missing 'weightsManifest'");var i=Be.io.getWeightSpecs(r.weightsManifest),o=Be.io.getModelArtifactsForJSONSync(r,i,a);e=Be.io.fromMemorySync(o)}else if("load"in n)e=n;else if("modelTopology"in n&&"weightSpecs"in n&&"weightData"in n)e=Be.io.fromMemorySync(n);else throw new Error("Unknown model format");var s=new Kw(e);return s.load(),s}function IDe(n){return n.endsWith("/")||(n=n+"/"),"".concat(n).concat(NDe).concat(SDe)}var CDe="4.2.0";jo.GraphModel=Kw;jo.deregisterOp=R1e;jo.loadGraphModel=TDe;jo.loadGraphModelSync=EDe;jo.registerOp=F1e;jo.version_converter=CDe});var jw=J(()=>{});var MB=J(()=>{});var rL=J(Rr=>{"use strict";Object.defineProperty(Rr,"__esModule",{value:!0});var wn=Cs();function ADe(n){if(n&&n.__esModule)return n;var e=Object.create(null);return n&&Object.keys(n).forEach(function(t){if(t!=="default"){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}}),e.default=n,e}var hn=ADe(wn),Yw=function(n,e){return Yw=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])},Yw(n,e)};function Dt(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");Yw(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Le(n,e,t,r){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(r.next(l))}catch(f){o(f)}}function u(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((r=r.apply(n,e||[])).next())})}function ze(n,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(l){c=[6,l],a=0}finally{r=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function ru(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function _De(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=r.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return i}function DDe(n,e,t){if(t||arguments.length===2)for(var r=0,a=e.length,i;r<a;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}var au=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function FDe(n){if(n.__esModule)return n;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(n).forEach(function(t){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}),e}function iu(n){var e={exports:{}};return n(e,e.exports),e.exports}var RDe=iu(function(n){(function(e,t,r){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.alea=o})(au,n,!1)}),ODe=iu(function(n){(function(e,t,r){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor128=o})(au,n,!1)}),PDe=iu(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorwow=o})(au,n,!1)}),MDe=iu(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,p;return h=l[f],h^=h>>>7,p=h^h<<24,h=l[f+1&7],p^=h^h>>>10,h=l[f+3&7],p^=h^h>>>3,h=l[f+4&7],p^=h^h<<7,h=l[f+7&7],h=h^h<<13,p^=h^h<<9,l[f]=p,u.i=f+1&7,p};function c(l,f){var h,p=[];if(f===(f|0))p[0]=f;else for(f=""+f,h=0;h<f.length;++h)p[h&7]=p[h&7]<<15^f.charCodeAt(h)+p[h+1&7]<<13;for(;p.length<8;)p.push(0);for(h=0;h<8&&p[h]===0;++h);for(h==8&&(p[7]=-1),l.x=p,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorshift7=o})(au,n,!1)}),BDe=iu(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,p,d;return u.w=l=l+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(l^l>>>16)|0};function c(l,f){var h,p,d,v,m,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,v=-32;v<y;++v)f&&(p^=f.charCodeAt((v+32)%f.length)),v===0&&(m=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,v>=0&&(m=m+1640531527|0,h=g[v&127]^=p+m,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,v=4*128;v>0;--v)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;l.w=m,l.X=g,l.i=d}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor4096=o})(au,n,!1)}),LDe=iu(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.tychei=o})(au,n,!1)}),zDe={},$De={__proto__:null,default:zDe},qDe=FDe($De),ou=iu(function(n){(function(e,t,r){var a=256,i=6,o=52,s="random",u=r.pow(a,i),c=r.pow(2,o),l=c*2,f=a-1,h;function p(w,x,N){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(m(x.entropy?[w,b(t)]:w??y(),3),T),C=new d(T),F=function(){for(var D=C.g(i),O=u,L=0;D<c;)D=(D+L)*a,O*=a,L=C.g(1);for(;D>=l;)D/=2,O/=2,L>>>=1;return(D+L)/O};return F.int32=function(){return C.g(4)|0},F.quick=function(){return C.g(4)/4294967296},F.double=F,g(b(C.S),t),(x.pass||N||function(D,O,L,z){return z&&(z.S&&v(z,C),D.state=function(){return v(C,{})}),L?(r[s]=D,O):D})(F,E,"global"in x?x.global:this==r,x.state)}function d(w){var x,N=w.length,T=this,E=0,C=T.i=T.j=0,F=T.S=[];for(N||(w=[N++]);E<a;)F[E]=E++;for(E=0;E<a;E++)F[E]=F[C=f&C+w[E%N]+(x=F[E])],F[C]=x;(T.g=function(D){for(var O,L=0,z=T.i,$=T.j,B=T.S;D--;)O=B[z=f&z+1],L=L*a+B[f&(B[z]=B[$=f&$+O])+(B[$]=O)];return T.i=z,T.j=$,L})(a)}function v(w,x){return x.i=w.i,x.j=w.j,x.S=w.S.slice(),x}function m(w,x){var N=[],T=typeof w,E;if(x&&T=="object")for(E in w)try{N.push(m(w[E],x-1))}catch{}return N.length?N:T=="string"?w:w+"\0"}function g(w,x){for(var N=w+"",T,E=0;E<N.length;)x[f&E]=f&(T^=x[f&E]*19)+N.charCodeAt(E++);return b(x)}function y(){try{var w;return h&&(w=h.randomBytes)?w=w(a):(w=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var x=e.navigator,N=x&&x.plugins;return[+new Date,e,N,e.screen,b(t)]}}function b(w){return String.fromCharCode.apply(0,w)}if(g(r.random(),t),n.exports){n.exports=p;try{h=qDe}catch{}}else r["seed"+s]=p})(typeof self<"u"?self:au,[],Math)});ou.alea=RDe;ou.xor128=ODe;ou.xorwow=PDe;ou.xorshift7=MDe;ou.xor4096=BDe;ou.tychei=LDe;var $B=ou;function WDe(n,e){return qv(n,e)}function qv(n,e,t,r){if(t===void 0&&(t=new Map),r===void 0&&(r=new Set),n==null)return null;if(typeof Blob=="function"&&n instanceof Blob)return n.slice();if(r.has(n))throw new Error("Circular references are not supported.");if(t.has(n))return t.get(n);var a=e(n);if(a.recurse&&a.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse)if(Ac(n)){var i=Array.isArray(n)?[]:{};r.add(n);for(var o in n){var s=n[o],u=qv(s,e,t,r);i[o]=u}return r.delete(n),n.__proto__&&(i.__proto__=n.__proto__),i}else throw new Error("Can't recurse into non-iterable type: ".concat(n));else return t.set(n,a.value),a.value}function VDe(n,e){return e===void 0&&(e=WB),qB(n,e)}function qB(n,e,t){t===void 0&&(t=new Set);var r=n[0];if(t.has(r))throw new Error("Circular references are not supported.");var a=e(n);if(a.recurse&&a.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse)if(Ac(r)){var i=Array.isArray(r)?[]:{};t.add(r);var o=function(u){var c=n.map(function(f){return f[u]}),l=qB(c,e,t);i[u]=l};for(var s in r)o(s);return t.delete(r),i}else throw new Error("Can't recurse into non-iterable type: ".concat(r));else return a.value}function WB(n){return n===null?null:Ac(n[0])?{value:null,recurse:!0}:{value:n,recurse:!1}}function VB(n,e){return Le(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f;return ze(this,function(h){switch(h.label){case 0:t=new Map,qv(n,e,t),h.label=1;case 1:h.trys.push([1,6,7,8]),r=ru(Array.from(t.keys())),a=r.next(),h.label=2;case 2:return a.done?[3,5]:(i=a.value,o=t.get(i),hn.util.isPromise(o)?[4,o]:[3,4]);case 3:s=h.sent(),t.set(i,s),h.label=4;case 4:return a=r.next(),[3,2];case 5:return[3,8];case 6:return u=h.sent(),l={error:u},[3,8];case 7:try{a&&!a.done&&(f=r.return)&&f.call(r)}finally{if(l)throw l.error}return[7];case 8:return c=qv(n,e,t),[2,c]}})})}function Ac(n){var e=!1;if(hn.env().get("IS_BROWSER"))e=n instanceof TextDecoder;else{var t=jw().StringDecoder;e=n instanceof t}return n!=null&&!ArrayBuffer.isView(n)&&(Array.isArray(n)||typeof n=="object"&&!(n instanceof hn.Tensor)&&!(n instanceof Promise)&&!e)}function GDe(n){return n==null||UDe(n)||Array.isArray(n)||typeof n=="object"&&n instanceof hn.Tensor||hn.util.isTypedArray(n)}function UDe(n){return n===null||typeof n!="object"&&typeof n!="function"}function HDe(n){return WDe(n,KDe)}function KDe(n){return n instanceof hn.Tensor?{value:n.clone(),recurse:!1}:Ac(n)?{value:null,recurse:!0}:{value:n,recurse:!1}}var GB=function(){function n(e){if(this.capacity=e,this.begin=0,this.end=0,e==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}return n.prototype.wrap=function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity},n.prototype.get=function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]},n.prototype.set=function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t},n.prototype.length=function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e},n.prototype.isFull=function(){return this.length()===this.capacity},n.prototype.isEmpty=function(){return this.length()===0},n.prototype.push=function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)},n.prototype.pushAll=function(e){var t,r;try{for(var a=ru(e),i=a.next();!i.done;i=a.next()){var o=i.value;this.push(o)}}catch(s){t={error:s}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}},n.prototype.pop=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e},n.prototype.unshift=function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)},n.prototype.shift=function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e},n.prototype.shuffleExcise=function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),r=this.get(t);return this.set(t,this.pop()),r},n}(),UB=function(n){Dt(e,n);function e(){return n.call(this,e.INITIAL_CAPACITY)||this}return e.prototype.isFull=function(){return!1},e.prototype.push=function(t){n.prototype.isFull.call(this)&&this.expand(),n.prototype.push.call(this,t)},e.prototype.unshift=function(t){n.prototype.isFull.call(this)&&this.expand(),n.prototype.unshift.call(this,t)},e.prototype.expand=function(){for(var t=this.capacity*2,r=new Array(t),a=this.length(),i=0;i<a;i++)r[i]=this.get(this.wrap(this.begin+i));this.data=r,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=a},e}(GB);UB.INITIAL_CAPACITY=32;function HB(n){return new YDe(n)}function Zw(n){return new ZDe(n)}function jDe(n,e){return new KB(n,e)}function XDe(n,e){return e===void 0&&(e=Xo.FAIL),new o3e(n,e)}var Yn=function(){function n(){}return n.prototype.toArray=function(){return Le(this,void 0,void 0,function(){var e,t;return ze(this,function(r){switch(r.label){case 0:return e=[],[4,this.next()];case 1:t=r.sent(),r.label=2;case 2:return t.done?[3,4]:(e.push(t.value),[4,this.next()]);case 3:return t=r.sent(),[3,2];case 4:return[2,e]}})})},n.prototype.toArrayForTest=function(){return Le(this,void 0,void 0,function(){var e,t,r;return ze(this,function(a){switch(a.label){case 0:return e=this.prefetch(100),t=[],[4,e.next()];case 1:r=a.sent(),a.label=2;case 2:return r.done?[3,4]:(t.push(r.value),[4,e.next()]);case 3:return r=a.sent(),[3,2];case 4:return[2,t]}})})},n.prototype.resolveFully=function(){return Le(this,void 0,void 0,function(){var e;return ze(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:e=t.sent(),t.label=2;case 2:return e.done?[3,4]:[4,this.next()];case 3:return e=t.sent(),[3,2];case 4:return[2]}})})},n.prototype.resolveWhile=function(e){return Le(this,void 0,void 0,function(){var t,r;return ze(this,function(a){switch(a.label){case 0:return[4,this.next()];case 1:t=a.sent(),r=e(t.value),a.label=2;case 2:return!t.done&&r?[4,this.next()]:[3,4];case 3:return t=a.sent(),r=e(t.value),[3,2];case 4:return[2]}})})},n.prototype.handleErrors=function(e){return new a3e(this,e)},n.prototype.filter=function(e){return new n3e(this,e)},n.prototype.map=function(e){return new r3e(this,e)},n.prototype.mapAsync=function(e){return new BB(this,e)},n.prototype.serialMapAsync=function(e){return new BB(this,e).serial()},n.prototype.flatmap=function(e){return new i3e(this,e)},n.prototype.forEachAsync=function(e){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,this.map(e).resolveFully()]})})},n.prototype.serialForEach=function(e){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,this.serialMapAsync(e).resolveWhile(function(r){return r===!0})]})})},n.prototype.rowMajorBatch=function(e,t){return t===void 0&&(t=!0),new t3e(this,e,t)},n.prototype.columnMajorBatch=function(e,t,r){t===void 0&&(t=!0),r===void 0&&(r=WB);var a=this.rowMajorBatch(e,t);return a.map(function(i){return VDe(i,r)})},n.prototype.concatenate=function(e,t){return new KB(HB([this,e]),t)},n.prototype.take=function(e){return e<0||e==null?this:new e3e(this,e)},n.prototype.skip=function(e){return e<0||e==null?this:new QDe(this,e)},n.prototype.prefetch=function(e){return new jB(this,e)},n.prototype.shuffle=function(e,t){return new s3e(this,e,t)},n.prototype.serial=function(){return new JDe(this)},n}(),YDe=function(n){Dt(e,n);function e(t){var r=n.call(this)||this;return r.items=t,r.trav=0,r}return e.prototype.summary=function(){return"Array of ".concat(this.items.length," items")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(r){return this.trav>=this.items.length?[2,{value:null,done:!0}]:(t=this.items[this.trav],this.trav++,[2,{value:HDe(t),done:!1}])})})},e}(Yn),ZDe=function(n){Dt(e,n);function e(t){var r=n.call(this)||this;return r.nextFn=t,r}return e.prototype.summary=function(){return"Function call"},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){try{return[2,this.nextFn()]}catch(r){throw r.message="Error thrown while iterating through a dataset: ".concat(r.message),r}return[2]})})},e}(Yn),JDe=function(n){Dt(e,n);function e(t){var r=n.call(this)||this;return r.upstream=t,r.lastRead=Promise.resolve({value:null,done:!1}),r}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Serial")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(r){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,this.upstream.next()]})})},e}(Yn),QDe=function(n){Dt(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.maxCount=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Skip")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(r){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(r){switch(r.label){case 0:return this.count++<this.maxCount?[4,this.upstream.next()]:[3,2];case 1:return t=r.sent(),t.done?[2,t]:(hn.dispose(t.value),[3,0]);case 2:return[2,this.upstream.next()]}})})},e}(Yn),e3e=function(n){Dt(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.maxCount=r,a.count=0,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Take")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return this.count++>=this.maxCount?[2,{value:null,done:!0}]:[2,this.upstream.next()]})})},e}(Yn),t3e=function(n){Dt(e,n);function e(t,r,a){a===void 0&&(a=!0);var i=n.call(this)||this;return i.upstream=t,i.batchSize=r,i.enableSmallLastBatch=a,i.lastRead=Promise.resolve({value:null,done:!1}),i}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> RowMajorBatch")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(r){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t,r;return ze(this,function(a){switch(a.label){case 0:t=[],a.label=1;case 1:return t.length<this.batchSize?[4,this.upstream.next()]:[3,3];case 2:return r=a.sent(),r.done?this.enableSmallLastBatch&&t.length>0?[2,{value:t,done:!1}]:[2,{value:null,done:!0}]:(t.push(r.value),[3,1]);case 3:return[2,{value:t,done:!1}]}})})},e}(Yn),n3e=function(n){Dt(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.predicate=r,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Filter")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(r){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(r){switch(r.label){case 0:return[4,this.upstream.next()];case 1:return t=r.sent(),t.done||this.predicate(t.value)?[2,t]:(hn.dispose(t.value),[3,0]);case 2:return[2]}})})},e}(Yn),r3e=function(n){Dt(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.transform=r,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Map")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l;return ze(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:if(t=f.sent(),t.done)return[2,{value:null,done:!0}];r=hn.tensor_util.getTensorsInContainer(t.value),a=this.transform(t.value),i=hn.tensor_util.getTensorsInContainer(a);try{for(o=ru(r),s=o.next();!s.done;s=o.next())u=s.value,hn.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){c={error:h}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}return[2,{value:a,done:!1}]}})})},e}(Yn),a3e=function(n){Dt(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.handler=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> handleErrors")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(r){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(r){switch(r.label){case 0:r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.upstream.next()];case 2:return[2,r.sent()];case 3:return t=r.sent(),this.handler(t)?[3,4]:[2,{value:null,done:!0}];case 4:return[3,0];case 5:return[2]}})})},e}(Yn),BB=function(n){Dt(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.transform=r,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> AsyncMap")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l;return ze(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:return t=f.sent(),t.done?[2,{value:null,done:!0}]:(r=hn.tensor_util.getTensorsInContainer(t.value),[4,this.transform(t.value)]);case 2:a=f.sent(),i=hn.tensor_util.getTensorsInContainer(a);try{for(o=ru(r),s=o.next();!s.done;s=o.next())u=s.value,hn.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){c={error:h}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}return[2,{value:a,done:!1}]}})})},e}(Yn),Jw=function(n){Dt(e,n);function e(){var t=n.call(this)||this;return t.outputQueue=new UB,t.lastRead=Promise.resolve({value:null,done:!1}),t}return e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(r){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){switch(t.label){case 0:return this.outputQueue.length()!==0?[3,2]:[4,this.pump()];case 1:return t.sent()?[3,0]:[2,{value:null,done:!0}];case 2:return[2,{value:this.outputQueue.shift(),done:!1}]}})})},e}(Yn),i3e=function(n){Dt(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.transform=r,a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Flatmap")},e.prototype.pump=function(){return Le(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l;return ze(this,function(f){switch(f.label){case 0:return[4,this.upstream.next()];case 1:if(t=f.sent(),t.done)return[2,!1];r=hn.tensor_util.getTensorsInContainer(t.value),a=this.transform(t.value),i=hn.tensor_util.getTensorsInContainer(a),this.outputQueue.pushAll(a);try{for(o=ru(r),s=o.next();!s.done;s=o.next())u=s.value,hn.tensor_util.isTensorInList(u,i)||u.dispose()}catch(h){c={error:h}}finally{try{s&&!s.done&&(l=o.return)&&l.call(o)}finally{if(c)throw c.error}}return[2,!0]}})})},e}(Jw),KB=function(n){Dt(e,n);function e(t,r){var a=n.call(this)||this;return a.baseErrorHandler=r,a.lastRead=null,a.iterator=null,a.moreIterators=t,a}return e.prototype.summary=function(){var t="TODO: fill in upstream of chained summaries";return"".concat(t," -> Chained")},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return this.lastRead=this.readFromChain(this.lastRead),[2,this.lastRead]})})},e.prototype.readFromChain=function(t){return Le(this,void 0,void 0,function(){var r,a;return ze(this,function(i){switch(i.label){case 0:return[4,t];case 1:return i.sent(),this.iterator!=null?[3,3]:[4,this.moreIterators.next()];case 2:if(r=i.sent(),r.done)return[2,{value:null,done:!0}];this.iterator=r.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler)),i.label=3;case 3:return[4,this.iterator.next()];case 4:return a=i.sent(),a.done?(this.iterator=null,[2,this.readFromChain(t)]):[2,a]}})})},e}(Yn),Xo;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(Xo||(Xo={}));var o3e=function(n){Dt(e,n);function e(t,r){r===void 0&&(r=Xo.FAIL);var a=n.call(this)||this;return a.iterators=t,a.mismatchMode=r,a.count=0,a.currentPromise=null,a}return e.prototype.summary=function(){var t="TODO: fill in upstream of zip summaries";return"{".concat(t,"} -> Zip")},e.prototype.nextState=function(t){return Le(this,void 0,void 0,function(){function r(s){if(s instanceof Yn){var u=s.next();return{value:u.then(function(c){return a++,c.done&&i++,c.value}),recurse:!1}}else return{value:null,recurse:!0}}var a,i,o;return ze(this,function(s){switch(s.label){case 0:return[4,t];case 1:return s.sent(),a=0,i=0,[4,VB(this.iterators,r)];case 2:if(o=s.sent(),a===i)return[2,{value:null,done:!0}];if(i>0)switch(this.mismatchMode){case Xo.FAIL:throw new Error("Zipped streams should have the same length. "+"Mismatched at element ".concat(this.count,"."));case Xo.SHORTEST:return[2,{value:null,done:!0}];case Xo.LONGEST:}return this.count++,[2,{value:o,done:!1}]}})})},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return this.currentPromise=this.nextState(this.currentPromise),[2,this.currentPromise]})})},e}(Yn),jB=function(n){Dt(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.bufferSize=r,a.buffer=new GB(r),a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Prefetch")},e.prototype.refill=function(){for(;!this.buffer.isFull();){var t=this.upstream.next();this.buffer.push(t)}},e.prototype.next=function(){return this.refill(),this.buffer.shift()},e}(Yn),s3e=function(n){Dt(e,n);function e(t,r,a){var i=n.call(this,t,r)||this;return i.upstream=t,i.windowSize=r,i.upstreamExhausted=!1,i.random=$B.alea(a||hn.util.now().toString()),i.lastRead=Promise.resolve({value:null,done:!1}),i}return e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t=this;return ze(this,function(r){return this.lastRead=this.lastRead.then(function(){return t.serialNext()}),[2,this.lastRead]})})},e.prototype.randomInt=function(t){return Math.floor(this.random()*t)},e.prototype.chooseIndex=function(){return this.randomInt(this.buffer.length())},e.prototype.serialNext=function(){return Le(this,void 0,void 0,function(){var t,r;return ze(this,function(a){switch(a.label){case 0:this.upstreamExhausted||this.refill(),a.label=1;case 1:return this.buffer.isEmpty()?[3,3]:(t=this.chooseIndex(),[4,this.buffer.shuffleExcise(t)]);case 2:if(r=a.sent(),r.done)this.upstreamExhausted=!0;else return this.refill(),[2,r];return[3,1];case 3:return[2,{value:null,done:!0}]}})})},e}(jB),_c=function(){function n(){this.size=null}return n.prototype.batch=function(e,t){var r=this;t===void 0&&(t=!0);var a=this;hn.util.assert(e>0,function(){return`batchSize needs to be positive, but it is
      `.concat(e)});var i;return this.size===1/0||this.size==null?i=this.size:t?i=Math.ceil(this.size/e):i=Math.floor(this.size/e),ta(function(){return Le(r,void 0,void 0,function(){return ze(this,function(o){switch(o.label){case 0:return[4,a.iterator()];case 1:return[2,o.sent().columnMajorBatch(e,t,l3e)]}})})},i)},n.prototype.concatenate=function(e){var t=this,r=this,a;return this.size===1/0||e.size===1/0?a=1/0:this.size!=null&&e.size!=null?a=this.size+e.size:a=null,ta(function(){return Le(t,void 0,void 0,function(){var i,o;return ze(this,function(s){switch(s.label){case 0:return[4,r.iterator()];case 1:return o=(i=s.sent()).concatenate,[4,e.iterator()];case 2:return[2,o.apply(i,[s.sent()])]}})})},a)},n.prototype.filter=function(e){var t=this,r=this,a;return this.size===1/0?a=1/0:a=null,ta(function(){return Le(t,void 0,void 0,function(){return ze(this,function(i){switch(i.label){case 0:return[4,r.iterator()];case 1:return[2,i.sent().filter(function(o){return hn.tidy(function(){return e(o)})})]}})})},a)},n.prototype.forEachAsync=function(e){return Le(this,void 0,void 0,function(){return ze(this,function(t){switch(t.label){case 0:return[4,this.iterator()];case 1:return[2,t.sent().forEachAsync(e)]}})})},n.prototype.map=function(e){var t=this,r=this;return ta(function(){return Le(t,void 0,void 0,function(){return ze(this,function(a){switch(a.label){case 0:return[4,r.iterator()];case 1:return[2,a.sent().map(function(i){return hn.tidy(function(){return e(i)})})]}})})},this.size)},n.prototype.mapAsync=function(e){var t=this,r=this;return ta(function(){return Le(t,void 0,void 0,function(){return ze(this,function(a){switch(a.label){case 0:return[4,r.iterator()];case 1:return[2,a.sent().mapAsync(e)]}})})},this.size)},n.prototype.prefetch=function(e){var t=this;if(e==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var r=this;return ta(function(){return Le(t,void 0,void 0,function(){return ze(this,function(a){switch(a.label){case 0:return[4,r.iterator()];case 1:return[2,a.sent().prefetch(e)]}})})},this.size)},n.prototype.repeat=function(e){var t=this,r=this,a;return this.size!=null&&e>0?a=this.size*e:e===0?a=0:this.size!=null&&(e===void 0||e<0)?a=1/0:a=null,ta(function(){return Le(t,void 0,void 0,function(){var i,o=this;return ze(this,function(s){return i=Zw(function(){return Le(o,void 0,void 0,function(){var u;return ze(this,function(c){switch(c.label){case 0:return u={},[4,r.iterator()];case 1:return[2,(u.value=c.sent(),u.done=!1,u)]}})})}),[2,jDe(i.take(e))]})})},a)},n.prototype.skip=function(e){var t=this,r=this,a;return this.size!=null&&e>=0&&this.size>=e?a=this.size-e:this.size!=null&&(this.size<e||e===void 0||e<0)?a=0:a=null,ta(function(){return Le(t,void 0,void 0,function(){return ze(this,function(i){switch(i.label){case 0:return[4,r.iterator()];case 1:return[2,i.sent().skip(e)]}})})},a)},n.prototype.shuffle=function(e,t,r){var a=this;if(r===void 0&&(r=!0),e==null||e<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting "+"bufferSize to the dataset size (".concat(this.size," elements)"));var i=this,o=$B.alea(t||hn.util.now().toString());return ta(function(){return Le(a,void 0,void 0,function(){var s;return ze(this,function(u){switch(u.label){case 0:return s=o.int32(),r&&(s+=o.int32()),[4,i.iterator()];case 1:return[2,u.sent().shuffle(e,s.toString())]}})})},this.size)},n.prototype.take=function(e){var t=this,r=this,a;return this.size!=null&&this.size>e?a=e:this.size!=null&&this.size<=e?a=this.size:a=null,ta(function(){return Le(t,void 0,void 0,function(){return ze(this,function(i){switch(i.label){case 0:return[4,r.iterator()];case 1:return[2,i.sent().take(e)]}})})},a)},n.prototype.toArray=function(){return Le(this,void 0,void 0,function(){return ze(this,function(e){switch(e.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,e.sent().toArray()]}})})},n.prototype.toArrayForTest=function(){return Le(this,void 0,void 0,function(){return ze(this,function(e){switch(e.label){case 0:if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return[4,this.iterator()];case 1:return[2,e.sent().toArrayForTest()]}})})},n}();_c.MAX_BUFFER_SIZE=1e4;function ta(n,e){return e===void 0&&(e=null),new(function(t){Dt(r,t);function r(){var a=t.apply(this,DDe([],_De(arguments),!1))||this;return a.size=e,a}return r.prototype.iterator=function(){return Le(this,void 0,void 0,function(){return ze(this,function(a){return[2,n()]})})},r}(_c))}function u3e(n){var e=this;return ta(function(){return Le(e,void 0,void 0,function(){return ze(this,function(t){return[2,HB(n)]})})},n.length)}function c3e(n){var e=this;if(!Ac(n))throw new Error("The argument to zip() must be an object or array.");var t;if(Array.isArray(n))for(var r=0;r<n.length;r++)t=t==null?n[r].size:Math.min(t,n[r].size);else if(n instanceof Object)for(var a in n)t=t==null?n[a].size:Math.min(t,n[a].size);return ta(function(){return Le(e,void 0,void 0,function(){var i;return ze(this,function(o){switch(o.label){case 0:return[4,VB(n,function(s){if(s instanceof _c)return{value:s.iterator(),recurse:!1};if(Ac(s))return{value:null,recurse:!0};throw new Error("Leaves of the structure passed to zip() must be Datasets, not primitives.")})];case 1:return i=o.sent(),[2,XDe(i,Xo.SHORTEST)]}})})},t)}function l3e(n){if(n===null)return null;var e=n[0];if(GDe(e)){var t=f3e(n);return{value:t,recurse:!1}}return{value:null,recurse:!0}}function f3e(n){if(n.length===0)throw new Error("Can't make a batch of zero elements.");return n[0]instanceof hn.Tensor?hn.stack(n):hn.tensor(n)}var XB=function(n){Dt(e,n);function e(t){var r=n.call(this)||this;return r.input=t,r}return e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){var t,r,a;return ze(this,function(i){switch(i.label){case 0:return[4,this.input.iterator()];case 1:return t=i.sent(),r=t.decodeUTF8(),a=r.split(`
`).map(function(o){return o.endsWith("\r")&&(o=o.slice(0,-1)),o}),[2,a]}})})},e}(_c),zv='"',Jf=Symbol("out"),LB=Symbol("field"),$v=Symbol("quote"),Xw=Symbol("quoteafterquote"),zB=Symbol("quoteinquote"),YB=function(n){Dt(e,n);function e(t,r){var a=n.call(this)||this;return a.input=t,a.hasHeader=!0,a.fullColumnNames=null,a.columnNamesValidated=!1,a.columnConfigs=null,a.configuredColumnsOnly=!1,a.delimiter=",",a.delimWhitespace=!1,a.base=new XB(t),r||(r={}),a.hasHeader=r.hasHeader!==!1,a.fullColumnNames=r.columnNames,a.columnConfigs=r.columnConfigs,a.configuredColumnsOnly=r.configuredColumnsOnly,r.delimWhitespace?(wn.util.assert(r.delimiter==null,function(){return"Delimiter should not be provided when delimWhitespace is true."}),a.delimWhitespace=!0,a.delimiter=" "):a.delimiter=r.delimiter?r.delimiter:",",a}return e.prototype.columnNames=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){switch(t.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:t.sent(),t.label=2;case 2:return[2,this.configuredColumnsOnly?Object.keys(this.columnConfigs):this.fullColumnNames]}})})},e.prototype.setColumnNames=function(){return Le(this,void 0,void 0,function(){var t,r,a,i,o,s,u,c,l,f=this;return ze(this,function(h){switch(h.label){case 0:return[4,this.maybeReadHeaderLine()];case 1:if(t=h.sent(),!this.fullColumnNames&&!t)throw new Error("Column names must be provided if there is no header line.");if(this.fullColumnNames&&t&&wn.util.assert(t.length===this.fullColumnNames.length,function(){return"The length of provided columnNames ("+f.fullColumnNames.length.toString()+") does not match the length of the header line read from file ("+t.length.toString()+")."}),this.fullColumnNames||(this.fullColumnNames=t),r=this.fullColumnNames.reduce(function(p,d){return p[d]=p[d]+1||1,p},{}),a=Object.keys(r).filter(function(p){return r[p]>1}),wn.util.assert(a.length===0,function(){return"Duplicate column names found: "+a.toString()}),this.columnConfigs)try{for(i=ru(Object.keys(this.columnConfigs)),o=i.next();!o.done;o=i.next())if(s=o.value,u=this.fullColumnNames.indexOf(s),u===-1)throw new Error('The key "'+s+'" provided in columnConfigs does not match any of the column names ('+this.fullColumnNames.toString()+").")}catch(p){c={error:p}}finally{try{o&&!o.done&&(l=i.return)&&l.call(i)}finally{if(c)throw c.error}}return this.columnNamesValidated=!0,[2]}})})},e.prototype.maybeReadHeaderLine=function(){return Le(this,void 0,void 0,function(){var t,r,a,i;return ze(this,function(o){switch(o.label){case 0:return this.hasHeader?[4,this.base.iterator()]:[3,3];case 1:return t=o.sent(),[4,t.next()];case 2:if(r=o.sent(),r.done)throw new Error("No data was found for CSV parsing.");return a=r.value,i=this.parseRow(a,!1),[2,i];case 3:return[2,null]}})})},e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){var t,r=this;return ze(this,function(a){switch(a.label){case 0:return this.columnNamesValidated?[3,2]:[4,this.setColumnNames()];case 1:a.sent(),a.label=2;case 2:return[4,this.base.iterator()];case 3:return t=a.sent(),this.hasHeader&&(t=t.skip(1)),[2,t.map(function(i){return r.makeDataElement(i)})]}})})},e.prototype.makeDataElement=function(t){for(var r=this.parseRow(t),a={},i={},o=0;o<this.fullColumnNames.length;o++){var s=this.fullColumnNames[o],u=this.columnConfigs?this.columnConfigs[s]:null;if(!(this.configuredColumnsOnly&&!u)){var c=r[o],l=null;if(c==="")if(u&&u.default!==void 0)l=u.default;else{if(u&&(u.required||u.isLabel))throw new Error("Required column ".concat(s," is empty in this line: ").concat(t));l=void 0}else{var f=Number(c);if(isNaN(f))u&&u.dtype==="bool"?l=this.getBoolean(c):l=c;else if(!u||!u.dtype)l=f;else switch(u.dtype){case"float32":l=f;break;case"int32":l=Math.floor(f);break;case"bool":l=this.getBoolean(c);break;default:l=f}}u&&u.isLabel?i[s]=l:a[s]=l}}return Object.keys(i).length===0?a:{xs:a,ys:i}},e.prototype.getBoolean=function(t){return t==="1"||t.toLowerCase()==="true"?1:0},e.prototype.parseRow=function(t,r){r===void 0&&(r=!0);for(var a=[],i=0,o=t.length,s=Jf,u=0;u<o;u++)switch(s){case Jf:switch(t.charAt(u)){case zv:i=u+1,s=$v;break;case this.delimiter:if(i=u+1,this.delimiter===" "&&this.delimWhitespace)break;a.push(""),s=Jf;break;default:s=LB,i=u;break}break;case LB:switch(t.charAt(u)){case this.delimiter:a.push(t.substring(i,u)),s=Jf,i=u+1;break}break;case $v:switch(t.charAt(u)){case zv:s=Xw;break}break;case Xw:switch(t.charAt(u)){case this.delimiter:a.push(t.substring(i,u-1)),s=Jf,i=u+1;break;case zv:s=$v;break;default:s=zB;break}break;case zB:switch(t.charAt(u)){case zv:s=$v;break}break}if(s===Xw?a.push(t.substring(i,o-1)):a.push(t.substring(i)),r&&a.length!==this.fullColumnNames.length)throw new Error("Invalid row in csv file. Should have ".concat(this.fullColumnNames.length," elements in a row, but got ").concat(a));return a},e}(_c),h3e=function(n){Dt(e,n);function e(t){var r=n.call(this)||this;r.microphoneConfig=t,r.isClosed=!1,r.fftSize=t.fftSize||1024;var a=Math.log2(r.fftSize);if(r.fftSize<0||a<4||a>14||!Number.isInteger(a))throw new Error("Invalid fftSize: it must be a power of 2 between "+"2 to 4 and 2 to 14, but got ".concat(r.fftSize));if(r.numFrames=t.numFramesPerSpectrogram||43,r.sampleRateHz=t.sampleRateHz,r.columnTruncateLength=t.columnTruncateLength||r.fftSize,r.audioTrackConstraints=t.audioTrackConstraints,r.smoothingTimeConstant=t.smoothingTimeConstant||0,r.includeSpectrogram=t.includeSpectrogram!==!1,r.includeWaveform=t.includeWaveform===!0,!r.includeSpectrogram&&!r.includeWaveform)throw new Error("Both includeSpectrogram and includeWaveform are false. At least one type of data should be returned.");return r}return e.prototype.summary=function(){return"microphone"},e.create=function(t){return t===void 0&&(t={}),Le(this,void 0,void 0,function(){var r;return ze(this,function(a){switch(a.label){case 0:if(!wn.env().get("IS_BROWSER"))throw new Error("microphone API is only supported in browser environment.");return r=new e(t),[4,r.start()];case 1:return a.sent(),[2,r]}})})},e.prototype.start=function(){return Le(this,void 0,void 0,function(){var t,r,a,i;return ze(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),t=this,[4,navigator.mediaDevices.getUserMedia({audio:this.audioTrackConstraints==null?!0:this.audioTrackConstraints,video:!1})];case 1:return t.stream=o.sent(),[3,3];case 2:throw r=o.sent(),new Error("Error thrown while initializing video stream: ".concat(r.message));case 3:if(!this.stream)throw new Error("Could not obtain audio from microphone.");if(a=window.AudioContext||window.webkitAudioContext,this.audioContext=new a,!this.sampleRateHz)this.sampleRateHz=this.audioContext.sampleRate;else if(this.audioContext.sampleRate!==this.sampleRateHz)throw new Error("Mismatch in sampling rate: "+"Expected: ".concat(this.sampleRateHz,"; ")+"Actual: ".concat(this.audioContext.sampleRate));return i=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.fftSize*2,this.analyser.smoothingTimeConstant=this.smoothingTimeConstant,i.connect(this.analyser),this.freqData=new Float32Array(this.fftSize),this.timeData=new Float32Array(this.fftSize),[2]}})})},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,r,a,i,o;return ze(this,function(s){switch(s.label){case 0:return this.isClosed?[2,{value:null,done:!0}]:[4,this.getAudioData()];case 1:return a=s.sent(),this.includeSpectrogram&&(i=this.flattenQueue(a.freqDataQueue),t=this.getTensorFromAudioDataArray(i,[this.numFrames,this.columnTruncateLength,1])),this.includeWaveform&&(o=this.flattenQueue(a.timeDataQueue),r=this.getTensorFromAudioDataArray(o,[this.numFrames*this.fftSize,1])),[2,{value:{spectrogram:t,waveform:r},done:!1}]}})})},e.prototype.capture=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:return[2,t.sent().value]}})})},e.prototype.getAudioData=function(){return Le(this,void 0,void 0,function(){var t,r,a,i=this;return ze(this,function(o){return t=[],r=[],a=0,[2,new Promise(function(s){var u=setInterval(function(){i.includeSpectrogram&&(i.analyser.getFloatFrequencyData(i.freqData),i.freqData[0]===-1/0&&s({freqDataQueue:t,timeDataQueue:r}),t.push(i.freqData.slice(0,i.columnTruncateLength))),i.includeWaveform&&(i.analyser.getFloatTimeDomainData(i.timeData),r.push(i.timeData.slice())),++a===i.numFrames&&(clearInterval(u),s({freqDataQueue:t,timeDataQueue:r}))},i.fftSize/i.sampleRateHz*1e3)})]})})},e.prototype.stop=function(){this.isClosed||(this.isClosed=!0,this.analyser.disconnect(),this.audioContext.close(),this.stream!=null&&this.stream.getTracks().length>0&&this.stream.getTracks()[0].stop())},e.prototype.toArray=function(){throw new Error("Can not convert infinite audio stream to array.")},e.prototype.getSampleRate=function(){return this.sampleRateHz},e.prototype.flattenQueue=function(t){var r=t[0].length,a=new Float32Array(t.length*r);return t.forEach(function(i,o){return a.set(i,o*r)}),a},e.prototype.getTensorFromAudioDataArray=function(t,r){var a=new Float32Array(wn.util.sizeFromShape(r));return a.set(t,a.length-t.length),wn.tensor(a,r)},e}(Yn),p3e=function(n){Dt(e,n);function e(t,r){var a=n.call(this)||this;if(a.webcamVideoElement=t,a.webcamConfig=r,a.isClosed=!0,a.resize=!1,a.needToResize())if(a.resize=!0,a.cropSize=[a.webcamConfig.resizeHeight,a.webcamConfig.resizeWidth],a.cropBoxInd=wn.tensor1d([0],"int32"),a.webcamConfig.centerCrop){var i=a.webcamConfig.resizeWidth*1/a.webcamVideoElement.width,o=a.webcamConfig.resizeHeight*1/a.webcamVideoElement.height,s=(1-i)/2,u=(1-o)/2,c=s+i,l=o+u;a.cropBox=wn.tensor2d([u,s,l,c],[1,4])}else a.cropBox=wn.tensor2d([0,0,1,1],[1,4]);return a}return e.prototype.summary=function(){return"webcam"},e.create=function(t,r){return r===void 0&&(r={}),Le(this,void 0,void 0,function(){var a;return ze(this,function(i){switch(i.label){case 0:if(!wn.env().get("IS_BROWSER"))throw new Error("tf.data.webcam is only supported in browser environment.");if(!t){if(t=document.createElement("video"),!r.resizeWidth||!r.resizeHeight)throw new Error("Please provide webcam video element, or resizeWidth and resizeHeight to create a hidden video element.");t.width=r.resizeWidth,t.height=r.resizeHeight}return a=new e(t,r),[4,a.start()];case 1:return i.sent(),[2,a]}})})},e.prototype.start=function(){return Le(this,void 0,void 0,function(){var t,r,a=this;return ze(this,function(i){switch(i.label){case 0:this.webcamConfig.facingMode&&wn.util.assert(this.webcamConfig.facingMode==="user"||this.webcamConfig.facingMode==="environment",function(){return"Invalid webcam facing mode: ".concat(a.webcamConfig.facingMode,". ")+"Please provide 'user' or 'environment'"}),i.label=1;case 1:return i.trys.push([1,3,,4]),t=this,[4,navigator.mediaDevices.getUserMedia({video:{deviceId:this.webcamConfig.deviceId,facingMode:this.webcamConfig.facingMode?this.webcamConfig.facingMode:"user",width:this.webcamVideoElement.width,height:this.webcamVideoElement.height}})];case 2:return t.stream=i.sent(),[3,4];case 3:throw r=i.sent(),r.message="Error thrown while initializing video stream: ".concat(r.message),r;case 4:if(!this.stream)throw new Error("Could not obtain video from webcam.");try{this.webcamVideoElement.srcObject=this.stream}catch(o){console.log(o),this.webcamVideoElement.src=window.URL.createObjectURL(this.stream)}return this.webcamVideoElement.play(),this.isClosed=!1,[2,new Promise(function(o){a.webcamVideoElement.onloadedmetadata=function(){o()}})]}})})},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(r){if(this.isClosed)return[2,{value:null,done:!0}];try{t=wn.browser.fromPixels(this.webcamVideoElement)}catch(a){throw new Error("Error thrown converting video to pixels: ".concat(JSON.stringify(a)))}if(this.resize)try{return[2,{value:this.cropAndResizeFrame(t),done:!1}]}catch(a){throw new Error("Error thrown cropping the video: ".concat(a.message))}finally{t.dispose()}else return[2,{value:t,done:!1}];return[2]})})},e.prototype.needToResize=function(){return!!(this.webcamConfig.resizeWidth&&this.webcamConfig.resizeHeight&&(this.webcamVideoElement.width!==this.webcamConfig.resizeWidth||this.webcamVideoElement.height!==this.webcamConfig.resizeHeight))},e.prototype.cropAndResizeFrame=function(t){var r=this;return wn.tidy(function(){var a=wn.expandDims(wn.cast(t,"float32"),0),i;i=wn.image.cropAndResize(a,r.cropBox,r.cropBoxInd,r.cropSize,"bilinear");var o=i.shape;return wn.reshape(i,o.slice(1))})},e.prototype.capture=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){switch(t.label){case 0:return[4,this.next()];case 1:return[2,t.sent().value]}})})},e.prototype.stop=function(){var t=this.stream.getTracks();t.forEach(function(r){return r.stop()});try{this.webcamVideoElement.srcObject=null}catch(r){console.log(r),this.webcamVideoElement.src=null}this.isClosed=!0},e.prototype.toArray=function(){throw new Error("Can not convert infinite video stream to array.")},e}(Yn);var ZB=function(){function n(){}return n}(),JB=function(n){Dt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.split=function(t){return new d3e(this,t)},e}(Yn),d3e=function(n){Dt(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.impl=new v3e(t,r),a}return e.prototype.summary=function(){return this.impl.summary()},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,this.impl.next()]})})},e}(JB),v3e=function(n){Dt(e,n);function e(t,r){var a=n.call(this)||this;return a.upstream=t,a.separator=r,a.carryover="",a}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Split('").concat(this.separator,"')")},e.prototype.pump=function(){return Le(this,void 0,void 0,function(){var t,r,a,i,o,s,u;return ze(this,function(c){switch(c.label){case 0:return[4,this.upstream.next()];case 1:if(t=c.sent(),t.done)return this.carryover===""?[2,!1]:(this.outputQueue.push(this.carryover),this.carryover="",[2,!0]);r=t.value.split(this.separator),r[0]=this.carryover+r[0];try{for(a=ru(r.slice(0,-1)),i=a.next();!i.done;i=a.next())o=i.value,this.outputQueue.push(o)}catch(l){s={error:l}}finally{try{i&&!i.done&&(u=a.return)&&u.call(a)}finally{if(s)throw s.error}}return this.carryover=r[r.length-1],[2,!0]}})})},e}(Jw),m3e=function(n){Dt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.decodeUTF8=function(){return new g3e(this)},e}(Yn),g3e=function(n){Dt(e,n);function e(t){var r=n.call(this)||this;return r.upstream=t,r.impl=new y3e(t),r}return e.prototype.summary=function(){return this.impl.summary()},e.prototype.next=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,this.impl.next()]})})},e}(JB),y3e=function(n){Dt(e,n);function e(t){var r=n.call(this)||this;if(r.upstream=t,wn.env().get("IS_BROWSER"))r.decoder=new TextDecoder("utf-8");else{var a=jw().StringDecoder;r.decoder=new a("utf8")}return r}return e.prototype.summary=function(){return"".concat(this.upstream.summary()," -> Utf8")},e.prototype.pump=function(){return Le(this,void 0,void 0,function(){var t,r,a;return ze(this,function(i){switch(i.label){case 0:return[4,this.upstream.next()];case 1:return t=i.sent(),t.done?[2,!1]:(r=t.value,wn.env().get("IS_BROWSER")?a=this.decoder.decode(r,{stream:!0}):a=this.decoder.write(Buffer.from(r.buffer)),this.outputQueue.push(a),[2,!0])}})})},e}(Jw),QB=function(n){Dt(e,n);function e(t,r){r===void 0&&(r={});var a=n.call(this)||this;return a.file=t,a.options=r,wn.util.assert(t instanceof Uint8Array||(wn.env().get("IS_BROWSER")?t instanceof File||t instanceof Blob:!1),function(){return"FileChunkIterator only supports File, Blob and Uint8Array right now."}),a.offset=r.offset||0,a.chunkSize=r.chunkSize||1024*1024,a}return e.prototype.summary=function(){return"FileChunks ".concat(this.file)},e.prototype.next=function(){return Le(this,void 0,void 0,function(){var t,r,a=this;return ze(this,function(i){switch(i.label){case 0:return this.offset>=(this.file instanceof Uint8Array?this.file.byteLength:this.file.size)?[2,{value:null,done:!0}]:(t=new Promise(function(o,s){var u=a.offset+a.chunkSize;if(a.file instanceof Uint8Array)o(new Uint8Array(a.file.slice(a.offset,u)));else{var c=new FileReader;c.onload=function(f){var h=c.result;if(h instanceof ArrayBuffer&&(h=new Uint8Array(h)),!(h instanceof Uint8Array))return s(new TypeError("FileReader returned unknown type."));o(h)},c.onabort=function(f){return s(new Error("Aborted"))},c.onerror=function(f){return s(new Error(f.type))};var l=a.file.slice(a.offset,u);c.readAsArrayBuffer(l)}a.offset=u}),r={},[4,t]);case 1:return[2,(r.value=i.sent(),r.done=!1,r)]}})})},e}(m3e);function b3e(n,e,t){return e===void 0&&(e={}),Le(this,void 0,void 0,function(){var r,a,i,o,s;return ze(this,function(u){switch(u.label){case 0:return typeof n=="string"?r=n:(r=n.url,a=w3e(n)),[4,(t||wn.util.fetch)(r,a)];case 1:return i=u.sent(),i.ok?(s=Uint8Array.bind,[4,i.arrayBuffer()]):[3,3];case 2:return o=new(s.apply(Uint8Array,[void 0,u.sent()])),[2,new QB(o,e)];case 3:throw new Error(i.statusText)}})})}var w3e=function(n){var e={method:n.method,headers:n.headers,body:n.body,mode:n.mode,credentials:n.credentials,cache:n.cache,redirect:n.redirect,referrer:n.referrer,integrity:n.integrity};return e};function eL(n){return typeof n=="string"&&n.slice(0,7)==="file://"}var tL=function(n){Dt(e,n);function e(t,r){r===void 0&&(r={});var a=n.call(this)||this;return a.input=t,a.options=r,a}return e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){var t;return ze(this,function(r){return eL(this.input)&&wn.env().get("IS_NODE")&&(t=MB(),this.input=t.readFileSync(this.input.slice(7))),[2,new QB(this.input,this.options)]})})},e}(ZB),nL=function(n){Dt(e,n);function e(t,r){r===void 0&&(r={});var a=n.call(this)||this;return a.url=t,a.fileOptions=r,a}return e.prototype.iterator=function(){return Le(this,void 0,void 0,function(){return ze(this,function(t){return eL(this.url)?[2,new tL(this.url,this.fileOptions).iterator()]:[2,b3e(this.url,this.fileOptions)]})})},e}(ZB);function x3e(n,e){return e===void 0&&(e={}),new YB(new nL(n),e)}function k3e(n){var e=this,t=Zw(n);return ta(function(){return Le(e,void 0,void 0,function(){return ze(this,function(r){return[2,t]})})})}function S3e(n){var e=this;return ta(function(){return Le(e,void 0,void 0,function(){var t;return ze(this,function(r){switch(r.label){case 0:return[4,n()];case 1:return t=r.sent(),[2,Zw(function(){return t.next()})]}})})})}function N3e(n,e){return Le(this,void 0,void 0,function(){return ze(this,function(t){return[2,p3e.create(n,e)]})})}function T3e(n){return Le(this,void 0,void 0,function(){return ze(this,function(e){return[2,h3e.create(n)]})})}var E3e="4.2.0";Rr.CSVDataset=YB;Rr.Dataset=_c;Rr.FileDataSource=tL;Rr.TextLineDataset=XB;Rr.URLDataSource=nL;Rr.array=u3e;Rr.csv=x3e;Rr.func=k3e;Rr.generator=S3e;Rr.microphone=T3e;Rr.version_data=E3e;Rr.webcam=N3e;Rr.zip=c3e});var iL=J((aL,Qw)=>{(function(n,e,t){function r(s){var u=this,c=o();u.next=function(){var l=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=l-(u.c=l|0)},u.c=1,u.s0=c(" "),u.s1=c(" "),u.s2=c(" "),u.s0-=c(s),u.s0<0&&(u.s0+=1),u.s1-=c(s),u.s1<0&&(u.s1+=1),u.s2-=c(s),u.s2<0&&(u.s2+=1),c=null}function a(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function i(s,u){var c=new r(s),l=u&&u.state,f=c.next;return f.int32=function(){return c.next()*4294967296|0},f.double=function(){return f()+(f()*2097152|0)*11102230246251565e-32},f.quick=f,l&&(typeof l=="object"&&a(l,c),f.state=function(){return a(c,{})}),f}function o(){var s=4022871197,u=function(c){c=String(c);for(var l=0;l<c.length;l++){s+=c.charCodeAt(l);var f=.02519603282416938*s;s=f>>>0,f-=s,f*=s,s=f>>>0,f-=s,s+=f*4294967296}return(s>>>0)*23283064365386963e-26};return u}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.alea=i})(aL,typeof Qw=="object"&&Qw,typeof define=="function"&&define)});var sL=J((oL,ex)=>{(function(n,e,t){function r(o){var s=this,u="";s.x=0,s.y=0,s.z=0,s.w=0,s.next=function(){var l=s.x^s.x<<11;return s.x=s.y,s.y=s.z,s.z=s.w,s.w^=s.w>>>19^l^l>>>8},o===(o|0)?s.x=o:u+=o;for(var c=0;c<u.length+64;c++)s.x^=u.charCodeAt(c)|0,s.next()}function a(o,s){return s.x=o.x,s.y=o.y,s.z=o.z,s.w=o.w,s}function i(o,s){var u=new r(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},l.int32=u.next,l.quick=l,c&&(typeof c=="object"&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xor128=i})(oL,typeof ex=="object"&&ex,typeof define=="function"&&define)});var cL=J((uL,tx)=>{(function(n,e,t){function r(o){var s=this,u="";s.next=function(){var l=s.x^s.x>>>2;return s.x=s.y,s.y=s.z,s.z=s.w,s.w=s.v,(s.d=s.d+362437|0)+(s.v=s.v^s.v<<4^(l^l<<1))|0},s.x=0,s.y=0,s.z=0,s.w=0,s.v=0,o===(o|0)?s.x=o:u+=o;for(var c=0;c<u.length+64;c++)s.x^=u.charCodeAt(c)|0,c==u.length&&(s.d=s.x<<10^s.x>>>4),s.next()}function a(o,s){return s.x=o.x,s.y=o.y,s.z=o.z,s.w=o.w,s.v=o.v,s.d=o.d,s}function i(o,s){var u=new r(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},l.int32=u.next,l.quick=l,c&&(typeof c=="object"&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xorwow=i})(uL,typeof tx=="object"&&tx,typeof define=="function"&&define)});var fL=J((lL,nx)=>{(function(n,e,t){function r(o){var s=this;s.next=function(){var c=s.x,l=s.i,f,h,p;return f=c[l],f^=f>>>7,h=f^f<<24,f=c[l+1&7],h^=f^f>>>10,f=c[l+3&7],h^=f^f>>>3,f=c[l+4&7],h^=f^f<<7,f=c[l+7&7],f=f^f<<13,h^=f^f<<9,c[l]=h,s.i=l+1&7,h};function u(c,l){var f,h,p=[];if(l===(l|0))h=p[0]=l;else for(l=""+l,f=0;f<l.length;++f)p[f&7]=p[f&7]<<15^l.charCodeAt(f)+p[f+1&7]<<13;for(;p.length<8;)p.push(0);for(f=0;f<8&&p[f]===0;++f);for(f==8?h=p[7]=-1:h=p[f],c.x=p,c.i=0,f=256;f>0;--f)c.next()}u(s,o)}function a(o,s){return s.x=o.x.slice(),s.i=o.i,s}function i(o,s){o==null&&(o=+new Date);var u=new r(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},l.int32=u.next,l.quick=l,c&&(c.x&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xorshift7=i})(lL,typeof nx=="object"&&nx,typeof define=="function"&&define)});var pL=J((hL,rx)=>{(function(n,e,t){function r(o){var s=this;s.next=function(){var c=s.w,l=s.X,f=s.i,h,p;return s.w=c=c+1640531527|0,p=l[f+34&127],h=l[f=f+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,p=l[f]=p^h,s.i=f,p+(c^c>>>16)|0};function u(c,l){var f,h,p,d,v,m=[],g=128;for(l===(l|0)?(h=l,l=null):(l=l+"\0",h=0,g=Math.max(g,l.length)),p=0,d=-32;d<g;++d)l&&(h^=l.charCodeAt((d+32)%l.length)),d===0&&(v=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,d>=0&&(v=v+1640531527|0,f=m[d&127]^=h+v,p=f==0?p+1:0);for(p>=128&&(m[(l&&l.length||0)&127]=-1),p=127,d=4*128;d>0;--d)h=m[p+34&127],f=m[p=p+1&127],h^=h<<13,f^=f<<17,h^=h>>>15,f^=f>>>12,m[p]=h^f;c.w=v,c.X=m,c.i=p}u(s,o)}function a(o,s){return s.i=o.i,s.w=o.w,s.X=o.X.slice(),s}function i(o,s){o==null&&(o=+new Date);var u=new r(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},l.int32=u.next,l.quick=l,c&&(c.X&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.xor4096=i})(hL,typeof rx=="object"&&rx,typeof define=="function"&&define)});var vL=J((dL,ax)=>{(function(n,e,t){function r(o){var s=this,u="";s.next=function(){var l=s.b,f=s.c,h=s.d,p=s.a;return l=l<<25^l>>>7^f,f=f-h|0,h=h<<24^h>>>8^p,p=p-l|0,s.b=l=l<<20^l>>>12^f,s.c=f=f-h|0,s.d=h<<16^f>>>16^p,s.a=p-l|0},s.a=0,s.b=0,s.c=-1640531527,s.d=1367130551,o===Math.floor(o)?(s.a=o/4294967296|0,s.b=o|0):u+=o;for(var c=0;c<u.length+20;c++)s.b^=u.charCodeAt(c)|0,s.next()}function a(o,s){return s.a=o.a,s.b=o.b,s.c=o.c,s.d=o.d,s}function i(o,s){var u=new r(o),c=s&&s.state,l=function(){return(u.next()>>>0)/4294967296};return l.double=function(){do var f=u.next()>>>11,h=(u.next()>>>0)/4294967296,p=(f+h)/(1<<21);while(p===0);return p},l.int32=u.next,l.quick=l,c&&(typeof c=="object"&&a(c,u),l.state=function(){return a(u,{})}),l}e&&e.exports?e.exports=i:t&&t.amd?t(function(){return i}):this.tychei=i})(dL,typeof ax=="object"&&ax,typeof define=="function"&&define)});var gL=J((mL,Wv)=>{(function(n,e,t){var r=256,a=6,i=52,o="random",s=t.pow(r,a),u=t.pow(2,i),c=u*2,l=r-1,f;function h(b,w,x){var N=[];w=w==!0?{entropy:!0}:w||{};var T=m(v(w.entropy?[b,y(e)]:b??g(),3),N),E=new p(N),C=function(){for(var F=E.g(a),D=s,O=0;F<u;)F=(F+O)*r,D*=r,O=E.g(1);for(;F>=c;)F/=2,D/=2,O>>>=1;return(F+O)/D};return C.int32=function(){return E.g(4)|0},C.quick=function(){return E.g(4)/4294967296},C.double=C,m(y(E.S),e),(w.pass||x||function(F,D,O,L){return L&&(L.S&&d(L,E),F.state=function(){return d(E,{})}),O?(t[o]=F,D):F})(C,T,"global"in w?w.global:this==t,w.state)}function p(b){var w,x=b.length,N=this,T=0,E=N.i=N.j=0,C=N.S=[];for(x||(b=[x++]);T<r;)C[T]=T++;for(T=0;T<r;T++)C[T]=C[E=l&E+b[T%x]+(w=C[T])],C[E]=w;(N.g=function(F){for(var D,O=0,L=N.i,z=N.j,$=N.S;F--;)D=$[L=l&L+1],O=O*r+$[l&($[L]=$[z=l&z+D])+($[z]=D)];return N.i=L,N.j=z,O})(r)}function d(b,w){return w.i=b.i,w.j=b.j,w.S=b.S.slice(),w}function v(b,w){var x=[],N=typeof b,T;if(w&&N=="object")for(T in b)try{x.push(v(b[T],w-1))}catch{}return x.length?x:N=="string"?b:b+"\0"}function m(b,w){for(var x=b+"",N,T=0;T<x.length;)w[l&T]=l&(N^=w[l&T]*19)+x.charCodeAt(T++);return y(w)}function g(){try{var b;return f&&(b=f.randomBytes)?b=b(r):(b=new Uint8Array(r),(n.crypto||n.msCrypto).getRandomValues(b)),y(b)}catch{var w=n.navigator,x=w&&w.plugins;return[+new Date,n,x,n.screen,y(e)]}}function y(b){return String.fromCharCode.apply(0,b)}if(m(t.random(),e),typeof Wv=="object"&&Wv.exports){Wv.exports=h;try{f=Dp()}catch{}}else typeof define=="function"&&define.amd?define(function(){return h}):t["seed"+o]=h})(typeof self<"u"?self:mL,[],Math)});var bL=J((hit,yL)=>{var I3e=iL(),C3e=sL(),A3e=cL(),_3e=fL(),D3e=pL(),F3e=vL(),su=gL();su.alea=I3e;su.xor128=C3e;su.xorwow=A3e;su.xorshift7=_3e;su.xor4096=D3e;su.tychei=F3e;yL.exports=su});var Bz=J(rh=>{"use strict";Object.defineProperty(rh,"__esModule",{value:!0});var S=Cs(),R3e=bL();function O3e(n){if(n&&n.__esModule)return n;var e=Object.create(null);return n&&Object.keys(n).forEach(function(t){if(t!=="default"){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}}),e.default=n,e}var P3e=O3e(R3e),ox=function(n,e){return ox=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])},ox(n,e)};function M3e(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");ox(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function wL(n,e,t,r){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(r.next(l))}catch(f){o(f)}}function u(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((r=r.apply(n,e||[])).next())})}function xL(n,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(l){c=[6,l],a=0}finally{r=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Rc(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function We(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=r.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return i}function ya(n,e,t){if(t||arguments.length===2)for(var r=0,a=e.length,i;r<a;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}function Ge(n,e){Array.isArray(n)||(n=[n]),n.forEach(function(t){t!=null&&S.util.assert(t.dtype!=="complex64",function(){return"".concat(e," does not support complex64 tensors in the CPU backend.")})})}var B3e=S.kernel_impls.whereImpl,cx=function(n){M3e(e,n);function e(){var t=n.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new S.DataStorage(t,S.engine()),t}return e.prototype.nextDataId=function(){return e.nextDataId++},e.prototype.write=function(t,r,a){this.firstUse&&(this.firstUse=!1,S.env().get("IS_NODE")&&S.backend_util.warn(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));var i={id:this.nextDataId()};return this.data.set(i,{values:t,dtype:a,refCount:1}),i},e.prototype.makeTensorInfo=function(t,r,a){var i;if(r==="string"&&a!=null&&a.length>0&&S.util.isString(a[0])){var o=a.map(function(s){return S.util.encodeString(s)});i=this.write(o,t,r)}else i=this.write(a,t,r);return{dataId:i,shape:t,dtype:r}},e.prototype.refCount=function(t){if(this.data.has(t)){var r=this.data.get(t);return r.refCount}return 0},e.prototype.incRef=function(t){var r=this.data.get(t);r.refCount++},e.prototype.decRef=function(t){if(this.data.has(t)){var r=this.data.get(t);r.refCount--}},e.prototype.move=function(t,r,a,i,o){this.data.set(t,{values:r,dtype:i,refCount:o})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return wL(this,void 0,void 0,function(){return xL(this,function(r){return[2,this.readSync(t)]})})},e.prototype.readSync=function(t){var r=this.data.get(t),a=r.dtype,i=r.complexTensorInfos;if(a==="complex64"){var o=this.readSync(i.real.dataId),s=this.readSync(i.imag.dataId);return S.backend_util.mergeRealAndImagArrays(o,s)}return S.util.convertBackendValuesAndArrayBuffer(this.data.get(t).values,a)},e.prototype.bufferSync=function(t){var r=this.readSync(t.dataId);if(t.dtype==="string")try{var a=r.map(function(i){return S.util.decodeString(i)});return S.buffer(t.shape,t.dtype,a)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return S.buffer(t.shape,t.dtype,r)},e.prototype.makeOutput=function(t,r,a){return S.engine().makeTensorFromTensorInfo(this.makeTensorInfo(r,a,t),this)},e.prototype.disposeData=function(t,r){if(r===void 0&&(r=!1),this.data.has(t)){if(this.data.get(t).refCount--,!r&&this.data.get(t).refCount>0)return!1;var a=this.data.get(t).complexTensorInfos;a!=null&&(this.disposeData(a.real.dataId,!0),this.disposeData(a.imag.dataId,!0)),this.data.delete(t)}return!0},e.prototype.disposeIntermediateTensorInfo=function(t){this.disposeData(t.dataId)},e.prototype.time=function(t){return wL(this,void 0,void 0,function(){var r,a;return xL(this,function(i){return r=S.util.now(),t(),a=S.util.now()-r,[2,{kernelMs:a}]})})},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.where=function(t){Ge([t],"where");var r=this.readSync(t.dataId);return B3e(t.shape,r)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return n.prototype.epsilon.call(this)},e}(S.KernelBackend);cx.nextDataId=0;function _L(n){for(var e=new Float32Array(n.length),t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}var L3e=function(n){var e=n.inputs.x,t=n.backend;Ge(e,"abs");var r=new Float32Array(S.util.sizeFromShape(e.shape)),a=t.data.get(e.dataId).values;return r=_L(a),t.makeOutput(r,e.shape,e.dtype)},z3e={kernelName:S.Abs,backendName:"cpu",kernelFunc:L3e};function zn(n){return function(e,t,r,a,i){var o=S.backend_util.assertAndGetBroadcastShape(e,t),s=o.length,u=S.util.computeStrides(o),c=S.util.sizeFromShape(o),l=S.util.getTypedArrayFromDType(i,c),f=e.length,h=t.length,p=S.util.computeStrides(e),d=S.util.computeStrides(t),v=S.backend_util.getBroadcastDims(e,o),m=S.backend_util.getBroadcastDims(t,o);if(v.length+m.length===0)for(var g=0;g<l.length;++g)l[g]=n(r[g%r.length],a[g%a.length]);else for(var y=function(b){var w=S.util.indexToLoc(b,s,u),x=w.slice(-f);v.forEach(function(C){return x[C]=0});var N=S.util.locToIndex(x,f,p),T=w.slice(-h);m.forEach(function(C){return T[C]=0});var E=S.util.locToIndex(T,h,d);l[b]=n(r[N],a[E])},g=0;g<l.length;++g)y(g);return[l,o]}}function na(n){var e=n.inputs,t=n.backend,r=e.real,a=e.imag,i=t.data.get(r.dataId).values,o=t.data.get(a.dataId).values,s=t.makeTensorInfo(r.shape,"complex64"),u=t.data.get(s.dataId);return u.complexTensorInfos={real:t.makeTensorInfo(r.shape,"float32",i),imag:t.makeTensorInfo(a.shape,"float32",o)},s}var $3e={kernelName:S.Complex,backendName:"cpu",kernelFunc:na};function Vv(n,e,t){if(t===void 0&&(t="float32"),t==="complex64"){var r=Vv(n,e,"float32"),a=Vv(n,e,"float32");return na({inputs:{real:r,imag:a},backend:n})}var i=S.util.makeZerosTypedArray(S.util.sizeFromShape(e),t);return n.makeTensorInfo(e,t,i)}function Mi(n){var e=n.inputs,t=n.backend,r=e.x;return t.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var q3e={kernelName:S.Identity,backendName:"cpu",kernelFunc:Mi};function uu(n){var e=n.inputs,t=n.backend,r=e.input,a=t.data.get(r.dataId).complexTensorInfos.real,i=t.data.get(a.dataId).values;return t.makeTensorInfo(a.shape,a.dtype,i)}var W3e={kernelName:S.Real,backendName:"cpu",kernelFunc:uu};function DL(n,e,t,r){if(r==="int32"){var a=Int32Array.from(n);return[e,"int32",a]}if(r==="bool"){var i=S.util.toTypedArray([0],t),o=We(zn(function(c,l){return c!==l?1:0})(e,[],n,i,"bool"),2),s=o[0],u=o[1];return[u,"bool",s]}throw new Error("Error in Cast: failed to cast ".concat(t," to ").concat(r))}function Yo(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.dtype;if(i==="complex64"){if(a.dtype==="complex64")return Mi({inputs:{x:a},backend:t});var o=Vv(t,a.shape,a.dtype),s=Yo({inputs:{x:a},backend:t,attrs:{dtype:"float32"}}),u=na({inputs:{real:s,imag:o},backend:t});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}if(a.dtype==="complex64"){var c=uu({inputs:{input:a},backend:t}),u=Yo({inputs:{x:c},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(c),u}if(!S.util.hasEncodingLoss(a.dtype,i)){var u=Mi({inputs:{x:a},backend:t});return{dataId:u.dataId,shape:u.shape,dtype:i}}var l=t.data.get(a.dataId).values,f=We(DL(l,a.shape,a.dtype,i),3),h=f[0],p=f[1],d=f[2];return t.makeTensorInfo(h,p,d)}var V3e={kernelName:S.Cast,backendName:"cpu",kernelFunc:Yo};function Zn(n,e,t,r){return t==null?function(a){var i=a.inputs,o=a.backend,s=i.a,u=i.b,c=o;Ge([s,u],n);var l=c.data.get(s.dataId).values,f=c.data.get(u.dataId).values,h=s.dtype==="string"?S.backend_util.fromUint8ToStringArray(l):l,p=s.dtype==="string"?S.backend_util.fromUint8ToStringArray(f):f,d=r||s.dtype,v=We(e(s.shape,u.shape,h,p,d),2),m=v[0],g=v[1];return c.makeTensorInfo(g,d,m)}:function(a){var i=a.inputs,o=a.backend,s=i.a,u=i.b,c=o;if(s.dtype==="complex64"||u.dtype==="complex64"){var l=Yo({inputs:{x:s},backend:c,attrs:{dtype:"complex64"}}),f=c.data.get(l.dataId),h=f.complexTensorInfos.real,p=f.complexTensorInfos.imag,d=c.data.get(h.dataId).values,v=c.data.get(p.dataId).values,m=Yo({inputs:{x:u},backend:c,attrs:{dtype:"complex64"}}),g=c.data.get(m.dataId),y=g.complexTensorInfos.real,b=g.complexTensorInfos.imag,w=c.data.get(y.dataId).values,x=c.data.get(b.dataId).values,N=We(t(s.shape,u.shape,d,v,w,x),3),T=N[0],E=N[1],C=N[2],F=c.makeTensorInfo(C,"float32",T),D=c.makeTensorInfo(C,"float32",E),O=na({inputs:{real:F,imag:D},backend:c});return c.disposeIntermediateTensorInfo(l),c.disposeIntermediateTensorInfo(m),c.disposeIntermediateTensorInfo(F),c.disposeIntermediateTensorInfo(D),O}else{var L=c.data.get(s.dataId).values,z=c.data.get(u.dataId).values,$=r||s.dtype,B=We(e(s.shape,u.shape,L,z,$),2),W=B[0],C=B[1];return c.makeTensorInfo(C,$,W)}}}function lx(n){return function(e,t,r,a,i,o){var s=S.backend_util.assertAndGetBroadcastShape(e,t),u=S.util.sizeFromShape(s),c=s.length,l=S.util.computeStrides(s),f=S.util.getTypedArrayFromDType("float32",u),h=S.util.getTypedArrayFromDType("float32",u),p=S.backend_util.getBroadcastDims(e,s),d=S.backend_util.getBroadcastDims(t,s),v=S.backend_util.mergeRealAndImagArrays(r,a),m=S.backend_util.mergeRealAndImagArrays(i,o),g=e.length,y=S.util.computeStrides(e),b=t.length,w=S.util.computeStrides(t);if(p.length+d.length===0)for(var x=0;x<f.length;x++){var N=x%v.length,T=x%m.length,E=n(v[N*2],v[N*2+1],m[T*2],m[T*2+1]);f[x]=E.real,h[x]=E.imag}else for(var C=function(F){var D=S.util.indexToLoc(F,c,l),O=D.slice(-g);p.forEach(function(W){return O[W]=0});var L=S.util.locToIndex(O,g,y),z=D.slice(-b);d.forEach(function(W){return z[W]=0});var $=S.util.locToIndex(z,b,w),B=n(v[L*2],v[L*2+1],m[$*2],m[$*2+1]);f[F]=B.real,h[F]=B.imag},x=0;x<f.length;x++)C(x);return[f,h,s]}}var FL=zn(function(n,e){return n+e}),G3e=lx(function(n,e,t,r){return{real:n+t,imag:e+r}}),Oc=Zn(S.Add,FL,G3e),U3e={kernelName:S.Add,backendName:"cpu",kernelFunc:Oc};function fx(n,e,t,r,a){for(var i=S.util.sizeFromShape(r),o=S.util.makeZerosTypedArray(a,t),s=0;s<n.length;s++){var u=n[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(i>0?o[u]+=e[s]:o[u]+=1)}return o}function RL(n,e,t,r){r===void 0&&(r=!1);for(var a=n.shape[0],i=n.shape[1],o=S.buffer([a,t],e.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=n.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=t||(r?o.set(1,s,c):e.size>0?o.set(o.get(s,c)+e.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o}function Zo(n){return function(e,t,r){for(var a=S.util.getTypedArrayFromDType(t,e.length),i=0;i<e.length;++i)a[i]=n(e[i],r);return a}}function Mt(n,e,t){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(Ge(s,n),s.dtype==="string"||t==="string")throw new Error("unaryKernelFunc does not support string input/output");for(var u=o,c=u.data.get(s.dataId).values,l=S.util.sizeFromShape(s.shape),f=t||s.dtype,h=S.util.getArrayFromDType(f,l),p=0;p<l;++p)h[p]=e(c[p],i);return u.makeTensorInfo(s.shape,f,h)}}function Bc(n,e,t){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(Ge(s,n),s.dtype==="string"||t==="string")throw new Error("unaryKernelFunc does not support string input/output");var u=o,c=u.data.get(s.dataId).values,l=t||s.dtype,f=e(c,l,i);return u.makeTensorInfo(s.shape,l,f)}}var OL=Zo(function(n){return Math.ceil(n)}),H3e=Bc(S.Ceil,OL),K3e={kernelName:S.Ceil,backendName:"cpu",kernelFunc:H3e};function PL(n,e,t,r){var a=S.util.getArrayFromDType(t,S.util.sizeFromShape(e));if(r&&t!=="string"){var i=0;n.forEach(function(s){var u=S.util.sizeFromShape(s.shape);a.set(s.vals,i),i+=u})}else{var o=0;n.forEach(function(s){for(var u=t==="string"?S.backend_util.fromUint8ToStringArray(s.vals):s.vals,c=0,l=0;l<s.shape[0];++l)for(var f=l*e[1]+o,h=0;h<s.shape[1];++h)a[f+h]=u[c++];o+=s.shape[1]})}return a}var ML=zn(function(n,e){return n===e?1:0}),BL=Zn(S.Equal,ML,null,"bool"),j3e={kernelName:S.Equal,backendName:"cpu",kernelFunc:BL};var LL=Zo(function(n){return Math.exp(n)}),zL=Bc(S.Exp,LL,"float32"),X3e={kernelName:S.Exp,backendName:"cpu",kernelFunc:zL};var $L=Zo(function(n){return Math.expm1(n)}),Y3e=Bc(S.Expm1,$L),Z3e={kernelName:S.Expm1,backendName:"cpu",kernelFunc:Y3e};var qL=Zo(function(n){return Math.floor(n)}),J3e=Bc(S.Floor,qL),Q3e={kernelName:S.Floor,backendName:"cpu",kernelFunc:J3e};function WL(n,e,t,r,a,i,o,s,u){for(var c=S.buffer([r,i],t),l=0;l<r;l++){for(var f=[],h=0,p=0;p<a;p++){var d=n[l*a+p];h+=d*o[p],f.push(d)}if(h<0||h>=u/i)throw new Error("Invalid indices: ".concat(f," does not index into ").concat(s));for(var v=0;v<i;v++)c.values[l*i+v]=e.get.apply(e,ya([],We(e.indexToLoc(h*i+v)),!1))}return c}function VL(n,e,t){for(var r=S.buffer(t,n.dtype),a=0;a<r.size;++a){var i=r.indexToLoc(a),o=i.slice(),s=o[0],u=o[2],c=e.locToIndex([s,u]);o[2]=e.values[c];var l=n.locToIndex(o);0<=l&&l<n.values.length&&(r.values[a]=n.values[l])}return r}var GL=zn(function(n,e){return n>e?1:0}),eFe=Zn(S.Greater,GL,null,"bool"),tFe={kernelName:S.Greater,backendName:"cpu",kernelFunc:eFe};var UL=zn(function(n,e){return n>=e?1:0}),nFe=Zn(S.GreaterEqual,UL,null,"bool"),rFe={kernelName:S.GreaterEqual,backendName:"cpu",kernelFunc:nFe};var HL=zn(function(n,e){return n<e?1:0}),aFe=Zn(S.Less,HL,null,"bool"),iFe={kernelName:S.Less,backendName:"cpu",kernelFunc:aFe};var KL=zn(function(n,e){return n<=e?1:0}),oFe=Zn(S.LessEqual,KL,null,"bool"),sFe={kernelName:S.LessEqual,backendName:"cpu",kernelFunc:oFe};function jL(n,e,t){var r=(e-n)/(t-1),a=S.util.makeZerosTypedArray(t,"float32");a[0]=n;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return a}var XL=Zo(function(n){return Math.log(n)}),uFe=Bc(S.Log,XL),cFe={kernelName:S.Log,backendName:"cpu",kernelFunc:uFe};function YL(n,e,t,r){for(var a=S.util.getTypedArrayFromDType(r,S.util.sizeFromShape(t)),i=0;i<a.length;++i){for(var o=i*e,s=n[o],u=0;u<e;++u){var c=n[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a}var ZL=zn(function(n,e){return Math.max(n,e)}),lFe=Zn(S.Maximum,ZL),fFe={kernelName:S.Maximum,backendName:"cpu",kernelFunc:lFe};var JL=zn(function(n,e){return Math.min(n,e)}),hFe=Zn(S.Minimum,JL),pFe={kernelName:S.Minimum,backendName:"cpu",kernelFunc:hFe};var hx=zn(function(n,e){return n*e}),dFe=lx(function(n,e,t,r){return{real:n*t-e*r,imag:n*r+e*t}}),Kv=Zn(S.Multiply,hx,dFe),vFe={kernelName:S.Multiply,backendName:"cpu",kernelFunc:Kv};function QL(n,e,t){var r=S.util.createScalarValue(-1,t);return hx([],e,r,n,t)}function mFe(n){var e=n.inputs,t=n.backend,r=e.x;Ge(r,"neg");var a=t.data.get(r.dataId).values,i=We(QL(a,r.shape,r.dtype),2),o=i[0],s=i[1];return t.makeTensorInfo(s,r.dtype,o)}var gFe={kernelName:S.Neg,backendName:"cpu",kernelFunc:mFe};var ez=zn(function(n,e){return n!==e?1:0}),yFe=Zn(S.NotEqual,ez,null,"bool"),bFe={kernelName:S.NotEqual,backendName:"cpu",kernelFunc:yFe};function px(n,e,t,r,a){for(var i=e.length,o=S.util.sizeFromShape(e),s=S.util.computeStrides(e),u=S.util.computeStrides(a),c=S.util.getTypedArrayFromDType(t,S.util.sizeFromShape(a)),l=0;l<o;++l){for(var f=S.util.indexToLoc(l,i,s),h=new Array(f.length),p=0;p<h.length;p++)h[p]=f[r[p]];var d=S.util.locToIndex(h,i,u);c[d]=n[l]}return c}function Or(n){var e=n.inputs,t=n.attrs,r=n.backend,a=e.x,i=t.perm;Ge(a,"transpose");for(var o=a.shape.length,s=new Array(o),u=0;u<s.length;u++)s[u]=a.shape[i[u]];var c=r.data.get(a.dataId).values,l=px(c,a.shape,a.dtype,i,s),f=r.write(l,s,a.dtype);return{dataId:f,shape:s,dtype:a.dtype}}var wFe={kernelName:S.Transpose,backendName:"cpu",kernelFunc:Or};function tz(n,e,t,r){for(var a=We(S.backend_util.computeOutAndReduceShapes(n,r),2),i=a[0],o=a[1],s=S.upcastType(e,"int32"),u=S.util.makeZerosTypedArray(S.util.sizeFromShape(i),s),c=S.util.sizeFromShape(o),l=0;l<u.length;++l){for(var f=l*c,h=1,p=0;p<c;++p)h*=t[f+p];u[l]=h}return{outVals:u,outShape:i,outDtype:s}}function xFe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims;Ge(a,"prod");var s=a.shape.length,u=S.util.parseAxisParam(i,a.shape),c=S.backend_util.getAxesPermutation(u,s),l=u,f=a,h=[];c!=null&&(f=Or({inputs:{x:a},backend:t,attrs:{perm:c}}),h.push(f),l=S.backend_util.getInnerMostAxes(l.length,s));var p=t.data.get(f.dataId).values,d=tz(f.shape,f.dtype,p,l),v=d.outVals,m=d.outShape,g=d.outDtype,y=m;return o&&(y=S.backend_util.expandShapeToKeepDim(m,u)),h.forEach(function(b){return t.disposeIntermediateTensorInfo(b)}),t.makeTensorInfo(y,g,v)}var kFe={kernelName:S.Prod,backendName:"cpu",kernelFunc:xFe};function SFe(n,e,t){n.forEach(function(r,a){if(r<0||r>=t){var i=S.util.indexToLoc(a,e.length,S.util.computeStrides(e)).join(",");throw new Error("indices[".concat(i,"] = ").concat(r," is not in [0, ").concat(t,")"))}})}function NFe(n,e){for(var t=0;t<n.length;++t){var r=n[t],a=t===n.length-1?e:n[t+1].length;if(r.length===0)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<r.length;++i)if(r[i-1]>r[i])throw new Error("Ragged splits must be sorted in ascending order")}}function TFe(n,e,t,r){var a=[],i=0,o=e.length-1+t.length,s=new Array(o).fill(null).map(function(){return[0]});NFe(t,r);for(var u=1,c=0;c<e.length-1;++c){u*=e[c];for(var l=e[c+1],f=1;f<u+1;++f)s[c].push(f*l)}for(var f=0;f<n.length;++f){for(var h=n[f],p=n[f]+1,c=0;c<t.length;++c){var d=t[c],v=c+e.length-1;if(v>=0)for(var m=s[v],g=m[m.length-1]-d[h],y=h;y<p;++y)s[v].push(d[y+1]+g);h=d[h],p=d[p]}p!==h&&(a.push([h,p]),i+=p-h)}return{outSplits:s,valueSlices:a,numValues:i}}function EFe(n){for(var e=[],t=function(a){var i=n[a].length,o=S.util.getArrayFromDType("int32",i);e.push(o),n[a].forEach(function(s,u){return o[u]=s})},r=0;r<n.length;++r)t(r);return e}function kL(n,e){for(var t=n.slice(0,e);t.length<e;)t.push(1);for(var r=e;r<n.length;r++)t[e-1]*=n[r];return t}function IFe(n,e,t,r,a,i){var o,s,u=kL(e,2)[1],c=kL(i,2)[1],l=0;try{for(var f=Rc(t),h=f.next();!h.done;h=f.next())for(var p=h.value,d=p[0];d<p[1];++d){for(var v=0;v<r;++v)a[l*c+v]=n[d*u+v];++l}}catch(m){o={error:m}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}}function CFe(n,e,t,r,a){var i=e.slice();i[0]=a;var o=S.util.getArrayFromDType(t,S.util.sizeFromShape(i)),s=n.length,u=s===0?0:s/e[0];return IFe(n,e,r,u,o,i),[o,i]}function nz(n,e,t,r,a,i,o,s){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");var u=e[0][0]-1;if(SFe(i,o,u),r.length===0)throw new Error("params.rank must be nonzero");var c=r[0],l=TFe(i,o,n,c),f=l.outSplits,h=l.valueSlices,p=l.numValues,d=EFe(f),v=CFe(t,r,a,h,p);return[d,v[0],v[1]]}var SL=2147483647;function rz(n,e,t,r,a,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");var s=e.length===0,u=a.length===0,c=o.length===0,l=[];s||l.push(e[0]),u||l.push(a[0]),c||l.push(o[0]);for(var f=1;f<l.length;++f)if(l[f]!==l[f-1])throw new Error("starts, limits, and deltas must have the same shape");var h=l.length===0?1:l[0],p=S.util.getArrayFromDType("int32",h+1);p[0]=0;for(var d=0;d<h;++d){var v=s?n[0]:n[d],m=u?r[0]:r[d],g=c?i[0]:i[d];if(g===0)throw new Error("Requires delta != 0");var y=void 0;if(g>0&&m<v||g<0&&m>v)y=0;else if(y=Math.ceil(Math.abs((m-v)/g)),y>SL)throw new Error("Requires ((limit - start) / delta) <= ".concat(SL));p[d+1]=p[d]+y}for(var b=p[h],w=S.util.getArrayFromDType(t,b),x=0,d=0;d<h;++d)for(var N=p[d+1]-p[d],T=s?n[0]:n[d],g=c?i[0]:i[d],f=0;f<N;++f)w[x++]=T,T+=g;return[p,w]}var Ha=S.backend_util.RowPartitionType,AFe=function(){function n(e,t,r,a,i,o,s,u,c,l){this.shape=e,this.shapeShape=t,this.values=r,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=S.backend_util.getRowPartitionTypesHelper(l),this.raggedRank=S.backend_util.getRaggedRank(this.rowPartitionTypes)}return n.prototype.getRowPartitionTypeByDimension=function(e){return this.rowPartitionTypes[0]===Ha.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]},n.prototype.getRowPartitionTensor=function(e){return this.rowPartitionTypes[0]===Ha.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]},n.prototype.getMaxWidth=function(e){var t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Ha.VALUE_ROWIDS:return n.getMaxWidthValueRowID(t);case Ha.ROW_SPLITS:return n.getMaxWidthRowSplit(t);default:throw new Error("Cannot handle partition type ".concat(Ha[this.getRowPartitionTypeByDimension(e-1)]))}},n.getMaxWidthRowSplit=function(e){var t=e.length;if(t===0||t===1)return 0;for(var r=0,a=0;a<t-1;++a){var i=e[a+1]-e[a];i>r&&(r=i)}return r},n.getMaxWidthValueRowID=function(e){var t=e.length;if(t===0)return 0;for(var r=0,a=e[0],i=0,o=1;o<t;++o){var s=e[o];s!==a&&(a=s,i=Math.max(o-r,i),r=o)}return Math.max(t-r,i)},n.prototype.tensorShapeFromTensor=function(e,t,r){if(r===void 0&&(r=!0),t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return TL(e,r)},n.prototype.calculateOutputSize=function(e){var t=this.valuesShape,r=this.defaultValueShape;S.backend_util.validateDefaultValueShape(r,t);var a=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=S.backend_util.combineRaggedTensorToTensorShapes(this.raggedRank,a,t),o=i;o[0]<0&&(o[0]=e);for(var s=1;s<=this.raggedRank;++s)o[s]<0&&(o[s]=this.getMaxWidth(s));return o},n.prototype.calculateFirstParentOutputIndex=function(e,t,r){for(var a=Math.min(e,r),i=[],o=0,s=0;s<a;++s,o+=t)i.push(o);for(var s=a;s<e;++s)i.push(-1);return S.util.assert(i.length===e,function(){return"Final length of result must be equal to firstDimension."}),i},n.prototype.calculateOutputIndexRowSplit=function(e,t,r,a){for(var i=e.length,o=[],s=0;s<i-1;++s){var u=e[s+1]-e[s],c=Math.min(a,u),l=t[s];l===-1&&(c=0);for(var f=0;f<c;++f)o.push(l),l+=r;for(var f=0;f<u-c;++f)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o},n.prototype.calculateOutputIndexValueRowID=function(e,t,r,a){var i=e.length,o=[];if(i===0)return[];var s=0,u=e[0];if(u>=t.length)throw new Error("Got currentValueRowId=".concat(u,", which is not less than ").concat(t.length));var c=t[u];o.push(c);for(var l=1;l<i;++l){var f=e[l];if(f===u)c>=0&&(++s,s<a?c+=r:c=-1);else{if(s=0,u=f,f>=t.length)throw new Error("Got nextValueRowId=".concat(f," which is not less than ").concat(t.length));c=t[f]}o.push(c)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o},n.prototype.calculateOutputIndex=function(e,t,r,a){var i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case Ha.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,r,a);case Ha.ROW_SPLITS:if(i.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(i.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(i,t,r,a);default:throw new Error("Unsupported partition type: ".concat(Ha[o]))}},n.prototype.getFirstDimensionSize=function(){var e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case Ha.FIRST_DIM_SIZE:return e[0];case Ha.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Ha.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(Ha[t]))}},n.prototype.compute=function(){var e=this.rowPartitionValues[0];if(e.length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var t=this.getFirstDimensionSize(),r=this.calculateOutputSize(t),a=new Array(this.raggedRank+1);a[a.length-1]=1;for(var i=a.length-2;i>=0;--i)a[i]=a[i+1]*r[i+1];var o=TL(r,!1),s=S.util.getArrayFromDType(this.valuesDType,S.util.sizeFromShape(o)),u=a[0]*r[0];if(u>0){for(var c=this.calculateFirstParentOutputIndex(t,a[0],r[0]),i=1;i<=this.raggedRank;++i){var l=this.calculateOutputIndex(i-1,c,a[i],r[i]);c=l}this.setOutput(this.raggedRank,c,s,o)}return[o,s]},n.prototype.setOutput=function(e,t,r,a){if(r.length!==0){var i=this.values,o=r,s=a.slice();s=s.slice(e+1);var u=S.util.sizeFromShape(s),c=t.length,l=this.defaultValue;if(l.length!==u&&l.length!==1){var f=this.defaultValueShape;S.tidy(function(){var x=S.reshape(l,f),N=S.broadcastTo(x,s);l=N.dataSync()})}for(var h=0,p=0,d=0,v=0;v<=c;++v){var m=v<c?t[v]:-1;if(m===d){++d;continue}if(p<d){var g=i.subarray(h*u),y=o.subarray(p*u),b=(d-p)*u;NL(y,g,b)}if(v>=c){var w=r.length;m=Math.floor(w/u)}if(m>d)if(this.defaultValue.length===1)o.subarray(d*u,m*u).fill(this.defaultValue[0]),d=m;else for(;m>d;){var y=o.slice(d*u);NL(y,l,u),++d}m<0?(h=v+1,p=d):(h=v,p=d,d=p+1)}}},n}();function NL(n,e,t){for(var r=0;r<t;r++)n[r]=e[r]}function TL(n,e){var t,r,a=[];try{for(var i=Rc(n),o=i.next();!o.done;o=i.next()){var s=o.value;if(s<0){if(!e)throw new Error("Dimension ".concat(s," must be >= 0"));if(s<-1)throw new Error("Dimension ".concat(s," must be >= -1"));s=-1}a.push(s)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return a}function az(n,e,t,r,a,i,o,s,u,c){return new AFe(n,e,t,r,a,i,o,s,u,c).compute()}function iz(n,e,t,r){var a=n===e,i=n<e&&t<0,o=e<n&&t>1;if(a||i||o)return S.util.makeZerosTypedArray(0,r);var s=Math.abs(Math.ceil((e-n)/t)),u=S.util.makeZerosTypedArray(s,r);e<n&&t===1&&(t=-1),u[0]=n;for(var c=1;c<u.length;c++)u[c]=u[c-1]+t;return u}var oz=Zo(function(n){return 1/Math.sqrt(n)}),_Fe=Bc(S.Rsqrt,oz),DFe={kernelName:S.Rsqrt,backendName:"cpu",kernelFunc:_Fe};function Fc(n,e,t,r,a,i,o,s,u,c){var l=[r/a,a],f=n.values,h=e.values;if(r===0)return S.buffer(t,e.dtype);var p=S.buffer(l,e.dtype);typeof u=="string"||typeof u=="number"?p.values.fill(u):typeof u=="boolean"&&p.values.fill(+u);for(var d=0;d<i;d++){for(var v=[],m=0,g=0;g<o;g++){var y=f[d*o+g];v.push(y),m+=y*s[g]}if(m<0||m>=r/a)throw new Error("Invalid indices: ".concat(v," does not index into ").concat(t));for(var b=0;b<a;b++)c?p.values[m*a+b]+=h[d*a+b]:p.values[m*a+b]=e.rank===0?h[0]:h[d*a+b]}return p}var FFe=Zo(function(n){return 1/(1+Math.exp(-n))}),sz=Mt(S.Sigmoid,function(n){return 1/(1+Math.exp(-n))}),RFe={kernelName:S.Sigmoid,backendName:"cpu",kernelFunc:sz};function uz(n,e,t,r,a){var i=S.slice_util.isSliceContinous(r,e,t),o=S.util.sizeFromShape(t),s=S.util.computeStrides(r);if(i){var u=S.slice_util.computeFlatOffset(e,s);return a==="string"?n.slice(u,u+o):n.subarray(u,u+o)}for(var c=a==="string"?S.backend_util.fromUint8ToStringArray(n):n,l=S.buffer(r,a,c),f=S.buffer(t,a),h=0;h<f.size;++h){var p=f.indexToLoc(h),d=p.map(function(v,m){return v+e[m]});f.set.apply(f,ya([l.get.apply(l,ya([],We(d),!1))],We(p),!1))}return a==="string"?S.backend_util.fromStringArrayToUint8(f.values):f.values}function cu(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.begin,o=r.size;Ge(a,"slice");var s=We(S.slice_util.parseSliceParams(a,i,o),2),u=s[0],c=s[1];S.slice_util.assertParamsValid(a,u,c);var l=t.data.get(a.dataId).values,f=uz(l,u,c,a.shape,a.dtype);return t.makeTensorInfo(c,a.dtype,f)}var OFe={kernelName:S.Slice,backendName:"cpu",kernelFunc:cu};function cz(n,e,t,r,a,i,o){var s=e[0],u=i[0],c=new Array(u),l=new Array(s),f=e[1];if(u===0){if(s!==0)throw new Error(S.backend_util.getSparseFillEmptyRowsIndicesDenseShapeMismatch(s));var h=S.util.getArrayFromDType(t,0),p=S.util.getArrayFromDType(a,0);return[h,[0,f],p,c,l]}for(var d=!0,v=0,m=new Array(u).fill(0),g=0;g<s;++g){var y=n[g*f];if(y<0)throw new Error(S.backend_util.getSparseFillEmptyRowsNegativeIndexErrorMessage(g,y));if(y>=u)throw new Error(S.backend_util.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(g,y,u));++m[y],d=d&&y>=v,v=y}for(var b=!0,y=0;y<u;++y){var w=m[y]===0;c[y]=w,b=b&&!w,m[y]=Math.max(m[y],1),y>0&&(m[y]+=m[y-1])}if(b&&d){for(var h=n,p=r,g=0;g<s;++g)l[g]=g;return[h,[s,f],p,c,l]}else{for(var x=m[u-1],h=S.util.getArrayFromDType(t,x*f),p=S.util.getArrayFromDType(a,x),N=new Array(u).fill(0),g=0;g<s;++g){var y=n[g*f],T=N[y],E=(y===0?0:m[y-1])+T;N[y]++;for(var C=0;C<f;++C)h[E*f+C]=n[g*f+C];p[E]=r[g],l[g]=E}for(var y=0;y<u;++y){var F=N[y];if(F===0){var D=y===0?0:m[y-1];h[D*f+0]=y;for(var O=1;O<f;++O)h[D*f+O]=0;p[D]=o}}return[h,[x,f],p,c,l]}}function lz(n,e,t,r,a){for(var i=S.util.sizeFromShape(r),o=e[0],s=a.length,u=[],c=1,l=-1,f=0;f<s;++f){var h=a[f];if(h===-1){if(l!==-1)throw new Error(S.backend_util.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(l,f));l=f,u.push(1)}else{if(h<0)throw new Error(S.backend_util.getSparseReshapeNegativeOutputDimErrorMessage(f,h));c*=h,u.push(h)}}if(l!==-1){if(c<=0)throw new Error(S.backend_util.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());var p=Math.trunc(i/c);if(c*p!==i)throw new Error(S.backend_util.getSparseReshapeInputOutputMultipleErrorMessage(r,u));u[l]=p}var d=S.util.sizeFromShape(u);if(d!==i)throw new Error(S.backend_util.getSparseReshapeInputOutputMismatchErrorMessage(r,u));var v=r.length,m=[];if(v>0){m[v-1]=1;for(var f=v-2;f>=0;--f)m[f]=m[f+1]*r[f+1]}var g=[];if(s>0){g[s-1]=1;for(var f=s-2;f>=0;--f)g[f]=g[f+1]*u[f+1]}for(var y=S.util.getArrayFromDType(t,o*s),b=0;b<o;++b){for(var w=0,x=0;x<v;++x)w+=n[b*v+x]*m[x];for(var x=0;x<s;++x)y[b*s+x]=Math.trunc(w/g[x]),w%=g[x]}return[y,[o,s],u]}function dx(n,e,t,r,a,i,o){i===void 0&&(i=!1),o===void 0&&(o=0);var s=r.length,u=[e[0],n.length/e[0]],c=u[1],l=s>0?a[s-1]+1:0,f=l;if(f<0)throw new Error(S.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var h=e.slice();h[0]=f;var p=h.reduce(function(T,E){return T*E},1),d=S.util.getArrayFromDType(t,p);if(s===0)return f>0&&d.fill(o),[d,h];if(f<=0)throw new Error(S.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());for(var v=0,m=1,g=0,y=a[v];;){var b=0;if(m<s){if(b=a[m],y===b){++m;continue}if(y>=b)throw new Error(S.backend_util.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=f)throw new Error(S.backend_util.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,f));y>g&&d.fill(o,g*c,y*c);for(var w=v;w<m;++w){var x=r[w];if(x<0||x>=u[0])throw new Error(S.backend_util.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(w,r[w],u[0]));for(var N=0;N<c;N++)d[y*c+N]+=n[x*c+N]}if(i)for(var N=0;N<c;N++)d[y*c+N]/=m-v;if(v=m,++m,g=y+1,y=b,m>s)break}return g<f&&d.fill(o,g*c,f*c),[d,h]}var PFe=Zo(function(n){return Math.sqrt(n)}),MFe=Mt(S.Sqrt,function(n){return Math.sqrt(n)}),BFe={kernelName:S.Sqrt,backendName:"cpu",kernelFunc:MFe};var fz=zn(function(n,e){var t=n-e;return t*t}),LFe=Zn(S.SquaredDifference,fz),zFe={kernelName:S.SquaredDifference,backendName:"cpu",kernelFunc:LFe};function hz(n,e,t,r){for(var a=S.buffer(n,e.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*t[u]+r[u];a.set.apply(a,ya([e.get.apply(e,ya([],We(s),!1))],We(o),!1))}return a}var $Fe=function(){function n(e,t,r,a,i,o){this.separator=S.util.encodeString(e),this.nGramWidths=t,this.leftPad=S.util.encodeString(r),this.rightPad=S.util.encodeString(a),this.padWidth=i,this.preserveShort=o}return n.prototype.getPadWidth=function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)},n.prototype.getNumNGrams=function(e,t){var r=this.getPadWidth(t);return Math.max(0,e+2*r-t+1)},n.prototype.createNGrams=function(e,t,r,a,i,o){for(var s=function(l){var f=u.getPadWidth(o),h=Math.max(0,f-l),p=Math.max(0,f-(i-(l+1))),d=o-(h+p),v=t+(h>0?0:l-f),m=0;m+=h*u.leftPad.length;for(var g=0;g<d;++g)m+=e[v+g].length;m+=p*u.rightPad.length;var y=h+p+d-1;m+=y*u.separator.length,r[a+l]=new Uint8Array(m);for(var b=r[a+l],w=0,x=function(N){return N.forEach(function(T){return b[w++]=T})},g=0;g<h;++g)x(u.leftPad),x(u.separator);for(var g=0;g<d-1;++g)x(e[v+g]),x(u.separator);if(d>0){x(e[v+d-1]);for(var g=0;g<p;++g)x(u.separator),x(u.rightPad)}else{for(var g=0;g<p-1;++g)x(u.rightPad),x(u.separator);x(u.rightPad)}},u=this,c=0;c<i;++c)s(c)},n.prototype.compute=function(e,t){var r=this,a=e.length,i=t.length;if(i>0){var o=t[0];if(o!==0)throw new Error("First split value must be 0, got ".concat(o));for(var s=1;s<i;++s){var u=t[s]>=o;if(u=u&&t[s]<=a,!u)throw new Error("Invalid split value ".concat(t[s],", must be in [").concat(o,", ").concat(a,"]"));o=t[s]}if(o!==a)throw new Error("Last split value must be data size. Expected ".concat(a,", got ").concat(o))}var c=i-1,l=S.util.getArrayFromDType("int32",i);if(a===0||i===0){for(var f=new Array(a),s=0;s<=c;++s)l[s]=0;return[f,l]}l[0]=0;for(var h=function(g){var y=t[g]-t[g-1],b=0;p.nGramWidths.forEach(function(w){b+=r.getNumNGrams(y,w)}),p.preserveShort&&y>0&&b===0&&(b=1),l[g]=l[g-1]+b},p=this,s=1;s<=c;++s)h(s);for(var d=new Array(l[c]),v=function(g){var y=t[g],b=l[g];if(m.nGramWidths.forEach(function(T){var E=t[g+1]-t[g],C=r.getNumNGrams(E,T);r.createNGrams(e,y,d,b,C,T),b+=C}),m.preserveShort&&b===l[g]){var w=t[g+1]-t[g];if(w===0)return"continue";var x=w+2*m.padWidth,N=1;m.createNGrams(e,y,d,b,N,x)}},m=this,s=0;s<c;++s)v(s);return[d,l]},n}();function pz(n,e,t,r,a,i,o,s){return new $Fe(t,r,a,i,o,s).compute(n,e)}function qFe(n,e,t,r){if(!!n.length){if(e.length===0){for(var a=0;a<n.length;++a)r.push(n.subarray(a,a+1));return}if(e.length===1){for(var i=e[0],o=n.indexOf(i);o!==-1;){var s=n.subarray(0,o);(!t||s.length!==0)&&r.push(s),n=n.subarray(o+1),o=n.indexOf(i)}(!t||n.length!==0)&&r.push(n);return}for(var u=0,a=0;a<n.length+1;a++)if(a===n.length||e.indexOf(n[a])!==-1){var s=n.subarray(u,a);(!t||s.length!==0)&&r.push(s),u=a+1}}}function dz(n,e,t){for(var r=n.length,a=[],i=0,o=0,s=new Array(r),u=0;u<r;++u){var c=a.length;qFe(n[u],e,t,a);var l=a.length-c;s[u]=l,i+=l,o=Math.max(o,l)}for(var f=S.util.getArrayFromDType("int32",i*2),h=new Array(i),p=[r,o],d=0,u=0;u<r;++u)for(var v=0;v<s[u];++v)f[d*2]=u,f[d*2+1]=v,h[d]=a[d],++d;return[f,h,p]}function vz(n,e){for(var t=S.util.getArrayFromDType("int32",n.length),r=0;r<n.length;++r)t[r]=S.util.fingerPrint64(n[r]).modulo(e).getLowBitsUnsigned();return t}var mz=zn(function(n,e){return n-e}),WFe=lx(function(n,e,t,r){return{real:n-t,imag:e-r}}),vx=Zn(S.Sub,mz,WFe),VFe={kernelName:S.Sub,backendName:"cpu",kernelFunc:vx};function gz(n,e){for(var t=new Array(n.rank),r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];for(var a=S.buffer(t,n.dtype),r=0;r<a.values.length;++r){for(var i=a.indexToLoc(r),o=new Array(n.rank),s=0;s<o.length;s++)o[s]=i[s]%n.shape[s];var u=n.locToIndex(o);a.values[r]=n.values[u]}return a}var eh=function(n,e){var t=e.value-n.value;return t===0?n.index-e.index:t};function yz(n,e,t,r){for(t===void 0&&(t=0),r===void 0&&(r=n.length-1);r>t;){if(r-t>600){var a=r-t+1,i=e-t+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2),c=Math.max(t,Math.floor(e-i*s/a+u)),l=Math.min(r,Math.floor(e+(a-i)*s/a+u));yz(n,e,c,l)}var f=n[e],h=t,p=r;for(S.util.swap(n,t,e),eh(n[r],f)>0&&S.util.swap(n,t,r);h<p;){for(S.util.swap(n,h,p),h++,p--;eh(n[h],f)<0;)h=h+1;for(;eh(n[p],f)>0;)p=p-1}eh(n[t],f)===0?S.util.swap(n,t,p):(p=p+1,S.util.swap(n,p,r)),p<=e&&(t=p+1),e<=p&&(r=p-1)}}function bz(n,e,t,r,a){for(var i=e[e.length-1],o=We([n.length/i,i],2),s=o[0],u=o[1],c=S.util.getTypedArrayFromDType(t,s*r),l=S.util.getTypedArrayFromDType("int32",s*r),f=function(d){var v=d*u,m=n.subarray(v,v+u),g=new Array(m.length);m.forEach(function(N,T){return g[T]={value:N,index:T}}),r<g.length&&(yz(g,r),g=g.slice(0,r)),a&&g.sort(eh);for(var y=d*r,b=c.subarray(y,y+r),w=l.subarray(y,y+r),x=0;x<r;x++)b[x]=g[x].value,w[x]=g[x].index},h=0;h<s;h++)f(h);var p=e.slice();return p[p.length-1]=r,[S.buffer(p,t,c),S.buffer(p,"int32",l)]}function wz(n,e,t,r){for(var a=S.util.parseAxisParam(e,t)[0],i=[1,t[0],1],o=0;o<a;o++)i[0]*=t[o];i[1]=t[a];for(var o=a+1;o<t.length;o++)i[2]*=t[o];for(var s={},u=new Int32Array(t[a]),c=new S.TensorBuffer(i,r,n),l=[],f=i[0]===1&&i[2]===1,o=0;o<t[a];o++){var h=void 0;if(f)h=n[o].toString();else{for(var p=[],d=0;d<i[0];d++)for(var v=0;v<i[2];v++)p.push(c.get(d,o,v));h=p.join(",")}if(s[h]!==void 0)u[o]=s[h];else{var m=Object.keys(s).length;s[h]=m,u[o]=m,l.push(o)}}var g=i.slice();g[1]=Object.keys(s).length;var y=new S.TensorBuffer(g,r);l.forEach(function(w,x){for(var N=0;N<i[0];N++)for(var T=0;T<i[2];T++)y.set(c.get(N,w,T),N,x,T)});var b=t.slice();return b[a]=g[1],{outputValues:y.values,outputShape:b,indices:u}}var GFe={__proto__:null,simpleAbsImpl:_L,addImpl:FL,bincountImpl:fx,bincountReduceImpl:RL,castImpl:DL,ceilImpl:OL,concatImpl:PL,equalImpl:ML,expImpl:LL,expm1Impl:$L,floorImpl:qL,gatherNdImpl:WL,gatherV2Impl:VL,greaterImpl:GL,greaterEqualImpl:UL,lessImpl:HL,lessEqualImpl:KL,linSpaceImpl:jL,logImpl:XL,maxImpl:YL,maximumImpl:ZL,minimumImpl:JL,multiplyImpl:hx,negImpl:QL,notEqualImpl:ez,prodImpl:tz,raggedGatherImpl:nz,raggedRangeImpl:rz,raggedTensorToTensorImpl:az,rangeImpl:iz,rsqrtImpl:oz,scatterImpl:Fc,sigmoidImpl:FFe,sliceImpl:uz,sparseFillEmptyRowsImpl:cz,sparseReshapeImpl:lz,sparseSegmentReductionImpl:dx,sqrtImpl:PFe,squaredDifferenceImpl:fz,stridedSliceImpl:hz,stringNGramsImpl:pz,stringSplitImpl:dz,stringToHashBucketFastImpl:vz,subImpl:mz,tileImpl:gz,topKImpl:bz,transposeImpl:px,uniqueImpl:wz};var UFe="4.2.0";S.registerBackend("cpu",function(){return new cx},1);var xz=Mt(S.Elu,function(n){return n>=0?n:Math.exp(n)-1}),HFe={kernelName:S.Elu,backendName:"cpu",kernelFunc:xz};function kz(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.alpha;Ge([a],"leakyRelu");for(var o=S.util.sizeFromShape(a.shape),s=t.data.get(a.dataId).values,u=S.util.getTypedArrayFromDType("float32",o),c=0;c<s.length;c++)u[c]=s[c]<0?i*s[c]:s[c];return t.makeTensorInfo(a.shape,"float32",u)}var KFe={kernelName:S.LeakyRelu,backendName:"cpu",kernelFunc:kz},jFe=zn(function(n,e){return n<0?e*n:n});function Sz(n){var e=n.inputs,t=n.backend,r=e.x,a=e.alpha;Ge([r,a],"prelu");var i=t.data.get(r.dataId).values,o=t.data.get(a.dataId).values,s=We(jFe(r.shape,a.shape,i,o,"float32"),2),u=s[0],c=s[1];return t.makeTensorInfo(c,"float32",u)}var XFe={kernelName:S.Prelu,backendName:"cpu",kernelFunc:Sz};var Nz=Mt(S.Relu,function(n){return Math.max(0,n)}),YFe={kernelName:S.Relu,backendName:"cpu",kernelFunc:Nz};var Tz=Mt(S.Relu6,function(n){return Math.min(Math.max(0,n),6)}),ZFe={kernelName:S.Relu6,backendName:"cpu",kernelFunc:Tz};function Gv(n,e,t,r,a){if(t==="linear")return Mi({inputs:{x:e},backend:n});if(t==="relu")return Nz({inputs:{x:e},backend:n});if(t==="elu")return xz({inputs:{x:e},backend:n});if(t==="relu6")return Tz({inputs:{x:e},backend:n});if(t==="prelu")return Sz({inputs:{x:e,alpha:r},backend:n});if(t==="leakyrelu")return kz({inputs:{x:e},backend:n,attrs:{alpha:a}});if(t==="sigmoid")return sz({inputs:{x:e},backend:n});throw new Error("Activation ".concat(t," has not been implemented for the CPU backend."))}function qt(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.shape,o=S.util.sizeFromShape(a.shape),s=S.util.inferFromImplicitShape(i,o),u=S.util.sizeFromShape(s);S.util.assert(o===u,function(){return"The new shape (".concat(s,") has ").concat(u," elements and the old ")+"shape (".concat(a.shape,") has ").concat(o," elements. The new shape and old ")+"shape must have the same number of elements."}),t.incRef(a.dataId);var c=t.data.get(a.dataId);if(c.complexTensorInfos!=null){var l=c.complexTensorInfos.real,f=c.complexTensorInfos.imag;l.shape=s,f.shape=s}return{dataId:a.dataId,shape:s,dtype:a.dtype}}var JFe={kernelName:S.Reshape,backendName:"cpu",kernelFunc:qt};function Ez(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.a,i=e.b,o=r.transposeA,s=r.transposeB;Ge([a,i],"matMul");var u=a.shape.length,c=i.shape.length,l=o?a.shape[u-2]:a.shape[u-1],f=s?i.shape[c-1]:i.shape[c-2],h=o?a.shape[u-1]:a.shape[u-2],p=s?i.shape[c-2]:i.shape[c-1],d=a.shape.slice(0,-2),v=i.shape.slice(0,-2),m=S.util.sizeFromShape(d),g=S.util.sizeFromShape(v),y=S.broadcast_util.assertAndGetBroadcastShape(a.shape.slice(0,-2),i.shape.slice(0,-2)),b=y.concat([h,p]);S.util.assert(l===f,function(){return"Error in matMul: inner shapes (".concat(l,") and (")+"".concat(f,") of Tensors with shapes ").concat(a.shape," and ")+"".concat(i.shape," and transposeA=").concat(o)+" and transposeB=".concat(s," must match.")});for(var w=o?[m,l,h]:[m,h,l],x=s?[g,p,f]:[g,f,p],N=qt({inputs:{x:a},backend:t,attrs:{shape:w}}),T=qt({inputs:{x:i},backend:t,attrs:{shape:x}}),E=o?N.shape[1]:N.shape[2],C=o?N.shape[2]:N.shape[1],F=s?T.shape[1]:T.shape[2],D=Math.max(m,g),O=t.data.get(N.dataId).values,L=t.data.get(T.dataId).values,z=S.util.computeStrides(N.shape),$=S.util.computeStrides(T.shape),B=We(o?[z[0],1,z[1]]:[z[0],z[1],1],3),W=B[0],X=B[1],Y=B[2],V=We(s?[1,$[1],$[0]]:[$[1],1,$[0]],3),j=V[0],re=V[1],ne=V[2],oe=C*F,le=S.buffer([D,C,F],N.dtype),de=le.values,xe=t.blockSize,he=0;he<D;he++)for(var ye=he%m,we=he%g,Ae=0;Ae<C;Ae+=xe)for(var Ye=Math.min(Ae+xe,C),ht=0;ht<F;ht+=xe)for(var at=Math.min(ht+xe,F),nt=0;nt<E;nt+=xe)for(var lt=Math.min(nt+xe,E),st=Ae;st<Ye;st++)for(var Ze=ht;Ze<at;Ze++){for(var tt=0,et=nt;et<lt;et++){var rn=O[ye*W+st*X+et*Y],He=L[et*j+Ze*re+we*ne];tt+=rn*He}de[he*oe+(st*F+Ze)]+=tt}return t.disposeIntermediateTensorInfo(N),t.disposeIntermediateTensorInfo(T),t.makeTensorInfo(b,le.dtype,le.values)}var QFe={kernelName:S.BatchMatMul,backendName:"cpu",kernelFunc:Ez};function eRe(n){var e,t,r=n.inputs,a=n.backend,i=n.attrs,o=r.a,s=r.b,u=r.bias,c=r.preluActivationWeights,l=i.transposeA,f=i.transposeB,h=i.activation,p=i.leakyreluAlpha,d,v,m,g=[],y=Ez({inputs:{a:o,b:s},attrs:{transposeA:l,transposeB:f},backend:a});d=y,u&&(v=Oc({inputs:{a:d,b:u},backend:a}),g.push(d),d=v),h&&(m=Gv(a,d,h,c,p),g.push(d),d=m);try{for(var b=Rc(g),w=b.next();!w.done;w=b.next()){var x=w.value;a.disposeIntermediateTensorInfo(x)}}catch(N){e={error:N}}finally{try{w&&!w.done&&(t=b.return)&&t.call(b)}finally{if(e)throw e.error}}return d}var tRe={kernelName:S._FusedMatMul,backendName:"cpu",kernelFunc:eRe};var nRe=Mt(S.Acos,function(n){return Math.acos(n)}),rRe={kernelName:S.Acos,backendName:"cpu",kernelFunc:nRe};var aRe=Mt(S.Acosh,function(n){return Math.acosh(n)}),iRe={kernelName:S.Acosh,backendName:"cpu",kernelFunc:aRe};function oRe(n){var e=n.inputs,t=n.backend,r=e;Ge(e,"addN");for(var a=r.map(function(l){return t.data.get(l.dataId).values}),i=S.buffer(r[0].shape,r[0].dtype),o=i.values,s=0;s<r.length;s++)for(var u=a[s],c=0;c<o.length;c++)o[c]+=u[c];return t.makeTensorInfo(i.shape,i.dtype,i.values)}var sRe={kernelName:S.AddN,backendName:"cpu",kernelFunc:oRe};function uRe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims;Ge(a,"all");var s=S.util.parseAxisParam(i,a.shape),u=s,c=S.backend_util.getAxesPermutation(u,a.shape.length),l=a;c!=null&&(l=Or({inputs:{x:a},backend:t,attrs:{perm:c}}),u=S.backend_util.getInnerMostAxes(u.length,a.shape.length)),S.backend_util.assertAxesAreInnerMostDims("all",u,l.shape.length);for(var f=We(S.backend_util.computeOutAndReduceShapes(l.shape,u),2),h=f[0],p=f[1],d=S.util.sizeFromShape(p),v=S.util.makeZerosTypedArray(S.util.sizeFromShape(h),l.dtype),m=t.data.get(l.dataId).values,g=0;g<v.length;++g){for(var y=g*d,b=m[y],w=0;w<d;++w){var x=m[y+w];b=b&&x}v[g]=b}c!=null&&t.disposeIntermediateTensorInfo(l);var N=t.makeTensorInfo(h,l.dtype,v);if(o){var T=S.backend_util.expandShapeToKeepDim(h,s),E=qt({inputs:{x:N},backend:t,attrs:{shape:T}});return t.disposeIntermediateTensorInfo(N),E}return N}var cRe={kernelName:S.All,backendName:"cpu",kernelFunc:uRe};function lRe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims;Ge(a,"any");var s=S.util.parseAxisParam(i,a.shape),u=s,c=S.backend_util.getAxesPermutation(u,a.shape.length),l=a;c!=null&&(l=Or({inputs:{x:a},backend:t,attrs:{perm:c}}),u=S.backend_util.getInnerMostAxes(u.length,a.shape.length)),S.backend_util.assertAxesAreInnerMostDims("any",u,l.shape.length);for(var f=We(S.backend_util.computeOutAndReduceShapes(l.shape,u),2),h=f[0],p=f[1],d=S.util.sizeFromShape(p),v=S.util.makeZerosTypedArray(S.util.sizeFromShape(h),l.dtype),m=t.data.get(l.dataId).values,g=0;g<v.length;++g){for(var y=g*d,b=m[y],w=0;w<d;++w){var x=m[y+w];b=b||x}v[g]=b}c!=null&&t.disposeIntermediateTensorInfo(l);var N=t.makeTensorInfo(h,l.dtype,v);if(o){var T=S.backend_util.expandShapeToKeepDim(h,s),E=qt({inputs:{x:N},backend:t,attrs:{shape:T}});return t.disposeIntermediateTensorInfo(N),E}return N}var fRe={kernelName:S.Any,backendName:"cpu",kernelFunc:lRe};function hRe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis;Ge(a,"argMax");var o=S.util.parseAxisParam(i,a.shape),s=S.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=Or({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=S.backend_util.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],S.backend_util.assertAxesAreInnerMostDims("argMax",o,u.shape.length);for(var l=We(S.backend_util.computeOutAndReduceShapes(u.shape,o),2),f=l[0],h=l[1],p=S.util.sizeFromShape(f),d=S.util.makeZerosTypedArray(p,"int32"),v=S.util.sizeFromShape(h),m=t.data.get(u.dataId).values,g=0;g<d.length;++g){for(var y=g*v,b=m[y],w=0,x=0;x<v;++x){var N=m[y+x];N>b&&(b=N,w=x)}d[g]=w}return c.forEach(function(T){return t.disposeIntermediateTensorInfo(T)}),t.makeTensorInfo(f,"int32",d)}var pRe={kernelName:S.ArgMax,backendName:"cpu",kernelFunc:hRe};function dRe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis;Ge(a,"argMin");var o=S.util.parseAxisParam(i,a.shape),s=S.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=Or({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=S.backend_util.getInnerMostAxes(o.length,u.shape.length)),o=[o[0]],S.backend_util.assertAxesAreInnerMostDims("argMin",o,u.shape.length);for(var l=We(S.backend_util.computeOutAndReduceShapes(u.shape,o),2),f=l[0],h=l[1],p=S.util.sizeFromShape(f),d=S.util.makeZerosTypedArray(p,"int32"),v=S.util.sizeFromShape(h),m=t.data.get(u.dataId).values,g=0;g<d.length;++g){for(var y=g*v,b=m[y],w=0,x=0;x<v;++x){var N=m[y+x];N<b&&(b=N,w=x)}d[g]=w}return c.forEach(function(T){return t.disposeIntermediateTensorInfo(T)}),t.makeTensorInfo(f,"int32",d)}var vRe={kernelName:S.ArgMin,backendName:"cpu",kernelFunc:dRe};var mRe=Mt(S.Asin,function(n){return Math.asin(n)}),gRe={kernelName:S.Asin,backendName:"cpu",kernelFunc:mRe};var yRe=Mt(S.Asinh,function(n){return Math.asinh(n)}),bRe={kernelName:S.Asinh,backendName:"cpu",kernelFunc:yRe};var wRe=Mt(S.Atan,function(n){return Math.atan(n)}),xRe={kernelName:S.Atan,backendName:"cpu",kernelFunc:wRe};var kRe=zn(function(n,e){return Math.atan2(n,e)}),SRe=Zn(S.Atan2,kRe),NRe={kernelName:S.Atan2,backendName:"cpu",kernelFunc:SRe};var TRe=Mt(S.Atanh,function(n){return Math.atanh(n)}),ERe={kernelName:S.Atanh,backendName:"cpu",kernelFunc:TRe};function mx(n,e,t,r,a,i){for(var o=a.strideHeight,s=a.strideWidth,u=a.dilationHeight,c=a.dilationWidth,l=a.effectiveFilterHeight,f=a.effectiveFilterWidth,h=a.padInfo.top,p=a.padInfo.left,d=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=S.buffer(a.outShape,t),m=v.values,g=a.outShape[1]*a.outShape[2]*a.outShape[3],y=a.outShape[2]*a.outShape[3],b=a.outShape[3],w=0;w<a.batchSize;++w)for(var x=w*g,N=w*r[0],T=0;T<a.inChannels;++T)for(var E=0;E<a.outHeight;++E)for(var C=E*o-h,F=Math.max(0,C),D=Math.min(a.inHeight,l+C),O=x+E*y,L=0;L<a.outWidth;++L){for(var z=L*s-p,$=Math.max(0,z),B=Math.min(a.inWidth,f+z),W=d,X=0,Y=0,V=F;V<D;V+=u){for(var j=N+V*r[1],re=$;re<B;re+=c){var ne=j+re*r[2],oe=n[ne+T];i==="max"&&oe>W?W=oe:i==="avg"&&(X+=oe,Y++)}if(isNaN(W))break}var le=O+L*b+T;m[le]=i==="avg"?X/Y:W}return v}function Iz(n,e,t,r,a,i){a===void 0&&(a=!1),i===void 0&&(i=!1);for(var o=S.buffer(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,f=r.effectiveFilterHeight,h=r.effectiveFilterWidth,p=r.padInfo.top,d=r.padInfo.left,v=S.buffer(e,t,n),m=0;m<r.batchSize;++m)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.outHeight;++y){for(var b=y*s-p,w=b;w<0;)w+=c;for(var x=Math.min(r.inHeight,f+b),N=0;N<r.outWidth;++N){for(var T=N*u-d,E=T;E<0;)E+=l;for(var C=Math.min(r.inWidth,h+T),F=Number.NEGATIVE_INFINITY,D=-1,O=w;O<x;O+=c)for(var L=O-b,z=E;z<C;z+=l){var $=z-T,B=v.get(m,O,z,g);B>F&&(F=B,a?D=i?((m*r.inHeight+O)*r.inWidth+z)*r.inChannels+g:(O*r.inWidth+z)*r.inChannels+g:D=L*h+$)}o.set(D,m,y,N,g)}}return o}function Cz(n,e,t,r,a,i){for(var o=a.strideDepth,s=a.strideHeight,u=a.strideWidth,c=a.dilationDepth,l=a.dilationHeight,f=a.dilationWidth,h=a.effectiveFilterDepth,p=a.effectiveFilterHeight,d=a.effectiveFilterWidth,v=a.padInfo.front,m=a.padInfo.top,g=a.padInfo.left,y=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=S.buffer(a.outShape,t),w=b.values,x=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],N=a.outShape[2]*a.outShape[3]*a.outShape[4],T=a.outShape[3]*a.outShape[4],E=a.outShape[4],C=0;C<a.batchSize;++C)for(var F=C*x,D=C*r[0],O=0;O<a.inChannels;++O)for(var L=0;L<a.outDepth;++L){for(var z=L*o-v,$=z;$<0;)$+=c;for(var B=Math.min(a.inDepth,h+z),W=F+L*N,X=0;X<a.outHeight;++X){for(var Y=X*s-m,V=Y;V<0;)V+=l;for(var j=Math.min(a.inHeight,p+Y),re=W+X*T,ne=0;ne<a.outWidth;++ne){for(var oe=ne*u-g,le=oe;le<0;)le+=f;for(var de=Math.min(a.inWidth,d+oe),xe=re+ne*E,he=y,ye=0,we=0,Ae=$;Ae<B;Ae+=c){for(var Ye=D+Ae*r[1],ht=V;ht<j;ht+=l){for(var at=Ye+ht*r[2],nt=le;nt<de;nt+=f){var lt=at+nt*r[3],st=n[lt+O];if(i==="max"&&st>he?he=st:i==="avg"&&(ye+=st,we++),isNaN(he))break}if(isNaN(he))break}if(isNaN(he))break}var Ze=xe+O;w[Ze]=i==="avg"?ye/Math.max(we,1):he}}}return b}function IRe(n,e){for(var t=S.buffer(e.outShape,"int32"),r=e.strideDepth,a=e.strideHeight,i=e.strideWidth,o=e.dilationDepth,s=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterDepth,l=e.effectiveFilterHeight,f=e.effectiveFilterWidth,h=e.padInfo.front,p=e.padInfo.top,d=e.padInfo.left,v=0;v<e.batchSize;++v)for(var m=0;m<e.inChannels;++m)for(var g=0;g<e.outDepth;++g){for(var y=g*r-h,b=y;b<0;)b+=o;for(var w=Math.min(e.inDepth,c+y),x=0;x<e.outHeight;++x){for(var N=x*a-p,T=N;T<0;)T+=s;for(var E=Math.min(e.inHeight,l+N),C=0;C<e.outWidth;++C){for(var F=C*i-d,D=F;D<0;)D+=u;for(var O=Math.min(e.inWidth,f+F),L=Number.NEGATIVE_INFINITY,z=-1,$=b;$<w;$+=o)for(var B=$-y,W=T;W<E;W+=s)for(var X=W-N,Y=D;Y<O;Y+=u){var V=Y-F,j=n.get(v,$,W,Y,m);j>=L&&(L=j,z=B*l*f+X*l+V)}t.set(z,v,g,x,C,m)}}}return t}function CRe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x;Ge(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=1;S.util.assert(S.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=S.backend_util.computePool2DInfo(a.shape,i,o,c,s,u),f;if(l.filterWidth===1&&l.filterHeight===1&&S.util.arraysEqual(l.inShape,l.outShape))f=Mi({inputs:{x:a},backend:t});else{var h=t.data.get(a.dataId).values,p=S.util.computeStrides(a.shape),d=mx(h,a.shape,a.dtype,p,l,"avg");f=t.makeTensorInfo(l.outShape,a.dtype,d.values)}return f}var ARe={kernelName:S.AvgPool,backendName:"cpu",kernelFunc:CRe};function _Re(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;Ge(a,"avgPool3d");var l=S.backend_util.computePool3DInfo(a.shape,i,o,1,s,u,c),f=t.data.get(a.dataId).values,h=Cz(f,a.shape,a.dtype,S.util.computeStrides(a.shape),l,"avg");return t.makeTensorInfo(h.shape,"float32",h.values)}var DRe={kernelName:S.AvgPool3D,backendName:"cpu",kernelFunc:_Re};function FRe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;Ge([a,i],"avgPool3DGrad");for(var l=S.backend_util.computePool3DInfo(i.shape,o,s,1,u,c),f=l.strideDepth,h=l.strideHeight,p=l.strideWidth,d=l.filterDepth,v=l.filterHeight,m=l.filterWidth,g=l.dilationDepth,y=l.dilationHeight,b=l.dilationWidth,w=l.effectiveFilterDepth,x=l.effectiveFilterHeight,N=l.effectiveFilterWidth,T=w-1-l.padInfo.front,E=N-1-l.padInfo.left,C=x-1-l.padInfo.top,F=S.buffer(i.shape,"float32"),D=1/(d*v*m),O=t.bufferSync(a),L=0;L<l.batchSize;++L)for(var z=0;z<l.inChannels;++z)for(var $=0;$<l.inDepth;++$)for(var B=0;B<l.inHeight;++B)for(var W=0;W<l.inWidth;++W){for(var X=$-T,Y=B-C,V=W-E,j=0,re=0;re<w;re+=g){var ne=(X+re)/f;if(!(ne<0||ne>=l.outDepth||Math.floor(ne)!==ne))for(var oe=0;oe<x;oe+=y){var le=(Y+oe)/h;if(!(le<0||le>=l.outHeight||Math.floor(le)!==le))for(var de=0;de<N;de+=b){var xe=(V+de)/p;if(!(xe<0||xe>=l.outWidth||Math.floor(xe)!==xe)){var he=O.get(L,ne,le,xe,z);j+=he}}}}F.set(j*D,L,$,B,W,z)}return t.makeTensorInfo(F.shape,F.dtype,F.values)}var RRe={kernelName:S.AvgPool3DGrad,backendName:"cpu",kernelFunc:FRe};function ORe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.input,o=i;Ge([a,i],"avgPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=S.backend_util.computePool2DInfo(o.shape,s,u,1,c),f=l.strideHeight,h=l.strideWidth,p=l.filterHeight,d=l.filterWidth,v=l.dilationHeight,m=l.dilationWidth,g=l.effectiveFilterHeight,y=l.effectiveFilterWidth,b=y-1-l.padInfo.left,w=g-1-l.padInfo.top,x=S.buffer(o.shape,"float32"),N=1/(p*d),T=t.data.get(a.dataId).values,E=S.buffer(a.shape,"float32",T),C=0;C<l.batchSize;++C)for(var F=0;F<l.inChannels;++F)for(var D=0;D<l.inHeight;++D)for(var O=0;O<l.inWidth;++O){for(var L=D-w,z=O-b,$=0,B=0;B<g;B+=v){var W=(L+B)/f;if(!(W<0||W>=l.outHeight||Math.floor(W)!==W))for(var X=0;X<y;X+=m){var Y=(z+X)/h;if(!(Y<0||Y>=l.outWidth||Math.floor(Y)!==Y)){var V=E.get(C,W,Y,F);$+=V}}}x.set($*N,C,D,O,F)}return t.makeTensorInfo(x.shape,x.dtype,x.values)}var PRe={kernelName:S.AvgPoolGrad,backendName:"cpu",kernelFunc:ORe};function MRe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.scale,o=e.offset,s=e.mean,u=e.variance;S.util.assert(s.shape.length===u.shape.length,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),S.util.assert(o==null||s.shape.length===o.shape.length,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),S.util.assert(i==null||s.shape.length===i.shape.length,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),Ge([a,s,u,i,o],"batchNorm");var c=r.varianceEpsilon;c==null&&(c=.001);for(var l=t.data.get(a.dataId).values,f=t.data.get(s.dataId).values,h=t.data.get(u.dataId).values,p=i?t.data.get(i.dataId).values:new Float32Array([1]),d=o?t.data.get(o.dataId).values:new Float32Array([0]),v=new Float32Array(l.length),m=d.length,g=p.length,y=h.length,b=f.length,w=0,x=0,N=0,T=0,E=0;E<l.length;++E)v[E]=d[w++]+(l[E]-f[x++])*p[N++]/Math.sqrt(h[T++]+c),w>=m&&(w=0),x>=b&&(x=0),N>=g&&(N=0),T>=y&&(T=0);return t.makeTensorInfo(a.shape,a.dtype,v)}var BRe={kernelName:S.FusedBatchNorm,backendName:"cpu",kernelFunc:MRe};function LRe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.blockShape,o=r.crops;Ge([a],"batchToSpaceND");var s=i.reduce(function(g,y){return g*y}),u=S.backend_util.getReshaped(a.shape,i,s),c=S.backend_util.getPermuted(u.length,i.length),l=S.backend_util.getReshapedPermuted(a.shape,i,s),f=S.backend_util.getSliceBeginCoords(o,i.length),h=S.backend_util.getSliceSize(l,o,i.length),p=qt({inputs:{x:a},backend:t,attrs:{shape:u}}),d=Or({inputs:{x:p},backend:t,attrs:{perm:c}}),v=qt({inputs:{x:d},backend:t,attrs:{shape:l}}),m=cu({inputs:{x:v},backend:t,attrs:{begin:f,size:h}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(v),m}var zRe={kernelName:S.BatchToSpaceND,backendName:"cpu",kernelFunc:LRe};function $Re(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.weights,o=r.size,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=fx(s,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,c)}var qRe={kernelName:S.Bincount,backendName:"cpu",kernelFunc:$Re};function WRe(n){var e=n.inputs,t=n.backend,r=e.s0,a=e.s1,i=t.data.get(r.dataId).values,o=t.data.get(a.dataId).values,s=S.backend_util.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return t.makeTensorInfo([s.length],"int32",Int32Array.from(s))}var VRe={kernelName:S.BroadcastArgs,backendName:"cpu",kernelFunc:WRe};var GRe=Mt(S.ClipByValue,function(n,e){var t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),URe={kernelName:S.ClipByValue,backendName:"cpu",kernelFunc:GRe};var HRe=function(n){for(var e=n.inputs.x,t=n.backend,r=new Float32Array(S.util.sizeFromShape(e.shape)),a=t.data.get(e.dataId),i=a.complexTensorInfos.real,o=a.complexTensorInfos.imag,s=t.data.get(i.dataId).values,u=t.data.get(o.dataId).values,c=0;c<s.length;c++){var l=s[c],f=u[c];r[c]=Math.hypot(l,f)}return t.makeOutput(r,e.shape,"float32")},KRe={kernelName:S.ComplexAbs,backendName:"cpu",kernelFunc:HRe};function Pc(n){var e=n.inputs,t=n.backend,r=e.input,a=t.data.get(r.dataId).complexTensorInfos.imag,i=t.data.get(a.dataId).values;return t.makeTensorInfo(a.shape,a.dtype,i)}var jRe={kernelName:S.Imag,backendName:"cpu",kernelFunc:Pc};function Mc(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.axis,i=S.util.parseAxisParam(a,e[0].shape)[0],o=e.map(function(w){return w.shape});S.backend_util.assertParamsConsistent(o,i);var s=S.backend_util.computeOutShape(e.map(function(w){return w.shape}),i);if(S.util.sizeFromShape(s)===0)return t.makeTensorInfo(s,e[0].dtype,[]);var u=e.filter(function(w){return S.util.sizeFromShape(w.shape)>0});if(u.length===1)return Mi({inputs:{x:u[0]},backend:t});if(u[0].dtype==="complex64"){var c=u.map(function(w){return uu({inputs:{input:w},backend:t})}),l=u.map(function(w){return Pc({inputs:{input:w},backend:t})}),f=Mc({inputs:c,backend:t,attrs:{axis:i}}),h=Mc({inputs:l,backend:t,attrs:{axis:i}}),p=na({inputs:{real:f,imag:h},backend:t});return c.forEach(function(w){return t.disposeIntermediateTensorInfo(w)}),l.forEach(function(w){return t.disposeIntermediateTensorInfo(w)}),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),p}var d=u.map(function(w){var x=S.util.sizeFromShape(w.shape.slice(i)),N=[-1,x];return qt({inputs:{x:w},backend:t,attrs:{shape:N}})}),v=d.map(function(w){return{vals:t.data.get(w.dataId).values,shape:w.shape}});s=S.backend_util.computeOutShape(d.map(function(w){return w.shape}),1);var m=d[0].shape[0]===1,g=PL(v,s,e[0].dtype,m),y=S.backend_util.computeOutShape(u.map(function(w){return w.shape}),i),b=t.makeTensorInfo(y,e[0].dtype,g);return d.forEach(function(w){return t.disposeIntermediateTensorInfo(w)}),b}var XRe={kernelName:S.Concat,backendName:"cpu",kernelFunc:Mc};function Az(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dilations,l=r.dimRoundingMode;Ge([a,i],"conv2d");for(var f=S.backend_util.convertConv2DDataFormat(u),h=S.backend_util.computeConv2DInfo(a.shape,i.shape,o,c,s,l,!1,f),p=h.filterHeight,d=h.filterWidth,v=h.dilationHeight,m=h.dilationWidth,g=h.padInfo.left,y=h.padInfo.top,b=h.dataFormat==="channelsLast",w=new S.TensorBuffer(h.outShape,a.dtype),x=S.util.computeStrides(a.shape),N=S.util.computeStrides(i.shape),T=x[0],E=b?x[1]:x[2],C=b?x[2]:1,F=b?1:x[1],D=w.strides[0],O=b?w.strides[1]:w.strides[2],L=b?w.strides[2]:1,z=b?1:w.strides[1],$=t.data.get(a.dataId).values,B=t.data.get(i.dataId).values,W=w.values,X=0;X<h.batchSize;++X)for(var Y=X*T,V=X*D,j=0;j<h.outHeight;++j)for(var re=V+j*O,ne=j*h.strideHeight-y,oe=0;oe<p;++oe){var le=ne+oe*v;if(!(le<0||le>=h.inHeight))for(var de=oe*N[0],xe=Y+le*E,he=0;he<h.outWidth;++he)for(var ye=re+he*L,we=he*h.strideWidth-g,Ae=0;Ae<d;++Ae){var Ye=we+Ae*m;if(!(Ye<0||Ye>=h.inWidth))for(var ht=de+Ae*N[1],at=xe+Ye*C,nt=ht,lt=0;lt<h.inChannels;++lt){for(var st=$[at+lt*F],Ze=0;Ze<h.outChannels;++Ze)W[ye+Ze*z]+=st*B[nt+Ze];nt+=h.outChannels}}}return t.makeTensorInfo(w.shape,w.dtype,W)}var YRe={kernelName:S.Conv2D,backendName:"cpu",kernelFunc:Az};function ZRe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape;Ge([a,i],"conv2dBackpropFilter");for(var f=S.backend_util.convertConv2DDataFormat(u),h=S.backend_util.computeConv2DInfo(a.shape,l,o,1,s,c,!1,f),p=h.strideHeight,d=h.strideWidth,v=h.filterHeight,m=h.filterWidth,g=h.dataFormat==="channelsLast",y=new S.TensorBuffer(h.filterShape,"float32"),b=h.padInfo.left,w=h.padInfo.top,x=t.data.get(a.dataId).values,N=t.data.get(i.dataId).values,T=new S.TensorBuffer(a.shape,a.dtype,x),E=new S.TensorBuffer(i.shape,i.dtype,N),C=0;C<v;++C)for(var F=Math.max(0,Math.ceil((w-C)/p)),D=Math.min(h.outHeight,(h.inHeight+w-C)/p),O=0;O<m;++O)for(var L=Math.max(0,Math.ceil((b-O)/d)),z=Math.min(h.outWidth,(h.inWidth+b-O)/d),$=0;$<h.inChannels;++$)for(var B=0;B<h.outChannels;++B){for(var W=0,X=0;X<h.batchSize;++X)for(var Y=F;Y<D;++Y)for(var V=C+Y*p-w,j=L;j<z;++j){var re=O+j*d-b;g?W+=T.get(X,V,re,$)*E.get(X,Y,j,B):W+=T.get(X,$,V,re)*E.get(X,B,Y,j)}y.set(W,C,O,$,B)}return t.makeTensorInfo(y.shape,y.dtype,y.values)}var JRe={kernelName:S.Conv2DBackpropFilter,backendName:"cpu",kernelFunc:ZRe};function QRe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode;Ge([a,i],"conv2dBackpropInput");var f=S.util.computeStrides(i.shape),h=S.util.computeStrides(a.shape),p=S.backend_util.convertConv2DDataFormat(c),d=S.backend_util.computeConv2DInfo(o,i.shape,s,1,u,l,!1,p),v=new S.TensorBuffer(d.inShape,"float32"),m=v.values,g=t.data.get(a.dataId).values,y=t.data.get(i.dataId).values,b=We(f,3),w=b[0],x=b[1],N=b[2],T=d.batchSize,E=d.filterHeight,C=d.filterWidth,F=d.inChannels,D=d.inHeight,O=d.inWidth,L=d.outChannels,z=d.outHeight,$=d.outWidth,B=d.strideHeight,W=d.strideWidth;p=d.dataFormat;for(var X=E-1-d.padInfo.top,Y=C-1-d.padInfo.left,V=p==="channelsLast",j=v.strides[0],re=V?v.strides[1]:v.strides[2],ne=V?v.strides[2]:1,oe=V?1:v.strides[1],le=h[0],de=V?h[1]:h[2],xe=V?h[2]:1,he=V?1:h[1],ye=0;ye<T;++ye)for(var we=0;we<F;++we)for(var Ae=0;Ae<D;++Ae)for(var Ye=Ae-X,ht=Math.max(0,Math.ceil(Ye/B)),at=Math.min(z,(E+Ye)/B),nt=0;nt<O;++nt){for(var lt=nt-Y,st=Math.max(0,Math.ceil(lt/W)),Ze=Math.min($,(C+lt)/W),tt=0,et=ht;et<at;++et)for(var rn=et*B-Ye,He=st;He<Ze;++He)for(var kt=He*W-lt,An=le*ye+de*et+xe*He,hr=w*(E-1-rn)+x*(C-1-kt)+N*we,On=0;On<L;++On){var _n=g[An+he*On],an=y[hr+On];tt+=_n*an}var Pr=j*ye+re*Ae+ne*nt+oe*we;m[Pr]=tt}return t.makeTensorInfo(v.shape,v.dtype,v.values)}var eOe={kernelName:S.Conv2DBackpropInput,backendName:"cpu",kernelFunc:QRe};function tOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=r.strides,s=r.pad,u=r.dilations;Ge([a,i],"conv3d");for(var c=S.backend_util.computeConv3DInfo(a.shape,i.shape,o,u,s),l=c.filterDepth,f=c.filterHeight,h=c.filterWidth,p=c.dilationDepth,d=c.dilationHeight,v=c.dilationWidth,m=c.padInfo,g=m.front,y=m.left,b=m.top,w=new S.TensorBuffer(c.outShape,a.dtype),x=t.data.get(a.dataId).values,N=t.data.get(i.dataId).values,T=w.values,E=S.util.computeStrides(a.shape),C=S.util.computeStrides(i.shape),F=0;F<c.batchSize;++F)for(var D=F*E[0],O=F*w.strides[0],L=0;L<c.outDepth;++L)for(var z=O+L*w.strides[1],$=L*c.strideDepth-g,B=0;B<l;++B){var W=$+B*p;if(!(W<0||W>=c.inDepth))for(var X=B*C[0],Y=D+W*E[1],V=0;V<c.outHeight;++V)for(var j=z+V*w.strides[2],re=V*c.strideHeight-b,ne=0;ne<f;++ne){var oe=re+ne*d;if(!(oe<0||oe>=c.inHeight))for(var le=X+ne*C[1],de=Y+oe*E[2],xe=0;xe<c.outWidth;++xe)for(var he=j+xe*c.outChannels,ye=xe*c.strideWidth-y,we=0;we<h;++we){var Ae=ye+we*v;if(!(Ae<0||Ae>=c.inWidth))for(var Ye=le+we*C[2],ht=de+Ae*c.inChannels,at=Ye,nt=0;nt<c.inChannels;++nt){for(var lt=x[ht+nt],st=0;st<c.outChannels;++st)T[he+st]+=lt*N[at+st];at+=c.outChannels}}}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}var nOe={kernelName:S.Conv3D,backendName:"cpu",kernelFunc:tOe};function rOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.dy,o=r.strides,s=r.pad,u=r.filterShape;Ge([a,i],"conv3dBackpropFilterV2");for(var c=S.util.computeStrides(a.shape),l=S.util.computeStrides(i.shape),f=S.backend_util.computeConv3DInfo(a.shape,u,o,1,s),h=f.strideDepth,p=f.strideHeight,d=f.strideWidth,v=f.filterDepth,m=f.filterHeight,g=f.filterWidth,y=new S.TensorBuffer(f.filterShape,"float32"),b=y.values,w=We(y.strides,4),x=w[0],N=w[1],T=w[2],E=w[3],C=t.data.get(i.dataId).values,F=We(l,4),D=F[0],O=F[1],L=F[2],z=F[3],$=t.data.get(a.dataId).values,B=We(c,4),W=B[0],X=B[1],Y=B[2],V=B[3],j=f.padInfo.front,re=f.padInfo.left,ne=f.padInfo.top,oe=0;oe<v;++oe)for(var le=Math.max(0,Math.ceil((j-oe)/h)),de=Math.min(f.outDepth,(f.inDepth+j-oe)/h),xe=oe*x,he=0;he<m;++he)for(var ye=Math.max(0,Math.ceil((ne-he)/p)),we=Math.min(f.outHeight,(f.inHeight+ne-he)/p),Ae=he*N+xe,Ye=0;Ye<g;++Ye)for(var ht=Math.max(0,Math.ceil((re-Ye)/d)),at=Math.min(f.outWidth,(f.inWidth+re-Ye)/d),nt=Ye*T+Ae,lt=0;lt<f.inChannels;++lt)for(var st=lt*E+nt,Ze=0;Ze<f.outChannels;++Ze){for(var tt=0,et=0;et<f.batchSize;++et)for(var rn=et*W,He=et*D,kt=le;kt<de;++kt)for(var An=oe+kt*h-j,hr=An*X+rn,On=kt*O+He,_n=ye;_n<we;++_n)for(var an=he+_n*p-ne,Pr=an*Y+hr,pr=_n*L+On,Mr=ht;Mr<at;++Mr){var Sn=Ye+Mr*d-re,Gi=Sn*V+Pr,Eu=Mr*z+pr;tt+=$[Gi+lt]*C[Eu+Ze]}b[st+Ze]=tt}return t.makeTensorInfo(y.shape,y.dtype,y.values)}var aOe={kernelName:S.Conv3DBackpropFilterV2,backendName:"cpu",kernelFunc:rOe};function iOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.filter,o=r.pad,s=r.strides,u=r.inputShape;Ge([a],"conv3dBackpropInputV2");for(var c=S.util.computeStrides(a.shape),l=S.util.computeStrides(i.shape),f=S.backend_util.computeConv3DInfo(u,i.shape,s,1,o),h=new S.TensorBuffer(f.inShape,"float32"),p=h.values,d=We(h.strides,4),v=d[0],m=d[1],g=d[2],y=d[3],b=t.data.get(a.dataId).values,w=We(c,4),x=w[0],N=w[1],T=w[2],E=w[3],C=t.data.get(i.dataId).values,F=We(l,4),D=F[0],O=F[1],L=F[2],z=F[3],$=f.batchSize,B=f.filterDepth,W=f.filterHeight,X=f.filterWidth,Y=f.inChannels,V=f.inDepth,j=f.inHeight,re=f.inWidth,ne=f.outChannels,oe=f.outDepth,le=f.outHeight,de=f.outWidth,xe=f.strideDepth,he=f.strideHeight,ye=f.strideWidth,we=B-1-f.padInfo.front,Ae=W-1-f.padInfo.top,Ye=X-1-f.padInfo.left,ht=0;ht<$;++ht)for(var at=0;at<Y;++at)for(var nt=0;nt<V;++nt)for(var lt=nt-we,st=Math.max(0,Math.ceil(lt/xe)),Ze=Math.min(oe,(B+lt)/xe),tt=0;tt<j;++tt)for(var et=tt-Ae,rn=Math.max(0,Math.ceil(et/he)),He=Math.min(le,(W+et)/he),kt=0;kt<re;++kt){for(var An=kt-Ye,hr=Math.max(0,Math.ceil(An/ye)),On=Math.min(de,(X+An)/ye),_n=0,an=st;an<Ze;++an)for(var Pr=an*xe-lt,pr=rn;pr<He;++pr)for(var Mr=pr*he-et,Sn=hr;Sn<On;++Sn)for(var Gi=Sn*ye-An,Eu=x*ht+N*an+T*pr+E*Sn,Uh=D*(B-1-Pr)+O*(W-1-Mr)+L*(X-1-Gi)+z*at,Ui=0;Ui<ne;++Ui){var os=b[Eu+Ui],Iu=C[Uh+Ui];_n+=os*Iu}p[v*ht+m*nt+g*tt+y*kt+at]=_n}return t.makeTensorInfo(h.shape,h.dtype,h.values)}var oOe={kernelName:S.Conv3DBackpropInputV2,backendName:"cpu",kernelFunc:iOe};var sOe=Mt(S.Cos,function(n){return Math.cos(n)}),uOe={kernelName:S.Cos,backendName:"cpu",kernelFunc:sOe};var cOe=Mt(S.Cosh,function(n){return Math.cosh(n)}),lOe={kernelName:S.Cosh,backendName:"cpu",kernelFunc:cOe};function fOe(n){for(var e=n.inputs,t=n.backend,r=n.attrs,a=e.image,i=e.boxes,o=e.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=We(a.shape,4),f=l[0],h=l[1],p=l[2],d=l[3],v=i.shape[0],m=We(s,2),g=m[0],y=m[1],b=S.buffer([v,g,y,d],"float32"),w=t.data.get(i.dataId).values,x=t.data.get(o.dataId).values,N=t.data.get(a.dataId).values,T=S.util.computeStrides(a.shape),E=S.util.computeStrides(b.shape),C=0;C<v;C++){var F=C*4,D=w[F],O=w[F+1],L=w[F+2],z=w[F+3],$=x[C];if(!($>=f))for(var B=g>1?(L-D)*(h-1)/(g-1):0,W=y>1?(z-O)*(p-1)/(y-1):0,X=0;X<g;X++){var Y=g>1?D*(h-1)+X*B:.5*(D+L)*(h-1);if(Y<0||Y>h-1){for(var V=0;V<y;V++)for(var j=0;j<d;j++){var re=j+V*E[2]+X*E[1]+C*E[0];b.values[re]=c}continue}if(u==="bilinear")for(var ne=Math.floor(Y),oe=Math.ceil(Y),le=Y-ne,V=0;V<y;V++){var de=y>1?O*(p-1)+V*W:.5*(O+z)*(p-1);if(de<0||de>p-1){for(var j=0;j<d;j++){var re=j+V*E[2]+X*E[1]+C*E[0];b.values[re]=c}continue}for(var xe=Math.floor(de),he=Math.ceil(de),ye=de-xe,j=0;j<d;j++){var re=j+xe*T[2]+ne*T[1]+$*T[0],we=N[re];re=j+he*T[2]+ne*T[1]+$*T[0];var Ae=N[re];re=j+xe*T[2]+oe*T[1]+$*T[0];var Ye=N[re];re=j+he*T[2]+oe*T[1]+$*T[0];var ht=N[re],at=we+(Ae-we)*ye,nt=Ye+(ht-Ye)*ye;re=j+V*E[2]+X*E[1]+C*E[0],b.values[re]=at+(nt-at)*le}}else for(var V=0;V<y;++V){var de=y>1?O*(p-1)+V*W:.5*(O+z)*(p-1);if(de<0||de>p-1){for(var j=0;j<d;j++){var re=j+V*E[2]+X*E[1]+C*E[0];b.values[re]=c}continue}for(var lt=Math.round(de),st=Math.round(Y),j=0;j<d;j++){var Ze=j+lt*T[2]+st*T[1]+$*T[0],tt=j+V*E[2]+X*E[1]+C*E[0];b.values[tt]=N[Ze]}}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}var hOe={kernelName:S.CropAndResize,backendName:"cpu",kernelFunc:fOe};function pOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.exclusive,s=r.reverse;Ge(a,"cumprod");var u=S.backend_util.getAxesPermutation([i],a.shape.length),c=a;u!=null&&(c=Or({inputs:{x:a},backend:t,attrs:{perm:u}}));var l=S.backend_util.getInnerMostAxes(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var f=S.upcastType(c.dtype,"int32"),h=S.util.makeOnesTypedArray(S.util.sizeFromShape(c.shape),f),p=t.data.get(c.dataId).values,d=c.shape[c.shape.length-1],v=s?function(T,E){return T+d-E-1}:function(T,E){return T+E},m=0;m<p.length;m+=d)for(var g=0;g<d;g++){var y=v(m,g);if(g===0)h[y]=o?1:p[y];else{var b=v(m,g-1);h[y]=o?p[b]*h[b]:p[y]*h[b]}}var w=t.makeTensorInfo(c.shape,f,h);if(u!=null){var x=S.backend_util.getUndoAxesPermutation(u),N=Or({inputs:{x:w},backend:t,attrs:{perm:x}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(c),N}return w}var dOe={kernelName:S.Cumprod,backendName:"cpu",kernelFunc:pOe};function vOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.exclusive,s=r.reverse;Ge(a,"cumsum");var u=S.backend_util.getAxesPermutation([i],a.shape.length),c=a;u!=null&&(c=Or({inputs:{x:a},backend:t,attrs:{perm:u}}));var l=S.backend_util.getInnerMostAxes(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var f=S.upcastType(c.dtype,"int32"),h=S.util.makeZerosTypedArray(S.util.sizeFromShape(c.shape),f),p=t.data.get(c.dataId).values,d=c.shape[c.shape.length-1],v=s?function(T,E){return T+d-E-1}:function(T,E){return T+E},m=0;m<p.length;m+=d)for(var g=0;g<d;g++){var y=v(m,g);if(g===0)h[y]=o?0:p[y];else{var b=v(m,g-1);h[y]=o?p[b]+h[b]:p[y]+h[b]}}var w=t.makeTensorInfo(c.shape,f,h);if(u!=null){var x=S.backend_util.getUndoAxesPermutation(u),N=Or({inputs:{x:w},backend:t,attrs:{perm:x}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(c),N}return w}var mOe={kernelName:S.Cumsum,backendName:"cpu",kernelFunc:vOe};function gOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.weights,o=r.size,s=r.binaryOutput;if(a.shape.length===1){var u=t.data.get(a.dataId).values,c=t.data.get(i.dataId).values,l=fx(u,c,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,l)}else if(a.shape.length===2){var f=t.bufferSync(a),h=t.bufferSync(i),p=RL(f,h,o,s);return t.makeTensorInfo(p.shape,i.dtype,p.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}var yOe={kernelName:S.DenseBincount,backendName:"cpu",kernelFunc:gOe};function bOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.blockSize,o=r.dataFormat;S.util.assert(o==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(o)});for(var s=a.shape[0],u=a.shape[1],c=a.shape[2],l=a.shape[3],f=u*i,h=c*i,p=l/(i*i),d=t.data.get(a.dataId).values,v=new Float32Array(s*f*h*p),m=0,g=0;g<s;++g)for(var y=0;y<f;++y)for(var b=Math.floor(y/i),w=y%i,x=0;x<h;++x)for(var N=Math.floor(x/i),T=x%i,E=(w*i+T)*p,C=0;C<p;++C){var F=C+E,D=F+l*(N+c*(b+u*g));v[m++]=d[D]}return t.makeTensorInfo([s,f,h,p],a.dtype,v)}var wOe={kernelName:S.DepthToSpace,backendName:"cpu",kernelFunc:bOe};function _z(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode;Ge([a,i],"depthwiseConv2DNative");var l=S.util.computeStrides(a.shape),f=S.util.computeStrides(i.shape),h=u;h==null&&(h=[1,1]),S.util.assert(S.backend_util.eitherStridesOrDilationsAreOne(o,h),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(h,"'")});for(var p=S.backend_util.computeConv2DInfo(a.shape,i.shape,o,h,s,c,!0),d=p.filterHeight,v=p.filterWidth,m=p.dilationHeight,g=p.dilationWidth,y=p.padInfo,b=y.left,w=y.top,x=p.outChannels/p.inChannels,N=new S.TensorBuffer(p.outShape,a.dtype),T=t.data.get(a.dataId).values,E=t.data.get(i.dataId).values,C=N.values,F=0;F<p.batchSize;++F)for(var D=F*l[0],O=F*N.strides[0],L=0;L<p.outHeight;++L)for(var z=O+L*N.strides[1],$=L*p.strideHeight-w,B=0;B<d;++B){var W=$+B*m;if(!(W<0||W>=p.inHeight))for(var X=B*f[0],Y=D+W*l[1],V=0;V<p.outWidth;++V)for(var j=z+V*N.strides[2],re=V*p.strideWidth-b,ne=0;ne<v;++ne){var oe=re+ne*g;if(!(oe<0||oe>=p.inWidth))for(var le=X+ne*f[1],de=Y+oe*p.inChannels,xe=j,he=le,ye=0;ye<p.inChannels;++ye){for(var we=T[de+ye],Ae=0;Ae<x;++Ae)C[xe+Ae]+=we*E[he+Ae];xe+=x,he+=x}}}return t.makeTensorInfo(N.shape,N.dtype,N.values)}var xOe={kernelName:S.DepthwiseConv2dNative,backendName:"cpu",kernelFunc:_z};function kOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape;Ge([a,i],"depthwiseConv2dNativeBackpropFilter");for(var f=S.backend_util.computeConv2DInfo(a.shape,l,o,s,u,c,!0),h=f.strideHeight,p=f.strideWidth,d=f.filterHeight,v=f.filterWidth,m=new S.TensorBuffer(f.filterShape,"float32"),g=f.padInfo.left,y=f.padInfo.top,b=f.outChannels/f.inChannels,w=t.data.get(a.dataId).values,x=new S.TensorBuffer(a.shape,a.dtype,w),N=t.data.get(i.dataId).values,T=new S.TensorBuffer(i.shape,i.dtype,N),E=0;E<d;++E)for(var C=Math.max(0,Math.ceil((y-E)/h)),F=Math.min(f.outHeight,(f.inHeight+y-E)/h),D=0;D<v;++D)for(var O=Math.max(0,Math.ceil((g-D)/p)),L=Math.min(f.outWidth,(f.inWidth+g-D)/p),z=0;z<f.outChannels;++z){for(var $=Math.trunc(z/b),B=z%b,W=0,X=0;X<f.batchSize;++X)for(var Y=C;Y<F;++Y)for(var V=E+Y*h-y,j=O;j<L;++j){var re=D+j*p-g;W+=x.get(X,V,re,$)*T.get(X,Y,j,z)}m.set(W,E,D,$,B)}return t.makeTensorInfo(m.shape,m.dtype,m.values)}var SOe={kernelName:S.DepthwiseConv2dNativeBackpropFilter,backendName:"cpu",kernelFunc:kOe};function NOe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.inputShape;Ge([a,i],"depthwiseConv2DNativeBackpropInput");for(var f=S.util.computeStrides(a.shape),h=S.util.computeStrides(i.shape),p=S.backend_util.computeConv2DInfo(l,i.shape,o,s,u,c,!0),d=new S.TensorBuffer(p.inShape,"float32"),v=d.values,m=We(d.strides,3),g=m[0],y=m[1],b=m[2],w=t.data.get(a.dataId).values,x=We(f,3),N=x[0],T=x[1],E=x[2],C=t.data.get(i.dataId).values,F=We(h,3),D=F[0],O=F[1],L=F[2],z=p.batchSize,$=p.filterHeight,B=p.filterWidth,W=p.inChannels,X=p.inHeight,Y=p.inWidth,V=p.outChannels,j=p.outHeight,re=p.outWidth,ne=p.strideHeight,oe=p.strideWidth,le=$-1-p.padInfo.top,de=B-1-p.padInfo.left,xe=V/W,he=0;he<z;++he)for(var ye=0;ye<W;++ye)for(var we=0;we<X;++we)for(var Ae=we-le,Ye=Math.max(0,Math.ceil(Ae/ne)),ht=Math.min(j,($+Ae)/ne),at=0;at<Y;++at){for(var nt=at-de,lt=Math.max(0,Math.ceil(nt/oe)),st=Math.min(re,(B+nt)/oe),Ze=0,tt=Ye;tt<ht;++tt)for(var et=tt*ne-Ae,rn=lt;rn<st;++rn)for(var He=rn*oe-nt,kt=N*he+T*tt+E*rn,An=D*($-1-et)+O*(B-1-He)+L*ye,hr=0;hr<xe;++hr){var On=ye*xe+hr,_n=w[kt+On],an=C[An+hr];Ze+=_n*an}v[g*he+y*we+b*at+ye]=Ze}return t.makeTensorInfo(d.shape,d.dtype,d.values)}var TOe={kernelName:S.DepthwiseConv2dNativeBackpropInput,backendName:"cpu",kernelFunc:NOe};function EOe(n){for(var e=n.inputs,t=n.backend,r=e.x,a=S.util.sizeFromShape(r.shape),i=t.data.get(r.dataId).values,o=S.buffer([a,a],r.dtype),s=o.values,u=0;u<i.length;u++)s[u*a+u]=i[u];var c=ya(ya([],We(r.shape),!1),We(r.shape),!1);return t.makeTensorInfo(c,o.dtype,o.values)}var IOe={kernelName:S.Diag,backendName:"cpu",kernelFunc:EOe};var COe={kernelName:S.Dilation2D,backendName:"cpu",kernelFunc:function(n){for(var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=r.strides,s=r.pad,u=r.dilations,c=t,l=c.data.get(a.dataId).values,f=a.shape.length,h=c.data.get(i.dataId).values,p=i.shape.length,d=S.backend_util.computeDilation2DInfo(a.shape,i.shape,o,s,"NHWC",u),v=d.batchSize,m=d.inHeight,g=d.inWidth,y=d.inChannels,b=d.outHeight,w=d.outWidth,x=d.padInfo,N=d.strideHeight,T=d.strideWidth,E=d.filterHeight,C=d.filterWidth,F=d.dilationHeight,D=d.dilationWidth,O=d.outShape,L=S.util.sizeFromShape(O),z=O.length,$=S.util.getArrayFromDType(a.dtype,L),B=0;B<v;++B)for(var W=0;W<b;++W)for(var X=W*N-x.top,Y=0;Y<w;++Y)for(var V=Y*T-x.left,j=0;j<y;++j){for(var re=Number.MIN_SAFE_INTEGER,ne=0;ne<E;++ne){var oe=X+ne*F;if(oe>=0&&oe<m)for(var le=0;le<C;++le){var de=V+le*D;if(de>=0&&de<g){var xe=S.util.locToIndex([B,oe,de,j],f,S.util.computeStrides(a.shape)),he=S.util.locToIndex([ne,le,j],p,S.util.computeStrides(i.shape)),ye=l[xe]+h[he];ye>re&&(re=ye)}}}var we=S.util.locToIndex([B,W,Y,j],z,S.util.computeStrides(O));$[we]=re}var Ae=c.write(S.util.toTypedArray($,a.dtype),O,a.dtype);return{dataId:Ae,shape:O,dtype:a.dtype}}};var AOe={kernelName:S.Dilation2DBackpropFilter,backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=e.dy,s=r.strides,u=r.pad,c=r.dilations,l=t,f=S.util.toNestedArray(a.shape,l.data.get(a.dataId).values),h=S.util.toNestedArray(i.shape,l.data.get(i.dataId).values),p=S.backend_util.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),d=p.batchSize,v=p.inHeight,m=p.inWidth,g=p.inChannels,y=p.outHeight,b=p.outWidth,w=p.padInfo,x=p.strideHeight,N=p.strideWidth,T=p.filterHeight,E=p.filterWidth,C=p.dilationHeight,F=p.dilationWidth,D=p.outShape;S.util.assert(o.rank===D.length,function(){return"Error in ".concat(S.Dilation2DBackpropFilter,", dy ")+"must have the same rank as output ".concat(D.length,", but got ")+"".concat(o.rank)});for(var O=S.util.toNestedArray(D,l.data.get(o.dataId).values),L=S.util.makeZerosNestedTypedArray(i.shape,i.dtype),z=0;z<d;++z)for(var $=0;$<y;++$)for(var B=$*x-w.top,W=0;W<b;++W)for(var X=W*N-w.left,Y=0;Y<g;++Y){for(var V=Number.MIN_SAFE_INTEGER,j=0,re=0,ne=0;ne<T;++ne){var oe=B+ne*C;if(oe>=0&&oe<v)for(var le=0;le<E;++le){var de=X+le*F;if(de>=0&&de<m){var xe=f[z][oe][de][Y]+h[ne][le][Y];xe>V&&(V=xe,j=ne,re=le)}}}L[j][re][Y]+=O[z][$][W][Y]}var he=l.write(S.util.toTypedArray(L,a.dtype),i.shape,i.dtype);return{dataId:he,shape:i.shape,dtype:i.dtype}}};var _Oe={kernelName:S.Dilation2DBackpropInput,backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=e.dy,s=r.strides,u=r.pad,c=r.dilations,l=t,f=S.util.toNestedArray(a.shape,l.data.get(a.dataId).values),h=S.util.toNestedArray(i.shape,l.data.get(i.dataId).values),p=S.backend_util.computeDilation2DInfo(a.shape,i.shape,s,u,"NHWC",c),d=p.batchSize,v=p.inHeight,m=p.inWidth,g=p.inChannels,y=p.outHeight,b=p.outWidth,w=p.padInfo,x=p.strideHeight,N=p.strideWidth,T=p.filterHeight,E=p.filterWidth,C=p.dilationHeight,F=p.dilationWidth,D=p.outShape;S.util.assert(o.rank===D.length,function(){return"Error in ".concat(S.Dilation2DBackpropInput,", dy ")+"must have the same rank as output ".concat(D.length,", but got ")+"".concat(o.rank)});for(var O=S.util.toNestedArray(D,l.data.get(o.dataId).values),L=S.util.makeZerosNestedTypedArray(a.shape,a.dtype),z=0;z<d;++z)for(var $=0;$<y;++$)for(var B=$*x-w.top,W=0;W<b;++W)for(var X=W*N-w.left,Y=0;Y<g;++Y){for(var V=Number.MIN_SAFE_INTEGER,j=B<0?0:B,re=X<0?0:X,ne=0;ne<T;++ne){var oe=B+ne*C;if(oe>=0&&oe<v)for(var le=0;le<E;++le){var de=X+le*F;if(de>=0&&de<m){var xe=f[z][oe][de][Y]+h[ne][le][Y];xe>V&&(V=xe,j=oe,re=de)}}}L[z][j][re][Y]+=O[z][$][W][Y]}var he=l.write(S.util.toTypedArray(L,a.dtype),a.shape,a.dtype);return{dataId:he,shape:a.shape,dtype:a.dtype}}};function nh(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims;Ge(a,"sum");var s;a.dtype==="bool"?s=Yo({inputs:{x:a},backend:t,attrs:{dtype:"int32"}}):s=Mi({inputs:{x:a},backend:t});var u=s.shape.length,c=S.util.parseAxisParam(i,s.shape),l=S.backend_util.getAxesPermutation(c,u),f=c,h=s;l!=null&&(h=Or({inputs:{x:s},backend:t,attrs:{perm:l}}),f=S.backend_util.getInnerMostAxes(f.length,u)),S.backend_util.assertAxesAreInnerMostDims("sum",f,h.shape.length);for(var p=We(S.backend_util.computeOutAndReduceShapes(h.shape,f),2),d=p[0],v=p[1],m=S.backend_util.upcastType(h.dtype,"int32"),g=Vv(t,d,m),y=S.util.sizeFromShape(v),b=t.data.get(g.dataId).values,w=t.data.get(h.dataId).values,x=0;x<b.length;++x){for(var N=x*y,T=0,E=0;E<y;++E)T+=w[N+E];b[x]=T}if(o){var C=S.backend_util.expandShapeToKeepDim(g.shape,c),F=g;g=qt({inputs:{x:g},backend:t,attrs:{shape:C}}),t.disposeIntermediateTensorInfo(F)}return t.disposeIntermediateTensorInfo(s),l!=null&&t.disposeIntermediateTensorInfo(h),g}var DOe={kernelName:S.Sum,backendName:"cpu",kernelFunc:nh};function FOe(n){var e,t,r,a,i=n.inputs,o=n.backend,s=n.attrs,u=s.equation,c=i,l=S.backend_util.decodeEinsumEquation(u,c.length),f=l.allDims,h=l.summedDims,p=l.idDims;S.backend_util.checkEinsumDimSizes(f.length,p,c);for(var d=S.backend_util.getEinsumComputePath(h,p),v=d.path,m=d.steps,g=m.length,y=null,b=f.length,w=[],x=0;x<g;++x){try{for(var N=(e=void 0,Rc(m[x])),T=N.next();!T.done;T=N.next()){var E=T.value,C=S.backend_util.getEinsumPermutation(b,p[E]),F=C.permutationIndices,D=C.expandDims,O=void 0;S.backend_util.isIdentityPermutation(F)?O=c[E]:(O=Or({inputs:{x:c[E]},backend:o,attrs:{perm:F}}),w.push(O));for(var L=O.shape.slice(),z=0;z<D.length;++z)L.splice(D[z],0,1);S.util.arraysEqual(O.shape,L)||(O=qt({inputs:{x:O},backend:o,attrs:{shape:L}}),w.push(O)),y===null?y=O:(y=Kv({inputs:{a:O,b:y},backend:o}),w.push(y))}}catch(X){e={error:X}}finally{try{T&&!T.done&&(t=N.return)&&t.call(N)}finally{if(e)throw e.error}}x<g-1&&(v[x]>=0&&(y=nh({inputs:{x:y},backend:o,attrs:{axis:v[x]-(f.length-b),keepDims:!1}}),w.push(y)),b--)}try{for(var $=Rc(w),B=$.next();!B.done;B=$.next()){var W=B.value;W!==y&&o.disposeIntermediateTensorInfo(W)}}catch(X){r={error:X}}finally{try{B&&!B.done&&(a=$.return)&&a.call($)}finally{if(r)throw r.error}}return y}var ROe={kernelName:S.Einsum,backendName:"cpu",kernelFunc:FOe};function OOe(n){var e=n.inputs,t=n.backend,r=e.dy,a=e.y;Ge([r,a],"eluGrad");for(var i=new Float32Array(S.util.sizeFromShape(a.shape)),o=t.data.get(a.dataId).values,s=t.data.get(r.dataId).values,u=0;u<o.length;++u){var c=o[u];c>=1?i[u]=s[u]:i[u]=s[u]*(c+1)}return t.makeTensorInfo(a.shape,"float32",i)}var POe={kernelName:S.EluGrad,backendName:"cpu",kernelFunc:OOe};var MOe=S.backend_util.ERF_P,BOe=S.backend_util.ERF_A1,LOe=S.backend_util.ERF_A2,zOe=S.backend_util.ERF_A3,$Oe=S.backend_util.ERF_A4,qOe=S.backend_util.ERF_A5,WOe=Mt(S.Erf,function(n){var e=Math.sign(n),t=Math.abs(n),r=1/(1+MOe*t);return e*(1-((((qOe*r+$Oe)*r+zOe)*r+LOe)*r+BOe)*r*Math.exp(-t*t))}),VOe={kernelName:S.Erf,backendName:"cpu",kernelFunc:WOe};function Uv(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.input,i=r.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(S.util.assert(-(o+1)<=i,function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")}),u=o+i+1),s.splice(u,0,1),qt({inputs:{x:a},backend:t,attrs:{shape:s}})}var GOe={kernelName:S.ExpandDims,backendName:"cpu",kernelFunc:Uv};var UOe=zn(function(n,e){return n/e}),gx=Zn(S.RealDiv,UOe),sx={kernelName:S.RealDiv,backendName:"cpu",kernelFunc:gx};function Dz(n,e,t){for(var r=n.shape,a=r[0],i=r[1],o=t.data.get(n.dataId),s=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,c=[a,i],l=S.util.sizeFromShape(c),f=S.util.getTypedArrayFromDType("float32",l),h=S.util.getTypedArrayFromDType("float32",l),p=0;p<a;p++){for(var d=cu({inputs:{x:s},backend:t,attrs:{begin:[p,0],size:[1,i]}}),v=cu({inputs:{x:u},backend:t,attrs:{begin:[p,0],size:[1,i]}}),m=na({inputs:{real:d,imag:v},backend:t}),g=HOe(m,e,t),y=g.real,b=g.imag,w=S.backend_util.mergeRealAndImagArrays(y,b),x=0;x<i;x++){var N=S.backend_util.getComplexWithIndex(w,x);f[p*i+x]=N.real,h[p*i+x]=N.imag}t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(m)}var T=t.makeTensorInfo(c,"float32",f),E=t.makeTensorInfo(c,"float32",h),C=na({inputs:{real:T,imag:E},backend:t});return t.disposeIntermediateTensorInfo(T),t.disposeIntermediateTensorInfo(E),C}function HOe(n,e,t){var r=S.util.sizeFromShape(n.shape),a=t.data.get(n.dataId),i=t.data.get(a.complexTensorInfos.real.dataId).values,o=t.data.get(a.complexTensorInfos.imag.dataId).values;if(KOe(r)){var s=ux(i,o,r,e,t),u=[n.shape[0],n.shape[1]];if(e){var c=t.makeTensorInfo(u,"float32",s.real),l=t.makeTensorInfo(u,"float32",s.imag),f=t.makeTensorInfo([],"float32",S.util.createScalarValue(r,"float32")),h=Mi({inputs:{x:f},backend:t}),p=sx.kernelFunc({inputs:{a:c,b:f},backend:t}),d=sx.kernelFunc({inputs:{a:l,b:h},backend:t}),v=t.data.get(p.dataId).values,m=t.data.get(d.dataId).values;return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),{real:v,imag:m}}return s}else{var g=S.backend_util.mergeRealAndImagArrays(i,o),y=jOe(g,r,e);return S.backend_util.splitRealAndImagArrays(y)}}function KOe(n){return(n&n-1)===0}function ux(n,e,t,r,a){if(t===1)return{real:n,imag:e};var i=S.backend_util.mergeRealAndImagArrays(n,e),o=t/2,s=S.backend_util.complexWithEvenIndex(i),u=s.real,c=s.imag,l=[u.length],f=a.makeTensorInfo(l,"float32",u),h=a.makeTensorInfo(l,"float32",c),p=na({inputs:{real:f,imag:h},backend:a}),d=S.backend_util.complexWithOddIndex(i),v=d.real,m=d.imag,g=[v.length],y=a.makeTensorInfo(g,"float32",v),b=a.makeTensorInfo(g,"float32",m),w=na({inputs:{real:y,imag:b},backend:a}),x=ux(u,c,o,r,a),N=x.real,T=x.imag,E=[N.length],C=a.makeTensorInfo(E,"float32",N),F=a.makeTensorInfo(E,"float32",T),D=na({inputs:{real:C,imag:F},backend:a}),O=ux(v,m,o,r,a),L=O.real,z=O.imag,$=[L.length],B=a.makeTensorInfo($,"float32",L),W=a.makeTensorInfo($,"float32",z),X=na({inputs:{real:B,imag:W},backend:a}),Y=S.backend_util.exponents(t,r),V=[Y.real.length],j=a.makeTensorInfo(V,"float32",Y.real),re=a.makeTensorInfo(V,"float32",Y.imag),ne=na({inputs:{real:j,imag:re},backend:a}),oe=Kv({inputs:{a:ne,b:X},backend:a}),le=Oc({inputs:{a:D,b:oe},backend:a}),de=vx({inputs:{a:D,b:oe},backend:a}),xe=uu({inputs:{input:le},backend:a}),he=uu({inputs:{input:de},backend:a}),ye=Pc({inputs:{input:le},backend:a}),we=Pc({inputs:{input:de},backend:a}),Ae=Mc({inputs:[xe,he],backend:a,attrs:{axis:0}}),Ye=Mc({inputs:[ye,we],backend:a,attrs:{axis:0}}),ht=a.data.get(Ae.dataId).values,at=a.data.get(Ye.dataId).values;return a.disposeIntermediateTensorInfo(f),a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(p),a.disposeIntermediateTensorInfo(y),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(w),a.disposeIntermediateTensorInfo(C),a.disposeIntermediateTensorInfo(F),a.disposeIntermediateTensorInfo(D),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(X),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(re),a.disposeIntermediateTensorInfo(ne),a.disposeIntermediateTensorInfo(oe),a.disposeIntermediateTensorInfo(le),a.disposeIntermediateTensorInfo(de),a.disposeIntermediateTensorInfo(xe),a.disposeIntermediateTensorInfo(ye),a.disposeIntermediateTensorInfo(he),a.disposeIntermediateTensorInfo(we),a.disposeIntermediateTensorInfo(Ae),a.disposeIntermediateTensorInfo(Ye),{real:ht,imag:at}}function jOe(n,e,t){for(var r=new Float32Array(e*2),a=0;a<e;a++){for(var i=0,o=0,s=0;s<e;s++){var u=S.backend_util.exponent(a*s,e,t),c=S.backend_util.getComplexWithIndex(n,s);i+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}t&&(i/=e,o/=e),S.backend_util.assignToTypedArray(r,i,o,a)}return r}function XOe(n){var e=n.inputs,t=n.backend,r=e.input,a=S.util.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],o=a/i,s=qt({inputs:{x:r},backend:t,attrs:{shape:[o,i]}}),u=Dz(s,!1,t),c=qt({inputs:{x:u},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(u),c}var YOe={kernelName:S.FFT,backendName:"cpu",kernelFunc:XOe};function yx(n){var e=n.backend,t=n.attrs,r=t.shape,a=t.value,i=t.dtype,o=i||S.util.inferDtype(a),s=S.util.getArrayFromDType(o,S.util.sizeFromShape(r));return JOe(s,a,o),e.makeTensorInfo(r,o,s)}var ZOe={kernelName:S.Fill,backendName:"cpu",kernelFunc:yx};function JOe(n,e,t){n.fill(e)}var QOe={kernelName:S.FlipLeftRight,backendName:"cpu",kernelFunc:function(n){var e=n.inputs;n.attrs;for(var t=n.backend,r=e.image,a=t,i=S.util.getTypedArrayFromDType(r.dtype,S.util.sizeFromShape(r.shape)),o=We(r.shape,4),s=o[0],u=o[1],c=o[2],l=o[3],f=a.data.get(r.dataId).values,h=0;h<s;h++)for(var p=h*c*u*l,d=0;d<u;d++)for(var v=d*(c*l),m=0;m<c;m++)for(var g=m*l,y=0;y<l;y++){var b=Math.round(c-m-1),w=p+v+g+y,x=f[w];if(b>=0&&b<c){var N=b*l,T=p+v+N+y;x=f[T]}i[w]=x}var E=a.write(i,r.shape,r.dtype);return{dataId:E,shape:r.shape,dtype:r.dtype}}};var ePe=zn(function(n,e){return Math.floor(n/e)}),tPe=Zn(S.FloorDiv,ePe,null,"int32"),nPe={kernelName:S.FloorDiv,backendName:"cpu",kernelFunc:tPe};function rPe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,f=r.dilations,h=r.dimRoundingMode,p=r.activation,d=r.leakyreluAlpha,v=Az({inputs:{x:a,filter:i},backend:t,attrs:{strides:u,pad:c,dataFormat:l,dilations:f,dimRoundingMode:h}});if(o){var m=v;if(l==="NCHW"&&o.shape.length===1&&o.shape[0]!==1){var g=qt({inputs:{x:o},backend:t,attrs:{shape:[o.shape[0],1,1]}});v=Oc({inputs:{a:v,b:g},backend:t}),t.disposeIntermediateTensorInfo(g)}else v=Oc({inputs:{a:v,b:o},backend:t});t.disposeIntermediateTensorInfo(m)}if(p){var m=v;if(l==="NCHW"&&p==="prelu"&&s.shape.length===1&&s.shape[0]!==1){var y=qt({inputs:{x:s},backend:t,attrs:{shape:[s.shape[0],1,1]}});v=Gv(t,v,p,y,d),t.disposeIntermediateTensorInfo(y)}else v=Gv(t,v,p,s,d);t.disposeIntermediateTensorInfo(m)}return v}var aPe={kernelName:S.FusedConv2D,backendName:"cpu",kernelFunc:rPe};function iPe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,f=r.dilations,h=r.dimRoundingMode,p=r.activation,d=r.leakyreluAlpha,v=_z({inputs:{x:a,filter:i},backend:t,attrs:{strides:u,pad:c,dataFormat:l,dilations:f,dimRoundingMode:h}});if(o){var m=v;v=Oc({inputs:{a:v,b:o},backend:t}),t.disposeIntermediateTensorInfo(m)}if(p){var m=v;v=Gv(t,v,p,s,d),t.disposeIntermediateTensorInfo(m)}return v}var oPe={kernelName:S.FusedDepthwiseConv2D,backendName:"cpu",kernelFunc:iPe};function sPe(n){var e=n.inputs,t=n.backend,r=e.params,a=e.indices,i=S.util.sizeFromShape(r.shape),o=a.shape,s=o[o.length-1],u=We(S.backend_util.prepareAndValidate(r,a),4),c=u[0],l=u[1],f=u[2],h=u[3];if(l===0)return t.makeTensorInfo(c,r.dtype,[]);var p=t.data.get(a.dataId).values,d=t.bufferSync(r),v=WL(p,d,r.dtype,l,s,f,h,r.shape,i);return t.makeTensorInfo(c,r.dtype,v.values)}var uPe={kernelName:S.GatherNd,backendName:"cpu",kernelFunc:sPe};function cPe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.indices,o=r.axis,s=r.batchDims;Ge([a,i],"gatherV2");for(var u=S.util.parseAxisParam(o,a.shape)[0],c=t.data.get(i.dataId).values,l=a.shape[u],f=function(N){var T=c[N];S.util.assert(T<=l-1&&T>=0,function(){return"GatherV2: the index value ".concat(T," is not in [0, ").concat(l-1,"]")})},h=0;h<c.length;++h)f(h);var p=s;s==null&&(p=0);var d=S.util.sizeFromShape(i.shape),v=S.backend_util.segment_util.collectGatherOpShapeInfo(a,i,u,p),m=qt({inputs:{x:a},backend:t,attrs:{shape:[v.batchSize,v.outerSize,v.dimSize,v.sliceSize]}}),g=qt({inputs:{x:i},backend:t,attrs:{shape:[v.batchSize,d/v.batchSize]}}),y=[v.batchSize,v.outerSize,d/v.batchSize,v.sliceSize],b=t.bufferSync(g),w=t.bufferSync(m),x=VL(w,b,y);return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),t.makeTensorInfo(v.outputShape,x.dtype,x.values)}var lPe={kernelName:S.GatherV2,backendName:"cpu",kernelFunc:cPe};function fPe(n){var e=n.inputs,t=n.backend,r=e.input,a=S.util.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],o=a/i,s=qt({inputs:{x:r},backend:t,attrs:{shape:[o,i]}}),u=Dz(s,!0,t),c=qt({inputs:{x:u},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(u),c}var hPe={kernelName:S.IFFT,backendName:"cpu",kernelFunc:fPe};var pPe=Mt(S.IsFinite,function(n){return Number.isFinite(n)?1:0},"bool"),dPe={kernelName:S.IsFinite,backendName:"cpu",kernelFunc:pPe};var vPe=Mt(S.IsInf,function(n){return Math.abs(n)===1/0?1:0},"bool"),mPe={kernelName:S.IsInf,backendName:"cpu",kernelFunc:vPe};var gPe=Mt(S.IsNan,function(n){return Number.isNaN(n)?1:0},"bool"),yPe={kernelName:S.IsNan,backendName:"cpu",kernelFunc:gPe};function bPe(n){var e=n.backend,t=n.attrs,r=t.start,a=t.stop,i=t.num,o=jL(r,a,i);return e.makeTensorInfo([o.length],"float32",o)}var wPe={kernelName:S.LinSpace,backendName:"cpu",kernelFunc:bPe};var xPe=Mt(S.Log1p,function(n){return Math.log1p(n)}),kPe={kernelName:S.Log1p,backendName:"cpu",kernelFunc:xPe};var SPe=zn(function(n,e){return n&&e}),NPe=Zn(S.LogicalAnd,SPe,null,"bool"),TPe={kernelName:S.LogicalAnd,backendName:"cpu",kernelFunc:NPe};var EPe=Mt(S.LogicalNot,function(n){return n?0:1},"bool"),IPe={kernelName:S.LogicalNot,backendName:"cpu",kernelFunc:EPe};var CPe=zn(function(n,e){return n||e}),APe=Zn(S.LogicalOr,CPe,null,"bool"),_Pe={kernelName:S.LogicalOr,backendName:"cpu",kernelFunc:APe};function DPe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta;Ge(a,"LRN");var c=a.shape[3],l=c-1,f=t.data.get(a.dataId).values,h=S.util.sizeFromShape(a.shape),p=new Float32Array(h);function d(y){for(var b=y%c,w=y-b+Math.max(0,b-i),x=y-b+Math.min(b+i,l),N=0;w<=x;w++){var T=f[w];N+=T*T}return N}for(var v=0;v<h;v++){var m=d(v),g=f[v]*Math.pow(o+s*m,-u);p[v]=g}return t.makeTensorInfo(a.shape,a.dtype,p)}var FPe={kernelName:S.LRN,backendName:"cpu",kernelFunc:DPe};function RPe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.y,o=e.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta;Ge(o,"LRNGrad");for(var f=S.util.sizeFromShape(o.shape),h=o.shape[3],p=t.data.get(o.dataId).values,d=t.data.get(a.dataId).values,v=t.data.get(i.dataId).values,m=new Float32Array(f),g=f,y=0;y<g;y++){for(var b=y%h,w=y-b+Math.max(0,b-s),x=y-b+Math.min(h,b+s+1),N=0,T=w;T<x;T++)N+=Math.pow(d[T],2);N=c*N+u;for(var T=w;T<x;T++){var E=-2*c*l*d[T]*v[y]/N;y===T&&(E+=Math.pow(N,-l)),E*=p[y],m[T]+=E}}return t.makeTensorInfo(o.shape,a.dtype,m)}var OPe={kernelName:S.LRNGrad,backendName:"cpu",kernelFunc:RPe};function Fz(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.reductionIndices,o=r.keepDims,s=t,u=a.shape,c=u.length,l=S.util.parseAxisParam(i,u),f=l,h=S.backend_util.getAxesPermutation(f,c),p=s.data.get(a.dataId).values;if(h!=null){for(var d=new Array(c),v=0;v<d.length;v++)d[v]=u[h[v]];p=px(p,u,a.dtype,h,d),f=S.backend_util.getInnerMostAxes(f.length,c),u=d}Ge(a,"max"),S.backend_util.assertAxesAreInnerMostDims("max",f,c);var m=We(S.backend_util.computeOutAndReduceShapes(u,f),2),g=m[0],y=m[1],b=S.util.sizeFromShape(y),w=YL(p,b,g,a.dtype),x=s.write(w,g,a.dtype),N=g;if(o){var d=S.backend_util.expandShapeToKeepDim(g,l);N=d}return{dataId:x,shape:N,dtype:a.dtype}}var PPe={kernelName:S.Max,backendName:"cpu",kernelFunc:Fz};function MPe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x;Ge(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=1;S.util.assert(S.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=S.backend_util.computePool2DInfo(a.shape,i,o,c,s,u),f;if(l.filterWidth===1&&l.filterHeight===1&&S.util.arraysEqual(l.inShape,l.outShape))f=Mi({inputs:{x:a},backend:t});else{var h=t.data.get(a.dataId).values,p=S.util.computeStrides(a.shape),d=mx(h,a.shape,a.dtype,p,l,"max");f=t.makeTensorInfo(l.outShape,a.dtype,d.values)}return f}var BPe={kernelName:S.MaxPool,backendName:"cpu",kernelFunc:MPe};function LPe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;Ge(a,"maxPool3d");var l=S.backend_util.computePool3DInfo(a.shape,i,o,1,s,u,c),f=t.data.get(a.dataId).values,h=Cz(f,a.shape,a.dtype,S.util.computeStrides(a.shape),l,"max");return t.makeTensorInfo(h.shape,"float32",h.values)}var zPe={kernelName:S.MaxPool3D,backendName:"cpu",kernelFunc:LPe};function $Pe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;Ge([a,i],"maxPool3DGrad");for(var l=S.backend_util.computePool3DInfo(i.shape,o,s,1,u,c),f=t.bufferSync(i),h=IRe(f,l),p=l.strideDepth,d=l.strideHeight,v=l.strideWidth,m=l.dilationDepth,g=l.dilationHeight,y=l.dilationWidth,b=l.effectiveFilterDepth,w=l.effectiveFilterHeight,x=l.effectiveFilterWidth,N=b-1-l.padInfo.front,T=x-1-l.padInfo.left,E=w-1-l.padInfo.top,C=S.buffer(i.shape,"float32"),F=t.bufferSync(a),D=0;D<l.batchSize;++D)for(var O=0;O<l.inChannels;++O)for(var L=0;L<l.inDepth;++L)for(var z=0;z<l.inHeight;++z)for(var $=0;$<l.inWidth;++$){for(var B=L-N,W=z-E,X=$-T,Y=0,V=0;V<b;V+=m){var j=(B+V)/p;if(!(j<0||j>=l.outDepth||Math.floor(j)!==j))for(var re=0;re<w;re+=g){var ne=(W+re)/d;if(!(ne<0||ne>=l.outHeight||Math.floor(ne)!==ne))for(var oe=0;oe<x;oe+=y){var le=(X+oe)/v;if(!(le<0||le>=l.outWidth||Math.floor(le)!==le)){var de=b*w*x-1-h.get(D,j,ne,le,O),xe=V*w*x+re*x+oe,he=de===xe?1:0;if(he!==0){var ye=F.get(D,j,ne,le,O);Y+=ye*he}}}}}C.set(Y,D,L,z,$,O)}return t.makeTensorInfo(C.shape,C.dtype,C.values)}var qPe={kernelName:S.MaxPool3DGrad,backendName:"cpu",kernelFunc:$Pe};function WPe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.input,o=e.output,s=i;Ge([i,o],"maxPoolGrad");for(var u=r.filterSize,c=r.strides,l=r.pad,f=r.dimRoundingMode,h=S.backend_util.computePool2DInfo(s.shape,u,c,1,l,f),p=t.data.get(s.dataId).values,d=S.buffer(h.outShape,s.dtype,Iz(p,s.shape,s.dtype,h).values),v=h.strideHeight,m=h.strideWidth,g=h.dilationHeight,y=h.dilationWidth,b=h.effectiveFilterHeight,w=h.effectiveFilterWidth,x=w-1-h.padInfo.left,N=b-1-h.padInfo.top,T=S.buffer(s.shape,"float32"),E=t.data.get(a.dataId).values,C=S.buffer(a.shape,"float32",E),F=0;F<h.batchSize;++F)for(var D=0;D<h.inChannels;++D)for(var O=0;O<h.inHeight;++O)for(var L=0;L<h.inWidth;++L){for(var z=O-N,$=L-x,B=0,W=0;W<b;W+=g){var X=(z+W)/v;if(!(X<0||X>=h.outHeight||Math.floor(X)!==X))for(var Y=0;Y<w;Y+=y){var V=($+Y)/m;if(!(V<0||V>=h.outWidth||Math.floor(V)!==V)){var j=b*w-1-d.get(F,X,V,D),re=W*w+Y,ne=j===re?1:0;if(ne!==0){var oe=C.get(F,X,V,D);B+=oe*ne}}}}T.set(B,F,O,L,D)}return t.makeTensorInfo(T.shape,T.dtype,T.values)}var VPe={kernelName:S.MaxPoolGrad,backendName:"cpu",kernelFunc:WPe};function GPe(n,e,t,r,a){var i=S.util.computeStrides(e),o=mx(n,e,t,i,a,"max"),s=Iz(n,e,t,a,!0,r);return[o.values,s.values]}var UPe={kernelName:S.MaxPoolWithArgmax,backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.attrs,r=n.backend,a=e.x,i=t.filterSize,o=t.strides,s=t.pad,u=t.includeBatchInIndex,c=r;Ge(a,"MaxPoolWithArgmax");var l=c.data.get(a.dataId).values,f=S.backend_util.computePool2DInfo(a.shape,i,o,[1,1],s),h=We(GPe(l,a.shape,a.dtype,u,f),2),p=h[0],d=h[1],v=c.write(p,f.outShape,a.dtype),m=c.write(d,f.outShape,a.dtype);return[{dataId:v,shape:f.outShape,dtype:a.dtype},{dataId:m,shape:f.outShape,dtype:"int32"}]}};function HPe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims,s=S.util.parseAxisParam(i,a.shape),u=S.backend_util.computeOutAndReduceShapes(a.shape,s),c=u[1],l=S.util.sizeFromShape(c),f=[],h=t.makeTensorInfo([],"float32",new Float32Array([l]));f.push(h);var p=Yo({inputs:{x:a},backend:t,attrs:{dtype:"float32"}});f.push(p);var d=gx({inputs:{a:p,b:h},backend:t});f.push(d);var v=nh({inputs:{x:d},backend:t,attrs:{axis:i,keepDims:o}});return f.forEach(function(m){return t.disposeIntermediateTensorInfo(m)}),v}var KPe={kernelName:S.Mean,backendName:"cpu",kernelFunc:HPe};function jPe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims;Ge(a,"min");var s=S.util.parseAxisParam(i,a.shape),u=s,c=S.backend_util.getAxesPermutation(u,a.shape.length),l=a;c!=null&&(l=Or({inputs:{x:a},backend:t,attrs:{perm:c}}),u=S.backend_util.getInnerMostAxes(u.length,a.shape.length)),S.backend_util.assertAxesAreInnerMostDims("min",u,l.shape.length);for(var f=We(S.backend_util.computeOutAndReduceShapes(l.shape,u),2),h=f[0],p=f[1],d=S.util.sizeFromShape(p),v=S.util.makeZerosTypedArray(S.util.sizeFromShape(h),l.dtype),m=t.data.get(l.dataId).values,g=0;g<v.length;++g){for(var y=g*d,b=m[y],w=0;w<d;++w){var x=m[y+w];(Number.isNaN(x)||x<b)&&(b=x)}v[g]=b}c!=null&&t.disposeIntermediateTensorInfo(l);var N=t.makeTensorInfo(h,l.dtype,v);if(o){var T=S.backend_util.expandShapeToKeepDim(h,s),E=qt({inputs:{x:N},backend:t,attrs:{shape:T}});return t.disposeIntermediateTensorInfo(N),E}return N}var XPe={kernelName:S.Min,backendName:"cpu",kernelFunc:jPe};function YPe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.paddings,o=r.mode;Ge(a,"mirrorPad");for(var s=i.map(function(T,E){return T[0]+a.shape[E]+T[1]}),u=i.map(function(T){return T[0]}),c=i.map(function(T,E){return T[0]+a.shape[E]}),l=o==="reflect"?0:1,f=t.data.get(a.dataId).values,h=a.shape.length,p=S.util.computeStrides(a.shape),d=S.util.sizeFromShape(s),v=s.length,m=S.util.computeStrides(s),g=S.util.getTypedArrayFromDType(a.dtype,d),y=0;y<d;y++){for(var b=S.util.indexToLoc(y,v,m),w=0;w<v;w++)b[w]<u[w]?b[w]=u[w]*2-b[w]-l:b[w]>=c[w]&&(b[w]=(c[w]-1)*2-b[w]+l);b=b.map(function(T,E){return T-u[E]});var x=S.util.locToIndex(b,h,p);g[y]=f[x]}var N=t.write(g,s,a.dtype);return{dataId:N,shape:s,dtype:a.dtype}}var ZPe={kernelName:S.MirrorPad,backendName:"cpu",kernelFunc:YPe};var JPe=zn(function(n,e){var t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e}),QPe=Zn(S.Mod,JPe),eMe={kernelName:S.Mod,backendName:"cpu",kernelFunc:QPe};function Rz(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.logits,i=r.dim,o=a.shape.length,s=i;if(s===-1&&(s=o-1),s!==o-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(o," and dim was ").concat(s));var u=S.util.parseAxisParam([s],a.shape),c=Fz({inputs:{x:a},backend:t,attrs:{reductionIndices:u,keepDims:!1}}),l=S.backend_util.expandShapeToKeepDim(c.shape,u),f=qt({inputs:{x:c},backend:t,attrs:{shape:l}}),h=vx({inputs:{a,b:f},backend:t}),p=zL({inputs:{x:h},backend:t}),d=nh({inputs:{x:p},backend:t,attrs:{axis:u,keepDims:!1}}),v=qt({inputs:{x:d},backend:t,attrs:{shape:l}}),m=gx({inputs:{a:p,b:v},backend:t});return t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(v),m}var tMe={kernelName:S.Softmax,backendName:"cpu",kernelFunc:Rz};function nMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.logits,i=r.numSamples,o=r.seed,s=r.normalized;Ge(a,"multinomial");for(var u=s?a:Rz({inputs:{logits:a},backend:t,attrs:{dim:-1}}),c=u.shape[0],l=u.shape[1],f=t.data.get(u.dataId).values,h=[c,i],p=S.util.makeZerosTypedArray(S.util.sizeFromShape(h),"int32"),d=0;d<c;++d){var v=d*l,m=new Float32Array(l-1);m[0]=f[v];for(var g=1;g<m.length;++g)m[g]=m[g-1]+f[v+g];for(var y=P3e.alea(o.toString()),b=d*i,w=0;w<i;++w){var x=y();p[b+w]=m.length;for(var g=0;g<m.length;g++)if(x<m[g]){p[b+w]=g;break}}}return s||t.disposeIntermediateTensorInfo(u),t.makeTensorInfo(h,"int32",p)}var rMe={kernelName:S.Multinomial,backendName:"cpu",kernelFunc:nMe};var aMe=S.kernel_impls.nonMaxSuppressionV3Impl;function iMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.boxes,i=e.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold;Ge(a,"NonMaxSuppression");var c=t.data.get(a.dataId).values,l=t.data.get(i.dataId).values,f=aMe(c,l,o,s,u).selectedIndices;return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}var oMe={kernelName:S.NonMaxSuppressionV3,backendName:"cpu",kernelFunc:iMe};var sMe=S.kernel_impls.nonMaxSuppressionV4Impl;function uMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.boxes,i=e.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize;Ge(a,"NonMaxSuppressionPadded");var l=t.data.get(a.dataId).values,f=t.data.get(i.dataId).values,h=sMe(l,f,o,s,u,c),p=h.selectedIndices,d=h.validOutputs;return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([d]))]}var cMe={kernelName:S.NonMaxSuppressionV4,backendName:"cpu",kernelFunc:uMe};var lMe=S.kernel_impls.nonMaxSuppressionV5Impl;function fMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.boxes,i=e.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma;Ge(a,"NonMaxSuppressionWithScore");var l=t.data.get(a.dataId).values,f=t.data.get(i.dataId).values,h=o,p=s,d=u,v=c,m=lMe(l,f,h,p,d,v),g=m.selectedIndices,y=m.selectedScores;return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var hMe={kernelName:S.NonMaxSuppressionV5,backendName:"cpu",kernelFunc:fMe};function pMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue;Ge(a,"oneHot");var c=S.util.sizeFromShape(a.shape),l=new Float32Array(c*o);l.fill(u);for(var f=t.data.get(a.dataId).values,h=0;h<c;++h)f[h]>=0&&f[h]<o&&(l[h*o+f[h]]=s);return t.makeTensorInfo(ya(ya([],We(a.shape),!1),[o],!1),i,l)}var dMe={kernelName:S.OneHot,backendName:"cpu",kernelFunc:pMe};function Hv(n){var e=n.inputs,t=n.backend,r=e.x;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){var a=uu({inputs:{input:r},backend:t}),i=Hv({inputs:{x:a},backend:t}),o=Pc({inputs:{input:r},backend:t}),s=Hv({inputs:{x:o},backend:t}),u=na({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return yx({backend:t,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var vMe={kernelName:S.ZerosLike,backendName:"cpu",kernelFunc:Hv};function Oz(n){var e=n.inputs,t=n.backend,r=e.x;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){var a=uu({inputs:{input:r},backend:t}),i=Oz({inputs:{x:a},backend:t}),o=Pc({inputs:{input:r},backend:t}),s=Hv({inputs:{x:o},backend:t}),u=na({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return yx({backend:t,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}var mMe={kernelName:S.OnesLike,backendName:"cpu",kernelFunc:Oz};function Pz(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.axis;if(e.length===1)return Uv({inputs:{input:e[0]},backend:t,attrs:{dim:a}});var i=e[0].shape,o=e[0].dtype;e.forEach(function(l){S.util.assertShapesMatch(i,l.shape,"All tensors passed to stack must have matching shapes"),S.util.assert(o===l.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=[],u=e.map(function(l){var f=Uv({inputs:{input:l},backend:t,attrs:{dim:a}});return s.push(f),f}),c=Mc({inputs:u,backend:t,attrs:{axis:a}});return s.forEach(function(l){return t.disposeIntermediateTensorInfo(l)}),c}var gMe={kernelName:S.Pack,backendName:"cpu",kernelFunc:Pz};function yMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.paddings,o=r.constantValue;Ge(a,"pad");var s=i.map(function(N,T){return N[0]+a.shape[T]+N[1]}),u=i.map(function(N){return N[0]}),c=t.data.get(a.dataId).values,l=S.util.sizeFromShape(a.shape),f=a.shape.length,h=S.util.computeStrides(a.shape),p=S.util.sizeFromShape(s),d=s.length,v=S.util.computeStrides(s),m=S.util.getTypedArrayFromDType(a.dtype,p);o!==0&&m.fill(o);for(var g=0;g<l;g++){var y=S.util.indexToLoc(g,f,h),b=y.map(function(N,T){return N+u[T]}),w=S.util.locToIndex(b,d,v);m[w]=c[g]}var x=t.write(m,s,a.dtype);return{dataId:x,shape:s,dtype:a.dtype}}var Mz={kernelName:S.PadV2,backendName:"cpu",kernelFunc:yMe};var bMe=zn(function(n,e){return Math.pow(n,e)}),wMe=Zn(S.Pow,bMe),xMe={kernelName:S.Pow,backendName:"cpu",kernelFunc:wMe};function kMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.paramsNestedSplits,i=e.paramsDenseValues,o=e.indices;r.outputRaggedRank;var s=a.map(function(g){return t.data.get(g.dataId).values}),u=a.map(function(g){return g.shape}),c=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values,f=We(nz(s,u,c,i.shape,i.dtype,l,o.shape),3),h=f[0],p=f[1],d=f[2],v=h.map(function(g){return t.makeTensorInfo([g.length],"int32",g)}),m=t.makeTensorInfo(d,i.dtype,p);return v.concat([m])}var SMe={kernelName:S.RaggedGather,backendName:"cpu",kernelFunc:kMe};function NMe(n){var e=n.inputs,t=n.backend,r=e.starts,a=e.limits,i=e.deltas,o=t.data.get(r.dataId).values,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=We(rz(o,r.shape,r.dtype,s,a.shape,u,i.shape),2),l=c[0],f=c[1],h=t.makeTensorInfo([l.length],"int32",l),p=t.makeTensorInfo([f.length],r.dtype,f);return[h,p]}var TMe={kernelName:S.RaggedRange,backendName:"cpu",kernelFunc:NMe};function EMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.shape,i=e.values,o=e.defaultValue,s=e.rowPartitionTensors,u=r.rowPartitionTypes,c=t.data.get(a.dataId).values,l=t.data.get(i.dataId).values,f=t.data.get(o.dataId).values,h=s.map(function(g){return t.data.get(g.dataId).values}),p=s.map(function(g){return g.shape}),d=We(az(c,a.shape,l,i.shape,i.dtype,f,o.shape,h,p,u),2),v=d[0],m=d[1];return t.makeTensorInfo(v,i.dtype,m)}var IMe={kernelName:S.RaggedTensorToTensor,backendName:"cpu",kernelFunc:EMe};function CMe(n){var e=n.backend,t=n.attrs,r=t.start,a=t.stop,i=t.dtype,o=t.step,s=iz(r,a,o,i);return e.makeTensorInfo([s.length],i,s)}var AMe={kernelName:S.Range,backendName:"cpu",kernelFunc:CMe};var _Me=Mt(S.Reciprocal,function(n){return 1/n}),DMe={kernelName:S.Reciprocal,backendName:"cpu",kernelFunc:_Me};function FMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;Ge(a,"resizeBilinear");for(var u=S.util.computeStrides(a.shape),c=We(s,2),l=c[0],f=c[1],h=We(a.shape,4),p=h[0],d=h[1],v=h[2],m=h[3],g=t.data.get(a.dataId).values,y=new Float32Array(S.util.sizeFromShape([p,l,f,m])),b=[i&&l>1?d-1:d,i&&f>1?v-1:v],w=[i&&l>1?l-1:l,i&&f>1?f-1:f],x=0,N=b[0]/w[0],T=b[1]/w[1],E=0;E<p;E++)for(var C=0;C<l;C++){var F=void 0;o?F=N*(C+.5)-.5:F=N*C;for(var D=Math.max(0,Math.floor(F)),O=F-D,L=Math.min(d-1,Math.ceil(F)),z=E*u[0]+D*u[1],$=E*u[0]+L*u[1],B=0;B<f;B++){var W=void 0;o?W=T*(B+.5)-.5:W=T*B;for(var X=Math.max(0,Math.floor(W)),Y=W-X,V=Math.min(v-1,Math.ceil(W)),j=z+X*u[2],re=$+X*u[2],ne=z+V*u[2],oe=$+V*u[2],le=0;le<m;le++){var de=g[j+le],xe=g[re+le],he=g[ne+le],ye=g[oe+le],we=de+(he-de)*Y,Ae=xe+(ye-xe)*Y,Ye=we+(Ae-we)*O;y[x++]=Ye}}}return t.makeTensorInfo([p,l,f,m],"float32",y)}var RMe={kernelName:S.ResizeBilinear,backendName:"cpu",kernelFunc:FMe};function OMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.images,i=e.dy,o=r.alignCorners;Ge([i,a],"resizeBilinearGrad");for(var s=S.util.computeStrides(a.shape),u=We(a.shape,4),c=u[0],l=u[1],f=u[2],h=u[3],p=We(i.shape,3),d=p[1],v=p[2],m=new Float32Array(c*l*f*h),g=[o&&d>1?l-1:l,o&&v>1?f-1:f],y=[o&&d>1?d-1:d,o&&v>1?v-1:v],b=g[0]/y[0],w=g[1]/y[1],x=t.data.get(i.dataId).values,N=0,T=0;T<c;T++)for(var E=T*s[0],C=0;C<d;C++)for(var F=C*b,D=Math.floor(F),O=Math.min(Math.ceil(F),l-1),L=E+D*s[1],z=E+O*s[1],$=F-D,B=1-$,W=0;W<v;W++)for(var X=W*w,Y=Math.floor(X),V=Math.min(Math.ceil(X),f-1),j=X-Y,re=1-j,ne=L+Y*s[2],oe=L+V*s[2],le=z+Y*s[2],de=z+V*s[2],xe=B*re,he=B*j,ye=$*re,we=$*j,Ae=0;Ae<h;Ae++){var Ye=x[N++];m[ne+Ae]+=Ye*xe,m[oe+Ae]+=Ye*he,m[le+Ae]+=Ye*ye,m[de+Ae]+=Ye*we}return t.makeTensorInfo([c,f,l,h],"float32",m)}var PMe={kernelName:S.ResizeBilinearGrad,backendName:"cpu",kernelFunc:OMe};function MMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;Ge(a,"resizeNearestNeighbor");for(var u=S.util.computeStrides(a.shape),c=We(s,2),l=c[0],f=c[1],h=We(a.shape,4),p=h[0],d=h[1],v=h[2],m=h[3],g=t.data.get(a.dataId).values,y=new Float32Array(p*l*f*m),b=[i&&l>1?d-1:d,i&&f>1?v-1:v],w=[i&&l>1?l-1:l,i&&f>1?f-1:f],x=b[0]/w[0],N=b[1]/w[1],T=0,E=0;E<p;E++)for(var C=E*u[0],F=0;F<l;F++){var D=o?x*(F+.5):x*F,O=Math.min(d-1,i?Math.round(D):Math.floor(D));o&&(O=Math.max(0,O));for(var L=C+O*u[1],z=0;z<f;z++){var $=o?N*(z+.5):N*z,B=Math.min(v-1,i?Math.round($):Math.floor($));o&&(B=Math.max(0,B));for(var W=L+B*u[2],X=0;X<m;X++){var Y=g[W+X];y[T++]=Y}}}return t.makeTensorInfo([p,l,f,m],a.dtype,y)}var BMe={kernelName:S.ResizeNearestNeighbor,backendName:"cpu",kernelFunc:MMe};function LMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.images,i=e.dy,o=r.alignCorners;Ge([i,a],"resizeNearestNeighborGrad");for(var s=S.util.computeStrides(a.shape),u=S.util.computeStrides(i.shape),c=We(a.shape,4),l=c[0],f=c[1],h=c[2],p=c[3],d=We(i.shape,3),v=d[1],m=d[2],g=new Float32Array(l*f*h*p),y=t.data.get(i.dataId).values,b=[o&&v>1?f-1:f,o&&m>1?h-1:h],w=[o&&v>1?v-1:v,o&&m>1?m-1:m],x=b[0]/w[0],N=b[1]/w[1],T=1/x,E=1/N,C=Math.ceil(T)*2+2,F=Math.ceil(E)*2+2,D=0;D<l;D++)for(var O=D*s[0],L=0;L<f;L++)for(var z=O+L*s[1],$=Math.floor(L*T),B=Math.floor($-C/2),W=0;W<h;W++)for(var X=z+W*s[2],Y=Math.floor(W*E),V=Math.floor(Y-F/2),j=0;j<p;j++){for(var re=0,ne=0;ne<C;ne++){var oe=ne+B;if(!(oe<0||oe>=v)){var le=O+oe*u[1],de=oe*x,xe=Math.min(f-1,o?Math.round(de):Math.floor(de));if(L===xe)for(var he=0;he<F;he++){var ye=he+V;if(!(ye<0||ye>=m)){var we=le+ye*u[2],Ae=ye*N,Ye=Math.min(h-1,o?Math.round(Ae):Math.floor(Ae));W===Ye&&(re+=y[we+j])}}}}g[X+j]=re}return t.makeTensorInfo(a.shape,a.dtype,g)}var zMe={kernelName:S.ResizeNearestNeighborGrad,backendName:"cpu",kernelFunc:LMe};function $Me(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.dims;Ge(a,"reverse");var o=a.shape.length,s=S.util.parseAxisParam(i,a.shape);if(o===0)return Mi({inputs:{x:a},backend:t});for(var u=new S.TensorBuffer(a.shape,a.dtype),c=t.bufferSync(a),l=function(h){var p=u.indexToLoc(h),d=p.slice();s.forEach(function(v){return d[v]=a.shape[v]-1-d[v]}),u.set.apply(u,ya([c.get.apply(c,ya([],We(d),!1))],We(p),!1))},f=0;f<u.size;f++)l(f);return t.makeTensorInfo(u.shape,u.dtype,u.values)}var qMe={kernelName:S.Reverse,backendName:"cpu",kernelFunc:$Me},WMe={kernelName:S.RotateWithOffset,backendName:"cpu",kernelFunc:function(n){for(var e=n.inputs,t=n.attrs,r=n.backend,a=e.image,i=t.radians,o=t.fillValue,s=t.center,u=r,c=S.util.getTypedArrayFromDType(a.dtype,S.util.sizeFromShape(a.shape)),l=We(a.shape,4),f=l[0],h=l[1],p=l[2],d=l[3],v=We(S.backend_util.getImageCenter(s,h,p),2),m=v[0],g=v[1],y=255,b=Math.sin(i),w=Math.cos(i),x=u.data.get(a.dataId).values,N=0;N<f;N++)for(var T=N*p*h*d,E=0;E<h;E++)for(var C=E*(p*d),F=0;F<p;F++)for(var D=F*d,O=0;O<d;O++){var L=[f,E,F,O],z=L[2],$=L[1],B=(z-m)*w-($-g)*b,W=(z-m)*b+($-g)*w;B=Math.round(B+m),W=Math.round(W+g);var X=o;if(typeof o!="number"&&(O===3?X=y:X=o[O]),B>=0&&B<p&&W>=0&&W<h){var Y=W*(p*d),V=B*d,j=T+Y+V+O;X=x[j]}var re=T+C+D+O;c[re]=X}var ne=u.write(c,a.shape,a.dtype);return{dataId:ne,shape:a.shape,dtype:a.dtype}}};var VMe=Mt(S.Round,function(n){var e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),GMe={kernelName:S.Round,backendName:"cpu",kernelFunc:VMe};function UMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.indices,i=e.updates,o=r.shape,s=S.backend_util.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,f=s.strides,h=s.outputSize,p=!0,d=t.bufferSync(a),v=t.bufferSync(i),m=Fc(d,v,o,h,l,c,u,f,0,p);return t.makeTensorInfo(o,m.dtype,m.values)}var HMe={kernelName:S.ScatterNd,backendName:"cpu",kernelFunc:UMe};function KMe(n,e){for(var t=0,r=n.length,a=0;t<r;)a=Math.floor((t+r)/2),n[a]<e?t=a+1:r=a;return r}function jMe(n,e){for(var t=0,r=n.length,a=0;t<r;)a=Math.floor((t+r)/2),n[a]<=e?t=a+1:r=a;return r}function XMe(n,e,t,r,a,i){for(var o=S.util.getArrayFromDType("int32",t*a),s=0;s<t;++s)for(var u=n.slice(s*r,(s+1)*r),c=s*a,l=0;l<a;++l)o[c+l]=i==="left"?KMe(u,e[l+c]):jMe(u,e[l+c]);return o}function YMe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.sortedSequence,i=e.values,o=r.side,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=XMe(s,u,a.shape[0],a.shape[1],i.shape[1],o);return t.makeTensorInfo(i.shape,"int32",c)}var ZMe={kernelName:S.SearchSorted,backendName:"cpu",kernelFunc:YMe};function JMe(n){var e=n.inputs,t=n.backend,r=e.condition,a=e.t,i=e.e;Ge([r,a,i],"select");for(var o=r.shape.length,s=t.data.get(r.dataId).values,u=t.data.get(a.dataId).values,c=t.data.get(i.dataId).values,l=S.upcastType(a.dtype,i.dtype),f=S.util.makeZerosTypedArray(S.util.sizeFromShape(a.shape),l),h=0,p=o===0||o>1||a.shape.length===1?1:S.util.sizeFromShape(a.shape.slice(1)),d=0;d<s.length;d++)for(var v=0;v<p;v++)s[d]===1?f[h++]=u[d]:f[h++]=c[d];return t.makeTensorInfo(a.shape,l,f)}var QMe={kernelName:S.Select,backendName:"cpu",kernelFunc:JMe};var e4e=S.backend_util.SELU_SCALEALPHA,t4e=S.backend_util.SELU_SCALE,n4e=Mt(S.Selu,function(n){return n>=0?t4e*n:e4e*(Math.exp(n)-1)}),r4e={kernelName:S.Selu,backendName:"cpu",kernelFunc:n4e};var a4e=Mt(S.Sign,function(n){return n<0?-1:n>0?1:0}),i4e={kernelName:S.Sign,backendName:"cpu",kernelFunc:a4e};var o4e=Mt(S.Sin,function(n){return Math.sin(n)}),s4e={kernelName:S.Sin,backendName:"cpu",kernelFunc:o4e};var u4e=Mt(S.Sinh,function(n){return Math.sinh(n)}),c4e={kernelName:S.Sinh,backendName:"cpu",kernelFunc:u4e};var l4e=11920928955078125e-23,EL=Math.log(l4e)+2,f4e=Mt(S.Softplus,function(n){var e=n>-EL,t=n<EL,r=Math.exp(n),a;return t?a=r:e?a=n:a=Math.log(1+r),a}),h4e={kernelName:S.Softplus,backendName:"cpu",kernelFunc:f4e};function p4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.blockShape,o=r.paddings;Ge([a],"spaceToBatchND");var s=S.util.sizeFromShape(i),u=[[0,0]];u.push.apply(u,ya([],We(o),!1));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=Mz.kernelFunc({inputs:{x:a},backend:t,attrs:{paddings:u,constantValue:0}}),f=S.backend_util.getReshaped(l.shape,i,s,!1),h=S.backend_util.getPermuted(f.length,i.length,!1),p=S.backend_util.getReshapedPermuted(l.shape,i,s,!1),d={x:l},v={shape:f},m=qt({inputs:d,backend:t,attrs:v}),g={x:m},y={perm:h},b=Or({inputs:g,backend:t,attrs:y}),w={x:b},x={shape:p},N=qt({inputs:w,backend:t,attrs:x});return t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(b),N}var d4e={kernelName:S.SpaceToBatchND,backendName:"cpu",kernelFunc:p4e};function v4e(n){var e=n.inputs,t=n.backend,r=e.indices,a=e.values,i=e.denseShape,o=e.defaultValue;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        `.concat(i.shape));if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        `.concat(r.shape));if(a.shape.length!==1)throw new Error(`Values must be a vector, saw:
        `.concat(a.shape));if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        `.concat(o.shape));var s=t.data.get(r.dataId).values,u=t.data.get(a.dataId).values,c=t.data.get(i.dataId).values,l=t.data.get(o.dataId).values[0],f=We(cz(s,r.shape,r.dtype,u,a.dtype,c,l),5),h=f[0],p=f[1],d=f[2],v=f[3],m=f[4];return[t.makeTensorInfo(p,r.dtype,h),t.makeTensorInfo([p[0]],a.dtype,d),t.makeTensorInfo([v.length],"bool",new Uint8Array(v.map(function(g){return Number(g)}))),t.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}var m4e={kernelName:S.SparseFillEmptyRows,backendName:"cpu",kernelFunc:v4e};function g4e(n){var e=n.inputs,t=n.backend,r=e.inputIndices,a=e.inputShape,i=e.newShape;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        `.concat(r.shape));if(a.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        `.concat(a.shape));if(i.shape.length!==1)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(t.data.get(a.dataId).values),s=t.data.get(r.dataId).values,u=Array.from(t.data.get(i.dataId).values),c=We(lz(s,r.shape,r.dtype,o,u),3),l=c[0],f=c[1],h=c[2];return[t.makeTensorInfo(f,r.dtype,l),t.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}var y4e={kernelName:S.SparseReshape,backendName:"cpu",kernelFunc:g4e};function b4e(n){var e=n.inputs,t=n.backend,r=e.data,a=e.indices,i=e.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          `.concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=t.data.get(r.dataId).values,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=We(dx(o,r.shape,r.dtype,s,u,!0),2),l=c[0],f=c[1];return t.makeTensorInfo(f,r.dtype,l)}var w4e={kernelName:S.SparseSegmentMean,backendName:"cpu",kernelFunc:b4e};function x4e(n){var e=n.inputs,t=n.backend,r=e.data,a=e.indices,i=e.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         `.concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=t.data.get(r.dataId).values,s=t.data.get(a.dataId).values,u=t.data.get(i.dataId).values,c=We(dx(o,r.shape,r.dtype,s,u),2),l=c[0],f=c[1];return t.makeTensorInfo(f,r.dtype,l)}var k4e={kernelName:S.SparseSegmentSum,backendName:"cpu",kernelFunc:x4e};function S4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.sparseIndices,i=e.sparseValues,o=e.defaultValue,s=r.outputShape,u=S.backend_util.calculateShapes(i,a,s),c=u.sliceRank,l=u.numUpdates,f=u.sliceSize,h=u.strides,p=u.outputSize,d=!1,v=t.bufferSync(a),m;switch(i.dtype){case"bool":{var g=t.bufferSync(i),y=Boolean(t.data.get(o.dataId).values[0]);m=Fc(v,g,s,p,f,l,c,h,y,d);break}case"float32":{var g=t.bufferSync(i),y=t.data.get(o.dataId).values[0];m=Fc(v,g,s,p,f,l,c,h,y,d);break}case"int32":{var g=t.bufferSync(i),y=t.data.get(o.dataId).values[0];m=Fc(v,g,s,p,f,l,c,h,y,d);break}case"string":{var g=t.bufferSync(i),y=S.util.decodeString(t.data.get(o.dataId).values[0]);m=Fc(v,g,s,p,f,l,c,h,y,d);break}default:throw new Error("Unsupported type ".concat(i.dtype))}return t.makeTensorInfo(s,m.dtype,m.values)}var N4e={kernelName:S.SparseToDense,backendName:"cpu",kernelFunc:S4e};function T4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.numOrSizeSplits,o=r.axis,s=S.util.parseAxisParam(o,a.shape)[0],u=S.backend_util.prepareSplitSize(a,i,s),c=new Array(a.shape.length).fill(0),l=a.shape.slice();return u.map(function(f){var h=ya([],We(l),!1);h[s]=f;var p=cu({inputs:{x:a},backend:t,attrs:{begin:c,size:h}});return c[s]+=f,p})}var E4e={kernelName:S.SplitV,backendName:"cpu",kernelFunc:T4e};var I4e={kernelName:S.Square,backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,a=t;Ge(r,"square");for(var i=a.data.get(r.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}var c=a.write(o,r.shape,r.dtype);return{dataId:c,shape:r.shape,dtype:r.dtype}}};var C4e=Mt(S.Step,function(n,e){var t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),A4e={kernelName:S.Step,backendName:"cpu",kernelFunc:C4e};function _4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.begin,o=r.end,s=r.strides,u=r.beginMask,c=r.endMask,l=r.ellipsisMask,f=r.newAxisMask,h=r.shrinkAxisMask;Ge(a,"stridedSlice");var p=S.slice_util.sliceInfo(a.shape,i,o,s,u,c,l,f,h),d=p.finalShapeSparse,v=p.finalShape,m=p.isIdentity,g=p.sliceDim0,y=p.isSimpleSlice,b=p.begin,w=p.end,x=p.strides,N;if(m)N=qt({inputs:{x:a},backend:t,attrs:{shape:v}});else if(g||y){S.util.assert(a.shape.length>=1,function(){return"Input must have rank at least 1, got: ".concat(a.shape.length)});var T=S.slice_util.computeOutShape(b,w,x),E=cu({inputs:{x:a},backend:t,attrs:{begin:b,size:T}});N=qt({inputs:{x:E},backend:t,attrs:{shape:v}}),t.disposeIntermediateTensorInfo(E)}else{var C=t.bufferSync(a),F=hz(d,C,x,b);N=t.makeTensorInfo(v,F.dtype,F.values)}return N}var D4e={kernelName:S.StridedSlice,backendName:"cpu",kernelFunc:_4e};function F4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,c=r.preserveShortSequences,l=e.data,f=e.dataSplits,h=t.data.get(l.dataId).values,p=t.data.get(f.dataId).values,d=We(pz(h,p,a,i,o,s,u,c),2),v=d[0],m=d[1];return[t.makeTensorInfo([v.length],"string",v),t.makeTensorInfo(f.shape,"int32",m)]}var R4e={kernelName:S.StringNGrams,backendName:"cpu",kernelFunc:F4e};function O4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.skipEmpty,i=e.input,o=e.delimiter;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error("Input must be a vector, got shape: ".concat(i.shape));if(o.shape.length!==0)throw new Error("Delimiter must be a scalar, got shape: ".concat(o.shape));var s=t.data.get(i.dataId).values,u=t.data.get(o.dataId).values[0],c=We(dz(s,u,a),3),l=c[0],f=c[1],h=c[2],p=f.length;return[t.makeTensorInfo([p,2],"int32",l),t.makeTensorInfo([p],"string",f),t.makeTensorInfo([2],"int32",new Int32Array(h))]}var P4e={kernelName:S.StringSplit,backendName:"cpu",kernelFunc:O4e};function M4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.numBuckets,i=e.input;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");var o=t.data.get(i.dataId).values,s=vz(o,a);return t.makeTensorInfo(i.shape,"int32",s)}var B4e={kernelName:S.StringToHashBucketFast,backendName:"cpu",kernelFunc:M4e};var L4e=Mt(S.Tan,function(n){return Math.tan(n)}),z4e={kernelName:S.Tan,backendName:"cpu",kernelFunc:L4e};var $4e=Mt(S.Tanh,function(n){return Math.tanh(n)}),q4e={kernelName:S.Tanh,backendName:"cpu",kernelFunc:$4e};function W4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.reps;Ge(a,"tile");var o=gz(t.bufferSync(a),i);return t.makeTensorInfo(o.shape,o.dtype,o.values)}var V4e={kernelName:S.Tile,backendName:"cpu",kernelFunc:W4e};function G4e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.k,o=r.sorted;Ge(a,"topk");var s=t.data.get(a.dataId).values,u=We(bz(s,a.shape,a.dtype,i,o),2),c=u[0],l=u[1];return[t.makeTensorInfo(c.shape,c.dtype,c.values),t.makeTensorInfo(l.shape,l.dtype,l.values)]}var U4e={kernelName:S.TopK,backendName:"cpu",kernelFunc:G4e};function H4e(n){var e=n.inputs,t=n.attrs,r=n.backend,a=e.image,i=e.transforms,o=t.interpolation,s=t.fillMode,u=t.fillValue,c=t.outputShape,l=We(a.shape,4),f=l[0],h=l[1],p=l[2],d=l[3],v=We(c??[h,p],2),m=v[0],g=v[1],y=[f,m,g,d],b=S.util.computeStrides(a.shape),w=b[0],x=b[1],N=b[2],T=S.util.computeStrides(y),E=T[0],C=T[1],F=T[2],D=S.util.getTypedArrayFromDType(a.dtype,S.util.sizeFromShape(y));D.fill(u);for(var O=r.data.get(a.dataId).values,L=r.data.get(i.dataId).values,z=0;z<f;++z){for(var $=i.shape[0]===1?L:L.subarray(z*8,z*8+8),B=0;B<m;++B)for(var W=0;W<g;++W)for(var X=0;X<d;++X){var Y=void 0,V=$[6]*W+$[7]*B+1;if(V!==0){var j=($[0]*W+$[1]*B+$[2])/V,re=($[3]*W+$[4]*B+$[5])/V,ne=IL(j,p,s),oe=IL(re,h,s);switch(o){case"nearest":Y=J4e(O,h,p,w,x,N,z,oe,ne,X,u);break;case"bilinear":Y=Q4e(O,h,p,w,x,N,z,oe,ne,X,u);break;default:throw new Error("Error in Transform: Expect 'nearest' or "+"'bilinear', but got ".concat(o))}var le=z*E+B*C+W*F+X;D[le]=Y}}return r.makeTensorInfo(y,a.dtype,D)}var de=r.write(D,y,a.dtype);return{dataId:de,shape:a.shape,dtype:a.dtype}}var K4e={kernelName:S.Transform,backendName:"cpu",kernelFunc:H4e};function IL(n,e,t){switch(t){case"reflect":return j4e(n,e);case"wrap":return X4e(n,e);case"nearest":return Z4e(n,e);case"constant":default:return Y4e(n)}}function j4e(n,e){var t=n;if(t<0)if(e<=1)t=0;else{var r=2*e;t<r&&(t=r*Math.trunc(-t/r)+t),t=t<-e?t+r:-t-1}else if(t>e-1)if(e<=1)t=0;else{var r=2*e;t-=r*Math.trunc(t/r),t>=e&&(t=r-t-1)}return S.util.clamp(0,t,e-1)}function X4e(n,e){var t=n;if(t<0)if(e<=1)t=0;else{var r=e-1;t+=e*(Math.trunc(-t/r)+1)}else if(t>e-1)if(e<=1)t=0;else{var r=e-1;t-=e*Math.trunc(t/r)}return S.util.clamp(0,t,e-1)}function Y4e(n,e){return n}function Z4e(n,e){return S.util.clamp(0,n,e-1)}function th(n,e,t,r,a,i,o,s,u,c,l){var f=o*r+s*a+u*i+c;return 0<=s&&s<e&&0<=u&&u<t?n[f]:l}function J4e(n,e,t,r,a,i,o,s,u,c,l){var f=Math.round(s),h=Math.round(u);return th(n,e,t,r,a,i,o,f,h,c,l)}function Q4e(n,e,t,r,a,i,o,s,u,c,l){var f=Math.floor(s),h=Math.floor(u),p=f+1,d=h+1,v=(d-u)*th(n,e,t,r,a,i,o,f,h,c,l)+(u-h)*th(n,e,t,r,a,i,o,f,d,c,l),m=(d-u)*th(n,e,t,r,a,i,o,p,h,c,l)+(u-h)*th(n,e,t,r,a,i,o,p,d,c,l);return(p-s)*v+(s-f)*m}function eBe(n){var e=n.inputs,t=n.attrs,r=n.backend,a=t.axis,i=e.x;Ge(i,"unique");var o=r.data.get(i.dataId).values,s=wz(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[r.makeTensorInfo(c,i.dtype,u),r.makeTensorInfo([l.length],"int32",l)]}var tBe={kernelName:S.Unique,backendName:"cpu",kernelFunc:eBe};function nBe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a.shape.length,s=a.shape[i],u=new Array(o-1),c=0,l=0;l<o;l++)l!==i&&(u[c++]=a.shape[l]);var f=new Array(o).fill(0),h=a.shape.slice();h[i]=1;for(var p=new Array(s),l=0;l<p.length;l++){f[i]=l;var d=cu({inputs:{x:a},backend:t,attrs:{begin:f,size:h}});p[l]=qt({inputs:{x:d},backend:t,attrs:{shape:u}}),t.disposeIntermediateTensorInfo(d)}return p}var rBe={kernelName:S.Unpack,backendName:"cpu",kernelFunc:nBe};function aBe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.segmentIds,o=r.numSegments;Ge(a,"unsortedSegmentSum");for(var s=a.shape.length,u=i.shape.length,c=[],l=[],f=s-u,h=i,p=0;p<f;++p){var d=Uv({inputs:{input:h},backend:t,attrs:{dim:p+1}});h=d,l.push(d)}for(var p=0;p<o;++p){var v=S.util.createScalarValue(p,"int32"),m=t.makeTensorInfo([],"int32",v),g=BL({inputs:{a:m,b:h},backend:t}),y=Yo({inputs:{x:g},backend:t,attrs:{dtype:"float32"}}),b=Kv({inputs:{a:y,b:a},backend:t}),w=nh({inputs:{x:b},backend:t,attrs:{axis:0,keepDims:!1}});c.push(w),l.push(m),l.push(g),l.push(y),l.push(b),l.push(w)}var x=Pz({inputs:c,backend:t,attrs:{axis:0}});return l.forEach(function(N){return t.disposeIntermediateTensorInfo(N)}),x}var iBe={kernelName:S.UnsortedSegmentSum,backendName:"cpu",kernelFunc:aBe},ix,CL,oBe=[tRe,z3e,rRe,iRe,U3e,sRe,cRe,fRe,pRe,vRe,gRe,bRe,xRe,NRe,ERe,ARe,DRe,RRe,PRe,QFe,BRe,zRe,qRe,VRe,V3e,K3e,URe,$3e,KRe,XRe,YRe,JRe,eOe,nOe,aOe,oOe,uOe,lOe,hOe,dOe,mOe,yOe,wOe,xOe,SOe,TOe,IOe,COe,AOe,_Oe,ROe,HFe,POe,j3e,VOe,X3e,GOe,Z3e,YOe,ZOe,QOe,Q3e,nPe,aPe,oPe,uPe,lPe,tFe,rFe,q3e,hPe,jRe,dPe,mPe,yPe,KFe,iFe,sFe,wPe,cFe,kPe,TPe,IPe,_Pe,FPe,OPe,PPe,fFe,BPe,zPe,qPe,VPe,UPe,KPe,XPe,pFe,ZPe,eMe,rMe,vFe,gFe,oMe,cMe,hMe,bFe,dMe,mMe,gMe,Mz,xMe,XFe,kFe,SMe,TMe,IMe,AMe,W3e,sx,DMe,YFe,ZFe,JFe,RMe,PMe,BMe,zMe,qMe,WMe,GMe,DFe,HMe,ZMe,QMe,r4e,RFe,i4e,s4e,c4e,OFe,tMe,h4e,d4e,m4e,y4e,w4e,k4e,N4e,E4e,BFe,I4e,zFe,A4e,D4e,R4e,P4e,B4e,VFe,DOe,z4e,q4e,V4e,U4e,K4e,wFe,tBe,rBe,iBe,vMe];try{for(Qf=Rc(oBe),Dc=Qf.next();!Dc.done;Dc=Qf.next())AL=Dc.value,S.registerKernel(AL)}catch(n){ix={error:n}}finally{try{Dc&&!Dc.done&&(CL=Qf.return)&&CL.call(Qf)}finally{if(ix)throw ix.error}}var AL,Qf,Dc;rh.MathBackendCPU=cx;rh.shared=GFe;rh.version_cpu=UFe});var Gq=J(Li=>{"use strict";Object.defineProperty(Li,"__esModule",{value:!0});var k=Cs();function sBe(n){if(n&&n.__esModule)return n;var e=Object.create(null);return n&&Object.keys(n).forEach(function(t){if(t!=="default"){var r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return n[t]}})}}),e.default=n,e}var uBe=sBe(k),xx=function(n,e){return xx=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a])},xx(n,e)};function cBe(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");xx(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function $c(n,e,t,r){function a(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function s(l){try{c(r.next(l))}catch(f){o(f)}}function u(l){try{c(r.throw(l))}catch(f){o(f)}}function c(l){l.done?i(l.value):a(l.value).then(s,u)}c((r=r.apply(n,e||[])).next())})}function qc(n,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},r,a,i,o;return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(c){return function(l){return u([c,l])}}function u(c){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,a&&(i=c[0]&2?a.return:c[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,c[1])).done)return i;switch(a=0,i&&(c=[c[0]&2,i.value]),c[0]){case 0:case 1:i=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,a=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){t.label=c[1];break}if(c[0]===6&&t.label<i[1]){t.label=i[1],i=c;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(c);break}i[2]&&t.ops.pop(),t.trys.pop();continue}c=e.call(n,t)}catch(l){c=[6,l],a=0}finally{r=i=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function ra(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Te(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),a,i=[],o;try{for(;(e===void 0||e-- >0)&&!(a=r.next()).done;)i.push(a.value)}catch(s){o={error:s}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(o)throw o.error}}return i}function pn(n,e,t){if(t||arguments.length===2)for(var r=0,a=e.length,i;r<a;r++)(i||!(r in e))&&(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return n.concat(i||Array.prototype.slice.call(e))}var fu={},jv={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function d$(n,e){fu[n]=e}function ki(n,e){if(!(n in fu)||e!=null){var t=fBe(n,e);if(t!==null)fu[n]=t;else return console.log("Could not get context for WebGL version",n),null}var r=fu[n];return r==null||r.isContextLost()?(delete fu[n],ki(n)):(r.disable(r.DEPTH_TEST),r.disable(r.STENCIL_TEST),r.disable(r.BLEND),r.disable(r.DITHER),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SAMPLE_COVERAGE),r.enable(r.SCISSOR_TEST),r.enable(r.CULL_FACE),r.cullFace(r.BACK),fu[n])}function lBe(n){if(typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function fBe(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=e??lBe(n);return t.addEventListener("webglcontextlost",function(r){r.preventDefault(),delete fu[n]},!1),k.env().getBool("SOFTWARE_WEBGL_ENABLED")&&(jv.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",jv)||t.getContext("experimental-webgl",jv):t.getContext("webgl2",jv)}var lh;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(lh||(lh={}));var ba;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(ba||(ba={}));var ir;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(ir||(ir={}));function vh(n,e){return[e,n]}function hBe(n,e){return n*e}function Xv(n){var e=k.util.sizeFromShape(n),t=Math.ceil(e/4);return k.util.sizeToSquarishShape(t)}function Vc(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function pBe(n,e){var t=Te(Vc(n,e),2),r=t[0],a=t[1];return r*a*4}function Ax(n,e){var t=n,r,a,i,o,s,u,c,l,f,h;return k.env().getNumber("WEBGL_VERSION")===2?(r=t.R32F,a=t.R16F,i=t.RGBA16F,o=t.RGBA32F,s=t.RED,c=4,l=1,f=t.HALF_FLOAT,h=t.FLOAT,u=t.RGBA8):(r=n.RGBA,a=n.RGBA,i=n.RGBA,o=t.RGBA,s=n.RGBA,c=4,l=4,f=e!=null?e.HALF_FLOAT_OES:null,h=n.FLOAT,u=n.RGBA),{internalFormatFloat:r,internalFormatHalfFloat:a,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:s,downloadTextureFormat:u,downloadUnpackNumChannels:c,defaultNumChannels:l,textureTypeHalfFloat:f,textureTypeFloat:h}}function Oe(n,e){var t=e();return k.env().getBool("DEBUG")&&dBe(n),t}function dBe(n){var e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+m$(n,e))}var vBe=596e-10,mBe=65504;function v$(n){return!!(k.env().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||vBe<Math.abs(n)&&Math.abs(n)<mBe)}function m$(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(e)}}function ih(n,e){return uo(n,function(){return n.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function g$(n,e){var t=uo(n,function(){return n.createShader(n.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Oe(n,function(){return n.shaderSource(t,e)}),Oe(n,function(){return n.compileShader(t)}),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function y$(n,e){var t=uo(n,function(){return n.createShader(n.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Oe(n,function(){return n.shaderSource(t,e)}),Oe(n,function(){return n.compileShader(t)}),k.env().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw _x(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}var gBe=/ERROR: [0-9]+:([0-9]+):/g;function _x(n,e){var t=gBe.exec(e);if(t==null){console.log("Couldn't parse line number in error: ".concat(e)),console.log(n);return}for(var r=+t[1],a=n.split(`
`),i=a.length.toString().length+2,o=a.map(function(h,p){return k.util.rightPad((p+1).toString(),i)+h}),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var c=o.slice(0,r-1),l=o.slice(r-1,r),f=o.slice(r);console.log(c.join(`
`)),console.log(e.split(`
`)[0]),console.log("%c ".concat(k.util.rightPad(l[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(f.join(`
`))}function b$(n){return uo(n,function(){return n.createProgram()},"Unable to create WebGLProgram.")}function w$(n,e){if(Oe(n,function(){return n.linkProgram(e)}),!k.env().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Qv(n,e){if(Oe(n,function(){return n.validateProgram(e)}),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function x$(n,e){var t=uo(n,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return Oe(n,function(){return n.bindBuffer(n.ARRAY_BUFFER,t)}),Oe(n,function(){return n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)}),t}function k$(n,e){var t=uo(n,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return Oe(n,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)}),Oe(n,function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)}),t}function yBe(){return k.env().getNumber("WEBGL_VERSION")===2?1:4}function S$(n){return uo(n,function(){return n.createTexture()},"Unable to create WebGLTexture.")}function N$(n,e){var t=k.env().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){var r="[".concat(n,"x").concat(e,"]");throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t){var r="[".concat(n,"x").concat(e,"]"),a="[".concat(t,"x").concat(t,"]");throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+a+".")}}function T$(n){return uo(n,function(){return n.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function kx(n,e,t,r,a,i,o){var s=n.getAttribLocation(e,t);return s===-1?!1:(Oe(n,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),Oe(n,function(){return n.vertexAttribPointer(s,a,n.FLOAT,!1,i,o)}),Oe(n,function(){return n.enableVertexAttribArray(s)}),!0)}function E$(n,e,t){D$(n,t),Oe(n,function(){return n.activeTexture(n.TEXTURE0+t)}),Oe(n,function(){return n.bindTexture(n.TEXTURE_2D,e)})}function bBe(n,e){D$(n,e),Oe(n,function(){return n.activeTexture(n.TEXTURE0+e)}),Oe(n,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function I$(n,e,t){return uo(n,function(){return n.getUniformLocation(e,t)},'uniform "'+t+'" not present in program.')}function C$(n,e,t){return n.getUniformLocation(e,t)}function A$(n,e,t,r){Oe(n,function(){return E$(n,e,r)}),Oe(n,function(){return n.uniform1i(t,r)})}function wBe(n){Oe(n,function(){return n.bindFramebuffer(n.FRAMEBUFFER,null)}),Oe(n,function(){return n.viewport(0,0,n.canvas.width,n.canvas.height)}),Oe(n,function(){return n.scissor(0,0,n.canvas.width,n.canvas.height)})}function em(n,e,t){Oe(n,function(){return n.bindFramebuffer(n.FRAMEBUFFER,t)}),Oe(n,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0)})}function Sx(n,e){Oe(n,function(){return n.bindFramebuffer(n.FRAMEBUFFER,e)}),Oe(n,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)})}function oh(n){var e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+_$(n,e))}function _$(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(e)}}function uo(n,e,t){var r=Oe(n,function(){return e()});if(r==null)throw new Error(t);return r}function D$(n,e){var t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t){var a="[gl.TEXTURE0, gl.TEXTURE".concat(t,"]");throw new Error("textureUnit must be in ".concat(a,"."))}}function hu(n,e){return e===void 0&&(e=2),k.util.sizeFromShape(n.slice(0,n.length-e))}function pu(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function sh(n){var e=[1,1,1],t=n.length===0||n.length===1&&n[0]===1;return t||(e=pn([hu(n)],Te(pu(n)),!1)),e}function F$(n,e){var t;e===void 0&&(e=!1);var r=k.env().getNumber("WEBGL_MAX_TEXTURE_SIZE"),a=k.env().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");if(a===1/0&&k.env().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(a=r/2),e&&(r=r*2,a=a*2,n=n.map(function(h,p){return p>=n.length-2?k.util.nearestLargerEven(n[p]):n[p]}),n.length===1&&(n=[2,n[0]])),n.length!==2){var i=k.util.squeezeShape(n);n=i.newShape}var o=k.util.sizeFromShape(n),s=null;n.length<=1&&o<=r?s=[1,o]:n.length===2&&n[0]<=r&&n[1]<=r?s=n:n.length===3&&n[0]*n[1]<=r&&n[2]<=r?s=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=r&&n[1]*n[2]<=r?s=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=r&&n[3]<=r?s=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=r&&n[1]*n[2]*n[3]<=r&&(s=[n[0],n[1]*n[2]*n[3]]);var u=s!=null&&Math.max.apply(Math,pn([],Te(s),!1))>a&&Math.min.apply(Math,pn([],Te(s),!1))<=(e?2:1)&&Math.min.apply(Math,pn([],Te(s),!1))>0;if(s==null||u)if(e){var c=hu(n),l=2,f=2;n.length&&(t=Te(pu(n),2),l=t[0],f=t[1]),o=c*(l/2)*(f/2),s=k.util.sizeToSquarishShape(o).map(function(h){return h*2})}else s=k.util.sizeToSquarishShape(o);return s}function Yv(n){return n%2===0}function fh(n,e){if(n=n.slice(-2),e=e.slice(-2),k.util.arraysEqual(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){var t=n.slice(-1)[0],r=e.slice(-1)[0];if(t===r||Yv(t)&&Yv(r)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&Yv(n[0])&&Yv(e[0])}var tm,nm;function R$(n){if(tm==null){var e=ki(n);tm=e.getParameter(e.MAX_TEXTURE_SIZE)}return tm}function xBe(){tm=null}function kBe(){nm=null}function O$(n){if(nm==null){var e=ki(n);nm=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,nm)}function P$(n){if(n===0)return 0;var e,t=ki(n);return wa(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:wa(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function wa(n,e){var t=n.getExtension(e);return t!=null}function Nx(n){try{var e=ki(n);if(e!=null)return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function M$(n){if(n===0)return!1;var e=ki(n);if(n===1){if(!wa(e,"OES_texture_float"))return!1}else if(!wa(e,"EXT_color_buffer_float"))return!1;var t=Tx(e);return t}function B$(n){if(n===0)return!1;var e=ki(n);if(n===1){if(!wa(e,"OES_texture_float")||!wa(e,"WEBGL_color_buffer_float"))return!1}else{if(wa(e,"EXT_color_buffer_float"))return Tx(e);var t="EXT_color_buffer_half_float";if(wa(e,t)){var r=e.getExtension(t);return SBe(e,r)}return!1}var a=Tx(e);return a}function Tx(n){var e=Ax(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t);var r=1,a=1;n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,r,a,0,e.textureFormatFloat,e.textureTypeFloat,null);var i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);var o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(i),o}function SBe(n,e){var t=Ax(n,e),r=n.createTexture();n.bindTexture(n.TEXTURE_2D,r);var a=1,i=1;n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,a,i,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);var o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r,0);var s=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(r),n.deleteFramebuffer(o),s}function L$(n){if(n!==2)return!1;var e=ki(n),t=e.fenceSync!=null;return t}function Gc(n,e){Array.isArray(n)||(n=[n]),n.forEach(function(t){t!=null&&k.util.assert(t.dtype!=="complex64",function(){return"".concat(e," does not support complex64 tensors ")+"in the WebGL backend."})})}var NBe={__proto__:null,callAndCheck:Oe,canBeRepresented:v$,getWebGLErrorMessage:m$,getExtensionOrThrow:ih,createVertexShader:g$,createFragmentShader:y$,logShaderSourceAndInfoLog:_x,createProgram:b$,linkProgram:w$,validateProgram:Qv,createStaticVertexBuffer:x$,createStaticIndexBuffer:k$,getNumChannels:yBe,createTexture:S$,validateTextureSize:N$,createFramebuffer:T$,bindVertexBufferToProgramAttribute:kx,bindTextureUnit:E$,unbindTextureUnit:bBe,getProgramUniformLocationOrThrow:I$,getProgramUniformLocation:C$,bindTextureToProgramUniformSampler:A$,bindCanvasToFramebuffer:wBe,bindColorTextureToFramebuffer:em,unbindColorTextureFromFramebuffer:Sx,validateFramebuffer:oh,getFramebufferErrorMessage:_$,getBatchDim:hu,getRowsCols:pu,getShapeAs3D:sh,getTextureShapeFromLogicalShape:F$,isReshapeFree:fh,getWebGLMaxTextureSize:R$,resetMaxTextureSize:xBe,resetMaxTexturesInShader:kBe,getMaxTexturesInShader:O$,getWebGLDisjointQueryTimerVersion:P$,hasExtension:wa,isWebGLVersionEnabled:Nx,isCapableOfRenderingToFloatTexture:M$,isDownloadFloatTextureEnabled:B$,isWebGLFenceEnabled:L$,assertNotComplex:Gc};var Ke=k.env();Ke.registerFlag("HAS_WEBGL",function(){return Ke.getNumber("WEBGL_VERSION")>0});Ke.registerFlag("WEBGL_VERSION",function(){return Nx(2)?2:Nx(1)?1:0});Ke.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",function(){return!1});Ke.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return Ke.get("WEBGL_VERSION")===2});Ke.registerFlag("WEBGL_CPU_FORWARD",function(){return!0});Ke.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1});Ke.registerFlag("WEBGL_PACK",function(){return Ke.getBool("HAS_WEBGL")});Ke.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_CLIP",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_PACK_REDUCE",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_LAZILY_UNPACK",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_CONV_IM2COL",function(){return Ke.getBool("WEBGL_PACK")});Ke.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return R$(Ke.getNumber("WEBGL_VERSION"))});Ke.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return O$(Ke.getNumber("WEBGL_VERSION"))});Ke.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var n=Ke.getNumber("WEBGL_VERSION");return n===0?0:P$(n)});Ke.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return Ke.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!k.device_util.isMobile()});Ke.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return M$(Ke.getNumber("WEBGL_VERSION"))});Ke.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return Ke.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Ke.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")});Ke.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return B$(Ke.getNumber("WEBGL_VERSION"))});Ke.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return L$(Ke.getNumber("WEBGL_VERSION"))});Ke.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){var n=Ke.getBool("WEBGL_RENDER_FLOAT32_ENABLED");return n?4:0});Ke.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",function(){return-1},function(n){if(n<0&&n!==-1)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never "+"delete) or at least 0, but got ".concat(n,"."))});Ke.registerFlag("WEBGL_FLUSH_THRESHOLD",function(){return k.device_util.isMobile()?1:-1},function(n){if(n<0&&n!==-1)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never "+"manual flush) or at least 0, but got ".concat(n,"."))});Ke.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",function(){return 128});Ke.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",function(){return!1});Ke.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",function(){return 1e5});Ke.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",function(){return 128});Ke.registerFlag("WEBGL_EXP_CONV",function(){return!1});Ke.registerFlag("SOFTWARE_WEBGL_ENABLED",function(){return Ke.getBool("IS_TEST")});Ke.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",function(){return 1/0});Ke.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",function(){return!1});Ke.registerFlag("WEBGL2_ISNAN_CUSTOM",function(){return!1});Ke.registerFlag("ENGINE_COMPILE_ONLY",function(){return!1});function xr(){var n,e,t,r,a,i,o,s,u,c;return k.env().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",s=k.env().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",u="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",r="varying",a="texture2D",i="gl_FragColor",o="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function du(n,e,t){t===void 0&&(t="index");var r=k.util.computeStrides(e);return r.map(function(a,i){var o="int ".concat(n[i]," = ").concat(t," / ").concat(a),s=i===r.length-1?"int ".concat(n[i+1]," = ").concat(t," - ").concat(n[i]," * ").concat(a):"index -= ".concat(n[i]," * ").concat(a);return"".concat(o,"; ").concat(s,";")}).join("")}function um(n,e,t){t===void 0&&(t="index");var r=k.util.computeStrides(e);return r.map(function(a,i){var o="int ".concat(n[i]," = ").concat(t," / outShapeStrides[").concat(i,"]"),s=i===r.length-1?"int ".concat(n[i+1]," = ").concat(t," - ").concat(n[i]," * outShapeStrides[").concat(i,"]"):"index -= ".concat(n[i]," * outShapeStrides[").concat(i,"]");return"".concat(o,"; ").concat(s,";")}).join("")}function TBe(n,e){var t=n.length,r=n.map(function(o){return"".concat(e,"[").concat(o,"]")}),a=new Array(t-1);a[t-2]=r[t-1];for(var i=t-3;i>=0;--i)a[i]="(".concat(a[i+1]," * ").concat(r[i+1],")");return a}function EBe(n,e,t){t===void 0&&(t="index");var r=n.map(function(i,o){return o}),a=TBe(r,e);return a.map(function(i,o){var s="int ".concat(n[o]," = ").concat(t," / ").concat(a[o]),u=o===a.length-1?"int ".concat(n[o+1]," = ").concat(t," - ").concat(n[o]," * ").concat(a[o]):"index -= ".concat(n[o]," * ").concat(a[o]);return"".concat(s,"; ").concat(u,";")}).join("")}function Dx(n){var e=k.util.computeStrides(n).map(function(t){return t.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `.concat(e[0]," + coords.y * ").concat(e[1],` + coords.z;
  }
`)}function Fx(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}var z$=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`,$$=k.backend_util.getBroadcastDims;function IBe(n,e,t){var r=[];if(n.forEach(function(p){var d=k.util.sizeFromShape(p.shapeInfo.logicalShape);if(p.shapeInfo.isUniform?r.push("uniform float ".concat(p.name).concat(d>1?"[".concat(d,"]"):"",";")):(r.push("uniform sampler2D ".concat(p.name,";")),r.push("uniform int offset".concat(p.name,";"))),t.enableShapeUniforms){var v=Rx(t.packedInputs,p.shapeInfo.logicalShape,p.shapeInfo.texShape).uniformShape;switch(v.length){case 1:r.push("uniform int ".concat(p.name,"Shape;"));break;case 2:r.push("uniform ivec2 ".concat(p.name,"Shape;"));break;case 3:r.push("uniform ivec3 ".concat(p.name,"Shape;"));break;case 4:r.push("uniform ivec4 ".concat(p.name,"Shape;"));break}r.push("uniform ivec2 ".concat(p.name,"TexShape;"))}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;");break}r.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(function(p){r.push("uniform ".concat(p.type," ").concat(p.name).concat(p.arrayIndex?"[".concat(p.arrayIndex,"]"):"",";"))});var a=r.join(`
`),i=n.map(function(p){return CBe(p,e,t.packedInputs,t.enableShapeUniforms)}).join(`
`),o=e.texShape,s=xr(),u=DBe(s),c,l,f=OBe(s);e.isPacked?(c=ABe(e.logicalShape,o,t.enableShapeUniforms),l=RBe(s)):(c=_Be(e.logicalShape,o,t.enableShapeUniforms),l=FBe(s)),t.packedInputs&&(f+=LBe);var h=[f,u,l,a,c,i,t.userCode].join(`
`);return h}function Uc(n,e){e===void 0&&(e=!1);var t=n.shapeInfo.logicalShape;switch(t.length){case 0:return YBe(n,e);case 1:return JBe(n,e);case 2:return eLe(n,e);case 3:return nLe(n,e);case 4:return aLe(n,e);case 5:return iLe(n);case 6:return oLe(n);default:throw new Error("".concat(t.length,"-D input sampling")+" is not yet supported")}}function q$(n,e){var t=n.shapeInfo.logicalShape;switch(t.length){case 0:return XBe(n);case 1:return ZBe(n,e);case 2:return QBe(n,e);case 3:return tLe(n,e);default:return rLe(n,e)}}function CBe(n,e,t,r){t===void 0&&(t=!1);var a="";t?a+=q$(n,r):a+=Uc(n,r);var i=n.shapeInfo.logicalShape,o=e.logicalShape;return i.length<=o.length&&(t?a+=sLe(n,e):a+=uLe(n,e)),a}function ABe(n,e,t){switch(n.length){case 0:return W$();case 1:return zBe(n,e,t);case 2:return KBe(n,e,t);case 3:return qBe(n,e,t);default:return VBe(n,e,t)}}function _Be(n,e,t){switch(n.length){case 0:return W$();case 1:return $Be(n,e,t);case 2:return jBe(n,e,t);case 3:return WBe(n,e,t);case 4:return GBe(n,e,t);case 5:return UBe(n,e);case 6:return HBe(n,e);default:throw new Error("".concat(n.length,"-D output sampling is not yet supported"))}}function DBe(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `.concat(n.texture2D,`(textureSampler, uv).r;
    }
  `)}function FBe(n){return`
    void setOutput(float val) {
      `.concat(n.output,` = vec4(val, 0, 0, 0);
    }
  `)}function RBe(n){return`
    void setOutput(vec4 val) {
      `.concat(n.output,` = val;
    }
  `)}function OBe(n){var e="".concat(n.version,`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `).concat(n.varyingFs,` vec2 resultUV;
    `).concat(n.defineOutput,`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `).concat(n.defineSpecialNaN,`
    `).concat(n.defineSpecialInf,`
    `).concat(n.defineRound,`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `).concat(PBe,`
    `).concat(MBe,`
    `).concat(BBe,`
  `);return e}var PBe=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,MBe=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,BBe=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,LBe=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function W$(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function zBe(n,e,t){var r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return r[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `.concat(r[1],`.0);
      }
    `):r[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `.concat(r[0],`.0);
      }
    `):t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(r[0],", ").concat(r[1],`));
      return 2 * (resTexRC.x * `).concat(r[1],` + resTexRC.y);
    }
  `)}function $Be(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * `.concat(e[1],`.0);
      }
    `):e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * `.concat(e[0],`.0);
      }
    `):t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(e[0],", ").concat(e[1],`));
      return resTexRC.x * `).concat(e[1],` + resTexRC.y;
    }
  `)}function qBe(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;var r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],a=Math.ceil(n[2]/2),i=a*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(r[0],", ").concat(r[1],`));
      int index = resTexRC.x * `).concat(r[1],` + resTexRC.y;

      int b = index / `).concat(i,`;
      index -= b * `).concat(i,`;

      int r = 2 * (index / `).concat(a,`);
      int c = imod(index, `).concat(a,`) * 2;

      return ivec3(b, r, c);
    }
  `)}function WBe(n,e,t){if(t){var r=um(["r","c","d"],n);return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    `.concat(r,`
    return ivec3(r, c, d);
  }
`)}var a=du(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
      `).concat(a,`
      return ivec3(r, c, d);
    }
  `)}function VBe(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;for(var r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],a=Math.ceil(n[n.length-1]/2),i=a*Math.ceil(n[n.length-2]/2),o=i,s="",u="b, r, c",c=2;c<n.length-1;c++)o*=n[n.length-c-1],s=`
      int b`.concat(c," = index / ").concat(o,`;
      index -= b`).concat(c," * ").concat(o,`;
    `)+s,u="b".concat(c,", ")+u;return`
    ivec`.concat(n.length,` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`).concat(r[0],", ").concat(r[1],`));
      int index = resTexRC.x * `).concat(r[1],` + resTexRC.y;

      `).concat(s,`

      int b = index / `).concat(i,`;
      index -= b * `).concat(i,`;

      int r = 2 * (index / `).concat(a,`);
      int c = imod(index, `).concat(a,`) * 2;

      return ivec`).concat(n.length,"(").concat(u,`);
    }
  `)}function GBe(n,e,t){if(t){var r=um(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      `.concat(r,`
      return ivec4(r, c, d, d2);
    }
  `)}var a=du(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
      `).concat(a,`
      return ivec4(r, c, d, d2);
    }
  `)}function UBe(n,e){var t=du(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`.concat(e[0],`,
                             `).concat(e[1],`));

      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;

      `).concat(t,`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `)}function HBe(n,e){var t=du(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;

      `).concat(t,`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `)}function KBe(n,e,t){var r=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(k.util.arraysEqual(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`.concat(r[0],", ").concat(r[1],`));
      }
    `);var a=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(r[0],", ").concat(r[1],`));

      int index = resTexRC.x * `).concat(r[1],` + resTexRC.y;
      int r = 2 * (index / `).concat(a,`);
      int c = imod(index, `).concat(a,`) * 2;

      return ivec2(r, c);
    }
  `)}function jBe(n,e,t){return k.util.arraysEqual(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`.concat(e[0],", ").concat(e[1],`));
      }
    `):n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`.concat(e[0],", ").concat(e[1],`));
        int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
        return ivec2(index, 0);
      }
    `):n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`.concat(e[0],", ").concat(e[1],`));
        int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
        return ivec2(0, index);
      }
    `):t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`.concat(e[0],", ").concat(e[1],`));
      int index = resTexRC.x * `).concat(e[1],` + resTexRC.y;
      int r = index / `).concat(n[1],`;
      int c = index - r * `).concat(n[1],`;
      return ivec2(r, c);
    }
  `)}function vu(n){return"offset".concat(n)}function XBe(n){var e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=xr();return`
    vec4 `.concat(t,`() {
      return `).concat(r.texture2D,"(").concat(e,`, halfCR);
    }
  `)}function YBe(n,e){var t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return"float ".concat(r,"() {return ").concat(t,";}");var a=Te(n.shapeInfo.texShape,2),i=a[0],o=a[1];if(i===1&&o===1)return`
      float `.concat(r,`() {
        return sampleTexture(`).concat(t,`, halfCR);
      }
    `);var s=vu(t);if(e)return`
    float `.concat(r,`() {
      vec2 uv = uvFromFlat(`).concat(t,"TexShape[0], ").concat(t,"TexShape[1], ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `);var u=Te(n.shapeInfo.texShape,2),c=u[0],l=u[1];return`
    float `.concat(r,`() {
      vec2 uv = uvFromFlat(`).concat(c,", ").concat(l,", ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function ZBe(n,e){var t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),a=n.shapeInfo.texShape,i=xr();if(e)return`
    vec4 `.concat(r,`(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(t,"TexShape[0]) / 2.0), ceil(float(").concat(t,`TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return `).concat(i.texture2D,"(").concat(t,`, uv);
    }
  `);var o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return`
    vec4 `.concat(r,`(int index) {
      vec2 uv = packedUVfrom1D(
        `).concat(o[0],", ").concat(o[1],`, index);
      return `).concat(i.texture2D,"(").concat(t,`, uv);
    }
  `)}function JBe(n,e){var t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float `.concat(r,`(int index) {
        `).concat(Hc(n),`
      }
    `);var a=n.shapeInfo.texShape,i=a[0],o=a[1];if(o===1&&i===1)return`
      float `.concat(r,`(int index) {
        return sampleTexture(`).concat(t,`, halfCR);
      }
    `);var s=vu(t);return o===1?e?`
      float `.concat(r,`(int index) {
        vec2 uv = vec2(0.5, (float(index + `).concat(s,") + 0.5) / float(").concat(t,`TexShape[0]));
        return sampleTexture(`).concat(t,`, uv);
      }
    `):`
      float `.concat(r,`(int index) {
        vec2 uv = vec2(0.5, (float(index + `).concat(s,") + 0.5) / ").concat(i,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `):i===1?e?`
      float `.concat(r,`(int index) {
        vec2 uv = vec2((float(index + `).concat(s,") + 0.5) / float(").concat(t,`TexShape[1]), 0.5);
        return sampleTexture(`).concat(t,`, uv);
      }
    `):`
      float `.concat(r,`(int index) {
        vec2 uv = vec2((float(index + `).concat(s,") + 0.5) / ").concat(o,`.0, 0.5);
        return sampleTexture(`).concat(t,`, uv);
      }
    `):e?`
    float `.concat(r,`(int index) {
      vec2 uv = uvFromFlat(`).concat(t,"TexShape[0], ").concat(t,"TexShape[1], index + ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `):`
    float `.concat(r,`(int index) {
      vec2 uv = uvFromFlat(`).concat(i,", ").concat(o,", index + ").concat(s,`);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function QBe(n,e){var t=n.shapeInfo.logicalShape,r=n.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape,o=i[0],s=i[1],u=xr();if(i!=null&&k.util.arraysEqual(t,i))return e?`
      vec4 `.concat(a,`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(r,"TexShape[1], ").concat(r,`TexShape[0]);

        return `).concat(u.texture2D,"(").concat(r,`, uv);
      }
    `):`
      vec4 `.concat(a,`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(s,".0, ").concat(o,`.0);

        return `).concat(u.texture2D,"(").concat(r,`, uv);
      }
    `);if(e)return`
    vec4 `.concat(a,`(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,`TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(`).concat(r,`Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return `).concat(u.texture2D,"(").concat(r,`, uv);
    }
  `);var c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],l=Math.ceil(t[1]/2);return`
    vec4 `.concat(a,`(int row, int col) {
      vec2 uv = packedUVfrom2D(`).concat(l,", ").concat(c[0],", ").concat(c[1],`, row, col);
      return `).concat(u.texture2D,"(").concat(r,`, uv);
    }
  `)}function eLe(n,e){var t=n.shapeInfo.logicalShape,r=n.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape;if(i!=null&&k.util.arraysEqual(t,i)){if(e)return`
      float `.concat(a,`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(r,"TexShape[1], ").concat(r,`TexShape[0]);
        return sampleTexture(`).concat(r,`, uv);
      }
    `);var o=i[0],s=i[1];return`
    float `.concat(a,`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`).concat(s,".0, ").concat(o,`.0);
      return sampleTexture(`).concat(r,`, uv);
    }
  `)}var u=k.util.squeezeShape(t),c=u.newShape,l=u.keptDims,f=c;if(f.length<t.length){var h=Kc(n,f),p=["row","col"];return`
      `.concat(Uc(h,e),`
      float `).concat(a,`(int row, int col) {
        return `).concat(a,"(").concat(jc(p,l),`);
      }
    `)}if(n.shapeInfo.isUniform)return`
      float `.concat(a,`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`).concat(t[1],`, 1)));
        `).concat(Hc(n),`
      }
    `);var d=i[0],v=i[1],m=vu(r);return v===1?e?`
      float `.concat(a,`(int row, int col) {
        float index = dot(vec3(row, col, `).concat(m,"), vec3(").concat(r,`Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(`).concat(r,`TexShape[0]));
        return sampleTexture(`).concat(r,`, uv);
      }
    `):`
    float `.concat(a,`(int row, int col) {
      float index = dot(vec3(row, col, `).concat(m,"), vec3(").concat(t[1],`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `).concat(d,`.0);
      return sampleTexture(`).concat(r,`, uv);
    }
  `):d===1?e?`
      float `.concat(a,`(int row, int col) {
        float index = dot(vec3(row, col, `).concat(m,"), vec3(").concat(r,`Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(`).concat(r,`TexShape[1]), 0.5);
        return sampleTexture(`).concat(r,`, uv);
      }
    `):`
    float `.concat(a,`(int row, int col) {
      float index = dot(vec3(row, col, `).concat(m,"), vec3(").concat(t[1],`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `).concat(v,`.0, 0.5);
      return sampleTexture(`).concat(r,`, uv);
    }
  `):e?`
      float `.concat(a,`(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `).concat(r,"Shape[1] + col + ").concat(m,`;
        vec2 uv = uvFromFlat(`).concat(r,"TexShape[0], ").concat(r,`TexShape[1], index);
        return sampleTexture(`).concat(r,`, uv);
      }
    `):`
  float `.concat(a,`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `).concat(t[1]," + col + ").concat(m,`;
    vec2 uv = uvFromFlat(`).concat(d,", ").concat(v,`, index);
    return sampleTexture(`).concat(r,`, uv);
  }
`)}function tLe(n,e){var t=n.shapeInfo.logicalShape,r=n.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(t[0]===1){var s=t.slice(1),u=[1,2],c=Kc(n,s),l=["b","row","col"];return`
        `.concat(q$(c,e),`
        vec4 `).concat(a,`(int b, int row, int col) {
          return `).concat(a,"(").concat(jc(l,u),`);
        }
      `)}var f=xr();if(e)return`
    vec4 `.concat(a,`(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,`TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(`).concat(r,`Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(`).concat(r,`Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return `).concat(f.texture2D,"(").concat(r,`, uv);
    }
  `);var h=o[0],p=o[1],d=Math.ceil(t[2]/2),v=d*Math.ceil(t[1]/2);return`
    vec4 `.concat(a,`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `).concat(h,", ").concat(p,", ").concat(v,", ").concat(d,`, b, row, col);
      return `).concat(f.texture2D,"(").concat(r,`, uv);
    }
  `)}function nLe(n,e){var t=n.shapeInfo.logicalShape,r=n.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t[1]*t[2],o=t[2],s=k.util.squeezeShape(t),u=s.newShape,c=s.keptDims,l=u;if(l.length<t.length){var f=Kc(n,l),h=["row","col","depth"];return`
        `.concat(Uc(f,e),`
        float `).concat(a,`(int row, int col, int depth) {
          return `).concat(a,"(").concat(jc(h,c),`);
        }
      `)}if(n.shapeInfo.isUniform)return`
      float `.concat(a,`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`).concat(i,", ").concat(o,`, 1)));
        `).concat(Hc(n),`
      }
    `);var p=n.shapeInfo.texShape,d=p[0],v=p[1],m=n.shapeInfo.flatOffset;if(v===i&&m==null)return e?`
      float `.concat(a,`(int row, int col, int depth) {
        int stride1 = `).concat(r,`Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(r,"TexShape[1], ").concat(r,`TexShape[0]);
        return sampleTexture(`).concat(r,`, uv);
      }
    `):`
        float `.concat(a,`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`).concat(o,`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`).concat(v,".0, ").concat(d,`.0);
          return sampleTexture(`).concat(r,`, uv);
        }
      `);if(v===o&&m==null)return e?`
      float `.concat(a,`(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(`).concat(r,`Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`).concat(r,"TexShape[1], ").concat(r,`TexShape[0]);
        return sampleTexture(`).concat(r,`, uv);
      }
    `):`
    float `.concat(a,`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`).concat(t[1],`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`).concat(v,".0, ").concat(d,`.0);
      return sampleTexture(`).concat(r,`, uv);
    }
  `);var g=vu(r);return e?`
    float `.concat(a,`(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = `).concat(r,"Shape[1] * ").concat(r,`Shape[2];
      int stride1 = `).concat(r,`Shape[2];
      int index = row * stride0 + col * stride1 + depth + `).concat(g,`;
      vec2 uv = uvFromFlat(`).concat(r,"TexShape[0], ").concat(r,`TexShape[1], index);
      return sampleTexture(`).concat(r,`, uv);
    }
    `):`
      float `.concat(a,`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `).concat(i," + col * ").concat(o," + depth + ").concat(g,`;
        vec2 uv = uvFromFlat(`).concat(d,", ").concat(v,`, index);
        return sampleTexture(`).concat(r,`, uv);
      }
  `)}function rLe(n,e){var t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),a=xr();if(e)return`
    vec4 `.concat(r,`(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(`).concat(t,`Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(`).concat(t,`Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= `).concat(t,`Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(`).concat(t,"TexShape[0]) / 2.0), ceil(float(").concat(t,`TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return `).concat(a.texture2D,"(").concat(t,`, uv);
    }
  `);for(var i=n.shapeInfo.logicalShape,o=i.length,s=n.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=u[0],l=u[1],f=Math.ceil(i[o-1]/2),h=f*Math.ceil(i[o-2]/2),p="int b, int row, int col",d="b * ".concat(h," + (row / 2) * ").concat(f," + (col / 2)"),v=2;v<o-1;v++)p="int b".concat(v,", ")+p,h*=i[o-v-1],d="b".concat(v," * ").concat(h," + ")+d;return`
    vec4 `.concat(r,"(").concat(p,`) {
      int index = `).concat(d,`;
      int texR = index / `).concat(l,`;
      int texC = index - texR * `).concat(l,`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`).concat(l,", ").concat(c,`);
      return `).concat(a.texture2D,"(").concat(t,`, uv);
    }
  `)}function aLe(n,e){var t=n.shapeInfo.logicalShape,r=n.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t[3],o=t[2]*i,s=t[1]*o,u=k.util.squeezeShape(t),c=u.newShape,l=u.keptDims;if(c.length<t.length){var f=Kc(n,c),h=["row","col","depth","depth2"];return`
      `.concat(Uc(f,e),`
      float `).concat(a,`(int row, int col, int depth, int depth2) {
        return `).concat(a,"(").concat(jc(h,l),`);
      }
    `)}if(n.shapeInfo.isUniform)return`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`).concat(s,", ").concat(o,", ").concat(i,`, 1)));
        `).concat(Hc(n),`
      }
    `);var p=n.shapeInfo.flatOffset,d=n.shapeInfo.texShape,v=d[0],m=d[1],g="int stride2 = ".concat(r,"Shape[3];"),y="int stride1 = ".concat(r,"Shape[2] * stride2;"),b="int stride0 = ".concat(r,"Shape[1] * stride1;");if(m===s&&p==null)return e?`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        `).concat(g,`
        `).concat(y,`
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(r,"TexShape[1], ").concat(r,`TexShape[0]);
        return sampleTexture(`).concat(r,`, uv);
      }
    `):`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`).concat(o,", ").concat(i,`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(m,".0, ").concat(v,`.0);
        return sampleTexture(`).concat(r,`, uv);
      }
    `);if(m===i&&p==null)return e?`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`).concat(r,"Shape[1] * ").concat(r,"Shape[2], ").concat(r,`Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(r,"TexShape[1], ").concat(r,`TexShape[0]);
        return sampleTexture(`).concat(r,`, uv);
      }
    `):`
      float `.concat(a,`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`).concat(t[1]*t[2],", ").concat(t[2],`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(m,".0, ").concat(v,`.0);
        return sampleTexture(`).concat(r,`, uv);
      }
    `);var w=vu(r);return e?`
    float `.concat(a,`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      `).concat(g,`
      `).concat(y,`
      `).concat(b,`
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(`).concat(r,"TexShape[0], ").concat(r,"TexShape[1], index + ").concat(w,`);
      return sampleTexture(`).concat(r,`, uv);
    }
  `):`
    float `.concat(a,`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `).concat(s," + col * ").concat(o,` +
          depth * `).concat(i,` + depth2;
      vec2 uv = uvFromFlat(`).concat(v,", ").concat(m,", index + ").concat(w,`);
      return sampleTexture(`).concat(r,`, uv);
    }
  `)}function iLe(n){var e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),a=e[4],i=e[3]*a,o=e[2]*i,s=e[1]*o,u=k.util.squeezeShape(e),c=u.newShape,l=u.keptDims;if(c.length<e.length){var f=Kc(n,c),h=["row","col","depth","depth2","depth3"];return`
      `.concat(Uc(f),`
      float `).concat(r,`(int row, int col, int depth, int depth2, int depth3) {
        return `).concat(r,"(").concat(jc(h,l),`);
      }
    `)}if(n.shapeInfo.isUniform)return`
      float `.concat(r,`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`).concat(s,", ").concat(o,", ").concat(i,", ").concat(a,`)) +
          depth3;
        `).concat(Hc(n),`
      }
    `);var p=n.shapeInfo.flatOffset,d=n.shapeInfo.texShape,v=d[0],m=d[1];if(m===s&&p==null)return`
      float `.concat(r,`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`).concat(o,", ").concat(i,", ").concat(a,`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(m,".0, ").concat(v,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);if(m===a&&p==null)return`
      float `.concat(r,`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`).concat(e[1]*e[2]*e[3],`,
               `).concat(e[2]*e[3],", ").concat(e[3],`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(m,".0, ").concat(v,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);var g=vu(t);return`
    float `.concat(r,`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `).concat(s," + col * ").concat(o," + depth * ").concat(i,` +
          depth2 * `).concat(a," + depth3 + ").concat(g,`;
      vec2 uv = uvFromFlat(`).concat(v,", ").concat(m,`, index);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function oLe(n){var e=n.shapeInfo.logicalShape,t=n.name,r="get"+t.charAt(0).toUpperCase()+t.slice(1),a=k.util.squeezeShape(e),i=a.newShape,o=a.keptDims;if(i.length<e.length){var s=Kc(n,i),u=["row","col","depth","depth2","depth3","depth4"];return`
      `.concat(Uc(s),`
      float `).concat(r,`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `).concat(r,"(").concat(jc(u,o),`);
      }
    `)}var c=e[5],l=e[4]*c,f=e[3]*l,h=e[2]*f,p=e[1]*h;if(n.shapeInfo.isUniform)return`
      float `.concat(r,`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`).concat(p,", ").concat(h,", ").concat(f,", ").concat(l,`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`).concat(c,`, 1)));
        `).concat(Hc(n),`
      }
    `);var d=n.shapeInfo.flatOffset,v=n.shapeInfo.texShape,m=v[0],g=v[1];if(g===p&&d==null)return`
      float `.concat(r,`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`).concat(h,", ").concat(f,", ").concat(l,", ").concat(c,`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`).concat(g,".0, ").concat(m,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);if(g===c&&d==null)return`
      float `.concat(r,`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`).concat(e[1]*e[2]*e[3]*e[4],`,
               `).concat(e[2]*e[3]*e[4],`,
               `).concat(e[3]*e[4],`,
               `).concat(e[4],`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`).concat(g,".0, ").concat(m,`.0);
        return sampleTexture(`).concat(t,`, uv);
      }
    `);var y=vu(t);return`
    float `.concat(r,`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `).concat(p," + col * ").concat(h," + depth * ").concat(f,` +
          depth2 * `).concat(l," + depth3 * ").concat(c," + depth4 + ").concat(y,`;
      vec2 uv = uvFromFlat(`).concat(m,", ").concat(g,`, index);
      return sampleTexture(`).concat(t,`, uv);
    }
  `)}function Hc(n){var e=n.name,t=k.util.sizeFromShape(n.shapeInfo.logicalShape);return t<2?"return ".concat(e,";"):`
    for (int i = 0; i < `.concat(t,`; i++) {
      if (i == index) {
        return `).concat(e,`[i];
      }
    }
  `)}function sLe(n,e){var t=n.name,r=t.charAt(0).toUpperCase()+t.slice(1),a="get"+r+"AtOutCoords",i=n.shapeInfo.logicalShape.length,o=e.logicalShape.length,s=$$(n.shapeInfo.logicalShape,e.logicalShape),u=Wt(o),c=o-i,l,f=["x","y","z","w","u","v"];i===0?l="":o<2&&s.length>=1?l="coords = 0;":l=s.map(function(w){return"coords.".concat(f[w+c]," = 0;")}).join(`
`);var h="";o<2&&i>0?h="coords":h=n.shapeInfo.logicalShape.map(function(w,x){return"coords.".concat(f[x+c])}).join(", ");var p="return outputValue;",d=k.util.sizeFromShape(n.shapeInfo.logicalShape),v=d===1,m=k.util.sizeFromShape(e.logicalShape),g=m===1;if(i===1&&!v&&!g)p=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(v&&!g)o===1?p=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:p=`
        return vec4(outputValue.x);
      `;else if(s.length){var y=i-2,b=i-1;s.indexOf(y)>-1&&s.indexOf(b)>-1?p="return vec4(outputValue.x);":s.indexOf(y)>-1?p="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":s.indexOf(b)>-1&&(p="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 `.concat(a,`() {
      `).concat(u,` coords = getOutputCoords();
      `).concat(l,`
      vec4 outputValue = get`).concat(r,"(").concat(h,`);
      `).concat(p,`
    }
  `)}function uLe(n,e){var t=n.name,r=t.charAt(0).toUpperCase()+t.slice(1),a="get"+r+"AtOutCoords",i=e.texShape,o=n.shapeInfo.texShape,s=n.shapeInfo.logicalShape.length,u=e.logicalShape.length;if(!n.shapeInfo.isUniform&&s===u&&n.shapeInfo.flatOffset==null&&k.util.arraysEqual(o,i))return`
      float `.concat(a,`() {
        return sampleTexture(`).concat(t,`, resultUV);
      }
    `);var c=Wt(u),l=$$(n.shapeInfo.logicalShape,e.logicalShape),f=u-s,h,p=["x","y","z","w","u","v"];s===0?h="":u<2&&l.length>=1?h="coords = 0;":h=l.map(function(v){return"coords.".concat(p[v+f]," = 0;")}).join(`
`);var d="";return u<2&&s>0?d="coords":d=n.shapeInfo.logicalShape.map(function(v,m){return"coords.".concat(p[m+f])}).join(", "),`
    float `.concat(a,`() {
      `).concat(c,` coords = getOutputCoords();
      `).concat(h,`
      return get`).concat(r,"(").concat(d,`);
    }
  `)}function Wt(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error("GPU for rank ".concat(n," is not yet supported"))}function Rx(n,e,t){var r=k.util.squeezeShape(e),a=r.newShape,i=r.keptDims,o=e.length,s=n&&o===3&&e[0]===1,u=s?e.slice(1):a,c=!n&&o>1&&!k.util.arraysEqual(e,t)&&a.length<o||s,l=c?u:e;return{useSqueezeShape:c,uniformShape:l,keptDims:i}}function Kc(n,e){var t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function jc(n,e){return e.map(function(t){return n[t]}).join(", ")}function cLe(n,e,t,r){var a=t.map(function(l,f){var h={logicalShape:l.shape,texShape:l.isUniform?null:l.texData.texShape,isUniform:l.isUniform,isPacked:l.isUniform?!1:l.texData.isPacked,flatOffset:null};return l.texData!=null&&l.texData.slice!=null&&l.texData.slice.flatOffset>0&&(h.flatOffset=l.texData.slice.flatOffset),{name:e.variableNames[f],shapeInfo:h}}),i=a.map(function(l){return l.shapeInfo}),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},s=IBe(a,o,e),u=y$(n.gl,s),c=n.createProgram(u);return k.env().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:e,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o},V$(n,e,c))}function V$(n,e,t){var r={},a={},i={},o=[],s,u,c,l=null,f=null;f=n.getUniformLocation(t,"NAN",!1),k.env().getNumber("WEBGL_VERSION")===1&&(l=n.getUniformLocation(t,"INFINITY",!1));for(var h=!1,p=0;p<e.variableNames.length;p++){var d=e.variableNames[p];r[d]=n.getUniformLocation(t,d,h),r["offset".concat(d)]=n.getUniformLocation(t,"offset".concat(d),h),e.enableShapeUniforms&&(a["".concat(d,"Shape")]=n.getUniformLocation(t,"".concat(d,"Shape"),h),i["".concat(d,"TexShape")]=n.getUniformLocation(t,"".concat(d,"TexShape"),h))}return e.enableShapeUniforms&&(s=n.getUniformLocation(t,"outShape",h),c=n.getUniformLocation(t,"outShapeStrides",h),u=n.getUniformLocation(t,"outTexShape",h)),e.customUniforms&&e.customUniforms.forEach(function(v,m){o[m]=n.getUniformLocation(t,v.name,h)}),{uniformLocations:r,customUniformLocations:o,infLoc:l,nanLoc:f,inShapesLocations:a,inTexShapesLocations:i,outShapeLocation:s,outShapeStridesLocation:c,outTexShapeLocation:u}}function Lz(n,e){if(n.length!==e.length)throw Error("Binary was compiled with ".concat(n.length," inputs, but ")+"was executed with ".concat(e.length," inputs"));n.forEach(function(t,r){var a=t.logicalShape,i=e[r],o=i.shape;if(!k.util.arraysEqual(a,o))throw Error("Binary was compiled with different shapes than "+"the current args. Shapes ".concat(a," and ").concat(o," must match"));if(!(t.isUniform&&i.isUniform)){var s=t.texShape,u=i.isUniform?null:i.texData.texShape;if(!k.util.arraysEqual(s,u))throw Error("Binary was compiled with different texture shapes than the"+" current args. Shape ".concat(s," and ").concat(u," must match"))}})}function lLe(n,e,t,r,a){e.program.enableShapeUniforms||(Lz(e.inShapeInfos,t),Lz([e.outShapeInfo],[r]));var i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?n.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):n.setOutputMatrixTexture(i.texture,o[0],o[1]),n.setProgram(e.webGLProgram),k.env().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN),t.forEach(function(c,l){var f=e.program.variableNames[l],h=e.uniformLocations[f],p=e.uniformLocations["offset".concat(f)],d=e.inShapesLocations["".concat(f,"Shape")],v=e.inTexShapesLocations["".concat(f,"TexShape")];if(d){var m=Rx(e.program.packedInputs,c.shape,c.texData.texShape).uniformShape;switch(m.length){case 1:n.gl.uniform1iv(d,new Int32Array(m));break;case 2:n.gl.uniform2iv(d,new Int32Array(m));break;case 3:n.gl.uniform3iv(d,new Int32Array(m));break;case 4:n.gl.uniform4iv(d,new Int32Array(m));break}}if(v&&n.gl.uniform2i(v,c.texData.texShape[0],c.texData.texShape[1]),h!=null){if(c.isUniform){if(k.util.sizeFromShape(c.shape)<2)n.gl.uniform1f(h,c.uniformValues[0]);else{var g=c.uniformValues;g instanceof Float32Array||(g=new Float32Array(g)),n.gl.uniform1fv(h,g)}return}c.texData.slice!=null&&p!=null&&n.gl.uniform1i(p,c.texData.slice.flatOffset),n.setInputMatrixTexture(c.texData.texture.texture,h,l)}});var s=e.outShapeLocation;if(s)switch(r.shape.length){case 1:n.gl.uniform1iv(s,new Int32Array(r.shape));break;case 2:n.gl.uniform2iv(s,new Int32Array(r.shape));break;case 3:n.gl.uniform3iv(s,new Int32Array(r.shape));break;case 4:n.gl.uniform4iv(s,new Int32Array(r.shape));break}if(e.outShapeStridesLocation){var u=k.util.computeStrides(r.shape);switch(r.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(u));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(u));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(u));break}}e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),e.program.customUniforms&&a&&e.program.customUniforms.forEach(function(c,l){var f=e.customUniformLocations[l],h=a[l];if(c.type==="float")n.gl.uniform1fv(f,h);else if(c.type==="vec2")n.gl.uniform2fv(f,h);else if(c.type==="vec3")n.gl.uniform3fv(f,h);else if(c.type==="vec4")n.gl.uniform4fv(f,h);else if(c.type==="int")n.gl.uniform1iv(f,h);else if(c.type==="ivec2")n.gl.uniform2iv(f,h);else if(c.type==="ivec3")n.gl.uniform3iv(f,h);else if(c.type==="ivec4")n.gl.uniform4iv(f,h);else throw Error("uniform type ".concat(c.type," is not supported yet."))}),n.executeProgram()}function fLe(n,e,t){var r="";e.concat(t).forEach(function(o){var s=o.texData!=null&&o.texData.slice!=null&&o.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!o.isUniform){var u=o.texData.texShape,c=Rx(n.packedInputs,o.shape,u),l=c.useSqueezeShape,f=c.uniformShape,h=c.keptDims,p="",d="",v="";if(f.length===1&&n.packedInputs){var m=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];p="".concat(m[0]>1,"_").concat(m[1]>1)}else if(f.length===2&&!n.packedInputs)d="".concat(f[0]>1,"_").concat(f[1]>1);else if(f.length>2&&!n.packedInputs){var g=k.util.computeStrides(f);v="".concat(g[0]===u[1],"_").concat(g[g.length-1]===u[1])}var y=o.shape.length,b=f.length===2&&k.util.arraysEqual(o.shape,u),w=k.util.sizeFromShape(o.shape)===1,x=k.backend_util.getBroadcastDims(o.shape,t.shape),N=!n.packedInputs&&y===t.shape.length&&k.util.arraysEqual(u,t.texData.texShape),T=n.packedInputs||f.length>2?"":"".concat(u[0]>1,"_").concat(u[1]>1);r+="".concat(y,"_").concat(N,"_").concat(l?h:"","_").concat(f.length,"_").concat(w,"_").concat(x,"_").concat(b,"_").concat(p,"_").concat(d,"_").concat(v,"_").concat(T,"_").concat(s)}else{var E=o.isUniform?"uniform":o.texData.texShape;r+="".concat(o.shape,"_").concat(E,"_").concat(s)}});var a=n.userCode,i=n.constructor.name;return i+="_"+r+"_"+a+"".concat(k.env().getNumber("WEBGL_VERSION")),i}function kr(n){return k.env().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}var hLe=function(){function n(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=lh.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var t=xr();this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `.concat(this.enableShapeUniforms?um(["r","c","d"],e):du(["r","c","d"],e),`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `).concat(t.output,` = result;
      }
    `)}return n}();var pLe=function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=lh.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var t=xr();this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `.concat(this.enableShapeUniforms?um(["r","c","d"],e):du(["r","c","d"],e),`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `).concat(t.output,` = result;
      }
    `)}return n}();var dLe=function(){function n(e){this.variableNames=["A"],this.outTexUsage=ba.DOWNLOAD;var t=xr();this.outputShape=e,this.userCode=`
      `.concat(z$,`

      void main() {
        float x = getAAtOutCoords();
        `).concat(t.output,` = encode_float(x);
      }
    `)}return n}();var vLe=function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ba.DOWNLOAD;var t=xr();this.outputShape=e,this.userCode=`
      `.concat(z$,`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `).concat(t.output,` = encode_float(x);
      }
    `)}return n}();var mLe={R:0,G:1,B:2,A:3},zz=function(){function n(e,t,r){t===void 0&&(t=!1),r===void 0&&(r="RGBA"),this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];var a=xr();this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length);var i="result";t&&(i="floor(result * 255. + 0.5)");for(var o="",s=0;s<r.length;s++){var u=r[s];o+=`
          if(offset == `.concat(s,`) {
            result = values[`).concat(mLe[u],`];
          }`)}this.userCode=`
      `.concat(this.enableShapeUniforms?Fx():Dx(e),`

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, `).concat(r.length,`);

        flatIndex = idiv(flatIndex, `).concat(r.length,`, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = `).concat(a.texture2D,`(A, uv);
          `).concat(o,`
        }
        `).concat(a.output," = vec4(").concat(i,`, 0., 0., 0.);
      }
    `)}return n}();var gLe=function(){function n(e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];var r=xr();this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length);var a="",i="result";t&&(i="floor(result * 255. + 0.5)");for(var o=0;o<=1;o++)for(var s=0;s<=1;s++){var u=o*2+s;a+=`
          localCoords = coords;
          if(localCoords[2] + `.concat(s," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(e[2]),`) {
          localCoords[2] += `).concat(s,`;
          if (localCoords[1] + `).concat(o," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(e[1]),`) {
            localCoords[1] += `).concat(o,`;

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = `).concat(r.texture2D,`(A, uv);

            if (offset == 0) {
              result[`).concat(u,`] = values[0];
            } else if (offset == 1) {
              result[`).concat(u,`] = values[1];
            } else if (offset == 2) {
              result[`).concat(u,`] = values[2];
            } else {
              result[`).concat(u,`] = values[3];
            }
          }
        }
        `)}this.userCode=`
        `.concat(this.enableShapeUniforms?Fx():Dx(e),`

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          `).concat(a,`

          `).concat(r.output," = ").concat(i,`;
        }
    `)}return n}();function G$(n){var e=xr(),t="".concat(e.version,`
    precision highp float;
    `).concat(e.attribute,` vec3 clipSpacePos;
    `).concat(e.attribute,` vec2 uv;
    `).concat(e.varyingVs,` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`);return g$(n,t)}function U$(n){var e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return x$(n,e)}function H$(n){var e=new Uint16Array([0,1,2,2,1,3]);return k$(n,e)}function mh(n,e,t,r,a,i){N$(e,t);var o=S$(n),s=n.TEXTURE_2D;return Oe(n,function(){return n.bindTexture(s,o)}),Oe(n,function(){return n.texParameteri(s,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)}),Oe(n,function(){return n.texParameteri(s,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)}),Oe(n,function(){return n.texParameteri(s,n.TEXTURE_MIN_FILTER,n.NEAREST)}),Oe(n,function(){return n.texParameteri(s,n.TEXTURE_MAG_FILTER,n.NEAREST)}),k.env().getNumber("WEBGL_VERSION")===1?Oe(n,function(){return n.texImage2D(s,0,r,e,t,0,a,i,null)}):Oe(n,function(){return n.texStorage2D(s,1,r,e,t)}),Oe(n,function(){return n.bindTexture(n.TEXTURE_2D,null)}),{texture:o,texShape:[t,e]}}function Ox(n){return n.internalFormatFloat}function K$(n,e,t,r){var a=Te(vh(e,t),2),i=a[0],o=a[1];return mh(n,i,o,Ox(r),r.textureFormatFloat,n.FLOAT)}function Px(n){return n.internalFormatHalfFloat}function j$(n,e,t,r){var a=Te(vh(e,t),2),i=a[0],o=a[1];return mh(n,i,o,Px(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function Mx(n){return n.downloadTextureFormat}function X$(n,e,t,r){var a=Te(vh(e,t),2),i=a[0],o=a[1];return mh(n,i,o,Mx(r),n.RGBA,n.UNSIGNED_BYTE)}function Bx(n){return n.internalFormatPackedFloat}function Y$(n,e,t,r){var a=Te(Vc(e,t),2),i=a[0],o=a[1];return mh(n,i,o,Bx(r),n.RGBA,n.FLOAT)}function Lx(n){return n.internalFormatPackedHalfFloat}function Z$(n,e,t,r){var a=Te(Vc(e,t),2),i=a[0],o=a[1];return mh(n,i,o,Lx(r),n.RGBA,r.textureTypeHalfFloat)}function J$(n,e,t){var r=0,a=3*4,i=3*4+2*4;Oe(n,function(){return n.bindBuffer(n.ARRAY_BUFFER,t)});var o=kx(n,e,"clipSpacePos",t,3,i,r);return o&&kx(n,e,"uv",t,2,i,a)}function Q$(n,e,t,r,a,i){Oe(n,function(){return n.bindTexture(n.TEXTURE_2D,e)});var o,s,u;a instanceof Uint8Array?(o=new Uint8Array(t*r*4),s=n.UNSIGNED_BYTE,u=n.RGBA):(o=new Float32Array(t*r*4),s=n.FLOAT,u=i.internalFormatPackedFloat),o.set(a),k.env().getNumber("WEBGL_VERSION")===2?Oe(n,function(){return n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,r,n.RGBA,s,o)}):Oe(n,function(){return n.texImage2D(n.TEXTURE_2D,0,u,t,r,0,n.RGBA,s,o)}),Oe(n,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function eq(n,e,t){Oe(n,function(){return n.bindTexture(n.TEXTURE_2D,e)}),t.data instanceof Uint8Array?k.env().getNumber("WEBGL_VERSION")===2?Oe(n,function(){return n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)}):Oe(n,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)}):k.env().getNumber("WEBGL_VERSION")===2?Oe(n,function(){return n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)}):Oe(n,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)}),Oe(n,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function tq(n,e,t,r){var a=n.createBuffer();Oe(n,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,a)});var i=4,o=4,s=i*o*e*t;return Oe(n,function(){return n.bufferData(n.PIXEL_PACK_BUFFER,s,n.STREAM_READ)}),Oe(n,function(){return n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)}),Oe(n,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,null)}),a}function nq(n,e,t){var r=n,a=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}function rq(n,e,t,r){var a=Te(vh(e,t),2),i=a[0],o=a[1],s=4,u=new Uint8Array(hBe(e*t,s));return Oe(n,function(){return n.readPixels(0,0,i,o,r.downloadTextureFormat,n.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function aq(n,e,t,r,a,i,o,s){var u=n,c=new Float32Array(pBe(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function iq(n,e,t){var r=new Float32Array(e*t*4);return Oe(n,function(){return n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,r)}),r}var yLe={__proto__:null,createVertexShader:G$,createVertexBuffer:U$,createIndexBuffer:H$,getInternalFormatForFloat32MatrixTexture:Ox,createFloat32MatrixTexture:K$,getInternalFormatForFloat16MatrixTexture:Px,createFloat16MatrixTexture:j$,getInternalFormatForUnsignedBytesMatrixTexture:Mx,createUnsignedBytesMatrixTexture:X$,getInternalFormatForPackedMatrixTexture:Bx,createPackedMatrixTexture:Y$,getInternalFormatForFloat16PackedMatrixTexture:Lx,createFloat16PackedMatrixTexture:Z$,bindVertexProgramAttributeStreams:J$,uploadDenseMatrixToTexture:Q$,uploadPixelDataToTexture:eq,createBufferFromOutputTexture:tq,downloadFloat32MatrixFromBuffer:nq,downloadByteEncodedFloatMatrixFromOutputTexture:rq,downloadPackedMatrixFromBuffer:aq,downloadMatrixFromPackedOutputTexture:iq},rm=function(){function n(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];var t=k.env().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,d$(t,e)):this.gl=ki(t),e=this.gl,k.env().getNumber("WEBGL_VERSION")===2){var r=e;this.createVertexArray=function(){return Oe(r,function(){return r.createVertexArray()})},this.bindVertexArray=function(c){return Oe(r,function(){return r.bindVertexArray(c)})},this.deleteVertexArray=function(c){return Oe(r,function(){return r.deleteVertexArray(c)})},this.getVertexArray=function(){return Oe(r,function(){return r.getParameter(r.VERTEX_ARRAY_BINDING)})}}else if(e!=null){var a=e.getExtension("OES_vertex_array_object");if(a==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=function(){return Oe(e,function(){return a.createVertexArrayOES()})},this.bindVertexArray=function(c){return Oe(e,function(){return a.bindVertexArrayOES(c)})},this.deleteVertexArray=function(c){return Oe(e,function(){return a.deleteVertexArrayOES(c)})},this.getVertexArray=function(){return Oe(e,function(){return e.getParameter(a.VERTEX_ARRAY_BINDING_OES)})}}var i="WEBGL_color_buffer_float",o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),k.env().getNumber("WEBGL_VERSION")===1){var s="OES_texture_float",u="OES_texture_half_float";if(this.textureFloatExtension=ih(this.gl,s),wa(this.gl,u))this.textureHalfFloatExtension=ih(this.gl,u);else if(k.env().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(i),wa(this.gl,o))this.colorBufferHalfFloatExtension=ih(this.gl,o);else if(k.env().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(i="EXT_color_buffer_float",wa(this.gl,i))this.colorBufferFloatExtension=this.gl.getExtension(i);else if(wa(this.gl,o))this.colorBufferHalfFloatExtension=this.gl.getExtension(o);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=U$(this.gl),this.indexBuffer=H$(this.gl),this.framebuffer=T$(this.gl),this.textureConfig=Ax(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return k.env().getBool("DEBUG")},enumerable:!1,configurable:!0}),n.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Oe(t,function(){return t.finish()}),Oe(t,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Oe(t,function(){return t.deleteFramebuffer(e.framebuffer)}),Oe(t,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),Oe(t,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),Oe(t,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),K$(this.gl,e,t,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),j$(this.gl,e,t,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),X$(this.gl,e,t,this.textureConfig)},n.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),eq(this.gl,e,t)},n.prototype.uploadDenseMatrixToTexture=function(e,t,r,a){this.throwIfDisposed(),Q$(this.gl,e,t,r,a,this.textureConfig)},n.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Z$(this.gl,e,t,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),Y$(this.gl,e,t,this.textureConfig)},n.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(Sx(this.gl,this.framebuffer),this.outputTexture=null),Oe(this.gl,function(){return t.gl.deleteTexture(e)})},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,r){var a=this;return this.downloadMatrixDriver(e,function(){return rq(a.gl,t,r,a.textureConfig)})},n.prototype.downloadPackedMatrixFromBuffer=function(e,t,r,a,i,o){return aq(this.gl,e,t,r,a,i,o,this.textureConfig)},n.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return nq(this.gl,e,t)},n.prototype.createBufferFromTexture=function(e,t,r){this.bindTextureToFrameBuffer(e);var a=tq(this.gl,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),a},n.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},n.prototype.createFence=function(e){var t=this,r,a;if(k.env().getBool("WEBGL_FENCE_API_ENABLED")){var i=e,o=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),a=function(){var s=i.clientWaitSync(o,0,0);return s===i.ALREADY_SIGNALED||s===i.CONDITION_SATISFIED},r=o}else k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(r=this.beginQuery(),this.endQuery(),a=function(){return t.isQueryAvailable(r,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):a=function(){return!0};return{query:r,isFencePassed:a}},n.prototype.downloadMatrixFromPackedTexture=function(e,t,r){var a=this;return this.downloadMatrixDriver(e,function(){return iq(a.gl,t,r)})},n.prototype.createProgram=function(e){var t=this;this.throwIfDisposed();var r=this.gl;this.vertexShader==null&&(this.vertexShader=G$(r));var a=b$(r);Oe(r,function(){return r.attachShader(a,t.vertexShader)}),Oe(r,function(){return r.attachShader(a,e)}),w$(r,a);var i;return i=Object.assign(a,{vao:this.createVertexArray()}),this.bindVertexArray(i.vao),Oe(r,function(){return r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t.indexBuffer)}),console.assert(J$(r,i,this.vertexBuffer),"gpgpu_util.bindVertexProgramAttributeStreams not fully successful."),this.debug&&Qv(r,i),this.setProgram(i),i},n.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Oe(this.gl,function(){return t.gl.deleteProgram(e)}),this.deleteVertexArray(e.vao))},n.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&(this.bindVertexArray(this.program.vao),this.debug&&Qv(this.gl,this.program)),Oe(this.gl,function(){return t.gl.useProgram(e)})},n.prototype.getUniformLocation=function(e,t,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?I$(this.gl,e,t):C$(this.gl,e,t)},n.prototype.getAttributeLocation=function(e,t){var r=this;return this.throwIfDisposed(),Oe(this.gl,function(){return r.gl.getAttribLocation(e,t)})},n.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},n.prototype.setInputMatrixTexture=function(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),A$(this.gl,e,t,r)},n.prototype.setOutputMatrixTexture=function(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)},n.prototype.setOutputPackedMatrixTexture=function(e,t,r){this.throwIfDisposed();var a=Te(Vc(t,r),2),i=a[0],o=a[1];this.setOutputMatrixTextureDriver(e,i,o)},n.prototype.setOutputMatrixWriteRegion=function(e,t,r,a){this.setOutputMatrixWriteRegionDriver(r,e,a,t)},n.prototype.setOutputPackedMatrixWriteRegion=function(e,t,r,a){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){this.program!=null&&Qv(this.gl,this.program),oh(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;if(this.debug){var t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Oe(e,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},n.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Oe(this.gl,function(){return e.gl.finish()})},n.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=ih(this.gl,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,r),r}var a=this.getQueryTimerExtensionWebGL1(),i=a.createQueryEXT();return a.beginQueryEXT(a.TIME_ELAPSED_EXT,i),i},n.prototype.endQuery=function(){if(k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2();e.endQuery(t.TIME_ELAPSED_EXT);return}var r=this.getQueryTimerExtensionWebGL1();r.endQueryEXT(r.TIME_ELAPSED_EXT)},n.prototype.waitForQueryAndGetTime=function(e){return $c(this,void 0,void 0,function(){var t=this;return qc(this,function(r){switch(r.label){case 0:return[4,k.util.repeatedTry(function(){return t.disposed||t.isQueryAvailable(e,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(e,k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},n.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var r=this.gl,a=r.getQueryParameter(e,r.QUERY_RESULT);return a/1e6}else{var i=this.getQueryTimerExtensionWebGL1(),a=i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT);return a/1e6}},n.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var r=this.gl,a=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{var a=this.getQueryTimerExtensionWebGL1(),i=a.getQueryObjectEXT(e,a.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),i&&!this.disjoint}},n.prototype.pollFence=function(e){var t=this;return new Promise(function(r){t.addItemToPoll(function(){return e.isFencePassed()},function(){return r()})})},n.prototype.pollItems=function(){for(var e=bLe(this.itemsToPoll.map(function(a){return a.isDoneFn})),t=0;t<=e;++t){var r=this.itemsToPoll[t].resolveFn;r()}this.itemsToPoll=this.itemsToPoll.slice(e+1)},n.prototype.addItemToPoll=function(e,t){var r=this;if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),!(this.itemsToPoll.length>1)){var a=void 0;"setTimeoutCustom"in k.env().platform&&(a=k.env().platform.setTimeoutCustom.bind(k.env().platform)),k.util.repeatedTry(function(){return r.pollItems(),r.itemsToPoll.length===0},function(){return 0},null,a)}},n.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),em(this.gl,e,this.framebuffer),this.debug&&oh(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(em(this.gl,this.outputTexture,this.framebuffer),this.debug&&oh(this.gl)):Sx(this.gl,this.framebuffer)},n.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var r=t();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(e,t,r){this.throwIfDisposed();var a=this.gl;em(a,e,this.framebuffer),this.debug&&oh(a),this.outputTexture=e,Oe(a,function(){return a.viewport(0,0,t,r)}),Oe(a,function(){return a.scissor(0,0,t,r)})},n.prototype.setOutputMatrixWriteRegionDriver=function(e,t,r,a){var i=this;this.throwIfDisposed(),Oe(this.gl,function(){return i.gl.scissor(e,t,r,a)})},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},n}();function bLe(n){for(var e=0;e<n.length;++e){var t=n[e]();if(!t)break}return e-1}function wLe(n){for(var e=new Float32Array(n.length),t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}function ja(n){return function(e,t,r,a,i){var o=k.backend_util.assertAndGetBroadcastShape(e,t),s=o.length,u=k.util.computeStrides(o),c=k.util.sizeFromShape(o),l=k.util.getTypedArrayFromDType(i,c),f=e.length,h=t.length,p=k.util.computeStrides(e),d=k.util.computeStrides(t),v=k.backend_util.getBroadcastDims(e,o),m=k.backend_util.getBroadcastDims(t,o);if(v.length+m.length===0)for(var g=0;g<l.length;++g)l[g]=n(r[g%r.length],a[g%a.length]);else for(var y=function(b){var w=k.util.indexToLoc(b,s,u),x=w.slice(-f);v.forEach(function(C){return x[C]=0});var N=k.util.locToIndex(x,f,p),T=w.slice(-h);m.forEach(function(C){return T[C]=0});var E=k.util.locToIndex(T,h,d);l[b]=n(r[N],a[E])},g=0;g<l.length;++g)y(g);return[l,o]}}function xLe(n,e,t,r){if(r==="int32"){var a=Int32Array.from(n);return[e,"int32",a]}if(r==="bool"){var i=k.util.toTypedArray([0],t),o=Te(ja(function(c,l){return c!==l?1:0})(e,[],n,i,"bool"),2),s=o[0],u=o[1];return[u,"bool",s]}throw new Error("Error in Cast: failed to cast ".concat(t," to ").concat(r))}var kLe=ja(function(n,e){return n+e});function SLe(n,e,t,r,a){for(var i=k.util.sizeFromShape(r),o=k.util.makeZerosTypedArray(a,t),s=0;s<n.length;s++){var u=n[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(i>0?o[u]+=e[s]:o[u]+=1)}return o}function NLe(n,e,t,r){r===void 0&&(r=!1);for(var a=n.shape[0],i=n.shape[1],o=k.buffer([a,t],e.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=n.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=t||(r?o.set(1,s,c):e.size>0?o.set(o.get(s,c)+e.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o}function es(n){return function(e,t,r){for(var a=k.util.getTypedArrayFromDType(t,e.length),i=0;i<e.length;++i)a[i]=n(e[i],r);return a}}var TLe=es(function(n){return Math.ceil(n)});function ELe(n,e,t,r){var a=k.util.getArrayFromDType(t,k.util.sizeFromShape(e));if(r&&t!=="string"){var i=0;n.forEach(function(s){var u=k.util.sizeFromShape(s.shape);a.set(s.vals,i),i+=u})}else{var o=0;n.forEach(function(s){for(var u=t==="string"?k.backend_util.fromUint8ToStringArray(s.vals):s.vals,c=0,l=0;l<s.shape[0];++l)for(var f=l*e[1]+o,h=0;h<s.shape[1];++h)a[f+h]=u[c++];o+=s.shape[1]})}return a}var ILe=ja(function(n,e){return n===e?1:0});var CLe=es(function(n){return Math.exp(n)});var ALe=es(function(n){return Math.expm1(n)});var _Le=es(function(n){return Math.floor(n)});function DLe(n,e,t,r,a,i,o,s,u){for(var c=k.buffer([r,i],t),l=0;l<r;l++){for(var f=[],h=0,p=0;p<a;p++){var d=n[l*a+p];h+=d*o[p],f.push(d)}if(h<0||h>=u/i)throw new Error("Invalid indices: ".concat(f," does not index into ").concat(s));for(var v=0;v<i;v++)c.values[l*i+v]=e.get.apply(e,pn([],Te(e.indexToLoc(h*i+v)),!1))}return c}function FLe(n,e,t){for(var r=k.buffer(t,n.dtype),a=0;a<r.size;++a){var i=r.indexToLoc(a),o=i.slice(),s=o[0],u=o[2],c=e.locToIndex([s,u]);o[2]=e.values[c];var l=n.locToIndex(o);0<=l&&l<n.values.length&&(r.values[a]=n.values[l])}return r}var RLe=ja(function(n,e){return n>e?1:0});var OLe=ja(function(n,e){return n>=e?1:0});var PLe=ja(function(n,e){return n<e?1:0});var MLe=ja(function(n,e){return n<=e?1:0});function BLe(n,e,t){var r=(e-n)/(t-1),a=k.util.makeZerosTypedArray(t,"float32");a[0]=n;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return a}var LLe=es(function(n){return Math.log(n)});function zLe(n,e,t,r){for(var a=k.util.getTypedArrayFromDType(r,k.util.sizeFromShape(t)),i=0;i<a.length;++i){for(var o=i*e,s=n[o],u=0;u<e;++u){var c=n[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a}var $Le=ja(function(n,e){return Math.max(n,e)});var qLe=ja(function(n,e){return Math.min(n,e)});var oq=ja(function(n,e){return n*e});function WLe(n,e,t){var r=k.util.createScalarValue(-1,t);return oq([],e,r,n,t)}var VLe=ja(function(n,e){return n!==e?1:0});function GLe(n,e,t,r,a){for(var i=e.length,o=k.util.sizeFromShape(e),s=k.util.computeStrides(e),u=k.util.computeStrides(a),c=k.util.getTypedArrayFromDType(t,k.util.sizeFromShape(a)),l=0;l<o;++l){for(var f=k.util.indexToLoc(l,i,s),h=new Array(f.length),p=0;p<h.length;p++)h[p]=f[r[p]];var d=k.util.locToIndex(h,i,u);c[d]=n[l]}return c}function ULe(n,e,t,r){for(var a=Te(k.backend_util.computeOutAndReduceShapes(n,r),2),i=a[0],o=a[1],s=k.upcastType(e,"int32"),u=k.util.makeZerosTypedArray(k.util.sizeFromShape(i),s),c=k.util.sizeFromShape(o),l=0;l<u.length;++l){for(var f=l*c,h=1,p=0;p<c;++p)h*=t[f+p];u[l]=h}return{outVals:u,outShape:i,outDtype:s}}function HLe(n,e,t){n.forEach(function(r,a){if(r<0||r>=t){var i=k.util.indexToLoc(a,e.length,k.util.computeStrides(e)).join(",");throw new Error("indices[".concat(i,"] = ").concat(r," is not in [0, ").concat(t,")"))}})}function KLe(n,e){for(var t=0;t<n.length;++t){var r=n[t],a=t===n.length-1?e:n[t+1].length;if(r.length===0)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>a)throw new Error("Ragged splits must not point past values");for(var i=1;i<r.length;++i)if(r[i-1]>r[i])throw new Error("Ragged splits must be sorted in ascending order")}}function jLe(n,e,t,r){var a=[],i=0,o=e.length-1+t.length,s=new Array(o).fill(null).map(function(){return[0]});KLe(t,r);for(var u=1,c=0;c<e.length-1;++c){u*=e[c];for(var l=e[c+1],f=1;f<u+1;++f)s[c].push(f*l)}for(var f=0;f<n.length;++f){for(var h=n[f],p=n[f]+1,c=0;c<t.length;++c){var d=t[c],v=c+e.length-1;if(v>=0)for(var m=s[v],g=m[m.length-1]-d[h],y=h;y<p;++y)s[v].push(d[y+1]+g);h=d[h],p=d[p]}p!==h&&(a.push([h,p]),i+=p-h)}return{outSplits:s,valueSlices:a,numValues:i}}function XLe(n){for(var e=[],t=function(a){var i=n[a].length,o=k.util.getArrayFromDType("int32",i);e.push(o),n[a].forEach(function(s,u){return o[u]=s})},r=0;r<n.length;++r)t(r);return e}function $z(n,e){for(var t=n.slice(0,e);t.length<e;)t.push(1);for(var r=e;r<n.length;r++)t[e-1]*=n[r];return t}function YLe(n,e,t,r,a,i){var o,s,u=$z(e,2)[1],c=$z(i,2)[1],l=0;try{for(var f=ra(t),h=f.next();!h.done;h=f.next())for(var p=h.value,d=p[0];d<p[1];++d){for(var v=0;v<r;++v)a[l*c+v]=n[d*u+v];++l}}catch(m){o={error:m}}finally{try{h&&!h.done&&(s=f.return)&&s.call(f)}finally{if(o)throw o.error}}}function ZLe(n,e,t,r,a){var i=e.slice();i[0]=a;var o=k.util.getArrayFromDType(t,k.util.sizeFromShape(i)),s=n.length,u=s===0?0:s/e[0];return YLe(n,e,r,u,o,i),[o,i]}function JLe(n,e,t,r,a,i,o,s){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");var u=e[0][0]-1;if(HLe(i,o,u),r.length===0)throw new Error("params.rank must be nonzero");var c=r[0],l=jLe(i,o,n,c),f=l.outSplits,h=l.valueSlices,p=l.numValues,d=XLe(f),v=ZLe(t,r,a,h,p);return[d,v[0],v[1]]}var qz=2147483647;function QLe(n,e,t,r,a,i,o){if(e.length>1)throw new Error("starts must be a scalar or vector");if(a.length>1)throw new Error("limits must be a scalar or vector");if(o.length>1)throw new Error("deltas must be a scalar or vector");var s=e.length===0,u=a.length===0,c=o.length===0,l=[];s||l.push(e[0]),u||l.push(a[0]),c||l.push(o[0]);for(var f=1;f<l.length;++f)if(l[f]!==l[f-1])throw new Error("starts, limits, and deltas must have the same shape");var h=l.length===0?1:l[0],p=k.util.getArrayFromDType("int32",h+1);p[0]=0;for(var d=0;d<h;++d){var v=s?n[0]:n[d],m=u?r[0]:r[d],g=c?i[0]:i[d];if(g===0)throw new Error("Requires delta != 0");var y=void 0;if(g>0&&m<v||g<0&&m>v)y=0;else if(y=Math.ceil(Math.abs((m-v)/g)),y>qz)throw new Error("Requires ((limit - start) / delta) <= ".concat(qz));p[d+1]=p[d]+y}for(var b=p[h],w=k.util.getArrayFromDType(t,b),x=0,d=0;d<h;++d)for(var N=p[d+1]-p[d],T=s?n[0]:n[d],g=c?i[0]:i[d],f=0;f<N;++f)w[x++]=T,T+=g;return[p,w]}var Ka=k.backend_util.RowPartitionType,eze=function(){function n(e,t,r,a,i,o,s,u,c,l){this.shape=e,this.shapeShape=t,this.values=r,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=k.backend_util.getRowPartitionTypesHelper(l),this.raggedRank=k.backend_util.getRaggedRank(this.rowPartitionTypes)}return n.prototype.getRowPartitionTypeByDimension=function(e){return this.rowPartitionTypes[0]===Ka.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]},n.prototype.getRowPartitionTensor=function(e){return this.rowPartitionTypes[0]===Ka.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]},n.prototype.getMaxWidth=function(e){var t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Ka.VALUE_ROWIDS:return n.getMaxWidthValueRowID(t);case Ka.ROW_SPLITS:return n.getMaxWidthRowSplit(t);default:throw new Error("Cannot handle partition type ".concat(Ka[this.getRowPartitionTypeByDimension(e-1)]))}},n.getMaxWidthRowSplit=function(e){var t=e.length;if(t===0||t===1)return 0;for(var r=0,a=0;a<t-1;++a){var i=e[a+1]-e[a];i>r&&(r=i)}return r},n.getMaxWidthValueRowID=function(e){var t=e.length;if(t===0)return 0;for(var r=0,a=e[0],i=0,o=1;o<t;++o){var s=e[o];s!==a&&(a=s,i=Math.max(o-r,i),r=o)}return Math.max(t-r,i)},n.prototype.tensorShapeFromTensor=function(e,t,r){if(r===void 0&&(r=!0),t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return Vz(e,r)},n.prototype.calculateOutputSize=function(e){var t=this.valuesShape,r=this.defaultValueShape;k.backend_util.validateDefaultValueShape(r,t);var a=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=k.backend_util.combineRaggedTensorToTensorShapes(this.raggedRank,a,t),o=i;o[0]<0&&(o[0]=e);for(var s=1;s<=this.raggedRank;++s)o[s]<0&&(o[s]=this.getMaxWidth(s));return o},n.prototype.calculateFirstParentOutputIndex=function(e,t,r){for(var a=Math.min(e,r),i=[],o=0,s=0;s<a;++s,o+=t)i.push(o);for(var s=a;s<e;++s)i.push(-1);return k.util.assert(i.length===e,function(){return"Final length of result must be equal to firstDimension."}),i},n.prototype.calculateOutputIndexRowSplit=function(e,t,r,a){for(var i=e.length,o=[],s=0;s<i-1;++s){var u=e[s+1]-e[s],c=Math.min(a,u),l=t[s];l===-1&&(c=0);for(var f=0;f<c;++f)o.push(l),l+=r;for(var f=0;f<u-c;++f)o.push(-1)}if(i>0&&o.length!==e[i-1])throw new Error("Invalid row split size.");return o},n.prototype.calculateOutputIndexValueRowID=function(e,t,r,a){var i=e.length,o=[];if(i===0)return[];var s=0,u=e[0];if(u>=t.length)throw new Error("Got currentValueRowId=".concat(u,", which is not less than ").concat(t.length));var c=t[u];o.push(c);for(var l=1;l<i;++l){var f=e[l];if(f===u)c>=0&&(++s,s<a?c+=r:c=-1);else{if(s=0,u=f,f>=t.length)throw new Error("Got nextValueRowId=".concat(f," which is not less than ").concat(t.length));c=t[f]}o.push(c)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o},n.prototype.calculateOutputIndex=function(e,t,r,a){var i=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case Ka.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(i,t,r,a);case Ka.ROW_SPLITS:if(i.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(i.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(i,t,r,a);default:throw new Error("Unsupported partition type: ".concat(Ka[o]))}},n.prototype.getFirstDimensionSize=function(){var e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case Ka.FIRST_DIM_SIZE:return e[0];case Ka.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Ka.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(Ka[t]))}},n.prototype.compute=function(){var e=this.rowPartitionValues[0];if(e.length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var t=this.getFirstDimensionSize(),r=this.calculateOutputSize(t),a=new Array(this.raggedRank+1);a[a.length-1]=1;for(var i=a.length-2;i>=0;--i)a[i]=a[i+1]*r[i+1];var o=Vz(r,!1),s=k.util.getArrayFromDType(this.valuesDType,k.util.sizeFromShape(o)),u=a[0]*r[0];if(u>0){for(var c=this.calculateFirstParentOutputIndex(t,a[0],r[0]),i=1;i<=this.raggedRank;++i){var l=this.calculateOutputIndex(i-1,c,a[i],r[i]);c=l}this.setOutput(this.raggedRank,c,s,o)}return[o,s]},n.prototype.setOutput=function(e,t,r,a){if(r.length!==0){var i=this.values,o=r,s=a.slice();s=s.slice(e+1);var u=k.util.sizeFromShape(s),c=t.length,l=this.defaultValue;if(l.length!==u&&l.length!==1){var f=this.defaultValueShape;k.tidy(function(){var x=k.reshape(l,f),N=k.broadcastTo(x,s);l=N.dataSync()})}for(var h=0,p=0,d=0,v=0;v<=c;++v){var m=v<c?t[v]:-1;if(m===d){++d;continue}if(p<d){var g=i.subarray(h*u),y=o.subarray(p*u),b=(d-p)*u;Wz(y,g,b)}if(v>=c){var w=r.length;m=Math.floor(w/u)}if(m>d)if(this.defaultValue.length===1)o.subarray(d*u,m*u).fill(this.defaultValue[0]),d=m;else for(;m>d;){var y=o.slice(d*u);Wz(y,l,u),++d}m<0?(h=v+1,p=d):(h=v,p=d,d=p+1)}}},n}();function Wz(n,e,t){for(var r=0;r<t;r++)n[r]=e[r]}function Vz(n,e){var t,r,a=[];try{for(var i=ra(n),o=i.next();!o.done;o=i.next()){var s=o.value;if(s<0){if(!e)throw new Error("Dimension ".concat(s," must be >= 0"));if(s<-1)throw new Error("Dimension ".concat(s," must be >= -1"));s=-1}a.push(s)}}catch(u){t={error:u}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return a}function tze(n,e,t,r,a,i,o,s,u,c){return new eze(n,e,t,r,a,i,o,s,u,c).compute()}function nze(n,e,t,r){var a=n===e,i=n<e&&t<0,o=e<n&&t>1;if(a||i||o)return k.util.makeZerosTypedArray(0,r);var s=Math.abs(Math.ceil((e-n)/t)),u=k.util.makeZerosTypedArray(s,r);e<n&&t===1&&(t=-1),u[0]=n;for(var c=1;c<u.length;c++)u[c]=u[c-1]+t;return u}var rze=es(function(n){return 1/Math.sqrt(n)});function aze(n,e,t,r,a,i,o,s,u,c){var l=[r/a,a],f=n.values,h=e.values;if(r===0)return k.buffer(t,e.dtype);var p=k.buffer(l,e.dtype);typeof u=="string"||typeof u=="number"?p.values.fill(u):typeof u=="boolean"&&p.values.fill(+u);for(var d=0;d<i;d++){for(var v=[],m=0,g=0;g<o;g++){var y=f[d*o+g];v.push(y),m+=y*s[g]}if(m<0||m>=r/a)throw new Error("Invalid indices: ".concat(v," does not index into ").concat(t));for(var b=0;b<a;b++)c?p.values[m*a+b]+=h[d*a+b]:p.values[m*a+b]=e.rank===0?h[0]:h[d*a+b]}return p}var ize=es(function(n){return 1/(1+Math.exp(-n))});function oze(n,e,t,r,a){var i=k.slice_util.isSliceContinous(r,e,t),o=k.util.sizeFromShape(t),s=k.util.computeStrides(r);if(i){var u=k.slice_util.computeFlatOffset(e,s);return a==="string"?n.slice(u,u+o):n.subarray(u,u+o)}for(var c=a==="string"?k.backend_util.fromUint8ToStringArray(n):n,l=k.buffer(r,a,c),f=k.buffer(t,a),h=0;h<f.size;++h){var p=f.indexToLoc(h),d=p.map(function(v,m){return v+e[m]});f.set.apply(f,pn([l.get.apply(l,pn([],Te(d),!1))],Te(p),!1))}return a==="string"?k.backend_util.fromStringArrayToUint8(f.values):f.values}function sze(n,e,t,r,a,i,o){var s=e[0],u=i[0],c=new Array(u),l=new Array(s),f=e[1];if(u===0){if(s!==0)throw new Error(k.backend_util.getSparseFillEmptyRowsIndicesDenseShapeMismatch(s));var h=k.util.getArrayFromDType(t,0),p=k.util.getArrayFromDType(a,0);return[h,[0,f],p,c,l]}for(var d=!0,v=0,m=new Array(u).fill(0),g=0;g<s;++g){var y=n[g*f];if(y<0)throw new Error(k.backend_util.getSparseFillEmptyRowsNegativeIndexErrorMessage(g,y));if(y>=u)throw new Error(k.backend_util.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(g,y,u));++m[y],d=d&&y>=v,v=y}for(var b=!0,y=0;y<u;++y){var w=m[y]===0;c[y]=w,b=b&&!w,m[y]=Math.max(m[y],1),y>0&&(m[y]+=m[y-1])}if(b&&d){for(var h=n,p=r,g=0;g<s;++g)l[g]=g;return[h,[s,f],p,c,l]}else{for(var x=m[u-1],h=k.util.getArrayFromDType(t,x*f),p=k.util.getArrayFromDType(a,x),N=new Array(u).fill(0),g=0;g<s;++g){var y=n[g*f],T=N[y],E=(y===0?0:m[y-1])+T;N[y]++;for(var C=0;C<f;++C)h[E*f+C]=n[g*f+C];p[E]=r[g],l[g]=E}for(var y=0;y<u;++y){var F=N[y];if(F===0){var D=y===0?0:m[y-1];h[D*f+0]=y;for(var O=1;O<f;++O)h[D*f+O]=0;p[D]=o}}return[h,[x,f],p,c,l]}}function uze(n,e,t,r,a){for(var i=k.util.sizeFromShape(r),o=e[0],s=a.length,u=[],c=1,l=-1,f=0;f<s;++f){var h=a[f];if(h===-1){if(l!==-1)throw new Error(k.backend_util.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(l,f));l=f,u.push(1)}else{if(h<0)throw new Error(k.backend_util.getSparseReshapeNegativeOutputDimErrorMessage(f,h));c*=h,u.push(h)}}if(l!==-1){if(c<=0)throw new Error(k.backend_util.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());var p=Math.trunc(i/c);if(c*p!==i)throw new Error(k.backend_util.getSparseReshapeInputOutputMultipleErrorMessage(r,u));u[l]=p}var d=k.util.sizeFromShape(u);if(d!==i)throw new Error(k.backend_util.getSparseReshapeInputOutputMismatchErrorMessage(r,u));var v=r.length,m=[];if(v>0){m[v-1]=1;for(var f=v-2;f>=0;--f)m[f]=m[f+1]*r[f+1]}var g=[];if(s>0){g[s-1]=1;for(var f=s-2;f>=0;--f)g[f]=g[f+1]*u[f+1]}for(var y=k.util.getArrayFromDType(t,o*s),b=0;b<o;++b){for(var w=0,x=0;x<v;++x)w+=n[b*v+x]*m[x];for(var x=0;x<s;++x)y[b*s+x]=Math.trunc(w/g[x]),w%=g[x]}return[y,[o,s],u]}function cze(n,e,t,r,a,i,o){i===void 0&&(i=!1),o===void 0&&(o=0);var s=r.length,u=[e[0],n.length/e[0]],c=u[1],l=s>0?a[s-1]+1:0,f=l;if(f<0)throw new Error(k.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());var h=e.slice();h[0]=f;var p=h.reduce(function(T,E){return T*E},1),d=k.util.getArrayFromDType(t,p);if(s===0)return f>0&&d.fill(o),[d,h];if(f<=0)throw new Error(k.backend_util.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());for(var v=0,m=1,g=0,y=a[v];;){var b=0;if(m<s){if(b=a[m],y===b){++m;continue}if(y>=b)throw new Error(k.backend_util.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=f)throw new Error(k.backend_util.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,f));y>g&&d.fill(o,g*c,y*c);for(var w=v;w<m;++w){var x=r[w];if(x<0||x>=u[0])throw new Error(k.backend_util.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(w,r[w],u[0]));for(var N=0;N<c;N++)d[y*c+N]+=n[x*c+N]}if(i)for(var N=0;N<c;N++)d[y*c+N]/=m-v;if(v=m,++m,g=y+1,y=b,m>s)break}return g<f&&d.fill(o,g*c,f*c),[d,h]}var lze=es(function(n){return Math.sqrt(n)});function fze(n,e,t,r){for(var a=k.buffer(n,e.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*t[u]+r[u];a.set.apply(a,pn([e.get.apply(e,pn([],Te(s),!1))],Te(o),!1))}return a}var hze=function(){function n(e,t,r,a,i,o){this.separator=k.util.encodeString(e),this.nGramWidths=t,this.leftPad=k.util.encodeString(r),this.rightPad=k.util.encodeString(a),this.padWidth=i,this.preserveShort=o}return n.prototype.getPadWidth=function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)},n.prototype.getNumNGrams=function(e,t){var r=this.getPadWidth(t);return Math.max(0,e+2*r-t+1)},n.prototype.createNGrams=function(e,t,r,a,i,o){for(var s=function(l){var f=u.getPadWidth(o),h=Math.max(0,f-l),p=Math.max(0,f-(i-(l+1))),d=o-(h+p),v=t+(h>0?0:l-f),m=0;m+=h*u.leftPad.length;for(var g=0;g<d;++g)m+=e[v+g].length;m+=p*u.rightPad.length;var y=h+p+d-1;m+=y*u.separator.length,r[a+l]=new Uint8Array(m);for(var b=r[a+l],w=0,x=function(N){return N.forEach(function(T){return b[w++]=T})},g=0;g<h;++g)x(u.leftPad),x(u.separator);for(var g=0;g<d-1;++g)x(e[v+g]),x(u.separator);if(d>0){x(e[v+d-1]);for(var g=0;g<p;++g)x(u.separator),x(u.rightPad)}else{for(var g=0;g<p-1;++g)x(u.rightPad),x(u.separator);x(u.rightPad)}},u=this,c=0;c<i;++c)s(c)},n.prototype.compute=function(e,t){var r=this,a=e.length,i=t.length;if(i>0){var o=t[0];if(o!==0)throw new Error("First split value must be 0, got ".concat(o));for(var s=1;s<i;++s){var u=t[s]>=o;if(u=u&&t[s]<=a,!u)throw new Error("Invalid split value ".concat(t[s],", must be in [").concat(o,", ").concat(a,"]"));o=t[s]}if(o!==a)throw new Error("Last split value must be data size. Expected ".concat(a,", got ").concat(o))}var c=i-1,l=k.util.getArrayFromDType("int32",i);if(a===0||i===0){for(var f=new Array(a),s=0;s<=c;++s)l[s]=0;return[f,l]}l[0]=0;for(var h=function(g){var y=t[g]-t[g-1],b=0;p.nGramWidths.forEach(function(w){b+=r.getNumNGrams(y,w)}),p.preserveShort&&y>0&&b===0&&(b=1),l[g]=l[g-1]+b},p=this,s=1;s<=c;++s)h(s);for(var d=new Array(l[c]),v=function(g){var y=t[g],b=l[g];if(m.nGramWidths.forEach(function(T){var E=t[g+1]-t[g],C=r.getNumNGrams(E,T);r.createNGrams(e,y,d,b,C,T),b+=C}),m.preserveShort&&b===l[g]){var w=t[g+1]-t[g];if(w===0)return"continue";var x=w+2*m.padWidth,N=1;m.createNGrams(e,y,d,b,N,x)}},m=this,s=0;s<c;++s)v(s);return[d,l]},n}();function pze(n,e,t,r,a,i,o,s){return new hze(t,r,a,i,o,s).compute(n,e)}function dze(n,e,t,r){if(!!n.length){if(e.length===0){for(var a=0;a<n.length;++a)r.push(n.subarray(a,a+1));return}if(e.length===1){for(var i=e[0],o=n.indexOf(i);o!==-1;){var s=n.subarray(0,o);(!t||s.length!==0)&&r.push(s),n=n.subarray(o+1),o=n.indexOf(i)}(!t||n.length!==0)&&r.push(n);return}for(var u=0,a=0;a<n.length+1;a++)if(a===n.length||e.indexOf(n[a])!==-1){var s=n.subarray(u,a);(!t||s.length!==0)&&r.push(s),u=a+1}}}function vze(n,e,t){for(var r=n.length,a=[],i=0,o=0,s=new Array(r),u=0;u<r;++u){var c=a.length;dze(n[u],e,t,a);var l=a.length-c;s[u]=l,i+=l,o=Math.max(o,l)}for(var f=k.util.getArrayFromDType("int32",i*2),h=new Array(i),p=[r,o],d=0,u=0;u<r;++u)for(var v=0;v<s[u];++v)f[d*2]=u,f[d*2+1]=v,h[d]=a[d],++d;return[f,h,p]}function mze(n,e){for(var t=k.util.getArrayFromDType("int32",n.length),r=0;r<n.length;++r)t[r]=k.util.fingerPrint64(n[r]).modulo(e).getLowBitsUnsigned();return t}var gze=ja(function(n,e){return n-e});function yze(n,e){for(var t=new Array(n.rank),r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];for(var a=k.buffer(t,n.dtype),r=0;r<a.values.length;++r){for(var i=a.indexToLoc(r),o=new Array(n.rank),s=0;s<o.length;s++)o[s]=i[s]%n.shape[s];var u=n.locToIndex(o);a.values[r]=n.values[u]}return a}var uh=function(n,e){var t=e.value-n.value;return t===0?n.index-e.index:t};function sq(n,e,t,r){for(t===void 0&&(t=0),r===void 0&&(r=n.length-1);r>t;){if(r-t>600){var a=r-t+1,i=e-t+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2),c=Math.max(t,Math.floor(e-i*s/a+u)),l=Math.min(r,Math.floor(e+(a-i)*s/a+u));sq(n,e,c,l)}var f=n[e],h=t,p=r;for(k.util.swap(n,t,e),uh(n[r],f)>0&&k.util.swap(n,t,r);h<p;){for(k.util.swap(n,h,p),h++,p--;uh(n[h],f)<0;)h=h+1;for(;uh(n[p],f)>0;)p=p-1}uh(n[t],f)===0?k.util.swap(n,t,p):(p=p+1,k.util.swap(n,p,r)),p<=e&&(t=p+1),e<=p&&(r=p-1)}}function bze(n,e,t,r,a){for(var i=e[e.length-1],o=Te([n.length/i,i],2),s=o[0],u=o[1],c=k.util.getTypedArrayFromDType(t,s*r),l=k.util.getTypedArrayFromDType("int32",s*r),f=function(d){var v=d*u,m=n.subarray(v,v+u),g=new Array(m.length);m.forEach(function(N,T){return g[T]={value:N,index:T}}),r<g.length&&(sq(g,r),g=g.slice(0,r)),a&&g.sort(uh);for(var y=d*r,b=c.subarray(y,y+r),w=l.subarray(y,y+r),x=0;x<r;x++)b[x]=g[x].value,w[x]=g[x].index},h=0;h<s;h++)f(h);var p=e.slice();return p[p.length-1]=r,[k.buffer(p,t,c),k.buffer(p,"int32",l)]}function wze(n,e,t,r){for(var a=k.util.parseAxisParam(e,t)[0],i=[1,t[0],1],o=0;o<a;o++)i[0]*=t[o];i[1]=t[a];for(var o=a+1;o<t.length;o++)i[2]*=t[o];for(var s={},u=new Int32Array(t[a]),c=new k.TensorBuffer(i,r,n),l=[],f=i[0]===1&&i[2]===1,o=0;o<t[a];o++){var h=void 0;if(f)h=n[o].toString();else{for(var p=[],d=0;d<i[0];d++)for(var v=0;v<i[2];v++)p.push(c.get(d,o,v));h=p.join(",")}if(s[h]!==void 0)u[o]=s[h];else{var m=Object.keys(s).length;s[h]=m,u[o]=m,l.push(o)}}var g=i.slice();g[1]=Object.keys(s).length;var y=new k.TensorBuffer(g,r);l.forEach(function(w,x){for(var N=0;N<i[0];N++)for(var T=0;T<i[2];T++)y.set(c.get(N,w,T),N,x,T)});var b=t.slice();return b[a]=g[1],{outputValues:y.values,outputShape:b,indices:u}}var xze=kLe,uq=SLe,kze=NLe,Sze=xLe,Nze=TLe,Tze=ELe,Eze=ILe,Ize=CLe,Cze=ALe,Aze=_Le,_ze=DLe,Dze=FLe,Fze=RLe,Rze=OLe,Oze=PLe,Pze=MLe,Mze=BLe,Bze=LLe,Lze=zLe,zze=$Le,$ze=qLe,qze=oq,Wze=WLe,Vze=VLe,Gze=ULe,Uze=JLe,Hze=QLe,Kze=tze,jze=nze,Xze=rze,Yze=aze,Zze=ize,cq=wLe,Jze=oze,Qze=sze,e$e=uze,lq=cze,t$e=lze,n$e=fze,r$e=pze,a$e=vze,i$e=mze,o$e=gze,s$e=yze,u$e=bze,zx=GLe,c$e=wze;function fq(n,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return"".concat(n,".").concat(t)})}function br(n,e){return e===1?[n]:fq(n,e)}function l$e(n,e){if(n===1)return"rc";for(var t="",r=0;r<n;r++)t+=e[r],r<n-1&&(t+=",");return t}var f$e=function(){function n(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=kr(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=br("rc",this.rank),r=Wt(this.rank),a=this.getOutOfBoundsCondition(t),i=this.getSetup(t),o=this.getOutput(t);this.userCode=`
        void main() {
          `.concat(r,` rc = getOutputCoords();

          if(`).concat(a,`) {
            setOutput(vec4(0));
          } else {
            `).concat(i,`

            setOutput(vec4(`).concat(o,`));
          }
        }
      `)}}return n.prototype.getSourceCoordsArr=function(e){for(var t=[],r=0;r<=1;r++)for(var a=0;a<=1;a++){for(var i="".concat(r===0?"r":"rp1",", ").concat(a===0?"c":"cp1"),o=2;o<this.rank;o++)i="".concat(e[e.length-1-o],",")+i;t.push(i)}return t},n.prototype.getOutOfBoundsCondition=function(e){if(this.rank===1)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);for(var t="",r=this.rank-2;r<this.rank;r++)t+="".concat(e[r]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(r,"]"):this.outputShape[r]),r<this.rank-1&&(t+="||");return t},n.prototype.getSetup=function(e){if(this.rank===1)return"";var t=e.slice(-2),r=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],a=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return`
      int r = `.concat(t[0],`;
      int c = `).concat(t[1],`;
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= `).concat(r,`;
      bool rEdge = rp1 >= `).concat(a,`;
    `)},n.prototype.getOutput=function(e){var t=this.getSourceCoordsArr(e);if(this.rank===1){var r=this.enableShapeUniforms?"outShape":this.outputShape[0];return"getA(rc), (rc + 1 >= ".concat(r," ? 0. : getA(rc + 1)), 0, 0")}return"getA(".concat(t[0],`),
            cEdge ? 0. : getA(`).concat(t[1],`),
            rEdge ? 0. : getA(`).concat(t[2],`),
            rEdge || cEdge ? 0. : getA(`).concat(t[3],")")},n}();var hq=function(){function n(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length);for(var r="",a=0;a<4;a++){var i="thisRC = rc;";a%2===1&&(i+="thisRC.z += 1;"),a>1&&(i+="thisRC.y += 1;"),r+=`
        `.concat(i,`
        `).concat(a>0?"if(thisRC.y < rows && thisRC.z < cols){":"",`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`).concat(a,`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `).concat(a>0?"}":"",`
      `)}this.userCode=`
      `.concat(h$e(t,this.enableShapeUniforms),`
      `).concat(this.enableShapeUniforms?Fx():Dx(e),`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `).concat(this.enableShapeUniforms?"outShape[1]":e[1],`;
        int cols = `).concat(this.enableShapeUniforms?"outShape[2]":e[2],`;

        `).concat(r,`

        setOutput(result);
      }
    `)}return n}();function h$e(n,e){var t=e?EBe(["r","c","d"],"inputShape"):du(["r","c","d"],n);return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `.concat(t,`
      return ivec3(r, c, d);
    }
  `)}var p$e=function(){function n(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(e,t,r){var a=Uz(t,r),i=Hz(e,a,r);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);var o=Gz(e,a,this.gpgpu.gl,this.gpgpu.textureConfig,r);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[i].shift();return this.usedTextures[i].push(s),s}var u;return a===ir.PACKED_2X2_FLOAT32?u=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):a===ir.PACKED_2X2_FLOAT16?u=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):a===ir.UNPACKED_FLOAT32?u=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):a===ir.UNPACKED_FLOAT16?u=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):a===ir.PACKED_4X1_UNSIGNED_BYTE&&(u=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[i].push(u),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),u},n.prototype.releaseTexture=function(e,t,r,a){if(this.freeTextures!=null){var i=Uz(r,a),o=Hz(t,i,a);o in this.freeTextures||(this.freeTextures[o]=[]);var s=Gz(t,i,this.gpgpu.gl,this.gpgpu.textureConfig,a),u=k.env().get("WEBGL_DELETE_TEXTURE_THRESHOLD");u!==-1&&this._numBytesAllocated>u?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=s):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=s),this.numUsedTextures--;var c=this.usedTextures[o],l=c.indexOf(e);if(l<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c.splice(l,1),this.log()}},n.prototype.log=function(){if(!!this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}},Object.defineProperty(n.prototype,"numBytesAllocated",{get:function(){return this._numBytesAllocated},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"numBytesFree",{get:function(){return this._numBytesFree},enumerable:!1,configurable:!0}),n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(r){e.gpgpu.deleteMatrixTexture(r.texture)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(a){e.gpgpu.deleteMatrixTexture(a.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}},n}();function d$e(n,e){var t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error("Unknown internal format ".concat(e))}function Gz(n,e,t,r,a){var i=v$e(e,r),o;if(a){var s=Te(Vc(n[0],n[1]),2),u=s[0],c=s[1];o=u*c}else{var l=Te(vh(n[0],n[1]),2),f=l[0],h=l[1];o=f*h}var p=d$e(t,i);return o*p}function v$e(n,e){switch(n){case ir.PACKED_2X2_FLOAT32:return Bx(e);case ir.PACKED_2X2_FLOAT16:return Lx(e);case ir.UNPACKED_FLOAT32:return Ox(e);case ir.UNPACKED_FLOAT16:return Px(e);case ir.PACKED_4X1_UNSIGNED_BYTE:return Mx(e);default:throw new Error("Unknown physical texture type ".concat(n))}}function m$e(n){return k.env().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?ir.PACKED_2X2_FLOAT32:ir.UNPACKED_FLOAT32:n?ir.PACKED_2X2_FLOAT16:ir.UNPACKED_FLOAT16}function Uz(n,e){if(n===ba.UPLOAD)return ir.PACKED_2X2_FLOAT32;if(n===ba.RENDER||n==null)return m$e(e);if(n===ba.DOWNLOAD||n===ba.PIXELS)return ir.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(n))}function Hz(n,e,t){return"".concat(n[0],"_").concat(n[1],"_").concat(e,"_").concat(t)}var Bi=function(){function n(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        `.concat(t,`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `)}return n}(),Xa="if (isnan(x)) return x;",g$e="return x;",Kz="return abs(x);",y$e="return (x >= 0.0) ? x : (exp(x) - 1.0);",b$e=Xa+`
  return (x < 0.0) ? 0.0 : x;
`,w$e=Xa+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Jo="return x;",x$e="return 1.0 / (1.0 + exp(-1.0 * x));";var k$e="return x;",S$e=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,N$e=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,T$e=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,E$e="return 1.0 / (1.0 + exp(-1.0 * x));",Qo=function(){function n(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `.concat(t,`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `)}return n}();var I$e=function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length);var t=e.length,r=br("rc",t),a=Wt(t),i=l$e(t,r),o=r.slice(-2),s=t<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode=`
      void main() {
        `.concat(a,` rc = getOutputCoords();
        vec4 packedInput = getA(`).concat(i,`);

        setOutput(getChannel(packedInput, `).concat(s,`));
      }
    `)}return n}(),C$e=k.kernel_impls.whereImpl,A$e=1e-7,_$e=1e-4,Zv={};function D$e(n){return n in Zv||(Zv[n]={}),Zv[n]}var F$e=k.env().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),R$e=600;function O$e(){return k.env().global.screen==null?1024:k.env().global.screen.height*k.env().global.screen.width*window.devicePixelRatio*R$e/1024/1024}var $x=function(n){cBe(e,n);function e(t){var r=n.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.lastGlFlushTime=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!k.env().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");var a;if(t!=null){if(t instanceof rm)a=t;else{var i=ki(k.env().getNumber("WEBGL_VERSION"),t);a=new rm(i)}r.binaryCache={},r.gpgpuCreatedLocally=!1}else{var i=ki(k.env().getNumber("WEBGL_VERSION"));a=new rm(i),r.binaryCache=D$e(k.env().getNumber("WEBGL_VERSION")),r.gpgpuCreatedLocally=!0}return r.gpgpu=a,r.canvas=r.gpgpu.gl.canvas,r.textureManager=new p$e(r.gpgpu),r.numMBBeforeWarning=O$e(),r.texData=new k.DataStorage(r,k.engine()),r}return e.prototype.nextDataId=function(){return e.nextDataId++},e.prototype.numDataIds=function(){return this.texData.numDataIds()-this.pendingDeletes},e.prototype.writeTexture=function(t,r,a,i,o,s){var u=this.makeTensorInfo(r,a),c=this.texData.get(u.dataId);c.isPacked=!1,c.texture={texture:t,texShape:[i,o]},c.texShape=[i,o];var l=sh(r),f=new zz(l,!1,s),h=this.runWebGLProgram(f,[u],a,[[i,o]]);return h.shape=r,c.texture=null,this.disposeIntermediateTensorInfo(u),h.dataId},e.prototype.write=function(t,r,a){if((k.env().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||k.env().getBool("DEBUG"))&&this.checkNumericalProblems(t),a==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var i={id:this.nextDataId()};return this.texData.set(i,{shape:r,dtype:a,values:t,usage:ba.UPLOAD,refCount:1}),i},e.prototype.refCount=function(t){if(this.texData.has(t)){var r=this.texData.get(t);return r.refCount}return 0},e.prototype.incRef=function(t){var r=this.texData.get(t);r.refCount++},e.prototype.decRef=function(t){if(this.texData.has(t)){var r=this.texData.get(t);r.refCount--}},e.prototype.move=function(t,r,a,i,o){if(k.env().getBool("DEBUG")&&this.checkNumericalProblems(r),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:a,dtype:i,values:r,usage:ba.UPLOAD,refCount:o})},e.prototype.disposeIntermediateTensorInfo=function(t){this.disposeData(t.dataId)},e.prototype.readSync=function(t){var r=this.texData.get(t),a=r.values,i=r.dtype,o=r.complexTensorInfos,s=r.slice,u=r.shape,c=r.isPacked;if(s!=null){var l=void 0;c?l=new Qo(u,Jo):l=new Bi(u,Jo);var f=this.runWebGLProgram(l,[{dataId:t,shape:u,dtype:i}],i),h=this.readSync(f.dataId);return this.disposeIntermediateTensorInfo(f),h}if(a!=null)return this.convertAndCacheOnCPU(t);if(i==="string")return a;var p=this.activeTimers!=null,d;p&&(d=k.util.now());var v;if(i==="complex64"){var m=this.readSync(o.real.dataId),g=this.readSync(o.imag.dataId);v=k.backend_util.mergeRealAndImagArrays(m,g)}else v=this.getValuesFromTexture(t);return p&&(this.downloadWaitMs+=k.util.now()-d),this.convertAndCacheOnCPU(t,v)},e.prototype.read=function(t){return $c(this,void 0,void 0,function(){var r,a,i,o,s,u,c,l,f,h,p,d,v,m,g,y,b,w,x,N,T,E,C;return qc(this,function(F){switch(F.label){case 0:if(this.pendingRead.has(t))return r=this.pendingRead.get(t),[2,new Promise(function(D){return r.push(D)})];if(a=this.texData.get(t),i=a.values,o=a.shape,s=a.slice,u=a.dtype,c=a.complexTensorInfos,l=a.isPacked,s!=null)return f=void 0,l?f=new Qo(o,Jo):f=new Bi(o,Jo),h=this.runWebGLProgram(f,[{dataId:t,shape:o,dtype:u}],u),p=this.read(h.dataId),this.disposeIntermediateTensorInfo(h),[2,p];if(i!=null)return[2,this.convertAndCacheOnCPU(t)];if(k.env().getBool("DEBUG")&&!k.env().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&k.env().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return d=null,u!=="complex64"&&k.env().get("WEBGL_BUFFER_SUPPORTED")&&(v=this.decode(t),m=this.texData.get(v.dataId),d=(C=this.gpgpu).createBufferFromTexture.apply(C,pn([m.texture.texture],Te(Xv(o)),!1))),this.pendingRead.set(t,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:F.sent(),F.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([this.read(c.real.dataId),this.read(c.imag.dataId)])];case 3:return y=F.sent(),b=y[0],w=y[1],g=k.backend_util.mergeRealAndImagArrays(b,w),[3,5];case 4:d==null?g=this.getValuesFromTexture(t):(x=k.util.sizeFromShape(o),g=this.gpgpu.downloadFloat32MatrixFromBuffer(d,x)),F.label=5;case 5:return v!=null&&this.disposeIntermediateTensorInfo(v),d!=null&&(N=this.gpgpu.gl,Oe(N,function(){return N.deleteBuffer(d)})),T=this.convertAndCacheOnCPU(t,g),E=this.pendingRead.get(t),this.pendingRead.delete(t),E.forEach(function(D){return D(T)}),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&k.engine().removeDataId(t,this),this.pendingDeletes--),[2,T]}})})},e.prototype.readToGPU=function(t,r){r===void 0&&(r={});var a=this.texData.get(t),i=a.values,o=a.shape,s=a.slice,u=a.dtype,c=a.isPacked,l=a.texture;if(u==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(s!=null){var f=void 0;c?f=new Qo(o,Jo):f=new Bi(o,Jo);var h=this.runWebGLProgram(f,[{dataId:t,shape:o,dtype:u}],u),p=this.readToGPU(h,r);return this.disposeIntermediateTensorInfo(h),p}if(l==null)throw i!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");var d=this.decode(t,r.customTexShape),v=k.engine().makeTensorFromTensorInfo(d),m=this.texData.get(d.dataId);return Object.assign({tensorRef:v},m.texture)},e.prototype.bufferSync=function(t){var r=this.readSync(t.dataId);if(t.dtype==="string")try{var a=r.map(function(i){return k.util.decodeString(i)});return k.buffer(t.shape,t.dtype,a)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return k.buffer(t.shape,t.dtype,r)},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var r=0;r<t.length;r++){var a=t[r];if(!v$(a))throw k.env().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value ".concat(a," cannot be represented with your ")+"current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value ".concat(a," cannot be represented on this device."))}},e.prototype.getValuesFromTexture=function(t){var r,a=this.texData.get(t),i=a.shape,o=a.dtype,s=a.isPacked,u=k.util.sizeFromShape(i);if(k.env().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var c=this.decode(t),l=this.texData.get(c.dataId),f=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,pn([l.texture.texture],Te(Xv(i)),!1)).subarray(0,u);return this.disposeIntermediateTensorInfo(c),f}var h=k.env().getBool("WEBGL_PACK")&&s===!0,p=h?sh(i):i,d=h?new vLe(p):new dLe(p),v=this.runWebGLProgram(d,[{shape:p,dtype:o,dataId:t}],"float32"),m=this.texData.get(v.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture.texture,m.texShape[0],m.texShape[1]).subarray(0,u);return this.disposeIntermediateTensorInfo(v),g},e.prototype.timerAvailable=function(){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0},e.prototype.time=function(t){var r=this,a=this.activeTimers,i=[],o=!1;this.programTimersStack==null?(this.programTimersStack=i,o=!0):this.activeTimers.push(i),this.activeTimers=i,t();var s=k.util.flatten(this.activeTimers.map(function(l){return l.query})).filter(function(l){return l!=null}),u=k.util.flatten(this.activeTimers.map(function(l){return l.name})).filter(function(l){return l!=null});this.activeTimers=a,o&&(this.programTimersStack=null);var c={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return function(){return $c(r,void 0,void 0,function(){var l;return qc(this,function(f){switch(f.label){case 0:return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(s)]:[3,2];case 1:return l=f.sent(),c.kernelMs=k.util.sum(l),c.getExtraProfileInfo=function(){return l.map(function(h,p){return{name:u[p],ms:h}}).map(function(h){return"".concat(h.name,": ").concat(h.ms)}).join(", ")},[3,3];case 2:c.kernelMs={error:"WebGL query timers are not supported in this environment."},f.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,c]}})})}()},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}},e.prototype.startTimer=function(){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:k.util.now(),endMs:null}},e.prototype.endTimer=function(t){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=k.util.now(),t)},e.prototype.getQueryTime=function(t){return $c(this,void 0,void 0,function(){var r;return qc(this,function(a){return k.env().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:(r=t,[2,r.endMs-r.startMs])})})},e.prototype.disposeData=function(t,r){if(r===void 0&&(r=!1),this.pendingDisposal.has(t))return!1;if(!this.texData.has(t))return!0;if(r?this.texData.get(t).refCount=0:this.texData.get(t).refCount--,!r&&this.texData.get(t).refCount>0)return!1;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),this.pendingDeletes++,!1;this.releaseGPUData(t);var a=this.texData.get(t).complexTensorInfos;return a!=null&&(this.disposeData(a.real.dataId,r),this.disposeData(a.imag.dataId,r)),this.texData.delete(t),!0},e.prototype.releaseGPUData=function(t){var r=this.texData.get(t),a=r.texture,i=r.dtype,o=r.texShape,s=r.usage,u=r.isPacked,c=r.slice,l=c&&c.origDataId||t,f=this.dataRefCount.get(l);f>1?this.dataRefCount.set(l,f-1):(this.dataRefCount.delete(l),a!=null&&(this.numBytesInGPU-=this.computeBytes(o,i),this.textureManager.releaseTexture(a,o,s,u)));var h=this.texData.get(t);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture.texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.shouldExecuteOnCPU=function(t,r){var a=this;return r===void 0&&(r=F$e),k.env().getBool("WEBGL_CPU_FORWARD")&&t.every(function(i){return a.texData.get(i.dataId).texture==null&&k.util.sizeFromShape(i.shape)<r})},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.where=function(t){k.backend_util.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=t.dataSync();return C$e(t.shape,r)},e.prototype.packedUnaryOp=function(t,r,a){var i=new Qo(t.shape,r),o=this.compileAndRun(i,[t],a);return k.engine().makeTensorFromTensorInfo(o)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t])&&t.dtype!=="complex64"){var r=cq(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,r)}if(k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Kz,t.dtype);var a=new Bi(t.shape,Kz),i=this.compileAndRun(a,[t]);return k.engine().makeTensorFromTensorInfo(i)},e.prototype.makeTensorInfo=function(t,r,a){var i;if(r==="string"&&a!=null&&a.length>0&&k.util.isString(a[0])){var o=a.map(function(s){return k.util.encodeString(s)});i=this.write(o,t,r)}else i=this.write(a,t,r);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:r}},e.prototype.makeOutput=function(t,r,a){return k.engine().makeTensorFromTensorInfo(this.makeTensorInfo(t,r,a),this)},e.prototype.unpackTensor=function(t){var r=new I$e(t.shape);return this.runWebGLProgram(r,[t],t.dtype)},e.prototype.packTensor=function(t){var r=new f$e(t.shape),a=!0;return this.runWebGLProgram(r,[t],t.dtype,null,a)},e.prototype.packedReshape=function(t,r){var a=pn([hu(t.shape)],Te(pu(t.shape)),!1),i={dtype:t.dtype,shape:a,dataId:t.dataId},o=pn([hu(r)],Te(pu(r)),!1),s=new hq(o,a),u=!0,c=[a],l=this.runWebGLProgram(s,[i],t.dtype,c,u);return{dataId:l.dataId,shape:r,dtype:l.dtype}},e.prototype.decode=function(t,r){var a=this.texData.get(t),i=a.isPacked,o=a.shape,s=a.dtype;if(r!=null){var u=k.util.sizeFromShape(o),c=r[0]*r[1]*4;k.util.assert(u<=c,function(){return"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."})}var l=sh(o),f;i?f=new pLe(l):f=new hLe(l);var h=!0,p=[r??Xv(l)],d=this.runWebGLProgram(f,[{shape:l,dtype:s,dataId:t}],s,p,h,r);return{dtype:s,shape:o,dataId:d.dataId}},e.prototype.runWebGLProgram=function(t,r,a,i,o,s){var u=this;o===void 0&&(o=!1);var c=this.makeTensorInfo(t.outputShape,a),l=this.texData.get(c.dataId);if(t.packedOutput&&(l.isPacked=!0),t.outPackingScheme===lh.DENSE){var f=s??Xv(t.outputShape);l.texShape=f.map(function(N){return N*2})}if(t.outTexUsage!=null&&(l.usage=t.outTexUsage),k.util.sizeFromShape(c.shape)===0)return l.values=k.util.getTypedArrayFromDType(c.dtype,0),c;var h=[],p=r.map(function(N){if(N.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var T=u.texData.get(N.dataId);if(T.texture==null){if(!t.packedInputs&&k.util.sizeFromShape(N.shape)<=k.env().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:N.shape,texData:null,isUniform:!0,uniformValues:T.values};t.packedInputs&&(T.isPacked=!0,T.shape=N.shape)}if(u.uploadToGPU(N.dataId),!!T.isPacked!=!!t.packedInputs)N=T.isPacked?u.unpackTensor(N):u.packTensor(N),h.push(N),T=u.texData.get(N.dataId);else if(T.isPacked&&!fh(T.shape,N.shape)){var E=N,C=N.shape;N.shape=T.shape,N=u.packedReshape(N,C),h.push(N),T=u.texData.get(N.dataId),E.shape=C}return{shape:N.shape,texData:T,isUniform:!1}});this.uploadToGPU(c.dataId);var d={shape:c.shape,texData:l,isUniform:!1},v=fLe(t,p,d),m=this.getAndSaveBinary(v,function(){return cLe(u.gpgpu,t,p,d)}),g=this.activeTimers!=null,y;g&&(y=this.startTimer()),k.env().get("ENGINE_COMPILE_ONLY")||lLe(this.gpgpu,m,p,d,i),h.forEach(function(N){return u.disposeIntermediateTensorInfo(N)}),g&&(y=this.endTimer(y),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(y)}));var b=k.env().get("WEBGL_FLUSH_THRESHOLD");if(b>0){var w=k.util.now();w-this.lastGlFlushTime>b&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=w)}if(!k.env().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&o===!1){var x=this.unpackTensor(c);return this.disposeIntermediateTensorInfo(c),x}return c},e.prototype.compileAndRun=function(t,r,a,i,o){o===void 0&&(o=!1),a=a||r[0].dtype;var s=this.runWebGLProgram(t,r,a,i,o);return s},e.prototype.getAndSaveBinary=function(t,r){return t in this.binaryCache||(this.binaryCache[t]=r()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;if(!this.disposed){if(!k.env().getBool("IS_TEST")){var r=Object.keys(this.binaryCache);r.forEach(function(a){t.gpgpu.deleteProgram(t.binaryCache[a].webGLProgram),delete t.binaryCache[a]})}this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=k.tidy(function(){if(!k.env().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=k.env().getBool("DEBUG");k.env().set("DEBUG",!1);var a=t.abs(k.scalar(1e-8)).dataSync()[0];if(k.env().set("DEBUG",r),a>0)return 32}return 16})),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?A$e:_$e},e.prototype.uploadToGPU=function(t){var r,a=this.texData.get(t),i=a.shape,o=a.dtype,s=a.values,u=a.texture,c=a.usage,l=a.isPacked;if(u==null){var f=this.activeTimers!=null,h;f&&(h=k.util.now());var p=a.texShape;if(p==null&&(p=F$(i,l),a.texShape=p),s!=null){var d=sh(i),v=void 0,m=p[1],g=p[0],y=s instanceof Uint8Array||s instanceof Uint8ClampedArray;(l||!y)&&(r=Te(Vc(p[0],p[1]),2),m=r[0],g=r[1]),l?v=new gLe(d,y):v=new zz(d,y);var b=y?[g,m]:p,w=this.makeTensorInfo(b,o),x=this.texData.get(w.dataId);y?x.usage=ba.PIXELS:x.usage=ba.UPLOAD,x.texShape=b,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(w.dataId),m,g,s);var N=[[g,m]],T=!0,E=this.runWebGLProgram(v,[w],o,N,T),C=this.texData.get(E.dataId);a.texShape=C.texShape,a.isPacked=C.isPacked,a.usage=C.usage,k.env().get("ENGINE_COMPILE_ONLY")?this.disposeData(E.dataId):(a.texture=C.texture,a.values=null,this.texData.delete(E.dataId)),this.disposeIntermediateTensorInfo(w),f&&(this.uploadWaitMs+=k.util.now()-h)}else{var F=this.acquireTexture(p,c,o,l);a.texture=F}}},e.prototype.convertAndCacheOnCPU=function(t,r){var a=this.texData.get(t),i=a.dtype;return r!=null&&(a.values=P$e(r,i)),a.values},e.prototype.acquireTexture=function(t,r,a,i){if(this.numBytesInGPU+=this.computeBytes(t,a),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(o," MB, ")+"most likely due to a memory leak")}return this.textureManager.acquireTexture(t,r,i)},e.prototype.computeBytes=function(t,r){return t[0]*t[1]*k.util.bytesPerElement(r)},e.prototype.checkCompileCompletion=function(){var t,r;try{for(var a=ra(Object.entries(this.binaryCache)),i=a.next();!i.done;i=a.next()){var o=Te(i.value,2),s=o[1];this.checkCompletion_(s)}}catch(u){t={error:u}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}},e.prototype.checkCompileCompletionAsync=function(){return $c(this,void 0,void 0,function(){var t,r,a,i,l,o,s,u,c,l,f,h,p,d,v=this;return qc(this,function(m){if(t=[],this.gpgpu.parallelCompilationExtension){try{for(r=ra(Object.entries(this.binaryCache)),a=r.next();!a.done;a=r.next())i=Te(a.value,2),l=i[1],t.push(this.checkCompletionAsync_(l))}catch(g){f={error:g}}finally{try{a&&!a.done&&(h=r.return)&&h.call(r)}finally{if(f)throw f.error}}return[2,Promise.all(t)]}else{o=function(g){var y=new Promise(function(b){try{v.checkCompletion_(g),b(!0)}catch(w){throw w}});t.push(y)};try{for(s=ra(Object.entries(this.binaryCache)),u=s.next();!u.done;u=s.next())c=Te(u.value,2),l=c[1],o(l)}catch(g){p={error:g}}finally{try{u&&!u.done&&(d=s.return)&&d.call(s)}finally{if(p)throw p.error}}return[2,Promise.all(t)]}})})},e.prototype.checkCompletionAsync_=function(t){return $c(this,void 0,void 0,function(){return qc(this,function(r){switch(r.label){case 0:return this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?[2,this.checkCompletion_(t)]:[3,1];case 1:return[4,k.nextFrame()];case 2:return r.sent(),[2,this.checkCompletionAsync_(t)]}})})},e.prototype.checkCompletion_=function(t){if(this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(t.webGLProgram)),this.gpgpu.gl.getShaderParameter(t.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(_x(t.source,this.gpgpu.gl.getShaderInfoLog(t.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0},e.prototype.getUniformLocations=function(){var t,r;try{for(var a=ra(Object.entries(this.binaryCache)),i=a.next();!i.done;i=a.next()){var o=Te(i.value,2),s=o[1],u=V$(this.gpgpu,s.program,s.webGLProgram),c=u.uniformLocations,l=u.customUniformLocations,f=u.infLoc,h=u.nanLoc,p=u.inShapesLocations,d=u.inTexShapesLocations,v=u.outShapeLocation,m=u.outShapeStridesLocation,g=u.outTexShapeLocation;s.uniformLocations=c,s.customUniformLocations=l,s.infLoc=f,s.nanLoc=h,s.inShapesLocations=p,s.inTexShapesLocations=d,s.outShapeLocation=v,s.outShapeStridesLocation=m,s.outTexShapeLocation=g}}catch(y){t={error:y}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}},e.prototype.createTensorFromGPUData=function(t,r,a){t.channels=t.channels||"RGBA";var i=t.texture,o=t.height,s=t.width,u=t.channels,c=k.engine().backend;if(!c.gpgpu.gl.isTexture(i))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");var l=c.writeTexture(i,r,a,o,s,u);return k.engine().makeTensorFromDataId(l,r,a,c)},e}(k.KernelBackend);$x.nextDataId=0;function P$e(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){for(var t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length),r=0;r<t.length;++r)t[r]=Math.round(n[r]);return t}else throw new Error("Unknown dtype ".concat(e))}var M$e="4.2.0";function pq(){k.env().set("WEBGL_FORCE_F16_TEXTURES",!0)}k.device_util.isBrowser()&&k.registerBackend("webgl",function(){return new $x},2);var B$e={forceHalfFloat:pq};var qx=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`,Wc=function(){function n(e,t,r){this.variableNames=["A","B"],this.outputShape=k.backend_util.assertAndGetBroadcastShape(t,r),this.enableShapeUniforms=kr(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        `.concat(e,`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `)}return n}();var gh=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`,yh=function(){function n(e,t,r,a){a===void 0&&(a=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=k.backend_util.assertAndGetBroadcastShape(t,r);var i=this.outputShape.length;this.enableShapeUniforms=kr(i);var o="";if(a)if(i===0||k.util.sizeFromShape(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else{var s=Wt(i);if(o=`
          `.concat(s,` coords = getOutputCoords();
        `),i===1)this.enableShapeUniforms?o+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:o+=`
            result.y = (coords + 1) >= `.concat(this.outputShape[0],` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `);else{var u=br("coords",i);this.enableShapeUniforms?o+=`
            bool nextRowOutOfBounds =
              (`.concat(u[i-2]," + 1) >= outShape[").concat(i,` - 2];
            bool nextColOutOfBounds =
              (`).concat(u[i-1]," + 1) >= outShape[").concat(i,` - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `):o+=`
            bool nextRowOutOfBounds =
              (`.concat(u[i-2]," + 1) >= ").concat(this.outputShape[i-2],`;
            bool nextColOutOfBounds =
              (`).concat(u[i-1]," + 1) >= ").concat(this.outputShape[i-1],`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `)}}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `.concat(e,`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `).concat(o,`

        setOutput(result);
      }
    `)}return n}();function aa(n){var e=n.inputs,t=n.backend,r=e.x;return t.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var L$e={kernelName:k.Identity,backendName:"webgl",kernelFunc:aa};function ts(n){var e=n.inputs,t=n.backend,r=e.real,a=e.imag,i=t.makeTensorInfo(r.shape,"complex64"),o=t.texData.get(i.dataId),s=aa({inputs:{x:r},backend:t}),u=aa({inputs:{x:a},backend:t});return o.complexTensorInfos={real:s,imag:u},i}var z$e={kernelName:k.Complex,backendName:"webgl",kernelFunc:ts};var dq="return (a < 0.) ? b * a : a;",vq=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function $$e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.alpha,o=t.makeTensorInfo([],"float32",k.util.createScalarValue(i,"float32")),s=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new yh(vq,a.shape,o.shape):new Wc(dq,a.shape,o.shape),u=t.runWebGLProgram(s,[a,o],"float32");return t.disposeIntermediateTensorInfo(o),u}var q$e={kernelName:k.LeakyRelu,backendName:"webgl",kernelFunc:$$e};var mq="return (a < 0.) ? b * a : a;",gq=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function W$e(n){var e=n.inputs,t=n.backend,r=e.x,a=e.alpha,i=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new yh(gq,r.shape,a.shape):new Wc(mq,r.shape,a.shape);return t.runWebGLProgram(i,[r,a],"float32")}var V$e={kernelName:k.Prelu,backendName:"webgl",kernelFunc:W$e},Xc="if (isnan(x)) return x;";function Nt(n){var e=n.opSnippet,t=n.packedOpSnippet,r=n.cpuKernelImpl,a=n.dtype;return function(i){var o=i.inputs,s=i.backend,u=o.x,c=s,l=a||u.dtype;if(c.shouldExecuteOnCPU([u])&&r!=null){var f=c.texData.get(u.dataId),h=r(f.values,l);return c.makeTensorInfo(u.shape,l,h)}var p=k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&t!=null,d;return p?d=new Qo(u.shape,t):d=new Bi(u.shape,e),c.runWebGLProgram(d,[u],l)}}function or(n){var e=n.opSnippet,t=n.packedOpSnippet,r=n.checkOutOfBounds,a=r===void 0?!1:r,i=n.supportsComplex,o=i===void 0?!1:i,s=n.cpuKernelImpl,u=n.dtype;return function(c){var l=c.inputs,f=c.backend,h=l.a,p=l.b,d=f;if(o&&h.dtype==="complex64"){var v=d.texData.get(h.dataId),m=d.texData.get(p.dataId),g=Te([[v.complexTensorInfos.real,m.complexTensorInfos.real],[v.complexTensorInfos.imag,m.complexTensorInfos.imag]].map(function(W){var X=Te(W,2),Y=X[0],V=X[1],j={dataId:Y.dataId,dtype:Y.dtype,shape:h.shape},re={dataId:V.dataId,dtype:V.dtype,shape:p.shape},ne=new Wc(e,h.shape,p.shape);return d.runWebGLProgram(ne,[j,re],k.upcastType(Y.dtype,V.dtype))}),2),y=g[0],b=g[1],w=ts({inputs:{real:y,imag:b},backend:d});return d.disposeIntermediateTensorInfo(y),d.disposeIntermediateTensorInfo(b),w}var x=u||k.upcastType(h.dtype,p.dtype);if((h.dtype==="string"||p.dtype==="string"||d.shouldExecuteOnCPU([h,p]))&&s!=null){var N=d.texData.get(h.dataId).values,T=d.texData.get(p.dataId).values,E=h.dtype==="string"?k.backend_util.fromUint8ToStringArray(N):N,C=h.dtype==="string"?k.backend_util.fromUint8ToStringArray(T):T,F=Te(s(h.shape,p.shape,E,C,x),2),D=F[0],O=F[1],L=d.makeTensorInfo(O,x),z=d.texData.get(L.dataId);return z.values=D,L}var $=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&t!=null,B;return $?B=new yh(t,h.shape,p.shape,a):B=new Wc(e,h.shape,p.shape),d.runWebGLProgram(B,[h,p],x)}}function hh(n,e){if(e===void 0&&(e=!1),n==="linear")return e?k$e:g$e;if(n==="relu")return e?N$e:b$e;if(n==="elu")return e?S$e:y$e;if(n==="relu6")return e?T$e:w$e;if(n==="prelu")return e?gq:mq;if(n==="leakyrelu")return e?vq:dq;if(n==="sigmoid")return e?E$e:x$e;throw new Error("Activation ".concat(n," has not been implemented for the WebGL backend."))}var yq=function(){function n(e,t,r,a,i,o,s,u,c){a===void 0&&(a=!1),i===void 0&&(i=!1),o===void 0&&(o=!1),s===void 0&&(s=null),u===void 0&&(u=!1),c===void 0&&(c=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=kr(this.outputShape.length);var l=a?e[1]:e[2],f=Math.ceil(l/2),h=a?"i * 2, rc.y":"rc.y, i * 2",p=i?"rc.z, i * 2":"i * 2, rc.z",d=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],v=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],m="",g="";s&&(u?m=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `.concat(s,`
        }`):c?m=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          `.concat(s,`
        }`):m=`vec4 activation(vec4 x) {
          `.concat(s,`
        }`),g="result = activation(result);");var y=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");var b="rc.x",w="rc.x";e[0]<t[0]?b="imod(rc.x, ".concat(e[0],")"):t[0]<e[0]&&(w="imod(rc.x, ".concat(t[0],")")),this.userCode=`
      `.concat(m,`
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = `).concat(f,`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = `).concat(b,`;
        int batchB = `).concat(w,`;
        for (int i = 0; i < `).concat(f,`; i++) {
          vec4 a = getMatrixA(batchA, `).concat(h,`);
          vec4 b = getMatrixB(batchB, `).concat(p,`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`).concat(d[0]," * ").concat(v[0],`);
          result += (`).concat(d[1]," * ").concat(v[1],`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `).concat(y,`

        `).concat(g,`

        setOutput(result);
      }
    `)}return n}();var jz={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},Xz=function(){function n(e,t,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=k.backend_util.assertAndGetBroadcastShape(t,r),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `.concat(e,`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `)}return n}(),Yz="return a * b;";function Wx(n){var e=n.inputs,t=n.backend,r=e.a,a=e.b,i=k.backend_util.upcastType(r.dtype,a.dtype);if(r.dtype==="complex64"){var o=t.texData.get(r.dataId),s=t.texData.get(a.dataId),u=new Xz(jz.REAL,r.shape,a.shape),c=new Xz(jz.IMAG,r.shape,a.shape),l=[{dataId:o.complexTensorInfos.real.dataId,dtype:o.complexTensorInfos.real.dtype,shape:r.shape},{dataId:o.complexTensorInfos.imag.dataId,dtype:o.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:a.shape},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:a.shape}],f=t.runWebGLProgram(u,l,"float32"),h=t.runWebGLProgram(c,l,"float32"),p=ts({inputs:{real:f,imag:h},backend:t});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),p}if(t.shouldExecuteOnCPU([r,a])){var o=t.texData.get(r.dataId),s=t.texData.get(a.dataId),d=Te(qze(r.shape,a.shape,o.values,s.values,i),2),v=d[0],m=d[1],g=t.makeTensorInfo(m,i),y=t.texData.get(g.dataId);return y.values=v,g}var b;return k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?b=new yh(Yz,r.shape,a.shape):b=new Wc(Yz,r.shape,a.shape),t.runWebGLProgram(b,[r,a],i)}var G$e={kernelName:k.Multiply,backendName:"webgl",kernelFunc:Wx};function U$e(n,e,t){var r=pn([hu(n.shape)],Te(pu(n.shape)),!1),a={dtype:n.dtype,shape:r,dataId:n.dataId},i=pn([hu(e)],Te(pu(e)),!1),o=new hq(i,r),s=!0,u=[r],c=t.runWebGLProgram(o,[a],n.dtype,u,s);return{dataId:c.dataId,shape:e,dtype:c.dtype}}function Pe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.shape,o=t,s=k.util.sizeFromShape(a.shape),u=k.util.inferFromImplicitShape(i,s),c=k.util.sizeFromShape(u);k.util.assert(s===c,function(){return"The new shape (".concat(u,") has ").concat(c," elements and the old ")+"shape (".concat(a.shape,") has ").concat(s," elements. The new shape and old ")+"shape must have the same number of elements."});var l=o.texData.get(a.dataId);return l.isPacked&&!fh(a.shape,u)&&!(l.texture!==null&&fh(l.shape,u))?U$e(a,u,o):(o.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype})}var H$e={kernelName:k.Reshape,backendName:"webgl",kernelFunc:Pe};var Zz=function(){function n(e,t){this.variableNames=["x"];var r=e.windowSize,a=e.batchSize,i=e.inSize,o=e.outSize;this.outputShape=[a,o];var s=Math.floor(r/4)*4,u=r%4,c="sumValue += dot(values, ones);";if(t!=null){var l=1/t;c="sumValue += dot(values * ".concat(k.util.isInt(l)?l.toPrecision(2):l,", ones);")}var f="";i%r>0&&(f=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return 0.0;
        }
      `)),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `.concat(f,`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `).concat(r,`;

        float sumValue = 0.0;

        for (int i = 0; i < `).concat(s,`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `).concat(c,`
        }

        int inIdx = inOffset + `).concat(s,`;
        if (`).concat(u===1,`) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          `).concat(c,`
        } else if (`).concat(u===2,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          `).concat(c,`
        } else if (`).concat(u===3,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          `).concat(c,`
        }
        setOutput(sumValue);
      }
    `)}return n}();var K$e=function(){function n(e,t){this.variableNames=["x"];var r=e.windowSize,a=e.batchSize,i=e.inSize,o=e.outSize;this.outputShape=[a,o];var s="0.0",u="";t==="prod"?s="1.0":t==="min"?(s="1.0 / 1e-20",u="min"):t==="max"&&(s="-1.0 / 1e-20",u="max");var c="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="sum"?c="sumValue":t==="prod"?c="prodValue":t==="all"?c="allValue":t==="any"&&(c="anyValue");var l=Math.floor(r/4)*4,f=r%4,h=`
      if (`.concat(t==="sum",`) {
        sumValue += dot(values, ones);
      } else if (`).concat(t==="prod",`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `).concat(u,`(values, minMaxValue);
        if (`).concat(t==="min"," || ").concat(t==="max",`) {
          minMaxValue = `).concat(u,`(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `),p="vec4";t==="all"?(s="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,p="bvec4"):t==="any"&&(s="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,p="bvec4");var d="";i%r>0&&(d=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return initializationValue;
        }
      `)),this.userCode=`
      const float initializationValue = `.concat(s,`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `).concat(d,`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `).concat(r,`;

        vec4 minMaxValue = vec4(`).concat(s,`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `).concat(l,`; i += 4) {
          int inIdx = inOffset + i;
          `).concat(p," values = ").concat(p,`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `).concat(h,`
        }

        int inIdx = inOffset + `).concat(l,`;
        if (`).concat(f===1,`) {
          `).concat(p," values = ").concat(p,`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `).concat(h,`
        } else if (`).concat(f===2,`) {
          `).concat(p," values = ").concat(p,`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `).concat(h,`
        } else if (`).concat(f===3,`) {
          `).concat(p," values = ").concat(p,`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `).concat(h,`
        }
        setOutput(`).concat(c,`);
      }
    `)}return n}();function j$e(n){for(var e=[];e.length===0||e[e.length-1].outSize!==1;){var t=e.length?e[e.length-1].outSize:n[1],r=k.backend_util.computeOptimalWindowSize(t);e.push({inSize:t,windowSize:r,outSize:Math.ceil(t/r)})}return e}function mu(n,e,t,r){for(var a=j$e(n.shape),i=n,o=0;o<a.length;o++){var s=a[o],u=s.inSize,c=s.windowSize,l=s.outSize,f=void 0,h=void 0;t==="mean"?f=o===0?new Zz({windowSize:c,inSize:u,batchSize:n.shape[0],outSize:l},u):new Zz({windowSize:c,inSize:u,batchSize:n.shape[0],outSize:l}):f=new K$e({windowSize:c,inSize:u,batchSize:n.shape[0],outSize:l},t),h=i,i=r.runWebGLProgram(f,[i],e),h.dataId!==n.dataId&&r.disposeIntermediateTensorInfo(h)}return i}var X$e=function(){function n(e,t){this.variableNames=["A"];for(var r=new Array(e.length),a=0;a<r.length;a++)r[a]=e[t[a]];this.outputShape=r,this.rank=r.length;var i=Wt(this.rank),o=Y$e(t);this.userCode=`
    void main() {
      `.concat(i,` resRC = getOutputCoords();
      setOutput(getA(`).concat(o,`));
    }
    `)}return n}();function Y$e(n){var e=n.length;if(e>6)throw Error("Transpose for rank ".concat(e," is not yet supported"));for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e),a=0;a<n.length;a++)r[n[a]]=t[a];return r.join()}var Z$e=function(){function n(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var r=new Array(e.length),a=0;a<r.length;a++)r[a]=e[t[a]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=Wt(this.rank),o=fq("rc",this.rank),s=new Array(this.rank),a=0;a<t.length;a++)s[t[a]]=o[a];var u="vec2(".concat(s.slice(-2).join(),")"),c="++".concat(o[this.rank-1]," < ").concat(r[this.rank-1]),l="getChannel(getA(".concat(s.join(),"), ").concat(u,")");this.userCode=`
    void main() {
      `.concat(i,` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `).concat(l,`;
      if(`).concat(c,`) {
        result[1] = `).concat(l,`;
      }
      --`).concat(o[this.rank-1],`;
      if(++`).concat(o[this.rank-2]," < ").concat(r[this.rank-2],`) {
        result[2] = `).concat(l,`;
        if(`).concat(c,`) {
          result[3] = `).concat(l,`;
        }
      }
      setOutput(result);
    }
    `)}return n}();function cm(n,e,t){var r=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Z$e(n.shape,e):new X$e(n.shape,e);return t.runWebGLProgram(r,[n],n.dtype)}function J$e(n,e,t,r){var a=e,i=n.shape.length,o=k.util.parseAxisParam(a,n.shape),s=o,u=k.backend_util.getAxesPermutation(s,i),c=u!=null,l=n;c&&(l=cm(n,u,r),s=k.backend_util.getInnerMostAxes(s.length,i)),k.backend_util.assertAxesAreInnerMostDims("sum",s,i);var f=Te(k.backend_util.computeOutAndReduceShapes(l.shape,s),2),h=f[0],p=f[1],d=h;t&&(d=k.backend_util.expandShapeToKeepDim(h,o));var v=k.util.sizeFromShape(p),m=k.util.sizeFromShape(n.shape),g=m/v,y=Pe({inputs:{x:l},attrs:{shape:[g,v]},backend:r}),b=k.sumOutType(n.dtype),w=mu(y,b,"sum",r),x=Pe({inputs:{x:w},attrs:{shape:d},backend:r});return r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(w),c&&r.disposeIntermediateTensorInfo(l),x}function lm(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims;return J$e(a,i,o,t)}var Q$e={kernelName:k.Sum,backendName:"webgl",kernelFunc:lm};function wr(n){for(var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.perm,o=t,s=a.shape.length,u=new Array(s),c=0;c<u.length;c++)u[c]=a.shape[i[c]];var l;if(o.shouldExecuteOnCPU([a])){var f=o.texData.get(a.dataId),h=f.values,p=zx(h,a.shape,a.dtype,i,u);l=o.makeTensorInfo(u,a.dtype);var d=o.texData.get(l.dataId);d.values=p}else l=cm(a,i,o);return l}var eqe={kernelName:k.Transpose,backendName:"webgl",kernelFunc:wr},bq=1e3;function im(n){var e,t,r=n.a,a=n.b,i=n.transposeA,o=n.transposeB,s=n.backend,u=n.bias,c=u===void 0?null:u,l=n.preluActivationWeights,f=l===void 0?null:l,h=n.leakyreluAlpha,p=h===void 0?0:h,d=n.activation,v=d===void 0?null:d,m=r.shape.length,g=a.shape.length,y=i?r.shape[m-2]:r.shape[m-1],b=o?a.shape[g-1]:a.shape[g-2],w=i?r.shape[m-1]:r.shape[m-2],x=o?a.shape[g-2]:a.shape[g-1],N=r.shape.slice(0,-2),T=a.shape.slice(0,-2),E=k.util.sizeFromShape(N),C=k.util.sizeFromShape(T),F=k.broadcast_util.assertAndGetBroadcastShape(r.shape.slice(0,-2),a.shape.slice(0,-2)),D=F.concat([w,x]);k.util.assert(y===b,function(){return"Error in matMul: inner shapes (".concat(y,") and (")+"".concat(b,") of Tensors with shapes ").concat(r.shape," and ")+"".concat(a.shape," and transposeA=").concat(i)+" and transposeB=".concat(o," must match.")});var O=i?[E,y,w]:[E,w,y],L=o?[C,x,b]:[C,b,x],z=Pe({inputs:{x:r},backend:s,attrs:{shape:O}}),$=Pe({inputs:{x:a},backend:s,attrs:{shape:L}}),B=[z,$],W=Math.max(E,C),X=i?z.shape[1]:z.shape[2],Y=c!=null,V=f!=null,j=v==="leakyrelu",re=v!=null?hh(v,!0):null,ne=Y||V||j||re!=null,oe;if((w===1||x===1)&&X>bq&&ne===!1){var le=z,de=$;i&&(le=wr({inputs:{x:z},backend:s,attrs:{perm:[0,2,1]}}),B.push(le)),o&&(de=wr({inputs:{x:$},backend:s,attrs:{perm:[0,2,1]}}),B.push(de));var xe=x!==1,he=x===1,ye=le;xe&&(ye=Pe({inputs:{x:le},backend:s,attrs:{shape:[W,X,1]}}),B.push(ye));var we=x===1?2:1,Ae=de;he&&(Ae=Pe({inputs:{x:de},backend:s,attrs:{shape:[W,1,X]}}),B.push(Ae));var Ye=Wx({inputs:{a:ye,b:Ae},backend:s});oe=lm({inputs:{x:Ye},backend:s,attrs:{axis:we,keepDims:!0}}),B.push(Ye)}else{var ht=k.upcastType(r.dtype,a.dtype),at=new yq(O,L,[W,w,x],i,o,Y,re,V,j),nt=[z,$];if(c!=null&&nt.push(c),V&&nt.push(f),j){var lt=s.makeTensorInfo([],"float32",k.util.createScalarValue(p,"float32"));nt.push(lt),B.push(lt)}oe=s.runWebGLProgram(at,nt,ht)}var st=Pe({inputs:{x:oe},backend:s,attrs:{shape:D}});B.push(oe);try{for(var Ze=ra(B),tt=Ze.next();!tt.done;tt=Ze.next()){var et=tt.value;s.disposeIntermediateTensorInfo(et)}}catch(rn){e={error:rn}}finally{try{tt&&!tt.done&&(t=Ze.return)&&t.call(Ze)}finally{if(e)throw e.error}}return st}function tqe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.a,i=e.b,o=e.bias,s=e.preluActivationWeights,u=r.transposeA,c=r.transposeB,l=r.activation,f=r.leakyreluAlpha;return im({a,b:i,transposeA:u,transposeB:c,backend:t,bias:o,preluActivationWeights:s,leakyreluAlpha:f,activation:l})}var nqe={kernelName:k._FusedMatMul,backendName:"webgl",kernelFunc:tqe};var Jz="return abs(x);";function rqe(n){var e=n.inputs,t=n.backend,r=e.x;if(t.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){var a=t.texData.get(r.dataId),i=cq(a.values);return t.makeTensorInfo(r.shape,r.dtype,i)}var o;return k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new Qo(r.shape,Jz):o=new Bi(r.shape,Jz),t.runWebGLProgram(o,[r],r.dtype)}var aqe={kernelName:k.Abs,backendName:"webgl",kernelFunc:rqe};var iqe=Xa+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,oqe=Nt({opSnippet:iqe}),sqe={kernelName:k.Acos,backendName:"webgl",kernelFunc:oqe};var uqe=Xa+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,cqe=Nt({opSnippet:uqe}),lqe={kernelName:k.Acosh,backendName:"webgl",kernelFunc:cqe};var Qz="return a + b;",fqe=or({opSnippet:Qz,packedOpSnippet:Qz,supportsComplex:!0,cpuKernelImpl:xze}),hqe={kernelName:k.Add,backendName:"webgl",kernelFunc:fqe};var pqe=function(){function n(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map(function(i,o){return"T".concat(o)});var r=[];this.variableNames.forEach(function(i){r.push("float v".concat(i," = get").concat(i,"AtOutCoords();"))});var a=this.variableNames.map(function(i){return"v".concat(i)}).join(" + ");this.userCode=`
      void main() {
        `.concat(r.join(`
        `),`

        float result = `).concat(a,`;
        setOutput(result);
      }
    `)}return n}();var dqe=function(){function n(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map(function(i,o){return"T".concat(o)});var r=[];this.variableNames.forEach(function(i){r.push("vec4 v".concat(i," = get").concat(i,"AtOutCoords();"))});var a=this.variableNames.map(function(i){return"v".concat(i)}).join(" + ");this.userCode=`
      void main() {
        `.concat(r.join(`
        `),`

        vec4 result = `).concat(a,`;
        setOutput(result);
      }
    `)}return n}();function am(n){var e=n.inputs,t=n.backend,r=e;if(r.length===1)return aa({inputs:{x:r[0]},backend:t});if(r.length>k.env().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(r.length/2),i=am({inputs:r.slice(0,a),backend:t}),o=am({inputs:r.slice(a),backend:t});return am({inputs:[i,o],backend:t})}var s=r.map(function(f){return f.dtype}).reduce(function(f,h){return k.upcastType(f,h)}),u=r.map(function(f){return f.shape}),c=k.env().getBool("WEBGL_PACK"),l=c?new dqe(r[0].shape,u):new pqe(r[0].shape,u);return t.runWebGLProgram(l,r,s)}var vqe={kernelName:k.AddN,backendName:"webgl",kernelFunc:am};function mqe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=a;l!=null&&(f=wr({inputs:{x:a},backend:t,attrs:{perm:l}}),c=k.backend_util.getInnerMostAxes(c.length,s)),k.backend_util.assertAxesAreInnerMostDims("all",c,s);var h=Te(k.backend_util.computeOutAndReduceShapes(f.shape,c),2),p=h[0],d=h[1],v=k.util.sizeFromShape(d),m=Pe({inputs:{x:f},backend:t,attrs:{shape:[-1,v]}}),g=mu(m,m.dtype,"all",t),y;if(o){var b=k.backend_util.expandShapeToKeepDim(p,u);y=Pe({inputs:{x:g},backend:t,attrs:{shape:b}})}else y=Pe({inputs:{x:g},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),l!=null&&t.disposeIntermediateTensorInfo(f),y}var gqe={kernelName:k.All,backendName:"webgl",kernelFunc:mqe};function yqe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=a;l!=null&&(f=wr({inputs:{x:a},backend:t,attrs:{perm:l}}),c=k.backend_util.getInnerMostAxes(c.length,s)),k.backend_util.assertAxesAreInnerMostDims("any",c,s);var h=Te(k.backend_util.computeOutAndReduceShapes(f.shape,c),2),p=h[0],d=h[1],v=k.util.sizeFromShape(d),m=Pe({inputs:{x:f},backend:t,attrs:{shape:[-1,v]}}),g=mu(m,m.dtype,"any",t),y;if(o){var b=k.backend_util.expandShapeToKeepDim(p,u);y=Pe({inputs:{x:g},backend:t,attrs:{shape:b}})}else y=Pe({inputs:{x:g},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),l!=null&&t.disposeIntermediateTensorInfo(f),y}var bqe={kernelName:k.Any,backendName:"webgl",kernelFunc:yqe};var wqe=function(){function n(e,t,r){this.variableNames=["A"];var a=e.windowSize,i=e.batchSize,o=e.outSize;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s=t==="max"?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `.concat(a,`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `).concat(a,`; i++) {
          int inIdx = `).concat(u,`;
          float candidate = getA(batch, inIdx);
          if (candidate `).concat(s,` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `)}return n}();var xqe=function(){function n(e,t,r,a){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,k.util.assert(e.length>2,function(){return"Packed arg".concat(r.charAt(0).toUpperCase()+r.slice(1)," supports only inputs with rank above 2.")});var i=e[e.length-1],o=Math.ceil(i/t);this.outputShape=e.slice(0,-1),o>1&&this.outputShape.push(o),a||this.variableNames.push("bestIndicesA");var s=this.outputShape,u=s.length,c=Wt(u),l=br("coords",u),f,h;if(o===1){h=u+1;var p=Wt(h);f=`
        `.concat(p," sourceLocR = ").concat(p,"(").concat(l.join(),`, 0);
        ++`).concat(l[u-1],`;
        `).concat(p," sourceLocG = ").concat(p,"(").concat(l.join(),`, 0);
        ++`).concat(l[u-2],`;
        `).concat(p," sourceLocA = ").concat(p,"(").concat(l.join(),`, 0);
        --`).concat(l[u-1],`;
        `).concat(p," sourceLocB = ").concat(p,"(").concat(l.join(),`, 0);
        --`).concat(l[u-2],";")}else h=u,f=`
        `.concat(c,` sourceLocR = coords;
        ++`).concat(l[u-1],`;
        `).concat(c,` sourceLocG = coords;
        ++`).concat(l[u-2],`;
        `).concat(c,` sourceLocA = coords;
        --`).concat(l[u-1],`;
        `).concat(c,` sourceLocB = coords;
        --`).concat(l[u-2],";");var d=["x","y","z","w","u","v"].slice(0,h),v="."+d[h-1],m=d.map(function(C){return"int "+C}),g=br("sourceLocR",h-1).concat("inIdx.r"),y=br("sourceLocG",h-1).concat("inIdx.g"),b=br("sourceLocB",h-1).concat("inIdx.b"),w=br("sourceLocA",h-1).concat("inIdx.a"),x=r==="max"?"greaterThan":"lessThan",N=a?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`.concat(g.join(),`),
                             getBestIndicesAChannel(`).concat(y.join(),`),
                             getBestIndicesAChannel(`).concat(b.join(),`),
                             getBestIndicesAChannel(`).concat(w.join(),")));"),T=`vec4(
            getAChannel(`.concat(g.join(),`),
            hasNextCol ? getAChannel(`).concat(y.join(),`) : 0.,
            hasNextRow ? getAChannel(`).concat(b.join(),`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`).concat(w.join(),") : 0.)"),E=a?"":`
      float getBestIndicesAChannel(`.concat(m.join(),`) {
        return getChannel(getBestIndicesA(`).concat(d.join(),`),
                                          vec2(`).concat(d.slice(-2).join(),`));
      }`);this.userCode=`
      float getAChannel(`.concat(m.join(),`) {
        return getChannel(getA(`).concat(d.join(),`),
                               vec2(`).concat(d.slice(-2).join(),`));
      }
      `).concat(E,`
      void main() {
        `).concat(c,` coords = getOutputCoords();
        bool hasNextCol = `).concat(l[u-1]," < ").concat(s[u-1]-1,`;
        bool hasNextRow = `).concat(l[u-2]," < ").concat(s[u-2]-1,`;
        `).concat(f,`
        ivec4 srcIdx = ivec4(sourceLocR`).concat(v,", sourceLocG").concat(v,`,
          sourceLocB`).concat(v,", sourceLocA").concat(v,") * ").concat(t,`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `).concat(T,`;

        for (int i = 0; i < `).concat(t,`; i++) {
          inIdx = srcIdx;
          `).concat(N,`
          vec4 candidate = `).concat(T,`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`).concat(x,`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `)}return n}();function wq(n,e,t,r){r===void 0&&(r=null);var a=e.shape[0],i=e.shape[1];r!=null&&(a=r.shape[0],i=r.shape[1]);var o=k.backend_util.computeOptimalWindowSize(i),s={windowSize:o,inSize:i,batchSize:a,outSize:Math.ceil(i/o)},u=new wqe(s,t,r==null),c=[e];r!=null&&c.push(r);var l=n.runWebGLProgram(u,c,"int32");if(l.shape[1]===1)return l;var f=wq(n,e,t,l);return n.disposeIntermediateTensorInfo(l),f}function xq(n,e,t,r){r===void 0&&(r=null);var a=r!=null?r.shape:e.shape,i=a[a.length-1],o=k.backend_util.computeOptimalWindowSize(i),s=new xqe(a,o,t,r==null),u=r==null?[e]:[e,r],c=n.runWebGLProgram(s,u,"int32");if(c.shape.length===e.shape.length){var l=xq(n,e,t,c);return n.disposeIntermediateTensorInfo(c),l}return c}function kq(n,e,t,r){var a=[t];if(k.backend_util.assertAxesAreInnerMostDims("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,e.shape.length),!k.env().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){var i=[],o=n.texData.get(e.dataId),s=o!==null&&o.isPacked,u=e;s&&(u=n.unpackTensor(e),i.push(u));var c=Te(k.backend_util.computeOutAndReduceShapes(u.shape,a),2),l=c[0],f=c[1],h=k.util.sizeFromShape(f),p=Pe({inputs:{x:u},backend:n,attrs:{shape:[-1,h]}});i.push(p);var d=wq(n,p,r);i.push(d);var v=Pe({inputs:{x:d},backend:n,attrs:{shape:l}});return i.forEach(function(m){return n.disposeIntermediateTensorInfo(m)}),v}return xq(n,e,r)}function kqe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=k.util.parseAxisParam(i,a.shape),s=k.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=wr({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=k.backend_util.getInnerMostAxes(o.length,u.shape.length)),k.backend_util.assertAxesAreInnerMostDims("argMax",[o[0]],u.shape.length);var l=kq(t,u,o[0],"max");return c.forEach(function(f){return t.disposeIntermediateTensorInfo(f)}),l}var Sqe={kernelName:k.ArgMax,backendName:"webgl",kernelFunc:kqe};function Nqe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=k.util.parseAxisParam(i,a.shape),s=k.backend_util.getAxesPermutation(o,a.shape.length),u=a,c=[];s!=null&&(u=wr({inputs:{x:a},backend:t,attrs:{perm:s}}),c.push(u),o=k.backend_util.getInnerMostAxes(o.length,u.shape.length)),k.backend_util.assertAxesAreInnerMostDims("argMin",[o[0]],u.shape.length);var l=kq(t,u,o[0],"min");return c.forEach(function(f){return t.disposeIntermediateTensorInfo(f)}),l}var Tqe={kernelName:k.ArgMin,backendName:"webgl",kernelFunc:Nqe};var Eqe=Xa+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,Iqe=Nt({opSnippet:Eqe}),Cqe={kernelName:k.Asin,backendName:"webgl",kernelFunc:Iqe};var Aqe=Xa+"return log(x + sqrt(x * x + 1.0));",_qe=Nt({opSnippet:Aqe}),Dqe={kernelName:k.Asinh,backendName:"webgl",kernelFunc:_qe};var Fqe=Xa+`
  return atan(x);
`,Rqe=Nt({opSnippet:Fqe}),Oqe={kernelName:k.Atan,backendName:"webgl",kernelFunc:Rqe};var Pqe=qx+`
  return atan(a, b);
`,Mqe=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+gh+`
  return result;
`,Bqe=or({opSnippet:Pqe,packedOpSnippet:Mqe}),Lqe={kernelName:k.Atan2,backendName:"webgl",kernelFunc:Bqe};var zqe=Xa+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,$qe=Nt({opSnippet:zqe}),qqe={kernelName:k.Atanh,backendName:"webgl",kernelFunc:$qe};var ph=function(){function n(e,t,r,a,i){if(a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x"],t==="avg"&&r)throw new Error("Cannot compute positions for average pool.");var o=e.filterWidth,s=e.strideHeight,u=e.strideWidth,c=e.dilationHeight,l=e.dilationWidth,f=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=e.padInfo.top,d=e.padInfo.left;this.outputShape=e.outShape;var v=t==="avg",m="((batch  * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + d"),g="(xR * ".concat(e.inWidth," + xC) * ").concat(e.inChannels," + d"),y="0.0";if(v||(y="-1.0 / 1e-20"),r){var b=">=";this.userCode=`
        const ivec2 strides = ivec2(`.concat(s,", ").concat(u,`);
        const ivec2 pads = ivec2(`).concat(p,", ").concat(d,`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `).concat(f,`;
              wR += `).concat(c,`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int wC = 0; wC < `).concat(h,`;
                wC += `).concat(l,`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value `).concat(b,` currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = `).concat(a?i?m:g:"wR * ".concat(h," + wC"),`;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `);return}var w="max",x="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(x="avgValue / max(count, 1.0)");var N=Math.floor(o/4)*4,T=o%4,E=`
      if (`.concat(v,`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = `).concat(w,`(values, minMaxValue);
      }
    `);this.userCode=`
      const ivec2 strides = ivec2(`.concat(s,", ").concat(u,`);
      const ivec2 pads = ivec2(`).concat(p,", ").concat(d,`);
      const float initializationValue = `).concat(y,`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `).concat(e.inWidth,`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`).concat(y,`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `).concat(f,`;
            wR += `).concat(c,`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `).concat(e.inHeight,`) {
            continue;
          }

          for (int wC = 0; wC < `).concat(N,`; wC += 4) {
            int xC = xCCorner + wC * `).concat(l,`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `).concat(l,`, d),
              getValue(batch, xR, xC + 2 * `).concat(l,`, d),
              getValue(batch, xR, xC + 3 * `).concat(l,`, d)
            );

            `).concat(E,`
          }

          int xC = xCCorner + `).concat(N,`;
          if (`).concat(T===1,`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `).concat(E,`
          } else if (`).concat(T===2,`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `).concat(l,`, d),
              initializationValue,
              initializationValue
            );

            `).concat(E,`
          } else if (`).concat(T===3,`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `).concat(l,`, d),
              getValue(batch, xR, xC + 2 * `).concat(l,`, d),
              initializationValue
            );

            `).concat(E,`
          }
        }
        setOutput(`).concat(x,`);
      }
    `)}return n}(),Vx=function(){function n(e,t,r,a,i){if(a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x"],t==="avg"&&r)throw new Error("Cannot compute positions for average pool.");var o=e.filterWidth,s=e.strideDepth,u=e.strideHeight,c=e.strideWidth,l=e.dilationDepth,f=e.dilationHeight,h=e.dilationWidth,p=e.effectiveFilterDepth,d=e.effectiveFilterHeight,v=e.effectiveFilterWidth,m=e.padInfo.front,g=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;var b=t==="avg",w="0.0";if(b||(w="-1.0 / 1e-20"),r){var x=">=";this.userCode=`
        const ivec3 strides =
            ivec3(`.concat(s,", ").concat(u,", ").concat(c,`);
        const ivec3 pads = ivec3(`).concat(m,", ").concat(g,", ").concat(y,`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `).concat(p,`;
              wD += `).concat(l,`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `).concat(e.inDepth,`) {
              continue;
            }

            for (int wR = 0; wR < `).concat(d,`;
                wR += `).concat(f,`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `).concat(e.inHeight,`) {
                continue;
              }

              for (int wC = 0; wC < `).concat(v,`;
                  wC += `).concat(h,`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value `).concat(x,` currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = `).concat(a?i?"(((batch * ".concat(e.inDepth," + xD) * ").concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"((xD * ".concat(e.inHeight," + xR) * ").concat(e.inWidth," + xC) * ").concat(e.inChannels," + ch"):"wD * ".concat(d," * ").concat(v,` +
                      wR * `).concat(v," + wC"),`;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `);return}var N="max",T="".concat(t,"(").concat(t,"(").concat(t,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(T="avgValue / max(count, 1.0)");var E=Math.floor(o/4)*4,C=o%4,F=`
      if (`.concat(b,`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = `).concat(N,`(values, minMaxValue);
      }
    `);this.userCode=`
      const ivec3 strides =
        ivec3(`.concat(s,", ").concat(u,", ").concat(c,`);
      const ivec3 pads = ivec3(`).concat(m,", ").concat(g,", ").concat(y,`);
      const float initializationValue = `).concat(w,`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `).concat(e.inWidth,`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`).concat(w,`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `).concat(p,`;
            wD += `).concat(l,`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `).concat(e.inDepth,`) {
            continue;
          }

          for (int wR = 0; wR < `).concat(d,`;
            wR += `).concat(f,`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int wC = 0; wC < `).concat(E,`; wC += 4) {
              int xC = xCCorner + wC * `).concat(h,`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `).concat(h,`, ch),
                getValue(batch, xD, xR, xC + 2 * `).concat(h,`, ch),
                getValue(batch, xD, xR, xC + 3 * `).concat(h,`, ch)
              );

              `).concat(F,`
            }

            int xC = xCCorner + `).concat(E,`;
            if (`).concat(C===1,`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `).concat(F,`
            } else if (`).concat(C===2,`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `).concat(h,`, ch),
                initializationValue,
                initializationValue
              );

              `).concat(F,`
            } else if (`).concat(C===3,`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `).concat(h,`, ch),
                getValue(batch, xD, xR, xC + 2 * `).concat(h,`, ch),
                initializationValue
              );

              `).concat(F,`
            }
          }
        }
        setOutput(`).concat(T,`);
      }
    `)}return n}();function Wqe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x;Gc(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=1;k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=k.backend_util.computePool2DInfo(a.shape,i,o,c,s,u);if(l.filterWidth===1&&l.filterHeight===1&&k.util.arraysEqual(l.inShape,l.outShape))return aa({inputs:{x:a},backend:t});var f=new ph(l,"avg",!1);return t.runWebGLProgram(f,[a],"float32")}var Vqe={kernelName:k.AvgPool,backendName:"webgl",kernelFunc:Wqe};function Gqe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat,l=[1,1,1],f=k.backend_util.computePool3DInfo(a.shape,i,o,l,s,u,c),h=new Vx(f,"avg",!1);return t.runWebGLProgram(h,[a],"float32")}var Uqe={kernelName:k.AvgPool3D,backendName:"webgl",kernelFunc:Gqe};var Hqe=function(){function n(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterHeight,r=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=u-1-e.padInfo.top,f=c-1-e.padInfo.left,h=1/(t*r);this.userCode=`
      const ivec2 pads = ivec2(`.concat(l,", ").concat(f,`);
      const float avgMultiplier = float(`).concat(h,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(u,`;
            wR += `).concat(o,`) {
          float dyR = float(dyRCorner + wR) / `).concat(a,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `).concat(c,`;
            wC+= `).concat(s,`) {
            float dyC = float(dyCCorner + wC) / `).concat(i,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `)}return n}(),Kqe=function(){function n(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.filterDepth,r=e.filterHeight,a=e.filterWidth,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=e.dilationDepth,c=e.dilationHeight,l=e.dilationWidth,f=e.effectiveFilterDepth,h=e.effectiveFilterHeight,p=e.effectiveFilterWidth,d=f-1-e.padInfo.front,v=h-1-e.padInfo.top,m=p-1-e.padInfo.left,g=1/(t*r*a);this.userCode=`
      const ivec3 pads = ivec3(`.concat(d,", ").concat(v,", ").concat(m,`);
      const float avgMultiplier = float(`).concat(g,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `).concat(f,`;
            wD += `).concat(u,`) {
          float dyD = float(dyDCorner + wD) / `).concat(i,`.0;

          if (dyD < 0.0 || dyD >= `).concat(e.outDepth,`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `).concat(h,`;
              wR += `).concat(c,`) {
            float dyR = float(dyRCorner + wR) / `).concat(o,`.0;

            if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `).concat(p,`;
                wC += `).concat(l,`) {
              float dyC = float(dyCCorner + wC) / `).concat(s,`.0;

              if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}();function jqe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.input,o=i,s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,f=[1,1,1],h=k.backend_util.computePool3DInfo(o.shape,s,u,f,c,l),p=new Kqe(h);return t.runWebGLProgram(p,[a],o.dtype)}var Xqe={kernelName:k.AvgPool3DGrad,backendName:"webgl",kernelFunc:jqe};function Yqe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.input,o=i;Gc([a,i],"avgPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=k.backend_util.computePool2DInfo(o.shape,s,u,1,c),f=new Hqe(l);return t.runWebGLProgram(f,[a],o.dtype)}var Zqe={kernelName:k.AvgPoolGrad,backendName:"webgl",kernelFunc:Yqe};function Jqe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.a,i=e.b,o=r.transposeA,s=r.transposeB;return im({a,b:i,transposeA:o,transposeB:s,backend:t})}var Qqe={kernelName:k.BatchMatMul,backendName:"webgl",kernelFunc:Jqe};var eWe=function(){function n(e,t,r,a,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],k.backend_util.assertAndGetBroadcastShape(e,t),k.backend_util.assertAndGetBroadcastShape(e,r);var s="0.0";a!=null&&(k.backend_util.assertAndGetBroadcastShape(e,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";i!=null&&(k.backend_util.assertAndGetBroadcastShape(e,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `.concat(s,`;
        float scale = `).concat(u,`;
        float inv = scale * inversesqrt(variance + float(`).concat(o,`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `)}return n}();var tWe=function(){function n(e,t,r,a,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],k.backend_util.assertAndGetBroadcastShape(e,t),k.backend_util.assertAndGetBroadcastShape(e,r);var s="vec4(0.0)";a!=null&&(k.backend_util.assertAndGetBroadcastShape(e,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";i!=null&&(k.backend_util.assertAndGetBroadcastShape(e,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = `.concat(s,`;
        vec4 scale = `).concat(u,`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`).concat(o,`));

        setOutput((x - mean) * inv + offset);
      }
    `)}return n}();var nWe=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.mean,o=e.variance,s=e.offset,u=e.scale;k.util.assert(i.shape.length===o.shape.length,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),k.util.assert(s==null||i.shape.length===s.shape.length,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),k.util.assert(u==null||i.shape.length===u.shape.length,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."});var c=r.varianceEpsilon;c==null&&(c=.001);var l=[a,i,o],f=null;s!=null&&(f=s.shape,l.push(s));var h=null;u!=null&&(h=u.shape,l.push(u));var p=k.env().getBool("WEBGL_PACK_NORMALIZATION")?new tWe(a.shape,i.shape,o.shape,f,h,c):new eWe(a.shape,i.shape,o.shape,f,h,c),d=t.runWebGLProgram(p,l,l[0].dtype);return d},rWe={kernelName:k.FusedBatchNorm,backendName:"webgl",kernelFunc:nWe};var aWe=function(){function n(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t=Wt(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var r=iWe(this.rank),a,i=e.map(function(o,s){return"sourceLoc.".concat(Ex[s]," = start[").concat(s,"] + coords.").concat(Ex[s],";")});a=`
        `.concat(t,` sourceLoc;
        `).concat(t,` coords = getOutputCoords();
        `).concat(i.join(`
`),`
      `),this.userCode=`
      void main() {
        `.concat(a,`
        setOutput(getSource(`).concat(r,`));
      }
    `)}return n}(),Ex=["x","y","z","w","u","v"];function iWe(n){if(n===1)return"sourceLoc";if(n<=6)return Ex.slice(0,n).map(function(e){return"sourceLoc."+e}).join(",");throw Error("Slicing for rank ".concat(n," is not yet supported"))}var oWe=function(){function n(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var t=Wt(this.rank),r=br("coords",this.rank),a=br("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s=`
      result.x = `.concat(o,`;
      if (++`).concat(r[this.rank-1]," < ").concat(e[this.rank-1],`) {
        ++`).concat(a[this.rank-1],`;
        result.y = `).concat(o,`;
        --`).concat(a[this.rank-1],`;
      }
    `),u=this.rank===1?"":`
      --`.concat(r[this.rank-1],`;
      if (++`).concat(r[this.rank-2]," < ").concat(e[this.rank-2],`) {
        ++`).concat(a[this.rank-2],`;
        result.z = `).concat(o,`;
        if (++`).concat(r[this.rank-1]," < ").concat(e[this.rank-1],`) {
          ++`).concat(a[this.rank-1],`;
          result.w = `).concat(o,`;
        }
      }
    `),c=this.rank<=4?`sourceLoc = coords +
            `.concat(t,"(").concat(e.map(function(l,f){return"start[".concat(f,"]")}).join(),");"):e.map(function(l,f){return"".concat(a[f]," = ").concat(r[f]," + start[").concat(f,"];")}).join(`
`);this.userCode=`
      void main() {
        `.concat(t,` coords = getOutputCoords();
        `).concat(t,` sourceLoc;
        `).concat(c,`
        vec4 result = vec4(0.);
        `).concat(s,`
        `).concat(u,`
        setOutput(result);
      }
    `)}return n}();function sWe(n,e,t,r){var a=r.texData.get(n.dataId),i=r.makeTensorInfo(t,n.dtype),o=r.texData.get(i.dataId);Object.assign(o,a),o.refCount=1,o.shape=t,o.dtype=n.dtype;var s=k.slice_util.computeFlatOffset(e,k.util.computeStrides(n.shape));a.slice&&(s+=a.slice.flatOffset),o.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||n.dataId};var u=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,u+1),i}function Yc(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.begin,o=r.size,s=Te(k.slice_util.parseSliceParams(a,i,o),2),u=s[0],c=s[1];if(k.slice_util.assertParamsValid(a,u,c),k.util.sizeFromShape(c)===0)return t.makeTensorInfo(c,a.dtype,[]);if(t.shouldExecuteOnCPU([a])||a.dtype==="string"){var l=t.texData.get(a.dataId),f=Jze(l.values,u,c,a.shape,a.dtype);return t.makeTensorInfo(c,a.dtype,f)}var h=t.texData.get(a.dataId).isPacked,p=k.slice_util.isSliceContinous(a.shape,u,c);if(h||!p){var d=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new oWe(c):new aWe(c),v=[u];return t.runWebGLProgram(d,[a],a.dtype,v)}return t.uploadToGPU(a.dataId),sWe(a,u,c,t)}var uWe={kernelName:k.Slice,backendName:"webgl",kernelFunc:Yc};var cWe=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.blockShape,o=r.crops;k.util.assert(a.shape.length<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var s=i.reduce(function(y,b){return y*b}),u=k.backend_util.getReshaped(a.shape,i,s),c=k.backend_util.getPermuted(u.length,i.length),l=k.backend_util.getReshapedPermuted(a.shape,i,s),f=k.backend_util.getSliceBeginCoords(o,i.length),h=k.backend_util.getSliceSize(l,o,i.length),p=[],d=Pe({inputs:{x:a},backend:t,attrs:{shape:u}}),v=wr({inputs:{x:d},backend:t,attrs:{perm:c}}),m=Pe({inputs:{x:v},backend:t,attrs:{shape:l}}),g=Yc({inputs:{x:m},backend:t,attrs:{begin:f,size:h}});return p.push(d),p.push(v),p.push(m),p.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),g},lWe={kernelName:k.BatchToSpaceND,backendName:"webgl",kernelFunc:cWe};function fWe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.weights,o=r.size,s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=uq(s,u,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,c)}var hWe={kernelName:k.Bincount,backendName:"webgl",kernelFunc:fWe};function pWe(n){var e=n.inputs,t=n.backend,r=e.s0,a=e.s1,i=t.readSync(r.dataId),o=t.readSync(a.dataId),s=k.backend_util.assertAndGetBroadcastShape(Array.from(i),Array.from(o));return t.makeTensorInfo([s.length],"int32",Int32Array.from(s))}var dWe={kernelName:k.BroadcastArgs,backendName:"webgl",kernelFunc:pWe};var vWe="return float(a != b);",Sq=or({opSnippet:vWe,cpuKernelImpl:Vze,dtype:"bool"}),mWe={kernelName:k.NotEqual,backendName:"webgl",kernelFunc:Sq};function bh(n){var e=n.inputs,t=n.backend,r=e.input,a=t.texData.get(r.dataId);return aa({inputs:{x:a.complexTensorInfos.real},backend:t})}var gWe={kernelName:k.Real,backendName:"webgl",kernelFunc:bh};var yWe="return float(int(x));";function bWe(n,e){var t=new Bi(n.shape,yWe),r=e.runWebGLProgram(t,[n],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}function Ix(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.dtype;if(i==="complex64"){if(a.dtype==="complex64")return aa({inputs:{x:a},backend:t});var o=uBe.zeros(a.shape),s=Ix({inputs:{x:a},backend:t,attrs:{dtype:"float32"}}),u=ts({inputs:{real:s,imag:o},backend:t});return o.dispose(),t.disposeIntermediateTensorInfo(s),u}if(a.dtype==="complex64"){var c=bh({inputs:{input:a},backend:t}),u=Ix({inputs:{x:c},backend:t,attrs:{dtype:i}});return t.disposeIntermediateTensorInfo(c),u}if(!k.util.hasEncodingLoss(a.dtype,i)){var u=aa({inputs:{x:a},backend:t});return{dataId:u.dataId,shape:u.shape,dtype:i}}if(t.shouldExecuteOnCPU([a])){var l=t.texData.get(a.dataId).values,f=Te(Sze(l,a.shape,a.dtype,i),3),h=f[0],p=f[1],d=f[2];return t.makeTensorInfo(h,p,d)}if(i==="int32")return bWe(a,t);if(i==="bool"){var v=t.makeTensorInfo([],"bool",k.util.getTypedArrayFromDType("bool",1)),m={a,b:v},u=Sq({inputs:m,backend:t});return t.disposeIntermediateTensorInfo(v),u}throw new Error("Error in Cast: failed to cast ".concat(a.dtype," to ").concat(i))}var wWe={kernelName:k.Cast,backendName:"webgl",kernelFunc:Ix};var e$="return ceil(x);",xWe=Nt({opSnippet:e$,packedOpSnippet:e$,cpuKernelImpl:Nze}),kWe={kernelName:k.Ceil,backendName:"webgl",kernelFunc:xWe};var SWe=function(){function n(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return n}();var NWe=function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return n}();function TWe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.clipValueMin,o=r.clipValueMax,s;k.env().getBool("WEBGL_PACK_CLIP")?s=new NWe(a.shape):s=new SWe(a.shape);var u=[[i],[o]];return t.runWebGLProgram(s,[a],a.dtype,u)}var EWe={kernelName:k.ClipByValue,backendName:"webgl",kernelFunc:TWe};var IWe=function(){function n(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}return n}();function t$(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function CWe(n){var e=n.inputs,t=n.backend,r=e.x,a=t.texData.get(r.dataId),i=new IWe(r.shape),o=[t$(r,a.complexTensorInfos.real),t$(r,a.complexTensorInfos.imag)];return t.runWebGLProgram(i,o,o[0].dtype)}var AWe={kernelName:k.ComplexAbs,backendName:"webgl",kernelFunc:CWe};var _We=function(){function n(e){this.outputShape=[],this.outputShape=k.backend_util.computeOutShape(e,1),this.variableNames=e.map(function(u,c){return"T".concat(c)});var t=new Array(e.length-1);t[0]=e[0][1];for(var r=1;r<t.length;r++)t[r]=t[r-1]+e[r][1];for(var a=["if (yC < ".concat(t[0],") setOutput(getT0(yR, yC));")],r=1;r<t.length;r++){var i=t[r-1];a.push("else if (yC < ".concat(t[r],") ")+"setOutput(getT".concat(r,"(yR, yC-").concat(i,"));"))}var o=t.length,s=t[t.length-1];a.push("else setOutput(getT".concat(o,"(yR, yC-").concat(s,"));")),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `.concat(a.join(`
        `),`
      }
    `)}return n}();var DWe=function(){function n(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=k.backend_util.computeOutShape(e,t);var r=this.outputShape,a=r.length,i=Wt(a),o=br("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=e.map(function(g,y){return"T".concat(y)});var u=new Array(e.length-1);u[0]=e[0][t];for(var c=1;c<u.length;c++)u[c]=u[c-1]+e[c][t];for(var l=s[t],f=s.slice(-2),h=s.join(),p="if (".concat(l," < ").concat(u[0],`) {
        return getChannel(
            getT0(`).concat(h,"), vec2(").concat(f.join(),`));
        }`),c=1;c<u.length;c++){var d=u[c-1];p+=`
        if (`.concat(l," < ").concat(u[c],"  && ").concat(l," >= ").concat(u[c-1],`) {
          return getChannel(
            getT`).concat(c,"(").concat(Jv(s,l,d),`),
            vec2(`).concat(Jv(f,l,d),`));
        }`)}var v=u.length,m=u[u.length-1];p+=`
        return getChannel(
          getT`.concat(v,"(").concat(Jv(s,l,m),`),
          vec2(`).concat(Jv(f,l,m),"));"),this.userCode=`
      float getValue(`.concat(s.map(function(g){return"int "+g}),`) {
        `).concat(p,`
      }

      void main() {
        `).concat(i,` coords = getOutputCoords();
        vec4 result = vec4(getValue(`).concat(o,`), 0., 0., 0.);

        `).concat(o[a-1]," = ").concat(o[a-1],` + 1;
        if (`).concat(o[a-1]," < ").concat(r[a-1],`) {
          result.g = getValue(`).concat(o,`);
        }

        `).concat(o[a-2]," = ").concat(o[a-2],` + 1;
        if (`).concat(o[a-2]," < ").concat(r[a-2],`) {
          result.a = getValue(`).concat(o,`);
        }

        `).concat(o[a-1]," = ").concat(o[a-1],` - 1;
        if (`).concat(o[a-2]," < ").concat(r[a-2],` &&
            `).concat(o[a-1]," < ").concat(r[a-1],`) {
          result.b = getValue(`).concat(o,`);
        }
        setOutput(result);
      }
    `)}return n}();function Jv(n,e,t){var r=n.indexOf(e),a=n.map(function(i,o){return o===r?"".concat(i," - ").concat(t):i});return a.join()}function fm(n){var e=n.inputs,t=n.backend,r=e.input,a=t.texData.get(r.dataId);return aa({inputs:{x:a.complexTensorInfos.imag},backend:t})}var FWe={kernelName:k.Imag,backendName:"webgl",kernelFunc:fm};function ch(n,e,t){var r,a,i=n[0].dtype;if(i==="complex64"){var o=n.map(function(V){return bh({inputs:{input:V},backend:t})}),s=n.map(function(V){return fm({inputs:{input:V},backend:t})}),u=ch(o,e,t),c=ch(s,e,t),l=ts({inputs:{real:u,imag:c},backend:t});return o.forEach(function(V){return t.disposeIntermediateTensorInfo(V)}),s.forEach(function(V){return t.disposeIntermediateTensorInfo(V)}),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(c),l}var f=t.shouldExecuteOnCPU(n);if(i==="string"&&(f=!0),f){var h=n.map(function(V){var j=k.util.sizeFromShape(V.shape.slice(e)),re=[-1,j];return Pe({inputs:{x:V},backend:t,attrs:{shape:re}})}),p=h.map(function(V){return{vals:t.readSync(V.dataId),shape:V.shape}}),d=k.backend_util.computeOutShape(h.map(function(V){return V.shape}),1),v=h[0].shape[0]===1,m=Tze(p,d,i,v),g=k.backend_util.computeOutShape(n.map(function(V){return V.shape}),e),y=t.makeTensorInfo(g,i,m);return h.forEach(function(V){return t.disposeIntermediateTensorInfo(V)}),y}var b=n.filter(function(V){return k.util.sizeFromShape(V.shape)>0}),w=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&b[0].shape.length>1;if(b.length===1){var x=w?new Bi(n[0].shape,Jo):new Qo(n[0].shape,Jo);return t.runWebGLProgram(x,n,i)}var N=k.env().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(b.length>N){for(var T=[],E=0;E<b.length;E+=N){var C=b.slice(E,E+N);T.push(ch(C,e,t))}var F=ch(T,e,t);try{for(var D=ra(T),O=D.next();!O.done;O=D.next()){var E=O.value;t.disposeIntermediateTensorInfo(E)}}catch(V){r={error:V}}finally{try{O&&!O.done&&(a=D.return)&&a.call(D)}finally{if(r)throw r.error}}return F}if(w){var L=new DWe(b.map(function(V){return V.shape}),e);return t.runWebGLProgram(L,b,i)}var z=RWe(b,e,t),$=z.tensors2D,B=z.outShape,W=new _We($.map(function(V){return V.shape})),X=t.runWebGLProgram(W,$,i);$.forEach(function(V){return t.disposeIntermediateTensorInfo(V)});var Y=Pe({inputs:{x:X},attrs:{shape:B},backend:t});return t.disposeIntermediateTensorInfo(X),Y}function RWe(n,e,t){var r=k.backend_util.computeOutShape(n.map(function(i){return i.shape}),e),a=n.map(function(i){return Pe({inputs:{x:i},attrs:{shape:[-1,k.util.sizeFromShape(i.shape.slice(e))]},backend:t})});return{tensors2D:a,outShape:r}}function Nq(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.axis,i=k.util.parseAxisParam(a,e[0].shape)[0],o=e.map(function(c){return c.shape});k.backend_util.assertParamsConsistent(o,i);var s=k.backend_util.computeOutShape(e.map(function(c){return c.shape}),i);if(k.util.sizeFromShape(s)===0)return t.makeTensorInfo(s,e[0].dtype,[]);var u=e.filter(function(c){return k.util.sizeFromShape(c.shape)>0});return u.length===1?aa({inputs:{x:u[0]},backend:t}):ch(u,i,t)}var OWe={kernelName:k.Concat,backendName:"webgl",kernelFunc:Nq};var Tq=function(){function n(e,t,r,a,i){t===void 0&&(t=!1),r===void 0&&(r=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var o=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,f=e.dilationWidth,h=e.filterHeight,p=e.filterWidth,d=Math.floor(e.inChannels/4)*4,v=e.inChannels%4,m=e.dataFormat==="channelsLast",g=m?1:2,y=m?2:3,b=m?3:1,w="",x="";r&&(a?w=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `.concat(r,`
        }`):i?w=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          `.concat(r,`
        }`):w=`
          float activation(float x) {
            `.concat(r,`
          }
        `),x="result = activation(result);");var N=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `.concat(w,`

      const ivec2 strides = ivec2(`).concat(u,", ").concat(c,`);
      const ivec2 pads = ivec2(`).concat(o,", ").concat(s,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`).concat(b,`];

        ivec2 xRCCorner =
            ivec2(coords[`).concat(g,"], coords[").concat(y,`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(h,`; wR++) {
          int xR = xRCorner + wR * `).concat(l,`;

          if (xR < 0 || xR >= `).concat(e.inHeight,`) {
            continue;
          }

          for (int wC = 0; wC < `).concat(p,`; wC++) {
            int xC = xCCorner + wC * `).concat(f,`;

            if (xC < 0 || xC >= `).concat(e.inWidth,`) {
              continue;
            }

            for (int d1 = 0; d1 < `).concat(d,`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`).concat(m,`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`).concat(v===1,`) {

              if (`).concat(m,`) {
                dotProd +=
                    getX(batch, xR, xC, `).concat(d,`) *
                    getW(wR, wC, `).concat(d,`, d2);
              } else {
                dotProd +=
                    getX(batch, `).concat(d,`, xR, xC) *
                    getW(wR, wC, `).concat(d,`, d2);
              }

            } else if (`).concat(v===2,`) {
              vec2 wValues = vec2(
                getW(wR, wC, `).concat(d,`, d2),
                getW(wR, wC, `).concat(d,` + 1, d2)
              );

              if (`).concat(m,`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `).concat(d,`),
                  getX(batch, xR, xC, `).concat(d,` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `).concat(d,`, xR, xC),
                  getX(batch, `).concat(d,` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`).concat(v===3,`) {
              vec3 wValues = vec3(
                getW(wR, wC, `).concat(d,`, d2),
                getW(wR, wC, `).concat(d,` + 1, d2),
                getW(wR, wC, `).concat(d,` + 2, d2)
              );

              if (`).concat(m,`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `).concat(d,`),
                  getX(batch, xR, xC, `).concat(d,` + 1),
                  getX(batch, xR, xC, `).concat(d,` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `).concat(d,`, xR, xC),
                  getX(batch, `).concat(d,` + 1, xR, xC),
                  getX(batch, `).concat(d,` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `).concat(N,`
        `).concat(x,`
        setOutput(result);
      }
    `)}return n}(),PWe=function(){function n(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,r=e.padInfo.top,a=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=e.dilationDepth,c=e.dilationHeight,l=e.dilationWidth,f=e.filterDepth,h=e.filterHeight,p=e.filterWidth,d=Math.floor(e.inChannels/4)*4,v=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`.concat(i,", ").concat(o,", ").concat(s,`);
      const ivec3 pads = ivec3(`).concat(t,", ").concat(r,", ").concat(a,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `).concat(f,`; wF++) {
          int xF = xFCorner + wF * `).concat(u,`;

          if (xF < 0 || xF >= `).concat(e.inDepth,`) {
            continue;
          }

          for (int wR = 0; wR < `).concat(h,`; wR++) {
            int xR = xRCorner + wR * `).concat(c,`;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int wC = 0; wC < `).concat(p,`; wC++) {
              int xC = xCCorner + wC * `).concat(l,`;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              for (int d1 = 0; d1 < `).concat(d,`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`).concat(v===1,`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `).concat(d,`) *
                  getW(wF, wR, wC, `).concat(d,`, d2);
              } else if (`).concat(v===2,`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `).concat(d,`),
                  getX(batch, xF, xR, xC, `).concat(d,` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `).concat(d,`, d2),
                  getW(wF, wR, wC, `).concat(d,` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`).concat(v===3,`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `).concat(d,`),
                  getX(batch, xF, xR, xC, `).concat(d,` + 1),
                  getX(batch, xF, xR, xC, `).concat(d,` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `).concat(d,`, d2),
                  getW(wF, wR, wC, `).concat(d,` + 1, d2),
                  getW(wF, wR, wC, `).concat(d,` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}();var Eq=function(){function n(e,t,r,a,i){t===void 0&&(t=!1),r===void 0&&(r=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=kr(this.outputShape.length);for(var o=e.padInfo.left,s=e.strideWidth,u=e.dilationWidth,c=e.filterHeight,l=e.filterWidth,f=l,h=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`,p=0;p<l;p++)h+=`
           vec4 xTexelC`.concat(p*2,`;
           int xTexelC`).concat(p*2,`Ready;
           vec4 xTexelC`).concat(p*2+1,`;
           int xTexelC`).concat(p*2+1,`Ready;
           vec4 xC`).concat(p,";");h+=`
     for (int r = 0; r < `.concat(c,`; r++) {
      for (int d1 = 0; d1 < `).concat(e.inChannels,`; d1 += 2) {
       `);for(var p=0;p<l;p++)h+=`
           xTexelC`.concat(p*2,` = vec4(0.0);
           xTexelC`).concat(p*2,`Ready = 0;
           xTexelC`).concat(p*2+1,` = vec4(0.0);
           xTexelC`).concat(p*2+1,`Ready = 0;
           xC`).concat(p," = vec4(0.0);");h+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(var d=0;d<(f+1)/2;d++){var v=d*2;if(h+=`
           xC = xCCorner + `.concat(v*u,`;
           `),s===1){if(v<l&&(o%2===1?(h+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                   xTexelC`).concat(v,` = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`).concat(v,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(v,`Ready = 1;
                 }
               `),u===1&&v>0?h+=`
                 xC`.concat(v," = vec4(xTexelC").concat(v-2,".zw, xTexelC").concat(v,`.xy);
                 `):h+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC`.concat(v," = vec4(previous.zw, xTexelC").concat(v,`.xy);
                   } else {
                     xC`).concat(v," = vec4(0.0, 0.0, xTexelC").concat(v,`.xy);
                   }
                   `)):h+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                   xTexelC`).concat(v,` = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC`).concat(v,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(v,`Ready = 1;
                 }

                 xC`).concat(v," = xTexelC").concat(v,`;
                 `),v+1<l)){var m=o%2===0?k.util.nearestLargerEven(u):u;u%2===0&&o%2===1||u%2!==0&&o%2!==1?(h+=`
                   xCOffset = xC + imod(pads[1], 2) + `.concat(m,`;

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                     xTexelC`).concat(v+1,` = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC`).concat(v+1,`.zw = vec2(0.0);
                     }
                     xTexelC`).concat(v+1,`Ready = 1;
                   }
                   `),u>1?h+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC`.concat(v+1," = vec4(previous.zw, xTexelC").concat(v+1,`.xy);
                     } else {
                      xC`).concat(v+1," = vec4(0.0, 0.0, xTexelC").concat(v+1,`.xy);
                     }
                     `):h+=`
                     xC`.concat(v+1," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,`.xy);
                     `)):m===1?h+=`
                     xC`.concat(v+1," = xTexelC").concat(v,`;
                     `):h+=`
                     xCOffset = xC + `.concat(m,`;

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                       xTexelC`).concat(v+1,` = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC`).concat(v+1,`.zw = vec2(0.0);
                       }
                       xTexelC`).concat(v+1,`Ready = 1;
                     }

                     xC`).concat(v+1," = xTexelC").concat(v+1,`;
                     `)}}else v<l&&(o%2===1?(h+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                   xTexelC`).concat(v,` = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`).concat(v,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(v,`Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                   xTexelC`).concat(v+1,` = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC`).concat(v+1,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(v+1,`Ready = 1;
                 }

                 xC`).concat(v," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,`.zw);
               `),v+1<l&&(h+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC`.concat(v+1," = vec4(xTexelC").concat(v+1,`.xy, final.xy);
                 `))):(h+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC`.concat(v,`Ready == 0) {
                   xTexelC`).concat(v,` = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC`).concat(v,`.zw = vec2(0.0);
                   }
                   xTexelC`).concat(v,`Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(v+1,`Ready == 0) {
                   xTexelC`).concat(v+1,` = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC`).concat(v+1,`.zw = vec2(0.);
                   }
                   xTexelC`).concat(v+1,`Ready = 1;
                 }

                 xC`).concat(v,` = vec4(
                   xTexelC`).concat(v,".xy, xTexelC").concat(v+1,`.xy);
               `),v+1<l&&(h+=`
                   xC`.concat(v+1," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,`.zw);
                 `))));v<l&&(h+=`
             wTexel = getW(r, `.concat(v,`, d1, d2);
             dotProd += xC`).concat(v,`.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < `).concat(e.inChannels,`) {
               dotProd += xC`).concat(v,`.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `),v+1<l&&(h+=`
               wTexel = getW(r, `.concat(v+1,`, d1, d2);
               dotProd += xC`).concat(v+1,`.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < `).concat(e.inChannels,`) {
                 dotProd += xC`).concat(v+1,`.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `)))}h+=`
     }
   `,h+=`
     }
   `,h+=`
     }
   `;var g="",y="";r&&(a?g=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           `.concat(r,`
         }`):i?g=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           `.concat(r,`
         }`):g=`vec4 activation(vec4 x) {
           `.concat(r,`
         }`),y="result = activation(result);");var b=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       `.concat(g,`

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         `).concat(h,`

         vec4 result = dotProd - vec4(0.000000000000001);
         `).concat(b,`
         `).concat(y,`
         setOutput(result);
       }
     `)}return n}();var MWe=function(){function n(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=kr(this.outputShape.length);for(var r=t.dataFormat,a=xr(),i=r==="channelsLast",o=i?1:2,s=i?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < ".concat(e[2]," && pos < ").concat(e[1],") {"),c="",l=0;l<=1;l++)for(var f=0;f<=1;f++)c+=`
          blockIndex = rc.z + `.concat(f,`;
          pos = rc.y + `).concat(l,`;

          `).concat(u,`
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[`).concat(o,`] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[`).concat(s,`] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (`).concat(i,`) {
                  innerDims = vec2(d1, ch);
                  result[`).concat(l*2+f,`] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`).concat(l*2+f,`] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `);this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `.concat(c,`

        `).concat(a.output,` = result;
      }
    `)}return n}();function om(n,e){var t=n.length;return t>=3?e?pn(pn([],Te(n.slice(0,-3)),!1),[n[t-3]*n[t-2],n[t-1]],!1):pn(pn([],Te(n.slice(0,-3)),!1),[n[t-3],n[t-2]*n[t-1]],!1):!e&&t===1&&n[0]>1?[n[0],1]:null}function Iq(n){var e,t,r=n.x,a=n.filter,i=n.convInfo,o=n.backend,s=n.bias,u=s===void 0?null:s,c=n.preluActivationWeights,l=c===void 0?null:c,f=n.leakyreluAlpha,h=f===void 0?0:f,p=n.activation,d=p===void 0?null:p,v=r.shape,m=o.texData.get(r.dataId),g=i.inChannels,y=v[0]*v[1]*v[2],b=i.outChannels,w=i.dataFormat==="channelsLast",x=!1,N=!1,T,E=[];if(l!=null){var C=om(l.shape,w);C!=null&&(l=Pe({inputs:{x:l},backend:o,attrs:{shape:C}}),E.push(l))}if(u!=null){var C=om(u.shape,w);C!=null&&(u=Pe({inputs:{x:u},backend:o,attrs:{shape:C}}),E.push(u))}var F=(y===1||b===1)&&g>bq,D=!F&&m.isPacked&&w&&m.texture!=null&&v[2]%2!==0&&k.util.arraysEqual(m.shape.slice(-3),v.slice(-3));if(D){var C=v[0]*v[1]*(v[2]+1),O={dataId:r.dataId,shape:[1,C,i.inChannels],dtype:r.dtype},L=m.shape;m.shape=m.shape.slice(),m.shape[m.shape.length-2]++,k.util.assert(fh(m.shape,O.shape),function(){return"packed reshape ".concat(m.shape," to ").concat(O.shape," isn't free")});var z=Pe({inputs:{x:a},backend:o,attrs:{shape:[1,i.inChannels,i.outChannels]}});E.push(z);var $=im({a:O,b:z,backend:o,transposeA:x,transposeB:N,bias:u,activation:d,preluActivationWeights:l,leakyreluAlpha:h}),B=o.texData.get($.dataId);k.util.assert(B.isPacked,function(){return"batchMatMul result is expected to be packed"}),m.shape=L,B.shape=i.outShape,T=aa({inputs:{x:$},backend:o}),T.shape=i.outShape,E.push($)}else{var W=i.outHeight*i.outWidth,X=Pe({inputs:{x:r},backend:o,attrs:{shape:w?[i.batchSize,W,i.inChannels]:[i.batchSize,i.inChannels,W]}}),z=Pe({inputs:{x:a},backend:o,attrs:{shape:[1,i.inChannels,i.outChannels]}}),Y=im({a:w?X:z,b:w?z:X,transposeA:!w,transposeB:N,backend:o,bias:u,activation:d,preluActivationWeights:l,leakyreluAlpha:h});T=Pe({inputs:{x:Y},backend:o,attrs:{shape:i.outShape}}),E.push(X),E.push(z),E.push(Y)}try{for(var V=ra(E),j=V.next();!j.done;j=V.next()){var re=j.value;o.disposeIntermediateTensorInfo(re)}}catch(ne){e={error:ne}}finally{try{j&&!j.done&&(t=V.return)&&t.call(V)}finally{if(e)throw e.error}}return T}function Cq(n){var e,t,r=n.x,a=n.filter,i=n.convInfo,o=n.backend,s=n.bias,u=s===void 0?null:s,c=n.preluActivationWeights,l=c===void 0?null:c,f=n.leakyreluAlpha,h=f===void 0?0:f,p=n.activation,d=p===void 0?null:p,v=i.filterWidth,m=i.filterHeight,g=i.inChannels,y=i.outWidth,b=i.outHeight,w=i.dataFormat,x=w==="channelsLast",N=v*m*g,T=b*y,E=[i.batchSize,N,T],C=!0,F=!1,D=[];if(l!=null){var O=om(l.shape,x);O!=null&&(l=Pe({inputs:{x:l},backend:o,attrs:{shape:O}}),D.push(l))}if(u!=null){var O=om(u.shape,x);O!=null&&(u=Pe({inputs:{x:u},backend:o,attrs:{shape:O}}),D.push(u))}var L=Pe({inputs:{x:a},backend:o,attrs:{shape:[1,N,k.util.sizeFromShape(a.shape)/N]}});D.push(L);var z=new MWe(E,i),$=[r.shape,[i.padInfo.top,i.padInfo.left],[i.strideHeight,i.strideWidth],[i.dilationHeight,i.dilationWidth],[i.inChannels],[i.filterWidth*i.inChannels],[i.outWidth]],B=o.runWebGLProgram(z,[r],"float32",$),W=Pe({inputs:{x:B},backend:o,attrs:{shape:E}});D.push(B),D.push(W);var X=u!=null,Y=l!=null,V=d==="leakyrelu",j=d?hh(d,!0):null,re=new yq(x?W.shape:L.shape,x?L.shape:W.shape,x?[i.batchSize,T,i.outChannels]:[i.batchSize,i.outChannels,T],C,F,X,j,Y,V),ne=x?[W,L]:[L,W];if(u&&ne.push(u),Y&&ne.push(l),V){var oe=o.makeTensorInfo([],"float32",k.util.createScalarValue(h,"float32"));ne.push(oe),D.push(oe)}var le=o.runWebGLProgram(re,ne,"float32"),de=Pe({inputs:{x:le},backend:o,attrs:{shape:i.outShape}});D.push(le);try{for(var xe=ra(D),he=xe.next();!he.done;he=xe.next()){var ye=he.value;o.disposeIntermediateTensorInfo(ye)}}catch(we){e={error:we}}finally{try{he&&!he.done&&(t=xe.return)&&t.call(xe)}finally{if(e)throw e.error}}return de}function BWe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dilations,l=r.dimRoundingMode,f=k.backend_util.convertConv2DDataFormat(u),h=k.backend_util.computeConv2DInfo(a.shape,i.shape,o,c,s,l,!1,f),p;if(h.filterHeight===1&&h.filterWidth===1&&h.dilationHeight===1&&h.dilationWidth===1&&h.strideHeight===1&&h.strideWidth===1&&(h.padInfo.type==="SAME"||h.padInfo.type==="VALID"))p=Iq({x:a,filter:i,convInfo:h,backend:t});else if(h.strideWidth<=2&&f==="channelsLast"&&k.env().getBool("WEBGL_EXP_CONV")){var d=new Eq(h),v=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];p=t.runWebGLProgram(d,[a,i],"float32",v)}else if(k.env().getBool("WEBGL_CONV_IM2COL"))p=Cq({x:a,filter:i,convInfo:h,backend:t});else{var d=new Tq(h);p=t.runWebGLProgram(d,[a,i],"float32")}var m=Pe({inputs:{x:p},backend:t,attrs:{shape:h.outShape}});return t.disposeIntermediateTensorInfo(p),m}var LWe={kernelName:k.Conv2D,backendName:"webgl",kernelFunc:BWe};var zWe=function(){function n(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,r=e.strideWidth,a=e.padInfo.top,i=e.padInfo.left,o=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `.concat(e.batchSize,`; b++) {
          for (int yR = 0; yR < `).concat(e.outHeight,`; yR++) {
            int xR = wR + yR * `).concat(t," - ").concat(a,`;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int yC = 0; yC < `).concat(e.outWidth,`; yC++) {
              int xC = wC + yC * `).concat(r," - ").concat(i,`;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              if (`).concat(o,`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}(),$We=function(){function n(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,r=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=e.dataFormat==="channelsLast",s=t-1-e.padInfo.top,u=r-1-e.padInfo.left,c=o?1:2,l=o?2:3,f=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(`.concat(s,", ").concat(u,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`).concat(f,`];

        ivec2 dyCorner = ivec2(coords[`).concat(c,"], coords[").concat(l,`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(t,`; wR++) {
          float dyR = float(dyRCorner + wR) / `).concat(a,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `).concat(t,` - 1 - wR;

          for (int wC = 0; wC < `).concat(r,`; wC++) {
            float dyC = float(dyCCorner + wC) / `).concat(i,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `).concat(r,` - 1 - wC;

            for (int d2 = 0; d2 < `).concat(e.outChannels,`; d2++) {

              if (`).concat(o,`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}(),qWe=function(){function n(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideDepth,r=e.strideHeight,a=e.strideWidth,i=e.padInfo.front,o=e.padInfo.top,s=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `.concat(e.batchSize,`; b++) {
          for (int yF = 0; yF < `).concat(e.outDepth,`; yF++) {
            int xF = wF + yF * `).concat(t," - ").concat(i,`;

            if (xF < 0 || xF >= `).concat(e.inDepth,`) {
              continue;
            }

            for (int yR = 0; yR < `).concat(e.outHeight,`; yR++) {
              int xR = wR + yR * `).concat(r," - ").concat(o,`;

              if (xR < 0 || xR >= `).concat(e.inHeight,`) {
                continue;
              }

              for (int yC = 0; yC < `).concat(e.outWidth,`; yC++) {
                int xC = wC + yC * `).concat(a," - ").concat(s,`;

                if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}(),WWe=function(){function n(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,r=e.filterHeight,a=e.filterWidth,i=e.strideDepth,o=e.strideHeight,s=e.strideWidth,u=t-1-e.padInfo.front,c=r-1-e.padInfo.top,l=a-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`.concat(u,", ").concat(c,", ").concat(l,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `).concat(t,`; wF++) {
          float dyF = float(dyFCorner + wF) / `).concat(i,`.0;

          if (dyF < 0.0 || dyF >= `).concat(e.outDepth,`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `).concat(t,` - 1 - wF;

          for (int wR = 0; wR < `).concat(r,`; wR++) {
            float dyR = float(dyRCorner + wR) / `).concat(o,`.0;

            if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `).concat(r,` - 1 - wR;

            for (int wC = 0; wC < `).concat(a,`; wC++) {
              float dyC = float(dyCCorner + wC) / `).concat(s,`.0;

              if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `).concat(a,` - 1 - wC;

              for (int d2 = 0; d2 < `).concat(e.outChannels,`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}();function VWe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape,f=k.backend_util.convertConv2DDataFormat(u),h=k.backend_util.computeConv2DInfo(a.shape,l,o,1,s,c,!1,f),p=new zWe(h);return t.runWebGLProgram(p,[a,i],"float32")}var GWe={kernelName:k.Conv2DBackpropFilter,backendName:"webgl",kernelFunc:VWe};function UWe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode,f=k.backend_util.convertConv2DDataFormat(c),h=k.backend_util.computeConv2DInfo(o,i.shape,s,1,u,l,!1,f),p=new $We(h);return t.runWebGLProgram(p,[a,i],"float32")}var HWe={kernelName:k.Conv2DBackpropInput,backendName:"webgl",kernelFunc:UWe};function KWe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=r.strides,s=r.pad,u=r.dilations,c=k.backend_util.computeConv3DInfo(a.shape,i.shape,o,u,s),l=new PWe(c);return t.runWebGLProgram(l,[a,i],"float32")}var jWe={kernelName:k.Conv3D,backendName:"webgl",kernelFunc:KWe};function XWe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.dy,o=r.strides,s=r.pad,u=r.filterShape,c=k.backend_util.computeConv3DInfo(a.shape,u,o,1,s),l=new qWe(c);return t.runWebGLProgram(l,[a,i],"float32")}var YWe={kernelName:k.Conv3DBackpropFilterV2,backendName:"webgl",kernelFunc:XWe};function ZWe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.filter,o=r.pad,s=r.strides,u=r.inputShape,c=k.backend_util.computeConv3DInfo(u,i.shape,s,1,o),l=new WWe(c);return t.runWebGLProgram(l,[a,i],"float32")}var JWe={kernelName:k.Conv3DBackpropInputV2,backendName:"webgl",kernelFunc:ZWe};var QWe=Xc+`
  return cos(x);
`,eVe=Nt({opSnippet:QWe}),tVe={kernelName:k.Cos,backendName:"webgl",kernelFunc:eVe};var nVe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,rVe=Nt({opSnippet:nVe}),aVe={kernelName:k.Cosh,backendName:"webgl",kernelFunc:rVe};var iVe=function(){function n(e,t,r,a,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3],f=Te(t,1),h=f[0],p=Te(r,2),d=p[0],v=p[1];this.outputShape=[h,d,v,l];var m=a==="bilinear"?1:0,g=Te(["".concat(u-1,".0"),"".concat(c-1,".0")],2),y=g[0],b=g[1],w=Te(d>1?["".concat((u-1)/(d-1)),"(y2-y1) * height_ratio","y1*".concat(y," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(y)],3),x=w[0],N=w[1],T=w[2],E=Te(v>1?["".concat((c-1)/(v-1)),"(x2-x1) * width_ratio","x1*".concat(b," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(b)],3),C=E[0],F=E[1],D=E[2];this.userCode=`
      const float height_ratio = float(`.concat(x,`);
      const float width_ratio = float(`).concat(C,`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `).concat(s,`) {
          return;
        }

        float height_scale = `).concat(N,`;
        float width_scale = `).concat(F,`;

        float in_y = `).concat(T,`;
        if( in_y < 0.0 || in_y > `).concat(y,` ) {
          setOutput(float(`).concat(i,`));
          return;
        }
        float in_x = `).concat(D,`;
        if( in_x < 0.0 || in_x > `).concat(b,` ) {
          setOutput(float(`).concat(i,`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`).concat(m,` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `)}return n}();var oVe=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.image,i=e.boxes,o=e.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=new iVe(a.shape,i.shape,s,u,c);return t.runWebGLProgram(l,[a,i,o],"float32")},sVe={kernelName:k.CropAndResize,backendName:"webgl",kernelFunc:oVe},dh;(function(n){n.Prod="*",n.Sum="+"})(dh||(dh={}));var n$=function(){function n(e,t,r,a){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];var i=this.outputShape.length,o=this.op===dh.Prod?"1.0":"0.0",s=r?o:"getX(".concat(r$(i,"coords",this.op),")"),u=this.outputShape[this.outputShape.length-1],c="",l="";r?(c=a?"end != ".concat(u-1):"end != 0",l=a?"end + 1":"end - 1"):(c=a?"end + pow2 < ".concat(u):"end >= pow2",l=a?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        `.concat(Wt(i),` coords = getOutputCoords();
        int end = `).concat(a$(i,"coords",this.op),`;
        float val = `).concat(s,`;
        int pow2 = int(pow(2.0, index));
        if (`).concat(c,`) {
          int idx = `).concat(l,`;
          `).concat(a$(i,"coords",this.op),` = idx;
          val `).concat(this.op,"= getX(").concat(r$(i,"coords",this.op),`);
        }
        setOutput(val);
      }
    `)}return n}();function r$(n,e,t){if(n===1)return"".concat(e);if(n===2)return"".concat(e,".x, ").concat(e,".y");if(n===3)return"".concat(e,".x, ").concat(e,".y, ").concat(e,".z");if(n===4)return"".concat(e,".x, ").concat(e,".y, ").concat(e,".z, ").concat(e,".w");throw new Error("Cumulative ".concat(t," for rank ").concat(n," is not yet supported"))}function a$(n,e,t){if(n===1)return"".concat(e);if(n===2)return"".concat(e,".y");if(n===3)return"".concat(e,".z");if(n===4)return"".concat(e,".w");throw new Error("Cumulative ".concat(t," for rank ").concat(n," is not yet supported"))}function Aq(n,e,t,r,a,i){var o=e.shape.length,s=k.backend_util.getAxesPermutation([r],o),u=e;s!=null&&(u=wr({inputs:{x:e},backend:t,attrs:{perm:s}}));var c=k.backend_util.getInnerMostAxes(1,o)[0];if(c!==o-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(e.shape.length-1," ")+"but got axis=".concat(r));for(var l=u.shape[c],f=aa({inputs:{x:u},backend:t}),h=0;h<=Math.ceil(Math.log2(l))-1;h++){var p=new n$(n,u.shape,!1,i),d=[[h]],v=f;f=t.runWebGLProgram(p,[f],f.dtype,d),t.disposeIntermediateTensorInfo(v)}if(a){var p=new n$(n,u.shape,a,i),v=f;f=t.runWebGLProgram(p,[f],f.dtype),t.disposeIntermediateTensorInfo(v)}if(s!=null){var m=k.backend_util.getUndoAxesPermutation(s),g=wr({inputs:{x:f},backend:t,attrs:{perm:m}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(u),g}return f}function uVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.exclusive,s=r.reverse;return Aq(dh.Prod,a,t,i,o,s)}var cVe={kernelName:k.Cumprod,backendName:"webgl",kernelFunc:uVe};function lVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.exclusive,s=r.reverse;return Aq(dh.Sum,a,t,i,o,s)}var fVe={kernelName:k.Cumsum,backendName:"webgl",kernelFunc:lVe};function hVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.weights,o=r.size,s=r.binaryOutput;if(a.shape.length===1){var u=t.readSync(a.dataId),c=t.readSync(i.dataId),l=uq(u,c,i.dtype,i.shape,o);return t.makeTensorInfo([o],i.dtype,l)}else if(a.shape.length===2){var f=t.bufferSync(a),h=t.bufferSync(i),p=kze(f,h,o,s);return t.makeTensorInfo(p.shape,i.dtype,p.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}var pVe={kernelName:k.DenseBincount,backendName:"webgl",kernelFunc:hVe};var dVe=function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `.concat(this.getHeightCoordString(),`;
      int w = `).concat(this.getWidthCoordString(),`;
      int d = `).concat(this.getDepthCoordString(),`;

      int in_h = h / `).concat(t,`;
      int offset_h = imod(h, `).concat(t,`);
      int in_w = w / `).concat(t,`;
      int offset_w = imod(w, `).concat(t,`);
      int offset_d = (offset_h * `).concat(t,` + offset_w) *
        `).concat(this.getOutputDepthSize(),`;
      int in_d = d + offset_d;

      float result = `).concat(this.getInputSamplingString(),`;
      setOutput(result);
    }
  `)}return n.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n}();function vVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.blockSize,o=r.dataFormat,s=a.shape[0],u=o==="NHWC"?a.shape[1]:a.shape[2],c=o==="NHWC"?a.shape[2]:a.shape[3],l=o==="NHWC"?a.shape[3]:a.shape[1],f=u*i,h=c*i,p=l/(i*i),d=o==="NHWC"?[s,f,h,p]:[s,p,f,h],v=new dVe(d,i,o);return t.runWebGLProgram(v,[a],a.dtype)}var mVe={kernelName:k.DepthToSpace,backendName:"webgl",kernelFunc:vVe};var _q=function(){function n(e,t,r,a,i){t===void 0&&(t=!1),r===void 0&&(r=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=kr(this.outputShape.length);var o=e.filterHeight,s=e.filterWidth,u=e.outChannels/e.inChannels,c="",l="";r&&(a?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `.concat(r,`
        }`):i?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          `.concat(r,`
        }`):c=`
          float activation(float x) {
            `.concat(r,`
          }
        `),l="result = activation(result);");var f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `.concat(c,`

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `).concat(u,`;
        int q = d2 - d1 * `).concat(u,`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `).concat(o,`; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < `).concat(s,`; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `).concat(f,`
        `).concat(l,`
        setOutput(result);
      }
    `)}return n}();var Dq=function(){function n(e,t,r,a,i){t===void 0&&(t=!1),r===void 0&&(r=null),a===void 0&&(a=!1),i===void 0&&(i=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=kr(this.outputShape.length);for(var o=e.outChannels/e.inChannels,s=e.padInfo.left,u=e.strideWidth,c=e.dilationWidth,l=e.filterHeight,f=e.filterWidth,h=f,p=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`,d=0;d<f;d++)p+=`
          vec4 xTexelC`.concat(d*2,`;
          int xTexelC`).concat(d*2,`Ready;
          vec4 xTexelC`).concat(d*2+1,`;
          int xTexelC`).concat(d*2+1,`Ready;
          vec4 xC`).concat(d,";");p+=`
    for (int r = 0; r < `.concat(l,`; r++) {
      `);for(var d=0;d<f;d++)p+=`
          xTexelC`.concat(d*2,` = vec4(0.0);
          xTexelC`).concat(d*2,`Ready = 0;
          xTexelC`).concat(d*2+1,` = vec4(0.0);
          xTexelC`).concat(d*2+1,`Ready = 0;
          xC`).concat(d," = vec4(0.0);");p+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(var v=0;v<(h+1)/2;v++){var m=v*2;if(p+=`
          xC = xCCorner + `.concat(m*c,`;
          `),u===1){if(m<f&&(s%2===1?(p+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                  xTexelC`).concat(m,` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`).concat(m,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(m,`Ready = 1;
                }
              `),c===1&&m>0?p+=`
                xC`.concat(m," = vec4(xTexelC").concat(m-2,".zw, xTexelC").concat(m,`.xy);
                `):p+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC`.concat(m," = vec4(previous.zw, xTexelC").concat(m,`.xy);
                  } else {
                    xC`).concat(m," = vec4(0.0, 0.0, xTexelC").concat(m,`.xy);
                  }
                  `)):p+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                  xTexelC`).concat(m,` = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC`).concat(m,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(m,`Ready = 1;
                }

                xC`).concat(m," = xTexelC").concat(m,`;
                `),m+1<f)){var g=s%2===0?k.util.nearestLargerEven(c):c;c%2===0&&s%2===1||c%2!==0&&s%2!==1?(p+=`
                  xCOffset = xC + imod(pads[1], 2) + `.concat(g,`;

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                    xTexelC`).concat(m+1,` = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC`).concat(m+1,`.zw = vec2(0.0);
                    }
                    xTexelC`).concat(m+1,`Ready = 1;
                  }
                  `),c>1?p+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC`.concat(m+1," = vec4(previous.zw, xTexelC").concat(m+1,`.xy);
                    } else {
                     xC`).concat(m+1," = vec4(0.0, 0.0, xTexelC").concat(m+1,`.xy);
                    }
                    `):p+=`
                    xC`.concat(m+1," = vec4(xTexelC").concat(m,".zw, xTexelC").concat(m+1,`.xy);
                    `)):g===1?p+=`
                    xC`.concat(m+1," = xTexelC").concat(m,`;
                    `):p+=`
                    xCOffset = xC + `.concat(g,`;

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                      xTexelC`).concat(m+1,` = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC`).concat(m+1,`.zw = vec2(0.0);
                      }
                      xTexelC`).concat(m+1,`Ready = 1;
                    }

                    xC`).concat(m+1," = xTexelC").concat(m+1,`;
                    `)}}else m<f&&(s%2===1?(p+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                  xTexelC`).concat(m,` = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`).concat(m,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(m,`Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                  xTexelC`).concat(m+1,` = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC`).concat(m+1,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(m+1,`Ready = 1;
                }

                xC`).concat(m," = vec4(xTexelC").concat(m,".zw, xTexelC").concat(m+1,`.zw);
              `),m+1<f&&(p+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC`.concat(m+1," = vec4(xTexelC").concat(m+1,`.xy, final.xy);
                `))):(p+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC`.concat(m,`Ready == 0) {
                  xTexelC`).concat(m,` = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC`).concat(m,`.zw = vec2(0.0);
                  }
                  xTexelC`).concat(m,`Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC`).concat(m+1,`Ready == 0) {
                  xTexelC`).concat(m+1,` = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC`).concat(m+1,`.zw = vec2(0.);
                  }
                  xTexelC`).concat(m+1,`Ready = 1;
                }

                xC`).concat(m,` = vec4(
                  xTexelC`).concat(m,".xy, xTexelC").concat(m+1,`.xy);
              `),m+1<f&&(p+=`
                  xC`.concat(m+1," = vec4(xTexelC").concat(m,".zw, xTexelC").concat(m+1,`.zw);
                `))));m<f&&(p+=`
            wTexel = getW(r, `.concat(m,`, d1, q);
            dotProd += xC`).concat(m,` * vec4(wTexel.xz, wTexel.xz);
          `),m+1<f&&(p+=`
              wTexel = getW(r, `.concat(m+1,`, d1, q);
              dotProd += xC`).concat(m+1,` * vec4(wTexel.xz, wTexel.xz);
            `)))}p+=`
    }
  `,p+=`
      }
    `;var y="",b="";r&&(a?y=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `.concat(r,`
        }`):i?y=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          `.concat(r,`
        }`):y=`vec4 activation(vec4 x) {
          `.concat(r,`
        }`),b="result = activation(result);");var w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      `.concat(y,`

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `).concat(o,`;
        int q = d2 - d1 * `).concat(o,`;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        `).concat(p,`

        vec4 result = dotProd - vec4(0.000000000000001);
        `).concat(w,`
        `).concat(b,`
        setOutput(result);
      }
    `)}return n}();function gVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode,l=u;l==null&&(l=[1,1]),k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,l),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(l,"'")});var f=k.backend_util.computeConv2DInfo(a.shape,i.shape,o,l,s,c,!0),h;k.env().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?h=new Dq(f):h=new _q(f);var p=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return t.runWebGLProgram(h,[a,i],"float32",p)}var yVe={kernelName:k.DepthwiseConv2dNative,backendName:"webgl",kernelFunc:gVe};var bVe=function(){function n(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;var t=e.strideHeight,r=e.strideWidth,a=e.padInfo.top,i=e.padInfo.left,o=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `.concat(o,` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `).concat(e.batchSize,`; b++) {
          for (int yR = 0; yR < `).concat(e.outHeight,`; yR++) {
            int xR = wR + yR * `).concat(t," - ").concat(a,`;

            if (xR < 0 || xR >= `).concat(e.inHeight,`) {
              continue;
            }

            for (int yC = 0; yC < `).concat(e.outWidth,`; yC++) {
              int xC = wC + yC * `).concat(r," - ").concat(i,`;

              if (xC < 0 || xC >= `).concat(e.inWidth,`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}(),wVe=function(){function n(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,r=e.filterWidth,a=e.strideHeight,i=e.strideWidth,o=t-1-e.padInfo.top,s=r-1-e.padInfo.left,u=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`.concat(o,", ").concat(s,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `).concat(t,`; wR++) {
          float dyR = float(dyRCorner + wR) / `).concat(a,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `).concat(t,` - 1 - wR;

          for (int wC = 0; wC < `).concat(r,`; wC++) {
            float dyC = float(dyCCorner + wC) / `).concat(i,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `).concat(r,` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `).concat(u,`; dm++) {
              int d2 = d1 * `).concat(u,` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}();function xVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape,f=k.backend_util.computeConv2DInfo(a.shape,l,o,s,u,c,!0),h=new bVe(f);return t.runWebGLProgram(h,[a,i],"float32")}var kVe={kernelName:k.DepthwiseConv2dNativeBackpropFilter,backendName:"webgl",kernelFunc:xVe};function SVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.inputShape,f=k.backend_util.computeConv2DInfo(l,i.shape,o,s,u,c,!0),h=new wVe(f);return t.runWebGLProgram(h,[a,i],"float32")}var NVe={kernelName:k.DepthwiseConv2dNativeBackpropInput,backendName:"webgl",kernelFunc:SVe};var TVe=function(){function n(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}return n}();function EVe(n){var e=n.inputs,t=n.backend,r=e.x,a=pn(pn([],Te(r.shape),!1),Te(r.shape),!1),i=k.util.sizeFromShape(r.shape),o=Pe({inputs:{x:r},backend:t,attrs:{shape:[i]}}),s=new TVe(i),u=t.runWebGLProgram(s,[o],o.dtype),c=Pe({inputs:{x:u},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(u),c}var IVe={kernelName:k.Diag,backendName:"webgl",kernelFunc:EVe};var CVe=function(){function n(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.inHeight,r=e.inWidth,a=e.padInfo,i=e.strideHeight,o=e.strideWidth,s=e.filterHeight,u=e.filterWidth,c=e.dilationHeight,l=e.dilationWidth,f=a.top,h=a.left;this.userCode=`
      const ivec2 strides = ivec2(`.concat(i,", ").concat(o,`);
      const ivec2 pads = ivec2(`).concat(f,", ").concat(h,`);
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < `).concat(s,`; h++) {
          int hIn = hBeg + h * `).concat(c,`;

          if (hIn >= 0 && hIn < `).concat(t,`) {
            for (int w = 0; w < `).concat(u,`; w++) {
              int wIn = wBeg + w * `).concat(l,`;

              if (wIn >= 0 && wIn < `).concat(r,`) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `)}return n}();function AVe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=r.strides,s=r.pad,u=r.dilations,c=k.backend_util.computeDilation2DInfo(a.shape,i.shape,o,s,"NHWC",u),l,f=new CVe(c);l=t.runWebGLProgram(f,[a,i],"float32");var h=Pe({inputs:{x:l},backend:t,attrs:{shape:c.outShape}});return t.disposeIntermediateTensorInfo(l),h}var _Ve={kernelName:k.Dilation2D,backendName:"webgl",kernelFunc:AVe};function DVe(n){var e,t,r,a,i=n.inputs,o=n.backend,s=n.attrs,u=s.equation,c=i,l=k.backend_util.decodeEinsumEquation(u,c.length),f=l.allDims,h=l.summedDims,p=l.idDims;k.backend_util.checkEinsumDimSizes(f.length,p,c);for(var d=k.backend_util.getEinsumComputePath(h,p),v=d.path,m=d.steps,g=m.length,y=null,b=f.length,w=[],x=0;x<g;++x){try{for(var N=(e=void 0,ra(m[x])),T=N.next();!T.done;T=N.next()){var E=T.value,C=k.backend_util.getEinsumPermutation(b,p[E]),F=C.permutationIndices,D=C.expandDims,O=void 0;k.backend_util.isIdentityPermutation(F)?O=c[E]:(O=wr({inputs:{x:c[E]},backend:o,attrs:{perm:F}}),w.push(O));for(var L=O.shape.slice(),z=0;z<D.length;++z)L.splice(D[z],0,1);k.util.arraysEqual(O.shape,L)||(O=Pe({inputs:{x:O},backend:o,attrs:{shape:L}}),w.push(O)),y===null?y=O:(y=Wx({inputs:{a:O,b:y},backend:o}),w.push(y))}}catch(X){e={error:X}}finally{try{T&&!T.done&&(t=N.return)&&t.call(N)}finally{if(e)throw e.error}}x<g-1&&(v[x]>=0&&(y=lm({inputs:{x:y},backend:o,attrs:{axis:v[x]-(f.length-b),keepDims:!1}}),w.push(y)),b--)}try{for(var $=ra(w),B=$.next();!B.done;B=$.next()){var W=B.value;W!==y&&o.disposeIntermediateTensorInfo(W)}}catch(X){r={error:X}}finally{try{B&&!B.done&&(a=$.return)&&a.call($)}finally{if(r)throw r.error}}return y}var FVe={kernelName:k.Einsum,backendName:"webgl",kernelFunc:DVe};var RVe="return (x >= 0.0) ? x : (exp(x) - 1.0);",OVe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,PVe=Nt({opSnippet:RVe,packedOpSnippet:OVe}),MVe={kernelName:k.Elu,backendName:"webgl",kernelFunc:PVe};var BVe="return (b >= 1.0) ? a : a * (b + 1.0);",LVe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,zVe=function(n){var e=n.inputs,t=n.backend,r=e.dy,a=e.y,i=k.env().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new yh(LVe,r.shape,a.shape):new Wc(BVe,r.shape,a.shape);return t.runWebGLProgram(i,[r,a],r.dtype)},$Ve={kernelName:k.EluGrad,backendName:"webgl",kernelFunc:zVe};var qVe=`
  return vec4(equal(a, b));
`,WVe="return float(a == b);",VVe=or({opSnippet:WVe,packedOpSnippet:qVe,dtype:"bool",cpuKernelImpl:Eze}),GVe={kernelName:k.Equal,backendName:"webgl",kernelFunc:VVe};var UVe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = `.concat(k.backend_util.ERF_P,`;
  float a1 = `).concat(k.backend_util.ERF_A1,`;
  float a2 = `).concat(k.backend_util.ERF_A2,`;
  float a3 = `).concat(k.backend_util.ERF_A3,`;
  float a4 = `).concat(k.backend_util.ERF_A4,`;
  float a5 = `).concat(k.backend_util.ERF_A5,`;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`),HVe=Nt({opSnippet:UVe}),KVe={kernelName:k.Erf,backendName:"webgl",kernelFunc:HVe};var jVe=Xc+`
  return exp(x);
`,XVe=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Fq=Nt({opSnippet:jVe,packedOpSnippet:XVe,cpuKernelImpl:Ize,dtype:"float32"}),YVe={kernelName:k.Exp,backendName:"webgl",kernelFunc:Fq};function Cx(n){var e=n.inputs,t=n.attrs,r=n.backend,a=t.dim,i=e.input,o=i.shape.length,s=i.shape.slice(),u=a;return a<0&&(k.util.assert(-(o+1)<=a,function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")}),u=o+a+1),s.splice(u,0,1),Pe({inputs:{x:i},backend:r,attrs:{shape:s}})}var ZVe={kernelName:k.ExpandDims,backendName:"webgl",kernelFunc:Cx};var i$="return exp(x) - 1.0;",JVe=Nt({opSnippet:i$,packedOpSnippet:i$,cpuKernelImpl:Cze}),QVe={kernelName:k.Expm1,backendName:"webgl",kernelFunc:JVe};var o$=function(){function n(e,t,r){this.variableNames=["real","imag"];var a=t[1];this.outputShape=t;var i=r?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),o=r?"".concat(a,".0"):"1.0",s;if(e==="real")s="return real * expR - imag * expI;";else if(e==="imag")s="return real * expI + imag * expR;";else throw new Error('FFT component must be either "real" or "imag", got '.concat(e,"."));this.userCode=`
      const float exponentMultiplier = `.concat(i,`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `).concat(s,`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`).concat(a,`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `).concat(a,`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `).concat(o,`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `)}return n}();function Rq(n,e,t){var r=t.texData.get(n.dataId),a=k.util.sizeFromShape(n.shape),i=n.shape[n.shape.length-1],o=a/i,s=Pe({inputs:{x:n},backend:t,attrs:{shape:[o,i]}}),u=s.shape,c=new o$("real",u,e),l=new o$("imag",u,e),f=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:u},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:u}],h=t.runWebGLProgram(c,f,"float32"),p=t.runWebGLProgram(l,f,"float32"),d=ts({inputs:{real:h,imag:p},backend:t});t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p);var v=Pe({inputs:{x:d},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(d),v}function eGe(n){var e=n.inputs,t=n.backend,r=e.input;return Rq(r,!1,t)}var tGe={kernelName:k.FFT,backendName:"webgl",kernelFunc:eGe};var nGe=function(){function n(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return n}();function wh(n){var e=n.backend,t=n.attrs,r=t.shape,a=t.value,i=t.dtype;if(i=i||k.util.inferDtype(a),i==="string"){var o=k.util.getArrayFromDType(i,k.util.sizeFromShape(r));return o.fill(a),e.makeTensorInfo(r,i,o)}else{var s=new nGe(r,a),u=[[a]];return e.runWebGLProgram(s,[],i,u)}}var rGe={kernelName:k.Fill,backendName:"webgl",kernelFunc:wh};var aGe=function(){function n(e){this.variableNames=["Image"],this.outputShape=[];var t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = `.concat(t,` - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < `).concat(t,`) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `)}return n}();var iGe={kernelName:k.FlipLeftRight,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.image,a=t,i=new aGe(r.shape),o=a.runWebGLProgram(i,[r],r.dtype);return o}};var s$="return floor(x);",oGe=Nt({opSnippet:s$,packedOpSnippet:s$,cpuKernelImpl:Aze}),sGe={kernelName:k.Floor,backendName:"webgl",kernelFunc:oGe};var uGe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,cGe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,lGe=or({opSnippet:uGe,packedOpSnippet:cGe,dtype:"int32"}),fGe={kernelName:k.FloorDiv,backendName:"webgl",kernelFunc:lGe},hGe=function(){function n(e){this.variableNames=["A"];var t=xr(),r=Te(e,2),a=r[0],i=r[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`.concat(i,".0, ").concat(a,`.0);

        vec4 values = `).concat(t.texture2D,`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `)}return n}(),pGe=function(){function n(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=xr(),r=Te(e,2),a=r[0],i=r[1];this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`.concat(i,".0, ").concat(a,`.0);
            vec4 values = `).concat(t.texture2D,`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `).concat(t.output,` = result;
      }
    `)}return n}(),dGe={kernelName:k.FromPixels,backendName:"webgl",kernelFunc:vGe},Lc,bx=k.env().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function vGe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.pixels,i=r.numChannels,o=typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement,u=Te(o?[a.videoWidth,a.videoHeight]:[a.width,a.height],2),c=u[0],l=u[1],f=[l,c],h=[l,c,i];if(s||o){var p=k.env().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Lc==null||p!==bx)&&(bx=p,Lc=document.createElement("canvas").getContext("2d",{willReadFrequently:bx})),Lc.canvas.width=c,Lc.canvas.height=l,Lc.drawImage(a,0,0,c,l),a=Lc.canvas}var d=t.makeTensorInfo(f,"int32");t.texData.get(d.dataId).usage=ba.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(d.dataId),a);var v=k.env().getBool("WEBGL_PACK")?new pGe(h):new hGe(h),m=t.runWebGLProgram(v,[d],"int32");return t.disposeData(d.dataId),m}function mGe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,f=r.dilations,h=r.dimRoundingMode,p=r.activation,d=r.leakyreluAlpha,v=k.backend_util.convertConv2DDataFormat(l),m=k.backend_util.computeConv2DInfo(a.shape,i.shape,u,f,c,h,!1,v),g,y=[],b=o!=null,w=s!=null,x=p==="leakyrelu",N=function(){var L=[a,i],z=function(B,W){if(W==="NCHW"&&B.shape.length===1&&B.shape[0]!==1){var X=Pe({inputs:{x:B},backend:t,attrs:{shape:[B.shape[0],1,1]}});return y.push(X),X}return B};if(b&&L.push(z(o,l)),w&&L.push(z(s,l)),x){var $=t.makeTensorInfo([],"float32",k.util.createScalarValue(d,"float32"));L.push($),y.push($)}return L};if(m.filterHeight===1&&m.filterWidth===1&&m.dilationHeight===1&&m.dilationWidth===1&&m.strideHeight===1&&m.strideWidth===1&&(m.padInfo.type==="SAME"||m.padInfo.type==="VALID"))g=Iq({x:a,filter:i,convInfo:m,backend:t,bias:o,activation:p,preluActivationWeights:s,leakyreluAlpha:d});else if(m.strideWidth<=2&&v==="channelsLast"&&k.env().getBool("WEBGL_EXP_CONV")){var T=p?hh(p,!0):null,E=new Eq(m,b,T,w,x),C=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],F=N();g=t.runWebGLProgram(E,F,"float32",C)}else if(k.env().getBool("WEBGL_CONV_IM2COL"))g=Cq({x:a,filter:i,convInfo:m,backend:t,bias:o,activation:p,preluActivationWeights:s,leakyreluAlpha:d});else{var T=p?hh(p,!1):null,E=new Tq(m,b,T,w,x),D=N();g=t.runWebGLProgram(E,D,"float32")}var O=Pe({inputs:{x:g},backend:t,attrs:{shape:m.outShape}});return y.push(g),y.forEach(function(L){return t.disposeIntermediateTensorInfo(L)}),O}var gGe={kernelName:k.FusedConv2D,backendName:"webgl",kernelFunc:mGe};function yGe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.filter,o=e.bias,s=e.preluActivationWeights,u=r.strides,c=r.pad,l=r.dilations,f=r.dimRoundingMode,h=r.activation,p=r.leakyreluAlpha,d=[],v=l;v==null&&(v=[1,1]),k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(u,v),function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(u," and dilations '").concat(v,"'")});var m=k.backend_util.computeConv2DInfo(a.shape,i.shape,u,v,c,f,!0),g=k.env().getBool("WEBGL_PACK_DEPTHWISECONV")&&m.strideWidth<=2&&m.outChannels/m.inChannels===1,y=h?hh(h,g):null,b=[a,i],w=o!=null,x=s!=null,N=h==="leakyrelu";if(w&&b.push(o),x&&b.push(s),N){var T=t.makeTensorInfo([],"float32",k.util.createScalarValue(p,"float32"));b.push(T),d.push(T)}var E;g?E=new Dq(m,w,y,x,N):E=new _q(m,w,y,x,N);var C=[[m.padInfo.top,m.padInfo.left],[m.strideHeight,m.strideWidth],[m.dilationHeight,m.dilationWidth],[m.inHeight,m.inWidth]],F=t.runWebGLProgram(E,b,"float32",C);return d.forEach(function(D){return t.disposeIntermediateTensorInfo(D)}),F}var bGe={kernelName:k.FusedDepthwiseConv2D,backendName:"webgl",kernelFunc:yGe},wGe=function(){function n(e,t,r,a){this.sliceDim=e,this.strides=t,this.paramsShape=a,this.variableNames=["x","indices"],this.outputShape=r;for(var i=Wt(r.length),o=`
    int index;`,s=0;s<this.sliceDim;s++)o+=`
          index = round(getIndices(coords[0], `.concat(s,`));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= `).concat(this.paramsShape[s],`;
          flattenIndex += index * `).concat(this.strides[s],";");this.userCode=`
         void main() {
          `.concat(i,` coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          `).concat(o,`

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `)}return n}();function xGe(n){var e=n.inputs,t=n.backend,r=e.params,a=e.indices,i=a.shape,o=i[i.length-1],s=k.util.sizeFromShape(r.shape),u=Te(k.backend_util.prepareAndValidate(r,a),4),c=u[0],l=u[1],f=u[2],h=u[3],p=Pe({inputs:{x:a},backend:t,attrs:{shape:[l,o]}}),d=Pe({inputs:{x:r},backend:t,attrs:{shape:[k.util.sizeFromShape(r.shape)/f,f]}});if(t.shouldExecuteOnCPU([r,a])||r.dtype==="string"){var v=t.readSync(a.dataId),m=t.bufferSync(r),g=_ze(v,m,r.dtype,l,o,f,h,r.shape,s);return t.makeTensorInfo(c,r.dtype,g.values)}var y=new wGe(o,h,[l,f],r.shape),b=t.runWebGLProgram(y,[d,p],d.dtype),w=Pe({inputs:{x:b},backend:t,attrs:{shape:c}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(b),w}var kGe={kernelName:k.GatherNd,backendName:"webgl",kernelFunc:xGe};var SGe=function(){function n(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;var r=Wt(this.rank),a=NGe(e);this.userCode=`
      void main() {
        `.concat(r,` resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < `).concat(e[2],`) ? 1.0 : 0.0;
        setOutput(inBounds * getA(`).concat(a,`));
      }
    `)}return n}();function NGe(n,e){for(var t=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],a=0;a<n.length;a++)a===2?r.push("index"):r.push("".concat(t[a]));return r.join()}function Oq(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.indices,o=r.axis,s=r.batchDims,u=k.util.parseAxisParam(o,a.shape)[0];if(k.env().get("DEBUG"))for(var c=t.readSync(i.dataId),l=a.shape[u],f=function(C){var F=c[C];k.util.assert(F<=l-1&&F>=0,function(){return"GatherV2: the index value ".concat(F," is not in [0, ").concat(l-1,"]")})},h=0;h<c.length;++h)f(h);var p=k.backend_util.segment_util.collectGatherOpShapeInfo(a,i,u,s),d=k.util.sizeFromShape(i.shape),v=[],m=Pe({inputs:{x:a},backend:t,attrs:{shape:[p.batchSize,p.outerSize,p.dimSize,p.sliceSize]}}),g=Pe({inputs:{x:i},backend:t,attrs:{shape:[p.batchSize,d/p.batchSize]}});v.push(m),v.push(g);var y=[p.batchSize,p.outerSize,d/p.batchSize,p.sliceSize];if(t.shouldExecuteOnCPU([a,i])||a.dtype==="string"){var b=t.bufferSync(g),w=t.bufferSync(m),x=Dze(w,b,y);return v.forEach(function(C){return t.disposeIntermediateTensorInfo(C)}),t.makeTensorInfo(p.outputShape,x.dtype,x.values)}var N=new SGe(m.shape,y),T=t.runWebGLProgram(N,[m,g],m.dtype);v.push(T);var E=Pe({inputs:{x:T},backend:t,attrs:{shape:p.outputShape}});return v.forEach(function(C){return t.disposeIntermediateTensorInfo(C)}),E}var TGe={kernelName:k.GatherV2,backendName:"webgl",kernelFunc:Oq};var EGe="return float(a > b);",IGe=`
  return vec4(greaterThan(a, b));
`,CGe=or({opSnippet:EGe,packedOpSnippet:IGe,cpuKernelImpl:Fze,dtype:"bool"}),AGe={kernelName:k.Greater,backendName:"webgl",kernelFunc:CGe};var _Ge="return float(a >= b);",DGe=`
  return vec4(greaterThanEqual(a, b));
`,FGe=or({opSnippet:_Ge,packedOpSnippet:DGe,dtype:"bool",cpuKernelImpl:Rze}),RGe={kernelName:k.GreaterEqual,backendName:"webgl",kernelFunc:FGe};function OGe(n){var e=n.inputs,t=n.backend,r=e.input;return Rq(r,!0,t)}var PGe={kernelName:k.IFFT,backendName:"webgl",kernelFunc:OGe};var MGe="return float(!isnan(x) && !isinf(x));",BGe=Nt({opSnippet:MGe,dtype:"bool"}),LGe={kernelName:k.IsFinite,backendName:"webgl",kernelFunc:BGe};var zGe="return float(isinf(x));",$Ge=Nt({opSnippet:zGe,dtype:"bool"}),qGe={kernelName:k.IsInf,backendName:"webgl",kernelFunc:$Ge};var WGe="return float(isnan(x));",VGe=Nt({opSnippet:WGe,dtype:"bool"}),GGe={kernelName:k.IsNan,backendName:"webgl",kernelFunc:VGe};var UGe="return float(a < b);",HGe=`
  return vec4(lessThan(a, b));
`,KGe=or({opSnippet:UGe,packedOpSnippet:HGe,cpuKernelImpl:Oze,dtype:"bool"}),jGe={kernelName:k.Less,backendName:"webgl",kernelFunc:KGe};var XGe="return float(a <= b);",YGe=`
  return vec4(lessThanEqual(a, b));
`,ZGe=or({opSnippet:XGe,packedOpSnippet:YGe,cpuKernelImpl:Pze,dtype:"bool"}),JGe={kernelName:k.LessEqual,backendName:"webgl",kernelFunc:ZGe};function QGe(n){var e=n.backend,t=n.attrs,r=t.start,a=t.stop,i=t.num,o=Mze(r,a,i);return e.makeTensorInfo([o.length],"float32",o)}var eUe={kernelName:k.LinSpace,backendName:"webgl",kernelFunc:QGe};var tUe=Xc+`
  return x < 0.0 ? 0./0. : log(x);
`,nUe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,rUe=Nt({opSnippet:tUe,packedOpSnippet:nUe,cpuKernelImpl:Bze}),aUe={kernelName:k.Log,backendName:"webgl",kernelFunc:rUe};var iUe=Xc+`
  return log(1.0 + x);
`,oUe=Nt({opSnippet:iUe}),sUe={kernelName:k.Log1p,backendName:"webgl",kernelFunc:oUe};var uUe="return float(a >= 1.0 && b >= 1.0);",cUe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,lUe=or({opSnippet:uUe,packedOpSnippet:cUe,dtype:"bool"}),fUe={kernelName:k.LogicalAnd,backendName:"webgl",kernelFunc:lUe};var hUe="return float(!(x >= 1.0));",pUe=Nt({opSnippet:hUe}),dUe={kernelName:k.LogicalNot,backendName:"webgl",kernelFunc:pUe};var vUe="return float(a >= 1.0 || b >= 1.0);",mUe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,gUe=or({opSnippet:vUe,packedOpSnippet:mUe,dtype:"bool"}),yUe={kernelName:k.LogicalOr,backendName:"webgl",kernelFunc:gUe};var bUe=function(){function n(e,t,r,a,i){this.variableNames=["x"],this.outputShape=[];var o=t,s=e[3]-1;this.outputShape=e;var u,c="float(".concat(r,") + float(").concat(a,") * sum");i===.5?u="inversesqrt(".concat(c,")"):i===1?u="1.0/(".concat(c,")"):u="exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`.concat(o,"; j <= ").concat(o,`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `).concat(s,`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `).concat(u,`;
        setOutput(val);
      }
    `)}return n}();var wUe=function(){function n(e,t,r,a,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o=t,s=e[3]-1;this.outputShape=e;var u,c="float(".concat(r,") + float(").concat(a,") * sum");i===.5?u="inversesqrt(".concat(c,")"):i===1?u="1.0/(".concat(c,")"):u="exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `.concat(this.outputShape[3],`;
        bool hasNextRow = c < `).concat(this.outputShape[2],`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `).concat(o,`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `).concat(o,"; j <= ").concat(o,`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`).concat(s,`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `).concat(u,`;
        setOutput(result);
      }
    `)}return n}();var xUe=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta,c=k.env().getBool("WEBGL_PACK_NORMALIZATION")?new wUe(a.shape,i,o,s,u):new bUe(a.shape,i,o,s,u);return t.runWebGLProgram(c,[a],a.dtype)},kUe={kernelName:k.LRN,backendName:"webgl",kernelFunc:xUe};var SUe=function(){function n(e,t,r,a,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=r,this.alpha=a,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `.concat(this.depth,`; ++d) {
          int depthBegin = int(max(0.0, float(d - `).concat(t,`)));
          int depthEnd = int(min(float(`).concat(this.depth,`),
              float(d + `).concat(t,` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `).concat(this.depth,`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`).concat(a,") * norm + float(").concat(r,`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`).concat(a,`)
                * float(`).concat(i,`)
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `).concat(i,`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `)}return n}();var NUe=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.y,o=e.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta,f=new SUe(a.shape,s,u,c,l);return t.runWebGLProgram(f,[a,i,o],a.dtype)},TUe={kernelName:k.LRNGrad,backendName:"webgl",kernelFunc:NUe};function EUe(n,e,t,r){var a=k.util.sizeFromShape(e),i=k.util.sizeFromShape(n.shape),o=i/a,s=Pe({inputs:{x:n},attrs:{shape:[o,a]},backend:r}),u=mu(s,n.dtype,"max",r),c=Pe({inputs:{x:u},attrs:{shape:t},backend:r});return r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}function Pq(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.reductionIndices,o=r.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=l!=null,h=t.shouldExecuteOnCPU([a]),p=a;if(f){if(h){for(var d=t.texData.get(p.dataId),v=d.values,m=new Array(s),g=0;g<m.length;g++)m[g]=a.shape[l[g]];var y=zx(v,a.shape,a.dtype,l,m);p=t.makeTensorInfo(m,a.dtype);var b=t.texData.get(p.dataId);b.values=y}else p=cm(a,l,t);c=k.backend_util.getInnerMostAxes(c.length,s)}k.backend_util.assertAxesAreInnerMostDims("max",c,s);var w=Te(k.backend_util.computeOutAndReduceShapes(p.shape,c),2),x=w[0],N=w[1],T=x;o&&(T=k.backend_util.expandShapeToKeepDim(x,u));var E;if(h){var d=t.texData.get(p.dataId),v=d.values,C=Lze(v,k.util.sizeFromShape(N),T,a.dtype);E=t.makeTensorInfo(T,a.dtype);var F=t.texData.get(E.dataId);F.values=C}else E=EUe(p,N,T,t);return f&&t.disposeIntermediateTensorInfo(p),E}var IUe={kernelName:k.Max,backendName:"webgl",kernelFunc:Pq};var CUe=qx+`
  return max(a, b);
`,AUe=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+gh+`
  return result;
`,_Ue=or({opSnippet:CUe,packedOpSnippet:AUe,cpuKernelImpl:zze}),DUe={kernelName:k.Maximum,backendName:"webgl",kernelFunc:_Ue};function FUe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x;Gc(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=1;k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,c),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(c,"'")});var l=k.backend_util.computePool2DInfo(a.shape,i,o,c,s,u);if(l.filterWidth===1&&l.filterHeight===1&&k.util.arraysEqual(l.inShape,l.outShape))return aa({inputs:{x:a},backend:t});var f=new ph(l,"max",!1);return t.runWebGLProgram(f,[a],a.dtype)}var RUe={kernelName:k.MaxPool,backendName:"webgl",kernelFunc:FUe};function OUe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=[1,1,1],f=k.backend_util.computePool3DInfo(a.shape,i,o,l,s,c,u),h=new Vx(f,"max",!1);return t.runWebGLProgram(h,[a],a.dtype)}var PUe={kernelName:k.MaxPool3D,backendName:"webgl",kernelFunc:OUe};var MUe=function(){function n(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideHeight,r=e.strideWidth,a=e.dilationHeight,i=e.effectiveFilterHeight,o=e.effectiveFilterWidth,s=i-1-e.padInfo.top,u=o-1-e.padInfo.left,c=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(`.concat(s,", ").concat(u,`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `).concat(i,`;
          wR += `).concat(a,`) {
          float dyR = float(dyRCorner + wR) / `).concat(t,`.0;

          if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `).concat(o,`; wC++) {
            float dyC = float(dyCCorner + wC) / `).concat(r,`.0;

            if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `).concat(c,` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `).concat(o,` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `)}return n}(),BUe=function(){function n(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.strideDepth,r=e.strideHeight,a=e.strideWidth,i=e.dilationDepth,o=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterDepth,c=e.effectiveFilterHeight,l=e.effectiveFilterWidth,f=u-1-e.padInfo.front,h=c-1-e.padInfo.top,p=l-1-e.padInfo.left,d=u*c*l-1;this.userCode=`
      const ivec3 pads = ivec3(`.concat(f,", ").concat(h,", ").concat(p,`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `).concat(u,`;
           wD += `).concat(i,`) {
          float dyD = float(dyDCorner + wD) / `).concat(t,`.0;

          if (dyD < 0.0 || dyD >= `).concat(e.outDepth,`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `).concat(c,`;
              wR += `).concat(o,`) {
            float dyR = float(dyRCorner + wR) / `).concat(r,`.0;

            if (dyR < 0.0 || dyR >= `).concat(e.outHeight,`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `).concat(l,`;
                wC += `).concat(s,`) {
              float dyC = float(dyCCorner + wC) / `).concat(a,`.0;

              if (dyC < 0.0 || dyC >= `).concat(e.outWidth,`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `).concat(d,` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `).concat(c," * ").concat(l,` +
                  wR * `).concat(l,` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `)}return n}();function LUe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.input,o=i,s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,f=[1,1,1],h=k.backend_util.computePool3DInfo(o.shape,s,u,f,c,l),p=new Vx(h,"max",!0),d=t.runWebGLProgram(p,[o],o.dtype),v=new BUe(h),m=t.runWebGLProgram(v,[a,d],o.dtype);return t.disposeIntermediateTensorInfo(d),m}var zUe={kernelName:k.MaxPool3DGrad,backendName:"webgl",kernelFunc:LUe};function $Ue(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.dy,i=e.input,o=e.output,s=i;Gc([i,o],"maxPoolGrad");var u=r.filterSize,c=r.strides,l=r.pad,f=r.dimRoundingMode,h=k.backend_util.computePool2DInfo(s.shape,u,c,1,l,f),p=!0,d=new ph(h,"max",p),v=t.runWebGLProgram(d,[s],s.dtype),m=new MUe(h),g=t.runWebGLProgram(m,[a,v],s.dtype);return t.disposeIntermediateTensorInfo(v),g}var qUe={kernelName:k.MaxPoolGrad,backendName:"webgl",kernelFunc:$Ue};function WUe(n,e,t,r){var a=new ph(t,"max",!1),i=r.runWebGLProgram(a,[n],"float32");a=new ph(t,"max",!0,!0,e);var o=r.runWebGLProgram(a,[n],"float32");return[i,o]}var VUe={kernelName:k.MaxPoolWithArgmax,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.attrs,r=n.backend,a=e.x,i=t.filterSize,o=t.strides,s=t.pad,u=t.includeBatchInIndex,c=r;k.util.assert(a.shape.length===4,function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,".")});var l=[1,1];k.util.assert(k.backend_util.eitherStridesOrDilationsAreOne(o,l),function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(l,"'")});var f=k.backend_util.computePool2DInfo(a.shape,i,o,l,s),h=Te(WUe(a,u,f,c),2),p=h[0],d=h[1];return[p,d]}};function GUe(n,e,t,r){var a=k.util.sizeFromShape(e),i=k.util.sizeFromShape(n.shape),o=i/a,s=Pe({inputs:{x:n},attrs:{shape:[o,a]},backend:r}),u=mu(s,"float32","mean",r),c=Pe({inputs:{x:u},attrs:{shape:t},backend:r});return r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}var UUe={kernelName:k.Mean,backendName:"webgl",kernelFunc:function(n){var e,t,r=n.inputs,a=n.attrs,i=n.backend,o=r.x,s=a.keepDims,u=a.axis,c=i,l=o.shape.length,f=k.util.parseAxisParam(u,o.shape),h=f,p=k.backend_util.getAxesPermutation(h,l),d=p!=null,v=c.shouldExecuteOnCPU([o]),m=[],g=o;if(d){if(v){for(var y=c.texData.get(g.dataId),b=y.values,w=new Array(l),x=0;x<w.length;x++)w[x]=o.shape[p[x]];var N=zx(b,o.shape,o.dtype,p,w);g=c.makeTensorInfo(w,o.dtype);var T=c.texData.get(g.dataId);T.values=N}else g=cm(o,p,c);m.push(g),h=k.backend_util.getInnerMostAxes(h.length,l)}k.backend_util.assertAxesAreInnerMostDims("sum",h,l);var E=Te(k.backend_util.computeOutAndReduceShapes(g.shape,h),2),C=E[0],F=E[1],D=C;s&&(D=k.backend_util.expandShapeToKeepDim(C,f));var O=GUe(g,F,D,c);try{for(var L=ra(m),z=L.next();!z.done;z=L.next()){var x=z.value;c.disposeIntermediateTensorInfo(x)}}catch($){e={error:$}}finally{try{z&&!z.done&&(t=L.return)&&t.call(L)}finally{if(e)throw e.error}}return O}};function HUe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=k.util.parseAxisParam(i,a.shape),c=u,l=k.backend_util.getAxesPermutation(c,s),f=a;l!=null&&(f=wr({inputs:{x:a},backend:t,attrs:{perm:l}}),c=k.backend_util.getInnerMostAxes(c.length,a.shape.length)),k.backend_util.assertAxesAreInnerMostDims("min",c,s);var h=Te(k.backend_util.computeOutAndReduceShapes(f.shape,c),2),p=h[0],d=h[1],v=k.util.sizeFromShape(d),m=Pe({inputs:{x:f},backend:t,attrs:{shape:[-1,v]}}),g=mu(m,m.dtype,"min",t),y;if(o){var b=k.backend_util.expandShapeToKeepDim(p,u);y=Pe({inputs:{x:g},backend:t,attrs:{shape:b}})}else y=Pe({inputs:{x:g},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(m),t.disposeIntermediateTensorInfo(g),l!=null&&t.disposeIntermediateTensorInfo(f),y}var KUe={kernelName:k.Min,backendName:"webgl",kernelFunc:HUe};var jUe=qx+`
  return min(a, b);
`,XUe=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+gh+`
  return result;
`,YUe=or({opSnippet:jUe,packedOpSnippet:XUe,cpuKernelImpl:$ze}),ZUe={kernelName:k.Minimum,backendName:"webgl",kernelFunc:YUe};var JUe=function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=t.map(function(l,f){return l[0]+e[f]+l[1]});var a=e.length,i=Wt(a),o=t.map(function(l){return l[0]}).join(","),s=t.map(function(l,f){return l[0]+e[f]}).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),c=r==="reflect"?0:1;if(a===1){this.userCode=`
        int start = `.concat(o,`;
        int end = `).concat(s,`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - `).concat(c,`;
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + `).concat(c,`;
          }
          setOutput(getX(outC - start));
        }
      `);return}this.userCode=`
      `.concat(i," start = ").concat(i,"(").concat(o,`);
      `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outC = getOutputCoords();
        for (int i = 0; i < `).concat(a,`; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - `).concat(c,`;
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + `).concat(c,`;
          }
        }
        `).concat(i,` coords = outC - start;
        setOutput(getX(`).concat(u,`));
      }
    `)}return n}();var QUe=function(){function n(e,t,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(v,m){return v[0]+e[m]+v[1]});var a=e.length,i=Wt(a),o=t.map(function(v){return v[0]}).join(","),s=t.map(function(v,m){return v[0]+e[m]}).join(","),u=br("rc",a),c=br("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),f=a===1?"source":"vec2(".concat(c.slice(-2).join(),")"),h=r==="reflect"?0:1,p="";if(a===1){var d=`
        `.concat(i,` source = rc;
        if (source < start) {
          source = start * 2 - source - `).concat(h,`;
        } else if (source >= end) {
          source = (end - 1) * 2 - source + `).concat(h,`;
        }
        source -= start;
      `);p=`
        `.concat(i,` rc = outputLoc;
        `).concat(d,`
        result[0] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        `).concat(u[a-1],` += 1;
        if(`).concat(l,`) {
          `).concat(d,`
          result[1] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        }
      `)}else{var d=`
        `.concat(i,` source = rc;
        `).concat(i," lt = ").concat(i,`(lessThan(source, start));
        `).concat(i," gte = ").concat(i,`(greaterThanEqual(source, end));
        `).concat(i,` orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - `).concat(h,`) +
                gte * ((end - 1) * 2 - source + `).concat(h,`);
        source -= start;
      `);p=`
        `.concat(i,` rc = outputLoc;
        `).concat(d,`
        result[0] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        `).concat(u[a-1],` += 1;
        if(`).concat(l,`) {
          `).concat(d,`
          result[1] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
        }
        rc = outputLoc;
        `).concat(u[a-2],` += 1;
        if(`).concat(u[a-2]," < ").concat(this.outputShape[a-2],`) {
          `).concat(d,`
          result[2] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
          `).concat(u[a-1],` += 1;
          if(`).concat(l,`) {
            `).concat(d,`
            result[3] = getChannel(getX(`).concat(c.join(),"), ").concat(f,`);
          }
        }
      `)}this.userCode=`
      const `.concat(i," start = ").concat(i,"(").concat(o,`);
      const `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `).concat(p,`
        setOutput(result);
      }
    `)}return n}();var e6e=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.paddings,o=r.mode,s=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new QUe(a.shape,i,o):new JUe(a.shape,i,o),u=t.runWebGLProgram(s,[a],a.dtype);return u},t6e={kernelName:k.MirrorPad,backendName:"webgl",kernelFunc:e6e};var n6e=`if (b == 0.0) return NAN;
  return mod(a, b);`,r6e=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+gh+`
  return result;
`,a6e=or({opSnippet:n6e,packedOpSnippet:r6e}),i6e={kernelName:k.Mod,backendName:"webgl",kernelFunc:a6e};var o6e=function(){function n(e,t,r){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,r],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `.concat(t-1,`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`).concat(t-1,`));
      }
    `)}return n}();var s6e=`
if (a == b) {
  return 1.0;
};
return a / b;`,u6e=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,Mq=or({opSnippet:s6e,packedOpSnippet:u6e,checkOutOfBounds:!0}),c6e={kernelName:k.RealDiv,backendName:"webgl",kernelFunc:Mq};var u$="return a - b;",Bq=or({opSnippet:u$,packedOpSnippet:u$,supportsComplex:!0,cpuKernelImpl:o$e}),l6e={kernelName:k.Sub,backendName:"webgl",kernelFunc:Bq};function Lq(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.logits,i=r.dim,o=k.util.parseAxisParam([i],a.shape),s=Pq({inputs:{x:a},backend:t,attrs:{reductionIndices:o,keepDims:!1}}),u=k.backend_util.expandShapeToKeepDim(s.shape,o),c=Pe({inputs:{x:s},backend:t,attrs:{shape:u}}),l=Bq({inputs:{a,b:c},backend:t}),f=Fq({inputs:{x:l},backend:t}),h=lm({inputs:{x:f},backend:t,attrs:{axis:o,keepDims:!1}}),p=Pe({inputs:{x:h},backend:t,attrs:{shape:u}}),d=Mq({inputs:{a:f,b:p},backend:t});return t.disposeIntermediateTensorInfo(s),t.disposeIntermediateTensorInfo(c),t.disposeIntermediateTensorInfo(l),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(h),t.disposeIntermediateTensorInfo(p),d}var f6e={kernelName:k.Softmax,backendName:"webgl",kernelFunc:Lq};function h6e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.logits,i=r.numSamples,o=r.seed,s=r.normalized,u=s?a:Lq({inputs:{logits:a},backend:t,attrs:{dim:a.shape.length-1}}),c=u.shape[0],l=u.shape[1],f=new o6e(c,l,i),h=[[o]],p=t.runWebGLProgram(f,[u],"int32",h);return s||t.disposeIntermediateTensorInfo(u),p}var p6e={kernelName:k.Multinomial,backendName:"webgl",kernelFunc:h6e},d6e=Xa+`
  return -x;
`,v6e=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function m6e(n){var e=n.inputs,t=n.backend,r=e.x;if(t.shouldExecuteOnCPU([r])){var a=t.texData.get(r.dataId),i=Te(Wze(a.values,r.shape,r.dtype),2),o=i[0],s=i[1];return t.makeTensorInfo(s,r.dtype,o)}var u;return k.env().getBool("WEBGL_PACK_UNARY_OPERATIONS")?u=new Qo(r.shape,v6e):u=new Bi(r.shape,d6e),t.runWebGLProgram(u,[r],r.dtype)}var g6e={kernelName:k.Neg,backendName:"webgl",kernelFunc:m6e};var y6e=k.kernel_impls.nonMaxSuppressionV3Impl;function b6e(n){k.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=n.inputs,t=n.backend,r=n.attrs,a=e.boxes,i=e.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=t.readSync(a.dataId),l=t.readSync(i.dataId),f=y6e(c,l,o,s,u).selectedIndices;return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}var w6e={kernelName:k.NonMaxSuppressionV3,backendName:"webgl",kernelFunc:b6e};var x6e=k.kernel_impls.nonMaxSuppressionV4Impl;function k6e(n){k.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=n.inputs,t=n.backend,r=n.attrs,a=e.boxes,i=e.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize,l=t.readSync(a.dataId),f=t.readSync(i.dataId),h=x6e(l,f,o,s,u,c),p=h.selectedIndices,d=h.validOutputs;return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([d]))]}var S6e={kernelName:k.NonMaxSuppressionV4,backendName:"webgl",kernelFunc:k6e};var N6e=k.kernel_impls.nonMaxSuppressionV5Impl;function T6e(n){k.backend_util.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var e=n.inputs,t=n.backend,r=n.attrs,a=e.boxes,i=e.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma,l=t.readSync(a.dataId),f=t.readSync(i.dataId),h=o,p=s,d=u,v=c,m=N6e(l,f,h,p,d,v),g=m.selectedIndices,y=m.selectedScores;return[t.makeTensorInfo([g.length],"int32",new Int32Array(g)),t.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var E6e={kernelName:k.NonMaxSuppressionV5,backendName:"webgl",kernelFunc:T6e};var I6e=function(){function n(e,t,r,a){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`.concat(a,"), float(").concat(r,`),
                      float(index == coords.y)));
      }
    `)}return n}(),C6e=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue,c=k.util.sizeFromShape(a.shape),l=new I6e(c,o,s,u),f=Pe({inputs:{x:a},backend:t,attrs:{shape:[c]}}),h=t.runWebGLProgram(l,[f],i);t.disposeIntermediateTensorInfo(f);var p=pn(pn([],Te(a.shape),!1),[o],!1),d=Pe({inputs:{x:h},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(h),d},A6e={kernelName:k.OneHot,backendName:"webgl",kernelFunc:C6e};function sm(n){var e=n.inputs,t=n.backend,r=e.x;if(r.dtype==="complex64"){var a=bh({inputs:{input:r},backend:t}),i=sm({inputs:{x:a},backend:t}),o=fm({inputs:{input:r},backend:t}),s=sm({inputs:{x:o},backend:t}),u=ts({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return wh({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:t})}var _6e={kernelName:k.ZerosLike,backendName:"webgl",kernelFunc:sm};function zq(n){var e=n.inputs,t=n.backend,r=e.x;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){var a=bh({inputs:{input:r},backend:t}),i=zq({inputs:{x:a},backend:t}),o=fm({inputs:{input:r},backend:t}),s=sm({inputs:{x:o},backend:t}),u=ts({inputs:{real:i,imag:s},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(s),u}else return wh({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:t})}var D6e={kernelName:k.OnesLike,backendName:"webgl",kernelFunc:zq};function F6e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.axis;if(e.length===1)return Cx({inputs:{input:e[0]},backend:t,attrs:{dim:a}});var i=e[0].shape,o=e[0].dtype;e.forEach(function(l){k.util.assertShapesMatch(i,l.shape,"All tensors passed to stack must have matching shapes"),k.util.assert(o===l.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var s=[],u=e.map(function(l){var f=Cx({inputs:{input:l},backend:t,attrs:{dim:a}});return s.push(f),f}),c=Nq({inputs:u,backend:t,attrs:{axis:a}});return s.forEach(function(l){return t.disposeIntermediateTensorInfo(l)}),c}var R6e={kernelName:k.Pack,backendName:"webgl",kernelFunc:F6e};var O6e=function(){function n(e,t,r){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(function(c,l){return c[0]+e[l]+c[1]});var a=e.length,i=Wt(a),o=t.map(function(c){return c[0]}).join(","),s=t.map(function(c,l){return c[0]+e[l]}).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);if(a===1){this.userCode=`
        int start = `.concat(o,`;
        int end = `).concat(s,`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `);return}this.userCode=`
      `.concat(i," start = ").concat(i,"(").concat(o,`);
      `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          `).concat(i,` coords = outC - start;
          setOutput(getX(`).concat(u,`));
        }
      }
    `)}return n}();var P6e=function(){function n(e,t,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map(function(g,y){return g[0]+e[y]+g[1]});for(var a=e.length,i=Wt(a),o=t.map(function(g){return g[0]}).join(","),s=t.map(function(g,y){return g[0]+e[y]}).join(","),u=br("rc",a),c=br("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),f=a===1?"source":"vec2(".concat(c.slice(-2).join(),")"),h=["".concat(i," rc = outputLoc;"),"".concat(u[a-1],` += 1;
       if(`).concat(l,`) {
      `),a===1?"":`}
       rc = outputLoc;
       `.concat(u[a-2],` += 1;
       if(`).concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),a===1?"":"  ".concat(u[a-1],` += 1;
         if(`).concat(l,") {")],p=a===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",d="",v=0,m=a===1?2:4;v<m;v++)d+=`
        `.concat(h[v],`
        if (`).concat(p,`) {
          result[`).concat(v,`] = float(value);
        } else {
          `).concat(i,` source = rc - start;
          result[`).concat(v,"] = getChannel(getX(").concat(c.join(),"), ").concat(f,`);
        }
      `);d+=a===1?"} ":"}}",this.userCode=`
      const `.concat(i," start = ").concat(i,"(").concat(o,`);
      const `).concat(i," end = ").concat(i,"(").concat(s,`);

      void main() {
        `).concat(i,` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `).concat(d,`
        setOutput(result);
      }
    `)}return n}();var $q=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.paddings,o=r.constantValue;if(k.util.sizeFromShape(a.shape)===0){var s=i.map(function(l,f){return l[0]+a.shape[f]+l[1]});return wh({backend:t,attrs:{shape:s,value:o,dtype:a.dtype}})}var u=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new P6e(a.shape,i,o):new O6e(a.shape,i,o),c=[[o]];return t.runWebGLProgram(u,[a],a.dtype,c)},M6e={kernelName:k.PadV2,backendName:"webgl",kernelFunc:$q};var B6e=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,L6e=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+gh+`
  return result;
`,z6e=or({opSnippet:B6e,packedOpSnippet:L6e}),$6e={kernelName:k.Pow,backendName:"webgl",kernelFunc:z6e};function q6e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=[],c=k.util.parseAxisParam(i,a.shape),l=c,f=k.backend_util.getAxesPermutation(l,s),h=a;f!=null&&(h=wr({inputs:{x:a},backend:t,attrs:{perm:f}}),l=k.backend_util.getInnerMostAxes(l.length,s),u.push(h)),k.backend_util.assertAxesAreInnerMostDims("prod",l,s);var p;if(t.shouldExecuteOnCPU([h])){var d=t.texData.get(h.dataId).values,v=Gze(h.shape,h.dtype,d,l),m=v.outVals,g=v.outShape,y=v.outDtype;p=t.makeTensorInfo(g,y,m)}else{var b=Te(k.backend_util.computeOutAndReduceShapes(h.shape,l),2),g=b[0],w=b[1],x=k.util.sizeFromShape(w),N=Pe({inputs:{x:h},backend:t,attrs:{shape:[-1,x]}}),T=k.sumOutType(a.dtype),E=mu(N,T,"prod",t);p=Pe({inputs:{x:E},backend:t,attrs:{shape:g}}),u.push(N),u.push(E)}if(o){u.push(p);var C=k.backend_util.expandShapeToKeepDim(p.shape,c);p=Pe({inputs:{x:p},backend:t,attrs:{shape:C}})}return u.forEach(function(F){return t.disposeIntermediateTensorInfo(F)}),p}var W6e={kernelName:k.Prod,backendName:"webgl",kernelFunc:q6e};function V6e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.paramsNestedSplits,i=e.paramsDenseValues,o=e.indices;r.outputRaggedRank;var s=a.map(function(g){return t.readSync(g.dataId)}),u=a.map(function(g){return g.shape}),c=t.readSync(i.dataId),l=t.readSync(o.dataId),f=Te(Uze(s,u,c,i.shape,i.dtype,l,o.shape),3),h=f[0],p=f[1],d=f[2],v=h.map(function(g){return t.makeTensorInfo([g.length],"int32",g)}),m=t.makeTensorInfo(d,i.dtype,p);return v.concat([m])}var G6e={kernelName:k.RaggedGather,backendName:"webgl",kernelFunc:V6e};function U6e(n){var e=n.inputs,t=n.backend,r=e.starts,a=e.limits,i=e.deltas,o=t.readSync(r.dataId),s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=Te(Hze(o,r.shape,r.dtype,s,a.shape,u,i.shape),2),l=c[0],f=c[1],h=t.makeTensorInfo([l.length],"int32",l),p=t.makeTensorInfo([f.length],r.dtype,f);return[h,p]}var H6e={kernelName:k.RaggedRange,backendName:"webgl",kernelFunc:U6e};function K6e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.shape,i=e.values,o=e.defaultValue,s=e.rowPartitionTensors,u=r.rowPartitionTypes,c=t.readSync(a.dataId),l=t.readSync(i.dataId),f=t.readSync(o.dataId),h=s.map(function(g){return t.readSync(g.dataId)}),p=s.map(function(g){return g.shape}),d=Te(Kze(c,a.shape,l,i.shape,i.dtype,f,o.shape,h,p,u),2),v=d[0],m=d[1];return t.makeTensorInfo(v,i.dtype,m)}var j6e={kernelName:k.RaggedTensorToTensor,backendName:"webgl",kernelFunc:K6e};var qq=function(n){var e=n.backend,t=n.attrs,r=t.start,a=t.stop,i=t.step,o=t.dtype,s=jze(r,a,i,o);return e.makeTensorInfo([s.length],o,s)},X6e={kernelName:k.Range,backendName:"webgl",kernelFunc:qq};var Y6e="return 1.0 / x;",Z6e=Nt({opSnippet:Y6e}),J6e={kernelName:k.Reciprocal,backendName:"webgl",kernelFunc:Z6e};var Q6e=Xa+`
  return (x < 0.0) ? 0.0 : x;
`,eHe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,tHe=Nt({opSnippet:Q6e,packedOpSnippet:eHe}),nHe={kernelName:k.Relu,backendName:"webgl",kernelFunc:tHe};var rHe=Xa+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,aHe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,iHe=Nt({opSnippet:rHe,packedOpSnippet:aHe}),oHe={kernelName:k.Relu6,backendName:"webgl",kernelFunc:iHe};var sHe=function(){function n(e,t,r,a,i){this.variableNames=["A"],this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,r,l];var f=[a&&t>1?u-1:u,a&&r>1?c-1:c],h=[a&&t>1?t-1:t,a&&r>1?r-1:r],p;i?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`);
      const vec2 inputShapeRC = vec2(`).concat(u,".0, ").concat(c,`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = `).concat(p,`;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `)}return n}();var uHe=function(){function n(e,t,r,a,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,r,l];var f=[a&&t>1?u-1:u,a&&r>1?c-1:c],h=[a&&t>1?t-1:t,a&&r>1?r-1:r],p;i?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`,
          `).concat(f[1]/h[1],`);
      const vec3 inputShapeRC = vec3(`).concat(u,".0, ").concat(c,`.0,
                                     `).concat(c,`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = `).concat(p,`;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `).concat(l-1,`;
        bool hasNextRow = coords.z < `).concat(r-1,`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `)}return n}();function cHe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size,u=Te(s,2),c=u[0],l=u[1],f=k.env().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new uHe(a.shape,c,l,i,o):new sHe(a.shape,c,l,i,o);return t.runWebGLProgram(f,[a],"float32")}var lHe={kernelName:k.ResizeBilinear,backendName:"webgl",kernelFunc:cHe};var fHe=function(){function n(e,t,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;var a=Te(t,3),i=a[1],o=a[2],s=Te(e,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],f=[r&&u>1?u-1:u,r&&c>1?c-1:c],h=l[0]/f[0],p=l[1]/f[1],d=1/h,v=1/p,m=Math.ceil(d)*2+2,g=Math.ceil(v)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`.concat(h,`);
        const float widthScale = float(`).concat(p,`);

        const float invHeightScale = float(`).concat(d,`);
        const float invWidthScale = float(`).concat(v,`);

        const int winHeight = int(`).concat(m,`);
        const int winWidth = int(`).concat(g,`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `).concat(u,`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `).concat(c,`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `).concat(i-1,`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `).concat(o-1,`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `)}return n}();function hHe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.images,i=e.dy,o=r.alignCorners,s=new fHe(i.shape,a.shape,o);return t.runWebGLProgram(s,[i],i.dtype)}var pHe={kernelName:k.ResizeBilinearGrad,backendName:"webgl",kernelFunc:hHe};var dHe=function(){function n(e,t,r,a,i){this.variableNames=["A"],this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,r,l];var f=[a&&t>1?u-1:u,a&&r>1?c-1:c],h=[a&&t>1?t-1:t,a&&r>1?r-1:r],p=a?"0.5":"0.0",d;i?d="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`);
      const vec2 inputShapeRC = vec2(`).concat(u,".0, ").concat(c,`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = `).concat(d,`;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `).concat(p,`)));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `)}return n}();var vHe=function(){function n(e,t,r,a,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=Te(e,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,t,r,l];var f=[a&&t>1?u-1:u,a&&r>1?c-1:c],h=[a&&t>1?t-1:t,a&&r>1?r-1:r],p=a?"0.5":"0.0",d;i?d="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `.concat(f[0]/h[0],`,
          `).concat(f[1]/h[1],`,
          `).concat(f[1]/h[1],`);
      const vec3 inputShapeRC = vec3(`).concat(u,".0, ").concat(c,`.0,
                                     `).concat(c,`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = `).concat(d,`;

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `).concat(p,`)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `).concat(l-1,`;
        bool hasNextRow = coords.z < `).concat(r-1,`;

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `)}return n}();function mHe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size,u=Te(s,2),c=u[0],l=u[1],f=k.env().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new vHe(a.shape,c,l,i,o):new dHe(a.shape,c,l,i,o);return t.runWebGLProgram(f,[a],a.dtype)}var gHe={kernelName:k.ResizeNearestNeighbor,backendName:"webgl",kernelFunc:mHe};var yHe=function(){function n(e,t,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;var a=Te(t,3),i=a[1],o=a[2],s=Te(e,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],f=[r&&u>1?u-1:u,r&&c>1?c-1:c],h=l[0]/f[0],p=l[1]/f[1],d=1/h,v=1/p,m=Math.ceil(d)*2+2,g=Math.ceil(v)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`.concat(h,`);
        const float widthScale = float(`).concat(p,`);

        const float invHeightScale = float(`).concat(d,`);
        const float invWidthScale = float(`).concat(v,`);

        const int winHeight = int(`).concat(m,`);
        const int winWidth = int(`).concat(g,`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `).concat(u,`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `).concat(c,`) {
              continue;
            }

            float sourceFracRow =
              float(`).concat(l[0],`) *
                (float(dyR) / float(`).concat(f[0],`));

            float sourceFracCol =
                float(`).concat(l[1],`) *
                  (float(dyC) / float(`).concat(f[1],`));

            int sourceNearestRow = int(min(
                float(int(`).concat(i,`) - 1),
                `).concat(r,` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`).concat(o,`) - 1),
                `).concat(r,` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `)}return n}();function bHe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.images,i=e.dy,o=r.alignCorners,s=new yHe(i.shape,a.shape,o);return t.runWebGLProgram(s,[i],i.dtype)}var wHe={kernelName:k.ResizeNearestNeighborGrad,backendName:"webgl",kernelFunc:bHe};var xHe=function(){function n(e,t){this.variableNames=["x"];var r=e.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));if(this.outputShape=e,r===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`.concat(e[0],` - coord - 1));
        }
      `);return}var a=function(s){return t.indexOf(s)!==-1&&e[s]!==1?"".concat(e[s]," - coords[").concat(s,"] - 1"):"coords[".concat(s,"]")},i=e.map(function(s,u){return a(u)}).join(","),o=Wt(r);this.userCode=`
      void main() {
        `.concat(o,` coords = getOutputCoords();
        setOutput(getX(`).concat(i,`));
      }
    `)}return n}();var kHe=function(){function n(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var r=e.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));this.outputShape=e;var a=br("rc",r),i="".concat(a[r-1]," + 1 < ").concat(this.outputShape[r-1]),o="".concat(a[r-2]," + 1 < ").concat(this.outputShape[r-2]),s=Wt(r);r===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`.concat(e[0],` - rc - 1),
            `).concat(e[0],` - rc - 1);
          if(`).concat(i,`){
              result.g = getChannel(getX(`).concat(e[0],` - (rc  + 1) - 1),
                `).concat(e[0],` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `):this.userCode=`
        void main() {
          `.concat(s,` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `).concat(u(a.slice()),`;
          if(`).concat(i,`){
            result.g = `).concat(c(a.slice()),`;
          }
          if(`).concat(o,`) {
            result.b = `).concat(l(a.slice()),`;
            if(`).concat(i,`) {
              result.a = `).concat(f(a.slice()),`;
            }
          }
          setOutput(result);
        }
    `);function u(d){return h(d)}function c(d){return d[r-1]="("+d[r-1]+" + 1)",h(d)}function l(d){return d[r-2]="("+d[r-2]+" + 1)",h(d)}function f(d){return d[r-1]="("+d[r-1]+" + 1)",d[r-2]="("+d[r-2]+" + 1)",h(d)}function h(d){var v=e.map(function(y,b){return p(b,d)}),m=v.join(","),g=v.slice(-2).join(",");return"getChannel(getX(".concat(m,"), vec2(").concat(g,"))")}function p(d,v){return t.indexOf(d)!==-1&&e[d]!==1?"".concat(e[d]," - ").concat(v[d]," - 1"):"".concat(v[d])}}return n}();function SHe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.dims,o=a.shape.length,s=k.util.parseAxisParam(i,a.shape);if(o===0)return aa({inputs:{x:a},backend:t});var u=k.env().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new kHe(a.shape,s):new xHe(a.shape,s);return t.runWebGLProgram(u,[a],a.dtype)}var NHe={kernelName:k.Reverse,backendName:"webgl",kernelFunc:SHe};var THe=function(){function n(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];var r=e[1],a=e[2];this.outputShape=e;var i="";typeof t=="number"?i="float outputValue = ".concat(t.toFixed(2),";"):i=`
        vec3 fill = vec3(`.concat(t.join(","),`);
        float outputValue = fill[coords[3]];`),this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          `.concat(i,`
          if(coordX >= 0 && coordX < `).concat(a," && coordY >= 0 && coordY < ").concat(r,`) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `)}return n}(),EHe={kernelName:k.RotateWithOffset,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.attrs,r=n.backend,a=e.image,i=t.radians,o=t.fillValue,s=t.center,u=r,c=new THe(a.shape,o),l=Te(k.backend_util.getImageCenter(s,a.shape[1],a.shape[2]),2),f=l[0],h=l[1],p=[[f,h,Math.sin(i),Math.cos(i)]],d=u.runWebGLProgram(c,[a],a.dtype,p);return d}};var IHe=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,CHe=Nt({opSnippet:IHe}),AHe={kernelName:k.Round,backendName:"webgl",kernelFunc:CHe};var _He="return inversesqrt(x);",DHe=Nt({opSnippet:_He,cpuKernelImpl:Xze}),FHe={kernelName:k.Rsqrt,backendName:"webgl",kernelFunc:DHe};var Wq=function(){function n(e,t,r,a,i,o,s){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var u=Wt(i.length),c=Wt(o.length),l="";r===1?l="i":r===2&&(l="i, j");var f="getIndices(".concat(l,")"),h="";a===1?h="i":a===2&&(h="i, coords[1]");var p="getUpdates(".concat(h,")"),d=t>1?"strides[j]":"strides";this.userCode=`
        `.concat(u," strides = ").concat(u,"(").concat(i,`);

        void main() {
          `).concat(c,` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `).concat(e,`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `).concat(t,`; j++) {
              int index = round(`).concat(f,`);
              flattenedIndex += index * `).concat(d,`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `).concat(p,`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `)}return n}();function RHe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.indices,i=e.updates,o=r.shape,s=k.backend_util.calculateShapes(i,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,f=s.strides,h=s.outputSize,p=[h/l,l];if(h===0)return t.makeTensorInfo(o,a.dtype);var d=Pe({inputs:{x:a},backend:t,attrs:{shape:[c,u]}}),v=Pe({inputs:{x:i},backend:t,attrs:{shape:[c,l]}}),m=t.makeTensorInfo([],"float32",new Float32Array([0])),g=new Wq(c,u,d.shape.length,v.shape.length,f,p),y=t.runWebGLProgram(g,[v,d,m],v.dtype),b=Pe({inputs:{x:y},backend:t,attrs:{shape:o}});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(y),t.disposeIntermediateTensorInfo(m),b}var OHe={kernelName:k.ScatterNd,backendName:"webgl",kernelFunc:RHe};var PHe=function(){function n(e,t,r,a){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,r];var i="while (left < right) {",o="for (int i = 0; i < ".concat(Math.ceil(Math.log2(t+1)),"; ++i) { if (left >= right) break;"),s=k.env().getNumber("WEBGL_VERSION")===2?i:o,u=a==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         `.concat(s,`
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) `).concat(u,` value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `)}return n}();function MHe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.sortedSequence,i=e.values,o=r.side,s=new PHe(a.shape[0],a.shape[1],i.shape[1],o),u=[[a.shape[1]]];return t.runWebGLProgram(s,[a,i],"int32",u)}var BHe={kernelName:k.SearchSorted,backendName:"webgl",kernelFunc:MHe};var LHe=function(){function n(e,t,r){this.variableNames=["c","a","b"],this.outputShape=t;var a,i;if(r>4)throw Error("Where for rank ".concat(r," is not yet supported"));if(r===1)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<t.length;c++)u.push("".concat(o[c])),c<e&&s.push("".concat(o[c]));a=s.join(),i=u.join()}var l=Wt(r);this.userCode=`
      void main() {
        `.concat(l,` resRC = getOutputCoords();
        float cVal = getC(`).concat(a,`);
        if (cVal >= 1.0) {
          setOutput(getA(`).concat(i,`));
        } else {
          setOutput(getB(`).concat(i,`));
        }
      }
    `)}return n}();function zHe(n){var e=n.inputs,t=n.backend,r=e.condition,a=e.t,i=e.e,o=new LHe(r.shape.length,a.shape,a.shape.length);return t.runWebGLProgram(o,[r,a,i],k.upcastType(a.dtype,i.dtype))}var $He={kernelName:k.Select,backendName:"webgl",kernelFunc:zHe};var qHe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `.concat(k.backend_util.SELU_SCALEALPHA,`;
  float scale = `).concat(k.backend_util.SELU_SCALE,`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`),WHe=Nt({opSnippet:qHe}),VHe={kernelName:k.Selu,backendName:"webgl",kernelFunc:WHe};var GHe=Xc+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,UHe=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,HHe=Nt({opSnippet:GHe,packedOpSnippet:UHe,cpuKernelImpl:Zze}),KHe={kernelName:k.Sigmoid,backendName:"webgl",kernelFunc:HHe};var jHe=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,XHe=Nt({opSnippet:jHe}),YHe={kernelName:k.Sign,backendName:"webgl",kernelFunc:XHe};var ZHe=Xc+`
  return sin(x);
`,JHe=Nt({opSnippet:ZHe}),QHe={kernelName:k.Sin,backendName:"webgl",kernelFunc:JHe};var eKe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,tKe=Nt({opSnippet:eKe}),nKe={kernelName:k.Sinh,backendName:"webgl",kernelFunc:tKe};var rKe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,aKe=Nt({opSnippet:rKe}),iKe={kernelName:k.Softplus,backendName:"webgl",kernelFunc:aKe},oKe=function(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.blockShape,o=r.paddings;k.util.assert(a.shape.length<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var s=i.reduce(function(y,b){return y*b}),u=[[0,0]];u.push.apply(u,pn([],Te(o),!1));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=[],f=$q({inputs:{x:a},backend:t,attrs:{paddings:u,constantValue:0}}),h=k.backend_util.getReshaped(f.shape,i,s,!1),p=k.backend_util.getPermuted(h.length,i.length,!1),d=k.backend_util.getReshapedPermuted(f.shape,i,s,!1),v=Pe({inputs:{x:f},backend:t,attrs:{shape:h}}),m=wr({inputs:{x:v},backend:t,attrs:{perm:p}}),g=Pe({inputs:{x:m},backend:t,attrs:{shape:d}});return l.push(f),l.push(v),l.push(m),l.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),g},sKe={kernelName:k.SpaceToBatchND,backendName:"webgl",kernelFunc:oKe};function uKe(n){var e=n.inputs,t=n.backend,r=e.indices,a=e.values,i=e.denseShape,o=e.defaultValue;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         `.concat(i.shape));if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         `.concat(r.shape));if(a.shape.length!==1)throw new Error(`Values must be a vector, saw:
         `.concat(a.shape));if(o.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        `.concat(o.shape));var s=t.readSync(r.dataId),u=t.readSync(a.dataId),c=t.readSync(i.dataId),l=t.readSync(o.dataId)[0],f=Te(Qze(s,r.shape,r.dtype,u,a.dtype,c,l),5),h=f[0],p=f[1],d=f[2],v=f[3],m=f[4];return[t.makeTensorInfo(p,r.dtype,h),t.makeTensorInfo([p[0]],a.dtype,d),t.makeTensorInfo([v.length],"bool",new Uint8Array(v.map(function(g){return Number(g)}))),t.makeTensorInfo([m.length],r.dtype,new Int32Array(m))]}var cKe={kernelName:k.SparseFillEmptyRows,backendName:"webgl",kernelFunc:uKe};function lKe(n){var e=n.inputs,t=n.backend,r=e.inputIndices,a=e.inputShape,i=e.newShape;if(r.shape.length!==2)throw new Error("Input indices should be a matrix but received shape ".concat(r.shape));if(a.shape.length!==1)throw new Error("Input shape should be a vector but received shape ".concat(a.shape));if(i.shape.length!==1)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(t.readSync(a.dataId)),s=t.readSync(r.dataId),u=Array.from(t.readSync(i.dataId)),c=Te(e$e(s,r.shape,r.dtype,o,u),3),l=c[0],f=c[1],h=c[2];return[t.makeTensorInfo(f,r.dtype,l),t.makeTensorInfo([h.length],i.dtype,new Int32Array(h))]}var fKe={kernelName:k.SparseReshape,backendName:"webgl",kernelFunc:lKe};function hKe(n){var e=n.inputs,t=n.backend,r=e.data,a=e.indices,i=e.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              `.concat(i.shape));var o=t.readSync(r.dataId),s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=Te(lq(o,r.shape,r.dtype,s,u,!0),2),l=c[0],f=c[1];return t.makeTensorInfo(f,r.dtype,l)}var pKe={kernelName:k.SparseSegmentMean,backendName:"webgl",kernelFunc:hKe};function dKe(n){var e=n.inputs,t=n.backend,r=e.data,a=e.indices,i=e.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(a.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             `.concat(a.shape));if(i.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             `.concat(i.shape));var o=t.readSync(r.dataId),s=t.readSync(a.dataId),u=t.readSync(i.dataId),c=Te(lq(o,r.shape,r.dtype,s,u),2),l=c[0],f=c[1];return t.makeTensorInfo(f,r.dtype,l)}var vKe={kernelName:k.SparseSegmentSum,backendName:"webgl",kernelFunc:dKe};function mKe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.sparseIndices,i=e.sparseValues,o=e.defaultValue,s=r.outputShape,u=k.backend_util.calculateShapes(i,a,s),c=u.sliceRank,l=u.numUpdates,f=u.sliceSize,h=u.strides,p=u.outputSize,d=!1;if(i.dtype==="string"){var v=t.bufferSync(a),m=t.bufferSync(i),g=k.util.decodeString(t.readSync(o.dataId)[0]),y=Yze(v,m,s,p,f,l,c,h,g,d);return t.makeTensorInfo(s,y.dtype,y.values)}var b=new Wq(l,c,a.shape.length,i.shape.length,h,[p,1],d),w=t.runWebGLProgram(b,[i,a,o],i.dtype),x=Pe({inputs:{x:w},backend:t,attrs:{shape:s}});return t.disposeIntermediateTensorInfo(w),x}var gKe={kernelName:k.SparseToDense,backendName:"webgl",kernelFunc:mKe};function yKe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.numOrSizeSplits,o=r.axis,s=k.util.parseAxisParam(o,a.shape)[0],u=k.backend_util.prepareSplitSize(a,i,s),c=a.shape.length,l=new Array(c).fill(0),f=a.shape.slice();return u.map(function(h){var p=pn([],Te(f),!1);p[s]=h;var d=Yc({inputs:{x:a},backend:t,attrs:{begin:l,size:p}});return l[s]+=h,d})}var bKe={kernelName:k.SplitV,backendName:"webgl",kernelFunc:yKe};var c$="return sqrt(x);",wKe=Nt({opSnippet:c$,packedOpSnippet:c$,cpuKernelImpl:t$e}),xKe={kernelName:k.Sqrt,backendName:"webgl",kernelFunc:wKe};var kKe="return x * x;",SKe=Nt({opSnippet:kKe}),NKe={kernelName:k.Square,backendName:"webgl",kernelFunc:SKe};var l$="return (a - b) * (a - b);",TKe=or({opSnippet:l$,packedOpSnippet:l$}),EKe={kernelName:k.SquaredDifference,backendName:"webgl",kernelFunc:TKe};function IKe(n){var e=n.inputs,t=n.attrs,r=n.backend,a=e.x,i=Xa+`
    return x > 0.0 ? 1.0 : float(`.concat(t.alpha,`);
  `),o=new Bi(a.shape,i);return r.runWebGLProgram(o,[a],a.dtype)}var CKe={kernelName:k.Step,backendName:"webgl",kernelFunc:IKe};var AKe=function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=r;var a=r.length,i=Wt(r.length),o=Wt(r.length),s="";if(a===1)s="coords * strides + begin";else{var u=0;s=r.map(function(c,l){return u++,r.length===1?"coords * strides[".concat(l,"] + begin[").concat(l,"]"):"coords[".concat(u-1,"] * strides[").concat(l,"] + begin[").concat(l,"]")}).join(",")}this.userCode=`
      `.concat(i," begin = ").concat(i,"(").concat(e,`);
      `).concat(i," strides = ").concat(i,"(").concat(t,`);

      void main() {
        `).concat(o,` coords = getOutputCoords();
        setOutput(getX(`).concat(s,`));
      }
    `)}return n}();function _Ke(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.begin,o=r.end,s=r.strides,u=r.beginMask,c=r.endMask,l=r.ellipsisMask,f=r.newAxisMask,h=r.shrinkAxisMask,p=k.slice_util.sliceInfo(a.shape,i,o,s,u,c,l,f,h),d=p.finalShapeSparse,v=p.finalShape,m=p.isIdentity,g=p.sliceDim0,y=p.isSimpleSlice,b=p.begin,w=p.end,x=p.strides,N;if(m)N=Pe({inputs:{x:a},backend:t,attrs:{shape:v}});else if(g||y){k.util.assert(a.shape.length>=1,function(){return"Input must have rank at least 1, got: ".concat(a.shape.length)});var T=k.slice_util.computeOutShape(b,w,x),E=Yc({inputs:{x:a},backend:t,attrs:{begin:b,size:T}});N=Pe({inputs:{x:E},backend:t,attrs:{shape:v}}),t.disposeIntermediateTensorInfo(E)}else{var C=t.shouldExecuteOnCPU([a]);if(C){var F=t.readSync(a.dataId),D=k.buffer(a.shape,a.dtype,F),O=n$e(d,D,x,b);N=t.makeTensorInfo(v,a.dtype,O.values)}else{var L=new AKe(b,x,d);N=t.runWebGLProgram(L,[a],a.dtype)}}var z=Pe({inputs:{x:N},backend:t,attrs:{shape:v}});return t.disposeIntermediateTensorInfo(N),z}var DKe={kernelName:k.StridedSlice,backendName:"webgl",kernelFunc:_Ke};function FKe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,c=r.preserveShortSequences,l=e.data,f=e.dataSplits,h=t.readSync(l.dataId),p=t.readSync(f.dataId),d=Te(r$e(h,p,a,i,o,s,u,c),2),v=d[0],m=d[1];return[t.makeTensorInfo([v.length],"string",v),t.makeTensorInfo(f.shape,"int32",m)]}var RKe={kernelName:k.StringNGrams,backendName:"webgl",kernelFunc:FKe};function OKe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.skipEmpty,i=e.input,o=e.delimiter;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(i.shape.length!==1)throw new Error("Input must be a vector, got shape: ".concat(i.shape));if(o.shape.length!==0)throw new Error("Delimiter must be a scalar, got shape: ".concat(o.shape));var s=t.readSync(i.dataId),u=t.readSync(o.dataId)[0],c=Te(a$e(s,u,a),3),l=c[0],f=c[1],h=c[2],p=f.length;return[t.makeTensorInfo([p,2],"int32",l),t.makeTensorInfo([p],"string",f),t.makeTensorInfo([2],"int32",new Int32Array(h))]}var PKe={kernelName:k.StringSplit,backendName:"webgl",kernelFunc:OKe};function MKe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=r.numBuckets,i=e.input;if(i.dtype!=="string")throw new Error("Input must be of datatype string");if(a<=0)throw new Error("Number of buckets must be at least 1");var o=t.readSync(i.dataId),s=i$e(o,a);return t.makeTensorInfo(i.shape,"int32",s)}var BKe={kernelName:k.StringToHashBucketFast,backendName:"webgl",kernelFunc:MKe};var LKe="return tan(x);",zKe=Nt({opSnippet:LKe}),$Ke={kernelName:k.Tan,backendName:"webgl",kernelFunc:zKe};var qKe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,WKe=Nt({opSnippet:qKe}),VKe={kernelName:k.Tanh,backendName:"webgl",kernelFunc:WKe};var GKe=function(){function n(e,t){this.variableNames=["A"];for(var r=new Array(e.length),a=0;a<r.length;a++)r[a]=e[a]*t[a];this.outputShape=r,this.rank=r.length;var i=Wt(this.rank),o=UKe(e);this.userCode=`
      void main() {
        `.concat(i,` resRC = getOutputCoords();
        setOutput(getA(`).concat(o,`));
      }
    `)}return n}();function UKe(n){var e=n.length;if(e>5)throw Error("Tile for rank ".concat(e," is not yet supported"));if(e===1)return"imod(resRC, ".concat(n[0],")");for(var t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<n.length;a++)r.push("imod(".concat(t[a],", ").concat(n[a],")"));return r.join()}function Vq(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.reps;if(a.dtype==="string"||a.shape.length>5){var o=t.readSync(a.dataId),s=a.dtype==="string"?o.map(function(h){return k.util.decodeString(h)}):o,u=k.buffer(a.shape,a.dtype,s),c=s$e(u,i);return t.makeTensorInfo(c.shape,c.dtype,c.values)}var l=new GKe(a.shape,i),f=t.runWebGLProgram(l,[a],a.dtype);return f}var HKe={kernelName:k.Tile,backendName:"webgl",kernelFunc:Vq},KKe=function(){function n(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}return n}(),jKe=function(){function n(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}return n}();function lu(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function f$(n){for(var e=1;e<n;)e*=2;return e}function XKe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=r.k,o=r.sorted,s=k.env().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=k.env().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=a.shape,l=c[c.length-1];if(t.shouldExecuteOnCPU([a])||l<s||i>u){var f=t.readSync(a.dataId),h=Te(u$e(f,c,a.dtype,i,o),2),p=h[0],d=h[1];return[t.makeTensorInfo(p.shape,p.dtype,p.values),t.makeTensorInfo(d.shape,d.dtype,d.values)]}if(i===0)return c[c.length-1]=0,[t.makeTensorInfo(c,a.dtype,[]),t.makeTensorInfo(c,"int32",[])];if(l===1)return[a,wh({attrs:{shape:c,dtype:"int32",value:0},backend:t})];var v=t.texData.get(a.dataId),m=v!==null&&v.isPacked,g=m?t.unpackTensor(a):a,y=k.util.sizeFromShape(c),b=y/l,w=Pe({inputs:{x:g},attrs:{shape:[b,l]},backend:t});m&&lu(t,g);for(var x=f$(i),N=f$(l),T=null,E=function(){return T===null?[w,w]:[w,T]},C=function(ne,oe,le){var de=E(),xe=new KKe(le),he=T===null?1:0,ye=[[l],[he],[Number.NEGATIVE_INFINITY],[ne],[oe]],we=T;T=t.runWebGLProgram(xe,de,"int32",ye),lu(t,we)},F=1;F<x;F*=2)for(var D=F*2,O=F;O>=1;O/=2)C(D,O,[b,N]);for(var L=N;L>x;L/=2){var z=E(),$=new jKe([b,L/2]),B=T===null?1:0,W=[[l],[B],[x]],X=T;T=t.runWebGLProgram($,z,"int32",W),lu(t,X);for(var F=x/2,D=F*2,O=F;O>=1;O/=2)C(D,O,T.shape)}var Y=T;T=Yc({inputs:{x:T},backend:t,attrs:{begin:0,size:[b,i]}}),lu(t,Y);var V=Oq({inputs:{x:w,indices:T},backend:t,attrs:{axis:1,batchDims:1}});lu(t,w);var j=c.slice(0,-1);j.push(i),Y=T,T=Pe({inputs:{x:T},attrs:{shape:j},backend:t}),lu(t,Y);var re=V;return V=Pe({inputs:{x:V},attrs:{shape:j},backend:t}),lu(t,re),[V,T]}var YKe={kernelName:k.TopK,backendName:"webgl",kernelFunc:XKe};var ZKe=function(){function n(e,t,r,a,i,o){this.variableNames=["Image","Transforms"],this.outputShape=o;var s=r==="nearest"?1:2,u;switch(a){case"constant":u=1;break;case"reflect":u=2;break;case"wrap":u=3;break;case"nearest":u=4;break;default:u=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(`.concat(u,` == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (`).concat(u,` == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (`).concat(u,` == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < `).concat(e," && 0 <= coordX && coordX < ").concat(t,`) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(`).concat(i,`);
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(`).concat(i,`);
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(`).concat(t,`));
                float mapY = mapCoord(inY, float(`).concat(e,`));

                if (`).concat(s,` == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `)}return n}();function JKe(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.image,i=e.transforms,o=r.interpolation,s=r.fillMode,u=r.fillValue,c=r.outputShape,l=Te(a.shape,4),f=l[0],h=l[1],p=l[2],d=l[3],v=Te(c??[h,p],2),m=v[0],g=v[1],y=[f,m,g,d],b=new ZKe(h,p,o,s,u,y);return t.runWebGLProgram(b,[a,i],"float32")}var QKe={kernelName:k.Transform,backendName:"webgl",kernelFunc:JKe};function e5e(n){var e=n.inputs,t=n.attrs,r=n.backend,a=t.axis,i=e.x;Gc(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=r.readSync(i.dataId),s=c$e(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[r.makeTensorInfo(c,i.dtype,u),r.makeTensorInfo([l.length],"int32",l)]}var t5e={kernelName:k.Unique,backendName:"webgl",kernelFunc:e5e};function n5e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],c=new Array(s-1),l=0,f=0;f<s;f++)f!==i&&(c[l++]=o.shape[f]);var h=[],p=new Array(s).fill(0),d=o.shape.slice();d[i]=1;for(var v=new Array(u),f=0;f<v.length;f++){p[i]=f;var m=Yc({inputs:{x:o},backend:t,attrs:{begin:p,size:d}}),g=Pe({inputs:{x:m},backend:t,attrs:{shape:c}});v[f]=g,h.push(m)}return h.forEach(function(y){return t.disposeIntermediateTensorInfo(y)}),v}var r5e={kernelName:k.Unpack,backendName:"webgl",kernelFunc:n5e};var a5e=function(){function n(e,t){this.variableNames=["x","segmentIds"];var r=e.windowSize,a=e.batchSize,i=e.inSize,o=e.numSegments,s=o*Math.ceil(i/r);this.outputShape=[a,s];var u="0.0",c="sumValue",l=Math.floor(r/4)*4,f=r%4,h=`
        sumValue += dot(values, segFilter);
    `,p="";i%r>0&&(p=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return initializationValue;
        }
      `));var d="";i%r>0&&(d=`
        if (inIdx < 0 || inIdx >= `.concat(i,`) {
          return -1.0;
        }
      `)),this.userCode=`
      const float initializationValue = `.concat(u,`;

      float getValue(int batch, int inIdx) {
        `).concat(p,`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `).concat(d,`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `).concat(o,")) * float(").concat(r,`));
        int currentSeg = int(mod(float(outIdx), float(`).concat(o,`)));

        float sumValue = 0.0;

        for (int i = 0; i < `).concat(l,`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `).concat(h,`
        }

        int inIdx = inOffset + `).concat(l,`;
        if (`).concat(f===1,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `).concat(h,`
        } else if (`).concat(f===2,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `).concat(h,`
        } else if (`).concat(f===3,`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `).concat(h,`
        }
        setOutput(`).concat(c,`);
      }
    `)}return n}();function i5e(n){var e=n.inputs,t=n.backend,r=n.attrs,a=e.x,i=e.segmentIds,o=r.numSegments,s=a.shape.length,u=[],c=0,l=k.backend_util.getAxesPermutation([c],s),f=a;l!=null&&(f=wr({inputs:{x:a},backend:t,attrs:{perm:l}}),u.push(f),c=k.backend_util.getInnerMostAxes(1,s)[0]);var h=k.backend_util.segment_util.computeOutShape(f.shape,c,o),p=k.util.sizeFromShape([f.shape[c]]),d=Pe({inputs:{x:f},backend:t,attrs:{shape:[-1,p]}});u.push(d);var v=k.sumOutType(a.dtype),m=function(x,N,T,E,C){var F=x.shape[0],D=x.shape[1],O=k.backend_util.segment_util.segOpComputeOptimalWindowSize(D,C),L={windowSize:O,inSize:D,batchSize:F,numSegments:C},z=new a5e(L,N),$=t.compileAndRun(z,[x,T],E);if(u.push($),$.shape[1]===C)return $;var B=qq({backend:t,attrs:{start:0,stop:C,step:1,dtype:"float32"}}),W=Vq({inputs:{x:B},backend:t,attrs:{reps:[D/O]}});u.push(B),u.push(W);var X=m($,N,W,E,C);return X},g=m(d,"unsortedSegmentSum",i,v,o),y=Pe({inputs:{x:g},backend:t,attrs:{shape:h}}),b=y;if(l!=null){u.push(y);var w=k.backend_util.getUndoAxesPermutation(l);b=wr({inputs:{x:b},backend:t,attrs:{perm:w}})}return u.forEach(function(x){return t.disposeIntermediateTensorInfo(x)}),b}var o5e={kernelName:k.UnsortedSegmentSum,backendName:"webgl",kernelFunc:i5e},wx,h$,s5e=[nqe,aqe,sqe,lqe,hqe,vqe,gqe,bqe,Sqe,Tqe,Cqe,Dqe,Oqe,Lqe,qqe,Vqe,Uqe,Xqe,Zqe,Qqe,rWe,lWe,hWe,dWe,wWe,kWe,EWe,z$e,AWe,OWe,LWe,GWe,HWe,jWe,YWe,JWe,tVe,aVe,sVe,cVe,fVe,pVe,mVe,yVe,kVe,NVe,IVe,_Ve,FVe,MVe,$Ve,GVe,KVe,YVe,ZVe,QVe,tGe,rGe,iGe,sGe,fGe,dGe,gGe,bGe,kGe,TGe,AGe,RGe,L$e,PGe,FWe,LGe,qGe,GGe,q$e,jGe,JGe,eUe,aUe,sUe,fUe,dUe,yUe,kUe,TUe,IUe,DUe,RUe,PUe,zUe,qUe,VUe,UUe,KUe,ZUe,t6e,i6e,p6e,G$e,g6e,w6e,S6e,E6e,mWe,A6e,D6e,R6e,M6e,$6e,V$e,W6e,G6e,H6e,j6e,X6e,gWe,c6e,J6e,nHe,oHe,H$e,lHe,pHe,gHe,wHe,NHe,EHe,AHe,FHe,OHe,BHe,$He,VHe,KHe,YHe,QHe,nKe,uWe,f6e,iKe,sKe,cKe,fKe,pKe,vKe,gKe,bKe,xKe,NKe,EKe,CKe,DKe,RKe,PKe,BKe,l6e,Q$e,$Ke,VKe,HKe,YKe,QKe,eqe,t5e,r5e,o5e,_6e];try{for(ah=ra(s5e),zc=ah.next();!zc.done;zc=ah.next())p$=zc.value,k.registerKernel(p$)}catch(n){wx={error:n}}finally{try{zc&&!zc.done&&(h$=ah.return)&&h$.call(ah)}finally{if(wx)throw wx.error}}var p$,ah,zc;Li.GPGPUContext=rm;Li.MathBackendWebGL=$x;Li.forceHalfFloat=pq;Li.gpgpu_util=yLe;Li.setWebGLContext=d$;Li.version_webgl=M$e;Li.webgl=B$e;Li.webgl_util=NBe});var VG=J(xu=>{"use strict";Object.defineProperty(xu,"__esModule",{value:!0});function u5e(n){return n&&typeof n=="object"&&"default"in n?n.default:n}var Kx=Cs(),pW=IR(),c5e=u5e(pW),jx=e4(),Xx=PB(),dW=rL(),l5e=Bz(),f5e=Gq(),vW="Abs",mW="Acos",gW="Acosh",pk="Add",h5e="AddN",p5e="All",d5e="Any",yW="ArgMax",bW="ArgMin",wW="Asin",xW="Asinh",kW="Atan",SW="Atanh",NW="Atan2",TW="AvgPool",v5e="AvgPoolGrad",m5e="AvgPool3D",g5e="AvgPool3DGrad",EW="BatchMatMul",IW="BatchToSpaceND",y5e="BroadcastTo",dk="Cast",CW="Ceil",AW="ClipByValue",b5e="Complex",_W="ComplexAbs",DW="Concat",FW="Conv2D",w5e="Conv2DBackpropFilter",RW="Conv2DBackpropInput",x5e="Conv3D",k5e="Conv3DBackpropFilterV2",S5e="Conv3DBackpropInputV2",OW="Cos",PW="Cosh",N5e="Cumprod",MW="Cumsum",T5e="DepthToSpace",BW="DepthwiseConv2dNative",E5e="DepthwiseConv2dNativeBackpropFilter",I5e="DepthwiseConv2dNativeBackpropInput",LW="Dilation2D",C5e="Dilation2DBackpropInput",A5e="Dilation2DBackpropFilter",zW="RealDiv",$W="Elu",_5e="EluGrad",qW="Erf",D5e="Equal",WW="Exp",VW="ExpandDims",GW="Expm1",F5e="FFT",R5e="Fill",UW="Floor",HW="FloorDiv",KW="FusedBatchNorm",jW="GatherV2",O5e="Greater",XW="GreaterEqual",vk="Identity",P5e="IFFT",M5e="Imag",YW="IsFinite",ZW="IsInf",JW="IsNan",QW="LeakyRelu",B5e="Less",L5e="LessEqual",eV="Log",tV="Log1p",z5e="LogicalAnd",$5e="LogicalNot",q5e="LogicalOr",W5e="LogSoftmax",nV="LRN",V5e="LRNGrad",rV="Max",aV="Maximum",iV="MaxPool",G5e="MaxPoolGrad",U5e="MaxPool3D",H5e="MaxPool3DGrad",oV="Mean",sV="Min",uV="Minimum",cV="MirrorPad",lV="Mod",fV="Multiply",hV="Neg",K5e="NotEqual",pV="OnesLike",dV="OneHot",vV="Pack",mV="PadV2",gV="Pow",yV="Prelu",bV="Prod",j5e="Real",wV="Reciprocal",xV="Relu",kV="Reshape",SV="ResizeNearestNeighbor",X5e="ResizeNearestNeighborGrad",NV="ResizeBilinear",Y5e="ResizeBilinearGrad",TV="Relu6",EV="Reverse",IV="Round",CV="Rsqrt",AV="Select",_V="Selu",DV="Slice",FV="Sin",RV="Sinh",OV="Sign",PV="Sigmoid",MV="Softplus",BV="Sqrt",LV="Sum",zV="SpaceToBatchND",$V="SplitV",qV="Softmax",WV="SquaredDifference",Z5e="Square",J5e="StridedSlice",VV="Sub",GV="Tan",UV="Tanh",mk="Tile",Q5e="TopK",hm="Transpose",eje="Unique",HV="Unpack",KV="UnsortedSegmentSum",jV="ZerosLike",XV="Step";var tje=1e-7,nje=1e-4,Yx=class{refCount(e){return ia("refCount")}incRef(e){return ia("incRef")}timerAvailable(){return!0}time(e){return ia("time")}read(e){return ia("read")}readSync(e){return ia("readSync")}readToGPU(e,t){return ia("readToGPU")}numDataIds(){return ia("numDataIds")}disposeData(e,t){return ia("disposeData")}write(e,t,r){return ia("write")}move(e,t,r,a,i){return ia("move")}createTensorFromGPUData(e,t,r){return ia("createTensorFromGPUData")}memory(){return ia("memory")}floatPrecision(){return ia("floatPrecision")}epsilon(){return this.floatPrecision()===32?tje:nje}dispose(){return ia("dispose")}};function ia(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function ie(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function rje(n,e,t=""){ie(gk(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function lo(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function gk(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Ch(n){return n%1===0}function pm(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function qi(n,e){let t=e.length;return n=n==null?e.map((r,a)=>a):[].concat(n),ie(n.every(r=>r>=-t&&r<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),ie(n.every(r=>Ch(r)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(r=>r<0?t+r:r)}function aje(n,e){let t=[],r=[],a=e!=null&&Array.isArray(e)&&e.length===0,i=e==null||a?null:qi(e,n).sort(),o=0;for(let s=0;s<n.length;++s){if(i!=null){if(i[o]===s&&n[s]!==1)throw new Error(`Can't squeeze axis ${s} since its dim '${n[s]}' is not 1`);(i[o]==null||i[o]>s)&&n[s]===1&&(t.push(n[s]),r.push(s)),i[o]<=s&&o++}n[s]!==1&&(t.push(n[s]),r.push(s))}return{newShape:t,keptDims:r}}function ije(n,e){for(let t=0;t<n.length;t++){let r=n[t];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${e} being uploaded contains ${r}.`)}}function oje(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function Zx(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function sje(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function yk(n){return typeof n=="string"||n instanceof String}function uje(n){return typeof n=="boolean"}function cje(n){return typeof n=="number"}function bk(n){return Array.isArray(n)?bk(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":cje(n)?"float32":yk(n)?"string":uje(n)?"bool":"float32"}function Jx(n){return!!(n&&n.constructor&&n.call&&n.apply)}function YV(n){let e=n.length;if(e<2)return[];let t=new Array(e-1);t[e-2]=n[e-1];for(let r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function ZV(n,e,t,r=!1){let a=new Array;if(e.length===1){let i=e[0]*(r?2:1);for(let o=0;o<i;o++)a[o]=t[n+o]}else{let i=e[0],o=e.slice(1),s=o.reduce((u,c)=>u*c)*(r?2:1);for(let u=0;u<i;u++)a[u]=ZV(n+u*s,o,t,r)}return a}function Uq(n,e,t=!1){if(n.length===0)return e[0];let r=n.reduce((a,i)=>a*i)*(t?2:1);if(r===0)return[];if(r!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return ZV(0,n,e,t)}function JV(n,e){let t=wk(n,e);for(let r=0;r<t.length;r++)t[r]=1;return t}function wk(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function Mh(n){n.forEach(e=>{ie(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function xk(n){return n&&n.then&&typeof n.then=="function"}var Hq="tfjsflags",Qx=class{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=lje,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(xn().getBool("IS_TEST")||xn().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){let a=this.urlFlags[e];xn().getBool("IS_TEST")||xn().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${a}.`),this.set(e,a)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];let t=this.evaluateFlag(e);if(xk(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;let e=this.getQueryParams(this.global.location.search);Hq in e&&e[Hq].split(",").forEach(r=>{let[a,i]=r.split(":");this.urlFlags[a]=hje(a,i)})}};function lje(n){let e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...r)=>(fje(e,r[0],r[1]),r.join("="))),e}function fje(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function hje(n,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if(`${+e}`===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${n}.`)}function xn(){return QV}var QV=null;function pje(n){QV=n}var Gx;function eG(){if(Gx==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");Gx=n}return Gx}function dje(){let n=eG();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function kk(n,e){let t=dje();if(t.has(n))return t.get(n);{let r=e();return t.set(n,r),t.get(n)}}function Zc(...n){xn().getBool("IS_TEST")||xn().getBool("PROD")||console.warn(...n)}var tG=kk("kernelRegistry",()=>new Map),ek=kk("gradRegistry",()=>new Map);function Kq(n,e){let t=mje(n,e);return tG.get(t)}function jq(n){return ek.get(n)}function Xq(n){let e=tG.entries(),t=[];for(;;){let{done:r,value:a}=e.next();if(r)break;let[i,o]=a,[s]=i.split("_");s===n&&t.push(o)}return t}function vje(n){let{kernelName:e}=n;ek.has(e)&&xn().getBool("DEBUG")&&Zc(`Overriding the gradient for '${e}'`),ek.set(e,n)}function mje(n,e){return`${e}_${n}`}var gje=c5e||pW;function Sk(n){return gje.fromString(n,!0,16)}var vit=Sk("c3a5c85c97cb3127"),mit=Sk("b492b66fbe98f273"),git=Sk("9ae16a3b2f90404f");function yje(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function nG(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Ah(n)),xn().getBool("DEBUG")&&ije(n,e),yje(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){let t=new Uint8Array(n.length);for(let r=0;r<t.length;++r)Math.round(n[r])!==0&&(t[r]=1);return t}else throw new Error(`Unknown data type ${e}`)}function gm(){return xn().platform.now()}function bje(n,e="utf-8"){return e=e||"utf-8",xn().platform.encode(n,e)}function Yq(n,e="utf-8"){return e=e||"utf-8",xn().platform.decode(n,e)}function Si(n){return xn().platform.isTypedArray(n)}function Ah(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||xk(n)||n==null||Si(n)&&t)e.push(n);else if(Array.isArray(n)||Si(n))for(let r=0;r<n.length;++r)Ah(n[r],e,t);else{let r=-1;for(let a of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(a)&&(r=Math.max(r,Number(a)));for(let a=0;a<=r;a++)Ah(n[a],e,t)}return e}var tk=class{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new nk)}profileKernel(e,t,r){let a,i=()=>{a=r()},o,s=gm();if(this.backendTimer.timerAvailable())o=this.backendTimer.time(i);else{i();for(let c of a)c.dataSync();o=Promise.resolve({kernelMs:gm()-s})}if(xn().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<a.length;c++){let l=a[c];l.data().then(f=>{wje(f,l.dtype,e)})}return{kernelName:e,outputs:a,inputs:t,timeMs:o.then(c=>c.kernelMs),extraInfo:o.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){let{kernelName:t,outputs:r,timeMs:a,inputs:i,extraInfo:o}=e;r.forEach(s=>{Promise.all([s.data(),a,o]).then(u=>{this.logger.logKernelProfile(t,s,u[0],u[1],i,u[2])})})}};function wje(n,e,t){if(e!=="float32")return!1;for(let r=0;r<n.length;r++){let a=n[r];if(isNaN(a)||!isFinite(a))return console.warn(`Found ${a} in the result of '${t}'`),!0}return!1}var nk=class{logKernelProfile(e,t,r,a,i,o){let s=typeof a=="number"?pm(`${a}ms`,9):a.error,u=pm(e,25),c=t.rank,l=t.size,f=pm(t.shape.toString(),14),h="";for(let p in i){let d=i[p];if(d!=null){let v=d.shape||t.shape,m=v.length;h+=`${p}: ${m}D ${m>0?v:""} `}}console.log(`%c${u}	%c${s}	%c${c}D ${f}	%c${l}	%c${h}	%c${o}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};function xje(n,e,t){let r={},a={};for(let u=0;u<e.length;u++)r[e[u].id]=!0;for(let u=0;u<n.length;u++){let c=n[u],l=c.inputs;for(let f in l){let h=l[f],p=!1;for(let d=0;d<e.length;d++)if(r[h.id]){c.outputs.forEach(v=>r[v.id]=!0),p=!0,a[c.id]=!0;break}if(p)break}}let i={};i[t.id]=!0;let o={};for(let u=n.length-1;u>=0;u--){let c=n[u],l=c.inputs;for(let f=0;f<c.outputs.length;f++)if(i[c.outputs[f].id]){for(let h in l)i[l[h].id]=!0,o[c.id]=!0;break}}let s=[];for(let u=0;u<n.length;u++){let c=n[u];if(a[c.id]&&o[c.id]){let l={};for(let h in c.inputs){let p=c.inputs[h];r[p.id]&&(l[h]=p)}let f=Object.assign({},c);f.inputs=l,f.outputs=c.outputs,s.push(f)}}return s}function kje(n,e,t,r){for(let a=e.length-1;a>=0;a--){let i=e[a],o=[];if(i.outputs.forEach(u=>{let c=n[u.id];c!=null?o.push(c):o.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);let s=i.gradient(o);for(let u in i.inputs){if(!(u in s))throw new Error(`Cannot backprop through input ${u}. Available gradients found: ${Object.keys(s)}.`);let c=t(()=>s[u]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${u} must have 'float32' dtype, but has '${c.dtype}'`);let l=i.inputs[u];if(!gk(c.shape,l.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${u}' has shape '${c.shape}', which does not match the shape of the input '${l.shape}'`);if(n[l.id]==null)n[l.id]=c;else{let f=n[l.id];n[l.id]=r(f,c),f.dispose()}}}}var Zq=20,xh=3,Ux=7;function Sje(n,e,t,r){let a=YV(e),i=Nje(n,e,t,a),o=e.length,s=dm(n,e,t,a,i),u=["Tensor"];return r&&(u.push(`  dtype: ${t}`),u.push(`  rank: ${o}`),u.push(`  shape: [${e}]`),u.push("  values:")),u.push(s.map(c=>"    "+c).join(`
`)),u.join(`
`)}function Nje(n,e,t,r){let a=lo(e),i=r[r.length-1],o=new Array(i).fill(0),s=e.length,u=t==="complex64"?Eh(n):n;if(s>1)for(let c=0;c<a/i;c++){let l=c*i;for(let f=0;f<i;f++)o[f]=Math.max(o[f],Th(u[l+f],0,t).length)}return o}function Th(n,e,t){let r;return Array.isArray(n)?r=`${parseFloat(n[0].toFixed(Ux))} + ${parseFloat(n[1].toFixed(Ux))}j`:yk(n)?r=`'${n}'`:t==="bool"?r=rG(n):r=parseFloat(n.toFixed(Ux)).toString(),pm(r,e)}function rG(n){return n===0?"false":"true"}function dm(n,e,t,r,a,i=!0){let o=t==="complex64"?2:1,s=e[0],u=e.length;if(u===0){if(t==="complex64"){let v=Eh(n);return[Th(v[0],0,t)]}return t==="bool"?[rG(n[0])]:[n[0].toString()]}if(u===1){if(s>Zq){let m=xh*o,g=Array.from(n.slice(0,m)),y=Array.from(n.slice((s-xh)*o,s*o));return t==="complex64"&&(g=Eh(g),y=Eh(y)),["["+g.map((b,w)=>Th(b,a[w],t)).join(", ")+", ..., "+y.map((b,w)=>Th(b,a[s-xh+w],t)).join(", ")+"]"]}let v=t==="complex64"?Eh(n):Array.from(n);return["["+v.map((m,g)=>Th(m,a[g],t)).join(", ")+"]"]}let c=e.slice(1),l=r.slice(1),f=r[0]*o,h=[];if(s>Zq){for(let v=0;v<xh;v++){let m=v*f,g=m+f;h.push(...dm(n.slice(m,g),c,t,l,a,!1))}h.push("...");for(let v=s-xh;v<s;v++){let m=v*f,g=m+f;h.push(...dm(n.slice(m,g),c,t,l,a,v===s-1))}}else for(let v=0;v<s;v++){let m=v*f,g=m+f;h.push(...dm(n.slice(m,g),c,t,l,a,v===s-1))}let p=u===2?",":"";h[0]="["+(s>0?h[0]+p:"");for(let v=1;v<h.length-1;v++)h[v]=" "+h[v]+p;let d=`,
`;for(let v=2;v<u;v++)d+=`
`;return h[h.length-1]=" "+h[h.length-1]+"]"+(i?"":d),h}function Eh(n){let e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var zi=null,kh=null,Tje=null;function Eje(n){zi=n}function Ije(n){Tje=n}var Sr=class{constructor(e,t,r,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=lo(e),this.strides=YV(e),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){let e=await this.data();return kh.buffer(this.shape,this.dtype,e)}bufferSync(){return kh.buffer(this.shape,this.dtype,this.dataSync())}async array(){let e=await this.data();return Uq(this.shape,e,this.dtype==="complex64")}arraySync(){return Uq(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();let e=zi().read(this.dataId);if(this.dtype==="string"){let t=await e;try{return t.map(r=>Yq(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),zi().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();let e=zi().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>Yq(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();let e=await zi().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(zi().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return kh.print(this,e)}clone(){return this.throwIfDisposed(),kh.clone(this)}toString(e=!1){let t=this.dataSync();return Sje(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),kh.cast(this,e)}variable(e=!0,t,r){return this.throwIfDisposed(),zi().makeVariable(this,e,t,r)}};Object.defineProperty(Sr,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function ce(){return kk("Tensor",()=>Sr)}ce();var Qc=class extends Sr{constructor(e,t,r,a){super(e.shape,e.dtype,e.dataId,a),this.trainable=t,this.name=r}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!gk(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);zi().disposeTensor(this),this.dataId=e.dataId,zi().incRef(this,null)}dispose(){zi().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(Qc,Symbol.hasInstance,{value:n=>n instanceof Sr&&n.assign!=null&&n.assign instanceof Function});var Jq;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(Jq||(Jq={}));var rk;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(rk||(rk={}));var ak;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(ak||(ak={}));var ik;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(ik||(ik={}));var ok;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(ok||(ok={}));var Cje={float32:ik,int32:rk,bool:ak,complex64:ok};function Aje(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return Cje[n][e]}function Qn(n,e){if(n.dtype===e.dtype)return[n,e];let t=Aje(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function aG(n){let e=[];return iG(n,e,new Set),e}function iG(n,e,t){if(n==null)return;if(n instanceof Sr){e.push(n);return}if(!_je(n))return;let r=n;for(let a in r){let i=r[a];t.has(i)||(t.add(i),iG(i,e,t))}}function _je(n){return Array.isArray(n)||typeof n=="object"}function Hx(n){return n.kernelName!=null}var ym=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(let e in this.registeredVariables)this.registeredVariables[e].dispose()}},ns=class{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new ym}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;let e=this.getSortedBackends();for(let t=0;t<e.length;t++){let r=e[t];if(await this.initializeBackend(r).success){await this.setBackend(r);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){let{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){let{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,r=1){return e in this.registryFactory?(Zc(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:r},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;let{success:t,asyncInit:r}=this.initializeBackend(e);if(!(r?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new tk(this.backendInstance),!0}setupRegisteredKernels(){Xq(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){Xq(e).forEach(r=>{r.disposeFunc!=null&&r.disposeFunc(this.registry[e])})}initializeBackend(e){let t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{let r=t.factory();if(r&&!(r instanceof Yx)&&typeof r.then=="function"){let a=++this.pendingBackendInitId,i=r.then(o=>a<this.pendingBackendInitId?!1:(this.registry[e]=o,this.pendingBackendInit=null,!0)).catch(o=>(a<this.pendingBackendInitId||(this.pendingBackendInit=null,Zc(`Initialization of backend ${e} failed`),Zc(o.stack||o.message)),!1));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}else return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(r){return Zc(`Initialization of backend ${e} failed`),Zc(r.stack||r.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){let e=this.getSortedBackends();for(let t=0;t<e.length;t++){let r=e[t],{success:a,asyncInit:i}=this.initializeBackend(r);if(i||a)return{name:r,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){let r=this.state.tensorInfo.get(t),a=r.backend,i=this.readSync(t),o=a.refCount(t);a.disposeData(t,!0),r.backend=e,e.move(t,i,r.shape,r.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let r=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");r=e}let a;return this.scopedRun(()=>this.startScope(r),()=>this.endScope(a),()=>(a=t(),a instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),a))}scopedRun(e,t,r){e();try{let a=r();return t(),a}catch(a){throw t(),a}}nextTensorId(){return ns.nextTensorId++}nextVariableId(){return ns.nextVariableId++}clone(e){let t=ae.runKernel(vk,{x:e}),r={x:e},a=o=>({x:()=>{let s="float32",u={x:o},c={dtype:s};return ae.runKernel(dk,u,c)}}),i=[];return this.addTapeNode(this.state.activeScope.name,r,[t],a,i,{}),t}runKernel(e,t,r){if(this.backendName==null&&this.backend,!(Kq(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:r})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,r){let a=this.backend.numDataIds(),i=0;r.forEach(u=>{i+=u.dtype==="complex64"?3:1});let o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-t-i-o;if(s>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${s} data ids) after running '${e}'`)}runKernelFunc(e){let t,r=[],a=this.isTapeOn(),i=this.state.numBytes,o=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let s;this.backendName==null&&this.backend;let u,c=Hx(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(Hx(e)){let{kernelName:d,inputs:v,attrs:m}=e;this.backendName==null&&this.backend;let g=Kq(d,this.backendName);ie(g!=null,()=>`Cannot find registered kernel '${d}' for backend '${this.backendName}'`),s=()=>{let y=this.backend.numDataIds();u=g.kernelFunc({inputs:v,attrs:m,backend:this.backend});let b=Array.isArray(u)?u:[u];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(d,y,b);let w=b.map(x=>x.rank!=null?x:this.makeTensorFromTensorInfo(x));if(a){let x=this.getTensorsForGradient(d,v,w);r=this.saveTensorsForBackwardMode(x)}return w}}else{let{forwardFunc:d}=e,v=m=>{!a||(r=m.map(g=>this.keep(this.clone(g))))};s=()=>{let m=this.backend.numDataIds();u=this.tidy(()=>d(this.backend,v));let g=Array.isArray(u)?u:[u];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,m,g),g}}let{inputs:l,attrs:f}=e,h=Hx(e)?null:e.backwardsFunc,p;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=s():(p=this.profiler.profileKernel(c,l,()=>s()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(p),t=p.outputs)}),a&&this.addTapeNode(c,l,t,h,r,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-i,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-o,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(l).map(d=>l[d]!=null?l[d].shape:null),outputShapes:t.map(d=>d.shape),kernelTimeMs:p.timeMs,extraInfo:p.extraInfo}),Array.isArray(u)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(r=>this.keep(this.clone(r)))}getTensorsForGradient(e,t,r){let a=jq(e);if(a!=null){let i=a.inputsToSave||[],o=a.outputsToSave||[],s;a.saveAllInputs?(ie(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),s=Object.keys(t).map(c=>t[c])):s=i.map(c=>t[c]);let u=r.filter((c,l)=>o[l]);return s.concat(u)}return[]}makeTensor(e,t,r,a){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",a=a||this.backend;let i=e;r==="string"&&yk(e[0])&&(i=e.map(u=>bje(u)));let o=a.write(i,t,r),s=new Sr(t,r,o,this.nextTensorId());if(this.trackTensor(s,a),r==="string"){let u=this.state.tensorInfo.get(o),c=sje(i);this.state.numBytes+=c-u.bytes,u.bytes=c}return s}makeTensorFromDataId(e,t,r,a){r=r||"float32";let i={dataId:e,shape:t,dtype:r};return this.makeTensorFromTensorInfo(i,a)}makeTensorFromTensorInfo(e,t){let{dataId:r,shape:a,dtype:i}=e,o=new Sr(a,i,r,this.nextTensorId());return this.trackTensor(o,t),o}makeVariable(e,t=!0,r,a){r=r||this.nextVariableId().toString(),a!=null&&a!==e.dtype&&(e=e.cast(a));let i=new Qc(e,t,r,this.nextTensorId());if(this.state.registeredVariables[i.name]!=null)throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let r=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(r=e.size*Zx(e.dtype)),this.state.numBytes+=r,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r})),e instanceof Qc||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;let t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){let r=e.size*Zx(e.dtype);this.state.numBytes-=r}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(let e in this.state.registeredVariables){let t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){let e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;let t=this.state.numBytes,r=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(a=>a.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r;for(let a of this.state.activeProfile.kernels)a.kernelTimeMs=await a.kernelTimeMs,a.extraInfo=await a.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,r,a,i,o){let s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:i},u=jq(e);u!=null&&(a=u.gradFunc),a!=null&&(s.gradient=c=>(c=c.map((l,f)=>{if(l==null){let h=r[f],p=wk(h.size,h.dtype);return this.makeTensor(p,h.shape,h.dtype)}return l}),a(c.length>1?c:c[0],i,o))),this.state.activeTape.push(s)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){let t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){let t=aG(e),r=new Set(t.map(i=>i.id));for(let i=0;i<this.state.activeScope.track.length;i++){let o=this.state.activeScope.track[i];!o.kept&&!r.has(o.id)&&o.dispose()}let a=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(i=>{!i.kept&&i.scopeId===a.id&&this.track(i)})}gradients(e,t,r,a=!1){if(ie(t.length>0,()=>"gradients() received an empty list of xs."),r!=null&&r.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${r.dtype}'`);let i=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));ie(i instanceof Sr,()=>"The result y returned by f() must be a tensor.");let o=xje(this.state.activeTape,t,i);if(!a&&o.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let s={};s[i.id]=r??Dje(i.shape),kje(s,o,c=>this.tidy(c),Rje);let u=t.map(c=>s[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(let l of c.saved)l.dispose()}),this.state.activeTape=null),{value:i,grads:u}})}customGrad(e){return ie(Jx(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{ie(t.every(s=>s instanceof Sr),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let r,a={};t.forEach((s,u)=>{a[u]=s});let i=(s,u)=>(r=e(...t,u),ie(r.value instanceof Sr,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),ie(Jx(r.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),r.value),o=(s,u)=>{let c=r.gradFunc(s,u),l=Array.isArray(c)?c:[c];ie(l.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),ie(l.every(h=>h instanceof Sr),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let f={};return l.forEach((h,p)=>{f[p]=()=>h}),f};return this.runKernelFunc({forwardFunc:i,backwardsFunc:o,inputs:a})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){let t=gm(),r=await this.backend.time(e);return r.wallMs=gm()-t,r}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new ym;for(let e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}};ns.nextTensorId=0;ns.nextVariableId=0;function Dje(n){let e=JV(lo(n),"float32");return ae.makeTensor(e,n,"float32")}function Fje(){let n=eG();if(n._tfengine==null){let e=new Qx(n);n._tfengine=new ns(e)}return pje(n._tfengine.ENV),Eje(()=>n._tfengine),n._tfengine}var ae=Fje();function Rje(n,e){let t={a:n,b:e};return ae.runKernel(pk,t)}function Oje(n,e){let t=n;if(Si(n))return e==="string"?[]:[n.length];if(typeof n=="object"){if("texture"in n){let i=n.channels||"RGBA";return[n.height,n.width*i.length]}else if("buffer"in n&&!(n.buffer instanceof ArrayBuffer))return[n.buffer.size/(e==null?4:Zx(e))]}if(!Array.isArray(n))return[];let a=[];for(;Array.isArray(t)||Si(t)&&e!=="string";)a.push(t.length),t=t[0];return Array.isArray(n)&&xn().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&oG(n,a,[]),a}function oG(n,e,t){if(t=t||[],!Array.isArray(n)&&!Si(n)){ie(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}ie(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),ie(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);let r=e.slice(1);for(let a=0;a<n.length;++a)oG(n[a],r,t.concat(a))}function Qq(n,e,t,r){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${r}' must be ${n} tensor, but got ${e} tensor`)}}function ee(n,e,t,r="numeric"){if(n instanceof Sr)return Qq(r,n.dtype,e,t),n;let a=bk(n);if(a!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),Qq(r,a,e,t),n==null||!Si(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){let u=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${u}'`)}let i=Oje(n,a);!Si(n)&&!Array.isArray(n)&&(n=[n]);let s=a!=="string"?nG(n,a):Ah(n,[],!0);return ae.makeTensor(s,i,a)}function sG(n,e,t,r="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((i,o)=>ee(i,`${e}[${o}]`,t,r))}var Pje="__op";function ue(n){let e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+Pje;let a=(...i)=>{ae.startScope(t);try{let o=r(...i);return xk(o)&&console.error("Cannot return a Promise inside of tidy."),ae.endScope(o),o}catch(o){throw ae.endScope(null),o}};return Object.defineProperty(a,"name",{value:t,configurable:!0}),a}function Mje(n,e){let t=ee(n,"x","cast");if(!oje(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");let r={x:t},a={dtype:e};return ae.runKernel(dk,r,a)}var ot=ue({cast_:Mje});function Bje(n,e){let t=ee(n,"a","mul"),r=ee(e,"b","mul");[t,r]=Qn(t,r);let a={a:t,b:r};return ae.runKernel(fV,a)}var $e=ue({mul_:Bje});function Lje(n,e=0){let r={x:ee(n,"x","step")},a={alpha:e};return ae.runKernel(XV,r,a)}var Tm=ue({step_:Lje});var uG={kernelName:vW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(n,Tm(ot(t,"float32"),-1))}}};function zje(n,e){let t=ee(n,"a","floorDiv"),r=ee(e,"b","floorDiv");[t,r]=Qn(t,r);let a={a:t,b:r};return ae.runKernel(HW,a)}var cG=ue({floorDiv_:zje});function $je(n,e){let t=ee(n,"a","div"),r=ee(e,"b","div");if([t,r]=Qn(t,r),t.dtype==="int32"&&r.dtype==="int32")return cG(t,r);let a={a:t,b:r},i={};return ae.runKernel(zW,a,i)}var Fn=ue({div_:$je});function qje(n){let t={x:ee(n,"x","neg")};return ae.runKernel(hV,t)}var Nr=ue({neg_:qje});function Wje(n,e,t,r){if(r==null)r=bk(n);else if(r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(typeof n=="object"&&("texture"in n||"buffer"in n&&!(n.buffer instanceof ArrayBuffer))){if(r!=="float32"&&r!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${r}.`);return ae.backend.createTensorFromGPUData(n,e||t,r)}if(!Si(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Mh(e);let a=lo(e),i=lo(t);ie(a===i,()=>`Based on the provided shape, [${e}], the tensor should have ${a} values but has ${i}`);for(let o=0;o<t.length;++o){let s=t[o],u=o===t.length-1?s!==lo(e.slice(o)):!0;ie(t[o]===e[o]||!u,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!Si(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=r!=="string"?nG(n,r):Ah(n,[],!0),ae.makeTensor(n,e,r)}function Jn(n,e){if((Si(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Si(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Wje(n,[],[],e)}function Vje(n){let t={x:ee(n,"x","sqrt","float32")};return ae.runKernel(BV,t)}var rs=ue({sqrt_:Vje});function Gje(n){let e=ee(n,"x","square"),t={};return ae.runKernel("Square",{x:e},t)}var sr=ue({square_:Gje});function Uje(n,e){let t=ee(n,"a","sub"),r=ee(e,"b","sub");[t,r]=Qn(t,r);let a={a:t,b:r};return ae.runKernel(VV,a)}var fr=ue({sub_:Uje});var Hje={kernelName:mW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>{let r=sr(ot(t,"float32")),a=rs(fr(Jn(1),r));return Nr(Fn(n,a))}}}};var Kje={kernelName:gW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>{let r=rs(fr(sr(ot(t,"float32")),1));return Fn(n,r)}}}};function ur(n,e){let t=[];for(let r=0;r<e.length;r++){let a=n[n.length-r-1],i=e.length-r-1,o=e[i];(a==null||a===1&&o>1)&&t.unshift(i)}return t}function Rn(n,e){let t=[],r=Math.max(n.length,e.length);for(let a=0;a<r;a++){let i=n[n.length-a-1];i==null&&(i=1);let o=e[e.length-a-1];if(o==null&&(o=1),i===1)t.unshift(o);else if(o===1)t.unshift(i);else if(i!==o){let s=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(s)}else t.unshift(i)}return t}function jje(n,e){let r={x:ee(n,"x","reshape","string_or_numeric")},a={shape:e};return ae.runKernel(kV,r,a)}var pe=ue({reshape_:jje});function Xje(n,e=null,t=!1){let r=ee(n,"x","sum");r.dtype==="bool"&&(r=ot(r,"int32"));let a={x:r},i={axis:e,keepDims:t};return ae.runKernel(LV,a,i)}var Tt=ue({sum_:Xje});var Yje={kernelName:pk,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e,a=Rn(t.shape,r.shape);return{a:()=>{let s=n,u=ur(t.shape,a);return u.length>0&&(s=Tt(s,u)),pe(s,t.shape)},b:()=>{let s=n,u=ur(r.shape,a);return u.length>0&&(s=Tt(s,u)),pe(s,r.shape)}}}};var Zje={kernelName:h5e,saveAllInputs:!0,gradFunc:(n,e)=>{let t={};return e.forEach((r,a)=>{t[a]=()=>n.clone()}),t}};function Jje(n){let t={x:ee(n,"x","zerosLike")};return ae.runKernel(jV,t)}var kn=ue({zerosLike_:Jje});var Qje={kernelName:yW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>kn(t)}}};var e8e={kernelName:bW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>kn(t)}}};var t8e={kernelName:wW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Fn(n,rs(fr(Jn(1),sr(ot(t,"float32")))))}}};function n8e(n,e){let t=ee(n,"a","add"),r=ee(e,"b","add");[t,r]=Qn(t,r);let a={a:t,b:r};return ae.runKernel(pk,a)}var Ya=ue({add_:n8e});var r8e={kernelName:xW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>{let r=rs(Ya(Jn(1),sr(ot(t,"float32"))));return Fn(n,r)}}}};var a8e={kernelName:NW,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e,a=Rn(t.shape,r.shape);return{a:()=>{let s=Ya(sr(t),sr(r)),u=$e(n,Fn(r,s)),c=ur(t.shape,a);return c.length>0&&(u=Tt(u,c)),pe(u,t.shape)},b:()=>{let s=Ya(sr(t),sr(r)),u=Nr($e(n,Fn(t,s))),c=ur(r.shape,a);return c.length>0&&(u=Tt(u,c)),pe(u,r.shape)}}}};var i8e={kernelName:kW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Fn(n,Ya(sr(ot(t,"float32")),1))}}};var o8e={kernelName:SW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Fn(n,fr(Jn(1),sr(ot(t,"float32"))))}}};function s8e(n,e,t,r,a,i,o="channelsLast"){let[s,u]=_h(e),c;if(o==="channelsLast")c=[s,u,n[3],n[3]];else if(o==="channelsFirst")c=[s,u,n[1],n[1]];else throw new Error(`Unknown dataFormat ${o}`);return u8e(n,c,t,r,a,i,!1,o)}function u8e(n,e,t,r,a,i,o=!1,s="channelsLast"){let[u,c,l,f]=[-1,-1,-1,-1];if(s==="channelsLast")[u,c,l,f]=n;else if(s==="channelsFirst")[u,f,c,l]=n;else throw new Error(`Unknown dataFormat ${s}`);let[h,p,,d]=e,[v,m]=_h(t),[g,y]=_h(r),b=sk(h,g),w=sk(p,y),{padInfo:x,outHeight:N,outWidth:T}=f8e(a,c,l,v,m,b,w,i,s),E=o?d*f:d,C;return s==="channelsFirst"?C=[u,E,N,T]:s==="channelsLast"&&(C=[u,N,T,E]),{batchSize:u,dataFormat:s,inHeight:c,inWidth:l,inChannels:f,outHeight:N,outWidth:T,outChannels:E,padInfo:x,strideHeight:v,strideWidth:m,filterHeight:h,filterWidth:p,effectiveFilterHeight:b,effectiveFilterWidth:w,dilationHeight:g,dilationWidth:y,inShape:n,outShape:C,filterShape:e}}function c8e(n,e,t,r,a){r==null&&(r=l8e(n,e,t));let i=n[0],o=n[1],s=bm((i-e+2*r)/t+1,a),u=bm((o-e+2*r)/t+1,a);return[s,u]}function l8e(n,e,t,r=1){let a=sk(e,r);return Math.floor((n[0]*(t-1)-t+a)/2)}function _h(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function sk(n,e){return e<=1?n:n+(n-1)*(e-1)}function f8e(n,e,t,r,a,i,o,s,u){let c,l,f;if(typeof n=="number"){c={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};let p=c8e([e,t],i,r,n,s);l=p[0],f=p[1]}else if(n==="same"){l=Math.ceil(e/r),f=Math.ceil(t/a);let h=Math.max(0,(l-1)*r+i-e),p=Math.max(0,(f-1)*a+o-t),d=Math.floor(h/2),v=h-d,m=Math.floor(p/2),g=p-m;c={top:d,bottom:v,left:m,right:g,type:"SAME"}}else if(n==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-i+1)/r),f=Math.ceil((t-o+1)/a);else if(typeof n=="object"){let h=u==="channelsLast"?n[1][0]:n[2][0],p=u==="channelsLast"?n[1][1]:n[2][1],d=u==="channelsLast"?n[2][0]:n[3][0],v=u==="channelsLast"?n[2][1]:n[3][1];c={top:h,bottom:p,left:d,right:v,type:h===0&&p===0&&d===0&&v===0?"VALID":"EXPLICIT"},l=bm((e-i+h+p)/r+1,s),f=bm((t-o+d+v)/a+1,s)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:c,outHeight:l,outWidth:f}}function bm(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function Dh(n){let[e,t,r]=_h(n);return e===1&&t===1&&r===1}function rl(n,e){return Dh(n)||Dh(e)}function wm(n){return _h(n).every(e=>e>0)}function Ni(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")ie(Ch(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(r=>{r.forEach(a=>{ie(Ch(a),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${a}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}function h8e(n,e,t,r,a,i){let o=ee(n,"dy","avgPool3dGrad"),s=ee(e,"input","avgPool3dGrad"),u=o,c=s,l=!1;s.rank===4&&(l=!0,u=pe(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=pe(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),ie(u.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),ie(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),Ni("avgPool3dGrad",a,i);let f={dy:u,input:c},h={filterSize:t,strides:r,pad:a,dimRoundingMode:i},p=ae.runKernel(g5e,f,h);return l?pe(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var p8e=ue({avgPool3dGrad_:h8e});var d8e={kernelName:m5e,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{filterSize:a,strides:i,pad:o,dimRoundingMode:s}=t;return{x:()=>p8e(n,r,a,i,o,s)}}};function v8e(n,e,t,r,a){let i=ee(n,"dy","avgPoolGrad"),o=ee(e,"input","avgPoolGrad");ie(o.rank===i.rank,()=>`Rank of input (${o.rank}) does not match rank of dy (${i.rank})`);let s=o,u=i,c=!1;o.rank===3&&(c=!0,s=pe(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=pe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),ie(u.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${u.rank}.`),ie(s.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${s.rank}.`);let l={dy:u,input:s},f={filterSize:t,strides:r,pad:a},h=ae.runKernel(v5e,l,f);return c?pe(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var m8e=ue({avgPoolGrad_:v8e});var g8e={kernelName:TW,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{filterSize:a,strides:i,pad:o}=t;return{x:()=>m8e(n,r,a,i,o)}}};function y8e(n,e,t=!1,r=!1){let a=ee(n,"a","matMul"),i=ee(e,"b","matMul");[a,i]=Qn(a,i);let o={a,b:i},s={transposeA:t,transposeB:r};return ae.runKernel(EW,o,s)}var xa=ue({matMul_:y8e});var b8e={kernelName:EW,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{let[r,a]=e,{transposeA:i,transposeB:o}=t;return!i&&!o?{a:()=>xa(n,a,!1,!0),b:()=>xa(r,n,!0,!1)}:!i&&o?{a:()=>xa(n,a,!1,!1),b:()=>xa(n,r,!0,!1)}:i&&!o?{a:()=>xa(a,n,!1,!0),b:()=>xa(r,n,!1,!1)}:{a:()=>xa(a,n,!0,!0),b:()=>xa(n,r,!0,!0)}}};function w8e(n,e,t){let r=ee(n,"x","spaceToBatchND");ie(r.rank>=1+e.length,()=>`input rank ${r.rank} should be > than [blockShape] ${e.length}`),ie(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),ie(r.shape.reduce((o,s,u)=>u>0&&u<=e.length?o&&(s+t[u-1][0]+t[u-1][1])%e[u-1]===0:o,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);let a={x:r},i={blockShape:e,paddings:t};return ae.runKernel(zV,a,i)}var Nk=ue({spaceToBatchND_:w8e});var x8e={kernelName:IW,gradFunc:(n,e,t)=>{let{blockShape:r,crops:a}=t;return{x:()=>Nk(n,r,a)}}};var k8e={kernelName:y5e,gradFunc:(n,e,t)=>{let r=t,a=r.inputShape,i=r.shape,o=Array.from(i);for(let u=a.length-1;u>=0;u--)if(a[u]===i[u])o[u]=1;else if(a[u]!==1)throw new Error(`broadcastTo(): [${a}] cannot be broadcast to [${i}].`);let s=[];for(let u=0;u<o.length;u++)o[u]>1&&s.push(u);return{x:()=>Tt(n,s,!0)}}};var S8e={kernelName:dk,gradFunc:n=>({x:()=>n.clone()})};var N8e={kernelName:CW,gradFunc:n=>({x:()=>kn(n)})};function T8e(n,e){let t=ee(n,"a","greaterEqual","string_or_numeric"),r=ee(e,"b","greaterEqual","string_or_numeric");[t,r]=Qn(t,r),Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(XW,a)}var Em=ue({greaterEqual_:T8e});function E8e(n,e){let t=ee(n,"a","lessEqual","string_or_numeric"),r=ee(e,"b","lessEqual","string_or_numeric");[t,r]=Qn(t,r),Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(L5e,a)}var Im=ue({lessEqual_:E8e});function I8e(n,e){let t=ee(n,"a","logicalAnd","bool"),r=ee(e,"b","logicalAnd","bool");Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(z5e,a)}var Fh=ue({logicalAnd_:I8e});function C8e(n){let t={x:ee(n,"x","clone","string_or_numeric")};return ae.runKernel(vk,t)}var lG=ue({clone_:C8e});function A8e(n,e){let t=ee(n,"broadcastTo","x"),r=t.shape;if(Mh(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){let c=t.shape.slice();for(;c.length<e.length;)c.unshift(1);t=pe(t,c)}let a=t.shape,i=Array.from(e);for(let c=e.length-1;c>=0;c--)if(a[c]===e[c])i[c]=1;else if(t.shape[c]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${e}].`);if(i.map((c,l)=>c>1?l:-1).filter(c=>c>=0).length===0)return lG(t);let s={x:t},u={reps:i};return ae.runKernel(mk,s,u)}var vm=ue({broadcastTo_:A8e});function _8e(n,e,t){let r=ee(e,"a","where"),a=ee(t,"b","where"),i=ee(n,"condition","where","bool"),o=Rn(Rn(i.shape,r.shape),a.shape),s=vm(i,o),u=vm(r,o),c=vm(a,o),l={condition:s,t:u,e:c};return ae.runKernel(AV,l)}var fo=ue({where_:_8e});var D8e={kernelName:AW,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{clipValueMin:a,clipValueMax:i}=t;return{x:()=>fo(Fh(Em(r,a),Im(r,i)),n,kn(n))}}};var F8e={kernelName:_W,inputsToSave:["x"],gradFunc:uG.gradFunc};function R8e(n,e,t=0){let a={x:ee(n,"x","split")},i={numOrSizeSplits:e,axis:t};return ae.runKernel($V,a,i)}var xm=ue({split_:R8e});var O8e={kernelName:DW,saveAllInputs:!0,gradFunc:(n,e,t)=>{let r=e.map(u=>u.shape),{axis:a}=t,i=qi(a,e[0].shape)[0],o=r.map(u=>u[i]);return xm(n,o,i).map(u=>()=>u)}};function P8e(n,e,t,r,a,i="NHWC",o){let s=n;n.rank===3&&(s=pe(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let u=e;u.rank===3&&(u=pe(e,[1,e.shape[0],e.shape[1],e.shape[2]])),ie(s.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${s.shape}.`),ie(u.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`),ie(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);let c=i==="NHWC"?s.shape[3]:s.shape[1],l=i==="NHWC"?u.shape[3]:u.shape[1];ie(c===t[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${t[2]}.`),ie(l===t[3],()=>`Error in conv2dDerFilter: depth of dy (${l}) must match output depth for filter (${t[3]}).`),Ni("conv2dDerFilter",a,o);let f={x:s,dy:u},h={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:t};return ae.runKernel(w5e,f,h)}var fG=ue({conv2DBackpropFilter_:P8e});function M8e(n,e,t,r,a,i="NHWC",o){ie(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let s=n,u=e,c=!1;e.rank===3&&(c=!0,u=pe(e,[1,e.shape[0],e.shape[1],e.shape[2]]),s=[1,n[0],n[1],n[2]]),ie(s.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${s.length}.`),ie(u.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`),ie(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);let l=i==="NHWC"?s[3]:s[1],f=i==="NHWC"?u.shape[3]:u.shape[1];ie(l===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[2]}.`),ie(f===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${t.shape[3]}.`),Ni("conv2dDerInput",a,o);let h={dy:u,filter:t},p={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},d=ae.runKernel(RW,h,p);return c?pe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var hG=ue({conv2DBackpropInput_:M8e});var B8e={kernelName:FW,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{let[r,a]=e,{dilations:i,strides:o,pad:s,dataFormat:u}=t;return ie(Dh(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>hG(r.shape,n,a,o,s,u),filter:()=>fG(r,n,a.shape,o,s,u)}}};function L8e(n,e,t,r,a="NHWC",i=[1,1],o){let s=ee(n,"x","conv2d","float32"),u=ee(e,"filter","conv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=pe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ie(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),ie(u.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`),Ni("conv2d",r,o);let f=a==="NHWC"?c.shape[3]:c.shape[1];ie(f===u.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${u.shape[2]}.`),ie(rl(t,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),ie(wm(i),()=>"Error in conv2D: Dilated rates should be larger than 0."),ie(wm(t),()=>"Error in conv2D: Strides should be larger than 0.");let h={x:c,filter:u},p={strides:t,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},d=ae.runKernel(FW,h,p);return l?pe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Cm=ue({conv2d_:L8e});var z8e={kernelName:RW,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{let[r,a]=e,{strides:i,pad:o,dataFormat:s,dimRoundingMode:u}=t;return{dy:()=>Cm(n,a,i,o,s,1,u),filter:()=>fG(n,r,a.shape,i,o,s,u)}}};function $8e(n,e,t,r,a){let i=n;n.rank===4&&(i=pe(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let o=e;o.rank===4&&(o=pe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),ie(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),ie(o.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`),ie(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),ie(i.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${t[3]}.`),ie(o.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${t[4]}).`);let s={x:i,dy:o},u={strides:r,pad:a,filterShape:t};return ae.runKernel(k5e,s,u)}var q8e=ue({conv3DBackpropFilter_:$8e});function W8e(n,e,t,r,a){ie(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let i=n,o=e,s=!1;e.rank===4&&(s=!0,o=pe(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),i=[1,n[0],n[1],n[2],n[3]]);let u=i[4],c=o.shape[4];ie(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),ie(o.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`),ie(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),ie(u===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${t.shape[3]}.`),ie(c===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${t.shape[4]}.`);let l={dy:o,filter:t},f={pad:a,strides:r,inputShape:i},h=ae.runKernel(S5e,l,f);return s?pe(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}var V8e=ue({conv3DBackpropInput_:W8e});var G8e={kernelName:x5e,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{let{dilations:r,strides:a,pad:i}=t;ie(Dh(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);let[o,s]=e;return{x:()=>V8e(o.shape,n,s,a,i),filter:()=>q8e(o,n,s.shape,a,i)}}};function U8e(n){let t={x:ee(n,"x","sin","float32")};return ae.runKernel(FV,t)}var pG=ue({sin_:U8e});var H8e={kernelName:OW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(Nr(pG(ot(t,"float32"))),n)}}};function K8e(n){let t={x:ee(n,"x","sinh")};return ae.runKernel(RV,t)}var dG=ue({sinh_:K8e});var j8e={kernelName:PW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(dG(ot(t,"float32")),n)}}};function X8e(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function Y8e(n,e,t){let r=n.length+e.length,a=[],i=0,o=0;for(let s=0;s<r;s++)t.indexOf(s)===-1?a.push(n[i++]):a.push(e[o++]);return a}function Z8e(n,e){let t=[],r=n.length;for(let i=0;i<r;i++)e.indexOf(i)===-1&&t.push(n[i]);let a=e.map(i=>n[i]);return[t,a]}function km(n,e){let t=e.map(r=>1);return Y8e(n,t,e)}function vG(n,e){if(X8e(n,e))return null;let t=[];for(let r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach(r=>t.push(r)),t}function Tk(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function J8e(n,e=0,t=!1,r=!1){let i={x:ee(n,"x","cumsum")},o={axis:e,exclusive:t,reverse:r};return ae.runKernel(MW,i,o)}var mG=ue({cumsum_:J8e});function Q8e(n){xn().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}Ije(Q8e);function e7e(n,e){return ae.tidy(n,e)}function eW(n){aG(n).forEach(t=>t.dispose())}function t7e(n,e){let t=ee(n,"real","complex"),r=ee(e,"imag","complex");rje(t.shape,r.shape,`real and imag shapes, ${t.shape} and ${r.shape}, must match in call to tf.complex().`);let a={real:t,imag:r};return ae.runKernel(b5e,a)}var el=ue({complex_:t7e});function n7e(n){let t={input:ee(n,"input","imag")};return ae.runKernel(M5e,t)}var Ek=ue({imag_:n7e});function r7e(n){let t={input:ee(n,"input","real")};return ae.runKernel(j5e,t)}var Sm=ue({real_:r7e});function a7e(n,e,t){let r=ee(n,"x","transpose");if(e==null&&(e=r.shape.map((o,s)=>s).reverse()),ie(r.rank===e.length,()=>`Error in transpose: rank of input ${r.rank} must match length of perm ${e}.`),e.forEach(o=>{ie(o>=0&&o<r.rank,()=>`All entries in 'perm' must be between 0 and ${r.rank-1} but got ${e}`)}),r.rank<=1)return r.clone();let a={x:r},i={perm:e};return r.dtype==="complex64"?e7e(()=>{let o=Sm(r),s=Ek(r);return o=ae.runKernel(hm,{x:o},i),s=ae.runKernel(hm,{x:s},i),t&&(s=Nr(s)),el(o,s)}):ae.runKernel(hm,a,i)}var gu=ue({transpose_:a7e});var i7e={kernelName:MW,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{axis:a,exclusive:i,reverse:o}=t;return{x:()=>{let s=vG([a],r.rank),u=mG(n,a,i,!o);return s!=null&&(u=gu(u,s)),u}}}};function o7e(n,e,t,r,a,i=[1,1],o){let s=n;n.rank===3&&(s=pe(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let u=e;u.rank===3&&(u=pe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let c={x:s,dy:u},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:t};return ae.runKernel(E5e,c,l)}var s7e=ue({depthwiseConv2dNativeBackpropFilter_:o7e});function u7e(n,e,t,r,a,i=[1,1],o){let s=e,u=!1;e.rank===3&&(u=!0,s=pe(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let c={dy:s,filter:t},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:n},f=ae.runKernel(I5e,c,l);return u?pe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var c7e=ue({depthwiseConv2dNativeBackpropInput_:u7e});var l7e={kernelName:BW,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{let{dilations:r,strides:a,pad:i,dimRoundingMode:o}=t,s=r??[1,1];ie(Dh(s),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`);let[u,c]=e;return ie(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${u.rank}.`),ie(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),ie(u.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),ie(rl(a,s),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${a} and dilations '${s}'.`),Ni("depthwiseConv2d",i,o),{x:()=>c7e(u.shape,n,c,a,i,s,o),filter:()=>s7e(u,n,c.shape,a,i,s,o)}}};var f7e={kernelName:LW,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{let[r,a]=e,i={x:r,filter:a,dy:n},o={x:r,filter:a,dy:n};return{x:()=>ae.runKernel(C5e,i,t),filter:()=>ae.runKernel(A5e,o,t)}}};var h7e={kernelName:$W,outputsToSave:[!0],gradFunc:(n,e)=>{let[t]=e,r={dy:n,y:t};return{x:()=>ae.runKernel(_5e,r)}}};function p7e(n){let t={x:ee(n,"x","exp")};return ae.runKernel(WW,t)}var as=ue({exp_:p7e});var d7e={kernelName:qW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e,r=$e(as(Nr(sr(t))),2/Math.sqrt(Math.PI));return{x:()=>$e(n,r)}}};var v7e={kernelName:WW,outputsToSave:[!0],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(n,t)}}};var m7e={kernelName:VW,inputsToSave:["input"],gradFunc:(n,e)=>{let[t]=e;return{input:()=>pe(n,t.shape)}}};var g7e={kernelName:GW,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(n,as(t))}}};var y7e={kernelName:UW,gradFunc:n=>({x:()=>kn(n)})};var b7e={kernelName:HW,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e,a=Rn(t.shape,r.shape);return{a:()=>{let s=Fn(n,ot(r,"float32")),u=ur(t.shape,a);return u.length>0?pe(Tt(s,u),t.shape):s},b:()=>{let s=$e(n,ot(t,"float32")),u=ur(r.shape,a);u.length>0&&(s=pe(Tt(s,u),r.shape));let c=sr(r);return Nr(Fn(s,ot(c,"float32")))}}}};function w7e(n){let t={x:ee(n,"x","rsqrt","float32")};return ae.runKernel(CV,t)}var gG=ue({rsqrt_:w7e});function x7e(n,e){let t=ee(n,"x","tile","string_or_numeric");ie(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);let r={x:t},a={reps:e};return ae.runKernel(mk,r,a)}var yG=ue({tile_:x7e});var k7e={kernelName:KW,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{let{varianceEpsilon:r}=t,[a,i,o,s]=e,u=s??Jn(1),c=ur(i.shape,a.shape),l=[];if(i.rank===1){for(let w=0;w<a.shape.length-1;++w)l.push(a.shape[w]);l.push(1)}let f=fr(a,i),h=$e(n,u),p=gG(Ya(o,Jn(r))),d=$e($e($e(p,p),p),Jn(-.5));return{x:()=>i.rank===1?pe($e($e(n,yG(pe(p,[1,1,1,i.shape[0]]),l)),u),a.shape):pe($e($e(n,p),u),a.shape),mean:()=>{let w=$e($e(p,Jn(-1)),h);return i.rank===1&&(w=Tt(w,c)),pe(w,i.shape)},variance:()=>{let w=$e($e(d,f),h);return i.rank===1&&(w=Tt(w,c)),pe(w,i.shape)},scale:()=>{let w=$e(f,p),x=$e(n,w);return i.rank===1&&(x=Tt(x,c)),pe(x,i.shape)},offset:()=>{let w=n;return i.rank===1&&(w=Tt(w,c)),pe(w,i.shape)}}}};function S7e(n,e,t){let r=ee(n,"x","unsortedSegmentSum"),a=ee(e,"segmentIds","unsortedSegmentSum","int32");ie(Ch(t),()=>"numSegments must be of dtype int");let i={x:r,segmentIds:a},o={numSegments:t};return ae.runKernel(KV,i,o)}var bG=ue({unsortedSegmentSum_:S7e});var N7e={kernelName:jW,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{let[r,a]=e,{axis:i}=t,o=qi(i,r.shape)[0];return{x:()=>{let u=r.shape,c=a.size,l=u.slice(0,o),f=l.length,h=u.slice(i,u.length).slice(1),p=h.length,d=tW(0,f),v=tW(f+1,f+1+p),m=nW([l,[c],h]),g=pe(n,m),y=pe(a,[c]),b=nW([[f],d,v]),w=gu(g,b),x=bG(w,y,r.shape[o]),N=Tk(b);return x=gu(x,N),x},indices:()=>a}}};function tW(n,e){let t=[];for(let r=n;r<e;++r)t.push(r);return t}function nW(n){let e=[];for(let t=0;t<n.length;++t)for(let r=0;r<n[t].length;++r)e.push(n[t][r]);return e}var T7e={kernelName:XW,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e;return{a:()=>kn(t),b:()=>kn(r)}}};var E7e={kernelName:vk,gradFunc:n=>({x:()=>ot(n,"float32")})};var I7e={kernelName:YW,gradFunc:n=>({x:()=>kn(n)})};var C7e={kernelName:ZW,gradFunc:n=>({x:()=>kn(n)})};var A7e={kernelName:JW,gradFunc:n=>({x:()=>kn(n)})};function _7e(n,e){let t=ee(n,"a","greater","string_or_numeric"),r=ee(e,"b","greater","string_or_numeric");[t,r]=Qn(t,r),Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(O5e,a)}var al=ue({greater_:_7e});var D7e={kernelName:QW,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{alpha:a}=t,i=al(r,0);return{x:()=>fo(i,n,$e(n,a))}}};var F7e={kernelName:tV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Fn(n,Ya(t,1))}}};var R7e={kernelName:eV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Fn(n,ot(t,"float32"))}}};var O7e={kernelName:W5e,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{let[r]=e,{axis:a}=t;return{logits:()=>{let o=as(r);return fr(n,$e(Tt(n,a,!0),o))}}}};function P7e(n,e,t,r=5,a=1,i=1,o=.5){let s={x:n,y:e,dy:t},u={depthRadius:r,bias:a,alpha:i,beta:o};return ae.runKernel(V5e,s,u)}var M7e=ue({localResponseNormalizationBackprop_:P7e});var B7e={kernelName:nV,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{let[r,a]=e,{depthRadius:i,bias:o,alpha:s,beta:u}=t;return{x:()=>M7e(r,a,n,i,o,s,u)}}};function L7e(n,e){let t=ee(n,"a","equal","string_or_numeric"),r=ee(e,"b","equal","string_or_numeric");[t,r]=Qn(t,r),Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(D5e,a)}var Ik=ue({equal_:L7e});function wG(n,e,t,r){return e.rank<t.rank&&(e=pe(e,km(e.shape,r))),n.rank<t.rank&&(n=pe(n,km(n.shape,r))),{x:()=>$e(n,ot(Ik(t,e),n.dtype))}}var rW={kernelName:rV,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{let r=t,{reductionIndices:a}=r,i=e[0],o=e[1],s=qi(a,i.shape),u=wG(n,o,i,s);return{x:()=>u.x()}}};function z7e(n,e){let t=ee(n,"a","less","string_or_numeric"),r=ee(e,"b","less","string_or_numeric");[t,r]=Qn(t,r),Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(B5e,a)}var xG=ue({less_:z7e});var $7e={kernelName:aV,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e;return{a:()=>$e(n,ot(Em(t,r),"float32")),b:()=>$e(n,ot(xG(t,r),"float32"))}}};function q7e(n,e,t,r,a,i,o){let s=ee(n,"dy","maxPool3dGrad"),u=ee(e,"input","maxPool3dGrad"),c=ee(t,"output","maxPool3dGrad"),l=s,f=u,h=c,p=!1;u.rank===4&&(p=!0,l=pe(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),f=pe(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),h=pe(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),ie(l.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),ie(f.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${f.rank}.`),ie(h.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${h.rank}.`),Ni("maxPool3dGrad",i,o);let d={dy:l,input:f,output:h},v={filterSize:r,strides:a,pad:i,dimRoundingMode:o},m=ae.runKernel(H5e,d,v);return p?pe(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}var W7e=ue({maxPool3dGrad_:q7e});var V7e={kernelName:U5e,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{let[r,a]=e,{filterSize:i,strides:o,pad:s,dimRoundingMode:u}=t;return{x:()=>W7e(n,r,a,i,o,s,u)}}};function G7e(n,e,t,r,a,i,o){let s=ee(n,"dy","maxPoolGrad"),u=ee(e,"input","maxPoolGrad"),c=ee(t,"output","maxPoolGrad");ie(u.rank===s.rank,()=>`Rank of input (${u.rank}) does not match rank of dy (${s.rank})`),ie(s.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${s.rank}.`),ie(u.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${u.rank}.`),Ni("maxPoolGrad",i,o);let l={dy:s,input:u,output:c},f={filterSize:r,strides:a,pad:i,dimRoundingMode:o};return ae.runKernel(G5e,l,f)}var U7e=ue({maxPoolGrad_:G7e});var H7e={kernelName:iV,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{let[r,a]=e,{filterSize:i,strides:o,pad:s}=t;return{x:()=>U7e(n,r,a,i,o,s)}}};function Rh(n,e="float32"){if(Mh(n),e==="complex64"){let r=Rh(n,"float32"),a=Rh(n,"float32");return el(r,a)}let t=wk(lo(n),e);return ae.makeTensor(t,n,e)}function Am(n,e="float32"){if(Mh(n),e==="complex64"){let r=Am(n,"float32"),a=Rh(n,"float32");return el(r,a)}let t=JV(lo(n),e);return ae.makeTensor(t,n,e)}var K7e={kernelName:oV,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{axis:a}=t,i=qi(a,r.shape),s=Z8e(r.shape,i)[1],u=lo(s);return{x:()=>{let l=r.shape.slice();i.forEach(p=>{l[p]=1});let f=pe(n,l);return Fn($e(f,Am(r.shape,"float32")),u)}}}};var j7e={kernelName:sV,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{let r=t,{axis:a}=r,[i,o]=e,s=qi(a,i.shape),u=wG(n,o,i,s);return{x:()=>u.x()}}};var X7e={kernelName:uV,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e;return{a:()=>$e(n,ot(Im(t,r),"float32")),b:()=>$e(n,ot(al(t,r),"float32"))}}};function Y7e(n,e,t){let r=ee(n,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");let a={x:r},i={begin:e,size:t};return ae.runKernel(DV,a,i)}var $i=ue({slice_:Y7e});var Z7e={kernelName:cV,inputsToSave:["x"],gradFunc:(n,e,t)=>{let r=e[0],{paddings:a}=t,i=a.map(o=>o[0]);return{x:()=>$i(n,i,r.shape)}}};function J7e(n){let t={x:ee(n,"x","floor","float32")};return ae.runKernel(UW,t)}var kG=ue({floor_:J7e});var Q7e={kernelName:lV,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e,a=Rn(t.shape,r.shape);return{a:()=>{let s=ur(t.shape,a);return s.length>0?pe(Tt(n,s),t.shape):n},b:()=>{let s=$e(n,Nr(kG(Fn(t,r)))),u=ur(r.shape,a);return u.length>0?pe(Tt(s,u),r.shape):s}}}};var eXe={kernelName:fV,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e,a=Rn(t.shape,r.shape);return{a:()=>{let s=$e(n,ot(r,"float32")),u=ur(t.shape,a);return u.length>0?pe(Tt(s,u),t.shape):s},b:()=>{let s=$e(n,ot(t,"float32")),u=ur(r.shape,a);return u.length>0?pe(Tt(s,u),r.shape):s}}}};var tXe={kernelName:hV,gradFunc:n=>({x:()=>Nr(n)})};var nXe={kernelName:dV,inputsToSave:["indices"],gradFunc:(n,e)=>{let t=e[0];return{indices:()=>Rh(t.shape,"float32")}}};var rXe={kernelName:pV,gradFunc:n=>({x:()=>kn(n)})};function aXe(n,e=0){let t=ee(n,"x","unstack","string_or_numeric");ie(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);let r={value:t},a={axis:e};return ae.runKernel(HV,r,a)}var SG=ue({unstack_:aXe});var iXe={kernelName:vV,saveAllInputs:!0,gradFunc:(n,e,t)=>{let{axis:r}=t;return SG(n,r).map(i=>()=>i)}};var aW={kernelName:mV,inputsToSave:["x"],gradFunc:(n,e,t)=>{let r=e[0],{paddings:a}=t,i=a.map(o=>o[0]);return{x:()=>$i(n,i,r.shape)}}};function oXe(n){let t={x:ee(n,"x","log","float32")};return ae.runKernel(eV,t)}var _m=ue({log_:oXe});function sXe(n,e){let t=ee(n,"base","pow"),r=ee(e,"exp","pow");[t,r]=Qn(t,r);let a={a:t,b:r};return ae.runKernel(gV,a)}var Dm=ue({pow_:sXe});var uXe={kernelName:gV,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{let[t,r,a]=e,i=t,o=r,s=Rn(i.shape,o.shape);return{a:()=>{let l=ot(o,"float32"),f=$e(n,$e(l,Dm(i,fr(l,Jn(1))))),h=ur(i.shape,s);return h.length>0&&(f=Tt(f,h)),pe(f,i.shape)},b:()=>{let l=al(i,0),f=fo(l,_m(i),kn(i)),h=$e(n,$e(a,f)),p=ur(o.shape,s);return p.length>0&&(h=Tt(h,p)),pe(h,o.shape)}}}};var cXe={kernelName:yV,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{let[t,r]=e,a=al(t,0);return{x:()=>fo(a,n,$e(n,r)),alpha:()=>{let i=fo(a,kn(n),$e(n,t)),o=ur(r.shape,n.shape);return o.length>0&&(i=Tt(i,o)),pe(i,r.shape)}}}};function lXe(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var ka=xn();ka.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});ka.registerFlag("IS_BROWSER",()=>lXe());ka.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");ka.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));ka.registerFlag("PROD",()=>!1);ka.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>ka.getBool("DEBUG"));ka.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);ka.registerFlag("IS_TEST",()=>!1);ka.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>!0);ka.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);ka.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);ka.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);var Ck=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function iW(n){return Ck?Buffer.byteLength(n):new Blob([n]).size}function fXe(n){if(Ck)return Buffer.from(n).toString("base64");let e=new Uint8Array(n),t="";for(let r=0,a=e.length;r<a;r++)t+=String.fromCharCode(e[r]);return btoa(t)}function hXe(n){if(Ck){let r=Buffer.from(n,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}let e=atob(n),t=new Uint8Array(e.length);for(let r=0;r<e.length;++r)t.set([e.charCodeAt(r)],r);return t.buffer}function pXe(n){if(n.length===1)return n[0];let e=0;n.forEach(a=>{e+=a.byteLength});let t=new Uint8Array(e),r=0;return n.forEach(a=>{t.set(new Uint8Array(a),r),r+=a.byteLength}),t.buffer}function NG(n,e){let t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function dXe(n,e,t){let r={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(r.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=e,r.weightData=t}return n.signature!=null&&(r.signature=n.signature),n.userDefinedMetadata!=null&&(r.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(r.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(r.initializerSignature=n.initializerSignature),r}async function vXe(n,e){let t,r;return n.weightsManifest!=null&&([t,r]=await e(n.weightsManifest)),dXe(n,t,r)}function Fm(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:iW(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:iW(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}function mXe(n){let e=[];for(let t of n)e.push(...t.weights);return e}var Gn=class{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Gn.instance==null&&(Gn.instance=new Gn),Gn.instance}static registerSaveRouter(e){Gn.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Gn.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Gn.getHandlers(e,"save")}static getLoadHandlers(e,t){return Gn.getHandlers(e,"load",t)}static getHandlers(e,t,r){let a=[];return(t==="load"?Gn.getInstance().loadRouters:Gn.getInstance().saveRouters).forEach(o=>{let s=o(e,r);s!==null&&a.push(s)}),a}};var gXe="tensorflowjs",yXe=1,Ih="models_store",mm="model_info_store";function bXe(){if(!xn().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function wXe(n){let e=n.result;e.createObjectStore(Ih,{keyPath:"modelPath"}),e.createObjectStore(mm,{keyPath:"modelPath"})}var tl=class{constructor(e){if(this.indexedDB=bXe(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((r,a)=>{let i=this.indexedDB.open(gXe,yXe);i.onupgradeneeded=()=>wXe(i),i.onsuccess=()=>{let o=i.result;if(t==null){let s=o.transaction(Ih,"readonly"),c=s.objectStore(Ih).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return o.close(),a(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));r(c.result.modelArtifacts)},c.onerror=l=>(o.close(),a(c.error)),s.oncomplete=()=>o.close()}else{let s=Fm(t),u=o.transaction(mm,"readwrite"),c=u.objectStore(mm),l=c.put({modelPath:this.modelPath,modelArtifactsInfo:s}),f;l.onsuccess=()=>{f=o.transaction(Ih,"readwrite");let p=f.objectStore(Ih).put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:s});p.onsuccess=()=>r({modelArtifactsInfo:s}),p.onerror=d=>{c=u.objectStore(mm);let v=c.delete(this.modelPath);v.onsuccess=()=>(o.close(),a(p.error)),v.onerror=m=>(o.close(),a(p.error))}},l.onerror=h=>(o.close(),a(l.error)),u.oncomplete=()=>{f==null?o.close():f.oncomplete=()=>o.close()}}},i.onerror=o=>a(i.error)})}};tl.URL_SCHEME="indexeddb://";var TG=n=>xn().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(tl.URL_SCHEME)?xXe(n.slice(tl.URL_SCHEME.length)):null;Gn.registerSaveRouter(TG);Gn.registerLoadRouter(TG);function xXe(n){return new tl(n)}var Sh="/",Nh="tensorflowjs_models",kXe="info",SXe="model_topology",NXe="weight_specs",TXe="weight_data",EXe="model_metadata";function IXe(n){return{info:[Nh,n,kXe].join(Sh),topology:[Nh,n,SXe].join(Sh),weightSpecs:[Nh,n,NXe].join(Sh),weightData:[Nh,n,TXe].join(Sh),modelMetadata:[Nh,n,EXe].join(Sh)}}function CXe(n){for(let e of Object.values(n))window.localStorage.removeItem(e)}var nl=class{constructor(e){if(!xn().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=IXe(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),a=Fm(e);try{this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,fXe(e.weightData));let i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:a}}catch{throw CXe(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${a.modelTopologyBytes}, weightSpecsBytes=${a.weightSpecsBytes}, weightDataBytes=${a.weightDataBytes}.`)}}}async load(){let e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let t={},r=JSON.parse(this.LS.getItem(this.keys.topology));if(r==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=r;let a=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(a==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=a;let i=this.LS.getItem(this.keys.modelMetadata);if(i!=null){let s=JSON.parse(i);t.format=s.format,t.generatedBy=s.generatedBy,t.convertedBy=s.convertedBy,s.signature!=null&&(t.signature=s.signature),s.userDefinedMetadata!=null&&(t.userDefinedMetadata=s.userDefinedMetadata),s.modelInitializer!=null&&(t.modelInitializer=s.modelInitializer),s.initializerSignature!=null&&(t.initializerSignature=s.initializerSignature),s.trainingConfig!=null&&(t.trainingConfig=s.trainingConfig)}let o=this.LS.getItem(this.keys.weightData);if(o==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=hXe(o),t}};nl.URL_SCHEME="localstorage://";var EG=n=>xn().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(nl.URL_SCHEME)?AXe(n.slice(nl.URL_SCHEME.length)):null;Gn.registerSaveRouter(EG);Gn.registerLoadRouter(EG);function AXe(n){return new nl(n)}var _Xe="model",DXe=".json",FXe=".weights.bin";function oW(n){return new Promise(e=>setTimeout(e)).then(n)}var ho=class{constructor(e){if(!xn().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(ho.URL_SCHEME)&&(e=e.slice(ho.URL_SCHEME.length)),(e==null||e.length===0)&&(e=_Xe),this.modelJsonFileName=e+DXe,this.weightDataFileName=e+FXe}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");let t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],a=NG(e,r),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),o=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(o.download=this.modelJsonFileName,o.href=i,await oW(()=>o.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){let s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;s.download=this.weightDataFileName,s.href=t,await oW(()=>s.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:Fm(e)}}}};ho.URL_SCHEME="downloads://";var RXe=n=>xn().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(ho.URL_SCHEME)?OXe(n.slice(ho.URL_SCHEME.length)):null;Gn.registerSaveRouter(RXe);function OXe(n="model"){return new ho(n)}function sW(n,e,t,r){o(n),t=t??0,r=r??1,s(t,r);let a=0,i=u=>(u.then(c=>{let l=t+ ++a/n.length*(r-t);return e(l),c}),u);function o(u){ie(u!=null&&Array.isArray(u)&&u.length>0,()=>"promises must be a none empty array")}function s(u,c){ie(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${u}`),ie(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),ie(c>=u,()=>`startFraction must be no more than endFraction, but got startFraction ${u} and endFraction ${c}`)}return Promise.all(n.map(i))}async function PXe(n,e){e==null&&(e={});let t=e.fetchFunc==null?xn().platform.fetch:e.fetchFunc,r=n.map(f=>t(f,e.requestInit,{isBinary:!0})),a=0,i=.5,s=(e.onProgress==null?await Promise.all(r):await sW(r,e.onProgress,a,i)).map(f=>f.arrayBuffer()),u=.5,c=1;return e.onProgress==null?await Promise.all(s):await sW(s,e.onProgress,u,c)}var MXe="application/octet-stream",BXe="application/json",Oh=class{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(ie(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=xn().platform.fetch,ie(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&ie(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;let r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],a=NG(e,r);t.body.append("model.json",new Blob([JSON.stringify(a)],{type:BXe}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:MXe}),"model.weights.bin");let i=await this.fetch(this.path,t);if(i.ok)return{modelArtifactsInfo:Fm(e),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async load(){let e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let o=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?o+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":o+=" Please make sure the server is serving valid JSON for this request.",new Error(o)}let r=t.modelTopology,a=t.weightsManifest;if(r==null&&a==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return vXe(t,i=>this.loadWeights(i))}async loadWeights(e){let t=Array.isArray(this.path)?this.path[1]:this.path,[r,a]=LXe(t),i=this.weightPathPrefix||r,o=mXe(e),s=[],u=[];for(let l of e)for(let f of l.paths)this.weightUrlConverter!=null?u.push(this.weightUrlConverter(f)):s.push(i+f+a);this.weightUrlConverter&&s.push(...await Promise.all(u));let c=await PXe(s,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[o,pXe(c)]}};Oh.URL_SCHEME_REGEX=/^https?:\/\//;function LXe(n){let e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),r=n.substring(0,e),a=t>e?n.substring(t):"";return[r+"/",a]}function uW(n){return n.match(Oh.URL_SCHEME_REGEX)!=null}var IG=(n,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(n)?t=n.every(r=>uW(r)):t=uW(n),t)return zXe(n,e)}return null};Gn.registerSaveRouter(IG);Gn.registerLoadRouter(IG);function zXe(n,e){return new Oh(n,e)}function $Xe(n,e,t=1,r=0,a="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);let o={indices:ee(n,"indices","oneHot","int32")},s={dtype:a,depth:e,onValue:t,offValue:r};return ae.runKernel(dV,o,s)}var qXe=ue({oneHot_:$Xe});function WXe(n,e,t){let r,a=n.shape.length;typeof e=="number"?r=[e,...new Array(a-1).fill(0)]:e.length<a?r=e.concat(new Array(a-e.length).fill(0)):r=e.slice(),r.forEach(o=>{ie(o!==-1,()=>"slice() does not support negative begin indexing.")});let i;return t==null?i=new Array(a).fill(-1):typeof t=="number"?i=[t,...new Array(a-1).fill(-1)]:t.length<a?i=t.concat(new Array(a-t.length).fill(-1)):i=t,i=i.map((o,s)=>o>=0?o:(ie(o===-1,()=>`Negative size values should be exactly -1 but got ${o} for the slice() size at index ${s}.`),n.shape[s]-r[s])),[r,i]}var uk=class{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}};function VXe(n){let e=ee(n,"x","abs");if(e.dtype==="complex64"){let t={x:e};return ae.runKernel(_W,t)}else{let t={x:e};return ae.runKernel(vW,t)}}var co=ue({abs_:VXe});function GXe(n){let t={x:ee(n,"x","acos")};return ae.runKernel(mW,t)}var UXe=ue({acos_:GXe});function HXe(n){let t={x:ee(n,"x","acosh")};return ae.runKernel(gW,t)}var KXe=ue({acosh_:HXe});function jXe(n,e=null,t=!1){let a={x:ee(n,"x","all","bool")},i={axis:e,keepDims:t};return ae.runKernel(p5e,a,i)}var XXe=ue({all_:jXe});function YXe(n,e=null,t=!1){let a={x:ee(n,"x","any","bool")},i={axis:e,keepDims:t};return ae.runKernel(d5e,a,i)}var ZXe=ue({any_:YXe});function JXe(n,e=0){let r={x:ee(n,"x","argMax")},a={axis:e};return ae.runKernel(yW,r,a)}var QXe=ue({argMax_:JXe});function e9e(n,e=0){let r={x:ee(n,"x","argMin")},a={axis:e};return ae.runKernel(bW,r,a)}var t9e=ue({argMin_:e9e});function n9e(n){let t={x:ee(n,"x","asin")};return ae.runKernel(wW,t)}var r9e=ue({asin_:n9e});function a9e(n){let t={x:ee(n,"x","asinh")};return ae.runKernel(xW,t)}var i9e=ue({asinh_:a9e});function o9e(n){let t={x:ee(n,"x","atan")};return ae.runKernel(kW,t)}var s9e=ue({atan_:o9e});function u9e(n,e){let t=ee(n,"a","atan2"),r=ee(e,"b","atan2");[t,r]=Qn(t,r);let a={a:t,b:r};return ae.runKernel(NW,a)}var c9e=ue({atan2_:u9e});function l9e(n){let t={x:ee(n,"x","atanh")};return ae.runKernel(SW,t)}var f9e=ue({atanh_:l9e});function h9e(n,e,t,r,a){let i=ee(n,"x","avgPool","float32"),o=1;ie(rl(t,o),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);let s=i,u=!1;i.rank===3&&(u=!0,s=pe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),ie(s.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${s.rank}.`),Ni("avgPool",r,a);let c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a},f=ae.runKernel(TW,c,l);return f=ot(f,i.dtype),u?pe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var CG=ue({avgPool_:h9e});function p9e(n,e=0){ie(n.length>=1,()=>"Pass at least one tensor to concat");let t=sG(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),t.length===1)return lG(t[0]);let r=t,a={axis:e};return ae.runKernel(DW,r,a)}var Ph=ue({concat_:p9e});function d9e(n){let t={x:ee(n,"x","sigmoid","float32")};return ae.runKernel(PV,t)}var Ak=ue({sigmoid_:d9e});function v9e(n){let t={x:ee(n,"x","tanh","float32")};return ae.runKernel(UV,t)}var m9e=ue({tanh_:v9e});function g9e(n,e,t){let r=ee(n,"x","batchToSpaceND"),a=e.reduce((s,u)=>s*u);ie(r.rank>=1+e.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${e.length}`),ie(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),ie(r.shape[0]%a===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${a}`);let i={x:r},o={blockShape:e,crops:t};return ae.runKernel(IW,i,o)}var _k=ue({batchToSpaceND_:g9e});function y9e(n){let e;return n.rank===0||n.rank===1?e=pe(n,[1,1,1,n.size]):n.rank===2?e=pe(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=pe(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}function b9e(n,e,t,r,a,i){i==null&&(i=.001);let o=ee(n,"x","batchNorm"),s=ee(e,"mean","batchNorm"),u=ee(t,"variance","batchNorm"),c;a!=null&&(c=ee(a,"scale","batchNorm"));let l;r!=null&&(l=ee(r,"offset","batchNorm")),ie(s.rank===u.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),ie(l==null||s.rank===l.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),ie(c==null||s.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let h={x:y9e(o),scale:c,offset:l,mean:s,variance:u},p={varianceEpsilon:i},d=ae.runKernel(KW,h,p);return pe(d,o.shape)}var w9e=ue({batchNorm_:b9e});function x9e(n){let t={x:ee(n,"x","ceil","float32")};return ae.runKernel(CW,t)}var k9e=ue({ceil_:x9e});function S9e(n,e,t){Mh(n);let r={shape:n,value:e,dtype:t};return ae.runKernel(R5e,{},r)}function N9e(n,e,t){let r=ee(n,"x","clipByValue");if(ie(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return S9e(r.shape,e,r.dtype);let a={x:r},i={clipValueMin:e,clipValueMax:t};return ae.runKernel(AW,a,i)}var T9e=ue({clipByValue_:N9e});function E9e(n,e,t,r,a="NWC",i=1,o){let s=ee(n,"x","conv1d"),u=ee(e,"filter","conv1d"),c=s,l=!1;s.rank===2&&(l=!0,c=pe(s,[1,s.shape[0],s.shape[1]])),ie(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),ie(u.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`),Ni("conv1d",r,o),ie(c.shape[2]===u.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${u.shape[1]}.`),ie(rl(t,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${i}'`),ie(wm(i),()=>"Error in conv1D: Dilated rates should be larger than 0."),ie(wm(t),()=>"Error in conv1D: Stride should be larger than 0."),ie(a==="NWC",()=>`Error in conv1d: got dataFormat of ${a} but only NWC is currently supported.`);let f=pe(u,[1,u.shape[0],u.shape[1],u.shape[2]]),h=pe(c,[c.shape[0],1,c.shape[1],c.shape[2]]),m=Cm(h,f,[1,t],r,"NHWC",[1,i],o);return l?pe(m,[m.shape[2],m.shape[3]]):pe(m,[m.shape[0],m.shape[2],m.shape[3]])}var I9e=ue({conv1d_:E9e});function C9e(n,e,t,r,a,i){let o=ee(n,"x","conv2dTranspose"),s=ee(e,"filter","conv2dTranspose");return hG(t,o,s,r,a,"NHWC",i)}var A9e=ue({conv2dTranspose_:C9e});function _9e(n){let t={x:ee(n,"x","cos","float32")};return ae.runKernel(OW,t)}var Dk=ue({cos_:_9e});function D9e(n){let t={x:ee(n,"x","cosh","float32")};return ae.runKernel(PW,t)}var AG=ue({cosh_:D9e});function F9e(n,e=0,t=!1,r=!1){let i={x:ee(n,"x","cumprod")},o={axis:e,exclusive:t,reverse:r};return ae.runKernel(N5e,i,o)}var ck=ue({cumprod_:F9e});function R9e(n,e,t="NHWC"){let r=ee(n,"x","depthToSpace","float32"),a=t==="NHWC"?r.shape[1]:r.shape[2],i=t==="NHWC"?r.shape[2]:r.shape[3],o=t==="NHWC"?r.shape[3]:r.shape[1];ie(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),ie(a*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${a} and ${e}  for depthToSpace with input shape
    ${r.shape}`),ie(i*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${e} for depthToSpace with input shape
        ${r.shape}`),ie(o%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${r.shape}`);let s={x:r},u={blockSize:e,dataFormat:t};return ae.runKernel(T5e,s,u)}var O9e=ue({depthToSpace_:R9e});function P9e(n,e,t,r,a="NHWC",i=[1,1],o){let s=ee(n,"x","depthwiseConv2d","float32"),u=ee(e,"filter","depthwiseConv2d","float32"),c=s,l=!1;s.rank===3&&(l=!0,c=pe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ie(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),ie(u.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`);let f=a==="NHWC"?c.shape[3]:c.shape[1];ie(f===u.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${f}) must match the inChannels dimension in filter ${u.shape[2]}.`),Ni("depthwiseConv2d",r,o);let h={x:c,filter:u},p={strides:t,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},d=ae.runKernel(BW,h,p);return l?pe(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var _G=ue({depthwiseConv2d_:P9e});function M9e(n,e,t,r,a=[1,1],i="NHWC"){let o=ee(n,"x","dilation2d"),s=ee(e,"filter","dilation2d");ie(o.rank===3||o.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`),ie(s.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${s.rank}.`),ie(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let u=o,c=!1;o.rank===3&&(u=pe(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0),ie(u.shape[3]===s.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${u.shape[3]} vs ${s.shape[2]}`);let l={x:u,filter:s},f={strides:t,pad:r,dilations:a},h=ae.runKernel(LW,l,f);return c?pe(h,[h.shape[1],h.shape[2],h.shape[3]]):h}var B9e=ue({dilation2d_:M9e});function L9e(n,e){let t=ee(n,"a","div"),r=ee(e,"b","div");[t,r]=Qn(t,r);let a=Fn(t,r),i=kn(a),o=Ik(r,i);return fo(o,i,a)}var z9e=ue({divNoNan_:L9e});function $9e(n,e){let t=ee(n,"t1","dot"),r=ee(e,"t2","dot");ie((t.rank===1||t.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${r.rank}.`);let a=t.rank===1?t.size:t.shape[1],i=r.rank===1?r.size:r.shape[0];if(ie(a===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${a} and ${i}.`),t.rank===1&&r.rank===1){let o=pe(t,[1,-1]),s=pe(r,[-1,1]),u=xa(o,s);return pe(u,[])}else if(t.rank===1&&r.rank===2){let o=pe(t,[1,-1]),s=pe(r,[r.shape[0],r.shape[1]]),u=xa(o,s);return pe(u,[u.size])}else if(t.rank===2&&r.rank===1){let o=pe(r,[-1,1]),s=xa(t,o);return pe(s,[s.size])}else{let o=pe(r,[r.shape[0],r.shape[1]]);return xa(t,o)}}var q9e=ue({dot_:$9e});function W9e(n){let t={x:ee(n,"x","elu","float32")};return ae.runKernel($W,t)}var V9e=ue({elu_:W9e});function G9e(n){let e=ee(n,"x","erf");ie(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=ot(e,"float32"));let t={x:e};return ae.runKernel(qW,t)}var U9e=ue({erf_:G9e});function H9e(n,e=null,t=!1){let a={x:ee(n,"x","max")},i={reductionIndices:e,keepDims:t};return ae.runKernel(rV,a,i)}var Jc=ue({max_:H9e});function K9e(n,e=null,t=!1){let a={x:ee(n,"x","min")},i={axis:e,keepDims:t};return ae.runKernel(sV,a,i)}var lk=ue({min_:K9e});function j9e(n,e="euclidean",t=null,r=!1){n=ee(n,"x","norm");let a=DG(n,e,t),i=a.shape;if(r){let o=qi(t,n.shape);i=km(a.shape,o)}return pe(a,i)}function DG(n,e,t=null){if(n.rank===0)return co(n);if(n.rank!==1&&t===null)return DG(pe(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Tt(co(n),t);if(e===1/0)return Jc(co(n),t);if(e===-1/0)return lk(co(n),t);if(e==="euclidean"||e===2)return rs(Tt(Dm(co(n),Jn(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return Jc(Tt(co(n),t[0]),t[1]-1);if(e===1/0)return Jc(Tt(co(n),t[1]),t[0]);if(e===-1/0)return lk(Tt(co(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return rs(Tt(sr(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}var FG=ue({norm_:j9e});function X9e(n,e=null,t=!1){return FG(n,"euclidean",e,t)}var Y9e=ue({euclideanNorm_:X9e});function Z9e(n,e=0){let t=ee(n,"x","expandDims","string_or_numeric");ie(e<=t.rank,()=>"Axis must be <= rank of the tensor");let r={input:t},a={dim:e};return ae.runKernel(VW,r,a)}var RG=ue({expandDims_:Z9e});function J9e(n){let t={x:ee(n,"x","expm1")};return ae.runKernel(GW,t)}var Q9e=ue({expm1_:J9e});function eYe(n,e,t=0,r=0){let a=ee(n,"x","gather"),i=ee(e,"indices","gather","int32"),o={x:a,indices:i},s={axis:t,batchDims:r};return ae.runKernel(jW,o,s)}var OG=ue({gather_:eYe});function tYe(n){let t={x:ee(n,"x","isFinite")};return ae.runKernel(YW,t)}var nYe=ue({isFinite_:tYe});function rYe(n){let t={x:ee(n,"x","isInf")};return ae.runKernel(ZW,t)}var aYe=ue({isInf_:rYe});function iYe(n){let t={x:ee(n,"x","isNaN")};return ae.runKernel(JW,t)}var oYe=ue({isNaN_:iYe});function sYe(n,e=.2){let r={x:ee(n,"x","leakyRelu")},a={alpha:e};return ae.runKernel(QW,r,a)}var uYe=ue({leakyRelu_:sYe});function cYe(n,e=5,t=1,r=1,a=.5){let i=ee(n,"x","localResponseNormalization");ie(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),ie(Ch(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let o=i,s=!1;i.rank===3&&(s=!0,o=pe(i,[1,i.shape[0],i.shape[1],i.shape[2]]));let u={x:o},c={depthRadius:e,bias:t,alpha:r,beta:a},l=ae.runKernel(nV,u,c);return s?pe(l,[l.shape[1],l.shape[2],l.shape[3]]):l}var lYe=ue({localResponseNormalization_:cYe});function fYe(n){let t={x:ee(n,"x","log1p")};return ae.runKernel(tV,t)}var hYe=ue({log1p_:fYe});function pYe(n,e){ie(Jx(n),()=>"The f passed in variableGrads(f) must be a function"),ie(e==null||Array.isArray(e)&&e.every(c=>c instanceof Qc),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");let t=e!=null;if(!t){e=[];for(let c in ae.registeredVariables)e.push(ae.registeredVariables[c])}let r=t?e.filter(c=>!c.trainable):null,a=e.length;e=e.filter(c=>c.trainable),ie(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${a} variables is trainable.`);let i=!0,{value:o,grads:s}=ae.gradients(n,e,null,i);ie(s.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),ie(o.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`);let u={};return e.forEach((c,l)=>{s[l]!=null&&(u[c.name]=s[l])}),r?.forEach(c=>u[c.name]=null),{value:o,grads:u}}function PG(n){return ae.customGrad(n)}function dYe(n){let t={x:ee(n,"x","softplus")};return ae.runKernel(MV,t)}var MG=ue({softplus_:dYe});function vYe(n){let e=ee(n,"x","logSigmoid");return PG(r=>({value:Nr(MG(Nr(r))),gradFunc:o=>$e(o,Ak(Nr(r)))}))(e)}var mYe=ue({logSigmoid_:vYe});function gYe(n,e=-1){let t=ee(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return PG((a,i)=>{let s=Jc(a,e,!0),u=fr(a,s),c=fr(ot(u,"float32"),_m(Tt(as(u),e,!0)));return i([c]),{value:c,gradFunc:(f,h)=>{let[p]=h,d=!0,v=as(p);return fr(f,$e(Tt(f,e,d),v))}}})(t)}var yYe=ue({logSoftmax_:gYe});function bYe(n,e=null,t=!1){let r=ee(n,"x","logSumExp"),a=qi(e,r.shape),i=Jc(r,a,!0),o=fr(r,i),s=as(o),u=Tt(s,a),c=_m(u),l=Ya(pe(i,c.shape),c);if(t){let f=km(l.shape,a);return pe(l,f)}return l}var wYe=ue({logSumExp_:bYe});function xYe(n){let t={x:ee(n,"x","logicalNot","bool")};return ae.runKernel($5e,t)}var Fk=ue({logicalNot_:xYe});function kYe(n,e){let t=ee(n,"a","logicalOr","bool"),r=ee(e,"b","logicalOr","bool");Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(q5e,a)}var BG=ue({logicalOr_:kYe});function SYe(n,e){let t=ee(n,"a","logicalXor","bool"),r=ee(e,"b","logicalXor","bool");return Rn(t.shape,r.shape),Fh(BG(n,e),Fk(Fh(n,e)))}var NYe=ue({logicalXor_:SYe});function TYe(n,e,t,r,a){let i=ee(n,"x","maxPool"),o=1,s=i,u=!1;i.rank===3&&(u=!0,s=pe(i,[1,i.shape[0],i.shape[1],i.shape[2]])),ie(s.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.rank}.`),ie(rl(t,o),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),Ni("maxPool",r,a);let c={x:s},l={filterSize:e,strides:t,pad:r,dimRoundingMode:a},f=ae.runKernel(iV,c,l);return u?pe(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var LG=ue({maxPool_:TYe});function EYe(n,e){let t=ee(n,"a","maximum"),r=ee(e,"b","maximum");[t,r]=Qn(t,r),t.dtype==="bool"&&(t=ot(t,"int32"),r=ot(r,"int32")),Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(aV,a)}var zG=ue({maximum_:EYe});function IYe(n,e=null,t=!1){let a={x:ee(n,"x","mean")},i={axis:e,keepDims:t};return ae.runKernel(oV,a,i)}var CYe=ue({mean_:IYe});function AYe(n,e){let t=ee(n,"a","minimum"),r=ee(e,"b","minimum");[t,r]=Qn(t,r),t.dtype==="bool"&&(t=ot(t,"int32"),r=ot(r,"int32")),Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(uV,a)}var _Ye=ue({minimum_:AYe});function DYe(n,e,t){ie(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);let r=ee(n,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");ie(e.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${e.length}.`);let a=t==="reflect"?1:0;for(let s=0;s<r.rank;s++)ie(e[s].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),ie(e[s][0]>=0&&e[s][0]<=r.shape[s]-a&&e[s][1]>=0&&e[s][1]<=r.shape[s]-a,()=>`Padding in dimension ${s} cannot be greater than or equal to ${r.shape[s]-a} or less than 0 for input of shape ${r.shape}`);let i={paddings:e,mode:t},o={x:r};return ae.runKernel(cV,o,i)}var FYe=ue({mirrorPad_:DYe});function RYe(n,e){let t=ee(n,"a","mod"),r=ee(e,"b","mod");[t,r]=Qn(t,r);let a={a:t,b:r};return ae.runKernel(lV,a)}var OYe=ue({mod_:RYe});function PYe(n,e){let t=ee(n,"a","notEqual","string_or_numeric"),r=ee(e,"b","notEqual","string_or_numeric");[t,r]=Qn(t,r),Rn(t.shape,r.shape);let a={a:t,b:r};return ae.runKernel(K5e,a)}var MYe=ue({notEqual_:PYe});function BYe(n){let t={x:ee(n,"x","onesLike")};return ae.runKernel(pV,t)}var LYe=ue({onesLike_:BYe});function zYe(n,e,t=0){let r=ee(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let a={paddings:e,constantValue:t},i={x:r};return ae.runKernel(mV,i,a)}var $G=ue({pad_:zYe});function $Ye(n,e,t,r,a,i,o){a==null&&(a=[1,1]),i==null&&(i=1),r===0&&(r="valid");let s=ee(n,"x","maxPool"),u=s,c=!1;s.rank===3&&(c=!0,u=pe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),ie(rl(i,a),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${a}'`);let l=s8e(u.shape,e,i,a,r),f=[l.dilationHeight,l.dilationWidth],h;r==="same"?h=WYe([l.filterHeight,l.filterWidth],f):h=[[0,0],[0,0]];let p=f[0]===1&&f[1]===1,[d,v]=qYe([l.inHeight,l.inWidth],f,h),m=p?r:"valid",g=p?u:Nk(u,f,d),b=(t==="avg"?()=>CG(g,e,i,m,o):()=>LG(g,e,i,m,o))(),w=p?b:_k(b,f,v);return c?pe(w,[w.shape[1],w.shape[2],w.shape[3]]):w}function qYe(n,e,t){let r=t.map(l=>l[0]),a=t.map(l=>l[1]),i=n.concat(r,a),o=e.map((l,f)=>(l-i[f]%l)%l),s=a.map((l,f)=>l+o[f]),u=e.map((l,f)=>[r[f],s[f]]),c=e.map((l,f)=>[0,o[f]]);return[u,c]}function WYe(n,e){let r=n.map((o,s)=>o+(o-1)*(e[s]-1)).map(o=>o-1),a=r.map(o=>Math.floor(o/2)),i=r.map((o,s)=>o-a[s]);return r.map((o,s)=>[a[s],i[s]])}var VYe=ue({pool_:$Ye});function GYe(n,e){let t=ee(n,"x","prelu"),r=ee(e,"alpha","prelu"),a={x:t,alpha:r};return ae.runKernel(yV,a)}var UYe=ue({prelu_:GYe});function HYe(n,e=null,t=!1){let r=ee(n,"x","prod");r.dtype==="bool"&&(r=ot(r,"int32"));let a={x:r},i={axis:e,keepDims:t};return ae.runKernel(bV,a,i)}var KYe=ue({prod_:HYe});var yu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function bu(n,e){return e={exports:{}},n(e,e.exports),e.exports}var jYe=bu(function(n){(function(e,t,r){function a(u){var c=this,l=s();c.next=function(){var f=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=f-(c.c=f|0)},c.c=1,c.s0=l(" "),c.s1=l(" "),c.s2=l(" "),c.s0-=l(u),c.s0<0&&(c.s0+=1),c.s1-=l(u),c.s1<0&&(c.s1+=1),c.s2-=l(u),c.s2<0&&(c.s2+=1),l=null}function i(u,c){return c.c=u.c,c.s0=u.s0,c.s1=u.s1,c.s2=u.s2,c}function o(u,c){var l=new a(u),f=c&&c.state,h=l.next;return h.int32=function(){return l.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,f&&(typeof f=="object"&&i(f,l),h.state=function(){return i(l,{})}),h}function s(){var u=4022871197,c=function(l){l=String(l);for(var f=0;f<l.length;f++){u+=l.charCodeAt(f);var h=.02519603282416938*u;u=h>>>0,h-=u,h*=u,u=h>>>0,h-=u,u+=h*4294967296}return(u>>>0)*23283064365386963e-26};return c}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.alea=o})(yu,n,!1)}),XYe=bu(function(n){(function(e,t,r){function a(s){var u=this,c="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var f=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^f^f>>>8},s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor128=o})(yu,n,!1)}),YYe=bu(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^(f^f<<1))|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(s|0)?u.x=s:c+=s;for(var l=0;l<c.length+64;l++)u.x^=c.charCodeAt(l)|0,l==c.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function i(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorwow=o})(yu,n,!1)}),ZYe=bu(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.x,f=u.i,h,p,d;return h=l[f],h^=h>>>7,p=h^h<<24,h=l[f+1&7],p^=h^h>>>10,h=l[f+3&7],p^=h^h>>>3,h=l[f+4&7],p^=h^h<<7,h=l[f+7&7],h=h^h<<13,p^=h^h<<9,l[f]=p,u.i=f+1&7,p};function c(l,f){var h,p,d=[];if(f===(f|0))p=d[0]=f;else for(f=""+f,h=0;h<f.length;++h)d[h&7]=d[h&7]<<15^f.charCodeAt(h)+d[h+1&7]<<13;for(;d.length<8;)d.push(0);for(h=0;h<8&&d[h]===0;++h);for(h==8?p=d[7]=-1:p=d[h],l.x=d,l.i=0,h=256;h>0;--h)l.next()}c(u,s)}function i(s,u){return u.x=s.x.slice(),u.i=s.i,u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.x&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xorshift7=o})(yu,n,!1)}),JYe=bu(function(n){(function(e,t,r){function a(s){var u=this;u.next=function(){var l=u.w,f=u.X,h=u.i,p,d;return u.w=l=l+1640531527|0,d=f[h+34&127],p=f[h=h+1&127],d^=d<<13,p^=p<<17,d^=d>>>15,p^=p>>>12,d=f[h]=d^p,u.i=h,d+(l^l>>>16)|0};function c(l,f){var h,p,d,v,m,g=[],y=128;for(f===(f|0)?(p=f,f=null):(f=f+"\0",p=0,y=Math.max(y,f.length)),d=0,v=-32;v<y;++v)f&&(p^=f.charCodeAt((v+32)%f.length)),v===0&&(m=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,v>=0&&(m=m+1640531527|0,h=g[v&127]^=p+m,d=h==0?d+1:0);for(d>=128&&(g[(f&&f.length||0)&127]=-1),d=127,v=4*128;v>0;--v)p=g[d+34&127],h=g[d=d+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,g[d]=p^h;l.w=m,l.X=g,l.i=d}c(u,s)}function i(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function o(s,u){s==null&&(s=+new Date);var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(l.X&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.xor4096=o})(yu,n,!1)}),QYe=bu(function(n){(function(e,t,r){function a(s){var u=this,c="";u.next=function(){var f=u.b,h=u.c,p=u.d,d=u.a;return f=f<<25^f>>>7^h,h=h-p|0,p=p<<24^p>>>8^d,d=d-f|0,u.b=f=f<<20^f>>>12^h,u.c=h=h-p|0,u.d=p<<16^h>>>16^d,u.a=d-f|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=s|0):c+=s;for(var l=0;l<c.length+20;l++)u.b^=c.charCodeAt(l)|0,u.next()}function i(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function o(s,u){var c=new a(s),l=u&&u.state,f=function(){return(c.next()>>>0)/4294967296};return f.double=function(){do var h=c.next()>>>11,p=(c.next()>>>0)/4294967296,d=(h+p)/(1<<21);while(d===0);return d},f.int32=c.next,f.quick=f,l&&(typeof l=="object"&&i(l,c),f.state=function(){return i(c,{})}),f}t&&t.exports?t.exports=o:r&&r.amd?r(function(){return o}):this.tychei=o})(yu,n,!1)}),wu=bu(function(n){(function(e,t,r){var a=256,i=6,o=52,s="random",u=r.pow(a,i),c=r.pow(2,o),l=c*2,f=a-1,h;function p(w,x,N){var T=[];x=x==!0?{entropy:!0}:x||{};var E=g(m(x.entropy?[w,b(t)]:w??y(),3),T),C=new d(T),F=function(){for(var D=C.g(i),O=u,L=0;D<c;)D=(D+L)*a,O*=a,L=C.g(1);for(;D>=l;)D/=2,O/=2,L>>>=1;return(D+L)/O};return F.int32=function(){return C.g(4)|0},F.quick=function(){return C.g(4)/4294967296},F.double=F,g(b(C.S),t),(x.pass||N||function(D,O,L,z){return z&&(z.S&&v(z,C),D.state=function(){return v(C,{})}),L?(r[s]=D,O):D})(F,E,"global"in x?x.global:this==r,x.state)}function d(w){var x,N=w.length,T=this,E=0,C=T.i=T.j=0,F=T.S=[];for(N||(w=[N++]);E<a;)F[E]=E++;for(E=0;E<a;E++)F[E]=F[C=f&C+w[E%N]+(x=F[E])],F[C]=x;(T.g=function(D){for(var O,L=0,z=T.i,$=T.j,B=T.S;D--;)O=B[z=f&z+1],L=L*a+B[f&(B[z]=B[$=f&$+O])+(B[$]=O)];return T.i=z,T.j=$,L})(a)}function v(w,x){return x.i=w.i,x.j=w.j,x.S=w.S.slice(),x}function m(w,x){var N=[],T=typeof w,E;if(x&&T=="object")for(E in w)try{N.push(m(w[E],x-1))}catch{}return N.length?N:T=="string"?w:w+"\0"}function g(w,x){for(var N=w+"",T,E=0;E<N.length;)x[f&E]=f&(T^=x[f&E]*19)+N.charCodeAt(E++);return b(x)}function y(){try{var w;return h&&(w=h.randomBytes)?w=w(a):(w=new Uint8Array(a),(e.crypto||e.msCrypto).getRandomValues(w)),b(w)}catch{var x=e.navigator,N=x&&x.plugins;return[+new Date,e,N,e.screen,b(t)]}}function b(w){return String.fromCharCode.apply(0,w)}if(g(r.random(),t),n.exports){n.exports=p;try{h=Dp()}catch{}}else r["seed"+s]=p})(typeof self<"u"?self:yu,[],Math)});wu.alea=jYe;wu.xor128=XYe;wu.xorwow=YYe;wu.xorshift7=ZYe;wu.xor4096=JYe;wu.tychei=QYe;var eZe=wu,yit=eZe.alea;function tZe(n){let t={x:ee(n,"x","reciprocal")};return ae.runKernel(wV,t)}var nZe=ue({reciprocal_:tZe});function rZe(n){let t={x:ee(n,"x","relu")};return ae.runKernel(xV,t)}var aZe=ue({relu_:rZe});function iZe(n){let t={x:ee(n,"x","relu6")};return ae.runKernel(TV,t)}var oZe=ue({relu6_:iZe});function sZe(n,e){let r={x:ee(n,"x","reverse")},a={dims:e};return ae.runKernel(EV,r,a)}var Nm=ue({reverse_:sZe});function uZe(n){let t={x:ee(n,"x","round")};return ae.runKernel(IV,t)}var cZe=ue({round_:uZe});function lZe(n){let t={x:ee(n,"x","selu")};return ae.runKernel(_V,t)}var fZe=ue({selu_:lZe});function hZe(n,e,t,r,a,i=[1,1],o="NHWC"){let s=ee(n,"x","separableConv2d"),u=ee(e,"depthwiseFilter","separableConv2d"),c=ee(t,"pointwiseFilter","separableConv2d"),l=s,f=!1;if(s.rank===3&&(f=!0,l=pe(s,[1,s.shape[0],s.shape[1],s.shape[2]])),o==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");ie(l.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${l.rank}.`),ie(u.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`),ie(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`),ie(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),ie(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);let h=u.shape[2],p=u.shape[3];ie(c.shape[2]===h*p,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*p}, but got ${c.shape[2]}.`);let d=_G(l,u,r,a,o,i),m=Cm(d,c,1,"valid",o);return f?pe(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var pZe=ue({separableConv2d_:hZe});function dZe(n){let t={x:ee(n,"x","sign")};return ae.runKernel(OV,t)}var vZe=ue({sign_:dZe});function mZe(n,e=-1){let t=ee(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);let r={logits:t},a={dim:e};return ae.runKernel(qV,r,a)}var gZe=ue({softmax_:mZe});function yZe(n){ie(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);let e={input:n};return ae.runKernel(F5e,e)}var qG=ue({fft_:yZe});function bZe(n){ie(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);let e={input:n};return ae.runKernel(P5e,e)}var fk=ue({ifft_:bZe});function wZe(n){let e=n.shape[n.shape.length-1],t=n.size/e,r;if(e<=2){let a=pe(n,[t,e]);r=fk(a)}else{let a=[t,2*(e-1)],i=pe(Sm(n),[t,e]),o=pe(Ek(n),[t,e]),s=Nm($i(i,[0,1],[t,e-2]),1),u=$e(Nm($i(o,[0,1],[t,e-2]),1),Jn(-1)),c=Ph([i,s],1),l=Ph([o,u],1),f=pe(el(c,l),[a[0],a[1]]);r=fk(f)}if(r=Sm(r),n.rank===3&&n.shape[0]!==0){let a=r,i=n.shape[0];r=pe(r,[i,r.shape[0]/i,r.shape[1]]),a.dispose()}return r}var xZe=ue({irfft_:wZe});function kZe(n,e){ie(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1],r=n.size/t,a;if(e!=null&&e<t){let d=n.shape.map(m=>0),v=n.shape.map(m=>m);v[n.shape.length-1]=e,a=$i(n,d,v),t=e}else if(e!=null&&e>t){let d=n.shape.map(v=>v);d[n.shape.length-1]=e-t,a=Ph([n,Rh(d)],n.shape.length-1),t=e}else a=n;let i=kn(a),o=pe(el(a,i),[r,t]),s=qG(o),u=Math.floor(t/2)+1,c=Sm(s),l=Ek(s),f=xm(c,[u,t-u],c.shape.length-1),h=xm(l,[u,t-u],l.shape.length-1),p=a.shape.slice();return p[a.shape.length-1]=u,pe(el(f[0],h[0]),p)}var SZe=ue({rfft_:kZe});function NZe(n,e){let t=ee(n,"a","squaredDifference"),r=ee(e,"b","squaredDifference");[t,r]=Qn(t,r),Rn(t.shape,r.shape);let a={a:t,b:r},i={};return ae.runKernel(WV,a,i)}var TZe=ue({squaredDifference_:NZe});function EZe(n,e){let t=ee(n,"x","squeeze","string_or_numeric");return pe(t,aje(t.shape,e).newShape)}var IZe=ue({squeeze_:EZe});function CZe(n,e=0){let t=sG(n,"tensors","stack","string_or_numeric");ie(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&ie(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");let r=t,a={axis:e};return ae.runKernel(vV,r,a)}var WG=ue({stack_:CZe});function AZe(n,e,t,r,a=0,i=0,o=0,s=0,u=0){let l={x:ee(n,"x","stridedSlice","string_or_numeric")},f={begin:e,end:t,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return ae.runKernel(J5e,l,f)}var _Ze=ue({stridedSlice_:AZe});function DZe(n){let t={x:ee(n,"x","tan","float32")};return ae.runKernel(GV,t)}var FZe=ue({tan_:DZe});function RZe(n,e=1,t=!0){let r=ee(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");let a=r.shape[r.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>a)throw new Error(`'k' passed to topk() must be <= the last dimension (${a}) but got ${e}`);let i={x:r},o={k:e,sorted:t},[s,u]=ae.runKernel(Q5e,i,o);return{values:s,indices:u}}var OZe=ue({topk_:RZe});function PZe(n,e=0){let t=ee(n,"x","unique","string_or_numeric");ie(t.rank>0,()=>"The input tensor must be at least 1D");let r={x:t},a={axis:e},[i,o]=ae.runKernel(eje,r,a);return{values:i,indices:o}}var MZe=ue({unique_:PZe});function BZe(n,e,t=!1,r=!1){let a=ee(n,"images","resizeBilinear");ie(a.rank===3||a.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${a.rank}.`),ie(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),ie(r===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=a,o=!1;a.rank===3&&(o=!0,i=pe(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let[]=e,s={images:i},u={alignCorners:t,halfPixelCenters:r,size:e},c=ae.runKernel(NV,s,u);return o?pe(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var LZe=ue({resizeBilinear_:BZe});function zZe(n,e,t=!1,r=!1){let a=ee(n,"images","resizeNearestNeighbor");ie(a.rank===3||a.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${a.rank}.`),ie(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),ie(a.dtype==="float32"||a.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),ie(r===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=a,o=!1;a.rank===3&&(o=!0,i=pe(a,[1,a.shape[0],a.shape[1],a.shape[2]]));let[]=e,s={images:i},u={alignCorners:t,halfPixelCenters:r,size:e},c=ae.runKernel(SV,s,u);return o?pe(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var $Ze=ue({resizeNearestNeighbor_:zZe});var cW;(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(cW||(cW={}));var hk=class extends uk{minimize(e,t=!1,r){let{value:a,grads:i}=this.computeGradients(e,r);if(r!=null){let o=r.map(s=>({name:s.name,tensor:i[s.name]}));this.applyGradients(o)}else this.applyGradients(i);return eW(i),t?a:(a.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return pYe(e,t)}dispose(){this.iterations_!=null&&eW(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Jn(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}};Object.defineProperty(hk,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});var bit=(()=>typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n())();var lW;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(lW||(lW={}));var qZe=1.7580993408473768,WZe=1.0507009873554805;function VZe(n,e,t){let r=n.shape.slice();r[t]=1;let a=pe(e,r),i=ck(n,t,!0,!1),o=ck(n,t,!0,!0),s=$e(i,o);return $e(a,s)}function GZe(n,e,t){let r=n.shape.length,a=r-t.length,i=vG(t,r),o=n;i!=null&&(o=gu(n,i));let s=o.shape.slice(),c=s.splice(r-t.length,t.length).reduce((h,p)=>h*p,1);s.push(c);let l=o.reshape(s),f=VZe(l,e,a);if(f=f.reshape(o.shape),i!=null){let h=Tk(i);f=gu(f,h)}return f}var UZe={kernelName:bV,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{axis:a}=t,i=[];return a==null?i=r.shape.map((o,s)=>s):typeof a=="number"?i=[a]:i=a,{x:()=>GZe(r,n,i)}}};var HZe={kernelName:zW,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e,a=Rn(t.shape,r.shape);return{a:()=>{let s=Fn(n,ot(r,"float32")),u=ur(t.shape,a);return u.length>0?pe(Tt(s,u),t.shape):s},b:()=>{let s=$e(n,ot(t,"float32")),u=ur(r.shape,a);u.length>0&&(s=pe(Tt(s,u),r.shape));let c=sr(r);return Nr(Fn(s,ot(c,"float32")))}}}};var KZe={kernelName:wV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Fn(n,Nr(sr(t)))}}};var jZe={kernelName:TV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e,r=$e(Im(t,6),Tm(t));return{x:()=>$e(n,ot(r,"float32"))}}};var XZe={kernelName:xV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(n,ot(Tm(t),"float32"))}}};var YZe={kernelName:kV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>pe(n,t.shape)}}};var ZZe={kernelName:NV,inputsToSave:["images"],gradFunc:(n,e,t)=>{let[r]=e,a={dy:n,images:r};return{images:()=>ae.runKernel(Y5e,a,t)}}};var JZe={kernelName:SV,inputsToSave:["images"],gradFunc:(n,e,t)=>{let[r]=e,a={dy:n,images:r};return{images:()=>ae.runKernel(X5e,a,t)}}};var QZe={kernelName:EV,gradFunc:(n,e,t)=>{let{dims:r}=t,a=qi(r,n.shape);return{x:()=>Nm(n,a)}}};var eJe={kernelName:IV,gradFunc:n=>({x:()=>kn(n)})};var tJe={kernelName:CV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Nr(Fn(n,$e(Dm(t,1.5),2)))}}};var nJe={kernelName:AV,inputsToSave:["condition"],gradFunc:(n,e)=>{let[t]=e;return{condition:()=>ot(kn(t),"float32"),t:()=>$e(n,ot(t,n.dtype)),e:()=>$e(n,ot(Fk(t),n.dtype))}}};var rJe={kernelName:_V,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>{let r=al(t,Jn(0)),a=Jn(qZe),i=Jn(WZe),o=$e(n,i),s=$e($e(n,a),as(ot(t,"float32")));return fo(r,o,s)}}}};var aJe={kernelName:PV,outputsToSave:[!0],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(n,$e(t,fr(Jn(1),t)))}}};var iJe={kernelName:OV,gradFunc:n=>({x:()=>kn(n)})};var oJe={kernelName:FV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(Dk(ot(t,"float32")),n)}}};var sJe={kernelName:RV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(AG(ot(t,"float32")),n)}}};var uJe={kernelName:DV,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{begin:a,size:i}=t,o=r.shape,[s,u]=WXe(r,a,i),c=[];for(let l=0;l<n.rank;l++)c.push([s[l],o[l]-s[l]-u[l]]);return{x:()=>$G(n,c)}}};var cJe={kernelName:qV,outputsToSave:[!0],gradFunc:(n,e,t)=>{let[r]=e,{dim:a}=t,i=!0,o=$e(n,r);return{logits:()=>fr(o,$e(Tt(o,[a],i),r))}}};var lJe={kernelName:MV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(n,Ak(t))}}};var fW={kernelName:zV,gradFunc:(n,e,t)=>{let{blockShape:r,paddings:a}=t;return{x:()=>_k(n,r,a)}}};var hW={kernelName:$V,gradFunc:(n,e,t)=>{let{axis:r}=t;return{x:()=>Ph(n,r)}}};var fJe={kernelName:BV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Fn(n,$e(rs(ot(t,"float32")),2))}}};var hJe={kernelName:Z5e,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(n,$e(ot(t,"float32"),2))}}};var pJe={kernelName:WV,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e,a=Jn(2);return{a:()=>$e(n,$e(a,fr(t,r))),b:()=>$e(n,$e(a,fr(r,t)))}}};var dJe={kernelName:XV,gradFunc:n=>({x:()=>kn(n)})};var vJe={kernelName:VV,inputsToSave:["a","b"],gradFunc:(n,e)=>{let[t,r]=e,a=Rn(t.shape,r.shape);return{a:()=>{let s=n,u=ur(t.shape,a);return u.length>0&&(s=Tt(s,u)),pe(s,t.shape)},b:()=>{let s=n,u=ur(r.shape,a);return u.length>0&&(s=Tt(s,u)),pe(Nr(s),r.shape)}}}};var mJe={kernelName:LV,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,a=r.shape.slice(),{axis:i}=t;qi(i,r.shape).forEach(c=>{a[c]=1});let s=pe(n,a),u=$e(s,Am(r.shape,"float32"));return{x:()=>u}}};var gJe={kernelName:GV,inputsToSave:["x"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>Fn(n,sr(Dk(t)))}}};var yJe={kernelName:UV,outputsToSave:[!0],gradFunc:(n,e)=>{let[t]=e;return{x:()=>$e(fr(Jn(1),sr(t)),n)}}};var bJe={kernelName:mk,inputsToSave:["x"],gradFunc:(n,e,t)=>{let[r]=e,{reps:a}=t;return{x:()=>{let o=kn(r);if(r.rank===1)for(let s=0;s<a[0];++s)o=Ya(o,$i(n,[s*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)o=Ya(o,$i(n,[s*r.shape[0],u*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)for(let c=0;c<a[2];++c)o=Ya(o,$i(n,[s*r.shape[0],u*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let s=0;s<a[0];++s)for(let u=0;u<a[1];++u)for(let c=0;c<a[2];++c)for(let l=0;l<a[3];++l)o=Ya(o,$i(n,[s*r.shape[0],u*r.shape[1],c*r.shape[2],l*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return o}}}};var wJe={kernelName:hm,gradFunc:(n,e,t)=>{let r=t,{perm:a}=r,i=Tk(a);return{x:()=>gu(n,i)}}};var xJe={kernelName:HV,gradFunc:(n,e,t)=>{let r=t,{axis:a}=r;return{value:()=>WG(n,a)}}};var kJe={kernelName:KV,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{let[t]=e;return{x:()=>SJe(n,t)}}};function SJe(n,e){let t=zG(e,kn(e)),r=OG(n,t),a=Em(e,Jn(0,"int32")),i=r.rank-a.rank;for(let s=0;s<i;++s)a=RG(a,s+1);a=Fh(a,Am(r.shape,"bool"));let o=kn(r);return fo(a,r,o)}var NJe={kernelName:jV,gradFunc:n=>({x:()=>kn(n)})};var TJe=[uG,Hje,Kje,Yje,Zje,Qje,e8e,t8e,r8e,a8e,i8e,o8e,d8e,g8e,b8e,x8e,k8e,S8e,N8e,D8e,F8e,O8e,z8e,B8e,G8e,H8e,j8e,i7e,l7e,f7e,HZe,h7e,d7e,v7e,m7e,g7e,b7e,y7e,k7e,N7e,T7e,E7e,I7e,C7e,A7e,D7e,F7e,R7e,O7e,B7e,rW,rW,$7e,V7e,H7e,K7e,j7e,X7e,Z7e,Q7e,eXe,tXe,nXe,rXe,iXe,aW,aW,uXe,cXe,UZe,KZe,jZe,XZe,YZe,ZZe,JZe,QZe,eJe,tJe,nJe,rJe,aJe,iJe,oJe,sJe,uJe,cJe,lJe,fW,fW,hW,hW,fJe,pJe,hJe,dJe,vJe,mJe,gJe,yJe,bJe,wJe,xJe,kJe,NJe];for(let n of TJe)vje(n);ce().prototype.abs=function(){return this.throwIfDisposed(),co(this)};ce().prototype.acos=function(){return this.throwIfDisposed(),UXe(this)};ce().prototype.acosh=function(){return this.throwIfDisposed(),KXe(this)};ce().prototype.add=function(n){return this.throwIfDisposed(),Ya(this,n)};ce().prototype.all=function(n,e){return this.throwIfDisposed(),XXe(this,n,e)};ce().prototype.any=function(n,e){return this.throwIfDisposed(),ZXe(this,n,e)};ce().prototype.argMax=function(n){return this.throwIfDisposed(),QXe(this,n)};ce().prototype.argMin=function(n){return this.throwIfDisposed(),t9e(this,n)};ce().prototype.asScalar=function(){return this.throwIfDisposed(),ie(this.size===1,()=>"The array must have only 1 element."),pe(this,[])};ce().prototype.asType=function(n){return this.throwIfDisposed(),ot(this,n)};ce().prototype.as1D=function(){return this.throwIfDisposed(),pe(this,[this.size])};ce().prototype.as2D=function(n,e){return this.throwIfDisposed(),pe(this,[n,e])};ce().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),pe(this,[n,e,t])};ce().prototype.as4D=function(n,e,t,r){return this.throwIfDisposed(),pe(this,[n,e,t,r])};ce().prototype.as5D=function(n,e,t,r,a){return this.throwIfDisposed(),pe(this,[n,e,t,r,a])};ce().prototype.asin=function(){return this.throwIfDisposed(),r9e(this)};ce().prototype.asinh=function(){return this.throwIfDisposed(),i9e(this)};ce().prototype.atan=function(){return this.throwIfDisposed(),s9e(this)};ce().prototype.atan2=function(n){return this.throwIfDisposed(),c9e(this,n)};ce().prototype.atanh=function(){return this.throwIfDisposed(),f9e(this)};ce().prototype.avgPool=function(n,e,t,r){return this.throwIfDisposed(),CG(this,n,e,t,r)};ce().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),_k(this,n,e)};ce().prototype.batchNorm=function(n,e,t,r,a){return this.throwIfDisposed(),w9e(this,n,e,t,r,a)};ce().prototype.broadcastTo=function(n){return this.throwIfDisposed(),vm(this,n)};ce().prototype.cast=function(n){return this.throwIfDisposed(),ot(this,n)};ce().prototype.ceil=function(){return this.throwIfDisposed(),k9e(this)};ce().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),T9e(this,n,e)};ce().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof Sr&&(n=[n]),Ph([this,...n],e)};ce().prototype.conv1d=function(n,e,t,r,a,i){return this.throwIfDisposed(),I9e(this,n,e,t,r,a,i)};ce().prototype.conv2dTranspose=function(n,e,t,r,a){return this.throwIfDisposed(),A9e(this,n,e,t,r,a)};ce().prototype.conv2d=function(n,e,t,r,a,i){return this.throwIfDisposed(),Cm(this,n,e,t,r,a,i)};ce().prototype.cos=function(){return this.throwIfDisposed(),Dk(this)};ce().prototype.cosh=function(){return this.throwIfDisposed(),AG(this)};ce().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),ck(this,n,e,t)};ce().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),mG(this,n,e,t)};ce().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),O9e(this,n,e)};ce().prototype.depthwiseConv2d=function(n,e,t,r,a,i){return this.throwIfDisposed(),_G(this,n,e,t,r,a,i)};ce().prototype.dilation2d=function(n,e,t,r,a){return this.throwIfDisposed(),B9e(this,n,e,t,r,a)};ce().prototype.divNoNan=function(n){return this.throwIfDisposed(),z9e(this,n)};ce().prototype.div=function(n){return this.throwIfDisposed(),Fn(this,n)};ce().prototype.dot=function(n){return this.throwIfDisposed(),q9e(this,n)};ce().prototype.elu=function(){return this.throwIfDisposed(),V9e(this)};ce().prototype.equal=function(n){return this.throwIfDisposed(),Ik(this,n)};ce().prototype.erf=function(){return this.throwIfDisposed(),U9e(this)};ce().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),Y9e(this,n,e)};ce().prototype.exp=function(){return this.throwIfDisposed(),as(this)};ce().prototype.expandDims=function(n){return this.throwIfDisposed(),RG(this,n)};ce().prototype.expm1=function(){return this.throwIfDisposed(),Q9e(this)};ce().prototype.fft=function(){return this.throwIfDisposed(),qG(this)};ce().prototype.flatten=function(){return this.throwIfDisposed(),pe(this,[this.size])};ce().prototype.floor=function(){return this.throwIfDisposed(),kG(this)};ce().prototype.floorDiv=function(n){return this.throwIfDisposed(),cG(this,n)};ce().prototype.gather=function(n,e){return this.throwIfDisposed(),OG(this,n,e)};ce().prototype.greaterEqual=function(n){return this.throwIfDisposed(),Em(this,n)};ce().prototype.greater=function(n){return this.throwIfDisposed(),al(this,n)};ce().prototype.ifft=function(){return this.throwIfDisposed(),fk(this)};ce().prototype.irfft=function(){return this.throwIfDisposed(),xZe(this)};ce().prototype.isFinite=function(){return this.throwIfDisposed(),nYe(this)};ce().prototype.isInf=function(){return this.throwIfDisposed(),aYe(this)};ce().prototype.isNaN=function(){return this.throwIfDisposed(),oYe(this)};ce().prototype.leakyRelu=function(n){return this.throwIfDisposed(),uYe(this,n)};ce().prototype.lessEqual=function(n){return this.throwIfDisposed(),Im(this,n)};ce().prototype.less=function(n){return this.throwIfDisposed(),xG(this,n)};ce().prototype.localResponseNormalization=function(n,e,t,r){return this.throwIfDisposed(),lYe(this,n,e,t,r)};ce().prototype.logSigmoid=function(){return this.throwIfDisposed(),mYe(this)};ce().prototype.logSoftmax=function(n){return this.throwIfDisposed(),yYe(this,n)};ce().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),wYe(this,n,e)};ce().prototype.log=function(){return this.throwIfDisposed(),_m(this)};ce().prototype.log1p=function(){return this.throwIfDisposed(),hYe(this)};ce().prototype.logicalAnd=function(n){return this.throwIfDisposed(),Fh(this,n)};ce().prototype.logicalNot=function(){return this.throwIfDisposed(),Fk(this)};ce().prototype.logicalOr=function(n){return this.throwIfDisposed(),BG(this,n)};ce().prototype.logicalXor=function(n){return this.throwIfDisposed(),NYe(this,n)};ce().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),xa(this,n,e,t)};ce().prototype.maxPool=function(n,e,t,r){return this.throwIfDisposed(),LG(this,n,e,t,r)};ce().prototype.max=function(n,e){return this.throwIfDisposed(),Jc(this,n,e)};ce().prototype.maximum=function(n){return this.throwIfDisposed(),zG(this,n)};ce().prototype.mean=function(n,e){return this.throwIfDisposed(),CYe(this,n,e)};ce().prototype.min=function(n,e){return this.throwIfDisposed(),lk(this,n,e)};ce().prototype.minimum=function(n){return this.throwIfDisposed(),_Ye(this,n)};ce().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),FYe(this,n,e)};ce().prototype.mod=function(n){return this.throwIfDisposed(),OYe(this,n)};ce().prototype.mul=function(n){return this.throwIfDisposed(),$e(this,n)};ce().prototype.neg=function(){return this.throwIfDisposed(),Nr(this)};ce().prototype.norm=function(n,e,t){return this.throwIfDisposed(),FG(this,n,e,t)};ce().prototype.notEqual=function(n){return this.throwIfDisposed(),MYe(this,n)};ce().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),qXe(this,n,e,t)};ce().prototype.onesLike=function(){return this.throwIfDisposed(),LYe(this)};ce().prototype.pad=function(n,e){return this.throwIfDisposed(),$G(this,n,e)};ce().prototype.pool=function(n,e,t,r,a,i){return this.throwIfDisposed(),VYe(this,n,e,t,r,a,i)};ce().prototype.pow=function(n){return this.throwIfDisposed(),Dm(this,n)};ce().prototype.prelu=function(n){return this.throwIfDisposed(),UYe(this,n)};ce().prototype.prod=function(n,e){return this.throwIfDisposed(),KYe(this,n,e)};ce().prototype.reciprocal=function(){return this.throwIfDisposed(),nZe(this)};ce().prototype.relu=function(){return this.throwIfDisposed(),aZe(this)};ce().prototype.relu6=function(){return this.throwIfDisposed(),oZe(this)};ce().prototype.reshapeAs=function(n){return this.throwIfDisposed(),pe(this,n.shape)};ce().prototype.reshape=function(n){return this.throwIfDisposed(),pe(this,n)};ce().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),LZe(this,n,e,t)};ce().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),$Ze(this,n,e,t)};ce().prototype.reverse=function(n){return this.throwIfDisposed(),Nm(this,n)};ce().prototype.rfft=function(){return this.throwIfDisposed(),SZe(this)};ce().prototype.round=function(){return this.throwIfDisposed(),cZe(this)};ce().prototype.rsqrt=function(){return this.throwIfDisposed(),gG(this)};ce().prototype.selu=function(){return this.throwIfDisposed(),fZe(this)};ce().prototype.separableConv2d=function(n,e,t,r,a,i){return this.throwIfDisposed(),pZe(this,n,e,t,r,a,i)};ce().prototype.sigmoid=function(){return this.throwIfDisposed(),Ak(this)};ce().prototype.sign=function(){return this.throwIfDisposed(),vZe(this)};ce().prototype.sin=function(){return this.throwIfDisposed(),pG(this)};ce().prototype.sinh=function(){return this.throwIfDisposed(),dG(this)};ce().prototype.slice=function(n,e){return this.throwIfDisposed(),$i(this,n,e)};ce().prototype.softmax=function(n){return this.throwIfDisposed(),gZe(this,n)};ce().prototype.softplus=function(){return this.throwIfDisposed(),MG(this)};ce().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),Nk(this,n,e)};ce().prototype.split=function(n,e){return this.throwIfDisposed(),xm(this,n,e)};ce().prototype.sqrt=function(){return this.throwIfDisposed(),rs(this)};ce().prototype.square=function(){return this.throwIfDisposed(),sr(this)};ce().prototype.squaredDifference=function(n){return this.throwIfDisposed(),TZe(this,n)};ce().prototype.squeeze=function(n){return this.throwIfDisposed(),IZe(this,n)};ce().prototype.stack=function(n,e){this.throwIfDisposed();let t=n instanceof Sr?[this,n]:[this,...n];return WG(t,e)};ce().prototype.step=function(n){return this.throwIfDisposed(),Tm(this,n)};ce().prototype.stridedSlice=function(n,e,t,r,a,i,o,s){return this.throwIfDisposed(),_Ze(this,n,e,t,r,a,i,o,s)};ce().prototype.sub=function(n){return this.throwIfDisposed(),fr(this,n)};ce().prototype.sum=function(n,e){return this.throwIfDisposed(),Tt(this,n,e)};ce().prototype.tan=function(){return this.throwIfDisposed(),FZe(this)};ce().prototype.tanh=function(){return this.throwIfDisposed(),m9e(this)};ce().prototype.tile=function(n){return this.throwIfDisposed(),yG(this,n)};ce().prototype.toBool=function(){return this.throwIfDisposed(),ot(this,"bool")};ce().prototype.toFloat=function(){return this.throwIfDisposed(),ot(this,"float32")};ce().prototype.toInt=function(){return this.throwIfDisposed(),ot(this,"int32")};ce().prototype.topk=function(n,e){return this.throwIfDisposed(),OZe(this,n,e)};ce().prototype.transpose=function(n){return this.throwIfDisposed(),gu(this,n)};ce().prototype.unique=function(n){return this.throwIfDisposed(),MZe(this,n)};ce().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),bG(this,n,e)};ce().prototype.unstack=function(n){return this.throwIfDisposed(),SG(this,n)};ce().prototype.where=function(n,e){return this.throwIfDisposed(),fo(n,this,e)};ce().prototype.zerosLike=function(){return this.throwIfDisposed(),kn(this)};var EJe="4.2.0";var IJe={"tfjs-core":Kx.version_core,"tfjs-backend-cpu":l5e.version_cpu,"tfjs-backend-webgl":f5e.version_webgl,"tfjs-data":dW.version_data,"tfjs-layers":jx.version_layers,"tfjs-converter":Xx.version_converter,tfjs:EJe};Object.keys(Kx).forEach(function(n){n!=="default"&&Object.defineProperty(xu,n,{enumerable:!0,get:function(){return Kx[n]}})});Object.keys(jx).forEach(function(n){n!=="default"&&Object.defineProperty(xu,n,{enumerable:!0,get:function(){return jx[n]}})});Object.keys(Xx).forEach(function(n){n!=="default"&&Object.defineProperty(xu,n,{enumerable:!0,get:function(){return Xx[n]}})});xu.data=dW;xu.version=IJe});var il=J((xit,HG)=>{var{argmin:CJe,distance:AJe,isArray:_Je,isDataFrame:GG,isNumber:DJe,isSeries:FJe,shape:RJe}=Ct(),Bh=VG(),OJe=new Function("try { return this === window } catch(e) { return false }");function UG(n){return Lh(n)?UG(n.arraySync()):GG(n)?!0:_Je(n)&&RJe(n).length===2}function Lh(n){return n instanceof Bh.Tensor}function PJe(n){return DJe(n)&&parseInt(n)===n&&n>=0}function MJe(n,e){return Bh.tidy(()=>{Lh(n)&&(n=n.arraySync()),Lh(e)&&(e=e.arraySync());let t=[],r=e.slice();return n.forEach(a=>{let i=CJe(r.map(o=>AJe(a,o)));t.push(r[i]),r.splice(i,1)}),t.concat(r)})}function BJe(n){return Bh.tidy(()=>((GG(n)||FJe(n))&&(n=n.values),Lh(n)||(n=Bh.tensor(n)),n.div(n.abs())))}HG.exports={isBrowser:OJe,isMatrix:UG,isTFTensor:Lh,isWholeNumber:PJe,orderCentroids:MJe,sign:BJe,tf:Bh}});var Pk=J((kit,XG)=>{var{assert:Rk,flatten:KG,isDataFrame:ku,isEqual:Ok,isSeries:Su,isUndefined:LJe,shape:ol}=Ct(),{isTFTensor:Nu,sign:zJe,tf:Wi}=il();function $Je(n,e){return Nu(n)&&(n=n.arraySync()),(ku(n)||Su(n))&&(n=n.values),Nu(e)&&(e=e.arraySync()),(ku(e)||Su(e))&&(e=e.values),Rk(Ok(ol(n),ol(e)),"`yPred` and `yTrue` must have the same shape!"),Wi.tidy(()=>Wi.tensor(n).sub(Wi.tensor(e)).pow(2).sum().arraySync())}function qJe(n,e){Nu(n)&&(n=n.arraySync()),(ku(n)||Su(n))&&(n=n.values),Nu(e)&&(e=e.arraySync()),(ku(e)||Su(e))&&(e=e.values),Rk(Ok(ol(n),ol(e)),"`yPred` and `yTrue` must have the same shape!");let t=KG(n),r=KG(e),a=0;return t.forEach((i,o)=>{i===r[o]&&a++}),a/t.length}function jG(n,e,t){return Wi.tidy(()=>{Nu(n)&&(n=n.arraySync()),(ku(n)||Su(n))&&(n=n.values),Nu(e)&&(e=e.arraySync()),(ku(e)||Su(e))&&(e=e.values),LJe(t)&&(t=n),Nu(t)&&(t=t.arraySync()),(ku(t)||Su(t))&&(t=t.values),typeof t=="number"&&(t=[t]),Rk(Ok(ol(n),ol(e)),"`yTrue` and `yPred` must have the same shape!"),n=Wi.tensor(n),e=Wi.tensor(e),t=Wi.tensor(t);let r=n.sub(e).pow(2).sum(),a=n.sub(t.mean()).pow(2).sum();return Wi.scalar(1).sub(r.div(a)).arraySync()})}function WJe(n,e,t){return Wi.tidy(()=>{let r=Wi.scalar(jG(n,e,t));return zJe(r).mul(r.abs().sqrt()).arraySync()})}XG.exports={sse:$Je,accuracy:qJe,rSquared:jG,rScore:WJe}});var Vi=J((Sit,YG)=>{YG.exports={shouldIgnoreNaNValues:!0}});var sl=J((Nit,JG)=>{var{assert:VJe,flatten:GJe,isArray:UJe,isDataFrame:HJe,isNumber:KJe,isSeries:jJe}=Ct();function ZG(n){if(HJe(n)||jJe(n))return ZG(n.values);VJe(UJe(n),"The `containsOnlyNumbers` function only works on arrays, Series, and DataFrames!");let e=GJe(n);for(let t=0;t<e.length;t++)if(!KJe(e[t]))return!1;return!0}JG.exports=ZG});var Bk=J((Tit,QG)=>{var{dropMissing:XJe,flatten:YJe,isArray:ZJe,isDataFrame:JJe,isSeries:QJe}=Ct();function Mk(n){return typeof n=="number"?n===0||n===1:JJe(n)||QJe(n)?Mk(n.values):ZJe(n)?n.length===0?!1:XJe(YJe(n)).every(t=>Mk(t)):!1}QG.exports=Mk});var Lk=J((Eit,uU)=>{var{abs:eU,apply:tU,assert:nU,clamp:eQe,copy:tQe,divide:nQe,dropNaN:rQe,flatten:aQe,isArray:iQe,isDataFrame:oQe,isNumber:rU,isSeries:sQe,max:aU,median:iU,min:uQe,sort:cQe,subtract:oU}=Ct(),lQe=Vi(),fQe=sl(),hQe=Bk();function sU(n,e){if(oQe(n)||sQe(n)){let u=n.copy();return u._values=sU(u._values,e),u}if(nU(iQe(n),"The `clipOutliers` function only works on arrays, Series, and DataFrames!"),e=e||5,nU(rU(e),"Any `maxScore` value passed into the `clipOutliers` function must be a number!"),!lQe.shouldIgnoreNaNValues&&!fQe(n))return tU(n,()=>NaN);let t=aQe(n),r=rQe(t);if(hQe(r)||r.length===0)return n;let a=iU(r),i=iU(eU(oU(r,a))),o=!1;if(i===0){let u=cQe(tQe(r)),c=u.filter(p=>p<a),l=u.filter(p=>p>a),f=a,h=a;if(c.length>0&&(f=aU(c)),l.length>0&&(h=uQe(l)),i=(h-f)/2,i===0)return n;o=(a-f)/i>e||(h-a)/i>e}return aU(nQe(eU(oU(r,a)),i))>e||o?tU(n,u=>rU(u)?eQe(u,a-e*i,a+e*i):u):n}uU.exports=sU});var $k=J((Iit,mU)=>{var{assert:cU,dropNaN:lU,isArray:fU,isSeries:hU,mean:pU,shape:dU,variance:vU}=Ct(),pQe=Vi();function zk(n,e){if(hU(n))return zk(n.values,e);if(hU(e))return zk(n,e.values);cU(fU(n)&&fU(e)&&dU(n).length===1&&dU(e).length===1,"The `cohensd` function only works on 1-dimensional arrays and Series!"),cU(n.length===e.length,"Two arrays or Series passed into the `cohensd` function must have the same length!"),pQe.shouldIgnoreNaNValues&&(n=lU(n),e=lU(e));try{let t=pU(n),r=pU(e),a=Math.sqrt((vU(n)+vU(e))/2);return(t-r)/a}catch{return NaN}}mU.exports=zk});var wU=J((Cit,bU)=>{var{assert:gU,DataFrame:dQe,isArray:vQe,isSeries:mQe,shape:gQe,zeros:yQe}=Ct();function yU(n){if(mQe(n)){let r=new dQe(yU(n.values));return r.index=n.index.slice(),r.columns=n.index.slice(),r}gU(vQe(n),"The `diagonalize` function only works on 1-dimensional arrays and Series!");let e=gQe(n);gU(e.length===1,"The `diagonalize` function only works on 1-dimensional arrays and Series!");let t=yQe([e[0],e[0]]);return n.forEach((r,a)=>t[a][a]=r),t}bU.exports=yU});var Gk=J((Ait,NU)=>{var{assert:qk,clamp:bQe,correl:xU,DataFrame:Rm,dropNaNPairwise:wQe,isArray:kU,isDataFrame:Om,isJagged:SU,isUndefined:xQe,ndarray:kQe}=Ct(),SQe=Vi();function Wk(n){let e="@jrc03c/js-data-science-helpers/get-correlation-matrix";return Object.defineProperty(n,e,{configurable:!1,enumerable:!1,writable:!1,value:Symbol.for(e)}),n}function Vk(n,e){if(xQe(e)&&(e=n),Om(n)){let r=new Rm(Vk(n.values,e));return r.index=n.columns.slice(),r.columns=Om(e)?e.columns.slice():new Rm(e).columns.slice(),Wk(r)}if(Om(e)){let r=new Rm(Vk(n,e.values));return r.index=Om(n)?n.columns.slice():new Rm(n).columns.slice(),r.columns=e.columns.slice(),Wk(r)}qk(kU(n)&&kU(e),"The `getCorrelationMatrix` function only works on 2-dimensional arrays and DataFrames!"),qk(!SU(n)&&!SU(e),"The `getCorrelationMatrix` function only works on non-jagged 2-dimensional arrays and DataFrames!"),qk(n.length===e.length,'The dimensions of the matrices you passed into the `getCorrelationMatrix` function aren\'t compatible! ([shape(a).join(", ")] vs. [shape(b).join(", ")]) The function expects that you\'ll be comparing the columns of two matrices where the columns are all of the same length, so please make sure that the matrices are oriented accordingly.');let t=kQe([n[0].length,e[0].length]);for(let r=0;r<n[0].length;r++){let a=n.map(i=>i[r]);for(let i=0;i<e[0].length;i++){let o=e.map(s=>s[i]);SQe.shouldIgnoreNaNValues?t[r][i]=xU(...wQe(a,o)):t[r][i]=xU(a,o)}}return Wk(bQe(t,-1,1))}NU.exports=Vk});var Uk=J((_it,TU)=>{function NQe(n){try{let e="@jrc03c/js-data-science-helpers/get-correlation-matrix";return n[e]===Symbol.for(e)}catch{return!1}}TU.exports=NQe});var AU=J((Dit,CU)=>{var{DataFrame:Hk,isArray:TQe,isDataFrame:Pm,isNumber:EU,MathError:EQe,sort:IQe}=Ct(),IU=Gk(),CQe=Uk();function AQe(n,e,t){t=Object.values(arguments).find(i=>EU(i))||1-1e-5;let r=(()=>{let i=Object.values(arguments).filter(o=>TQe(o)||Pm(o));if(i.length===1){let o=i[0];if(CQe(o))return Pm(o)?o:new Hk(o);{let s=IU(o,null);return Pm(s)?s:new Hk(s)}}if(i.length===2){let o=IU(i[0],i[1]);return Pm(o)?o:new Hk(o)}throw new EQe("You must pass 1 or 2 2-dimensional arrays or DataFrames into the `getHighlyCorrelatedColumns` function!")})(),a={};return r.values.forEach((i,o)=>{i.forEach((s,u)=>{if(EU(s)&&s>t){let c=r.index[o],l=r.columns[u];a[c]||(a[c]=[]),a[c].indexOf(l)<0&&a[c].push(l),a[l]||(a[l]=[]),a[l].indexOf(c)<0&&a[l].push(c)}})}),Object.keys(a).forEach(i=>{a[i]=IQe(a[i])}),a}CU.exports=AQe});var Kk=J((Fit,DU)=>{var{dropNaN:_Qe,isArray:DQe,isDataFrame:FQe,isNumber:RQe,isSeries:OQe,pow:PQe,sqrt:MQe,sum:BQe}=Ct(),LQe=Vi();function _U(n){return FQe(n)||OQe(n)?_U(n.values):RQe(n)?Math.abs(n):DQe(n)?(LQe.shouldIgnoreNaNValues&&(n=_Qe(n)),MQe(BQe(PQe(n,2)))):NaN}DU.exports=_U});var jk=J((Rit,OU)=>{var{assert:FU,DataFrame:zQe,isArray:$Qe,isSeries:qQe,isString:WQe,isUndefined:VQe,set:GQe,shape:UQe,sort:HQe}=Ct();function RU(){if(arguments.length===1&&qQe(arguments[0])){let{name:i,values:o}=arguments[0],s=RU(i,o),u=new zQe(s);return u.index=arguments[0].index.slice(),u}let[n,e]=arguments;FU(WQe(n),"When passing two arguments into the `getOneHotEncodings` function, the first argument must be a string representing the name of the variable being encoded!"),FU($Qe(e)&&UQe(e).length===1,"When passing two arguments into the `getOneHotEncodings` function, the second argument must be a 1-dimensional array!");let t={},r=n+"_"+e[0];return HQe(GQe(e)).filter(i=>!VQe(i)).map(i=>n+"_"+i).filter(i=>i!==r).forEach(i=>{t[i]=e.map(o=>i===n+"_"+o?1:0)}),t}OU.exports=RU});var MU=J((Oit,PU)=>{var{count:KQe}=Ct();function jQe(n){return KQe(n).map(t=>(t.percentage=t.count/n.length,t))}PU.exports=jQe});var BU=J((Pit,XQe)=>{XQe.exports=[.5,.49601,.49202,.48803,.48405,.48006,.47608,.4721,.46812,.46414,.46017,.4562,.45224,.44828,.44433,.44038,.4364,.43251,.42858,.42465,.42074,.41683,.41294,.40905,.40517,.40129,.39743,.39358,.38974,.38591,.38209,.37828,.37448,.3707,.36693,.36317,.35942,.35569,.35197,.34827,.34458,.3409,.33724,.3336,.32997,.32636,.32276,.31918,.31561,.31207,.30854,.30503,.30153,.29806,.2946,.29116,.28774,.28434,.28096,.2776,.27425,.27093,.26763,.26435,.26109,.25785,.25463,.25143,.24825,.2451,.24196,.23885,.23576,.2327,.22965,.22663,.22363,.22065,.2177,.21476,.21186,.20897,.20611,.20327,.20045,.19766,.19489,.19215,.18943,.18673,.18406,.18141,.17879,.17619,.17361,.17106,.16853,.16602,.16354,.16109,.15866,.15625,.15386,.15151,.14917,.14686,.14457,.14231,.14007,.13786,.13567,.1335,.13136,.12924,.12714,.12507,.12302,.121,.119,.11702,.11507,.11314,.11123,.10935,.10749,.10565,.10383,.10204,.10027,.09853,.0968,.0951,.09342,.09176,.09012,.08851,.08692,.08534,.08379,.08226,.08076,.07927,.0778,.07636,.07493,.07353,.07215,.07078,.06944,.06811,.06681,.06552,.06426,.06301,.06178,.06057,.05938,.05821,.05705,.05592,.0548,.0537,.05262,.05155,.0505,.04947,.04846,.04746,.04648,.04551,.04457,.04363,.04272,.04182,.04093,.04006,.0392,.03836,.03754,.03673,.03593,.03515,.03438,.03362,.03288,.03216,.03144,.03074,.03005,.02938,.02872,.02807,.02743,.0268,.02619,.02559,.025,.02442,.02385,.0233,.02275,.02222,.02169,.02118,.02068,.02018,.0197,.01923,.01876,.01831,.01786,.01743,.017,.01659,.01618,.01578,.01539,.015,.01463,.01426,.0139,.01355,.01321,.01287,.01255,.01222,.01191,.0116,.0113,.01101,.01072,.01044,.01017,.0099,.00964,.00939,.00914,.00889,.00866,.00842,.0082,.00798,.00776,.00755,.00734,.00714,.00695,.00676,.00657,.00639,.00621,.00604,.00587,.0057,.00554,.00539,.00523,.00508,.00494,.0048,.00466,.00453,.0044,.00427,.00415,.00402,.00391,.00379,.00368,.00357,.00347,.00336,.00326,.00317,.00307,.00298,.00289,.0028,.00272,.00264,.00256,.00248,.0024,.00233,.00226,.00219,.00212,.00205,.00199,.00193,.00187,.00181,.00175,.00169,.00164,.00159,.00154,.00149,.00144,.00139,.00135,.00131,.00126,.00122,.00118,.00114,.00111,.00107,.00104,.001,97e-5,94e-5,9e-4,87e-5,84e-5,82e-5,79e-5,76e-5,74e-5,71e-5,69e-5,66e-5,64e-5,62e-5,6e-4,58e-5,56e-5,54e-5,52e-5,5e-4,48e-5,47e-5,45e-5,43e-5,42e-5,4e-4,39e-5,38e-5,36e-5,35e-5,34e-5,32e-5,31e-5,3e-4,29e-5,28e-5,27e-5,26e-5,25e-5,24e-5,23e-5,22e-5,22e-5,21e-5,2e-4,19e-5,19e-5,18e-5,17e-5,17e-5,16e-5,15e-5,15e-5,14e-5,14e-5,13e-5,13e-5,12e-5,12e-5,11e-5,11e-5,1e-4,1e-4,1e-4,9e-5,9e-5,8e-5,8e-5,8e-5,8e-5,7e-5,7e-5,7e-5,6e-5,6e-5,6e-5,6e-5,5e-5,5e-5,5e-5,5e-5,5e-5,4e-5,4e-5,4e-5,4e-5,4e-5,4e-5,3e-5,3e-5,3e-5,3e-5,3e-5,3e-5,3e-5,3e-5,2e-5,2e-5,2e-5,2e-5]});var Yk=J((Mit,HU)=>{var{abs:LU,assert:YQe,dropNaNPairwise:ZQe,flatten:Mm,isArray:zU,isDataFrame:$U,isEqual:JQe,isSeries:qU,mean:WU,remap:QQe,round:eet,shape:VU,sqrt:tet,std:GU}=Ct(),net=Vi(),UU=BU();function ret(n){return LU(n)>4.1?0:UU[eet(QQe(LU(n),0,4.1,0,UU.length))]}function Xk(n,e){if($U(n)||qU(n))return Xk(n.values,e);if($U(e)||qU(e))return Xk(n,e.values);YQe(zU(n)&&zU(e)&&JQe(VU(n),VU(e)),"You must pass two identically-shaped arrays, Series, or DataFrames into the `pValue` function!");let[t,r]=net.shouldIgnoreNaNValues?ZQe(Mm(n),Mm(e)):[Mm(n),Mm(e)];if(t.length===0||r.length===0)return NaN;let a=WU(t),i=WU(r),o=GU(t),s=GU(r),u=t.length,c=r.length,l=(a-i)/tet(o*o/u+s*s/c);return 2*ret(l)}HU.exports=Xk});var ZU=J((Bit,YU)=>{var{assert:Zk,clamp:aet,DataFrame:Bm,dropNaNPairwise:iet,isArray:KU,isDataFrame:Lm,isJagged:jU,isUndefined:oet,ndarray:set}=Ct(),uet=Vi(),XU=Yk();function Jk(n){let e="@jrc03c/js-data-science-helpers/get-p-value-matrix";return Object.defineProperty(n,e,{configurable:!1,enumerable:!1,writable:!1,value:Symbol.for(e)}),n}function Qk(n,e){if(oet(e)&&(e=n),Lm(n)){let r=new Bm(Qk(n.values,e));return r.index=n.columns.slice(),r.columns=Lm(e)?e.columns.slice():new Bm(e).columns.slice(),Jk(r)}if(Lm(e)){let r=new Bm(Qk(n,e.values));return r.index=Lm(n)?n.columns.slice():new Bm(n).columns.slice(),r.columns=e.columns.slice(),Jk(r)}Zk(KU(n)&&KU(e),"The `getPValueMatrix` function only works on 2-dimensional arrays and DataFrames!"),Zk(!jU(n)&&!jU(e),"The `getPValueMatrix` function only works on non-jagged 2-dimensional arrays and DataFrames!"),Zk(n.length===e.length,'The dimensions of the matrices you passed into the `getPValueMatrix` function aren\'t compatible! ([shape(a).join(", ")] vs. [shape(b).join(", ")]) The function expects that you\'ll be comparing the columns of two matrices where the columns are all of the same length, so please make sure that the matrices are oriented accordingly.');let t=set([n[0].length,e[0].length]);for(let r=0;r<n[0].length;r++){let a=n.map(i=>i[r]);for(let i=0;i<e[0].length;i++){let o=e.map(s=>s[i]);uet.shouldIgnoreNaNValues?t[r][i]=XU(...iet(a,o)):t[r][i]=XU(a,o)}}return Jk(aet(t,0,1))}YU.exports=Qk});var n6=J((Lit,t6)=>{var{assert:zm,intersect:cet,isDataFrame:JU,isSeries:QU,isUndefined:e6}=Ct(),ul=class{constructor(e){let t=this;zm(e6(e)||e===ul.DROP_NAN_MODE||e===ul.DROP_MISSING_MODE,"The `mode` value passed into the `IndexMatcher` constructor must be undefined or one of [IndexMatcher.DROP_NAN_MODE, IndexMatcher.DROP_MISSING_MODE]! (By default, the mode is `Indexer.DROP_MISSING_MODE`.)"),t.mode=e6(e)?ul.DROP_MISSING_MODE:e,t.index=null}fit(){let e=this,t=[];return Object.values(arguments).forEach(r=>{zm(JU(r)||QU(r),"The `IndexMatcher` only works on Series and DataFrames! To drop NaN values in a pair-wise fashion from regular arrays, use the `dropNaNPairwise` function from the @jrc03c/js-math-tools library."),e.mode===ul.DROP_MISSING_MODE?t.push(r.dropMissing().index):t.push(r.dropNaN().index)}),e.index=cet(...t),e}transform(){let e=this;zm(!!e.index,"The IndexMatcher hasn't been fitted yet! Please call the `fit` method before calling the `transform` method.");let t=Object.values(arguments).map(r=>(zm(JU(r)||QU(r),"The `IndexMatcher` only works on Series and DataFrames! To drop NaN values in a pair-wise fashion from regular arrays, use the `dropNaNPairwise` function from the @jrc03c/js-math-tools library."),r.get(e.index,null)));return t.length===1?t[0]:t}fitAndTransform(){return this.fit(...arguments).transform(...arguments)}},zh=ul;Km(zh,"DROP_NAN_MODE","DROP_NAN_MODE"),Km(zh,"DROP_MISSING_MODE","DROP_MISSING_MODE");t6.exports=zh});var t2=J(($it,s6)=>{var{assert:e2,isArray:fet,isBoolean:het,isDataFrame:r6,isSeries:a6,int:pet,isNumber:det,isUndefined:i6,range:o6,set:vet,shape:met,shuffle:get}=Ct();s6.exports=function(){let e=Array.from(arguments),t=e.find(p=>het(p)),r=i6(t)?!0:t,a=e.find(p=>det(p)),i=i6(a)?.1:a;e2(i>0&&i<1,"`testSize` must be a number between 0 and 1 (exclusive on both ends)!");let o=e.filter(p=>fet(p)||r6(p)||a6(p));e2(o.length>0,"You must pass at least one dataset into the `trainTestSplit` function!");let s=o.map(p=>met(p)[0]);e2(vet(s).length===1,`All datasets passed into the \`trainTestSplit\` function must be the same length at their shallowest dimension! The lengths of your datasets, though, are: ${s.join(", ")}`);let u=[],c=r?get(o6(0,s[0])):o6(0,s[0]),l=pet((1-i)*c.length),f=c.slice(0,l),h=c.slice(l);return o.forEach(p=>{if(r6(p))u.push(p.get(f,null)),u.push(p.get(h,null));else if(a6(p))u.push(p.get(f)),u.push(p.get(h));else{let d=[],v=[];p.forEach((m,g)=>{f.indexOf(g)>-1?d.push(m):v.push(m)}),u.push(d),u.push(v)}}),u}});var qm=J((qit,p6)=>{var{add:yet,argmin:bet,assert:wet,flatten:u6,isArray:xet,isDataFrame:c6,isEqual:ket,int:Net,isNumber:Tet,isSeries:l6,normal:n2,pow:Eet,random:Iet,range:Cet,scale:Aet,shape:$m,subtract:_et,sum:Det}=Ct(),Fet=t2();function r2(n,e){(c6(n)||l6(n))&&(n=n.values),(c6(e)||l6(e))&&(e=e.values),wet(ket($m(n),$m(e)),"`yPred` and `yTrue` must have the same shape!");let t=u6(n),r=u6(e),a=0;return t.forEach((i,o)=>{i===r[o]&&a++}),a/t.length}function Ret(n){test(`tests that the \`${n.name}\` model works correctly`,()=>{let e=n2([5,10]).map(f=>f.map(h=>h*100+n2()*100)),t=[],r=Cet(0,500).map(()=>{let f=Net(Iet()*e.length),h=e[f];return t.push(f),yet(h,Aet(5,n2($m(h))))}),[a,i,o,s]=Fet(r,t),u=new n({k:e.length});u.fit(a),u.centroids=f6(e,u.centroids);let c=u.predict(a),l=u.predict(i);expect(r2(o,c)).toBeGreaterThan(.95),expect(r2(s,l)).toBeGreaterThan(.95)})}function Oet(n){return xet(n)&&$m(n).length===2}function Pet(n){return Tet(n)&&parseInt(n)===n&&n>=0}function f6(n,e){return n.map(t=>e[bet(e.map(r=>h6(t,r)))])}function h6(n,e){return Det(Eet(_et(n,e),2))}p6.exports={accuracy:r2,createGenericTest:Ret,isMatrix:Oet,isWholeNumber:Pet,orderCentroids:f6,sse:h6}});var o2=J((Wit,g6)=>{var{add:d6,argmin:Met,assert:Tu,copy:Bet,distance:v6,divide:Let,isDataFrame:zet,isFunction:$et,isUndefined:Wm,normal:qet,random:Wet,range:Vet,scale:Get,shuffle:Uet,zeros:m6}=Ct(),{isMatrix:Het,isWholeNumber:a2,sse:Ket}=qm(),i2=class{constructor(e){Tu(typeof e=="object","`config` must be an object! See the documentation for more information about the properties that the `config` object can contain."),Tu(a2(e.k),"`k` must be a whole number!"),Tu(a2(e.maxIterations)||Wm(e.maxIterations),"`maxIterations` must be a whole number or undefined!"),Tu(a2(e.maxRestarts)||Wm(e.maxRestarts),"`maxRestarts` must be a whole number or undefined!"),Tu(typeof e.tolerance=="number"||Wm(e.tolerance),"`tolerance` must be a number or undefined!");let t=this;t.k=e.k,t.maxRestarts=e.maxRestarts||25,t.maxIterations=e.maxIterations||100,t.tolerance=e.tolerance||1e-4,t.centroids=null,t._fitState=null}initializeCentroids(e){let t=this;return Uet(e).slice(0,t.k)}fitStep(e,t){let r=this;if(Tu(Het(e),"`x` must be a matrix!"),zet(e)&&(e=e.values),Wm(t)||Tu($et(t),"If defined, `progress` must be a function!"),r._fitState){if(r._fitState.isFinished)return r}else{let u=r.initializeCentroids(e);r._fitState={currentRestart:0,currentIteration:0,currentCentroids:u,bestCentroids:u,bestScore:-1/0,isFinished:!1}}let a=r.predict(e,r._fitState.currentCentroids),i=[],o=m6(r.k);e.forEach((u,c)=>{let l=a[c];i[l]||(i[l]=m6(u.length)),i[l]=d6(i[l],u),o[l]++});let s=Vet(0,r.k).map(u=>o[u]===0?d6(r._fitState.currentCentroids[parseInt(Wet()*r._fitState.currentCentroids.length)],Get(.001,qet(r._fitState.currentCentroids[0].length))):Let(i[u],o[u]));if(v6(r._fitState.currentCentroids,s)<r.tolerance?r._fitState.currentIteration=r.maxIterations-1:r._fitState.currentCentroids=s,t&&t((r._fitState.currentRestart+r._fitState.currentIteration/r.maxIterations)/r.maxRestarts,r),r._fitState.currentIteration++,r._fitState.currentIteration>=r.maxIterations){let u=r.score(e,r._fitState.currentCentroids);if(u>r._fitState.bestScore&&(r._fitState.bestScore=u,r._fitState.bestCentroids=Bet(r._fitState.currentCentroids)),r._fitState.currentIteration=0,r._fitState.currentRestart++,r._fitState.currentRestart>=r.maxRestarts)r._fitState.isFinished=!0,r.centroids=r._fitState.bestCentroids,t&&t(1,r);else{let c=r.initializeCentroids(e);r._fitState.currentCentroids=c}}return r}fit(e,t){let r=this;for(r._fitState&&(r._fitState=null);!r._fitState||!r._fitState.isFinished;)r.fitStep(e,t);return r}predict(e,t){if(t=t||this.centroids,!t)throw new Error("No centroids were provided to the `predict` method, and the K-Means model hasn't been fitted yet. Please either pass centroids as a second parameter to the `predict` method or run the `fit` method first!");return e.map(a=>Met(t.map(i=>v6(a,i))))}score(e,t){let r=this;if(t=t||r.centroids,!t)throw new Error("No centroids were provided to the `score` method, and the K-Means model hasn't been fitted yet. Please either pass centroids as a second parameter to the `score` method or run the `fit` method first!");let i=r.predict(e,t).map(o=>t[o]);return-Ket(e,i)}};g6.exports=i2});var u2=J((Vit,w6)=>{var{argmin:jet,distance:y6,divide:Xet,max:Yet,random:b6}=Ct(),Zet=o2(),s2=class extends Zet{initializeCentroids(e){let t=this,r=[e[parseInt(b6()*e.length)]];for(;r.length<t.k;){let a=e.map(o=>y6(o,r[jet(r.map(s=>y6(o,s)))])),i=Xet(a,Yet(a));r.push(e[i.findIndex(o=>b6()<o)])}return r}};w6.exports=s2});var S6=J((Git,k6)=>{var{assert:po,isArray:Jet,isDataFrame:Qet,isEqual:ett,isFunction:ttt,isUndefined:cl,range:ntt,shape:x6}=Ct(),{isMatrix:rtt,isWholeNumber:c2}=qm(),att=u2(),l2=class{constructor(e){cl(e)&&(e={}),po(typeof e=="object","`config` must be an object! See the documentation for more information about the properties that the `config` object can contain."),cl(e.ks)&&(e.ks=ntt(1,16)),po(Jet(e.ks),"`ks` must be an array of whole numbers!"),e.ks.forEach(r=>{po(c2(r),"`ks` must be an array of whole numbers!")}),po(c2(e.maxIterations)||cl(e.maxIterations),"`maxIterations` must be a whole number or undefined!"),po(c2(e.maxRestarts)||cl(e.maxRestarts),"`maxRestarts` must be a whole number or undefined!"),po(typeof e.tolerance=="number"||cl(e.tolerance),"`tolerance` must be a number or undefined!");let t=this;t.ks=e.ks,t.maxRestarts=e.maxRestarts||25,t.maxIterations=e.maxIterations||100,t.tolerance=e.tolerance||1e-4,t.scoreStopRatio=e.scoreStopRatio||.85,t.modelClass=e.modelClass||att,t.fittedModel=null,t._fitState=null}fitStep(e,t){let r=this;if(po(rtt(e),"`x` must be a matrix!"),Qet(e)&&(e=e.values),cl(t)||po(ttt(t),"If defined, `progress` must be a function!"),!r._fitState)r._fitState={isFinished:!1,lastScore:-1/0,currentIndex:0};else if(r._fitState.isFinished)return r;let a=r.ks[r._fitState.currentIndex],i=new r.modelClass({k:a,maxRestarts:10,maxIterations:20});i.fit(e,s=>t?t((r._fitState.currentIndex+s)/(r.ks.length+1)):null);let o=i.score(e);return o/r._fitState.lastScore>r.scoreStopRatio?(r._fitState.isFinished=!0,r._fitState.currentIndex--):(r._fitState.lastScore=o,r._fitState.currentIndex+1>=r.ks.length?r._fitState.isFinished=!0:r._fitState.currentIndex++),r._fitState.isFinished&&(r.fittedModel=new r.modelClass({k:r.ks[r._fitState.currentIndex],maxRestarts:r.maxRestarts,maxIterations:r.maxIterations}),r.fittedModel.fit(e,s=>t?t((r.ks.length+s)/(r.ks.length+1)):null),t&&t(1)),r}fit(e,t){let r=this;for(r._fitState=null;!r._fitState||!r._fitState.isFinished;)r.fitStep(e,t);return r}predict(e,t){return this.fittedModel.predict(e,t)}score(e,t){return this.fittedModel.score(e,t)}get k(){return this.fittedModel.k}set k(e){throw new Error("You can't set the k-value manually! It has to be set automatically via the `fit` method.")}get centroids(){return this.fittedModel.centroids}set centroids(e){let t=this;po(ett(x6(e),x6(t.fittedModel.centroids)),"When assigning a new value to the `centroids` property, the new centroids must have the same shape as the old centroids!"),t.fittedModel.centroids=e}};k6.exports=l2});var T6=J((Uit,N6)=>{N6.exports={KMeansMeta:S6(),KMeansNaive:o2(),KMeansPlusPlus:u2(),helpers:qm()}});var f2=J((Hit,D6)=>{var{apply:itt,assert:ott,dropNaN:E6,isArray:stt,isDataFrame:utt,isSeries:ctt,mean:I6,std:C6}=Ct(),A6=Vi();function _6(n){if(utt(n)||ctt(n)){let r=n.copy();return r.values=_6(r.values),r}ott(stt(n),"The `normalize` function only works on arrays, Series, and DataFrames!");let e=(()=>A6.shouldIgnoreNaNValues?I6(E6(n)):I6(n))(),t=(()=>A6.shouldIgnoreNaNValues?C6(E6(n)):C6(n))();return t===0?n:itt(n,r=>(r-e)/t)}D6.exports=_6});var p2=J((Kit,M6)=>{var{assert:ll,dot:F6,isArray:R6,isSeries:h2,scale:ltt,Series:ftt,shape:O6}=Ct(),P6=sl();function Vm(n,e){if(h2(n)){if(h2(e))return new ftt(Vm(n.values,e.values));{let t=n.copy();return t.values=Vm(n.values,e),t}}if(h2(e)){let t=e.copy();return t.values=Vm(n,e.values),t}return ll(R6(n),"`project` only works on vectors!"),ll(R6(e),"`project` only works on vectors!"),ll(P6(n),"`project` only works on vectors of numbers!"),ll(P6(e),"`project` only works on vectors of numbers!"),ll(O6(n).length===1,"`project` only works on vectors!"),ll(O6(e).length===1,"`project` only works on vectors!"),ltt(F6(e,n)/F6(e,e),e)}M6.exports=Vm});var q6=J((jit,$6)=>{var{assert:B6,copy:htt,DataFrame:ptt,divide:dtt,isArray:vtt,isDataFrame:mtt,isJagged:gtt,shape:ytt,subtract:btt,transpose:L6}=Ct(),wtt=sl(),xtt=Kk(),ktt=p2();function z6(n){if(mtt(n)){let a=new ptt(z6(n.values));return a.index=n.index.slice(),a.columns=n.columns.slice(),a}B6(vtt(n)&&!gtt(n)&&ytt(n).length===2,"`orthonormalize` only works on matrices!"),B6(wtt(n),"`orthonormalize` only works on matrices of numbers!");let e=L6(n),t=[];e.forEach(a=>{let i=htt(a);t.forEach(o=>{i=btt(i,ktt(i,o))}),t.push(i)});let r=t.map(a=>dtt(a,xtt(a)));return L6(r)}$6.exports=z6});var j6=J((Xit,K6)=>{var{assert:fl,correl:Stt,DataFrame:W6,dropMissing:Ntt,inferType:V6,isArray:Ttt,isDataFrame:Ett,isEqual:Itt,isFunction:Ctt,isJagged:Att,isNumber:$h,isUndefined:_tt,set:Dtt,shape:Ftt}=Ct(),Rtt=Lk(),Ott=jk(),G6=(n,e)=>n.map(t=>t[e]),U6=n=>$h(n)&&(parseInt(n)===n||n===1/0);function H6(n,e){e=e||{};let t=$h(e.maxUniqueStrings)?e.maxUniqueStrings:7,r=$h(e.minNonMissingValues)?e.minNonMissingValues:15,a=$h(e.maxCorrelationThreshold)?e.maxCorrelationThreshold:1-1e-5,i=e.progress||null;if(Ttt(n))return fl(Ftt(n).length===2&&!Att(n),"The `preprocess` function only works on non-jagged 2-dimensional arrays and DataFrames!"),H6(new W6(n));fl(Ett(n),"You must pass a DataFrame into the `preprocess` function!"),fl(U6(t),"`maxUniqueStrings` must be a whole number!"),fl(U6(r),"`minNonMissingValues` must be a whole number!"),fl($h(a),"`maxCorrelationThreshold` must be a number!"),_tt(i)||fl(Ctt(i),"If defined, `progress` must be a function!");let o={},s={},u={},c=n.values;n.columns.forEach((f,h)=>{if(s[f])return;let p=G6(c,h),d=(()=>{if(o[f])return o[f];{let g=V6(p);return g.type==="date"&&(g.values=g.values.map(y=>y-0)),o[f]=g,g}})();if(d.type==="null"||d.type==="object"){s[f]=!0;return}let v=Ntt(d.values);if(v.length<=r){s[f]=!0;return}let m=Dtt(v);if(m.length<2){s[f]=!0;return}if(d.type==="string"&&m.length<=t){let g=Ott(f,d.values);Object.keys(g).forEach(y=>{u[y]=g[y]}),s[f]=!0;return}d.type==="number"&&(d.values=Rtt(d.values)),n.columns.slice(h+1).forEach((g,y)=>{if(s[g])return;let b=G6(c,h+y+1),w=(()=>{if(o[g])return o[g];{let x=V6(b);return x.type==="date"&&(x.values=x.values.map(N=>N-0)),o[g]=x,x}})();if(w.type===d.type){if(w.type==="number"&&Stt(w.values,d.values)>a){s[g]=!0;return}if(w.type==="string"&&Itt(w.values,d.values)){s[g]=!0;return}}}),u[f]=d.values,i&&i(h/n.columns.length)});let l=new W6(u);return l.index=n.index.slice(),l}K6.exports=H6});var aH=J((Yit,rH)=>{var{abs:Ptt,add:Mtt,assert:qh,isArray:X6,isDataFrame:Y6,isEqual:Btt,isSeries:Z6,mean:Ltt,pow:J6,scale:ztt,shape:Q6,sign:$tt,sqrt:qtt,sum:eH}=Ct(),tH=sl(),nH=(n,e)=>Mtt(n,ztt(e,-1));function d2(n,e){if(Y6(n)||Z6(n))return d2(n.values,e);if(Y6(e)||Z6(e))return d2(n,e.values);qh(X6(n),"You must pass two same-shaped numerical arrays into the `rScore` function!"),qh(X6(e),"You must pass two same-shaped numerical arrays into the `rScore` function!"),qh(Btt(Q6(n),Q6(e)),"You must pass two same-shaped numerical arrays into the `rScore` function!"),qh(tH(n),"You must pass two same-shaped numerical arrays into the `rScore` function!"),qh(tH(e),"You must pass two same-shaped numerical arrays into the `rScore` function!");let t=eH(J6(nH(n,e),2)),r=eH(J6(nH(n,Ltt(n)),2));if(r===0)return NaN;let a=1-t/r;return $tt(a)*qtt(Ptt(a))}rH.exports=d2});var cH=J((Zit,uH)=>{var{argmax:iH,assert:Wh,copy:Wtt,DataFrame:Vtt,dot:Gtt,isArray:Utt,isDataFrame:Htt,isEqual:oH,isJagged:Ktt,max:jtt,min:Xtt,reverse:Ytt,shape:Ztt,transpose:Jtt}=Ct();function sH(n){if(Utt(n)){Wh(Ztt(n).length===2&&!Ktt(n),"The `sortCorrelationMatrix` function only works on 2-dimensional arrays and DataFrames!");let a=new Vtt(n);return a.index=a.columns.slice(),sH(a).values}Wh(Htt(n),"You must pass a DataFrame into the `sortCorrelationMatrix` function!"),Wh(jtt(n.values)<=1&&Xtt(n.values)>=-1,"The correlation matrix passed into the `sortCorrelationMatrix` function must not contain values less than -1 or greater than 1!"),Wh(oH(n.values,Jtt(n.values)),"The correlation matrix passed into the `sortCorrelationMatrix` function must be symmetrical!"),Wh(oH(n.index,n.columns),"The correlation matrix passed into the `sortCorrelationMatrix` function must be symmetrical! (In this case, although the values themselves are symmetrical, the row and column names differ.)");let e=Wtt(n.index),t=[];for(;e.length>0;)if(t.length===0){let a=iH(n.values.map(i=>Gtt(i,i)));t.push(e[a]),e.splice(a,1)}else{let a=n.index.indexOf(t.at(-1)),i=iH(e.map(s=>n.values[n.index.indexOf(s)][a])),o=e[i];t.push(o),e.splice(i,1)}let r=Ytt(t);return n.get(r,r)}uH.exports=sH});var fH=J((Jit,lH)=>{var Qtt=f2();function ent(){return Qtt(...arguments)}lH.exports=ent});var wH=J((Qit,bH)=>{var{assert:Gm,DataFrame:hH,dropNaN:tnt,flatten:pH,isArray:nnt,isDataFrame:v2,isSeries:m2,mean:dH,range:rnt,Series:vH,shape:mH,stdev:gH,transpose:yH}=Ct(),ant=Vi(),g2=class{constructor(){let e=this;e.means=[],e.stdevs=[],e.wasFittedOnAVector=!1,e.hasBeenFitted=!1}_getDataArrayAndShape(e){if(v2(e))return[e.values,e.shape];if(m2(e)){let r=yH([e.values]);return[r,mH(r)]}Gm(nnt(e),"`x` must be a 1- or 2-dimensional array, DataFrame, or Series!");let t=mH(e);return Gm(t.length<3,"`x` must be a 1- or 2-dimensional array, DataFrame, or Series!"),t.length===1&&(t.push(1),e=yH([e])),[e,t]}fit(e){let t=this,r=t._getDataArrayAndShape(e);e=r[0];let a=r[1];return t.wasFittedOnAVector=a.indexOf(1)>-1,t.means=[],t.stdevs=[],rnt(0,a[1]).forEach(i=>{let o=e.map(s=>s[i]);if(ant.shouldIgnoreNaNValues){let s=tnt(o);t.means.push(dH(s)),t.stdevs.push(gH(s))}else t.means.push(dH(o)),t.stdevs.push(gH(o))}),t.hasBeenFitted=!0,t}transform(e){let t=this;if(!t.hasBeenFitted)throw new Error("This `StandardScaler` instance hasn't been trained on any data yet! Please use the `fit` method to train it before calling the `transform` method.");if(v2(e)){let o=new hH(t.transform(e.values));return o.columns=e.columns,o.index=e.index,o}if(m2(e)){let o=new vH(t.transform(e.values));return o.name=e.name,o.index=e.index,o}let r=t._getDataArrayAndShape(e);e=r[0];let a=r[1];Gm(a[1]===t.means.length,"The data you passed into the `transform` function doesn't have the same number of columns as the data set on which this StandardScaler was fitted!");let i=e.map(o=>o.map((s,u)=>(s-t.means[u])/t.stdevs[u]));return t.wasFittedOnAVector?pH(i):i}untransform(e){let t=this;if(!t.hasBeenFitted)throw new Error("This `StandardScaler` instance hasn't been trained on any data yet! Please use the `fit` method to train it before calling the `transform` method.");if(v2(e)){let o=new hH(t.untransform(e.values));return o.columns=e.columns,o.index=e.index,o}if(m2(e)){let o=new vH(t.untransform(e.values));return o.name=e.name,o.index=e.index,o}let r=t._getDataArrayAndShape(e);e=r[0];let a=r[1];Gm(a[1]===t.means.length,"The data you passed into the `untransform` function doesn't have the same number of columns as the data set on which this StandardScaler was fitted!");let i=e.map(o=>o.map((s,u)=>s*t.stdevs[u]+t.means[u]));return t.wasFittedOnAVector?pH(i):i}};bH.exports=g2});var y2=J((eot,kH)=>{var{MathError:int}=Ct(),xH={clipOutliers:Lk(),cohensD:$k(),cohensd:$k(),common:Vi(),containsOnlyNumbers:sl(),diagonalize:wU(),getCorrelationMatrix:Gk(),getHighlyCorrelatedColumns:AU(),getMagnitude:Kk(),getOneHotEncodings:jk(),getPercentages:MU(),getPValueMatrix:ZU(),IndexMatcher:n6(),isBinary:Bk(),isCorrelationMatrix:Uk(),KMeans:T6(),normalize:f2(),orthonormalize:q6(),preprocess:j6(),project:p2(),pValue:Yk(),rScore:aH(),sortCorrelationMatrix:cH(),standardize:fH(),StandardScaler:wH(),trainTestSplit:t2(),dump(){let n=this,e=typeof global<"u"?global:typeof window<"u"?window:null;if(!e)throw new int("Cannot dump functions into global scope because neither `global` nor `window` exist in the current context!");Object.keys(n).forEach(t=>{try{Object.defineProperty(e,t,{configurable:!1,enumerable:!0,writable:!1,value:n[t]})}catch{e[t]=n[t]}})}};try{window.JSDataScienceHelpers=xH}catch{}try{kH.exports=xH}catch{}});var k2=J((tot,NH)=>{var{add:ont,assert:is,isDataFrame:b2,isFunction:snt,isUndefined:w2,normal:unt,random:cnt,scale:lnt,shape:Um}=Ct(),{isMatrix:Vh,isTFTensor:Gh,tf:Za}=il(),{KMeansNaive:fnt}=y2().KMeans,{sse:SH}=Pk(),x2=class extends fnt{initializeCentroids(e){return Za.tidy(()=>Za.tensor(super.initializeCentroids(e)))}fitStep(e,t){let r=this;if(is(Vh(e),"`x` must be a matrix!"),b2(e)&&(e=e.values),w2(t)||is(snt(t),"If defined, `progress` must be a function!"),Gh(e)&&(e=e.arraySync()),r._fitState){if(r._fitState.isFinished)return r}else{let a=r.initializeCentroids(e);r._fitState={currentRestart:0,currentIteration:0,currentCentroids:a,bestCentroids:a,bestScore:-1/0,isFinished:!1}}return Za.tidy(()=>{let a=Za.tensor(e),i=r.predict(a,r._fitState.currentCentroids),o=[];for(let u=0;u<r.k;u++){let c=[];if(i.forEach((l,f)=>{l===u&&c.push(f)}),c.length===0){let l=f=>f[parseInt(cnt()*f.length)];o.push(ont(l(r._fitState.currentCentroids.arraySync()),lnt(.01,unt(e[0].length))))}else{let l=a.gather(c);o.push(l.mean(0))}}if(o=Za.stack(o),SH(r._fitState.currentCentroids,o)<r.tolerance&&(r._fitState.currentIteration=r.maxIterations-1),r._fitState.currentIteration++,r._fitState.currentIteration>=r.maxIterations){r._fitState.currentRestart++;let u=r.score(a,o);u>r._fitState.bestScore&&(r._fitState.bestScore=u,r._fitState.bestCentroids=o.clone()),r._fitState.currentIteration=0,r._fitState.currentRestart>=r.maxRestarts?r._fitState.isFinished=!0:r._fitState.currentCentroids=r.initializeCentroids(e)}else r._fitState.currentCentroids=o.clone();return r._fitState.isFinished?(r.centroids=r._fitState.bestCentroids.arraySync(),r._fitState={isFinished:!0},t&&t(1,r)):t&&t((r._fitState.currentRestart+r._fitState.currentIteration/r.maxIterations)/r.maxRestarts,r),r})}fit(e,t){let r=this;for(r._fitState=null;!r._fitState||!r._fitState.isFinished;)r.fitStep(e,t);return r}predict(e,t){let r=this;return Gh(e)&&(e=e.arraySync()),b2(e)&&(e=e.values),is(Vh(e),"`x` must be a matrix!"),t=t||r.centroids,Gh(t)&&(t=t.arraySync()),is(Vh(t)||w2(t),"`centroids` must be a matrix or undefined!"),is(Um(e)[1]===Um(t)[1],"`x` and `centroids` must have the same number of columns!"),Za.tidy(()=>{let a=Za.tensor(e).expandDims(1),i=Za.tensor(t).expandDims(0);return a.sub(i).pow(2).sum(2).argMin(1).arraySync()})}score(e,t){let r=this;return Gh(e)&&(e=e.arraySync()),b2(e)&&(e=e.values),is(Vh(e),"`x` must be a matrix!"),t=t||r.centroids,Gh(t)&&(t=t.arraySync()),is(Vh(t)||w2(t),"`centroids` must be a matrix or undefined!"),is(Um(e)[1]===Um(t)[1],"`x` and `centroids` must have the same number of columns!"),Za.tidy(()=>{let a=Za.tensor(e),i=Za.tensor(t),o=Za.tidy(()=>{let s=r.predict(a,i);return i.gather(s).arraySync()});return-SH(a,o)})}};NH.exports=x2});var T2=J((not,EH)=>{var{assert:hnt,int:TH,random:S2}=Ct(),{isMatrix:pnt,tf:hl}=il(),dnt=k2(),N2=class extends dnt{initializeCentroids(e){hnt(pnt(e),"`x` must be a matrix!");let t=this;return hl.tidy(()=>{let r=hl.tensor(e),a=[TH(S2()*e.length)];for(;a.length<t.k;){let i=a.map(l=>e[l]),o=hl.tensor(t.predict(e,i),null,"int32"),s=hl.tidy(()=>hl.tensor(i).gather(o).sub(r).pow(2).sum(1)),u=s.div(s.max()).arraySync(),c=0;for(let l=0;l<1e4;l++){c=TH(S2()*u.length);let f=u[c];if(S2()<f)break}a.push(c)}return hl.tensor(a.map(i=>e[i]))})}};EH.exports=N2});var AH=J((rot,CH)=>{var{assert:vnt,isEqual:mnt,shape:IH}=Ct(),{KMeansMeta:gnt}=y2().KMeans,{isTFTensor:ynt}=il(),bnt=T2(),E2=class extends gnt{constructor(e){super(e);let t=this;e=e||{},t.modelClass=e.modelClass||bnt}get centroids(){let e=this;return e.fittedModel?e.fittedModel.centroids:e._fitState.bestCentroids}set centroids(e){let t=this;ynt(e)&&(e=e.arraySync());let r=IH(e);if(t.centroids){let a=t.centroids,i=IH(a);vnt(mnt(r,i),`The new centroids must have the same shape as the old centroids! (expected: [${i.join(", ")}], received: [${r.join(", ")}])`)}t.fittedModel||(t.fittedModel=new t.modelClass({k:r[0],maxIterations:t.maxIterations,maxRestarts:t.maxRestarts,tolerance:t.tolerance})),t.fittedModel.centroids=e}};CH.exports=E2});var DH=J((aot,_H)=>{_H.exports={TFKMeansMeta:AH(),TFKMeansNaive:k2(),TFKMeansPlusPlus:T2()}});var wnt=J((iot,I2)=>{var FH={helpers:il(),metrics:Pk(),models:DH()};typeof I2<"u"&&(I2.exports=FH);typeof window<"u"&&(window.TFKMeans=FH)});wnt();})();
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/**
 * @license
 * Copyright 2023 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
/** @license See the LICENSE file. */
